<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:21:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-162] Thrift structures are unhashable, preventing them from being used as set elements</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-162</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;Let Foo be a Thrift structure:&lt;/p&gt;

&lt;p&gt;struct Foo {&lt;br/&gt;
 1: i32 bar&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;If you want to use it properly as a set element or a as a dictionary key, the autoegenerated Python code will complain about not being hashable:&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;&amp;gt; f1 = Foo()&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; f1.bar = 1&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; f2 = Foo()&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; f2.bar = 1&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; f1 == f2&lt;br/&gt;
True&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; set(&lt;span class=&quot;error&quot;&gt;&amp;#91;f1&amp;#93;&lt;/span&gt;) &amp;amp; set(&lt;span class=&quot;error&quot;&gt;&amp;#91;f2&amp;#93;&lt;/span&gt;)&lt;br/&gt;
set([])&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; d = {}&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; d&lt;span class=&quot;error&quot;&gt;&amp;#91;f1&amp;#93;&lt;/span&gt; = 2&lt;br/&gt;
Traceback (most recent call last):&lt;br/&gt;
 File &quot;&amp;lt;stdin&amp;gt;&quot;, line 1, in &amp;lt;module&amp;gt;&lt;br/&gt;
TypeError: unhashable instance&lt;/p&gt;

&lt;p&gt;Since Thrift structures already implement _&lt;em&gt;eq&lt;/em&gt;_ and _&lt;em&gt;ne&lt;/em&gt;&lt;em&gt;, they should implement __hash&lt;/em&gt;_ as well. The attached patch tries to mimic the behaviour of the Java compiler, including a HashCodeBuilder class written in Python.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12406031">THRIFT-162</key>
            <summary>Thrift structures are unhashable, preventing them from being used as set elements</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nsuke">Nobuaki Sukegawa</assignee>
                                    <reporter username="esteve">Esteve Fernandez</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Oct 2008 16:35:20 +0000</created>
                <updated>Wed, 14 Jun 2017 15:48:57 +0000</updated>
                            <resolved>Fri, 27 Nov 2015 23:09:03 +0000</resolved>
                                                    <fixVersion>0.10.0</fixVersion>
                                    <component>Python - Compiler</component>
                    <component>Python - Library</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="12637973" author="esteve" created="Wed, 8 Oct 2008 16:36:02 +0000"  >&lt;p&gt;Adds support for hashable Thrift structures&lt;/p&gt;</comment>
                            <comment id="12638132" author="dreiss" created="Wed, 8 Oct 2008 23:14:39 +0000"  >&lt;p&gt;My gut feeling is that Thrift structures should not be hashable in Python because they are inherently mutable.  Putting one in a set is really not safe, because you can change the value of some field, which would change the hash and break the set.&lt;/p&gt;</comment>
                            <comment id="12638237" author="esteve" created="Thu, 9 Oct 2008 09:39:46 +0000"  >&lt;p&gt;You&apos;re completely right, somehow I mixed Java and Python. It&apos;s advisable to define a custom hashCode method if you define a equals in Java, but this doesn&apos;t apply to Python, unless objects are immutable.&lt;/p&gt;

&lt;p&gt;I&apos;m using a Thrift structure to wrap uuids (as two 64 bit integers), and I needed to use them as set elements. Do you think it would be desirable to add a returnImmutable method to Thrift structures so they can be used as set elements and dictionary keys?&lt;/p&gt;</comment>
                            <comment id="12638397" author="dreiss" created="Thu, 9 Oct 2008 21:21:54 +0000"  >&lt;p&gt;I&apos;m not sure if that is any better, because you could just change the object, which would change the return value of returnImmutable.  I think Java has this same issue, but the Java convention is to trust the developer not to mutate map keys.  In your use case, I would suggest using a dict from uuid to structure.&lt;/p&gt;</comment>
                            <comment id="12638519" author="esteve" created="Fri, 10 Oct 2008 09:55:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m not sure if that is any better, because you could just change the object, which would change the return value of returnImmutable.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, if you return a new (immutable) instance, it won&apos;t depend on the original object. Of course, it won&apos;t reflect the original object, as it may evolve independently.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think Java has this same issue, but the Java convention is to trust the developer not to mutate map keys. In your use case, I would suggest using a dict from uuid to structure.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The problem here, is that dict are mutable as well, they are unhashable:&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;&amp;gt; d1 = dict(a=1)&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; set(&lt;span class=&quot;error&quot;&gt;&amp;#91;d1&amp;#93;&lt;/span&gt;)&lt;br/&gt;
Traceback (most recent call last):&lt;br/&gt;
  File &quot;&amp;lt;stdin&amp;gt;&quot;, line 1, in &amp;lt;module&amp;gt;&lt;br/&gt;
TypeError: dict objects are unhashable&lt;/p&gt;

&lt;p&gt;So, the only workaround is to use a tuple (as they&apos;re immutable) holding two integers to represent uuids, but it&apos;s kinda ugly.&lt;/p&gt;</comment>
                            <comment id="12640638" author="dreiss" created="Fri, 17 Oct 2008 19:25:21 +0000"  >&lt;p&gt;From the Python docs: &quot;&quot;&quot;If a class defines mutable objects and implements a _&lt;em&gt;cmp&lt;/em&gt;&lt;em&gt;() or __eq&lt;/em&gt;&lt;em&gt;() method, it should not implement __hash&lt;/em&gt;_(), since the dictionary implementation requires that a key&apos;s hash value is immutable (if the object&apos;s hash value changes, it will be in the wrong hash bucket).&quot;&quot;&quot;&lt;/p&gt;

&lt;p&gt;Thrift structures are inherently mutable, so they should not define _&lt;em&gt;hash&lt;/em&gt;_().  Please use a map with simple types as keys if you are using Python.&lt;/p&gt;</comment>
                            <comment id="12640644" author="bryanduxbury" created="Fri, 17 Oct 2008 19:50:03 +0000"  >&lt;p&gt;This is an interesting point, and one that should perhaps be generalized to Thrift as a whole. This same problem exists in Java and probably Ruby as well. Maybe we should disallow non-primitives as hash keys as part of the IDL.&lt;/p&gt;</comment>
                            <comment id="12640651" author="dreiss" created="Fri, 17 Oct 2008 20:31:16 +0000"  >&lt;p&gt;I agree that it is an interesting problem, but I think disallowing non-base types in sets and map keys is overkill.  C++ enforces the immutability of set members and map keys (as best as it can, given its explicit pointers and direct access to memory) using const.  As far as I can tell, Java&apos;s convention is to trust the application developer not to mutate keys rather than to make mutable objects unhashable.  In Erlang, (almost) all values are immutable/copy-on-write, so there is no problem using mutable objects as keys.  The best thing I can think of would be to put some verification code in each generator to make sure you aren&apos;t trying to do something that isn&apos;t appropriate for the language you are generating.&lt;/p&gt;</comment>
                            <comment id="12640778" author="esteve" created="Sat, 18 Oct 2008 17:09:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;From the Python docs: &quot;&quot;&quot;If a class defines mutable objects and implements a &lt;em&gt;cmp() or __eq() method, it should not implement __hash&lt;/em&gt;(), since the dictionary implementation requires that a key&apos;s hash value is immutable (if the object&apos;s hash value changes, it will be in the wrong hash bucket).&quot;&quot;&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, I know, that&apos;s why I said that only immutable objects can have both _&lt;em&gt;eq&lt;/em&gt;&lt;em&gt;() and __hash&lt;/em&gt;_()&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Thrift structures are inherently mutable, so they should not define &lt;em&gt;hash&lt;/em&gt;(). Please use a map with simple types as keys if you are using Python.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No, using a map won&apos;t solve this problem. As I already said, dictionaries (maps) are mutable and thus, can&apos;t be used as set elements. I&apos;ll either use a tuple (i64, i64) or a tree-based set, such as ZODB&apos;s TreeSet (&lt;a href=&quot;http://www.zope.org/Wikis/ZODB/guide/node6.html#SECTION000630000000000000000&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.zope.org/Wikis/ZODB/guide/node6.html#SECTION000630000000000000000&lt;/a&gt;), it won&apos;t be O(1), though.&lt;/p&gt;

&lt;p&gt;Anyway, would it be useful to add an immutable keyword to Thrift structures in the IDL? This would make structures immutable (overriding _&lt;em&gt;setattr&lt;/em&gt;_ in Python, removing setters in Java, declaring attributes with attr_reader, but not attr_writer in Ruby, etc.) I&apos;m sure there are more implications, for example, one would have to make struct members immutable as well, but would like to know your opinions.&lt;/p&gt;</comment>
                            <comment id="12640791" author="dreiss" created="Sat, 18 Oct 2008 18:38:26 +0000"  >&lt;p&gt;Sorry for the miscommunication.  I didn&apos;t mean storing a dict in your structure.  I meant replacing your set of objects with a dict from keys to objects.&lt;/p&gt;

&lt;p&gt;As for the immutable keyword, I do think that it would make sense as a type modifier (this infrastructure hasn&apos;t been implemented yet).&lt;/p&gt;</comment>
                            <comment id="12669270" author="esteve" created="Sat, 31 Jan 2009 22:13:25 +0000"  >&lt;p&gt;I&apos;m reopening this issue, &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-231&quot; title=&quot;Ruby generated structs lack a hash method, and thus cannot be used as map keys or set members&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-231&quot;&gt;&lt;del&gt;THRIFT-231&lt;/del&gt;&lt;/a&gt; exposes the exact same problem and the solution was to make the hash method to always return 0&lt;/p&gt;

&lt;p&gt;I don&apos;t think it&apos;s the best solution, but if we&apos;re following this path, then we should make this behavior homogeneous (even if it&apos;s not completely right). I&apos;d rather to use annotations, but it may take a while until I can upload a patch that implements immutability of Thrift structures through annotations.&lt;/p&gt;</comment>
                            <comment id="12669295" author="dreiss" created="Sun, 1 Feb 2009 00:20:12 +0000"  >&lt;p&gt;I disagree.  I think that it is more important for Thrift to conform to the standard idioms of the individual languages than to be identical across languages.  I don&apos;t know what the convention is in Ruby, but Java and Python are clear.  Java defines hashCode/_&lt;em&gt;hash&lt;/em&gt;_ for mutable objects and Python doesn&apos;t.  I think we should stick to these conventions.&lt;/p&gt;</comment>
                            <comment id="12669300" author="cwalters" created="Sun, 1 Feb 2009 00:44:30 +0000"  >&lt;p&gt;I respectfully disagree with David here. The goal of interoperability across languages supercedes the goal of being idiomatic in each language, at least in my eyes.&lt;/p&gt;

&lt;p&gt;Either we choose to violate Python&apos;s conventions here (effectively choosing Java&apos;s &quot;trust-the-programmer&quot; model) or we limit sets to operating only on basic types. Any kind of middle ground means that I have to anticipate whether or not any of my clients will be in Python when I decide whether to include a set of Thrift objects in my interface.&lt;/p&gt;</comment>
                            <comment id="12669303" author="dreiss" created="Sun, 1 Feb 2009 00:48:54 +0000"  >&lt;p&gt;How about using a list of ints or an int-&amp;gt;int map as a map key?  That won&apos;t work in Python even if we do define _&lt;em&gt;hash&lt;/em&gt;_.  What should we do about that?&lt;/p&gt;</comment>
                            <comment id="12669308" author="dreiss" created="Sun, 1 Feb 2009 01:17:45 +0000"  >&lt;p&gt;There is another case too.  C++ can&apos;t use structures as map keys or set elements unless a comparator is defined.  Rather than presume an ordering by defining one automatically, we leave it to application developers to define one if they need it.  My point is that some data types simply can&apos;t be expressed naturally in a given language.  Service writers will always have to consider how their data will appear in other languages.  Rather than trying to shoehorn the cases we can, I think that it is best to accept that data types will be language-dependent and respect the expectations of programmers in each language.&lt;/p&gt;</comment>
                            <comment id="12669317" author="cwalters" created="Sun, 1 Feb 2009 02:11:48 +0000"  >&lt;p&gt;I have already proposed that we disallow non-basic types as map keys because there are several languages for which this is actually problematic (in fact, I thought that we had reached general agreement on that but perhaps I am mistaken).&lt;/p&gt;

&lt;p&gt;The C++ case you present w.r.t. comparators can be worked around, I believe, but these others cannot.&lt;/p&gt;

&lt;p&gt;I realize I haven&apos;t been able to participate as much as I would have liked over the past 6 months but I really strongly believe that we should be striving for interoperability as one of the foremost goals. Thrift has taken this approach in the past &amp;#8211; for example, the decision to support only signed integer types. At the least, I&apos;d suggest we try to have a broad discussion about this, since it seems like a key decision.&lt;/p&gt;</comment>
                            <comment id="12669394" author="esteve" created="Sun, 1 Feb 2009 15:41:26 +0000"  >&lt;p&gt;This patch uses the annotations mechanism to implement immutable structures.&lt;/p&gt;</comment>
                            <comment id="12669397" author="esteve" created="Sun, 1 Feb 2009 15:51:05 +0000"  >&lt;p&gt;Well, I&apos;ve implemented immutable structures using annotations (python.immutable). I hope I haven&apos;t introduced any bugs, but I&apos;d like someone else (David, Ben, etc.) to review my patch.&lt;/p&gt;

&lt;p&gt;Wow, the annotations stuff is really impressive and easy to use &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12670006" author="esteve" created="Tue, 3 Feb 2009 16:31:30 +0000"  >&lt;p&gt;Fixes _&lt;em&gt;repr&lt;/em&gt;_ and _&lt;em&gt;eq&lt;/em&gt;_&lt;/p&gt;</comment>
                            <comment id="12672702" author="esteve" created="Wed, 11 Feb 2009 18:00:12 +0000"  >&lt;p&gt;Any opinion on whether the python.immutable annotation is a good thing or not? I think it could be standardized (java.immutable, ruby.immutable, etc.) and have immutable types across all languages, but would like to hear the opinion of others.&lt;/p&gt;</comment>
                            <comment id="12673690" author="bmaurer" created="Sun, 15 Feb 2009 18:37:10 +0000"  >&lt;p&gt;I think we should avoid having two different code generation paths &amp;#8211; it&apos;s much more complex to test and will be prone to bugs.&lt;/p&gt;</comment>
                            <comment id="12673755" author="esteve" created="Sun, 15 Feb 2009 21:59:48 +0000"  >&lt;p&gt;But then, this contradicts the purpose of type annotations. Taken from David&apos;s commit message for &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-121&quot; title=&quot;Add support for type modifiers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-121&quot;&gt;&lt;del&gt;THRIFT-121&lt;/del&gt;&lt;/a&gt;, the usefulness of arbitrary type annotations is:&lt;/p&gt;

&lt;p&gt;&quot;Adds syntax for attaching arbitrary key/value pairs to types.&lt;br/&gt;
These annotations can be accessed by individual generators to alter&lt;br/&gt;
the code they produce.&quot;&lt;/p&gt;

&lt;p&gt;For example, I have a patch that I&apos;ll try to submit tomorrow which adds support for using tuples instead of lists for the list&amp;lt;&amp;gt; container type. And, if I understood it correctly, the encouraged way to add such feature is to use annotations, instead of hacking a new special type in the IDL parser.&lt;/p&gt;

</comment>
                            <comment id="12674352" author="dreiss" created="Tue, 17 Feb 2009 20:42:22 +0000"  >&lt;p&gt;FWIW, I think having an annotation for immutability is the best way to achieve sets of structures and maps with structures as keys.&lt;/p&gt;

&lt;p&gt;Could you explain the addition of _&lt;em&gt;slots&lt;/em&gt;&lt;em&gt;?  Is this related to the changes in repr and eq?  Can you also explain the implementation of __init&lt;/em&gt;&lt;em&gt;?  If the __slots&lt;/em&gt;_ stuff is not strictly necessary, I&apos;d prefer to see it in a separate diff so the initial code review will be easier and we can give it more attention.&lt;/p&gt;</comment>
                            <comment id="12674554" author="esteve" created="Wed, 18 Feb 2009 09:57:14 +0000"  >&lt;p&gt;I had to add a _&lt;em&gt;slots&lt;/em&gt;_ variable to prevent Python from creating a _&lt;em&gt;dict&lt;/em&gt;_ instance, otherwise one could still modify an instance using obj._&lt;em&gt;dict&lt;/em&gt;_&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;foo&amp;quot;&amp;#93;&lt;/span&gt; = 42&lt;/p&gt;

&lt;p&gt;As for the _&lt;em&gt;init&lt;/em&gt;_ implementation, although it looks a bit awkward, it&apos;s necessary as it&apos;s impossible to call self.X = Y once _&lt;em&gt;setattr&lt;/em&gt;_ is overloaded to raise an exception, so to set an attribute, I had to call _&lt;em&gt;setattr&lt;/em&gt;_ using the parent class.&lt;/p&gt;</comment>
                            <comment id="12688867" author="dreiss" created="Tue, 24 Mar 2009 21:06:55 +0000"  >&lt;p&gt;I&apos;m working on this now.  Can you explain this comment?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (m_iter = members.begin(); m_iter != members.end(); ++m_iter) {
      &lt;span class=&quot;code-comment&quot;&gt;// This fills in &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; values, as opposed to nulls
&lt;/span&gt;      out &amp;lt;&amp;lt; &lt;span class=&quot;code-quote&quot;&gt;&quot;self.&quot;&lt;/span&gt; &amp;lt;&amp;lt; (*m_iter)-&amp;gt;get_name() &amp;lt;&amp;lt; &lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;;
    }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12688883" author="dreiss" created="Tue, 24 Mar 2009 21:28:06 +0000"  >&lt;p&gt;Okay.  Here is my version without the slots stuff.  Slots don&apos;t prevent you from doing&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    object.__setattr__(my_immut, &lt;span class=&quot;code-quote&quot;&gt;&apos;field&apos;&lt;/span&gt;, value)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;so a really crafty hacker can still break his own program.  Therefore, there is not much need to block _&lt;em&gt;dict&lt;/em&gt;_.&lt;/p&gt;

&lt;p&gt;Obviously the patch is much simpler.  We can still consider using slots, but I think it should be a separate discussion, and it is lower priority.&lt;/p&gt;

&lt;p&gt;We still have to implement immutable lists, sets, and (gasp) maps, both in the readers and render_const_value before this will actually work, though.&lt;/p&gt;</comment>
                            <comment id="12688907" author="dreiss" created="Tue, 24 Mar 2009 22:22:07 +0000"  >&lt;p&gt;This version makes the syntax test pass.  Yay!  Of course, reading still doesn&apos;t work. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
A semi-coherent breakdown of the changes is here: &lt;a href=&quot;http://gitweb.thrift-rpc.org/?p=thrift.git;a=log;h=refs/heads/pri/dreiss/py-immut;hb=HEAD&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://gitweb.thrift-rpc.org/?p=thrift.git;a=log;h=refs/heads/pri/dreiss/py-immut;hb=HEAD&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12688923" author="esteve" created="Tue, 24 Mar 2009 22:52:11 +0000"  >&lt;p&gt;I still prefer adding slots, but I guess that could be discussed at thrift-dev. However, I&apos;m not sure I like your implementation of const maps, I&apos;d rather backport named tuples from Python 2.6, here&apos;s the recipe:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://code.activestate.com/recipes/500261/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://code.activestate.com/recipes/500261/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It should be fairly easy to check whether we should use collections.namedtuple (2.6) or our backported version. Something like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; sys
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; sys.hexversion &amp;gt;= 0x20600f0:
    from collections &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; namedtuple
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;:
    from thrift.compat &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; namedtuple
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;BTW, I&apos;m sorry, but I won&apos;t be able to devote too much time to this issue (and to Thrift in general) during the next days &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Feel free to take over it David.&lt;/p&gt;</comment>
                            <comment id="12689030" author="nicolast" created="Wed, 25 Mar 2009 08:33:26 +0000"  >&lt;p&gt;As I see it in &lt;a href=&quot;http://gitweb.thrift-rpc.org/?p=thrift.git;a=commitdiff;h=bccfbe9a6ea9a1fee27f3b201befcbf034090c97&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://gitweb.thrift-rpc.org/?p=thrift.git;a=commitdiff;h=bccfbe9a6ea9a1fee27f3b201befcbf034090c97&lt;/a&gt;, 2 TFreezableDicts containing the same items can have another hash value depending on insertion order since the hash is calculated based on the return value of dict.items(), which is not ordered.&lt;/p&gt;

&lt;p&gt;Shouldn&apos;t we sort this somehow before calculating the result hash?&lt;/p&gt;</comment>
                            <comment id="12689246" author="dreiss" created="Wed, 25 Mar 2009 21:28:49 +0000"  >&lt;p&gt;@Esteve: I don&apos;t like named tuples for this case because they require different code to use compared to normal dicts and they are very awkward if keys are non-identifiers (or non-strings!).&lt;/p&gt;

&lt;p&gt;@Nicholas: Good catch.  Thrift structures are not sortable in Python, but I can sort the items by hash.  New patch coming soon.&lt;/p&gt;</comment>
                            <comment id="12689403" author="nicolast" created="Thu, 26 Mar 2009 08:54:32 +0000"  >&lt;p&gt;immut-v3.diff seems to contain some unrelated hunks (reverts even, I think) in fastbinary.c, the Ruby lib and some testcases.&lt;/p&gt;</comment>
                            <comment id="12689617" author="dreiss" created="Thu, 26 Mar 2009 19:41:25 +0000"  >&lt;p&gt;Sorry, diffed against the wrong branch.&lt;/p&gt;</comment>
                            <comment id="12694873" author="dreiss" created="Thu, 2 Apr 2009 02:34:05 +0000"  >&lt;p&gt;This additional patch provides support for reading immutable containers with normal (not fastbinary) protocols.  I think we&apos;re going to have to extend thrift_spec again to make fastbinary work.&lt;/p&gt;</comment>
                            <comment id="12897844" author="bryanduxbury" created="Thu, 12 Aug 2010 17:13:19 +0000"  >&lt;p&gt;I&apos;m untagging this for 0.4 because I don&apos;t expect it to get done today, but I&apos;d really love it if someone who understands the final state of this issue were to figure it out and either commit it or let me know so I can commit it.&lt;/p&gt;</comment>
                            <comment id="13761878" author="ashutoshc" created="Mon, 9 Sep 2013 14:26:39 +0000"  >&lt;p&gt;We got hit by this too. We tried to workaround this issue &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4322&quot; title=&quot;SkewedInfo in Metastore Thrift API cannot be deserialized in Python&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4322&quot;&gt;&lt;del&gt;HIVE-4322&lt;/del&gt;&lt;/a&gt; Than failed &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4432&quot; title=&quot;Follow-up to HIVE-4322 - make metastore API changes backwards compatible&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4432&quot;&gt;&lt;del&gt;HIVE-4432&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4433&quot; title=&quot;Fix C++ Thrift bindings broken in HIVE-4322&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4433&quot;&gt;&lt;del&gt;HIVE-4433&lt;/del&gt;&lt;/a&gt; Subsequently we had to roll-back this at 11th hour &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4492&quot; title=&quot;Revert HIVE-4322&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4492&quot;&gt;&lt;del&gt;HIVE-4492&lt;/del&gt;&lt;/a&gt; to unblock a release. Suffice to say it hit us badly. Would love to see this fixed in core thrift.&lt;/p&gt;</comment>
                            <comment id="14520583" author="henrique" created="Thu, 30 Apr 2015 00:22:18 +0000"  >&lt;p&gt;This needs rebase and unit testing for the mentioned case.&lt;br/&gt;
Please reopen if you have something new&lt;/p&gt;</comment>
                            <comment id="15022145" author="githubbot" created="Mon, 23 Nov 2015 14:20:24 +0000"  >&lt;p&gt;GitHub user nsuke opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/714&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/714&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-162&quot; title=&quot;Thrift structures are unhashable, preventing them from being used as set elements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-162&quot;&gt;&lt;del&gt;THRIFT-162&lt;/del&gt;&lt;/a&gt; Thrift structures are unhashable, preventing them from bei&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;ng used as set elements&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/nsuke/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/nsuke/thrift&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-162&quot; title=&quot;Thrift structures are unhashable, preventing them from being used as set elements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-162&quot;&gt;&lt;del&gt;THRIFT-162&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/714.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/714.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #714&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 8d6c200c9b44b3d4bf284cfe0238df7ede94f270&lt;br/&gt;
Author: Nobuaki Sukegawa &amp;lt;nsuke@apache.org&amp;gt;&lt;br/&gt;
Date:   2015-11-17T02:01:17Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-162&quot; title=&quot;Thrift structures are unhashable, preventing them from being used as set elements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-162&quot;&gt;&lt;del&gt;THRIFT-162&lt;/del&gt;&lt;/a&gt; Thrift structures are unhashable, preventing them from being used as set elements&lt;br/&gt;
    Client: Python&lt;br/&gt;
    Patch: David Reiss, Nobuaki Sukegawa&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15030302" author="roger.meier" created="Fri, 27 Nov 2015 23:09:03 +0000"  >&lt;p&gt;Thanks Aki!&lt;/p&gt;</comment>
                            <comment id="15030303" author="githubbot" created="Fri, 27 Nov 2015 23:09:13 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/714&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/714&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15030316" author="hudson" created="Fri, 27 Nov 2015 23:48:22 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #1743 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/1743/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/1743/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-162&quot; title=&quot;Thrift structures are unhashable, preventing them from being used as set elements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-162&quot;&gt;&lt;del&gt;THRIFT-162&lt;/del&gt;&lt;/a&gt; Thrift structures are unhashable, preventing them from being (roger: rev e841b3dac619a5e5d3523d059d48db1a12e41360)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;compiler/cpp/src/generate/t_py_generator.cc&lt;/li&gt;
	&lt;li&gt;test/py/RunClientServer.py&lt;/li&gt;
	&lt;li&gt;lib/py/src/protocol/TBase.py&lt;/li&gt;
	&lt;li&gt;test/py/TestFrozen.py&lt;/li&gt;
	&lt;li&gt;lib/py/src/protocol/fastbinary.c&lt;/li&gt;
	&lt;li&gt;test/ThriftTest.thrift&lt;/li&gt;
	&lt;li&gt;test/DebugProtoTest.thrift&lt;/li&gt;
	&lt;li&gt;lib/py/src/protocol/TProtocol.py&lt;/li&gt;
	&lt;li&gt;lib/py/src/Thrift.py&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16049312" author="cjbarth" created="Wed, 14 Jun 2017 15:48:57 +0000"  >&lt;p&gt;A related issue is #4002 (&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4002&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/THRIFT-4002&lt;/a&gt;) pertaining to exceptions. The logging facility in Python 3 requires that Exceptions be hashable. Can this solution be applied to that problem too?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12905378">THRIFT-3388</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12413725">THRIFT-301</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12403561" name="immut-no-slots-v1.diff" size="2388" author="dreiss" created="Tue, 24 Mar 2009 21:28:05 +0000"/>
                            <attachment id="12403568" name="immut-v2.diff" size="6745" author="dreiss" created="Tue, 24 Mar 2009 22:22:07 +0000"/>
                            <attachment id="12403643" name="immut-v3.diff" size="9501" author="dreiss" created="Wed, 25 Mar 2009 21:50:45 +0000"/>
                            <attachment id="12403730" name="immut-v4.diff" size="6983" author="dreiss" created="Thu, 26 Mar 2009 19:41:25 +0000"/>
                            <attachment id="12404410" name="reading-containers.diff" size="2597" author="dreiss" created="Thu, 2 Apr 2009 02:34:05 +0000"/>
                            <attachment id="12399243" name="thrift-162_annotiations.patch" size="2248" author="esteve" created="Sun, 1 Feb 2009 15:41:26 +0000"/>
                            <attachment id="12399365" name="thrift-162_v2_annotiations.patch" size="5298" author="esteve" created="Tue, 3 Feb 2009 16:31:30 +0000"/>
                            <attachment id="12391751" name="thrift_py_hash.patch" size="3613" author="esteve" created="Wed, 8 Oct 2008 16:36:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>186400</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 22 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14j9z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>234586</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>