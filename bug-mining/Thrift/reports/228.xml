<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:57:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-643] Smalltalk generated code don&apos;t load on Squeak3.10.2-7179-basic and PharoCore-1.0-10491rc1 images</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-643</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;I have found a bug in the generated code for the Smalltalk thrift interface.&lt;/p&gt;

&lt;p&gt;I used thrift svn revision:&lt;/p&gt;

&lt;p&gt;miguel@laptop:~/thrift-svn$ svn info&lt;br/&gt;
Ruta: .&lt;br/&gt;
URL: &lt;a href=&quot;http://svn.apache.org/repos/asf/incubator/thrift/trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/repos/asf/incubator/thrift/trunk&lt;/a&gt;&lt;br/&gt;
Ra&#237;z del repositorio: &lt;a href=&quot;http://svn.apache.org/repos/asf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/repos/asf&lt;/a&gt;&lt;br/&gt;
UUID del repositorio: 13f79535-47bb-0310-9956-ffa450edef68&lt;br/&gt;
Revisi&#243;n: 888521&lt;br/&gt;
Tipo de nodo: directorio&lt;br/&gt;
Agendado: normal&lt;br/&gt;
Autor del &#250;ltimo cambio: todd&lt;br/&gt;
Revisi&#243;n del &#250;ltimo cambio: 887812&lt;br/&gt;
Fecha de &#250;ltimo cambio: 2009-12-06 18:42:38 -0600 (dom 06 de dic de&lt;br/&gt;
2009)&lt;/p&gt;

&lt;p&gt;I did:&lt;/p&gt;

&lt;p&gt;bootstrap.sh&lt;br/&gt;
configure&lt;br/&gt;
make&lt;/p&gt;

&lt;p&gt;and then I tried to load the thrift smalltalk code from&lt;/p&gt;

&lt;p&gt;lib/st/thrift.st &lt;/p&gt;

&lt;p&gt;in a squeak Squeak3.10.2-7179-basic.zip, pristine image from squeak.org.&lt;br/&gt;
That halted with an error about a duplicated readString method&lt;br/&gt;
declaration. The error is fixed in the attached patch.&lt;/p&gt;

&lt;p&gt;Next I compiled the code for the cassandra thrift:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://svn.apache.org/repos/asf/incubator/cassandra/trunk/interface/cassandra.thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/incubator/cassandra/trunk/interface/cassandra.thrift&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;with the command:&lt;/p&gt;

&lt;p&gt;./compiler/cpp/thrift --gen st cassandra.thrift &lt;/p&gt;

&lt;p&gt;and tried to file in the generated code &lt;/p&gt;

&lt;p&gt;gen-st/cassandra.st&lt;/p&gt;

&lt;p&gt;in said image.&lt;/p&gt;

&lt;p&gt;Again the load halted. This time because of the underscores in the&lt;br/&gt;
generated code for the cassandra thrift definition. Squeak (and derived&lt;br/&gt;
smalltalks as Pharo) doesn&apos;t allow underscores in variable names (the&lt;br/&gt;
underscore is a legacy character used for variable assigment). Anyway I&lt;br/&gt;
have modified the code for smalltalk generator:&lt;/p&gt;

&lt;p&gt;compiler/cpp/src/generate/t_st_generator.cc &lt;/p&gt;

&lt;p&gt;so that when a variable name in the thrift definition has a &quot;_&quot;&lt;br/&gt;
character, this is removed and the next character is converted to&lt;br/&gt;
uppercase. e.g. a variable like column_name will be generated in&lt;br/&gt;
smalltalk code as columnName. This way the code loads (and works&lt;br/&gt;
correctly) on Squeak.&lt;/p&gt;

&lt;p&gt;The generated code has been tested in the following smalltalk images&lt;/p&gt;

&lt;p&gt;Squeak3.10.2-7179-basic.image&lt;br/&gt;
PharoCore-1.0-10491rc1.image&lt;/p&gt;

&lt;p&gt;and in both of them the new generated code for cassandra works&lt;br/&gt;
correctly.&lt;/p&gt;

&lt;p&gt;I haven&apos;t tested the code generation with a thrift spec other than&lt;br/&gt;
cassandra, so maybe this will introduce some bugs. For my case it worked&lt;br/&gt;
great.&lt;br/&gt;
If anyone is using cassandra and want to test it, I installed the&lt;br/&gt;
default cassandra server on localhost port 9160 and tested from Squeak&lt;br/&gt;
and from Pharo by loading&lt;/p&gt;

&lt;p&gt;lib/st/thrift.st&lt;br/&gt;
gen-st/cassandra.st&lt;/p&gt;

&lt;p&gt;Then in a Squeak or Pharo workspace:&lt;/p&gt;

&lt;p&gt;&quot;Insert 10000 values&quot;&lt;br/&gt;
[| cp result client |&lt;/p&gt;

&lt;p&gt;client := CassandraClient binaryOnHost: &apos;localhost&apos; port: 9160.&lt;/p&gt;

&lt;p&gt;cp := ColumnPath new&lt;br/&gt;
  columnFamily: &apos;Standard1&apos;;&lt;br/&gt;
  column: &apos;col1&apos;.&lt;/p&gt;

&lt;p&gt;1 to: 10000 do: [ :i |&lt;br/&gt;
result := client insertKeyspace: &apos;Keyspace1&apos;&lt;br/&gt;
  key: &apos;row&apos;, i asString&lt;br/&gt;
  columnPath: cp&lt;br/&gt;
  value: &apos;v&apos;, i asString&lt;br/&gt;
  timestamp: 1&lt;br/&gt;
  consistencyLevel: ((Cassandra enums at: &apos;ConsistencyLevel&apos;) at:&lt;br/&gt;
&apos;QUORUM&apos;).]] timeToRun&lt;/p&gt;

&lt;p&gt;And read the values just inserted:&lt;/p&gt;

&lt;p&gt;&quot;Read 10000 values&quot;&lt;br/&gt;
[| cp result client |&lt;/p&gt;

&lt;p&gt;client := CassandraClient binaryOnHost: &apos;localhost&apos; port: 9160.&lt;br/&gt;
cp := ColumnPath new&lt;br/&gt;
  columnFamily: &apos;Standard1&apos;;&lt;br/&gt;
  column: &apos;col1&apos;.&lt;/p&gt;

&lt;p&gt;1 to: 10000 do: [ :i |&lt;br/&gt;
result := client getKeyspace: &apos;Keyspace1&apos;&lt;br/&gt;
  key: &apos;row&apos;, i asString&lt;br/&gt;
  columnPath: cp&lt;br/&gt;
  consistencyLevel: ((Cassandra enums at: &apos;ConsistencyLevel&apos;) at:&lt;br/&gt;
&apos;QUORUM&apos;).]] timeToRun&lt;/p&gt;


&lt;p&gt;Regarding the patch, I am not a C++ expert and the drop_underscores()&lt;br/&gt;
function surely can be improved by someone with more experience with C++&lt;br/&gt;
idioms. Essentially what it does is to convert:&lt;/p&gt;

&lt;p&gt;from -&amp;gt; to&lt;br/&gt;
-----   -----&lt;br/&gt;
a_variable -&amp;gt; aVariable&lt;br/&gt;
a_new_var -&amp;gt; aNewVar&lt;br/&gt;
column_path -&amp;gt; columnPath&lt;br/&gt;
variable -&amp;gt; variable&lt;/p&gt;

&lt;p&gt;Give it a try and if deemed good enough please add it to the thrift&lt;br/&gt;
code.&lt;br/&gt;
Those changes are published under the apache public license, the same as&lt;br/&gt;
the thrift codebase.&lt;/p&gt;

&lt;p&gt;The patch is generated with&lt;/p&gt;

&lt;p&gt;svn diff -x -u &amp;gt; patch.888520&lt;/p&gt;

&lt;p&gt;against revision 888520 of the thrift svn code.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Debian GNU/Linux Squeeze&lt;br/&gt;
Smalltalk versions:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Squeak3.10.2-7179-basic&lt;/li&gt;
	&lt;li&gt;PharoCore-1.0-10491rc1&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;thrift svn revision: 887812&lt;/p&gt;</environment>
        <key id="12442777">THRIFT-643</key>
            <summary>Smalltalk generated code don&apos;t load on Squeak3.10.2-7179-basic and PharoCore-1.0-10491rc1 images</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="miguel.coba">Miguel Enrique Cob&#225; Mart&#237;nez</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Dec 2009 22:19:16 +0000</created>
                <updated>Tue, 1 Nov 2011 02:51:57 +0000</updated>
                            <resolved>Tue, 19 Jan 2010 05:19:08 +0000</resolved>
                                    <version>0.2</version>
                                    <fixVersion>0.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12787781" author="miguel.coba" created="Tue, 8 Dec 2009 22:24:33 +0000"  >&lt;p&gt;This patch solves the loading issues with the smalltalk generated code.&lt;/p&gt;</comment>
                            <comment id="12788371" author="tlipcon" created="Wed, 9 Dec 2009 23:01:33 +0000"  >&lt;p&gt;Hi Miguel,&lt;/p&gt;

&lt;p&gt;I think the underscore helper you&apos;ve added should go in t_generator.h next to the underscore function, since it&apos;s essentially the inverse.&lt;/p&gt;

&lt;p&gt;Other than that, patch seems good.&lt;/p&gt;</comment>
                            <comment id="12788535" author="miguel.coba" created="Thu, 10 Dec 2009 06:22:46 +0000"  >&lt;p&gt;This new patch implements the comments made by Todd.&lt;br/&gt;
The helper is now in t_generator.h and is named camelcase as that is what it does.&lt;br/&gt;
I found that in t_st_generator.cc there was a sanitize helper that did exactly the same that my function. The problem was that wasn&apos;t used everywhere where an underscore could cause problems in Squeak or Pharo. So I refactored the code, moved sanitize to the t_generator.h and changed its name to camelcase. Then changed every reference to sanitize and to my old drop_underscores by calls to camelcase. Other than that, the patch is very similar to the old one.&lt;br/&gt;
Use this instead of the old one.&lt;/p&gt;

&lt;p&gt;Tested on svn revision: 889098 and on the thrift-0.2.0-incubating-rc0.tar.gz code. In both cases the compilation went ok.&lt;/p&gt;</comment>
                            <comment id="12801986" author="miguel.coba" created="Mon, 18 Jan 2010 23:15:17 +0000"  >&lt;p&gt;It is more than a month that I sent this patch to the jira. Will someday be merged to the trunk?&lt;/p&gt;

&lt;p&gt;Cheers&lt;/p&gt;</comment>
                            <comment id="12802104" author="miguel.coba" created="Tue, 19 Jan 2010 05:46:03 +0000"  >&lt;p&gt;Thank you very much &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12427388" name="patch.888520" size="4476" author="miguel.coba" created="Tue, 8 Dec 2009 22:24:33 +0000"/>
                            <attachment id="12427576" name="patch.888931" size="6495" author="miguel.coba" created="Thu, 10 Dec 2009 06:22:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37821</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 45 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16bpr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245030</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>