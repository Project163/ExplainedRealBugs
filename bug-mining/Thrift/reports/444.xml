<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:00:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-1183] Pure-ruby CompactProtocol raises ArgumentError when deserializing under Ruby 1.9</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-1183</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;While testing my fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1182&quot; title=&quot;Native deserializer segfaults on incorrect list element type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1182&quot;&gt;&lt;del&gt;THRIFT-1182&lt;/del&gt;&lt;/a&gt; with various combinations of native/non-native ruby and binary/compact protocols, I stumbled upon a bug in the pure-ruby implementation of CompactProtocol.&lt;/p&gt;

&lt;p&gt;In lib/thrift/protocol/compact_protocol.rb line 306:&lt;br/&gt;
      ...&lt;br/&gt;
      val = dat&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;&lt;br/&gt;
      if (val &amp;gt; 0x7f)&lt;br/&gt;
      ...&lt;br/&gt;
Here, dat is a string, so dat&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; returns a Fixnum in Ruby 1.8.7 but a string of size 1 in Ruby 1.9.2. The conditional compares dat&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; with 0x7f, which raises the following error in 1.9.2:&lt;/p&gt;

&lt;p&gt;/Users/ilyam/.rvm/gems/ruby-1.9.2-p180/gems/thrift-0.6.0/lib/thrift/protocol/compact_protocol.rb:307:in `&amp;gt;&apos;: comparison of String with 127 failed (ArgumentError)&lt;br/&gt;
	from /Users/ilyam/.rvm/gems/ruby-1.9.2-p180/gems/thrift-0.6.0/lib/thrift/protocol/compact_protocol.rb:307:in `read_byte&apos;&lt;br/&gt;
	from /Users/ilyam/.rvm/gems/ruby-1.9.2-p180/gems/thrift-0.6.0/lib/thrift/protocol/compact_protocol.rb:243:in `read_field_begin&apos;&lt;br/&gt;
	from /Users/ilyam/.rvm/gems/ruby-1.9.2-p180/gems/thrift-0.6.0/lib/thrift/struct.rb:86:in `block in read&apos;&lt;br/&gt;
	from /Users/ilyam/.rvm/gems/ruby-1.9.2-p180/gems/thrift-0.6.0/lib/thrift/struct.rb:85:in `loop&apos;&lt;br/&gt;
	from /Users/ilyam/.rvm/gems/ruby-1.9.2-p180/gems/thrift-0.6.0/lib/thrift/struct.rb:85:in `read&apos;&lt;br/&gt;
	from /Users/ilyam/.rvm/gems/ruby-1.9.2-p180/gems/thrift-0.6.0/lib/thrift/serializer/deserializer.rb:29:in `deserialize&apos;&lt;/p&gt;

&lt;p&gt;The solution is a one-line fix, patch will be attached shortly.&lt;/p&gt;</description>
                <environment>&lt;p&gt;OS X 10.6 i686 / Ruby 1.9.2&lt;/p&gt;</environment>
        <key id="12508645">THRIFT-1183</key>
            <summary>Pure-ruby CompactProtocol raises ArgumentError when deserializing under Ruby 1.9</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ilyam">Ilya Maykov</assignee>
                                    <reporter username="ilyam">Ilya Maykov</reporter>
                        <labels>
                    </labels>
                <created>Sun, 29 May 2011 07:44:57 +0000</created>
                <updated>Wed, 1 Jun 2011 17:49:46 +0000</updated>
                            <resolved>Wed, 1 Jun 2011 17:24:04 +0000</resolved>
                                    <version>0.6.1</version>
                                    <fixVersion>0.7</fixVersion>
                                    <component>Ruby - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13040757" author="ilyam" created="Sun, 29 May 2011 07:47:33 +0000"  >&lt;p&gt;Patch attached.&lt;/p&gt;</comment>
                            <comment id="13040760" author="ilyam" created="Sun, 29 May 2011 08:00:07 +0000"  >&lt;p&gt;Sorry the patch is against a copy of the source that i&apos;ve mirrored on our own git repo, so the file paths may look funky.&lt;/p&gt;</comment>
                            <comment id="13041494" author="ilyam" created="Tue, 31 May 2011 09:16:01 +0000"  >&lt;p&gt;This breaks CompactProtocol completely in JRuby when run with the --1.9 flag.&lt;/p&gt;</comment>
                            <comment id="13041794" author="bryanduxbury" created="Tue, 31 May 2011 20:06:00 +0000"  >&lt;p&gt;There&apos;s a problem with your one-liner: it doesn&apos;t work in ruby 1.8.6!&lt;/p&gt;</comment>
                            <comment id="13041800" author="michaelstockton" created="Tue, 31 May 2011 20:20:26 +0000"  >&lt;p&gt;It should work. We added the #ord method in thrift/core_ext/fixnum.rb for pre 1.8.7 clients.&lt;/p&gt;</comment>
                            <comment id="13041853" author="ilyam" created="Tue, 31 May 2011 21:49:10 +0000"  >&lt;p&gt;I haven&apos;t tested it in 1.8.6 but it should work with the thrift/core_ext/fixnum.rb patch. I can test it with 1.8.6 if you like.&lt;/p&gt;</comment>
                            <comment id="13041854" author="ilyam" created="Tue, 31 May 2011 21:51:17 +0000"  >&lt;p&gt;P.S. The pure-ruby BinaryProtocol already has this #ord behavior in 0.6.1 (probably much earlier), but the CompactProtocol does not.&lt;/p&gt;</comment>
                            <comment id="13042304" author="bryanduxbury" created="Wed, 1 Jun 2011 17:24:04 +0000"  >&lt;p&gt;Ah, you&apos;re totally right. I just tested #ord in a ruby 1.8.6 irb without thinking about our extensions. I just committed this patch.&lt;/p&gt;</comment>
                            <comment id="13042319" author="hudson" created="Wed, 1 Jun 2011 17:49:46 +0000"  >&lt;p&gt;Integrated in Thrift #151 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/Thrift/151/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/hudson/job/Thrift/151/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1183&quot; title=&quot;Pure-ruby CompactProtocol raises ArgumentError when deserializing under Ruby 1.9&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1183&quot;&gt;&lt;del&gt;THRIFT-1183&lt;/del&gt;&lt;/a&gt;. rb: Pure-ruby CompactProtocol raises ArgumentError when deserializing under Ruby 1.9&lt;/p&gt;

&lt;p&gt;Use #ord to ensure we get back an int&lt;/p&gt;

&lt;p&gt;Patch: Ilya Maykov&lt;/p&gt;

&lt;p&gt;bryanduxbury : &lt;a href=&quot;http://svn.apache.org/viewvc/?view=rev&amp;amp;rev=1130236&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/?view=rev&amp;amp;rev=1130236&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/thrift/trunk/lib/rb/lib/thrift/protocol/compact_protocol.rb&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12480769" name="patch-THRIFT-1183.txt" size="543" author="ilyam" created="Sun, 29 May 2011 07:47:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72311</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 25 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16cv3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245216</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>