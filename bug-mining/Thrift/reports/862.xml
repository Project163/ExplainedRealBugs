<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:10:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-2232] IsSet* broken in Go</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-2232</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;The various generated IsSetXYZ() methods just check for magic values of their respective fields. This is obviously broken, and also diverges from the implementation in other languages.&lt;/p&gt;

&lt;p&gt;I am willing and able to fix this myself, but I don&apos;t want to start on any impl until we can decide on an approach.&lt;/p&gt;

&lt;p&gt;At this point, though, optional fields in Go are basically useless if one&apos;s application makes use of the magic &quot;absence&quot; value.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12674892">THRIFT-2232</key>
            <summary>IsSet* broken in Go</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jensg">Jens Geyer</assignee>
                                    <reporter username="bensigelman">Ben Sigelman</reporter>
                        <labels>
                            <label>isset</label>
                    </labels>
                <created>Mon, 21 Oct 2013 20:52:10 +0000</created>
                <updated>Mon, 7 Apr 2014 16:29:32 +0000</updated>
                            <resolved>Sat, 21 Dec 2013 19:16:02 +0000</resolved>
                                                    <fixVersion>0.9.2</fixVersion>
                                    <component>Go - Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                                                            <comments>
                            <comment id="13801558" author="jensg" created="Tue, 22 Oct 2013 07:17:37 +0000"  >&lt;p&gt;Let&apos;s talk about it. What are your proposals?&lt;/p&gt;</comment>
                            <comment id="13801855" author="bensigelman" created="Tue, 22 Oct 2013 14:27:21 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jensg&quot; class=&quot;user-hover&quot; rel=&quot;jensg&quot;&gt;jensg&lt;/a&gt;, thanks for the quick response!&lt;/p&gt;

&lt;p&gt;There are, of course, a variety of options. Here are some things I&apos;d like to maintain:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;allow users to continue to treat thrift structs as simple Go structs, at least to a first approximation&lt;/li&gt;
	&lt;li&gt;do not force users to manually maintain a bit vector of IsSet information&lt;/li&gt;
	&lt;li&gt;backwards compatibility would be awesome&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The sad thing is that I can&apos;t imagine a solution that accomplishes all of the above. Since these are still relatively early days (and since the current library is broken per this bug report), I am inclined to give up the backwards compatibility goal.&lt;/p&gt;

&lt;p&gt;One option (which I do not favor) would be to generate Go interfaces rather than Go structs. These interfaces would be the only way to get/set fields, and could internally do any number of things to satisfy the various method guarantees. The actual implementation of the thrift-generated interface could take many forms, but it definitely wouldn&apos;t be exported from the generated package. I don&apos;t like this idea, though, as it seems a little heavy-weight and replaces simple struct accessors with method calls. It would be great to allow users to treat generated thrift structs as Go structs somehow.&lt;/p&gt;

&lt;p&gt;My proposal is to do something akin to what protobufs does to solve this problem. (It&apos;s also similar to what other popular packages do for things like this... e.g., the way that the `gorp` ORM package deals with nullable database columns) In particular, we would represent an optional field as a pointer, and use the `nil` value to represent absence. Required fields could either (a) also be represented as pointers and make their containing structs invalid when absent, or (b) be represented as non-pointer fields like the current thrift Go impl does for all fields. list&amp;lt;&amp;gt;s etc would hopefully be unaffected by this proposal... they can still be empty, and that&apos;s all we need as far as presence/absence info (correct me if I&apos;m mistaken!).&lt;/p&gt;

&lt;p&gt;Also, note that it&apos;s annoying &lt;span class=&quot;error&quot;&gt;&amp;#91;though still totally feasible&amp;#93;&lt;/span&gt; to pass pointers to POD and string literals in Go. Protobufs deals with this by providing helpers. We would probably do the same... See these guys:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://godoc.org/code.google.com/p/goprotobuf/proto#String&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://godoc.org/code.google.com/p/goprotobuf/proto#String&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://godoc.org/code.google.com/p/goprotobuf/proto#Uint32&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://godoc.org/code.google.com/p/goprotobuf/proto#Uint32&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The above begs the question of whether there can/should be a central lib of Go thrift helpers that people can add to their projects (rather than simply embedding all of these, redundantly, in every generated thrift Go package).&lt;/p&gt;

&lt;p&gt;So, let me know what you think. FYI, I know a lot about protobufs (was at google for 9 years), but less about Thrift per se. I&apos;d love to know if there are thorny things I should be aware of in advance.&lt;/p&gt;

&lt;p&gt;Also, if there&apos;s someone else who&apos;s willing to do this work, I have a million other things to do and would gladly wait for them if the turnaround would be less than a month or so. Thanks for your help!&lt;/p&gt;</comment>
                            <comment id="13803320" author="jensg" created="Wed, 23 Oct 2013 20:59:23 +0000"  >&lt;p&gt;Hi Ben,&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The various generated IsSetXYZ() methods just check for magic values of their respective fields. &lt;br/&gt;
This is obviously broken, and also diverges from the implementation in other languages.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I just ran the test with&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;struct Test {
  1: optional string one
  2: required string two
  3:          string three
  4: optional i32 four
  5: required i32 five
  6:          i32 six
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;which gave me this&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;func (p *Test) IsSetOne() bool {
	&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; p.One != &quot;&quot;
}

func (p *Test) IsSetFour() bool {
	&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; p.Four != 0
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Whether or not this is sufficient may be questionable (especially IsSetFour() seems a bit heuristic), but I can&apos;t find any reference to &quot;reflect&quot; in the Go generator or in IsSetXxx() at all. What am I doing wrong?&lt;/p&gt;

&lt;p&gt;EDIT: After reading it again, you probably mean exactly that: the comparison against empty strings and 0 integers. The &quot;magic&quot; did send me on the wrong path, sorry.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Here are some things I&apos;d like to maintain:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;do not force users to manually maintain a bit vector of IsSet information&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;Some languages use setter methods, where the value setter also switches the isset flag to true. Maintaining a bit vector would be an implementation detail, so I agree on that.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The sad thing is that I can&apos;t imagine a solution that accomplishes all of the above. Since these are still relatively early days (...), I am inclined to give up the backwards compatibility goal.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The entire Go code has been rewritten not so far ago to keep up with the Go 1.1 release. From that viewpoint, backwards compatibility is relative, but breaking compatibility twice within only a few months sounds not like such a great plan to me. On the other hand, if the implementation participates from it, a few breaking changes that are easy to fix may be an acceptable price. It always depends on the changes, IMHO.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;interfaces&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;One point where I still think interfaces could be a solution is the (still unsolved) problem with complex map keys, &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2063&quot; title=&quot;Go compiler cannot create code for maps with complex/binary keys&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2063&quot;&gt;THRIFT-2063&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;My proposal is to do something akin to what protobufs does to solve this problem. (It&apos;s also similar to what other popular packages do for things like this... e.g., the way that the `gorp` ORM package deals with nullable database columns) In particular, we would represent an optional field as a pointer, and use the `nil` value to represent absence. Required fields could either (a) also be represented as pointers and make their containing structs invalid when absent, or (b) be represented as non-pointer fields like the current thrift Go impl does for all fields. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree on that. We use similar approaches at other places.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;list&amp;lt;&amp;gt;s etc would hopefully be unaffected by this proposal... they can still be empty, and that&apos;s all we need as far as presence/absence info (correct me if I&apos;m mistaken!).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Is an empty list really the same as a non-existent list? In my opinion containers should be treaten the same way as structs, at least regarding that point.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The above begs the question of whether there can/should be a central lib of Go thrift helpers that people can add to their projects (rather than simply embedding all of these, redundantly, in every generated thrift Go package).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If you mean that the central helpers library would be something outside of the Thrift source tree, I don&apos;t agree. We strive to minimize external dependencies as much as it makes sense in order to reduce problems on the different platforms supported by Thrift, so this would be clearly counter-productive. If we need these helpers, they should be integrated into the Go Thrift runtime package (aka. library).&lt;/p&gt;
</comment>
                            <comment id="13803549" author="bensigelman" created="Wed, 23 Oct 2013 23:38:51 +0000"  >&lt;p&gt;Hi Jens,&lt;br/&gt;
Thanks for getting back to me.&lt;/p&gt;

&lt;p&gt;I don&apos;t use Jira often and I thus don&apos;t know how to do nice inline replies like you have &#8211; apologies in advance!&lt;/p&gt;

&lt;p&gt;How to handle empty lists&amp;lt;&amp;gt;: in protobufs, declaring something as a list (&quot;repeated&quot; in their parlance) is exclusive with declaring it as optional. This is because an empty list serializes as &quot;&quot; and is thus indistinguishable on the wire from an absent list.&lt;/p&gt;

&lt;p&gt;In thrift, of course, lists can be declared as optional, so I can see why you&apos;d want to be able to represent them as such. How does the thrift wire format distinguish between a present list that has no elements and an absent list, though?&lt;/p&gt;

&lt;p&gt;Back to the matter at hand: either the interface approach or the pointer-to-field approach will break backwards compatibility. I think the latter would be closer to the existing impl and also closer to the spirit of Go programming in general, so I favor it. What do you think/prefer? I really do feel strongly that the current impl is unacceptable, though, as I need to distinguish between 0-valued i64 fields and absent i64 fields.&lt;/p&gt;

&lt;p&gt;Thanks again!&lt;/p&gt;</comment>
                            <comment id="13804653" author="jensg" created="Thu, 24 Oct 2013 20:48:38 +0000"  >&lt;blockquote&gt;
&lt;p&gt;This is because an empty list serializes as &quot;&quot; and is thus indistinguishable on the wire from an absent list. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thrift can, and so Go should.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;How does the thrift wire format distinguish between a present list that has no elements and an absent list, though?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The basic sequence is as follows:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;WriteStructBegin
  WriteFieldBegin
    WriteListBegin
      foreach elm in list &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; WriteElement
    WriteListEnd
  WriteFieldEnd
  &lt;span class=&quot;code-comment&quot;&gt;// more fields ...
&lt;/span&gt;WriteFieldStop
WriteStructEnd
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I agree on the pointer/fields approach. &lt;br/&gt;
If any other Go-er around has an opinion on this, please speak/post.&lt;/p&gt;</comment>
                            <comment id="13804664" author="bensigelman" created="Thu, 24 Oct 2013 20:57:23 +0000"  >&lt;p&gt;Thanks for the remedial help re: thrift serialization!&lt;/p&gt;

&lt;p&gt;I won&apos;t get to this work until the weekend at the earliest... if there are any objections, I hope people raise them before then &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Best wishes and thanks again for being so friendly and responsive about this.&lt;/p&gt;</comment>
                            <comment id="13809720" author="bensigelman" created="Wed, 30 Oct 2013 22:43:13 +0000"  >&lt;p&gt;Hi Jens,&lt;br/&gt;
I sent you a pull request via github... let me know what you think,&lt;br/&gt;
Ben&lt;/p&gt;</comment>
                            <comment id="13848083" author="bensigelman" created="Sat, 14 Dec 2013 00:02:33 +0000"  >&lt;p&gt;Per &lt;a href=&quot;http://thrift.apache.org/docs/HowToContribute/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://thrift.apache.org/docs/HowToContribute/&lt;/a&gt; , I am attaching a patch against the current master that addresses the issue. Let me know if there are any problems!&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Ben&lt;/p&gt;</comment>
                            <comment id="13848084" author="bensigelman" created="Sat, 14 Dec 2013 00:03:51 +0000"  >&lt;p&gt;after rebasing to the upstream master, this is the output of&lt;/p&gt;

&lt;p&gt;git diff master &amp;gt; thrift-2232-golang-optional-fields-fix.patch&lt;/p&gt;</comment>
                            <comment id="13848345" author="jensg" created="Sat, 14 Dec 2013 12:19:24 +0000"  >&lt;p&gt;+1 many thanks for the great work, Ben.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=traviscline&quot; class=&quot;user-hover&quot; rel=&quot;traviscline&quot;&gt;traviscline&lt;/a&gt;, would you mind to have a look at it too?&lt;/p&gt;</comment>
                            <comment id="13850870" author="jensg" created="Tue, 17 Dec 2013 20:41:05 +0000"  >&lt;p&gt;Committed. Thanks again, Ben.&lt;/p&gt;</comment>
                            <comment id="13850909" author="bensigelman" created="Tue, 17 Dec 2013 21:08:58 +0000"  >&lt;p&gt;Thanks very much for your help!&lt;/p&gt;</comment>
                            <comment id="13851062" author="hudson" created="Tue, 17 Dec 2013 23:02:52 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #953 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/953/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/953/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2232&quot; title=&quot;IsSet* broken in Go&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2232&quot;&gt;&lt;del&gt;THRIFT-2232&lt;/del&gt;&lt;/a&gt; IsSet* broken in Go (jensg: rev 0853ab67b4db1db15dc4b8f195764331174e5594)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;compiler/cpp/src/generate/t_go_generator.cc&lt;/li&gt;
	&lt;li&gt;README&lt;/li&gt;
	&lt;li&gt;lib/go/thrift/pointerize.go&lt;/li&gt;
	&lt;li&gt;lib/go/README&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13854903" author="jensg" created="Sat, 21 Dec 2013 18:58:53 +0000"  >&lt;p&gt;This IDL&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;struct CrazyNesting {
  2: optional set&amp;lt;Insanity&amp;gt; set_field,
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;leads to uncompileable code&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;tSet := make(map[*Insanity]bool, size)
p.SetField = tSet     &lt;span class=&quot;code-comment&quot;&gt;// wrong, missing &amp;amp;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</comment>
                            <comment id="13854905" author="jensg" created="Sat, 21 Dec 2013 19:10:24 +0000"  >&lt;p&gt;regenerated serializer_types.go testcase helper file&lt;/p&gt;</comment>
                            <comment id="13854906" author="jensg" created="Sat, 21 Dec 2013 19:16:02 +0000"  >&lt;p&gt;Both fixes committed.&lt;/p&gt;</comment>
                            <comment id="13915486" author="apesternikov" created="Fri, 28 Feb 2014 05:52:57 +0000"  >&lt;p&gt;this fix broke binary keys (&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2247&quot; title=&quot;Go generator doesn&amp;#39;t deal well with map keys of type binary&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2247&quot;&gt;&lt;del&gt;THRIFT-2247&lt;/del&gt;&lt;/a&gt;) again&lt;/p&gt;</comment>
                            <comment id="13915490" author="apesternikov" created="Fri, 28 Feb 2014 05:58:31 +0000"  >&lt;p&gt;fix is here &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2384&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/THRIFT-2384&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13961968" author="apesternikov" created="Mon, 7 Apr 2014 16:09:54 +0000"  >&lt;p&gt;I started changing my existing code to reflect this change. Some thoughts on the way:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;optional with defaults are broken (&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2451&quot; title=&quot;Do not use pointers for optional fields with defaults. Do not write such fields if its value set to default. Also, do not use pointers for any optional fields mapped to go map or slice. generate Get accessors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2451&quot;&gt;&lt;del&gt;THRIFT-2451&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;inlined fields are much easier to deal with and far more optimal in terms of producing memory garbage.&lt;/li&gt;
	&lt;li&gt;code using old &quot;optional field is unset when it has default value&quot; semantics feels like a natural fit for go.&lt;br/&gt;
this is a part of my code:&lt;br/&gt;
thrift:&lt;br/&gt;
struct log {&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;br/&gt;
  42: optional string referrer&lt;br/&gt;
  43: optional string user_agent&lt;br/&gt;
  100: optional bool is_admin = false&lt;br/&gt;
}&lt;br/&gt;
old_code(req *http.Request) {&lt;br/&gt;
  l.Referrer = req.Referrer()&lt;br/&gt;
  l.UserAgent = req.UserAgent()&lt;br/&gt;
  l.IsAdmin = calculateAdminStatus(req)&lt;br/&gt;
}&lt;br/&gt;
equivalent_new_code(req *http.Request) {&lt;br/&gt;
	if s := req.Referer(); s != &quot;&quot; 
{
		l.Referer = &amp;amp;s
	}
&lt;p&gt;	if s := req.UserAgent(); s != &quot;&quot; &lt;/p&gt;
{
		l.UserAgent = &amp;amp;s
	}
&lt;p&gt;        if calculateAdminStatus(req) &lt;/p&gt;
{
                l.IsAdmin = thrift.BoolPtr(true)
        }
&lt;p&gt;}&lt;br/&gt;
Easy to see that the old way is waaay more readable.&lt;br/&gt;
I&apos;m even ready to deal with some restrictions of this model - like it is impossible to have non-zero default for non-comparable types like maps.&lt;br/&gt;
So, going back to the description of the bug: if you replace &quot;magic values&quot; with &quot;default values&quot; it is not &quot;obviously broken&quot; anymore. I&apos;m about to implement the old mapping. It will not be turned on by default. Instead, it will be controlled by option passed to generator.&lt;br/&gt;
Any thoughts?&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13961980" author="bensigelman" created="Mon, 7 Apr 2014 16:29:32 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apesternikov&quot; class=&quot;user-hover&quot; rel=&quot;apesternikov&quot;&gt;apesternikov&lt;/a&gt;,&lt;br/&gt;
A few responses:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Sorry about &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2451&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/THRIFT-2451&lt;/a&gt; ... I will chime in on that over there, though.&lt;/li&gt;
	&lt;li&gt;As for your last point, though, I disagree (as you might imagine!). Basically, it&apos;s not the job of the serialization library to decide which values are &quot;empty&quot;. And just because something happens to take on its default value, we don&apos;t necessarily know that it&apos;s &quot;empty&quot;/absent.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I would also suggest looking at the approach that protobufs took to Go... they were confronted with much the same set of constraints and ended up with something much like what Thrift-2232 yielded.&lt;/p&gt;

&lt;p&gt;Anyway, the old code was definitely way more compact. It just wasn&apos;t correct in the general case &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; And that is, unfortunately, a requirement.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12619983" name="THRIFT-2322_optional_set_assignment_issue.patch" size="950" author="jensg" created="Sat, 21 Dec 2013 19:05:27 +0000"/>
                            <attachment id="12619984" name="THRIFT-2322_regenerated_serializer_testfile.patch" size="12829" author="jensg" created="Sat, 21 Dec 2013 19:10:24 +0000"/>
                            <attachment id="12618726" name="thrift-2232-golang-optional-fields-fix.patch" size="36160" author="bensigelman" created="Sat, 14 Dec 2013 00:03:51 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12684669">THRIFT-2290</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>354514</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 33 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1p49z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>354804</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>