<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:21:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-3388] hash doesn&apos;t work on set/list</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-3388</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2621&quot; title=&quot;Add basic default hash code method to python&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2621&quot;&gt;&lt;del&gt;THRIFT-2621&lt;/del&gt;&lt;/a&gt; added hash function to thrift generated classes, but certain types like set or list cannot be hashed. One solution is to convert them to immutable types (fronzenset, tuple) before calling hash() on them.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ thrift -version
Thrift version 0.9.3

$ cat test.thrift
struct Test {
  1: required set&amp;lt;string&amp;gt; test
}

$ thrift --gen py -out . test.thrift

$ cat test.py    
from test.ttypes import Test
from thrift.protocol import TBinaryProtocol
from thrift.transport import TTransport

# serialize
t = Test(test=set([&quot;a&quot;]))
tout = TTransport.TMemoryBuffer()
pout = TBinaryProtocol.TBinaryProtocol(tout)
t.write(pout)

# deserialize
tin = TTransport.TMemoryBuffer(tout.getvalue())
pin = TBinaryProtocol.TBinaryProtocol(tin)
t2 = Test()
t2.read(pin)

# put the deserialized object to a set
a = set([t2])

$ python test.py
Traceback (most recent call last):
  File &quot;test.py&quot;, line 18, in &amp;lt;module&amp;gt;
    a = set([t2])
  File &quot;/tmp/test/test/ttypes.py&quot;, line 81, in __hash__
    value = (value * 31) ^ hash(self.test)
TypeError: unhashable type: &apos;set&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;ubuntu 14.04 python 2.6.9&lt;/p&gt;</environment>
        <key id="12905378">THRIFT-3388</key>
            <summary>hash doesn&apos;t work on set/list</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jensg">Jens Geyer</assignee>
                                    <reporter username="michim">Michi Mutsuzaki</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Oct 2015 00:05:49 +0000</created>
                <updated>Fri, 18 Mar 2016 17:54:31 +0000</updated>
                            <resolved>Fri, 18 Mar 2016 17:54:31 +0000</resolved>
                                    <version>0.9.3</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>Python - Compiler</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14961019" author="jensg" created="Fri, 16 Oct 2015 17:09:41 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kishorvpatil&quot; class=&quot;user-hover&quot; rel=&quot;kishorvpatil&quot;&gt;kishorvpatil&lt;/a&gt;,&lt;br/&gt;
may I ask you to look at this issue?&lt;/p&gt;</comment>
                            <comment id="14979060" author="tejal29" created="Wed, 28 Oct 2015 19:09:13 +0000"  >&lt;p&gt;We are also bit by this issue. &lt;br/&gt;
Is there an ETA for this?&lt;/p&gt;</comment>
                            <comment id="14979482" author="jensg" created="Wed, 28 Oct 2015 23:34:55 +0000"  >&lt;p&gt;Not yet. If someone provides a fix, maybe? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15005591" author="jsirois" created="Sat, 14 Nov 2015 20:15:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jensg&quot; class=&quot;user-hover&quot; rel=&quot;jensg&quot;&gt;jensg&lt;/a&gt; One appropriate fix seems like a revert.  &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2621&quot; title=&quot;Add basic default hash code method to python&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2621&quot;&gt;&lt;del&gt;THRIFT-2621&lt;/del&gt;&lt;/a&gt; ~lifted a patch striaght from &lt;a href=&quot;https://github.com/nathanmarz/thrift/commit/6d4b008512cd9fcd5a6bb598d09f35eaf2dc7412&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; that was appropriate in its original context but it does not seem appropriate to ship with the official Apache thrift. It breaks very common use cases in thrift, namely using map, set, list. It would help to understand &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kishorvpatil&quot; class=&quot;user-hover&quot; rel=&quot;kishorvpatil&quot;&gt;kishorvpatil&lt;/a&gt;&apos;s use case for &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2621&quot; title=&quot;Add basic default hash code method to python&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2621&quot;&gt;&lt;del&gt;THRIFT-2621&lt;/del&gt;&lt;/a&gt;, since a revert would break presumably break his work.  My guess is wanting to avoid writing custom wrappers or keys for thrift structs for use in unit test comparisons and as members of application-level dicts and sets.&lt;/p&gt;

&lt;p&gt;Increasing the fix complexity, but being sensitive to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kishorvpatil&quot; class=&quot;user-hover&quot; rel=&quot;kishorvpatil&quot;&gt;kishorvpatil&lt;/a&gt;&apos;s use case would mean adding deep hash/eq as an option, there is precedent for this in &lt;tt&gt;java:hashcode&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Interested in your opinions in particular since I&apos;m not familiar with the thrift community or its protocols on things like this.&lt;/p&gt;</comment>
                            <comment id="15005602" author="jensg" created="Sat, 14 Nov 2015 20:33:26 +0000"  >&lt;p&gt;&amp;gt; since I&apos;m not familiar with the thrift community or its protocols &lt;/p&gt;

&lt;p&gt;We don&apos;t have that much &quot;protocol&quot; overhead here, so don&apos;t worry. &lt;/p&gt;

&lt;p&gt;Let me put it this way: If &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2621&quot; title=&quot;Add basic default hash code method to python&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2621&quot;&gt;&lt;del&gt;THRIFT-2621&lt;/del&gt;&lt;/a&gt; does not solve the whole issue - and it seems pretty much being the case - we should find a solution that does. You as a group, you and the &lt;del&gt;two&lt;/del&gt; 3  other guys &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kishorvpatil&quot; class=&quot;user-hover&quot; rel=&quot;kishorvpatil&quot;&gt;kishorvpatil&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michim&quot; class=&quot;user-hover&quot; rel=&quot;michim&quot;&gt;michim&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tejal29&quot; class=&quot;user-hover&quot; rel=&quot;tejal29&quot;&gt;tejal29&lt;/a&gt;, have toghether probably more than enough Python experience to find the best solution that covers all cases, and eventually put a  pull request together that satisfies all needs. &lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="15005609" author="jsirois" created="Sat, 14 Nov 2015 20:51:07 +0000"  >&lt;p&gt;My thought is that &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2621&quot; title=&quot;Add basic default hash code method to python&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2621&quot;&gt;&lt;del&gt;THRIFT-2621&lt;/del&gt;&lt;/a&gt; makes thrift python un-useable under 0.9.2+, so I&apos;d classify it not as &quot;does not solve the whole issue&quot;, but instead as it breaks thrift python for almost all real world cases.  As such I favor a revert under the premise that ~no-one can actually be using thrift python support under 0.9.2+ because of this break in the deserialization pipeline inside thrift itself.  Although confident of this, the patch was accepted and so I was hoping to get &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kishorvpatil&quot; class=&quot;user-hover&quot; rel=&quot;kishorvpatil&quot;&gt;kishorvpatil&lt;/a&gt;&apos;s thoughts before posting a revert patch as a proposal.&lt;/p&gt;</comment>
                            <comment id="15005626" author="michim" created="Sat, 14 Nov 2015 21:23:30 +0000"  >&lt;p&gt;+1 for reverting &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2621&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/THRIFT-2621&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There was a good discussion related to this topic in &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-162&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/THRIFT-162&lt;/a&gt; . The consensus there seems to be to add an &quot;immutable&quot; annotation. It seems like a reasonable approach to me.&lt;/p&gt;</comment>
                            <comment id="15005884" author="jensg" created="Sun, 15 Nov 2015 13:18:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kishorvpatil&quot; class=&quot;user-hover&quot; rel=&quot;kishorvpatil&quot;&gt;kishorvpatil&lt;/a&gt;, any closing arguments before I revert &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2621&quot; title=&quot;Add basic default hash code method to python&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2621&quot;&gt;&lt;del&gt;THRIFT-2621&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="15007397" author="tejal29" created="Mon, 16 Nov 2015 21:47:18 +0000"  >&lt;p&gt;Thank you all for chiming in!&lt;br/&gt;
I was about to propose a patch which would cover all the unhashable allowed types, by converting them to corresponding immutable and then hashing them&lt;br/&gt;
1. set &lt;br/&gt;
2. map&lt;br/&gt;
3. lists&lt;/p&gt;

&lt;p&gt;However, going through discussion over Thrift-162, seems like reverting the patch is the right way. &lt;/p&gt;</comment>
                            <comment id="15009522" author="jensg" created="Tue, 17 Nov 2015 21:17:42 +0000"  >&lt;p&gt;Committed the patch above in order to revert &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2621&quot; title=&quot;Add basic default hash code method to python&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2621&quot;&gt;&lt;del&gt;THRIFT-2621&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15009596" author="jsirois" created="Tue, 17 Nov 2015 21:43:15 +0000"  >&lt;p&gt;Thank you  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jensg&quot; class=&quot;user-hover&quot; rel=&quot;jensg&quot;&gt;jensg&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;Does 1.0 have a vague timeline for release or totally unknown?&lt;/p&gt;</comment>
                            <comment id="15009627" author="hudson" created="Tue, 17 Nov 2015 21:57:52 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #1732 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/1732/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/1732/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3388&quot; title=&quot;hash doesn&amp;#39;t work on set/list&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3388&quot;&gt;&lt;del&gt;THRIFT-3388&lt;/del&gt;&lt;/a&gt; hash doesn&apos;t work on set/list Client: Python Patch: Jens (jensg: rev 341390c19a4f559ddf9f64e5189ec103890ed239)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;compiler/cpp/src/generate/t_py_generator.cc&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15009696" author="tejal29" created="Tue, 17 Nov 2015 22:21:46 +0000"  >&lt;p&gt;Thank you! Same question as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jsirois&quot; class=&quot;user-hover&quot; rel=&quot;jsirois&quot;&gt;jsirois&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15009792" author="jensg" created="Tue, 17 Nov 2015 23:02:53 +0000"  >&lt;p&gt;I really would like to give you a more satisfying answer, but I have no release date or timeline for you, yet.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12406031">THRIFT-162</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12726696">THRIFT-2621</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12771554">AURORA-1083</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12726696">THRIFT-2621</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12772832" name="THRIFT-3388-hash-doesn-t-work-on-set-list.patch" size="1344" author="jensg" created="Tue, 17 Nov 2015 21:15:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 1 week ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2n3cn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>