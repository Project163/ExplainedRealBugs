<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:34:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-5685] Compiler generates wrong go code for forward defined types in optional fields</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-5685</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;This is a bug introduced by the fix of &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-5601&quot; title=&quot;Typedef after first use causes incorrect go code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-5601&quot;&gt;THRIFT-5601&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Given this thrift file:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
struct Bar {
  1: optional Foo bar
}

struct Foo {
  1: optional i64 foo
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;0.18.0 with b39370ec3bc96d2 reverted will generate the following go code (expected):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-go&quot;&gt;
...
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; Bar_Bar_DEFAULT *Foo
&lt;span class=&quot;code-keyword&quot;&gt;func&lt;/span&gt; (p *Bar) GetBar() *Foo {
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; !p.IsSetBar() {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Bar_Bar_DEFAULT
  }
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; p.Bar
}
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;while 0.18.0 generates:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-go&quot;&gt;
...
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; Bar_Bar_DEFAULT Foo
&lt;span class=&quot;code-keyword&quot;&gt;func&lt;/span&gt; (p *Bar) GetBar() Foo {
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; !p.IsSetBar() {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Bar_Bar_DEFAULT
  }
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; *p.Bar
}
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This makes usages like bar.GetBar().GetFoo() no longer compiles because GetBar now returns non-pointer type.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13524890">THRIFT-5685</key>
            <summary>Compiler generates wrong go code for forward defined types in optional fields</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fishywang">Yuxuan Wang</assignee>
                                    <reporter username="fishywang">Yuxuan Wang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Feb 2023 17:18:56 +0000</created>
                <updated>Fri, 11 Oct 2024 00:51:28 +0000</updated>
                            <resolved>Tue, 21 Feb 2023 21:59:16 +0000</resolved>
                                    <version>0.18.0</version>
                                    <fixVersion>0.18.1</fixVersion>
                                    <component>Go - Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="17689320" author="fishywang" created="Wed, 15 Feb 2023 19:34:57 +0000"  >&lt;p&gt;I don&apos;t find a quick and safe fix, so I&apos;ll just revert b39370ec3bc96d2 and reopen &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-5601&quot; title=&quot;Typedef after first use causes incorrect go code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-5601&quot;&gt;THRIFT-5601&lt;/a&gt; instead, as the impact of &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-5601&quot; title=&quot;Typedef after first use causes incorrect go code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-5601&quot;&gt;THRIFT-5601&lt;/a&gt; is far smaller than this bug.&lt;/p&gt;</comment>
                            <comment id="17689344" author="jensg" created="Wed, 15 Feb 2023 21:22:17 +0000"  >&lt;p&gt;branch created&lt;/p&gt;</comment>
                            <comment id="17689963" author="fishywang" created="Thu, 16 Feb 2023 20:01:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jensg&quot; class=&quot;user-hover&quot; rel=&quot;jensg&quot;&gt;jensg&lt;/a&gt; The patch should be enough, but to be sure I&apos;m also running this version in our test environment against 0.17.0 to verify that there&apos;s no other regressions.&lt;/p&gt;</comment>
                            <comment id="17691808" author="jensg" created="Tue, 21 Feb 2023 21:59:03 +0000"  >&lt;p&gt;Assuming this is resolved as per &lt;a href=&quot;https://github.com/apache/thrift/pull/2759#issuecomment-1433830467&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Github comment&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17888471" author="jensg" created="Thu, 10 Oct 2024 23:44:10 +0000"  >&lt;p&gt;ForwardType.thrift contains a different test case as cdesvrinbed. Particularly an ILLEGAL test case.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
namespace go forwardtypetest

struct Struct {
  1: optional Exc foo    &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is ILLEGAL
&lt;/span&gt;}

exception Exc {
  1: optional i32 code
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17888472" author="jensg" created="Thu, 10 Oct 2024 23:45:19 +0000"  >&lt;p&gt;... because an exception is not a normal struct type. Even if it works in Go,m it is still illegal IDL.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13594987">THRIFT-5823</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="13469529">THRIFT-5601</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1fyow:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>