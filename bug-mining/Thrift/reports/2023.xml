<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:31:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-4976] Docker build: Test failure for `StalenessCheckTest` on MacOS</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-4976</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;`StalenessCheckTest` consists of three python tests, each of which verify whether a thrift file is recompiled after some modification. The test scheme is such as:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Compile some thrift files&lt;/li&gt;
	&lt;li&gt;Get the modification timestamp of generated files.&lt;/li&gt;
	&lt;li&gt;Make modification to the thrift files&lt;/li&gt;
	&lt;li&gt;Sleep for 0.1 second, and then recompile&lt;/li&gt;
	&lt;li&gt;Get the modification timestamp of (re)generated files&lt;/li&gt;
	&lt;li&gt;Assert that the second timestamp is bigger than the first&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;When running a docker build (with ubuntu-bionic) on MacOS, the assertion fails randomly, because the underlying file system&apos;s timestamp is only second-accurate. So the 0.1 second is not enough to make sure that the second timestamp is bigger than the first (both could end up to be round to the same second).&lt;/p&gt;

&lt;p&gt;Example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
export  SCRIPT=&lt;span class=&quot;code-quote&quot;&gt;&quot;cmake.sh&quot;&lt;/span&gt;
export  BUILD_ARG=&lt;span class=&quot;code-quote&quot;&gt;&quot;-D WITH_C_GLIB=OFF -D WITH_AS3=OFF -D WITH_PYTHON=OFF -D WITH_HASKELL=OFF&quot;&lt;/span&gt;
export  BUILD_ENV=&lt;span class=&quot;code-quote&quot;&gt;&quot;-e CC=gcc -e CXX=g++ -e THRIFT_CROSSTEST_CONCURRENCY=3&quot;&lt;/span&gt;
export  DISTRO=ubuntu-bionic
export  BUILD_LIBS=&lt;span class=&quot;code-quote&quot;&gt;&quot;CPP JAVA&quot;&lt;/span&gt;  # only meaningful &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; CMake builds
export  DOCKER_REPO=&lt;span class=&quot;code-quote&quot;&gt;&quot;thrift/thrift-build&quot;&lt;/span&gt;

SCRIPT_DIR=&lt;span class=&quot;code-quote&quot;&gt;&quot;$(cd &quot;&lt;/span&gt;$(dirname &lt;span class=&quot;code-quote&quot;&gt;&quot;${BASH_SOURCE[0]}&quot;&lt;/span&gt;)&lt;span class=&quot;code-quote&quot;&gt;&quot; &amp;amp;&amp;amp; pwd)&quot;&lt;/span&gt;
DOCKER_TAG=$DOCKER_REPO:$DISTRO

docker run --net=host -e BUILD_LIBS=&lt;span class=&quot;code-quote&quot;&gt;&quot;$BUILD_LIBS&quot;&lt;/span&gt; $BUILD_ENV -v $(pwd):/thrift/src \
        -it $DOCKER_TAG build/docker/scripts/cmake.sh $BUILD_ARG

...

test 435
        Start 435: StalenessCheckTest435: Test command: /usr/bin/python &lt;span class=&quot;code-quote&quot;&gt;&quot;/thrift/src/compiler/cpp/test/compiler/staleness_check.py&quot;&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;/thrift/src/cmake_build/compiler/cpp/bin/thrift&quot;&lt;/span&gt;
435: Test timeout computed to be: 1500
435: test_staleness_check_of_included_file (__main__.TestStalenessCheck) ... FAIL
435: test_staleness_check_of_single_thrift_file_with_changed_output (__main__.TestStalenessCheck) ... ok
435: test_staleness_check_of_single_thrift_file_without_changed_output (__main__.TestStalenessCheck) ... ok
435:
435: ======================================================================
435: FAIL: test_staleness_check_of_included_file (__main__.TestStalenessCheck)
435: ----------------------------------------------------------------------
435: Traceback (most recent call last):
435:   File &lt;span class=&quot;code-quote&quot;&gt;&quot;/thrift/src/compiler/cpp/test/compiler/staleness_check.py&quot;&lt;/span&gt;, line 123, in test_staleness_check_of_included_file
435:     included_constants_cpp_second_modification_time, included_constants_cpp_first_modification_time)
435: AssertionError: 1570986553.0 not greater than 1570986553.0
435:
435: ----------------------------------------------------------------------
435: Ran 3 tests in 0.727s
435:
435: FAILED (failures=1)
435/464 Test #435: StalenessCheckTest ...............***Failed    0.85 sec

...

99% tests passed, 1 tests failed out of 46499% tests passed, 1 tests failed out of 464
Total Test time (real) = 344.50 sec
The following tests FAILED: 435 - StalenessCheckTest (Failed)Errors &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; running CTest&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13262024">THRIFT-4976</key>
            <summary>Docker build: Test failure for `StalenessCheckTest` on MacOS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="q.xu">Qinghui Xu</assignee>
                                    <reporter username="q.xu">Qinghui Xu</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sun, 13 Oct 2019 20:15:15 +0000</created>
                <updated>Thu, 11 Feb 2021 22:26:38 +0000</updated>
                            <resolved>Sat, 19 Oct 2019 19:04:19 +0000</resolved>
                                                    <fixVersion>0.14.0</fixVersion>
                                    <component>Build Process</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16950465" author="q.xu" created="Sun, 13 Oct 2019 20:16:32 +0000"  >&lt;p&gt;I would suggest to put the delay to 1.0 second to make sure the timestamp will be changed.&lt;/p&gt;</comment>
                            <comment id="16954137" author="calcifer" created="Thu, 17 Oct 2019 22:04:49 +0000"  >&lt;p&gt;This only applies to HFS+ systems, right? Because APFS has nanosecond resolution.&lt;/p&gt;</comment>
                            <comment id="16954926" author="q.xu" created="Fri, 18 Oct 2019 19:26:59 +0000"  >&lt;p&gt;In docker container, the file system is mounted as `osxfs`. This file system thus might behave differently from the physical one (HFS+ or APFS), and there is not much documentation about it.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 4 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z07jpk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>