<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:26:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-3891] TNonblockingServer configured with more than one IO threads does not always return from serve() upon stop()</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-3891</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;Using &lt;tt&gt;TNonblockingServer&lt;/tt&gt;, when the number of IO threads is &amp;gt; 1, there is race condition in which &lt;tt&gt;stop()&lt;/tt&gt; does not properly unblock &lt;tt&gt;serve()&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;The problem manifests itself when &lt;tt&gt;stop()&lt;/tt&gt; is called (obviously from a different thread) soon after &lt;tt&gt;serve()&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;The core issue is that, &lt;tt&gt;event_base_loopbreak()&lt;/tt&gt; is called within the &lt;tt&gt;stop()&lt;/tt&gt; sequence without checking whether the IO thread has actually entered its event loop. The documentation of &lt;tt&gt;event_base_loopbreak()&lt;/tt&gt; says (&lt;a href=&quot;http://www.wangafu.net/~nickm/libevent-book/Ref3_eventloop.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.wangafu.net/~nickm/libevent-book/Ref3_eventloop.html&lt;/a&gt;)&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Note also that event_base_loopexit(base,NULL) and event_base_loopbreak(base) act differently when no event loop is running: loopexit schedules the next instance of the event loop to stop right after the next round of callbacks are run (as if it had been invoked with EVLOOP_ONCE) whereas loopbreak only stops a currently running loop, and has no effect if the event loop isn&#8217;t running.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Attached is a patch (against the released 0.9.3 version of the codebase).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12994107">THRIFT-3891</key>
            <summary>TNonblockingServer configured with more than one IO threads does not always return from serve() upon stop()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jking3">James E. King III</assignee>
                                    <reporter username="bgedik">Bu&#287;ra Gedik</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Aug 2016 23:06:00 +0000</created>
                <updated>Thu, 14 Dec 2017 13:56:00 +0000</updated>
                            <resolved>Tue, 28 Feb 2017 04:50:24 +0000</resolved>
                                    <version>0.9.3</version>
                                    <fixVersion>0.11.0</fixVersion>
                                    <component>C++ - Library</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15462646" author="githubbot" created="Sun, 4 Sep 2016 09:44:02 +0000"  >&lt;p&gt;GitHub user nsuke opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1080&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1080&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3891&quot; title=&quot;TNonblockingServer configured with more than one IO threads does not always return from serve() upon stop()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3891&quot;&gt;&lt;del&gt;THRIFT-3891&lt;/del&gt;&lt;/a&gt; TNonblockingServer configured with more than one IO threa&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;ds does not always return from serve() upon stop()&lt;/p&gt;

&lt;p&gt;    imported from JIRA issue.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/nsuke/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/nsuke/thrift&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3891&quot; title=&quot;TNonblockingServer configured with more than one IO threads does not always return from serve() upon stop()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3891&quot;&gt;&lt;del&gt;THRIFT-3891&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1080.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1080.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1080&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit f32a79088f0b2309d53af519677e6f103b3b8c6a&lt;br/&gt;
Author: Bu&#287;ra Gedik &amp;lt;bgedik@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-09-04T08:18:15Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3891&quot; title=&quot;TNonblockingServer configured with more than one IO threads does not always return from serve() upon stop()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3891&quot;&gt;&lt;del&gt;THRIFT-3891&lt;/del&gt;&lt;/a&gt; TNonblockingServer configured with more than one IO threads does not always return from serve() upon stop()&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15657456" author="bgedik" created="Fri, 11 Nov 2016 16:29:10 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jking3&quot; class=&quot;user-hover&quot; rel=&quot;jking3&quot;&gt;jking3&lt;/a&gt;. Since you worked on &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3932&quot; title=&quot;C++ ThreadManager has a rare termination race&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3932&quot;&gt;&lt;del&gt;THRIFT-3932&lt;/del&gt;&lt;/a&gt;, I was wondering if you would be interested in taking a look at this one as well. This is another threading issue we&apos;ve had to patch ourselves. Or perhaps you know someone who is familiar with this part of the code, who can take a look at this.&lt;/p&gt;</comment>
                            <comment id="15657628" author="nsuke" created="Fri, 11 Nov 2016 17:47:04 +0000"  >&lt;p&gt;A couple of comments:&lt;/p&gt;

&lt;p&gt;1. Instead of adding isEventInitialized_ flag, &lt;tt&gt;if (eventFlags_ != 0)&lt;/tt&gt; can do basically the same thing.&lt;br/&gt;
eventFlags_ avoids more unecessary cases although double event_del is harmless according to the doc.&lt;/p&gt;

&lt;p&gt;2. After that we synchronize initialization using isStopRequested_, we no longer need to replace event_base_loopbreak with event_base_loopexit ?&lt;/p&gt;</comment>
                            <comment id="15657754" author="jking3" created="Fri, 11 Nov 2016 18:34:38 +0000"  >&lt;p&gt;I&apos;m actually not familiar at all with the nonblocking server right now.  Thank you for providing the patch however, that will be helpful.&lt;/p&gt;</comment>
                            <comment id="15659227" author="bgedik" created="Sat, 12 Nov 2016 07:40:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nsuke&quot; class=&quot;user-hover&quot; rel=&quot;nsuke&quot;&gt;nsuke&lt;/a&gt;: That was my initial fix, but I recall it did not work due to &lt;tt&gt;event_del&lt;/tt&gt; issues. I think what is needed is a test case, which starts the &lt;tt&gt;TNonBlockingServer&lt;/tt&gt; with  multiple IO threads and immediately stops it from a different thread. This way we can test different fixes.&lt;/p&gt;</comment>
                            <comment id="15837187" author="githubbot" created="Wed, 25 Jan 2017 04:46:09 +0000"  >&lt;p&gt;Github user jeking3 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1080#discussion_r97708735&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1080#discussion_r97708735&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/src/thrift/server/TNonblockingServer.cpp &amp;#8212;&lt;br/&gt;
    @@ -1524,7 +1532,7 @@ void TNonblockingIOThread::breakLoop(bool error) {&lt;br/&gt;
       }&lt;/p&gt;

&lt;p&gt;       // sets a flag so that the loop exits on the next event&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;event_base_loopbreak(eventBase_);&lt;br/&gt;
    +  event_base_loopexit(eventBase_, 0);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I am curious to understand why this was changed.  event_base_loopexit will cause the lop to continue processing until drained.  This function is called breakLoop and I assume that means stop as soon as possible, which is what it was doing.&lt;/p&gt;</comment>
                            <comment id="15837222" author="githubbot" created="Wed, 25 Jan 2017 05:34:10 +0000"  >&lt;p&gt;Github user bgedik commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1080#discussion_r97712383&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1080#discussion_r97712383&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/src/thrift/server/TNonblockingServer.cpp &amp;#8212;&lt;br/&gt;
    @@ -1524,7 +1532,7 @@ void TNonblockingIOThread::breakLoop(bool error) {&lt;br/&gt;
       }&lt;/p&gt;

&lt;p&gt;       // sets a flag so that the loop exits on the next event&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;event_base_loopbreak(eventBase_);&lt;br/&gt;
    +  event_base_loopexit(eventBase_, 0);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    There are some subtle differences between the two. The first difference is what you already mentioned. The second difference is that, event_base_loopbreak will have no effect when there is no loop running: &lt;a href=&quot;http://www.wangafu.net/~nickm/libevent-book/Ref3_eventloop.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.wangafu.net/~nickm/libevent-book/Ref3_eventloop.html&lt;/a&gt;. In contrast, event_base_loopexit is not `lost` if it is called without having a loop running.&lt;/p&gt;

&lt;p&gt;    In the TNonblockingServer code, event_base_loopbreak is called without checking if the loop started running.&lt;/p&gt;

&lt;p&gt;    An alternative fix would be to keep the event_base_loopbreak, but somehow introduce additional synchronization to make sure it is not lost.&lt;/p&gt;
</comment>
                            <comment id="15837225" author="githubbot" created="Wed, 25 Jan 2017 05:40:00 +0000"  >&lt;p&gt;Github user bgedik commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1080#discussion_r97712737&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1080#discussion_r97712737&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/src/thrift/server/TNonblockingServer.cpp &amp;#8212;&lt;br/&gt;
    @@ -1524,7 +1532,7 @@ void TNonblockingIOThread::breakLoop(bool error) {&lt;br/&gt;
       }&lt;/p&gt;

&lt;p&gt;       // sets a flag so that the loop exits on the next event&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I guess the comment is stale now. The loop now exits once the current iteration is complete.&lt;/p&gt;</comment>
                            <comment id="15837811" author="githubbot" created="Wed, 25 Jan 2017 14:30:51 +0000"  >&lt;p&gt;Github user jeking3 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1080#discussion_r97789162&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1080#discussion_r97789162&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/src/thrift/server/TNonblockingServer.cpp &amp;#8212;&lt;br/&gt;
    @@ -1524,7 +1532,7 @@ void TNonblockingIOThread::breakLoop(bool error) {&lt;br/&gt;
       }&lt;/p&gt;

&lt;p&gt;       // sets a flag so that the loop exits on the next event&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;event_base_loopbreak(eventBase_);&lt;br/&gt;
    +  event_base_loopexit(eventBase_, 0);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Your commends correspond to the discussion in the Jira entry for this item from @nsuke.  Is that something you would have time to do?&lt;/p&gt;</comment>
                            <comment id="15837879" author="githubbot" created="Wed, 25 Jan 2017 15:11:36 +0000"  >&lt;p&gt;Github user bgedik commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1080#discussion_r97798270&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1080#discussion_r97798270&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/src/thrift/server/TNonblockingServer.cpp &amp;#8212;&lt;br/&gt;
    @@ -1524,7 +1532,7 @@ void TNonblockingIOThread::breakLoop(bool error) {&lt;br/&gt;
       }&lt;/p&gt;

&lt;p&gt;       // sets a flag so that the loop exits on the next event&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;event_base_loopbreak(eventBase_);&lt;br/&gt;
    +  event_base_loopexit(eventBase_, 0);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I created the JIRA entry, with a patch that works for us (in production and testing). I know it is not the ideal fix, but I was hoping that someone who is more versed in the ``TNonblockingServer`` implementation can work it. I don&apos;t have the time to dig into the design of ``TNonblockingServer``.&lt;/p&gt;</comment>
                            <comment id="15873324" author="githubbot" created="Sat, 18 Feb 2017 20:16:45 +0000"  >&lt;p&gt;GitHub user jeking3 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1196&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1196&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3891&quot; title=&quot;TNonblockingServer configured with more than one IO threads does not always return from serve() upon stop()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3891&quot;&gt;&lt;del&gt;THRIFT-3891&lt;/del&gt;&lt;/a&gt; TNonblockingServer configured with more than one IO threads does not always return from serve() upon stop()&lt;/p&gt;

&lt;p&gt;    I took the comments from @nsuke and applied them to the PR.  I was able to reasonably eliminate the boolean you mentioned however I could not go back to loopbreak.  I see no reasonable way to synchronize here.  The run() thread will eventually need to release a mutex and THEN call the event loop.  There&apos;s no way inside breakLoop() to know if it is actually IN the event loop.  Given this, the exit variant is the only safe method to break the loop.&lt;/p&gt;

&lt;p&gt;    The obsoletes PR #1080.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jeking3/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jeking3/thrift&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3891&quot; title=&quot;TNonblockingServer configured with more than one IO threads does not always return from serve() upon stop()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3891&quot;&gt;&lt;del&gt;THRIFT-3891&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1196.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1196.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1196&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 38d3c87aa11f1f4232cb97b01200c01fc578cd9d&lt;br/&gt;
Author: Bu&#287;ra Gedik &amp;lt;bgedik@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-09-04T08:18:15Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3891&quot; title=&quot;TNonblockingServer configured with more than one IO threads does not always return from serve() upon stop()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3891&quot;&gt;&lt;del&gt;THRIFT-3891&lt;/del&gt;&lt;/a&gt; TNonblockingServer configured with more than one IO threads does not always return from serve() upon stop()&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15873347" author="githubbot" created="Sat, 18 Feb 2017 22:29:30 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1196&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1196&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks like I ran the build and tests outside the dockerfile so it didn&apos;t do any libevent stuff. :|&lt;/p&gt;</comment>
                            <comment id="15873441" author="githubbot" created="Sun, 19 Feb 2017 03:47:14 +0000"  >&lt;p&gt;Github user nsuke commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1196#discussion_r101908056&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1196#discussion_r101908056&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/src/thrift/server/TNonblockingServer.cpp &amp;#8212;&lt;br/&gt;
    @@ -212,7 +212,8 @@ class TNonblockingServer::TConnection {&lt;br/&gt;
       TConnection(THRIFT_SOCKET socket,&lt;br/&gt;
                   TNonblockingIOThread* ioThread,&lt;br/&gt;
                   const sockaddr* addr,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;socklen_t addrLen) {&lt;br/&gt;
    +              socklen_t addrLen)&lt;br/&gt;
    +  {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Enter key by accident ?&lt;/p&gt;</comment>
                            <comment id="15873442" author="githubbot" created="Sun, 19 Feb 2017 03:47:14 +0000"  >&lt;p&gt;Github user nsuke commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1196#discussion_r101908093&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1196#discussion_r101908093&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/src/thrift/server/TNonblockingServer.cpp &amp;#8212;&lt;br/&gt;
    @@ -820,9 +821,11 @@ void TNonblockingServer::TConnection::setFlags(short eventFlags) {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Closes a connection&lt;br/&gt;
      */&lt;br/&gt;
     void TNonblockingServer::TConnection::close() {&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Delete the registered libevent&lt;/li&gt;
	&lt;li&gt;if (event_del(&amp;amp;event_) == -1) {&lt;/li&gt;
	&lt;li&gt;GlobalOutput.perror(&quot;TConnection::close() event_del&quot;, THRIFT_GET_SOCKET_ERROR);&lt;br/&gt;
    +  if (eventFlags_) {&lt;br/&gt;
    +    if (event_del(&amp;amp;event_) == -1) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    nits: single `if` with `eventFlags_ &amp;amp;&amp;amp; event_del...` ?&lt;/p&gt;</comment>
                            <comment id="15873443" author="githubbot" created="Sun, 19 Feb 2017 03:47:14 +0000"  >&lt;p&gt;Github user nsuke commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1196#discussion_r101908102&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1196#discussion_r101908102&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/src/thrift/server/TNonblockingServer.cpp &amp;#8212;&lt;br/&gt;
    @@ -820,9 +821,11 @@ void TNonblockingServer::TConnection::setFlags(short eventFlags) {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Closes a connection&lt;br/&gt;
      */&lt;br/&gt;
     void TNonblockingServer::TConnection::close() {&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Delete the registered libevent&lt;/li&gt;
	&lt;li&gt;if (event_del(&amp;amp;event_) == -1) {&lt;/li&gt;
	&lt;li&gt;GlobalOutput.perror(&quot;TConnection::close() event_del&quot;, THRIFT_GET_SOCKET_ERROR);&lt;br/&gt;
    +  if (eventFlags_) {&lt;br/&gt;
    +    if (event_del(&amp;amp;event_) == -1) {&lt;br/&gt;
    +      GlobalOutput(&quot;TConnection::close event_del&quot;);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Not sure why changing from `GlobalOutput.perror` to `GlobalOutput`.&lt;/p&gt;</comment>
                            <comment id="15873444" author="githubbot" created="Sun, 19 Feb 2017 03:47:14 +0000"  >&lt;p&gt;Github user nsuke commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1196#discussion_r101908082&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1196#discussion_r101908082&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/src/thrift/server/TNonblockingServer.cpp &amp;#8212;&lt;br/&gt;
    @@ -1520,13 +1524,9 @@ void TNonblockingIOThread::breakLoop(bool error) {&lt;br/&gt;
         ::abort();&lt;br/&gt;
       }&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// sets a flag so that the loop exits on the next event&lt;/li&gt;
	&lt;li&gt;event_base_loopbreak(eventBase_);&lt;br/&gt;
    +  // cause the loop to stop ASAP - even if it has things to do in it&lt;br/&gt;
    +  event_base_loopexit(eventBase_, 0);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +1&lt;br/&gt;
    According to another look at the header doc, loopbreak is typically to be called from inside the loop.&lt;/p&gt;</comment>
                            <comment id="15873463" author="githubbot" created="Sun, 19 Feb 2017 04:20:28 +0000"  >&lt;p&gt;Github user jeking3 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1196#discussion_r101908414&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1196#discussion_r101908414&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/src/thrift/server/TNonblockingServer.cpp &amp;#8212;&lt;br/&gt;
    @@ -820,9 +821,11 @@ void TNonblockingServer::TConnection::setFlags(short eventFlags) {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Closes a connection&lt;br/&gt;
      */&lt;br/&gt;
     void TNonblockingServer::TConnection::close() {&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Delete the registered libevent&lt;/li&gt;
	&lt;li&gt;if (event_del(&amp;amp;event_) == -1) {&lt;/li&gt;
	&lt;li&gt;GlobalOutput.perror(&quot;TConnection::close() event_del&quot;, THRIFT_GET_SOCKET_ERROR);&lt;br/&gt;
    +  if (eventFlags_) {&lt;br/&gt;
    +    if (event_del(&amp;amp;event_) == -1) {&lt;br/&gt;
    +      GlobalOutput(&quot;TConnection::close event_del&quot;);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Sorry I copied this from another location and it must have been using GlobalOutput.  I will fix this.&lt;/p&gt;</comment>
                            <comment id="15873774" author="githubbot" created="Sun, 19 Feb 2017 17:56:13 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1196&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1196&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The failure looks like an inability to stop the loop.&lt;br/&gt;
    I an going to look into changing the nonblocking server&apos;s stop() method to inject an event that causes it to call loopbreak from within the loop.&lt;/p&gt;</comment>
                            <comment id="15873802" author="githubbot" created="Sun, 19 Feb 2017 19:09:43 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1196&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1196&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    In the next push I have changed the way the nonblocking server test starts up, avoiding a ~100ms delay three times.  Then I changed how the loop stops so that it always stops from inside using loopbreak.&lt;/p&gt;</comment>
                            <comment id="15873970" author="githubbot" created="Mon, 20 Feb 2017 02:39:01 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1196&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1196&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @nsuke to test this I ran TNonblockingServerTest in a tight loop for 30 minutes.  It never made it past 30 seconds before, and that was with 300ms delay built into each test.  The test runs much faster now because I properly synchronized the &quot;wait for the server to be listening&quot; part of the test, and I fixed the shutdown mechanism so that it always occurs from within the event loop.&lt;/p&gt;</comment>
                            <comment id="15874554" author="githubbot" created="Mon, 20 Feb 2017 13:54:52 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1196&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1196&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @nsuke this is ready for review again.&lt;/p&gt;</comment>
                            <comment id="15874559" author="githubbot" created="Mon, 20 Feb 2017 13:59:20 +0000"  >&lt;p&gt;Github user bgedik commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1196#discussion_r102023002&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1196#discussion_r102023002&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/src/thrift/server/TNonblockingServer.cpp &amp;#8212;&lt;br/&gt;
    @@ -1566,24 +1562,26 @@ void TNonblockingIOThread::setCurrentThreadHighPriority(bool value) {&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;     void TNonblockingIOThread::run() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (eventBase_ == NULL)&lt;br/&gt;
    +  if (eventBase_ == NULL) 
{
         registerEvents();
    -
    -  GlobalOutput.printf(&quot;TNonblockingServer: IO thread #%d entering loop...&quot;, number_);
    -
    +  }
&lt;p&gt;       if (useHighPriority_) &lt;/p&gt;
{
         setCurrentThreadHighPriority(true);
       }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Run libevent engine, never returns, invokes calls to eventHandler&lt;/li&gt;
	&lt;li&gt;event_base_loop(eventBase_, 0);&lt;br/&gt;
    +  if (eventBase_ != NULL)&lt;br/&gt;
    +  {&lt;br/&gt;
    +    GlobalOutput.printf(&quot;TNonblockingServer: IO thread #%d entering loop...&quot;, number_);&lt;br/&gt;
    +    // Run libevent engine, never returns, invokes calls to eventHandler&lt;br/&gt;
    +    event_base_loop(eventBase_, 0);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (useHighPriority_) 
{
    -    setCurrentThreadHighPriority(false);
    -  }
&lt;p&gt;    +    if (useHighPriority_) &lt;/p&gt;
{
    +      setCurrentThreadHighPriority(false);
    +    }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// cleans up our registered events&lt;/li&gt;
	&lt;li&gt;cleanupEvents();&lt;br/&gt;
    +    // cleans up our registered events&lt;br/&gt;
    +    cleanupEvents();&lt;br/&gt;
    +  }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;       GlobalOutput.printf(&quot;TNonblockingServer: IO thread #%d run() done!&quot;, number_);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Is there any way to control the outputting of these messages? When we run with TNonblockingServer, we get these output. I couldn&apos;t find a way to mask them.&lt;/p&gt;</comment>
                            <comment id="15874586" author="githubbot" created="Mon, 20 Feb 2017 14:10:24 +0000"  >&lt;p&gt;Github user jeking3 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1196#discussion_r102025071&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1196#discussion_r102025071&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/src/thrift/server/TNonblockingServer.cpp &amp;#8212;&lt;br/&gt;
    @@ -1566,24 +1562,26 @@ void TNonblockingIOThread::setCurrentThreadHighPriority(bool value) {&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;     void TNonblockingIOThread::run() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (eventBase_ == NULL)&lt;br/&gt;
    +  if (eventBase_ == NULL) 
{
         registerEvents();
    -
    -  GlobalOutput.printf(&quot;TNonblockingServer: IO thread #%d entering loop...&quot;, number_);
    -
    +  }
&lt;p&gt;       if (useHighPriority_) &lt;/p&gt;
{
         setCurrentThreadHighPriority(true);
       }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Run libevent engine, never returns, invokes calls to eventHandler&lt;/li&gt;
	&lt;li&gt;event_base_loop(eventBase_, 0);&lt;br/&gt;
    +  if (eventBase_ != NULL)&lt;br/&gt;
    +  {&lt;br/&gt;
    +    GlobalOutput.printf(&quot;TNonblockingServer: IO thread #%d entering loop...&quot;, number_);&lt;br/&gt;
    +    // Run libevent engine, never returns, invokes calls to eventHandler&lt;br/&gt;
    +    event_base_loop(eventBase_, 0);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (useHighPriority_) 
{
    -    setCurrentThreadHighPriority(false);
    -  }
&lt;p&gt;    +    if (useHighPriority_) &lt;/p&gt;
{
    +      setCurrentThreadHighPriority(false);
    +    }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// cleans up our registered events&lt;/li&gt;
	&lt;li&gt;cleanupEvents();&lt;br/&gt;
    +    // cleans up our registered events&lt;br/&gt;
    +    cleanupEvents();&lt;br/&gt;
    +  }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;       GlobalOutput.printf(&quot;TNonblockingServer: IO thread #%d run() done!&quot;, number_);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    You can install your own GlobalOutput handler.  The hooks should be in the top level thrift header.&lt;/p&gt;</comment>
                            <comment id="15874587" author="githubbot" created="Mon, 20 Feb 2017 14:12:45 +0000"  >&lt;p&gt;Github user bgedik commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1196#discussion_r102025490&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1196#discussion_r102025490&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/src/thrift/server/TNonblockingServer.cpp &amp;#8212;&lt;br/&gt;
    @@ -1566,24 +1562,26 @@ void TNonblockingIOThread::setCurrentThreadHighPriority(bool value) {&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;     void TNonblockingIOThread::run() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (eventBase_ == NULL)&lt;br/&gt;
    +  if (eventBase_ == NULL) 
{
         registerEvents();
    -
    -  GlobalOutput.printf(&quot;TNonblockingServer: IO thread #%d entering loop...&quot;, number_);
    -
    +  }
&lt;p&gt;       if (useHighPriority_) &lt;/p&gt;
{
         setCurrentThreadHighPriority(true);
       }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Run libevent engine, never returns, invokes calls to eventHandler&lt;/li&gt;
	&lt;li&gt;event_base_loop(eventBase_, 0);&lt;br/&gt;
    +  if (eventBase_ != NULL)&lt;br/&gt;
    +  {&lt;br/&gt;
    +    GlobalOutput.printf(&quot;TNonblockingServer: IO thread #%d entering loop...&quot;, number_);&lt;br/&gt;
    +    // Run libevent engine, never returns, invokes calls to eventHandler&lt;br/&gt;
    +    event_base_loop(eventBase_, 0);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (useHighPriority_) 
{
    -    setCurrentThreadHighPriority(false);
    -  }
&lt;p&gt;    +    if (useHighPriority_) &lt;/p&gt;
{
    +      setCurrentThreadHighPriority(false);
    +    }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// cleans up our registered events&lt;/li&gt;
	&lt;li&gt;cleanupEvents();&lt;br/&gt;
    +    // cleans up our registered events&lt;br/&gt;
    +    cleanupEvents();&lt;br/&gt;
    +  }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;       GlobalOutput.printf(&quot;TNonblockingServer: IO thread #%d run() done!&quot;, number_);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Thanks, but for a message like &lt;tt&gt;&quot;TNonblockingServer: IO thread #0 run() done!&quot;&lt;/tt&gt; is there any kind of metadata that tells me if this is a info message or a warning/error message. It seems to be being output without any information attached to it. That makes it hard to filter the messages that we consider unnecessary.&lt;/p&gt;</comment>
                            <comment id="15874588" author="githubbot" created="Mon, 20 Feb 2017 14:15:02 +0000"  >&lt;p&gt;Github user jeking3 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1196#discussion_r102025979&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1196#discussion_r102025979&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/src/thrift/server/TNonblockingServer.cpp &amp;#8212;&lt;br/&gt;
    @@ -1566,24 +1562,26 @@ void TNonblockingIOThread::setCurrentThreadHighPriority(bool value) {&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;     void TNonblockingIOThread::run() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (eventBase_ == NULL)&lt;br/&gt;
    +  if (eventBase_ == NULL) 
{
         registerEvents();
    -
    -  GlobalOutput.printf(&quot;TNonblockingServer: IO thread #%d entering loop...&quot;, number_);
    -
    +  }
&lt;p&gt;       if (useHighPriority_) &lt;/p&gt;
{
         setCurrentThreadHighPriority(true);
       }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Run libevent engine, never returns, invokes calls to eventHandler&lt;/li&gt;
	&lt;li&gt;event_base_loop(eventBase_, 0);&lt;br/&gt;
    +  if (eventBase_ != NULL)&lt;br/&gt;
    +  {&lt;br/&gt;
    +    GlobalOutput.printf(&quot;TNonblockingServer: IO thread #%d entering loop...&quot;, number_);&lt;br/&gt;
    +    // Run libevent engine, never returns, invokes calls to eventHandler&lt;br/&gt;
    +    event_base_loop(eventBase_, 0);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (useHighPriority_) 
{
    -    setCurrentThreadHighPriority(false);
    -  }
&lt;p&gt;    +    if (useHighPriority_) &lt;/p&gt;
{
    +      setCurrentThreadHighPriority(false);
    +    }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// cleans up our registered events&lt;/li&gt;
	&lt;li&gt;cleanupEvents();&lt;br/&gt;
    +    // cleans up our registered events&lt;br/&gt;
    +    cleanupEvents();&lt;br/&gt;
    +  }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;       GlobalOutput.printf(&quot;TNonblockingServer: IO thread #%d run() done!&quot;, number_);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    All of these messages were already in the implementation and they do not appear to have any discrimination as to the severity.  My assumption is they are all meant for &quot;printf style debugging&quot;.&lt;/p&gt;</comment>
                            <comment id="15874967" author="githubbot" created="Mon, 20 Feb 2017 19:07:14 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1196&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1196&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Once someone has a chance to approve the changes I can merge.&lt;/p&gt;</comment>
                            <comment id="15878633" author="githubbot" created="Wed, 22 Feb 2017 16:26:44 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1196&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1196&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Could someone please do a code review and approve or request changes?  Thanks.&lt;/p&gt;</comment>
                            <comment id="15887251" author="githubbot" created="Tue, 28 Feb 2017 04:50:35 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1080&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1080&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15887252" author="githubbot" created="Tue, 28 Feb 2017 04:50:35 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1196&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1196&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12821657" name="patch.diff" size="3911" author="bgedik" created="Tue, 2 Aug 2016 17:39:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 38 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31ruf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>