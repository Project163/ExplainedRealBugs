<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:57:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-715] Thrift server built with ruby fails to return values of 0</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-715</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;A thrift server built with ruby does will only return nonzero values from the handler functions.&lt;/p&gt;

&lt;p&gt;In the following test case, when registerClient returns 0, the client throws an exception.  If register client returns a nonzero value, no exception is generated.  &lt;/p&gt;

&lt;p&gt;Test case:  &lt;/p&gt;

&lt;p&gt;file myservice.thrift:&lt;/p&gt;

&lt;p&gt;service MyService{&lt;br/&gt;
 bool registerClient(1:string email);  &lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;Create a server handler in ruby:&lt;/p&gt;

&lt;p&gt;file svr.rb:&lt;/p&gt;

&lt;p&gt;$:.push(&apos;./gen-rb&apos;)&lt;/p&gt;

&lt;p&gt;require &apos;thrift/transport/socket&apos;&lt;br/&gt;
require &apos;thrift/protocol/binaryprotocol&apos;&lt;br/&gt;
require &apos;thrift/server&apos;&lt;/p&gt;

&lt;p&gt;require &apos;MyService&apos;&lt;/p&gt;

&lt;p&gt;def class MyServiceHandler&lt;br/&gt;
    def registerClient ( email )&lt;br/&gt;
        return false # works for &apos;return true&apos;&lt;br/&gt;
    end&lt;br/&gt;
end&lt;/p&gt;

&lt;p&gt;handler = MyServiceHandler.new()&lt;br/&gt;
processor = MyService::Processor.new(handler)&lt;br/&gt;
transport = Thrift::ServerSocket.new( 9030 ) # client code&lt;/p&gt;

&lt;p&gt;server = Thrift::SimpleServer.new(processor, transport )&lt;/p&gt;

&lt;p&gt;puts &quot;Starting the MyService server...&quot;&lt;br/&gt;
server.serve()&lt;br/&gt;
puts &quot;Done&quot;&lt;/p&gt;

&lt;p&gt;Here&apos;s the client:&lt;/p&gt;

&lt;p&gt;file cl.rb:&lt;/p&gt;

&lt;p&gt;require &apos;gen-rb/MyService.rb&apos;&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;include Thrift&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    def run( )&lt;br/&gt;
        transport = Thrift::Socket.new( &quot;localhost&quot;, 9030, 10 ) &lt;br/&gt;
        transport.open&lt;br/&gt;
        protocol = Thrift::BinaryProtocol.new( transport )&lt;br/&gt;
        client = MyService::Client.new( protocol )&lt;br/&gt;
        puts &quot;MyService client created&quot;&lt;/p&gt;

&lt;p&gt;        begin&lt;br/&gt;
            retval = client.registerClient( &quot;email@host.com&quot; )&lt;br/&gt;
        rescue Exception =&amp;gt; e&lt;br/&gt;
             puts &quot;Exception caught during registerClient:&lt;br/&gt;
             puts e.message&lt;br/&gt;
        else&lt;br/&gt;
             puts &quot;registerClient returned = #&lt;/p&gt;
{retval}
&lt;p&gt;&quot;&lt;br/&gt;
        end&lt;br/&gt;
    end&lt;/p&gt;

&lt;p&gt;run()&lt;/p&gt;

&lt;p&gt;The following error is put out by the client: &lt;/p&gt;

&lt;p&gt;Exception caught during registerClient&lt;br/&gt;
registerClient failed: unknown result&lt;/p&gt;


&lt;p&gt;The problem appears in both thrift-instant-r760184.tar.gz (from facebook.com) and thrift-0.2.0-incubating.tar.gz from Apache.&lt;/p&gt;



&lt;p&gt;=========&lt;/p&gt;

&lt;p&gt;The offending code is in struct.rb, Struct.write:&lt;/p&gt;

&lt;p&gt;        if (value = instance_variable_get(&quot;@#&lt;/p&gt;
{name}&quot;))&lt;br/&gt;
&lt;br/&gt;
It appears to have been fixed in r915499 with the following code:&lt;br/&gt;
&lt;br/&gt;
        value = instance_variable_get(&quot;@#{name}
&lt;p&gt;&quot;)&lt;br/&gt;
        unless value.nil?&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux on x86_64&lt;/p&gt;</environment>
        <key id="12457365">THRIFT-715</key>
            <summary>Thrift server built with ruby fails to return values of 0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanduxbury">Bryan Duxbury</assignee>
                                    <reporter username="lkang">Larry Kang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Feb 2010 23:36:01 +0000</created>
                <updated>Sat, 27 Feb 2010 05:47:42 +0000</updated>
                            <resolved>Sat, 27 Feb 2010 05:47:42 +0000</resolved>
                                    <version>0.2</version>
                                    <fixVersion>0.3</fixVersion>
                                    <component>Ruby - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12838476" author="bryanduxbury" created="Thu, 25 Feb 2010 18:48:46 +0000"  >&lt;p&gt;Hey Larry, could I convince you to attach this as a patch and check the ASF license box?&lt;/p&gt;</comment>
                            <comment id="12839003" author="lkang" created="Fri, 26 Feb 2010 19:55:45 +0000"  >&lt;p&gt;Patch file for thrift/lib/rb/lib/thrift/struct.rb&lt;/p&gt;</comment>
                            <comment id="12839005" author="lkang" created="Fri, 26 Feb 2010 19:59:21 +0000"  >&lt;p&gt;        Rewrote test case to work with the latest thrift-instant-r916508&lt;/p&gt;

&lt;p&gt;        The test case passes with r916508&lt;/p&gt;

&lt;p&gt;        To run the server: ruby -rdebug -I&amp;lt;thrifloc&amp;gt;/thrift/lib/rb/lib -Igen-rb svr.rb&lt;br/&gt;
        To run the client: ruby -rdebug -I&amp;lt;thriftloc&amp;gt;/thrift/lib/rb/lib -Igen-rb cl.rb&lt;/p&gt;

&lt;p&gt;        files:&lt;br/&gt;
                svr.rb&lt;br/&gt;
                cl.rb&lt;br/&gt;
                myservice.thrift&lt;/p&gt;</comment>
                            <comment id="12839171" author="bryanduxbury" created="Sat, 27 Feb 2010 05:47:41 +0000"  >&lt;p&gt;I just committed a testcase. Thanks for bringing this to my attention, Larry!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12437234" name="THRIFT-715.patch" size="595" author="lkang" created="Fri, 26 Feb 2010 19:55:45 +0000"/>
                            <attachment id="12437236" name="cl.rb" size="513" author="lkang" created="Fri, 26 Feb 2010 19:59:21 +0000"/>
                            <attachment id="12437237" name="myservice.thrift" size="87" author="lkang" created="Fri, 26 Feb 2010 19:59:21 +0000"/>
                            <attachment id="12437235" name="svr.rb" size="783" author="lkang" created="Fri, 26 Feb 2010 19:59:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>186874</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 39 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16er3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245522</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>