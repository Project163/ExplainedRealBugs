<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:26:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-4042] ExtractionError when using accelerated thrift in a multiprocess test</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-4042</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;We recently switched to thrift 0.10.0 with accelerated protocols and started seeing ExtractionError being sporadically raised in tests that use the accelerated protocols (fastbinary module) and multiprocessing module.  Example traceback:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/lib64/python2.7/runpy.py&quot;&lt;/span&gt;, line 162, in _run_module_as_main
    &lt;span class=&quot;code-quote&quot;&gt;&quot;__main__&quot;&lt;/span&gt;, fname, loader, pkg_name)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/lib64/python2.7/runpy.py&quot;&lt;/span&gt;, line 72, in _run_code
    exec code in run_globals
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/thrift-4042/thrift4042.py&quot;&lt;/span&gt;, line 15, in &amp;lt;module&amp;gt;
    load_fastbinary()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/thrift-4042/thrift4042.py&quot;&lt;/span&gt;, line 9, in load_fastbinary
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; TCompactProtocolAccelerated(None, fallback=False)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;build/bdist.linux-x86_64/egg/thrift/protocol/TCompactProtocol.py&quot;&lt;/span&gt;, line 449, in __init__
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;build/bdist.linux-x86_64/egg/thrift/protocol/fastbinary.py&quot;&lt;/span&gt;, line 7, in &amp;lt;module&amp;gt;
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;build/bdist.linux-x86_64/egg/thrift/protocol/fastbinary.py&quot;&lt;/span&gt;, line 4, in __bootstrap__
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/lib/python2.7/site-packages/pkg_resources/__init__.py&quot;&lt;/span&gt;, line 1203, in resource_filename
    self, resource_name
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/lib/python2.7/site-packages/pkg_resources/__init__.py&quot;&lt;/span&gt;, line 1715, in get_resource_filename
    self._extract_resource(manager, self._eager_to_zip(name))
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/lib/python2.7/site-packages/pkg_resources/__init__.py&quot;&lt;/span&gt;, line 1745, in _extract_resource
    self.egg_name, self._parts(zip_path)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/lib/python2.7/site-packages/pkg_resources/__init__.py&quot;&lt;/span&gt;, line 1270, in get_cache_path
    self.extraction_error()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/lib/python2.7/site-packages/pkg_resources/__init__.py&quot;&lt;/span&gt;, line 1250, in extraction_error
    raise err
pkg_resources.ExtractionError: Can&apos;t extract file(s) to egg cache

The following error occurred &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; trying to extract file(s) to the Python egg
cache:

  [Errno 17] File exists: &lt;span class=&quot;code-quote&quot;&gt;&apos;/root/.cache/Python-Eggs&apos;&lt;/span&gt;

The Python egg cache directory is currently set to:

  /root/.cache/Python-Eggs

Perhaps your account does not have write access to &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; directory?  You can
change the cache directory by setting the PYTHON_EGG_CACHE environment
variable to point to an accessible directory.


&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There is a MWE using Docker at &lt;a href=&quot;https://github.com/cjmay/thrift-4042&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/cjmay/thrift-4042&lt;/a&gt; .  I reproduced the error on the first run, but you may need to try several runs to reproduce it as it is a race condition.&lt;/p&gt;

&lt;p&gt;This bug only happens when using the new accelerated protocol in thrift 0.10.0 and only happens when thrift has been installed as an egg.  When the accelerated protocol is used the fastbinary module is extracted from the installed thrift egg to the Python egg cache.  I believe the extraction of the module file itself is atomic (using the rename syscall) but the creation of its parent directory is non-atomic and sometimes results in an error if the fastbinary module is loaded simultaneously by several processes.  Note this only occurs the first time the module is loaded, as after that point the parent directory already exists.  (This is the justification for using Docker for the MWE.)&lt;/p&gt;

&lt;p&gt;I believe this is the same error as:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://dev.list.galaxyproject.org/python-egg-cache-exists-error-td4656276.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://dev.list.galaxyproject.org/python-egg-cache-exists-error-td4656276.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.georgevreilly.com/blog/2015/01/28/PythonEggCache.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.georgevreilly.com/blog/2015/01/28/PythonEggCache.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The documentation indicates we can prevent packaging the module into an egg by setting &lt;tt&gt;zip_safe&lt;/tt&gt; to &lt;tt&gt;False&lt;/tt&gt; in &lt;tt&gt;setup.py&lt;/tt&gt;:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://setuptools.readthedocs.io/en/latest/setuptools.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://setuptools.readthedocs.io/en/latest/setuptools.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I tried this in the repository linked above and it worked.  There are public builds demonstrating it: &lt;a href=&quot;https://travis-ci.org/cjmay/thrift-4042&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/cjmay/thrift-4042&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13038278">THRIFT-4042</key>
            <summary>ExtractionError when using accelerated thrift in a multiprocess test</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jking3">James E. King III</assignee>
                                    <reporter username="cjmay">Chandler May</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Jan 2017 21:50:41 +0000</created>
                <updated>Thu, 14 Dec 2017 13:56:12 +0000</updated>
                            <resolved>Sat, 28 Jan 2017 04:34:23 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.11.0</fixVersion>
                                    <component>Python - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15840532" author="cjmay" created="Thu, 26 Jan 2017 22:00:40 +0000"  >&lt;p&gt;Clarified that the bug occurs when thrift is installed via setuptools, as a dependency of our project---but not when thrift is installed beforehand via pip.&lt;/p&gt;</comment>
                            <comment id="15843432" author="cjmay" created="Fri, 27 Jan 2017 20:18:03 +0000"  >&lt;p&gt;Updated with minimal working example.&lt;/p&gt;</comment>
                            <comment id="15843532" author="githubbot" created="Fri, 27 Jan 2017 21:40:27 +0000"  >&lt;p&gt;GitHub user cjmay opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1165&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1165&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4042&quot; title=&quot;ExtractionError when using accelerated thrift in a multiprocess test&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4042&quot;&gt;&lt;del&gt;THRIFT-4042&lt;/del&gt;&lt;/a&gt; set zip_safe=False in python build to prevent egg ExtractionError&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/cjmay/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/cjmay/thrift&lt;/a&gt; thrift-4042&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1165.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1165.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1165&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 11ee1da2bb9e85990953a854181d106e73a0cadb&lt;br/&gt;
Author: Chandler May &amp;lt;cjmay4754@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-01-27T21:21:40Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4042&quot; title=&quot;ExtractionError when using accelerated thrift in a multiprocess test&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4042&quot;&gt;&lt;del&gt;THRIFT-4042&lt;/del&gt;&lt;/a&gt; set zip_safe=False in python build to prevent egg ExtractionError&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15843567" author="cjmay" created="Fri, 27 Jan 2017 22:13:00 +0000"  >&lt;p&gt;I updated the description: setting &lt;tt&gt;zip_safe=False&lt;/tt&gt; in &lt;tt&gt;setup()&lt;/tt&gt; does fix the issue.&lt;/p&gt;</comment>
                            <comment id="15843836" author="githubbot" created="Sat, 28 Jan 2017 04:34:26 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1165&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1165&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15843844" author="githubbot" created="Sat, 28 Jan 2017 04:44:58 +0000"  >&lt;p&gt;Github user cjmay commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1165&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1165&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thank you!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 42 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i399rz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>