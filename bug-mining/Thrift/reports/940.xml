<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:12:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-2463] test/py/RunClientServer.py fails sometimes</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-2463</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;This test is flaky in our CI system and the flakiness is also visible on Jenkins (see examples of failed builds &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/thrift-dev/201309.mbox/%3C1012268498.737.1378727603714.JavaMail.hudson@aegis%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and &lt;a href=&quot;https://www.mail-archive.com/dev@thrift.apache.org/msg10124.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;All the test cases of &lt;tt&gt;AcceleratedBinaryTest&lt;/tt&gt; fail with this signature:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;======================================================================
ERROR: testByte (__main__.AcceleratedBinaryTest)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;./TestClient.py&quot;&lt;/span&gt;, line 85, in setUp
    self.transport.open()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;./../../lib/py/build/lib.linux-i686-2.7/thrift/transport/TTransport.py&quot;&lt;/span&gt;, line 149, in open
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self.__trans.open()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;./../../lib/py/build/lib.linux-i686-2.7/thrift/transport/TSocket.py&quot;&lt;/span&gt;, line 99, in open
    message=message)
TTransportException: Could not connect to localhost:9090
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12708118">THRIFT-2463</key>
            <summary>test/py/RunClientServer.py fails sometimes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roger">Roger Meier</assignee>
                                    <reporter username="tsuna">Benoit Sigoure</reporter>
                        <labels>
                    </labels>
                <created>Sun, 13 Apr 2014 04:08:10 +0000</created>
                <updated>Sun, 6 Jul 2014 04:00:59 +0000</updated>
                            <resolved>Mon, 21 Apr 2014 19:24:16 +0000</resolved>
                                    <version>0.9.1</version>
                                    <fixVersion>0.9.2</fixVersion>
                                    <component>Python - Library</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13967739" author="tsuna" created="Sun, 13 Apr 2014 05:19:12 +0000"  >&lt;p&gt;I&apos;m wondering whether this could be caused by a spurious SIGALRM timeout, because &lt;tt&gt;TestServer.py&lt;/tt&gt; arms the alarm for only 2 seconds and it&apos;s possible that if the machine was under heavy load, it would take more than 2 seconds for &lt;tt&gt;TestServer.py&lt;/tt&gt; to start accepting connections.&lt;/p&gt;

&lt;p&gt;Excerpt from the code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;elif server_type == &lt;span class=&quot;code-quote&quot;&gt;&quot;TProcessPoolServer&quot;&lt;/span&gt;:
  &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; signal
  from thrift.server &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; TProcessPoolServer
  server = TProcessPoolServer.TProcessPoolServer(processor, transport, tfactory, pfactory)
  server.setNumWorkers(5)
  def set_alarm():
    def clean_shutdown(signum, frame):
      print &lt;span class=&quot;code-quote&quot;&gt;&quot;SIGALRM: Shutting down server&quot;&lt;/span&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; worker in server.workers:
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; options.verbose &amp;gt; 0:
          print &lt;span class=&quot;code-quote&quot;&gt;&apos;Terminating worker: %s&apos;&lt;/span&gt; % worker                                                 
        worker.terminate()
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; options.verbose &amp;gt; 0:
        print &lt;span class=&quot;code-quote&quot;&gt;&apos;Requesting server to stop()&apos;&lt;/span&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;:       
        server.stop()
      except:
        pass
    signal.signal(signal.SIGALRM, clean_shutdown)
    signal.alarm(2)
  set_alarm()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m sure why the alarm is even armed here, and why so aggressively.  This was added in &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1094&quot; title=&quot;bug in TCompactProto python readMessageEnd method and updated test cases&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1094&quot;&gt;&lt;del&gt;THRIFT-1094&lt;/del&gt;&lt;/a&gt; by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bryanduxbury&quot; class=&quot;user-hover&quot; rel=&quot;bryanduxbury&quot;&gt;bryanduxbury&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13967768" author="henrique" created="Sun, 13 Apr 2014 09:29:04 +0000"  >&lt;p&gt;Hi Benoit,&lt;/p&gt;

&lt;p&gt;Thanks for having a look on it. That&apos;s something we really need to fix. If you have a patch please attach here so everyone can review it.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
Henrique&lt;/p&gt;</comment>
                            <comment id="13967772" author="tsuna" created="Sun, 13 Apr 2014 09:53:46 +0000"  >&lt;p&gt;I may have a patch, I added some debugging and I don&apos;t see us tripping on the &lt;tt&gt;SIGALRM&lt;/tt&gt; (event though it still looks fishy to me).  There are some interlock issues in &lt;tt&gt;RunClientServer.py&lt;/tt&gt; that I&apos;m fixing to see if that indeed stops the flakiness of my CI system.&lt;/p&gt;</comment>
                            <comment id="13967773" author="tsuna" created="Sun, 13 Apr 2014 09:58:16 +0000"  >&lt;p&gt;Maybe the problem is completely different than what I thought.  I just saw this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Test run #2:  (includes gen-py-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) Server=TSimpleServer,  Proto=accel,  zlib=False,  SSL=True
Testing server TSimpleServer: /usr/bin/python ./TestServer.py --genpydir=gen-py-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; --proto=accel --port=9090 --ssl TSimpleServer
Testing client: /usr/bin/python ./TestClient.py --genpydir=gen-py-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; --proto=accel --port=9090 --ssl
ERROR:root:&lt;span class=&quot;code-quote&quot;&gt;&apos;NoneType&apos;&lt;/span&gt; object has no attribute &lt;span class=&quot;code-quote&quot;&gt;&apos;read&apos;&lt;/span&gt;
Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;./../../lib/py/build/lib.linux-i686-2.7/thrift/server/TServer.py&quot;&lt;/span&gt;, line 84, in serve
    self.processor.process(iprot, oprot)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;gen-py-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/ThriftTest/ThriftTest.py&quot;&lt;/span&gt;, line 995, in process
    (name, type, seqid) = iprot.readMessageBegin()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;./../../lib/py/build/lib.linux-i686-2.7/thrift/protocol/TBinaryProtocol.py&quot;&lt;/span&gt;, line 126, in readMessageBegin
    sz = self.readI32()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;./../../lib/py/build/lib.linux-i686-2.7/thrift/protocol/TBinaryProtocol.py&quot;&lt;/span&gt;, line 206, in readI32
    buff = self.trans.readAll(4)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;./../../lib/py/build/lib.linux-i686-2.7/thrift/transport/TTransport.py&quot;&lt;/span&gt;, line 58, in readAll
    chunk = self.read(sz - have)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;./../../lib/py/build/lib.linux-i686-2.7/thrift/transport/TTransport.py&quot;&lt;/span&gt;, line 159, in read
    self.__rbuf = StringIO(self.__trans.read(max(sz, self.__rbuf_size)))
AttributeError: &lt;span class=&quot;code-quote&quot;&gt;&apos;NoneType&apos;&lt;/span&gt; object has no attribute &lt;span class=&quot;code-quote&quot;&gt;&apos;read&apos;&lt;/span&gt;
Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;./TestServer.py&quot;&lt;/span&gt;, line 243, in &amp;lt;module&amp;gt;
    server.serve()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;./../../lib/py/build/lib.linux-i686-2.7/thrift/server/TServer.py&quot;&lt;/span&gt;, line 90, in serve
    itrans.close()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;./../../lib/py/build/lib.linux-i686-2.7/thrift/transport/TTransport.py&quot;&lt;/span&gt;, line 152, in close
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self.__trans.close()
AttributeError: &lt;span class=&quot;code-quote&quot;&gt;&apos;NoneType&apos;&lt;/span&gt; object has no attribute &lt;span class=&quot;code-quote&quot;&gt;&apos;close&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I haven&apos;t modified anything that could be causing this.  Weird.&lt;/p&gt;</comment>
                            <comment id="13967778" author="tsuna" created="Sun, 13 Apr 2014 10:12:52 +0000"  >&lt;p&gt;Ah OK, while trying to fix this bug, I tripped on another bug, namely that opening and closing a connection to a thrift server that uses SSL without actually performing an SSL handshake triggers the above &lt;tt&gt;AttributeError&lt;/tt&gt; due to lack of error checking in &lt;tt&gt;TSimpleServer&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="13968021" author="tsuna" created="Mon, 14 Apr 2014 02:20:40 +0000"  >&lt;p&gt;I think my fix works, I filed a separate issue for the lack of error checking in the &lt;tt&gt;TServer&lt;/tt&gt; implementations (it&apos;s not just &lt;tt&gt;TSimpleServer&lt;/tt&gt;): &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2466&quot; title=&quot;Improper error handling for SSL/TLS connections that don&amp;#39;t complete a handshake&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2466&quot;&gt;&lt;del&gt;THRIFT-2466&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13968024" author="tsuna" created="Mon, 14 Apr 2014 02:29:26 +0000"  >&lt;p&gt;Patch that I believe fixes the issue.  Need the patch of &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2466&quot; title=&quot;Improper error handling for SSL/TLS connections that don&amp;#39;t complete a handshake&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2466&quot;&gt;&lt;del&gt;THRIFT-2466&lt;/del&gt;&lt;/a&gt; first, otherwise this patch will cause the test to run into that bug.&lt;/p&gt;</comment>
                            <comment id="13975927" author="roger.meier" created="Mon, 21 Apr 2014 19:24:16 +0000"  >&lt;p&gt;Hi Benoit&lt;br/&gt;
looks good!&lt;br/&gt;
committed&lt;br/&gt;
;-r&lt;/p&gt;</comment>
                            <comment id="13976097" author="hudson" created="Mon, 21 Apr 2014 21:56:19 +0000"  >&lt;p&gt;FAILURE: Integrated in Thrift #1138 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/1138/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/1138/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2463&quot; title=&quot;test/py/RunClientServer.py fails sometimes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2463&quot;&gt;&lt;del&gt;THRIFT-2463&lt;/del&gt;&lt;/a&gt; test/py/RunClientServer.py fails sometimes (roger: rev 9b328531122ae241ed52622b9356014fd8aa8a6a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;test/py/RunClientServer.py&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12708177">THRIFT-2466</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12640007" name="THRIFT-2463-Fix-a-timing-bug-by-properly-waiting-for-the-server.patch" size="3327" author="tsuna" created="Mon, 14 Apr 2014 02:29:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386441</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 31 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1uklj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386705</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>