<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:29:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-4671] c glib is unable to handle client close unexpectedly</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-4671</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;When using c_glib thrift server. Once a client connects to the server &lt;b&gt;but does nothing (didn&apos;t send data to server) when being connected&lt;/b&gt;. If the client closed unexpectedly(such as being killed) at the moment, &lt;b&gt;the thrift-work thread for that client wont&apos;t be closed&lt;/b&gt; and read the closed client sock fd in the server forever.&lt;/p&gt;

&lt;p&gt;*I*t has been fixed in my branch, and will be tested and committed later if it runs well.&lt;/p&gt;</description>
                <environment>&lt;p&gt;ubuntu 16.04&#160;&lt;/p&gt;

&lt;p&gt;thrift sever: c_glib&lt;/p&gt;

&lt;p&gt;thrift client: c_glib, go&lt;/p&gt;</environment>
        <key id="13200105">THRIFT-4671</key>
            <summary>c glib is unable to handle client close unexpectedly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jking3">James E. King III</assignee>
                                    <reporter username="lixiasong">lixiasong</reporter>
                        <labels>
                            <label>easyfix</label>
                            <label>ready-to-commit</label>
                    </labels>
                <created>Thu, 22 Nov 2018 15:28:36 +0000</created>
                <updated>Thu, 27 Dec 2018 15:25:14 +0000</updated>
                            <resolved>Fri, 23 Nov 2018 21:53:39 +0000</resolved>
                                    <version>0.11.0</version>
                                    <fixVersion>0.12.0</fixVersion>
                                    <component>C glib - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="16696306" author="githubbot" created="Fri, 23 Nov 2018 01:25:07 +0000"  >&lt;p&gt;BoringKen opened a new pull request #1635: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4671&quot; title=&quot;c glib is unable to handle client close unexpectedly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4671&quot;&gt;&lt;del&gt;THRIFT-4671&lt;/del&gt;&lt;/a&gt;: handle client&apos;s unexpected close.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1635&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1635&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   THRIFT-9999: handle client&apos;s unexpected close. Avoid the server work thread falling into dead loop.&lt;br/&gt;
   Client: c_glib&lt;/p&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16696307" author="lixiasong" created="Fri, 23 Nov 2018 01:26:27 +0000"  >&lt;p&gt;1. fixed the function return result from INT32 coverts to UINT32 ;&lt;br/&gt;
2. fixed the condition in line 482 &quot;ftype == T_STOP&quot; will never be satisfied when the client socket closed before sending data to server.&lt;/p&gt;</comment>
                            <comment id="16697529" author="githubbot" created="Fri, 23 Nov 2018 21:53:28 +0000"  >&lt;p&gt;jeking3 closed pull request #1635: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4671&quot; title=&quot;c glib is unable to handle client close unexpectedly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4671&quot;&gt;&lt;del&gt;THRIFT-4671&lt;/del&gt;&lt;/a&gt;: handle client&apos;s unexpected close.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1635&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1635&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/lib/c_glib/src/thrift/c_glib/protocol/thrift_protocol.c b/lib/c_glib/src/thrift/c_glib/protocol/thrift_protocol.c&lt;br/&gt;
index 1433725759..8296a8cad1 100644&lt;br/&gt;
&amp;#8212; a/lib/c_glib/src/thrift/c_glib/protocol/thrift_protocol.c&lt;br/&gt;
+++ b/lib/c_glib/src/thrift/c_glib/protocol/thrift_protocol.c&lt;br/&gt;
@@ -465,7 +465,7 @@ thrift_protocol_skip (ThriftProtocol *protocol, ThriftType type, GError **error)&lt;br/&gt;
       }&lt;br/&gt;
     case T_STRUCT:&lt;br/&gt;
       {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;guint32 result = 0;&lt;br/&gt;
+        gint32 result = 0;&lt;br/&gt;
         gchar *name;&lt;br/&gt;
         gint16 fid;&lt;br/&gt;
         ThriftType ftype;&lt;br/&gt;
@@ -475,6 +475,10 @@ thrift_protocol_skip (ThriftProtocol *protocol, ThriftType type, GError **error)&lt;br/&gt;
         {&lt;br/&gt;
           result += thrift_protocol_read_field_begin (protocol, &amp;amp;name, &amp;amp;ftype,&lt;br/&gt;
                                                       &amp;amp;fid, error);&lt;br/&gt;
+          if (result &amp;lt; 0)&lt;br/&gt;
+          
{
+            return result;  
+          }
&lt;p&gt;           if (ftype == T_STOP)&lt;/p&gt;
           {
             break;
@@ -487,7 +491,7 @@ thrift_protocol_skip (ThriftProtocol *protocol, ThriftType type, GError **error)
       }
&lt;p&gt;     case T_SET:&lt;/p&gt;
       {
-        guint32 result = 0;
+        gint32 result = 0;
         ThriftType elem_type;
         guint32 i, size;
         result += thrift_protocol_read_set_begin (protocol, &amp;amp;elem_type, &amp;amp;size,
@@ -501,7 +505,7 @@ thrift_protocol_skip (ThriftProtocol *protocol, ThriftType type, GError **error)
       }
&lt;p&gt;     case T_MAP:&lt;/p&gt;
       {
-        guint32 result = 0;
+        gint32 result = 0;
         ThriftType elem_type;
         ThriftType key_type;
         guint32 i, size;
@@ -517,7 +521,7 @@ thrift_protocol_skip (ThriftProtocol *protocol, ThriftType type, GError **error)
       }
&lt;p&gt;     case T_LIST:&lt;br/&gt;
       {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;guint32 result = 0;&lt;br/&gt;
+        gint32 result = 0;&lt;br/&gt;
         ThriftType elem_type;&lt;br/&gt;
         guint32 i, size;&lt;br/&gt;
         result += thrift_protocol_read_list_begin (protocol, &amp;amp;elem_type, &amp;amp;size,&lt;/li&gt;
&lt;/ul&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16697530" author="jking3" created="Fri, 23 Nov 2018 21:53:39 +0000"  >&lt;p&gt;Committed - thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 51 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s00s7c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>