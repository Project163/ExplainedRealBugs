<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:27:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-4263] Fix use after free bug for thrown exceptions</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-4263</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;Fix use after free bug for thrown exceptions&lt;/p&gt;

&lt;p&gt;Exceptions thrown through PHPExceptionWrapper are prematurely freed at&lt;br/&gt;
the end of the catch block, even though zend_throw_exception_object&lt;br/&gt;
expects to take ownership of the value.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Verified both on Debian unstable and Centos 7 under valgrind&lt;/p&gt;</environment>
        <key id="13090245">THRIFT-4263</key>
            <summary>Fix use after free bug for thrown exceptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jking3">James E. King III</assignee>
                                    <reporter username="Rockj">Roy Sindre Norangshol</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Jul 2017 15:54:18 +0000</created>
                <updated>Thu, 14 Dec 2017 13:55:52 +0000</updated>
                            <resolved>Sun, 13 Aug 2017 03:13:22 +0000</resolved>
                                    <version>0.10.0</version>
                    <version>0.11.0</version>
                                    <fixVersion>0.11.0</fixVersion>
                                    <component>PHP - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16101879" author="githubbot" created="Wed, 26 Jul 2017 16:25:51 +0000"  >&lt;p&gt;GitHub user norrs opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1314&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1314&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4263&quot; title=&quot;Fix use after free bug for thrown exceptions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4263&quot;&gt;&lt;del&gt;THRIFT-4263&lt;/del&gt;&lt;/a&gt;: Fix use after free bug for thrown exceptions&lt;/p&gt;

&lt;p&gt;    Exceptions thrown through PHPExceptionWrapper are prematurely freed at the end&lt;br/&gt;
    of the catch block, even though zend_throw_exception_object expects to take&lt;br/&gt;
    ownership of the value.&lt;/p&gt;

&lt;p&gt;    Ensure we free return_value in case of exceptions&lt;/p&gt;

&lt;p&gt;    Test binary deserialization of insufficient data which verifies we can cast&lt;br/&gt;
    exception to string to verify against memory corruption when transport casts&lt;br/&gt;
    exceptions.&lt;/p&gt;

&lt;p&gt;    Patch: H&#229;kon Hitland &amp;lt;hakon.hitland@zedge.net&amp;gt;&lt;br/&gt;
    Patch: Roy Sindre Norangshol &amp;lt;norangshol@zedge.net&amp;gt;&lt;/p&gt;

&lt;p&gt;    This closes #4263&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/norrs/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/norrs/thrift&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4263&quot; title=&quot;Fix use after free bug for thrown exceptions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4263&quot;&gt;&lt;del&gt;THRIFT-4263&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1314.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1314.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1314&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 7e64cc664170999e8224c7df4a689efebc55aea5&lt;br/&gt;
Author: Roy Sindre Norangshol &amp;lt;norangshol@zedge.net&amp;gt;&lt;br/&gt;
Date:   2017-07-26T16:19:38Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4263&quot; title=&quot;Fix use after free bug for thrown exceptions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4263&quot;&gt;&lt;del&gt;THRIFT-4263&lt;/del&gt;&lt;/a&gt;: Test case for &apos;Fix use after free bug for thrown exceptions&apos;&lt;/p&gt;

&lt;p&gt;    Test binary deserialization of insufficient data which verifies we can cast&lt;br/&gt;
    exception to string to verify against memory corruption when transport casts&lt;br/&gt;
    exceptions.&lt;/p&gt;

&lt;p&gt;    Patch: H&#229;kon Hitland &amp;lt;hakon.hitland@zedge.net&amp;gt;&lt;br/&gt;
    Patch: Roy Sindre Norangshol &amp;lt;norangshol@zedge.net&amp;gt;&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16102123" author="githubbot" created="Wed, 26 Jul 2017 19:02:55 +0000"  >&lt;p&gt;Github user norrs commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1314&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1314&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Side story:&lt;/p&gt;

&lt;p&gt;    Ok, I was hoping travis would run the cross compile tests with php7, but sadly it doesn&apos;t. As I was hoping the build would fail with the test case before submitting, as this is what we&apos;ve used for testing it under valgrind.&lt;/p&gt;


&lt;p&gt;    Currently cross compile builds runs with ubuntu 1404 trusty. For thrift as a project you might consider trying to maybe bump this dependency, as maintenance updates for 1404 is more or less going away this year according to &lt;a href=&quot;https://www.ubuntu.com/info/release-end-of-life&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.ubuntu.com/info/release-end-of-life&lt;/a&gt; . &lt;/p&gt;

&lt;p&gt;    You will also need min 1604 for php7 packages. Sadly the test suite really doesn&apos;t run with newer versions, at least python tests seems to start failing. Another problem is the system tests with (cross-compile) doesn&apos;t use cmake yet, which seems to have an idea about being able to select which libraries you want to include in the build. &lt;/p&gt;

&lt;p&gt;    Also note that PHP5 != PHP7 , and you probably want to focus new development towards PHP7. &lt;a href=&quot;http://php.net/supported-versions.php&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://php.net/supported-versions.php&lt;/a&gt; . &lt;/p&gt;

&lt;p&gt;    Ideally CI should maybe build with latest distros where developers hang and live &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;    Anyhow, me and @zhaakhi rolled out this in production for our systems and haven&apos;t noticed any segfaults since we deployed it 24 hours ago. But we did revert &lt;a href=&quot;https://github.com/apache/thrift/pull/1215&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1215&lt;/a&gt; in our fork that we have deployed, since we noticed memory leaks from it. Unsure if it was due to me  not ensuring newer thrift compiler under testing, but didn&apos;t want to risk it. I&apos;ve also left a note about it in &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4126&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/THRIFT-4126&lt;/a&gt; . &lt;/p&gt;</comment>
                            <comment id="16102873" author="githubbot" created="Thu, 27 Jul 2017 07:43:19 +0000"  >&lt;p&gt;Github user norrs commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1314&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1314&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Test failures seems unrelated, how do we retrigger em to be run again? &lt;/p&gt;</comment>
                            <comment id="16123842" author="jking3" created="Fri, 11 Aug 2017 18:52:03 +0000"  >&lt;p&gt;Updating the distro used in the build process is a good idea.  We want coverage for some older environments however so we&apos;ll have to use a mixture of both.  That deserves a separate story, however.  For this one, I was looking for documentation on zend_throw_exception_object and its requirements to verify your ownership assertions in the description however I could not find it?&lt;/p&gt;</comment>
                            <comment id="16124781" author="githubbot" created="Sun, 13 Aug 2017 03:13:25 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1314&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1314&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 14 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3i1kv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>