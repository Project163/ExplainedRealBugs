<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:29:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-4564] TBufferedTransport can leave corrupt data in the buffer</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-4564</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;I ran into the following issue on Thrift 0.10.0 using Buffered Transport and Binary Protocol&lt;/p&gt;

&lt;p&gt;IDL File:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
struct Foo {
1: string name
}

service SocketTestService {
i16 countFoos(1: list&amp;lt;Foo&amp;gt; foos)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Client Call:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
async function main() {
numFoos = await client.countFoos([
&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; thriftTypes.Foo(),
&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; thriftTypes.Foo(),
]);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The issue I ran into was a client-side thrown exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
TypeError: Cannot read property &lt;span class=&quot;code-quote&quot;&gt;&apos;write&apos;&lt;/span&gt; of &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
at SocketTestService_countFoos_args.write (/Users/bforbis/git/bforbis/thrift-socket-test/gen10/SocketTestService.js:81:15)
at exports.Client.SocketTestServiceClient.send_countFoos (/Users/bforbis/git/bforbis/thrift-socket-test/gen10/SocketTestService.js:178:8)
at exports.Client.SocketTestServiceClient.countFoos (/Users/bforbis/git/bforbis/thrift-socket-test/gen10/SocketTestService.js:165:10)
at main (/Users/bforbis/git/bforbis/thrift-socket-test/client.js:110:28)
at &amp;lt;anonymous&amp;gt;
at process._tickCallback (internal/process/next_tick.js:188:7)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The cause of the issue is because I pass in &lt;b&gt;null&lt;/b&gt;&#160;as a parameter to my Foo list, which does not have a write() method to serialize itself when writing to the buffer. That&apos;s okay on its own, but what ends up happening here is we have &lt;b&gt;half&lt;/b&gt; of a message still written to our buffered transport, meaning that a subsequent RPC call on that same transport will fail to be processed on the server side.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Error: Invalid type: -128
at TBinaryProtocol.skip (/Users/bforbis/git/bforbis/thrift-socket-test/node_modules/thrift/lib/nodejs/lib/thrift/binary_protocol.js:364:13)
at module.exports.Foo.Foo.read (/Users/bforbis/git/bforbis/thrift-socket-test/gen11/socket-test_types.js:47:15)
at SocketTestService_countFoos_args.read (/Users/bforbis/git/bforbis/thrift-socket-test/gen11/SocketTestService.js:51:17)
at exports.Processor.SocketTestServiceProcessor.process_countFoos (/Users/bforbis/git/bforbis/thrift-socket-test/gen11/SocketTestService.js:224:8)
at exports.Processor.SocketTestServiceProcessor.process (/Users/bforbis/git/bforbis/thrift-socket-test/gen11/SocketTestService.js:210:39)
at /Users/bforbis/git/bforbis/thrift-socket-test/node_modules/thrift/lib/nodejs/lib/thrift/server.js:55:21
at Socket.&amp;lt;anonymous&amp;gt; (/Users/bforbis/git/bforbis/thrift-socket-test/node_modules/thrift/lib/nodejs/lib/thrift/buffered_transport.js:48:5)
at emitOne (events.js:121:20)
at Socket.emit (events.js:211:7)
at addChunk (_stream_readable.js:263:12)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;Proposal&lt;/b&gt;: We should allow applications to have global persistent socket connections that don&apos;t corrupt&#160;their buffer if there is a serialization error when doing an RPC all on the client. Calls to send_${RPC_NAME} should be wrapped in a try / catch in case there are client side errors in the processing code. In the case that an exception is thrown, the buffer in buffered transport should be emptied rather than leaving it full.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Side Note&lt;/b&gt;:&#160;The cause of the client-side exception has been fixed in Thrift 0.11.0 in this &lt;a href=&quot;https://github.com/apache/thrift/commit/de112fbb0d7f2139ef107211e82e03b574f890d0#diff-a686530169a8a14044fae0f95d54578c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Pull Request&lt;/a&gt;, which casts undef to a new struct. But I fear that this issue where hanging data on the buffered transport isn&apos;t cleaned up could come up again.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13157248">THRIFT-4564</key>
            <summary>TBufferedTransport can leave corrupt data in the buffer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jking3">James E. King III</assignee>
                                    <reporter username="bforbis">Brian Forbis</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 May 2018 16:38:09 +0000</created>
                <updated>Thu, 27 Dec 2018 15:24:51 +0000</updated>
                            <resolved>Fri, 22 Jun 2018 00:48:25 +0000</resolved>
                                    <version>0.10.0</version>
                    <version>0.11.0</version>
                                    <fixVersion>0.12.0</fixVersion>
                                    <component>Node.js - Compiler</component>
                    <component>Node.js - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16464117" author="bforbis" created="Fri, 4 May 2018 16:41:45 +0000"  >&lt;p&gt;This may affect other languages as well, and I also don&apos;t know how this behaves with very large messages. Another thing I noticed is that subsequent RPC requests using JSONProtocol do NOT have an issue. I am not sure why yet.&lt;/p&gt;</comment>
                            <comment id="16492138" author="githubbot" created="Sun, 27 May 2018 20:01:17 +0000"  >&lt;p&gt;bforbis opened a new pull request #1558: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4564&quot; title=&quot;TBufferedTransport can leave corrupt data in the buffer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4564&quot;&gt;&lt;del&gt;THRIFT-4564&lt;/del&gt;&lt;/a&gt;: Reset buffered transport on serialization errors&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1558&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1558&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Tested locally using the following thrift IDL on thrift v0.10.0&lt;br/&gt;
   ```&lt;br/&gt;
   struct Foo &lt;/p&gt;
{
     1: string name
   }

&lt;p&gt;   service SocketTestService &lt;/p&gt;
{
     i16 countFoos(1: list&amp;lt;Foo&amp;gt; foos)
   }
&lt;p&gt;   ```&lt;/p&gt;

&lt;p&gt;   The following client request will fail on the client side, but leave data on the buffer:&lt;br/&gt;
   ```&lt;br/&gt;
   client.countFoos(&lt;span class=&quot;error&quot;&gt;&amp;#91;new thriftTypes.Foo(), null, new thriftTypes.Foo()&amp;#93;&lt;/span&gt;);&lt;br/&gt;
   ```&lt;/p&gt;

&lt;p&gt;   Using the new code, the client side error will be caught and the buffered transport will be reset, allowing for the socket to be used for a subsequent RPC call without causing a parse error on the server side&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16515115" author="githubbot" created="Sun, 17 Jun 2018 15:54:53 +0000"  >&lt;p&gt;bforbis commented on issue #1558: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4564&quot; title=&quot;TBufferedTransport can leave corrupt data in the buffer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4564&quot;&gt;&lt;del&gt;THRIFT-4564&lt;/del&gt;&lt;/a&gt;: Reset buffered transport on serialization errors&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1558#issuecomment-397888034&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1558#issuecomment-397888034&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   I don&apos;t think we have a danger with this. The underlying net socket will not get reset, just the wrapping buffered transport. Calling `reset()` on the buffered_transport instance that is responsible for writing will only throw out its internal outBuffers in this case, which will only have up to 1 message at a time before flushing it to the net socket (flush is called at the end of send_Foo RPC call in the generated service module). Since this try/catch is catching serialization errors to the outBuffers, the only thing that would ever be thrown out is this corrupt half-message in the transports outBuffer, which we won&apos;t need anymore since serialization has failed.&lt;/p&gt;

&lt;p&gt;   Node will only serialize and send one message at a time, since constructing the message into the outbuffer and flushing to the socket is done synchronously. Reading is done by an entirely different instance of buffered_transport, so resetting the transport responsible for writing will have no affect on receiving messages.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16515117" author="githubbot" created="Sun, 17 Jun 2018 16:06:57 +0000"  >&lt;p&gt;bforbis commented on issue #1558: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4564&quot; title=&quot;TBufferedTransport can leave corrupt data in the buffer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4564&quot;&gt;&lt;del&gt;THRIFT-4564&lt;/del&gt;&lt;/a&gt;: Reset buffered transport on serialization errors&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1558#issuecomment-397888878&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1558#issuecomment-397888878&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   I think some of the confusion might be around which internal state variables are actually used by the outbound portion of the buffered_transport.&lt;/p&gt;

&lt;p&gt;   Writing to a buffered transport only uses `this.outBuffers` and `this.outCount`. The rest of the internal state variables like `readCursor` and `writeCursor` are used for reading inbound data, and are done by a different instance of the buffered transport class. It&apos;s kind of confusing, because you would think `writeCursor` would be used for sending data, but it is actually used for copying data from the inbound stream to the `inBuf` buffer object.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16515122" author="githubbot" created="Sun, 17 Jun 2018 16:20:39 +0000"  >&lt;p&gt;jeking3 commented on issue #1558: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4564&quot; title=&quot;TBufferedTransport can leave corrupt data in the buffer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4564&quot;&gt;&lt;del&gt;THRIFT-4564&lt;/del&gt;&lt;/a&gt;: Reset buffered transport on serialization errors&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1558#issuecomment-397889804&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1558#issuecomment-397889804&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Okay, thanks, I&apos;m going to rebase it on the current master for you to kick another build.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16519876" author="githubbot" created="Fri, 22 Jun 2018 00:48:19 +0000"  >&lt;p&gt;jeking3 closed pull request #1558: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4564&quot; title=&quot;TBufferedTransport can leave corrupt data in the buffer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4564&quot;&gt;&lt;del&gt;THRIFT-4564&lt;/del&gt;&lt;/a&gt;: Reset buffered transport on serialization errors&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1558&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1558&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/compiler/cpp/src/thrift/generate/t_js_generator.cc b/compiler/cpp/src/thrift/generate/t_js_generator.cc&lt;br/&gt;
index 6f73c1c352..512fe3c1ff 100644&lt;br/&gt;
&amp;#8212; a/compiler/cpp/src/thrift/generate/t_js_generator.cc&lt;br/&gt;
+++ b/compiler/cpp/src/thrift/generate/t_js_generator.cc&lt;br/&gt;
@@ -1529,16 +1529,7 @@ void t_js_generator::generate_service_client(t_service* tservice) {&lt;/p&gt;

&lt;p&gt;     std::string messageType = (*f_iter)-&amp;gt;is_oneway() ? &quot;Thrift.MessageType.ONEWAY&quot;&lt;br/&gt;
                                                      : &quot;Thrift.MessageType.CALL&quot;;&lt;br/&gt;
-&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Serialize the request header&lt;/li&gt;
	&lt;li&gt;if (gen_node_) 
{
-      f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; outputVar &amp;lt;&amp;lt; &quot;.writeMessageBegin(&apos;&quot; &amp;lt;&amp;lt; (*f_iter)-&amp;gt;get_name()
-                 &amp;lt;&amp;lt; &quot;&apos;, &quot; &amp;lt;&amp;lt; messageType &amp;lt;&amp;lt; &quot;, this.seqid());&quot; &amp;lt;&amp;lt; endl;
-    }
&lt;p&gt; else &lt;/p&gt;
{
-      f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; outputVar &amp;lt;&amp;lt; &quot;.writeMessageBegin(&apos;&quot; &amp;lt;&amp;lt; (*f_iter)-&amp;gt;get_name()
-                 &amp;lt;&amp;lt; &quot;&apos;, &quot; &amp;lt;&amp;lt; messageType &amp;lt;&amp;lt; &quot;, this.seqid);&quot; &amp;lt;&amp;lt; endl;
-    }
&lt;p&gt;-&lt;br/&gt;
+    // Build args&lt;br/&gt;
     if (fields.size() &amp;gt; 0){&lt;br/&gt;
       f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; &quot;var params = {&quot; &amp;lt;&amp;lt; endl;&lt;br/&gt;
       for (fld_iter = fields.begin(); fld_iter != fields.end(); ++fld_iter) {&lt;br/&gt;
@@ -1555,6 +1546,20 @@ void t_js_generator::generate_service_client(t_service* tservice) &lt;/p&gt;
{
       f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; &quot;var args = new &quot; &amp;lt;&amp;lt; argsname &amp;lt;&amp;lt; &quot;();&quot; &amp;lt;&amp;lt; endl;
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+&lt;br/&gt;
+    // Serialize the request header within try/catch&lt;br/&gt;
+    f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; &quot;try {&quot; &amp;lt;&amp;lt; endl;&lt;br/&gt;
+    indent_up();&lt;br/&gt;
+&lt;br/&gt;
+    if (gen_node_) &lt;/p&gt;
{
+      f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; outputVar &amp;lt;&amp;lt; &quot;.writeMessageBegin(&apos;&quot; &amp;lt;&amp;lt; (*f_iter)-&amp;gt;get_name()
+                 &amp;lt;&amp;lt; &quot;&apos;, &quot; &amp;lt;&amp;lt; messageType &amp;lt;&amp;lt; &quot;, this.seqid());&quot; &amp;lt;&amp;lt; endl;
+    }
&lt;p&gt; else &lt;/p&gt;
{
+      f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; outputVar &amp;lt;&amp;lt; &quot;.writeMessageBegin(&apos;&quot; &amp;lt;&amp;lt; (*f_iter)-&amp;gt;get_name()
+                 &amp;lt;&amp;lt; &quot;&apos;, &quot; &amp;lt;&amp;lt; messageType &amp;lt;&amp;lt; &quot;, this.seqid);&quot; &amp;lt;&amp;lt; endl;
+    }
&lt;p&gt;+&lt;br/&gt;
+&lt;br/&gt;
     // Write to the stream&lt;br/&gt;
     f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; &quot;args.write(&quot; &amp;lt;&amp;lt; outputVar &amp;lt;&amp;lt; &quot;);&quot; &amp;lt;&amp;lt; endl &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; outputVar&lt;br/&gt;
                &amp;lt;&amp;lt; &quot;.writeMessageEnd();&quot; &amp;lt;&amp;lt; endl;&lt;br/&gt;
@@ -1605,6 +1610,25 @@ void t_js_generator::generate_service_client(t_service* tservice) {&lt;br/&gt;
       }&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;+    indent_down();&lt;br/&gt;
+    f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; &quot;}&quot; &amp;lt;&amp;lt; endl;&lt;br/&gt;
+&lt;br/&gt;
+    // Reset the transport if there was a serialization error&lt;br/&gt;
+    f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; &quot;catch (e) {&quot; &amp;lt;&amp;lt; endl;&lt;br/&gt;
+    indent_up();&lt;br/&gt;
+    if (gen_node_) {&lt;br/&gt;
+      f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; &quot;if (typeof &quot; &amp;lt;&amp;lt; outputVar &amp;lt;&amp;lt; &quot;.reset === &apos;function&apos;) &lt;/p&gt;
{&quot; &amp;lt;&amp;lt; endl;
+      f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; &quot;  &quot; &amp;lt;&amp;lt; outputVar &amp;lt;&amp;lt; &quot;.reset();&quot; &amp;lt;&amp;lt; endl;
+      f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; &quot;}
&lt;p&gt;&quot; &amp;lt;&amp;lt; endl;&lt;br/&gt;
+    } else {&lt;br/&gt;
+      f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; &quot;if (typeof &quot; &amp;lt;&amp;lt; outputVar &amp;lt;&amp;lt; &quot;.getTransport().reset === &apos;function&apos;) &lt;/p&gt;
{&quot; &amp;lt;&amp;lt; endl;
+      f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; &quot;  &quot; &amp;lt;&amp;lt; outputVar &amp;lt;&amp;lt; &quot;.getTransport().reset();&quot; &amp;lt;&amp;lt; endl;
+      f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; &quot;}
&lt;p&gt;&quot; &amp;lt;&amp;lt; endl;&lt;br/&gt;
+    }&lt;br/&gt;
+    f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; &quot;throw e;&quot; &amp;lt;&amp;lt; endl;&lt;br/&gt;
+    indent_down();&lt;br/&gt;
+    f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; &quot;}&quot; &amp;lt;&amp;lt; endl;&lt;br/&gt;
+&lt;br/&gt;
     indent_down();&lt;/p&gt;

&lt;p&gt;     f_service_ &amp;lt;&amp;lt; &quot;};&quot; &amp;lt;&amp;lt; endl;&lt;br/&gt;
diff --git a/lib/nodejs/lib/thrift/buffered_transport.js b/lib/nodejs/lib/thrift/buffered_transport.js&lt;br/&gt;
index 13636b574f..a9e006e6cc 100644&lt;br/&gt;
&amp;#8212; a/lib/nodejs/lib/thrift/buffered_transport.js&lt;br/&gt;
+++ b/lib/nodejs/lib/thrift/buffered_transport.js&lt;br/&gt;
@@ -33,6 +33,14 @@ function TBufferedTransport(buffer, callback) &lt;/p&gt;
{
   this.onFlush = callback;
 }
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;+TBufferedTransport.prototype.reset = function() &lt;/p&gt;
{
+  this.inBuf = new Buffer(this.defaultReadBufferSize);
+  this.readCursor = 0;
+  this.writeCursor = 0;
+  this.outBuffers = [];
+  this.outCount = 0;
+}
&lt;p&gt;+&lt;br/&gt;
 TBufferedTransport.receiver = function(callback, seqid) {&lt;br/&gt;
   var reader = new TBufferedTransport();&lt;/p&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16519878" author="jking3" created="Fri, 22 Jun 2018 00:48:25 +0000"  >&lt;p&gt;Committed - thanks.&lt;/p&gt;</comment>
                            <comment id="16519933" author="bforbis" created="Fri, 22 Jun 2018 03:05:26 +0000"  >&lt;p&gt;Linked to another&#160;pre-existing issue &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-616&quot; title=&quot;Transport should be reset on error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-616&quot;&gt;THRIFT-616&lt;/a&gt; for the Python library. Looks like this issue exists across other languages.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12439658">THRIFT-616</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13196941">THRIFT-4663</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12470604">THRIFT-834</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13078084">THRIFT-4225</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 21 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3tcxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>