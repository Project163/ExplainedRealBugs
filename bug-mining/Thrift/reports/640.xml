<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:05:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-1673] Ruby compile flags for extension for multi arch builds (os x)</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-1673</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;ld: warning: ld: warning: ignoring file thrift_native.o, file was built for unsupported file format ( 0xcf 0xfa 0xed 0xfe 0x 7 0x 0 0x 0 0x 1 0x 3 0x 0 0x 0 0x 0 0x 1 0x 0 0x 0 0x 0 ) which is not the architecture being linked (i386): thrift_native.oignoring file struct.o, file was built for unsupported file format ( 0xcf 0xfa 0xed 0xfe 0x 7 0x 0 0x 0 0x 1 0x 3 0x 0 0x 0 0x 0 0x 1 0x 0 0x 0 0x 0 ) which is not the architecture being linked (i386): struct.o&lt;/p&gt;</description>
                <environment>&lt;p&gt;os x&lt;/p&gt;</environment>
        <key id="12602531">THRIFT-1673</key>
            <summary>Ruby compile flags for extension for multi arch builds (os x)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jfarrell">Jake Farrell</assignee>
                                    <reporter username="jfarrell">Jake Farrell</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Aug 2012 16:02:24 +0000</created>
                <updated>Tue, 9 Oct 2012 05:11:18 +0000</updated>
                            <resolved>Tue, 9 Oct 2012 00:31:41 +0000</resolved>
                                    <version>0.9</version>
                                    <fixVersion>0.9</fixVersion>
                                    <component>Ruby - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13431934" author="jfarrell" created="Thu, 9 Aug 2012 16:03:55 +0000"  >&lt;p&gt;Committed r1371273&lt;/p&gt;</comment>
                            <comment id="13431987" author="hudson" created="Thu, 9 Aug 2012 17:12:11 +0000"  >&lt;p&gt;Integrated in Thrift #515 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/515/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/515/&lt;/a&gt;)&lt;br/&gt;
    Thrift-1673: Ruby compile flags for extension for multi arch builds (os x)&lt;br/&gt;
Client: ruby&lt;br/&gt;
Patch: Jake Farrell&lt;/p&gt;

&lt;p&gt;Updating extension build to use ruby cflags which include the arch flags needed. (Revision 1371273)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;/p&gt;</comment>
                            <comment id="13465701" author="nbeyer_cerner" created="Fri, 28 Sep 2012 16:12:05 +0000"  >&lt;p&gt;The the commit associated with this issue, I&apos;m not able to build on OS X with Ruby 1.9.3-p194. I can build on OS X with Ruby 1.8.7-p370. Here&apos;s the output I&apos;m seeing -&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;compiling binary_protocol_accelerated.c
cc1: warnings being treated as errors
binary_protocol_accelerated.c: In function &#8216;write_string_direct&#8217;:
binary_protocol_accelerated.c:83: warning: implicit conversion shortens 64-bit value into a 32-bit value
binary_protocol_accelerated.c: In function &#8216;rb_thrift_binary_proto_write_double&#8217;:
binary_protocol_accelerated.c:203: warning: ISO C90 forbids mixed declarations and code
binary_protocol_accelerated.c: In function &#8216;rb_thrift_binary_proto_write_string&#8217;:
binary_protocol_accelerated.c:215: warning: ISO C90 forbids mixed declarations and code
binary_protocol_accelerated.c: In function &#8216;read_i64_direct&#8217;:
binary_protocol_accelerated.c:252: warning: ISO C90 forbids mixed declarations and code
binary_protocol_accelerated.c: In function &#8216;Init_binary_protocol_accelerated&#8217;:
binary_protocol_accelerated.c:389: warning: implicit conversion shortens 64-bit value into a 32-bit value
binary_protocol_accelerated.c:390: warning: implicit conversion shortens 64-bit value into a 32-bit value
binary_protocol_accelerated.c:391: warning: implicit conversion shortens 64-bit value into a 32-bit value
binary_protocol_accelerated.c:393: warning: ISO C90 forbids mixed declarations and code
make: *** [binary_protocol_accelerated.o] Error 1
rake aborted!
Command failed with status (2): [make...]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When I remove the changes made in this bug it compiles fine. Any thoughts?&lt;/p&gt;</comment>
                            <comment id="13465996" author="nbeyer_cerner" created="Fri, 28 Sep 2012 23:11:01 +0000"  >&lt;p&gt;I think I found the issue. With Ruby 1.8.7, the generated Makefile has this for CFLAGS - &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CFLAGS   =  -fno-common -g -O2 -Wall -Werror -g -O2  -fno-common -pipe -fno-common   &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;.&lt;/p&gt;

&lt;p&gt;With Ruby 1.9.3, the generated Makefile has this for CFLAGS - &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CFLAGS   = -fno-common -g -O2 -Wall -Werror  -O3 -ggdb -Wextra -Wno-unused-parameter -Wno-parentheses -Wno-&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;-&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; -Wno-missing-field-initializers -Werror=pointer-arith -Werror=write-strings -Werror=declaration-after-statement -Werror=shorten-64-to-32 -Werror=implicit-function-declaration  -fno-common -pipe $(ARCH_FLAG)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The particularly painful issue is the &apos;-Werror=declaration-after-statement&apos;, which is generating all of the &apos;ISO C90 forbids mixed declarations and code&apos;. Unfortunately, none of the C code is written to strict C90 in this regard (variables declared at the top of functions).&lt;/p&gt;</comment>
                            <comment id="13466651" author="nbeyer" created="Mon, 1 Oct 2012 05:51:06 +0000"  >&lt;p&gt;Does the &apos;$CFLAGS&apos; variable need to be set at all? Is there a particular parameter that needs to be included?&lt;/p&gt;

&lt;p&gt;I tried remove the modification of &apos;$CFLAGS&apos; and everything seems to work just fine on Ruby 1.8.7-p370 and Ruby 1.9.3-p194 on OS X Lion. There are a lot of warnings for the native code when built via Ruby 1.9.3-p194, but the compilation and tests complete successfully.&lt;/p&gt;</comment>
                            <comment id="13466680" author="nbeyer" created="Mon, 1 Oct 2012 07:32:43 +0000"  >&lt;p&gt;Just to see what&apos;s really going on, I compare the generate Makefiles with and without the $CFLAGS setting on Ruby 1.8.7 and Ruby 1.9.3 to see the differences. Here&apos;s what&apos;s happening.&lt;/p&gt;

&lt;p&gt;Ruby 1.8.7 diff between current state in trunk and after removing $CFLAGS assignment -&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
 RUBY_EXTCONF_H = 
-CFLAGS   =  -fno-common -g -O2 -Wall -Werror -g -O2  -fno-common -pipe -fno-common   
+CFLAGS   =  -fno-common -g -O2  -fno-common -pipe -fno-common $(cflags) 
 INCFLAGS = -I. -I. -I/Users/me/.rvm/rubies/ruby-1.8.7-p370/lib/ruby/1.8/i686-darwin11.4.0 -I.
 DEFS     = 
 CPPFLAGS = -DHAVE_STRLCPY  -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE  
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Ruby 1.9.3 diff between current state in trunk and after removing $CFLAGS assignment -&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; RUBY_EXTCONF_H = 
 cflags   =  $(optflags) $(debugflags) $(warnflags)
 optflags = -O3
 debugflags = -ggdb
 warnflags = -Wextra -Wno-unused-parameter -Wno-parentheses -Wno-&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;-&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; -Wno-missing-field-initializers -Wpointer-arith -Wwrite-strings -Wdeclaration-after-statement -Wshorten-64-to-32 -Wimplicit-function-declaration
-CFLAGS   = -fno-common -g -O2 -Wall -Werror  -O3 -ggdb -Wextra -Wno-unused-parameter -Wno-parentheses -Wno-&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;-&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; -Wno-missing-field-initializers -Werror=pointer-arith -Werror=write-strings -Werror=declaration-after-statement -Werror=shorten-64-to-32 -Werror=implicit-function-declaration  -fno-common -pipe $(ARCH_FLAG)
+CFLAGS   = -fno-common $(cflags)  -fno-common -pipe $(ARCH_FLAG)
 INCFLAGS = -I. -I$(arch_hdrdir) -I$(hdrdir)/ruby/backward -I$(hdrdir) -I$(srcdir)
 DEFS     = 
 CPPFLAGS = -DHAVE_STRLCPY -I/Users/nathan/.rvm/usr/include -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE $(DEFS) $(cppflags)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The changes seem appropriate for Ruby 1.8.7, but I think they&apos;ll need to be either disable or adjusted to user the other, more discreet configuration parameters.&lt;/p&gt;</comment>
                            <comment id="13467090" author="jfarrell" created="Mon, 1 Oct 2012 18:49:47 +0000"  >&lt;p&gt;To enable the multi arch the CFLAGS from ruby are needed, this is added in the extconf with Config::CONFIG&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;CFLAGS&amp;quot;&amp;#93;&lt;/span&gt;. We could skip all other flags that ruby was compiled with and just use the arch flags as needed within this ticket originally with Config::CONFIG&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;CFLAGS&amp;#39;&amp;#93;&lt;/span&gt;.scan( /(-arch )(\S+)/ ).map&lt;/p&gt;
{|x,y| x + y + &apos; &apos; }
&lt;p&gt;.join(&apos;&apos;). Thoughts?&lt;/p&gt;
</comment>
                            <comment id="13467112" author="nbeyer" created="Mon, 1 Oct 2012 19:07:31 +0000"  >&lt;p&gt;Do you know what specific flags are missing? When I made the following change to extconf.rb, the flags seem to be copied from the original Ruby build appropriately.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Index: ext/extconf.rb
===================================================================
--- ext/extconf.rb	(revision 1392514)
+++ ext/extconf.rb	(working copy)
@@ -22,8 +22,6 @@
 &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
   require &lt;span class=&quot;code-quote&quot;&gt;&apos;mkmf&apos;&lt;/span&gt;
 
-  $CFLAGS = &lt;span class=&quot;code-quote&quot;&gt;&quot;-g -O2 -Wall -Werror &quot;&lt;/span&gt; + Config::CONFIG[&lt;span class=&quot;code-quote&quot;&gt;&quot;CFLAGS&quot;&lt;/span&gt;]
-
   have_func(&lt;span class=&quot;code-quote&quot;&gt;&quot;strlcpy&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;string.h&quot;&lt;/span&gt;)
 
   create_makefile &lt;span class=&quot;code-quote&quot;&gt;&apos;thrift_native&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;How is the original situation recreated?&lt;/p&gt;</comment>
                            <comment id="13471988" author="jfarrell" created="Tue, 9 Oct 2012 00:31:41 +0000"  >&lt;p&gt;Added CONFIG arch only line to allow for rvm build to compile without extra flags from ruby being included when only -arch flag was necessary&lt;/p&gt;</comment>
                            <comment id="13472138" author="hudson" created="Tue, 9 Oct 2012 05:11:18 +0000"  >&lt;p&gt;Integrated in Thrift #557 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/557/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/557/&lt;/a&gt;)&lt;br/&gt;
    Thrift-1673: Ruby compile flags for exension for multi arch builds (os x)&lt;br/&gt;
Client: rb&lt;br/&gt;
Patch: Jake Farrell&lt;/p&gt;

&lt;p&gt;Updating extconf to only grab arch flags from ruby binary to stop rvm version &amp;gt;= 1.9.x from breaking. (Revision 1395824)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245713</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 7 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i06cv3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35018</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>