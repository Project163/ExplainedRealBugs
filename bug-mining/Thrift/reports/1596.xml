<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:24:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-3786] Node.js TLS emits &apos;connect&apos; before connection is ready</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-3786</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;When using a TLS connection, the Node.js Thrift connection instance will emit a `connect` event early, making it possible to lose commands.&lt;/p&gt;

&lt;p&gt;`connect` is emitted by the Thrift connection instance when the underlying socket is opened, instead of when the TLS handshake has completed. Making matters worse, the offline queue is flushed during this premature `connect`, which means that any commands issued prior to the TLS connection handshake will be lost.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12957788">THRIFT-3786</key>
            <summary>Node.js TLS emits &apos;connect&apos; before connection is ready</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="codesf">Randy Abernethy</assignee>
                                    <reporter username="jamesreggio">James Reggio</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Apr 2016 17:50:14 +0000</created>
                <updated>Fri, 12 Aug 2016 01:29:51 +0000</updated>
                            <resolved>Mon, 11 Apr 2016 21:40:56 +0000</resolved>
                                                    <fixVersion>0.10.0</fixVersion>
                                    <component>Node.js - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15235590" author="jamesreggio" created="Mon, 11 Apr 2016 17:52:28 +0000"  >&lt;p&gt;These two issues share an root cause; specifically, code is executed when the secure socket emits `connect`, then again when it emits `secureConnect`.&lt;/p&gt;

&lt;p&gt;The handler should only run on `secureConnect` for TLS sockets, and on `connect` for standard (insecure) sockets.&lt;/p&gt;</comment>
                            <comment id="15235614" author="githubbot" created="Mon, 11 Apr 2016 18:03:05 +0000"  >&lt;p&gt;GitHub user jamesreggio opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/985&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/985&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3786&quot; title=&quot;Node.js TLS emits &amp;#39;connect&amp;#39; before connection is ready&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3786&quot;&gt;&lt;del&gt;THRIFT-3786&lt;/del&gt;&lt;/a&gt; Fix premature firing of `connect` event for secure sockets&lt;/p&gt;

&lt;p&gt;    `tls.connect()` returns a socket that will fire a `connect` event when the initial socket is connected, followed by a `secureConnect` event when the TLS handshake is complete&lt;/p&gt;

&lt;p&gt;    This commit causes the Thrift connection to wait until `secureConnect` to broadcast its own `connect` event and begin using the secure socket. This helps to resolve a race condition where commands issued after `connect` but before `secureConnect` are lost. It also fixes loss of commands in the offline queue, as well as double-broadcasting due to the same handler running on both underlying `connect` events.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jamesreggio/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jamesreggio/thrift&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3786&quot; title=&quot;Node.js TLS emits &amp;#39;connect&amp;#39; before connection is ready&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3786&quot;&gt;&lt;del&gt;THRIFT-3786&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/985.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/985.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #985&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit b76bad70826d539ddfb26b5277ff3bc09ffa9803&lt;br/&gt;
Author: James Reggio &amp;lt;james.reggio@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-04-11T17:53:12Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3786&quot; title=&quot;Node.js TLS emits &amp;#39;connect&amp;#39; before connection is ready&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3786&quot;&gt;&lt;del&gt;THRIFT-3786&lt;/del&gt;&lt;/a&gt; Fix premature firing of `connect` event for secure sockets&lt;/p&gt;

&lt;p&gt;    tls.connect() returns a socket that will fire a `connect` event when the&lt;br/&gt;
    initial socket is connected, followed by a `secureConnect` event when&lt;br/&gt;
    the TLS handshake is complete&lt;/p&gt;

&lt;p&gt;    This commit causes the Thrift connection to wait until `secureConnect`&lt;br/&gt;
    to broadcast its own `connect` event and begin using the secure socket.&lt;br/&gt;
    This helps to resolve a race condition where commands issued after&lt;br/&gt;
    `connect` but before `secureConnect` are lost. It also fixes loss of&lt;br/&gt;
    commands in the offline queue, as well as double-broadcasting due to the&lt;br/&gt;
    same handler running on both underlying `connect` events.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15236027" author="githubbot" created="Mon, 11 Apr 2016 21:39:37 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/985&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/985&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15236030" author="codesf" created="Mon, 11 Apr 2016 21:40:56 +0000"  >&lt;p&gt;great patch, thanks! committed with minor update to condition to support old nodes.&lt;/p&gt;</comment>
                            <comment id="15236064" author="jamesreggio" created="Mon, 11 Apr 2016 22:02:26 +0000"  >&lt;p&gt;Thanks for the quick merge, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=codesf&quot; class=&quot;user-hover&quot; rel=&quot;codesf&quot;&gt;codesf&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15236440" author="hudson" created="Tue, 12 Apr 2016 02:05:26 +0000"  >&lt;p&gt;FAILURE: Integrated in Thrift-precommit #404 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift-precommit/404/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift-precommit/404/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3786&quot; title=&quot;Node.js TLS emits &amp;#39;connect&amp;#39; before connection is ready&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3786&quot;&gt;&lt;del&gt;THRIFT-3786&lt;/del&gt;&lt;/a&gt; Fix premature firing of `connect` event for secure sockets (james.reggio: &lt;a href=&quot;https://github.com/apache/thrift/commit/b76bad70826d539ddfb26b5277ff3bc09ffa9803&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/commit/b76bad70826d539ddfb26b5277ff3bc09ffa9803&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/nodejs/lib/thrift/connection.js&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15240939" author="hudson" created="Thu, 14 Apr 2016 10:27:47 +0000"  >&lt;p&gt;FAILURE: Integrated in Thrift-precommit #408 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift-precommit/408/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift-precommit/408/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3786&quot; title=&quot;Node.js TLS emits &amp;#39;connect&amp;#39; before connection is ready&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3786&quot;&gt;&lt;del&gt;THRIFT-3786&lt;/del&gt;&lt;/a&gt;: Node TLS emits &apos;connect&apos; before connection is ready Client: (ra: &lt;a href=&quot;https://github.com/apache/thrift/commit/0ea6c1d5d77f046f089f200c67cffb629f3fe11e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/commit/0ea6c1d5d77f046f089f200c67cffb629f3fe11e&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/nodejs/lib/thrift/connection.js&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12830242">THRIFT-3156</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 31 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vxxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>