<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:04:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-1429] The nonblocking servers is supposed to use TransportFactory to read the data</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-1429</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;The nonblocking servers (TNonblockingServer) presume that you are using a framed transport and use that information to read the data as though it were framed. However, once it is loaded into memory, it is supposed to be wrapped up in the transport that the transport factory returns so that we can do post-processing.&lt;br/&gt;
This does not seems to be the case anymore.&lt;/p&gt;

&lt;p&gt;Use case: Implement another transport on top of TFramedTransport&lt;br/&gt;
For testing purposed I wrapped a TFramedTransport inside another TFramedTransport.&lt;/p&gt;

&lt;p&gt;On the client side:&lt;/p&gt;

&lt;p&gt;transport = new TFramedTransport(socket);&lt;br/&gt;
TTransport transport2 = new TFramedTransport(transport);&lt;br/&gt;
protocol = new TBinaryProtocol(transport2);&lt;br/&gt;
transport2.open();&lt;br/&gt;
service = new MyService.Client(protocol);&lt;br/&gt;
long count = service.getCounter(&quot;My counter&quot;);&lt;/p&gt;

&lt;p&gt;On the server side:&lt;br/&gt;
serverTransport = new TNonblockingServerSocket(port);&lt;br/&gt;
processor =  new MyService.Processor(new ServerIMPL());&lt;br/&gt;
THsHaServer.Args options = new THsHaServer.Args(serverTransport); &lt;br/&gt;
options.workerThreads(1);&lt;br/&gt;
options.processor(processor);&lt;br/&gt;
options.transportFactory(new TFramedTransport.Factory());&lt;br/&gt;
server = new THsHaServer(options);&lt;/p&gt;

&lt;p&gt;I&apos;m getting this exception:&lt;/p&gt;

&lt;p&gt;2385 &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; WARN org.apache.thrift.server.TNonblockingServer - Exception while invoking!&lt;br/&gt;
org.apache.thrift.transport.TTransportException: Cannot read. Remote side has closed. Tried to read 1 bytes, but only got 0 bytes. (This is often indicative of an internal error on the server side. Please check your server logs.)&lt;br/&gt;
at org.apache.thrift.transport.TTransport.readAll(TTransport.java:86)&lt;br/&gt;
at org.apache.thrift.protocol.TBinaryProtocol.readAll(TBinaryProtocol.java:378)&lt;br/&gt;
at org.apache.thrift.protocol.TBinaryProtocol.readByte(TBinaryProtocol.java:264)&lt;br/&gt;
at org.apache.thrift.protocol.TBinaryProtocol.readMessageBegin(TBinaryProtocol.java:215)&lt;br/&gt;
at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:22)&lt;br/&gt;
at org.apache.thrift.server.TNonblockingServer$FrameBuffer.invoke(TNonblockingServer.java:651)&lt;br/&gt;
at org.apache.thrift.server.THsHaServer$Invocation.run(THsHaServer.java:201)&lt;br/&gt;
at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
at java.lang.Thread.run(Thread.java:680)&lt;/p&gt;

&lt;p&gt;private TTransport getInputTransport() {&lt;br/&gt;
    return new TMemoryInputTransport(buffer_.array());&lt;br/&gt;
}&lt;br/&gt;
Why the buffer is not wrapped by the transportFactory similarly to the getOutputTransport&apos;s method?&lt;br/&gt;
This method looks suspicious to me but I&apos;m not familiar with TNonblockingServer so ... &lt;/p&gt;</description>
                <environment></environment>
        <key id="12531716">THRIFT-1429</key>
            <summary>The nonblocking servers is supposed to use TransportFactory to read the data</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanduxbury">Bryan Duxbury</assignee>
                                    <reporter username="jboulon">Jerome Boulon</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Nov 2011 23:57:55 +0000</created>
                <updated>Fri, 2 Mar 2012 06:41:33 +0000</updated>
                            <resolved>Fri, 2 Mar 2012 05:55:11 +0000</resolved>
                                    <version>0.7</version>
                                    <fixVersion>0.9</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13168775" author="bryanduxbury" created="Tue, 13 Dec 2011 22:10:45 +0000"  >&lt;p&gt;I just cooked this up, and it seems to enforce the transport factory on the server-read side as well as on the server-write side. Feel like trying this out?&lt;/p&gt;</comment>
                            <comment id="13220698" author="jfarrell" created="Fri, 2 Mar 2012 05:55:11 +0000"  >&lt;p&gt;Committed&lt;/p&gt;</comment>
                            <comment id="13220733" author="hudson" created="Fri, 2 Mar 2012 06:41:33 +0000"  >&lt;p&gt;Integrated in Thrift #423 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/423/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/423/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1429&quot; title=&quot;The nonblocking servers is supposed to use TransportFactory to read the data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1429&quot;&gt;&lt;del&gt;THRIFT-1429&lt;/del&gt;&lt;/a&gt;:The nonblocking servers is supposed to use TransportFactory to read the data&lt;br/&gt;
Client: Java&lt;br/&gt;
Patch: Bryan Duxbury &lt;/p&gt;

&lt;p&gt;Enforce the transport factory on the server-read side as well as on the server-write side (Revision 1296060)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
jfarrell : &lt;a href=&quot;http://svn.apache.org/viewvc/?view=rev&amp;amp;rev=1296060&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/?view=rev&amp;amp;rev=1296060&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/thrift/trunk/lib/java/src/org/apache/thrift/server/AbstractNonblockingServer.java&lt;/li&gt;
	&lt;li&gt;/thrift/trunk/lib/java/test/org/apache/thrift/server/ServerTestBase.java&lt;/li&gt;
	&lt;li&gt;/thrift/trunk/lib/java/test/org/apache/thrift/server/TestNonblockingServer.java&lt;/li&gt;
	&lt;li&gt;/thrift/trunk/lib/java/test/org/apache/thrift/transport/TestTSSLTransportFactory.java&lt;/li&gt;
	&lt;li&gt;/thrift/trunk/lib/java/test/org/apache/thrift/transport/TestTSaslTransports.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12507255" name="thrift-1429.patch" size="8645" author="bryanduxbury" created="Tue, 13 Dec 2011 22:10:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>217452</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 38 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i083lb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>45181</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>