<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:24:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-3753] TServerFramework::stop may fail to interrupt connected clients</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-3753</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;This is a sequence that exposes the race condition:&lt;br/&gt;
(1) Thread-1: in serve(), blocked on accept()&lt;br/&gt;
(2) Thread-2: in stop(), calls interrupt()&lt;br/&gt;
(3) Thread-2: in stop(), in interruptChildren(), checked that socket is valid&lt;br/&gt;
(4) Thread-1: in serve(), unblocked because of interrupt(), calls releaseOneDescriptor&lt;br/&gt;
(5) Thread-2: in interruptChildren(), send fails so clients are not interrupted&lt;/p&gt;</description>
                <environment></environment>
        <key id="12952951">THRIFT-3753</key>
            <summary>TServerFramework::stop may fail to interrupt connected clients</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tewang">Ted Wang</assignee>
                                    <reporter username="tewang">Ted Wang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Mar 2016 19:52:55 +0000</created>
                <updated>Fri, 12 Aug 2016 01:29:52 +0000</updated>
                            <resolved>Thu, 16 Jun 2016 20:12:37 +0000</resolved>
                                    <version>0.9.3</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>C++ - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15209049" author="githubbot" created="Wed, 23 Mar 2016 20:00:10 +0000"  >&lt;p&gt;GitHub user tpcwang opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/959&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/959&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3753&quot; title=&quot;TServerFramework::stop may fail to interrupt connected clients&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3753&quot;&gt;&lt;del&gt;THRIFT-3753&lt;/del&gt;&lt;/a&gt; Fixed a race condition in TServerFramework::stop that prevents clean server shutdown&lt;/p&gt;

&lt;p&gt;    This is a sequence that exposes the race condition:&lt;br/&gt;
    (1) Thread-1: in serve(), blocked on accept()&lt;br/&gt;
    (2) Thread-2: in stop(), calls interrupt()&lt;br/&gt;
    (3) Thread-2: in stop(), in interruptChildren(), checked that socket is valid&lt;br/&gt;
    (4) Thread-1: in serve(), unblocked because of interrupt(), calls releaseOneDescriptor&lt;br/&gt;
    (5) Thread-2: in interruptChildren(), send fails so clients are not interrupted&lt;/p&gt;

&lt;p&gt;    Closing a socket while it is being polled/selected may or may not work on all platforms, so I think changing the order is better.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tpcwang/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tpcwang/thrift&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3753&quot; title=&quot;TServerFramework::stop may fail to interrupt connected clients&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3753&quot;&gt;&lt;del&gt;THRIFT-3753&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/959.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/959.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #959&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 712df0e1473b56909e8f4a393fe64607f4493a47&lt;br/&gt;
Author: tpcwang &amp;lt;tpc.wang@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-03-23T19:20:44Z&lt;/p&gt;

&lt;p&gt;    Fixed a race condition in TServerFramework::stop that prevents clean server shutdown.&lt;/p&gt;

&lt;p&gt;    This is a sequence that exposes the race condition:&lt;br/&gt;
    (1) Thread-1: in serve(), blocked on accept()&lt;br/&gt;
    (2) Thread-2: in stop(), calls interrupt()&lt;br/&gt;
    (3) Thread-2: in stop(), in interruptChildren(), checked that socket is valid&lt;br/&gt;
    (4) Thread-1: in serve(), unblocked because of interrupt(), calls releaseOneDescriptor&lt;br/&gt;
    (5) Thread-2: in interruptChildren(), send fails so clients are not interrupted&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15224992" author="jking3" created="Mon, 4 Apr 2016 20:30:50 +0000"  >&lt;p&gt;If you interrupt serve() second, a new client might arrive while the first set of clients is being interrupted; will the new client also be interrupted?&lt;/p&gt;</comment>
                            <comment id="15225012" author="tewang" created="Mon, 4 Apr 2016 20:45:20 +0000"  >&lt;p&gt;Yes. TServerSocket (the only server transport that implements interruptChildren) uses the same socket pair for interruption all children. Data is written to the socket to signal the clients and break them out of the poll loop. Data is never read so the interrupt signal will not be lost, even if a new client were to come in after we have written to the socket.&lt;/p&gt;

&lt;p&gt;With that said, I do share some concerns that a future server transport not handle the case that you mention correctly.&lt;/p&gt;</comment>
                            <comment id="15330632" author="githubbot" created="Tue, 14 Jun 2016 21:20:16 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/959&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/959&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I recommend you rebase this against origin/master because the list of commits above leads me to believe it wasn&apos;t on origin/master to begin with, and the fix should be small.  Plus this will re-run the build so it passes, and we can look at merging it in.&lt;/p&gt;</comment>
                            <comment id="15330697" author="githubbot" created="Tue, 14 Jun 2016 21:51:38 +0000"  >&lt;p&gt;Github user tpcwang commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/959&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/959&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @jeking3 Thanks for catching it. It is rebased correctly now.&lt;/p&gt;</comment>
                            <comment id="15334590" author="githubbot" created="Thu, 16 Jun 2016 20:11:01 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/959&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/959&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15334592" author="jensg" created="Thu, 16 Jun 2016 20:12:37 +0000"  >&lt;p&gt;Committed, thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 22 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2v447:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>