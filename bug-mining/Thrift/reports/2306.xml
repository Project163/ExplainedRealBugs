<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:35:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-5880] C++ TSocket on an IPv6-only system fails if you use a hostname of 127.0.0.1</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-5880</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;&lt;tt&gt;The TSocket code uses AI_ADDRCONFIG to resolve the hostname and retrieve A and AAAA records for IPv6 compatibility.&#160; There&apos;s a nasty corner case documented in the &lt;a href=&quot;https://linux.die.net/man/3/getaddrinfo&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;getaddrinfo() documentation&lt;/a&gt;:&lt;/tt&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;If &lt;em&gt;hints.ai_flags&lt;/em&gt; includes the &lt;b&gt;AI_ADDRCONFIG&lt;/b&gt; flag, then IPv4 addresses are returned in the list pointed to by &lt;em&gt;res&lt;/em&gt; only if the local system has at least one IPv4 address configured, and IPv6 addresses are only returned if the local system has at least one IPv6 address configured. The loopback address is not considered for this case as valid as a configured address.&#160;&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;tt&gt;Therefore on a system that has only IPv6 interfaces with the exception of loopback, using AI_ADDRINFO results in an EAI_ADDRFAMILY error:&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;# ifconfig&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;eth0: flags=4163&amp;lt;UP,BROADCAST,RUNNING,MULTICAST&amp;gt; &#160;mtu 1500&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; inet6 ffff:ffff:ffff:ffff::ffff&#160; prefixlen 128 &#160;scopeid 0x0&amp;lt;global&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; inet6 ffff::ffff:ff:ffff:ffff&#160; prefixlen 64 &#160;scopeid 0x20&amp;lt;link&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; ether ff:ff:ff:ff:ff:ff&#160; txqueuelen 10000 &#160;(Ethernet)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; RX packets 118419 &#160;bytes 352689119 (336.3 MiB)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; RX errors 0 &#160;dropped 4 &#160;overruns 0 &#160;frame 0&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; TX packets 101312 &#160;bytes 43358432 (41.3 MiB)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; TX errors 0 &#160;dropped 0 overruns 0 &#160;carrier 0 &#160;collisions 0&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;lo: flags=73&amp;lt;UP,LOOPBACK,RUNNING&amp;gt; &#160;mtu 65536&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; inet 127.0.0.1 &#160;netmask 255.0.0.0&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; inet6 ::1 &#160;prefixlen 128 &#160;scopeid 0x10&amp;lt;host&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; loop &#160;txqueuelen 1000 &#160;(Local Loopback)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; RX packets 2343 &#160;bytes 277200 (270.7 KiB)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; RX errors 0 &#160;dropped 0 &#160;overruns 0 &#160;frame 0&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; TX packets 2343 &#160;bytes 277200 (270.7 KiB)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; TX errors 0 &#160;dropped 0 overruns 0 &#160;carrier 0 &#160;collisions 0&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Calling getaddrinfo() on &quot;127.0.0.1&quot; causes this error.&#160; I generated a test program to validate the behavior:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;# ## without AI_ADDRCONFIG - it works&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;# ./resolvtest 127.0.0.1&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Resolving hostname: 127.0.0.1&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Resolution successful. Results:&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; 1: IPv4: 127.0.0.1&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160;Family: 2, Socket type: 1, Protocol: 6&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;# ./resolvtest -c 127.0.0.1&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Using AI_ADDRCONFIG flag&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Resolving hostname: 127.0.0.1&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;getaddrinfo error: Address family for hostname not supported&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;I attached the test program as well.&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;The fix is simple: in TSocket.cpp around line 466 where we check for an EAI_NODATA response, we should also check for EAI_ADDRFAMILY.&lt;/tt&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13620857">THRIFT-5880</key>
            <summary>C++ TSocket on an IPv6-only system fails if you use a hostname of 127.0.0.1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jking3">James E. King III</assignee>
                                    <reporter username="jking3">James E. King III</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Jun 2025 13:26:39 +0000</created>
                <updated>Mon, 16 Jun 2025 13:23:28 +0000</updated>
                            <resolved>Mon, 16 Jun 2025 13:23:28 +0000</resolved>
                                    <version>0.20.0</version>
                                    <fixVersion>0.23.0</fixVersion>
                                    <component>C++ - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                        <attachments>
                            <attachment id="13076993" name="resolvtest.c" size="3182" author="jking3" created="Fri, 13 Jun 2025 13:26:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            21 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1wbls:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>