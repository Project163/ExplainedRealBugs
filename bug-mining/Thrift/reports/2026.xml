<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:31:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-4252] Cannot shutdown Java server when clients are still connected</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-4252</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;I found issue &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2441&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/THRIFT-2441&lt;/a&gt; and I believe that the same problem still exists in the Java servers, and I&apos;m affected by it. Short summary: I can not shut down the Java server (neither TSimpleServer nor TThreadedServer) while clients are still connected. That is pretty bad, because essentially the clients are not under by control, but they can essentially &quot;block&quot; server maintenance operations by blocking the shutdown.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;In more detail:&lt;/b&gt; I have a Java TSimpleServer runnable in a thread running. The main thread eventually asks the server to stop(). But they seem to ignore the request. I checked the code of TSimpleServer.java and I&apos;m under the impression that the innermost loop the server does not poll the variable stopped_ or does it? Looking at &lt;a href=&quot;https://github.com/apache/thrift/blob/master/lib/java/src/org/apache/thrift/server/TSimpleServer.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/blob/master/lib/java/src/org/apache/thrift/server/TSimpleServer.java&lt;/a&gt; from line 76:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;          &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (eventHandler_ != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
              eventHandler_.processContext(connectionContext, inputTransport, outputTransport);
            }
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(!processor.process(inputProtocol, outputProtocol)) {
              &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
            }
          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I found that this loop is only interrupted if the client disconnects. I tried changing &lt;tt&gt;while(true)&lt;/tt&gt; for &lt;tt&gt;while(!stopped_)&lt;/tt&gt; but that did not help. I guess that one of the methods in the loop must be blocking.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13087569">THRIFT-4252</key>
            <summary>Cannot shutdown Java server when clients are still connected</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="q.xu">Qinghui Xu</assignee>
                                    <reporter username="emmenlau">Mario Emmenlauer</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 17 Jul 2017 12:45:28 +0000</created>
                <updated>Fri, 12 Feb 2021 07:07:44 +0000</updated>
                            <resolved>Thu, 12 Dec 2019 23:35:17 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.14.0</fixVersion>
                                    <component>Java - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16124948" author="emmenlau" created="Sun, 13 Aug 2017 14:27:33 +0000"  >&lt;p&gt;I have the same problem also with the Java thread pool server, so it seems this is an expected behavior of the Java servers. However, since this has been fixed for the C++ servers, I think it would be sensible to also fix the issue for the Java servers.&lt;/p&gt;

&lt;p&gt;With the current behavior, a malicious client can basically prohibit clean server shutdown (and all it needs to do is keep the connection open). More realisticly, the client does not need to be malicious, it could just hang or forget to disconnect and thereby &quot;locking&quot; the server in an open API connection.&lt;/p&gt;</comment>
                            <comment id="16160353" author="emmenlau" created="Sun, 10 Sep 2017 14:08:39 +0000"  >&lt;p&gt;Can someone please confirm that I&apos;m on the right track? Is this an expected behavior or a bug? Could you give me a hint if changing this behavior would require significant effort or if there is something simple that could be done about it? Thanks for your help!&lt;/p&gt;</comment>
                            <comment id="16205985" author="emmenlau" created="Mon, 16 Oct 2017 14:33:13 +0000"  >&lt;p&gt;Anyone?&lt;/p&gt;</comment>
                            <comment id="16510998" author="emmenlau" created="Wed, 13 Jun 2018 11:48:08 +0000"  >&lt;p&gt;Is it possible to post a bounty on this task? Are there thrift core developers that accept a bounty?&lt;/p&gt;</comment>
                            <comment id="16533536" author="jking3" created="Thu, 5 Jul 2018 11:16:03 +0000"  >&lt;p&gt;The issue here is that once a client connects, if it sits idle, it will hold the server hostage until it disconnects.  This is a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2441&quot; title=&quot;Cannot shutdown TThreadedServer when clients are still connected&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2441&quot;&gt;&lt;del&gt;THRIFT-2441&lt;/del&gt;&lt;/a&gt; which was fixed for C++ by adding an interruptable socket pair mechanism to each connected client as part of a library refactoring.  It looks like the same thing needs to be done on the Java side, or alternatively the Java server could be taught to keep track of the clients and when the server executes stop() it could close all the client transports in addition to the server socket.  (Close the server socket first to prevent new clients during the remainder...)&lt;/p&gt;</comment>
                            <comment id="16963416" author="jensg" created="Wed, 30 Oct 2019 20:43:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emmenlau&quot; class=&quot;user-hover&quot; rel=&quot;emmenlau&quot;&gt;emmenlau&lt;/a&gt; we have a pull request for this, would you mind revieweing it?&lt;/p&gt;</comment>
                            <comment id="16976148" author="q.xu" created="Sun, 17 Nov 2019 20:52:00 +0000"  >&lt;p&gt;It would be nice to get a review on the PR.&lt;/p&gt;

&lt;p&gt;To grasp the idea of the PR, it might be useful to checkout the commit, run the test I added with and without the patch to see the difference.&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                            <outwardlinks description="fixes">
                                        <issuelink>
            <issuekey id="13358283">ZEPPELIN-5249</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13170071">THRIFT-4598</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13141280">THRIFT-4500</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12706127">THRIFT-2441</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3hlgn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>