<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:59:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-1067] Tons of bugs in php implementation</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-1067</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;PHP version of thrift hold many bugs:&lt;/p&gt;

&lt;p&gt;1). Incorrect work with ZTS&lt;br/&gt;
2). Hung when work throw thrift framed transport&lt;br/&gt;
3). Memleak in protocol_writeMessageBegin&lt;br/&gt;
4). Hung when server close connection, and when php code try reuse same connection&lt;br/&gt;
5). Impossible pass really long values on 32 bit platforms&lt;/p&gt;</description>
                <environment></environment>
        <key id="12499007">THRIFT-1067</key>
            <summary>Tons of bugs in php implementation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tantra">ruslan.usifov</assignee>
                                    <reporter username="tantra">ruslan.usifov</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Feb 2011 08:01:34 +0000</created>
                <updated>Sat, 26 Jan 2019 14:51:03 +0000</updated>
                            <resolved>Tue, 22 Feb 2011 18:18:07 +0000</resolved>
                                    <version>0.6</version>
                                    <fixVersion>0.7</fixVersion>
                                    <component>PHP - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12996941" author="bryanduxbury" created="Sun, 20 Feb 2011 00:56:26 +0000"  >&lt;p&gt;Can any PHP users/devs vouch for this patch? I don&apos;t understand what&apos;s going on in there.&lt;/p&gt;</comment>
                            <comment id="12997118" author="tantra" created="Sun, 20 Feb 2011 09:32:44 +0000"  >&lt;p&gt;I explain some of them:&lt;/p&gt;

&lt;p&gt;2). Hung when work throw thrift framed transport&lt;br/&gt;
In PHPOutputTransport destructor you make flush(), but in PHP_FUNCTION(thrift_protocol_write_binary) you make flash too at the end: transport.flush(), in framed transport this call hung&lt;/p&gt;

&lt;p&gt;3). Memleak in protocol_writeMessageBegin&lt;br/&gt;
In this function you allocate 3 function agrs (MAKE_STD_ZVAL), but doesn&apos;t free them with zval_ptr_dtor. On very long executed scripts this results as &lt;/p&gt;

&lt;p&gt;Fatal error: Allowed memory size of 262144 bytes exhausted (tried to allocate 30084 bytes)&lt;/p&gt;

&lt;p&gt;How fast you got this error, depends on your memory_limit config param in php.ini&lt;/p&gt;

&lt;p&gt;4). Hung when server close connection, and when php code try reuse same connection&lt;br/&gt;
To reproduce:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;?php
define(&lt;span class=&quot;code-quote&quot;&gt;&quot;LIBPATH&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;lib/&quot;&lt;/span&gt;);

require_once(&lt;span class=&quot;code-quote&quot;&gt;&quot;thrift/Thrift.php&quot;&lt;/span&gt;);
require_once(&lt;span class=&quot;code-quote&quot;&gt;&quot;thrift/transport/TSocket.php&quot;&lt;/span&gt;);
require_once(&lt;span class=&quot;code-quote&quot;&gt;&quot;thrift/transport/TFramedTransport.php&quot;&lt;/span&gt;);
require_once(&lt;span class=&quot;code-quote&quot;&gt;&quot;thrift/protocol/TBinaryProtocol.php&quot;&lt;/span&gt;);

require_once(&lt;span class=&quot;code-quote&quot;&gt;&apos;Log.php&apos;&lt;/span&gt;);
require_once(&lt;span class=&quot;code-quote&quot;&gt;&apos;Log/file.php&apos;&lt;/span&gt;);

require_once(LIBPATH.&lt;span class=&quot;code-quote&quot;&gt;&quot;cassandra/Cassandra.php&quot;&lt;/span&gt;);
require_once(LIBPATH.&lt;span class=&quot;code-quote&quot;&gt;&quot;cassandra/cassandra_types.php&quot;&lt;/span&gt;);

$transport = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TFramedTransport(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TSocket(&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;, 9160));
$protocol  = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TBinaryProtocolAccelerated($transport);

$client = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CassandraClient($protocol);
$transport-&amp;gt;open();

$client-&amp;gt;set_keyspace(&lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;);

$l_supercolumn = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; cassandra_SuperColumn(array(&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; =&amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;12&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;columns&quot;&lt;/span&gt; =&amp;gt; NULL));
$l_c_or_sc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; cassandra_ColumnOrSuperColumn(array(&lt;span class=&quot;code-quote&quot;&gt;&quot;super_column&quot;&lt;/span&gt; =&amp;gt; $l_supercolumn));
$l_mutation = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; cassandra_Mutation(array(&lt;span class=&quot;code-quote&quot;&gt;&quot;column_or_supercolumn&quot;&lt;/span&gt; =&amp;gt; $l_c_or_sc));

&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;($i=0; $i &amp;lt; 10; $i++)
{
	&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
	{
		$client-&amp;gt;batch_mutate(array(&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt; =&amp;gt; array(&lt;span class=&quot;code-quote&quot;&gt;&apos;test&apos;&lt;/span&gt; =&amp;gt; array($l_mutation))), cassandra_ConsistencyLevel::QUORUM);
	}
	&lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;(Exception $e)
	{
		print $e;
		print &lt;span class=&quot;code-quote&quot;&gt;&quot;\n\n&quot;&lt;/span&gt;;
	};
};

sleep(30);
?&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;This code when fist time go to batch_mutate, will throw TApplication exception, second attempt will hung in TSocket::readAll, because fread will always return empty data&lt;/p&gt;

&lt;p&gt;5). Impossible pass really long values on 32 bit platforms&lt;/p&gt;

&lt;p&gt;Try to pass something like this: 4294967296 on 32 bit platform  and look what you get on server. Result will surprise you&lt;/p&gt;
</comment>
                            <comment id="12997941" author="bryanduxbury" created="Tue, 22 Feb 2011 18:18:07 +0000"  >&lt;p&gt;I just committed this. Thanks for the patch, Ruslan!&lt;/p&gt;</comment>
                            <comment id="12997942" author="dreiss" created="Tue, 22 Feb 2011 18:18:18 +0000"  >&lt;p&gt;The original author of the extension module had this to say:&lt;/p&gt;

&lt;p&gt;It&apos;s been so long since I dealt with PHP internals that I&apos;m not sure I can&lt;br/&gt;
do a good job of validating this patch &amp;#8211; and that&apos;s not exactly something&lt;br/&gt;
I&apos;m eager to pick up again.&lt;/p&gt;

&lt;p&gt;That being said: the ZTS stuff and the memory leak fix in&lt;br/&gt;
protocol_writeMessageBegin look probably OK. The exception stuff is also&lt;br/&gt;
probably OK. I would make sure that the #include and typedef stuff at the&lt;br/&gt;
top to work around Windows&apos; lack of the &lt;span class=&quot;error&quot;&gt;&amp;#91;u&amp;#93;&lt;/span&gt;intXX_t typedefs and some of&lt;br/&gt;
the networking headers didn&apos;t break the build on UNIXy machines. Not sure&lt;br/&gt;
what the correct behaviour is for the changes to the T_&lt;span class=&quot;error&quot;&gt;&amp;#91;UI&amp;#93;&lt;/span&gt;64 conversions.&lt;br/&gt;
Given that it&apos;s PHP and we&apos;re dealing with 64 bit values, it&apos;s probably&lt;br/&gt;
all undefined behaviour anyway.&lt;/p&gt;</comment>
                            <comment id="12997992" author="tantra" created="Tue, 22 Feb 2011 19:33:42 +0000"  >&lt;p&gt;&amp;gt;&amp;gt;&amp;gt;Not sure&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;what the correct behaviour is for the changes to the T_&lt;span class=&quot;error&quot;&gt;&amp;#91;UI&amp;#93;&lt;/span&gt;64 conversions.&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;Given that it&apos;s PHP and we&apos;re dealing with 64 bit values, it&apos;s probably&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;all undefined behaviour anyway.&lt;/p&gt;

&lt;p&gt;This helps pass cassandra big timestamps in my test environment. It&apos;s not very clean, but in may case is acceptable&lt;/p&gt;</comment>
                            <comment id="13038020" author="whitingj" created="Mon, 23 May 2011 16:21:14 +0000"  >&lt;p&gt;I think the php thrift extension version number should be incremented whenever a bug fix / change is made to the extension.  Right now it is still at 1.0 but it should be 1.0.1 or 1.1 after applying this patch.  That way when people have problems you can have them check their extension version and know if they have the latest one installed with all the bug fixes.&lt;/p&gt;</comment>
                            <comment id="13038030" author="jfarrell" created="Mon, 23 May 2011 16:32:49 +0000"  >&lt;p&gt;Jeff, &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-985&quot; title=&quot;php: add version Info to the library&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-985&quot;&gt;&lt;del&gt;THRIFT-985&lt;/del&gt;&lt;/a&gt; is open for versioning the php client&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12458805">THRIFT-729</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12471467" name="php20110219.patch" size="4906" author="tantra" created="Sat, 19 Feb 2011 12:35:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>187171</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16cwf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245222</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>