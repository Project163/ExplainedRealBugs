<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:56:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-59] Memory leak reading lists of structs</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-59</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;The Cocoa generated code inside a struct that reads in a field that is a list of structs leaks memory.&lt;/p&gt;

&lt;p&gt;Here&apos;s a relevant sample from the read: of a generated struct:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;      case 3:
        if (fieldType == TType_LIST) {
          int _size50;
          [inProtocol readListBeginReturningElementType: NULL size: &amp;amp;_size50];
          NSMutableArray * fieldValue = [[NSMutableArray alloc] initWithCapacity: _size50];
          int _i51;
          for (_i51 = 0; _i51 &amp;lt; _size50; ++_i51)
          {
            MYOBJECT *_elem52 = [[MYOBJECT alloc] init];
            [_elem52 read: inProtocol];
            [fieldValue addObject: _elem52];
          }
          [inProtocol readListEnd];
          [self setNotes: fieldValue];
          [fieldValue release];
        } else { 
          [TProtocolUtil skipType: fieldType onProtocol: inProtocol];
        }
        break;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Each instance of MYOBJECT read in is created with alloc/init and then added to the fieldValue array (which retains it) but then never released.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12399032">THRIFT-59</key>
            <summary>Memory leak reading lists of structs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="geechorama">Andrew McGeachie</assignee>
                                    <reporter username="geechorama">Andrew McGeachie</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Jun 2008 20:44:28 +0000</created>
                <updated>Tue, 1 Nov 2011 02:51:48 +0000</updated>
                            <resolved>Tue, 21 Jul 2009 20:14:45 +0000</resolved>
                                                                    <component>Cocoa - Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12608182" author="geechorama" created="Wed, 25 Jun 2008 20:48:51 +0000"  >&lt;p&gt;Just formatting.&lt;/p&gt;</comment>
                            <comment id="12712466" author="mattstevens" created="Sat, 23 May 2009 22:09:04 +0000"  >&lt;p&gt;Attached patch fixing the memory leaks, which apply to objects created for maps and sets as well as lists.&lt;/p&gt;

&lt;p&gt;Release types that can be null when allocated for a container. Also consolidated type fetching within the container deserialize functions.&lt;/p&gt;</comment>
                            <comment id="12733627" author="geechorama" created="Tue, 21 Jul 2009 14:11:53 +0000"  >&lt;p&gt;Marking as patch available.&lt;/p&gt;</comment>
                            <comment id="12733640" author="geechorama" created="Tue, 21 Jul 2009 14:34:01 +0000"  >&lt;p&gt;Patch committed.  Thanks Matt.&lt;/p&gt;</comment>
                            <comment id="12733737" author="geechorama" created="Tue, 21 Jul 2009 17:31:51 +0000"  >&lt;p&gt;The applied patch is a little over-aggressive.  It also releases NSString objects which are already in the auto-release pool.&lt;/p&gt;

&lt;p&gt;Need to tweak it to just release container objects.  e.g.:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;      &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; 12:
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (fieldType == TType_LIST) {
          &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; _size10;
          [inProtocol readListBeginReturningElementType: NULL size: &amp;amp;_size10];
          NSMutableArray * fieldValue = [[NSMutableArray alloc] initWithCapacity: _size10];
          &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; _i11;
          &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (_i11 = 0; _i11 &amp;lt; _size10; ++_i11)
          {
            NSString * _elem12 = [inProtocol readString];
            [fieldValue addObject: _elem12];
            [_elem12 release];
          }
          [inProtocol readListEnd];
          [self setTagGuids: fieldValue];
          [fieldValue release];
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; { 
          NSLog(@&lt;span class=&quot;code-quote&quot;&gt;&quot;%s: field ID %i has unexpected type %i.  Skipping.&quot;&lt;/span&gt;, __PRETTY_FUNCTION__, fieldID, fieldType);
          [TProtocolUtil skipType: fieldType onProtocol: inProtocol];
        }
        &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12733787" author="mattstevens" created="Tue, 21 Jul 2009 19:10:29 +0000"  >&lt;p&gt;I think this can be fixed by excluding the release for strings as done in generate_cocoa_struct_reader(). This would leave the release in for both containers and structs. I&apos;ll do a little more investigation and submit a patch.&lt;/p&gt;</comment>
                            <comment id="12733802" author="geechorama" created="Tue, 21 Jul 2009 20:11:21 +0000"  >&lt;p&gt;Agreed.  I&apos;ve attached a patch which does that here.&lt;/p&gt;</comment>
                            <comment id="12733805" author="geechorama" created="Tue, 21 Jul 2009 20:14:45 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12414135" name="thrift-59-no-strings.patch" size="1667" author="geechorama" created="Tue, 21 Jul 2009 20:11:21 +0000"/>
                            <attachment id="12408890" name="thrift-59.patch" size="2724" author="mattstevens" created="Sat, 23 May 2009 22:09:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>186311</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 19 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14pfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>235585</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>