<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:19:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-2918] Race condition in Python TProcessPoolServer test</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-2918</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;&lt;tt&gt;make check&lt;/tt&gt; gets stuck very reproducible in my VM at Test run #218:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Test run #217:  (includes gen-py-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) Server=TProcessPoolServer,  Proto=accel,  zlib=False,  SSL=False
Testing server TProcessPoolServer: /usr/bin/python ./TestServer.py --genpydir=gen-py-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; --protocol=accel --port=9090 TProcessPoolServer
Testing client: /usr/bin/python ./TestClient.py --genpydir=gen-py-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; --protocol=accel --port=9090 --transport=buffered
...testException(Safe)
testException(Xception)
testException(throw_undeclared)
...............
----------------------------------------------------------------------
Ran 18 tests in 0.563s

OK
Giving TProcessPoolServer (proto=accel,zlib=False,ssl=False) an extra 3 seconds &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; childprocesses to terminate via alarm
Terminating worker: &amp;lt;&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;-1, started daemon)&amp;gt;
Terminating worker: &amp;lt;&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;-2, started daemon)&amp;gt;
Terminating worker: &amp;lt;&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;-3, started daemon)&amp;gt;
Terminating worker: &amp;lt;&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;-4, started daemon)&amp;gt;
Terminating worker: &amp;lt;&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;-5, started daemon)&amp;gt;
Requesting server to stop()
OK: Finished (includes gen-py-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;)  TProcessPoolServer / accel proto / zlib=False / SSL=False.   217 combinations tested.

Test run #218:  (includes gen-py-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) Server=TProcessPoolServer,  Proto=accel,  zlib=False,  SSL=True
Testing server TProcessPoolServer: /usr/bin/python ./TestServer.py --genpydir=gen-py-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; --protocol=accel --port=9090 --ssl TProcessPoolServer
Testing client: /usr/bin/python ./TestClient.py --genpydir=gen-py-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; --protocol=accel --port=9090 --ssl --transport=buffered
...testException(Safe)
testException(Xception)
testException(throw_undeclared)
..........Terminating worker: &amp;lt;&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;-1, started daemon)&amp;gt;
Terminating worker: &amp;lt;&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;-2, started daemon)&amp;gt;
Terminating worker: &amp;lt;&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;-3, started daemon)&amp;gt;
Terminating worker: &amp;lt;&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;-4, started daemon)&amp;gt;
Terminating worker: &amp;lt;&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;-5, started daemon)&amp;gt;
Requesting server to stop()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After fiddling a bit around with it I got it to work by increasing the alarm() timeout from 2 seconds to 4 seconds. &lt;/p&gt;

&lt;p&gt;I&apos;m not a Python expert, but the code looks somewhat interesting to me: &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The server code starts the workers, but some piece of code outside of the server is responsible for terminating them. Is that really idiomatic in Python or just bad design?&lt;/li&gt;
	&lt;li&gt;The Condition() object used in TProcessPoolsServer.py should probably be replaced by an Event() object. Especially, as Condition.wait() &lt;a href=&quot;http://stackoverflow.com/questions/24137480/threading-condition-waittimeout-ignores-threading-condition-notify&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;seems to have it&apos;s own perils&lt;/a&gt; and Event is much easier to use.&lt;/li&gt;
	&lt;li&gt;Calling Condition.aquire() without a matching release() within a &lt;tt&gt;while True:&lt;/tt&gt; loop looks also not very convincing to me. AFAIK the second call to aquire() will block, if that ever happens (it did not in my tests).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The bad news is, that neither of the proposed changes above had any effect on the race conditions, except increasing the timeout - but that is merely a workaround, not a solution.&lt;/p&gt;</description>
                <environment>&lt;p&gt;openSUSE 13.2&lt;br/&gt;
Python 2.7.8 (default, Sep 30 2014, 15:34:38) &lt;span class=&quot;error&quot;&gt;&amp;#91;GCC&amp;#93;&lt;/span&gt; on linux2&lt;/p&gt;</environment>
        <key id="12763951">THRIFT-2918</key>
            <summary>Race condition in Python TProcessPoolServer test</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jensg">Jens Geyer</assignee>
                                    <reporter username="jensg">Jens Geyer</reporter>
                        <labels>
                    </labels>
                <created>Sun, 28 Dec 2014 23:49:38 +0000</created>
                <updated>Thu, 17 Sep 2015 08:27:34 +0000</updated>
                            <resolved>Sat, 25 Jul 2015 13:45:30 +0000</resolved>
                                                    <fixVersion>0.9.3</fixVersion>
                                    <component>Python - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14259763" author="jensg" created="Sun, 28 Dec 2014 23:52:02 +0000"  >&lt;p&gt;Re the timeout: I came up with this because the log output lead me to the impression that the workers were terminated too early. But that&apos;s kind of a guess, I&apos;m not really sure about that.&lt;/p&gt;</comment>
                            <comment id="14641588" author="jensg" created="Sat, 25 Jul 2015 13:45:30 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="14641648" author="hudson" created="Sat, 25 Jul 2015 15:01:23 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #1622 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/1622/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/1622/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2918&quot; title=&quot;Race condition in Python TProcessPoolServer test&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2918&quot;&gt;&lt;del&gt;THRIFT-2918&lt;/del&gt;&lt;/a&gt; Race condition in Python TProcessPoolServer test (jensg: rev f7d327ae96d451ff76b80d7e952f9cc21a1c4464)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;test/py/TestServer.py&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14641662" author="jensg" created="Sat, 25 Jul 2015 15:12:45 +0000"  >&lt;p&gt;Same here: The fix does not even attempt to solve the underlying issue, but works for me. Feel free to reopen and improve.&lt;/p&gt;</comment>
                            <comment id="14791157" author="githubbot" created="Wed, 16 Sep 2015 21:32:29 +0000"  >&lt;p&gt;GitHub user bufferoverflow opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/606&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/606&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2918&quot; title=&quot;Race condition in Python TProcessPoolServer test&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2918&quot;&gt;&lt;del&gt;THRIFT-2918&lt;/del&gt;&lt;/a&gt; Race condition in Python TProcessPoolServer test&lt;/p&gt;

&lt;p&gt;    This makes python test pass on my machine.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/bufferoverflow/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/bufferoverflow/thrift&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2918&quot; title=&quot;Race condition in Python TProcessPoolServer test&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2918&quot;&gt;&lt;del&gt;THRIFT-2918&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/606.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/606.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #606&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 66192cf5394c71d499db179515b89820858fe402&lt;br/&gt;
Author: Roger Meier &amp;lt;roger@apache.org&amp;gt;&lt;br/&gt;
Date:   2015-09-16T17:53:07Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2918&quot; title=&quot;Race condition in Python TProcessPoolServer test&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2918&quot;&gt;&lt;del&gt;THRIFT-2918&lt;/del&gt;&lt;/a&gt; Race condition in Python TProcessPoolServer test&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14791733" author="githubbot" created="Thu, 17 Sep 2015 07:46:55 +0000"  >&lt;p&gt;Github user bufferoverflow commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/606#issuecomment-140994555&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/606#issuecomment-140994555&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    committed&lt;/p&gt;</comment>
                            <comment id="14791734" author="githubbot" created="Thu, 17 Sep 2015 07:46:56 +0000"  >&lt;p&gt;Github user bufferoverflow closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/606&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/606&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14791781" author="hudson" created="Thu, 17 Sep 2015 08:27:34 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #1656 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/1656/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/1656/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2918&quot; title=&quot;Race condition in Python TProcessPoolServer test&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2918&quot;&gt;&lt;del&gt;THRIFT-2918&lt;/del&gt;&lt;/a&gt; Race condition in Python TProcessPoolServer test (r.meier: rev 6857b7fe90bd1561b9b982f9063bccaa25107b1d)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;test/py/RunClientServer.py&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12747185" name="THRIFT-2918-python-test-timeouts.patch" size="489" author="jensg" created="Sat, 25 Jul 2015 13:43:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 9 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i23t27:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>