<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:57:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-815] Deserialization of lists is critically broken.</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-815</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;Edit the test code that comes with the js language target:&lt;/p&gt;

&lt;p&gt;  var list = &lt;span class=&quot;error&quot;&gt;&amp;#91;1,2,3&amp;#93;&lt;/span&gt;; &lt;br/&gt;
  var ret = client.testList(list);&lt;br/&gt;
  debugger;&lt;/p&gt;

&lt;p&gt;ret comes back as &lt;span class=&quot;error&quot;&gt;&amp;#91;3,3,3&amp;#93;&lt;/span&gt; when it should be echoed back as &lt;span class=&quot;error&quot;&gt;&amp;#91;1,2,3&amp;#93;&lt;/span&gt;&lt;br/&gt;
The test case never caught this because it only verified the size, and not the contents of the returned array. &lt;br/&gt;
I cannot find an immediate workaround, but I will try wrapping it in a dummy type like ListServiceResponse. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12468599">THRIFT-815</key>
            <summary>Deserialization of lists is critically broken.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tjake">T Jake Luciani</assignee>
                                    <reporter username="jordo">Jordan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 Jul 2010 01:58:25 +0000</created>
                <updated>Tue, 1 Nov 2011 02:51:38 +0000</updated>
                            <resolved>Tue, 10 Aug 2010 23:57:11 +0000</resolved>
                                    <version>0.4</version>
                                    <fixVersion>0.4</fixVersion>
                                    <component>JavaScript - Compiler</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12886124" author="jordo" created="Wed, 7 Jul 2010 22:28:19 +0000"  >&lt;p&gt;Is anyone interested in fixing this? I&apos;m afraid I don&apos;t know much about the code base. I&apos;d love to help fix this if anyone can provide me some direction. &lt;/p&gt;</comment>
                            <comment id="12886132" author="bryanduxbury" created="Wed, 7 Jul 2010 22:33:40 +0000"  >&lt;p&gt;Well for starters, you should amend the test to check not just the length but the contents. From there, I would look into the protocol implementation for bugs. I&apos;m neither a Thrift-JS contributor nor user, so I can&apos;t provide much more detail than that. If you find yourself with questions about the architecture of Thrift in general, feel free to toss questions up on the dev mailing list or find me in #thrift on freenode.&lt;/p&gt;</comment>
                            <comment id="12886160" author="tjake" created="Thu, 8 Jul 2010 00:00:51 +0000"  >&lt;p&gt;Hi Jordan,&lt;/p&gt;

&lt;p&gt;This is most likely a bug on the javascript protocol side.  if you step through the de-serialization in a browser I&apos;m sure you&apos;ll see the issue.&lt;/p&gt;

&lt;p&gt;Sorry I&apos;m unable to help out more at the moment.&lt;/p&gt;

&lt;p&gt;-Jake&lt;/p&gt;</comment>
                            <comment id="12886262" author="jordo" created="Thu, 8 Jul 2010 06:46:45 +0000"  >&lt;p&gt;Jake, &lt;br/&gt;
I&apos;ll try to track down where this is occurring exactly to provide enough info to pinpoint where the problem is coming from. &lt;/p&gt;</comment>
                            <comment id="12887006" author="jordo" created="Sat, 10 Jul 2010 07:03:36 +0000"  >&lt;p&gt;Jake, &lt;/p&gt;

&lt;p&gt;I stepped through the browser using firefox, and I could see that the first element from a list is obtained correctly and the second one is incorrect. I&apos;m not sure what is causing it. There&apos;s all sorts of crazy variable names such as rstack, rpos, r, fid, ftype that have no explanation or documentation. I&apos;ve exhausted a couple hours trying to see what&apos;s going on, and I can&apos;t seem to make sense of the code. Can you take a look this weekend? I think that this is the most critical bug so far in the js-compiler. &lt;/p&gt;</comment>
                            <comment id="12887043" author="tjake" created="Sat, 10 Jul 2010 15:00:00 +0000"  >&lt;p&gt;Fixed, thanks for finding this.&lt;/p&gt;</comment>
                            <comment id="12887055" author="jordo" created="Sat, 10 Jul 2010 16:49:15 +0000"  >&lt;p&gt;Thanks Jake, but I don&apos;t think that this works when the things in the list contains objects. &lt;/p&gt;

&lt;p&gt;I changed the testList method to accept a list of LoginResponse objects (that&apos;s one of my types) and tried the following code example:&lt;br/&gt;
On the server side, it should just return the same list, as before but now the list contains objects. &lt;/p&gt;

&lt;p&gt;  var arr = new Array(); &lt;br/&gt;
  var lr = new TheService.LoginResponse(&lt;/p&gt;
{validCredentials:true, sessionId:&quot;asdf&quot;}
&lt;p&gt;);                                                                                                                                                           &lt;br/&gt;
  arr.push(lr); &lt;br/&gt;
  lr = new TheService.LoginResponse(&lt;/p&gt;
{validCredentials:false, sessionId:&quot;ccc&quot;}
&lt;p&gt;);&lt;br/&gt;
  arr.push(lr);&lt;br/&gt;
  lr = new TheService.LoginResponse(&lt;/p&gt;
{validCredentials:false, sessionId:&quot;KKLK&quot;}
&lt;p&gt;);&lt;br/&gt;
  arr.push(lr);&lt;br/&gt;
  var ret = client.testList(arr);&lt;br/&gt;
  debugger;&lt;/p&gt;

&lt;p&gt;What I observe is that I get an empty (everything set to false etc.) first object, the second object is the &lt;b&gt;last&lt;/b&gt; object of the input list* and everything else is empty (everything set to false/0/etc).&lt;/p&gt;</comment>
                            <comment id="12887058" author="jordo" created="Sat, 10 Jul 2010 16:57:27 +0000"  >&lt;p&gt;See my last comment. (I think the provided fix won&apos;t fix the case when lists contain objects. )&lt;/p&gt;</comment>
                            <comment id="12887059" author="tjake" created="Sat, 10 Jul 2010 16:57:44 +0000"  >&lt;p&gt;hmm, could you provide a testcase?&lt;/p&gt;</comment>
                            <comment id="12887064" author="jordo" created="Sat, 10 Jul 2010 17:10:00 +0000"  >&lt;p&gt;Yes, but it will involve actually changing the service to include a method which accepts and returns a list of objects. &lt;br/&gt;
Do you just use diff to make the patches? &lt;/p&gt;</comment>
                            <comment id="12887066" author="tjake" created="Sat, 10 Jul 2010 17:14:54 +0000"  >&lt;p&gt;yeah, or you can just attach a tar of the test dir. thanks&lt;/p&gt;</comment>
                            <comment id="12887083" author="roger.meier" created="Sat, 10 Jul 2010 19:07:07 +0000"  >&lt;p&gt;The patch fixes the list type!&lt;/p&gt;

&lt;p&gt;attached is a qunit based test, that also contains utf-8 string tests, etc, not complete yet but it might be a starting point.&lt;/p&gt;

&lt;p&gt;Currently I use test/cpp/srcTestServer.cpp using the C++ HttpServer, provided by &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-247&quot; title=&quot;THttpServer Transport&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-247&quot;&gt;&lt;del&gt;THRIFT-247&lt;/del&gt;&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://svn.apache.org/repos/asf/incubator/thrift/trunk/test/ThriftTest.thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/incubator/thrift/trunk/test/ThriftTest.thrift&lt;/a&gt;&lt;br/&gt;
I&apos;m not sure if all supported Languages are doing the same within UnitTests....&lt;br/&gt;
e.g echo a list, etc.&lt;/p&gt;</comment>
                            <comment id="12887094" author="roger.meier" created="Sat, 10 Jul 2010 21:34:32 +0000"  >&lt;p&gt;The patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12449170/THRIFT-815_thrift.js.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;THRIFT-815_thrift.js.patch &lt;/a&gt; fixes wrong order on wire:&lt;/p&gt;

&lt;p&gt;detected with the Unit Test provided above and Firebug&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-javascript&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; list = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Array(1,2,3)
    test(&lt;span class=&quot;code-quote&quot;&gt;&quot;List&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;function&lt;/span&gt;() {
      ok(client.testList(list), list);
    });
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;Wire:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;out: [1,&lt;span class=&quot;code-quote&quot;&gt;&quot;testList&quot;&lt;/span&gt;,1,0,{&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;lst&quot;&lt;/span&gt;:[&lt;span class=&quot;code-quote&quot;&gt;&quot;i32&quot;&lt;/span&gt;,3,3,2,1]}}]
in:   [1,&lt;span class=&quot;code-quote&quot;&gt;&quot;testList&quot;&lt;/span&gt;,2,0,{&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;lst&quot;&lt;/span&gt;:[&lt;span class=&quot;code-quote&quot;&gt;&quot;i32&quot;&lt;/span&gt;,3,3,2,1]}}]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With that patch:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;out: [1,&lt;span class=&quot;code-quote&quot;&gt;&quot;testList&quot;&lt;/span&gt;,1,0,{&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;lst&quot;&lt;/span&gt;:[&lt;span class=&quot;code-quote&quot;&gt;&quot;i32&quot;&lt;/span&gt;,3,1,2,3]}}]
in:   [1,&lt;span class=&quot;code-quote&quot;&gt;&quot;testList&quot;&lt;/span&gt;,2,0,{&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;lst&quot;&lt;/span&gt;:[&lt;span class=&quot;code-quote&quot;&gt;&quot;i32&quot;&lt;/span&gt;,3,1,2,3]}}]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12887096" author="tjake" created="Sat, 10 Jul 2010 21:51:40 +0000"  >&lt;p&gt;Cool! this test framework you added is nice.&lt;/p&gt;

&lt;p&gt;I&apos;ve got a number of other tests failing, let me tinker with this a bit... Thanks&lt;/p&gt;</comment>
                            <comment id="12887137" author="jordo" created="Sun, 11 Jul 2010 02:50:54 +0000"  >&lt;p&gt;If you&apos;re adding test cases, don&apos;t forget the null being translated into dummy objects:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-816&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/THRIFT-816&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12887138" author="jordo" created="Sun, 11 Jul 2010 03:05:02 +0000"  >&lt;p&gt;I just tested objects that are declared as &quot;Set&quot;s of objects, and I experience the same problem. The fix doesn&apos;t work for Sets of complex (non-primitive) objects either.&lt;br/&gt;
The symptoms are exactly the same as with Lists of objects. &lt;/p&gt;</comment>
                            <comment id="12887671" author="jordo" created="Tue, 13 Jul 2010 06:33:20 +0000"  >&lt;p&gt;For the record, I&apos;ve applied both patches, and, while it may fix the order and primitive objects, it doesn&apos;t seem to work for lists/sets that contain objects (as defined in the thrift models.)&lt;br/&gt;
For instance, if one of my operations returns a list&amp;lt;i32&amp;gt; it works fine, but if I change the service to return a list&amp;lt;Car&amp;gt; it will not work. &lt;br/&gt;
I just wanted to clarify that I had tried both patches. I will look some more into the code, but I&apos;m not very optimistic about being able to understand what&apos;s going on in thrift.js without some simple documentation. &lt;/p&gt;</comment>
                            <comment id="12887686" author="jordo" created="Tue, 13 Jul 2010 08:03:10 +0000"  >&lt;p&gt;I don&apos;t know what&apos;s &lt;b&gt;supposed&lt;/b&gt; to happen, but around line 510-530 in thrift.js seems wrong. When we read a list, we delete an element off of the front of the list, and pop it on top of the rstack, then around the the following part of the code, we treat the object that we just popped on top of the stack, as if it were a field of an object itself. It is NOT. It is an object, not a field of an object. So things are failing because of this, and I&apos;m not sure why we were popping an object on top in the first place. Can someone look at this? &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Bar.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            &lt;span class=&quot;code-comment&quot;&gt;//remove so we don&apos;t see it again
&lt;/span&gt;            delete &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rstack[&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rstack.length-1][fid]

            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rstack.push(field)      

            &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;
        }

        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(fid != -1){ 

            &lt;span class=&quot;code-comment&quot;&gt;//should only be 1 of these but &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is the only
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;//way to match a key
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; f in (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rstack[&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rstack.length-1])){
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(Thrift.Protocol.RType[f] == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ) &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;

                ftype = Thrift.Protocol.RType[f];

                &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rstack[&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rstack.length-1] = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rstack[&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rstack.length-1][f];

            }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;  </comment>
                            <comment id="12887946" author="roger.meier" created="Tue, 13 Jul 2010 19:34:42 +0000"  >&lt;p&gt;Hi Jordan!&lt;br/&gt;
code snippets? just use the question mark and preview function on the right side of the input box to get help on formating text &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Cool, you did some tests with both patches and they work! What do you think about the QUnit based test? Is there another framework you would recommend?&lt;/p&gt;

&lt;p&gt;@Jake:&lt;br/&gt;
Could you commit the patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12449170/THRIFT-815_thrift.js.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;THRIFT-815_thrift.js.patch &lt;/a&gt; , that fixes the wire order? ... I would like to commit, but I can&apos;t....&lt;br/&gt;
I would appreciate if you could commit the JavaScript test.html with the Unit tests as well.&lt;br/&gt;
This might be a place where Jordan&apos;s likes to contribute?&lt;/p&gt;

&lt;p&gt;Adding test cases for all defined functions at &lt;a href=&quot;https://svn.apache.org/repos/asf/incubator/thrift/trunk/test/ThriftTest.thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ThriftTest.thrift &lt;/a&gt; is an important thing, for finding bugs inside the List&amp;lt;Object&amp;gt; serialization and other.&lt;/p&gt;

&lt;p&gt;Another BIG question is the server side for the tests, I use test/cpp/srcTestServer.cpp using the C++ HttpServer, provided by &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-247&quot; title=&quot;THttpServer Transport&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-247&quot;&gt;&lt;del&gt;THRIFT-247&lt;/del&gt;&lt;/a&gt; (please commit...). It seems, that many different tests for several Languages exist, but they do different things inside and are therefore not useful for interacting with eachother.....I think this is an important thing to standardize.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-35&quot; title=&quot;Move language tests into their appropriate library directory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-35&quot;&gt;&lt;del&gt;THRIFT-35&lt;/del&gt;&lt;/a&gt; mentions that all language tests have to be moved into their appropriate library directory, this will cleanup the test directory and it can be used for describing standard tests cases, that have to be implemented in every language.&lt;/p&gt;</comment>
                            <comment id="12888004" author="jordo" created="Tue, 13 Jul 2010 21:01:12 +0000"  >&lt;p&gt;Roger, &lt;/p&gt;

&lt;p&gt;Thanks for the tips on formatting. &lt;br/&gt;
You are correct that I tried both patches, but they do not fix the major problem. Do you think we should wait until we figure out what&apos;s going wrong and fix it before submitting the patch? &lt;/p&gt;

&lt;p&gt;The patches do not fix lists of objects and sets of objects. My previous comment was the result of me stepping though the code in firebug. &lt;/p&gt;</comment>
                            <comment id="12888026" author="roger.meier" created="Tue, 13 Jul 2010 21:36:00 +0000"  >&lt;p&gt;Jordan,&lt;/p&gt;

&lt;p&gt;my philosophy would be: &lt;b&gt;&lt;cite&gt;Every thing that goes into the right direction and fixes bugs should be commited.&lt;/cite&gt;&lt;/b&gt;&lt;br/&gt;
Now Lists with simple types work properly with these patches. =&amp;gt; That&apos;s a &lt;b&gt;good&lt;/b&gt; thing!&lt;/p&gt;

&lt;p&gt;I really do not like to work with a local code base, that contains many patches! see my &lt;b&gt;svn status&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;M      test/cpp/Thrift-test.mk
M      test/cpp/src/TestClient.cpp
M      test/cpp/src/main.cpp
M      test/cpp/src/TestServer.cpp
M      lib/cpp/src/protocol/TProtocol.h
A      lib/cpp/src/transport/THttpServer.h
M      lib/cpp/src/transport/THttpClient.cpp
M      lib/cpp/src/transport/THttpClient.h
A      lib/cpp/src/transport/THttpTransport.cpp
A      lib/cpp/src/transport/THttpTransport.h
A      lib/cpp/src/transport/THttpServer.cpp
M      lib/cpp/Makefile.am
M      lib/js/test/test.html
M      lib/js/thrift.js
M      compiler/cpp/src/generate/t_js_generator.cc
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We should proceed with enhancing the Test Framework to have a good basis for finding the pending bug&apos;s.&lt;/p&gt;

&lt;p&gt;I&apos;m especially interested in C++ and JavaScript bindings and I would like to help fixing bugs and enhancing Thrift!&lt;/p&gt;</comment>
                            <comment id="12889475" author="jordo" created="Sat, 17 Jul 2010 08:14:36 +0000"  >&lt;p&gt;Would someone like to join me in a phone call, in order to explain how the javascript code works? That way I can be more productive in fixing these bugs.&lt;/p&gt;</comment>
                            <comment id="12893400" author="tjake" created="Wed, 28 Jul 2010 22:33:02 +0000"  >&lt;p&gt;Ok, I&apos;ve committed the fixes and test cases all pass now.  Please take a look and let me know if this addresses your issues.&lt;/p&gt;</comment>
                            <comment id="12893551" author="jordo" created="Thu, 29 Jul 2010 08:36:25 +0000"  >&lt;p&gt;Jake, &lt;/p&gt;

&lt;p&gt;Thank you for making these fixes and tidying up the test cases, but this issue shouldn&apos;t be resolved until returning lists of &lt;b&gt;objects&lt;/b&gt; is fixed. Currently I believe this to still be broken unless you added a fix that I was unaware of.. &lt;/p&gt;

&lt;p&gt;I&apos;m going to reassign this ticket, please re-resolve if I am mistaken. &lt;/p&gt;</comment>
                            <comment id="12893553" author="jordo" created="Thu, 29 Jul 2010 08:37:01 +0000"  >&lt;p&gt;Reopening ticket, as I believe returning lists of &lt;b&gt;objects&lt;/b&gt; is still broken.&lt;/p&gt;</comment>
                            <comment id="12893803" author="roger.meier" created="Thu, 29 Jul 2010 20:20:25 +0000"  >&lt;p&gt;Thanks Jake, for applying the QUnit based test.html and the bugfixes. I appreciate that very much!&lt;/p&gt;

&lt;p&gt;From my perspective, Lists and Sets with Basetypes are fixed!&lt;/p&gt;

&lt;p&gt;But I still have issues with other Types (Map, MapMap and testInsanity from ThriftTest.thrift): &lt;br/&gt;
see &lt;a href=&quot;http://www.bufferoverflow.ch/thrift/test/test.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.bufferoverflow.ch/thrift/test/test.html&lt;/a&gt; (r980253)&lt;br/&gt;
and &lt;a href=&quot;http://www.bufferoverflow.ch/thrift/test/test_roger.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.bufferoverflow.ch/thrift/test/test_roger.html&lt;/a&gt; with more unit tests.&lt;/p&gt;

&lt;p&gt;I&apos;m using TestServer.cpp in combination with THttpServer.cpp&lt;/p&gt;</comment>
                            <comment id="12895094" author="tjake" created="Wed, 4 Aug 2010 00:05:07 +0000"  >&lt;p&gt;Hmm, all these work for me.&lt;/p&gt;

&lt;p&gt;Have you tried it with the java server?  it&apos;s running here: &lt;a href=&quot;http://3.rdrail.net:8088/test/test.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://3.rdrail.net:8088/test/test.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This includes a list of objects in testInsanity()&lt;/p&gt;

&lt;p&gt;I guess there could be an encoding issue with the c++ server...&lt;/p&gt;</comment>
                            <comment id="12895107" author="jordo" created="Wed, 4 Aug 2010 00:33:12 +0000"  >&lt;p&gt;Jake, &lt;/p&gt;

&lt;p&gt;I&apos;ll have to check, but I remember the symptoms of the problem with lists of objects, was that the results would have maybe one or two valid objects, and the rest were missing. Or even worse, and object would be duplicated in the place of all of the objects, and the others would be missing. I recall that testInsanity didn&apos;t check these edge cases (unless you fixed it.)&lt;br/&gt;
I&apos;m not currently able to get the most recent Thrift to build on my desktop, but I&apos;ll see if I can pinpoint where the test is lacking.&lt;/p&gt;</comment>
                            <comment id="12895385" author="roger.meier" created="Wed, 4 Aug 2010 19:48:19 +0000"  >&lt;p&gt;I did not test with the Java Server. It seems, that it returns other values as the C++ Test Server for Exceptions, all the other things are just the same, but testInsanity is broken on both test sites.&lt;/p&gt;

&lt;p&gt;Is there a defined standard for Interoperability tests across all languages?&lt;/p&gt;

&lt;p&gt;I can not imagine that there are some error&apos;s with the c++ encoding. I did some tests with JSON and Binary with simple and HTTP Server. I verified the JSON Packets on wire for HTTP and regular TCP transport. =&amp;gt; Everything is correct.&lt;/p&gt;

&lt;p&gt;The other test I&apos;ve added does verify more details and uses &lt;a href=&quot;http://www.JSON.org/json2.js&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;json2 &lt;/a&gt; in addition to QUnit.&lt;br/&gt;
see: &lt;a href=&quot;http://www.bufferoverflow.ch/thrift/test/test_roger.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.bufferoverflow.ch/thrift/test/test_roger.html&lt;/a&gt;&lt;br/&gt;
There, I recognized some error&apos;s with map types.&lt;/p&gt;

&lt;p&gt;As mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-829&quot; title=&quot;Need assistance in getting ramped up on code base. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-829&quot;&gt;&lt;del&gt;THRIFT-829&lt;/del&gt;&lt;/a&gt;, Im still not sure if loading the JSON response into one object (robj) and reading parts of that object depending on the data type is a problem for decoding Thrift JSON Protocol within JavaScript.&lt;br/&gt;
I think, that all Languages supported by Thrift do parse the JSON message within the Protocol Implementation without special functions like the eval function provided by JavaScript.&lt;/p&gt;
</comment>
                            <comment id="12895887" author="tjake" created="Fri, 6 Aug 2010 00:12:21 +0000"  >&lt;p&gt;Ah, I see, all the tests pass in Chrome (which I use)  I checked in Safari and FF and test Insanity is now failing for me.&lt;/p&gt;

&lt;p&gt;Let me take a look and get it fixed. I&apos;ll also take a look at the c++ server. However If it passes with java server I&apos;d consider this particular issue resolved.&lt;br/&gt;
We can open a new one for C++ issues.&lt;/p&gt;

&lt;p&gt;Also, I don&apos;t agree with the idea of implementing the json protocol with string parsing,  js engines are very good at marshaling json its going to be much more efficient doing it this way IMO.&lt;/p&gt;
</comment>
                            <comment id="12895928" author="tjake" created="Fri, 6 Aug 2010 02:39:44 +0000"  >&lt;p&gt;I&apos;ve committed a fix for testInsanity for FF and Safari. Please take a look.&lt;/p&gt;</comment>
                            <comment id="12895939" author="jordo" created="Fri, 6 Aug 2010 03:41:33 +0000"  >&lt;p&gt;Can you describe what the difference is for firefox? &lt;/p&gt;</comment>
                            <comment id="12896420" author="roger.meier" created="Sun, 8 Aug 2010 21:53:34 +0000"  >&lt;p&gt;I have the Java Test Server up and running! =&amp;gt; The current trunk version passes the tests!&lt;br/&gt;
see: &lt;a href=&quot;http://www.bufferoverflow.ch:8088/test/test.orig.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.bufferoverflow.ch:8088/test/test.orig.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As mentioned I added a few additional Tests, see&lt;br/&gt;
&lt;a href=&quot;http://www.bufferoverflow.ch:8088/test/test.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.bufferoverflow.ch:8088/test/test.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The patch(THRIFT_815_TestFramework_test.html_json2.patch) contains additional tests, adds the Apache License Header to test.html again and adds json2 which is Public Domain.&lt;/p&gt;

&lt;p&gt;I absolutely agree, that implementing Thrift JSON Protocol based on string parsing is not that efficient as the eval approach.&lt;br/&gt;
However, during my debug and bug fixing (list element order on wire) sessions I was often confused by the values of rstack and rpos inside thrift.js, especially with map and mapmap objects. That&apos;s why I&apos;m thinking about a classic string parsing approach.&lt;/p&gt;</comment>
                            <comment id="12897087" author="tjake" created="Tue, 10 Aug 2010 23:56:56 +0000"  >&lt;p&gt;Hi Roger,&lt;/p&gt;

&lt;p&gt;I&apos;d like to mark this issue resolved. We can work on your extended testcase in another ticket. Please create this.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;-Jake&lt;/p&gt;
</comment>
                            <comment id="12897375" author="roger.meier" created="Wed, 11 Aug 2010 18:38:37 +0000"  >&lt;p&gt;Hi Jake&lt;/p&gt;

&lt;p&gt;I fully agree, with your proposal! &lt;/p&gt;

&lt;p&gt;Just created &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-846&quot; title=&quot;JavaScript Test Framwork: extended Testcases&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-846&quot;&gt;&lt;del&gt;THRIFT-846&lt;/del&gt;&lt;/a&gt; to extend the Test Framework.&lt;/p&gt;

&lt;p&gt;Regards Roger&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12449158" name="813-1.patch" size="1320" author="tjake" created="Sat, 10 Jul 2010 14:58:24 +0000"/>
                            <attachment id="12449170" name="THRIFT-815_thrift.js.patch" size="1059" author="roger" created="Sat, 10 Jul 2010 21:34:32 +0000"/>
                            <attachment id="12451537" name="THRIFT_815_TestFramework_test.html_json2.patch" size="30534" author="roger" created="Sun, 8 Aug 2010 21:53:34 +0000"/>
                            <attachment id="12449165" name="test.html" size="7698" author="roger" created="Sat, 10 Jul 2010 19:07:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>186966</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 15 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16c7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245111</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>