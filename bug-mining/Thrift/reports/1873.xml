<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:28:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-4465] TNonblockingServer throwing THRIFT LOGGER: TConnection::workSocket(): THRIFT_EAGAIN (unavailable resources)</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-4465</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;Once I upgraded to 0.11.0, I&apos;m getting the following error occasionally:&lt;/p&gt;

&lt;p&gt;THRIFT LOGGER: TConnection::workSocket(): THRIFT_EAGAIN (unavailable resources)&lt;/p&gt;

&lt;p&gt;I tracked this to the following change: &lt;a href=&quot;https://github.com/apache/thrift/commit/808d143245f4f5c30600fab31cf9db854cbf5b48#diff-fe8fec8ec38ea35df64cfcc305e3ab08&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/commit/808d143245f4f5c30600fab31cf9db854cbf5b48#diff-fe8fec8ec38ea35df64cfcc305e3ab08&lt;/a&gt;&lt;br/&gt;
 &#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// Work the socket right away
&lt;/span&gt;
- &lt;span class=&quot;code-comment&quot;&gt;// workSocket();
&lt;/span&gt;
+ workSocket();

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;While adding SSL support, @dthaluru has re-activated the above line. From my own testing, this causes occasional THRIFT_EAGAIN exceptions. It seems like this is due to calling workSocket() too early and the socket gets a read call in non-blocking mode before it has data.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13132493">THRIFT-4465</key>
            <summary>TNonblockingServer throwing THRIFT LOGGER: TConnection::workSocket(): THRIFT_EAGAIN (unavailable resources)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jking3">James E. King III</assignee>
                                    <reporter username="bgedik">Bu&#287;ra Gedik</reporter>
                        <labels>
                    </labels>
                <created>Sun, 21 Jan 2018 08:58:23 +0000</created>
                <updated>Thu, 27 Dec 2018 15:24:58 +0000</updated>
                            <resolved>Mon, 12 Mar 2018 10:57:22 +0000</resolved>
                                    <version>0.11.0</version>
                                    <fixVersion>0.12.0</fixVersion>
                                    <component>C++ - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16333510" author="jking3" created="Sun, 21 Jan 2018 13:22:32 +0000"  >&lt;p&gt;Thanks for the analysis; can you throw a pull request into the system with that line removed (along with its comment) so it never returns?&lt;/p&gt;</comment>
                            <comment id="16333601" author="bgedik" created="Sun, 21 Jan 2018 17:20:00 +0000"  >&lt;p&gt;OK, I&apos;m creating a PR now. I saw 2 other places where this exact same line was already commented out. I thought a better fix is to kill these commented out lines altogether, so that they do not confuse the developers going forward.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16333605" author="bgedik" created="Sun, 21 Jan 2018 17:46:34 +0000"  >&lt;p&gt;Here: &lt;a href=&quot;https://github.com/apache/thrift/pull/1476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1476&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16333631" author="bgedik" created="Sun, 21 Jan 2018 19:06:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jking3&quot; class=&quot;user-hover&quot; rel=&quot;jking3&quot;&gt;jking3&lt;/a&gt;: While removing the &lt;tt&gt;workSocket()&lt;/tt&gt; fixes the problem for the regular sockets, it breaks SSL based sockets. It turns out the SSL sockets circumvent the spurious exceptions via the following code.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160;} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (TTransportException&amp;amp; te) {
&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-comment&quot;&gt;//In Nonblocking SSLSocket some operations need to be retried again.
&lt;/span&gt;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-comment&quot;&gt;//Current approach is parsing exception message, but a better solution needs to be investigated.
&lt;/span&gt;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(!strstr(te.what(), &lt;span class=&quot;code-quote&quot;&gt;&quot;retry&quot;&lt;/span&gt;)) {
&#160;&#160;&#160;&#160;&#160;&#160;&#160; GlobalOutput.printf(&lt;span class=&quot;code-quote&quot;&gt;&quot;TConnection::workSocket(): %s&quot;&lt;/span&gt;, te.what());
&#160;&#160;&#160;&#160;&#160;&#160;&#160; close();
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
&#160;&#160;&#160;&#160;&#160; }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This looks wrong at so many levels if you ask me. Handling retries with an exception is a performance killer. Then there is the issue of searching for a message string in the exception. In any case, the original code before the SSL changes assumed that you only consume from a socket once it is ready for reading, so you never get an exception. By uncommenting the premature workStatus() call, the SSL PR changed this and handled the resulting exception with the above code, but only for the SSL setup, and not for regular sockets!!!&lt;/p&gt;

&lt;p&gt;I&apos;ll see if I can figure out:&lt;/p&gt;

&lt;p&gt;1) Why does SSL server depend on the premature workStatus() call?&lt;/p&gt;

&lt;p&gt;2) Can the SSL server be changed to work without having to perform retries with an exception?&lt;/p&gt;

&lt;p&gt;&#160;I don&apos;t see&#160;Divya Thaluru in the system, who is the original author of the SSL extensions. &lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16333756" author="bgedik" created="Mon, 22 Jan 2018 00:36:42 +0000"  >&lt;p&gt;I think the workSocket() is needed if there is more data than the frame size and not needed otherwise. I made a fix accordingly.&lt;/p&gt;</comment>
                            <comment id="16333761" author="bgedik" created="Mon, 22 Jan 2018 01:05:35 +0000"  >&lt;p&gt;Not much luck &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;&lt;tt&gt;TSocket::peek&lt;/tt&gt; is not implemented in a meaningful way for non-blocking sockets and the&#160;&lt;tt&gt;TSSLSocket::peek&lt;/tt&gt; is not even libevent safe. In fact, the root cause of the problem seems to be that the&#160;&lt;tt&gt;TSocket&lt;/tt&gt; class does not seem to understand the difference between non-blocking and blocking sockets.&lt;/p&gt;</comment>
                            <comment id="16335314" author="bgedik" created="Tue, 23 Jan 2018 02:13:36 +0000"  >&lt;p&gt;I created the PR that fixes this here: &lt;a href=&quot;https://github.com/apache/thrift/pull/1476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1476&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16379366" author="bgedik" created="Tue, 27 Feb 2018 22:04:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jking3&quot; class=&quot;user-hover&quot; rel=&quot;jking3&quot;&gt;jking3&lt;/a&gt;: would it be possible to get this in: Here is the squashed version:&#160;&lt;a href=&quot;https://github.com/apache/thrift/pull/1497&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1497&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16394659" author="githubbot" created="Sun, 11 Mar 2018 21:21:59 +0000"  >&lt;p&gt;Github user bgedik commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1497&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1497&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @jeking3 There is already a Jira item: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4465&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/THRIFT-4465&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Btw, it makes sense that the fix resolves the framed transport failures. Because the bug was about the transition from the frame size reading to the frame content reading.&lt;/p&gt;</comment>
                            <comment id="16395074" author="jking3" created="Mon, 12 Mar 2018 10:57:22 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;commit 8bcb7ac2be2f28e5fddfe578645c2aaa98b94717 (HEAD -&amp;gt; master, origin/master, origin/HEAD)
Author: Bugra Gedik &amp;lt;bgedik@unscrambl.com&amp;gt;
Date:   Sun Jan 21 09:43:49 2018 -0800

    THRIFT-4465: Fix C++ TNonblockingServer and THRIFT_EAGAIN issues
    Client: cpp
    
    This closes #1497
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13092752">THRIFT-4276</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 36 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3p5if:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>