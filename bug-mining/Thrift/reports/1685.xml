<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:25:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-3968] Deserializing empty string/binary fields</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-3968</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;If we use a string inside struct definition and set the value to &quot;&quot; (empty string, not NULL) when de-serializing it we get set it NULL and and the same time the __isset field for this value is set to TRUE which is think is not correct. &lt;/p&gt;

&lt;p&gt;Either we fix the library to return an empty string, or fix the compiler to set the __isset filed to FALSE.&lt;/p&gt;

&lt;p&gt;What would be the best way to solve this?&lt;br/&gt;
Please, let me know if you need any more information.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13019920">THRIFT-3968</key>
            <summary>Deserializing empty string/binary fields</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="simonsouth">Simon South</assignee>
                                    <reporter username="matejkupljen">Matej Kupljen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Nov 2016 19:27:06 +0000</created>
                <updated>Sat, 20 Feb 2021 15:28:10 +0000</updated>
                            <resolved>Thu, 22 Dec 2016 11:47:12 +0000</resolved>
                                    <version>0.9.3</version>
                                    <fixVersion>0.11.0</fixVersion>
                                    <component>C glib - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15677617" author="simonsouth" created="Fri, 18 Nov 2016 20:09:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=matejkupljen&quot; class=&quot;user-hover&quot; rel=&quot;matejkupljen&quot;&gt;matejkupljen&lt;/a&gt;, looking at &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=thrift.git;a=blob;f=lib/cpp/test/AllProtocolTests.tcc;h=8c8eaa8bf98d2259d164b4e2d1c32db7cd863b11;hb=16a23a6618754a5a87aeb8df99a72516b0272fb3#l205&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the C++ implementation&lt;/a&gt; it seems clear an empty string should be serialized and deserialized as-is; that is, the C (GLib) implementation should not be returning NULL in place of an empty string deserialized from a transport (as I&apos;ve confirmed it does).&lt;/p&gt;

&lt;p&gt;I&apos;m working on test cases and a fix for this now.&lt;/p&gt;</comment>
                            <comment id="15677893" author="simonsouth" created="Fri, 18 Nov 2016 22:00:34 +0000"  >&lt;p&gt;I&apos;ve attached a pair of patches that add suitable test cases and fix the behaviour of the two protocols the implementation supports, binary and compact.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=matejkupljen&quot; class=&quot;user-hover&quot; rel=&quot;matejkupljen&quot;&gt;matejkupljen&lt;/a&gt;, if you have a chance, please apply these patches and let me know if this resolves the issue.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cjmay&quot; class=&quot;user-hover&quot; rel=&quot;cjmay&quot;&gt;cjmay&lt;/a&gt;, could you give these a second look please to make sure the changes are appropriate?&lt;/p&gt;</comment>
                            <comment id="15693336" author="matejkupljen" created="Thu, 24 Nov 2016 13:53:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=simonsouth&quot; class=&quot;user-hover&quot; rel=&quot;simonsouth&quot;&gt;simonsouth&lt;/a&gt; I have used that patch on 0.9.3 release version, just modified to apply to that version, and it is working. Thanks.&lt;/p&gt;</comment>
                            <comment id="15693409" author="simonsouth" created="Thu, 24 Nov 2016 14:25:30 +0000"  >&lt;p&gt;Great. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cjmay&quot; class=&quot;user-hover&quot; rel=&quot;cjmay&quot;&gt;cjmay&lt;/a&gt;, if you have no feedback I&apos;ll commit within a couple days.&lt;/p&gt;</comment>
                            <comment id="15693554" author="cjmay" created="Thu, 24 Nov 2016 15:35:50 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=simonsouth&quot; class=&quot;user-hover&quot; rel=&quot;simonsouth&quot;&gt;simonsouth&lt;/a&gt;, I&apos;m sorry for such a long delay.  This looks good to me.&lt;/p&gt;

&lt;p&gt;Also, it seems empty binary fields are read the same way.  Should we create an analogous issue and patch for it?&lt;/p&gt;</comment>
                            <comment id="15693589" author="simonsouth" created="Thu, 24 Nov 2016 15:51:42 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cjmay&quot; class=&quot;user-hover&quot; rel=&quot;cjmay&quot;&gt;cjmay&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure what the behaviour for empty binary fields should be. How does the C++ implementation handle them?&lt;/p&gt;</comment>
                            <comment id="15698350" author="cjmay" created="Sat, 26 Nov 2016 18:55:18 +0000"  >&lt;p&gt;The C++ implementation also returns empty strings when the length is zero:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/thrift/blob/master/lib/cpp/src/thrift/protocol/TBinaryProtocol.tcc#L433&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/blob/master/lib/cpp/src/thrift/protocol/TBinaryProtocol.tcc#L433&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/thrift/blob/master/lib/cpp/src/thrift/protocol/TCompactProtocol.tcc#L685&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/blob/master/lib/cpp/src/thrift/protocol/TCompactProtocol.tcc#L685&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15738769" author="simonsouth" created="Sun, 11 Dec 2016 00:48:04 +0000"  >&lt;p&gt;Having looked into this, I think the existing implementation is correct.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=thrift.git;a=blob;f=lib/cpp/src/thrift/protocol/TProtocol.h;h=eb323b0cb0654ec0a121976fa9ea22b2634ba30a;hb=16a23a6618754a5a87aeb8df99a72516b0272fb3#l601&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;The C++ implementation&apos;s &lt;tt&gt;readBinary&lt;/tt&gt; method&lt;/a&gt; returns a &lt;tt&gt;std::string&lt;/tt&gt;, while &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=thrift.git;a=blob;f=lib/c_glib/src/thrift/c_glib/protocol/thrift_protocol.h;h=58fe5e0afa9ee27c0988c4c4ce20f73687e8aca0;hb=16a23a6618754a5a87aeb8df99a72516b0272fb3#l172&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the C (GLib) equivalent&lt;/a&gt; returns a pointer to a buffer in memory. While the concept of a zero-length string exists, there isn&apos;t really such a thing as a zero-length memory buffer, except one represented by a null pointer&amp;mdash;which is what the current implementation returns.&lt;/p&gt;

&lt;p&gt;Even explicitly allocating a zero-length buffer would achieve only the same behaviour. From &lt;a href=&quot;https://developer.gnome.org/glib/2.26/glib-Memory-Allocation.html#g-new&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the GLib reference manual&apos;s entry on &lt;tt&gt;g_new&lt;/tt&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Allocates n_structs elements of type struct_type... If n_structs is 0 it returns NULL.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So I think the existing implementation is correct, unless we want to go as far as reimplementing the binary-field methods to work with strings instead. I recommend we leave things as they are.&lt;/p&gt;

&lt;p&gt;I&apos;ve updated the first patch with test cases that illustrate explicitly the handling of zero-length binary fields, but otherwise I think the work here is complete. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cjmay&quot; class=&quot;user-hover&quot; rel=&quot;cjmay&quot;&gt;cjmay&lt;/a&gt;, any additional thoughts before I commit?&lt;/p&gt;</comment>
                            <comment id="15769865" author="simonsouth" created="Thu, 22 Dec 2016 11:47:12 +0000"  >&lt;p&gt;Committed. Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=matejkupljen&quot; class=&quot;user-hover&quot; rel=&quot;matejkupljen&quot;&gt;matejkupljen&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cjmay&quot; class=&quot;user-hover&quot; rel=&quot;cjmay&quot;&gt;cjmay&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12842687" name="0-thrift-3968-add-test-cases.patch" size="8344" author="simonsouth" created="Sun, 11 Dec 2016 00:48:04 +0000"/>
                            <attachment id="12839620" name="1-thrift-3968-deserialize-empty-string.patch" size="2758" author="simonsouth" created="Fri, 18 Nov 2016 22:00:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 47 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i366v3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>