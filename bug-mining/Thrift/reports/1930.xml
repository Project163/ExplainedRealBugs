<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:29:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-4662] Rust const string calls function at compile time</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-4662</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;&lt;b&gt;For this thrift:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;const string broker_playback_message = &quot;mmi.developer.playback&quot;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Generates:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;// thrift -gen rs -out ../rust/thrift/src const_string.thrift&lt;/p&gt;

&lt;p&gt;pub const BROKER_PLAYBACK_MESSAGE: String = &quot;mmi.developer.playback&quot;.to_owned();&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Fails to compile:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;error&lt;span class=&quot;error&quot;&gt;&amp;#91;E0015&amp;#93;&lt;/span&gt;: calls in constants are limited to tuple structs and tuple variants&lt;br/&gt;
note: a limited form of compile-time function evaluation is available on a nightly compiler via `const fn`&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Fix:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Probably want to output:&lt;/p&gt;

&lt;p&gt;pub const BROKER_PLAYBACK_MESSAGE: &amp;amp;str = &quot;mmi.developer.playback&quot;;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Looking at render_const_value() it looks like byte arrays will have the same issue.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;C:\Users\jake&amp;gt;rustup show&lt;br/&gt;
Default host: x86_64-pc-windows-msvc&lt;/p&gt;

&lt;p&gt;stable-x86_64-pc-windows-msvc (default)&lt;br/&gt;
rustc 1.30.0 (da5f414c2 2018-10-24)&lt;/p&gt;</environment>
        <key id="13196749">THRIFT-4662</key>
            <summary>Rust const string calls function at compile time</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="allengeorge">Allen George</assignee>
                                    <reporter username="jeikabu">J W</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 Nov 2018 06:51:55 +0000</created>
                <updated>Thu, 27 Dec 2018 15:24:49 +0000</updated>
                            <resolved>Mon, 12 Nov 2018 12:51:51 +0000</resolved>
                                    <version>0.11.0</version>
                                    <fixVersion>0.12.0</fixVersion>
                                    <component>Rust - Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16677894" author="githubbot" created="Wed, 7 Nov 2018 09:22:57 +0000"  >&lt;p&gt;jake-ruyi opened a new pull request #1624: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4662&quot; title=&quot;Rust const string calls function at compile time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4662&quot;&gt;&lt;del&gt;THRIFT-4662&lt;/del&gt;&lt;/a&gt;: Rust const string calls function at compile time&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1624&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1624&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Client: rs&lt;/p&gt;

&lt;p&gt;   Fix with simple test&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16678210" author="githubbot" created="Wed, 7 Nov 2018 13:18:25 +0000"  >&lt;p&gt;allengeorge commented on a change in pull request #1624: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4662&quot; title=&quot;Rust const string calls function at compile time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4662&quot;&gt;&lt;del&gt;THRIFT-4662&lt;/del&gt;&lt;/a&gt;: Rust const string calls function at compile time&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1624#discussion_r231499393&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1624#discussion_r231499393&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: compiler/cpp/src/thrift/generate/t_rs_generator.cc&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -673,15 +676,22 @@ void t_rs_generator::render_const_value_holder(const string&amp;amp; name, t_type* ttype&lt;br/&gt;
   f_gen_ &amp;lt;&amp;lt; endl;&lt;br/&gt;
 }&lt;/p&gt;

&lt;p&gt;-void t_rs_generator::render_const_value(t_type* ttype, t_const_value* tvalue) {&lt;br/&gt;
+void t_rs_generator::render_const_value(t_type* ttype, t_const_value* tvalue, bool isowned) {&lt;br/&gt;
   if (ttype-&amp;gt;is_base_type()) {&lt;br/&gt;
     t_base_type* tbase_type = (t_base_type*)ttype;&lt;br/&gt;
     switch (tbase_type-&amp;gt;get_base()) {&lt;br/&gt;
     case t_base_type::TYPE_STRING:&lt;br/&gt;
       if (tbase_type-&amp;gt;is_binary()) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;f_gen_ &amp;lt;&amp;lt; &quot;\&quot;&quot; &amp;lt;&amp;lt; tvalue-&amp;gt;get_string() &amp;lt;&amp;lt; &quot;\&quot;&quot;&amp;lt;&amp;lt;  &quot;.to_owned().into_bytes()&quot;;&lt;br/&gt;
+        if (isowned) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Will there ever be a point where we want the const string/byte-array to be owned?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16678211" author="githubbot" created="Wed, 7 Nov 2018 13:19:07 +0000"  >&lt;p&gt;allengeorge commented on issue #1624: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4662&quot; title=&quot;Rust const string calls function at compile time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4662&quot;&gt;&lt;del&gt;THRIFT-4662&lt;/del&gt;&lt;/a&gt;: Rust const string calls function at compile time&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1624#issuecomment-436619709&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1624#issuecomment-436619709&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @jake-ruyi Thank you for the bug report - and the PR! I&apos;ve asked a question about the implementation.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16678281" author="githubbot" created="Wed, 7 Nov 2018 14:22:20 +0000"  >&lt;p&gt;jake-ruyi commented on a change in pull request #1624: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4662&quot; title=&quot;Rust const string calls function at compile time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4662&quot;&gt;&lt;del&gt;THRIFT-4662&lt;/del&gt;&lt;/a&gt;: Rust const string calls function at compile time&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1624#discussion_r231521483&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1624#discussion_r231521483&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: compiler/cpp/src/thrift/generate/t_rs_generator.cc&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -673,15 +676,22 @@ void t_rs_generator::render_const_value_holder(const string&amp;amp; name, t_type* ttype&lt;br/&gt;
   f_gen_ &amp;lt;&amp;lt; endl;&lt;br/&gt;
 }&lt;/p&gt;

&lt;p&gt;-void t_rs_generator::render_const_value(t_type* ttype, t_const_value* tvalue) {&lt;br/&gt;
+void t_rs_generator::render_const_value(t_type* ttype, t_const_value* tvalue, bool isowned) {&lt;br/&gt;
   if (ttype-&amp;gt;is_base_type()) {&lt;br/&gt;
     t_base_type* tbase_type = (t_base_type*)ttype;&lt;br/&gt;
     switch (tbase_type-&amp;gt;get_base()) {&lt;br/&gt;
     case t_base_type::TYPE_STRING:&lt;br/&gt;
       if (tbase_type-&amp;gt;is_binary()) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;f_gen_ &amp;lt;&amp;lt; &quot;\&quot;&quot; &amp;lt;&amp;lt; tvalue-&amp;gt;get_string() &amp;lt;&amp;lt; &quot;\&quot;&quot;&amp;lt;&amp;lt;  &quot;.to_owned().into_bytes()&quot;;&lt;br/&gt;
+        if (isowned) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Honestly, I&apos;m not really sure about the byte-arrays.  We aren&apos;t using them anywhere, so I&apos;m not clear on the use-cases.&lt;br/&gt;
   I assume it will end up like the regular strings where you might want `map&amp;lt;u8,binary&amp;gt;` or something like that.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16682130" author="githubbot" created="Sat, 10 Nov 2018 01:19:36 +0000"  >&lt;p&gt;jake-ruyi commented on a change in pull request #1624: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4662&quot; title=&quot;Rust const string calls function at compile time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4662&quot;&gt;&lt;del&gt;THRIFT-4662&lt;/del&gt;&lt;/a&gt;: Rust const string calls function at compile time&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1624#discussion_r232434691&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1624#discussion_r232434691&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: compiler/cpp/src/thrift/generate/t_rs_generator.cc&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -673,15 +676,22 @@ void t_rs_generator::render_const_value_holder(const string&amp;amp; name, t_type* ttype&lt;br/&gt;
   f_gen_ &amp;lt;&amp;lt; endl;&lt;br/&gt;
 }&lt;/p&gt;

&lt;p&gt;-void t_rs_generator::render_const_value(t_type* ttype, t_const_value* tvalue) {&lt;br/&gt;
+void t_rs_generator::render_const_value(t_type* ttype, t_const_value* tvalue, bool isowned) {&lt;br/&gt;
   if (ttype-&amp;gt;is_base_type()) {&lt;br/&gt;
     t_base_type* tbase_type = (t_base_type*)ttype;&lt;br/&gt;
     switch (tbase_type-&amp;gt;get_base()) {&lt;br/&gt;
     case t_base_type::TYPE_STRING:&lt;br/&gt;
       if (tbase_type-&amp;gt;is_binary()) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;f_gen_ &amp;lt;&amp;lt; &quot;\&quot;&quot; &amp;lt;&amp;lt; tvalue-&amp;gt;get_string() &amp;lt;&amp;lt; &quot;\&quot;&quot;&amp;lt;&amp;lt;  &quot;.to_owned().into_bytes()&quot;;&lt;br/&gt;
+        if (isowned) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   My goals were:&lt;br/&gt;
   1. Make `const binary` compile&lt;br/&gt;
   2. Preserve existing behavior&lt;/p&gt;

&lt;p&gt;   Presently, neither `const string` nor `const binary` compiles. I&apos;m more interested in getting our stuff compiling than addressing the semantics of `binary`. Should I revert the binary portion?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16682454" author="githubbot" created="Sat, 10 Nov 2018 15:09:55 +0000"  >&lt;p&gt;allengeorge commented on a change in pull request #1624: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4662&quot; title=&quot;Rust const string calls function at compile time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4662&quot;&gt;&lt;del&gt;THRIFT-4662&lt;/del&gt;&lt;/a&gt;: Rust const string calls function at compile time&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1624#discussion_r232454772&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1624#discussion_r232454772&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: compiler/cpp/src/thrift/generate/t_rs_generator.cc&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -673,15 +676,22 @@ void t_rs_generator::render_const_value_holder(const string&amp;amp; name, t_type* ttype&lt;br/&gt;
   f_gen_ &amp;lt;&amp;lt; endl;&lt;br/&gt;
 }&lt;/p&gt;

&lt;p&gt;-void t_rs_generator::render_const_value(t_type* ttype, t_const_value* tvalue) {&lt;br/&gt;
+void t_rs_generator::render_const_value(t_type* ttype, t_const_value* tvalue, bool isowned) {&lt;br/&gt;
   if (ttype-&amp;gt;is_base_type()) {&lt;br/&gt;
     t_base_type* tbase_type = (t_base_type*)ttype;&lt;br/&gt;
     switch (tbase_type-&amp;gt;get_base()) {&lt;br/&gt;
     case t_base_type::TYPE_STRING:&lt;br/&gt;
       if (tbase_type-&amp;gt;is_binary()) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;f_gen_ &amp;lt;&amp;lt; &quot;\&quot;&quot; &amp;lt;&amp;lt; tvalue-&amp;gt;get_string() &amp;lt;&amp;lt; &quot;\&quot;&quot;&amp;lt;&amp;lt;  &quot;.to_owned().into_bytes()&quot;;&lt;br/&gt;
+        if (isowned) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   No - the PR isn&apos;t being held up because of const binary. I just didn&apos;t have time to look at it yet. I usually pull the branch locally and test in a container to ensure everything works. For one thing, I&apos;m unsure that&lt;/p&gt;

&lt;p&gt;   ```&lt;br/&gt;
   const FOO: &amp;amp;str = &quot;ladeda&quot;;&lt;br/&gt;
   ```&lt;/p&gt;

&lt;p&gt;   works in rust 1.28.&lt;/p&gt;

&lt;p&gt;   EDIT. Oh, nm - I see it was &lt;span class=&quot;error&quot;&gt;&amp;#91;enabled in 1.17&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://rust-lang-nursery.github.io/edition-guide/rust-2018/ownership-and-lifetimes/simpler-lifetimes-in-static-and-const.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://rust-lang-nursery.github.io/edition-guide/rust-2018/ownership-and-lifetimes/simpler-lifetimes-in-static-and-const.html&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16682465" author="githubbot" created="Sat, 10 Nov 2018 15:32:09 +0000"  >&lt;p&gt;allengeorge commented on a change in pull request #1624: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4662&quot; title=&quot;Rust const string calls function at compile time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4662&quot;&gt;&lt;del&gt;THRIFT-4662&lt;/del&gt;&lt;/a&gt;: Rust const string calls function at compile time&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1624#discussion_r232455341&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1624#discussion_r232455341&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: compiler/cpp/src/thrift/generate/t_rs_generator.cc&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -414,6 +414,9 @@ class t_rs_generator : public t_generator {&lt;br/&gt;
   // Return a string representing the rift `protocol::TType` given a `t_type`.&lt;br/&gt;
   string to_rust_field_type_enum(t_type* ttype);&lt;/p&gt;

&lt;p&gt;+  // Return a string representing the `const` rust type given a `t_type`&lt;br/&gt;
+  string to_rust_const_type(t_type* ttype, bool ordered_float = true);&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Good call. Makes sense to split this out from the `to_rust_type`. Could you please put this function declaration right before `to_rust_type`? And do the same for implementation please? It just ensures that code that has similar functionality is in the same part of the file.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16682466" author="githubbot" created="Sat, 10 Nov 2018 15:32:10 +0000"  >&lt;p&gt;allengeorge commented on a change in pull request #1624: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4662&quot; title=&quot;Rust const string calls function at compile time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4662&quot;&gt;&lt;del&gt;THRIFT-4662&lt;/del&gt;&lt;/a&gt;: Rust const string calls function at compile time&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1624#discussion_r232455248&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1624#discussion_r232455248&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: compiler/cpp/src/thrift/generate/t_rs_generator.cc&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -127,7 +127,7 @@ class t_rs_generator : public t_generator {&lt;br/&gt;
   void render_const_value_holder(const string&amp;amp; name, t_type* ttype, t_const_value* tvalue);&lt;/p&gt;

&lt;p&gt;   // Write the actual const value - the right side of a const definition.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;void render_const_value(t_type* ttype, t_const_value* tvalue);&lt;br/&gt;
+  void render_const_value(t_type* ttype, t_const_value* tvalue, bool isowned = true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Could you change parameter name to `owned` or `is_owned`?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16682467" author="githubbot" created="Sat, 10 Nov 2018 15:32:10 +0000"  >&lt;p&gt;allengeorge commented on a change in pull request #1624: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4662&quot; title=&quot;Rust const string calls function at compile time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4662&quot;&gt;&lt;del&gt;THRIFT-4662&lt;/del&gt;&lt;/a&gt;: Rust const string calls function at compile time&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1624#discussion_r232455421&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1624#discussion_r232455421&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: compiler/cpp/src/thrift/generate/t_rs_generator.cc&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -673,15 +676,22 @@ void t_rs_generator::render_const_value_holder(const string&amp;amp; name, t_type* ttype&lt;br/&gt;
   f_gen_ &amp;lt;&amp;lt; endl;&lt;br/&gt;
 }&lt;/p&gt;

&lt;p&gt;-void t_rs_generator::render_const_value(t_type* ttype, t_const_value* tvalue) {&lt;br/&gt;
+void t_rs_generator::render_const_value(t_type* ttype, t_const_value* tvalue, bool isowned) {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Please rename parameter to `owned` or `is_owned`.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16682468" author="githubbot" created="Sat, 10 Nov 2018 15:32:10 +0000"  >&lt;p&gt;allengeorge commented on a change in pull request #1624: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4662&quot; title=&quot;Rust const string calls function at compile time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4662&quot;&gt;&lt;del&gt;THRIFT-4662&lt;/del&gt;&lt;/a&gt;: Rust const string calls function at compile time&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1624#discussion_r232455395&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1624#discussion_r232455395&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: compiler/cpp/src/thrift/generate/t_rs_generator.cc&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -645,8 +648,8 @@ void t_rs_generator::render_const_value(const string&amp;amp; name, t_type* ttype, t_con&lt;br/&gt;
     throw &quot;cannot generate simple rust constant for &quot; + ttype-&amp;gt;get_name();&lt;br/&gt;
   }&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;f_gen_ &amp;lt;&amp;lt; &quot;pub const &quot; &amp;lt;&amp;lt; rust_upper_case(name) &amp;lt;&amp;lt; &quot;: &quot; &amp;lt;&amp;lt; to_rust_type(ttype) &amp;lt;&amp;lt; &quot; = &quot;;&lt;/li&gt;
	&lt;li&gt;render_const_value(ttype, tvalue);&lt;br/&gt;
+  f_gen_ &amp;lt;&amp;lt; &quot;pub const &quot; &amp;lt;&amp;lt; rust_upper_case(name) &amp;lt;&amp;lt; &quot;: &quot; &amp;lt;&amp;lt; to_rust_const_type(ttype) &amp;lt;&amp;lt; &quot; = &quot;;&lt;br/&gt;
+  render_const_value(ttype, tvalue, false);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Interesting. This works because the call isn&apos;t recursive. Only the top-level type will be owned/static. The types in containers will all be owned because of the internal call to `to_rust_type`.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16682469" author="githubbot" created="Sat, 10 Nov 2018 15:32:10 +0000"  >&lt;p&gt;allengeorge commented on a change in pull request #1624: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4662&quot; title=&quot;Rust const string calls function at compile time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4662&quot;&gt;&lt;del&gt;THRIFT-4662&lt;/del&gt;&lt;/a&gt;: Rust const string calls function at compile time&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1624#discussion_r232455435&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1624#discussion_r232455435&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: lib/rs/test/thrifts/Base_One.thrift&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -37,6 +37,9 @@ const list&amp;lt;double&amp;gt; CommonTemperatures = &lt;span class=&quot;error&quot;&gt;&amp;#91;300.0, 450.0&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt; const double MealsPerDay = 2.5;&lt;/p&gt;

&lt;p&gt;+const string DefaultRecipeName = &quot;Something&quot;&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   This is incredibly minor, but, could you please choose some funny recipe names here? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16682470" author="githubbot" created="Sat, 10 Nov 2018 15:33:09 +0000"  >&lt;p&gt;allengeorge commented on a change in pull request #1624: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4662&quot; title=&quot;Rust const string calls function at compile time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4662&quot;&gt;&lt;del&gt;THRIFT-4662&lt;/del&gt;&lt;/a&gt;: Rust const string calls function at compile time&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1624#discussion_r232455479&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1624#discussion_r232455479&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: compiler/cpp/src/thrift/generate/t_rs_generator.cc&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -3076,6 +3086,21 @@ string t_rs_generator::to_rust_field_type_enum(t_type* ttype) &lt;/p&gt;
{
   throw &quot;cannot find TType for &quot; + ttype-&amp;gt;get_name();
 }

&lt;p&gt;+string t_rs_generator::to_rust_const_type(t_type* ttype, bool ordered_float) {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Please reorder implementation just before `to_rust_type`&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16682471" author="githubbot" created="Sat, 10 Nov 2018 15:33:43 +0000"  >&lt;p&gt;allengeorge commented on issue #1624: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4662&quot; title=&quot;Rust const string calls function at compile time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4662&quot;&gt;&lt;del&gt;THRIFT-4662&lt;/del&gt;&lt;/a&gt;: Rust const string calls function at compile time&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1624#issuecomment-437592044&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1624#issuecomment-437592044&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @jake-ruyi Thank you for the PR. I&apos;ve some minor comments, but overall this looks good. If you can address them, I&apos;ll approve and this can be merged in.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16682737" author="githubbot" created="Sun, 11 Nov 2018 04:57:16 +0000"  >&lt;p&gt;jake-ruyi commented on a change in pull request #1624: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4662&quot; title=&quot;Rust const string calls function at compile time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4662&quot;&gt;&lt;del&gt;THRIFT-4662&lt;/del&gt;&lt;/a&gt;: Rust const string calls function at compile time&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1624#discussion_r232474522&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1624#discussion_r232474522&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: compiler/cpp/src/thrift/generate/t_rs_generator.cc&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -673,15 +676,22 @@ void t_rs_generator::render_const_value_holder(const string&amp;amp; name, t_type* ttype&lt;br/&gt;
   f_gen_ &amp;lt;&amp;lt; endl;&lt;br/&gt;
 }&lt;/p&gt;

&lt;p&gt;-void t_rs_generator::render_const_value(t_type* ttype, t_const_value* tvalue) {&lt;br/&gt;
+void t_rs_generator::render_const_value(t_type* ttype, t_const_value* tvalue, bool isowned) {&lt;br/&gt;
   if (ttype-&amp;gt;is_base_type()) {&lt;br/&gt;
     t_base_type* tbase_type = (t_base_type*)ttype;&lt;br/&gt;
     switch (tbase_type-&amp;gt;get_base()) {&lt;br/&gt;
     case t_base_type::TYPE_STRING:&lt;br/&gt;
       if (tbase_type-&amp;gt;is_binary()) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;f_gen_ &amp;lt;&amp;lt; &quot;\&quot;&quot; &amp;lt;&amp;lt; tvalue-&amp;gt;get_string() &amp;lt;&amp;lt; &quot;\&quot;&quot;&amp;lt;&amp;lt;  &quot;.to_owned().into_bytes()&quot;;&lt;br/&gt;
+        if (isowned) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   That explains it.  I could have sworn it needed to be `&amp;amp;&apos;static`, but I found a bunch of examples that were `&amp;amp;str` and assumed I was thinking of something else...&lt;br/&gt;
   Do you think it&apos;s worth outputting `&amp;amp;&apos;static str` instead so it works with Rust &amp;lt;1.17?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16682738" author="githubbot" created="Sun, 11 Nov 2018 04:58:10 +0000"  >&lt;p&gt;jake-ruyi commented on a change in pull request #1624: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4662&quot; title=&quot;Rust const string calls function at compile time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4662&quot;&gt;&lt;del&gt;THRIFT-4662&lt;/del&gt;&lt;/a&gt;: Rust const string calls function at compile time&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1624#discussion_r232474522&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1624#discussion_r232474522&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: compiler/cpp/src/thrift/generate/t_rs_generator.cc&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -673,15 +676,22 @@ void t_rs_generator::render_const_value_holder(const string&amp;amp; name, t_type* ttype&lt;br/&gt;
   f_gen_ &amp;lt;&amp;lt; endl;&lt;br/&gt;
 }&lt;/p&gt;

&lt;p&gt;-void t_rs_generator::render_const_value(t_type* ttype, t_const_value* tvalue) {&lt;br/&gt;
+void t_rs_generator::render_const_value(t_type* ttype, t_const_value* tvalue, bool isowned) {&lt;br/&gt;
   if (ttype-&amp;gt;is_base_type()) {&lt;br/&gt;
     t_base_type* tbase_type = (t_base_type*)ttype;&lt;br/&gt;
     switch (tbase_type-&amp;gt;get_base()) {&lt;br/&gt;
     case t_base_type::TYPE_STRING:&lt;br/&gt;
       if (tbase_type-&amp;gt;is_binary()) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;f_gen_ &amp;lt;&amp;lt; &quot;\&quot;&quot; &amp;lt;&amp;lt; tvalue-&amp;gt;get_string() &amp;lt;&amp;lt; &quot;\&quot;&quot;&amp;lt;&amp;lt;  &quot;.to_owned().into_bytes()&quot;;&lt;br/&gt;
+        if (isowned) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   That explains it.  I could have sworn it needed to be `&amp;amp;&apos;static`, but I found a bunch of examples that were `&amp;amp;str` and it compiled so I assumed I was thinking of something else...&lt;br/&gt;
   Do you think it&apos;s worth outputting `&amp;amp;&apos;static str` instead so it works with Rust &amp;lt;1.17?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16682888" author="githubbot" created="Sun, 11 Nov 2018 14:08:23 +0000"  >&lt;p&gt;allengeorge commented on issue #1624: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4662&quot; title=&quot;Rust const string calls function at compile time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4662&quot;&gt;&lt;del&gt;THRIFT-4662&lt;/del&gt;&lt;/a&gt;: Rust const string calls function at compile time&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1624#issuecomment-437673078&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1624#issuecomment-437673078&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   No - that&#8217;s ok. I&#8217;ve set the minimum Rust version to 1.28 for a while now, so I think we should be fine.&lt;/p&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16683143" author="githubbot" created="Mon, 12 Nov 2018 02:38:21 +0000"  >&lt;p&gt;jeikabu commented on a change in pull request #1624: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4662&quot; title=&quot;Rust const string calls function at compile time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4662&quot;&gt;&lt;del&gt;THRIFT-4662&lt;/del&gt;&lt;/a&gt;: Rust const string calls function at compile time&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1624#discussion_r232522246&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1624#discussion_r232522246&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: compiler/cpp/src/thrift/generate/t_rs_generator.cc&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -645,8 +648,8 @@ void t_rs_generator::render_const_value(const string&amp;amp; name, t_type* ttype, t_con&lt;br/&gt;
     throw &quot;cannot generate simple rust constant for &quot; + ttype-&amp;gt;get_name();&lt;br/&gt;
   }&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;f_gen_ &amp;lt;&amp;lt; &quot;pub const &quot; &amp;lt;&amp;lt; rust_upper_case(name) &amp;lt;&amp;lt; &quot;: &quot; &amp;lt;&amp;lt; to_rust_type(ttype) &amp;lt;&amp;lt; &quot; = &quot;;&lt;/li&gt;
	&lt;li&gt;render_const_value(ttype, tvalue);&lt;br/&gt;
+  f_gen_ &amp;lt;&amp;lt; &quot;pub const &quot; &amp;lt;&amp;lt; rust_upper_case(name) &amp;lt;&amp;lt; &quot;: &quot; &amp;lt;&amp;lt; to_rust_const_type(ttype) &amp;lt;&amp;lt; &quot; = &quot;;&lt;br/&gt;
+  render_const_value(ttype, tvalue, false);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Right&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16683161" author="githubbot" created="Mon, 12 Nov 2018 03:23:24 +0000"  >&lt;p&gt;jeikabu commented on a change in pull request #1624: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4662&quot; title=&quot;Rust const string calls function at compile time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4662&quot;&gt;&lt;del&gt;THRIFT-4662&lt;/del&gt;&lt;/a&gt;: Rust const string calls function at compile time&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1624#discussion_r232526420&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1624#discussion_r232526420&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: lib/rs/test/thrifts/Base_One.thrift&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -37,6 +37,9 @@ const list&amp;lt;double&amp;gt; CommonTemperatures = &lt;span class=&quot;error&quot;&gt;&amp;#91;300.0, 450.0&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt; const double MealsPerDay = 2.5;&lt;/p&gt;

&lt;p&gt;+const string DefaultRecipeName = &quot;Something&quot;&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Glad to know my mastery of bad puns may finally be put to good use.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16683665" author="githubbot" created="Mon, 12 Nov 2018 11:58:15 +0000"  >&lt;p&gt;allengeorge commented on issue #1624: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4662&quot; title=&quot;Rust const string calls function at compile time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4662&quot;&gt;&lt;del&gt;THRIFT-4662&lt;/del&gt;&lt;/a&gt;: Rust const string calls function at compile time&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1624#issuecomment-437853849&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1624#issuecomment-437853849&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @jeking3 These changes look good. Could they be merged please? All the cross-tests pass. Two build failures: SBCL (same issue as before) and D.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16683755" author="githubbot" created="Mon, 12 Nov 2018 12:51:29 +0000"  >&lt;p&gt;jeking3 closed pull request #1624: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4662&quot; title=&quot;Rust const string calls function at compile time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4662&quot;&gt;&lt;del&gt;THRIFT-4662&lt;/del&gt;&lt;/a&gt;: Rust const string calls function at compile time&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1624&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1624&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/compiler/cpp/src/thrift/generate/t_rs_generator.cc b/compiler/cpp/src/thrift/generate/t_rs_generator.cc&lt;br/&gt;
index dc11fd3ee2..eccdd275e0 100644&lt;br/&gt;
&amp;#8212; a/compiler/cpp/src/thrift/generate/t_rs_generator.cc&lt;br/&gt;
+++ b/compiler/cpp/src/thrift/generate/t_rs_generator.cc&lt;br/&gt;
@@ -127,7 +127,7 @@ class t_rs_generator : public t_generator {&lt;br/&gt;
   void render_const_value_holder(const string&amp;amp; name, t_type* ttype, t_const_value* tvalue);&lt;/p&gt;

&lt;p&gt;   // Write the actual const value - the right side of a const definition.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;void render_const_value(t_type* ttype, t_const_value* tvalue);&lt;br/&gt;
+  void render_const_value(t_type* ttype, t_const_value* tvalue, bool is_owned = true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   // Write a const struct (returned from `const_value` method).&lt;br/&gt;
   void render_const_struct(t_type* ttype, t_const_value* tvalue);&lt;br/&gt;
@@ -411,6 +411,9 @@ class t_rs_generator : public t_generator &lt;/p&gt;
{
   // Return a string representing the rust type given a `t_type`.
   string to_rust_type(t_type* ttype, bool ordered_float = true);
 
+  // Return a string representing the `const` rust type given a `t_type`
+  string to_rust_const_type(t_type* ttype, bool ordered_float = true);
+
   // Return a string representing the rift `protocol::TType` given a `t_type`.
   string to_rust_field_type_enum(t_type* ttype);
 
@@ -645,8 +648,8 @@ void t_rs_generator::render_const_value(const string&amp;amp; name, t_type* ttype, t_con
     throw &quot;cannot generate simple rust constant for &quot; + ttype-&amp;gt;get_name();
   }

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;f_gen_ &amp;lt;&amp;lt; &quot;pub const &quot; &amp;lt;&amp;lt; rust_upper_case(name) &amp;lt;&amp;lt; &quot;: &quot; &amp;lt;&amp;lt; to_rust_type(ttype) &amp;lt;&amp;lt; &quot; = &quot;;&lt;/li&gt;
	&lt;li&gt;render_const_value(ttype, tvalue);&lt;br/&gt;
+  f_gen_ &amp;lt;&amp;lt; &quot;pub const &quot; &amp;lt;&amp;lt; rust_upper_case(name) &amp;lt;&amp;lt; &quot;: &quot; &amp;lt;&amp;lt; to_rust_const_type(ttype) &amp;lt;&amp;lt; &quot; = &quot;;&lt;br/&gt;
+  render_const_value(ttype, tvalue, false);&lt;br/&gt;
   f_gen_ &amp;lt;&amp;lt; &quot;;&quot; &amp;lt;&amp;lt; endl;&lt;br/&gt;
   f_gen_ &amp;lt;&amp;lt; endl;&lt;br/&gt;
 }&lt;br/&gt;
@@ -673,15 +676,22 @@ void t_rs_generator::render_const_value_holder(const string&amp;amp; name, t_type* ttype&lt;br/&gt;
   f_gen_ &amp;lt;&amp;lt; endl;&lt;br/&gt;
 }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;-void t_rs_generator::render_const_value(t_type* ttype, t_const_value* tvalue) {&lt;br/&gt;
+void t_rs_generator::render_const_value(t_type* ttype, t_const_value* tvalue, bool is_owned) {&lt;br/&gt;
   if (ttype-&amp;gt;is_base_type()) {&lt;br/&gt;
     t_base_type* tbase_type = (t_base_type*)ttype;&lt;br/&gt;
     switch (tbase_type-&amp;gt;get_base()) {&lt;br/&gt;
     case t_base_type::TYPE_STRING:&lt;br/&gt;
       if (tbase_type-&amp;gt;is_binary()) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;f_gen_ &amp;lt;&amp;lt; &quot;\&quot;&quot; &amp;lt;&amp;lt; tvalue-&amp;gt;get_string() &amp;lt;&amp;lt; &quot;\&quot;&quot;&amp;lt;&amp;lt;  &quot;.to_owned().into_bytes()&quot;;&lt;br/&gt;
+        if (is_owned) 
{
+          f_gen_ &amp;lt;&amp;lt; &quot;\&quot;&quot; &amp;lt;&amp;lt; tvalue-&amp;gt;get_string() &amp;lt;&amp;lt; &quot;\&quot;&quot;&amp;lt;&amp;lt;  &quot;.to_owned().into_bytes()&quot;;
+        }
&lt;p&gt; else &lt;/p&gt;
{
+          f_gen_ &amp;lt;&amp;lt; &quot;b\&quot;&quot; &amp;lt;&amp;lt; tvalue-&amp;gt;get_string() &amp;lt;&amp;lt; &quot;\&quot;&quot;;
+        }
&lt;p&gt;       } else {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;f_gen_ &amp;lt;&amp;lt; &quot;\&quot;&quot; &amp;lt;&amp;lt; tvalue-&amp;gt;get_string() &amp;lt;&amp;lt; &quot;\&quot;&quot;&amp;lt;&amp;lt;  &quot;.to_owned()&quot;;&lt;br/&gt;
+        f_gen_ &amp;lt;&amp;lt; &quot;\&quot;&quot; &amp;lt;&amp;lt; tvalue-&amp;gt;get_string() &amp;lt;&amp;lt; &quot;\&quot;&quot;;&lt;br/&gt;
+        if (is_owned) 
{
+          f_gen_ &amp;lt;&amp;lt; &quot;.to_owned()&quot;;
+        }
&lt;p&gt;       }&lt;br/&gt;
       break;&lt;br/&gt;
     case t_base_type::TYPE_BOOL:&lt;br/&gt;
@@ -3039,6 +3049,21 @@ string t_rs_generator::to_rust_type(t_type* ttype, bool ordered_float) &lt;/p&gt;
{
   throw &quot;cannot find rust type for &quot; + ttype-&amp;gt;get_name();
 }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+string t_rs_generator::to_rust_const_type(t_type* ttype, bool ordered_float) {&lt;br/&gt;
+  if (ttype-&amp;gt;is_base_type()) {&lt;br/&gt;
+    t_base_type* tbase_type = ((t_base_type*)ttype);&lt;br/&gt;
+    if (tbase_type-&amp;gt;get_base() == t_base_type::TYPE_STRING) {&lt;br/&gt;
+      if (tbase_type-&amp;gt;is_binary()) &lt;/p&gt;
{
+        return &quot;&amp;amp;[u8]&quot;;
+      }
&lt;p&gt; else &lt;/p&gt;
{
+        return &quot;&amp;amp;str&quot;;
+      }
&lt;p&gt;+    }&lt;br/&gt;
+  }&lt;br/&gt;
+&lt;br/&gt;
+  return to_rust_type(ttype, ordered_float);&lt;br/&gt;
+}&lt;br/&gt;
+&lt;br/&gt;
 string t_rs_generator::to_rust_field_type_enum(t_type* ttype) {&lt;br/&gt;
   ttype = get_true_type(ttype);&lt;br/&gt;
   if (ttype-&amp;gt;is_base_type()) {&lt;br/&gt;
diff --git a/lib/rs/test/thrifts/Base_One.thrift b/lib/rs/test/thrifts/Base_One.thrift&lt;br/&gt;
index 3da083d451..c5fa6c20df 100644&lt;br/&gt;
&amp;#8212; a/lib/rs/test/thrifts/Base_One.thrift&lt;br/&gt;
+++ b/lib/rs/test/thrifts/Base_One.thrift&lt;br/&gt;
@@ -37,6 +37,9 @@ const list&amp;lt;double&amp;gt; CommonTemperatures = &lt;span class=&quot;error&quot;&gt;&amp;#91;300.0, 450.0&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt; const double MealsPerDay = 2.5;&lt;/p&gt;

&lt;p&gt;+const string DefaultRecipeName = &quot;Soup-rise of the Day&quot;&lt;br/&gt;
+const binary DefaultRecipeBinary = &quot;Soup-rise of the 01010101&quot;&lt;br/&gt;
+&lt;br/&gt;
 struct Noodle {&lt;br/&gt;
   1: string flourType&lt;br/&gt;
   2: Temperature cookTemp&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 1 week, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s007mo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>