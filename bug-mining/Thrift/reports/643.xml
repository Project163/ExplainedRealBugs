<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:05:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-1643] Denial of Service attack in TBinaryProtocol.readString</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-1643</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;In readString, if the string field&apos;s size is greater than the number of bytes remaining in the byte array to deserialize, libthrift will happily allocate a byte array of that size in readStringBody, filling the heap.&lt;/p&gt;</description>
                <environment>&lt;p&gt;All&lt;/p&gt;</environment>
        <key id="12597685">THRIFT-1643</key>
            <summary>Denial of Service attack in TBinaryProtocol.readString</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ntolia">Niraj Tolia</assignee>
                                    <reporter username="dparekh">Devesh Parekh</reporter>
                        <labels>
                            <label>security</label>
                    </labels>
                <created>Fri, 6 Jul 2012 01:44:46 +0000</created>
                <updated>Mon, 25 Nov 2013 17:58:22 +0000</updated>
                            <resolved>Fri, 12 Oct 2012 00:47:33 +0000</resolved>
                                    <version>0.6.1</version>
                    <version>0.8</version>
                                    <fixVersion>0.9</fixVersion>
                                    <component>Java - Library</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="13407651" author="dparekh" created="Fri, 6 Jul 2012 01:45:59 +0000"  >&lt;p&gt;Demonstration of the attack.&lt;/p&gt;</comment>
                            <comment id="13471312" author="roger.meier" created="Sun, 7 Oct 2012 20:12:30 +0000"  >&lt;p&gt;do you have a patch or/and a test case?&lt;/p&gt;</comment>
                            <comment id="13472043" author="dparekh" created="Tue, 9 Oct 2012 01:28:24 +0000"  >&lt;p&gt;The two attached files demonstrate the attack. Unfortunately, I&apos;ve stopped using Thrift, so writing a patch and a unit test won&apos;t be a good use of my time.&lt;/p&gt;</comment>
                            <comment id="13472077" author="ntolia" created="Tue, 9 Oct 2012 02:26:17 +0000"  >&lt;p&gt;Doesn&apos;t this also impact TCompactProtocol.readString() because it uses readBinary() which does a &quot;new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;length&amp;#93;&lt;/span&gt;&quot;? In this case, length is derived from readVarint32().&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] readBinary(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; length) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; TException {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (length == 0) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[0];

    &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] buf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[length];
    trans_.readAll(buf, 0, length);
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; buf;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13472189" author="ntolia" created="Tue, 9 Oct 2012 07:05:11 +0000"  >&lt;p&gt;Would a patch like the one attached be acceptable? Note that apart from a private hacked-up test, this patch hasn&apos;t really been put through its paces. However, all current unit tests pass. Would be happy to add more tests if this or something similar would be accepted.&lt;/p&gt;

&lt;p&gt;As I could not see any easy way of making it backwards compatible with arbitrary applications, this would involve callers that care about the Denial-of-Service problem to change how they construct the protocol factories. &lt;/p&gt;</comment>
                            <comment id="13472622" author="roger.meier" created="Tue, 9 Oct 2012 18:43:43 +0000"  >&lt;p&gt;Thanks,&lt;br/&gt;
committed!&lt;/p&gt;

&lt;p&gt;a test case and binaryprotocol fix would be great&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13472704" author="ntolia" created="Tue, 9 Oct 2012 20:11:59 +0000"  >&lt;p&gt;Will submit a TCompactProtocol test case for review soon. I will also look at the TBinaryProtocol code right after that and, assuming the solution is similar, will submit a fix for that too.&lt;/p&gt;</comment>
                            <comment id="13472766" author="ntolia" created="Tue, 9 Oct 2012 21:28:04 +0000"  >&lt;p&gt;Here is a test case for TCompactProtocol.&lt;/p&gt;

&lt;p&gt;Turns out that TBinaryProtocol was already protected by something similar to my previous patch and does not need any modification. I have also included a test case for TBinaryProtocol based on the Attack.java test included by the Devesh, the original filer.&lt;/p&gt;

&lt;p&gt;That said, would you like me to add a new patch for TCompactProtocol that, like &lt;a href=&quot;https://svn.apache.org/viewvc?view=revision&amp;amp;revision=1383515&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/viewvc?view=revision&amp;amp;revision=1383515&lt;/a&gt;, also throws TProtocolException instead of TException?&lt;/p&gt;</comment>
                            <comment id="13472821" author="ntolia" created="Tue, 9 Oct 2012 22:45:42 +0000"  >&lt;p&gt;Cleanup patch for TCompactProtocol attached to bring it closer to TBinaryProtocol. Also adds some additional checks. Will apply cleanly on top of the unit test patches.&lt;/p&gt;</comment>
                            <comment id="13472922" author="hudson" created="Wed, 10 Oct 2012 01:21:28 +0000"  >&lt;p&gt;Integrated in Thrift #560 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/560/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/560/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1643&quot; title=&quot;Denial of Service attack in TBinaryProtocol.readString&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1643&quot;&gt;&lt;del&gt;THRIFT-1643&lt;/del&gt;&lt;/a&gt; Denial of Service attack in TBinaryProtocol.readString&lt;br/&gt;
Patch: Niraj Tolia&lt;br/&gt;
Fix:   add TCompactProtocol maxNetworkBytes (Revision 1396186)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
roger : &lt;a href=&quot;http://svn.apache.org/viewvc/?view=rev&amp;amp;rev=1396186&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/?view=rev&amp;amp;rev=1396186&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/thrift/trunk/lib/java/src/org/apache/thrift/protocol/TCompactProtocol.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13473841" author="roger.meier" created="Thu, 11 Oct 2012 04:56:59 +0000"  >&lt;p&gt;Sorry, I was too busy to look on it.&lt;br/&gt;
However I reviewed the new patches with the test and they are ready to commit. &lt;/p&gt;

&lt;p&gt;I did not commit because Jake is preparing a release and he already made a branch for 0.9.x.&lt;/p&gt;
</comment>
                            <comment id="13474682" author="jfarrell" created="Fri, 12 Oct 2012 00:47:33 +0000"  >&lt;p&gt;Committed to trunk and 0.9 branch pre-rc&lt;/p&gt;</comment>
                            <comment id="13474836" author="hudson" created="Fri, 12 Oct 2012 06:26:53 +0000"  >&lt;p&gt;Integrated in Thrift #563 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/563/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/563/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1643&quot; title=&quot;Denial of Service attack in TBinaryProtocol.readString&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1643&quot;&gt;&lt;del&gt;THRIFT-1643&lt;/del&gt;&lt;/a&gt;:Denial of Service attack in TBinaryProtocol.readString&lt;br/&gt;
Client: java&lt;br/&gt;
Patch: Niraj Tolia &lt;/p&gt;

&lt;p&gt;In readString, if the string field&apos;s size is greater than the number of bytes remaining in the byte array to deserialize, libthrift will happily allocate a byte array of that size in readStringBody, filling the heap. (Revision 1397397)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
jfarrell : &lt;a href=&quot;http://svn.apache.org/viewvc/?view=rev&amp;amp;rev=1397397&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/?view=rev&amp;amp;rev=1397397&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/thrift/trunk/lib/java/src/org/apache/thrift/protocol/TCompactProtocol.java&lt;/li&gt;
	&lt;li&gt;/thrift/trunk/lib/java/test/org/apache/thrift/protocol/TestTBinaryProtocol.java&lt;/li&gt;
	&lt;li&gt;/thrift/trunk/lib/java/test/org/apache/thrift/protocol/TestTCompactProtocol.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13802052" author="yavalek" created="Tue, 22 Oct 2013 17:40:12 +0000"  >&lt;p&gt;The issue is still there, in TBinaryProtocol in particular. The Attack.java still produces java.lang.OutOfMemoryError&lt;/p&gt;</comment>
                            <comment id="13806973" author="ntolia" created="Mon, 28 Oct 2013 17:38:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yavalek&quot; class=&quot;user-hover&quot; rel=&quot;yavalek&quot;&gt;yavalek&lt;/a&gt;: Looks like the code in TBinaryProtocol to check for lengths got yanked in commit 2ca9c2028593782621c8876817d8772aa5f46ac7 by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carlyeks&quot; class=&quot;user-hover&quot; rel=&quot;carlyeks&quot;&gt;carlyeks&lt;/a&gt;. The code looked a little shady to begin with and differed significantly from the TCompactProtocol checks. We probably want to add something similar to the TCompactProtocol.checkReadLength() check in TBinaryProtocol too.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="12681090">THRIFT-2272</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12548467" name="0001-Add-test-for-TCompactProtocol-OOM-Denial-of-Service.patch" size="1609" author="ntolia" created="Tue, 9 Oct 2012 21:28:04 +0000"/>
                            <attachment id="12548371" name="0001-Address-denial-of-service-in-TCompactProtocol.patch" size="3040" author="ntolia" created="Tue, 9 Oct 2012 07:05:11 +0000"/>
                            <attachment id="12548468" name="0002-Add-test-for-TBinaryProtocol-OOM-Denial-of-Service.patch" size="1608" author="ntolia" created="Tue, 9 Oct 2012 21:28:04 +0000"/>
                            <attachment id="12548484" name="0003-Cleanup-length-checks-in-TCompactProtocol.patch" size="2417" author="ntolia" created="Tue, 9 Oct 2012 22:45:42 +0000"/>
                            <attachment id="12535305" name="Attack.java" size="278" author="dparekh" created="Fri, 6 Jul 2012 01:45:59 +0000"/>
                            <attachment id="12535304" name="Foo.thrift" size="38" author="dparekh" created="Fri, 6 Jul 2012 01:45:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>244989</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 4 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05xe7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32509</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>