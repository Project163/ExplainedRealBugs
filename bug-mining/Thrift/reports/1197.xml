<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:16:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-3048] NodeJS decoding of I64 is inconsistent across protocols</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-3048</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;The NodeJS libraries decode i64 differently between protocols. The &lt;tt&gt;TCompactProtocol&lt;/tt&gt; returns a &lt;tt&gt;number&lt;/tt&gt; whereas &lt;tt&gt;TBinaryProtocol&lt;/tt&gt; and &lt;tt&gt;TJSONProtocol&lt;/tt&gt; return an &lt;tt&gt;object&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Compact: &lt;a href=&quot;https://github.com/apache/thrift/blob/master/lib/nodejs/lib/thrift/compact_protocol.js#L815&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/blob/master/lib/nodejs/lib/thrift/compact_protocol.js#L815&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Binary: &lt;a href=&quot;https://github.com/apache/thrift/blob/master/lib/nodejs/lib/thrift/binary_protocol.js#L273&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/blob/master/lib/nodejs/lib/thrift/binary_protocol.js#L273&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;JSON:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/thrift/blob/master/lib/nodejs/lib/thrift/json_protocol.js#L664&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/blob/master/lib/nodejs/lib/thrift/json_protocol.js#L664&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This leads to a lack interoperability when switching between protocols:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;service BTest {
  bool testMethod (
    1: string protocol
    2: i64 int64
  );
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-javascript&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; handlers = {
  testMethod: &lt;span class=&quot;code-keyword&quot;&gt;function&lt;/span&gt;(desc, int64, callback) {
    console.log(util.format(&lt;span class=&quot;code-quote&quot;&gt;&apos;%s: %d, %s&apos;&lt;/span&gt;, desc, int64, &lt;span class=&quot;code-keyword&quot;&gt;typeof&lt;/span&gt; int64));
    callback(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
  }
};

&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; startServer = &lt;span class=&quot;code-keyword&quot;&gt;function&lt;/span&gt;(callback){
  &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; serverOptions = {
    services: {
      &lt;span class=&quot;code-quote&quot;&gt;&apos;/thrift&apos;&lt;/span&gt;: {
        handler: handlers,
        processor: BTest,
        protocol: thrift.TCompactProtocol,
        transport: thrift.TBufferedTransport
      },
      &lt;span class=&quot;code-quote&quot;&gt;&apos;/thrift.binary&apos;&lt;/span&gt;: {
        handler: handlers,
        processor: BTest,
        protocol: thrift.TBinaryProtocol,
        transport: thrift.TBufferedTransport
      }
    }
  };

  &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.server = thrift.createWebServer(serverOptions);
  &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.server.listen(9887, &lt;span class=&quot;code-keyword&quot;&gt;function&lt;/span&gt; serverCreated(){
    callback();
  }.bind(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;));
};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Client side: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-javascript&quot;&gt;  compactClient.testMethod(&lt;span class=&quot;code-quote&quot;&gt;&apos;compact small&apos;&lt;/span&gt;, 123);
  binaryClient.testMethod(&lt;span class=&quot;code-quote&quot;&gt;&apos;binary small&apos;&lt;/span&gt;, 456);

  compactClient.testMethod(&lt;span class=&quot;code-quote&quot;&gt;&apos;compact&apos;&lt;/span&gt;, 4294967297);
  binaryClient.testMethod(&lt;span class=&quot;code-quote&quot;&gt;&apos;binary&apos;&lt;/span&gt;, 4294967297);

  compactClient.testMethod(&lt;span class=&quot;code-quote&quot;&gt;&apos;compact large&apos;&lt;/span&gt;, 3.602879702e16);
  binaryClient.testMethod(&lt;span class=&quot;code-quote&quot;&gt;&apos;binary large&apos;&lt;/span&gt;, 3.602879702e16);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Results (0.9.2 and 1.0-dev):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;compact small: 123, number
binary small: 456, object
compact: 4294967297, number
binary: 4294967297, object
binary large: Infinity, object
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12783428">THRIFT-3048</key>
            <summary>NodeJS decoding of I64 is inconsistent across protocols</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="codesf">Randy Abernethy</assignee>
                                    <reporter username="Willyham">Will Demaine</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Mar 2015 23:40:18 +0000</created>
                <updated>Sat, 20 Feb 2021 15:27:31 +0000</updated>
                            <resolved>Thu, 26 Mar 2015 23:07:30 +0000</resolved>
                                    <version>0.9.2</version>
                                    <fixVersion>0.9.3</fixVersion>
                                    <component>Node.js - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14371521" author="codesf" created="Fri, 20 Mar 2015 15:57:26 +0000"  >&lt;p&gt;Thanks for the bug report. This is a problem. While it would be nice to have all protos return a number here (as happens in other languages) I think the JavaScript bin/json protos have chosen the lesser of two evils (returning an Int64 object rather than a Number  which can&apos;t store all possible i64 values).&lt;/p&gt;

&lt;p&gt;Patches welcome.&lt;/p&gt;</comment>
                            <comment id="14371549" author="willyham" created="Fri, 20 Mar 2015 16:12:24 +0000"  >&lt;p&gt;I agree, I think the best solution is to change compact to also return an object. This is clearly a pretty large breaking change though. I&apos;ll submit a patch shortly.&lt;/p&gt;</comment>
                            <comment id="14372245" author="githubbot" created="Fri, 20 Mar 2015 22:30:53 +0000"  >&lt;p&gt;GitHub user Willyham opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/403&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/403&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3048&quot; title=&quot;NodeJS decoding of I64 is inconsistent across protocols&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3048&quot;&gt;&lt;del&gt;THRIFT-3048&lt;/del&gt;&lt;/a&gt; - Make TCompactProtocol always return an object for i64&lt;/p&gt;

&lt;p&gt;    This changes the TCompactProtocol to always return an Int64 object in the same way that TBinary and TJSON do.&lt;/p&gt;

&lt;p&gt;    This is definitely a breaking change and will likely cause application problems for many people using TCompact and i64 types.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/Willyham/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Willyham/thrift&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/403.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/403.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #403&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 11d0a661985cabe63c1dc1b47576bb2b2d6c2e54&lt;br/&gt;
Author: Willyham &amp;lt;willyd@uber.com&amp;gt;&lt;br/&gt;
Date:   2015-03-20T22:28:01Z&lt;/p&gt;

&lt;p&gt;    Make TCompactProtocol always return an object for i64&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14372246" author="githubbot" created="Fri, 20 Mar 2015 22:31:22 +0000"  >&lt;p&gt;Github user Willyham commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/403#issuecomment-84170188&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/403#issuecomment-84170188&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Same test cases from the issue run against this code:&lt;br/&gt;
    ```&lt;br/&gt;
    compact small: 123, object&lt;br/&gt;
    binary small: 456, object&lt;br/&gt;
    compact: 4294967297, object&lt;br/&gt;
    binary: 4294967297, object&lt;br/&gt;
    compact large: Infinity, object&lt;br/&gt;
    binary large: Infinity, object&lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="14372864" author="codesf" created="Sat, 21 Mar 2015 16:07:06 +0000"  >&lt;p&gt;Hey Will,&lt;/p&gt;

&lt;p&gt;Thanks for the patch! These two tests used to pass but fail with the patch applied:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;nodejs-cpp       compact       buffered-ip       failure(1)&lt;/li&gt;
	&lt;li&gt;nodejs-cpp       compact       buffered-ip-ssl   failure(1)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I am certain it is the test but didn&apos;t have time to track it down. If you can update the pull great, otherwise I will fix the test and commit this over the weekend. &lt;/p&gt;

&lt;p&gt;Best,&lt;br/&gt;
Randy&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;~/thrift/test$ ./test.sh 
Apache Thrift - integration test suite
Sat Mar 21 08:52:25 PDT 2015
======================================================
client-server:   protocol:     transport:        result:
nodejs-nodejs    binary        buffered-ip       success(0)
nodejs-nodejs    binary        buffered-ip-ssl   success(0)
nodejs-nodejs    binary        framed-ip         success(0)
nodejs-nodejs    binary        framed-ip-ssl     success(0)
nodejs-nodejs    compact       buffered-ip       success(0)
nodejs-nodejs    compact       buffered-ip-ssl   success(0)
nodejs-nodejs    compact       framed-ip         success(0)
nodejs-nodejs    compact       framed-ip-ssl     success(0)
nodejs-nodejs    json          buffered-ip       success(0)
nodejs-nodejs    json          buffered-ip-ssl   success(0)
nodejs-nodejs    json          framed-ip         success(0)
nodejs-nodejs    json          framed-ip-ssl     success(0)
nodejs-cpp       binary        buffered-ip       success(0)
nodejs-cpp       binary        buffered-ip-ssl   success(0)
nodejs-cpp       binary        framed-ip         success(0)
nodejs-cpp       binary        framed-ip-ssl     success(0)
nodejs-cpp       compact       buffered-ip       failure(1)
nodejs-cpp       compact       buffered-ip-ssl   failure(1)
nodejs-cpp       compact       framed-ip         success(0)
nodejs-cpp       compact       framed-ip-ssl     success(0)
nodejs-cpp       json          buffered-ip       success(0)
nodejs-cpp       json          buffered-ip-ssl   success(0)
nodejs-cpp       json          framed-ip         success(0)
nodejs-cpp       json          framed-ip-ssl     success(0)
cpp-nodejs       binary        buffered-ip       success(0)
cpp-nodejs       binary        buffered-ip-ssl   success(0)
cpp-nodejs       binary        framed-ip         success(0)
cpp-nodejs       binary        framed-ip-ssl     success(0)
cpp-nodejs       compact       buffered-ip       success(0)
cpp-nodejs       compact       buffered-ip-ssl   success(0)
cpp-nodejs       compact       framed-ip         success(0)
cpp-nodejs       compact       framed-ip-ssl     success(0)
cpp-nodejs       json          buffered-ip       success(0)
cpp-nodejs       json          buffered-ip-ssl   success(0)
cpp-nodejs       json          framed-ip         success(0)
cpp-nodejs       json          framed-ip-ssl     success(0)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14382889" author="codesf" created="Thu, 26 Mar 2015 23:00:28 +0000"  >&lt;p&gt;The pull missed a required change in readI32 (which is implemented in terms of readI64()). This patch completes the fix.&lt;/p&gt;</comment>
                            <comment id="14382898" author="githubbot" created="Thu, 26 Mar 2015 23:06:57 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/403&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/403&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14382899" author="codesf" created="Thu, 26 Mar 2015 23:07:30 +0000"  >&lt;p&gt;committed.&lt;/p&gt;</comment>
                            <comment id="14382913" author="githubbot" created="Thu, 26 Mar 2015 23:16:48 +0000"  >&lt;p&gt;Github user Willyham commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/403#issuecomment-86750849&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/403#issuecomment-86750849&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hey Randy,&lt;/p&gt;

&lt;p&gt;    Thank you. I was having trouble building the entire test suite on my distro. I should note that the NodeJS specific tests which run with `npm test` all passed after I patched them, so there must be some missing coverage in those. Thanks for finishing this up.&lt;/p&gt;</comment>
                            <comment id="14382981" author="hudson" created="Thu, 26 Mar 2015 23:53:05 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #1483 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/1483/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/1483/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3048&quot; title=&quot;NodeJS decoding of I64 is inconsistent across protocols&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3048&quot;&gt;&lt;del&gt;THRIFT-3048&lt;/del&gt;&lt;/a&gt;: Repair node i64 compact interface (ra: rev cada37008ce6e609fe6312596d3ced760e5cd60c)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/nodejs/lib/thrift/compact_protocol.js&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12707630" name="0001-repaired-compact-i64-interface.patch" size="1903" author="codesf" created="Thu, 26 Mar 2015 23:00:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i270f3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>