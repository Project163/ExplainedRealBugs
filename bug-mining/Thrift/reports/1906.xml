<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:29:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-4225] Error handling malformed arguments leaks memory, corrupts transport buffers causing next RPC to fail</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-4225</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;This issue is related to &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2997&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;THRIFT-2997&lt;/a&gt;. I have a workaround &lt;a href=&quot;https://github.com/graphistry/rxjs-mapd/blob/bf88da285ebc32ee6528f596919c626efccaf7ee/src/client/bind.ts#L85&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, but it&apos;s only possible because I&apos;m wrapping all thrift client calls anyway.&lt;/p&gt;

&lt;p&gt;If the arguments to a thrift client method are malformed, the transport throws an error while writing the arguments to its buffers. Unfortunately, the buffers aren&apos;t reset (as would happen in flush), and the next RPC call will fail if any values were already written. Additionally, the callback isn&apos;t dereferenced from the client&apos;s _reqs table, leaking memory.&lt;/p&gt;

&lt;p&gt;From what I understand, this problem would need to be addressed in both the node lib and compiler.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13078084">THRIFT-4225</key>
            <summary>Error handling malformed arguments leaks memory, corrupts transport buffers causing next RPC to fail</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jking3">James E. King III</assignee>
                                    <reporter username="paul.e.taylor">Paul Taylor</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 Jun 2017 19:02:39 +0000</created>
                <updated>Thu, 27 Dec 2018 15:25:01 +0000</updated>
                            <resolved>Wed, 27 Jun 2018 12:48:51 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.12.0</fixVersion>
                                    <component>Node.js - Compiler</component>
                    <component>Node.js - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16519939" author="bforbis" created="Fri, 22 Jun 2018 03:13:53 +0000"  >&lt;p&gt;I believe this has been fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4564&quot; title=&quot;TBufferedTransport can leave corrupt data in the buffer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4564&quot;&gt;&lt;del&gt;THRIFT-4564&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16519946" author="bforbis" created="Fri, 22 Jun 2018 03:20:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4564&quot; title=&quot;TBufferedTransport can leave corrupt data in the buffer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4564&quot;&gt;&lt;del&gt;THRIFT-4564&lt;/del&gt;&lt;/a&gt; fixes the issue with the corrupted output buffer, but not the issue you describe where the&#160;stored callback can cause memory leaks. That&apos;s a good point, that if we know the callback would never be called due to a serialization error then we should remove it from the _reqs registry.&lt;/p&gt;</comment>
                            <comment id="16521276" author="githubbot" created="Sat, 23 Jun 2018 21:29:56 +0000"  >&lt;p&gt;bforbis opened a new pull request #1565: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4225&quot; title=&quot;Error handling malformed arguments leaks memory, corrupts transport buffers causing next RPC to fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4225&quot;&gt;&lt;del&gt;THRIFT-4225&lt;/del&gt;&lt;/a&gt;: Delete callback if RPC send failed&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1565&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1565&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   The same testing that was done in #1558 applies to this fix as well. This just makes sure to delete the callback from the `reqs` registry so that they don&apos;t build up and cause a memory leak.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16524420" author="jking3" created="Wed, 27 Jun 2018 01:14:56 +0000"  >&lt;p&gt;Marked as fixed in 0.12.0 - thanks for scrubbing the backlog!&lt;/p&gt;</comment>
                            <comment id="16524422" author="jking3" created="Wed, 27 Jun 2018 01:17:22 +0000"  >&lt;p&gt;Reopening - I thought this was a dupe of something already fixed, but it has its own PR.&lt;/p&gt;</comment>
                            <comment id="16525000" author="githubbot" created="Wed, 27 Jun 2018 12:48:21 +0000"  >&lt;p&gt;jeking3 closed pull request #1565: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4225&quot; title=&quot;Error handling malformed arguments leaks memory, corrupts transport buffers causing next RPC to fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4225&quot;&gt;&lt;del&gt;THRIFT-4225&lt;/del&gt;&lt;/a&gt;: Delete callback if RPC send failed&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1565&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1565&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/compiler/cpp/src/thrift/generate/t_js_generator.cc b/compiler/cpp/src/thrift/generate/t_js_generator.cc&lt;br/&gt;
index 512fe3c1ff..57baa9b76d 100644&lt;br/&gt;
&amp;#8212; a/compiler/cpp/src/thrift/generate/t_js_generator.cc&lt;br/&gt;
+++ b/compiler/cpp/src/thrift/generate/t_js_generator.cc&lt;br/&gt;
@@ -1613,10 +1613,11 @@ void t_js_generator::generate_service_client(t_service* tservice) &lt;/p&gt;
{
     indent_down();
     f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; &quot;}
&lt;p&gt;&quot; &amp;lt;&amp;lt; endl;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Reset the transport if there was a serialization error&lt;br/&gt;
+    // Reset the transport and delete registered callback if there was a serialization error&lt;br/&gt;
     f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; &quot;catch (e) {&quot; &amp;lt;&amp;lt; endl;&lt;br/&gt;
     indent_up();&lt;br/&gt;
     if (gen_node_) {&lt;br/&gt;
+      f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; &quot;delete this._reqs&lt;span class=&quot;error&quot;&gt;&amp;#91;this.seqid()&amp;#93;&lt;/span&gt;;&quot; &amp;lt;&amp;lt; endl;&lt;br/&gt;
       f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; &quot;if (typeof &quot; &amp;lt;&amp;lt; outputVar &amp;lt;&amp;lt; &quot;.reset === &apos;function&apos;) 
{&quot; &amp;lt;&amp;lt; endl;
       f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; &quot;  &quot; &amp;lt;&amp;lt; outputVar &amp;lt;&amp;lt; &quot;.reset();&quot; &amp;lt;&amp;lt; endl;
       f_service_ &amp;lt;&amp;lt; indent() &amp;lt;&amp;lt; &quot;}
&lt;p&gt;&quot; &amp;lt;&amp;lt; endl;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16525001" author="jking3" created="Wed, 27 Jun 2018 12:48:51 +0000"  >&lt;p&gt;Committed - thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13157248">THRIFT-4564</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 20 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3fzyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>