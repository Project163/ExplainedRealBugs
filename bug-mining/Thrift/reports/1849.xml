<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:28:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-4390] Rust binary protocol and buffered transport cannot handle writes above 4096 bytes</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-4390</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;While working on improving test coverage and fixing busted cross tests I reworked the cpp test client to send binary in at size 0, 1, 2, 4, 6, 16, ..., 131072 and after 4096 the rust server gave up.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;12, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128])
WARN:thrift::server::threaded: processor completed with error: TransportError { kind: Unknown, message: &quot;failed to write whole buffer&quot; }

Server process is successfully killed.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;@gadLinux this may be the root cause of some of the issues you were seeing with the interop against c_glib recently.  It is the root cause of some (if not all of) the rs-csharp test failures.&lt;/p&gt;</description>
                <environment>&lt;p&gt;docker image ubuntu-artful&lt;/p&gt;</environment>
        <key id="13119499">THRIFT-4390</key>
            <summary>Rust binary protocol and buffered transport cannot handle writes above 4096 bytes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="allengeorge">Allen George</assignee>
                                    <reporter username="jking3">James E. King III</reporter>
                        <labels>
                    </labels>
                <created>Sun, 19 Nov 2017 16:41:22 +0000</created>
                <updated>Thu, 27 Dec 2018 15:25:10 +0000</updated>
                            <resolved>Fri, 12 Jan 2018 13:07:42 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.12.0</fixVersion>
                                    <component>Rust - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16263138" author="allengeorge" created="Wed, 22 Nov 2017 18:52:56 +0000"  >&lt;p&gt;For both the framed and buffered read transport I set a fixed-size buffer with (what I thought) was an incredibly large size. The default is 4096 bytes - or 4K. The immediate workaround is to bump those numbers up substantially so that cross tests can succeed. The longer term fix would be to use a growable buffer - like a vector and use that. That&apos;s a non-trivial change.&lt;/p&gt;</comment>
                            <comment id="16264543" author="allengeorge" created="Thu, 23 Nov 2017 16:05:06 +0000"  >&lt;p&gt;It&apos;s really unclear to me why I&apos;d need more than 4K though - there must be some behavior I don&apos;t understand, or some bug in my buffer count/reset&lt;/p&gt;</comment>
                            <comment id="16265504" author="jking3" created="Fri, 24 Nov 2017 20:07:18 +0000"  >&lt;p&gt;So I&apos;m not sure why it is happening but all I can say is that the cross tests prove the issue is there from multiple clients (csharp, cpp).&lt;br/&gt;
Remember anybody can send a binary blob/string up to 2GB.  Communications are not limited to 4KB.&lt;/p&gt;</comment>
                            <comment id="16286101" author="allengeorge" created="Mon, 11 Dec 2017 16:10:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jking3&quot; class=&quot;user-hover&quot; rel=&quot;jking3&quot;&gt;jking3&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It appears there are two problems: I&apos;d like to split them up into two JIRAs. First:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;I misunderstood the rust stdlib&apos;s implementation of &lt;tt&gt;write_all&lt;/tt&gt; - it bails if 0 bytes are written; this caused the buffered transport to fail. I now &lt;tt&gt;flush&lt;/tt&gt; if there&apos;s no space in the internal buffer to allow the writes to continue&lt;/li&gt;
	&lt;li&gt;There was a bug in the binary protocol where I accidentally used &lt;tt&gt;write&lt;/tt&gt; instead of &lt;tt&gt;write_all&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Second:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The framed protocol uses a fixed buffer size; it should use a growable buffer.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Finally, I also reverted the change to the &lt;tt&gt;TTcpChannel&lt;/tt&gt; &lt;tt&gt;write&lt;/tt&gt; -&amp;gt; &lt;tt&gt;write_all&lt;/tt&gt; that was made to work around these issues.&lt;/p&gt;</comment>
                            <comment id="16286110" author="allengeorge" created="Mon, 11 Dec 2017 16:14:20 +0000"  >&lt;p&gt;Renamed this bug to deal with the first issue. Also created &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4419&quot; title=&quot;Rust framed transport cannot handle writes above 4096 bytes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4419&quot;&gt;&lt;del&gt;THRIFT-4419&lt;/del&gt;&lt;/a&gt; for the second issue.&lt;/p&gt;</comment>
                            <comment id="16313039" author="githubbot" created="Fri, 5 Jan 2018 12:44:37 +0000"  >&lt;p&gt;GitHub user allengeorge opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1458&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1458&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4390&quot; title=&quot;Rust binary protocol and buffered transport cannot handle writes above 4096 bytes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4390&quot;&gt;&lt;del&gt;THRIFT-4390&lt;/del&gt;&lt;/a&gt;: Fix bug where binary/buffered messages &amp;gt; 4K could not be read/written&lt;/p&gt;

&lt;p&gt;    Client: rs&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/allengeorge/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/allengeorge/thrift&lt;/a&gt; thrift-4390&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1458.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1458.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1458&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit b4a7fc785de82cd18ef6f56864d7e04ebeaea233&lt;br/&gt;
Author: Allen George &amp;lt;allen.george@...&amp;gt;&lt;br/&gt;
Date:   2017-12-11T16:44:11Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4390&quot; title=&quot;Rust binary protocol and buffered transport cannot handle writes above 4096 bytes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4390&quot;&gt;&lt;del&gt;THRIFT-4390&lt;/del&gt;&lt;/a&gt;: Fix bug where binary/buffered messages &amp;gt; 4K could not be read/written&lt;br/&gt;
    Client: rs&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16313040" author="githubbot" created="Fri, 5 Jan 2018 12:45:29 +0000"  >&lt;p&gt;Github user allengeorge commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1458&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1458&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    One of two fixes for problems noticed by others during cross-tests. I&apos;ve a separate PR for framed transports.&lt;/p&gt;</comment>
                            <comment id="16313428" author="githubbot" created="Fri, 5 Jan 2018 16:54:07 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1458&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1458&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    There were related cross test errors:&lt;br/&gt;
    ```&lt;br/&gt;
    ===============================================================================&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;Following 3 failures were unexpected ***:&lt;br/&gt;
    If it is introduced by you, please fix it before submitting the code.&lt;br/&gt;
    ===============================================================================&lt;br/&gt;
    server-client:          protocol:         transport:               result:&lt;br/&gt;
    c_glib-rs               multi             buffered-ip              failure(timeout)&lt;br/&gt;
    c_glib-rs               multic            buffered-ip              failure(timeout)&lt;br/&gt;
    perl-rs                 multi             buffered-ip              failure(timeout)&lt;br/&gt;
    ```&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16315546" author="githubbot" created="Mon, 8 Jan 2018 01:24:43 +0000"  >&lt;p&gt;Github user allengeorge commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1458&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1458&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @jeking3 This seems like a separate problem unfortunately. I&apos;d removed three tests from the &quot;known failures list&quot; and it appears there&apos;s a specific problem related to multiplexed processors and c_glib/perl. That was an oversight :/&lt;/p&gt;

&lt;p&gt;    I&apos;d suggest the following course of action:&lt;/p&gt;

&lt;p&gt;    1. I re-add those three test failures to the &quot;known failures&quot; list&lt;br/&gt;
    2. I fix up the framed test failures with &amp;gt; 4k long messages; I have a patch for this already&lt;br/&gt;
    3. I add a JIRA for the multiplexed failures and fix that in a separate PR&lt;/p&gt;

&lt;p&gt;    Let me know if this is acceptable to you, and I&apos;ll go about doing that.&lt;/p&gt;</comment>
                            <comment id="16318854" author="githubbot" created="Tue, 9 Jan 2018 18:15:00 +0000"  >&lt;p&gt;Github user allengeorge commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1458&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1458&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @jeking3 This seems like a separate problem unfortunately. I&apos;d removed three tests from the &quot;known failures list&quot; and it appears there&apos;s a specific problem related to multiplexed processors and c_glib/perl. That was an oversight :/&lt;/p&gt;

&lt;p&gt;    I&apos;d suggest the following course of action:&lt;/p&gt;

&lt;p&gt;    1. I re-add those three test failures to the &quot;known failures&quot; list&lt;br/&gt;
    2. I fix up the framed test failures with &amp;gt; 4k long messages; I have a patch for this already&lt;br/&gt;
    3. I add a JIRA for the multiplexed failures and fix that in a separate PR&lt;/p&gt;

&lt;p&gt;    Let me know if this is acceptable to you, and I&apos;ll go about doing that.&lt;/p&gt;</comment>
                            <comment id="16321444" author="githubbot" created="Thu, 11 Jan 2018 00:25:21 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1458&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1458&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Sure - I like progress. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16322156" author="githubbot" created="Thu, 11 Jan 2018 12:39:06 +0000"  >&lt;p&gt;Github user allengeorge commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1458&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1458&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @jeking3 Thank you!&lt;/p&gt;

&lt;p&gt;    So...updated the PR to re-add the three failing tests. Created &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4451&quot; title=&quot;Rust cross test client fails to communicate with multiplexed servers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4451&quot;&gt;&lt;del&gt;THRIFT-4451&lt;/del&gt;&lt;/a&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4451&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/THRIFT-4451&lt;/a&gt;) to track this. I&apos;m going to fix up the framed transport first, circle back to 4451, and then handle dart/c++ issues.&lt;/p&gt;</comment>
                            <comment id="16323913" author="githubbot" created="Fri, 12 Jan 2018 12:59:56 +0000"  >&lt;p&gt;Github user allengeorge commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1458&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1458&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @jeking3 Looks like everything passed, so this patch is good to go. TY!&lt;/p&gt;</comment>
                            <comment id="16323929" author="jking3" created="Fri, 12 Jan 2018 13:07:42 +0000"  >&lt;p&gt;Committed - thanks!&lt;/p&gt;</comment>
                            <comment id="16323930" author="githubbot" created="Fri, 12 Jan 2018 13:07:45 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1458&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1458&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 44 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mz33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>