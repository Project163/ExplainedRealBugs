<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:58:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-899] Ruby read timeouts  can sometimes be 2x what they should be</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-899</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;Thrift::Socket#read will sometimes fail to enforce a timeout properly  and wait approximately 2x @timeout before timing out the request.&lt;/p&gt;

&lt;p&gt;Our testing via thrift_client (&lt;a href=&quot;http://github.com/fauna/thrift_client&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://github.com/fauna/thrift_client&lt;/a&gt;) would only fail about 1/20 of the time. My hypothesis is that it only fails when you have a floating-point rounding error (we set the timeout to 0.8 seconds, but the math gave us 0.7999, so we wait another 0.8 seconds).&lt;/p&gt;

&lt;p&gt;The patch doesn&apos;t have any tests, because this problem is non-deterministic. (also, I couldn&apos;t figure out how to run the tests)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12474322">THRIFT-899</key>
            <summary>Ruby read timeouts  can sometimes be 2x what they should be</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kingryan">Ryan King</assignee>
                                    <reporter username="kingryan">Ryan King</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Sep 2010 21:10:52 +0000</created>
                <updated>Fri, 17 Sep 2010 20:18:57 +0000</updated>
                            <resolved>Fri, 17 Sep 2010 20:17:34 +0000</resolved>
                                    <version>0.1</version>
                    <version>0.2</version>
                    <version>0.3</version>
                    <version>0.4</version>
                                    <fixVersion>0.5</fixVersion>
                                    <component>Ruby - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12910323" author="kingryan" created="Thu, 16 Sep 2010 21:21:04 +0000"  >&lt;p&gt;I can&apos;t get jira to upload a the patch as an attachment, so here it is pasted:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git a/lib/rb/lib/thrift/transport/socket.rb b/lib/rb/lib/thrift/transport/socket.rb
index 06c937e..dd76036 100644
--- a/lib/rb/lib/thrift/transport/socket.rb
+++ b/lib/rb/lib/thrift/transport/socket.rb
@@ -97,12 +97,12 @@ module Thrift
           data = @handle.readpartial(sz)
         else
           # it&apos;s possible to interrupt select for something other than the timeout
-          # so we need to ensure we&apos;ve waited long enough
+          # so we need to ensure we&apos;ve waited long enough, but not too long
           start = Time.now
-          rd = nil # scoping
-          loop do
-            rd, = IO.select([@handle], nil, nil, @timeout)
-            break if (rd and not rd.empty?) or Time.now - start &amp;gt;= @timeout
+          deadline = start + @timeout
+          rd = loop do
+            rd, = IO.select([@handle], nil, nil, deadline - Time.now)
+            break rd if (rd and not rd.empty?) or Time.now &amp;gt;= deadline
           end
           if rd.nil? or rd.empty?
             raise TransportException.new(TransportException::TIMED_OUT, &quot;Socket: Timed out reading #{sz} bytes from #{@desc}&quot;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12910324" author="kingryan" created="Thu, 16 Sep 2010 21:21:56 +0000"  >&lt;p&gt;Also, we may want to consider doing this for #open and #write.&lt;/p&gt;</comment>
                            <comment id="12910418" author="kingryan" created="Fri, 17 Sep 2010 01:28:44 +0000"  >&lt;p&gt;updated diff with tests passing&lt;/p&gt;</comment>
                            <comment id="12910765" author="bryanduxbury" created="Fri, 17 Sep 2010 20:17:34 +0000"  >&lt;p&gt;I just committed this. Thanks for the patch!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12454821" name="THRIFT-899.patch" size="1794" author="kingryan" created="Fri, 17 Sep 2010 01:28:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>187036</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 10 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16dsf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245366</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>