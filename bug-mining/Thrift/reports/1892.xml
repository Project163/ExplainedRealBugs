<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:29:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-3769] Fix logic of THRIFT-2268</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-3769</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2268&quot; title=&quot;Modify TSaslTransport to ignore TCP health checks from loadbalancers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2268&quot;&gt;&lt;del&gt;THRIFT-2268&lt;/del&gt;&lt;/a&gt; intended to reduce the logging noise of TSaslTransport enabled servers, but the commit doesn&apos;t help in doing so (its just adding more specific noise today).&lt;/p&gt;

&lt;p&gt;This is because the transport factory overrides disallow throwing specific execution types (no TTransportException in signature), and thereby all implementations will throw a RuntimeException-wrapped exception, which the added catch clauses would never encounter.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/thrift/blob/master/lib/java/src/org/apache/thrift/transport/TSaslServerTransport.java#L217-L219&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/blob/master/lib/java/src/org/apache/thrift/transport/TSaslServerTransport.java#L217-L219&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/thrift/blob/master/lib/java/src/org/apache/thrift/server/TThreadPoolServer.java#L290-L295&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/blob/master/lib/java/src/org/apache/thrift/server/TThreadPoolServer.java#L290-L295&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We&apos;ll need to unwrap the RuntimeException to perform an actual valid cause check.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12955214">THRIFT-3769</key>
            <summary>Fix logic of THRIFT-2268</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jking3">James E. King III</assignee>
                                    <reporter username="qwertymaniac">Harsh J</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Apr 2016 07:05:16 +0000</created>
                <updated>Fri, 20 Sep 2019 06:50:03 +0000</updated>
                            <resolved>Tue, 1 May 2018 12:17:01 +0000</resolved>
                                    <version>0.9.2</version>
                                    <fixVersion>0.12.0</fixVersion>
                                    <component>Java - Library</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="15221288" author="qwertymaniac" created="Fri, 1 Apr 2016 07:06:45 +0000"  >&lt;p&gt;Attached patch checks for TTransportException instance types within the final Exception-level catcher.&lt;/p&gt;

&lt;p&gt;Additionally, since TSaslTransportException and TTransportException are both to be ignored, we can just ignore TTransportException (parent of TSaslTransportException).&lt;/p&gt;</comment>
                            <comment id="15226580" author="qwertymaniac" created="Tue, 5 Apr 2016 16:30:02 +0000"  >&lt;p&gt;Post &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2268&quot; title=&quot;Modify TSaslTransport to ignore TCP health checks from loadbalancers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2268&quot;&gt;&lt;del&gt;THRIFT-2268&lt;/del&gt;&lt;/a&gt;, the load balancers will generate these obscure (but very harmless) errors, note the RuntimeException wrap:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2016-03-01 00:10:59,128 ERROR org.apache.thrift.server.TThreadPoolServer: [HiveServer2-Handler-Pool: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-982]: Error occurred during processing of message.
java.lang.RuntimeException: org.apache.thrift.transport.TSaslTransportException: No data or no sasl data in the stream
        at org.apache.thrift.transport.TSaslServerTransport$Factory.getTransport(TSaslServerTransport.java:219)
        at org.apache.hadoop.hive.thrift.HadoopThriftAuthBridge$Server$TUGIAssumingTransportFactory$1.run(HadoopThriftAuthBridge.java:742)
        at org.apache.hadoop.hive.thrift.HadoopThriftAuthBridge$Server$TUGIAssumingTransportFactory$1.run(HadoopThriftAuthBridge.java:739)
        at java.security.AccessController.doPrivileged(Native Method)
        at javax.security.auth.Subject.doAs(Subject.java:356)
        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1651)
        at org.apache.hadoop.hive.thrift.HadoopThriftAuthBridge$Server$TUGIAssumingTransportFactory.getTransport(HadoopThriftAuthBridge.java:739)
        at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:268)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: org.apache.thrift.transport.TSaslTransportException: No data or no sasl data in the stream
        at org.apache.thrift.transport.TSaslTransport.open(TSaslTransport.java:328)
        at org.apache.thrift.transport.TSaslServerTransport.open(TSaslServerTransport.java:41)
        at org.apache.thrift.transport.TSaslServerTransport$Factory.getTransport(TSaslServerTransport.java:216)
        ... 10 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15985525" author="sershe" created="Wed, 26 Apr 2017 20:51:36 +0000"  >&lt;p&gt;Looks like a simple patch... should this be included?&lt;/p&gt;</comment>
                            <comment id="15985526" author="sershe" created="Wed, 26 Apr 2017 20:51:38 +0000"  >&lt;p&gt;Looks like a simple patch... should this be included?&lt;/p&gt;</comment>
                            <comment id="15985627" author="jking3" created="Wed, 26 Apr 2017 21:46:37 +0000"  >&lt;p&gt;A pull request with the patch needs to be opened.&lt;/p&gt;

&lt;p&gt;See:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://thrift.apache.org/docs/HowToContribute&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://thrift.apache.org/docs/HowToContribute&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16437731" author="githubbot" created="Fri, 13 Apr 2018 18:39:06 +0000"  >&lt;p&gt;vihangk1 opened a new pull request #1543: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3769&quot; title=&quot;Fix logic of THRIFT-2268&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3769&quot;&gt;&lt;del&gt;THRIFT-3769&lt;/del&gt;&lt;/a&gt; : Fix logic of &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2268&quot; title=&quot;Modify TSaslTransport to ignore TCP health checks from loadbalancers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2268&quot;&gt;&lt;del&gt;THRIFT-2268&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1543&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1543&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Client: java&lt;/p&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16437733" author="vihangk1" created="Fri, 13 Apr 2018 18:42:30 +0000"  >&lt;p&gt;Moving this forward. When load balancers like HAProxy are used for HiveServer2 these exceptions practically make the HS2 logs unusable since it logs connection resets every 2 sec. I used patch provided by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qwertymaniac&quot; class=&quot;user-hover&quot; rel=&quot;qwertymaniac&quot;&gt;qwertymaniac&lt;/a&gt; to create a PR. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jking3&quot; class=&quot;user-hover&quot; rel=&quot;jking3&quot;&gt;jking3&lt;/a&gt; Can you please review? Thanks! &lt;/p&gt;</comment>
                            <comment id="16440087" author="vihangk1" created="Mon, 16 Apr 2018 22:04:24 +0000"  >&lt;p&gt;ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jking3&quot; class=&quot;user-hover&quot; rel=&quot;jking3&quot;&gt;jking3&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;sershe&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16440093" author="sershe" created="Mon, 16 Apr 2018 22:07:52 +0000"  >&lt;p&gt;LGTM but I&apos;m not a committer&lt;/p&gt;</comment>
                            <comment id="16440097" author="vihangk1" created="Mon, 16 Apr 2018 22:09:40 +0000"  >&lt;p&gt;oh sorry &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I thought you were based on your old comment on this JIRA. Thanks for the review.&lt;/p&gt;</comment>
                            <comment id="16457260" author="vihangk1" created="Sat, 28 Apr 2018 00:34:46 +0000"  >&lt;p&gt;ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jking3&quot; class=&quot;user-hover&quot; rel=&quot;jking3&quot;&gt;jking3&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="16459652" author="githubbot" created="Tue, 1 May 2018 12:16:46 +0000"  >&lt;p&gt;jeking3 closed pull request #1543: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3769&quot; title=&quot;Fix logic of THRIFT-2268&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3769&quot;&gt;&lt;del&gt;THRIFT-3769&lt;/del&gt;&lt;/a&gt; : Fix logic of &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2268&quot; title=&quot;Modify TSaslTransport to ignore TCP health checks from loadbalancers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2268&quot;&gt;&lt;del&gt;THRIFT-2268&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1543&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1543&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/lib/java/src/org/apache/thrift/server/TThreadPoolServer.java b/lib/java/src/org/apache/thrift/server/TThreadPoolServer.java&lt;br/&gt;
index 53c20e98fe..3b5f21e84c 100644&lt;br/&gt;
&amp;#8212; a/lib/java/src/org/apache/thrift/server/TThreadPoolServer.java&lt;br/&gt;
+++ b/lib/java/src/org/apache/thrift/server/TThreadPoolServer.java&lt;br/&gt;
@@ -311,14 +311,24 @@ public void run() &lt;/p&gt;
{
               break;
             }
&lt;p&gt;         }&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;} catch (TSaslTransportException ttx) 
{
-        // Something thats not SASL was in the stream, continue silently
-      }
&lt;p&gt; catch (TTransportException ttx) &lt;/p&gt;
{
-        // Assume the client died and continue silently
       }
&lt;p&gt; catch (TException tx) &lt;/p&gt;
{
         LOGGER.error(&quot;Thrift error occurred during processing of message.&quot;, tx);
       }
&lt;p&gt; catch (Exception x) {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;LOGGER.error(&quot;Error occurred during processing of message.&quot;, x);&lt;br/&gt;
+        // We&apos;ll usually receive RuntimeException types here&lt;br/&gt;
+        // Need to unwrap to ascertain real causing exception before we choose to ignore&lt;br/&gt;
+        Throwable realCause = x.getCause();&lt;br/&gt;
+        // Ignore err-logging all transport-level/type exceptions&lt;br/&gt;
+        if ((realCause != null &amp;amp;&amp;amp; realCause instanceof TTransportException)&lt;br/&gt;
+            || (x instanceof TTransportException)) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+          if (LOGGER.isDebugEnabled()) {
+            // Write to debug, just in case the exception gets required
+            LOGGER
+                .debug(&quot;Received TTransportException during processing of message, ignoring: &quot;, x);
+          }+        }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; else &lt;/p&gt;
{
+          // Log the exception at error level and continue
+          LOGGER.error(&quot;Error occurred during processing of message.&quot;, x);
+        }
&lt;p&gt;       } finally {&lt;br/&gt;
         if (eventHandler != null) {&lt;br/&gt;
           eventHandler.deleteContext(connectionContext, inputProtocol, outputProtocol);&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16459654" author="jking3" created="Tue, 1 May 2018 12:17:01 +0000"  >&lt;p&gt;Committed - thanks.&lt;/p&gt;</comment>
                            <comment id="16460155" author="vihangk1" created="Tue, 1 May 2018 21:04:06 +0000"  >&lt;p&gt;Thanks for committing the patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jking3&quot; class=&quot;user-hover&quot; rel=&quot;jking3&quot;&gt;jking3&lt;/a&gt;. Do you know if there are any plans to release 0.12.0 soon?&lt;/p&gt;</comment>
                            <comment id="16460166" author="vihangk1" created="Tue, 1 May 2018 21:15:39 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jking3&quot; class=&quot;user-hover&quot; rel=&quot;jking3&quot;&gt;jking3&lt;/a&gt; Is it possible to get this patch merged in 0.9.x branch as well? We would like to get this patch released as part of 0.9.4 if possible. Thank you!&lt;/p&gt;</comment>
                            <comment id="16460345" author="jking3" created="Wed, 2 May 2018 00:41:36 +0000"  >&lt;p&gt;The project has not retroactively applied patches.&#160; It will appear in 0.12.0 which is likely to start soon, as we want to release more than once yearly &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160; but in the meantime you can maintain your own fork with the patch and build a jar...&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13231538">THRIFT-4858</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13216113">THRIFT-4805</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13145443">HIVE-18964</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12680655">THRIFT-2268</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12796485" name="THRIFT-3769.patch" size="1758" author="qwertymaniac" created="Fri, 1 Apr 2016 07:06:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 29 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vi2v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>