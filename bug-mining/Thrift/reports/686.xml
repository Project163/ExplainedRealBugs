<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:06:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-1603] Thrift IDL allows for multiple exceptions, args or struct member names to be the same</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-1603</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;I noticed that the Thrift IDL compiler allows for multiple exceptions instances to utilize the same name... This is a problem because when compiling to C+&lt;ins&gt;, the generated C&lt;/ins&gt;+ code will not compile properly:&lt;/p&gt;

&lt;p&gt;service whatever&lt;br/&gt;
{&lt;br/&gt;
void insert(1: string s) throws (1: NS nst, WX wxx, NSTx nst),&lt;br/&gt;
}&lt;/p&gt;</description>
                <environment>&lt;p&gt;RedHat 5.5, C++, thrift-0.8.0&lt;/p&gt;</environment>
        <key id="12555162">THRIFT-1603</key>
            <summary>Thrift IDL allows for multiple exceptions, args or struct member names to be the same</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Trivial</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="keppetto">Kamil Sa&#322;a&#347;</assignee>
                                    <reporter username="mpopovich">Michael Popovich</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 May 2012 17:25:56 +0000</created>
                <updated>Sat, 8 Jun 2013 03:15:39 +0000</updated>
                            <resolved>Sat, 8 Jun 2013 03:15:39 +0000</resolved>
                                                    <fixVersion>0.9.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13569816" author="keppetto" created="Sun, 3 Feb 2013 17:03:44 +0000"  >&lt;p&gt;This small patch should fix the issue. &lt;/p&gt;</comment>
                            <comment id="13569861" author="jensg" created="Sun, 3 Feb 2013 19:04:06 +0000"  >&lt;p&gt;Hey, that looks like a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1835&quot; title=&quot;Compiler should fail when duplicate field names are present&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1835&quot;&gt;&lt;del&gt;THRIFT-1835&lt;/del&gt;&lt;/a&gt;. I will have a look at your solution, it looks better and less complicated than mine. Update follows shortly, thanks so far.&lt;/p&gt;</comment>
                            <comment id="13569901" author="jensg" created="Sun, 3 Feb 2013 21:33:30 +0000"  >&lt;p&gt;Committed - thank you, Kamil!&lt;/p&gt;</comment>
                            <comment id="13570041" author="hudson" created="Mon, 4 Feb 2013 07:38:30 +0000"  >&lt;p&gt;Integrated in Thrift #622 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/622/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/622/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1603&quot; title=&quot;Thrift IDL allows for multiple exceptions, args or struct member names to be the same&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1603&quot;&gt;&lt;del&gt;THRIFT-1603&lt;/del&gt;&lt;/a&gt; Thrift IDL allows for multiple exceptions, args or struct member names to be the same (Revision 3a67c2f834119b8a1148ab071443c8d12ce207a1)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
jensg : &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=thrift.git&amp;amp;a=commit&amp;amp;h=3a67c2f834119b8a1148ab071443c8d12ce207a1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=thrift.git&amp;amp;a=commit&amp;amp;h=3a67c2f834119b8a1148ab071443c8d12ce207a1&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;compiler/cpp/src/thrifty.yy&lt;/li&gt;
	&lt;li&gt;compiler/cpp/src/parse/t_struct.h&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13571837" author="nicolastr" created="Tue, 5 Feb 2013 22:53:35 +0000"  >&lt;p&gt;Sorry for the duplicate (&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1835&quot; title=&quot;Compiler should fail when duplicate field names are present&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1835&quot;&gt;&lt;del&gt;THRIFT-1835&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=thrift.git;a=commitdiff;h=6f9ac3ffeb408392d1c3bb3945fe5b261f9e7817&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Actually, you implemented it the same way it was implemented at first.&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=thrift.git;a=commitdiff;h=ff219acb6c6ec434d48ceb78ec4b7e03141e27b5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;This commit broke it.&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=thrift.git;a=blob;f=compiler/cpp/src/parse/t_struct.h;h=1d0354239b37d1cf8d081218a03d0cd448240cdc;hb=HEAD#l115&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;These 3 lines&lt;/a&gt; are another way to return false. They were introduced by by the second commit I referenced. If the two &quot;return false;&quot; don&apos;t have the same meaning, won&apos;t the first one produce an incomprehensible error message?&lt;/p&gt;

&lt;p&gt;Where can I create a unit test to avoid future regressions on this? I only found tests for the clients/servers in the tree, not for the compiler (There are some .thrift file but my purpose here is to create a test that should fail, not pass).&lt;/p&gt;</comment>
                            <comment id="13572731" author="jensg" created="Wed, 6 Feb 2013 19:43:32 +0000"  >&lt;blockquote&gt;
&lt;p&gt; If the two &quot;return false;&quot; don&apos;t have the same meaning, won&apos;t the first one produce an incomprehensible error message?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The first test checks for duplicate IDs, not names. However, I got this message which should be sufficient for both cases:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[ERROR:C:/D/TPCPP/Thrift/Testcase/err-num-1.thrift:6] (last token was &lt;span class=&quot;code-quote&quot;&gt;&apos;}&apos;&lt;/span&gt;)
&lt;span class=&quot;code-quote&quot;&gt;&quot;1: field2&quot;&lt;/span&gt; - field identifier/name has already been used
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;But I&apos;m questioning the insert() even more. Can we, according to &lt;a href=&quot;http://www.cplusplus.com/reference/algorithm/equal_range&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.cplusplus.com/reference/algorithm/equal_range&lt;/a&gt;, really be sure that &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;bounds.second&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; always has the right value? Shouldn&apos;t it be better&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;members_in_id_order_.insert( elem.get_key(), elem);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;instead?&lt;/p&gt;</comment>
                            <comment id="13574746" author="nicolastr" created="Fri, 8 Feb 2013 19:13:33 +0000"  >&lt;p&gt;I think we can:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;The elements in the range shall already be sorted according to &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; same criterion (&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;&amp;lt; or comp), or at least partitioned with respect to val.&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Every new insert keeps the vector sorted so bounds.second will contain the right position.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;members_in_id_order_.insert( elem.get_key(), elem);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You would get a segmentation fault because it&apos;s a vector, not a dictionary. The position of the field in the vector is different from the field id.&lt;/p&gt;

&lt;p&gt;&amp;#8212;&lt;/p&gt;

&lt;p&gt;For the insertion speed:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;equal_range is O(log(N)) because the elements are sorted&lt;/li&gt;
	&lt;li&gt;get_field_by_name is O(N) because it runs through the entire vector&lt;/li&gt;
	&lt;li&gt;push_back is O(1)&lt;/li&gt;
	&lt;li&gt;insert is O(N) because the entire vector could be copied.&lt;/li&gt;
	&lt;li&gt;validate_union_member is O(1)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;So the execution time is O(N&#178;) for a structure of N fields. This could be O(N log N) using two maps (one for the ids and one for the names) because std::map keep the elements sorted (they need to be sorted for the fingerprint generation).&lt;/p&gt;

&lt;p&gt;The actual version of the code isn&apos;t broken, so does it worth the trouble? (The getters return a vector, not simply an iterator, so the changes may require a little bit of extra work.)&lt;/p&gt;</comment>
                            <comment id="13574829" author="jensg" created="Fri, 8 Feb 2013 21:14:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt; since it&apos;s a vector not a dictionary&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Indeed. At least that explains why it is working. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Insertion Speed &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt; is it worth the trouble?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agree, absolutely. Don&apos;t think this is a problem.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12628430">THRIFT-1835</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12567776" name="0001-Thrift-1603-Provide-unique-names-for-t_struct-elemen.patch" size="1880" author="keppetto" created="Sun, 3 Feb 2013 17:03:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>239414</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 41 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14idb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>234439</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>