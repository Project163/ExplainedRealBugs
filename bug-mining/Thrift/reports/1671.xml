<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:25:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-3038] Use of volatile in cpp library</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-3038</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;In the cpp library there are several member variables which are declared volatile, I believe with the intention of providing some sort of thread-safety. &lt;br/&gt;
While volatile can be used in this way in Java and C#, in C++ it cannot! It does not provide any guarantees with regard to instruction (re-)ordering, i.e. there are no implied memory barriers like you would get by using explicit locking or atomic variables.&lt;br/&gt;
This means that all uses of volatile should be examined, the volatile qualifier should be removed and replaced by proper synchronization.&lt;/p&gt;

&lt;p&gt;The affected member variables are:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;(Issue moved to &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3972&quot; title=&quot;C++ Library NoStarveReadWriteMutex helgrind identified race&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3972&quot;&gt;THRIFT-3972&lt;/a&gt;) NoStarveReadWriteMutex::writerWaiting_&lt;br/&gt;
Unprotected read access in acquireRead(). Data race can be seen by running the unit test with Helgrind.&lt;/li&gt;
	&lt;li&gt;(already fixed) TFileTransport::forceFlush_&lt;br/&gt;
Always accessed while holding mutex_. In this case, the volatile can just be removed.&lt;/li&gt;
	&lt;li&gt;(2nd pr: removed volatile) TFileTransport::closing_&lt;br/&gt;
Sometimes accessed while holding mutex_ (in combination with the notEmpty_ Monitor),&lt;br/&gt;
but, e.g., enqueueEvent reads closing_ without any synchronization.&lt;/li&gt;
	&lt;li&gt;(already fixed) TThreadPoolServer::stop_, TThreadedServer::stop_&lt;br/&gt;
Accessed (read and written) without synchronization. These would probably be fine using an atomic data type. Or, use explicit locking or signaling. &lt;/li&gt;
	&lt;li&gt;(already fixed) TThreadPoolServer::timeout_, TThreadPoolServer::taskExpiration_&lt;br/&gt;
Should probably use a lock.&lt;/li&gt;
	&lt;li&gt;(2nd pr: removed volatile) Mutex.cpp has mutexProfilingCounter as static variable. This probably doesn&#8217;t break anything, but still the volatile serves no real purpose.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;While some of the fixes are probably simple, in general I think someone with better knowledge of the code should have a look at this.&lt;br/&gt;
Items marked (already fixed) were addressed in &lt;a href=&quot;https://github.com/apache/thrift/pull/981&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/981&lt;/a&gt; in 0.10.0.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12781758">THRIFT-3038</key>
            <summary>Use of volatile in cpp library</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jking3">James E. King III</assignee>
                                    <reporter username="adriaan42">Adriaan Schmidt</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Mar 2015 10:11:00 +0000</created>
                <updated>Mon, 12 Dec 2016 18:02:33 +0000</updated>
                            <resolved>Sun, 13 Nov 2016 17:02:36 +0000</resolved>
                                    <version>0.9.2</version>
                    <version>0.9.3</version>
                    <version>0.10.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>C++ - Library</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14375066" author="roger.meier" created="Sun, 22 Mar 2015 17:27:38 +0000"  >&lt;p&gt;Do you already have some patches to be reviewed?&lt;/p&gt;</comment>
                            <comment id="14561759" author="flojdek" created="Wed, 27 May 2015 21:17:59 +0000"  >&lt;p&gt;For issue number 1. it looks like it would be enough to make `writerWaiting_` an atomic integer/bool variable. That would solve the synchronization problem and the data race. I haven&apos;t noticed though usage of any atomic types in thrift cpp files. Cpp11 supports atomic types and as far as I can see we compile with Cpp11 support. It can have an impact on performance as as far as I&apos;m aware when using atomics memory barriers are involved. It&apos;s hard to say what will be the impact. I can provide a patch for that and try do some performance testing. Any objections/suggestions?&lt;/p&gt;</comment>
                            <comment id="14561769" author="ben.craig" created="Wed, 27 May 2015 21:26:43 +0000"  >&lt;p&gt;The Thrift Cpp library does not currently require Cpp11 capable compilers to build.  There have been some talks about switching to Cpp11 in the 1.0 timeframe, but not in the 0.9.3 timeframe.&lt;/p&gt;</comment>
                            <comment id="14561807" author="flojdek" created="Wed, 27 May 2015 21:47:22 +0000"  >&lt;p&gt;Ok, fair enough. How about using Boost.Atomic? But that will be additional dependency. On the other hand WRT 1. I don&apos;t see NoStarveReadWriteMutex used anywhere else except in a unit test. Maybe we would be better off removing it if it is not used.&lt;/p&gt;</comment>
                            <comment id="14562856" author="ben.craig" created="Thu, 28 May 2015 13:03:47 +0000"  >&lt;p&gt;You could take that path that the threading and function wrapper classes take.  Basically, use std::atomic on new compilers and boost::atomic on old compilers.  &lt;/p&gt;

&lt;p&gt;Look at these files to see what they did:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/thrift/blob/master/lib/cpp/src/thrift/cxxfunctional.h&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/blob/master/lib/cpp/src/thrift/cxxfunctional.h&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/thrift/blob/master/lib/cpp/src/thrift/concurrency/PlatformThreadFactory.h&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/blob/master/lib/cpp/src/thrift/concurrency/PlatformThreadFactory.h&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15228442" author="jking3" created="Wed, 6 Apr 2016 15:14:39 +0000"  >&lt;p&gt;I believe you meant, use std::atomic when __cplusplus &amp;gt;= 201103L, not necessarily based on the compiler version?&lt;/p&gt;</comment>
                            <comment id="15228444" author="githubbot" created="Wed, 6 Apr 2016 15:18:56 +0000"  >&lt;p&gt;GitHub user jeking3 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/981&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/981&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3038&quot; title=&quot;Use of volatile in cpp library&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3038&quot;&gt;&lt;del&gt;THRIFT-3038&lt;/del&gt;&lt;/a&gt;: fix up some volatiles in cpp&lt;/p&gt;

&lt;p&gt;    I addressed the concerns in TFileTransport (forceFlush_) and in TThreadPoolServer, so items #2, #4, #5 from the original issue description.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jeking3/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jeking3/thrift&lt;/a&gt; defect/&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3038&quot; title=&quot;Use of volatile in cpp library&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3038&quot;&gt;&lt;del&gt;THRIFT-3038&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/981.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/981.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #981&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit cb4849abc4156d64532989344a4b2c2fa8be8148&lt;br/&gt;
Author: Jim King &amp;lt;jim.king@simplivity.com&amp;gt;&lt;br/&gt;
Date:   2016-04-05T17:00:24Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3038&quot; title=&quot;Use of volatile in cpp library&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3038&quot;&gt;&lt;del&gt;THRIFT-3038&lt;/del&gt;&lt;/a&gt;: fix a couple races and removed volatile per analysis&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15229335" author="hudson" created="Wed, 6 Apr 2016 23:30:08 +0000"  >&lt;p&gt;FAILURE: Integrated in Thrift-precommit #392 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift-precommit/392/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift-precommit/392/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3038&quot; title=&quot;Use of volatile in cpp library&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3038&quot;&gt;&lt;del&gt;THRIFT-3038&lt;/del&gt;&lt;/a&gt;: fix a couple races and removed volatile per analysis (jim.king: &lt;a href=&quot;https://github.com/apache/thrift/commit/cb4849abc4156d64532989344a4b2c2fa8be8148&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/commit/cb4849abc4156d64532989344a4b2c2fa8be8148&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/cpp/src/thrift/server/TThreadPoolServer.cpp&lt;/li&gt;
	&lt;li&gt;lib/cpp/src/thrift/server/TThreadPoolServer.h&lt;/li&gt;
	&lt;li&gt;lib/cpp/src/thrift/transport/TFileTransport.h&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15241070" author="hudson" created="Thu, 14 Apr 2016 12:48:02 +0000"  >&lt;p&gt;FAILURE: Integrated in Thrift-precommit #410 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift-precommit/410/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift-precommit/410/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3038&quot; title=&quot;Use of volatile in cpp library&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3038&quot;&gt;&lt;del&gt;THRIFT-3038&lt;/del&gt;&lt;/a&gt;: fix a couple races and removed volatile per analysis (jim.king: &lt;a href=&quot;https://github.com/apache/thrift/commit/cb4849abc4156d64532989344a4b2c2fa8be8148&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/commit/cb4849abc4156d64532989344a4b2c2fa8be8148&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/cpp/src/thrift/server/TThreadPoolServer.h&lt;/li&gt;
	&lt;li&gt;lib/cpp/src/thrift/server/TThreadPoolServer.cpp&lt;/li&gt;
	&lt;li&gt;lib/cpp/src/thrift/transport/TFileTransport.h&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15379979" author="jking3" created="Fri, 15 Jul 2016 19:35:50 +0000"  >&lt;p&gt;Note the open pull request resolves items 2, 4, 5 from the original list.  It does not address the others.&lt;/p&gt;</comment>
                            <comment id="15380799" author="githubbot" created="Sat, 16 Jul 2016 14:38:02 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/981&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/981&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Quite interesting, the job that failed is related to the code changes but the error message comes from a version of boost before 1.53.  It looks like that build job isn&apos;t making sure boost is at the minimum required version.&lt;/p&gt;</comment>
                            <comment id="15380987" author="githubbot" created="Sun, 17 Jul 2016 00:04:54 +0000"  >&lt;p&gt;Github user ben-craig commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/981&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/981&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Unless you have extremely compelling profiling results, the only atomic memory order you should be using is memory_order_seq_cst.  Even better, you get seq_cst for free as the default parameter of load and store.&lt;br/&gt;
    memory_order_consume is almost entirely broken in C++11 and 14.  Basically all compilers promote it to an acquire instead of a consume.&lt;br/&gt;
    memory_order_relaxed is extremely difficult to reason about, and should be avoided.&lt;/p&gt;</comment>
                            <comment id="15381003" author="githubbot" created="Sun, 17 Jul 2016 00:33:15 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/981&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/981&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I am okay letting things default to something else here.  I followed the boost examples and it passed the build with those settings.&lt;/p&gt;</comment>
                            <comment id="15381244" author="githubbot" created="Sun, 17 Jul 2016 09:03:58 +0000"  >&lt;p&gt;Github user nsuke commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/981&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/981&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Seeing the &lt;span class=&quot;error&quot;&gt;&amp;#91;commit log&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/thrift/commit/05b19b57cf2e224ab49e5cf983677361acb18311#diff-487498268b6e5a491d25456332fd44a1R107&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/commit/05b19b57cf2e224ab49e5cf983677361acb18311#diff-487498268b6e5a491d25456332fd44a1R107&lt;/a&gt;), it looks like more about not to use `acquire` for `store` and `release` for `load` (it&apos;s swapped).&lt;/p&gt;</comment>
                            <comment id="15381247" author="githubbot" created="Sun, 17 Jul 2016 09:05:42 +0000"  >&lt;p&gt;Github user nsuke commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/981#discussion_r71079188&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/981#discussion_r71079188&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/src/thrift/transport/TFileTransport.h &amp;#8212;&lt;br/&gt;
    @@ -352,7 +352,7 @@ class TFileTransport : public TFileReaderTransport, public TFileWriterTransport&lt;/p&gt;

&lt;p&gt;       // To keep track of whether the buffer has been flushed&lt;br/&gt;
       Monitor flushed_;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;volatile bool forceFlush_;&lt;br/&gt;
    +  bool forceFlush_;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    We&apos;re doing `while (forceFlush_) {`, so we need atomic here.&lt;/p&gt;</comment>
                            <comment id="15381642" author="githubbot" created="Mon, 18 Jul 2016 02:34:15 +0000"  >&lt;p&gt;Github user jeking3 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/981#discussion_r71095982&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/981#discussion_r71095982&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/src/thrift/transport/TFileTransport.h &amp;#8212;&lt;br/&gt;
    @@ -352,7 +352,7 @@ class TFileTransport : public TFileReaderTransport, public TFileWriterTransport&lt;/p&gt;

&lt;p&gt;       // To keep track of whether the buffer has been flushed&lt;br/&gt;
       Monitor flushed_;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;volatile bool forceFlush_;&lt;br/&gt;
    +  bool forceFlush_;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Thanks for catching that - I pushed an update changing this to a boost::atomic&amp;lt;bool&amp;gt; type.&lt;/p&gt;</comment>
                            <comment id="15382361" author="githubbot" created="Mon, 18 Jul 2016 14:32:05 +0000"  >&lt;p&gt;Github user nsuke commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/981&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/981&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @jeking3 the atomics for TThreadPoolServer fields are for 64-bit field read-write on 32bit-x86 and other platforms ? If so, we only need relaxed.&lt;/p&gt;

&lt;p&gt;    That said, as @ben-craig suggested, leaviing it as default strict order (+without `load` and `store`) would even be better for readability.&lt;/p&gt;</comment>
                            <comment id="15382367" author="githubbot" created="Mon, 18 Jul 2016 14:35:52 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/981&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/981&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Are you suggesting I get rid of the load and store calls and instead just use the provided &quot;operator=&quot; from the atomic?  I&apos;m okay with that... it is much more readable.&lt;/p&gt;</comment>
                            <comment id="15382679" author="githubbot" created="Mon, 18 Jul 2016 17:40:34 +0000"  >&lt;p&gt;Github user ben-craig commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/981&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/981&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The default op=, and even the default conversion operators from atomic&amp;lt;T&amp;gt; to T are fine.&lt;/p&gt;

&lt;p&gt;    @nsuke I would prefer we keep the access to TThreadPoolServer timeout variables as seq_cst.  The setter operations shouldn&apos;t ever be in performance critical code, and the &apos;get&apos; side of things is happening in an already slow area.  On x86, the getters will still turn into regular &apos;mov&apos; operations.  On ARM, there will be a couple of memory barriers generated, but those shouldn&apos;t be a huge deal.&lt;/p&gt;</comment>
                            <comment id="15382717" author="githubbot" created="Mon, 18 Jul 2016 17:59:22 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/981&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/981&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @ben-craig are you saying additional code changes are needed?&lt;/p&gt;</comment>
                            <comment id="15382845" author="githubbot" created="Mon, 18 Jul 2016 19:05:52 +0000"  >&lt;p&gt;Github user ben-craig commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/981&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/981&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Your latest revision look fine, I was mainly trying to address nsuke&apos;s post.&lt;/p&gt;</comment>
                            <comment id="15383055" author="githubbot" created="Mon, 18 Jul 2016 21:00:58 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/981&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/981&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The latest build failure was environmental and passed all other tests:&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    make&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt;: Leaving directory `/thrift/src/lib/lua&apos;&lt;br/&gt;
    make&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt;: write error&lt;br/&gt;
    make&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;: *** &lt;span class=&quot;error&quot;&gt;&amp;#91;check-recursive&amp;#93;&lt;/span&gt; Error 1&lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="15390605" author="githubbot" created="Sat, 23 Jul 2016 07:54:04 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/981&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/981&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15390610" author="nsuke" created="Sat, 23 Jul 2016 07:54:45 +0000"  >&lt;p&gt;committed, thanks !&lt;/p&gt;</comment>
                            <comment id="15390825" author="jking3" created="Sat, 23 Jul 2016 19:38:21 +0000"  >&lt;p&gt;Reopening as only 3 out of the 6 listed items were addressed in the last pull request.&lt;/p&gt;</comment>
                            <comment id="15660913" author="githubbot" created="Sun, 13 Nov 2016 05:41:30 +0000"  >&lt;p&gt;GitHub user jeking3 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1129&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1129&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3038&quot; title=&quot;Use of volatile in cpp library&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3038&quot;&gt;&lt;del&gt;THRIFT-3038&lt;/del&gt;&lt;/a&gt; clean up remaining volatile issues; remove unused NoStarveReadWriteMutex class&lt;/p&gt;

&lt;p&gt;    This takes care of items 1, 3, and 6 in the PR description.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jeking3/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jeking3/thrift&lt;/a&gt; defect/&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3038&quot; title=&quot;Use of volatile in cpp library&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3038&quot;&gt;&lt;del&gt;THRIFT-3038&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1129.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1129.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1129&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 356be9a548a7fcd6bc8da9473b822c87bec71315&lt;br/&gt;
Author: James E. King, III &amp;lt;jim.king@simplivity.com&amp;gt;&lt;br/&gt;
Date:   2016-11-13T04:55:50Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3038&quot; title=&quot;Use of volatile in cpp library&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3038&quot;&gt;&lt;del&gt;THRIFT-3038&lt;/del&gt;&lt;/a&gt; clean up remaining volatile issues; remove unused NoStarveReadWriteMutex class&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15661236" author="githubbot" created="Sun, 13 Nov 2016 10:10:24 +0000"  >&lt;p&gt;Github user nsuke commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1129#discussion_r87707817&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1129#discussion_r87707817&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/src/thrift/concurrency/Mutex.cpp &amp;#8212;&lt;br/&gt;
    @@ -37,11 +37,10 @@ namespace concurrency {&lt;/p&gt;

&lt;p&gt;     #ifndef THRIFT_NO_CONTENTION_PROFILING&lt;/p&gt;

&lt;p&gt;    +static sig_atomic_t mutexProfilingCounter = 0;&lt;br/&gt;
     static sig_atomic_t mutexProfilingSampleRate = 0;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Are we dealing with signal here at all ?&lt;br/&gt;
    Otherwise, changing these to int/int32_t would be a good idea.&lt;/p&gt;

&lt;p&gt;    mutexProfilingCounter can arguably be atomic if we want to avoid data race (technically UB) in exchange for some performance penalty.&lt;/p&gt;</comment>
                            <comment id="15661235" author="githubbot" created="Sun, 13 Nov 2016 10:10:24 +0000"  >&lt;p&gt;Github user nsuke commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1129#discussion_r87709373&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1129#discussion_r87709373&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/src/thrift/concurrency/Mutex.h &amp;#8212;&lt;br/&gt;
    @@ -101,25 +101,6 @@ class ReadWriteMutex &lt;/p&gt;
{
       boost::shared_ptr&amp;lt;impl&amp;gt; impl_;
     }
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;    -/**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* A ReadWriteMutex that guarantees writers will not be starved by readers:&lt;/li&gt;
	&lt;li&gt;* When a writer attempts to acquire the mutex, all new readers will be&lt;/li&gt;
	&lt;li&gt;* blocked from acquiring the mutex until the writer has acquired and&lt;/li&gt;
	&lt;li&gt;* released it. In some operating systems, this may already be guaranteed&lt;/li&gt;
	&lt;li&gt;* by a regular ReadWriteMutex.&lt;/li&gt;
	&lt;li&gt;*/&lt;br/&gt;
    -class NoStarveReadWriteMutex : public ReadWriteMutex 
{
    -public:
    -  NoStarveReadWriteMutex();
    -
    -  virtual void acquireRead() const;
    -  virtual void acquireWrite() const;
    -
    -private:
    -  Mutex mutex_;
    -  mutable volatile bool writerWaiting_;
    -}
&lt;p&gt;;&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    It&apos;s in a &quot;public&quot; header (kind of).&lt;br/&gt;
    Are you sure you delete this without deprecation warning etc ?&lt;/p&gt;

&lt;p&gt;    In this file, ReadWriteMutex and RWGuard are not used inside Thrift either.&lt;br/&gt;
    How about removing or deprecating all the three classes in a separate issue,&lt;br/&gt;
    since these are somewhat more involved compared to private volatile removal ?&lt;/p&gt;</comment>
                            <comment id="15661418" author="githubbot" created="Sun, 13 Nov 2016 12:28:56 +0000"  >&lt;p&gt;Github user jeking3 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1129#discussion_r87711314&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1129#discussion_r87711314&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/src/thrift/concurrency/Mutex.cpp &amp;#8212;&lt;br/&gt;
    @@ -37,11 +37,10 @@ namespace concurrency {&lt;/p&gt;

&lt;p&gt;     #ifndef THRIFT_NO_CONTENTION_PROFILING&lt;/p&gt;

&lt;p&gt;    +static sig_atomic_t mutexProfilingCounter = 0;&lt;br/&gt;
     static sig_atomic_t mutexProfilingSampleRate = 0;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    According to the comment in the implementation file, a race on this variable is acceptable, so I will change the type as you suggested and re-submit.&lt;/p&gt;</comment>
                            <comment id="15661559" author="jking3" created="Sun, 13 Nov 2016 14:24:24 +0000"  >&lt;p&gt;I ended up moving the issue with NoStarveReadWriteMutex into &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3972&quot; title=&quot;C++ Library NoStarveReadWriteMutex helgrind identified race&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3972&quot;&gt;THRIFT-3972&lt;/a&gt; because it is tangled up with ReadWriteMutex.&lt;/p&gt;</comment>
                            <comment id="15661561" author="githubbot" created="Sun, 13 Nov 2016 14:25:22 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1129&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1129&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    By moving the issue with NoStargeReadWriteMutex to &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3972&quot; title=&quot;C++ Library NoStarveReadWriteMutex helgrind identified race&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3972&quot;&gt;THRIFT-3972&lt;/a&gt; this became much simpler and it ready for approval.&lt;/p&gt;</comment>
                            <comment id="15661775" author="githubbot" created="Sun, 13 Nov 2016 17:01:41 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1129&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1129&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 1 week, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i26qcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>