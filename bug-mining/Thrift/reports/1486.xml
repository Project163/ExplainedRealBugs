<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:22:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-3552] glib_c Memory Leak</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-3552</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;I have been seeing some memory leaks using valgring in my testprogram.&lt;/p&gt;

&lt;p&gt;Leak:&lt;/p&gt;

&lt;p&gt;==94320== 17,878 bytes in 2,712 blocks are definitely lost in loss record 987 of 1,018&lt;br/&gt;
==94320==    at 0x4A057BB: calloc (vg_replace_malloc.c:593)&lt;br/&gt;
==94320==    by 0x3D7DA49BF7: g_malloc0 (gmem.c:196)&lt;br/&gt;
==94320==    by 0x5768002: thrift_binary_protocol_read_string (thrift_binary_protocol.c:791)&lt;br/&gt;
==94320==    by 0x5768987: thrift_binary_protocol_read_message_begin (thrift_binary_protocol.c:431)&lt;br/&gt;
==94320==    by 0x576702E: thrift_dispatch_processor_process (thrift_dispatch_processor.c:41)&lt;br/&gt;
==94320==    by 0x576CC06: thrift_simple_server_serve (thrift_simple_server.c:62)&lt;br/&gt;
==94320==    by 0x45A548: server_start (server.c:135)&lt;br/&gt;
==94320==    by 0x3D7C607A50: start_thread (pthread_create.c:301)&lt;br/&gt;
==94320==    by 0x3D7C2E893C: clone (clone.S:115)&lt;/p&gt;

&lt;p&gt;My question is where is the *str memory allocated by function thrift_binary_protocol_read_string() freed? Am I doing something wrong or is there an actual memory leak? &lt;/p&gt;</description>
                <environment></environment>
        <key id="12929927">THRIFT-3552</key>
            <summary>glib_c Memory Leak</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="simonsouth">Simon South</assignee>
                                    <reporter username="shahanish001@yahoo.com">Anish Shah</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Jan 2016 19:47:10 +0000</created>
                <updated>Fri, 19 Feb 2016 02:17:49 +0000</updated>
                            <resolved>Sat, 16 Jan 2016 12:10:36 +0000</resolved>
                                    <version>0.9.3</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>C glib - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15096921" author="jking3" created="Wed, 13 Jan 2016 20:21:13 +0000"  >&lt;p&gt;I tried to get around these issues in the past but gave up on it.  See this article for some help:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://stackoverflow.com/questions/4254610/valgrind-reports-memory-possibly-lost-when-using-glib-data-types&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/4254610/valgrind-reports-memory-possibly-lost-when-using-glib-data-types&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If you are able to make it work properly please post comments to that effect.  I will leave this open for a little while longer until we know the results.&lt;/p&gt;</comment>
                            <comment id="15097251" author="shahanish001@yahoo.com" created="Wed, 13 Jan 2016 23:17:19 +0000"  >&lt;p&gt;Thank you for the information but when I was just digging up on the thrift source code I found one memory leak.&lt;/p&gt;

&lt;p&gt;In the function thrift_dispatch_processor_process (thrift_dispatch_processor.c:41) the memory that later on gets allocated to ghar *fname is not freed. I could find anything in my piece of code that free&apos;s it. So I modified the function to free the buffer and it got me rid of that error. Can you help me confirm if thats correct? if it does get freed then where?&lt;/p&gt;</comment>
                            <comment id="15097260" author="jking3" created="Wed, 13 Jan 2016 23:23:09 +0000"  >&lt;p&gt;I don&apos;t know much about the c_glib library so I&apos;ll defer to a subject matter expert in the project.&lt;/p&gt;</comment>
                            <comment id="15097975" author="simonsouth" created="Thu, 14 Jan 2016 10:42:33 +0000"  >&lt;p&gt;I wrote the code in question and yes, it appears Anish has found a real memory leak.&lt;/p&gt;

&lt;p&gt;It seems to me the method-name string should be free&apos;d by the first &lt;tt&gt;dispatch_call&lt;/tt&gt; implementation that recognizes it, or by the default implementation if the method name is unrecognized.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached a patch that implements this change. Anish, can you please test again with this patch applied? Note you will need to rebuild the compiler and library and regenerate the Thrift classes for your project.&lt;/p&gt;</comment>
                            <comment id="15102214" author="shahanish001@yahoo.com" created="Fri, 15 Jan 2016 18:08:43 +0000"  >&lt;p&gt;Yup works like a charm thank you. I had just another question - probably this is not he right pace to ask but wanted to know if there are any plans to role out the multi-threaded or non-blocking support in the glib_c server?&lt;/p&gt;</comment>
                            <comment id="15102546" author="simonsouth" created="Fri, 15 Jan 2016 22:03:57 +0000"  >&lt;p&gt;There is no plan that I&apos;m aware of, though of course everyone is free to submit a patch.&lt;/p&gt;

&lt;p&gt;I would love to tackle these things myself but paid work takes priority for me most days. If you have a business case for getting enhancements to the C version implemented I&apos;d love to discuss it with you further.&lt;/p&gt;</comment>
                            <comment id="15103142" author="roger.meier" created="Sat, 16 Jan 2016 12:10:36 +0000"  >&lt;p&gt;Thanks Simon!&lt;/p&gt;</comment>
                            <comment id="15111135" author="shahanish001@yahoo.com" created="Thu, 21 Jan 2016 19:22:28 +0000"  >&lt;p&gt;Is there any documentation explaining the architecture of how the thrift glib_c library works? No business case just curiosity. If I ending up adding some features will add it here.&lt;/p&gt;</comment>
                            <comment id="15111264" author="simonsouth" created="Thu, 21 Jan 2016 20:46:50 +0000"  >&lt;p&gt;The &lt;a href=&quot;http://thrift.apache.org/docs/concepts&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Concepts page&lt;/a&gt; on the website gives a high-level overview of Thrift&apos;s architecture, and everything there applies to the C (GLib) implementation. &lt;a href=&quot;http://thrift.apache.org/tutorial/c_glib&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;The tutorials&lt;/a&gt;, if you haven&apos;t read through them yet, also explain a little bit about how everything fits together.&lt;/p&gt;

&lt;p&gt;The C implementation intentionally mirrors the C++ one, so much of what can be said about the latter applies to the former as well (with accommodations for GObject, such as its lack of template support). There is not a tremendous amount of documentation on Thrift yet, though, so reading through the code may still be your best bet.&lt;/p&gt;

&lt;p&gt;By the way, &lt;a href=&quot;http://thrift.apache.org/mailing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the developer mailing list&lt;/a&gt; is a better place to ask this sort of question.&lt;/p&gt;</comment>
                            <comment id="15111276" author="shahanish001@yahoo.com" created="Thu, 21 Jan 2016 20:54:02 +0000"  >&lt;p&gt;I was missing the Concepts page.  I am not familiar with GObject so it is difficult for me to understand some parts of the code. I will dig through the code. Thank you.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12782257" name="0001-c_glib-Fix-memory-leak-in-processor.patch" size="2197" author="simonsouth" created="Thu, 14 Jan 2016 10:42:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 43 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2r9d3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>