<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:34:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-5540] Can&apos;t use a typedef for a container type containing enums in a constant</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-5540</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;This small thrift file fails to compile.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;enum&lt;/span&gt; SomeEnum {
&#160; &#160; A,
&#160; &#160; B,
&#160; &#160; C
}
typedef map&amp;lt;SomeEnum, i32&amp;gt; SomeMap
&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; SomeMap MY_MAP = {
&#160; &#160; SomeEnum.A: 123,
&#160; &#160; SomeEnum.B: 456,
&#160; &#160; SomeEnum.C: 789
}
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Trying to compile this thrift file results in this error:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[FAILURE:generation:1] Error: have identifier &lt;span class=&quot;code-quote&quot;&gt;&quot;SomeEnum.A&quot;&lt;/span&gt;, but unset &lt;span class=&quot;code-keyword&quot;&gt;enum&lt;/span&gt; on line!&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If I didn&apos;t use the typedef and instead declared MY_MAP with type map&amp;lt;SomeEnum, i32&amp;gt;, there is no issues with compilation. This issue also happens if SomeEnum is the value type in the map, and it also happens for typedefs of lists of enums.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13434016">THRIFT-5540</key>
            <summary>Can&apos;t use a typedef for a container type containing enums in a constant</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jensg">Jens Geyer</assignee>
                                    <reporter username="rchomium">Raymond Chee</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Mar 2022 04:15:01 +0000</created>
                <updated>Wed, 26 Oct 2022 23:46:25 +0000</updated>
                            <resolved>Thu, 17 Mar 2022 08:49:18 +0000</resolved>
                                    <version>0.16.0</version>
                                    <fixVersion>0.17.0</fixVersion>
                                    <component>Compiler (General)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17507863" author="jensg" created="Wed, 16 Mar 2022 20:49:54 +0000"  >&lt;p&gt;I cannot reproduce the error message. Could you tell the exact command you used?&lt;/p&gt;</comment>
                            <comment id="17507867" author="jensg" created="Wed, 16 Mar 2022 20:58:10 +0000"  >&lt;p&gt;Ok, not all are affected but a lot are.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;cpp&lt;/li&gt;
	&lt;li&gt;dart&lt;/li&gt;
	&lt;li&gt;D lang&lt;/li&gt;
	&lt;li&gt;erlang&lt;/li&gt;
	&lt;li&gt;Go&lt;/li&gt;
	&lt;li&gt;...&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17507877" author="fishywang" created="Wed, 16 Mar 2022 21:07:43 +0000"  >&lt;p&gt;Constants in thrift files are big minefield unfortunately. For go compiler there were &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4253&quot; title=&quot;Go generator assigns strings to field in const instead of pointers.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4253&quot;&gt;&lt;del&gt;THRIFT-4253&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-5389&quot; title=&quot;Thrift compiler generates uncompilable go code around optional constants&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-5389&quot;&gt;&lt;del&gt;THRIFT-5389&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-5461&quot; title=&quot;Invalid golang code generated for optional set&amp;lt;binary&amp;gt; with a default value&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-5461&quot;&gt;&lt;del&gt;THRIFT-5461&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-5463&quot; title=&quot;Incorrect and inconsistency in compiler generated go code regarding pointer types&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-5463&quot;&gt;THRIFT-5463&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17507896" author="jensg" created="Wed, 16 Mar 2022 22:25:22 +0000"  >&lt;p&gt;Unresolved typedefs are as well. Gave up counting the number of issues I fixed around those.&lt;/p&gt;</comment>
                            <comment id="17507897" author="jensg" created="Wed, 16 Mar 2022 22:38:22 +0000"  >&lt;p&gt;The problem is the way how symbolic constants, particularly enums, are (not) resolved.&lt;/p&gt;

&lt;p&gt;The parsing code actually does indeed call &lt;tt&gt;const_value.set_enum()&lt;/tt&gt;. which sets up the connection between the reference and the underlying type, but it&apos;s way too late and therefore essentially only sets the value for the constant of the previous pass. The second pass references never get resolved, but these are used when the actual integer value is fetched, usually during &lt;tt&gt;generate_const()&lt;/tt&gt;. That call is made differently in the various generators, so some are running into that trap and some don&apos;t.&lt;/p&gt;

&lt;p&gt;The patch fixes the references before entering generation state (and also fixes a typedef dereference issue).&lt;/p&gt;</comment>
                            <comment id="17508058" author="jensg" created="Thu, 17 Mar 2022 08:50:33 +0000"  >&lt;p&gt;Good catch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rchomium&quot; class=&quot;user-hover&quot; rel=&quot;rchomium&quot;&gt;rchomium&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z10ir4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>