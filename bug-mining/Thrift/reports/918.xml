<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:11:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-2430] Crash during TThreadPoolServer shutdown</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-2430</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;While destroying a TThreadPoolServer instance, an unhandled exception occurred. For more details please see the comment, with the according mailing list thread.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 7&lt;br/&gt;
Visual Studio 2008&lt;br/&gt;
32 bit build&lt;/p&gt;</environment>
        <key id="12704288">THRIFT-2430</key>
            <summary>Crash during TThreadPoolServer shutdown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jensg">Jens Geyer</assignee>
                                    <reporter username="lbenner">Lars Benner</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Mar 2014 16:13:29 +0000</created>
                <updated>Mon, 26 May 2014 22:41:36 +0000</updated>
                            <resolved>Fri, 28 Mar 2014 20:47:26 +0000</resolved>
                                    <version>0.9.1</version>
                                    <fixVersion>0.9.2</fixVersion>
                                    <component>C++ - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13950956" author="lbenner" created="Fri, 28 Mar 2014 16:14:11 +0000"  >&lt;p&gt;Hi Lars,&lt;/p&gt;

&lt;p&gt;just create a JIRA ticket and add the patch file as outlined in &lt;a href=&quot;http://thrift.apache.org/docs/HowToContribute&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://thrift.apache.org/docs/HowToContribute&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
JensG&lt;/p&gt;



&lt;p&gt;----&lt;del&gt;Urspr&#252;ngliche Nachricht&lt;/del&gt;----&lt;br/&gt;
From: Lars Benner&lt;br/&gt;
Sent: Tuesday, March 25, 2014 7:02 PM&lt;br/&gt;
To: user@thrift.apache.org&lt;br/&gt;
Subject: RE: C++ TThreadPoolServer shutdown&lt;/p&gt;

&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I rebuild the Thrift lib today, just to make sure my lib wasn&apos;t corrupted.&lt;/p&gt;

&lt;p&gt;During the rebuild I got a warning, that no public symbols are available for TTransportException. For removing this warning I moved the implementation of&lt;br/&gt;
TTransportException::what() from the header file to the cpp file. After doing this and rebuilding the complete application the problem was gone.&lt;/p&gt;

&lt;p&gt;I not quite sure if I have enough insight in the compiler and linker stuff. &lt;br/&gt;
But I assume that somehow the code generated for TTransportException for the lib and in my application did not match. Which would also explain the lack off a call stack. And by moving at least one method into the cpp file and thus into the lib, the lib code was used for building the actual application.&lt;/p&gt;

&lt;p&gt;Anyway, I prefer implementations of virtual functions in the cpp files. So what is the best way for getting my changes into the next version?&lt;/p&gt;

&lt;p&gt;Thanks again for all your comments and help,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Lars&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;----&lt;del&gt;Original Message&lt;/del&gt;----&lt;br/&gt;
From: Nevo Hed &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;mailto:nhed+thriftusr@aereo.com&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;nhed+thriftusr@aereo.com&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/mail_small.gif&quot; height=&quot;12&quot; width=&quot;13&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;br/&gt;
Sent: Tuesday, March 25, 2014 4:51 PM&lt;br/&gt;
To: Thrift Users&lt;br/&gt;
Subject: Re: C++ TThreadPoolServer shutdown&lt;/p&gt;

&lt;p&gt;ignore me, I didn&apos;t even pay attention to which threads are being joined etc&lt;/p&gt;


&lt;p&gt;On Tue, Mar 25, 2014 at 11:48 AM, Nevo Hed &amp;lt;nhed+thriftusr@aereo.com&amp;gt; wrote:&lt;/p&gt;

&lt;p&gt;&amp;gt; Never used this class nor look at trace but I think join is called &lt;br/&gt;
&amp;gt; already from serve (so you should not call it again)&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt;   // If stopped manually, join the existing threads&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt;   if (stop_) {&lt;br/&gt;
&amp;gt;     try &lt;/p&gt;
{
&amp;gt;       serverTransport_-&amp;gt;close();
&amp;gt;       threadManager_-&amp;gt;join();
&amp;gt;     }
&lt;p&gt; catch (TException &amp;amp;tx) {&lt;br/&gt;
&amp;gt;       string errStr = string(&quot;TThreadPoolServer: Exception shutting down:&lt;br/&gt;
&amp;gt; &quot;) + tx.what();&lt;br/&gt;
&amp;gt;       GlobalOutput(errStr.c_str());&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; On Mon, Mar 24, 2014 at 4:38 PM, Lars Benner &amp;lt;LBenner@tomtec.de&amp;gt; wrote:&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt; Hi,&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt; I am having a problem, while shutting down a multithreaded thrift &lt;br/&gt;
&amp;gt;&amp;gt; session. Basically I am setting up a TThreadPoolServer with a &lt;br/&gt;
&amp;gt;&amp;gt; TPipeServer.&lt;br/&gt;
&amp;gt;&amp;gt; Therefore, I call in a separate thread, the serve function of&lt;br/&gt;
&amp;gt;&amp;gt; TThreadPoolServer:&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt; void run()&lt;br/&gt;
&amp;gt;&amp;gt; &lt;/p&gt;
{
&amp;gt;&amp;gt;   ...
&amp;gt;&amp;gt;
&amp;gt;&amp;gt;   d-&amp;gt;pServer-&amp;gt;serve();
&amp;gt;&amp;gt; }
&lt;p&gt;&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt; For shutting down the server, this is done:&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt; void shutdown()&lt;br/&gt;
&amp;gt;&amp;gt; &lt;/p&gt;
{
&amp;gt;&amp;gt;   d-&amp;gt;pServer-&amp;gt;stop();
&amp;gt;&amp;gt;
&amp;gt;&amp;gt;   d-&amp;gt;serverThread.join();
&amp;gt;&amp;gt; }
&lt;p&gt;&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt; If I debug the shutdown function, stepping in or over the stop call &lt;br/&gt;
&amp;gt;&amp;gt; works without a problem. But while waiting for the thread to &lt;br/&gt;
&amp;gt;&amp;gt; terminate I get an unhandled exception:&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt; &quot;Unhandled exception at ...: Access violation reading location &lt;br/&gt;
&amp;gt;&amp;gt; 0xffffffff.&quot;&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt; I figured out that exceptions are used for closing the connection. It &lt;br/&gt;
&amp;gt;&amp;gt; actually looks like, that the Visual Studio debugger is able to catch &lt;br/&gt;
&amp;gt;&amp;gt; the exception as intended, but if I tried to do the next step, I see &lt;br/&gt;
&amp;gt;&amp;gt; the exception above.&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt; Has anybody observed a similar issue or has an idea what is going wrong?&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt; Please let me additionally note that everything else is working &lt;br/&gt;
&amp;gt;&amp;gt; great, including several thousand calls from the client to the server.&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt; You might want also some additional information:&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt; Thrift version: 0.9.1&lt;br/&gt;
&amp;gt;&amp;gt; Visual Studio 2008&lt;br/&gt;
&amp;gt;&amp;gt; Boost version: 1.54.0&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt; Thanks,&lt;br/&gt;
&amp;gt;&amp;gt; - Lars&lt;/p&gt;</comment>
                            <comment id="13950960" author="lbenner" created="Fri, 28 Mar 2014 16:19:20 +0000"  >&lt;p&gt;Added patch for fixing the crash. &lt;/p&gt;</comment>
                            <comment id="13951362" author="jensg" created="Fri, 28 Mar 2014 20:47:26 +0000"  >&lt;p&gt;LGTM, and if it solves the issue - committed. &lt;br/&gt;
Thanks Lars!&lt;/p&gt;</comment>
                            <comment id="13951637" author="hudson" created="Sat, 29 Mar 2014 00:15:46 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #1099 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/1099/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/1099/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2430&quot; title=&quot;Crash during TThreadPoolServer shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2430&quot;&gt;&lt;del&gt;THRIFT-2430&lt;/del&gt;&lt;/a&gt; Crash during TThreadPoolServer shutdown (jensg: rev ea6076f1750fecf2f2bd0a9fa4747f916588427b)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/cpp/src/thrift/transport/TTransportException.cpp&lt;/li&gt;
	&lt;li&gt;lib/cpp/src/thrift/transport/TTransportException.h&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12637440" name="thrift-2430-crash-fix.patch" size="10788" author="lbenner" created="Fri, 28 Mar 2014 16:19:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>382622</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 34 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1tx3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>382890</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>