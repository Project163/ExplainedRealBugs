<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:55:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-153] Invalid code generated for string constants containing single quotes (&apos;)</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-153</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;If I declare a constant in a Thrift iDL like this:&lt;/p&gt;

&lt;p&gt;const string HAMMER_TIME = &quot;Can&apos;t touch this&quot;;&lt;/p&gt;

&lt;p&gt;The generated Python sources generate a constant like this:&lt;/p&gt;

&lt;p&gt;HAMMER_TIME = &apos;Can&apos;t touch this&apos;;&lt;/p&gt;

&lt;p&gt;This doesn&apos;t work because the apostrophe terminates the string constant.&lt;/p&gt;

&lt;p&gt;Since Python supports string constants using either &apos; or &quot;, an easy fix is just to use &quot; around Python constants instead:&lt;/p&gt;


&lt;p&gt;Index: compiler/cpp/src/generate/t_py_generator.cc&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; compiler/cpp/src/generate/t_py_generator.cc	(revision 701711)&lt;br/&gt;
+++ compiler/cpp/src/generate/t_py_generator.cc	(working copy)&lt;br/&gt;
@@ -363,7 +363,7 @@&lt;br/&gt;
     t_base_type::t_base tbase = ((t_base_type*)type)-&amp;gt;get_base();&lt;br/&gt;
     switch (tbase) {&lt;br/&gt;
     case t_base_type::TYPE_STRING:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;out &amp;lt;&amp;lt; &quot;&apos;&quot; &amp;lt;&amp;lt; value-&amp;gt;get_string() &amp;lt;&amp;lt; &quot;&apos;&quot;;&lt;br/&gt;
+      out &amp;lt;&amp;lt; &apos;&quot;&apos; &amp;lt;&amp;lt; value-&amp;gt;get_string() &amp;lt;&amp;lt; &apos;&quot;&apos;;&lt;br/&gt;
       break;&lt;br/&gt;
     case t_base_type::TYPE_BOOL:&lt;br/&gt;
       out &amp;lt;&amp;lt; (value-&amp;gt;get_integer() &amp;gt; 0 ? &quot;True&quot; : &quot;False&quot;);&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12405748">THRIFT-153</key>
            <summary>Invalid code generated for string constants containing single quotes (&apos;)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shigin">Alexander Shigin</assignee>
                                    <reporter username="engberg">Dave Engberg</reporter>
                        <labels>
                    </labels>
                <created>Sat, 4 Oct 2008 21:31:13 +0000</created>
                <updated>Tue, 1 Nov 2011 02:52:07 +0000</updated>
                            <resolved>Thu, 26 Mar 2009 23:33:15 +0000</resolved>
                                                                    <component>C# - Compiler</component>
                    <component>C++ - Compiler</component>
                    <component>Cocoa - Compiler</component>
                    <component>Compiler (General)</component>
                    <component>Erlang - Compiler</component>
                    <component>Haskell - Compiler</component>
                    <component>Java - Compiler</component>
                    <component>Perl - Compiler</component>
                    <component>PHP - Compiler</component>
                    <component>Python - Compiler</component>
                    <component>Ruby - Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12636858" author="engberg" created="Sat, 4 Oct 2008 21:31:48 +0000"  >&lt;p&gt;patch&lt;/p&gt;</comment>
                            <comment id="12636929" author="shigin" created="Sun, 5 Oct 2008 18:46:50 +0000"  >&lt;p&gt;It&apos;s better to use triple quote in this case, because your patch will break generated code if constant contains double quote. &lt;/p&gt;

&lt;p&gt;Here is my version of the patch.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Index: compiler/cpp/src/generate/t_py_generator.cc
===================================================================
--- compiler/cpp/src/generate/t_py_generator.cc	(revision 701711)
+++ compiler/cpp/src/generate/t_py_generator.cc	(working copy)
@@ -363,7 +363,7 @@
     t_base_type::t_base tbase = ((t_base_type*)type)-&amp;gt;get_base();
     &lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt; (tbase) {
     &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; t_base_type::TYPE_STRING:
-      out &amp;lt;&amp;lt; &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&lt;/span&gt; &amp;lt;&amp;lt; value-&amp;gt;get_string() &amp;lt;&amp;lt; &lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;&lt;/span&gt;&quot;&lt;/span&gt;;
+      out &amp;lt;&amp;lt; &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-quote&quot;&gt;&apos;&apos;&apos;&quot;&lt;/span&gt; &amp;lt;&amp;lt; value-&amp;gt;get_string() &amp;lt;&amp;lt; &lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;&lt;/span&gt;&apos;&apos;&quot;&lt;/span&gt;;
       &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
     &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; t_base_type::TYPE_BOOL:
       out &amp;lt;&amp;lt; (value-&amp;gt;get_integer() &amp;gt; 0 ? &lt;span class=&quot;code-quote&quot;&gt;&quot;True&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;False&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Sorry for double post.&lt;/p&gt;</comment>
                            <comment id="12636931" author="engberg" created="Sun, 5 Oct 2008 18:48:06 +0000"  >&lt;p&gt;That sounds fine to me ... although the double-quotes would have to be escaped in the original Thrift IDL, so I assumed (incorrectly?) that this escaping would carry through to the generated code.&lt;/p&gt;</comment>
                            <comment id="12636956" author="shigin" created="Sun, 5 Oct 2008 19:32:35 +0000"  >&lt;p&gt;You have to use &apos;string with &quot; double quote&apos; and &quot;string with &apos; quote&quot; in your thrift file. You can&apos;t escape single or double quote with back slash or something like it. The literal token is described in thriftl.ll file:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;dliteral      (&lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;[^&quot;&lt;/span&gt;]*&lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;&quot;)
sliteral      (&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&lt;/span&gt;[^&apos;&lt;/span&gt;]*&lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think it should be fixed.&lt;/p&gt;</comment>
                            <comment id="12636957" author="engberg" created="Sun, 5 Oct 2008 19:38:54 +0000"  >&lt;p&gt;Ah, ok.  I&apos;ve only used double-quotes for string constants in Thrift.  In that case, it sounds like triple-quotes is the right fix for now, thanks.&lt;/p&gt;

&lt;p&gt;So it sounds like there&apos;s no way to write a string constant in a Thrift IDL which contains both a single quote and a double quote character?&lt;/p&gt;</comment>
                            <comment id="12636961" author="shigin" created="Sun, 5 Oct 2008 19:55:06 +0000"  >&lt;p&gt;It seems so.&lt;/p&gt;

&lt;p&gt;And my patch should be reworked. It&apos;s uncommon to use triple single quote, but if anyone use it, he gets an error. I think it&apos;s better to replace &apos; to \&apos; and use single quote as guard.&lt;/p&gt;

&lt;p&gt;Your string should be escaped like: &apos;Can\&apos;t touch this&apos;.&lt;/p&gt;</comment>
                            <comment id="12637187" author="mcslee" created="Mon, 6 Oct 2008 19:22:45 +0000"  >&lt;p&gt;The escaping in the Thrift file should be separate from the escaping of generated code. We should &lt;b&gt;NOT&lt;/b&gt; be putting slashes into a .thrift file to account for how they&apos;ll be escaped in Python, for example.&lt;/p&gt;

&lt;p&gt;The correct fix is to change the generators on a per-language basis to properly escape the strings that they are generating.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;out &amp;lt;&amp;lt; &quot;&apos;&quot; &amp;lt;&amp;lt; value-&amp;gt;get_string() &amp;lt;&amp;lt; &quot;&apos;&quot;;&lt;br/&gt;
+      out &amp;lt;&amp;lt; &quot;&apos;&apos;&apos;&quot; &amp;lt;&amp;lt; value-&amp;gt;get_string() &amp;lt;&amp;lt; &quot;&apos;&apos;&apos;&quot;;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This should look like:&lt;/p&gt;

&lt;p&gt;+      out &amp;lt;&amp;lt; &quot;&apos;&apos;&apos;&quot; &amp;lt;&amp;lt; this-&amp;gt;escape_py_literal(value-&amp;gt;get_string()) &amp;lt;&amp;lt; &quot;&apos;&apos;&apos;&quot;;&lt;/p&gt;

&lt;p&gt;And the method escape_*_literal should take care of proper escaping on a per-language basis.&lt;/p&gt;</comment>
                            <comment id="12637197" author="cwalters" created="Mon, 6 Oct 2008 19:38:55 +0000"  >&lt;p&gt;Mark, I think that Dave points out a flaw that should be addressed, though. We do need some kind of escaping in Thrift IDL or we can&apos;t represent strings with both single quotes and double quotes in them. However, as you correctly point out, this escaping should be separate from the escaping needs of the target languages.&lt;/p&gt;

&lt;p&gt;My recommendation:&lt;br/&gt;
1. Beef up the IDL parser to allow some form of slash escaping in the constant strings. This would not be fully backwards compatible since existing &apos;\&apos; in strings would need to be escaped. The parser would unescape these characters as they are read in.&lt;br/&gt;
2. Have the compiler perform the appropriate language-specific escaping as you suggest above.&lt;/p&gt;</comment>
                            <comment id="12637255" author="mcslee" created="Mon, 6 Oct 2008 21:36:36 +0000"  >&lt;p&gt;Ah, yes, I see. Totally overlooked that. And yes, you&apos;re right, we need to make the parser also understand escaping.&lt;/p&gt;</comment>
                            <comment id="12640669" author="dreiss" created="Fri, 17 Oct 2008 21:15:22 +0000"  >&lt;p&gt;&lt;a href=&quot;http://wiki.apache.org/thrift/EscapingVote&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/thrift/EscapingVote&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12689156" author="shigin" created="Wed, 25 Mar 2009 16:53:58 +0000"  >&lt;p&gt;The patch adds escaping method to generator and fixes lexer to allow strings like &apos;I don\&apos;t know&apos;. Can anybody check if I escape strings right?&lt;/p&gt;

&lt;p&gt;I don&apos;t know if t_const_value::get_escaped_string is a right decision.&lt;/p&gt;</comment>
                            <comment id="12689244" author="dreiss" created="Wed, 25 Mar 2009 21:23:04 +0000"  >&lt;p&gt;Awesome patch.  I made a bunch of small changes like adding escapes, fixing a few generators, making the call sites more uniform, etc.  I also changed the way get_escaped_string is called.  I like this way better, and you seemed unsure about the old way too.  I also eliminated your vim comment.  My guess is that you had the wrong filetype set because Vim defaults to &quot;LifeLines&quot; for &quot;.ll&quot;, even though it concedes that it is also used for Lex for C++.  Let me know if the modeline patch doesn&apos;t fix it.&lt;/p&gt;</comment>
                            <comment id="12689438" author="shigin" created="Thu, 26 Mar 2009 10:47:33 +0000"  >&lt;p&gt;The new version of patch.&lt;/p&gt;</comment>
                            <comment id="12689610" author="dreiss" created="Thu, 26 Mar 2009 19:14:04 +0000"  >&lt;p&gt;I think you forgot to add the files under test/const-check&lt;/p&gt;</comment>
                            <comment id="12689640" author="shigin" created="Thu, 26 Mar 2009 20:42:06 +0000"  >&lt;p&gt;Oh, there is something wrong with me in past two days. I&apos;ve missed your comments with new patch at all David, sorry.&lt;/p&gt;

&lt;p&gt;I&apos;ll check the modeline, because I do hate the &quot;comment fix&quot;. Perl &apos;\n&apos; was a big surprise for me. The absent of test/const-check is even worse. I haven&apos;t made one &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. It&apos;s hard for me to create test suite because I have to read a manual about automake, autoconf, etc...&lt;/p&gt;

&lt;p&gt;Your decision to make get_escaped_string is better than send this to const_value.&lt;/p&gt;

&lt;p&gt;Here a couple strange things in your patch:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;we don&apos;t need t_php_generator::escape_string anymore;&lt;/li&gt;
	&lt;li&gt;why do you escape &amp;apos; in html generator?&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;So, if escaping is right it&apos;s lgtm.&lt;/p&gt;</comment>
                            <comment id="12689723" author="seliopou" created="Thu, 26 Mar 2009 23:14:50 +0000"  >&lt;p&gt;I tried compiling with dreiss&apos; patch and got the following error:&lt;/p&gt;

&lt;p&gt;thriftl.ll: In function &apos;int yylex()&apos;:&lt;br/&gt;
thriftl.ll:263: error: &apos;mark&apos; cannot appear in a constant-expression&lt;/p&gt;

&lt;p&gt;The attached patch fixes this problem by putting the mark case in default.&lt;/p&gt;</comment>
                            <comment id="12689725" author="dreiss" created="Thu, 26 Mar 2009 23:20:08 +0000"  >&lt;p&gt;Yeah, I thought that felt a little sketchy.&lt;/p&gt;</comment>
                            <comment id="12689734" author="dreiss" created="Thu, 26 Mar 2009 23:33:15 +0000"  >&lt;p&gt;Tentatively marking this resolved.  Feel free to reopen if I broke something.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12403754" name="0001-THRIFT-153.-Proper-handling-of-strings-with-escapes.v2.patch" size="14907" author="seliopou" created="Thu, 26 Mar 2009 23:14:50 +0000"/>
                            <attachment id="12403728" name="ASF.LICENSE.NOT.GRANTED--0001-THRIFT-153.-Proper-handling-of-strings-with-escapes.patch" size="16265" author="dreiss" created="Thu, 26 Mar 2009 19:38:32 +0000"/>
                            <attachment id="12403639" name="ASF.LICENSE.NOT.GRANTED--0001-THRIFT-153.-Proper-handling-of-strings-with-escapes.patch" size="16783" author="dreiss" created="Wed, 25 Mar 2009 21:20:21 +0000"/>
                            <attachment id="12403640" name="ASF.LICENSE.NOT.GRANTED--0002-Make-vim-recognize-that-thriftl.ll-is-Lex-source.patch" size="573" author="dreiss" created="Wed, 25 Mar 2009 21:20:21 +0000"/>
                            <attachment id="12391476" name="t_py_generator.cc.diff" size="600" author="engberg" created="Sat, 4 Oct 2008 21:31:48 +0000"/>
                            <attachment id="12403703" name="thrift-const-escaping-v2.thrift" size="15990" author="shigin" created="Thu, 26 Mar 2009 10:47:33 +0000"/>
                            <attachment id="12403619" name="thrift-const-escaping.thrift" size="16179" author="shigin" created="Wed, 25 Mar 2009 16:53:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38491</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 35 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16bh3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>244991</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>