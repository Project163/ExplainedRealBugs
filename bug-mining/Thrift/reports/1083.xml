<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:15:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-2793] Go compiler produces uncompilable code</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-2793</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;The Thrift Go compiler produces wrong code for the following code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;struct A { 1: list&amp;lt;B&amp;gt; b }
struct B { 1: i64 id }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The abbreviated reader method creates a []B instead of a []*B but still tries to add a &amp;amp;B{}.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; func (p *A) ReadField1(iprot thrift.TProtocol) error {
     ...
     tSlice := make([]B, 0, size)
     ...
     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; i := 0; i &amp;lt; size; i++ {
         _elem0 := &amp;amp;B{}
         ...
         p.B = append(p.B, _elem0)
     }
     ...
 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The Go compiler message is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ go version
go version go1.3.3 darwin/amd64
$ go build
./ttypes.go:74: cannot use _elem0 (type *B) as type B in append
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Moving struct B &lt;b&gt;above&lt;/b&gt; struct A produces correct code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;struct B { 1: i64 id }
struct A { 1: list&amp;lt;B&amp;gt; b }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The abbreviated reader method:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; func (p *A) ReadField1(iprot thrift.TProtocol) error {
     ...
     tSlice := make([]*B, 0, size)
     ...
     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; i := 0; i &amp;lt; size; i++ {
         _elem0 := &amp;amp;B{}
         ...
         p.B = append(p.B, _elem0)
     }
     ...
 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This problem does not occurr with enums since they are aliases for int64. So both versions generate correct code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;struct A { 1: list&amp;lt;B&amp;gt; b }
&lt;span class=&quot;code-keyword&quot;&gt;enum&lt;/span&gt; B { X }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;enum&lt;/span&gt; B { X }
struct A { 1: list&amp;lt;B&amp;gt; b }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Tested with version 902b7af4c84b8f716668d4d4f10612c16109c09a from &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf/thrift.git&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf/thrift.git&lt;/a&gt;.&lt;br/&gt;
I&apos;ve built the thrift compiler with the following flags:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;PATH=/opt/boxen/homebrew/Cellar/bison27/2.7.1/bin:$PATH ./configure \
    --without-cpp \
    --without-qt4 \
    --without-c_glib \
    --without-csharp \
    --without-java \
    --without-erlang \
    --without-nodejs \
    --without-lua \
    --without-python \
    --without-perl \
    --without-php \
    --without-php_extension \
    --without-ruby \
    --without-haskell \
    --with-go
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and generate the thrift stubs as follows: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;../compiler/cpp/thrift --gen go -out . model.thrift
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ll try to dig a bit through the source of the generator to see whether I can produce a patch.&lt;/p&gt;</description>
                <environment>&lt;p&gt;OSX 10.10&lt;/p&gt;</environment>
        <key id="12751219">THRIFT-2793</key>
            <summary>Go compiler produces uncompilable code</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jensg">Jens Geyer</assignee>
                                    <reporter username="magiconair">Frank Schroeder</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Oct 2014 20:25:47 +0000</created>
                <updated>Mon, 2 Feb 2015 11:54:45 +0000</updated>
                            <resolved>Wed, 5 Nov 2014 08:26:22 +0000</resolved>
                                    <version>0.9.2</version>
                                    <fixVersion>0.9.2</fixVersion>
                                    <component>Go - Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14187394" author="magiconair" created="Tue, 28 Oct 2014 20:31:38 +0000"  >&lt;p&gt;Same applies to sets&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;struct A { 1: set&amp;lt;B&amp;gt; b }
struct B { 1: i64 id }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;produces &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;./ttypes.go:74: cannot use _elem0 (type *B) as type B in map index
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;since it creates &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;tSet := make(map[B]bool, size)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;instead of &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;tSet := make(map[*B]bool, size)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14187425" author="magiconair" created="Tue, 28 Oct 2014 20:45:57 +0000"  >&lt;p&gt;It looks like the compiler does not recognize that the second struct is a struct and treats it as an enum since not only the reader function is affected. This code &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;struct B { 1: i64 id }
struct A { 1: list&amp;lt;B&amp;gt; b, 2: list&amp;lt;C&amp;gt; c }
struct C { 1: i64 id }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;generates this definition for A&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; type A struct {
     B []*B `thrift:&lt;span class=&quot;code-quote&quot;&gt;&quot;b,1&quot;&lt;/span&gt; json:&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;`
     C []C  `thrift:&lt;span class=&quot;code-quote&quot;&gt;&quot;c,2&quot;&lt;/span&gt; json:&lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;`
 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14187441" author="jensg" created="Tue, 28 Oct 2014 20:53:34 +0000"  >&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12677687/12677687_Thrift2793.thrift&quot; title=&quot;Thrift2793.thrift attached to THRIFT-2793&quot;&gt;Here&apos;s an IDL file&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; with all of your above mentioned test cases rolled into one file. I can confirm the problem using that file. &lt;/p&gt;</comment>
                            <comment id="14193382" author="magiconair" created="Sat, 1 Nov 2014 19:28:15 +0000"  >&lt;p&gt;I&apos;ve attached a patch which should solve it. I want to complete it with a new test case in the build if possible. But someone else can check the patch out already whether it makes sense.&lt;/p&gt;</comment>
                            <comment id="14193453" author="jensg" created="Sat, 1 Nov 2014 20:37:30 +0000"  >&lt;p&gt;LGTM, all tests succeed =&amp;gt; committed&lt;/p&gt;

&lt;p&gt;&amp;gt; I want to complete it with a new test case in the build if possible. &lt;/p&gt;

&lt;p&gt;Having a dedicated test case would be cool indeed. I leave the ticket open.&lt;/p&gt;</comment>
                            <comment id="14193504" author="hudson" created="Sat, 1 Nov 2014 21:39:13 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #1329 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/1329/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/1329/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2793&quot; title=&quot;Go compiler produces uncompilable code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2793&quot;&gt;&lt;del&gt;THRIFT-2793&lt;/del&gt;&lt;/a&gt; Go compiler produces uncompilable code (jensg: rev 6e43b18526a92264dca8d3d0d6ac27b9fcdc1961)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;compiler/cpp/src/generate/t_go_generator.cc&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14197530" author="hudson" created="Wed, 5 Nov 2014 04:48:44 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #1331 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/1331/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/1331/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2793&quot; title=&quot;Go compiler produces uncompilable code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2793&quot;&gt;&lt;del&gt;THRIFT-2793&lt;/del&gt;&lt;/a&gt; Go compiler produces uncompilable code (jensg: rev 6e43b18526a92264dca8d3d0d6ac27b9fcdc1961)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;compiler/cpp/src/generate/t_go_generator.cc&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14197670" author="magiconair" created="Wed, 5 Nov 2014 06:26:25 +0000"  >&lt;p&gt;Can we move this back to 0.9.2 since this fixes a bug there? I&apos;ll try to get a test case ready by next week but if it helps to get it into 0.9.2 then close the ticket without the test case. I&apos;ll provide the test case in any case.&lt;/p&gt;</comment>
                            <comment id="14197855" author="jensg" created="Wed, 5 Nov 2014 08:22:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=magiconair&quot; class=&quot;user-hover&quot; rel=&quot;magiconair&quot;&gt;magiconair&lt;/a&gt;, &lt;br/&gt;
the patch is already committed into 0.9.2, see above (even though it is not mentioned in CHANGES). I file a separate ticket  for the test case to make this clear, no prb.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jfarrell&quot; class=&quot;user-hover&quot; rel=&quot;jfarrell&quot;&gt;jfarrell&lt;/a&gt; &lt;br/&gt;
FYI&lt;/p&gt;
</comment>
                            <comment id="14197865" author="jensg" created="Wed, 5 Nov 2014 08:26:22 +0000"  >&lt;p&gt;Already committed into 0.9.2, FUP for test case see &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2796&quot; title=&quot;Testcase for THRIFT-2793&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2796&quot;&gt;&lt;del&gt;THRIFT-2796&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14198314" author="jfarrell" created="Wed, 5 Nov 2014 12:03:37 +0000"  >&lt;p&gt;missed in changelog script due to being in resolved state and not closed, will add api calls to ensure all resolved tickets have approperate flags on them and then automatically close before generating the list. this is the only ticket in this case that was impacted&lt;/p&gt;</comment>
                            <comment id="14198330" author="hudson" created="Wed, 5 Nov 2014 12:46:58 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #1332 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/1332/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/1332/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2793&quot; title=&quot;Go compiler produces uncompilable code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2793&quot;&gt;&lt;del&gt;THRIFT-2793&lt;/del&gt;&lt;/a&gt;: Go compiler produces uncompilable code (jfarrell: rev e81367bb95714a4720d36c5bf3bb0386d4ae04c0)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;CHANGES&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14198354" author="magiconair" created="Wed, 5 Nov 2014 13:23:46 +0000"  >&lt;p&gt;Thanks guys &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12752990">THRIFT-2796</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12770661">THRIFT-2955</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12678705" name="THRIFT-2793.patch" size="2426" author="magiconair" created="Sat, 1 Nov 2014 19:28:43 +0000"/>
                            <attachment id="12677687" name="Thrift2793.thrift" size="242" author="jensg" created="Tue, 28 Oct 2014 20:53:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 2 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21ovr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>