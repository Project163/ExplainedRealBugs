<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:27:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-4266] Erlang library throws during skipping fields of composite type (maps, lists, structs, sets)</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-4266</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;I am creating this issue because I am unable to reopen &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1191&quot; title=&quot;Erlang binding throws during skipping fields of composite type (maps, lists, structs, sets)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1191&quot;&gt;&lt;del&gt;THRIFT-1191&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The Erlang thrift library throws an error when it attempts skip over an unknown field when decoding a message.&lt;/p&gt;

&lt;p&gt;The issue is that the second argument of the `thrift_protocol:skip` function must be an atom, but the calls to the `skip` function in `skip_struct_loop`, skip_map_loop`, skip_set_loop`, and `skip_list_loop` do not convert the type of the received field header from the integer form to the atom form.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13090328">THRIFT-4266</key>
            <summary>Erlang library throws during skipping fields of composite type (maps, lists, structs, sets)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dhull">David Hull</assignee>
                                    <reporter username="dhull">David Hull</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Jul 2017 20:50:04 +0000</created>
                <updated>Thu, 14 Dec 2017 13:55:54 +0000</updated>
                            <resolved>Sat, 5 Aug 2017 12:05:21 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.11.0</fixVersion>
                                    <component>Erlang - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16103562" author="githubbot" created="Thu, 27 Jul 2017 17:39:07 +0000"  >&lt;p&gt;GitHub user dhull opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1316&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1316&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4266&quot; title=&quot;Erlang library throws during skipping fields of composite type (maps, lists, structs, sets)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4266&quot;&gt;&lt;del&gt;THRIFT-4266&lt;/del&gt;&lt;/a&gt;: Erlang skip fix&lt;/p&gt;

&lt;p&gt;    The Erlang library has a bug that causes it to crash when attempting to skip over a struct that it receives that does not exist in its thrift definition. This will happen when the client and server are using different versions of the thrift definition where one of the versions adds a struct field to an existing struct.&lt;/p&gt;

&lt;p&gt;    This pull request has two commits. The first commit adds a test that fails with the existing Erlang library. The second commit fixes the bug.&lt;/p&gt;

&lt;p&gt;    The bug was that the `erlang_protocol:skip` function expects an atom as its second (Type) argument, but the calls in `skip_struct_loop`, `skip_map_loop`, `skip_set_loop`, and `skip_list_loop` did not convert from the integer type decoded from the buffer to the corresponding atom.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dhull/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dhull/thrift&lt;/a&gt; thrift-4266-erlang-skip-fix&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1316.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1316.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1316&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 79874dbe079fbabba663568e5ed31ffab540329a&lt;br/&gt;
Author: David Hull &amp;lt;david.hull@openx.com&amp;gt;&lt;br/&gt;
Date:   2017-07-26T21:27:02Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4266&quot; title=&quot;Erlang library throws during skipping fields of composite type (maps, lists, structs, sets)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4266&quot;&gt;&lt;del&gt;THRIFT-4266&lt;/del&gt;&lt;/a&gt;: Fix skipping of unknown fields in Erlang client.&lt;/p&gt;

&lt;p&gt;commit 8fd55cc7685ea2ea22016296936789572dd83c56&lt;br/&gt;
Author: David Hull &amp;lt;david.hull@openx.com&amp;gt;&lt;br/&gt;
Date:   2017-07-27T00:15:00Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4266&quot; title=&quot;Erlang library throws during skipping fields of composite type (maps, lists, structs, sets)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4266&quot;&gt;&lt;del&gt;THRIFT-4266&lt;/del&gt;&lt;/a&gt;: Add Erlang deleted field test.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16103915" author="githubbot" created="Thu, 27 Jul 2017 21:08:57 +0000"  >&lt;p&gt;Github user Jens-G commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1316&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1316&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Anyone amongst the fluently Erlang speaking people who wants to review this?&lt;/p&gt;</comment>
                            <comment id="16104022" author="githubbot" created="Thu, 27 Jul 2017 22:28:10 +0000"  >&lt;p&gt;Github user djnym commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1316#discussion_r129973811&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1316#discussion_r129973811&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/erl/test/test_omit.erl &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,82 @@&lt;br/&gt;
    +-module(test_omit).&lt;br/&gt;
    +&lt;br/&gt;
    +-include(&quot;gen-erl/thrift_omit_with_types.hrl&quot;).&lt;br/&gt;
    +&lt;br/&gt;
    +-ifdef(TEST).&lt;br/&gt;
    +-include_lib(&quot;eunit/include/eunit.hrl&quot;).&lt;br/&gt;
    +&lt;br/&gt;
    +omit_struct1_test() -&amp;gt;&lt;br/&gt;
    +  %% In this test, the field that is deleted is a basic type (an i32).&lt;br/&gt;
    +  A = #test1&lt;/p&gt;
{one = 1, three = 3}
&lt;p&gt;,&lt;br/&gt;
    +  B = #test1&lt;/p&gt;
{one = 1, two = 2, three = 3}
&lt;p&gt;,&lt;br/&gt;
    +  &lt;/p&gt;
{ok, Transport}
&lt;p&gt; = thrift_membuffer_transport:new(),&lt;br/&gt;
    +  &lt;/p&gt;
{ok, P0}
&lt;p&gt; = thrift_binary_protocol:new(Transport),&lt;br/&gt;
    +&lt;br/&gt;
    +  &lt;/p&gt;
{P1, ok}
&lt;p&gt; = thrift_protocol:write(P0, &lt;tt&gt;struct, {thrift_omit_with_types, element(1, A)&lt;/tt&gt;, A}),&lt;br/&gt;
    +  {P2, {ok, O0}} = thrift_protocol:read(P1, {struct, {thrift_omit_without_types, element(1, A)}}),&lt;br/&gt;
    +  ?assertEqual(element(1, A), element(1, O0)),&lt;br/&gt;
    +  ?assertEqual(element(2, A), element(2, O0)),&lt;br/&gt;
    +  ?assertEqual(element(4, A), element(3, O0)),&lt;br/&gt;
    +&lt;br/&gt;
    +  &lt;/p&gt;
{P3, ok}
&lt;p&gt; = thrift_protocol:write(P2, &lt;tt&gt;struct, {thrift_omit_with_types, element(1, B)&lt;/tt&gt;, B}),&lt;br/&gt;
    +  {_P4, {ok, O1}} = thrift_protocol:read(P3, {struct, {thrift_omit_without_types, element(1, A)}}),&lt;br/&gt;
    +  %% io:format(user, &quot;~p ~p\n&quot;, [ A, O1 ]),&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    And there are about 3-4 other commented out lines which can probably be removed.&lt;/p&gt;</comment>
                            <comment id="16104023" author="githubbot" created="Thu, 27 Jul 2017 22:28:10 +0000"  >&lt;p&gt;Github user djnym commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1316#discussion_r129973689&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1316#discussion_r129973689&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/erl/test/test_omit.erl &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,82 @@&lt;br/&gt;
    +-module(test_omit).&lt;br/&gt;
    +&lt;br/&gt;
    +-include(&quot;gen-erl/thrift_omit_with_types.hrl&quot;).&lt;br/&gt;
    +&lt;br/&gt;
    +-ifdef(TEST).&lt;br/&gt;
    +-include_lib(&quot;eunit/include/eunit.hrl&quot;).&lt;br/&gt;
    +&lt;br/&gt;
    +omit_struct1_test() -&amp;gt;&lt;br/&gt;
    +  %% In this test, the field that is deleted is a basic type (an i32).&lt;br/&gt;
    +  A = #test1&lt;/p&gt;
{one = 1, three = 3}
&lt;p&gt;,&lt;br/&gt;
    +  B = #test1&lt;/p&gt;
{one = 1, two = 2, three = 3}
&lt;p&gt;,&lt;br/&gt;
    +  &lt;/p&gt;
{ok, Transport}
&lt;p&gt; = thrift_membuffer_transport:new(),&lt;br/&gt;
    +  &lt;/p&gt;
{ok, P0}
&lt;p&gt; = thrift_binary_protocol:new(Transport),&lt;br/&gt;
    +&lt;br/&gt;
    +  &lt;/p&gt;
{P1, ok}
&lt;p&gt; = thrift_protocol:write(P0, &lt;tt&gt;struct, {thrift_omit_with_types, element(1, A)&lt;/tt&gt;, A}),&lt;br/&gt;
    +  {P2, {ok, O0}} = thrift_protocol:read(P1, {struct, {thrift_omit_without_types, element(1, A)}}),&lt;br/&gt;
    +  ?assertEqual(element(1, A), element(1, O0)),&lt;br/&gt;
    +  ?assertEqual(element(2, A), element(2, O0)),&lt;br/&gt;
    +  ?assertEqual(element(4, A), element(3, O0)),&lt;br/&gt;
    +&lt;br/&gt;
    +  &lt;/p&gt;
{P3, ok}
&lt;p&gt; = thrift_protocol:write(P2, &lt;tt&gt;struct, {thrift_omit_with_types, element(1, B)&lt;/tt&gt;, B}),&lt;br/&gt;
    +  {_P4, {ok, O1}} = thrift_protocol:read(P3, {struct, {thrift_omit_without_types, element(1, A)}}),&lt;br/&gt;
    +  %% io:format(user, &quot;~p ~p\n&quot;, [ A, O1 ]),&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Probably don&apos;t need this commented out line.&lt;/p&gt;</comment>
                            <comment id="16104028" author="githubbot" created="Thu, 27 Jul 2017 22:29:15 +0000"  >&lt;p&gt;Github user djnym commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1316&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1316&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @Jens-G I gave it a quick review and it looks to do what it claims.  I&apos;m not sure the current process for approval, so just added the comments.  If I need to approve some other way let me know.&lt;/p&gt;
</comment>
                            <comment id="16104033" author="githubbot" created="Thu, 27 Jul 2017 22:38:05 +0000"  >&lt;p&gt;Github user dhull commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1316#discussion_r129976272&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1316#discussion_r129976272&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/erl/test/test_omit.erl &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,82 @@&lt;br/&gt;
    +-module(test_omit).&lt;br/&gt;
    +&lt;br/&gt;
    +-include(&quot;gen-erl/thrift_omit_with_types.hrl&quot;).&lt;br/&gt;
    +&lt;br/&gt;
    +-ifdef(TEST).&lt;br/&gt;
    +-include_lib(&quot;eunit/include/eunit.hrl&quot;).&lt;br/&gt;
    +&lt;br/&gt;
    +omit_struct1_test() -&amp;gt;&lt;br/&gt;
    +  %% In this test, the field that is deleted is a basic type (an i32).&lt;br/&gt;
    +  A = #test1&lt;/p&gt;
{one = 1, three = 3}
&lt;p&gt;,&lt;br/&gt;
    +  B = #test1&lt;/p&gt;
{one = 1, two = 2, three = 3}
&lt;p&gt;,&lt;br/&gt;
    +  &lt;/p&gt;
{ok, Transport}
&lt;p&gt; = thrift_membuffer_transport:new(),&lt;br/&gt;
    +  &lt;/p&gt;
{ok, P0}
&lt;p&gt; = thrift_binary_protocol:new(Transport),&lt;br/&gt;
    +&lt;br/&gt;
    +  &lt;/p&gt;
{P1, ok}
&lt;p&gt; = thrift_protocol:write(P0, &lt;tt&gt;struct, {thrift_omit_with_types, element(1, A)&lt;/tt&gt;, A}),&lt;br/&gt;
    +  {P2, {ok, O0}} = thrift_protocol:read(P1, {struct, {thrift_omit_without_types, element(1, A)}}),&lt;br/&gt;
    +  ?assertEqual(element(1, A), element(1, O0)),&lt;br/&gt;
    +  ?assertEqual(element(2, A), element(2, O0)),&lt;br/&gt;
    +  ?assertEqual(element(4, A), element(3, O0)),&lt;br/&gt;
    +&lt;br/&gt;
    +  &lt;/p&gt;
{P3, ok}
&lt;p&gt; = thrift_protocol:write(P2, &lt;tt&gt;struct, {thrift_omit_with_types, element(1, B)&lt;/tt&gt;, B}),&lt;br/&gt;
    +  {_P4, {ok, O1}} = thrift_protocol:read(P3, {struct, {thrift_omit_without_types, element(1, A)}}),&lt;br/&gt;
    +  %% io:format(user, &quot;~p ~p\n&quot;, [ A, O1 ]),&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    OK, will do.&lt;/p&gt;</comment>
                            <comment id="16114807" author="githubbot" created="Fri, 4 Aug 2017 18:46:57 +0000"  >&lt;p&gt;Github user djnym commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1316&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1316&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @Jens-G just following up here, this is good to merge, and it would be great if it could make it with @dhull other fixes in the 0.11.0 release.&lt;/p&gt;</comment>
                            <comment id="16114809" author="djnym" created="Fri, 4 Aug 2017 18:47:36 +0000"  >&lt;p&gt;This should be good to merge and it would be great if it could make it into the 0.11.0 release.&lt;/p&gt;</comment>
                            <comment id="16115386" author="githubbot" created="Sat, 5 Aug 2017 12:05:08 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1316&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1316&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16115387" author="jensg" created="Sat, 5 Aug 2017 12:05:21 +0000"  >&lt;p&gt;Committed, thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 15 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3i233:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>