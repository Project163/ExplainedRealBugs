<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:34:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-5601] Typedef after first use causes incorrect go code</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-5601</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;Currently if a typedef happens after it&apos;s first used, the compiler will generate incorrect (uncompilable) go code.&lt;/p&gt;

&lt;p&gt;For example, for this thrift file:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
struct Bar {
&#160; 1: optional Foo foo,
}

typedef i32 Foo &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The generated go code would be:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
...

type Foo int32

...

type Bar struct {
&#160; Foo *int32 `thrift:&lt;span class=&quot;code-quote&quot;&gt;&quot;foo,1&quot;&lt;/span&gt; db:&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt; json:&lt;span class=&quot;code-quote&quot;&gt;&quot;foo,omitempty&quot;&lt;/span&gt;`
}

...

func (p *Bar) &#160;ReadField1(ctx context.Context, iprot thrift.TProtocol) error {
&#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; v, err := iprot.ReadI32(ctx); err != nil {
&#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; thrift.PrependError(&lt;span class=&quot;code-quote&quot;&gt;&quot;error reading field 1: &quot;&lt;/span&gt;, err)
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; { &#160; &#160; &#160; &#160; &#160;
&#160; temp := Foo(v)
&#160; p.Foo = &amp;amp;temp &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;
}
&#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; nil
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If we move the typedef to be before it&apos;s used, then generated go code would be:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
...
type Bar struct {
&#160; Foo *Foo `thrift:&lt;span class=&quot;code-quote&quot;&gt;&quot;foo,1&quot;&lt;/span&gt; db:&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt; json:&lt;span class=&quot;code-quote&quot;&gt;&quot;foo,omitempty&quot;&lt;/span&gt;`
}
...&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;instead.&lt;/p&gt;

&lt;p&gt;Interestingly the compiler knows that the field should be of type int32 (if we change the typedef to string it would be string instead), so it&apos;s not like the compiler don&apos;t know about the typedef at all, it&apos;s just not using the correct typedef in the go code.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13469529">THRIFT-5601</key>
            <summary>Typedef after first use causes incorrect go code</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="fishywang">Yuxuan Wang</assignee>
                                    <reporter username="fishywang">Yuxuan Wang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Jun 2022 21:59:20 +0000</created>
                <updated>Sat, 15 Jul 2023 09:08:14 +0000</updated>
                                            <version>0.17.0</version>
                    <version>0.18.1</version>
                                                    <component>Go - Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17689965" author="fishywang" created="Thu, 16 Feb 2023 20:03:24 +0000"  >&lt;p&gt;Reopening because the fix was reverted&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12946891">THRIFT-3705</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="13524890">THRIFT-5685</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 38 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z16iio:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>