<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:26:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-2026] Fix TCompactProtocol 64 bit builds</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-2026</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;TCompactProtocol has several places where it truncates a size_t to a 32-bit value.&lt;/p&gt;

&lt;p&gt;TCompactProtocol also does bitwise operations on signed values, which has undefined behavior.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Mac 64, Win 64, Linux 64&lt;/p&gt;</environment>
        <key id="12652660">THRIFT-2026</key>
            <summary>Fix TCompactProtocol 64 bit builds</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ben.craig">Ben Craig</assignee>
                                    <reporter username="ben.craig">Ben Craig</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Jun 2013 14:28:34 +0000</created>
                <updated>Thu, 14 Dec 2017 13:54:47 +0000</updated>
                            <resolved>Sat, 25 Mar 2017 12:22:35 +0000</resolved>
                                    <version>0.9</version>
                                    <fixVersion>0.9.2</fixVersion>
                    <fixVersion>0.11.0</fixVersion>
                                    <component>C++ - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13794476" author="jensg" created="Mon, 14 Oct 2013 21:02:02 +0000"  >&lt;p&gt;+1, nice catch!&lt;/p&gt;</comment>
                            <comment id="13794796" author="hudson" created="Tue, 15 Oct 2013 02:22:11 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #930 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/930/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/930/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2026&quot; title=&quot;Fix TCompactProtocol 64 bit builds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2026&quot;&gt;&lt;del&gt;THRIFT-2026&lt;/del&gt;&lt;/a&gt;: Fix TCompactProtocol 64 bit builds (bencraig: rev 7f10de7ee8114ad337043f7de734481e505a3407)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/cpp/src/thrift/protocol/TCompactProtocol.tcc&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15931090" author="jbapple" created="Sat, 18 Mar 2017 06:45:01 +0000"  >&lt;p&gt;There is still undefined behavior in TCompactProtocol. For instance, &lt;a href=&quot;https://github.com/apache/thrift/blob/ddc53c32486cc23dfa63ed4e5abb19923b8d13e6/lib/cpp/src/thrift/protocol/TCompactProtocol.tcc#L390&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/blob/ddc53c32486cc23dfa63ed4e5abb19923b8d13e6/lib/cpp/src/thrift/protocol/TCompactProtocol.tcc#L390&lt;/a&gt; includes a left shift of a signed value. When that value is negatie, this results in undefined behavior. In this draft copy of the C++14 standard, &lt;a href=&quot;http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/n4582.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/n4582.pdf&lt;/a&gt;, that&apos;s 5.8 Shift operators [expr.shift], paragraph 2.&lt;/p&gt;

&lt;p&gt;I would re-open this issue, but I do not appear to have the auths to do so.&lt;/p&gt;</comment>
                            <comment id="15931300" author="jensg" created="Sat, 18 Mar 2017 17:36:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbapple&quot; class=&quot;user-hover&quot; rel=&quot;jbapple&quot;&gt;jbapple&lt;/a&gt;, here we go.&lt;/p&gt;</comment>
                            <comment id="15931388" author="githubbot" created="Sat, 18 Mar 2017 21:03:28 +0000"  >&lt;p&gt;GitHub user jbapple-cloudera opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1214&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1214&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2026&quot; title=&quot;Fix TCompactProtocol 64 bit builds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2026&quot;&gt;&lt;del&gt;THRIFT-2026&lt;/del&gt;&lt;/a&gt;: Eliminate some undefined behavior in C/C++&lt;/p&gt;

&lt;p&gt;    Clients: glib, C++&lt;br/&gt;
    Patch: Jim Apple &amp;lt;jbapple-impala@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;    These examples of undefined behavior were found using Clang&apos;s&lt;br/&gt;
    UndefinedBehaviorSanitizer (UBSan). To check them, first set your C and C++&lt;br/&gt;
    compiler to a recent Clang:&lt;/p&gt;

&lt;p&gt;        export CC=clang-3.8&lt;br/&gt;
        export CXX=clang++-3.8&lt;/p&gt;

&lt;p&gt;    Then run configure with the UBSan flags:&lt;/p&gt;

&lt;p&gt;        ./configure CFLAGS=&quot;-fsanitize=undefined \&lt;br/&gt;
        -fno-sanitize-recover=undefined -fno-sanitize=vptr&quot; CXXFLAGS=&lt;br/&gt;
        &quot;-fsanitize=undefined -fno-sanitize-recover=undefined \&lt;br/&gt;
        -fno-sanitize=vptr&quot;&lt;/p&gt;

&lt;p&gt;    Then set your environment so that the backtrace can be printed:&lt;/p&gt;

&lt;p&gt;        export UBSAN_OPTIONS=print_stacktrace=1&lt;/p&gt;

&lt;p&gt;    Finally, make sure that llvm-symbolizer corresponding to the Clang&lt;br/&gt;
    version is in your path:&lt;/p&gt;

&lt;p&gt;        export PATH=.......:${PATH}&lt;/p&gt;

&lt;p&gt;    Now you can run the build and test to see the undefined behavior.&lt;/p&gt;

&lt;p&gt;    The three examples fixed in this commit are:&lt;/p&gt;

&lt;p&gt;    Enumerations exhibit undefined behavior under bitwise operations; see&lt;br/&gt;
    libstdc++&apos;s&lt;br/&gt;
    &amp;lt;&lt;a href=&quot;https://gcc.gnu.org/bugzilla/show_bug.cgi?id=56158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gcc.gnu.org/bugzilla/show_bug.cgi?id=56158&lt;/a&gt;&amp;gt;. Adding an&lt;br/&gt;
    &quot;underlying type&quot; to t_field::e_req fixes it, following C++14 The&lt;br/&gt;
    behavior in question is in violation of chapter 5 (&quot;Expressions&quot;)&lt;br/&gt;
    paragraph 4: &quot;If during the evaluation of an expression, the result is&lt;br/&gt;
    not mathematically defined or not in the range of representable values&lt;br/&gt;
    for its type, the behavior is undefined.&quot; as well as 7.2 (&quot;Enumeration&lt;br/&gt;
    declarations&quot;), paragraph 8, which is too long to quote here.&lt;/p&gt;

&lt;p&gt;    Left shift of negative values, used in zigzag encoding, is undefined&lt;br/&gt;
    behavior. See 5.8 (&quot;Shift operators&quot;), paragraph 2 for C++ and 6.5.7&lt;br/&gt;
    (&quot;Bitwise shift operators&quot;), paragraph 4 for C99 and C11.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jbapple-cloudera/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jbapple-cloudera/thrift&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2026&quot; title=&quot;Fix TCompactProtocol 64 bit builds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2026&quot;&gt;&lt;del&gt;THRIFT-2026&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1214.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1214.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1214&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit fd007eccfb652578f556b190caff394cc327978a&lt;br/&gt;
Author: Jim Apple &amp;lt;jbapple-impala@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-03-18T19:56:50Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2026&quot; title=&quot;Fix TCompactProtocol 64 bit builds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2026&quot;&gt;&lt;del&gt;THRIFT-2026&lt;/del&gt;&lt;/a&gt;: Eliminate some undefined behavior in C/C++&lt;br/&gt;
    Clients: glib, C++&lt;br/&gt;
    Patch: Jim Apple &amp;lt;jbapple-impala@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;    These examples of undefined behavior were found using Clang&apos;s&lt;br/&gt;
    UndefinedBehaviorSanitizer (UBSan). To check them, first set your C and C++&lt;br/&gt;
    compiler to a recent Clang:&lt;/p&gt;

&lt;p&gt;        export CC=clang-3.8&lt;br/&gt;
        export CXX=clang++-3.8&lt;/p&gt;

&lt;p&gt;    Then run configure with the UBSan flags:&lt;/p&gt;

&lt;p&gt;        ./configure CFLAGS=&quot;-fsanitize=undefined \&lt;br/&gt;
        -fno-sanitize-recover=undefined -fno-sanitize=vptr&quot; CXXFLAGS=&lt;br/&gt;
        &quot;-fsanitize=undefined -fno-sanitize-recover=undefined \&lt;br/&gt;
        -fno-sanitize=vptr&quot;&lt;/p&gt;

&lt;p&gt;    Then set your environment so that the backtrace can be printed:&lt;/p&gt;

&lt;p&gt;        export UBSAN_OPTIONS=print_stacktrace=1&lt;/p&gt;

&lt;p&gt;    Finally, make sure that llvm-symbolizer corresponding to the Clang&lt;br/&gt;
    version is in your path:&lt;/p&gt;

&lt;p&gt;        export PATH=.......:${PATH}&lt;/p&gt;

&lt;p&gt;    Now you can run the build and test to see the undefined behavior.&lt;/p&gt;

&lt;p&gt;    The three examples fixed in this commit are:&lt;/p&gt;

&lt;p&gt;    Enumerations exhibit undefined behavior under bitwise operations; see&lt;br/&gt;
    libstdc++&apos;s&lt;br/&gt;
    &amp;lt;&lt;a href=&quot;https://gcc.gnu.org/bugzilla/show_bug.cgi?id=56158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gcc.gnu.org/bugzilla/show_bug.cgi?id=56158&lt;/a&gt;&amp;gt;. Adding an&lt;br/&gt;
    &quot;underlying type&quot; to t_field::e_req fixes it, following C++14 The&lt;br/&gt;
    behavior in question is in violation of chapter 5 (&quot;Expressions&quot;)&lt;br/&gt;
    paragraph 4: &quot;If during the evaluation of an expression, the result is&lt;br/&gt;
    not mathematically defined or not in the range of representable values&lt;br/&gt;
    for its type, the behavior is undefined.&quot; as well as 7.2 (&quot;Enumeration&lt;br/&gt;
    declarations&quot;), paragraph 8, which is too long to quote here.&lt;/p&gt;

&lt;p&gt;    Left shift of negative values, used in zigzag encoding, is undefined&lt;br/&gt;
    behavior. See 5.8 (&quot;Shift operators&quot;), paragraph 2 for C++ and 6.5.7&lt;br/&gt;
    (&quot;Bitwise shift operators&quot;), paragraph 4 for C99 and C11.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15931460" author="githubbot" created="Sat, 18 Mar 2017 23:20:48 +0000"  >&lt;p&gt;Github user jeking3 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1214#discussion_r106793785&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1214#discussion_r106793785&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/c_glib/src/thrift/c_glib/protocol/thrift_compact_protocol.c &amp;#8212;&lt;br/&gt;
    @@ -120,7 +120,11 @@ thrift_bitwise_cast_gdouble (const guint64 v)&lt;br/&gt;
     static guint64&lt;br/&gt;
     i64_to_zigzag (const gint64 l)&lt;br/&gt;
     {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return (l &amp;lt;&amp;lt; 1) ^ (l &amp;gt;&amp;gt; 63);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Couldn&apos;t we put ULL qualifiers on everything here to force them to unsigned long long types?&lt;/p&gt;</comment>
                            <comment id="15931461" author="githubbot" created="Sat, 18 Mar 2017 23:20:48 +0000"  >&lt;p&gt;Github user jeking3 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1214#discussion_r106793777&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1214#discussion_r106793777&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: compiler/cpp/src/thrift/parse/t_field.h &amp;#8212;&lt;br/&gt;
    @@ -68,7 +68,7 @@ class t_field : public t_doc {&lt;/p&gt;

&lt;p&gt;       int32_t get_key() const &lt;/p&gt;
{ return key_; }

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;enum e_req 
{ T_REQUIRED, T_OPTIONAL, T_OPT_IN_REQ_OUT };&lt;br/&gt;
    +  enum e_req : unsigned { T_REQUIRED, T_OPTIONAL, T_OPT_IN_REQ_OUT }
&lt;p&gt;;&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    We still support C+&lt;ins&gt;03 and earlier compilation, so this won&apos;t work.  I know it&apos;s a burden, but I&apos;m also on some projects that haven&apos;t moved to C&lt;/ins&gt;+11 yet, amazing as it is.&lt;/p&gt;</comment>
                            <comment id="15931482" author="githubbot" created="Sat, 18 Mar 2017 23:49:21 +0000"  >&lt;p&gt;Github user jbapple-cloudera commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1214#discussion_r106794187&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1214#discussion_r106794187&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/c_glib/src/thrift/c_glib/protocol/thrift_compact_protocol.c &amp;#8212;&lt;br/&gt;
    @@ -120,7 +120,11 @@ thrift_bitwise_cast_gdouble (const guint64 v)&lt;br/&gt;
     static guint64&lt;br/&gt;
     i64_to_zigzag (const gint64 l)&lt;br/&gt;
     {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return (l &amp;lt;&amp;lt; 1) ^ (l &amp;gt;&amp;gt; 63);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Well, you can only put those suffixes like &quot;ULL&quot; on literals, and the only literals here are the right-hand sides of the shifts, and the right-hand sides are not the problem. The problem is that `p &amp;lt;&amp;lt; q` has undefined behavior when p is negative.&lt;/p&gt;</comment>
                            <comment id="15931483" author="githubbot" created="Sat, 18 Mar 2017 23:50:09 +0000"  >&lt;p&gt;Github user jbapple-cloudera commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1214#discussion_r106794199&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1214#discussion_r106794199&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: compiler/cpp/src/thrift/parse/t_field.h &amp;#8212;&lt;br/&gt;
    @@ -68,7 +68,7 @@ class t_field : public t_doc {&lt;/p&gt;

&lt;p&gt;       int32_t get_key() const &lt;/p&gt;
{ return key_; }

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;enum e_req 
{ T_REQUIRED, T_OPTIONAL, T_OPT_IN_REQ_OUT };&lt;br/&gt;
    +  enum e_req : unsigned { T_REQUIRED, T_OPTIONAL, T_OPT_IN_REQ_OUT }
&lt;p&gt;;&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Got it. Should I add a new patch to this pull request or squash them into one patch on this pull request?&lt;/p&gt;</comment>
                            <comment id="15931498" author="githubbot" created="Sun, 19 Mar 2017 00:20:56 +0000"  >&lt;p&gt;Github user jeking3 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1214#discussion_r106794619&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1214#discussion_r106794619&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/c_glib/src/thrift/c_glib/protocol/thrift_compact_protocol.c &amp;#8212;&lt;br/&gt;
    @@ -120,7 +120,11 @@ thrift_bitwise_cast_gdouble (const guint64 v)&lt;br/&gt;
     static guint64&lt;br/&gt;
     i64_to_zigzag (const gint64 l)&lt;br/&gt;
     {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return (l &amp;lt;&amp;lt; 1) ^ (l &amp;gt;&amp;gt; 63);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Sounds to me like a negative input is not allowed; can we change the input type to unsigned then, or throw an exception when it is negative?  If you look inside commit 7edc8faefd391ce11eca3023a35cc54bcb2eb1af I added code in the cpp library (and compiler, following the &quot;throw a string&quot; ugliness) to throw on various conditions like this.  Let&apos;s make it so these undefined cases cause an exception rather than trying to clip them.&lt;/p&gt;</comment>
                            <comment id="15931502" author="githubbot" created="Sun, 19 Mar 2017 00:28:54 +0000"  >&lt;p&gt;Github user jbapple-cloudera commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1214#discussion_r106794729&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1214#discussion_r106794729&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/c_glib/src/thrift/c_glib/protocol/thrift_compact_protocol.c &amp;#8212;&lt;br/&gt;
    @@ -120,7 +120,11 @@ thrift_bitwise_cast_gdouble (const guint64 v)&lt;br/&gt;
     static guint64&lt;br/&gt;
     i64_to_zigzag (const gint64 l)&lt;br/&gt;
     {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return (l &amp;lt;&amp;lt; 1) ^ (l &amp;gt;&amp;gt; 63);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Negative input is expected:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/blob/796667b29f91682871cec310571e66b1259fffb0/lib/cpp/src/thrift/protocol/TCompactProtocol.tcc#L385&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/blob/796667b29f91682871cec310571e66b1259fffb0/lib/cpp/src/thrift/protocol/TCompactProtocol.tcc#L385&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Also, changing the input to unsigned would actually break this, because the right shift depends on being an arithmetic shift, not a logical one.&lt;/p&gt;</comment>
                            <comment id="15931515" author="githubbot" created="Sun, 19 Mar 2017 01:07:13 +0000"  >&lt;p&gt;Github user nsuke commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1214#discussion_r106795259&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1214#discussion_r106795259&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/src/thrift/protocol/TCompactProtocol.tcc &amp;#8212;&lt;br/&gt;
    @@ -387,7 +389,11 @@ uint32_t TCompactProtocolT&amp;lt;Transport_&amp;gt;::writeVarint64(uint64_t n) {&lt;br/&gt;
      */&lt;br/&gt;
     template &amp;lt;class Transport_&amp;gt;&lt;br/&gt;
     uint64_t TCompactProtocolT&amp;lt;Transport_&amp;gt;::i64ToZigzag(const int64_t l) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return (l &amp;lt;&amp;lt; 1) ^ (l &amp;gt;&amp;gt; 63);&lt;br/&gt;
    +  const int64_t m = l &amp;gt;&amp;gt; 63;&lt;br/&gt;
    +  uint64_t p, q;&lt;br/&gt;
    +  memcpy(&amp;amp;p, &amp;amp;l, sizeof(p));&lt;br/&gt;
    +  memcpy(&amp;amp;q, &amp;amp;m, sizeof(q));&lt;br/&gt;
    +  return p = (p &amp;lt;&amp;lt; 1) ^ q;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    `return (static_cast&amp;lt;uint64_t&amp;gt;(l) &amp;lt;&amp;lt; 1) ^ (l &amp;gt;&amp;gt; 63);` would be much simpler and efficient.&lt;br/&gt;
    static casting of negative to unsigned value is well defined AFAICT.&lt;/p&gt;</comment>
                            <comment id="15931528" author="githubbot" created="Sun, 19 Mar 2017 02:06:40 +0000"  >&lt;p&gt;Github user jbapple-cloudera commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1214#discussion_r106796208&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1214#discussion_r106796208&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: compiler/cpp/src/thrift/parse/t_field.h &amp;#8212;&lt;br/&gt;
    @@ -68,7 +68,7 @@ class t_field : public t_doc {&lt;/p&gt;

&lt;p&gt;       int32_t get_key() const &lt;/p&gt;
{ return key_; }

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;enum e_req 
{ T_REQUIRED, T_OPTIONAL, T_OPT_IN_REQ_OUT };&lt;br/&gt;
    +  enum e_req : unsigned { T_REQUIRED, T_OPTIONAL, T_OPT_IN_REQ_OUT }
&lt;p&gt;;&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I squashed.&lt;/p&gt;</comment>
                            <comment id="15931529" author="githubbot" created="Sun, 19 Mar 2017 02:06:53 +0000"  >&lt;p&gt;Github user jbapple-cloudera commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1214#discussion_r106796209&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1214#discussion_r106796209&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/src/thrift/protocol/TCompactProtocol.tcc &amp;#8212;&lt;br/&gt;
    @@ -387,7 +389,11 @@ uint32_t TCompactProtocolT&amp;lt;Transport_&amp;gt;::writeVarint64(uint64_t n) {&lt;br/&gt;
      */&lt;br/&gt;
     template &amp;lt;class Transport_&amp;gt;&lt;br/&gt;
     uint64_t TCompactProtocolT&amp;lt;Transport_&amp;gt;::i64ToZigzag(const int64_t l) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return (l &amp;lt;&amp;lt; 1) ^ (l &amp;gt;&amp;gt; 63);&lt;br/&gt;
    +  const int64_t m = l &amp;gt;&amp;gt; 63;&lt;br/&gt;
    +  uint64_t p, q;&lt;br/&gt;
    +  memcpy(&amp;amp;p, &amp;amp;l, sizeof(p));&lt;br/&gt;
    +  memcpy(&amp;amp;q, &amp;amp;m, sizeof(q));&lt;br/&gt;
    +  return p = (p &amp;lt;&amp;lt; 1) ^ q;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Good point.&lt;/p&gt;</comment>
                            <comment id="15931530" author="githubbot" created="Sun, 19 Mar 2017 02:08:26 +0000"  >&lt;p&gt;Github user jbapple-cloudera commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1214#discussion_r106796226&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1214#discussion_r106796226&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/c_glib/src/thrift/c_glib/protocol/thrift_compact_protocol.c &amp;#8212;&lt;br/&gt;
    @@ -120,7 +120,11 @@ thrift_bitwise_cast_gdouble (const guint64 v)&lt;br/&gt;
     static guint64&lt;br/&gt;
     i64_to_zigzag (const gint64 l)&lt;br/&gt;
     {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return (l &amp;lt;&amp;lt; 1) ^ (l &amp;gt;&amp;gt; 63);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    You can read more about zigzag encoding here: &lt;a href=&quot;https://developers.google.com/protocol-buffers/docs/encoding#types&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://developers.google.com/protocol-buffers/docs/encoding#types&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15932755" author="githubbot" created="Mon, 20 Mar 2017 14:47:12 +0000"  >&lt;p&gt;Github user jbapple-cloudera commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1214&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1214&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Can this be on hold for a bit? I would like to add the UBSan checks to .travis.yml first, which may take a couple of days for me to have time for.&lt;/p&gt;</comment>
                            <comment id="15933089" author="githubbot" created="Mon, 20 Mar 2017 17:13:09 +0000"  >&lt;p&gt;Github user jeking3 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1214#discussion_r106959992&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1214#discussion_r106959992&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: compiler/cpp/src/thrift/parse/t_field.h &amp;#8212;&lt;br/&gt;
    @@ -68,7 +68,7 @@ class t_field : public t_doc {&lt;/p&gt;

&lt;p&gt;       int32_t get_key() const &lt;/p&gt;
{ return key_; }

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;enum e_req 
{ T_REQUIRED, T_OPTIONAL, T_OPT_IN_REQ_OUT }
&lt;p&gt;;&lt;br/&gt;
    +  enum e_req &lt;/p&gt;
{ T_REQUIRED = 0u, T_OPTIONAL, T_OPT_IN_REQ_OUT = ~0u }
&lt;p&gt;;&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    This changes the value of T_OPT_IN_REQ_OUT from before - is this ever on the wire?  Would an older client end up sending &quot;2&quot; here instead of ~0u ?&lt;/p&gt;</comment>
                            <comment id="15937050" author="githubbot" created="Wed, 22 Mar 2017 20:16:33 +0000"  >&lt;p&gt;Github user jbapple-cloudera commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1214&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1214&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Agreed. I&apos;l get to that as soon as I have a chance and then I&apos;ll ping this PR for review when it has addressed that.&lt;/p&gt;</comment>
                            <comment id="15941677" author="githubbot" created="Sat, 25 Mar 2017 09:58:32 +0000"  >&lt;p&gt;Github user jbapple-cloudera commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1214&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1214&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    OK, this new patch does not change the definitions of any `enum`s, only their usages. It also adds undefined behavior checking to the pre-merge CI tests on Travis to discourage regressions.&lt;/p&gt;</comment>
                            <comment id="15941709" author="githubbot" created="Sat, 25 Mar 2017 12:21:03 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1214&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1214&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15941710" author="jking3" created="Sat, 25 Mar 2017 12:22:35 +0000"  >&lt;p&gt;Committed the changes from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbapple&quot; class=&quot;user-hover&quot; rel=&quot;jbapple&quot;&gt;jbapple&lt;/a&gt;.   I marked this as additionally fixed in 0.11.0.  Thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13055650">IMPALA-5031</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12587638" name="compact_int_stuff.patch" size="1841" author="ben.craig" created="Thu, 13 Jun 2013 14:28:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>332984</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 34 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lfxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>333312</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>