<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:21:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-1522] TServerSocket potential memory leak with addrinfo *res0</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-1522</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;I noticed a potential memory leak in TServerSocket.cpp. The res0 pointer receives an allocation from getaddrinfo() but is only freed part of the time in a conditional branch. It should be outside of the if-else to ensure it&apos;s deallocated every time.&lt;/p&gt;

&lt;p&gt;I&apos;m holding off on creating a patch in case I&apos;m not understanding some hidden functionality in the socket library. Here is the code snippet:&lt;/p&gt;

&lt;p&gt;  struct addrinfo *res0;&lt;br/&gt;
  ...&lt;br/&gt;
  getaddrinfo(NULL, port, &amp;amp;hints, &amp;amp;res0);&lt;br/&gt;
  ...&lt;br/&gt;
  if (! path_.empty())&lt;/p&gt;
  { ... }
&lt;p&gt;  else&lt;/p&gt;
  {
    ...
    freeaddrinfo(res0); //Line 331 of TServerSocket.cpp
  }</description>
                <environment>&lt;p&gt;Unix, Windows&lt;/p&gt;</environment>
        <key id="12543886">THRIFT-1522</key>
            <summary>TServerSocket potential memory leak with addrinfo *res0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="peace">Peace C</assignee>
                                    <reporter username="peace">Peace C</reporter>
                        <labels>
                            <label>TServerSocket</label>
                            <label>leak</label>
                            <label>memory</label>
                            <label>thrift</label>
                    </labels>
                <created>Thu, 23 Feb 2012 19:36:30 +0000</created>
                <updated>Fri, 18 Mar 2016 18:02:03 +0000</updated>
                            <resolved>Fri, 18 Mar 2016 18:02:03 +0000</resolved>
                                    <version>0.8</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>C++ - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14612976" author="cmhe" created="Fri, 3 Jul 2015 08:03:46 +0000"  >&lt;p&gt;I would say your assessment of the memory leak is correct.&lt;br/&gt;
It is never deallocated when an exception is thrown or it has to open a Unix Domain Socket.&lt;br/&gt;
The memory leak is present in the current commit in the master branch (5cf9d7744c41).&lt;br/&gt;
IMO the best solution would be, to wrap getaddrinfo and freeaddrinfo into a class that calls the methods with its con/destructors.&lt;/p&gt;</comment>
                            <comment id="14613390" author="roger.meier" created="Fri, 3 Jul 2015 18:45:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cmhe&quot; class=&quot;user-hover&quot; rel=&quot;cmhe&quot;&gt;cmhe&lt;/a&gt; could you please provide a patch for this?&lt;/p&gt;</comment>
                            <comment id="14614602" author="cmhe" created="Mon, 6 Jul 2015 06:30:43 +0000"  >&lt;p&gt;Ok, I will take a look.&lt;/p&gt;</comment>
                            <comment id="14614665" author="githubbot" created="Mon, 6 Jul 2015 07:50:55 +0000"  >&lt;p&gt;GitHub user cmhe opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/542&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/542&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1522&quot; title=&quot;TServerSocket potential memory leak with addrinfo *res0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1522&quot;&gt;&lt;del&gt;THRIFT-1522&lt;/del&gt;&lt;/a&gt;: Fixes Memory leak by wrapping getaddrinfo into a class.&lt;/p&gt;

&lt;p&gt;    Sponsored-by: Roger Meier &amp;lt;r.meier@siemens.com&amp;gt;&lt;br/&gt;
    Signed-off-by: Claudius Heine &amp;lt;ch@denx.de&amp;gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/cmhe/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/cmhe/thrift&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1522&quot; title=&quot;TServerSocket potential memory leak with addrinfo *res0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1522&quot;&gt;&lt;del&gt;THRIFT-1522&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/542.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/542.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #542&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 4828e52ffe6a8bd0cdd7c40b629143a5ec299e31&lt;br/&gt;
Author: Claudius Heine &amp;lt;ch@denx.de&amp;gt;&lt;br/&gt;
Date:   2015-07-06T07:14:25Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1522&quot; title=&quot;TServerSocket potential memory leak with addrinfo *res0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1522&quot;&gt;&lt;del&gt;THRIFT-1522&lt;/del&gt;&lt;/a&gt;: Fixes Memory leak by wrapping getaddrinfo into a class.&lt;/p&gt;

&lt;p&gt;    Sponsored-by: Roger Meier &amp;lt;r.meier@siemens.com&amp;gt;&lt;br/&gt;
    Signed-off-by: Claudius Heine &amp;lt;ch@denx.de&amp;gt;&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14614672" author="githubbot" created="Mon, 6 Jul 2015 07:54:01 +0000"  >&lt;p&gt;Github user cmhe commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/542#issuecomment-118762338&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/542#issuecomment-118762338&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I have run &quot;make cross&quot; and &quot;make check&quot; without any unexpected errors.&lt;br/&gt;
    Feedback is welcome.&lt;/p&gt;</comment>
                            <comment id="14614940" author="githubbot" created="Mon, 6 Jul 2015 12:00:10 +0000"  >&lt;p&gt;Github user cmhe commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/542#issuecomment-118833111&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/542#issuecomment-118833111&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Maybe this can also be used in TNonblockingServer.cpp and TSocket.cpp.&lt;/p&gt;</comment>
                            <comment id="14615000" author="githubbot" created="Mon, 6 Jul 2015 13:03:55 +0000"  >&lt;p&gt;Github user cmhe commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/542#issuecomment-118848681&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/542#issuecomment-118848681&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I moved TGetAddrInfoWrapper into its own C++ Module and integrated it into TNonblockingServer and TSocket: &lt;a href=&quot;https://github.com/cmhe/thrift/commits/WrappedGetAddrInfo&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/cmhe/thrift/commits/WrappedGetAddrInfo&lt;/a&gt;&lt;br/&gt;
    Comments are welcome.&lt;/p&gt;</comment>
                            <comment id="14995657" author="githubbot" created="Sun, 8 Nov 2015 15:04:40 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/542&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/542&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14995667" author="hudson" created="Sun, 8 Nov 2015 15:18:12 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #1716 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/1716/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/1716/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1522&quot; title=&quot;TServerSocket potential memory leak with addrinfo *res0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1522&quot;&gt;&lt;del&gt;THRIFT-1522&lt;/del&gt;&lt;/a&gt;: Fixes Memory leak by wrapping getaddrinfo into a class. (nsuke: rev d8ddb775e4330050e04cefa711f60250905978d3)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/cpp/src/thrift/transport/TServerSocket.cpp&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14995705" author="nsuke" created="Sun, 8 Nov 2015 16:53:29 +0000"  >&lt;p&gt;Committed, thanks !&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12509644">THRIFT-1201</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>229124</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 2 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14ibj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>234431</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>