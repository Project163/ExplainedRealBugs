<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:30:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-4675] JS code generators not handling int64 type properly for constants and for TypeScript type mappings</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-4675</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;The code generated for JS constants involving the &lt;tt&gt;int64&lt;/tt&gt; Thrift type do not rely on the &lt;tt&gt;Int64&lt;/tt&gt; JS type (from the &lt;tt&gt;node-int64&lt;/tt&gt; package Thrift uses for handling 64-bit integers). &lt;/p&gt;

&lt;p&gt;For example, consider the following Thrift constant definitions:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; i64 MAX_INT64 = 9223372036854775807
    &lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; i64 SMALL_INT64 = 15
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This results in generating the following code:&lt;/p&gt;

&lt;p&gt;For node.js:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    ttypes.MAX_INT64 = 9223372036854775807;  
    ttypes.SMALL_INT64 = 15;  
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For the browser:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    MAX_INT64 = 9223372036854775807;
    SMALL_INT64 = 15;  
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since the JS &lt;tt&gt;number&lt;/tt&gt; type cannot natively represent integers that do not fit into a double precision floating point, this will result in lost precision for certain values. E.g., printing &lt;tt&gt;MAX_INT64&lt;/tt&gt; would produce &lt;tt&gt;922337203685477&lt;/tt&gt;&lt;b&gt;&lt;tt&gt;6000&lt;/tt&gt;&lt;/b&gt;. &lt;/p&gt;

&lt;p&gt;The correct output should be (showing for node.js):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    ttypes.MAX_INT64 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Int64(&lt;span class=&quot;code-quote&quot;&gt;&apos;&apos;7FFFFFFFFFFFFFFF&apos;&lt;/span&gt;&apos;);  
    ttypes.SMALL_INT64 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Int64(15);  
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Besides this, none of the Typescript type bindings (&lt;tt&gt;.d.ts&lt;/tt&gt; files) contain the types for int64 types. This includes constants, types, and service method parameters. &lt;/p&gt;

&lt;p&gt;Note that fixing this may break some of the existing code. In my mind, this is how it should work by default, but I don&apos;t know the policy in Thrift regarding backward compatibility. It could also be added as an option.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13201392">THRIFT-4675</key>
            <summary>JS code generators not handling int64 type properly for constants and for TypeScript type mappings</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jking3">James E. King III</assignee>
                                    <reporter username="bgedik">Bu&#287;ra Gedik</reporter>
                        <labels>
                            <label>Breaking-Change</label>
                    </labels>
                <created>Thu, 29 Nov 2018 16:35:48 +0000</created>
                <updated>Wed, 16 Oct 2019 22:26:40 +0000</updated>
                            <resolved>Tue, 15 Jan 2019 14:21:17 +0000</resolved>
                                    <version>0.11.0</version>
                                    <fixVersion>0.13.0</fixVersion>
                                    <component>JavaScript - Compiler</component>
                    <component>JavaScript - Library</component>
                    <component>Node.js - Compiler</component>
                    <component>Node.js - Library</component>
                    <component>TypeScript - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="16703481" author="bgedik" created="Thu, 29 Nov 2018 16:47:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jking3&quot; class=&quot;user-hover&quot; rel=&quot;jking3&quot;&gt;jking3&lt;/a&gt; Could you please advise in two areas:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Do you agree that this should be fixed? If you agree, we are willing to work on this and submit a patch (hopefully for the next repease).&lt;/li&gt;
	&lt;li&gt;Do you think this requires an option or should it be the default behavior? I happen to think that it should be the default behavior, as it is a correctness problem.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16703770" author="jking3" created="Thu, 29 Nov 2018 20:34:23 +0000"  >&lt;p&gt;For typescript: I think now that &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3143&quot; title=&quot;add typescript directory support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3143&quot;&gt;&lt;del&gt;THRIFT-3143&lt;/del&gt;&lt;/a&gt; was merged, we should see if it is still broken.&lt;br/&gt;
Compatibility should be maintained in the protocol level, if at all possible.&lt;br/&gt;
As for the generated code, if what we&apos;re generating is incorrect, it makes sense to correct it.  People can change their handlers when they upgrade.  Seems to me we should be using the node-int64 type?&lt;/p&gt;</comment>
                            <comment id="16703817" author="bgedik" created="Thu, 29 Nov 2018 21:05:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3143&quot; title=&quot;add typescript directory support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3143&quot;&gt;&lt;del&gt;THRIFT-3143&lt;/del&gt;&lt;/a&gt; does not fix the int64 support (we could have done it, but did not want to mix the two issues). &lt;/p&gt;

&lt;p&gt;There won&apos;t be a protocol level change, just the generated code is incorrect and would have to be corrected. Yes, the idea is to use the &lt;tt&gt;node-int64&lt;/tt&gt; package.&lt;/p&gt;</comment>
                            <comment id="16718555" author="bgedik" created="Wed, 12 Dec 2018 07:27:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jking3&quot; class=&quot;user-hover&quot; rel=&quot;jking3&quot;&gt;jking3&lt;/a&gt; While working on this, we&apos;ve discovered that the existing Thrift library has a bug in its JSON protocol implementation for JS. When an Int64 type is present, it serializes it to JSON by truncating to 58-bit (what can fit in a double). This is due to the use of JSON.parse/format. We&apos;ve seen this problem a few times before, so we know how to fix it. To fix it, we&apos;ll need a small library (json-int64). Since node-int64 is already an external dependency, we are thinking that we should make json-int64 an external dependency as well. We&apos;ll be publishing that library to npm. Do we have your blessing? &lt;/p&gt;
</comment>
                            <comment id="16719037" author="jking3" created="Wed, 12 Dec 2018 14:44:41 +0000"  >&lt;p&gt;Sounds okay to me; make sure there are tests. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16738194" author="jking3" created="Wed, 9 Jan 2019 12:46:19 +0000"  >&lt;p&gt;So this affects lib/ts and not lib/nodets, or both?  Why are there two?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13215970">THRIFT-4803</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 44 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s0104g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>