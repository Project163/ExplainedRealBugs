<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:22:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-3568] THeader server crashes on readSlow</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-3568</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;It is essentially caused by readFrame method that is not overriden (but hidden).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12932216">THRIFT-3568</key>
            <summary>THeader server crashes on readSlow</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nsuke">Nobuaki Sukegawa</assignee>
                                    <reporter username="nsuke">Nobuaki Sukegawa</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Jan 2016 19:12:04 +0000</created>
                <updated>Fri, 19 Feb 2016 02:17:53 +0000</updated>
                            <resolved>Sat, 23 Jan 2016 15:33:43 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>C++ - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15105691" author="githubbot" created="Mon, 18 Jan 2016 19:13:41 +0000"  >&lt;p&gt;GitHub user nsuke opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/807&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/807&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3568&quot; title=&quot;THeader server crashes on readSlow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3568&quot;&gt;&lt;del&gt;THRIFT-3568&lt;/del&gt;&lt;/a&gt; THeader server crashes on readSlow&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/nsuke/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/nsuke/thrift&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3568&quot; title=&quot;THeader server crashes on readSlow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3568&quot;&gt;&lt;del&gt;THRIFT-3568&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/807.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/807.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #807&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 27a377ba1e2fa208643da0bd3fcd1483ae39ed9b&lt;br/&gt;
Author: Nobuaki Sukegawa &amp;lt;nsuke@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-01-18T19:12:45Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3568&quot; title=&quot;THeader server crashes on readSlow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3568&quot;&gt;&lt;del&gt;THRIFT-3568&lt;/del&gt;&lt;/a&gt; THeader server crashes on readSlow&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15105740" author="githubbot" created="Mon, 18 Jan 2016 19:46:42 +0000"  >&lt;p&gt;Github user bufferoverflow commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/807#issuecomment-172632943&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/807#issuecomment-172632943&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @andrewcox similar issues at fb with this code?&lt;/p&gt;</comment>
                            <comment id="15106964" author="githubbot" created="Tue, 19 Jan 2016 16:37:06 +0000"  >&lt;p&gt;Github user nsuke commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/807#issuecomment-172909649&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/807#issuecomment-172909649&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    This bug causes server to SegFault whenever it has a client that is not writing for a while (like milliseconds).&lt;br/&gt;
    So basically the THeader is not functional at all without this patch.&lt;br/&gt;
    I don&apos;t think fbthrift THeader has such an obvious bug.&lt;/p&gt;</comment>
                            <comment id="15111497" author="githubbot" created="Thu, 21 Jan 2016 22:23:47 +0000"  >&lt;p&gt;Github user bufferoverflow commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/807#issuecomment-173733541&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/807#issuecomment-173733541&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1 &lt;br/&gt;
    Thanks for the details, I&apos;ve never used THeader...&lt;/p&gt;</comment>
                            <comment id="15111513" author="githubbot" created="Thu, 21 Jan 2016 22:30:15 +0000"  >&lt;p&gt;Github user andrewcox commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/807#issuecomment-173735565&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/807#issuecomment-173735565&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Could we get a callstack for the crash this was fixing?&lt;/p&gt;</comment>
                            <comment id="15111637" author="githubbot" created="Fri, 22 Jan 2016 00:02:01 +0000"  >&lt;p&gt;Github user andrewcox commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/807#issuecomment-173754745&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/807#issuecomment-173754745&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    One mitigating factor here is our &quot;ThriftServer&quot; class (our most used server) doesn&apos;t use &quot;THeaderTransport&quot; at all, it uses the &quot;THeader&quot; core.&lt;/p&gt;

&lt;p&gt;    And then some of our servers that &lt;b&gt;do&lt;/b&gt; use THeaderTransport do it through TAsyncChannel in a way that it ends up reading a buffer that already contains a full message, so it would never stall in the middle of a message.&lt;/p&gt;

&lt;p&gt;    Still though, I believe at least some of our legacy servers still use THeaderTransport and synchronous I/O, and we&apos;ve never seen this AFAICT. That&apos;s why I&apos;d like to see the callstack.&lt;/p&gt;</comment>
                            <comment id="15111638" author="githubbot" created="Fri, 22 Jan 2016 00:03:40 +0000"  >&lt;p&gt;Github user andrewcox commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/807#issuecomment-173755016&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/807#issuecomment-173755016&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    (I should clarify when I say &quot;our&quot; I&apos;m talking about the fbthrift codebase)&lt;/p&gt;</comment>
                            <comment id="15113657" author="githubbot" created="Sat, 23 Jan 2016 09:09:12 +0000"  >&lt;p&gt;Github user nsuke commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/807#issuecomment-174164904&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/807#issuecomment-174164904&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @andrewcox here you are.&lt;br/&gt;
    Critical flaw lies in `TFramedTransport::readSlow` -&amp;gt; `TFramedTransport::readFrame`.&lt;br/&gt;
    Where *&lt;b&gt;THeaderTransport&lt;/b&gt;*::readFrame should have been called.&lt;br/&gt;
    Seems to be a simple transplant issue.&lt;/p&gt;

&lt;p&gt;        __assert_fail () from /usr/lib/libc.so.6&lt;br/&gt;
        boost::shared_ptr&amp;lt;apache::thrift::transport::ttransport&amp;gt;::operator-&amp;gt; (this=0x7f8248001af8) at /usr/include/boost/smart_ptr/shared_ptr.hpp:693&lt;br/&gt;
        apache::thrift::transport::tframedtransport::readframe (this=0x7f8248001ad0) at src/thrift/transport/tbuffertransports.cpp:183&lt;br/&gt;
        apache::thrift::transport::tframedtransport::readslow (this=0x7f8248001ad0, buf=0x7f82517207d0 &quot;\360\arq&quot;, len=4) rt/tbuffertransports.cpp:154&lt;br/&gt;
        apache::thrift::transport::theadertransport::readslow (this=0x7f8248001ad0, buf=0x7f82517207d0 &quot;\360\arq&quot;, len=4) at src/thrift/transport/theadertransport.cpp:55&lt;br/&gt;
        apache::thrift::transport::tbufferbase::read (this=0x7f8248001ad0, buf=0x7f82517207d0 &quot;\360\arq&quot;, len=4) thrift/transport/tbuffertransports.h:71&lt;br/&gt;
        apache::thrift::transport::readall&amp;lt;apache::thrift::transport::tbufferbase&amp;gt; (trans=..., buf=0x7f82517207d0 &quot;\360\arq&quot;, len=4) thrift/transport/ttransport.h:41&lt;br/&gt;
        apache::thrift::transport::tbufferbase::readall (this=0x7f8248001ad0, buf=0x7f82517207d0 &quot;\360\arq&quot;, len=4) thrift/transport/tbuffertransports.h:84&lt;br/&gt;
        apache::thrift::transport::theadertransport::readall (this=0x7f8248001ad0, buf=0x7f82517207d0 &quot;\360\arq&quot;, len=4) at src/thrift/transport/theadertransport.cpp:46&lt;br/&gt;
        apache::thrift::protocol::tbinaryprotocolt&amp;lt;apache::thrift::transport::theadertransport, apache::thrift::protocol::tnetworkbigendian&amp;gt;::readi32 ( i32=@0x7f825172081c: 0) at ./src/thrift/protocol/tbinaryprotocol.tcc:373&lt;br/&gt;
        apache::thrift::protocol::tbinaryprotocolt&amp;lt;apache::thrift::transport::theadertransport, apache::thrift::protocol::tnetworkbigendian&amp;gt;::readmessagebegin ( name=&quot;&quot;, messagetype=@0x7f82517209fc: 32642, seqid=@0x7f82517209f8: 1207967376) at ./src/thrift/protocol/tbinaryprotocol.tcc:205&lt;br/&gt;
        apache::thrift::protocol::tvirtualprotocol&amp;lt;apache::thrift::protocol::tbinaryprotocolt&amp;lt;apache::thrift::transport::theadertransport, apache::thrift::protocol::tnetworkbigendian&amp;gt;, apache::thrift::protocol::tprotocoldefaults&amp;gt;::readmessagebegin_virt (this=0x7f8248001e40, name=&quot;&quot;, messagetype=@0x7f82517209fc: 32642, seqid=@0x7f82517209f8: 1207967376) col/tvirtualprotocol.h:403&lt;br/&gt;
        apache::thrift::protocol::tprotocol::readmessagebegin (this=0x7f8248001e40, name=&quot;&quot;, messagetype=@0x7f82517209fc: 32642, seqid=@0x7f82517209f8: 1207967376) thrift/protocol/tprotocol.h:431&lt;br/&gt;
        apache::thrift::protocol::theaderprotocol::readmessagebegin (this=0x7f8248001190, name=&quot;&quot;, messagetype=@0x7f82517209fc: 32642, seqid=@0x7f82517209f8: 1207967376) l/theaderprotocol.cpp:172&lt;br/&gt;
        apache::thrift::protocol::tvirtualprotocol&amp;lt;apache::thrift::protocol::theaderprotocol, apache::thrift::protocol::tprotocoldefaults&amp;gt;::readmessagebegin_virt ( name=&quot;&quot;, messagetype=@0x7f82517209fc: 32642, seqid=@0x7f82517209f8: 1207967376) at ../../lib/cpp/src/thrift/protocol/tvirtualprotocol.h:403&lt;br/&gt;
        apache::thrift::protocol::tprotocol::readmessagebegin (this=0x7f8248001190, name=&quot;&quot;, messagetype=@0x7f82517209fc: 32642, seqid=@0x7f82517209f8: 1207967376) thrift/protocol/tprotocol.h:431&lt;br/&gt;
        apache::thrift::tdispatchprocessor::process (this=0x270ce00, in=..., out=..., connectioncontext=0x0) at ../../lib/cpp/src/thrift/tdispatchprocessor.h:114&lt;br/&gt;
        apache::thrift::server::tconnectedclient::run (this=0x7f8248001210) at src/thrift/server/tconnectedclient.cpp:62&lt;br/&gt;
        apache::thrift::server::tsimpleserver::onclientconnected (this=0x270d920, pclient=...) at src/thrift/server/tsimpleserver.cpp:90&lt;br/&gt;
        apache::thrift::server::tserverframework::newlyconnectedclient (this=0x270d920, pclient=...) at src/thrift/server/tserverframework.cpp:222&lt;br/&gt;
        apache::thrift::server::tserverframework::serve (this=0x270d920) at src/thrift/server/tserverframework.cpp:164&lt;br/&gt;
        apache::thrift::server::tserver::run (this=0x270d920) at ../../lib/cpp/src/thrift/server/tserver.h:108&lt;br/&gt;
        apache::thrift::concurrency::pthreadthread::threadmain (arg=0x270db30) at src/thrift/concurrency/posixthreadfactory.cpp:208&lt;br/&gt;
        start_thread () from /usr/lib/libpthread.so.0&lt;br/&gt;
        clone () from /usr/lib/libc.so.6&lt;/p&gt;</comment>
                            <comment id="15113782" author="githubbot" created="Sat, 23 Jan 2016 15:22:19 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/807&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/807&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15113794" author="nsuke" created="Sat, 23 Jan 2016 15:33:43 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 43 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2rnhb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>