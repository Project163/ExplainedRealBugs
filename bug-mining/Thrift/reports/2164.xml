<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:33:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-5419] Incorrect usage of thread pool in TThreadPoolAsyncServer may lead to poor performance</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-5419</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;&lt;b&gt;Abstract:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;TThreadPoolAsyncServer uses ThreadPool.QueueUserWorkItem for each incoming connection to post a long-lived, synchronous task to the thread pool. This causes deadlock in the thread pool, which is only designed for short lived tasks, and can cause dramatic poor performance throughout your application, even in unrelated areas.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Details:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;The .NET Thread Pool is not designed to handle long lived tasks. It has a complex set of logic that starts the pool at a size based on available CPUs and memory, then automatically grows it if it detects deadlock (no tasks completed for a second). Let&apos;s say that number is 4, as soon as you have 4 concurrent connections, everything in your process will come grinding to a halt until a second has passed and it grows the pool. This will affect everything in your process, even seemingly unrelated code and can have dramatic bad effects on performance.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Fix:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;There are a number of fixes possible, but the most efficient and best is to use async/await to rewrite Execute() as asynchronous.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Other side effects:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Execute has a catch(TTransportException) block which I suspect will never be hit. Calling .Wait() and/or .Result always wraps exceptions in an AggregateException. A properly written async/await version would unwrap that exception for you.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 10 with Visual Studio 2019.&lt;/p&gt;</environment>
        <key id="13379849">THRIFT-5419</key>
            <summary>Incorrect usage of thread pool in TThreadPoolAsyncServer may lead to poor performance</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nsharp">Nathan P Sharp</assignee>
                                    <reporter username="nsharp">Nathan P Sharp</reporter>
                        <labels>
                    </labels>
                <created>Fri, 21 May 2021 20:35:12 +0000</created>
                <updated>Sat, 11 Sep 2021 12:31:17 +0000</updated>
                            <resolved>Wed, 26 May 2021 20:39:12 +0000</resolved>
                                    <version>0.14.1</version>
                                    <fixVersion>0.15.0</fixVersion>
                                    <component>netstd - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="6600">1h 50m</timespent>
                                <comments>
                            <comment id="17349724" author="jensg" created="Sat, 22 May 2021 12:34:18 +0000"  >&lt;p&gt;&lt;b&gt;recommended action&lt;/b&gt;&lt;br/&gt;
&lt;a href=&quot;https://thrift.apache.org/docs/HowToContribute.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://thrift.apache.org/docs/HowToContribute.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks for the analysis,pull request  appreciated &lt;/p&gt;</comment>
                            <comment id="17350591" author="nsharp" created="Mon, 24 May 2021 19:18:55 +0000"  >&lt;p&gt;I have created a fork and branch at &lt;a href=&quot;https://github.com/apache/thrift/compare/master...phxnsharp:THRIFT-5419&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/compare/master...phxnsharp:THRIFT-5419&lt;/a&gt;**&lt;/p&gt;

&lt;p&gt;I have not created the PR because the build instructions are not working for me. I attempted to use &quot;Building like Travis CI does, locally&quot; from &lt;a href=&quot;https://github.com/phxnsharp/thrift/blob/master/build/docker/README.md&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/phxnsharp/thrift/blob/master/build/docker/README.md&lt;/a&gt; but received an error on master (before my changes). It compiles with the same error on my branch and produces the netstd thrift.dll. The cross-tests says &quot;success&quot;, but I don&apos;t see where the test report goes. &lt;/p&gt;

&lt;p&gt;I haven&apos;t tried the generated DLL in my context because we are currently on 0.13.1 and there are dependency issues. Attempting to build the 0.13.0 branch is not working for me for other reasons.&lt;/p&gt;

&lt;p&gt;Would you like this change as a PR in its untested form? It may be some time before I can find the time to work on the build problems.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="17350843" author="jensg" created="Tue, 25 May 2021 07:02:43 +0000"  > &lt;blockquote&gt;
&lt;p&gt;Would you like this change as a PR in its untested form? It may be some time before I can find the time to work on the build problems.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Sure, send it and assign me as reviewer. I&apos;ll take a look at it and we move on from that. Thanks!&lt;/p&gt;</comment>
                            <comment id="17351038" author="nsharp" created="Tue, 25 May 2021 12:47:20 +0000"  >&lt;p&gt;Thank you! &lt;a href=&quot;https://github.com/apache/thrift/pull/2395&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/2395&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310760">
                    <name>Testing</name>
                                            <outwardlinks description="Testing discovered">
                                        <issuelink>
            <issuekey id="13380416">THRIFT-5422</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 25 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0r9ts:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>