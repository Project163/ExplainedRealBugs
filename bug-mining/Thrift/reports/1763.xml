<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:26:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-3703] Unions Field Count Does Not Consider Map/Set/List Fields</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-3703</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;Go code for unions generated by Thrift 0.9.3 fails to consider map/set/list fields of a union when enforcing that the number of fields set is 1. For example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;union Foo{
    1: map&amp;lt;bool,bool&amp;gt; u1
    2: set&amp;lt;bool&amp;gt; u2,
    3: list&amp;lt;bool&amp;gt; u3,
    4: bool u4,
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Produces Go code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;type Foo struct {
	U1 map[bool]bool `thrift:&lt;span class=&quot;code-quote&quot;&gt;&quot;u1,1&quot;&lt;/span&gt; json:&lt;span class=&quot;code-quote&quot;&gt;&quot;u1,omitempty&quot;&lt;/span&gt;`
	U2 map[bool]bool `thrift:&lt;span class=&quot;code-quote&quot;&gt;&quot;u2,2&quot;&lt;/span&gt; json:&lt;span class=&quot;code-quote&quot;&gt;&quot;u2,omitempty&quot;&lt;/span&gt;`
	U3 []bool        `thrift:&lt;span class=&quot;code-quote&quot;&gt;&quot;u3,3&quot;&lt;/span&gt; json:&lt;span class=&quot;code-quote&quot;&gt;&quot;u3,omitempty&quot;&lt;/span&gt;`
	U4 *bool         `thrift:&lt;span class=&quot;code-quote&quot;&gt;&quot;u4,4&quot;&lt;/span&gt; json:&lt;span class=&quot;code-quote&quot;&gt;&quot;u4,omitempty&quot;&lt;/span&gt;`
}
...
func (p *Foo) CountSetFieldsFoo() &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; {
	count := 0
	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; p.IsSetU4() {
		count++
	}
	&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; count
}
...
func (p *Foo) Write(oprot thrift.TProtocol) error {
	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; c := p.CountSetFieldsFoo(); c != 1 {
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; fmt.Errorf(&lt;span class=&quot;code-quote&quot;&gt;&quot;%T write union: exactly one field must be set (%d set).&quot;&lt;/span&gt;, p, c)
	}
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Due to this bug, Thrift will complain that a union with only the fields u1, u2, or u3 set has no fields set. And it will allow all four fields to be set.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu 15.10&lt;/p&gt;</environment>
        <key id="12945947">THRIFT-3703</key>
            <summary>Unions Field Count Does Not Consider Map/Set/List Fields</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dcelasun">Duru Can Celasun</assignee>
                                    <reporter username="tdeering">Tom Deering</reporter>
                        <labels>
                            <label>golang</label>
                            <label>thrift</label>
                            <label>union</label>
                    </labels>
                <created>Tue, 1 Mar 2016 21:29:40 +0000</created>
                <updated>Thu, 14 Dec 2017 13:55:28 +0000</updated>
                            <resolved>Wed, 31 May 2017 20:59:20 +0000</resolved>
                                    <version>0.9.3</version>
                    <version>0.10.0</version>
                                    <fixVersion>0.11.0</fixVersion>
                                    <component>Go - Compiler</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15174446" author="tdeering" created="Tue, 1 Mar 2016 21:33:14 +0000"  >&lt;p&gt;Seems to affect union fields of type map, set, and list. So not just map. Updated.&lt;/p&gt;</comment>
                            <comment id="15176377" author="jensg" created="Wed, 2 Mar 2016 20:09:32 +0000"  >&lt;p&gt;Could be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3650&quot; title=&quot;incorrect union serialization &quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3650&quot;&gt;&lt;del&gt;THRIFT-3650&lt;/del&gt;&lt;/a&gt;. &lt;br/&gt;
Could you check whether setting explicit &lt;tt&gt;optional&lt;/tt&gt; solves the issue? &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;union Foo{
    1:   optional   map&amp;lt;bool,bool&amp;gt; u1
    2:   optional   set&amp;lt;bool&amp;gt; u2,
    3:   optional   list&amp;lt;bool&amp;gt; u3,
    4:   optional   bool u4,
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15176653" author="tdeering" created="Wed, 2 Mar 2016 22:55:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jensg&quot; class=&quot;user-hover&quot; rel=&quot;jensg&quot;&gt;jensg&lt;/a&gt;, just gave it a shot. Same result with the optional keywords.&lt;/p&gt;</comment>
                            <comment id="16029296" author="githubbot" created="Tue, 30 May 2017 11:48:38 +0000"  >&lt;p&gt;GitHub user dcelasun opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1281&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1281&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3703&quot; title=&quot;Unions Field Count Does Not Consider Map/Set/List Fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3703&quot;&gt;&lt;del&gt;THRIFT-3703&lt;/del&gt;&lt;/a&gt; Unions Field Count Does Not Consider Map/Set/List Fields&lt;/p&gt;

&lt;p&gt;    Even though maps and slices are not pointer fields in the generated&lt;br/&gt;
    code, they are still nullable. Adding an extra check for map/set/list&lt;br/&gt;
    types fixes the generated Count* methods.&lt;/p&gt;

&lt;p&gt;    Sample IDL:&lt;br/&gt;
    ```thrift&lt;br/&gt;
    union Foo&lt;/p&gt;
{
        1: map&amp;lt;bool,bool&amp;gt; u1
        2: set&amp;lt;bool&amp;gt; u2
        3: list&amp;lt;bool&amp;gt; u3
        4: bool u4
    }
&lt;p&gt;    ```&lt;/p&gt;

&lt;p&gt;    Generated code before fix:&lt;br/&gt;
    ```go&lt;br/&gt;
    func (p *Foo) CountSetFieldsFoo() int {&lt;br/&gt;
    	count := 0&lt;br/&gt;
    	if p.IsSetU4() &lt;/p&gt;
{
    		count++
    	}&lt;br/&gt;
    	return count&lt;br/&gt;
    }&lt;br/&gt;
    ```&lt;br/&gt;
    &lt;br/&gt;
    After fix:&lt;br/&gt;
    ```go&lt;br/&gt;
    func (p *Foo) CountSetFieldsFoo() int {&lt;br/&gt;
    	count := 0&lt;br/&gt;
    	if p.IsSetU1() {    		count++    	}
&lt;p&gt;    	if p.IsSetU2() &lt;/p&gt;
{
    		count++
    	}&lt;br/&gt;
    	if p.IsSetU3() {    		count++    	}
&lt;p&gt;    	if p.IsSetU4() &lt;/p&gt;
{
    		count++
    	}
&lt;p&gt;    	return count&lt;br/&gt;
    }&lt;br/&gt;
    ```&lt;/p&gt;

&lt;p&gt;    Fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3703&quot; title=&quot;Unions Field Count Does Not Consider Map/Set/List Fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3703&quot;&gt;&lt;del&gt;THRIFT-3703&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dcelasun/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dcelasun/thrift&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3703&quot; title=&quot;Unions Field Count Does Not Consider Map/Set/List Fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3703&quot;&gt;&lt;del&gt;THRIFT-3703&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1281.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1281.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1281&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit cacfd6fd041eba27540f61a897cc5d5826126197&lt;br/&gt;
Author: D. Can Celasun &amp;lt;can@dcc.im&amp;gt;&lt;br/&gt;
Date:   2017-05-30T10:44:56Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3703&quot; title=&quot;Unions Field Count Does Not Consider Map/Set/List Fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3703&quot;&gt;&lt;del&gt;THRIFT-3703&lt;/del&gt;&lt;/a&gt; Unions Field Count Does Not Consider Map/Set/List Fields&lt;/p&gt;

&lt;p&gt;    Even though maps and slices are not pointer fields in the generated&lt;br/&gt;
    code, they are still nullable. Adding an extra check for map/set/list&lt;br/&gt;
    types fixes the generated Count* methods.&lt;/p&gt;

&lt;p&gt;    Fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3703&quot; title=&quot;Unions Field Count Does Not Consider Map/Set/List Fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3703&quot;&gt;&lt;del&gt;THRIFT-3703&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16029444" author="githubbot" created="Tue, 30 May 2017 13:53:04 +0000"  >&lt;p&gt;Github user dcelasun commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1281&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1281&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Travis failures are unrelated to the PR, looks like problems with Java and JS. &lt;/p&gt;</comment>
                            <comment id="16031941" author="githubbot" created="Wed, 31 May 2017 20:57:39 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1281&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1281&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16031953" author="jensg" created="Wed, 31 May 2017 20:59:20 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 24 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tzuv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>