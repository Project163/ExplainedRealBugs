<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:07:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-1903] PHP namespaces cause binary protocols to not be used</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-1903</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;Currently the compiled code produces the following check for binary capability (slightly different in other places, but same idea):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    $bin_accel = ($this-&amp;gt;output_ instanceof TProtocol::$TBINARYPROTOCOLACCELERATED) &amp;amp;&amp;amp; function_exists(&apos;thrift_protocol_write_binary&apos;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The TProtocol::$TBINARYPROTOCOLACCELERATED variable contains &apos;TBinaryProtocolAccelerated&apos;. This check always fails because when the protocol class is instantiated like:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    use Thrift\Protocol\TBinaryProtocolAccelerated;
    $protocol = new TBinaryProtocolAccelerated($transport);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(as shown in the current PHP example), the protocol class is instantiated as &apos;Thrift\Protocol\TBinaryProtocolAccelerated&apos;. In the standard compiled class, TBinaryProtocolAccelerated&apos;s namespace is not use&apos;d, so the instanceof fails.&lt;/p&gt;

&lt;p&gt;EXAMPLE PROGRAM&lt;br/&gt;
Based on PHP tutorial, only needs compiled code. Does not make a&lt;br/&gt;
connection and demonstrates the instanceof failure.&lt;br/&gt;
--------------------------------------------------------------------&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;namespace tutorial\php;

define(&apos;THRIFT_ROOT&apos;, &apos;/home/tim/projects/inquisic/thrift-0.9.0/lib/php/lib&apos;);
require_once(THRIFT_ROOT . &apos;/Thrift/ClassLoader/ThriftClassLoader.php&apos;);

use Thrift\ClassLoader\ThriftClassLoader;
$GEN_DIR = &apos;/home/tim/public_html/thrift0.9/gen-php&apos;;

$loader = new ThriftClassLoader();
$loader-&amp;gt;registerNamespace(&apos;Thrift&apos;, THRIFT_ROOT);
$loader-&amp;gt;registerDefinition(&apos;shared&apos;, $GEN_DIR);
$loader-&amp;gt;registerDefinition(&apos;tutorial&apos;, $GEN_DIR);
$loader-&amp;gt;register();

use Thrift\Protocol\TBinaryProtocol;
use Thrift\Protocol\TBinaryProtocolAccelerated;
use Thrift\Transport\THttpClient;
use Thrift\Transport\TBufferedTransport;

$socket = new THttpClient(&apos;localhost&apos;, 8383, &apos;/~tim/thrift0.9/PhpServer.php&apos;);
$transport = new TBufferedTransport($socket, 1024, 1024);
$protocol = new TBinaryProtocolAccelerated($transport);

// Reset namespace
namespace tutorial\php;

use Thrift\Protocol\TProtocol;
use Thrift\Protocol\TBinaryProtocol;

  print &quot;protocol class = &quot; . get_class($protocol) . &quot;\n&quot;;
  print &quot;check class = &quot; . TProtocol::$TBINARYPROTOCOLACCELERATED . &quot;\n&quot;;
  if ($protocol instanceof TProtocol::$TBINARYPROTOCOLACCELERATED)
    print &quot;Standard: INSTANCE!\n&quot;;
  else
    print &quot;Standard: NOT INSTANCE!\n&quot;;

  $good_class = &apos;\Thrift\Protocol\TBinaryProtocolAccelerated&apos;;
  if ($protocol instanceof $good_class)
    print &quot;Good: INSTANCE!\n&quot;;
  else
    print &quot;Good: NOT INSTANCE!\n&quot;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;---------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;PROGRAM OUTPUT:&lt;br/&gt;
---------------------------------------------------------------------&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;protocol class = Thrift\Protocol\TBinaryProtocolAccelerated
check class = TBinaryProtocolAccelerated
Standard: NOT INSTANCE!
Good: INSTANCE!
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;---------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;WORKAROUND:&lt;br/&gt;
Note that leading backslash is required. Just having &apos;Thrift\Protocol\...&apos; etc will not work.&lt;br/&gt;
---------------------------------------------------------------------&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Changed line 37 in TProtocol.php to:

static $TBINARYPROTOCOLACCELERATED = &apos;\Thrift\Protocol\TBinaryProtocolAccelerated&apos;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;---------------------------------------------------------------------&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Centos 6.4&lt;/p&gt;</environment>
        <key id="12639184">THRIFT-1903</key>
            <summary>PHP namespaces cause binary protocols to not be used</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thobbs">Tom Hobbs</assignee>
                                    <reporter username="siliconengine">Tim Behrendsen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Mar 2013 20:59:25 +0000</created>
                <updated>Sat, 8 Jun 2013 03:15:41 +0000</updated>
                            <resolved>Sat, 8 Jun 2013 03:15:41 +0000</resolved>
                                    <version>0.9</version>
                                    <fixVersion>0.9.1</fixVersion>
                                    <component>PHP - Compiler</component>
                    <component>PHP - Library</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13636652" author="thobbs" created="Fri, 19 Apr 2013 17:37:48 +0000"  >&lt;p&gt;Attached patch resolves the issue by importing TBinaryProtocolAccelerated and checking if &lt;tt&gt;$this-&amp;gt;output_&lt;/tt&gt; is an instance of that instead of using a static string in TProtocol.&lt;/p&gt;</comment>
                            <comment id="13637076" author="jfarrell" created="Sat, 20 Apr 2013 02:07:06 +0000"  >&lt;p&gt;Thanks Tyler, committed&lt;/p&gt;</comment>
                            <comment id="13637105" author="progolferyo" created="Sat, 20 Apr 2013 03:40:30 +0000"  >&lt;p&gt;I built the new thrift with this new patch and we are getting this error.  Think it&apos;s related to this or to something else?&lt;/p&gt;

&lt;p&gt;PHP Fatal error:  Class &apos;TProtocolException&apos; not found in XXXX&lt;/p&gt;</comment>
                            <comment id="13637321" author="thobbs" created="Sat, 20 Apr 2013 18:51:11 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I built the new thrift with this new patch and we are getting this error. Think it&apos;s related to this or to something else?&lt;/p&gt;

&lt;p&gt;PHP Fatal error: Class &apos;TProtocolException&apos; not found in XXXX&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=progolferyo&quot; class=&quot;user-hover&quot; rel=&quot;progolferyo&quot;&gt;progolferyo&lt;/a&gt; I would be surprised if this patch caused that error.  Can you provide more context or do you have an easy way to reproduce?&lt;/p&gt;</comment>
                            <comment id="13638752" author="jeremy.rayner" created="Tue, 23 Apr 2013 03:47:30 +0000"  >&lt;p&gt;Refer to &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1942&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/THRIFT-1942&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13643783" author="hudson" created="Sat, 27 Apr 2013 19:54:41 +0000"  >&lt;p&gt;Integrated in Thrift #643 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/643/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/643/&lt;/a&gt;)&lt;br/&gt;
    Thrift-1903: PHP namespaces cause binary protocols to not be used (Revision de262dc77ee06ab40859230dd57f383ac4f32c61)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12579582" name="THRIFT-1903-v1.txt" size="3196" author="thobbs" created="Fri, 19 Apr 2013 17:37:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>319654</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 30 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1j5kf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>319995</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>