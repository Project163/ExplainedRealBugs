<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:00:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-1190] readBufferBytesAllocated in TNonblockingServer.java should be AtomicLong to fix FD leakage and general server malfunction</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-1190</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;We&apos;re having a problem using THsHaServer where the server suddenly stops closing connections and runs out of file descriptors.&lt;/p&gt;

&lt;p&gt;It looks like the problem is in TNonblockingServer.java.  The variable &quot;long readBufferBytesAllocated&quot; is shared between threads but isn&apos;t synchronized.  Intermittently, its value can get out of whack due to races and cause this if statement to always execute:&lt;/p&gt;

&lt;p&gt;          // if this frame will push us over the memory limit, then return.&lt;br/&gt;
          // with luck, more memory will free up the next time around.&lt;br/&gt;
          if (readBufferBytesAllocated.get() + frameSize &amp;gt; MAX_READ_BUFFER_BYTES) &lt;/p&gt;
{
            return true;
          }

&lt;p&gt;We started having this problem when we set MAX_READ_BUFFER_BYTES to a somewhat small size, which unmasked the issue.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Any&lt;/p&gt;</environment>
        <key id="12508890">THRIFT-1190</key>
            <summary>readBufferBytesAllocated in TNonblockingServer.java should be AtomicLong to fix FD leakage and general server malfunction</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tommay">Tom May</assignee>
                                    <reporter username="tommay">Tom May</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Jun 2011 00:37:54 +0000</created>
                <updated>Wed, 1 Jun 2011 17:49:46 +0000</updated>
                            <resolved>Wed, 1 Jun 2011 17:19:58 +0000</resolved>
                                    <version>0.6</version>
                                    <fixVersion>0.7</fixVersion>
                                    <component>Java - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13041918" author="tommay" created="Wed, 1 Jun 2011 00:40:20 +0000"  >&lt;p&gt;Here&apos;s the patch.&lt;/p&gt;</comment>
                            <comment id="13042301" author="bryanduxbury" created="Wed, 1 Jun 2011 17:19:58 +0000"  >&lt;p&gt;Nice catch! I just committed this patch.&lt;/p&gt;</comment>
                            <comment id="13042318" author="hudson" created="Wed, 1 Jun 2011 17:49:46 +0000"  >&lt;p&gt;Integrated in Thrift #151 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/Thrift/151/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/hudson/job/Thrift/151/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1190&quot; title=&quot;readBufferBytesAllocated in TNonblockingServer.java should be AtomicLong to fix FD leakage and general server malfunction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1190&quot;&gt;&lt;del&gt;THRIFT-1190&lt;/del&gt;&lt;/a&gt;. java: readBufferBytesAllocated in TNonblockingServer.java should be AtomicLong to fix FD leakage and general server malfunction&lt;/p&gt;

&lt;p&gt;There was a race condition in the use of the memory limiting feature that would lead to memory loss.&lt;/p&gt;

&lt;p&gt;Patch: Tom May&lt;/p&gt;

&lt;p&gt;bryanduxbury : &lt;a href=&quot;http://svn.apache.org/viewvc/?view=rev&amp;amp;rev=1130231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/?view=rev&amp;amp;rev=1130231&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/thrift/trunk/lib/java/src/org/apache/thrift/server/TNonblockingServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12481022" name="thrift.patch" size="2357" author="tommay" created="Wed, 1 Jun 2011 00:40:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72312</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 25 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16cvb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245217</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>