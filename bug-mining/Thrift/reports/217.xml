<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:56:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-637] Bug in TNonblockingServer.py for services with both oneway and regular requests </title>
                <link>https://issues.apache.org/jira/browse/THRIFT-637</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;If you implement a service with TNonblockingServer.py and have both oneway and regular methods in your interface, the first regular request after a oneway request will fail with the error:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;TNonblockingServer.py :113 &amp;#93;&lt;/span&gt; - 2009-11-26 13:58:01,829 - ERROR - can&apos;t read frame size from socket&lt;/p&gt;

&lt;p&gt;This is because self.message is not cleaned up when there is no reply.&lt;/p&gt;

&lt;p&gt;The implementation seems to start constructing a message in response&lt;br/&gt;
to a oneway request and then gives up once it realizes it is a oneway&lt;br/&gt;
request&lt;/p&gt;

&lt;p&gt; def ready(self, all_ok, message):&lt;/p&gt;

&lt;p&gt;....&lt;br/&gt;
       self.message = struct.pack(&apos;!i&apos;, len(message)) + message&lt;br/&gt;
       if len(message) == 0:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;it was a oneway request, do not write answer&lt;br/&gt;
           self.status = WAIT_LEN&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Then for the next regular message len(self.message) == 4 and self._read_len is very defensive about&lt;br/&gt;
reading only the exact right amount of data from the socket.&lt;/p&gt;

&lt;p&gt;My patch is simple and seems to fix the problem:&lt;/p&gt;

&lt;p&gt;&amp;gt; svn diff&lt;br/&gt;
Index: lib/py/src/server/TNonblockingServer.py&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; lib/py/src/server/TNonblockingServer.py     (revision 884669)&lt;br/&gt;
+++ lib/py/src/server/TNonblockingServer.py     (working copy)&lt;br/&gt;
@@ -182,6 +182,7 @@&lt;br/&gt;
        if len(message) == 0:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;it was a oneway request, do not write answer&lt;br/&gt;
            self.status = WAIT_LEN&lt;br/&gt;
+            self.message = &apos;&apos;&lt;br/&gt;
        else:&lt;br/&gt;
            self.status = SEND_ANSWER&lt;br/&gt;
        self.wake_up()&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment>&lt;p&gt;All hardware/os combos, Python server&lt;/p&gt;</environment>
        <key id="12441843">THRIFT-637</key>
            <summary>Bug in TNonblockingServer.py for services with both oneway and regular requests </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tlipcon">Todd Lipcon</assignee>
                                    <reporter username="arvinds">Arvind Sundararajan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Nov 2009 18:43:12 +0000</created>
                <updated>Tue, 1 Nov 2011 02:51:55 +0000</updated>
                            <resolved>Thu, 3 Dec 2009 01:20:21 +0000</resolved>
                                    <version>0.1</version>
                    <version>0.2</version>
                                    <fixVersion>0.1</fixVersion>
                                    <component>Python - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12784096" author="tlipcon" created="Tue, 1 Dec 2009 07:29:52 +0000"  >&lt;p&gt;Thanks for the bug report. I fixed it slightly differently than your proposal, and also added a unit test.&lt;/p&gt;

&lt;p&gt;To test:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ cd test
$ thrift -gen py ThriftTest.thrift
$ cd py
$ PYTHONPATH=../gen-py python TestServer.py  TNonblockingServer &amp;amp;
$ PYTHONPATH=../gen-py python TestClient.py --framed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Without the patch, the new unit test fails. With, it passes.&lt;/p&gt;</comment>
                            <comment id="12784297" author="dreiss" created="Tue, 1 Dec 2009 17:26:06 +0000"  >&lt;p&gt;LGTM.  Want me to commit, or wait for you to get your account?  Also, can you change the message to&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-637&quot; title=&quot;Bug in TNonblockingServer.py for services with both oneway and regular requests &quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-637&quot;&gt;&lt;del&gt;THRIFT-637&lt;/del&gt;&lt;/a&gt;. python: Fix mixing of oneway and regular requests in TNonblockingServer&lt;/p&gt;

&lt;p&gt;?  I think having the language at the beginning makes it easier to skim logs.&lt;/p&gt;</comment>
                            <comment id="12785112" author="tlipcon" created="Thu, 3 Dec 2009 01:20:21 +0000"  >&lt;p&gt;Committed in r886646. Thanks for reporting, Arvind.&lt;/p&gt;</comment>
                            <comment id="12785146" author="dreiss" created="Thu, 3 Dec 2009 02:14:39 +0000"  >&lt;p&gt;FYI, you can click the &quot;Subversion Commits&quot; or &quot;All&quot; tab in JIRA to see the revision information, so it isn&apos;t necessary to put it into the comment.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12426510" name="thrift-637.txt" size="1477" author="tlipcon" created="Tue, 1 Dec 2009 07:29:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>186805</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 51 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16brr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245039</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>