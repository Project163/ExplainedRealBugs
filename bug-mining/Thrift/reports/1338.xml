<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:20:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-3051] Go Thrift generator creates bad go code</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-3051</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;h2&gt;&lt;a name=&quot;Motivation&quot;&gt;&lt;/a&gt;Motivation&lt;/h2&gt;
&lt;p&gt;I was attempting to build a go tool that used the Apache Aurora thrift interface, only to be stymied because thrift generates invalid code for the current api.thrift interface. (found under api/src/main/thrift/org/apache/aurora/gen/api.thrift)&lt;/p&gt;

&lt;h2&gt;&lt;a name=&quot;Stepstoreplicate&quot;&gt;&lt;/a&gt;Steps to replicate&lt;/h2&gt;
&lt;ol&gt;
	&lt;li&gt;Create a thrift file called test.thrift containing the text:
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;test.thrift&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;struct Option1 {
}

struct Option2 {
  1: optional string name
}

union Descendant {
  1: Option1 option1
  2: Option2 option2
}

struct TestStruct {
  1: optional Descendant descendant = { &lt;span class=&quot;code-quote&quot;&gt;&quot;option1&quot;&lt;/span&gt;: {}}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Run &lt;tt&gt;thrift -o somedir -r --gen go test.thrift&lt;/tt&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;h2&gt;&lt;a name=&quot;ExpectedResult&quot;&gt;&lt;/a&gt;Expected Result&lt;/h2&gt;

&lt;p&gt;The command indicates success, and the &lt;tt&gt;somedir&lt;/tt&gt; directory contains a tree of go code that successfully compiles.&lt;/p&gt;

&lt;h2&gt;&lt;a name=&quot;ActualResult&quot;&gt;&lt;/a&gt;Actual Result&lt;/h2&gt;

&lt;p&gt;The above command outputs&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;/somedir/gen-go&lt;span class=&quot;code-comment&quot;&gt;//test/ttypes.go:317:6: expected &lt;span class=&quot;code-quote&quot;&gt;&apos;}&apos;&lt;/span&gt;, found &lt;span class=&quot;code-quote&quot;&gt;&apos;:=&apos;&lt;/span&gt;
&lt;/span&gt;/somedir/gen-go&lt;span class=&quot;code-comment&quot;&gt;//test/ttypes.go:318:3: expected declaration, found &lt;span class=&quot;code-quote&quot;&gt;&apos;IDENT&apos;&lt;/span&gt; descendant
&lt;/span&gt;WARNING - Running &lt;span class=&quot;code-quote&quot;&gt;&apos;gofmt -w /somedir/gen-go&lt;span class=&quot;code-comment&quot;&gt;//test/ttypes.go&apos;&lt;/span&gt; failed.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The code fails to compile with similar errors. On inspection, it appears that the go compiler outputs&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;ttypes.go&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; TestStruct_Descendant_DEFAULT *Descendant = &amp;amp;Descendant{
  v1 := &amp;amp;Option1{}
  descendant.Option1 = v1}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;which is entirely incorrect. This code should instead be&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;ttypes.go&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; TestStruct_Descendant_DEFAULT *Descendant = &amp;amp;Descendant{
 Option1: &amp;amp;Option1{}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When this change is made, the compilation succeeds.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Mac OS X 10.10.2&lt;br/&gt;
Thrift 0.9.2 installed via homebrew, and Thrift HEAD (identifies as 1.0.0-dev) installed via homebrew&lt;/p&gt;</environment>
        <key id="12785956">THRIFT-3051</key>
            <summary>Go Thrift generator creates bad go code</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jfarrell">Jake Farrell</assignee>
                                    <reporter username="swsnider">Silas Snider</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Mar 2015 17:52:36 +0000</created>
                <updated>Sat, 20 Feb 2021 15:28:18 +0000</updated>
                            <resolved>Tue, 15 Sep 2015 19:47:28 +0000</resolved>
                                    <version>0.9.2</version>
                                    <fixVersion>0.9.3</fixVersion>
                                    <component>Go - Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14387362" author="jensg" created="Mon, 30 Mar 2015 20:42:13 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=swsnider&quot; class=&quot;user-hover&quot; rel=&quot;swsnider&quot;&gt;swsnider&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;would it be possible for you to submit a patch or pull request?&lt;/p&gt;</comment>
                            <comment id="14387386" author="swsnider" created="Mon, 30 Mar 2015 20:55:11 +0000"  >&lt;p&gt;No: I took a look at the generator code, and a) I don&apos;t know C++ very well, b) even with the knowledge I do have, it&apos;s really non-obvious to me what to change, and c) I haven&apos;t gone through the process to get my employer&apos;s OK before contributing a patch, so that&apos;d also lengthen the time it would take for me to submit one. Sorry.&lt;/p&gt;</comment>
                            <comment id="14745752" author="jfarrell" created="Tue, 15 Sep 2015 17:08:50 +0000"  >&lt;p&gt;Thanks for the bug report &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=swsnider&quot; class=&quot;user-hover&quot; rel=&quot;swsnider&quot;&gt;swsnider&lt;/a&gt;, attached is a patch that should address this issue. can you please test this out and confirm.&lt;/p&gt;

&lt;p&gt;ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jensg&quot; class=&quot;user-hover&quot; rel=&quot;jensg&quot;&gt;jensg&lt;/a&gt; for review&lt;/p&gt;</comment>
                            <comment id="14746025" author="jensg" created="Tue, 15 Sep 2015 19:47:28 +0000"  >&lt;p&gt;Tested &amp;amp; committed, thanks Jake!&lt;/p&gt;</comment>
                            <comment id="14746146" author="hudson" created="Tue, 15 Sep 2015 20:47:19 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #1654 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/1654/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/1654/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3051&quot; title=&quot;Go Thrift generator creates bad go code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3051&quot;&gt;&lt;del&gt;THRIFT-3051&lt;/del&gt;&lt;/a&gt; Go Thrift generator creates bad go code (jensg: rev 0f17e15255f772167ab8bd844a5ddbcbec7ea616)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;compiler/cpp/src/generate/t_go_generator.cc&lt;/li&gt;
	&lt;li&gt;lib/go/test/Makefile.am&lt;/li&gt;
	&lt;li&gt;lib/go/test/UnionDefaultValueTest.thrift&lt;/li&gt;
	&lt;li&gt;lib/go/test/tests/union_default_value_test.go&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12756038" name="THRIFT-3051.patch" size="5580" author="jfarrell" created="Tue, 15 Sep 2015 17:08:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i27es7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>