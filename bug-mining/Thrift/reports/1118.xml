<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:15:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-2854] Go Struct writer and reader looses important error information</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-2854</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;The GO Compiler generates code for a struct so that the following occurs:&lt;/p&gt;

&lt;p&gt;When an error occurs while reading or writing, a new error is created with additional text information using &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;fmt.Errorf&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;.&lt;br/&gt;
By doing this the original error is completely lost. This is a real problem because errors of type TTransportException and TProtocolExceptions which contain additional information are lost. This will cause bad error handling, as the server implementation is dependent on those information.&lt;/p&gt;

&lt;p&gt;In my personal fork, I have a quick&apos;n dirty fix for this, but I&apos;m looking for a better option.&lt;/p&gt;

&lt;p&gt;Maybe instead of &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;fmt.Errorf&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; we could use this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// Prepends additional information to an error without losing the Thrift &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt;
&lt;/span&gt;func PrependError(err error, prepend string) error {
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; t, ok := err.(TTransportException); ok {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; NewTTransportException(t.TypeId(), prepend+t.Error())
  }
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; t, ok := err.(TProtocolException); ok {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; NewTProtocolExceptionWithType(t.TypeId(), errors.New(prepend+err.Error()))
  }
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; t, ok := err.(TApplicationException); ok {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; NewTApplicationException(t.TypeId(), prepend+t.Error())
  }

  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; errors.New(prepend + err.Error())
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I want to discuss this first here, because making a patch is quiet some work and I don&apos;t want major changes after I create a fix.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12757564">THRIFT-2854</key>
            <summary>Go Struct writer and reader looses important error information</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jensg">Jens Geyer</assignee>
                                    <reporter username="cvlchinet">Chi Vinh Le</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Nov 2014 00:04:29 +0000</created>
                <updated>Mon, 8 Dec 2014 20:34:58 +0000</updated>
                            <resolved>Sun, 30 Nov 2014 14:27:04 +0000</resolved>
                                    <version>0.9.2</version>
                                    <fixVersion>0.9.3</fixVersion>
                                    <component>Go - Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14223825" author="cvlchinet" created="Tue, 25 Nov 2014 00:22:51 +0000"  >&lt;p&gt;Example of code that is currently being generated:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;func (p *Bonk) ReadField1(iprot thrift.TProtocol) error {
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; v, err := iprot.ReadString(); err != nil {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; fmt.Errorf(&lt;span class=&quot;code-quote&quot;&gt;&quot;error reading field 1: %s&quot;&lt;/span&gt;, err)
  } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
    p.Message = v
  }
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; nil
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14225211" author="jensg" created="Tue, 25 Nov 2014 21:10:19 +0000"  >&lt;p&gt;The generated code has some known flaws with respect to error handling in general. I absolutely agree that we should do something about it. A good test case would be nice as well.&lt;/p&gt;

&lt;p&gt;Actually there are some more places that could need some reviewing. At some occasions returned errors are entirely ignored right now,e.g. the generated &lt;tt&gt;Process()&lt;/tt&gt; functions. Although these are a bit tricky because of the &lt;tt&gt;oneway&lt;/tt&gt; stuff. But that&apos;s probably a bit outside of the scope of this ticket.&lt;/p&gt;</comment>
                            <comment id="14225235" author="cvlchinet" created="Tue, 25 Nov 2014 21:27:29 +0000"  >&lt;p&gt;I just scanned the generated code. It seems to be working correctly. Errors get reported back to the processing server. &lt;tt&gt;oneway&lt;/tt&gt; doesn&apos;t reply back to client, otherwise it does. Where are the flaws located exactly?&lt;br/&gt;
The only problem I find is what I reported above in the ticket.&lt;/p&gt;</comment>
                            <comment id="14225237" author="cvlchinet" created="Tue, 25 Nov 2014 21:30:00 +0000"  >&lt;p&gt;One thing though: &lt;br/&gt;
Why does the &lt;tt&gt;Process()&lt;/tt&gt; functions returns 2 variables &lt;tt&gt;(success bool, err thrift.TException)&lt;/tt&gt;.&lt;br/&gt;
Isn&apos;t just having&#160;&lt;tt&gt;err thrift.TException&lt;/tt&gt; enough? &lt;/p&gt;

&lt;p&gt;I have my own server implementation and currently I just ignore the success variable.&lt;/p&gt;</comment>
                            <comment id="14225305" author="jensg" created="Tue, 25 Nov 2014 22:17:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;where are the flaws?&lt;/p&gt;&lt;/blockquote&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;protocol.go&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// note the error returns
&lt;/span&gt;type TProtocol &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; {
	WriteMessageBegin(name string, typeId TMessageType, seqid int32) error
	WriteMessageEnd() error
        &lt;span class=&quot;code-comment&quot;&gt;// ... more code ...
&lt;/span&gt;	ReadMessageBegin() (name string, typeId TMessageType, seqid int32, err error)
	ReadMessageEnd() error
        &lt;span class=&quot;code-comment&quot;&gt;// ... more code ...
&lt;/span&gt;	Flush() (err error)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;some_generated_code.go&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;func (p *foobarProcessorBaz_) &lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;(seqId int32, iprot, oprot thrift.TProtocol) (success bool, err thrift.TException) {
	args := NewBazArgs_{}
	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; err = args.Read(iprot); err != nil {
		iprot.ReadMessageEnd()  &lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;== no error check 
&lt;/span&gt;		x := thrift.NewTApplicationException(thrift.PROTOCOL_ERROR, err.Error())
		oprot.WriteMessageBegin(&lt;span class=&quot;code-quote&quot;&gt;&quot;Quox&quot;&lt;/span&gt;, thrift.EXCEPTION, seqId)  &lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;== no error check 
&lt;/span&gt;		x.Write(oprot)  &lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;== no error check 
&lt;/span&gt;		oprot.WriteMessageEnd()  &lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;== no error check 
&lt;/span&gt;		oprot.Flush()  &lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;== no error check 
&lt;/span&gt;		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, err
	}

	iprot.ReadMessageEnd()
        &lt;span class=&quot;code-comment&quot;&gt;// ... more code ...&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;Why does the Process() functions returns 2 variables (success bool, err thrift.TException). Isn&apos;t just having err thrift.TException enough? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That would break too many things. You know, people are actually using this stuff and we already had some breaking changes in the Go library not so long ago. I would like to avoid that, especially compared to the limited benefit we would get from it. That is also a point to consider when providing patches in general: First, we have a somwehat standardized layout of certain things across all languages that we want to keep. Next, we want to be compatible. &lt;/p&gt;

&lt;p&gt;Thanks to a number of significant contributions the Go part of Thrift has reached quite a good state that we absolutely should strive to improve (there is room for that), but not at all cost.&lt;/p&gt;</comment>
                            <comment id="14225330" author="cvlchinet" created="Tue, 25 Nov 2014 22:42:09 +0000"  >&lt;p&gt;Just asking &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I saw that part of code, but I considered it correct.&lt;br/&gt;
When reading the struct fails, the incoming stream is usually corrupted or not available.&lt;br/&gt;
Good chance that the outgoing stream is not available as well.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;iprot.ReadMessageEnd()&lt;/tt&gt; will usually fail as a subsequent error and should be considered as best effort try.&lt;br/&gt;
I see the same for sending the &lt;tt&gt;thrift.Exception&lt;/tt&gt;&#160;as an best effort try. At most we can log the errors that happen during those best effort tries. &lt;/p&gt;

&lt;p&gt;The first error that occurred will be returned, which is more important than the other errors &#8211; as they probably are subsequent errors caused by the first one.&lt;/p&gt;

&lt;p&gt;Anyway this is going off scope of the ticket. If the &lt;tt&gt;Process&lt;/tt&gt; error handling still bugs someone, he/she should open a ticket.&lt;/p&gt;

&lt;p&gt;Back to main ticket:&lt;br/&gt;
I will implement the proposed solution for the problem mentioned in the ticket by tomorrow. If anyone has a better solution please write here. This removes the single problem I encountered to implement a faul tolerant Thrift server. &lt;/p&gt;
</comment>
                            <comment id="14225422" author="jensg" created="Tue, 25 Nov 2014 23:51:33 +0000"  >&lt;p&gt;Ok.&lt;/p&gt;</comment>
                            <comment id="14226991" author="githubbot" created="Wed, 26 Nov 2014 23:31:55 +0000"  >&lt;p&gt;GitHub user cvlchinet opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/291&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/291&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2854&quot; title=&quot;Go Struct writer and reader looses important error information&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2854&quot;&gt;&lt;del&gt;THRIFT-2854&lt;/del&gt;&lt;/a&gt; Go Struct writer and reader looses important error information&lt;/p&gt;

&lt;p&gt;    This PR fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2854&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/THRIFT-2854&lt;/a&gt;.&lt;br/&gt;
    The included test will cover the complete client error handling code except the check for the Sequence ID. (unless I miss something)&lt;br/&gt;
    I will submit a follow up PR to test the error handling for the Sequence ID too once this PR has been merged.&lt;br/&gt;
    The covered code makes up the majority of the server error handling code too.&lt;/p&gt;

&lt;p&gt;    And yes.. it was not fun too code the test.. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/tongue.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/cvlchinet/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/cvlchinet/thrift&lt;/a&gt; go-struct-error&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/291.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/291.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #291&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 18d2d2b58a1dd3ed256fe189bc9b8a5a77f5bcc5&lt;br/&gt;
Author: Chi Vinh Le &amp;lt;cvl@chinet.info&amp;gt;&lt;br/&gt;
Date:   2014-11-26T23:19:17Z&lt;/p&gt;

&lt;p&gt;    Fixes error reporting in go generator&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14228454" author="cvlchinet" created="Fri, 28 Nov 2014 18:23:24 +0000"  >&lt;p&gt;Added PR yesterday. Have a look &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14228594" author="cvlchinet" created="Sat, 29 Nov 2014 02:14:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jensg&quot; class=&quot;user-hover&quot; rel=&quot;jensg&quot;&gt;jensg&lt;/a&gt; I thought again about the Process function. It is true, you are right. It is not optimal the way it is done right now.&lt;br/&gt;
I want to work on that too and provide a test case. I would be happy if you can help me on the Go issues. I am highly interested in a robust and tested go implementation as fast as possible.&lt;/p&gt;</comment>
                            <comment id="14229114" author="githubbot" created="Sun, 30 Nov 2014 14:25:19 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/291&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/291&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14229115" author="jensg" created="Sun, 30 Nov 2014 14:27:04 +0000"  >&lt;p&gt;Great, thanks! =&amp;gt; Committed.&lt;/p&gt;</comment>
                            <comment id="14229125" author="hudson" created="Sun, 30 Nov 2014 14:51:54 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #1377 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/1377/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/1377/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2854&quot; title=&quot;Go Struct writer and reader looses important error information&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2854&quot;&gt;&lt;del&gt;THRIFT-2854&lt;/del&gt;&lt;/a&gt; Go Struct writer and reader looses important error information (jensg: rev 527b6d9c86a7e5cde14cbb09a0e3103be0791c3a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/go/thrift/exception_test.go&lt;/li&gt;
	&lt;li&gt;lib/go/test/ErrorTest.thrift&lt;/li&gt;
	&lt;li&gt;lib/go/thrift/exception.go&lt;/li&gt;
	&lt;li&gt;lib/go/test/tests/client_error_test.go&lt;/li&gt;
	&lt;li&gt;lib/go/test/Makefile.am&lt;/li&gt;
	&lt;li&gt;compiler/cpp/src/generate/t_go_generator.cc&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 51 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i22qpz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>