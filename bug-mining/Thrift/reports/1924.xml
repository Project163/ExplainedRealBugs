<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:29:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-4618] TNonblockingServer crash because of limitation of select()</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-4618</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;Process opened more than 1024 file descriptors. When new incoming connection was established to TNonblockingServer, sig 6 came from one of &apos;select&apos;-related macros (FD_ZERO/FD_SET).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13178417">THRIFT-4618</key>
            <summary>TNonblockingServer crash because of limitation of select()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jking3">James E. King III</assignee>
                                    <reporter username="st0ke">Alexander Boldyrev</reporter>
                        <labels>
                            <label>C++</label>
                            <label>TNonblockingServer</label>
                    </labels>
                <created>Sat, 11 Aug 2018 06:25:15 +0000</created>
                <updated>Thu, 27 Dec 2018 15:24:55 +0000</updated>
                            <resolved>Fri, 12 Oct 2018 11:38:17 +0000</resolved>
                                    <version>0.9.3</version>
                                    <fixVersion>0.12.0</fixVersion>
                                    <component>C++ - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16577073" author="githubbot" created="Sat, 11 Aug 2018 06:35:38 +0000"  >&lt;p&gt;st0ke opened a new pull request #1579: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4618&quot; title=&quot;TNonblockingServer crash because of limitation of select()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4618&quot;&gt;&lt;del&gt;THRIFT-4618&lt;/del&gt;&lt;/a&gt;: Use poll() instead of select() in C++ TNonblockingServer if available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1579&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1579&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Got poll() realization from b5ebcd199c1b603cea652847bfc9177c60fb8e28&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16577077" author="githubbot" created="Sat, 11 Aug 2018 06:46:58 +0000"  >&lt;p&gt;st0ke closed pull request #1579: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4618&quot; title=&quot;TNonblockingServer crash because of limitation of select()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4618&quot;&gt;&lt;del&gt;THRIFT-4618&lt;/del&gt;&lt;/a&gt;: Use poll() instead of select() in C++ TNonblockingServer if available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1579&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1579&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16577079" author="githubbot" created="Sat, 11 Aug 2018 06:49:51 +0000"  >&lt;p&gt;st0ke opened a new pull request #1580: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4618&quot; title=&quot;TNonblockingServer crash because of limitation of select()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4618&quot;&gt;&lt;del&gt;THRIFT-4618&lt;/del&gt;&lt;/a&gt;: Use poll() instead of select() in C++ TNonblockingServer if available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1580&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1580&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Got poll() code from b5ebcd1&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16577415" author="githubbot" created="Sun, 12 Aug 2018 05:02:48 +0000"  >&lt;p&gt;st0ke commented on issue #1580: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4618&quot; title=&quot;TNonblockingServer crash because of limitation of select()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4618&quot;&gt;&lt;del&gt;THRIFT-4618&lt;/del&gt;&lt;/a&gt;: Use poll() instead of select() in C++ TNonblockingServer if available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1580#issuecomment-412318997&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1580#issuecomment-412318997&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &quot;continuous-integration/travis-ci/pr&quot; failed not because of my changes. Please, help.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16577416" author="githubbot" created="Sun, 12 Aug 2018 05:03:18 +0000"  >&lt;p&gt;st0ke edited a comment on issue #1580: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4618&quot; title=&quot;TNonblockingServer crash because of limitation of select()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4618&quot;&gt;&lt;del&gt;THRIFT-4618&lt;/del&gt;&lt;/a&gt;: Use poll() instead of select() in C++ TNonblockingServer if available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1580#issuecomment-412318997&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1580#issuecomment-412318997&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &quot;continuous-integration/travis-ci/pr&quot; failed not because of my changes. Does master branch is ok?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16577417" author="githubbot" created="Sun, 12 Aug 2018 05:03:37 +0000"  >&lt;p&gt;st0ke edited a comment on issue #1580: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4618&quot; title=&quot;TNonblockingServer crash because of limitation of select()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4618&quot;&gt;&lt;del&gt;THRIFT-4618&lt;/del&gt;&lt;/a&gt;: Use poll() instead of select() in C++ TNonblockingServer if available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1580#issuecomment-412318997&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1580#issuecomment-412318997&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &quot;continuous-integration/travis-ci/pr&quot; failed not because of my changes. Is master branch ok?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16595836" author="githubbot" created="Wed, 29 Aug 2018 01:57:00 +0000"  >&lt;p&gt;jeking3 commented on issue #1580: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4618&quot; title=&quot;TNonblockingServer crash because of limitation of select()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4618&quot;&gt;&lt;del&gt;THRIFT-4618&lt;/del&gt;&lt;/a&gt;: Use poll() instead of select() in C++ TNonblockingServer if available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1580#issuecomment-416797288&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1580#issuecomment-416797288&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Sometimes it needs a little help.  We can restart individual jobs.  I have done that.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16595838" author="githubbot" created="Wed, 29 Aug 2018 02:00:26 +0000"  >&lt;p&gt;jeking3 commented on issue #1580: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4618&quot; title=&quot;TNonblockingServer crash because of limitation of select()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4618&quot;&gt;&lt;del&gt;THRIFT-4618&lt;/del&gt;&lt;/a&gt;: Use poll() instead of select() in C++ TNonblockingServer if available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1580#issuecomment-416797908&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1580#issuecomment-416797908&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   I don&apos;t think non-blocking servers are tested in the current cross test suite...&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16596305" author="githubbot" created="Wed, 29 Aug 2018 13:13:11 +0000"  >&lt;p&gt;st0ke commented on issue #1580: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4618&quot; title=&quot;TNonblockingServer crash because of limitation of select()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4618&quot;&gt;&lt;del&gt;THRIFT-4618&lt;/del&gt;&lt;/a&gt;: Use poll() instead of select() in C++ TNonblockingServer if available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1580#issuecomment-416947668&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1580#issuecomment-416947668&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Do I need to rebase the commit?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16596939" author="githubbot" created="Wed, 29 Aug 2018 23:45:09 +0000"  >&lt;p&gt;jeking3 commented on issue #1580: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4618&quot; title=&quot;TNonblockingServer crash because of limitation of select()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4618&quot;&gt;&lt;del&gt;THRIFT-4618&lt;/del&gt;&lt;/a&gt;: Use poll() instead of select() in C++ TNonblockingServer if available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1580#issuecomment-417143513&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1580#issuecomment-417143513&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Unlikely, there are some stubborn failures.   I will try to rekick.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16599543" author="githubbot" created="Sat, 1 Sep 2018 05:53:12 +0000"  >&lt;p&gt;st0ke commented on issue #1580: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4618&quot; title=&quot;TNonblockingServer crash because of limitation of select()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4618&quot;&gt;&lt;del&gt;THRIFT-4618&lt;/del&gt;&lt;/a&gt;: Use poll() instead of select() in C++ TNonblockingServer if available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1580#issuecomment-417835549&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1580#issuecomment-417835549&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &amp;gt; I see changes for cmake - what about autoconf?&lt;/p&gt;

&lt;p&gt;   Done&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16599544" author="githubbot" created="Sat, 1 Sep 2018 05:53:29 +0000"  >&lt;p&gt;st0ke commented on issue #1580: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4618&quot; title=&quot;TNonblockingServer crash because of limitation of select()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4618&quot;&gt;&lt;del&gt;THRIFT-4618&lt;/del&gt;&lt;/a&gt;: Use poll() instead of select() in C++ TNonblockingServer if available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1580#issuecomment-417835563&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1580#issuecomment-417835563&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &amp;gt; I see changes for cmake - what about autoconf?&lt;/p&gt;

&lt;p&gt;   Done&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16599545" author="githubbot" created="Sat, 1 Sep 2018 05:53:42 +0000"  >&lt;p&gt;st0ke removed a comment on issue #1580: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4618&quot; title=&quot;TNonblockingServer crash because of limitation of select()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4618&quot;&gt;&lt;del&gt;THRIFT-4618&lt;/del&gt;&lt;/a&gt;: Use poll() instead of select() in C++ TNonblockingServer if available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1580#issuecomment-417835563&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1580#issuecomment-417835563&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &amp;gt; I see changes for cmake - what about autoconf?&lt;/p&gt;

&lt;p&gt;   Done&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16610351" author="githubbot" created="Tue, 11 Sep 2018 09:40:36 +0000"  >&lt;p&gt;duynl58 commented on issue #1580: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4618&quot; title=&quot;TNonblockingServer crash because of limitation of select()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4618&quot;&gt;&lt;del&gt;THRIFT-4618&lt;/del&gt;&lt;/a&gt;: Use poll() instead of select() in C++ TNonblockingServer if available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1580#issuecomment-420212466&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1580#issuecomment-420212466&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Select is slow.&lt;br/&gt;
   Please consider epoll/kqueue instead.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16610374" author="githubbot" created="Tue, 11 Sep 2018 09:55:48 +0000"  >&lt;p&gt;st0ke commented on issue #1580: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4618&quot; title=&quot;TNonblockingServer crash because of limitation of select()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4618&quot;&gt;&lt;del&gt;THRIFT-4618&lt;/del&gt;&lt;/a&gt;: Use poll() instead of select() in C++ TNonblockingServer if available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1580#issuecomment-420216776&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1580#issuecomment-420216776&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &amp;gt; Select is slow.&lt;br/&gt;
   &amp;gt; Please consider epoll/kqueue instead.&lt;/p&gt;

&lt;p&gt;   1. Current realization use select(). I add poll() if available, because FD_SET is failed if descriptor is bigger than 1024.&lt;br/&gt;
   2. Does epoll/kqueue do it faster than poll on only two descriptors? If so, does anybody need this small boost?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16639864" author="githubbot" created="Fri, 5 Oct 2018 14:04:09 +0000"  >&lt;p&gt;jeking3 commented on a change in pull request #1580: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4618&quot; title=&quot;TNonblockingServer crash because of limitation of select()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4618&quot;&gt;&lt;del&gt;THRIFT-4618&lt;/del&gt;&lt;/a&gt;: Use poll() instead of select() in C++ TNonblockingServer if available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1580#discussion_r223017516&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1580#discussion_r223017516&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: lib/cpp/src/thrift/server/TNonblockingServer.cpp&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -1291,10 +1295,44 @@ bool TNonblockingIOThread::notify(TNonblockingServer::TConnection* conn) &lt;/p&gt;
{
     return false;
   }

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fd_set wfds, efds;&lt;/li&gt;
	&lt;li&gt;long ret = -1;&lt;br/&gt;
+  int ret = -1;&lt;br/&gt;
   long kSize = sizeof(conn);&lt;/li&gt;
	&lt;li&gt;const char* pos = reinterpret_cast&amp;lt;const char*&amp;gt;(&amp;amp;conn);&lt;br/&gt;
+  const char * pos = (const char *)const_cast_sockopt(&amp;amp;conn);&lt;br/&gt;
+&lt;br/&gt;
+#if defined(HAVE_POLL_H) || defined(HAVE_SYS_POLL_H)&lt;br/&gt;
+  struct pollfd pfd = 
{fd, POLLOUT, 0}
&lt;p&gt;;&lt;br/&gt;
+&lt;br/&gt;
+  while (kSize &amp;gt; 0) {&lt;br/&gt;
+    pfd.revents = 0;&lt;br/&gt;
+    ret = poll(&amp;amp;pfd, 1, -1);&lt;br/&gt;
+    if (ret &amp;lt; 0) &lt;/p&gt;
{
+      return false;
+    }
&lt;p&gt; else if (ret == 0) &lt;/p&gt;
{
+      continue;
+    }
&lt;p&gt;+&lt;br/&gt;
+    if (pfd.revents &amp;amp; POLLHUP || pfd.revents &amp;amp; POLLERR) {&lt;br/&gt;
+      ::close(fd);&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Should this and the other instances of close instead be THRIFT_CLOSESOCKET like the other code path?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643647" author="githubbot" created="Tue, 9 Oct 2018 15:37:52 +0000"  >&lt;p&gt;st0ke commented on a change in pull request #1580: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4618&quot; title=&quot;TNonblockingServer crash because of limitation of select()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4618&quot;&gt;&lt;del&gt;THRIFT-4618&lt;/del&gt;&lt;/a&gt;: Use poll() instead of select() in C++ TNonblockingServer if available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1580#discussion_r223755475&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1580#discussion_r223755475&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: lib/cpp/src/thrift/server/TNonblockingServer.cpp&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -1291,10 +1295,44 @@ bool TNonblockingIOThread::notify(TNonblockingServer::TConnection* conn) &lt;/p&gt;
{
     return false;
   }

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fd_set wfds, efds;&lt;/li&gt;
	&lt;li&gt;long ret = -1;&lt;br/&gt;
+  int ret = -1;&lt;br/&gt;
   long kSize = sizeof(conn);&lt;/li&gt;
	&lt;li&gt;const char* pos = reinterpret_cast&amp;lt;const char*&amp;gt;(&amp;amp;conn);&lt;br/&gt;
+  const char * pos = (const char *)const_cast_sockopt(&amp;amp;conn);&lt;br/&gt;
+&lt;br/&gt;
+#if defined(HAVE_POLL_H) || defined(HAVE_SYS_POLL_H)&lt;br/&gt;
+  struct pollfd pfd = 
{fd, POLLOUT, 0}
&lt;p&gt;;&lt;br/&gt;
+&lt;br/&gt;
+  while (kSize &amp;gt; 0) {&lt;br/&gt;
+    pfd.revents = 0;&lt;br/&gt;
+    ret = poll(&amp;amp;pfd, 1, -1);&lt;br/&gt;
+    if (ret &amp;lt; 0) &lt;/p&gt;
{
+      return false;
+    }
&lt;p&gt; else if (ret == 0) &lt;/p&gt;
{
+      continue;
+    }
&lt;p&gt;+&lt;br/&gt;
+    if (pfd.revents &amp;amp; POLLHUP || pfd.revents &amp;amp; POLLERR) {&lt;br/&gt;
+      ::close(fd);&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Yes, it should. closesocket() is used on win platform.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643657" author="githubbot" created="Tue, 9 Oct 2018 15:48:07 +0000"  >&lt;p&gt;jeking3 commented on issue #1580: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4618&quot; title=&quot;TNonblockingServer crash because of limitation of select()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4618&quot;&gt;&lt;del&gt;THRIFT-4618&lt;/del&gt;&lt;/a&gt;: Use poll() instead of select() in C++ TNonblockingServer if available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1580#issuecomment-428245479&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1580#issuecomment-428245479&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Sadly I think our coverage on non-blocking is lax, so I&apos;m sure how well this is tested across platforms; and there&apos;s no cross test that runs on Windows.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16645987" author="githubbot" created="Thu, 11 Oct 2018 05:19:27 +0000"  >&lt;p&gt;st0ke commented on issue #1580: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4618&quot; title=&quot;TNonblockingServer crash because of limitation of select()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4618&quot;&gt;&lt;del&gt;THRIFT-4618&lt;/del&gt;&lt;/a&gt;: Use poll() instead of select() in C++ TNonblockingServer if available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1580#issuecomment-428824059&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1580#issuecomment-428824059&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &quot;Travis build&quot; failed in D language tests. Do I need to do something with that?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16647802" author="githubbot" created="Fri, 12 Oct 2018 11:37:43 +0000"  >&lt;p&gt;jeking3 closed pull request #1580: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4618&quot; title=&quot;TNonblockingServer crash because of limitation of select()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4618&quot;&gt;&lt;del&gt;THRIFT-4618&lt;/del&gt;&lt;/a&gt;: Use poll() instead of select() in C++ TNonblockingServer if available&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1580&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1580&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/build/cmake/ConfigureChecks.cmake b/build/cmake/ConfigureChecks.cmake&lt;br/&gt;
index 6b9c6a32f9..457bfe05da 100644&lt;br/&gt;
&amp;#8212; a/build/cmake/ConfigureChecks.cmake&lt;br/&gt;
+++ b/build/cmake/ConfigureChecks.cmake&lt;br/&gt;
@@ -45,6 +45,7 @@ check_include_file(sys/socket.h HAVE_SYS_SOCKET_H)&lt;br/&gt;
 check_include_file(sys/stat.h HAVE_SYS_STAT_H)&lt;br/&gt;
 check_include_file(sys/time.h HAVE_SYS_TIME_H)&lt;br/&gt;
 check_include_file(sys/un.h HAVE_SYS_UN_H)&lt;br/&gt;
+check_include_file(poll.h HAVE_POLL_H)&lt;br/&gt;
 check_include_file(sys/poll.h HAVE_SYS_POLL_H)&lt;br/&gt;
 check_include_file(sys/select.h HAVE_SYS_SELECT_H)&lt;br/&gt;
 check_include_file(sched.h HAVE_SCHED_H)&lt;br/&gt;
diff --git a/build/cmake/config.h.in b/build/cmake/config.h.in&lt;br/&gt;
index c5d4d307d4..39d8270aa3 100644&lt;br/&gt;
&amp;#8212; a/build/cmake/config.h.in&lt;br/&gt;
+++ b/build/cmake/config.h.in&lt;br/&gt;
@@ -121,6 +121,9 @@&lt;br/&gt;
 /* Define to 1 if you have the &amp;lt;sys/un.h&amp;gt; header file. */&lt;br/&gt;
 #cmakedefine HAVE_SYS_UN_H 1&lt;/p&gt;

&lt;p&gt;+/* Define to 1 if you have the &amp;lt;poll.h&amp;gt; header file. */&lt;br/&gt;
+#cmakedefine HAVE_POLL_H 1&lt;br/&gt;
+&lt;br/&gt;
 /* Define to 1 if you have the &amp;lt;sys/poll.h&amp;gt; header file. */&lt;br/&gt;
 #cmakedefine HAVE_SYS_POLL_H 1&lt;/p&gt;

&lt;p&gt;diff --git a/configure.ac b/configure.ac&lt;br/&gt;
index 917f6fa226..14a8c2e0bf 100755&lt;br/&gt;
&amp;#8212; a/configure.ac&lt;br/&gt;
+++ b/configure.ac&lt;br/&gt;
@@ -640,6 +640,7 @@ AC_CHECK_HEADERS(&lt;span class=&quot;error&quot;&gt;&amp;#91;sys/ioctl.h&amp;#93;&lt;/span&gt;)&lt;br/&gt;
 AC_CHECK_HEADERS(&lt;span class=&quot;error&quot;&gt;&amp;#91;sys/socket.h&amp;#93;&lt;/span&gt;)&lt;br/&gt;
 AC_CHECK_HEADERS(&lt;span class=&quot;error&quot;&gt;&amp;#91;sys/time.h&amp;#93;&lt;/span&gt;)&lt;br/&gt;
 AC_CHECK_HEADERS(&lt;span class=&quot;error&quot;&gt;&amp;#91;sys/un.h&amp;#93;&lt;/span&gt;)&lt;br/&gt;
+AC_CHECK_HEADERS(&lt;span class=&quot;error&quot;&gt;&amp;#91;poll.h&amp;#93;&lt;/span&gt;)&lt;br/&gt;
 AC_CHECK_HEADERS(&lt;span class=&quot;error&quot;&gt;&amp;#91;sys/poll.h&amp;#93;&lt;/span&gt;)&lt;br/&gt;
 AC_CHECK_HEADERS(&lt;span class=&quot;error&quot;&gt;&amp;#91;sys/resource.h&amp;#93;&lt;/span&gt;)&lt;br/&gt;
 AC_CHECK_HEADERS(&lt;span class=&quot;error&quot;&gt;&amp;#91;unistd.h&amp;#93;&lt;/span&gt;)&lt;br/&gt;
diff --git a/lib/cpp/src/thrift/server/TNonblockingServer.cpp b/lib/cpp/src/thrift/server/TNonblockingServer.cpp&lt;br/&gt;
index f89b5f7935..194d59fa08 100644&lt;br/&gt;
&amp;#8212; a/lib/cpp/src/thrift/server/TNonblockingServer.cpp&lt;br/&gt;
+++ b/lib/cpp/src/thrift/server/TNonblockingServer.cpp&lt;br/&gt;
@@ -28,7 +28,11 @@&lt;br/&gt;
 #include &amp;lt;algorithm&amp;gt;&lt;br/&gt;
 #include &amp;lt;iostream&amp;gt;&lt;/p&gt;

&lt;p&gt;-#ifdef HAVE_SYS_SELECT_H&lt;br/&gt;
+#ifdef HAVE_POLL_H&lt;br/&gt;
+#include &amp;lt;poll.h&amp;gt;&lt;br/&gt;
+#elif HAVE_SYS_POLL_H&lt;br/&gt;
+#include &amp;lt;sys/poll.h&amp;gt;&lt;br/&gt;
+#elif HAVE_SYS_SELECT_H&lt;br/&gt;
 #include &amp;lt;sys/select.h&amp;gt;&lt;br/&gt;
 #endif&lt;/p&gt;

&lt;p&gt;@@ -1291,10 +1295,44 @@ bool TNonblockingIOThread::notify(TNonblockingServer::TConnection* conn) &lt;/p&gt;
{
     return false;
   }

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fd_set wfds, efds;&lt;/li&gt;
	&lt;li&gt;long ret = -1;&lt;br/&gt;
+  int ret = -1;&lt;br/&gt;
   long kSize = sizeof(conn);&lt;/li&gt;
	&lt;li&gt;const char* pos = reinterpret_cast&amp;lt;const char*&amp;gt;(&amp;amp;conn);&lt;br/&gt;
+  const char * pos = (const char *)const_cast_sockopt(&amp;amp;conn);&lt;br/&gt;
+&lt;br/&gt;
+#if defined(HAVE_POLL_H) || defined(HAVE_SYS_POLL_H)&lt;br/&gt;
+  struct pollfd pfd = 
{fd, POLLOUT, 0}
&lt;p&gt;;&lt;br/&gt;
+&lt;br/&gt;
+  while (kSize &amp;gt; 0) {&lt;br/&gt;
+    pfd.revents = 0;&lt;br/&gt;
+    ret = poll(&amp;amp;pfd, 1, -1);&lt;br/&gt;
+    if (ret &amp;lt; 0) &lt;/p&gt;
{
+      return false;
+    }
&lt;p&gt; else if (ret == 0) &lt;/p&gt;
{
+      continue;
+    }
&lt;p&gt;+&lt;br/&gt;
+    if (pfd.revents &amp;amp; POLLHUP || pfd.revents &amp;amp; POLLERR) &lt;/p&gt;
{
+      ::THRIFT_CLOSESOCKET(fd);
+      return false;
+    }
&lt;p&gt;+&lt;br/&gt;
+    if (pfd.revents &amp;amp; POLLOUT) {&lt;br/&gt;
+      ret = send(fd, pos, kSize, 0);&lt;br/&gt;
+      if (ret &amp;lt; 0) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+        if (errno == EAGAIN) {
+          continue;
+        }++        }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;+&lt;br/&gt;
+      kSize -= ret;&lt;br/&gt;
+      pos += ret;&lt;br/&gt;
+    }&lt;br/&gt;
+  }&lt;br/&gt;
+#else&lt;br/&gt;
+  fd_set wfds, efds;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   while (kSize &amp;gt; 0) {&lt;br/&gt;
     FD_ZERO(&amp;amp;wfds);&lt;br/&gt;
@@ -1328,6 +1366,7 @@ bool TNonblockingIOThread::notify(TNonblockingServer::TConnection* conn) &lt;/p&gt;
{
       pos += ret;
     }
&lt;p&gt;   }&lt;br/&gt;
+#endif&lt;/p&gt;

&lt;p&gt;   return true;&lt;br/&gt;
 }&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 5 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3wyfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>