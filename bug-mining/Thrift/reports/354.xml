<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:58:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-517] TExceptions thrown by server result in cryptic error message on client - Tried to read 4 bytes, but only got 0 bytes</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-517</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;To reproduce:&lt;/p&gt;

&lt;p&gt;1. Define a simple Thrift service method with no custom exceptions.&lt;br/&gt;
2. In server implementation of service method, throw a TException.&lt;br/&gt;
3. Generated code in client forces you to do try/catch TException around service call, do this, and output stack trace,&lt;/p&gt;

&lt;p&gt;The exception thrown by the server then results in this rather cryptic error message in the client:&lt;/p&gt;

&lt;p&gt;26 22:32:44,931 INFO Caused by: org.apache.thrift.transport.TTransportException: Cannot read. Remote side has closed. Tried to read 4 bytes, but only got 0 bytes.&lt;br/&gt;
26 22:32:44,931 INFO    at org.apache.thrift.transport.TTransport.readAll(TTransport.java:86)&lt;br/&gt;
26 22:32:44,931 INFO    at org.apache.thrift.protocol.TBinaryProtocol.readAll(TBinaryProtocol.java:314)&lt;br/&gt;
26 22:32:44,931 INFO    at org.apache.thrift.protocol.TBinaryProtocol.readI32(TBinaryProtocol.java:262)&lt;br/&gt;
26 22:32:44,931 INFO    at org.apache.thrift.protocol.TBinaryProtocol.readMessageBegin(TBinaryProtocol.java:192)&lt;br/&gt;
26 22:32:44,931 INFO    at fm.last.catalogue.api.TCatalogueAPI$Client.recv_getTrackById(TCatalogueAPI.java:249)&lt;/p&gt;

&lt;p&gt;It would be better if the client got the actual TException sent by the server, or at the very least a better error message indicating that an unexpected error occurred on the server (akin to an HTTP 500 message that most web servers use).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12426456">THRIFT-517</key>
            <summary>TExceptions thrown by server result in cryptic error message on client - Tried to read 4 bytes, but only got 0 bytes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanduxbury">Bryan Duxbury</assignee>
                                    <reporter username="adrianw">Adrian Woodhead</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 May 2009 11:37:13 +0000</created>
                <updated>Wed, 27 Oct 2010 23:16:31 +0000</updated>
                            <resolved>Wed, 27 Oct 2010 23:16:31 +0000</resolved>
                                                    <fixVersion>0.6</fixVersion>
                                    <component>Java - Compiler</component>
                    <component>Java - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12713610" author="bryanduxbury" created="Wed, 27 May 2009 15:45:35 +0000"  >&lt;p&gt;If you throw an anonymous TException on the server side, it&apos;s basically an &quot;unexpected&quot; exception. The way that the Thrift server code handles this is to log the exception and close the client connection. This is why your clientside gets a transport exception - the pipe closed on it unexpectedly.&lt;/p&gt;

&lt;p&gt;We could consider actually sending back the exception message from the TException you threw, but that is a little iffy. Without declaring that a method throws a certain exception type, how do we know what to encode it as on the wire? If we wanted to do this, we would probably have to extend the message-passing layer to include an undeclared exception message. &lt;/p&gt;

&lt;p&gt;I think that in principle, if you are going to throw an exception, declare it. Otherwise the semantics are just too confusing. &lt;/p&gt;</comment>
                            <comment id="12713639" author="tlipcon" created="Wed, 27 May 2009 16:48:59 +0000"  >&lt;p&gt;I always understood this as the difference between a TException and a TApplicationException of some sort. I think in some of the implementations, it will catch exceptions in the server code and serialize it back over the wire as a TApplicationException. I do something of this sort in Erlang, at least, if I recall correctly &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12868253" author="andrewzimmer" created="Mon, 17 May 2010 15:28:03 +0000"  >&lt;p&gt;Why not just append the throwable&apos;s getMessage() or even toString() in the internal error text?  I understand that this doesn&apos;t  render the exception most elegantly, but I think by not including any details at all the client is pretty clueless.  The debug process without any message to the client then results in confusion and requires that someone on the server side line up log timestamps with the operator on the client side.&lt;/p&gt;

&lt;p&gt;In a web app, it makes sense that one doesn&apos;t barf the stack trace to the user.  But in this case I think you want to give as much detail as possible.  Clients can still trap the general &quot;unexpected&quot; exception differently, but having a bit more detail in the logs would be hugely helpful for those of us on the server side who have a slew of code that throws RuntimeExceptions that shouldn&apos;t be turned into checked exceptions in Thrift.&lt;/p&gt;

&lt;p&gt;Here&apos;s how I hand patch the generated code:&lt;/p&gt;

&lt;p&gt;} catch (Throwable th) {&lt;br/&gt;
          LOGGER.error(&quot;Internal error processing &lt;span class=&quot;error&quot;&gt;&amp;#91;method name here&amp;#93;&lt;/span&gt;&quot;, th);&lt;br/&gt;
          TApplicationException x = new TApplicationException(TApplicationException.INTERNAL_ERROR, &quot;Internal error processing [method name here: &quot; + th.getMessage());&lt;/p&gt;

&lt;p&gt;It&apos;s a simple change and I think it would give the client a lot of useful information without breaking any exception models.  It&apos;s just a log message, after all &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12868323" author="dreiss" created="Mon, 17 May 2010 18:03:28 +0000"  >&lt;p&gt;I&apos;d be curious to hear what others think of this proposal.  Personally, I think it risks leaking information about the server&apos;s internal implementation that it might want to keep private.&lt;/p&gt;</comment>
                            <comment id="12901047" author="bryanduxbury" created="Sat, 21 Aug 2010 16:35:05 +0000"  >&lt;p&gt;I am against this proposal. I think the current exception model is correct. I would be willing to improve the message of the clientside exception to make it more obvious that you should check your server&apos;s logs, if that would help.&lt;/p&gt;</comment>
                            <comment id="12901408" author="adrianw" created="Mon, 23 Aug 2010 14:11:16 +0000"  >&lt;p&gt;I personally would like to get more detailed error messages on the client - in setups where thrift clients and servers are written by different teams of developers it helps each team know where the root cause of an exception is. When the server devs get bug reports it would also help a lot if there was more information than just &quot;tried to read 4 bytes&quot; as this is useless for figuring out what actually went wrong. We now end up writing try/catch throwable blocks in each and every thrift method so we can log the server exception and rethrow it as a checked exception which isn&apos;t exactly elegant but has to be done otherwise we have no idea where errors are occurring. &lt;/p&gt;

&lt;p&gt;If you are against it I would be happy to settle for at least receiving a less cryptic message - the equivalent of an HTTP 500 &quot;something went wrong on the server&quot;.&lt;/p&gt;</comment>
                            <comment id="12925599" author="bryanduxbury" created="Wed, 27 Oct 2010 23:16:31 +0000"  >&lt;p&gt;I committed a micro improvement that at least mentions that the server side might be to blame.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>186702</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 4 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16djb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245325</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>