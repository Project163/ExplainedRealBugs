<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:58:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-895] Thrift compiler does not allow two different enumerations to have the same key name for one of the enum values</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-895</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;As of version 0.4.0 the Thrift compiler no longer allows two different enums to have a key with the same name. It seems that this change was introduced by the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-544&quot; title=&quot;multiple enums with the same key generate invalid code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-544&quot;&gt;&lt;del&gt;THRIFT-544&lt;/del&gt;&lt;/a&gt;. Particularly the patch labeled: thrift-544_prevent_redefining_consts.patch.&lt;/p&gt;

&lt;p&gt;The problem with this patch is that it now blocks this seemingly valid definition.&lt;/p&gt;

&lt;p&gt;enum Foo {&lt;br/&gt;
    A=1,&lt;br/&gt;
    B=2&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;enum Bar {&lt;br/&gt;
    A=1,&lt;br/&gt;
    B=2&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;If I then run the thrift compiler as follows....&lt;/p&gt;

&lt;p&gt;thrift --gen java test.thrift &lt;/p&gt;

&lt;p&gt;It will tell me that: test.thrift:7] Enum A is already defined!&lt;/p&gt;

&lt;p&gt;However, this should be valid and has worked in previous versions of Thrift. I believe this patch (thrift-544_prevent_redefining_consts.patch) should be rolled back.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12473743">THRIFT-895</key>
            <summary>Thrift compiler does not allow two different enumerations to have the same key name for one of the enum values</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dreiss">David Reiss</assignee>
                                    <reporter username="tkinnis">Tony Kinnis</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Sep 2010 23:53:37 +0000</created>
                <updated>Sun, 12 Sep 2010 14:45:18 +0000</updated>
                            <resolved>Sun, 12 Sep 2010 14:45:18 +0000</resolved>
                                    <version>0.4</version>
                                    <fixVersion>0.5</fixVersion>
                                    <component>Compiler (General)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12907830" author="tkinnis" created="Thu, 9 Sep 2010 23:55:50 +0000"  >&lt;p&gt;Here is a thrift file that demonstrates the issue.&lt;/p&gt;</comment>
                            <comment id="12907844" author="bryanduxbury" created="Fri, 10 Sep 2010 00:40:47 +0000"  >&lt;p&gt;I&apos;ll try to have a look.&lt;/p&gt;</comment>
                            <comment id="12907860" author="dreiss" created="Fri, 10 Sep 2010 01:50:21 +0000"  >&lt;p&gt;This generated illegal code in both C++ and Erlang, which is why it was disabled.&lt;/p&gt;</comment>
                            <comment id="12907894" author="tkinnis" created="Fri, 10 Sep 2010 05:42:56 +0000"  >&lt;p&gt;I can see from the comments in the referenced bug that this was an attempt to fix an Erlang issue. In this case I think it would have been better to change those code generators that were misbehaving rather than disabling the feature. The IDL does not specify that this is not allowed. Additionally, this was allowed in previous versions of Thrift and works without issue in other languages. I would consider this to be a fairly serious regression as it would surely break anyone who tried to upgrade to 0.4 that was making use of enumerations that had the same key names. I believe requiring an enum value to be globally unique is less than ideal and I hope others agree. &lt;/p&gt;

&lt;p&gt;From the looks of things it appears that Bryan is targeting this fix for 0.5. Does anyone have an estimate as to when 0.5 will ship, or could the fix be put into a patch release (0.4.x)?&lt;/p&gt;</comment>
                            <comment id="12908037" author="bryanduxbury" created="Fri, 10 Sep 2010 14:33:24 +0000"  >&lt;p&gt;I agree that this should be legal. Is there something about Erlang and C++ that fundamentally prevents two different enums from having members with the same name?&lt;/p&gt;</comment>
                            <comment id="12908052" author="lowekamp" created="Fri, 10 Sep 2010 15:22:06 +0000"  >&lt;p&gt;in C++ enum keys are scoped at the same level as the enum.  so, yes&lt;/p&gt;

&lt;p&gt;enum Foo &lt;/p&gt;
{ A=1, B=2 }&lt;br/&gt;
&lt;br/&gt;
enum Bar { A=1, B=2 }

&lt;p&gt;is not legal in C++. &lt;/p&gt;

&lt;p&gt;To get something like that, you could wrap them in an enclosing class:&lt;/p&gt;

&lt;p&gt;class Foo {&lt;br/&gt;
public: enum &lt;/p&gt;
{A=1,B=2}
&lt;p&gt;;&lt;br/&gt;
};&lt;/p&gt;

&lt;p&gt;class Bar {&lt;br/&gt;
public: enum &lt;/p&gt;
{A=1, B=2}
&lt;p&gt;;&lt;br/&gt;
};&lt;/p&gt;

&lt;p&gt;now you have to reference them explicitly as Foo::A and Bar::A&lt;/p&gt;

&lt;p&gt;which would require any C++ code that used enums to be updated to refer to classnames, but I think that&apos;s the best way to support enums in the same scope having the same keys.&lt;/p&gt;</comment>
                            <comment id="12908054" author="lowekamp" created="Fri, 10 Sep 2010 15:26:56 +0000"  >&lt;p&gt;For Erlang, again, it could be fixed, but the code right now generates:&lt;/p&gt;

&lt;p&gt;-define&lt;/p&gt;
{&amp;lt;service&amp;gt;_&amp;lt;key&amp;gt;,1}

&lt;p&gt;for each key.  so it would be simple to change it to&lt;/p&gt;

&lt;p&gt;-define&lt;/p&gt;
{&amp;lt;service&amp;gt;_&amp;lt;enum_name&amp;gt;_&amp;lt;key&amp;gt;, 1}

&lt;p&gt;to get rid of the conflict, but all referencing code would have to change.&lt;/p&gt;</comment>
                            <comment id="12908064" author="dreiss" created="Fri, 10 Sep 2010 16:05:41 +0000"  >&lt;p&gt;I think Bruce explained the problem well.&lt;/p&gt;

&lt;p&gt;However, in the C++ example, the enum types no longer have names.  With the current code, a value from the Foo enum has type Foo.&lt;/p&gt;</comment>
                            <comment id="12908073" author="bryanduxbury" created="Fri, 10 Sep 2010 16:19:56 +0000"  >&lt;p&gt;I&apos;m sure that changing their code references would be an acceptable cost to those that are actually encountering this problem right now. &lt;/p&gt;</comment>
                            <comment id="12908079" author="djnym" created="Fri, 10 Sep 2010 16:30:40 +0000"  >&lt;p&gt;Since 0.5 contains the big erlang refactor, people using it will have to change their code slightly anyway (at least they have to change their client code, since the way to create and manage a client changed).  So changing enums at this point is probably okay.  We probably just want to make sure these sorts of changes are called out in release notes for 0.5.&lt;/p&gt;</comment>
                            <comment id="12908086" author="bryanduxbury" created="Fri, 10 Sep 2010 16:51:51 +0000"  >&lt;p&gt;Spoke with David in IRC. We can make an acceptable C++ enum solution that looks like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;enum&lt;/span&gt; type {A=1, B=2};
};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then, you can reference the enum type via Foo::type and the enum values via Foo::A and Foo::B. This means the only thing that users will need to change is the reference from Foo to Foo::type.&lt;/p&gt;

&lt;p&gt;The Erlang stuff can be fixed as was already proposed.&lt;/p&gt;

&lt;p&gt;More generally, this means that we&apos;ll be specifying clearly that we support this kind of functionality. That is, our enums will be more Java-like than C-like.&lt;/p&gt;

&lt;p&gt;David is going to work up a patch.&lt;/p&gt;</comment>
                            <comment id="12908094" author="lowekamp" created="Fri, 10 Sep 2010 17:07:39 +0000"  >&lt;p&gt;I think that&apos;s the right way to handle that.  I think making the change makes sense.&lt;/p&gt;</comment>
                            <comment id="12908247" author="bryanduxbury" created="Sat, 11 Sep 2010 00:09:51 +0000"  >&lt;p&gt;I think we&apos;ll get the desired effect out of doing the right thing on &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-897&quot; title=&quot;Don&amp;#39;t allow unqualified constant access to enum values&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-897&quot;&gt;&lt;del&gt;THRIFT-897&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12908478" author="bryanduxbury" created="Sun, 12 Sep 2010 14:45:18 +0000"  >&lt;p&gt;Fixed by the attached patch and &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-897&quot; title=&quot;Don&amp;#39;t allow unqualified constant access to enum values&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-897&quot;&gt;&lt;del&gt;THRIFT-897&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12473841">THRIFT-897</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12454313" name="ASF.LICENSE.NOT.GRANTED--v1-0001-THRIFT-895.-cpp-By-default-generate-enums-as-class-s.patch" size="3377" author="dreiss" created="Fri, 10 Sep 2010 17:21:39 +0000"/>
                            <attachment id="12454255" name="test.thrift" size="60" author="tkinnis" created="Thu, 9 Sep 2010 23:55:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>187033</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 11 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16dtb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245370</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>