<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:28:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-3118] Python MemoryError in THttpClient when using an SSL endpoint</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-3118</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;When using the Python Thrift HTTP client, a MemoryError is raised by the underlying socket when using SSL:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;File &quot;/path/to/local/lib/python2.7/site-packages/thrift/transport/THttpClient.py&quot;, line 116, in read
  return self.__http.file.read(sz)
File &quot;/usr/lib/python2.7/socket.py&quot;, line 380, in read
  data = self._sock.recv(left)
File &quot;/usr/lib/python2.7/ssl.py&quot;, line 241, in recv
  return self.read(buflen)
File &quot;/usr/lib/python2.7/ssl.py&quot;, line 160, in read
  return self._sslobj.read(len)
MemoryError
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12825477">THRIFT-3118</key>
            <summary>Python MemoryError in THttpClient when using an SSL endpoint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="jking3">James E. King III</assignee>
                                    <reporter username="jbq">Jean-Baptiste Quenot</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Apr 2015 10:22:02 +0000</created>
                <updated>Thu, 27 Dec 2018 15:24:52 +0000</updated>
                            <resolved>Fri, 6 Apr 2018 12:39:15 +0000</resolved>
                                    <version>0.9</version>
                                    <fixVersion>0.12.0</fixVersion>
                                    <component>Python - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14516777" author="githubbot" created="Tue, 28 Apr 2015 10:26:19 +0000"  >&lt;p&gt;GitHub user jbq opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/467&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/467&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Work around &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3118&quot; title=&quot;Python MemoryError in THttpClient when using an SSL endpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3118&quot;&gt;&lt;del&gt;THRIFT-3118&lt;/del&gt;&lt;/a&gt; MemoryError when using an SSL endpoint&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jbq/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jbq/thrift&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3118&quot; title=&quot;Python MemoryError in THttpClient when using an SSL endpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3118&quot;&gt;&lt;del&gt;THRIFT-3118&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/467.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/467.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #467&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 942cb2f88786f6b53bf55ccb42fcf1cb0c410b8b&lt;br/&gt;
Author: Jean-Baptiste Quenot &amp;lt;jbq@caraldi.com&amp;gt;&lt;br/&gt;
Date:   2014-10-06T08:36:39Z&lt;/p&gt;

&lt;p&gt;    Work around MemoryError when using an SSL endpoint&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15957350" author="jking3" created="Wed, 5 Apr 2017 18:10:13 +0000"  >&lt;p&gt;The code in the py implementation has changed significantly since this issue was created, and may no longer be relevant.  file.read is no longer used, so I would suggest this issue is not reproducible any longer.  Thoughts?  If so, the pull request can be closed.&lt;/p&gt;</comment>
                            <comment id="15957375" author="githubbot" created="Wed, 5 Apr 2017 18:21:21 +0000"  >&lt;p&gt;Github user jfarrell closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/467&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/467&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16411966" author="jking3" created="Fri, 23 Mar 2018 19:58:29 +0000"  >&lt;p&gt;Was going to close this out but I see that we don&apos;t test &quot;http&quot; transport in the cross test, so I am going to add it.&#160; As for the actual fix here, I think more information is needed such as what was the &quot;sz&quot; in question; what exact version of Python was in use?&#160; I see it was a 2.7.x.&#160; I would have expected Python to return a smaller data buffer if there isn&apos;t enough memory available for the whole buffer...&lt;/p&gt;</comment>
                            <comment id="16412115" author="jking3" created="Fri, 23 Mar 2018 21:33:29 +0000"  >&lt;p&gt;I have http working, but https is another story.&#160; Looks like we need to teach THttpClient how to work with certificates.&lt;/p&gt;</comment>
                            <comment id="16427869" author="githubbot" created="Fri, 6 Apr 2018 02:53:31 +0000"  >&lt;p&gt;jeking3 opened a new pull request #1533: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3118&quot; title=&quot;Python MemoryError in THttpClient when using an SSL endpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3118&quot;&gt;&lt;del&gt;THRIFT-3118&lt;/del&gt;&lt;/a&gt;: add http and https cross test support for python&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1533&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1533&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Also disable haskell on windows as it is breaking CI builds (&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4545&quot; title=&quot;Appveyor builds are failing due to a haskell / cabal update in chocolatey&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4545&quot;&gt;&lt;del&gt;THRIFT-4545&lt;/del&gt;&lt;/a&gt; remediation).&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16428227" author="githubbot" created="Fri, 6 Apr 2018 11:40:00 +0000"  >&lt;p&gt;jeking3 closed pull request #1533: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3118&quot; title=&quot;Python MemoryError in THttpClient when using an SSL endpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3118&quot;&gt;&lt;del&gt;THRIFT-3118&lt;/del&gt;&lt;/a&gt;: add http and https cross test support for python&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1533&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1533&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/build/appveyor/MSVC-appveyor-build.bat b/build/appveyor/MSVC-appveyor-build.bat&lt;br/&gt;
index a4b92a29cd..31aac57c99 100644&lt;br/&gt;
&amp;#8212; a/build/appveyor/MSVC-appveyor-build.bat&lt;br/&gt;
+++ b/build/appveyor/MSVC-appveyor-build.bat&lt;br/&gt;
@@ -21,6 +21,8 @@ CALL cl_setenv.bat                          || EXIT /B&lt;br/&gt;
 MKDIR &quot;%BUILDDIR%&quot;                          || EXIT /B&lt;br/&gt;
 CD &quot;%BUILDDIR%&quot;                             || EXIT /B&lt;/p&gt;

&lt;p&gt;+:: Haskell is disabled for cmake (Windows), see Jira &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4545&quot; title=&quot;Appveyor builds are failing due to a haskell / cabal update in chocolatey&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4545&quot;&gt;&lt;del&gt;THRIFT-4545&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
+&lt;br/&gt;
 @ECHO ON&lt;br/&gt;
   cmake &quot;%SRCDIR%&quot; ^&lt;br/&gt;
     -G&quot;%GENERATOR%&quot; ^&lt;br/&gt;
@@ -36,6 +38,7 @@ CD &quot;%BUILDDIR%&quot;                             || EXIT /B&lt;br/&gt;
     -DOPENSSL_USE_STATIC_LIBS=OFF ^&lt;br/&gt;
     -DZLIB_LIBRARY=&quot;%WIN3P%\zlib-inst\lib\zlib%ZLIB_LIB_SUFFIX%.lib&quot; ^&lt;br/&gt;
     -DZLIB_ROOT=&quot;%WIN3P%\zlib-inst&quot; ^&lt;br/&gt;
+    -DWITH_HASKELL=OFF ^&lt;br/&gt;
     -DWITH_PYTHON=%WITH_PYTHON% ^&lt;br/&gt;
     -DWITH_%THREADMODEL%THREADS=ON ^&lt;br/&gt;
     -DWITH_SHARED_LIB=OFF ^&lt;br/&gt;
diff --git a/build/appveyor/MSVC-appveyor-install.bat b/build/appveyor/MSVC-appveyor-install.bat&lt;br/&gt;
index 95008bd523..f9eb0c67da 100644&lt;br/&gt;
&amp;#8212; a/build/appveyor/MSVC-appveyor-install.bat&lt;br/&gt;
+++ b/build/appveyor/MSVC-appveyor-install.bat&lt;br/&gt;
@@ -56,5 +56,5 @@ pip.exe ^&lt;br/&gt;
             tornado ^&lt;br/&gt;
             twisted                       || EXIT /B&lt;/p&gt;

&lt;p&gt;-:: Haskell (GHC) and cabal&lt;br/&gt;
-cinst -c &quot;%BUILDCACHE%&quot; -y ghc            || EXIT /B&lt;br/&gt;
+:: Haskell (GHC) and cabal (disabled: see Jira &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4545&quot; title=&quot;Appveyor builds are failing due to a haskell / cabal update in chocolatey&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4545&quot;&gt;&lt;del&gt;THRIFT-4545&lt;/del&gt;&lt;/a&gt;)&lt;br/&gt;
+:: cinst -c &quot;%BUILDCACHE%&quot; -y ghc            || EXIT /B&lt;br/&gt;
diff --git a/build/docker/scripts/sca.sh b/build/docker/scripts/sca.sh&lt;br/&gt;
index f17f7035dc..f26ce9556d 100755&lt;br/&gt;
&amp;#8212; a/build/docker/scripts/sca.sh&lt;br/&gt;
+++ b/build/docker/scripts/sca.sh&lt;br/&gt;
@@ -39,10 +39,10 @@ cppcheck --force --quiet --inline-suppr --error-exitcode=1 -j2 lib/cpp/src lib/c&lt;br/&gt;
 cppcheck --force --quiet --inline-suppr --error-exitcode=1 -j2 lib/c_glib/src lib/c_glib/test test/c_glib/src tutorial/c_glib&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Python code style&lt;br/&gt;
-flake8 --ignore=E501 lib/py&lt;br/&gt;
-flake8 tutorial/py&lt;br/&gt;
+flake8 --ignore=E501 --exclude=lib/py/build lib/py&lt;br/&gt;
+flake8 --exclude=tutorial/py/build tutorial/py&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4371&quot; title=&quot;cppcheck, flake8 detecting issues in generated code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4371&quot;&gt;THRIFT-4371&lt;/a&gt; : generated files are excluded because they haven&apos;t been scrubbed yet&lt;br/&gt;
-flake8 --ignore=E501 --exclude=&quot;&lt;b&gt;/gen-py&lt;/b&gt;/*&quot; test/py&lt;br/&gt;
+flake8 --ignore=E501 --exclude=&quot;&lt;b&gt;/gen-py&lt;/b&gt;/*&quot;,test/py/build test/py&lt;br/&gt;
 flake8 test/py.twisted&lt;br/&gt;
 flake8 test/py.tornado&lt;br/&gt;
 flake8 --ignore=E501 test/test.py&lt;br/&gt;
diff --git a/lib/py/src/server/THttpServer.py b/lib/py/src/server/THttpServer.py&lt;br/&gt;
index 1b501a7aa5..85cf4005ea 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/lib/py/src/server/THttpServer.py&lt;br/&gt;
+++ b/lib/py/src/server/THttpServer.py&lt;br/&gt;
@@ -17,6 +17,8 @@&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;under the License.&lt;br/&gt;
 #&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;+import ssl&lt;br/&gt;
+&lt;br/&gt;
 from six.moves import BaseHTTPServer&lt;/p&gt;

&lt;p&gt; from thrift.server import TServer&lt;br/&gt;
@@ -47,11 +49,17 @@ def _&lt;em&gt;init&lt;/em&gt;_(self,&lt;br/&gt;
                  server_address,&lt;br/&gt;
                  inputProtocolFactory,&lt;br/&gt;
                  outputProtocolFactory=None,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;server_class=BaseHTTPServer.HTTPServer):&lt;/li&gt;
	&lt;li&gt;&quot;&quot;&quot;Set up protocol factories and HTTP server.&lt;br/&gt;
+                 server_class=BaseHTTPServer.HTTPServer,&lt;br/&gt;
+                 **kwargs):&lt;br/&gt;
+        &quot;&quot;&quot;Set up protocol factories and HTTP (or HTTPS) server.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         See BaseHTTPServer for server_address.&lt;br/&gt;
         See TServer for protocol factories.&lt;br/&gt;
+&lt;br/&gt;
+        To make a secure server, provide the named arguments:&lt;br/&gt;
+        * cafile    - to validate clients &lt;span class=&quot;error&quot;&gt;&amp;#91;optional&amp;#93;&lt;/span&gt;&lt;br/&gt;
+        * cert_file - the server cert&lt;br/&gt;
+        * key_file  - the server&apos;s key&lt;br/&gt;
         &quot;&quot;&quot;&lt;br/&gt;
         if outputProtocolFactory is None:&lt;br/&gt;
             outputProtocolFactory = inputProtocolFactory&lt;br/&gt;
@@ -83,5 +91,16 @@ def do_POST(self):&lt;/p&gt;

&lt;p&gt;         self.httpd = server_class(server_address, RequestHander)&lt;/p&gt;

&lt;p&gt;+        if (kwargs.get(&apos;cafile&apos;) or kwargs.get(&apos;cert_file&apos;) or kwargs.get(&apos;key_file&apos;)):&lt;br/&gt;
+            context = ssl.create_default_context(cafile=kwargs.get(&apos;cafile&apos;))&lt;br/&gt;
+            context.check_hostname = False&lt;br/&gt;
+            context.load_cert_chain(kwargs.get(&apos;cert_file&apos;), kwargs.get(&apos;key_file&apos;))&lt;br/&gt;
+            context.verify_mode = ssl.CERT_REQUIRED if kwargs.get(&apos;cafile&apos;) else ssl.CERT_NONE&lt;br/&gt;
+            self.httpd.socket = context.wrap_socket(self.httpd.socket, server_side=True)&lt;br/&gt;
+&lt;br/&gt;
     def serve(self):&lt;br/&gt;
         self.httpd.serve_forever()&lt;br/&gt;
+&lt;br/&gt;
+    def shutdown(self):&lt;br/&gt;
+        self.httpd.socket.close()&lt;br/&gt;
+        # self.httpd.shutdown() # hangs forever, python doesn&apos;t handle POLLNVAL properly!&lt;br/&gt;
diff --git a/lib/py/src/transport/THttpClient.py b/lib/py/src/transport/THttpClient.py&lt;br/&gt;
index fb33421d75..60ff226a90 100644&lt;br/&gt;
&amp;#8212; a/lib/py/src/transport/THttpClient.py&lt;br/&gt;
+++ b/lib/py/src/transport/THttpClient.py&lt;br/&gt;
@@ -20,6 +20,7 @@&lt;br/&gt;
 from io import BytesIO&lt;br/&gt;
 import os&lt;br/&gt;
 import socket&lt;br/&gt;
+import ssl&lt;br/&gt;
 import sys&lt;br/&gt;
 import warnings&lt;br/&gt;
 import base64&lt;br/&gt;
@@ -34,17 +35,20 @@&lt;br/&gt;
 class THttpClient(TTransportBase):&lt;br/&gt;
     &quot;&quot;&quot;Http implementation of TTransport base.&quot;&quot;&quot;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;def _&lt;em&gt;init&lt;/em&gt;_(self, uri_or_host, port=None, path=None):&lt;/li&gt;
	&lt;li&gt;&quot;&quot;&quot;THttpClient supports two different types constructor parameters.&lt;br/&gt;
+    def _&lt;em&gt;init&lt;/em&gt;_(self, uri_or_host, port=None, path=None, cafile=None, cert_file=None, key_file=None, ssl_context=None):&lt;br/&gt;
+        &quot;&quot;&quot;THttpClient supports two different types of construction:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         THttpClient(host, port, path) - deprecated&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;THttpClient(uri)&lt;br/&gt;
+        THttpClient(uri, &lt;span class=&quot;error&quot;&gt;&amp;#91;port=&amp;lt;n&amp;gt;, path=&amp;lt;s&amp;gt;, cafile=&amp;lt;filename&amp;gt;, cert_file=&amp;lt;filename&amp;gt;, key_file=&amp;lt;filename&amp;gt;, ssl_context=&amp;lt;context&amp;gt;&amp;#93;&lt;/span&gt;)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Only the second supports https.&lt;br/&gt;
+        Only the second supports https.  To properly authenticate against the server,&lt;br/&gt;
+        provide the client&apos;s identity by specifying cert_file and key_file.  To properly&lt;br/&gt;
+        authenticate the server, specify either cafile or ssl_context with a CA defined.&lt;br/&gt;
+        NOTE: if both cafile and ssl_context are defined, ssl_context will override cafile.&lt;br/&gt;
         &quot;&quot;&quot;&lt;br/&gt;
         if port is not None:&lt;br/&gt;
             warnings.warn(&lt;/li&gt;
	&lt;li&gt;&quot;Please use the THttpClient(&apos;http://host:port/path&apos;) syntax&quot;,&lt;br/&gt;
+                &quot;Please use the THttpClient(&apos;http
{s}
&lt;p&gt;://host:port/path&apos;) constructor&quot;,&lt;br/&gt;
                 DeprecationWarning,&lt;br/&gt;
                 stacklevel=2)&lt;br/&gt;
             self.host = uri_or_host&lt;br/&gt;
@@ -60,6 +64,9 @@ def _&lt;em&gt;init&lt;/em&gt;_(self, uri_or_host, port=None, path=None):&lt;br/&gt;
                 self.port = parsed.port or http_client.HTTP_PORT&lt;br/&gt;
             elif self.scheme == &apos;https&apos;:&lt;br/&gt;
                 self.port = parsed.port or http_client.HTTPS_PORT&lt;br/&gt;
+                self.certfile = cert_file&lt;br/&gt;
+                self.keyfile = key_file&lt;br/&gt;
+                self.context = ssl.create_default_context(cafile=cafile) if (cafile and not ssl_context) else ssl_context&lt;br/&gt;
             self.host = parsed.hostname&lt;br/&gt;
             self.path = parsed.path&lt;br/&gt;
             if parsed.query:&lt;br/&gt;
@@ -100,12 +107,17 @@ def using_proxy(self):&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     def open(self):&lt;br/&gt;
         if self.scheme == &apos;http&apos;:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;self.__http = http_client.HTTPConnection(self.host, self.port)&lt;br/&gt;
+            self.__http = http_client.HTTPConnection(self.host, self.port,&lt;br/&gt;
+                                                     timeout=self.__timeout)&lt;br/&gt;
         elif self.scheme == &apos;https&apos;:&lt;/li&gt;
	&lt;li&gt;self.__http = http_client.HTTPSConnection(self.host, self.port)&lt;/li&gt;
	&lt;li&gt;if self.using_proxy():&lt;/li&gt;
	&lt;li&gt;self.__http.set_tunnel(self.realhost, self.realport,&lt;/li&gt;
	&lt;li&gt;{&quot;Proxy-Authorization&quot;: self.proxy_auth}
&lt;p&gt;)&lt;br/&gt;
+            self.__http = http_client.HTTPSConnection(self.host, self.port,&lt;br/&gt;
+                                                      key_file=self.keyfile,&lt;br/&gt;
+                                                      cert_file=self.certfile,&lt;br/&gt;
+                                                      timeout=self.__timeout,&lt;br/&gt;
+                                                      context=self.context)&lt;br/&gt;
+        if self.using_proxy():&lt;br/&gt;
+            self.__http.set_tunnel(self.realhost, self.realport,&lt;br/&gt;
+                                   &lt;/p&gt;
{&quot;Proxy-Authorization&quot;: self.proxy_auth}
&lt;p&gt;)&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     def close(self):&lt;br/&gt;
         self.__http.close()&lt;br/&gt;
diff --git a/test/crossrunner/run.py b/test/crossrunner/run.py&lt;br/&gt;
index 25c58cef3e..a7bc939ea9 100644&lt;br/&gt;
&amp;#8212; a/test/crossrunner/run.py&lt;br/&gt;
+++ b/test/crossrunner/run.py&lt;br/&gt;
@@ -235,7 +235,7 @@ def ensure_socket_open(sv, port, test):&lt;br/&gt;
                 logger.warn(&apos;&lt;span class=&quot;error&quot;&gt;&amp;#91;%s&amp;#93;&lt;/span&gt;: Detected socket bind failure, retrying...&apos;, test.server.name)&lt;br/&gt;
                 bind_retry_count += 1&lt;br/&gt;
             else:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;result = RESULT_TIMEOUT if cl.expired else cl.returncode if cl.proc.poll() is not None else RESULT_ERROR&lt;br/&gt;
+                result = RESULT_TIMEOUT if cl.expired else cl.returncode if (cl.proc and cl.proc.poll()) is not None else RESULT_ERROR&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;For servers that handle a controlled shutdown by signal&lt;/li&gt;
	&lt;li&gt;if they are killed, or return an error code, that is a&lt;br/&gt;
diff --git a/test/known_failures_Linux.json b/test/known_failures_Linux.json&lt;br/&gt;
index f7676498af..16ede27357 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/test/known_failures_Linux.json&lt;br/&gt;
+++ b/test/known_failures_Linux.json&lt;br/&gt;
@@ -83,6 +83,46 @@&lt;br/&gt;
   &quot;cpp-nodejs_multij-json_http-domain&quot;,&lt;br/&gt;
   &quot;cpp-nodejs_multij-json_http-ip&quot;,&lt;br/&gt;
   &quot;cpp-nodejs_multij-json_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;cpp-py3_binary-accel_http-ip&quot;,&lt;br/&gt;
+  &quot;cpp-py3_binary-accel_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;cpp-py3_binary_http-ip&quot;,&lt;br/&gt;
+  &quot;cpp-py3_binary_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;cpp-py3_compact-accelc_http-ip&quot;,&lt;br/&gt;
+  &quot;cpp-py3_compact-accelc_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;cpp-py3_compact_http-ip&quot;,&lt;br/&gt;
+  &quot;cpp-py3_compact_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;cpp-py3_json_http-ip&quot;,&lt;br/&gt;
+  &quot;cpp-py3_json_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;cpp-py3_multi-accel_http-ip&quot;,&lt;br/&gt;
+  &quot;cpp-py3_multi-accel_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;cpp-py3_multi-binary_http-ip&quot;,&lt;br/&gt;
+  &quot;cpp-py3_multi-binary_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;cpp-py3_multic-accelc_http-ip&quot;,&lt;br/&gt;
+  &quot;cpp-py3_multic-accelc_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;cpp-py3_multic-compact_http-ip&quot;,&lt;br/&gt;
+  &quot;cpp-py3_multic-compact_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;cpp-py3_multij-json_http-ip&quot;,&lt;br/&gt;
+  &quot;cpp-py3_multij-json_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;cpp-py_binary-accel_http-ip&quot;,&lt;br/&gt;
+  &quot;cpp-py_binary-accel_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;cpp-py_binary_http-ip&quot;,&lt;br/&gt;
+  &quot;cpp-py_binary_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;cpp-py_compact-accelc_http-ip&quot;,&lt;br/&gt;
+  &quot;cpp-py_compact-accelc_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;cpp-py_compact_http-ip&quot;,&lt;br/&gt;
+  &quot;cpp-py_compact_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;cpp-py_json_http-ip&quot;,&lt;br/&gt;
+  &quot;cpp-py_json_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;cpp-py_multi-accel_http-ip&quot;,&lt;br/&gt;
+  &quot;cpp-py_multi-accel_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;cpp-py_multi-binary_http-ip&quot;,&lt;br/&gt;
+  &quot;cpp-py_multi-binary_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;cpp-py_multic-accelc_http-ip&quot;,&lt;br/&gt;
+  &quot;cpp-py_multic-accelc_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;cpp-py_multic-compact_http-ip&quot;,&lt;br/&gt;
+  &quot;cpp-py_multic-compact_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;cpp-py_multij-json_http-ip&quot;,&lt;br/&gt;
+  &quot;cpp-py_multij-json_http-ip-ssl&quot;,&lt;br/&gt;
   &quot;cpp-rs_multi_buffered-ip&quot;,&lt;br/&gt;
   &quot;cpp-rs_multi_framed-ip&quot;,&lt;br/&gt;
   &quot;cpp-rs_multic_buffered-ip&quot;,&lt;br/&gt;
@@ -166,42 +206,62 @@&lt;br/&gt;
   &quot;d-py3_binary-accel_buffered-ip-ssl&quot;,&lt;br/&gt;
   &quot;d-py3_binary-accel_framed-ip&quot;,&lt;br/&gt;
   &quot;d-py3_binary-accel_framed-ip-ssl&quot;,&lt;br/&gt;
+  &quot;d-py3_binary-accel_http-ip&quot;,&lt;br/&gt;
+  &quot;d-py3_binary-accel_http-ip-ssl&quot;,&lt;br/&gt;
   &quot;d-py3_binary_buffered-ip&quot;,&lt;br/&gt;
   &quot;d-py3_binary_buffered-ip-ssl&quot;,&lt;br/&gt;
   &quot;d-py3_binary_framed-ip&quot;,&lt;br/&gt;
   &quot;d-py3_binary_framed-ip-ssl&quot;,&lt;br/&gt;
+  &quot;d-py3_binary_http-ip&quot;,&lt;br/&gt;
+  &quot;d-py3_binary_http-ip-ssl&quot;,&lt;br/&gt;
   &quot;d-py3_compact-accelc_buffered-ip&quot;,&lt;br/&gt;
   &quot;d-py3_compact-accelc_buffered-ip-ssl&quot;,&lt;br/&gt;
   &quot;d-py3_compact-accelc_framed-ip&quot;,&lt;br/&gt;
   &quot;d-py3_compact-accelc_framed-ip-ssl&quot;,&lt;br/&gt;
+  &quot;d-py3_compact-accelc_http-ip&quot;,&lt;br/&gt;
+  &quot;d-py3_compact-accelc_http-ip-ssl&quot;,&lt;br/&gt;
   &quot;d-py3_compact_buffered-ip&quot;,&lt;br/&gt;
   &quot;d-py3_compact_buffered-ip-ssl&quot;,&lt;br/&gt;
   &quot;d-py3_compact_framed-ip&quot;,&lt;br/&gt;
   &quot;d-py3_compact_framed-ip-ssl&quot;,&lt;br/&gt;
+  &quot;d-py3_compact_http-ip&quot;,&lt;br/&gt;
+  &quot;d-py3_compact_http-ip-ssl&quot;,&lt;br/&gt;
   &quot;d-py3_json_buffered-ip&quot;,&lt;br/&gt;
   &quot;d-py3_json_buffered-ip-ssl&quot;,&lt;br/&gt;
   &quot;d-py3_json_framed-ip&quot;,&lt;br/&gt;
   &quot;d-py3_json_framed-ip-ssl&quot;,&lt;br/&gt;
+  &quot;d-py3_json_http-ip&quot;,&lt;br/&gt;
+  &quot;d-py3_json_http-ip-ssl&quot;,&lt;br/&gt;
   &quot;d-py_binary-accel_buffered-ip&quot;,&lt;br/&gt;
   &quot;d-py_binary-accel_buffered-ip-ssl&quot;,&lt;br/&gt;
   &quot;d-py_binary-accel_framed-ip&quot;,&lt;br/&gt;
   &quot;d-py_binary-accel_framed-ip-ssl&quot;,&lt;br/&gt;
+  &quot;d-py_binary-accel_http-ip&quot;,&lt;br/&gt;
+  &quot;d-py_binary-accel_http-ip-ssl&quot;,&lt;br/&gt;
   &quot;d-py_binary_buffered-ip&quot;,&lt;br/&gt;
   &quot;d-py_binary_buffered-ip-ssl&quot;,&lt;br/&gt;
   &quot;d-py_binary_framed-ip&quot;,&lt;br/&gt;
   &quot;d-py_binary_framed-ip-ssl&quot;,&lt;br/&gt;
+  &quot;d-py_binary_http-ip&quot;,&lt;br/&gt;
+  &quot;d-py_binary_http-ip-ssl&quot;,&lt;br/&gt;
   &quot;d-py_compact-accelc_buffered-ip&quot;,&lt;br/&gt;
   &quot;d-py_compact-accelc_buffered-ip-ssl&quot;,&lt;br/&gt;
   &quot;d-py_compact-accelc_framed-ip&quot;,&lt;br/&gt;
   &quot;d-py_compact-accelc_framed-ip-ssl&quot;,&lt;br/&gt;
+  &quot;d-py_compact-accelc_http-ip&quot;,&lt;br/&gt;
+  &quot;d-py_compact-accelc_http-ip-ssl&quot;,&lt;br/&gt;
   &quot;d-py_compact_buffered-ip&quot;,&lt;br/&gt;
   &quot;d-py_compact_buffered-ip-ssl&quot;,&lt;br/&gt;
   &quot;d-py_compact_framed-ip&quot;,&lt;br/&gt;
   &quot;d-py_compact_framed-ip-ssl&quot;,&lt;br/&gt;
+  &quot;d-py_compact_http-ip&quot;,&lt;br/&gt;
+  &quot;d-py_compact_http-ip-ssl&quot;,&lt;br/&gt;
   &quot;d-py_json_buffered-ip&quot;,&lt;br/&gt;
   &quot;d-py_json_buffered-ip-ssl&quot;,&lt;br/&gt;
   &quot;d-py_json_framed-ip&quot;,&lt;br/&gt;
   &quot;d-py_json_framed-ip-ssl&quot;,&lt;br/&gt;
+  &quot;d-py_json_http-ip&quot;,&lt;br/&gt;
+  &quot;d-py_json_http-ip-ssl&quot;,&lt;br/&gt;
   &quot;erl-cpp_binary_buffered-ip&quot;,&lt;br/&gt;
   &quot;erl-cpp_compact_buffered-ip&quot;,&lt;br/&gt;
   &quot;erl-csharp_binary_buffered-ip&quot;,&lt;br/&gt;
@@ -302,8 +362,118 @@&lt;br/&gt;
   &quot;nodejs-netcore_json_buffered-ip-ssl&quot;,&lt;br/&gt;
   &quot;nodejs-netcore_json_framed-ip&quot;,&lt;br/&gt;
   &quot;nodejs-netcore_json_framed-ip-ssl&quot;,&lt;br/&gt;
+  &quot;nodejs-py3_binary-accel_http-ip&quot;,&lt;br/&gt;
+  &quot;nodejs-py3_binary-accel_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;nodejs-py3_binary_http-ip&quot;,&lt;br/&gt;
+  &quot;nodejs-py3_binary_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;nodejs-py3_compact-accelc_http-ip&quot;,&lt;br/&gt;
+  &quot;nodejs-py3_compact-accelc_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;nodejs-py3_compact_http-ip&quot;,&lt;br/&gt;
+  &quot;nodejs-py3_compact_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;nodejs-py3_json_http-ip&quot;,&lt;br/&gt;
+  &quot;nodejs-py3_json_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;nodejs-py_binary-accel_http-ip&quot;,&lt;br/&gt;
+  &quot;nodejs-py_binary-accel_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;nodejs-py_binary_http-ip&quot;,&lt;br/&gt;
+  &quot;nodejs-py_binary_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;nodejs-py_compact-accelc_http-ip&quot;,&lt;br/&gt;
+  &quot;nodejs-py_compact-accelc_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;nodejs-py_compact_http-ip&quot;,&lt;br/&gt;
+  &quot;nodejs-py_compact_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;nodejs-py_json_http-ip&quot;,&lt;br/&gt;
+  &quot;nodejs-py_json_http-ip-ssl&quot;,&lt;br/&gt;
   &quot;perl-rs_multi_buffered-ip&quot;,&lt;br/&gt;
   &quot;perl-rs_multi_framed-ip&quot;,&lt;br/&gt;
+  &quot;py-cpp_accel-binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py-cpp_accel-binary_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py-cpp_accelc-compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py-cpp_accelc-compact_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py-cpp_binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py-cpp_binary_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py-cpp_compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py-cpp_compact_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py-cpp_json_http-ip&quot;,&lt;br/&gt;
+  &quot;py-cpp_json_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py-d_accel-binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py-d_accel-binary_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py-d_accelc-compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py-d_accelc-compact_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py-d_binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py-d_binary_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py-d_compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py-d_compact_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py-d_json_http-ip&quot;,&lt;br/&gt;
+  &quot;py-d_json_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py-dart_accel-binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py-dart_accelc-compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py-dart_binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py-dart_compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py-dart_json_http-ip&quot;,&lt;br/&gt;
+  &quot;py-hs_accel-binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py-hs_accelc-compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py-hs_binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py-hs_compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py-hs_json_http-ip&quot;,&lt;br/&gt;
+  &quot;py-java_accel-binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py-java_accel-binary_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py-java_accelc-compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py-java_accelc-compact_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py-java_binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py-java_binary_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py-java_compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py-java_compact_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py-java_json_http-ip&quot;,&lt;br/&gt;
+  &quot;py-java_json_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py-lua_accel-binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py-lua_accelc-compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py-lua_binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py-lua_compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py-lua_json_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-cpp_accel-binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-cpp_accel-binary_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py3-cpp_accelc-compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-cpp_accelc-compact_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py3-cpp_binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-cpp_binary_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py3-cpp_compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-cpp_compact_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py3-cpp_json_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-cpp_json_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py3-d_accel-binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-d_accel-binary_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py3-d_accelc-compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-d_accelc-compact_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py3-d_binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-d_binary_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py3-d_compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-d_compact_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py3-d_json_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-d_json_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py3-dart_accel-binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-dart_accelc-compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-dart_binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-dart_compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-dart_json_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-hs_accel-binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-hs_accelc-compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-hs_binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-hs_compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-hs_json_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-java_accel-binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-java_accel-binary_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py3-java_accelc-compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-java_accelc-compact_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py3-java_binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-java_binary_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py3-java_compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-java_compact_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py3-java_json_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-java_json_http-ip-ssl&quot;,&lt;br/&gt;
+  &quot;py3-lua_accel-binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-lua_accelc-compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-lua_binary_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-lua_compact_http-ip&quot;,&lt;br/&gt;
+  &quot;py3-lua_json_http-ip&quot;,&lt;br/&gt;
   &quot;rb-cpp_json_buffered-domain&quot;,&lt;br/&gt;
   &quot;rb-cpp_json_buffered-ip&quot;,&lt;br/&gt;
   &quot;rb-cpp_json_buffered-ip-ssl&quot;,&lt;br/&gt;
@@ -322,4 +492,4 @@&lt;br/&gt;
   &quot;rs-cpp_multic-compact_framed-ip&quot;,&lt;br/&gt;
   &quot;rs-cpp_multic_buffered-ip&quot;,&lt;br/&gt;
   &quot;rs-cpp_multic_framed-ip&quot;&lt;br/&gt;
-]&lt;br/&gt;
+]&lt;br/&gt;
\ No newline at end of file&lt;br/&gt;
diff --git a/test/py/TestClient.py b/test/py/TestClient.py&lt;br/&gt;
index 1ab8e78aed..edab610b15 100755&lt;/li&gt;
			&lt;li&gt;a/test/py/TestClient.py&lt;br/&gt;
+++ b/test/py/TestClient.py&lt;br/&gt;
@@ -32,8 +32,18 @@&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt; class AbstractTest(unittest.TestCase):&lt;br/&gt;
     def setUp(self):&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if options.http_path:&lt;/li&gt;
	&lt;li&gt;self.transport = THttpClient.THttpClient(options.host, port=options.port, path=options.http_path)&lt;br/&gt;
+        if options.trans == &apos;http&apos;:&lt;br/&gt;
+            uri = &apos;
{0}
&lt;p&gt;://&lt;/p&gt;
{1}
&lt;p&gt;:&lt;/p&gt;
{2}
{3}
&lt;p&gt;&apos;.format((&apos;https&apos; if options.ssl else &apos;http&apos;),&lt;br/&gt;
+                                            options.host,&lt;br/&gt;
+                                            options.port,&lt;br/&gt;
+                                            (options.http_path if options.http_path else &apos;/&apos;))&lt;br/&gt;
+            if options.ssl:&lt;br/&gt;
+                __cafile = os.path.join(os.path.dirname(SCRIPT_DIR), &quot;keys&quot;, &quot;CA.pem&quot;)&lt;br/&gt;
+                __certfile = os.path.join(os.path.dirname(SCRIPT_DIR), &quot;keys&quot;, &quot;client.crt&quot;)&lt;br/&gt;
+                __keyfile = os.path.join(os.path.dirname(SCRIPT_DIR), &quot;keys&quot;, &quot;client.key&quot;)&lt;br/&gt;
+                self.transport = THttpClient.THttpClient(uri, cafile=_&lt;em&gt;cafile, cert_file=&lt;/em&gt;&lt;em&gt;certfile, key_file=&lt;/em&gt;_keyfile)&lt;br/&gt;
+            else:&lt;br/&gt;
+                self.transport = THttpClient.THttpClient(uri)&lt;br/&gt;
         else:&lt;br/&gt;
             if options.ssl:&lt;br/&gt;
                 from thrift.transport import TSSLSocket&lt;br/&gt;
@@ -325,9 +335,9 @@ def parseArgs(self, argv):&lt;br/&gt;
                       dest=&quot;verbose&quot;, const=0,&lt;br/&gt;
                       help=&quot;minimal output&quot;)&lt;br/&gt;
     parser.add_option(&apos;--protocol&apos;, dest=&quot;proto&quot;, type=&quot;string&quot;,&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;help=&quot;protocol to use, one of: accel, binary, compact, json&quot;)&lt;br/&gt;
+                      help=&quot;protocol to use, one of: accel, accelc, binary, compact, json&quot;)&lt;br/&gt;
     parser.add_option(&apos;--transport&apos;, dest=&quot;trans&quot;, type=&quot;string&quot;,&lt;/li&gt;
	&lt;li&gt;help=&quot;transport to use, one of: buffered, framed&quot;)&lt;br/&gt;
+                      help=&quot;transport to use, one of: buffered, framed, http&quot;)&lt;br/&gt;
     parser.set_defaults(framed=False, http_path=None, verbose=1, host=&apos;localhost&apos;, port=9090, proto=&apos;binary&apos;)&lt;br/&gt;
     options, args = parser.parse_args()&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -335,6 +345,9 @@ def parseArgs(self, argv):&lt;br/&gt;
         sys.path.insert(0, os.path.join(SCRIPT_DIR, options.genpydir))&lt;br/&gt;
     sys.path.insert(0, local_libpath())&lt;/p&gt;

&lt;p&gt;+    if options.http_path:&lt;br/&gt;
+        options.trans = &apos;http&apos;&lt;br/&gt;
+&lt;br/&gt;
     from ThriftTest import ThriftTest&lt;br/&gt;
     from ThriftTest.ttypes import Xtruct, Xtruct2, Numberz, Xception, Xception2&lt;br/&gt;
     from thrift.Thrift import TException&lt;br/&gt;
diff --git a/test/py/TestServer.py b/test/py/TestServer.py&lt;br/&gt;
index 04ad62a955..4dc4c0744e 100755&lt;br/&gt;
&amp;#8212; a/test/py/TestServer.py&lt;br/&gt;
+++ b/test/py/TestServer.py&lt;br/&gt;
@@ -21,6 +21,7 @@&lt;br/&gt;
 from _&lt;em&gt;future&lt;/em&gt;_ import division&lt;br/&gt;
 import logging&lt;br/&gt;
 import os&lt;br/&gt;
+import signal&lt;br/&gt;
 import sys&lt;br/&gt;
 import time&lt;br/&gt;
 from optparse import OptionParser&lt;br/&gt;
@@ -180,11 +181,11 @@ def testMulti(self, arg0, arg1, arg2, arg3, arg4, arg5):&lt;br/&gt;
 def main(options):&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;set up the protocol factory form the --protocol option&lt;br/&gt;
     prot_factories = 
{
-        &apos;binary&apos;: TBinaryProtocol.TBinaryProtocolFactory,
         &apos;accel&apos;: TBinaryProtocol.TBinaryProtocolAcceleratedFactory,
-        &apos;compact&apos;: TCompactProtocol.TCompactProtocolFactory,
         &apos;accelc&apos;: TCompactProtocol.TCompactProtocolAcceleratedFactory,
-        &apos;json&apos;: TJSONProtocol.TJSONProtocolFactory,
+        &apos;binary&apos;: TBinaryProtocol.TBinaryProtocolFactory,
+        &apos;compact&apos;: TCompactProtocol.TCompactProtocolFactory,
+        &apos;json&apos;: TJSONProtocol.TJSONProtocolFactory
     }
&lt;p&gt;     pfactory_cls = prot_factories.get(options.proto, None)&lt;br/&gt;
     if pfactory_cls is None:&lt;br/&gt;
@@ -201,14 +202,23 @@ def main(options):&lt;br/&gt;
     if len(args) &amp;gt; 1:&lt;br/&gt;
         raise AssertionError(&apos;Only one server type may be specified, not multiple types.&apos;)&lt;br/&gt;
     server_type = args&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;&lt;br/&gt;
+    if options.trans == &apos;http&apos;:&lt;br/&gt;
+        server_type = &apos;THttpServer&apos;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;Set up the handler and processor objects&lt;br/&gt;
     handler = TestHandler()&lt;br/&gt;
     processor = ThriftTest.Processor(handler)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;+    global server&lt;br/&gt;
+&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Handle THttpServer as a special case&lt;br/&gt;
     if server_type == &apos;THttpServer&apos;:&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;server = THttpServer.THttpServer(processor, (&apos;&apos;, options.port), pfactory)&lt;br/&gt;
+        if options.ssl:&lt;br/&gt;
+            __certfile = os.path.join(os.path.dirname(SCRIPT_DIR), &quot;keys&quot;, &quot;server.crt&quot;)&lt;br/&gt;
+            __keyfile = os.path.join(os.path.dirname(SCRIPT_DIR), &quot;keys&quot;, &quot;server.key&quot;)&lt;br/&gt;
+            server = THttpServer.THttpServer(processor, (&apos;&apos;, options.port), pfactory, cert_file=_&lt;em&gt;certfile, key_file=&lt;/em&gt;_keyfile)&lt;br/&gt;
+        else:&lt;br/&gt;
+            server = THttpServer.THttpServer(processor, (&apos;&apos;, options.port), pfactory)&lt;br/&gt;
         server.serve()&lt;br/&gt;
         sys.exit(0)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -268,7 +278,15 @@ def clean_shutdown(signum, frame):&lt;br/&gt;
     server.serve()&lt;/p&gt;


&lt;p&gt;+def exit_gracefully(signum, frame):&lt;br/&gt;
+    print(&quot;SIGINT received\n&quot;)&lt;br/&gt;
+    server.shutdown()   # doesn&apos;t work properly, yet&lt;br/&gt;
+    sys.exit(0)&lt;br/&gt;
+&lt;br/&gt;
+&lt;br/&gt;
 if _&lt;em&gt;name&lt;/em&gt;_ == &apos;_&lt;em&gt;main&lt;/em&gt;_&apos;:&lt;br/&gt;
+    signal.signal(signal.SIGINT, exit_gracefully)&lt;br/&gt;
+&lt;br/&gt;
     parser = OptionParser()&lt;br/&gt;
     parser.add_option(&apos;--libpydir&apos;, type=&apos;string&apos;, dest=&apos;libpydir&apos;,&lt;br/&gt;
                       help=&apos;include this directory to sys.path for locating library code&apos;)&lt;br/&gt;
@@ -288,12 +306,12 @@ def clean_shutdown(signum, frame):&lt;br/&gt;
                       dest=&quot;verbose&quot;, const=0,&lt;br/&gt;
                       help=&quot;minimal output&quot;)&lt;br/&gt;
     parser.add_option(&apos;--protocol&apos;, dest=&quot;proto&quot;, type=&quot;string&quot;,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;help=&quot;protocol to use, one of: accel, binary, compact, json&quot;)&lt;br/&gt;
+                      help=&quot;protocol to use, one of: accel, accelc, binary, compact, json&quot;)&lt;br/&gt;
     parser.add_option(&apos;--transport&apos;, dest=&quot;trans&quot;, type=&quot;string&quot;,&lt;/li&gt;
	&lt;li&gt;help=&quot;transport to use, one of: buffered, framed&quot;)&lt;br/&gt;
+                      help=&quot;transport to use, one of: buffered, framed, http&quot;)&lt;br/&gt;
     parser.add_option(&apos;--container-limit&apos;, dest=&apos;container_limit&apos;, type=&apos;int&apos;, default=None)&lt;br/&gt;
     parser.add_option(&apos;--string-limit&apos;, dest=&apos;string_limit&apos;, type=&apos;int&apos;, default=None)&lt;/li&gt;
	&lt;li&gt;parser.set_defaults(port=9090, verbose=1, proto=&apos;binary&apos;)&lt;br/&gt;
+    parser.set_defaults(port=9090, verbose=1, proto=&apos;binary&apos;, transport=&apos;buffered&apos;)&lt;br/&gt;
     options, args = parser.parse_args()&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;Print TServer log to stdout so that the test-runner can redirect it to log files&lt;br/&gt;
diff --git a/test/test.py b/test/test.py&lt;br/&gt;
index 24e7c4e47b..f59256a26e 100755
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/test/test.py&lt;br/&gt;
+++ b/test/test.py&lt;br/&gt;
@@ -52,7 +52,7 @@&lt;br/&gt;
 CONFIG_FILE = &apos;tests.json&apos;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ol&gt;



&lt;p&gt;-def run_cross_tests(server_match, client_match, jobs, skip_known_failures, retry_count, regex):&lt;br/&gt;
+def run_cross_tests(server_match, client_match, jobs, skip_known_failures, only_known_failures, retry_count, regex):&lt;br/&gt;
     logger = multiprocessing.get_logger()&lt;br/&gt;
     logger.debug(&apos;Collecting tests&apos;)&lt;br/&gt;
     with open(path_join(TEST_DIR, CONFIG_FILE), &apos;r&apos;) as fp:&lt;br/&gt;
@@ -63,6 +63,10 @@ def run_cross_tests(server_match, client_match, jobs, skip_known_failures, retry&lt;br/&gt;
         print(&apos;  servers: %s&apos; % server_match, file=sys.stderr)&lt;br/&gt;
         print(&apos;  clients: %s&apos; % client_match, file=sys.stderr)&lt;br/&gt;
         return False&lt;br/&gt;
+    if only_known_failures:&lt;br/&gt;
+        logger.debug(&apos;Only running known failures&apos;)&lt;br/&gt;
+        known = crossrunner.load_known_failures(TEST_DIR)&lt;br/&gt;
+        tests = list(filter(lambda t: crossrunner.test_name(**t) in known, tests))&lt;br/&gt;
     if skip_known_failures:&lt;br/&gt;
         logger.debug(&apos;Skipping known failures&apos;)&lt;br/&gt;
         known = crossrunner.load_known_failures(TEST_DIR)&lt;br/&gt;
@@ -81,7 +85,7 @@ def run_cross_tests(server_match, client_match, jobs, skip_known_failures, retry&lt;br/&gt;
         return False&lt;/p&gt;


&lt;p&gt;-def run_feature_tests(server_match, feature_match, jobs, skip_known_failures, retry_count, regex):&lt;br/&gt;
+def run_feature_tests(server_match, feature_match, jobs, skip_known_failures, only_known_failures, retry_count, regex):&lt;br/&gt;
     basedir = path_join(ROOT_DIR, FEATURE_DIR_RELATIVE)&lt;br/&gt;
     logger = multiprocessing.get_logger()&lt;br/&gt;
     logger.debug(&apos;Collecting tests&apos;)&lt;br/&gt;
@@ -95,6 +99,10 @@ def run_feature_tests(server_match, feature_match, jobs, skip_known_failures, re&lt;br/&gt;
         print(&apos;  servers: %s&apos; % server_match, file=sys.stderr)&lt;br/&gt;
         print(&apos;  features: %s&apos; % feature_match, file=sys.stderr)&lt;br/&gt;
         return False&lt;br/&gt;
+    if only_known_failures:&lt;br/&gt;
+        logger.debug(&apos;Only running known failures&apos;)&lt;br/&gt;
+        known = crossrunner.load_known_failures(basedir)&lt;br/&gt;
+        tests = list(filter(lambda t: crossrunner.test_name(**t) in known, tests))&lt;br/&gt;
     if skip_known_failures:&lt;br/&gt;
         logger.debug(&apos;Skipping known failures&apos;)&lt;br/&gt;
         known = crossrunner.load_known_failures(basedir)&lt;br/&gt;
@@ -130,6 +138,8 @@ def main(argv):&lt;br/&gt;
     parser.add_argument(&apos;&lt;del&gt;F&apos;, &apos;&lt;/del&gt;-features&apos;, nargs=&apos;*&apos;, default=None,&lt;br/&gt;
                         help=&apos;run server feature tests instead of cross language tests&apos;)&lt;br/&gt;
     parser.add_argument(&apos;&lt;del&gt;R&apos;, &apos;&lt;/del&gt;-regex&apos;, help=&apos;test name pattern to run&apos;)&lt;br/&gt;
+    parser.add_argument(&apos;&lt;del&gt;o&apos;, &apos;&lt;/del&gt;-only-known_failures&apos;, action=&apos;store_true&apos;, dest=&apos;only_known_failures&apos;,&lt;br/&gt;
+                        help=&apos;only execute tests that are known to fail&apos;)&lt;br/&gt;
     parser.add_argument(&apos;&lt;del&gt;s&apos;, &apos;&lt;/del&gt;-skip-known-failures&apos;, action=&apos;store_true&apos;, dest=&apos;skip_known_failures&apos;,&lt;br/&gt;
                         help=&apos;do not execute tests that are known to fail&apos;)&lt;br/&gt;
     parser.add_argument(&apos;&lt;del&gt;r&apos;, &apos;&lt;/del&gt;-retry-count&apos;, type=int,&lt;br/&gt;
@@ -169,10 +179,12 @@ def main(argv):&lt;br/&gt;
     elif options.features is not None:&lt;br/&gt;
         features = options.features or &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;.*&amp;#39;&amp;#93;&lt;/span&gt;&lt;br/&gt;
         res = run_feature_tests(server_match, features, options.jobs,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;options.skip_known_failures, options.retry_count, options.regex)&lt;br/&gt;
+                                options.skip_known_failures, options.only_known_failures,&lt;br/&gt;
+                                options.retry_count, options.regex)&lt;br/&gt;
     else:&lt;br/&gt;
         res = run_cross_tests(server_match, client_match, options.jobs,&lt;/li&gt;
	&lt;li&gt;options.skip_known_failures, options.retry_count, options.regex)&lt;br/&gt;
+                              options.skip_known_failures, options.only_known_failures,&lt;br/&gt;
+                              options.retry_count, options.regex)&lt;br/&gt;
     return 0 if res else 1&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;diff --git a/test/tests.json b/test/tests.json&lt;br/&gt;
index 4641f223b8..ed38fea3b0 100644&lt;br/&gt;
&amp;#8212; a/test/tests.json&lt;br/&gt;
+++ b/test/tests.json&lt;br/&gt;
@@ -64,7 +64,7 @@&lt;br/&gt;
     &quot;server&quot;: &lt;/p&gt;
{
       &quot;command&quot;: [
         &quot;thrift_test_server&quot;,
-	&quot;--trace&quot;
+        &quot;--trace&quot;
       ]
     }
&lt;p&gt;,&lt;br/&gt;
     &quot;client&quot;: &lt;/p&gt;
{
@@ -254,7 +254,8 @@
     }
&lt;p&gt;,&lt;br/&gt;
     &quot;transports&quot;: [&lt;br/&gt;
       &quot;buffered&quot;,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&quot;framed&quot;&lt;br/&gt;
+      &quot;framed&quot;,&lt;br/&gt;
+      &quot;http&quot;&lt;br/&gt;
     ],&lt;br/&gt;
     &quot;sockets&quot;: [&lt;br/&gt;
       &quot;ip&quot;,&lt;br/&gt;
@@ -292,11 +293,12 @@&lt;br/&gt;
     },&lt;br/&gt;
     &quot;transports&quot;: [&lt;br/&gt;
       &quot;buffered&quot;,&lt;/li&gt;
	&lt;li&gt;&quot;framed&quot;&lt;br/&gt;
+      &quot;framed&quot;,&lt;br/&gt;
+      &quot;http&quot;&lt;br/&gt;
     ],&lt;br/&gt;
     &quot;sockets&quot;: [&lt;/li&gt;
	&lt;li&gt;&quot;ip-ssl&quot;,&lt;/li&gt;
	&lt;li&gt;&quot;ip&quot;&lt;br/&gt;
+      &quot;ip&quot;,&lt;br/&gt;
+      &quot;ip-ssl&quot;&lt;br/&gt;
     ],&lt;br/&gt;
     &quot;protocols&quot;: [&lt;br/&gt;
       &quot;compact&quot;,&lt;/li&gt;
&lt;/ul&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16428256" author="jking3" created="Fri, 6 Apr 2018 12:39:00 +0000"  >&lt;p&gt;Added http and https support for python language cross tests.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 32 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2e03j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>