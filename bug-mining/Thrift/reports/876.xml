<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:10:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-2313] nodejs server crash after processing the first request when using MultiplexedProcessor/FramedBuffer/BinaryProtocol</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-2313</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;The problem is due to the way Protocols and Transports handle the end of streams.&lt;/p&gt;

&lt;p&gt;Basically what happens is that we read a first message correctly, then we try to read another message from the buffer we have no more data&lt;/p&gt;

&lt;p&gt;So, in TBinaryProtocol.readMessageBegin, we starts by reading an Int32 from the streambuffer, but as the buffer is empty, it return undefined, then the rest of the function is complete garbage (but it doesn&apos;t crash), so the exception is thrown from the processor. The MultiplexedProcessor see the error (by side effect), and throw a thrift.TException which is not catched by the server.&lt;/p&gt;

&lt;p&gt;It doesn&apos;t happens with:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TBufferedTransport because ensureAvailable is called before each reads&lt;/li&gt;
	&lt;li&gt;TJSONProtocol because we check for the stream length before reading it (borrow + readindex)&lt;/li&gt;
	&lt;li&gt;Non Multiplexed Protocol: because MultiplexedPrcessor throw its own error (thrift.TException) which is not catched above, however what happens is that a thrift exception is thrown on the wire after &lt;b&gt;each&lt;/b&gt; requests when using regularprocessor/framedtransport/binaryprotocol&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think that the best way to handle it is to check that there is enough data before extracting it from the buffer in the functions TBinaryProtocol.readInt/String/.... and to throw a underbuffer error if necessary&lt;/p&gt;</description>
                <environment></environment>
        <key id="12688632">THRIFT-2313</key>
            <summary>nodejs server crash after processing the first request when using MultiplexedProcessor/FramedBuffer/BinaryProtocol</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="henrique">Henrique Mendonca</assignee>
                                    <reporter username="chubinou">Pierre Lamot</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Jan 2014 23:06:16 +0000</created>
                <updated>Wed, 15 Jan 2014 02:59:52 +0000</updated>
                            <resolved>Tue, 14 Jan 2014 14:23:34 +0000</resolved>
                                    <version>0.9.1</version>
                                    <fixVersion>0.9.2</fixVersion>
                                    <component>Node.js - Library</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13870203" author="chubinou" created="Tue, 14 Jan 2014 00:53:18 +0000"  >&lt;p&gt;add patches&lt;/p&gt;

&lt;p&gt;0001 -&amp;gt; fix this issue&lt;br/&gt;
0002 -&amp;gt; remove dependency upon Harmony as discussed &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2205?focusedCommentId=13867914&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13867914&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;here&lt;/a&gt;&lt;br/&gt;
0003 -&amp;gt; split very long lines in nodes tests as suggested &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2205?focusedCommentId=13868263&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13868263&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;here&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13870758" author="henrique" created="Tue, 14 Jan 2014 14:23:34 +0000"  >&lt;p&gt;committed!&lt;br/&gt;
thanks for the patches Pierre! I had to change patch 3 a bit to apply it and also removed all the unnecessary tabs.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
Henrique&lt;/p&gt;</comment>
                            <comment id="13870772" author="chubinou" created="Tue, 14 Jan 2014 14:44:49 +0000"  >&lt;p&gt;hi Henrique,&lt;/p&gt;

&lt;p&gt;great, thank you.&lt;/p&gt;

&lt;p&gt;Sorry for the tab, I thought I checked them. In my defense tab/space is quite inconsistent across node implementation (4spaces, 2spaces, tab+ spaces, ...), CRLF LF differences also&lt;/p&gt;

&lt;p&gt;Pierre&lt;/p&gt;</comment>
                            <comment id="13870811" author="hudson" created="Tue, 14 Jan 2014 15:21:43 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #1001 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/1001/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/1001/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2313&quot; title=&quot;nodejs server crash after processing the first request when using MultiplexedProcessor/FramedBuffer/BinaryProtocol&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2313&quot;&gt;&lt;del&gt;THRIFT-2313&lt;/del&gt;&lt;/a&gt; nodejs server crash after processing the first request when using MultiplexedProcessor/FramedBuffer/BinaryProtocol (henrique: rev 216374ec4a72cbabf7c76dd9284362aba4d30f1c)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;test/nodejs/multiplex_client.js&lt;/li&gt;
	&lt;li&gt;test/nodejs/thrift_test_driver.js&lt;/li&gt;
	&lt;li&gt;test/nodejs/Makefile.am&lt;/li&gt;
	&lt;li&gt;lib/nodejs/lib/thrift/transport.js&lt;/li&gt;
	&lt;li&gt;lib/nodejs/lib/thrift/multiplexed_processor.js&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12669807">THRIFT-2205</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12622750" name="0001-THRIFT-2313-nodejs-server-crash-after-processing-the.patch" size="1881" author="chubinou" created="Tue, 14 Jan 2014 00:53:18 +0000"/>
                            <attachment id="12622749" name="0002-node-avoid-dependency-upon-harmony-Ecmas-in-multiple.patch" size="2326" author="chubinou" created="Tue, 14 Jan 2014 00:53:18 +0000"/>
                            <attachment id="12622748" name="0003-node-split-very-long-lines-in-tests.patch" size="10687" author="chubinou" created="Tue, 14 Jan 2014 00:53:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>367651</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 45 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1rddj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>367958</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>