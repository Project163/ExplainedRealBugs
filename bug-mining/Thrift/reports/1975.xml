<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:30:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-4807] PHP extension segfaults if reference is used in input</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-4807</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;When reference is passed to php extension, it&apos;s unreferenced (instead of derefrenced). The next time one tries to use the same variable PHP segaults. Even if not used again, php segfaults on user_shutdown_function_call.&lt;/p&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;p&gt;Thrift&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
namespace php tt.demo

struct SumInput {
&#160;&#160;&#160; 1: required list&amp;lt;i64&amp;gt; numbers;
}

service DemoService {
&#160;&#160;&#160; i64 sum(1: SumInput input)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;PHP client:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// Create HTTP Transport
&lt;/span&gt;$transport = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; \Thrift\Transport\TNullTransport();

&lt;span class=&quot;code-comment&quot;&gt;// binary protocol
&lt;/span&gt;$protocol = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; \Thrift\Protocol\TBinaryProtocolAccelerated($transport, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);

&lt;span class=&quot;code-comment&quot;&gt;// create a client
&lt;/span&gt;$client = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; \tt\demo\DemoServiceClient($protocol);

&lt;span class=&quot;code-comment&quot;&gt;// at &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; point, client is ready, and we can make RPC calls:
&lt;/span&gt;$numbers = [];
$input = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; \tt\demo\SumInput();
$input-&amp;gt;numbers = &amp;amp;$numbers;

debug_zval_dump($input);

$client-&amp;gt;send_sum($input); &lt;span class=&quot;code-comment&quot;&gt;// used by sum()
&lt;/span&gt;
$input-&amp;gt;numbers = &amp;amp;$numbers;
debug_zval_dump($input);

$client-&amp;gt;send_sum($input); &lt;span class=&quot;code-comment&quot;&gt;// used by sum()
&lt;/span&gt;var_dump(&lt;span class=&quot;code-quote&quot;&gt;&apos;never reached&apos;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Output (gdb)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
(gdb) run -c ~/bin/php7-0-33/php.ini ~/Work/thrift-examples/php/client.php
Starting program: /home/jsokcevic/bin/php7-0-33/bin/php -c ~/bin/php7-0-33/php.ini ~/Work/thrift-examples/php/client.php
[&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; debugging using libthread_db enabled]
Using host libthread_db library &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/lib/libthread_db.so.1&quot;&lt;/span&gt;.
object(tt\demo\SumInput)#6 (1) refcount(2){
&#160; [&lt;span class=&quot;code-quote&quot;&gt;&quot;numbers&quot;&lt;/span&gt;]=&amp;gt;
&#160; &amp;amp;array(0) refcount(1){
&#160; }
}
object(tt\demo\SumInput)#6 (1) refcount(2){
&#160; [&lt;span class=&quot;code-quote&quot;&gt;&quot;numbers&quot;&lt;/span&gt;]=&amp;gt;
&#160; &amp;amp;array(0) refcount(4094359424){
&#160; }
}
php: /home/jsokcevic/Work/php-src/Zend/zend_operators.c:356: convert_to_long_base: Assertion `0&apos; failed.

Program received signal SIGABRT, Aborted.
0x00007ffff51d6d7f in raise () from /usr/lib/libc.so.6
(gdb) bt
#0&#160; 0x00007ffff51d6d7f in raise () from /usr/lib/libc.so.6
#1&#160; 0x00007ffff51c1672 in abort () from /usr/lib/libc.so.6
#2&#160; 0x00007ffff51c1548 in __assert_fail_base.cold.0 () from /usr/lib/libc.so.6
#3&#160; 0x00007ffff51cf396 in __assert_fail () from /usr/lib/libc.so.6
#4&#160; 0x0000555555b7422b in convert_to_long_base (op=0x7ffff4006448, base=10)
&#160;&#160;&#160; at /home/jsokcevic/Work/php-src/Zend/zend_operators.c:356
#5&#160; 0x0000555555b73e13 in convert_to_long (op=0x7ffff4006448)
&#160;&#160;&#160; at /home/jsokcevic/Work/php-src/Zend/zend_operators.c:297
#6&#160; 0x00007ffff3c99052 in binary_serialize (thrift_typeID=10 &lt;span class=&quot;code-quote&quot;&gt;&apos;\n&apos;&lt;/span&gt;, transport=..., value=0x7ffff4006448,
&#160;&#160;&#160; fieldspec=0x7ffff407ecc0) at /home/jsokcevic/Work/php-workspace/thrift_protocol/php_thrift_protocol.cpp:744
#7&#160; 0x00007ffff3c9956c in binary_serialize (thrift_typeID=15 &lt;span class=&quot;code-quote&quot;&gt;&apos;\017&apos;&lt;/span&gt;, transport=..., value=0x7ffff40af4a8,
&#160;&#160;&#160; fieldspec=0x7ffff40afc60) at /home/jsokcevic/Work/php-workspace/thrift_protocol/php_thrift_protocol.cpp:818
#8&#160; 0x00007ffff3c9a318 in binary_serialize_spec (zthis=0x7ffff407e328, transport=..., spec=0x7ffff40c43c0)
&#160;&#160;&#160; at /home/jsokcevic/Work/php-workspace/thrift_protocol/php_thrift_protocol.cpp:1021
#9&#160; 0x00007ffff3c98ef3 in binary_serialize (thrift_typeID=12 &lt;span class=&quot;code-quote&quot;&gt;&apos;\f&apos;&lt;/span&gt;, transport=..., value=0x7ffff407e328,
&#160;&#160;&#160; fieldspec=0x7ffff40c45a0) at /home/jsokcevic/Work/php-workspace/thrift_protocol/php_thrift_protocol.cpp:722
#10 0x00007ffff3c9a318 in binary_serialize_spec (zthis=0x7ffff4015560, transport=..., spec=0x7ffff40c4540)
&#160;&#160;&#160; at /home/jsokcevic/Work/php-workspace/thrift_protocol/php_thrift_protocol.cpp:1021
#11 0x00007ffff3c9a4ef in zif_thrift_protocol_write_binary (execute_data=0x7ffff40154d0, return_value=0x7ffff4015410)
&#160;&#160;&#160; at /home/jsokcevic/Work/php-workspace/thrift_protocol/php_thrift_protocol.cpp:1053
#12 0x0000555555be76e7 in ZEND_DO_FCALL_BY_NAME_SPEC_HANDLER ()
&#160;&#160;&#160; at /home/jsokcevic/Work/php-src/Zend/zend_vm_execute.h:714
#13 0x0000555555be6b68 in execute_ex (ex=0x7ffff4015030) at /home/jsokcevic/Work/php-src/Zend/zend_vm_execute.h:414
#14 0x0000555555be6c79 in zend_execute (op_array=0x7ffff4085000, return_value=0x0)
&#160;&#160;&#160; at /home/jsokcevic/Work/php-src/Zend/zend_vm_execute.h:458
#15 0x0000555555b872ff in zend_execute_scripts (type=8, retval=0x0, file_count=3)
&#160;&#160;&#160; at /home/jsokcevic/Work/php-src/Zend/zend.c:1445
#16 0x0000555555aef67b in php_execute_script (primary_file=0x7fffffffcaa0)
&#160;&#160;&#160; at /home/jsokcevic/Work/php-src/main/main.c:2516
#17 0x0000555555c4ff4b in do_cli (argc=4, argv=0x55555638e310) at /home/jsokcevic/Work/php-src/sapi/cli/php_cli.c:977
#18 0x0000555555c51132 in main (argc=4, argv=0x55555638e310) at /home/jsokcevic/Work/php-src/sapi/cli/php_cli.c:1347
(gdb)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;php 7.0 &amp;amp; php 7.2 with php extension&lt;/p&gt;</environment>
        <key id="13217107">THRIFT-4807</key>
            <summary>PHP extension segfaults if reference is used in input</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jking3">James E. King III</assignee>
                                    <reporter username="sokac">Josip Sokcevic</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 Feb 2019 07:19:26 +0000</created>
                <updated>Wed, 16 Oct 2019 22:26:53 +0000</updated>
                            <resolved>Fri, 22 Feb 2019 11:22:18 +0000</resolved>
                                    <version>0.12.0</version>
                                    <fixVersion>0.13.0</fixVersion>
                                    <component>PHP - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                        <attachments>
                            <attachment id="12959568" name="0001-THRIFT-4807-Fix-php-segfault-on-reference-pass.patch" size="1245" author="sokac" created="Thu, 21 Feb 2019 07:22:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 38 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi17rc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>