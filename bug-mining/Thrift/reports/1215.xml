<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:17:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-3061] C++ TSSLSocket shutdown delay/vulnerability</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-3061</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;In the C++ implementation of TSSLSocket, during close() the following code sequence is found:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;void TSSLSocket::close() {
  if (ssl_ != NULL) {
    int rc = SSL_shutdown(ssl_);
    if (rc == 0) {
      rc = SSL_shutdown(ssl_);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;According to the OpenSSL documentation, while it is &quot;nice&quot; to attempt to shutdown SSL in this way, it is not required when the code is performing a unilateral shutdown (meaning the underlying connection will be closed).  It is only necessary to call SSL_Shutdown twice like this if the socket (and configured SSL therein) is going to be reused.&lt;/p&gt;

&lt;p&gt;It is possible to have a misbehaving client that does not handle this part of the shutdown process properly and fail to reply, and also fail to close.  The most likely embodiment would be a program designed specifically to fail to reply to the &quot;close notify&quot; and hold the socket open in order to produce a denial-of-service attack.  Another possibility is a poorly written client.&lt;/p&gt;

&lt;p&gt;Given the OpenSSL documentation states that calling SSL_Shutdown once is sufficient when the socket is going to be closed, I recommend that we remove the second SSL_Shutdown call and prevent something that can block the close() call.  We have seen this happen, and it interacts with &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2441&quot; title=&quot;Cannot shutdown TThreadedServer when clients are still connected&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2441&quot;&gt;&lt;del&gt;THRIFT-2441&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12786782">THRIFT-3061</key>
            <summary>C++ TSSLSocket shutdown delay/vulnerability</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jking3">James E. King III</assignee>
                                    <reporter username="jking3">James E. King III</reporter>
                        <labels>
                            <label>OpenSSL</label>
                            <label>SSL</label>
                    </labels>
                <created>Mon, 30 Mar 2015 17:15:44 +0000</created>
                <updated>Tue, 21 Jul 2015 02:21:18 +0000</updated>
                            <resolved>Mon, 4 May 2015 13:35:37 +0000</resolved>
                                    <version>0.8</version>
                    <version>0.9</version>
                    <version>0.9.1</version>
                    <version>0.9.2</version>
                                    <fixVersion>0.9.3</fixVersion>
                                    <component>C++ - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14388553" author="jking3" created="Tue, 31 Mar 2015 13:57:00 +0000"  >&lt;p&gt;I have attached a patch for this issue.&lt;/p&gt;</comment>
                            <comment id="14394925" author="githubbot" created="Fri, 3 Apr 2015 18:57:20 +0000"  >&lt;p&gt;GitHub user jeking3 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/423&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/423&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3061&quot; title=&quot;C++ TSSLSocket shutdown delay/vulnerability&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3061&quot;&gt;&lt;del&gt;THRIFT-3061&lt;/del&gt;&lt;/a&gt; eliminate potential for client to hang SSLSocket close&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jeking3/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jeking3/thrift&lt;/a&gt; bugfix/&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3061&quot; title=&quot;C++ TSSLSocket shutdown delay/vulnerability&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3061&quot;&gt;&lt;del&gt;THRIFT-3061&lt;/del&gt;&lt;/a&gt;-ssl-shutdown-vulnerability&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/423.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/423.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #423&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 5cb13f25ee6d292f2fde0051a2b7ee56b7884055&lt;br/&gt;
Author: Jim King &amp;lt;jim.king@simplivity.com&amp;gt;&lt;br/&gt;
Date:   2015-04-03T18:56:27Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3061&quot; title=&quot;C++ TSSLSocket shutdown delay/vulnerability&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3061&quot;&gt;&lt;del&gt;THRIFT-3061&lt;/del&gt;&lt;/a&gt; eliminate potential for client to hang SSLSocket close&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14484155" author="roger.meier" created="Tue, 7 Apr 2015 21:53:01 +0000"  >&lt;p&gt;We should keep it as it is as long as it does not hurt on the performance side.&lt;br/&gt;
And people do crazy things with sockets such as reusing them and we should keep them on the safe side as well.&lt;br/&gt;
;-r&lt;/p&gt;</comment>
                            <comment id="14485091" author="jking3" created="Wed, 8 Apr 2015 11:24:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roger.meier&quot; class=&quot;user-hover&quot; rel=&quot;roger.meier&quot;&gt;roger.meier&lt;/a&gt; I respectfully disagree here, since the code in TSSLSocket is clearly closing the socket following the shutdown sequence.  The second shutdown call is only necessary if the socket is going to be reused and this is documented in the SSL_shutdown manual page.  As it is, a malicious client can hold the server connection hostage by opening a SSL connection and then only responding to the first SSL_Shutdown, and not respond to the second; further not all SSL clients on all platforms and in all languages adhere to the &quot;close notify&quot; part properly (but most do) as we&apos;ve seen this behavior with older C# clients connected.  Please reconsider.&lt;/p&gt;</comment>
                            <comment id="14491690" author="githubbot" created="Sun, 12 Apr 2015 20:11:51 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/423&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/423&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14491691" author="roger.meier" created="Sun, 12 Apr 2015 20:11:57 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="14491711" author="hudson" created="Sun, 12 Apr 2015 20:47:19 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #1505 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/1505/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/1505/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3061&quot; title=&quot;C++ TSSLSocket shutdown delay/vulnerability&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3061&quot;&gt;&lt;del&gt;THRIFT-3061&lt;/del&gt;&lt;/a&gt; eliminate potential for client to hang SSLSocket close (roger: rev 932c3ee66e8bddf3619e063683a6047e7673b76c)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/cpp/src/thrift/transport/TSSLSocket.cpp&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14521997" author="jking3" created="Thu, 30 Apr 2015 18:28:13 +0000"  >&lt;p&gt;The resolution on this needs to change from &quot;Won&apos;t Fix&quot; to &quot;Fixed&quot;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12706127">THRIFT-2441</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12708431" name="THRIFT-3061.patch" size="570" author="jking3" created="Tue, 31 Mar 2015 13:57:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 29 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i27jtr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>