<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:08:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-1932] TFileTransport::readEvent() casts values read from input stream into a pointer and then dereferences it.</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-1932</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;The Compilation of thrift-0.9.0 ended with the following warnings:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;QA Notice: Package triggers severe warnings which indicate that it&lt;/li&gt;
	&lt;li&gt;may exhibit random runtime failures.&lt;/li&gt;
	&lt;li&gt;src/thrift/transport/TFileTransport.cpp:715:56: warning: dereferencing type-punned pointer will break strict-aliasing rules &lt;span class=&quot;error&quot;&gt;&amp;#91;-Wstrict-aliasing&amp;#93;&lt;/span&gt;&lt;/li&gt;
	&lt;li&gt;src/thrift/transport/TFileTransport.cpp:726:84: warning: dereferencing type-punned pointer will break strict-aliasing rules &lt;span class=&quot;error&quot;&gt;&amp;#91;-Wstrict-aliasing&amp;#93;&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;When looking into src/thrift/transport/TFileTransport.cpp:715 ...&lt;/p&gt;


&lt;p&gt;711         readState_.eventSizeBuff_&lt;span class=&quot;error&quot;&gt;&amp;#91;readState_.eventSizeBuffPos_++&amp;#93;&lt;/span&gt; =&lt;br/&gt;
712           readBuff_&lt;span class=&quot;error&quot;&gt;&amp;#91;readState_.bufferPtr_++&amp;#93;&lt;/span&gt;;&lt;br/&gt;
713         if (readState_.eventSizeBuffPos_ == 4) {&lt;br/&gt;
714           // 0 length event indicates padding&lt;br/&gt;
715           if (*((uint32_t *)(readState_.eventSizeBuff_)) == 0) &lt;/p&gt;
{
716             //            T_DEBUG_L(1, &quot;Got padding&quot;);
717             readState_.resetState(readState_.lastDispatchPtr_);
718             continue;
719           }

&lt;p&gt;... it becomes obvious that the four values casted into a  pointer were previously read from the input stream by ::read() in line 661: &lt;/p&gt;


&lt;p&gt;661       readState_.bufferLen_ = ::read(fd_, readBuff_, readBuffSize_);&lt;/p&gt;


&lt;p&gt;Same issue here:&lt;/p&gt;

&lt;p&gt;725           readState_.event_ = new eventInfo();&lt;br/&gt;
726           readState_.event_-&amp;gt;eventSize_ = &amp;#42;((uint32_t*)(readState_.eventSizeBuff_));&lt;br/&gt;
727 &lt;/p&gt;

&lt;p&gt;While it is a two minute job fix this problem, the method TFileTransport::readEvent() looks so fragile that a clean rewrite appears to be more appropriate. &lt;/p&gt;</description>
                <environment>&lt;p&gt;Hardened Gentoo amd64 Linux &lt;/p&gt;</environment>
        <key id="12643266">THRIFT-1932</key>
            <summary>TFileTransport::readEvent() casts values read from input stream into a pointer and then dereferences it.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roger">Roger Meier</assignee>
                                    <reporter username="hkjm">Hugo Mildenberger</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Apr 2013 16:10:01 +0000</created>
                <updated>Mon, 20 May 2013 03:13:13 +0000</updated>
                            <resolved>Sun, 5 May 2013 21:38:30 +0000</resolved>
                                    <version>0.9</version>
                                                    <component>C++ - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13637521" author="roger.meier" created="Sun, 21 Apr 2013 09:57:45 +0000"  >&lt;p&gt;Hi Hugo, would be great if you can spend the two minutes to fix it and provide a patch.&lt;br/&gt;
see &lt;a href=&quot;http://thrift.apache.org/docs/HowToContribute&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://thrift.apache.org/docs/HowToContribute&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m ready to review and commit this afterwards.&lt;br/&gt;
-roger&lt;/p&gt;
</comment>
                            <comment id="13637574" author="hkjm" created="Sun, 21 Apr 2013 15:33:30 +0000"  >&lt;p&gt;Hi Roger, here is the patch you requested. It does, however, only suppress the type-punned pointer warning. Since I&apos;m new to Thrift, I&apos;m quite unsure if the sequence of bytes read from file handle &apos;fd_&apos; is already in host byte order. If this is not the case the patch is still wrong &lt;/p&gt;
</comment>
                            <comment id="13649441" author="roger.meier" created="Sun, 5 May 2013 21:38:30 +0000"  >&lt;p&gt;Thanks Hugo!&lt;br/&gt;
committed&lt;/p&gt;</comment>
                            <comment id="13661737" author="hudson" created="Mon, 20 May 2013 03:13:13 +0000"  >&lt;p&gt;Integrated in Thrift #646 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/646/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/646/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1932&quot; title=&quot;TFileTransport::readEvent() casts values read from input stream into a pointer and then dereferences it.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1932&quot;&gt;&lt;del&gt;THRIFT-1932&lt;/del&gt;&lt;/a&gt; TFileTransport::readEvent() casts values read from input stream into a pointer and then dereferences it. (Revision 7f1df992479fdcad208889e53b8b982e2428d250)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
roger : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/cpp/src/thrift/transport/TFileTransport.h&lt;/li&gt;
	&lt;li&gt;lib/cpp/src/thrift/transport/TFileTransport.cpp&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12579732" name="thrift-0.9.0-fix-type-punned-pointer-warning.patch" size="1812" author="hkjm" created="Sun, 21 Apr 2013 15:33:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>323676</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 27 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1juef:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>324021</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>