<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:08:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-1973] TCompactProtocol in C# lib does not serialize and deserialize negative int32 and int64 number correctly</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-1973</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;longToZigzag and ZigzagToLong in TCompactProtocol does not perform corresponding operations to serialize and deserialize negative int32 and int64 number correctly.  Purpose to change longToZigzag from (ulong)(((ulong)n &amp;lt;&amp;lt; 1) ^ ((ulong)n &amp;gt;&amp;gt; 63)) to (ulong)(n &amp;lt;&amp;lt; 1) ^ (ulong)(n &amp;gt;&amp;gt; 63).&lt;/p&gt;

&lt;p&gt;Will need to do same for intToZigZag.  The reason is that we want arithmetic shift not logic shift.  &lt;/p&gt;

&lt;p&gt;The test case in the project shows this, the output on server and client are different even though client received the same number back.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows&lt;/p&gt;</environment>
        <key id="12648269">THRIFT-1973</key>
            <summary>TCompactProtocol in C# lib does not serialize and deserialize negative int32 and int64 number correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="henrique">Henrique Mendonca</assignee>
                                    <reporter username="eding">Eric Ding</reporter>
                        <labels>
                            <label>PatchAvailable</label>
                    </labels>
                <created>Fri, 17 May 2013 23:29:45 +0000</created>
                <updated>Sat, 20 Feb 2021 15:27:36 +0000</updated>
                            <resolved>Sat, 8 Jun 2013 03:15:43 +0000</resolved>
                                    <version>0.9</version>
                                    <fixVersion>0.9.1</fixVersion>
                                    <component>C# - Library</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13661149" author="eding" created="Fri, 17 May 2013 23:32:34 +0000"  >&lt;p&gt;Patch Attached&lt;/p&gt;</comment>
                            <comment id="13661647" author="henrique" created="Sun, 19 May 2013 20:47:21 +0000"  >&lt;p&gt;Hi Eric,&lt;br/&gt;
Thanks for you patch. Are both your client and server running C#?&lt;br/&gt;
Would you be able to provide us some unit-testing to reproduce that?&lt;br/&gt;
We are already using this on production code and the cases you mentioned were successfully tested against a c++ server, but yes, this could be a problem on the other side.&lt;br/&gt;
Ideally, we should make the existing tests to optionally use compact binary to check this.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
Henrique&lt;/p&gt;</comment>
                            <comment id="13661847" author="afds" created="Mon, 20 May 2013 08:19:06 +0000"  >&lt;p&gt;We got the same issue with C# and Java interoperability. C# does it wrong with zigzag.&lt;/p&gt;</comment>
                            <comment id="13662311" author="eding" created="Mon, 20 May 2013 19:52:11 +0000"  >&lt;p&gt;Yeah, I tested this using the test client and server project in the C# lib.    I didn&apos;t run with another server in a different language.  Are you saying that a C# client and C++ server, this works correctly?  Looking at the code in C++ and Java, zigzag functions are correct.  But paired with C# client, they should failed.  &lt;/p&gt;

&lt;p&gt;I didn&apos;t add any new test cases in the test project because it already has it.  I just switched the protocol from Binary to Compact.  And the test cases already in the test project failed for negative numbers on server vs what was sent from the client.  The thing I did notice is that the client test calls send and receive to verify the number.  In this particular case, the client receives the same number back.  But the server actually receives a different number.  The code needs to run ones complement once for serialize and once for deserialize it.   Calling sending and receiving just happens to deserialize correctly again on the client.    &lt;/p&gt;</comment>
                            <comment id="13662489" author="jensg" created="Tue, 21 May 2013 00:08:30 +0000"  >&lt;blockquote&gt;
&lt;p&gt;And the test cases already in the test project failed for negative numbers on server vs what was sent from the client. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Just curious (and without having tried myself): What type are these negative numbers of? Maybe i64 and/or byte? Or same as above, or any (integer) type?&lt;/p&gt;</comment>
                            <comment id="13662965" author="henrique" created="Tue, 21 May 2013 13:17:19 +0000"  >&lt;p&gt;Yes, I see. It&apos;s probably a problem on the configuration of the c++ server then.&lt;br/&gt;
However, I&apos;d not commit this until we have a proper testing running on the trunk.&lt;br/&gt;
That means making the existing test accept parameters to change the protocol and test this and the other protocols automatically. Not a big thing but I won&apos;t have time right now. Help is welcome &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
We need to fix this before 1.0, though.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jensg&quot; class=&quot;user-hover&quot; rel=&quot;jensg&quot;&gt;jensg&lt;/a&gt;: I think the patch is for i64 and i32&lt;/p&gt;</comment>
                            <comment id="13663794" author="eding" created="Wed, 22 May 2013 05:26:09 +0000"  >&lt;p&gt;I can add it to C# lib when I can grab some free time probably not in a few days depends on time.  I don&apos;t do C++ development and I don&apos;t have time right now to ramp up to make a meaningful contribution.  Is changing C# lib alone enough?&lt;/p&gt;</comment>
                            <comment id="13663812" author="carlyeks" created="Wed, 22 May 2013 05:54:50 +0000"  >&lt;p&gt;I don&apos;t think the original patch fixes the issue; I still cannot get ints to round trip properly in the compact protocol. Please see 1973-test-suite for a few tests of the protocols.&lt;/p&gt;</comment>
                            <comment id="13664042" author="carlyeks" created="Wed, 22 May 2013 12:01:21 +0000"  >&lt;p&gt;Sorry, I take that back; I didn&apos;t have the original patch applied (I hadn&apos;t pulled in master, and didn&apos;t notice the conflict).&lt;/p&gt;

&lt;p&gt;+1 to Eric&apos;s patch: The patch fixes the issue; the number it is generating now is the correct zig-zagged number.&lt;/p&gt;</comment>
                            <comment id="13666407" author="eding" created="Fri, 24 May 2013 16:00:13 +0000"  >&lt;p&gt;Thanks Carl for adding test suites.&lt;/p&gt;</comment>
                            <comment id="13667952" author="carlyeks" created="Mon, 27 May 2013 21:05:54 +0000"  >&lt;p&gt;This adds `make check` support, to bring it more in line with other languages.&lt;/p&gt;</comment>
                            <comment id="13672032" author="henrique" created="Sat, 1 Jun 2013 10:02:37 +0000"  >&lt;p&gt;Hi Carl and Eric,&lt;/p&gt;

&lt;p&gt;Thanks a lot for your patches. I&apos;m committing Eric&apos;s patch, but not yet Carl&apos;s.&lt;/p&gt;

&lt;p&gt;@Carl: Your test case covers it all and is a great improvement to the platform but I didn&apos;t get why you&apos;re removing lib/csharp/test/ThriftTest/maketest.sh since I don&apos;t see the TestServer been used anywhere else. It would be cool to have it on the make check too and on test/test.sh, what do you think?&lt;br/&gt;
We could probably rewrite it into a NUnit-test but that&apos;s a different thing.&lt;/p&gt;

&lt;p&gt;Unfortunately, I also couldn&apos;t get the new dependencies to work automatically on Ubuntu, please see:&lt;br/&gt;
&lt;a href=&quot;https://travis-ci.org/henrique/thrift/builds/7679253&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/henrique/thrift/builds/7679253&lt;/a&gt;&lt;br/&gt;
and&lt;br/&gt;
&lt;a href=&quot;https://github.com/henrique/thrift/blob/trunk/.travis.yml&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/henrique/thrift/blob/trunk/.travis.yml&lt;/a&gt;&lt;br/&gt;
So, I don&apos;t think it would run automatically on Jenkins, but fell free to add this to the trunk if you work it out.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
Henrique&lt;/p&gt;</comment>
                            <comment id="13672122" author="hudson" created="Sat, 1 Jun 2013 14:51:03 +0000"  >&lt;p&gt;Integrated in Thrift #655 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/655/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/655/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1973&quot; title=&quot;TCompactProtocol in C# lib does not serialize and deserialize negative int32 and int64 number correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1973&quot;&gt;&lt;del&gt;THRIFT-1973&lt;/del&gt;&lt;/a&gt; TCompactProtocol in C# lib does not serialize and deserialize negative int32 and int64 number correctly (Revision da7982edeaff5d47485909662ebd489d67a4085a)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1973&quot; title=&quot;TCompactProtocol in C# lib does not serialize and deserialize negative int32 and int64 number correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1973&quot;&gt;&lt;del&gt;THRIFT-1973&lt;/del&gt;&lt;/a&gt; TCompactProtocol in C# lib does not serialize and deserialize negative int32 and int64 number correctly (Revision 5a61438a5e61505d226d9aef1d131659109e5781)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
henrique : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/csharp/src/Transport/TMemoryBuffer.cs&lt;/li&gt;
	&lt;li&gt;lib/csharp/Makefile.am&lt;/li&gt;
	&lt;li&gt;lib/csharp/src/Thrift.sln&lt;/li&gt;
	&lt;li&gt;lib/csharp/test/ThriftTest/maketest.sh&lt;/li&gt;
	&lt;li&gt;lib/csharp/src/Protocol/TCompactProtocol.cs&lt;/li&gt;
	&lt;li&gt;test/ThriftTest.thrift&lt;/li&gt;
	&lt;li&gt;lib/csharp/test/ThriftTest/ThriftTest.csproj&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;henrique : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/csharp/Makefile.am&lt;/li&gt;
	&lt;li&gt;lib/csharp/test/ThriftTest/ThriftTest.csproj&lt;/li&gt;
	&lt;li&gt;test/ThriftTest.thrift&lt;/li&gt;
	&lt;li&gt;lib/csharp/src/Thrift.sln&lt;/li&gt;
	&lt;li&gt;lib/csharp/src/Transport/TMemoryBuffer.cs&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13675909" author="hudson" created="Wed, 5 Jun 2013 13:34:29 +0000"  >&lt;p&gt;Integrated in Thrift #663 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/663/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/663/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1973&quot; title=&quot;TCompactProtocol in C# lib does not serialize and deserialize negative int32 and int64 number correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1973&quot;&gt;&lt;del&gt;THRIFT-1973&lt;/del&gt;&lt;/a&gt; TCompactProtocol in C# lib does not serialize and deserialize negative int32 and int64 number correctly (Revision 8d22c10a47767f37eae8be3778dc40baa89713db)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
henrique : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/csharp/Makefile.am&lt;/li&gt;
	&lt;li&gt;test/ThriftTest.thrift&lt;/li&gt;
	&lt;li&gt;lib/csharp/src/Transport/TMemoryBuffer.cs&lt;/li&gt;
	&lt;li&gt;lib/csharp/test/ThriftTest/maketest.sh&lt;/li&gt;
	&lt;li&gt;lib/csharp/test/ThriftTest/ThriftTest.csproj&lt;/li&gt;
	&lt;li&gt;lib/csharp/src/Thrift.sln&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12653645">THRIFT-2047</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12584976" name="1973-test-suite-v2.patch" size="14579" author="carlyeks" created="Mon, 27 May 2013 21:09:03 +0000"/>
                            <attachment id="12584247" name="1973-test-suite.patch" size="12642" author="carlyeks" created="Wed, 22 May 2013 05:59:07 +0000"/>
                            <attachment id="12583705" name="thrift-1973-TCompactProtocol-Fix.patch" size="1153" author="eding" created="Fri, 17 May 2013 23:32:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>328625</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 24 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1kp6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>328969</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>