<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:58:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-785] Framed transport server problems</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-785</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;If I try to call the erlang thirift service associated with the attached files in framed mode from python, it dies with:&lt;/p&gt;

&lt;p&gt;$ gen-py/erlframedtest/FramedTest-remote -h localhost:9999 -f hi&lt;/p&gt;


&lt;p&gt;=ERROR REPORT==== 19-May-2010::15:09:20 ===&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;Generic server &amp;lt;0.41.0&amp;gt; terminating&lt;/li&gt;
		&lt;li&gt;Last message in was 
{read,4}&lt;/li&gt;
		&lt;li&gt;When Server state == {framed_transport,&lt;br/&gt;
                            {transport,thrift_socket_transport,&lt;br/&gt;
                                {data,#Port&amp;lt;0.847&amp;gt;,500}},&lt;br/&gt;
                            &amp;lt;&amp;lt;&amp;gt;&amp;gt;,[]}&lt;/li&gt;
		&lt;li&gt;Reason for termination ==&lt;/li&gt;
		&lt;li&gt;&lt;tt&gt;badmatch,{error,closed&lt;/tt&gt;,&lt;br/&gt;
    [
{thrift_framed_transport,handle_call,3},&lt;br/&gt;
     {gen_server,handle_msg,5},&lt;br/&gt;
     {proc_lib,init_p_do_apply,3}]}&lt;br/&gt;
&lt;br/&gt;
=ERROR REPORT==== 19-May-2010::15:09:20 ===&lt;br/&gt;
{thrift_socket_server,245,&lt;br/&gt;
                      {child_error,&lt;tt&gt;badmatch,{error,closed&lt;/tt&gt;,&lt;br/&gt;
                                    [{thrift_framed_transport,handle_call,3}
&lt;p&gt;,&lt;br/&gt;
                                     &lt;/p&gt;
{gen_server,handle_msg,5}
&lt;p&gt;,&lt;br/&gt;
                                     &lt;/p&gt;
{proc_lib,init_p_do_apply,3}
&lt;p&gt;]},&lt;br/&gt;
                                   []}}&lt;/p&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This is with erlang R13B04.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12464957">THRIFT-785</key>
            <summary>Framed transport server problems</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="djnym">Anthony Molinaro</assignee>
                                    <reporter username="yosh">Manish Singh</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 May 2010 22:19:04 +0000</created>
                <updated>Tue, 1 Nov 2011 02:52:14 +0000</updated>
                            <resolved>Mon, 30 Aug 2010 22:16:42 +0000</resolved>
                                    <version>0.4</version>
                                    <fixVersion>0.5</fixVersion>
                                    <component>Erlang - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12869378" author="yosh" created="Wed, 19 May 2010 22:20:12 +0000"  >&lt;p&gt;Test files&lt;/p&gt;</comment>
                            <comment id="12901109" author="djnym" created="Sat, 21 Aug 2010 22:13:46 +0000"  >&lt;p&gt;I came across the same issue yesterday in a slightly different guise.  I&apos;m using the refactored code from &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-599&quot; title=&quot;Don&amp;#39;t use unnecessary processes in the Erlang transports and clients&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-599&quot;&gt;&lt;del&gt;THRIFT-599&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt; The good news is the python client returns correctly and the server does not die.  The bad news it still spews an error&lt;/p&gt;

&lt;p&gt;=CRASH REPORT==== 21-Aug-2010::04:20:36 ===&lt;br/&gt;
  crasher:&lt;br/&gt;
    initial call: thrift_socket_server:acceptor_loop/1&lt;br/&gt;
    pid: &amp;lt;0.45.0&amp;gt;&lt;br/&gt;
    registered_name: []&lt;br/&gt;
    exception error: no match of right hand side value &lt;br/&gt;
                     {{transport,thrift_socket_transport,&lt;br/&gt;
                                 {data,#Port&amp;lt;0.647&amp;gt;,3600000}},&lt;br/&gt;
                      {error,closed}}&lt;br/&gt;
      in function  thrift_framed_transport:read/2&lt;br/&gt;
      in call from thrift_transport:read/2&lt;br/&gt;
      in call from thrift_binary_protocol:read_data/2&lt;br/&gt;
      in call from thrift_binary_protocol:read/2&lt;br/&gt;
      in call from thrift_binary_protocol:read/2&lt;br/&gt;
      in call from thrift_protocol:read_specific/2&lt;br/&gt;
      in call from thrift_processor:loop/1&lt;br/&gt;
    ancestors: &lt;span class=&quot;error&quot;&gt;&amp;#91;test_server,&amp;lt;0.42.0&amp;gt;&amp;#93;&lt;/span&gt;&lt;br/&gt;
    messages: []&lt;br/&gt;
    links: &lt;a href=&quot;#Port&amp;lt;0.647&amp;gt;&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&amp;lt;0.44.0&amp;gt;,#Port&amp;lt;0.647&amp;gt;&lt;/a&gt;&lt;br/&gt;
    dictionary: []&lt;br/&gt;
    trap_exit: false&lt;br/&gt;
    status: running&lt;br/&gt;
    heap_size: 610&lt;br/&gt;
    stack_size: 24&lt;br/&gt;
    reductions: 604&lt;br/&gt;
  neighbours:&lt;/p&gt;

&lt;p&gt;=ERROR REPORT==== 21-Aug-2010::04:20:36 ===&lt;br/&gt;
{thrift_socket_server,244,&lt;br/&gt;
    {child_error,&lt;br/&gt;
        {badmatch,&lt;br/&gt;
            &lt;tt&gt;transport,thrift_socket_transport,{data,#Port&amp;lt;0.647&amp;gt;,3600000&lt;/tt&gt;,&lt;br/&gt;
             &lt;/p&gt;
{error,closed}
&lt;p&gt;}},&lt;br/&gt;
        []}}&lt;/p&gt;

&lt;p&gt;Looking through the framed_transport it looks like it will currently crash in this way every time the client closes a connection.  The problem is in the read/2 call lines 73-80.  The current call has been finished and a read happens for the next call.  Unfortunately the client has disconnected so the thrift_transport:read call on line 76 returns &lt;/p&gt;
{error, closed}
&lt;p&gt;.  It looks like either of those read calls could result in a connection close.  So I&apos;ll try to put together a patch which passes the error outward since that&apos;s what really should happen.&lt;/p&gt;</comment>
                            <comment id="12903769" author="djnym" created="Sat, 28 Aug 2010 05:32:59 +0000"  >&lt;p&gt;This patch make sure that the thrift_framed_transport:read/2 function passes lower level read errors outward.  It solves the problem for me.  I&apos;ll be putting it into production soon.&lt;/p&gt;</comment>
                            <comment id="12904374" author="dreiss" created="Mon, 30 Aug 2010 22:16:42 +0000"  >&lt;p&gt;I renamed your &quot;_Reason&quot; variables to Reason1 and Reason2, because I don&apos;t think it&apos;s good to name variables with leading underscores if their values are used.&lt;/p&gt;</comment>
                            <comment id="12904536" author="djnym" created="Tue, 31 Aug 2010 06:46:25 +0000"  >&lt;p&gt;Yeah, I&apos;m sure I meant to remove the underscores, and just didn&apos;t quite catch it in the final patch, thanks for getting rid of those.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12444992" name="erlframedtest.erl" size="722" author="yosh" created="Wed, 19 May 2010 22:20:12 +0000"/>
                            <attachment id="12444991" name="erlframedtest.thrift" size="39" author="yosh" created="Wed, 19 May 2010 22:20:12 +0000"/>
                            <attachment id="12453337" name="thrift-erl-framed.patch" size="2293" author="djnym" created="Sat, 28 Aug 2010 05:32:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>186938</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16b8f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>244952</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>