<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:34:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-5595] TSocket errors with SSLSocket</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-5595</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;Starting with 0.14.0 - probably &lt;a href=&quot;https://github.com/apache/thrift/commit/01d53f483a7531ad4899b522060e8913dca309fb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt; commit - when we call isOpen on an open TSSLSocket we get an error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/michael/Impala/shell/build/py2_venv/local/lib/python2.7/site-packages/impala_shell/impala_client.py&quot;&lt;/span&gt;, line 226, in _close_transport
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; self.transport and self.transport.isOpen():
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/michael/Impala/shell/build/py2_venv/local/lib/python2.7/site-packages/impala_shell/thrift/transport/TTransport.py&quot;&lt;/span&gt;, line 150, in isOpen
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self.__trans.isOpen()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/michael/Impala/shell/build/py2_venv/local/lib/python2.7/site-packages/thrift/transport/TSocket.py&quot;&lt;/span&gt;, line 92, in isOpen
    peeked_bytes = self.handle.recv(1, socket.MSG_PEEK)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/lib/python2.7/ssl.py&quot;&lt;/span&gt;, line 753, in recv
    self.__class__)
ValueError: non-zero flags not allowed in calls to recv() on &amp;lt;class &lt;span class=&quot;code-quote&quot;&gt;&apos;ssl.SSLSocket&apos;&lt;/span&gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A relatively simple reproduction (if you have an open socket to connect to) is&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
from thrift.transport &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; TSSLSocket
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; ssl
sock = TSSLSocket.TSSLSocket(&lt;span class=&quot;code-quote&quot;&gt;&apos;localhost&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;21000&apos;&lt;/span&gt;, ssl.CERT_NONE, None, None, ssl_version=ssl.PROTOCOL_SSLv23)
sock.open()
sock.isOpen()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which produces&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;stdin&amp;gt;&quot;&lt;/span&gt;, line 1, in &amp;lt;module&amp;gt;
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/michael/Impala/shell/build/py3_venv/lib/python3.8/site-packages/thrift/transport/TSocket.py&quot;&lt;/span&gt;, line 92, in isOpen
    peeked_bytes = self.handle.recv(1, socket.MSG_PEEK)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/lib/python3.8/ssl.py&quot;&lt;/span&gt;, line 1223, in recv
    raise ValueError(
ValueError: non-zero flags not allowed in calls to recv() on &amp;lt;class &lt;span class=&quot;code-quote&quot;&gt;&apos;ssl.SSLSocket&apos;&lt;/span&gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ve reproduced this with python 2.7 and python 3.8.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13449077">THRIFT-5595</key>
            <summary>TSocket errors with SSLSocket</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="MikaelSmith">Michael Smith</assignee>
                                    <reporter username="MikaelSmith">Michael Smith</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Jun 2022 21:47:50 +0000</created>
                <updated>Wed, 26 Oct 2022 23:46:23 +0000</updated>
                            <resolved>Fri, 10 Jun 2022 15:42:25 +0000</resolved>
                                    <version>0.14.0</version>
                    <version>0.15.0</version>
                    <version>0.16.0</version>
                                    <fixVersion>0.17.0</fixVersion>
                                    <component>Python - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4200">1h 10m</timespent>
                                <comments>
                            <comment id="17551805" author="fishywang" created="Wed, 8 Jun 2022 22:07:24 +0000"  >&lt;p&gt;hmm it looks like python does have this restriction for SSLSocket but not for socket: &lt;a href=&quot;https://github.com/python/cpython/blob/feca9bbd1f6489f2b6d2783bfc22fdb96e45b69f/Lib/ssl.py#L1259-L1262&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/python/cpython/blob/feca9bbd1f6489f2b6d2783bfc22fdb96e45b69f/Lib/ssl.py#L1259-L1262&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;and I don&apos;t understand why.&lt;/p&gt;

&lt;p&gt;the easiest fix would be just catch that error on &lt;a href=&quot;https://github.com/apache/thrift/blob/4959a92385e2a6d7a4b8419784f85e5762c714cf/lib/py/src/transport/TSocket.py#L93&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/blob/4959a92385e2a6d7a4b8419784f85e5762c714cf/lib/py/src/transport/TSocket.py#L93&lt;/a&gt; to just give up on this check with SSLSocket, if we cannot figure out a way to do the same connectivity check with SSLSocket.&lt;/p&gt;

&lt;p&gt;feel free to create a PR for that.&lt;/p&gt;</comment>
                            <comment id="17551806" author="JIRAUSER288956" created="Wed, 8 Jun 2022 22:09:25 +0000"  >&lt;p&gt;We&apos;re using this to test if it&apos;s safe to `close` the socket. We could remove the check, except TSSLSocket doesn&apos;t check that handle is set before trying to use it (unlike TSocket).&lt;/p&gt;</comment>
                            <comment id="17551813" author="JIRAUSER288956" created="Wed, 8 Jun 2022 22:28:10 +0000"  >&lt;p&gt;I can probably look at fixing this next week, if not sooner. We&apos;ve worked around it for now by overriding &lt;tt&gt;isOpen&lt;/tt&gt;, because we already inherit TSSLSocket.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13449075">IMPALA-11343</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="13449536">IMPALA-11348</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 22 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z132ew:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>