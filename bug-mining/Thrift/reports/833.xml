<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:09:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-1892] Socket timeouts are declared in milli-seconds, but are actually set in micro-seconds</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-1892</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;Socket timeouts are declared in milliseconds in TSocket.h:&lt;/p&gt;

&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Set the connect timeout&lt;br/&gt;
   */&lt;br/&gt;
  void setConnTimeout(int ms);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Set the receive timeout&lt;br/&gt;
   */&lt;br/&gt;
  void setRecvTimeout(int ms);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Set the send timeout&lt;br/&gt;
   */&lt;br/&gt;
  void setSendTimeout(int ms);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;But, when i set timeout which is supposed to be 5000 seconds, and make a call to the service function that intentionally hangs, ETIMEDOUT exception occurs precisely after 5 seconds.&lt;/p&gt;

&lt;p&gt;  socket-&amp;gt;setConnTimeout(5*1000*1000);&lt;br/&gt;
  socket-&amp;gt;setRecvTimeout(5*1000*1000);&lt;br/&gt;
  socket-&amp;gt;setSendTimeout(5*1000*1000);&lt;/p&gt;

</description>
                <environment>&lt;p&gt;Windows 8 x64&lt;/p&gt;</environment>
        <key id="12637556">THRIFT-1892</key>
            <summary>Socket timeouts are declared in milli-seconds, but are actually set in micro-seconds</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ben.craig">Ben Craig</assignee>
                                    <reporter username="alexp-ru">Alexander</reporter>
                        <labels>
                            <label>cpp</label>
                            <label>socket</label>
                            <label>timeout</label>
                    </labels>
                <created>Mon, 18 Mar 2013 15:47:59 +0000</created>
                <updated>Thu, 9 Apr 2015 01:00:54 +0000</updated>
                            <resolved>Thu, 10 Oct 2013 14:55:02 +0000</resolved>
                                    <version>0.9</version>
                                    <fixVersion>0.9.2</fixVersion>
                                    <component>C++ - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13605247" author="ben.craig" created="Mon, 18 Mar 2013 16:04:39 +0000"  >&lt;p&gt;I looked at the code, and timeouts are wrong for both connection timeouts (handled in config.h) and send / recv timeouts (handled in TSocket.cpp), but these two are wrong for different reasons, and it isn&apos;t as simple as milliseconds being treated as microseconds.&lt;/p&gt;

&lt;p&gt;In config.h poll_win32 is turning a millisecond timeout &quot;int&quot; into a timeval structure, and doing so incorrectly.  It fills in the timeval via &lt;/p&gt;
{timeout/1000, timeout*1000}
&lt;p&gt;, but should do something like &lt;/p&gt;
{timeout/1000, (timeout%1000)*1000}
&lt;p&gt;.&lt;/p&gt;

&lt;p&gt;For the send and recv timeouts, setsockopt is called with a timeval, but WinSock is expecting a DWORD of milliseconds.  I suspect it is using the seconds parameter of the structure instead, which would mean that the value is off by a factor of 1000, matching the behavior observed in the bug description.&lt;/p&gt;</comment>
                            <comment id="13752904" author="ben.craig" created="Wed, 28 Aug 2013 21:55:15 +0000"  >&lt;p&gt;haven&apos;t tried applying this on a clean checkout, but it gets the idea across.  Either this, or something very similar to it will be my approach.&lt;/p&gt;</comment>
                            <comment id="13753190" author="xieliang007" created="Thu, 29 Aug 2013 02:12:07 +0000"  >&lt;p&gt;Is it just a windows platform related ?  or in other words, does LINUX be affected by this issue ?  thanks&lt;/p&gt;</comment>
                            <comment id="13753640" author="ben.craig" created="Thu, 29 Aug 2013 14:03:06 +0000"  >&lt;p&gt;It&apos;s Windows related.  *nix expects a timeval struct in the setsockopt call for setting timeouts, and Windows expects a DWORD.  Thrift doesn&apos;t currently account for this difference.&lt;/p&gt;</comment>
                            <comment id="13761967" author="ben.craig" created="Mon, 9 Sep 2013 16:13:54 +0000"  >&lt;p&gt;There was another timeout related issue in windows specific code.  This would have the symptom of connection timeouts lasting roughly double what was specified.  This patch fixes both sets of issues.&lt;/p&gt;</comment>
                            <comment id="13790818" author="jensg" created="Wed, 9 Oct 2013 20:20:16 +0000"  >&lt;p&gt;I can&apos;t manage that one to apply successfully, sorry. Seems not to be EOL this time.&lt;/p&gt;</comment>
                            <comment id="13790849" author="jensg" created="Wed, 9 Oct 2013 20:54:00 +0000"  >&lt;p&gt;+1, good catch and nice solution&lt;/p&gt;</comment>
                            <comment id="13791559" author="hudson" created="Thu, 10 Oct 2013 14:51:58 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #927 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/927/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/927/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1892&quot; title=&quot;Socket timeouts are declared in milli-seconds, but are actually set in micro-seconds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1892&quot;&gt;&lt;del&gt;THRIFT-1892&lt;/del&gt;&lt;/a&gt;: Socket timeouts are declared in milli-seconds, but are (bencraig: rev 71b5a10b613406765037ecd0e300769b34741c00)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/cpp/src/thrift/windows/WinFcntl.cpp&lt;/li&gt;
	&lt;li&gt;lib/cpp/src/thrift/transport/TSocket.h&lt;/li&gt;
	&lt;li&gt;lib/cpp/src/thrift/transport/TSocket.cpp&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12553229">THRIFT-1587</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12602156" name="winsock_mstimeouts.patch" size="4811" author="ben.craig" created="Mon, 9 Sep 2013 16:13:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>318047</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 6 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ivnb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>318388</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>