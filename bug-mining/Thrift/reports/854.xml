<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:10:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-2275] Fix memory leak in golang compact_protocol.</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-2275</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;After a long time running go program base on compact protocol, I found that the memory is just increase and never drop. After using go tool pprof to check the memory usage, I found in `ReadStructBegin` it push `lastFieldId` to the slice p.lastField. But in `ReadStructEnd`, it just assign the last element in `p.lastField` to `lastFieldId` and do not pop the last element.&lt;br/&gt;
So the length of `p.lastField` is just increasing...&lt;br/&gt;
To fix the bug,we need to pop the last element as the patch shows below:&lt;/p&gt;

&lt;p&gt;diff --git a/lib/go/thrift/compact_protocol.go b/lib/go/thrift/compact_protocol.go&lt;br/&gt;
index 74d36d0..f89fc2f 100644&lt;br/&gt;
&amp;#8212; a/lib/go/thrift/compact_protocol.go&lt;br/&gt;
+++ b/lib/go/thrift/compact_protocol.go&lt;br/&gt;
@@ -352,6 +352,7 @@ func (p *TCompactProtocol) ReadStructBegin() (name string, err error) {&lt;br/&gt;
 func (p *TCompactProtocol) ReadStructEnd() error &lt;/p&gt;
{
 	// consume the last field we read off the wire.
 	p.lastFieldId = p.lastField[len(p.lastField)-1]
+	p.lastField = p.lastField[:len(p.lastField)-1]
 	return nil
 }</description>
                <environment>&lt;p&gt;os x 10.9 &lt;/p&gt;</environment>
        <key id="12681732">THRIFT-2275</key>
            <summary>Fix memory leak in golang compact_protocol.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jensg">Jens Geyer</assignee>
                                    <reporter username="wizardcypress">bolin huang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 Nov 2013 10:20:11 +0000</created>
                <updated>Fri, 13 Dec 2013 16:41:36 +0000</updated>
                            <resolved>Thu, 28 Nov 2013 20:19:35 +0000</resolved>
                                                    <fixVersion>0.9.2</fixVersion>
                                    <component>Go - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13835064" author="jensg" created="Thu, 28 Nov 2013 20:19:35 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wizardcypress&quot; class=&quot;user-hover&quot; rel=&quot;wizardcypress&quot;&gt;wizardcypress&lt;/a&gt; for catching and fixing this, committed.&lt;/p&gt;

&lt;p&gt;Next time, please add a &lt;b&gt;patch &lt;ins&gt;file&lt;/ins&gt;&lt;/b&gt; instead of copying the diff into the text. This time, it was an very simple one-liner change, but that&apos;s not always the case.&lt;/p&gt;</comment>
                            <comment id="13835151" author="hudson" created="Fri, 29 Nov 2013 02:19:12 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #947 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/947/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/947/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2275&quot; title=&quot;Fix memory leak in golang compact_protocol.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2275&quot;&gt;&lt;del&gt;THRIFT-2275&lt;/del&gt;&lt;/a&gt; Fix memory leak in golang compact_protocol. (jensg: rev f322d917fb1f1465049ed29853081ef47ca16800)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/go/thrift/compact_protocol.go&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>360996</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 51 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1q89r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>361295</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>