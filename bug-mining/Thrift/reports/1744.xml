<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:26:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-3978] Thrift C++ runtime uses assert to prevent overflows, checks sanity only in debug builds</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-3978</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;Currently there is widespread use of assert in the thrift C++ runtime library.  Some of the more disturbing cases are security related, for example checking header sizes.  I recommend we eliminate assertions that are only checked in debug mode, and instead throw the appropriate exception, usually a TTransportException with CORRUPTED_DATA as the reason.  If we&apos;re going to check for an overflow or a buffer overrun, we should do so in debug and release modes.  Further, assertions are not easily tested whereas exceptions are.&lt;/p&gt;

&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3873&quot; title=&quot;Fix various build warnings when using Visual Studio&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3873&quot;&gt;&lt;del&gt;THRIFT-3873&lt;/del&gt;&lt;/a&gt; apache::thrift::transport::safe_numeric_cast was added, so I also suggest changing static_cast to safe_numeric_cast where appropriate throughout the transport code to catch any overflow errors.&lt;/p&gt;

&lt;p&gt;Another location where assert is used liberally is inside the posix Mutex implementation.&lt;/p&gt;</description>
                <environment>&lt;p&gt;All&lt;/p&gt;</environment>
        <key id="13021625">THRIFT-3978</key>
            <summary>Thrift C++ runtime uses assert to prevent overflows, checks sanity only in debug builds</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="jking3">James E. King III</assignee>
                                    <reporter username="jking3">James E. King III</reporter>
                        <labels>
                            <label>security</label>
                    </labels>
                <created>Thu, 17 Nov 2016 23:28:48 +0000</created>
                <updated>Fri, 11 Jan 2019 14:23:13 +0000</updated>
                                            <version>0.10.0</version>
                                                    <component>C++ - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15675133" author="jking3" created="Thu, 17 Nov 2016 23:29:34 +0000"  >&lt;p&gt;Discovered when addressing code review comments on &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3873&quot; title=&quot;Fix various build warnings when using Visual Studio&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3873&quot;&gt;&lt;del&gt;THRIFT-3873&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15949667" author="githubbot" created="Thu, 30 Mar 2017 19:37:43 +0000"  >&lt;p&gt;GitHub user jeking3 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1228&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1228&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3978&quot; title=&quot;Thrift C++ runtime uses assert to prevent overflows, checks sanity only in debug builds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3978&quot;&gt;THRIFT-3978&lt;/a&gt;: tighten up pthread mutex implementation, removing asserts and replacing them with exceptions&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jeking3/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jeking3/thrift&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3978&quot; title=&quot;Thrift C++ runtime uses assert to prevent overflows, checks sanity only in debug builds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3978&quot;&gt;THRIFT-3978&lt;/a&gt;-mutex&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1228.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1228.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1228&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 8323899a347a316b59443e1dd88ef0a7d1529748&lt;br/&gt;
Author: James E. King, III &amp;lt;jim.king@simplivity.com&amp;gt;&lt;br/&gt;
Date:   2017-03-30T19:30:03Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3978&quot; title=&quot;Thrift C++ runtime uses assert to prevent overflows, checks sanity only in debug builds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3978&quot;&gt;THRIFT-3978&lt;/a&gt;: tighten up pthread mutex implementation, removing asserts and replacing them with exceptions&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15952261" author="githubbot" created="Sat, 1 Apr 2017 15:00:25 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1228&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1228&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    For anybody interested in reviewing this pull request, I pretty much followed the logic that boost::mutex is using with one exception.  In cases where boost ignores an error condition to avoid throwing in a destructor, I have instead preferred to abort the process.  My thought process on this is that should mutex destruction return EBUSY or EINVAL, it is a design flaw in the implementation using the Mutex class.  EBUSY means we tried to delete the mutex while it was locked.  EINVAL means it may have been destroyed twice.  In either case, getting a core is way more useful than silently letting the issue pass by in a release build.&lt;/p&gt;</comment>
                            <comment id="15955144" author="githubbot" created="Tue, 4 Apr 2017 13:40:38 +0000"  >&lt;p&gt;Github user jeking3 closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1228&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1228&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16121982" author="jking3" created="Thu, 10 Aug 2017 17:46:20 +0000"  >&lt;p&gt;The following still need to be cleaned up before we can consider this story complete:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;jking@dvm:~/thrift/github/thrift$ find lib/cpp/src -type f -name &apos;*.cpp&apos; -exec grep -l &apos;assert&apos; {} \;
lib/cpp/src/thrift/VirtualProfiling.cpp
lib/cpp/src/thrift/windows/OverlappedSubmissionThread.cpp
lib/cpp/src/thrift/windows/TWinsockSingleton.cpp
lib/cpp/src/thrift/server/TNonblockingServer.cpp
lib/cpp/src/thrift/protocol/TBase64Utils.cpp
lib/cpp/src/thrift/protocol/TDebugProtocol.cpp
lib/cpp/src/thrift/protocol/THeaderProtocol.cpp
lib/cpp/src/thrift/protocol/TJSONProtocol.cpp
lib/cpp/src/thrift/concurrency/Monitor.cpp
lib/cpp/src/thrift/concurrency/BoostMonitor.cpp
lib/cpp/src/thrift/concurrency/TimerManager.cpp
lib/cpp/src/thrift/concurrency/StdThreadFactory.cpp
lib/cpp/src/thrift/concurrency/BoostThreadFactory.cpp
lib/cpp/src/thrift/concurrency/Util.cpp
lib/cpp/src/thrift/concurrency/StdMutex.cpp
lib/cpp/src/thrift/concurrency/Mutex.cpp
lib/cpp/src/thrift/concurrency/StdMonitor.cpp
lib/cpp/src/thrift/concurrency/BoostMutex.cpp
lib/cpp/src/thrift/concurrency/PosixThreadFactory.cpp
lib/cpp/src/thrift/transport/TFileTransport.cpp
lib/cpp/src/thrift/transport/TBufferTransports.cpp
lib/cpp/src/thrift/transport/TSSLSocket.cpp
lib/cpp/src/thrift/transport/TZlibTransport.cpp
lib/cpp/src/thrift/transport/TPipe.cpp
lib/cpp/src/thrift/async/TEvhttpClientChannel.cpp
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16734921" author="jking3" created="Sat, 5 Jan 2019 14:44:54 +0000"  >&lt;p&gt;By removing boost thread factory and posix thread factory, it may also resolve &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3978&quot; title=&quot;Thrift C++ runtime uses assert to prevent overflows, checks sanity only in debug builds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3978&quot;&gt;THRIFT-3978&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12987832">THRIFT-3873</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13208212">THRIFT-4730</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 45 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i36hdz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>