<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:29:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-4658] Rust&apos;s TBinaryInputProtocol fails when strict is false</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-4658</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;When use `TBinaryInputProtocol::new(..., false)`, any&#160;trivial example will fail:&lt;/p&gt;

&lt;p&gt;service TestService &lt;/p&gt;
{
 bool Test()
}

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Problem is here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/thrift/blob/master/lib/rs/src/protocol/binary.rs#L126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/blob/master/lib/rs/src/protocol/binary.rs#L126&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;with_capacity() allocates space, but len() of resulting Vec&amp;lt;&amp;gt; is 0.&#160; read_exact() reads 0 bytes&#160;and read_byte() below receives first byte of the string which may or may not convert to TMessageType.&lt;/p&gt;

&lt;p&gt;Change it to:&lt;br/&gt;
let mut name_buf: Vec&amp;lt;u8&amp;gt; = vec!&lt;span class=&quot;error&quot;&gt;&amp;#91;0; name_size&amp;#93;&lt;/span&gt;;&lt;br/&gt;
&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;`rustup show` output:&lt;/p&gt;

&lt;p&gt;Default host: x86_64-apple-darwin&lt;/p&gt;

&lt;p&gt;installed toolchains&lt;/p&gt;

&lt;p&gt;--------------------&lt;/p&gt;

&lt;p&gt;stable-x86_64-apple-darwin&lt;/p&gt;

&lt;p&gt;nightly-x86_64-apple-darwin&lt;/p&gt;

&lt;p&gt;active toolchain&lt;/p&gt;

&lt;p&gt;----------------&lt;/p&gt;

&lt;p&gt;stable-x86_64-apple-darwin (default)&lt;/p&gt;

&lt;p&gt;rustc 1.30.0 (da5f414c2 2018-10-24)&lt;/p&gt;</environment>
        <key id="13196098">THRIFT-4658</key>
            <summary>Rust&apos;s TBinaryInputProtocol fails when strict is false</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="allengeorge">Allen George</assignee>
                                    <reporter username="jeikabu">J W</reporter>
                        <labels>
                    </labels>
                <created>Sun, 4 Nov 2018 10:46:33 +0000</created>
                <updated>Thu, 27 Dec 2018 15:24:51 +0000</updated>
                            <resolved>Mon, 5 Nov 2018 12:59:38 +0000</resolved>
                                    <version>0.11.0</version>
                                    <fixVersion>0.12.0</fixVersion>
                                    <component>Rust - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16674483" author="allengeorge" created="Sun, 4 Nov 2018 19:37:41 +0000"  >&lt;p&gt;Ah - dammit. Sorry about that :/ I&apos;ll get the fix into 0.12.0. Thank you for tracking this down, BTW!&lt;/p&gt;</comment>
                            <comment id="16674594" author="githubbot" created="Mon, 5 Nov 2018 02:11:24 +0000"  >&lt;p&gt;allengeorge opened a new pull request #1620: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4658&quot; title=&quot;Rust&amp;#39;s TBinaryInputProtocol fails when strict is false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4658&quot;&gt;&lt;del&gt;THRIFT-4658&lt;/del&gt;&lt;/a&gt;: TBinaryInputProtocol fails when strict is false&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1620&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1620&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Client: rs&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16674595" author="githubbot" created="Mon, 5 Nov 2018 02:13:37 +0000"  >&lt;p&gt;allengeorge commented on issue #1620: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4658&quot; title=&quot;Rust&amp;#39;s TBinaryInputProtocol fails when strict is false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4658&quot;&gt;&lt;del&gt;THRIFT-4658&lt;/del&gt;&lt;/a&gt;: TBinaryInputProtocol fails when strict is false&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1620#issuecomment-435734864&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1620#issuecomment-435734864&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Note:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Added unit tests&lt;/li&gt;
	&lt;li&gt;Ran cross-tests in docker&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16675035" author="githubbot" created="Mon, 5 Nov 2018 12:08:05 +0000"  >&lt;p&gt;allengeorge commented on issue #1620: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4658&quot; title=&quot;Rust&amp;#39;s TBinaryInputProtocol fails when strict is false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4658&quot;&gt;&lt;del&gt;THRIFT-4658&lt;/del&gt;&lt;/a&gt;: TBinaryInputProtocol fails when strict is false&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1620#issuecomment-435852206&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1620#issuecomment-435852206&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &lt;span class=&quot;error&quot;&gt;&amp;#91;puzzled&amp;#93;&lt;/span&gt; There appears to be a failure in a sub-build, but it doesn&apos;t have to do with the PR.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16675036" author="githubbot" created="Mon, 5 Nov 2018 12:09:04 +0000"  >&lt;p&gt;allengeorge edited a comment on issue #1620: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4658&quot; title=&quot;Rust&amp;#39;s TBinaryInputProtocol fails when strict is false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4658&quot;&gt;&lt;del&gt;THRIFT-4658&lt;/del&gt;&lt;/a&gt;: TBinaryInputProtocol fails when strict is false&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1620#issuecomment-435852206&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1620#issuecomment-435852206&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &lt;span class=&quot;error&quot;&gt;&amp;#91;puzzled&amp;#93;&lt;/span&gt; There appears to be a failure in a sub-build, but it doesn&apos;t have to do with the PR.&lt;/p&gt;

&lt;p&gt;   Not sure how I can kick off the build again?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16675062" author="githubbot" created="Mon, 5 Nov 2018 12:24:13 +0000"  >&lt;p&gt;allengeorge commented on issue #1620: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4658&quot; title=&quot;Rust&amp;#39;s TBinaryInputProtocol fails when strict is false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4658&quot;&gt;&lt;del&gt;THRIFT-4658&lt;/del&gt;&lt;/a&gt;: TBinaryInputProtocol fails when strict is false&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1620#issuecomment-435856200&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1620#issuecomment-435856200&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @jeking3 The rust changes seem OK. Not sure why one of the sub-builds failed. Would it be possible to kick off the sub-build again or merge the changes please?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16675104" author="githubbot" created="Mon, 5 Nov 2018 12:58:55 +0000"  >&lt;p&gt;jeking3 closed pull request #1620: &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4658&quot; title=&quot;Rust&amp;#39;s TBinaryInputProtocol fails when strict is false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4658&quot;&gt;&lt;del&gt;THRIFT-4658&lt;/del&gt;&lt;/a&gt;: TBinaryInputProtocol fails when strict is false&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/thrift/pull/1620&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1620&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/lib/rs/src/protocol/binary.rs b/lib/rs/src/protocol/binary.rs&lt;br/&gt;
index 8505b63344..42c6c97511 100644&lt;br/&gt;
&amp;#8212; a/lib/rs/src/protocol/binary.rs&lt;br/&gt;
+++ b/lib/rs/src/protocol/binary.rs&lt;br/&gt;
@@ -123,7 +123,7 @@ where&lt;br/&gt;
                 // is the message name. strings (byte arrays) are length-prefixed,&lt;br/&gt;
                 // so we&apos;ve just read the length in the first 4 bytes&lt;br/&gt;
                 let name_size = BigEndian::read_i32(&amp;amp;first_bytes) as usize;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;let mut name_buf: Vec&amp;lt;u8&amp;gt; = Vec::with_capacity(name_size);&lt;br/&gt;
+                let mut name_buf: Vec&amp;lt;u8&amp;gt; = vec!&lt;span class=&quot;error&quot;&gt;&amp;#91;0; name_size&amp;#93;&lt;/span&gt;;&lt;br/&gt;
                 self.transport.read_exact(&amp;amp;mut name_buf)?;&lt;br/&gt;
                 let name = String::from_utf8(name_buf)?;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -544,8 +544,8 @@ mod tests {&lt;br/&gt;
     use super::*;&lt;/p&gt;

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fn must_write_message_call_begin() {&lt;/li&gt;
	&lt;li&gt;let (_, mut o_prot) = test_objects();&lt;br/&gt;
+    fn must_write_strict_message_call_begin() {&lt;br/&gt;
+        let (_, mut o_prot) = test_objects(true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         let ident = TMessageIdentifier::new(&quot;test&quot;, TMessageType::Call, 1);&lt;br/&gt;
         assert!(o_prot.write_message_begin(&amp;amp;ident).is_ok());&lt;br/&gt;
@@ -573,8 +573,34 @@ mod tests {&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fn must_write_message_reply_begin() {&lt;/li&gt;
	&lt;li&gt;let (_, mut o_prot) = test_objects();&lt;br/&gt;
+    fn must_write_non_strict_message_call_begin() 
{
+        let (_, mut o_prot) = test_objects(false);
+
+        let ident = TMessageIdentifier::new(&quot;test&quot;, TMessageType::Call, 1);
+        assert!(o_prot.write_message_begin(&amp;amp;ident).is_ok());
+
+        let expected: [u8; 13] = [
+            0x00,
+            0x00,
+            0x00,
+            0x04,
+            0x74,
+            0x65,
+            0x73,
+            0x74,
+            0x01,
+            0x00,
+            0x00,
+            0x00,
+            0x01,
+        ];
+
+        assert_eq_written_bytes!(o_prot, expected);
+    }
&lt;p&gt;+&lt;br/&gt;
+    #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
+    fn must_write_strict_message_reply_begin() {&lt;br/&gt;
+        let (_, mut o_prot) = test_objects(true);&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         let ident = TMessageIdentifier::new(&quot;test&quot;, TMessageType::Reply, 10);&lt;br/&gt;
         assert!(o_prot.write_message_begin(&amp;amp;ident).is_ok());&lt;br/&gt;
@@ -601,9 +627,48 @@ mod tests &lt;/p&gt;
{
         assert_eq_written_bytes!(o_prot, expected);
     }

&lt;p&gt;+    #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
+    fn must_write_non_strict_message_reply_begin() &lt;/p&gt;
{
+        let (_, mut o_prot) = test_objects(false);
+
+        let ident = TMessageIdentifier::new(&quot;test&quot;, TMessageType::Reply, 10);
+        assert!(o_prot.write_message_begin(&amp;amp;ident).is_ok());
+
+        let expected: [u8; 13] = [
+            0x00,
+            0x00,
+            0x00,
+            0x04,
+            0x74,
+            0x65,
+            0x73,
+            0x74,
+            0x02,
+            0x00,
+            0x00,
+            0x00,
+            0x0A,
+        ];
+
+        assert_eq_written_bytes!(o_prot, expected);
+    }
&lt;p&gt;+&lt;br/&gt;
     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_round_trip_strict_message_begin() &lt;/p&gt;
{
-        let (mut i_prot, mut o_prot) = test_objects();
+        let (mut i_prot, mut o_prot) = test_objects(true);
+
+        let sent_ident = TMessageIdentifier::new(&quot;test&quot;, TMessageType::Call, 1);
+        assert!(o_prot.write_message_begin(&amp;amp;sent_ident).is_ok());
+
+        copy_write_buffer_to_read_buffer!(o_prot);
+
+        let received_ident = assert_success!(i_prot.read_message_begin());
+        assert_eq!(&amp;amp;received_ident, &amp;amp;sent_ident);
+    }
&lt;p&gt;+&lt;br/&gt;
+    #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
+    fn must_round_trip_non_strict_message_begin() {&lt;br/&gt;
+        let (mut i_prot, mut o_prot) = test_objects(false);&lt;/p&gt;

&lt;p&gt;         let sent_ident = TMessageIdentifier::new(&quot;test&quot;, TMessageType::Call, 1);&lt;br/&gt;
         assert!(o_prot.write_message_begin(&amp;amp;sent_ident).is_ok());&lt;br/&gt;
@@ -616,22 +681,22 @@ mod tests {&lt;/p&gt;

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_write_message_end() &lt;/p&gt;
{
-        assert_no_write(|o| o.write_message_end());
+        assert_no_write(|o| o.write_message_end(), true);
     }

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_write_struct_begin() &lt;/p&gt;
{
-        assert_no_write(|o| o.write_struct_begin(&amp;amp;TStructIdentifier::new(&quot;foo&quot;)));
+        assert_no_write(|o| o.write_struct_begin(&amp;amp;TStructIdentifier::new(&quot;foo&quot;)), true);
     }

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_write_struct_end() &lt;/p&gt;
{
-        assert_no_write(|o| o.write_struct_end());
+        assert_no_write(|o| o.write_struct_end(), true);
     }

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_write_field_begin() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;let (_, mut o_prot) = test_objects();&lt;br/&gt;
+        let (_, mut o_prot) = test_objects(true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         assert!(&lt;br/&gt;
             o_prot&lt;br/&gt;
@@ -645,7 +710,7 @@ mod tests {&lt;/p&gt;

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_round_trip_field_begin() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;let (mut i_prot, mut o_prot) = test_objects();&lt;br/&gt;
+        let (mut i_prot, mut o_prot) = test_objects(true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         let sent_field_ident = TFieldIdentifier::new(&quot;foo&quot;, TType::I64, 20);&lt;br/&gt;
         assert!(o_prot.write_field_begin(&amp;amp;sent_field_ident).is_ok());&lt;br/&gt;
@@ -663,7 +728,7 @@ mod tests {&lt;/p&gt;

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_write_stop_field() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;let (_, mut o_prot) = test_objects();&lt;br/&gt;
+        let (_, mut o_prot) = test_objects(true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         assert!(o_prot.write_field_stop().is_ok());&lt;/p&gt;

&lt;p&gt;@@ -673,7 +738,7 @@ mod tests {&lt;/p&gt;

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_round_trip_field_stop() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;let (mut i_prot, mut o_prot) = test_objects();&lt;br/&gt;
+        let (mut i_prot, mut o_prot) = test_objects(true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         assert!(o_prot.write_field_stop().is_ok());&lt;/p&gt;

&lt;p&gt;@@ -691,12 +756,12 @@ mod tests {&lt;/p&gt;

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_write_field_end() &lt;/p&gt;
{
-        assert_no_write(|o| o.write_field_end());
+        assert_no_write(|o| o.write_field_end(), true);
     }

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_write_list_begin() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;let (_, mut o_prot) = test_objects();&lt;br/&gt;
+        let (_, mut o_prot) = test_objects(true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         assert!(&lt;br/&gt;
             o_prot&lt;br/&gt;
@@ -710,7 +775,7 @@ mod tests {&lt;/p&gt;

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_round_trip_list_begin() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;let (mut i_prot, mut o_prot) = test_objects();&lt;br/&gt;
+        let (mut i_prot, mut o_prot) = test_objects(true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         let ident = TListIdentifier::new(TType::List, 900);&lt;br/&gt;
         assert!(o_prot.write_list_begin(&amp;amp;ident).is_ok());&lt;br/&gt;
@@ -723,12 +788,12 @@ mod tests {&lt;/p&gt;

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_write_list_end() &lt;/p&gt;
{
-        assert_no_write(|o| o.write_list_end());
+        assert_no_write(|o| o.write_list_end(), true);
     }

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_write_set_begin() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;let (_, mut o_prot) = test_objects();&lt;br/&gt;
+        let (_, mut o_prot) = test_objects(true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         assert!(&lt;br/&gt;
             o_prot&lt;br/&gt;
@@ -742,7 +807,7 @@ mod tests {&lt;/p&gt;

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_round_trip_set_begin() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;let (mut i_prot, mut o_prot) = test_objects();&lt;br/&gt;
+        let (mut i_prot, mut o_prot) = test_objects(true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         let ident = TSetIdentifier::new(TType::I64, 2000);&lt;br/&gt;
         assert!(o_prot.write_set_begin(&amp;amp;ident).is_ok());&lt;br/&gt;
@@ -756,12 +821,12 @@ mod tests {&lt;/p&gt;

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_write_set_end() &lt;/p&gt;
{
-        assert_no_write(|o| o.write_set_end());
+        assert_no_write(|o| o.write_set_end(), true);
     }

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_write_map_begin() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;let (_, mut o_prot) = test_objects();&lt;br/&gt;
+        let (_, mut o_prot) = test_objects(true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         assert!(&lt;br/&gt;
             o_prot&lt;br/&gt;
@@ -775,7 +840,7 @@ mod tests {&lt;/p&gt;

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_round_trip_map_begin() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;let (mut i_prot, mut o_prot) = test_objects();&lt;br/&gt;
+        let (mut i_prot, mut o_prot) = test_objects(true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         let ident = TMapIdentifier::new(TType::Map, TType::Set, 100);&lt;br/&gt;
         assert!(o_prot.write_map_begin(&amp;amp;ident).is_ok());&lt;br/&gt;
@@ -788,12 +853,12 @@ mod tests {&lt;/p&gt;

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_write_map_end() &lt;/p&gt;
{
-        assert_no_write(|o| o.write_map_end());
+        assert_no_write(|o| o.write_map_end(), true);
     }

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_write_bool_true() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;let (_, mut o_prot) = test_objects();&lt;br/&gt;
+        let (_, mut o_prot) = test_objects(true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         assert!(o_prot.write_bool(true).is_ok());&lt;/p&gt;

&lt;p&gt;@@ -803,7 +868,7 @@ mod tests {&lt;/p&gt;

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_write_bool_false() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;let (_, mut o_prot) = test_objects();&lt;br/&gt;
+        let (_, mut o_prot) = test_objects(true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         assert!(o_prot.write_bool(false).is_ok());&lt;/p&gt;

&lt;p&gt;@@ -813,7 +878,7 @@ mod tests {&lt;/p&gt;

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_read_bool_true() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;let (mut i_prot, _) = test_objects();&lt;br/&gt;
+        let (mut i_prot, _) = test_objects(true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         set_readable_bytes!(i_prot, &amp;amp;&lt;span class=&quot;error&quot;&gt;&amp;#91;0x01&amp;#93;&lt;/span&gt;);&lt;/p&gt;

&lt;p&gt;@@ -823,7 +888,7 @@ mod tests {&lt;/p&gt;

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_read_bool_false() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;let (mut i_prot, _) = test_objects();&lt;br/&gt;
+        let (mut i_prot, _) = test_objects(true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         set_readable_bytes!(i_prot, &amp;amp;&lt;span class=&quot;error&quot;&gt;&amp;#91;0x00&amp;#93;&lt;/span&gt;);&lt;/p&gt;

&lt;p&gt;@@ -833,7 +898,7 @@ mod tests {&lt;/p&gt;

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_allow_any_non_zero_value_to_be_interpreted_as_bool_true() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;let (mut i_prot, _) = test_objects();&lt;br/&gt;
+        let (mut i_prot, _) = test_objects(true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         set_readable_bytes!(i_prot, &amp;amp;&lt;span class=&quot;error&quot;&gt;&amp;#91;0xAC&amp;#93;&lt;/span&gt;);&lt;/p&gt;

&lt;p&gt;@@ -843,7 +908,7 @@ mod tests {&lt;/p&gt;

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_write_bytes() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;let (_, mut o_prot) = test_objects();&lt;br/&gt;
+        let (_, mut o_prot) = test_objects(true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         let bytes: &lt;span class=&quot;error&quot;&gt;&amp;#91;u8; 10&amp;#93;&lt;/span&gt; = &lt;span class=&quot;error&quot;&gt;&amp;#91;0x0A, 0xCC, 0xD1, 0x84, 0x99, 0x12, 0xAB, 0xBB, 0x45, 0xDF&amp;#93;&lt;/span&gt;;&lt;/p&gt;

&lt;p&gt;@@ -856,7 +921,7 @@ mod tests {&lt;/p&gt;

&lt;p&gt;     #&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;&lt;br/&gt;
     fn must_round_trip_bytes() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;let (mut i_prot, mut o_prot) = test_objects();&lt;br/&gt;
+        let (mut i_prot, mut o_prot) = test_objects(true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         let bytes: &lt;span class=&quot;error&quot;&gt;&amp;#91;u8; 25&amp;#93;&lt;/span&gt; = [&lt;br/&gt;
             0x20,&lt;br/&gt;
@@ -894,7 +959,7 @@ mod tests &lt;/p&gt;
{
         assert_eq!(&amp;amp;received_bytes, &amp;amp;bytes);
     }

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fn test_objects()&lt;br/&gt;
+    fn test_objects(strict: bool)&lt;br/&gt;
         -&amp;gt; (TBinaryInputProtocol&amp;lt;ReadHalf&amp;lt;TBufferChannel&amp;gt;&amp;gt;,&lt;br/&gt;
             TBinaryOutputProtocol&amp;lt;WriteHalf&amp;lt;TBufferChannel&amp;gt;&amp;gt;)&lt;br/&gt;
     {&lt;br/&gt;
@@ -902,17 +967,17 @@ mod tests 
{
 
         let (r_mem, w_mem) = mem.split().unwrap();
 
-        let i_prot = TBinaryInputProtocol::new(r_mem, true);
-        let o_prot = TBinaryOutputProtocol::new(w_mem, true);
+        let i_prot = TBinaryInputProtocol::new(r_mem, strict);
+        let o_prot = TBinaryOutputProtocol::new(w_mem, strict);
 
         (i_prot, o_prot)
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fn assert_no_write&amp;lt;F&amp;gt;(mut write_fn: F)&lt;br/&gt;
+    fn assert_no_write&amp;lt;F&amp;gt;(mut write_fn: F, strict: bool)&lt;br/&gt;
     where&lt;br/&gt;
         F: FnMut(&amp;amp;mut TBinaryOutputProtocol&amp;lt;WriteHalf&amp;lt;TBufferChannel&amp;gt;&amp;gt;) -&amp;gt; ::Result&amp;lt;()&amp;gt;,
     {
-        let (_, mut o_prot) = test_objects();
+        let (_, mut o_prot) = test_objects(strict);
         assert!(write_fn(&amp;amp;mut o_prot).is_ok());
         assert_eq!(o_prot.transport.write_bytes().len(), 0);
     }&lt;/li&gt;
&lt;/ul&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16675106" author="jking3" created="Mon, 5 Nov 2018 12:59:38 +0000"  >&lt;p&gt;If this gets pulled into the 0.12.0 build branch someone will need to change the &quot;Fix Version/s&quot;.&lt;/p&gt;</comment>
                            <comment id="16675108" author="allengeorge" created="Mon, 5 Nov 2018 13:01:01 +0000"  >&lt;p&gt;I changed the &quot;Fix Version/s&quot; to 0.12.0. I&apos;ll also create a separate PR for master.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 2 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s003mg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>