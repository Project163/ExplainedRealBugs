<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:58:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-945] TAsyncClient class&apos;s currentMethod is never set, hence a second call on the same client will fail if a previous call is ongoing.</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-945</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;TAsyncClient has this check:&lt;/p&gt;

&lt;p&gt;  protected void checkReady() {&lt;br/&gt;
    // Ensure we are not currently executing a method&lt;br/&gt;
    if (currentMethod != null) &lt;/p&gt;
{
      throw new IllegalStateException(&quot;Client is currently executing another method: &quot; + currentMethod.getClass().getName());
    }

&lt;p&gt;However currentMethod is not being set anywhere. &lt;br/&gt;
In my code I have a TAsyncClient  and  method calls made on it are not necessarily serialized (one starts after previous finishes), so interleaving calls will fail with mysterious messages such as:&lt;/p&gt;

&lt;p&gt;java.lang.IllegalArgumentException&lt;br/&gt;
	at java.nio.ByteBuffer.allocate(ByteBuffer.java:311)&lt;br/&gt;
	at org.apache.thrift.async.TAsyncMethodCall.doReadingResponseSize(TAsyncMethodCall.java:175)&lt;br/&gt;
	at org.apache.thrift.async.TAsyncMethodCall.transition(TAsyncMethodCall.java:128)&lt;br/&gt;
	at org.apache.thrift.async.TAsyncClientManager$SelectThread.run(TAsyncClientManager.java:99)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12475905">THRIFT-945</key>
            <summary>TAsyncClient class&apos;s currentMethod is never set, hence a second call on the same client will fail if a previous call is ongoing.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanduxbury">Bryan Duxbury</assignee>
                                    <reporter username="jpenguin">Zhenlei Cai</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Oct 2010 23:29:18 +0000</created>
                <updated>Wed, 6 Oct 2010 16:52:52 +0000</updated>
                            <resolved>Wed, 6 Oct 2010 00:28:22 +0000</resolved>
                                    <version>0.4</version>
                                                    <component>Java - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12918326" author="ericcj" created="Tue, 5 Oct 2010 23:41:50 +0000"  >&lt;p&gt;it&apos;s a common misunderstanding that this client could possibly support concurrent calls.  it cannot since it is backed only by a single socket just like the blocking Client calls.  if you want concurrent calls you must pool these clients or their sockets yourself.&lt;/p&gt;</comment>
                            <comment id="12918340" author="bryanduxbury" created="Tue, 5 Oct 2010 23:59:40 +0000"  >&lt;p&gt;This patch adds a test and appears to fix the issue. Thoughts?&lt;/p&gt;</comment>
                            <comment id="12918345" author="ericcj" created="Wed, 6 Oct 2010 00:12:02 +0000"  >&lt;p&gt;oh, the title of this ticket confused me.  the bug we are really fixing is that it fails with the wrong, uninformative, message if you try to make a concurrent call.  do we really intend for these to not be reusable?  i think the only problem we should protect against is using them for two concurrent calls as opposed to making them non-reusable.  ning?&lt;/p&gt;</comment>
                            <comment id="12918347" author="bryanduxbury" created="Wed, 6 Oct 2010 00:14:42 +0000"  >&lt;p&gt;It&apos;s not just the error message. It&apos;s that the error you&apos;d get if you tried to make two method calls with the same in-use TAsyncClient was concurrency related rather than state related.&lt;/p&gt;</comment>
                            <comment id="12918350" author="ning" created="Wed, 6 Oct 2010 00:22:42 +0000"  >&lt;p&gt;This looks like the fix we want, I think the name of the test is just a bit confusing. Maybe &quot;testItRaisesExceptionOnConcurrentUsage&quot;? The message thrown should be correct now - &quot;Client is currently executing another method ...&quot;&lt;/p&gt;</comment>
                            <comment id="12918352" author="bryanduxbury" created="Wed, 6 Oct 2010 00:27:13 +0000"  >&lt;p&gt;Fair enough. I&apos;ll commit the patch with that change in a second.&lt;/p&gt;</comment>
                            <comment id="12918353" author="bryanduxbury" created="Wed, 6 Oct 2010 00:28:22 +0000"  >&lt;p&gt;I just committed this.&lt;/p&gt;</comment>
                            <comment id="12918362" author="jpenguin" created="Wed, 6 Oct 2010 00:53:29 +0000"  >&lt;p&gt;FYI I am not calling the same TAsyncClient from two threads, I am calling from only one thread it&apos;s just the calls are made very rapidly like 10000 calls per second, so one call starts before the other finishes.  &lt;/p&gt;</comment>
                            <comment id="12918545" author="bryanduxbury" created="Wed, 6 Oct 2010 14:55:45 +0000"  >&lt;p&gt;With this patch, the error message will be improved, but it&apos;s still not OK to try to make another method call before the first one is complete. &lt;/p&gt;</comment>
                            <comment id="12918588" author="ericcj" created="Wed, 6 Oct 2010 16:52:52 +0000"  >&lt;p&gt;i&apos;ve had to clarify this to a few people already.  maybe we could improve the documentation somehow?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12456453" name="thrift-945.patch" size="2939" author="bryanduxbury" created="Tue, 5 Oct 2010 23:59:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>187073</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 7 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16dnb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245343</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>