<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:58:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-869] TSocket.py on Mac (and FreeBSD) doesn&apos;t handle ECONNRESET from recv()</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-869</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;Use of Python&apos;s TSocket.read() will produce a lot of stack traces like the following:&lt;/p&gt;

&lt;p&gt;Traceback (most recent call last):&lt;br/&gt;
  File &quot;net/mtvhome46.nfs/vol/mtvhome46/sgk/src/presto1/presto/third_party/thrift/Darwin/lib/python2.5/site-packages/thrift/server/TServer.py&quot;, line 83, in serve&lt;br/&gt;
  File &quot;/net/mtvhome46.nfs/vol/mtvhome46/sgk/src/presto1/presto/build/Darwin/lib/presto/pylib/presto/PrestoService.py&quot;, line 94, in process&lt;br/&gt;
    (name, type, seqid) = iprot.readMessageBegin()&lt;br/&gt;
  File &quot;net/mtvhome46.nfs/vol/mtvhome46/sgk/src/presto1/presto/third_party/thrift/Darwin/lib/python2.5/site-packages/thrift/protocol/TBinaryProtocol.py&quot;, line 126, in readMessageBegin&lt;br/&gt;
  File &quot;net/mtvhome46.nfs/vol/mtvhome46/sgk/src/presto1/presto/third_party/thrift/Darwin/lib/python2.5/site-packages/thrift/protocol/TBinaryProtocol.py&quot;, line 203, in readI32&lt;br/&gt;
  File &quot;net/mtvhome46.nfs/vol/mtvhome46/sgk/src/presto1/presto/third_party/thrift/Darwin/lib/python2.5/site-packages/thrift/transport/TTransport.py&quot;, line 58, in readAll&lt;br/&gt;
  File &quot;net/mtvhome46.nfs/vol/mtvhome46/sgk/src/presto1/presto/third_party/thrift/Darwin/lib/python2.5/site-packages/thrift/transport/TTransport.py&quot;, line 155, in read&lt;br/&gt;
  File &quot;net/mtvhome46.nfs/vol/mtvhome46/sgk/src/presto1/presto/third_party/thrift/Darwin/lib/python2.5/site-packages/thrift/transport/TSocket.py&quot;, line 92, in read&lt;br/&gt;
error: (54, &apos;Connection reset by peer&apos;)&lt;/p&gt;

&lt;p&gt;The underlying issue is explained by the following #ifdef&apos;ed code in the C++ implementation, line 305 in the 0.4.0 version of lib/cpp/src/transport/TSocket.cpp:&lt;/p&gt;

&lt;p&gt;    #if defined _&lt;em&gt;FreeBSD&lt;/em&gt;_ || defined _&lt;em&gt;MACH&lt;/em&gt;_&lt;br/&gt;
    if (errno_copy == ECONNRESET) &lt;/p&gt;
{
      /* shigin: freebsd doesn&apos;t follow POSIX semantic of recv and fails with
       * ECONNRESET if peer performed shutdown 
       */
      close();
      return 0;
    }
&lt;p&gt;    #endif&lt;/p&gt;

&lt;p&gt;TSocket.py doesn&apos;t have any corresponding logic to handle this deviation from POSIX semantics.  I&apos;ll attach a patch that implements logic similar to the C++ code, and which fixes the problem for me.&lt;/p&gt;

&lt;p&gt;The patch might want some clean up for efficiency.  I was cautious and had it check (every time an exception is handled) for whether there is, in fact, an errno.ECONNRESET attribute, on the off-chance that some other Python platform out there might not provide it.  I also have it check (only if ECONNRESET is received) for whether we&apos;re actually on a Darwin or FreeBSD system, to avoid swallowing the exception on other, well-behaved systems.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Mac OS X (Darwin).&lt;br/&gt;
Also presumably on FreeBSD (although I don&apos;t have a FreeBSD system available for testing).&lt;/p&gt;</environment>
        <key id="12472531">THRIFT-869</key>
            <summary>TSocket.py on Mac (and FreeBSD) doesn&apos;t handle ECONNRESET from recv()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sgk">Steven Knight</assignee>
                                    <reporter username="sgk">Steven Knight</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Aug 2010 22:11:55 +0000</created>
                <updated>Tue, 1 Nov 2011 02:51:55 +0000</updated>
                            <resolved>Mon, 30 Aug 2010 21:58:10 +0000</resolved>
                                    <version>0.4</version>
                                    <fixVersion>0.5</fixVersion>
                                    <component>Python - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12903121" author="dreiss" created="Thu, 26 Aug 2010 22:45:57 +0000"  >&lt;p&gt;I don&apos;t think you need to check whether ECONNRESET is defined.  Can you drop that test and also do the imports at global scope?  Also, can you attach a unified diff?&lt;/p&gt;</comment>
                            <comment id="12903699" author="sgk" created="Fri, 27 Aug 2010 23:07:54 +0000"  >&lt;p&gt;Updated patch:  moved imports, removed hasattr(&apos;ECONNRESET&apos;) check, diff -u output.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12453314" name="TSocket.ECONNRESET-2.patch" size="1169" author="sgk" created="Fri, 27 Aug 2010 23:07:54 +0000"/>
                            <attachment id="12453080" name="TSocket.ECONNRESET.patch" size="1394" author="sgk" created="Wed, 25 Aug 2010 22:13:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>187011</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 13 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16bsn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245043</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>