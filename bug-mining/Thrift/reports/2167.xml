<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:33:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-5369] Malformed payload can still cause huge allocations</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-5369</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;While testing Jaeger with the fix provided as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-5322&quot; title=&quot;Go compact_protocol allocating unreasonable buffer size&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-5322&quot;&gt;&lt;del&gt;THRIFT-5322&lt;/del&gt;&lt;/a&gt;, users in our community reported that they are still seeing huge allocations when malformed packets are received by our backend (jaeger-agent). See the &lt;a href=&quot;https://github.com/jaegertracing/jaeger/issues/2638#issuecomment-791242270&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;discussion starting from this comment by vchirikov on Mar 5&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;Based on the comment from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fishywang&quot; class=&quot;user-hover&quot; rel=&quot;fishywang&quot;&gt;fishywang&lt;/a&gt; in the issue linked above, I understand that the issue should be addressed at both the compiler and the Go library:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The sanity check on container header should be done in thrift go library (github.com/apache/thrift/lib/go/thrift)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;If you want to avoid allocation of the containers upfront after it passed the header sanity check, then that needs to be don in thrift compiler (in generated go code)&lt;/p&gt;&lt;/blockquote&gt;
</description>
                <environment></environment>
        <key id="13364057">THRIFT-5369</key>
            <summary>Malformed payload can still cause huge allocations</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fishywang">Yuxuan Wang</assignee>
                                    <reporter username="jpkroehling">Juraci Paix&#227;o Kr&#246;hling</reporter>
                        <labels>
                    </labels>
                <created>Fri, 12 Mar 2021 08:42:09 +0000</created>
                <updated>Sat, 11 Sep 2021 12:31:08 +0000</updated>
                            <resolved>Mon, 14 Jun 2021 07:45:25 +0000</resolved>
                                    <version>0.14.1</version>
                                    <fixVersion>0.15.0</fixVersion>
                    <fixVersion>0.14.2</fixVersion>
                                    <component>Go - Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="7800">2h 10m</timespent>
                                <comments>
                            <comment id="17309400" author="jensg" created="Fri, 26 Mar 2021 12:36:47 +0000"  >&lt;p&gt;Did you consider to limit MaxMessageSize? If that does not work then there might be an impl bug. &lt;/p&gt;

&lt;p&gt;Having another separate setting just for containers raiises the question if we should also limit strings and binary separately? And finally, if we implemented all of this,&#160;what we need the then totally redundant MaxMessageSize for? I don&apos;t want to stay in the way but I personally think it is not the right way to add more code only to cover weaknesses of the existing implementation.&lt;/p&gt;</comment>
                            <comment id="17309402" author="jensg" created="Fri, 26 Mar 2021 12:38:54 +0000"  >&lt;p&gt;Test case:&lt;/p&gt;

&lt;p&gt;struct&#160;Foo &lt;/p&gt;
{

&#160;&#160; 1 : string bar

}

&lt;p&gt;You can put that into a container with limit 1 and I still can blow the server. I only need the string to be big enough.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17309424" author="fishywang" created="Fri, 26 Mar 2021 13:28:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jensg&quot; class=&quot;user-hover&quot; rel=&quot;jensg&quot;&gt;jensg&lt;/a&gt; strings and binary are already limited in &lt;a href=&quot;https://github.com/apache/thrift/pull/2296&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/2296&lt;/a&gt; (by MaxMessageSize).&lt;/p&gt;

&lt;p&gt;We can also just limit container size by MaxMessageSize. The problem with that is MaxMessageSize &lt;a href=&quot;https://github.com/apache/thrift/blob/b87873222a509f5c6ba07e9d7c78d7b20909f805/lib/go/thrift/configuration.go#L30&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;defaults to 100M&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17309670" author="jensg" created="Fri, 26 Mar 2021 19:20:29 +0000"  >&lt;p&gt;&amp;gt; strings and binary are already limited (by MaxMessageSize).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Correct. So are containers. .&lt;/p&gt;</comment>
                            <comment id="17309682" author="fishywang" created="Fri, 26 Mar 2021 19:35:25 +0000"  >&lt;p&gt;not yet. but if you prefer to just use max message size as max container size over having a separated config for them, I can do that. &lt;/p&gt;</comment>
                            <comment id="17362792" author="jensg" created="Mon, 14 Jun 2021 07:44:11 +0000"  >&lt;p&gt;What is the status of this? We have a commit in two branches now and it is still open?&lt;/p&gt;</comment>
                            <comment id="17362793" author="jensg" created="Mon, 14 Jun 2021 07:45:25 +0000"  >&lt;p&gt;closing, feel freee to reopen if necessary&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 22 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ol9s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>