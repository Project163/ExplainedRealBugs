<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:09:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-2069] TPipeServer creates overlapped pipes, then uses synchronous I/O on them with TPipe</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-2069</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;The documentation for ReadFile states the following:&lt;br/&gt;
A pointer to an OVERLAPPED structure is required if the hFile parameter was opened with FILE_FLAG_OVERLAPPED, otherwise it can be NULL.&lt;br/&gt;
&lt;a href=&quot;http://msdn.microsoft.com/en-us/library/windows/desktop/aa365467%28v=vs.85%29.aspx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://msdn.microsoft.com/en-us/library/windows/desktop/aa365467%28v=vs.85%29.aspx&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In C++&apos;s TPipeServer, we create a named pipe with FILE_FLAG_OVERLAPPED, then create a TPipe with it.  TPipe then calls ReadFile without an overlapped structure.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows&lt;/p&gt;</environment>
        <key id="12654938">THRIFT-2069</key>
            <summary>TPipeServer creates overlapped pipes, then uses synchronous I/O on them with TPipe</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ben.craig">Ben Craig</assignee>
                                    <reporter username="ben.craig">Ben Craig</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Jun 2013 14:41:30 +0000</created>
                <updated>Sun, 27 Jul 2014 02:52:14 +0000</updated>
                            <resolved>Tue, 22 Jul 2014 10:51:28 +0000</resolved>
                                    <version>0.9.1</version>
                                    <fixVersion>0.9.2</fixVersion>
                                    <component>C++ - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13694004" author="ben.craig" created="Wed, 26 Jun 2013 14:43:59 +0000"  >&lt;p&gt;This patch also fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1776&quot; title=&quot;TPipeServer should implement &amp;quot;listen&amp;quot;, so that TServerEventHandler preServe will work right&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1776&quot;&gt;&lt;del&gt;THRIFT-1776&lt;/del&gt;&lt;/a&gt; &quot;TPipeServer should implement &apos;listen&apos;, so that TServerEventHandler preServe will work right&quot;&lt;/p&gt;</comment>
                            <comment id="13703370" author="ben.craig" created="Tue, 9 Jul 2013 15:20:34 +0000"  >&lt;p&gt;I have found a couple of issues with this patch, and I&apos;m working on resolving them.&lt;br/&gt;
1. Connection timeouts use the TimeoutSeconds member in a place where milliseconds are expected.  This means the default of 3 seconds is being interpreted as 3 milliseconds.&lt;/p&gt;

&lt;p&gt;2. Non-overlapped read and write file are much slower than overlapped reads and writes, and much slower than loopback socket reads and writes.  The overall latency and throughput of the system is still better than loopback sockets, but if you have some kind of external synchronization on the reads and writes, then you will hit more contention than normal.  I would switch it all to overlapped, but...&lt;/p&gt;

&lt;p&gt;3. Starting overlapped I/O on one thread, and completing it on another thread is dangerous.  If the starting thread exits, then the overlapped i/o request completes with ERROR_OPERATION_ABORTED.  Currently, I start up a new read request in an &quot;eager&quot; fashion, so that there is always an outstanding read request.  I do this so that clients can get a hold of the event object used in the overlapped read so they can do a WaitForMultipleObjects call.  If I want to support this use case (and I need to for my own projects), then I am stuck in the situation where I must start I/O early so that I can get an event object, but I can&apos;t start I/O early because the hosting thread could exit.&lt;/p&gt;</comment>
                            <comment id="13703494" author="jensg" created="Tue, 9 Jul 2013 16:57:43 +0000"  >&lt;p&gt;Hey, good timing! This patch is one of the next items on my list. So I&apos;ll wait for the update.&lt;/p&gt;</comment>
                            <comment id="13753937" author="ben.craig" created="Thu, 29 Aug 2013 18:58:36 +0000"  >&lt;p&gt;This is a hefty patch.  It is pretty much a complete rewrite of the pipe code.  &lt;/p&gt;

&lt;p&gt;Cases that require &quot;eager&quot; overlapped I/O requests now send those requests to a singleton thread.  This is to avoid issue 3. mentioned above, where an exiting thread that owns an I/O operations would cause all sorts of havoc.&lt;/p&gt;

&lt;p&gt;I&apos;m glad to take any extra feedback on this approach.  It is pretty complicated.&lt;/p&gt;</comment>
                            <comment id="13753950" author="jensg" created="Thu, 29 Aug 2013 19:11:27 +0000"  >&lt;p&gt;I&apos;ll have a look on that.&lt;/p&gt;</comment>
                            <comment id="13754966" author="ben.craig" created="Fri, 30 Aug 2013 18:11:03 +0000"  >&lt;p&gt;I&apos;ve set up a review here:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/13916/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/13916/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13765848" author="jensg" created="Thu, 12 Sep 2013 20:05:43 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Looks good to me, and it is for sure an improvement compared to the previous code. However, I have to admit that I did not test it very deeply. I&apos;ll see how I can improve the Delphi version based on your stuff, there are quite a few good ideas in there.&lt;/p&gt;</comment>
                            <comment id="13766762" author="hudson" created="Fri, 13 Sep 2013 18:24:23 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #897 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/897/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/897/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2069&quot; title=&quot;TPipeServer creates overlapped pipes, then uses synchronous I/O on them with TPipe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2069&quot;&gt;&lt;del&gt;THRIFT-2069&lt;/del&gt;&lt;/a&gt;: TPipeServer creates overlapped pipes, then uses synchronous I/O on them with TPipe (bencraig: rev b2501a71a79304fa27dfd6d2e55b75d8eacf0cef)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/cpp/src/thrift/windows/OverlappedSubmissionThread.h&lt;/li&gt;
	&lt;li&gt;lib/cpp/src/thrift/transport/TPipe.cpp&lt;/li&gt;
	&lt;li&gt;lib/cpp/src/thrift/transport/TPipeServer.cpp&lt;/li&gt;
	&lt;li&gt;lib/cpp/src/thrift/windows/OverlappedSubmissionThread.cpp&lt;/li&gt;
	&lt;li&gt;lib/cpp/src/thrift/transport/TPipeServer.h&lt;/li&gt;
	&lt;li&gt;lib/cpp/src/thrift/windows/Sync.h&lt;/li&gt;
	&lt;li&gt;lib/cpp/src/thrift/transport/TPipe.h&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12600631" name="overlapped_pipes.patch" size="50447" author="ben.craig" created="Thu, 29 Aug 2013 18:58:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>335215</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 10 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ltn3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>335539</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>