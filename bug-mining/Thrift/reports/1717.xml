<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:26:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-4060] Thrift printTo ostream overload mechanism breaks down when types are nested</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-4060</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;I&apos;m in the middle of converting a project that provides some ostream operators (for logging purposes) for a number of thrift structures.  The project was using 0.8.0 and in 0.9.3 some ostream operator overloads were added with &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3336&quot; title=&quot;Thrift generated streaming operators added in 0.9.2 cannot be overridden&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3336&quot;&gt;&lt;del&gt;THRIFT-3336&lt;/del&gt;&lt;/a&gt;.  The solution that was provided here runs into complications if a thrift structure is contained within another one.  Take this simple example:&lt;/p&gt;

&lt;h4&gt;&lt;a name=&quot;Thrift&quot;&gt;&lt;/a&gt;Thrift&lt;/h4&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;namespace cpp example.detail

struct Lower {
   1: binary lowerBinary
}

struct Higher {
    1: set&amp;lt;Lower&amp;gt; lowers
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;h4&gt;&lt;a name=&quot;C&quot;&gt;&lt;/a&gt;C++&lt;/h4&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;namespace example {

class MyLower : public detail::Lower
{
    virtual void printTo(std::ostream&amp;amp; os) const override;
}

class MyHigher : public detail::Higher
{
    virtual void printTo(std::ostream&amp;amp; os) const override
    {
        os &amp;lt;&amp;lt; lowers;
        // here&apos;s the problem, lowers is a set&amp;lt;detail::Lower&amp;gt; when it serializes in,
        // not a set&amp;lt;MyLower&amp;gt;, so I cannot override it...
    }
}

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m considering adding an annotation to the thrift IDL that the compiler will recognize that allows someone to say, &quot;I am going to provide my own operator&amp;lt;&amp;lt; for this structure, don&apos;t generate one&quot;.  This would replace the printTo mechanism that was added in &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3336&quot; title=&quot;Thrift generated streaming operators added in 0.9.2 cannot be overridden&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3336&quot;&gt;&lt;del&gt;THRIFT-3336&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Here is an example:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;namespace cpp example.detail

struct MyLower {
   1: binary lowerBinary
} (cpp.customostream)

struct MyHigher {
    1: set&amp;lt;Lower&amp;gt; lowers
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The annotation &lt;tt&gt;cpp.customostream&lt;/tt&gt; (or the compiler option &lt;tt&gt;--gen cpp:no_ostream_operators&lt;/tt&gt; for global effect) tells the compiler to emit only the declaration of the &lt;tt&gt;operator &amp;lt;&amp;lt;&lt;/tt&gt; but does not emit a definition (implementation).  It would be up to the implementation building against the generated code to provide an operator &amp;lt;&amp;lt; if such an operator is needed for conversion to a stream (cout, lexical_cast to string, etc..).&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu 14.04 LTS&lt;/p&gt;</environment>
        <key id="13038974">THRIFT-4060</key>
            <summary>Thrift printTo ostream overload mechanism breaks down when types are nested</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jking3">James E. King III</assignee>
                                    <reporter username="jking3">James E. King III</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 Jan 2017 19:20:49 +0000</created>
                <updated>Thu, 14 Dec 2017 13:55:04 +0000</updated>
                            <resolved>Mon, 13 Feb 2017 21:41:02 +0000</resolved>
                                    <version>0.9.3</version>
                    <version>0.10.0</version>
                                    <fixVersion>0.11.0</fixVersion>
                                    <component>C++ - Compiler</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15845900" author="githubbot" created="Mon, 30 Jan 2017 20:53:33 +0000"  >&lt;p&gt;GitHub user jeking3 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1172&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1172&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4060&quot; title=&quot;Thrift printTo ostream overload mechanism breaks down when types are nested&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4060&quot;&gt;&lt;del&gt;THRIFT-4060&lt;/del&gt;&lt;/a&gt; add better support in the cpp generator for custom ostream operators on structures&lt;/p&gt;

&lt;p&gt;    This pull request adds support for an annotation that will disable the emit code for operator &amp;lt;&amp;lt; and printTo, allowing a custom streaming output format to be provided by the consuming application.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jeking3/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jeking3/thrift&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4060&quot; title=&quot;Thrift printTo ostream overload mechanism breaks down when types are nested&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4060&quot;&gt;&lt;del&gt;THRIFT-4060&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1172.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1172.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1172&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit db4cb328a374a75c91cf70c61a808b68a54f8699&lt;br/&gt;
Author: James E. King, III &amp;lt;jim.king@simplivity.com&amp;gt;&lt;br/&gt;
Date:   2017-01-30T20:51:42Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4060&quot; title=&quot;Thrift printTo ostream overload mechanism breaks down when types are nested&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4060&quot;&gt;&lt;del&gt;THRIFT-4060&lt;/del&gt;&lt;/a&gt; add better support in the cpp generator for custom ostream operators on structures&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15846028" author="githubbot" created="Mon, 30 Jan 2017 22:10:34 +0000"  >&lt;p&gt;Github user jeking3 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1172#discussion_r98554132&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1172#discussion_r98554132&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: compiler/cpp/src/thrift/generate/t_cpp_generator.cc &amp;#8212;&lt;br/&gt;
    @@ -1117,7 +1129,7 @@ void t_cpp_generator::generate_struct_declaration(ofstream&amp;amp; out,&lt;br/&gt;
             &amp;lt;&amp;lt; &quot; &amp;amp;b);&quot; &amp;lt;&amp;lt; endl &amp;lt;&amp;lt; endl;&lt;br/&gt;
       }&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (is_user_struct) {&lt;br/&gt;
    +  if (is_user_struct &amp;amp;&amp;amp; !has_custom_ostream(tstruct)) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    This needs to change; on ostream declaration must be in the header even if thrift does not emit an implementation for it so that a thrift class that emits output code can contain a thrift class that does not.&lt;/p&gt;</comment>
                            <comment id="15846058" author="githubbot" created="Mon, 30 Jan 2017 22:34:54 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1172&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1172&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Going to add the ability to generate with cpp:no_ostream_operators to omit definitions for ostream operators entirely (when set, declarations will still be made, which means consuming implementations must provide all the implementations just like they did before thrift-0.9.3).&lt;/p&gt;</comment>
                            <comment id="15848469" author="githubbot" created="Wed, 1 Feb 2017 15:06:42 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1172&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1172&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    So job #2 failed strangely in c_glib which is unrelated to this change.&lt;br/&gt;
    I pushed an empty change to kick a rebuild.  I expect it to clear...&lt;br/&gt;
    Here&apos;s the job that failed:&lt;br/&gt;
    &lt;a href=&quot;https://travis-ci.org/apache/thrift/jobs/197100291&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/apache/thrift/jobs/197100291&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15859670" author="jking3" created="Thu, 9 Feb 2017 15:45:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hcorg&quot; class=&quot;user-hover&quot; rel=&quot;hcorg&quot;&gt;hcorg&lt;/a&gt;, I would appreciate your input on this change since you implemented &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3336&quot; title=&quot;Thrift generated streaming operators added in 0.9.2 cannot be overridden&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3336&quot;&gt;&lt;del&gt;THRIFT-3336&lt;/del&gt;&lt;/a&gt; and I reviewed it.  In particular, I&apos;m trying to decide if there is any value in the printTo mechanism.  It is the standard way for someone to create an overridable conversion to a stream in C++ since you cannot make operator &amp;lt;&amp;lt; virtual (see: &lt;a href=&quot;http://stackoverflow.com/questions/4571611/making-operator-virtual&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/4571611/making-operator-virtual&lt;/a&gt;) and that is what we ended up settling on, however that solution does not work in practice for thrift generated code (see description of &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4060&quot; title=&quot;Thrift printTo ostream overload mechanism breaks down when types are nested&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4060&quot;&gt;&lt;del&gt;THRIFT-4060&lt;/del&gt;&lt;/a&gt; for more info).  My inclination right now is to remove the printTo implementation and instead use this annotation/compiler flag to control whether operator &amp;lt;&amp;lt; is defined or just declared as opposed to keeping both.&lt;/p&gt;</comment>
                            <comment id="15861564" author="githubbot" created="Fri, 10 Feb 2017 17:30:06 +0000"  >&lt;p&gt;Github user hcorg commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1172#discussion_r100583307&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1172#discussion_r100583307&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/test/AnnotationTest.cpp &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,73 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements. See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership. The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License. You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,&lt;br/&gt;
    + * software distributed under the License is distributed on an&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY&lt;br/&gt;
    + * KIND, either express or implied. See the License for the&lt;br/&gt;
    + * specific language governing permissions and limitations&lt;br/&gt;
    + * under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +#define BOOST_TEST_MODULE AnnotationTest&lt;br/&gt;
    +#include &amp;lt;boost/test/unit_test.hpp&amp;gt;&lt;br/&gt;
    +#include &quot;gen-cpp/AnnotationTest_types.h&quot;&lt;br/&gt;
    +#include &amp;lt;ostream&amp;gt;&lt;br/&gt;
    +#include &amp;lt;sstream&amp;gt;&lt;br/&gt;
    +&lt;br/&gt;
    +// Normally thrift generates ostream operators, however&lt;br/&gt;
    +// with the annotation &quot;cpp.customostream&quot; one can tell the&lt;br/&gt;
    +// compiler they are going to provide their own, and not&lt;br/&gt;
    +// emit operator &amp;lt;&amp;lt; or printTo().&lt;br/&gt;
    +&lt;br/&gt;
    +std::ostream&amp;amp; operator&amp;lt;&amp;lt;(std::ostream&amp;amp; os, const ostr_custom&amp;amp; osc)&lt;br/&gt;
    +{&lt;br/&gt;
    +  os &amp;lt;&amp;lt; &quot;&lt;/p&gt;
{ bar = &quot; &amp;lt;&amp;lt; osc.bar &amp;lt;&amp;lt; &quot;; }
&lt;p&gt;&quot;;&lt;br/&gt;
    +  return os;&lt;br/&gt;
    +}&lt;br/&gt;
    +&lt;br/&gt;
    +BOOST_AUTO_TEST_SUITE(BOOST_TEST_MODULE)&lt;br/&gt;
    +&lt;br/&gt;
    +BOOST_AUTO_TEST_CASE(test_cpp_customostream) {&lt;br/&gt;
    +  //&lt;br/&gt;
    +  // Show the compiler generated ostream operator does something..&lt;br/&gt;
    +  //&lt;br/&gt;
    +&lt;br/&gt;
    +  ostr_default def;&lt;br/&gt;
    +  def.__set_bar(10);&lt;br/&gt;
    +&lt;br/&gt;
    +  std::stringstream ssd;&lt;br/&gt;
    +  ssd &amp;lt;&amp;lt; def;&lt;br/&gt;
    +  BOOST_CHECK_EQUAL(ssd.str(), &quot;ostr_default(bar=10)&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +  //&lt;br/&gt;
    +  // Now show that if cpp.customostream is added as an annotation,&lt;br/&gt;
    +  // the behavior can be overridden in a safe and usable way (&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4060&quot; title=&quot;Thrift printTo ostream overload mechanism breaks down when types are nested&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4060&quot;&gt;&lt;del&gt;THRIFT-4060&lt;/del&gt;&lt;/a&gt;).&lt;br/&gt;
    +  //&lt;br/&gt;
    +&lt;br/&gt;
    +  ostr_custom cus;&lt;br/&gt;
    +  cus.__set_bar(10);&lt;br/&gt;
    +&lt;br/&gt;
    +  std::stringstream csd;&lt;br/&gt;
    +  csd &amp;lt;&amp;lt; cus;&lt;br/&gt;
    +  BOOST_CHECK_EQUAL(csd.str(), &quot;&lt;/p&gt;
{ bar = 10; }
&lt;p&gt;&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    IMHO its better to keep &quot;single test-case - single test&quot; (or AAA or GivenWhenThen scheme). This file could include couple of SUITES (for example - one per annotation, and then well-named tests). Anytime I see comment I try to find a way to remade code so it does not need that comment &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15861577" author="hcorg" created="Fri, 10 Feb 2017 17:39:26 +0000"  >&lt;p&gt;I do not completely follow your example: &lt;tt&gt;set&amp;lt;detail::Lower&amp;gt;&lt;/tt&gt; will always contain &lt;tt&gt;Lower&lt;/tt&gt;, even if you put &lt;tt&gt;MyLower&lt;/tt&gt; there are you get is object splicing (&lt;a href=&quot;http://stackoverflow.com/questions/274626/what-is-object-slicing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/274626/what-is-object-slicing&lt;/a&gt;). So there is no way for &lt;tt&gt;MyHigher&lt;/tt&gt; to print out &lt;tt&gt;MyLower&lt;/tt&gt; via &lt;tt&gt;lowers&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;So I&apos;m not against introducing this annotation, but I&apos;d like to see proper use-case &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; (because for now all use-cases I see could rely on &lt;tt&gt;printTo&lt;/tt&gt;, and it&apos;s better to keep thrift compiler simple - without too many annotations)&lt;/p&gt;</comment>
                            <comment id="15861701" author="jking3" created="Fri, 10 Feb 2017 19:08:46 +0000"  >&lt;p&gt;One use case of this is if you stream these objects to storage on the server side, you likely need a more structured format string than provided, and if your structure has a container of another class, you don&apos;t have the opportunity to change the ostream &amp;lt;&amp;lt; behavior (in this case, MyHigher&apos;s set&amp;lt;detail::lower&amp;gt;).  Another use case is that the generated behavior is sufficient for some logging implementations however there may be auditing / formatting requirements that demand more structured logging of these items as well.&lt;/p&gt;

&lt;p&gt;By modifying the mechanism with the annotation or compiler flag, one can say &quot;I am going to provide a definition for operator &amp;lt;&amp;lt; of this structure&quot; and disable the one thrift generates.  One can say &lt;tt&gt;os &amp;lt;&amp;lt; higher_;&lt;/tt&gt; and know that the consuming applications output operators will be used for everything.&lt;/p&gt;

&lt;p&gt;You made the case that due to slicing that:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;there is no way for MyHigher to print out MyLower via lowers&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I believe this solution makes it unnecessary to subclass Lower or Higher at all, or to put them into a detail namespace; instead you can define how operator &amp;lt;&amp;lt; works instead of having thrift define it.  This is more efficient.&lt;/p&gt;</comment>
                            <comment id="15862503" author="hcorg" created="Sat, 11 Feb 2017 19:32:57 +0000"  >&lt;p&gt;ok, I did not get that &lt;tt&gt;MyHigher&lt;/tt&gt; etc. was a try to override &lt;tt&gt;operator&amp;lt;&amp;lt;&lt;/tt&gt; behavior. Now I do see a need for such extension point &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; But instead of annotation (which makes .thrift file &quot;language aware&quot;) I&apos;d go with some &lt;tt&gt;ifdef&lt;/tt&gt; in generated source code. Something along &lt;tt&gt;THRIFT_NO_GENERATED_OSTREAM_OPERATOR&lt;/tt&gt; and &lt;tt&gt;ifndef&lt;/tt&gt;. It would keep compiler code simpler and (more importantly) service/data definition clean.&lt;/p&gt;</comment>
                            <comment id="15862886" author="jking3" created="Sun, 12 Feb 2017 17:29:26 +0000"  >&lt;p&gt;In my PR I have already added a compiler argument of &lt;tt&gt;--gen cpp:no_ostream_operators&lt;/tt&gt; which someone can use to disable the definition on a file-by-file basis, so using compile time branches (ifdef) is unnecessary.&lt;/p&gt;

&lt;p&gt;We already have language-aware annotations based on the contents of AnnotationTest.thrift, for example &quot;java:final&quot;.  The annotation allows someone the ability to disable it on a structure-by-structure basis so they can take advantage of the thrift generated operator for things that don&apos;t need special treatment.  What you suggest means if they have one special structure in a thrift file they want to do their own, they would be forced to move it to a separate thrift file and include it to leverage this.  It could be done without the annotation option, but I would like to continue to provide that for flexibility.&lt;/p&gt;

&lt;p&gt;I am going to make your suggested test isolation change.&lt;/p&gt;</comment>
                            <comment id="15863020" author="githubbot" created="Sun, 12 Feb 2017 22:55:42 +0000"  >&lt;p&gt;Github user jeking3 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1172#discussion_r100707345&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1172#discussion_r100707345&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/cpp/test/AnnotationTest.cpp &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,73 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements. See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership. The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License. You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,&lt;br/&gt;
    + * software distributed under the License is distributed on an&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY&lt;br/&gt;
    + * KIND, either express or implied. See the License for the&lt;br/&gt;
    + * specific language governing permissions and limitations&lt;br/&gt;
    + * under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +#define BOOST_TEST_MODULE AnnotationTest&lt;br/&gt;
    +#include &amp;lt;boost/test/unit_test.hpp&amp;gt;&lt;br/&gt;
    +#include &quot;gen-cpp/AnnotationTest_types.h&quot;&lt;br/&gt;
    +#include &amp;lt;ostream&amp;gt;&lt;br/&gt;
    +#include &amp;lt;sstream&amp;gt;&lt;br/&gt;
    +&lt;br/&gt;
    +// Normally thrift generates ostream operators, however&lt;br/&gt;
    +// with the annotation &quot;cpp.customostream&quot; one can tell the&lt;br/&gt;
    +// compiler they are going to provide their own, and not&lt;br/&gt;
    +// emit operator &amp;lt;&amp;lt; or printTo().&lt;br/&gt;
    +&lt;br/&gt;
    +std::ostream&amp;amp; operator&amp;lt;&amp;lt;(std::ostream&amp;amp; os, const ostr_custom&amp;amp; osc)&lt;br/&gt;
    +{&lt;br/&gt;
    +  os &amp;lt;&amp;lt; &quot;&lt;/p&gt;
{ bar = &quot; &amp;lt;&amp;lt; osc.bar &amp;lt;&amp;lt; &quot;; }
&lt;p&gt;&quot;;&lt;br/&gt;
    +  return os;&lt;br/&gt;
    +}&lt;br/&gt;
    +&lt;br/&gt;
    +BOOST_AUTO_TEST_SUITE(BOOST_TEST_MODULE)&lt;br/&gt;
    +&lt;br/&gt;
    +BOOST_AUTO_TEST_CASE(test_cpp_customostream) {&lt;br/&gt;
    +  //&lt;br/&gt;
    +  // Show the compiler generated ostream operator does something..&lt;br/&gt;
    +  //&lt;br/&gt;
    +&lt;br/&gt;
    +  ostr_default def;&lt;br/&gt;
    +  def.__set_bar(10);&lt;br/&gt;
    +&lt;br/&gt;
    +  std::stringstream ssd;&lt;br/&gt;
    +  ssd &amp;lt;&amp;lt; def;&lt;br/&gt;
    +  BOOST_CHECK_EQUAL(ssd.str(), &quot;ostr_default(bar=10)&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +  //&lt;br/&gt;
    +  // Now show that if cpp.customostream is added as an annotation,&lt;br/&gt;
    +  // the behavior can be overridden in a safe and usable way (&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4060&quot; title=&quot;Thrift printTo ostream overload mechanism breaks down when types are nested&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4060&quot;&gt;&lt;del&gt;THRIFT-4060&lt;/del&gt;&lt;/a&gt;).&lt;br/&gt;
    +  //&lt;br/&gt;
    +&lt;br/&gt;
    +  ostr_custom cus;&lt;br/&gt;
    +  cus.__set_bar(10);&lt;br/&gt;
    +&lt;br/&gt;
    +  std::stringstream csd;&lt;br/&gt;
    +  csd &amp;lt;&amp;lt; cus;&lt;br/&gt;
    +  BOOST_CHECK_EQUAL(csd.str(), &quot;&lt;/p&gt;
{ bar = 10; }
&lt;p&gt;&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I split it out into two tests without comments.&lt;/p&gt;</comment>
                            <comment id="15863569" author="hcorg" created="Mon, 13 Feb 2017 12:23:37 +0000"  >&lt;p&gt;IMHO: ifdef is still better because it allows implementers to make decision about `ostream&amp;lt;&amp;lt;` later in development process (for example: when thrift files are somehow shared and can&apos;t be easily modified etc.)&lt;/p&gt;

&lt;p&gt;I also recall some very old discussion about keeping thrift compiler options/switches to minimum.&lt;/p&gt;

&lt;p&gt;But that&apos;s just opinion - don&apos;t treat it &quot;blocking&quot; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="15864496" author="githubbot" created="Mon, 13 Feb 2017 21:41:06 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1172&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1172&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12895149">THRIFT-3336</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 40 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i39drj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>