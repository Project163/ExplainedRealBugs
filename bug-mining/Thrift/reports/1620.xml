<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:24:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-3233] Fix C++ ThreadManager::Impl::removeWorker worker join</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-3233</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;ThreadManager::Impl::removeWorker is not joining worker properly.&lt;br/&gt;
It possible that the not joined worker will continue to reference destructed ThreadManager&apos;s non-static members causing crash.&lt;/p&gt;

&lt;p&gt;It is caused by removeWorker() implementation which waits for workers to decrement the ThreadManager&apos;s workerCount_. Once value is decremented removeWorker() assumes the worker thread joined, while in fact the worker thread continues to execute some more code which adds the worker thread to destruction list which list may be just freed due to ThreadManager object destruction.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12843815">THRIFT-3233</key>
            <summary>Fix C++ ThreadManager::Impl::removeWorker worker join</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jking3">James E. King III</assignee>
                                    <reporter username="pjanicki">Pawe&#322; Janicki</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jul 2015 09:55:48 +0000</created>
                <updated>Thu, 29 Sep 2016 20:50:01 +0000</updated>
                            <resolved>Tue, 14 Jun 2016 20:11:05 +0000</resolved>
                                    <version>0.9.2</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>C++ - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14620390" author="pjanicki" created="Thu, 9 Jul 2015 12:02:45 +0000"  >&lt;p&gt;Attaching patch&lt;/p&gt;</comment>
                            <comment id="14933848" author="jking3" created="Mon, 28 Sep 2015 19:35:16 +0000"  >&lt;p&gt;Is there a unit test that might expose the original issue and prove that it is resolved?&lt;/p&gt;</comment>
                            <comment id="15151681" author="zhubenwuzui" created="Thu, 18 Feb 2016 03:27:49 +0000"  >&lt;p&gt;It&apos;s not working.&lt;/p&gt;</comment>
                            <comment id="15248055" author="jking3" created="Tue, 19 Apr 2016 16:08:10 +0000"  >&lt;p&gt;I agree removeWorker is not functioning properly.  In my investigation into &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3768&quot; title=&quot;TThreadedServer may crash if it is destroyed immediately after it returns from serve(); TThreadedServer disconnects clients when they connec&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3768&quot;&gt;&lt;del&gt;THRIFT-3768&lt;/del&gt;&lt;/a&gt; I was planning to use the call in an implementation but it proved to be unsafe.  The patch does not cover all issues in the code.  I&apos;ll take a look.&lt;/p&gt;</comment>
                            <comment id="15248464" author="jking3" created="Tue, 19 Apr 2016 19:33:36 +0000"  >&lt;p&gt;There are already some fixes in the pull request for &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3768&quot; title=&quot;TThreadedServer may crash if it is destroyed immediately after it returns from serve(); TThreadedServer disconnects clients when they connec&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3768&quot;&gt;&lt;del&gt;THRIFT-3768&lt;/del&gt;&lt;/a&gt; because I found that when I enhanced the TServerIntegrationTest it was exposing the issue in this defect.  Please give those changes a try and see if it resolves the issues you were seeing.&lt;/p&gt;

&lt;p&gt;Note that ThreadManager needs an overhaul.  It has three monitors, two of which are being used to protect the same variables.  I&apos;d prefer to implement something using boost::thread_group at some point because it&apos;s going to be more reliable.&lt;/p&gt;</comment>
                            <comment id="15254360" author="jking3" created="Fri, 22 Apr 2016 18:14:54 +0000"  >&lt;p&gt;Reviewed your patch and it does look suspect that we decrement the workerCount_ and then run the task thread anyway.  I&apos;ll open another pull request.&lt;/p&gt;</comment>
                            <comment id="15254456" author="githubbot" created="Fri, 22 Apr 2016 18:50:54 +0000"  >&lt;p&gt;GitHub user jeking3 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/992&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/992&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3233&quot; title=&quot;Fix C++ ThreadManager::Impl::removeWorker worker join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3233&quot;&gt;&lt;del&gt;THRIFT-3233&lt;/del&gt;&lt;/a&gt;: fix accounting of workers in thread manager&lt;/p&gt;

&lt;p&gt;    Per patch submitted by Pawe&#322; Janicki.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jeking3/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jeking3/thrift&lt;/a&gt; defect/THIFT-3233&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/992.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/992.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #992&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit c2d179b6572ef2cf92301cf80e333688635f5c06&lt;br/&gt;
Author: Jim King &amp;lt;jim.king@simplivity.com&amp;gt;&lt;br/&gt;
Date:   2016-04-19T19:57:31Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3233&quot; title=&quot;Fix C++ ThreadManager::Impl::removeWorker worker join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3233&quot;&gt;&lt;del&gt;THRIFT-3233&lt;/del&gt;&lt;/a&gt;: fix accounting of workers in thread manager&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15262574" author="githubbot" created="Thu, 28 Apr 2016 17:25:51 +0000"  >&lt;p&gt;Github user jeking3 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/992#issuecomment-215501943&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/992#issuecomment-215501943&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looking for an advocate who would consider merging this fix despite the busted Apache Jenkins environment result.&lt;/p&gt;</comment>
                            <comment id="15329391" author="jking3" created="Tue, 14 Jun 2016 12:17:05 +0000"  >&lt;p&gt;The latest build passed fully.  Please merge this in so it gets into 0.10.0.&lt;/p&gt;</comment>
                            <comment id="15330267" author="jensg" created="Tue, 14 Jun 2016 19:42:06 +0000"  >&lt;p&gt;Looking at it.&lt;/p&gt;</comment>
                            <comment id="15330269" author="jensg" created="Tue, 14 Jun 2016 19:43:39 +0000"  >&lt;p&gt;Looking at it.&lt;/p&gt;</comment>
                            <comment id="15330283" author="githubbot" created="Tue, 14 Jun 2016 20:01:02 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/992&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/992&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15330481" author="jensg" created="Tue, 14 Jun 2016 20:11:05 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13006129">THRIFT-3932</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12744475" name="0001-THRIFT-3233.-cpp-Fix-ThreadManager-Impl-removeWorker.patch" size="2611" author="pjanicki" created="Thu, 9 Jul 2015 12:02:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2h1lb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>