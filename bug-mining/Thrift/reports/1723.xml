<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:26:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-3984] PHP7 extension causes segfault</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-3984</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;I cant offer a script to reproduce segfault because it  not happens everytime. &lt;/p&gt;

&lt;p&gt;PHP7 extension use ZVAL_STR to wrap zend_string to zval struct&#65292;and later use zval_dtor try to free it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/thrift/blob/master/lib/php/src/ext/thrift_protocol/php_thrift_protocol7.cpp#L825&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/blob/master/lib/php/src/ext/thrift_protocol/php_thrift_protocol7.cpp#L825&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The method_name parameter is pass from PHP script,  and zval_dtor decrement the gc reference count, thus would free the zend_string object but it is still referenced in the script.&lt;/p&gt;

&lt;p&gt;I  changed  ZVAL_STR to ZVAL_STR_COPY, which will add reference count by 1 to the zend_string object ,  apply this patch in our production environment and segfault never happen again&lt;/p&gt;

&lt;p&gt;Another place use ZVAL_STR is &lt;a href=&quot;https://github.com/apache/thrift/blob/master/lib/php/src/ext/thrift_protocol/php_thrift_protocol7.cpp#L668&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. Both this two place need to be fixed &lt;/p&gt;</description>
                <environment></environment>
        <key id="13023131">THRIFT-3984</key>
            <summary>PHP7 extension causes segfault</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jking3">James E. King III</assignee>
                                    <reporter username="kdlan">Fei Dong</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Nov 2016 09:13:24 +0000</created>
                <updated>Thu, 14 Dec 2017 13:56:03 +0000</updated>
                            <resolved>Thu, 23 Feb 2017 16:45:34 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.11.0</fixVersion>
                                    <component>PHP - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15801464" author="githubbot" created="Thu, 5 Jan 2017 14:20:24 +0000"  >&lt;p&gt;GitHub user zhaakhi opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1152&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1152&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3984&quot; title=&quot;PHP7 extension causes segfault&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3984&quot;&gt;&lt;del&gt;THRIFT-3984&lt;/del&gt;&lt;/a&gt; PHP7 extension causes segfault &lt;/p&gt;

&lt;p&gt;    Fix a double-free when serializing string map keys or the name of called methods, and a memory leak when deserializing maps or sets.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/zhaakhi/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/zhaakhi/thrift&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3984&quot; title=&quot;PHP7 extension causes segfault&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3984&quot;&gt;&lt;del&gt;THRIFT-3984&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1152.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1152.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1152&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit d956e2fc998ff4cee463b5ef39758b3cbe4d635e&lt;br/&gt;
Author: H&#229;kon Hitland &amp;lt;hakon.hitland@zedge.net&amp;gt;&lt;br/&gt;
Date:   2016-12-05T17:42:41Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3984&quot; title=&quot;PHP7 extension causes segfault&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3984&quot;&gt;&lt;del&gt;THRIFT-3984&lt;/del&gt;&lt;/a&gt; PHP7 extension causes segfault&lt;/p&gt;

&lt;p&gt;    The PHP 7 extension can sometimes free strings it does not own,&lt;br/&gt;
    when serializing string map keys, or the name of called methods.&lt;br/&gt;
    The latter case was somewhat migitated since the double-free has no&lt;br/&gt;
    effect on interned strings.&lt;br/&gt;
    Using ZVAL_STR_COPY instead of ZVAL_STR will increment the reference&lt;br/&gt;
    count, making the following destructor call correct.&lt;/p&gt;

&lt;p&gt;commit e4b6425086938ab42f7d097324dea9c2136dbcba&lt;br/&gt;
Author: H&#229;kon Hitland &amp;lt;hakon.hitland@zedge.net&amp;gt;&lt;br/&gt;
Date:   2016-12-05T20:08:19Z&lt;/p&gt;

&lt;p&gt;    Fix memory leak in PHP 7&lt;/p&gt;

&lt;p&gt;    Fix memory leak when deserializing maps or sets.&lt;br/&gt;
    zend_hash_update will add its own reference to the key, so we need to&lt;br/&gt;
    destruct the key zval to not leak.&lt;br/&gt;
    We don&apos;t need to destruct the value, the hash table will take ownership&lt;br/&gt;
    of it.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15809225" author="githubbot" created="Sun, 8 Jan 2017 11:21:57 +0000"  >&lt;p&gt;Github user Jens-G commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1152&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1152&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Any PHPers around to comment/confirm this solution? Will be happy to commit it if there are no objections against it.&lt;/p&gt;</comment>
                            <comment id="15854461" author="githubbot" created="Mon, 6 Feb 2017 18:02:34 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1152&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1152&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Not a php expert but this looks okay to me, however I would like to see it pass CI.  How do we trigger a new build on someone else&apos;s pull request?  Otherwise, if the original author could rebase on master, ideally squash the commits to one, and push again that would be helpful and would kick off a new build.&lt;/p&gt;</comment>
                            <comment id="15856191" author="githubbot" created="Tue, 7 Feb 2017 15:21:44 +0000"  >&lt;p&gt;Github user wesm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1152&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1152&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    In investigating long Travis CI queue times, I discovered that the Thrift project has 24 builds in its Travis CI matrix:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://travis-ci.org/apache/thrift/builds/199234155&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/apache/thrift/builds/199234155&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;    Since the entire Apache Software Foundation only has 30 concurrent build slaves on Travis CI, I&apos;ve requested that concurrent builds for Thrift be throttled:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/INFRA-13477&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/INFRA-13477&lt;/a&gt;&lt;/p&gt;

</comment>
                            <comment id="15856214" author="githubbot" created="Tue, 7 Feb 2017 15:40:10 +0000"  >&lt;p&gt;Github user zhaakhi commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1152&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1152&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Rebased, the failed test seems unrelated.&lt;/p&gt;</comment>
                            <comment id="15856367" author="githubbot" created="Tue, 7 Feb 2017 17:30:34 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1152&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1152&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I agree the failed CI build job does not look like it is related to the php change.&lt;/p&gt;</comment>
                            <comment id="15880491" author="githubbot" created="Thu, 23 Feb 2017 14:15:38 +0000"  >&lt;p&gt;Github user zhaakhi commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1152&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1152&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Ping. It would be nice to get this fix in since the double free is potentially a data corrupting bug.&lt;/p&gt;</comment>
                            <comment id="15880798" author="githubbot" created="Thu, 23 Feb 2017 16:41:24 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1152&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1152&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the reminder.  Things with failures often slip (as you can see from the current backlog).   I will merge this.&lt;/p&gt;</comment>
                            <comment id="15880816" author="githubbot" created="Thu, 23 Feb 2017 16:45:19 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1152&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1152&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 38 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i36qon:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>