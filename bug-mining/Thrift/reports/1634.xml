<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:24:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-3855] In the go simple server, if Stop() is called multiple times it hangs</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-3855</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;From the submitter huaiwan:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;huaiyun commented 18 hours ago&lt;br/&gt;
When Stop() is called twice or more, and no new connection accepted from AcceptLoop(), the Stop() will be blocked because the quit channel is full.&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="12980071">THRIFT-3855</key>
            <summary>In the go simple server, if Stop() is called multiple times it hangs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="asm0dey">Pasha Finkeshteyn</assignee>
                                    <reporter username="jking3">James E. King III</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Jun 2016 03:42:28 +0000</created>
                <updated>Sat, 28 Jan 2017 18:57:18 +0000</updated>
                            <resolved>Mon, 26 Sep 2016 20:08:19 +0000</resolved>
                                    <version>0.9.3</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>Go - Library</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15335344" author="githubbot" created="Fri, 17 Jun 2016 03:43:01 +0000"  >&lt;p&gt;Github user jeking3 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1028#discussion_r67457396&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1028#discussion_r67457396&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/go/thrift/simple_server.go &amp;#8212;&lt;br/&gt;
    @@ -149,8 +151,10 @@ func (p *TSimpleServer) Serve() error {&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;     func (p *TSimpleServer) Stop() error {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;p.quit &amp;lt;- struct{}{}&lt;/li&gt;
	&lt;li&gt;p.serverTransport.Interrupt()&lt;br/&gt;
    +	if atomic.CompareAndSwapInt64(&amp;amp;p.stopped, 0, 1) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I created a Jira item for your issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3855&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/THRIFT-3855&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="15335346" author="jking3" created="Fri, 17 Jun 2016 03:43:16 +0000"  >&lt;p&gt;PR is out, was submitted without a Jira ticket:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/thrift/pull/1028&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1028&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15386259" author="githubbot" created="Wed, 20 Jul 2016 17:34:43 +0000"  >&lt;p&gt;Github user jeking3 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1052&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1052&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Please create an Apache Jira ticket in the THRIFT project to cover the defect, and put a link to the pull request in there.  In the future if you open a ticket first and put the name of the Jira item (like &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3855&quot; title=&quot;In the go simple server, if Stop() is called multiple times it hangs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3855&quot;&gt;&lt;del&gt;THRIFT-3855&lt;/del&gt;&lt;/a&gt;) into the pull request comments, it will get linked to the Jira ticket automatically.&lt;/p&gt;</comment>
                            <comment id="15386261" author="jking3" created="Wed, 20 Jul 2016 17:36:32 +0000"  >&lt;p&gt;Hi, sorry, I used this thrift ticket number in an example - please ignore that.&lt;/p&gt;</comment>
                            <comment id="15390688" author="jensg" created="Sat, 23 Jul 2016 13:09:17 +0000"  >
&lt;p&gt;    MOD: fix the blocked bug when call Stop() twice or more&lt;/p&gt;

&lt;p&gt;    When Stop() is called twice or more, and no new connection accepted from &lt;br/&gt;
AcceptLoop(), the Stop() will be blocked because the quit channel is full.&lt;br/&gt;
    Use a flag to ensure the Stop() executed only once, and no block.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/huaiyun/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/huaiyun/thrift&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1028.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1028.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1028&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 24d16aaaf20c97a944d22551a8a5215d830546c0&lt;br/&gt;
Author: ZhiyuYin &amp;lt;yinzh...@xiaomi.com&amp;gt;&lt;br/&gt;
Date:   2016-06-16T09:28:42Z&lt;/p&gt;

&lt;p&gt;    MOD: fix the blocked bug when call the Stop() twice or more&lt;/p&gt;

&lt;hr /&gt;


&lt;p&gt;&amp;#8212;&lt;br/&gt;
If your project is set up for it, you can reply to this email and have your&lt;br/&gt;
reply appear on GitHub as well. If your project does not have this feature&lt;br/&gt;
enabled and wishes so, or if the feature is enabled but not working, please&lt;br/&gt;
contact infrastructure at infrastruct...@apache.org or file a JIRA ticket&lt;br/&gt;
with INFRA.&lt;br/&gt;
&amp;#8212;&lt;/p&gt;
</comment>
                            <comment id="15390690" author="jensg" created="Sat, 23 Jul 2016 13:17:42 +0000"  >&lt;p&gt;Good catch, committed.&lt;/p&gt;</comment>
                            <comment id="15414866" author="jensg" created="Wed, 10 Aug 2016 07:45:09 +0000"  >&lt;p&gt;I get a strange error here. To be honest, I have no idea what is going on, but I can reproduce it 100% of the time.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;--- FAIL: TestShutdownServerAndClients (0.00s)
panic: runtime error: invalid memory address or nil pointer dereference [recovered]
        panic: runtime error: invalid memory address or nil pointer dereference
[signal 0xb code=0x1 addr=0x0 pc=0x810085c]

goroutine 43 [running]:
panic(0x8403880, 0x1880a038)
        /usr/local/go/src/runtime/panic.go:481 +0x326
testing.tRunner.func1(0x1894c660)
        /usr/local/go/src/testing/testing.go:467 +0x14f
panic(0x8403880, 0x1880a038)
        /usr/local/go/src/runtime/panic.go:443 +0x3fd
sync/atomic.CompareAndSwapUint64(0x1880f844, 0x0, 0x0, 0x1, 0x0)
        /usr/local/go/src/sync/atomic/asm_386.s:76 +0xc
thrift.(*TSimpleServer).Stop(0x1880f840, 0x0, 0x0)
        /home/jens/Thrift/lib/go/test/gopath/src/thrift/simple_server.go:154 +0x5d
tests.TestShutdownServerAndClients(0x1894c660)
        /home/jens/Thrift/lib/go/test/gopath/src/tests/multiplexed_protocol_test.go:158 +0x63
testing.tRunner(0x1894c660, 0x86592fc)
        /usr/local/go/src/testing/testing.go:473 +0x8f
created by testing.RunTests
        /usr/local/go/src/testing/testing.go:582 +0x6f2
FAIL    tests   0.046s
ok      dontexportrwtest        0.031s
Makefile:663: recipe &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; target &lt;span class=&quot;code-quote&quot;&gt;&apos;check&apos;&lt;/span&gt; failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The line where it happens is the newly introduced CompareAndSwapInt64(). I&apos;ve checked all possible and impossible pointers in that area, and everything looks fine to me. Yet still calling &lt;tt&gt;make &amp;amp;&amp;amp; make check&lt;/tt&gt; within the &lt;tt&gt;/lib/go&lt;/tt&gt; folder fails with the above error. &lt;/p&gt;

&lt;p&gt;Environment is openSuse (32 bit), &lt;br/&gt;
Go version is go1.6.3 Linux/386.&lt;/p&gt;</comment>
                            <comment id="15519537" author="githubbot" created="Sat, 24 Sep 2016 19:49:50 +0000"  >&lt;p&gt;GitHub user asm0dey opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1094&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1094&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3855&quot; title=&quot;In the go simple server, if Stop() is called multiple times it hangs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3855&quot;&gt;&lt;del&gt;THRIFT-3855&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Replaced complex CompareAndSwapInt64 with syncOnce.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/asm0dey/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/asm0dey/thrift&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1094.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1094.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1094&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 762c2573e2275307b26ac78271b66d37065ed5f9&lt;br/&gt;
Author: Paul &amp;lt;pavel.finkelshtein@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-09-24T19:47:58Z&lt;/p&gt;

&lt;p&gt;    Fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3855&quot; title=&quot;In the go simple server, if Stop() is called multiple times it hangs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3855&quot;&gt;&lt;del&gt;THRIFT-3855&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Replaced complex CompareAndSwapInt64 with syncOnce.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15519585" author="asm0dey" created="Sat, 24 Sep 2016 20:28:58 +0000"  >&lt;p&gt;Hi guys,&lt;/p&gt;

&lt;p&gt;I&apos;ve just submitted pull request, where closing of channel is performed in more idiomatic (and more lightweight) way then with CompareAndSwapInt64.&lt;br/&gt;
Could you please review it and, if that&apos;s ok &#8211; than release 0.10 finally? We&apos;re waiting for python 3 support sooo much...&lt;/p&gt;</comment>
                            <comment id="15520419" author="asm0dey" created="Sun, 25 Sep 2016 08:00:04 +0000"  >&lt;p&gt;To a pity one test is failed due to some technical reason, I wish it was possible to run it again, but I can&apos;t.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jensg&quot; class=&quot;user-hover&quot; rel=&quot;jensg&quot;&gt;jensg&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jking&quot; class=&quot;user-hover&quot; rel=&quot;jking&quot;&gt;jking&lt;/a&gt; Could you please check my pull request?&lt;/p&gt;</comment>
                            <comment id="15521358" author="githubbot" created="Sun, 25 Sep 2016 20:18:04 +0000"  >&lt;p&gt;Github user Jens-G commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1094#discussion_r80390983&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1094#discussion_r80390983&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/go/thrift/simple_server.go &amp;#8212;&lt;br/&gt;
    @@ -183,9 +186,6 @@ func (p *TSimpleServer) processRequests(client TTransport) error &lt;/p&gt;
{
     			log.Printf(&quot;error processing request: %s&quot;, err)
     			return err
     		}
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if err, ok := err.(TApplicationException); ok &amp;amp;&amp;amp; err.TypeId() == UNKNOWN_METHOD 
{
    -			continue
    -		}
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I can&apos;t see the connection. Please explain.&lt;/p&gt;</comment>
                            <comment id="15521359" author="githubbot" created="Sun, 25 Sep 2016 20:18:04 +0000"  >&lt;p&gt;Github user Jens-G commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1094#discussion_r80390991&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1094#discussion_r80390991&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/go/thrift/simple_server.go &amp;#8212;&lt;br/&gt;
    @@ -183,9 +186,6 @@ func (p *TSimpleServer) processRequests(client TTransport) error &lt;/p&gt;
{
     			log.Printf(&quot;error processing request: %s&quot;, err)
     			return err
     		}
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if err, ok := err.(TApplicationException); ok &amp;amp;&amp;amp; err.TypeId() == UNKNOWN_METHOD 
{
    -			continue
    -		}
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    How is that related? Please explain. &lt;/p&gt;</comment>
                            <comment id="15521406" author="githubbot" created="Sun, 25 Sep 2016 20:55:33 +0000"  >&lt;p&gt;Github user asm0dey commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1094#discussion_r80391813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1094#discussion_r80391813&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/go/thrift/simple_server.go &amp;#8212;&lt;br/&gt;
    @@ -183,9 +186,6 @@ func (p *TSimpleServer) processRequests(client TTransport) error &lt;/p&gt;
{
     			log.Printf(&quot;error processing request: %s&quot;, err)
     			return err
     		}
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if err, ok := err.(TApplicationException); ok &amp;amp;&amp;amp; err.TypeId() == UNKNOWN_METHOD 
{
    -			continue
    -		}
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    It&apos;s removed by gofmt. I thought that gofmt knows better tan me, so I didn&apos;t revert that change. should I?&lt;/p&gt;</comment>
                            <comment id="15521408" author="githubbot" created="Sun, 25 Sep 2016 20:55:49 +0000"  >&lt;p&gt;Github user asm0dey commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1094#discussion_r80391820&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1094#discussion_r80391820&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/go/thrift/simple_server.go &amp;#8212;&lt;br/&gt;
    @@ -183,9 +186,6 @@ func (p *TSimpleServer) processRequests(client TTransport) error &lt;/p&gt;
{
     			log.Printf(&quot;error processing request: %s&quot;, err)
     			return err
     		}
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if err, ok := err.(TApplicationException); ok &amp;amp;&amp;amp; err.TypeId() == UNKNOWN_METHOD 
{
    -			continue
    -		}
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    @Jens-G --^&lt;/p&gt;</comment>
                            <comment id="15521453" author="githubbot" created="Sun, 25 Sep 2016 21:32:05 +0000"  >&lt;p&gt;Github user Jens-G commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1094#discussion_r80392522&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1094#discussion_r80392522&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/go/thrift/simple_server.go &amp;#8212;&lt;br/&gt;
    @@ -183,9 +186,6 @@ func (p *TSimpleServer) processRequests(client TTransport) error &lt;/p&gt;
{
     			log.Printf(&quot;error processing request: %s&quot;, err)
     			return err
     		}
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if err, ok := err.(TApplicationException); ok &amp;amp;&amp;amp; err.TypeId() == UNKNOWN_METHOD 
{
    -			continue
    -		}
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I would doubt that. If that is true that would probably qualify for a bug report. I would not expect a formatting tool to arbitrarily delete valid code lines.&lt;/p&gt;</comment>
                            <comment id="15521462" author="githubbot" created="Sun, 25 Sep 2016 21:37:57 +0000"  >&lt;p&gt;Github user asm0dey commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1094#discussion_r80392646&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1094#discussion_r80392646&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/go/thrift/simple_server.go &amp;#8212;&lt;br/&gt;
    @@ -183,9 +186,6 @@ func (p *TSimpleServer) processRequests(client TTransport) error &lt;/p&gt;
{
     			log.Printf(&quot;error processing request: %s&quot;, err)
     			return err
     		}
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if err, ok := err.(TApplicationException); ok &amp;amp;&amp;amp; err.TypeId() == UNKNOWN_METHOD 
{
    -			continue
    -		}
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    @Jens-G  Reverted back that change. Thank you for review!&lt;/p&gt;</comment>
                            <comment id="15522224" author="githubbot" created="Mon, 26 Sep 2016 06:34:16 +0000"  >&lt;p&gt;Github user asm0dey commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1094#discussion_r80414179&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1094#discussion_r80414179&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: lib/go/thrift/simple_server.go &amp;#8212;&lt;br/&gt;
    @@ -183,9 +186,6 @@ func (p *TSimpleServer) processRequests(client TTransport) error &lt;/p&gt;
{
     			log.Printf(&quot;error processing request: %s&quot;, err)
     			return err
     		}
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if err, ok := err.(TApplicationException); ok &amp;amp;&amp;amp; err.TypeId() == UNKNOWN_METHOD 
{
    -			continue
    -		}
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    And again I dunno why one of builds has failed, but it looks like it&apos;s nothing to do with Fo code.&lt;/p&gt;</comment>
                            <comment id="15524043" author="githubbot" created="Mon, 26 Sep 2016 20:08:09 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1094&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1094&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15524044" author="jensg" created="Mon, 26 Sep 2016 20:08:19 +0000"  >&lt;p&gt;Committed&lt;/p&gt;</comment>
                            <comment id="15525072" author="asm0dey" created="Tue, 27 Sep 2016 04:56:20 +0000"  >&lt;p&gt;Thank you! Now we&apos;re waiting for 0.10 version!&lt;/p&gt;</comment>
                            <comment id="15530847" author="patrickb" created="Wed, 28 Sep 2016 20:57:54 +0000"  >&lt;p&gt;Not sure if this is related but thrift 0.9.3 generates code such that even one call to Stop() hangs.&lt;br/&gt;
If I set up a handler to trap ctrl-c/sigint (so that I can gracefully term my own goroutines) like so:&lt;br/&gt;
quitChan := make(chan os.Signal)&lt;/p&gt;

&lt;p&gt;// trap ctrl-c - and gracefully stop service&lt;br/&gt;
signal.Notify(quitChan, os.Interrupt)&lt;br/&gt;
go func() {&lt;br/&gt;
    &amp;lt;-quitChan&lt;br/&gt;
    consoleTopic.Status(ctx, &quot;...exiting&quot;)&lt;br/&gt;
    server.Stop()&lt;br/&gt;
}()&lt;br/&gt;
server.Serve()  // &amp;lt;--- this never returns!&lt;/p&gt;
</comment>
                            <comment id="15533694" author="jensg" created="Thu, 29 Sep 2016 18:53:30 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=patrickb&quot; class=&quot;user-hover&quot; rel=&quot;patrickb&quot;&gt;patrickb&lt;/a&gt;, did you check this against current master?&lt;/p&gt;</comment>
                            <comment id="15533727" author="asm0dey" created="Thu, 29 Sep 2016 19:03:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=patrickb&quot; class=&quot;user-hover&quot; rel=&quot;patrickb&quot;&gt;patrickb&lt;/a&gt; looks like you&apos;re using old version of server.&lt;/p&gt;</comment>
                            <comment id="15534859" author="patrickb" created="Fri, 30 Sep 2016 03:06:45 +0000"  >&lt;p&gt;I wasn&apos;t using an old version at all.  I was just using the official &apos;production&apos; version of thrift (0.9.3) from &lt;a href=&quot;https://thrift.apache.org/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://thrift.apache.org/&lt;/a&gt;.&lt;br/&gt;
Looking again right now, that&apos;s what still shows for download.&lt;br/&gt;
If it&apos;s not something people should be using, shouldn&apos;t it be updated?&lt;/p&gt;</comment>
                            <comment id="15534873" author="jking3" created="Fri, 30 Sep 2016 03:14:56 +0000"  >&lt;p&gt;A fix was put into the stop logic for 0.10.0 which is currently only available if you get the master branch from github.  We&apos;re starting the process of rolling out the next release that includes the fix.  If you could, please try that and see if the issue is still there using your test so we can see if the issue has already been addressed or if we need to open a new defect.&lt;/p&gt;</comment>
                            <comment id="15536266" author="jensg" created="Fri, 30 Sep 2016 15:25:06 +0000"  >&lt;p&gt;As Thrift is still below 1.0 we usually do not publish updates to released packages. The fix will be part of the next release, anyonewho needs it is free to cherrypick it from here or from master. &lt;/p&gt;</comment>
                            <comment id="15536523" author="patrickb" created="Fri, 30 Sep 2016 17:25:03 +0000"  >&lt;p&gt;I&apos;m not sure I follow.  If there are nasty bugs that should be fixed why wouldn&apos;t a new version be released?  I&apos;d like to just &apos;use&apos; thrift, not develop it, and building the thrift compiler for windows looks to be a bit of a morass.  &lt;br/&gt;
Is this project one that basically assumes everyone that uses it runs off tip and builds it all themselves with no particular release process?&lt;/p&gt;</comment>
                            <comment id="15536604" author="jking3" created="Fri, 30 Sep 2016 18:04:15 +0000"  >&lt;p&gt;It sounds like what you are looking for is regular, timely releases - perhaps even more frequent patch releases to fix bugs.  I agree with you on that.&lt;/p&gt;</comment>
                            <comment id="15537013" author="jensg" created="Fri, 30 Sep 2016 20:42:31 +0000"  >&lt;p&gt;I agree too. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&amp;gt; Building the thrift compiler for windows looks to be a bit of a morass. &lt;/p&gt;

&lt;p&gt;It&apos;s actually not. You need WinFlexBison and some not too old version of Visual Studio, and that&apos;s it. Couldn&apos;t be much easier.&lt;/p&gt;</comment>
                            <comment id="15537067" author="asm0dey" created="Fri, 30 Sep 2016 21:04:37 +0000"  >&lt;p&gt;Is it possible that we could just backport commits with changes of Stop() method to some new brunch for bugfix 0.9.4 release?&lt;/p&gt;</comment>
                            <comment id="15537100" author="jensg" created="Fri, 30 Sep 2016 21:18:56 +0000"  >&lt;p&gt;Next release is 0.10.0, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jfarrell&quot; class=&quot;user-hover&quot; rel=&quot;jfarrell&quot;&gt;jfarrell&lt;/a&gt; may be able to tell you more about the timeline.&lt;/p&gt;</comment>
                            <comment id="15537133" author="jfarrell" created="Fri, 30 Sep 2016 21:32:40 +0000"  >&lt;p&gt;hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=asm0dey&quot; class=&quot;user-hover&quot; rel=&quot;asm0dey&quot;&gt;asm0dey&lt;/a&gt;, the 0.10.0 release candidate is in process, you can follow &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3775&quot; title=&quot;0.10.0 release candidate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3775&quot;&gt;&lt;del&gt;THRIFT-3775&lt;/del&gt;&lt;/a&gt; for progress. We have had some issues with our CI and tooling and have been working through them and with the new changes we are making hope to get back to a more regular release cadence. &lt;/p&gt;</comment>
                            <comment id="15537144" author="patrickb" created="Fri, 30 Sep 2016 21:36:09 +0000"  >&lt;p&gt;No, it doesn&apos;t work as-is.  Not even close.  The readme.me file in compiler/cpp says to use winflex/bison and then at the end says not to use it but to use the one from &lt;a href=&quot;https://jaisantonyk.wordpress.com/2008/03/16/lex-and-yaccbison-in-windows/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jaisantonyk.wordpress.com/2008/03/16/lex-and-yaccbison-in-windows/&lt;/a&gt; instead. &lt;br/&gt;
All the links on that page are dead, so can&apos;t use that.&lt;br/&gt;
So renaming winflexbison binaries and putting in path doesn&apos;t work either.&lt;br/&gt;
The solution references src/thriftl.ll when it&apos;s really in src/thrift/thriftl.ll&lt;br/&gt;
It continues to ripple through in fact..  Basically the solution/vcxproj file is completely broken as checked in.&lt;br/&gt;
So.... let&apos;s try cmake.  It looks like its more current.&lt;br/&gt;
Yet, trying cmake as directed using cmake .. yields the error:&lt;br/&gt;
CMake Error at CMakeLists.txt:156 (install):&lt;br/&gt;
  install TARGETS given no RUNTIME DESTINATION for executable target&lt;br/&gt;
  &quot;thrift-compiler&quot;.&lt;br/&gt;
So I guess I have to learn about cmake now...&lt;br/&gt;
Guess I &lt;b&gt;really&lt;/b&gt; have to use cmake with the -D BIN_INSTALL_DIR=xxxx flag.&lt;br/&gt;
So I run that... it builds the projects, build them... and it compiles but I get tons of linker errors.&lt;/p&gt;

&lt;p&gt;So... yeah... it&apos;s a mess.  Clearly it&apos;s not being built based on the instructions as listed.&lt;/p&gt;</comment>
                            <comment id="15537280" author="jensg" created="Fri, 30 Sep 2016 22:39:46 +0000"  >&lt;p&gt;So the VS project it&apos;s obviously completely utterly broken and I did something wrong, because for me it works. Too bad. Sorry, no idea.&lt;/p&gt;</comment>
                            <comment id="15538486" author="nsuke" created="Sat, 1 Oct 2016 13:00:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=patrickb&quot; class=&quot;user-hover&quot; rel=&quot;patrickb&quot;&gt;patrickb&lt;/a&gt; thanks for describing the problems.&lt;br/&gt;
It seems to be broken by my commit last week (&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2835&quot; title=&quot;Add possibility to distribute generators separately from thrift core, and load them dynamically&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2835&quot;&gt;&lt;del&gt;THRIFT-2835&lt;/del&gt;&lt;/a&gt;).&lt;br/&gt;
I&apos;ll update vcxproj and readme.&lt;br/&gt;
But I don&apos;t what was happening for your CMake build.&lt;br/&gt;
We&apos;re building it fine without &quot;-DBIN_INSTALL_DIR=&quot; flag on our windows CI (and without link errors).&lt;/p&gt;</comment>
                            <comment id="15563236" author="patrickb" created="Mon, 10 Oct 2016 19:28:40 +0000"  >&lt;p&gt;I didn&apos;t see it anywhere else but my problem is actually that Stop doesn&apos;t actually interrupt the waiting Accept call. &lt;br/&gt;
If I start my service and something calls Stop (my ctrl-c handler) then it just &apos;hangs&apos; until a new client connects. &lt;br/&gt;
AcceptLoop calls Accept in a loop and Accept blocks until the server accepts a new connection, so there&apos;s nothing to actually &apos;stop&apos; the server in that accept.&lt;br/&gt;
The problem is that SimpleServer.Stop calls Interrupt (which sets the interrupted variable in ServerSocket &lt;span class=&quot;error&quot;&gt;&amp;#91;in my case&amp;#93;&lt;/span&gt;) but doesn&apos;t do anything to abort the open listener.&lt;br/&gt;
If I change SimpleServer Stop to&lt;br/&gt;
```&lt;br/&gt;
func (p *TSimpleServer) Stop() error {&lt;br/&gt;
	p.quit &amp;lt;- struct{}{}&lt;br/&gt;
	p.serverTransport.Interrupt()&lt;br/&gt;
	p.serverTransport.Close()&lt;/p&gt;

&lt;p&gt;	return nil&lt;br/&gt;
}&lt;br/&gt;
```&lt;br/&gt;
Then it works fine.&lt;/p&gt;</comment>
                            <comment id="15563630" author="jensg" created="Mon, 10 Oct 2016 21:47:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=patrickb&quot; class=&quot;user-hover&quot; rel=&quot;patrickb&quot;&gt;patrickb&lt;/a&gt;&lt;br/&gt;
What about providing an updated patch? &lt;/p&gt;</comment>
                            <comment id="15565712" author="patrickb" created="Tue, 11 Oct 2016 15:15:14 +0000"  >&lt;p&gt;I just modified the generated .go code and got it working fine.  It&apos;s a very trivial patch (add that Close line).  I&apos;m just surprised no one noticed this before?  No one tried to stop an idle server?&lt;/p&gt;

&lt;p&gt;I was never able to get thrift building cleanly locally with the solutions or cmake generated files and vc14 (vs2015) so I can&apos;t test the changes locally for submitting a patch.  If I stay with thrift I may go back to it in earnest.  So far the performance is about 4-5x slower than grpc (although grpc seems completely broken for ruby/windows clients so thrift is only working solution for me at the moment).&lt;/p&gt;</comment>
                            <comment id="15567209" author="patrickb" created="Wed, 12 Oct 2016 01:27:41 +0000"  >&lt;p&gt;Looks like this was fixed already in the latest code.  Even though it still shows 0.9.3 in changes and elsewhere, the latest revisions had Stop() added to TServerSocket.Interrupt() which fixes my problem as well.&lt;/p&gt;</comment>
                            <comment id="15569609" author="jensg" created="Wed, 12 Oct 2016 19:08:10 +0000"  >&lt;p&gt;Good. And 0.10.0 is on the way ...&lt;/p&gt;</comment>
                            <comment id="15843854" author="jking3" created="Sat, 28 Jan 2017 04:52:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=patrickb&quot; class=&quot;user-hover&quot; rel=&quot;patrickb&quot;&gt;patrickb&lt;/a&gt; If you believe that the issue has already been resolved, could you close your pull request (&lt;a href=&quot;https://github.com/apache/thrift/pull/1113)?&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1113)?&lt;/a&gt;  Thanks.&lt;/p&gt;</comment>
                            <comment id="15843896" author="githubbot" created="Sat, 28 Jan 2017 05:51:07 +0000"  >&lt;p&gt;Github user pbennett commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1113&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1113&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I was asked to close this pull request in &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3855&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/THRIFT-3855&lt;/a&gt; but I&apos;m not the submitter of this pull request nor can I accept it.&lt;/p&gt;</comment>
                            <comment id="15844157" author="jking3" created="Sat, 28 Jan 2017 18:57:18 +0000"  >&lt;p&gt;@jfarrell can close it if we believe this issue has already been resolved; just trying to get a handle on the pull request backlog. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 42 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zlw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>