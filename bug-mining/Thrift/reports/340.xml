<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:58:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-868] Referencing constant values doesn&apos;t work with with typedef types</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-868</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;Setting a constant&apos;s value to the value of another constant does not work when the types are typedefs.  The workaround is easy, but it devalues the typedef.&lt;/p&gt;

&lt;p&gt;Here&apos;s my example input:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Test.thrift&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// test with strings
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; string str_a = &lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; string str_b = str_a

typedef string MyString
&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; MyString mystr_a = &lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; MyString mystr_b = mystr_a &lt;span class=&quot;code-comment&quot;&gt;// results in empty string
&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;// Test with ints
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; i32 int_x = 42
&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; i32 int_y = int_x

typedef i32 MyInt
&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; MyInt myint_x = 29
&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; MyInt myint_y = myint_x &lt;span class=&quot;code-comment&quot;&gt;// causes compiler error - code generator ends prematurely&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which erroneously results in the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Constants.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Constants {

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; str_a = &lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; str_b = &lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; mystr_a = &lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; mystr_b = &quot;&quot;;

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; int_x = 42;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; int_y = 42;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; myint_x = 29;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; 
&amp;lt;&amp;lt;eof&amp;gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The string typedef fails silently, ignoring the value and using &quot;&quot; instead, while the i32 typedef successfully parses, but causes the code generator to error out mid-file.  There are clearly two very different symptoms here, but my gut tells me that they have the same root cause.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12472513">THRIFT-868</key>
            <summary>Referencing constant values doesn&apos;t work with with typedef types</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dreiss">David Reiss</assignee>
                                    <reporter username="jdecew">Jeff DeCew</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Aug 2010 18:30:43 +0000</created>
                <updated>Tue, 1 Nov 2011 02:54:17 +0000</updated>
                            <resolved>Tue, 5 Oct 2010 16:40:09 +0000</resolved>
                                    <version>0.4</version>
                                    <fixVersion>0.6</fixVersion>
                                    <component>Compiler (General)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12908864" author="bryanduxbury" created="Mon, 13 Sep 2010 17:09:34 +0000"  >&lt;p&gt;I looked into this a little bit, and it looks like the problem is that somehow resolve_const_value isn&apos;t doing its job correctly. I tried doing a little bit of work to resolve the typedef to the underlying type, but that didn&apos;t do it. Someone is going to have to dig in a little deeper.&lt;/p&gt;</comment>
                            <comment id="12917273" author="greafine" created="Sun, 3 Oct 2010 01:18:25 +0000"  >&lt;p&gt;Hey Bryan I did exactly that and it seemed to work. Are there any other tests you did that failed?&lt;/p&gt;</comment>
                            <comment id="12917670" author="dreiss" created="Mon, 4 Oct 2010 17:35:32 +0000"  >&lt;p&gt;Can you use the true_type method instead of hard-coding the loop?&lt;/p&gt;</comment>
                            <comment id="12917741" author="greafine" created="Mon, 4 Oct 2010 20:16:36 +0000"  >&lt;p&gt;Yes. But needed to make some changes to avoid forward declaration errors and make get_true_type public (it was protected).&lt;/p&gt;</comment>
                            <comment id="12917770" author="dreiss" created="Mon, 4 Oct 2010 21:24:06 +0000"  >&lt;p&gt;Ick.  Maybe it would be better to make get_true_type a method of t_type and make the t_program version just be a wrapper?&lt;/p&gt;</comment>
                            <comment id="12917820" author="greafine" created="Mon, 4 Oct 2010 23:43:30 +0000"  >&lt;p&gt;Yeah, it&apos;s better. New patch attached.&lt;/p&gt;</comment>
                            <comment id="12917822" author="dreiss" created="Mon, 4 Oct 2010 23:54:19 +0000"  >&lt;p&gt;Why not just put the version you have in t_typedef directly in t_type?&lt;/p&gt;</comment>
                            <comment id="12917828" author="greafine" created="Tue, 5 Oct 2010 00:12:48 +0000"  >&lt;p&gt;Ok, but then I would need to move get_type to t_type or am I missing something?&lt;/p&gt;</comment>
                            <comment id="12917863" author="dreiss" created="Tue, 5 Oct 2010 02:22:06 +0000"  >&lt;p&gt;I don&apos;t think so, because get_true_type is casting the type pointer to a t_typedef*.&lt;/p&gt;</comment>
                            <comment id="12917864" author="dreiss" created="Tue, 5 Oct 2010 02:22:48 +0000"  >&lt;p&gt;Oh, also, can you use spaces instead of tabs for indentation?&lt;/p&gt;</comment>
                            <comment id="12917866" author="dreiss" created="Tue, 5 Oct 2010 02:23:24 +0000"  >&lt;p&gt;Oh, I see.  Is it an include order thing?  Let me play around with it for a bit and see if I can find something I like.&lt;/p&gt;</comment>
                            <comment id="12917872" author="greafine" created="Tue, 5 Oct 2010 04:14:22 +0000"  >&lt;p&gt;Using spaces instead of tabs.&lt;/p&gt;</comment>
                            <comment id="12917883" author="dreiss" created="Tue, 5 Oct 2010 05:25:04 +0000"  >&lt;p&gt;What do you think of this version?  I started with a separate diff to create parse.cc, so a t_type function can reference t_typedef.&lt;/p&gt;</comment>
                            <comment id="12917979" author="greafine" created="Tue, 5 Oct 2010 13:47:48 +0000"  >&lt;p&gt;Looks good to me.&lt;/p&gt;</comment>
                            <comment id="12918062" author="dreiss" created="Tue, 5 Oct 2010 16:40:09 +0000"  >&lt;p&gt;Thanks for tracking this down.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12456363" name="ASF.LICENSE.NOT.GRANTED--v5-0001-compiler-Move-t_type-generate_fingerprint-to-a-.cc-f.patch" size="2620" author="dreiss" created="Tue, 5 Oct 2010 05:24:37 +0000"/>
                            <attachment id="12456364" name="ASF.LICENSE.NOT.GRANTED--v5-0002-THRIFT-868.-Make-const-values-work-properly-with-typ.patch" size="3890" author="dreiss" created="Tue, 5 Oct 2010 05:24:37 +0000"/>
                            <attachment id="12456218" name="THIRFT-868_Referencing_constant_values_dont_work_with_typedefs.patch" size="1798" author="greafine" created="Sun, 3 Oct 2010 01:15:33 +0000"/>
                            <attachment id="12456311" name="THRIFT-868-v1_Referencing_constant_values_dont_work_with_typedefs.patch" size="6853" author="greafine" created="Mon, 4 Oct 2010 20:14:51 +0000"/>
                            <attachment id="12456343" name="THRIFT-868-v2_Referencing_constant_values_dont_work_with_typedefs.patch" size="3099" author="greafine" created="Mon, 4 Oct 2010 23:42:45 +0000"/>
                            <attachment id="12456347" name="THRIFT-868-v3_Referencing_constant_values_dont_work_with_typedefs.patch" size="3118" author="greafine" created="Tue, 5 Oct 2010 00:13:04 +0000"/>
                            <attachment id="12456361" name="THRIFT-868-v4_Referencing_constant_values_dont_work_with_typedefs.patch" size="3273" author="greafine" created="Tue, 5 Oct 2010 04:14:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>187010</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 8 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i169tj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>244723</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>