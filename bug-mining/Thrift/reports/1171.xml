<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:16:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-2955] Using list of typedefs does not compile on Go</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-2955</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;Using a list with a typedefed value in a struct does not generate compilable&lt;br/&gt;
Go code.&lt;/p&gt;

&lt;p&gt;Here is a small example definition which generates uncompilable code on at&lt;br/&gt;
least 0.9.2 and git master (as of the reporting of this issue).&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unable to find source-code formatter for language: thrift.&lt;/span&gt; Available languages are: actionscript, ada, applescript, bash, c, c#, c++, cpp, css, erlang, go, groovy, haskell, html, java, javascript, js, json, lua, none, nyan, objc, perl, php, python, r, rainbow, ruby, scala, sh, sql, swift, visualbasic, xml, yaml&lt;/div&gt;&lt;pre&gt;namespace go poc
typedef i64 X
struct Y {
	1: list&amp;lt;X&amp;gt; xs
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ve extracted some of the relevant snippets of code from the generated Go&lt;br/&gt;
code.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-go&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;type&lt;/span&gt; X &lt;span class=&quot;code-object&quot;&gt;int64&lt;/span&gt;

&lt;span class=&quot;code-keyword&quot;&gt;type&lt;/span&gt; Y &lt;span class=&quot;code-keyword&quot;&gt;struct&lt;/span&gt; {
	Xs []&lt;span class=&quot;code-object&quot;&gt;int64&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;`thrift:&lt;span class=&quot;code-quote&quot;&gt;&quot;xs,1&quot;&lt;/span&gt; json:&lt;span class=&quot;code-quote&quot;&gt;&quot;xs&quot;&lt;/span&gt;`&lt;/span&gt;
}

&lt;span class=&quot;code-keyword&quot;&gt;func&lt;/span&gt; (p *Y) ReadField1(ipot thrift.TProtocol) error {
	tSlice := make([]&lt;span class=&quot;code-object&quot;&gt;int64&lt;/span&gt;, 0, size)
	&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; i := 0; i &amp;lt; size; i++ {
		&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; _elem0 X
		&lt;span class=&quot;code-comment&quot;&gt;// _elem0 declared as X above
&lt;/span&gt;		&lt;span class=&quot;code-comment&quot;&gt;// [...]
&lt;/span&gt;			temp := X(v)
			_elem0 = temp
		&lt;span class=&quot;code-comment&quot;&gt;// [...]
&lt;/span&gt;		&lt;span class=&quot;code-comment&quot;&gt;// Trying to append _elem0 (of &lt;span class=&quot;code-keyword&quot;&gt;type&lt;/span&gt; X) to p.Xs of &lt;span class=&quot;code-keyword&quot;&gt;type&lt;/span&gt; []&lt;span class=&quot;code-object&quot;&gt;int64&lt;/span&gt;
&lt;/span&gt;		p.Xs = append(p.Xs, _elem0)
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The issue is that the code is trying to append the typedefed type to a list of&lt;br/&gt;
the underlying type. I.e. appending &lt;tt&gt;X&lt;/tt&gt; to a list of &lt;tt&gt;int64&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Smallest code change to make the generated code work is to cast &lt;tt&gt;_elem0&lt;/tt&gt; to&lt;br/&gt;
&lt;tt&gt;int64&lt;/tt&gt; in the &lt;tt&gt;append&lt;/tt&gt; operation. However it might be better to actually&lt;br/&gt;
have &lt;tt&gt;p.Xs&lt;/tt&gt; be of type &lt;tt&gt;[]X&lt;/tt&gt; rather than &lt;tt&gt;[]int64&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;(Currently I&apos;m manually patching my generated Go code with type casts before appending to these lists.)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Using golang 1.4 on linux/amd64&lt;/p&gt;</environment>
        <key id="12770661">THRIFT-2955</key>
            <summary>Using list of typedefs does not compile on Go</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jensg">Jens Geyer</assignee>
                                    <reporter username="axiom">Johannes Martinsson</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Jan 2015 12:51:48 +0000</created>
                <updated>Wed, 22 Feb 2017 21:01:14 +0000</updated>
                            <resolved>Tue, 3 Feb 2015 21:38:23 +0000</resolved>
                                    <version>0.9.2</version>
                                    <fixVersion>0.9.3</fixVersion>
                                    <component>Go - Compiler</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14295918" author="jensg" created="Wed, 28 Jan 2015 21:50:41 +0000"  >&lt;p&gt;In other words, you would be able to provide a patch or pull request?&lt;/p&gt;</comment>
                            <comment id="14301185" author="axiom" created="Mon, 2 Feb 2015 11:54:45 +0000"  >&lt;p&gt;I believe the addition of the &lt;tt&gt;-&amp;gt;get_true_type()&lt;/tt&gt; in issue 2793 introduced the bug.&lt;/p&gt;</comment>
                            <comment id="14301256" author="axiom" created="Mon, 2 Feb 2015 13:19:30 +0000"  >&lt;p&gt;The attached patch seems to work. Would be nice with some input on this, I&apos;m not very confident in regards to this patch.&lt;/p&gt;</comment>
                            <comment id="14303939" author="jensg" created="Tue, 3 Feb 2015 20:40:46 +0000"  >&lt;p&gt;Against which commit is the patch created? I get an arror with current master:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;error: patch failed: compiler/cpp/src/generate/t_go_generator.cc:154
error: compiler/cpp/src/generate/t_go_generator.cc: patch does not apply
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14303945" author="axiom" created="Tue, 3 Feb 2015 20:44:10 +0000"  >&lt;p&gt;Oh, my bad, I though git would include that information in the patch. Anyway, I based it off 0.9.2; commit &lt;tt&gt;591e20f9636c37527a70dc03598218c3468a0eff&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14303984" author="jensg" created="Tue, 3 Feb 2015 21:06:23 +0000"  >&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12696283/12696283_THRIFT-2955-Using-list-of-typedefs-does-not-compile-%28master%29.patch&quot; title=&quot;THRIFT-2955-Using-list-of-typedefs-does-not-compile-(master).patch attached to THRIFT-2955&quot;&gt;same patch but against master&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;EDIT: there&apos;s a comma missing in the patch.&lt;/p&gt;</comment>
                            <comment id="14304057" author="jensg" created="Tue, 3 Feb 2015 21:38:23 +0000"  >&lt;p&gt;Many thanks, just committed (to master).&lt;/p&gt;</comment>
                            <comment id="14304136" author="hudson" created="Tue, 3 Feb 2015 22:19:13 +0000"  >&lt;p&gt;FAILURE: Integrated in Thrift #1445 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/1445/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/1445/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2955&quot; title=&quot;Using list of typedefs does not compile on Go&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2955&quot;&gt;&lt;del&gt;THRIFT-2955&lt;/del&gt;&lt;/a&gt; Using list of typedefs does not compile on Go (jensg: rev 12d430e723b020f7a8ce42a40c19edf88f948367)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;compiler/cpp/src/generate/t_go_generator.cc&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2955&quot; title=&quot;Using list of typedefs does not compile on Go&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2955&quot;&gt;&lt;del&gt;THRIFT-2955&lt;/del&gt;&lt;/a&gt; Using list of typedefs does not compile on Go (jensg: rev 2663ec43ab5954d65d4bfb1509d963ac40019789)&lt;/li&gt;
	&lt;li&gt;compiler/cpp/src/generate/t_go_generator.cc&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12751219">THRIFT-2793</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="13034976">THRIFT-4031</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12695919" name="0001-Be-explicit-about-when-to-use-true-type.patch" size="3558" author="axiom" created="Mon, 2 Feb 2015 13:19:30 +0000"/>
                            <attachment id="12696283" name="THRIFT-2955-Using-list-of-typedefs-does-not-compile-(master).patch" size="3776" author="jensg" created="Tue, 3 Feb 2015 21:06:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 42 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i24w9j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>