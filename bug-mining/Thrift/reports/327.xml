<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:58:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-914] Make haskell bindings &apos;easily&apos; compilable</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-914</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;Current Setup.lhs file has weird commenting that barfs on my machine (Haskell does not use # as a comment marker). Also, after much recent mungling from me the .cabal file is out of date.&lt;/p&gt;

&lt;p&gt;This patch fixes both issues, making it easy to test the haskell bindings compilability state:&lt;/p&gt;

{noquote}&lt;br/&gt;
cabal update&lt;br/&gt;
cabal install network binary http&lt;br/&gt;
cd $THRIFT/lib/hs/src&lt;br/&gt;
runhaskell Setup.lhs configure --user # --user is optional, but you&apos;ll need root-like powers without it&lt;br/&gt;
runhaskell Setup.lhs build&lt;br/&gt;
runhaskell Setup.lhs install # optional, really{noquote}

&lt;p&gt;Also, with the recent commit of the improved type bindings, it&apos;s worth bumping the thrift cabal package&apos;s version number &amp;#8211; that change was major API breakage.&lt;/p&gt;

&lt;p&gt;(Please note this does NOT integrate with autotools in any useful way, but is a prerequisite for &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-905&quot; title=&quot;Make haskell thrift bindings use automake to compile and install&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-905&quot;&gt;&lt;del&gt;THRIFT-905&lt;/del&gt;&lt;/a&gt; to be useful)&lt;/p&gt;</description>
                <environment>&lt;p&gt;GHC 6.12.3, Mac OS X 10.6, Haskell Platform 2010.2.0.0&lt;/p&gt;

&lt;p&gt;Darwin &amp;#8211; 10.4.0 Darwin Kernel Version 10.4.0: Fri Apr 23 18:28:53 PDT 2010; root:xnu-1504.7.4~1/RELEASE_I386 i386&lt;br/&gt;
The Glorious Glasgow Haskell Compilation System, version 6.12.3&lt;/p&gt;</environment>
        <key id="12474824">THRIFT-914</key>
            <summary>Make haskell bindings &apos;easily&apos; compilable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="clavoie">Christian Lavoie</assignee>
                                    <reporter username="clavoie">Christian Lavoie</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Sep 2010 14:30:18 +0000</created>
                <updated>Tue, 1 Nov 2011 02:51:58 +0000</updated>
                            <resolved>Thu, 23 Sep 2010 22:29:40 +0000</resolved>
                                    <version>0.5</version>
                                    <fixVersion>0.5</fixVersion>
                                    <component>Haskell - Compiler</component>
                    <component>Haskell - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12913639" author="djnym" created="Wed, 22 Sep 2010 16:10:55 +0000"  >&lt;p&gt;This should allow me to at least test compilation of the other patches you&apos;ve been submitting so I&apos;ll definitely try this one out.&lt;/p&gt;

&lt;p&gt;Are the cabal commands necessary if say I have homebrew haskell-platform (which seems to already have all those available)?&lt;/p&gt;

&lt;p&gt;Also, you might want to send in a patch for the README in the lib/hs directory which has alternate build instructions.&lt;/p&gt;</comment>
                            <comment id="12913652" author="clavoie" created="Wed, 22 Sep 2010 16:31:32 +0000"  >&lt;p&gt;Please try without and let me know. At least on bryanduxbury&apos;s box there&lt;br/&gt;
were version conflicts with the network package (and other issues).&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-914?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;amp;focusedCommentId=12913639#action_12913639&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/THRIFT-914?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;amp;focusedCommentId=12913639#action_12913639&lt;/a&gt;]&lt;br/&gt;
you&apos;ve been submitting so I&apos;ll definitely try this one out.&lt;br/&gt;
(which seems to already have all those available)?&lt;br/&gt;
directory which has alternate build instructions.&lt;br/&gt;
2010; root:xnu-1504.7.4~1/RELEASE_I386 i386&lt;br/&gt;
(Haskell does not use # as a comment marker). Also, after much recent&lt;br/&gt;
mungling from me the .cabal file is out of date.&lt;br/&gt;
compilability state:&lt;br/&gt;
need root-like powers without it&lt;br/&gt;
bumping the thrift cabal package&apos;s version number &amp;#8211; that change was major&lt;br/&gt;
API breakage.&lt;br/&gt;
but is a prerequisite for &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-905&quot; title=&quot;Make haskell thrift bindings use automake to compile and install&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-905&quot;&gt;&lt;del&gt;THRIFT-905&lt;/del&gt;&lt;/a&gt; to be useful)&lt;/p&gt;</comment>
                            <comment id="12913666" author="djnym" created="Wed, 22 Sep 2010 16:59:43 +0000"  >&lt;p&gt;Well, with homebrew haskell-package you still need the cabal commands at leat&lt;/p&gt;

&lt;p&gt;% cabal update&lt;br/&gt;
% cabal install binary&lt;br/&gt;
% runhaskell Setup.lhs configure --user &lt;br/&gt;
% runhaskell Setup.lhs build&lt;/p&gt;

&lt;p&gt;works for me.&lt;/p&gt;

&lt;p&gt;Although the cabal install binary gives me lots of warnings like&lt;/p&gt;

&lt;p&gt;    Warning: Module `Prelude&apos; is deprecated:&lt;br/&gt;
               You are using the old package `base&apos; version 3.x.&lt;br/&gt;
               Future GHC versions will not support base version 3.x. You&lt;br/&gt;
               should update your code to use the new base version 4.x.&lt;/p&gt;

&lt;p&gt;And if I don&apos;t include &apos;--user&apos; it doesn&apos;t work (seems like cabal installs things as my user, so not using --user fails to find the binary module).&lt;/p&gt;

&lt;p&gt;I still want to see if I can get a version of 6.10 working so I can make sure it looks good.&lt;/p&gt;

&lt;p&gt;Your comment seems a little mangled, I&apos;m a bit unclear as to what the problem with Bryan&apos;s box was?&lt;/p&gt;</comment>
                            <comment id="12913676" author="djnym" created="Wed, 22 Sep 2010 17:35:01 +0000"  >&lt;p&gt;Okay, got 6.10 via macports working, but it has a problem&lt;/p&gt;

&lt;p&gt;% runhaskell Setup.lhs build           &lt;br/&gt;
Preprocessing library Thrift-0.2.0...&lt;br/&gt;
Building Thrift-0.2.0...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;1 of 7&amp;#93;&lt;/span&gt; Compiling Thrift.Transport ( src/Thrift/Transport.hs, dist/build/Thrift/Transport.o )&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2 of 7&amp;#93;&lt;/span&gt; Compiling Thrift.Transport.Handle ( src/Thrift/Transport/Handle.hs, dist/build/Thrift/Transport/Handle.o )&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;3 of 7&amp;#93;&lt;/span&gt; Compiling Thrift.Transport.HttpClient ( src/Thrift/Transport/HttpClient.hs, dist/build/Thrift/Transport/HttpClient.o )&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;4 of 7&amp;#93;&lt;/span&gt; Compiling Thrift.Protocol  ( src/Thrift/Protocol.hs, dist/build/Thrift/Protocol.o )&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;5 of 7&amp;#93;&lt;/span&gt; Compiling Thrift.Protocol.Binary ( src/Thrift/Protocol/Binary.hs, dist/build/Thrift/Protocol/Binary.o )&lt;/p&gt;

&lt;p&gt;/var/folders/q7/q7p9BF14FxqQhWcZbhqHiU+++TI/&lt;del&gt;Tmp&lt;/del&gt;/ghc45876_0/ghc45876_0.s:4188:0:&lt;br/&gt;
    suffix or operands invalid for `movq&apos;&lt;/p&gt;

&lt;p&gt;It does seem to compile fine with 6.12.3 from homebrew (even without &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-743&quot; title=&quot;compile error with GHC 6.12.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-743&quot;&gt;&lt;del&gt;THRIFT-743&lt;/del&gt;&lt;/a&gt;, any idea why that is the case?).  Do you have any idea what could be causing this failure?&lt;/p&gt;</comment>
                            <comment id="12913708" author="clavoie" created="Wed, 22 Sep 2010 18:33:50 +0000"  >&lt;p&gt;&amp;gt; It does seem to compile fine with 6.12.3 from homebrew (even without &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-743&quot; title=&quot;compile error with GHC 6.12.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-743&quot;&gt;&lt;del&gt;THRIFT-743&lt;/del&gt;&lt;/a&gt;, any idea why that is the case?).&lt;/p&gt;

&lt;p&gt;Yes &amp;#8211; see my comments above about -glasgow-exts and -XArrows.&lt;/p&gt;

&lt;p&gt;To recap:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;ghc 6.11.something (development version) introduced the -XArrows flag (and the matching Arrows haskell language extension) which reserves identifiers &apos;proc&apos; and &apos;rec&apos; as keywords.&lt;/li&gt;
	&lt;li&gt;-fglasgow-exts is a ghc flag that enables all glasgow (==ghc) haskell extensions (including -XArrows)&lt;/li&gt;
	&lt;li&gt;Before my patches &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-901&quot; title=&quot;Allow the bindings to compile without -fglasgow-exts and with -Wall -Werror&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-901&quot;&gt;&lt;del&gt;THRIFT-901&lt;/del&gt;&lt;/a&gt; (recently commited by Bryan Duxbury) and &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-914&quot; title=&quot;Make haskell bindings &amp;#39;easily&amp;#39; compilable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-914&quot;&gt;&lt;del&gt;THRIFT-914&lt;/del&gt;&lt;/a&gt; (this very JIRA issue) the Thrift bindings required -fglasgow-exts&lt;/li&gt;
	&lt;li&gt;Because of stuff like #1, releasing general libraries that require -fglasgow-exts is a suboptimal situation &amp;#8211; as is the case here, new extensions have the nasty habit of clashing with older codebases&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;When ghc 6.12 came out, Thrift stopped compiling without my patches or without &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-743&quot; title=&quot;compile error with GHC 6.12.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-743&quot;&gt;&lt;del&gt;THRIFT-743&lt;/del&gt;&lt;/a&gt;. Now &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-743&quot; title=&quot;compile error with GHC 6.12.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-743&quot;&gt;&lt;del&gt;THRIFT-743&lt;/del&gt;&lt;/a&gt; is only required IFF you want to use both thrift and the Arrows extension. If you don&apos;t want or use Arrows (or ghc 6.12), it&apos;s redundant but entirely harmless.&lt;/p&gt;

&lt;p&gt;So the full state matrix is:&lt;/p&gt;

&lt;p&gt;1) Before my patches and before &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-743&quot; title=&quot;compile error with GHC 6.12.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-743&quot;&gt;&lt;del&gt;THRIFT-743&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Thrift passes -fglasgow-exts to ghc&lt;/li&gt;
	&lt;li&gt;Thrift and thrift-compiler generated code would compile with ghc 6.10 (and probably any earlier ghc6 version, but I have not tested this)&lt;/li&gt;
	&lt;li&gt;Thrift would NOT compile with ghc 6.12&lt;/li&gt;
	&lt;li&gt;Thrift-compiler generated code would NOT compile if your build system passed -XArrows (this is my case and how I got started on this path) or -fglasgow-exts (which implicitly turns on -XArrows; and probably was Martin&apos;s case)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;2) After my patches but before &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-743&quot; title=&quot;compile error with GHC 6.12.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-743&quot;&gt;&lt;del&gt;THRIFT-743&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Thrift does NOT pass -fglasgow-exts (or any of the extension flags anywhere, but rather turns them on individually as pragmas, for maximum compatibility with random build scripts)&lt;/li&gt;
	&lt;li&gt;Thrift would compile in all cases (except if you somehow forced -fglasgow-exts or -XArrows to the ghc invokation compiling thrift itself)&lt;/li&gt;
	&lt;li&gt;The thrift-compiler generated code would NOT compile if your build system passed -XArrows to GHC when trying to build the generated code (this is still my case)&lt;/li&gt;
	&lt;li&gt;The thrift compiler generated code will compile in all other cases (including, if I read you correctly, your current situation)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;3) After my patches and after &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-743&quot; title=&quot;compile error with GHC 6.12.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-743&quot;&gt;&lt;del&gt;THRIFT-743&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Both the thrift/lib/hs/src/... code and the thrift-compiler generated code will compile in all cases (except, apparently, with your homebrew haskell platform, see below for my thoughts on that &amp;#8211; it is, I believe, a completely unrelated issue)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&amp;gt; Do you have any idea what could be causing this failure?&lt;/p&gt;

&lt;p&gt;Bug in GHC, is my gut feeling; specifically, in the evil mangler: &lt;a href=&quot;http://hackage.haskell.org/trac/ghc/wiki/Commentary/EvilMangler&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hackage.haskell.org/trac/ghc/wiki/Commentary/EvilMangler&lt;/a&gt;). Try making sure your homebrew version is using ghc&apos;s native code backend just for fun; or use a different version of perl (no, seriously, see &lt;a href=&quot;http://www.mail-archive.com/cvs-ghc@haskell.org/msg02780.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.mail-archive.com/cvs-ghc@haskell.org/msg02780.html&lt;/a&gt; for an example bug caused by perl version).&lt;/p&gt;

&lt;p&gt;You could always attach the .s file, but I haven&apos;t played with x86 assembly in about a decade, and never with ghc&apos;s internals (evil mangler or not). Not sure I can do much there.&lt;/p&gt;

&lt;p&gt;I asked, there seems to be general consensus in the haskell irc channel that macports&apos; ghc is particularly sensitive to perl versions.&lt;/p&gt;</comment>
                            <comment id="12914261" author="djnym" created="Thu, 23 Sep 2010 22:29:40 +0000"  >&lt;p&gt;Okay, so I decided not to worry too much about not being able to compile with older haskell from macports, the problem seems very bizarre with perl versions and not really worth the effort to solve.  Homebrew compilation works fine, so I committed this.  Thanks Christian.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12455268" name="v1-thrift-fix-cabal-Setup.patch" size="2860" author="clavoie" created="Wed, 22 Sep 2010 14:30:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38720</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 9 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16bp3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245027</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>