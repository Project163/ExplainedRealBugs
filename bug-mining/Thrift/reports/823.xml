<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:09:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-2200] nested structs cause generate_fingerprint() to slow down at excessive CPU load</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-2200</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;The file &lt;a href=&quot;http://pastebin.com/H5Uj74aW&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://pastebin.com/H5Uj74aW&lt;/a&gt; contains a number of nested structs definitions. These highly recursive structs (over 8 levels in this case) cause the get_fingerprint_material() method to loop over minutes.&lt;/p&gt;

&lt;p&gt;Thanks to Niclas who prepared the pastebin.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12669566">THRIFT-2200</key>
            <summary>nested structs cause generate_fingerprint() to slow down at excessive CPU load</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jensg">Jens Geyer</assignee>
                                    <reporter username="jensg">Jens Geyer</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Sep 2013 22:03:22 +0000</created>
                <updated>Sat, 5 Oct 2013 01:43:26 +0000</updated>
                            <resolved>Mon, 23 Sep 2013 20:11:25 +0000</resolved>
                                                    <fixVersion>0.9.2</fixVersion>
                                    <component>Compiler (General)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13772445" author="jensg" created="Thu, 19 Sep 2013 23:13:17 +0000"  >&lt;p&gt;The patch idea:&lt;br/&gt;
(a) reduce  memory reallocation in get_fp_material()&lt;br/&gt;
(b) lazy fp generation: only when we really need it&lt;/p&gt;

&lt;p&gt;Tested against previous output. Old fingerprints remain the same, but due to the nature of the change the compiler now creates fps for ALL structs. I don&apos;t think this is a showstopper, though.&lt;/p&gt;</comment>
                            <comment id="13773782" author="jensg" created="Sat, 21 Sep 2013 10:32:03 +0000"  >&lt;p&gt;Hi C++ folks,&lt;/p&gt;

&lt;p&gt;would be great if someone could spend some time to review that soon. Most changes affect C++, but all languages will profit from an overall more performant Thrift Compiler due to lazy FP generation. &lt;/p&gt;

&lt;p&gt;The patch can very likely be combined without much hassle with Randy&apos;s &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2199&quot; title=&quot;Remove Dense protocol (was: move to Contrib)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2199&quot;&gt;&lt;del&gt;THRIFT-2199&lt;/del&gt;&lt;/a&gt; proposal (Randy, please correct me if I&apos;m wrong). &lt;/p&gt;

&lt;p&gt;Thanks in advance&lt;/p&gt;</comment>
                            <comment id="13773864" author="codesf" created="Sat, 21 Sep 2013 17:50:13 +0000"  >&lt;p&gt;Hey Jens,&lt;/p&gt;

&lt;p&gt;If there&apos;s support for 2199 all of the fingerprint compiler stuff would move to contrib along with the dense files from the lib/cpp. 2200 is not a conflict at all and a nice fix in the meantime.&lt;/p&gt;

&lt;p&gt;Best,&lt;br/&gt;
Randy&lt;/p&gt;</comment>
                            <comment id="13774545" author="ben.craig" created="Mon, 23 Sep 2013 13:39:20 +0000"  >&lt;p&gt;I have not tested the patch and I don&apos;t use fingerprints / dense protocol, but it looks (mostly) good.  The only thing that I saw that seemed off was the following lines:&lt;br/&gt;
+    if( rv.capacity() &amp;gt; (rv.size() + 0x4000)) &lt;/p&gt;
{
+      rv.reserve( rv.size());  // correct heavily oversized allocations to reduce memory footprint
+    }
&lt;p&gt;string::reserve usually won&apos;t shrink a string&apos;s capacity.  I would recommend removing those lines.&lt;/p&gt;</comment>
                            <comment id="13775614" author="jensg" created="Mon, 23 Sep 2013 20:11:25 +0000"  >&lt;blockquote&gt;
&lt;p&gt;string::reserve usually won&apos;t shrink a string&apos;s capacity. I would recommend removing those lines.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks, done and committed.&lt;/p&gt;</comment>
                            <comment id="13775669" author="hudson" created="Mon, 23 Sep 2013 21:12:20 +0000"  >&lt;p&gt;FAILURE: Integrated in Thrift #915 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/915/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/915/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2200&quot; title=&quot;nested structs cause generate_fingerprint() to slow down at excessive CPU load&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2200&quot;&gt;&lt;del&gt;THRIFT-2200&lt;/del&gt;&lt;/a&gt;: nested structs cause generate_fingerprint() to slow down at excessive CPU load (jensg: rev 83767a72cd94c0bcc89d350bc551227f41669479)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;compiler/cpp/src/parse/parse.cc&lt;/li&gt;
	&lt;li&gt;compiler/cpp/src/parse/t_type.h&lt;/li&gt;
	&lt;li&gt;compiler/cpp/src/generate/t_cpp_generator.cc&lt;/li&gt;
	&lt;li&gt;compiler/cpp/src/parse/t_struct.h&lt;/li&gt;
	&lt;li&gt;compiler/cpp/src/main.cc&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12669565">THRIFT-2199</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12604149" name="THRIFT-2200_slow_fingerprints.patch" size="4636" author="jensg" created="Thu, 19 Sep 2013 23:11:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>349498</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 9 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1o9hj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>349796</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>