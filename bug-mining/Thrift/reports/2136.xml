<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:33:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-5353] Namespace from type is ignored in generated code</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-5353</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;When using the Go compiler 0.14 with the Thrift spec below, the generated function does not use the namespace, causing compilation issues.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

include &lt;span class=&quot;code-quote&quot;&gt;&quot;jaeger.thrift&quot;&lt;/span&gt;
include &lt;span class=&quot;code-quote&quot;&gt;&quot;zipkincore.thrift&quot;&lt;/span&gt;

namespace cpp jaegertracing.agent.thrift
namespace java io.jaegertracing.agent.thrift
namespace php Jaeger.Thrift.Agent
namespace netstd Jaeger.Thrift.Agent
namespace lua jaeger.thrift.agent

service Agent {
    oneway void emitZipkinBatch(1: list&amp;lt;zipkincore.Span&amp;gt; spans)
    oneway void emitBatch(1: jaeger.Batch batch)
}

 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here&apos;s an excerpt of the generated Go code for this service:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

&lt;span class=&quot;code-comment&quot;&gt;// Code generated by Thrift &lt;span class=&quot;code-object&quot;&gt;Compiler&lt;/span&gt; (0.14.0). DO NOT EDIT.
&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; agent

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt;(
	&lt;span class=&quot;code-quote&quot;&gt;&quot;bytes&quot;&lt;/span&gt;
	&lt;span class=&quot;code-quote&quot;&gt;&quot;context&quot;&lt;/span&gt;
	&lt;span class=&quot;code-quote&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
	&lt;span class=&quot;code-quote&quot;&gt;&quot;time&quot;&lt;/span&gt;
	&lt;span class=&quot;code-quote&quot;&gt;&quot;github.com/apache/thrift/lib/go/thrift&quot;&lt;/span&gt;
	&lt;span class=&quot;code-quote&quot;&gt;&quot;github.com/jaegertracing/jaeger/thrift-gen/jaeger&quot;&lt;/span&gt;

)

&lt;span class=&quot;code-comment&quot;&gt;// (needed to ensure safety because of naive &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; list construction.)
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; _ = thrift.ZERO
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; _ = fmt.Printf
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; _ = context.Background
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; _ = time.Now
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; _ = bytes.Equal

&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; _ = jaeger.GoUnusedProtection__
type Agent &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; {
  &lt;span class=&quot;code-comment&quot;&gt;// Parameters:
&lt;/span&gt;  &lt;span class=&quot;code-comment&quot;&gt;//  - Spans
&lt;/span&gt;  EmitZipkinBatch(ctx context.Context, spans []*Span) (err error)
  &lt;span class=&quot;code-comment&quot;&gt;// Parameters:
&lt;/span&gt;  &lt;span class=&quot;code-comment&quot;&gt;//  - Batch
&lt;/span&gt;  EmitBatch(ctx context.Context, batch *jaeger.Batch) (err error)
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In previous versions like 0.13, this is how the generated code looks like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

&lt;span class=&quot;code-comment&quot;&gt;// Autogenerated by Thrift &lt;span class=&quot;code-object&quot;&gt;Compiler&lt;/span&gt; (0.13.0)
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// DO NOT EDIT UNLESS YOU ARE SURE THAT YOU KNOW WHAT YOU ARE DOING
&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; agent

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt;(
	&lt;span class=&quot;code-quote&quot;&gt;&quot;bytes&quot;&lt;/span&gt;
	&lt;span class=&quot;code-quote&quot;&gt;&quot;context&quot;&lt;/span&gt;
	&lt;span class=&quot;code-quote&quot;&gt;&quot;reflect&quot;&lt;/span&gt;
	&lt;span class=&quot;code-quote&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
	&lt;span class=&quot;code-quote&quot;&gt;&quot;github.com/apache/thrift/lib/go/thrift&quot;&lt;/span&gt;
	&lt;span class=&quot;code-quote&quot;&gt;&quot;github.com/jaegertracing/jaeger/thrift-gen/jaeger&quot;&lt;/span&gt;
	&lt;span class=&quot;code-quote&quot;&gt;&quot;github.com/jaegertracing/jaeger/thrift-gen/zipkincore&quot;&lt;/span&gt;

)

&lt;span class=&quot;code-comment&quot;&gt;// (needed to ensure safety because of naive &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; list construction.)
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; _ = thrift.ZERO
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; _ = fmt.Printf
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; _ = context.Background
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; _ = reflect.DeepEqual
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; _ = bytes.Equal

&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; _ = jaeger.GoUnusedProtection__
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; _ = zipkincore.GoUnusedProtection__
type Agent &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; {
  &lt;span class=&quot;code-comment&quot;&gt;// Parameters:
&lt;/span&gt;  &lt;span class=&quot;code-comment&quot;&gt;//  - Spans
&lt;/span&gt;  EmitZipkinBatch(ctx context.Context, spans []*zipkincore.Span) (err error)
  &lt;span class=&quot;code-comment&quot;&gt;// Parameters:
&lt;/span&gt;  &lt;span class=&quot;code-comment&quot;&gt;//  - Batch
&lt;/span&gt;  EmitBatch(ctx context.Context, batch *jaeger.Batch) (err error)
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13359303">THRIFT-5353</key>
            <summary>Namespace from type is ignored in generated code</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fishywang">Yuxuan Wang</assignee>
                                    <reporter username="jpkroehling">Juraci Paix&#227;o Kr&#246;hling</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Feb 2021 12:47:15 +0000</created>
                <updated>Tue, 2 Mar 2021 19:36:51 +0000</updated>
                            <resolved>Mon, 22 Feb 2021 18:05:04 +0000</resolved>
                                    <version>0.14.0</version>
                                    <fixVersion>0.15.0</fixVersion>
                    <fixVersion>0.14.1</fixVersion>
                                    <component>Go - Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="17286589" author="fishywang" created="Thu, 18 Feb 2021 16:51:36 +0000"  >&lt;p&gt;Are you talking about that the included zipkincore.thrift is no longer imported by the go code? You also imported jaeger.thrift and I see that is still imported by 0.14.0 generated go code. We also have thrift files importing multiple other thrift files without an issue. Do you have a full example (with all the imported files) that can be used to reproduce this issue?&lt;/p&gt;</comment>
                            <comment id="17286664" author="jpkroehling" created="Thu, 18 Feb 2021 18:45:02 +0000"  >&lt;p&gt;Sorry, looks like there&apos;s more code in the ticket description than it would be required. It&apos;s basically down to these two lines.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Before (working)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

  EmitZipkinBatch(ctx context.Context, spans []*zipkincore.Span) (err error)

 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After (not working)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

  EmitZipkinBatch(ctx context.Context, spans []*Span) (err error)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When using the code generated from 0.14, I get the following compilation errors:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
# github.com/jaegertracing/jaeger/thrift-gen/agent
thrift-gen/agent/agent.go:26:49: undefined: Span
thrift-gen/agent/agent.go:69:69: undefined: Span
thrift-gen/agent/agent.go:188:12: undefined: Span
thrift-gen/agent/agent.go:196:50: undefined: Span
thrift-gen/agent/agent.go:242:21: undefined: Span
thrift-gen/agent/agent.go:245:16: undefined: Span

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here&apos;s our current code: &lt;a href=&quot;https://github.com/jaegertracing/jaeger/blob/cc3c8e3231ea9bb8d6a4185ab634a3009a46be1b/thrift-gen/agent/agent.go#L62-L69&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jaegertracing/jaeger/blob/cc3c8e3231ea9bb8d6a4185ab634a3009a46be1b/thrift-gen/agent/agent.go#L62-L69&lt;/a&gt; and this is the code that is generated with 0.14: &lt;a href=&quot;https://github.com/jpkrohling/jaeger/blob/c074b7eee1ed3f805a7e07e091cd4016d3aada2f/thrift-gen/agent/agent.go#L69-L77&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jpkrohling/jaeger/blob/c074b7eee1ed3f805a7e07e091cd4016d3aada2f/thrift-gen/agent/agent.go#L69-L77&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17286682" author="fishywang" created="Thu, 18 Feb 2021 19:16:20 +0000"  >&lt;p&gt;This is indeed a behavior change between the compiler 0.13.0 and 0.14.0, I&apos;m not yet tracked down which change caused this.&lt;/p&gt;

&lt;p&gt;But your way of doing it is also not the best. This will be fixed if you add &quot;namespace go zipkincore&quot; to zipkincore.thrift (I&apos;d suggest you do that for all the thrift files):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ git diff
diff --git a/thrift/zipkincore.thrift b/thrift/zipkincore.thrift
index 5bc93d7..626c3c3 100644
--- a/thrift/zipkincore.thrift
+++ b/thrift/zipkincore.thrift
@@ -18,6 +18,7 @@ namespace rb Zipkin
 namespace php Jaeger.Thrift.Agent.Zipkin
 namespace netstd Jaeger.Thrift.Agent.Zipkin
 namespace lua jaeger.thrift.agent
+namespace go zipkincore
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And also the sed replacement you are doing in the Makefile (&lt;a href=&quot;https://github.com/jaegertracing/jaeger/blob/cc3c8e3231ea9bb8d6a4185ab634a3009a46be1b/Makefile#L462-L463&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jaegertracing/jaeger/blob/cc3c8e3231ea9bb8d6a4185ab634a3009a46be1b/Makefile#L462-L463&lt;/a&gt;) is totally unnecessary if you just add &apos;,package_prefix=&quot;$(JAEGER_IMPORT_PATH)/thrift-gen/&quot;&apos; to your THRIFT_GO_ARGS. That&apos;s the proper way of handling the go import paths of thrift includes.&lt;/p&gt;</comment>
                            <comment id="17286688" author="fishywang" created="Thu, 18 Feb 2021 19:22:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/thrift/commit/f4475ff76fe3dcc1b3774d52bf28b333ab9acd01&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/commit/f4475ff76fe3dcc1b3774d52bf28b333ab9acd01&lt;/a&gt; is likely the change caused this behavior change. cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dcelasun&quot; class=&quot;user-hover&quot; rel=&quot;dcelasun&quot;&gt;dcelasun&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17286691" author="fishywang" created="Thu, 18 Feb 2021 19:28:43 +0000"  >&lt;p&gt;So the problem, as I understood it, is that&lt;/p&gt;

&lt;p&gt;1. You do not have go namespaces explicitly defined in the thrift files, so the go namespaces are inferred from the file names&lt;br/&gt;
2. We added a logic to dedup multiple includes from the same namespace, that logic likely incorrectly assumed that the two different thrift files without go namespaces are from the same go namespace and dedup&apos;d the second one. The logic likely didn&apos;t get the inferred namespace from filename correctly.&lt;/p&gt;</comment>
                            <comment id="17286692" author="fishywang" created="Thu, 18 Feb 2021 19:29:29 +0000"  >&lt;p&gt;So while we can fix 2, 1 is a much easier immediate fix for you (by adding explicit go namespaces to the thrift files).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 38 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0nsm0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>