<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:09:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-820] The readLength attribute of TBinaryProtocol is used as an instance variable and is decremented on each call of checkReadLength</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-820</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;When coding towards readLength, I saw this more as a check on the message length as it comes in. Perhaps its me, but I just dont see why this should decrement giving the length header for each message.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12469380">THRIFT-820</key>
            <summary>The readLength attribute of TBinaryProtocol is used as an instance variable and is decremented on each call of checkReadLength</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="carlyeks">Carl Yeksigian</assignee>
                                    <reporter username="zznate">Nate McCall</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Jul 2010 20:44:03 +0000</created>
                <updated>Sat, 17 Aug 2013 23:54:27 +0000</updated>
                            <resolved>Wed, 14 Aug 2013 23:39:14 +0000</resolved>
                                    <version>0.2</version>
                    <version>0.3</version>
                                    <fixVersion>0.9.1</fixVersion>
                                    <component>Java - Library</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>12</watches>
                                                                                                                <comments>
                            <comment id="12890328" author="jbellis" created="Tue, 20 Jul 2010 17:05:48 +0000"  >&lt;p&gt;The consensus in #thrift seemed to be that the &quot;right&quot; fix is to reset the length value for each new message, thus making it a sort of frame size for unframed connections.&lt;/p&gt;</comment>
                            <comment id="12892171" author="zznate" created="Mon, 26 Jul 2010 04:41:23 +0000"  >&lt;p&gt;FWIW, we switched to creating new TProtocolBuffer objects after each TProcessor.process call (&lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-475&quot; title=&quot;sending random data crashes thrift service&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CASSANDRA-475&quot;&gt;&lt;del&gt;CASSANDRA-475&lt;/del&gt;&lt;/a&gt;) so we are not so hot-to-trot on this for now. &lt;/p&gt;

&lt;p&gt;If the consensus is to reset the length, that&apos;s fine, but then a resetLength() method should exposed for such.&lt;/p&gt;</comment>
                            <comment id="12965952" author="tkinnis" created="Thu, 2 Dec 2010 01:25:09 +0000"  >&lt;p&gt;I think this change is necessary and a resetLength() style solution won&apos;t be appropriate in many cases, namely when a client instance is reused for multiple service calls. In this case each service call deducts from readLength and can cause the client to fail when it eventually hits zero.&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;

&lt;p&gt;TProtocolFactory factory = new TBinaryProtocol.Factory(false, true, 100);&lt;/p&gt;

&lt;p&gt;Foo.Iface client = new Foo.Client(factory.getProtocol(someTransport));&lt;/p&gt;

&lt;p&gt;// pass client off to some other object&lt;/p&gt;

&lt;p&gt;client.doSomething();&lt;br/&gt;
client.doSomethingElse();&lt;/p&gt;

&lt;p&gt;In this example doSomethingElse() can fail if doSomething() was large enough. It seems reasonable to me that a client should be able to be reused for multiple service calls without concern for this readLength limit. In most cases the consumer of the client would not even know such a limit exists so asking them to reset it wouldn&apos;t be appropriate.&lt;/p&gt;

&lt;p&gt;I started using this limit and then I ran into this exact issue with clients and had to stop using it. I would like to set a reasonable limit to avoid the well-known OutOfMemoryException that can occur when the protocol gets an unexpected message and tries to allocate a MAX_INT buffer.&lt;/p&gt;

&lt;p&gt;I also have a question about the patch. It is unclear to me when checkReadLength() is called. Is it called once for the entire message? Or, is it called once per struct or property it is decoding? Looking at the places were checkReadLength() is called it seems like it is invoked multiple times per message. &lt;/p&gt;

&lt;p&gt;If this is called once for the entire message then the patch seems reasonable. If not then I think the patch is only setting a limit per struct/property, which may be ok but there should be comments indicating that is the case.&lt;/p&gt;</comment>
                            <comment id="13678071" author="jbellis" created="Fri, 7 Jun 2013 14:55:05 +0000"  >&lt;p&gt;As I said three years ago, the intent appears to be providing frame-like protection against OOM for unframed connections, but since it&apos;s languished broken this long, and we presumably have way more modern framed connection these days than otherwise, I suggest just ripping it out.&lt;/p&gt;</comment>
                            <comment id="13678097" author="carlyeks" created="Fri, 7 Jun 2013 15:38:25 +0000"  >&lt;p&gt;Agreed. Just need to get that patch together. &lt;/p&gt;</comment>
                            <comment id="13678341" author="carlyeks" created="Fri, 7 Jun 2013 19:35:28 +0000"  >&lt;p&gt;Attached patch removes usages of readCheck. Languages affected:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;as3&lt;/li&gt;
	&lt;li&gt;c#&lt;/li&gt;
	&lt;li&gt;go&lt;/li&gt;
	&lt;li&gt;java&lt;/li&gt;
	&lt;li&gt;javame&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I removed the setReadLength. We could instead deprecate them, but since the semantics have changed, I&apos;d rather just remove it completely.&lt;/p&gt;</comment>
                            <comment id="13692325" author="jbellis" created="Mon, 24 Jun 2013 20:10:09 +0000"  >&lt;p&gt;WDYT &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bterm&quot; class=&quot;user-hover&quot; rel=&quot;bterm&quot;&gt;bterm&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13692694" author="jfarrell" created="Tue, 25 Jun 2013 02:29:41 +0000"  >&lt;p&gt;Agree, delphi is the only other lang that has this functionality and is not in the new patch. Carl can you update the patch to pull from delphi as well please &lt;/p&gt;</comment>
                            <comment id="13738849" author="carlyeks" created="Tue, 13 Aug 2013 21:24:03 +0000"  >&lt;p&gt;Attached patch also removes from delphi.&lt;/p&gt;</comment>
                            <comment id="13740412" author="jensg" created="Wed, 14 Aug 2013 23:33:19 +0000"  >&lt;p&gt;+1 for Delphi and Go from &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12597828/12597828_820-v2.patch&quot; title=&quot;820-v2.patch attached to THRIFT-820&quot;&gt;820-v2.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="13740421" author="carlyeks" created="Wed, 14 Aug 2013 23:39:15 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="13740462" author="hudson" created="Thu, 15 Aug 2013 00:04:23 +0000"  >&lt;p&gt;FAILURE: Integrated in Thrift #850 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/850/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/850/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-820&quot; title=&quot;The readLength attribute of TBinaryProtocol is used as an instance variable and is decremented on each call of checkReadLength&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-820&quot;&gt;&lt;del&gt;THRIFT-820&lt;/del&gt;&lt;/a&gt; Remove readLength attribute from BinaryProtocol (carl: rev 2ca9c2028593782621c8876817d8772aa5f46ac7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/delphi/src/Thrift.Protocol.pas&lt;/li&gt;
	&lt;li&gt;lib/csharp/src/Protocol/TBinaryProtocol.cs&lt;/li&gt;
	&lt;li&gt;lib/javame/src/org/apache/thrift/protocol/TBinaryProtocol.java&lt;/li&gt;
	&lt;li&gt;lib/java/src/org/apache/thrift/protocol/TBinaryProtocol.java&lt;/li&gt;
	&lt;li&gt;lib/go/thrift/binary_protocol.go&lt;/li&gt;
	&lt;li&gt;lib/as3/src/org/apache/thrift/protocol/TBinaryProtocol.as&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12648660">THRIFT-1975</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12664208">THRIFT-2133</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12597828" name="820-v2.patch" size="12089" author="carlyeks" created="Tue, 13 Aug 2013 21:24:12 +0000"/>
                            <attachment id="12586774" name="820.patch" size="10172" author="carlyeks" created="Fri, 7 Jun 2013 19:35:31 +0000"/>
                            <attachment id="12449592" name="tbinaryprotocol-length-check-patch-THRIFT-820.txt" size="600" author="zznate" created="Thu, 15 Jul 2010 20:45:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>186970</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 14 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14j5b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>234565</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>