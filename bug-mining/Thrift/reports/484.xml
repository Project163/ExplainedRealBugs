<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:01:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-1240] TBinarySerializer.php invalid serialization due to TBufferTransport not flushing last chunk of data into TMemoryBuffer</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-1240</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;Simple Serialization errors out, due to the TBufferTransport not flushing the data into TMemoryBuffer after $object-&amp;gt;write($protocol) in TBinarySerializer.&lt;br/&gt;
Please find the error output of my test program below. It fixed after I added the following line on the serialize method in TBinarySerializer.&lt;/p&gt;

&lt;p&gt;$protocol-&amp;gt;getTransport()-&amp;gt;flush();&lt;/p&gt;

&lt;p&gt;This because of TBinaryProtocolAccelerated internally wraps TMemoryBuffer within TBufferTransport in its constructor.&lt;/p&gt;

&lt;p&gt; TBufferTransport write only if the wbuf_ is full (512 bytes) into TMemoryBuffer. Hence data smaller than 512 will not get written into TMemoryBuffer. While getting serialized data from TMemoryBuffer it might not have the last chunk of data which is less than 512 bytes. &lt;/p&gt;

&lt;p&gt;This outputs invalid serialized data &lt;/p&gt;



&lt;p&gt;TestSchema$ php testsimple.php &lt;/p&gt;

&lt;p&gt;Serialized  .&lt;br/&gt;
             mari&lt;br/&gt;
Fatal error: Uncaught exception &apos;TTransportException&apos; with message &apos;TMemoryBuffer: Could not read 512 bytes from buffer.&apos; in /Users/mponnambalam/work/eclipse/workspace/thrift0.6.1/lib/php/src/transport/TMemoryBuffer.php on line 58&lt;/p&gt;

&lt;p&gt;TTransportException: TMemoryBuffer: Could not read 512 bytes from buffer. in /Users/mponnambalam/work/eclipse/workspace/thrift0.6.1/lib/php/src/transport/TMemoryBuffer.php on line 58&lt;/p&gt;

&lt;p&gt;Call Stack:&lt;br/&gt;
    0.0003     636976   1. &lt;/p&gt;
{main}() /Users/mponnambalam/work/eclipse/workspace/TestSchema/testsimple.php:0&lt;br/&gt;
    0.0043    1509728   2. TBinarySerializer::deserialize() /Users/mponnambalam/work/eclipse/workspace/TestSchema/testsimple.php:47&lt;br/&gt;
    0.0043    1511808   3. thrift_protocol_read_binary() /Users/mponnambalam/work/eclipse/workspace/thrift0.6.1/lib/php/src/protocol/TBinarySerializer.php:62&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
thrift_protoco_read_binary disabled  ( I commented extension in thrift_protocol.ini) &lt;br/&gt;
 &lt;br/&gt;
TestSchema$ php testsimple.php &lt;br/&gt;
&lt;br/&gt;
Serialized  .&lt;br/&gt;
Fatal error: Uncaught exception &apos;TTransportException&apos; with message &apos;TMemoryBuffer: Could not read 1 bytes from buffer.&apos; in /Users/mponnambalam/work/eclipse/workspace/thrift0.6.1/lib/php/src/transport/TMemoryBuffer.php on line 58&lt;br/&gt;
&lt;br/&gt;
TTransportException: TMemoryBuffer: Could not read 1 bytes from buffer. in /Users/mponnambalam/work/eclipse/workspace/thrift0.6.1/lib/php/src/transport/TMemoryBuffer.php on line 58&lt;br/&gt;
&lt;br/&gt;
Call Stack:&lt;br/&gt;
    0.0003     636976   1. {main}
&lt;p&gt;() /Users/mponnambalam/work/eclipse/workspace/TestSchema/testsimple.php:0&lt;br/&gt;
    0.0041    1509944   2. TBinarySerializer::deserialize() /Users/mponnambalam/work/eclipse/workspace/TestSchema/testsimple.php:47&lt;br/&gt;
    0.0041    1512248   3. Person-&amp;gt;read() /Users/mponnambalam/work/eclipse/workspace/thrift0.6.1/lib/php/src/protocol/TBinarySerializer.php:66&lt;br/&gt;
    0.0041    1512472   4. TBinaryProtocol-&amp;gt;readFieldBegin() /Users/mponnambalam/work/eclipse/workspace/TestSchema/gen-php/simple/simple_types.php:45&lt;br/&gt;
    0.0041    1512472   5. TBinaryProtocol-&amp;gt;readByte() /Users/mponnambalam/work/eclipse/workspace/thrift0.6.1/lib/php/src/protocol/TBinaryProtocol.php:231&lt;br/&gt;
    0.0041    1512520   6. TBufferedTransport-&amp;gt;readAll() /Users/mponnambalam/work/eclipse/workspace/thrift0.6.1/lib/php/src/protocol/TBinaryProtocol.php:283&lt;br/&gt;
    0.0041    1512568   7. TTransport-&amp;gt;readAll() /Users/mponnambalam/work/eclipse/workspace/thrift0.6.1/lib/php/src/transport/TBufferedTransport.php:109&lt;br/&gt;
    0.0041    1512744   8. TMemoryBuffer-&amp;gt;read() /Users/mponnambalam/work/eclipse/workspace/thrift0.6.1/lib/php/src/transport/TTransport.php:87&lt;/p&gt;</description>
                <environment>&lt;p&gt;Cent OS and Mac OS 10.5&lt;/p&gt;</environment>
        <key id="12514746">THRIFT-1240</key>
            <summary>TBinarySerializer.php invalid serialization due to TBufferTransport not flushing last chunk of data into TMemoryBuffer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marimuthupg">Marimuthu Ponnambalam</assignee>
                                    <reporter username="marimuthupg">Marimuthu Ponnambalam</reporter>
                        <labels>
                            <label>TBinarySerializer</label>
                            <label>invalid</label>
                            <label>serialization</label>
                    </labels>
                <created>Wed, 20 Jul 2011 05:43:44 +0000</created>
                <updated>Fri, 26 Aug 2011 03:17:06 +0000</updated>
                            <resolved>Fri, 26 Aug 2011 02:53:00 +0000</resolved>
                                    <version>0.6.1</version>
                                    <fixVersion>0.8</fixVersion>
                                    <component>PHP - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13068159" author="marimuthupg" created="Wed, 20 Jul 2011 05:49:23 +0000"  >&lt;p&gt;Thrift IDL for simple test&lt;/p&gt;</comment>
                            <comment id="13068160" author="marimuthupg" created="Wed, 20 Jul 2011 05:50:41 +0000"  >&lt;p&gt;Test file to for simple IDL&lt;/p&gt;</comment>
                            <comment id="13068161" author="marimuthupg" created="Wed, 20 Jul 2011 05:52:33 +0000"  >&lt;p&gt;Patch: Fixed for invalid serialization&lt;/p&gt;</comment>
                            <comment id="13091535" author="jfarrell" created="Fri, 26 Aug 2011 02:53:00 +0000"  >&lt;p&gt;Thanks for the test case, committed.&lt;/p&gt;</comment>
                            <comment id="13091542" author="hudson" created="Fri, 26 Aug 2011 03:17:06 +0000"  >&lt;p&gt;Integrated in Thrift #238 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/238/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/238/&lt;/a&gt;)&lt;br/&gt;
    Thrift-1240: TBinarySerializer.php invalid serialization due to TBufferTransport not flushing last chunk of data into TMemoryBuffer&lt;br/&gt;
Client: php&lt;br/&gt;
Patch: Marimuthu Ponnambalam&lt;/p&gt;

&lt;p&gt;Simple Serialization errors out, due to the TBufferTransport not flushing the data into TMemoryBuffer after $object-&amp;gt;write($protocol) in TBinarySerializer.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12487108" name="TBinarySerializer.php" size="2707" author="marimuthupg" created="Wed, 20 Jul 2011 05:52:33 +0000"/>
                            <attachment id="12487106" name="simple.thrift" size="73" author="marimuthupg" created="Wed, 20 Jul 2011 05:49:23 +0000"/>
                            <attachment id="12487107" name="testsimple.php" size="655" author="marimuthupg" created="Wed, 20 Jul 2011 05:50:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63672</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16civ:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245161</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>