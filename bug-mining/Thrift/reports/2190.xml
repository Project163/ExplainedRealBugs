<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:34:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-5482] Memory leak during SSL handshake</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-5482</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;We observed continuous memory increase in the thrift server during SSL handshake and this memory increase was crashing the windows hosts as there was no memory left for other applications to work. During further investigation, we found that ERR_remove_state has been made stub in the later versions of OpenSSL, and recommended function to clear the thread state is OPENSSL_thread_stop. Once I made this change we did not observe any memory leak further. We are using OpenSSL 1.1.1k with thrift 0.12.0. Hence I am putting the patch for the same. Thanks!&lt;/p&gt;

&lt;p&gt;I am adding call stack sample leak trace&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

Call stack sample 2
Address &#160; 0x0000000e`00bdd770
Allocation Time &#160;00:00:45 since tracking started
Allocation Size 64 Bytes


Function
LeakTrack+1f109
!_malloc_base+44
!CRYPTO_zalloc+59
!BN_CTX_new+20
!rsa_ossl_public_decrypt+d8
!pkey_rsa_verify+245
!EVP_DigestVerify+15f
!tls_process_cert_verify+42a
!read_state_machine+24f
!state_machine+2d2
!SSL_do_handshake+bc
!apache::thrift::transport::TSSLSocket::initializeHandshake+dc
!apache::thrift::transport::TSSLSocket::read+3c
!apache::thrift::transport::TBufferedTransport::readSlow+56
!apache::thrift::transport::TBufferBase::readAll+88
!apache::thrift::protocol::TVirtualProtocol&amp;lt;apache::thrift::protocol::TBinaryProtocolT&amp;lt;apache::thrift::transport::TTransport,apache::thrift::protocol::TNetworkBigEndian&amp;gt;,apache::thrift::protocol::TProtocolDefaults&amp;gt;::readMessageBegin_virt+4c
!apache::thrift::TMultiplexedProcessor::process+87
!apache::thrift::server::TConnectedClient::run+16a
!apache::thrift::server::TThreadedServer::TConnectedClientRunner::run+17
!apache::thrift::concurrency::StdThread::threadMain+6c
!std::thread::_Invoke&amp;lt;std::tuple&amp;lt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; (__cdecl*)(std::shared_ptr&amp;lt;Reducted&amp;gt;),std::shared_ptr&amp;lt;Reducted&amp;gt; &amp;gt;,0,1&amp;gt;+3e
!thread_start&amp;lt;unsigned &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; (__cdecl*)(void * __ptr64)&amp;gt;+50
kernel32!BaseThreadInitThunk+22
ntdll!RtlUserThreadStart+34

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Build env: Windows 2019&lt;/p&gt;

&lt;p&gt;Issue observed: Windows 2012R2&lt;/p&gt;

&lt;p&gt;OpenSSL: 1.1.1k&lt;/p&gt;</environment>
        <key id="13414703">THRIFT-5482</key>
            <summary>Memory leak during SSL handshake</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anshulmgupta">Anshul Mohan Gupta</assignee>
                                    <reporter username="anshulmgupta">Anshul Mohan Gupta</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Dec 2021 08:37:13 +0000</created>
                <updated>Tue, 30 Aug 2022 21:31:57 +0000</updated>
                            <resolved>Wed, 18 May 2022 01:33:27 +0000</resolved>
                                    <version>0.12.0</version>
                                    <fixVersion>0.16.0</fixVersion>
                                    <component>C++ - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="17451643" author="emmenlau" created="Wed, 1 Dec 2021 09:14:51 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshulmgupta&quot; class=&quot;user-hover&quot; rel=&quot;anshulmgupta&quot;&gt;anshulmgupta&lt;/a&gt; , this looks good. Your patch applies to current master, even though you developed against 0.12.0, correct?&lt;/p&gt;</comment>
                            <comment id="17451651" author="JIRAUSER281036" created="Wed, 1 Dec 2021 09:25:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emmenlau&quot; class=&quot;user-hover&quot; rel=&quot;emmenlau&quot;&gt;emmenlau&lt;/a&gt;&#160; Thanks for looking into the PR. Internally we are using thrift 0.12.0 so I patched 0.12.0 and verified it but this should also apply to master as well. Thanks!&lt;/p&gt;</comment>
                            <comment id="17538439" author="slachiewicz" created="Tue, 17 May 2022 20:01:33 +0000"  >&lt;p&gt;Already merged to master and part of v0.16 release&#160; &lt;a href=&quot;https://github.com/apache/thrift/commit/98be76fc033f1d66bcfd09d4a22b86e8061e89c2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/commit/98be76fc033f1d66bcfd09d4a22b86e8061e89c2&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0x8j4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>