<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:56:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-214] PosixThreadFactory.cpp fails 64 bit compile with gcc on Mac OS X 10.5</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-214</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;We are building quad libraries for the Mac. (32/64 bit PPC/Intel)&lt;/p&gt;

&lt;p&gt;Project was configure this way:&lt;br/&gt;
CFLAGS: -g  -O0  -isysroot /Developer/SDKs/MacOSX10.5.sdk -mmacosx-version-min=10.4 -arch i386 -arch x86_64 -arch ppc -arch ppc64  -fvisibility=hidden -DYYLMAX=1048576&lt;br/&gt;
CPPFLAGS: &lt;br/&gt;
CXXFLAGS: -g  -O0  -isysroot /Developer/SDKs/MacOSX10.5.sdk -mmacosx-version-min=10.4 -arch i386 -arch x86_64 -arch ppc -arch ppc64  -fvisibility=hidden -DYYLMAX=1048576 -fvisibility-inlines-hidden&lt;br/&gt;
LDFLAGS:  -syslibroot,/Developer/SDKs/MacOSX10.5.sdk -mmacosx-version-min=10.4 -arch i386 -arch x86_64 -arch ppc -arch ppc64  -Wl,-dead_strip -no_dead_strip_inits_and_terms -Wl,-search_paths_first &lt;/p&gt;

&lt;p&gt;CONFIGURE_OPTIONS: --without-java --without-py --without-ruby --with-boost=/Users/rmanbert/development/trunkHead/client/thirdPartyLibs/sources/thrift/SUBSYS_TOP/thirdPartyLibs/installedMac/individual/boost --with-zlib=/Users/rmanbert/development/trunkHead/client/thirdPartyLibs/sources/thrift/SUBSYS_TOP/thirdPartyLibs/installedMac/individual/zlib/Debug --with-libevent=/Users/rmanbert/development/trunkHead/client/thirdPartyLibs/sources/thrift/SUBSYS_TOP/thirdPartyLibs/installedMac/individual/libevent/Debug --disable-dependency-tracking --enable-static --disable-shared --enable-debug --prefix=/Users/rmanbert/development/trunkHead/client/thirdPartyLibs/sources/thrift/SUBSYS_TOP/thirdPartyLibs/installedMac/individual/thrift/Debug&lt;/p&gt;


&lt;p&gt;The compile command line and error output is:&lt;br/&gt;
 g++ -DHAVE_CONFIG_H -I. -I../.. -I/Users/rmanbert/development/trunkHead/client/thirdPartyLibs/sources/thrift/lib/cpp -I/Users/rmanbert/development/trunkHead/client/thirdPartyLibs/sources/thrift/SUBSYS_TOP/thirdPartyLibs/installedMac/individual/boost/include -I/Users/rmanbert/development/trunkHead/client/thirdPartyLibs/sources/thrift/lib/cpp/src -Wall -g -O0 -isysroot /Developer/SDKs/MacOSX10.5.sdk -mmacosx-version-min=10.4 -arch i386 -arch x86_64 -arch ppc -arch ppc64 -fvisibility=hidden -DYYLMAX=1048576 -fvisibility-inlines-hidden -c /Users/rmanbert/development/trunkHead/client/thirdPartyLibs/sources/thrift/lib/cpp/src/concurrency/PosixThreadFactory.cpp -o PosixThreadFactory.o&lt;br/&gt;
/Users/rmanbert/development/trunkHead/client/thirdPartyLibs/sources/thrift/lib/cpp/src/concurrency/PosixThreadFactory.cpp: In member function &apos;uint64_t facebook::thrift::concurrency::PosixThreadFactory::Impl::getCurrentThreadId() const&apos;:&lt;br/&gt;
/Users/rmanbert/development/trunkHead/client/thirdPartyLibs/sources/thrift/lib/cpp/src/concurrency/PosixThreadFactory.cpp:273: error: cast from &apos;_opaque_pthread_t*&apos; to &apos;id_t&apos; loses precision&lt;br/&gt;
/Users/rmanbert/development/trunkHead/client/thirdPartyLibs/sources/thrift/lib/cpp/src/concurrency/PosixThreadFactory.cpp: In member function &apos;uint64_t facebook::thrift::concurrency::PosixThreadFactory::Impl::getCurrentThreadId() const&apos;:&lt;br/&gt;
/Users/rmanbert/development/trunkHead/client/thirdPartyLibs/sources/thrift/lib/cpp/src/concurrency/PosixThreadFactory.cpp:273: error: cast from &apos;_opaque_pthread_t*&apos; to &apos;id_t&apos; loses precision&lt;/p&gt;</description>
                <environment>&lt;p&gt;Mac Os X 10.5 compiling for 64 bit&lt;/p&gt;</environment>
        <key id="12409156">THRIFT-214</key>
            <summary>PosixThreadFactory.cpp fails 64 bit compile with gcc on Mac OS X 10.5</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rushmanbert">Rush Manbert</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 Nov 2008 23:07:53 +0000</created>
                <updated>Tue, 1 Nov 2011 02:52:29 +0000</updated>
                            <resolved>Tue, 2 Dec 2008 02:34:26 +0000</resolved>
                                                                    <component>C++ - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12650376" author="rushmanbert" created="Mon, 24 Nov 2008 23:09:50 +0000"  >&lt;p&gt;Here&apos;s the patch.&lt;/p&gt;</comment>
                            <comment id="12650384" author="dreiss" created="Mon, 24 Nov 2008 23:36:40 +0000"  >&lt;p&gt;What g++ version are you using?  I&apos;m confused as to why this doesn&apos;t happen on FreeBSD, which also uses a pointer type for pthread_t.&lt;/p&gt;

&lt;p&gt;Unfortunately, we cannot use a reinterpret cast here because Linux uses an integer type for pthread_t and reinterpret_cast cannot be used for casting between integer types, even if they are the exact same type, as they are in this case.  I thought that a C-style cast would work in all cases based on &amp;lt;&lt;a href=&quot;http://www.open-std.org/jtc1/sc22/open/n2356/expr.html#expr.cast&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.open-std.org/jtc1/sc22/open/n2356/expr.html#expr.cast&lt;/a&gt;&amp;gt;, but I guess not.  I don&apos;t really understand how the cast in this case can be &quot;interpreted&quot; as a static_cast or const_cast, but I guess that what is going on, otherwise the compiler should try to treat it as a reinterpret_cast.  Do you know what type _opaque_pthread_t is?&lt;/p&gt;

&lt;p&gt;I had a plan to create a templated function that would reinterpret_cast pointers but static_cast integers.  I guess I&apos;ll have to do it after all.&lt;/p&gt;</comment>
                            <comment id="12650424" author="rushmanbert" created="Tue, 25 Nov 2008 00:51:56 +0000"  >&lt;p&gt;My compiler version:&lt;br/&gt;
i686-apple-darwin9-g++-4.0.1 (GCC) 4.0.1 (Apple Inc. build 5484)&lt;/p&gt;

&lt;p&gt;I traced down the return types and typedefs and pthread_t is just a 64 bit pointer to a structure.&lt;/p&gt;

&lt;p&gt;So this didn&apos;t make sense, but I made a test project and defined this:&lt;br/&gt;
typedef uint64_t id_t;&lt;/p&gt;

&lt;p&gt;and when I built, I got this error:&lt;br/&gt;
/Developer/SDKs/MacOSX10.5.sdk/usr/include/sys/wait.h:95: error: &apos;id_t&apos; has a previous declaration as &apos;typedef __darwin_id_t id_t&apos;&lt;br/&gt;
which resolves to a uint32_t.&lt;/p&gt;

&lt;p&gt;I think this is what&apos;s causing the error, and if I change line 273 of PosixThreadFactory.cpp to this:&lt;br/&gt;
    return (Thread::id_t)pthread_self();&lt;/p&gt;

&lt;p&gt;it works. So it seems that the real change is to make sure the correct type gets used.&lt;/p&gt;

&lt;p&gt;Sorry for the earlier info. Someone else actually ran into this and fixed it as the original patch shows. They asked me to submit it because I&apos;m the &quot;thrift liaison&quot; guy here.&lt;/p&gt;

&lt;p&gt;If this looks correct to you, do you want a patch?&lt;/p&gt;</comment>
                            <comment id="12650429" author="dreiss" created="Tue, 25 Nov 2008 01:01:29 +0000"  >&lt;p&gt;I would have hoped that it would have used the class-local type first, but oh well.  Yeah, please upload a new patch (preferably as a unified diff with the path and file name to make it easier to apply).&lt;/p&gt;</comment>
                            <comment id="12650433" author="rushmanbert" created="Tue, 25 Nov 2008 01:17:33 +0000"  >&lt;p&gt;That is fairly annoying, isn&apos;t it?&lt;/p&gt;

&lt;p&gt;I made the patch and will attach. Somehow in a long career I have managed to only do this once or twice. I hope the format is what you&apos;re looking for. (diff --unified)&lt;/p&gt;</comment>
                            <comment id="12650434" author="dreiss" created="Tue, 25 Nov 2008 01:22:36 +0000"  >&lt;p&gt;Yep.  This is what I was looking for.  If this version works for you, I can commit it.&lt;/p&gt;</comment>
                            <comment id="12650441" author="rushmanbert" created="Tue, 25 Nov 2008 01:56:03 +0000"  >&lt;p&gt;Everything looks good. The library builds. All our apps that use it run and all the regression tests pass.&lt;/p&gt;</comment>
                            <comment id="12749371" author="lenn0x" created="Mon, 31 Aug 2009 04:16:35 +0000"  >&lt;p&gt;Can we get this committed? I just installed a fresh copy of Snow Leopard, and it seems by default its compiling in 64-bit. I applied the patch and it builds fine.&lt;/p&gt;</comment>
                            <comment id="12749384" author="dreiss" created="Mon, 31 Aug 2009 05:19:03 +0000"  >&lt;p&gt;This was committed.  If you hit the &quot;all&quot; tab in JIRA, it will show you the svn commit.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12394622" name="patch.txt" size="493" author="rushmanbert" created="Tue, 25 Nov 2008 01:17:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38522</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 13 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16aqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>244871</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>