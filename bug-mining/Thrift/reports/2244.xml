<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:34:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-5674] Server implementation exceptions are not sent to client in ES6 promise-style invocation</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-5674</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;When a server implementation throws a user-defined exception, the server crashes and the exception is not sent to the client. &#160;I believe this issue only happens in the Promise-style invocation of code generated for ES6. &#160;Specifically, I think it arises from this line:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/thrift/blob/0.17.0/compiler/cpp/src/thrift/generate/t_js_generator.cc#L1484&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/blob/0.17.0/compiler/cpp/src/thrift/generate/t_js_generator.cc#L1484&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Generated code looks like the following (generated from the Calculator.calculate example):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Promise.resolve(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;._handler.calculate.bind(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;._handler)(
&#160; args.logid,
  args.w
)).then(
  ...
).&lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;(err =&amp;gt; {
&#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (err &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; ttypes.InvalidOperation) {
    ...
  }
);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The implementation-generated exception is handled by the promise chain. &#160;The problem is that the implementation (handler) method is called &lt;em&gt;before&lt;/em&gt; Promise.resolve, so any exception it throws is not handled by the promise chain. &#160;So, when running&lt;sup&gt;1&lt;/sup&gt; NodeServerPromise.js and NodeClientPromise.js from the tutorial, the server crashes when InvalidOperation is thrown and the client does not receive InvalidOperation (or anything further).&lt;/p&gt;

&lt;p&gt;I think the minimal fix would be to generate something like the following instead:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Promise((resolve) =&amp;gt; resolve(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;._handler.calculate.bind(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;._handler)(
  args.logid,
  args.w
))).then(
  ...
).&lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;(err =&amp;gt; {
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (err &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; ttypes.InvalidOperation) {
    ...
  }
);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When making this change on the generated tutorial code and re-running&lt;sup&gt;1&lt;/sup&gt; the server and client, the server stays up and both the server and client log five lines, as expected.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&#160;There also seems to be a couple of errors in NodeClientPromise.js in the tutorial code. &#160;I had to change &quot;fail&quot; to &quot;catch&quot; and &quot;fin&quot; to &quot;finally&quot; to get it to work.&lt;/em&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Discovered on Node.js v16.13.2, Thrift 0.17.0 compiler, 0.16.0 library.&lt;/p&gt;

&lt;p&gt;Reproduced on Node.js v10.19.0, Thrift 0.17.0 compiler, 0.17.0 library (just what I happened to have available for trying out the tutorial code).&lt;/p&gt;</environment>
        <key id="13514635">THRIFT-5674</key>
            <summary>Server implementation exceptions are not sent to client in ES6 promise-style invocation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cjmay">Chandler May</assignee>
                                    <reporter username="cjmay">Chandler May</reporter>
                        <labels>
                    </labels>
                <created>Sun, 18 Dec 2022 18:57:57 +0000</created>
                <updated>Sat, 2 Sep 2023 11:53:36 +0000</updated>
                            <resolved>Wed, 1 Mar 2023 23:12:54 +0000</resolved>
                                    <version>0.17.0</version>
                                    <fixVersion>0.19.0</fixVersion>
                                    <component>JavaScript - Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <workratio workratioPercent="11"/>
                                    <progress percentage="11">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="11" backgroundColor="#51a825"/>
                                                    <row percentage="89" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="11">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="11" backgroundColor="#51a825"/>
                                                    <row percentage="89" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="10800">3h</timeoriginalestimate>
                            <timeestimate seconds="9600">2h 40m</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17695338" author="cjmay" created="Wed, 1 Mar 2023 21:52:58 +0000"  >&lt;p&gt;Can I please get feedback on this?&lt;/p&gt;

&lt;p&gt;I just rebased my PR, I believe it is still ready to be merged. &#160;There are CI errors but I believe they are unrelated; there are also CI errors in the parent commit.&lt;/p&gt;</comment>
                            <comment id="17695359" author="jensg" created="Wed, 1 Mar 2023 23:12:10 +0000"  >&lt;p&gt;&amp;gt;&#160; &lt;em&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&#160;There also seems to be a couple of errors in NodeClientPromise.js in the tutorial code. &#160;I had to change &quot;fail&quot; to &quot;catch&quot; and &quot;fin&quot; to &quot;finally&quot; to get it to work.&lt;/em&gt;&lt;br/&gt;
That most likely probably relates to &lt;a href=&quot;https://www.npmjs.com/package/q&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.npmjs.com/package/q &lt;/a&gt; - since their recommendation on that page is to switch to catch/finally, that change seems fine to me.&lt;/p&gt;</comment>
                            <comment id="17695822" author="cjmay" created="Thu, 2 Mar 2023 16:56:29 +0000"  >&lt;p&gt;Thank you so much!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 36 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1e7w8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>