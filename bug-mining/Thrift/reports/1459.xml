<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:22:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-2883] TTwisted.py, during ConnectionLost processing: exceptions.RuntimeError: dictionary changed size during iteration</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-2883</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;If any of the errbacks called by the connectionLost routine attempt to make new requests over thrift (retries), the requests dictionary will change size and Python with throw the RuntimeError exception and the clients will not be properly notified of the connectionLost state change.&lt;br/&gt;
2014-12-06 02:22:16,808 ERROR    twisted      Unhandled Error&lt;br/&gt;
Traceback (most recent call last):&lt;br/&gt;
  File &quot;/usr/lib/pymodules/python2.7/companyutils/service/_&lt;em&gt;init&lt;/em&gt;_.py&quot;, line 292, in main&lt;br/&gt;
    self.reactor.run()&lt;br/&gt;
  File &quot;/usr/lib/python2.7/dist-packages/twisted/internet/base.py&quot;, line 1169, in run&lt;br/&gt;
    self.mainLoop()&lt;br/&gt;
  File &quot;/usr/lib/python2.7/dist-packages/twisted/internet/base.py&quot;, line 1181, in mainLoop&lt;br/&gt;
    self.doIteration(t)&lt;br/&gt;
  File &quot;/usr/lib/python2.7/dist-packages/twisted/internet/epollreactor.py&quot;, line 379, in doPoll&lt;br/&gt;
    log.callWithLogger(selectable, _drdw, selectable, fd, event)&lt;br/&gt;
&amp;#8212; &amp;lt;exception caught here&amp;gt; &amp;#8212;&lt;br/&gt;
  File &quot;/usr/lib/python2.7/dist-packages/twisted/python/log.py&quot;, line 84, in callWithLogger&lt;br/&gt;
    return callWithContext(&lt;/p&gt;
{&quot;system&quot;: lp}
&lt;p&gt;, func, *args, **kw)&lt;br/&gt;
  File &quot;/usr/lib/python2.7/dist-packages/twisted/python/log.py&quot;, line 69, in callWithContext&lt;br/&gt;
    return context.call(&lt;/p&gt;
{ILogContext: newCtx}
&lt;p&gt;, func, *args, **kw)&lt;br/&gt;
  File &quot;/usr/lib/python2.7/dist-packages/twisted/python/context.py&quot;, line 118, in callWithContext&lt;br/&gt;
    return self.currentContext().callWithContext(ctx, func, *args, **kw)&lt;br/&gt;
  File &quot;/usr/lib/python2.7/dist-packages/twisted/python/context.py&quot;, line 81, in callWithContext&lt;br/&gt;
    return func(&lt;b&gt;args,&lt;/b&gt;*kw)&lt;br/&gt;
  File &quot;/usr/lib/python2.7/dist-packages/twisted/internet/posixbase.py&quot;, line 627, in _doReadOrWrite&lt;br/&gt;
    self._disconnectSelectable(selectable, why, inRead)&lt;br/&gt;
  File &quot;/usr/lib/python2.7/dist-packages/twisted/internet/posixbase.py&quot;, line 258, in _disconnectSelectable&lt;br/&gt;
    selectable.readConnectionLost(f)&lt;br/&gt;
  File &quot;/usr/lib/python2.7/dist-packages/twisted/internet/tcp.py&quot;, line 267, in readConnectionLost&lt;br/&gt;
    self.connectionLost(reason)&lt;br/&gt;
  File &quot;/usr/lib/python2.7/dist-packages/twisted/internet/tcp.py&quot;, line 473, in connectionLost&lt;br/&gt;
    self._commonConnection.connectionLost(self, reason)&lt;br/&gt;
  File &quot;/usr/lib/python2.7/dist-packages/twisted/internet/tcp.py&quot;, line 287, in connectionLost&lt;br/&gt;
    protocol.connectionLost(reason)&lt;br/&gt;
  File &quot;/usr/lib/pymodules/python2.7/telephus/protocol.py&quot;, line 63, in connectionLost&lt;br/&gt;
    self._parent_protocol.connectionLost(self, reason)&lt;br/&gt;
  File &quot;/usr/lib/pymodules/python2.7/thrift/transport/TTwisted.py&quot;, line 84, in connectionLost&lt;br/&gt;
    for k, v in self.client._reqs.iteritems():&lt;br/&gt;
exceptions.RuntimeError: dictionary changed size during iteration&lt;/p&gt;</description>
                <environment></environment>
        <key id="12760610">THRIFT-2883</key>
            <summary>TTwisted.py, during ConnectionLost processing: exceptions.RuntimeError: dictionary changed size during iteration</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rthille">Robert P. Thille</reporter>
                        <labels>
                            <label>easyfix</label>
                            <label>patch</label>
                    </labels>
                <created>Wed, 10 Dec 2014 00:43:00 +0000</created>
                <updated>Wed, 6 Jan 2016 02:06:21 +0000</updated>
                            <resolved>Wed, 23 Dec 2015 17:44:33 +0000</resolved>
                                    <version>0.9.2</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>Python - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="300">5m</timeoriginalestimate>
                            <timeestimate seconds="300">5m</timeestimate>
                                        <comments>
                            <comment id="14240422" author="rthille" created="Wed, 10 Dec 2014 00:48:48 +0000"  >&lt;p&gt;Code change shamelessly stolen from:&lt;br/&gt;
&lt;a href=&quot;https://github.com/Metaswitch/crest/issues/105&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Metaswitch/crest/issues/105&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14241667" author="githubbot" created="Wed, 10 Dec 2014 20:23:51 +0000"  >&lt;p&gt;GitHub user rthille opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/314&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/314&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2883&quot; title=&quot;TTwisted.py, during ConnectionLost processing: exceptions.RuntimeError: dictionary changed size during iteration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2883&quot;&gt;&lt;del&gt;THRIFT-2883&lt;/del&gt;&lt;/a&gt; Fix dict changed size during iteration exception&lt;/p&gt;

&lt;p&gt;    During the notification of outstanding requests via errback that the&lt;br/&gt;
      connection has failed, new requests can be attempted which change&lt;br/&gt;
      the size of the client._reqs dict.  This change uses a temp variable&lt;br/&gt;
      to hold the old dict, and resets client._reqs to a new, empty dict.&lt;br/&gt;
      Also, it iterates until the new dict does not have any requests added&lt;br/&gt;
      by the errbacks.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/rthille/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rthille/thrift&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2883&quot; title=&quot;TTwisted.py, during ConnectionLost processing: exceptions.RuntimeError: dictionary changed size during iteration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2883&quot;&gt;&lt;del&gt;THRIFT-2883&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/314.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/314.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #314&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 55a86f53c05d243258f01037778fad20d53d070b&lt;br/&gt;
Author: Robert Thille &amp;lt;robert.thille@cyaninc.com&amp;gt;&lt;br/&gt;
Date:   2014-12-10T20:16:01Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2883&quot; title=&quot;TTwisted.py, during ConnectionLost processing: exceptions.RuntimeError: dictionary changed size during iteration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2883&quot;&gt;&lt;del&gt;THRIFT-2883&lt;/del&gt;&lt;/a&gt; Fix dict changed size during iteration exception&lt;br/&gt;
    During the notification of outstanding requests via errback that the&lt;br/&gt;
      connection has failed, new requests can be attempted which change&lt;br/&gt;
      the size of the client._reqs dict.  This change uses a temp variable&lt;br/&gt;
      to hold the old dict, and resets client._reqs to a new, empty dict.&lt;br/&gt;
      Also, it iterates until the new dict does not have any requests added&lt;br/&gt;
      by the errbacks.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15069897" author="githubbot" created="Wed, 23 Dec 2015 17:19:50 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/314&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/314&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12686161" name="THRIFT-2883.patch" size="1442" author="rthille" created="Wed, 10 Dec 2014 00:48:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 47 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i23973:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>