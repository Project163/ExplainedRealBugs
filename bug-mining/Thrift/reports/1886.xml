<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:28:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-4253] Go generator assigns strings to field in const instead of pointers.</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-4253</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;Given the follow thrift definition:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;struct custom {
  1: required string field_a;
  2: optional string field_b;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;with the following constant map defined in the same file:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; map&amp;lt;i32, custom&amp;gt; custom_map = {
  ...,
  42 : { &lt;span class=&quot;code-quote&quot;&gt;&apos;field_a&apos;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&apos;www.testa.com&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;field_b&apos;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&apos;www.testb.com&apos;&lt;/span&gt;},
  ...,
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thrift generates the following go struct in the main &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;x.go&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; file:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;type Custom struct {
  FieldA string `thrift:&lt;span class=&quot;code-quote&quot;&gt;&quot;field_a,required&quot;&lt;/span&gt; db:&lt;span class=&quot;code-quote&quot;&gt;&quot;field_a&quot;&lt;/span&gt; json:&lt;span class=&quot;code-quote&quot;&gt;&quot;field_a&quot;&lt;/span&gt;`
  FieldB *string `thrift:&lt;span class=&quot;code-quote&quot;&gt;&quot;field_b,2&quot;&lt;/span&gt; db:&lt;span class=&quot;code-quote&quot;&gt;&quot;field_b&quot;&lt;/span&gt; json:&lt;span class=&quot;code-quote&quot;&gt;&quot;field_b,omitempty&quot;&lt;/span&gt;`
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;with the corresponding assignments in the &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; X-consts.go &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; file:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CUSTOM_MAP = map[&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;]*Custom {
  ...,
  42: &amp;amp;Custom {FieldA: &lt;span class=&quot;code-quote&quot;&gt;&quot;www.testa.com&quot;&lt;/span&gt;, FieldB: &lt;span class=&quot;code-quote&quot;&gt;&quot;www.testb.com&quot;&lt;/span&gt;},
  ...,
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I assume field_b&apos;s pointer type is to allow for null values as per the optional. The generator should be assigning pointers instead of strings. &lt;/p&gt;

&lt;p&gt;I&apos;m not sure how much effort it would take to fix this. I am encountering this problem at work right and would be very happy to starting working on this with some guidance from experts around here. &lt;/p&gt;</description>
                <environment>&lt;p&gt;Generated using docker-thrift.&lt;/p&gt;</environment>
        <key id="13087732">THRIFT-4253</key>
            <summary>Go generator assigns strings to field in const instead of pointers.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jking3">James E. King III</assignee>
                                    <reporter username="DavinC">Davin Chia</reporter>
                        <labels>
                    </labels>
                <created>Mon, 17 Jul 2017 20:51:44 +0000</created>
                <updated>Thu, 27 Dec 2018 15:25:09 +0000</updated>
                            <resolved>Mon, 9 Apr 2018 12:05:12 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.12.0</fixVersion>
                                    <component>Go - Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16090591" author="jensg" created="Mon, 17 Jul 2017 21:24:11 +0000"  >&lt;p&gt;Confirmed, trying this ends up in a &quot;&lt;tt&gt;cannot use &quot;test&quot; (type string) as type *string in field value&lt;/tt&gt;&quot;. &lt;/p&gt;

&lt;p&gt;That seems absolutely wrong, and besides fixing it we also should integrate an test into &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=thrift.git;a=blob;f=test/ConstantsDemo.thrift;hb=HEAD&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ConstantsDemo.thrift&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=DavinC&quot; class=&quot;user-hover&quot; rel=&quot;DavinC&quot;&gt;DavinC&lt;/a&gt;, what specific questions that I can answer do you have?&lt;/p&gt;</comment>
                            <comment id="16090895" author="davinc" created="Tue, 18 Jul 2017 00:47:55 +0000"  >&lt;p&gt;Thanks for the quick reply &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jensg&quot; class=&quot;user-hover&quot; rel=&quot;jensg&quot;&gt;jensg&lt;/a&gt;. This is the first time I am contributing to a large C++ open source project, or writing much C++ to be honest, and it will be good to get some guidance on development workflow. I&apos;m assuming I clone &lt;a href=&quot;https://github.com/apache/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift&lt;/a&gt;, make a branch and start working. Happy to jump on some other communication medium if that is better for you.&lt;/p&gt;

&lt;p&gt;If you can spare a few minutes, it will also be nice to have a point in the code I can start from. Thanks.&lt;/p&gt;</comment>
                            <comment id="16091234" author="jensg" created="Tue, 18 Jul 2017 07:44:24 +0000"  >&lt;p&gt;The Go generator is &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=thrift.git;a=blob;f=compiler/cpp/src/thrift/generate/t_go_generator.cc;hb=HEAD&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this&lt;/a&gt;. &lt;br/&gt;
I&apos;d probably start looking into &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=thrift.git;a=blob;f=compiler/cpp/src/thrift/generate/t_go_generator.cc;hb=HEAD#l114&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;generate_const&lt;/tt&gt; or &lt;tt&gt;render_const_value&lt;/tt&gt;&lt;/a&gt;.&lt;/p&gt;
</comment>
                            <comment id="16095309" author="githubbot" created="Thu, 20 Jul 2017 20:25:56 +0000"  >&lt;p&gt;GitHub user davinchia opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1311&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1311&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Fix for constant assignments to optional fields in Go.&lt;/p&gt;

&lt;p&gt;    As per ticket &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4253&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/THRIFT-4253&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;    As I dug through the code I realised the problem was not only limited to optional strings, and that the generator was not generating optionals for all types.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/davinchia/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/davinchia/thrift&lt;/a&gt; constant-fix&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1311.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1311.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1311&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit de3d3a76bdaf2baa3eab9c6fdd8d3b31e7887f55&lt;br/&gt;
Author: Davin Chia Ming Juay &amp;lt;dchia@liveramp.com&amp;gt;&lt;br/&gt;
Date:   2017-07-20T08:08:48Z&lt;/p&gt;

&lt;p&gt;    logging to track path; modified function to pass optional value over&lt;/p&gt;

&lt;p&gt;commit f038cc0d6504ecbf30bd13a1daa0f8fc8201fad4&lt;br/&gt;
Author: Davin Chia Ming Juay &amp;lt;dchia@liveramp.com&amp;gt;&lt;br/&gt;
Date:   2017-07-20T08:53:24Z&lt;/p&gt;

&lt;p&gt;    fix generation for bool and int constant values&lt;/p&gt;

&lt;p&gt;commit 7c58a2555203aac67aec3d81c71dd807def4de59&lt;br/&gt;
Author: Davin Chia Ming Juay &amp;lt;dchia@liveramp.com&amp;gt;&lt;br/&gt;
Date:   2017-07-20T09:05:06Z&lt;/p&gt;

&lt;p&gt;    fix for double; make sure int type is precise&lt;/p&gt;

&lt;p&gt;commit 04f07888c714415a94121a774d26738eda0b21ac&lt;br/&gt;
Author: Davin Chia Ming Juay &amp;lt;dchia@liveramp.com&amp;gt;&lt;br/&gt;
Date:   2017-07-20T09:13:30Z&lt;/p&gt;

&lt;p&gt;    fix for string&lt;/p&gt;

&lt;p&gt;commit acd26f0e9e1c0fc47122b9f2a16573ee84fcc67e&lt;br/&gt;
Author: Davin Chia Ming Juay &amp;lt;dchia@liveramp.com&amp;gt;&lt;br/&gt;
Date:   2017-07-20T09:24:30Z&lt;/p&gt;

&lt;p&gt;    remove binary from opt because it is not needed&lt;/p&gt;

&lt;p&gt;commit 54e97c3fc09737a15380d82d9cd5a9ac049d9095&lt;br/&gt;
Author: Davin Chia Ming Juay &amp;lt;dchia@liveramp.com&amp;gt;&lt;br/&gt;
Date:   2017-07-20T20:23:05Z&lt;/p&gt;

&lt;p&gt;    remove logging&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16106111" author="jensg" created="Sat, 29 Jul 2017 12:17:17 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Thanks! Two things:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;May I ask you for adding a small test case under &lt;tt&gt;/lib/go/test&lt;/tt&gt; to verify the changes?&lt;/li&gt;
	&lt;li&gt;There are some sporadic whitespace changes that should be reverted. Also &lt;tt&gt;main.cc&lt;/tt&gt; and &lt;tt&gt;t_program.h&lt;/tt&gt; seem to have some unrelated code formatting changes that probably should be reverted as well.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=calcifer&quot; class=&quot;user-hover&quot; rel=&quot;calcifer&quot;&gt;calcifer&lt;/a&gt;, any further comments from your side?&lt;/p&gt;</comment>
                            <comment id="16106166" author="calcifer" created="Sat, 29 Jul 2017 16:26:31 +0000"  >&lt;p&gt;Definitely needs some tests, but otherwise LGTM.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=DavinC&quot; class=&quot;user-hover&quot; rel=&quot;DavinC&quot;&gt;DavinC&lt;/a&gt; you can ignore Travis failures if they are not related to Go.&lt;/p&gt;</comment>
                            <comment id="16106201" author="davinc" created="Sat, 29 Jul 2017 18:12:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jensg&quot; class=&quot;user-hover&quot; rel=&quot;jensg&quot;&gt;jensg&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;Made the whitespace changes. &lt;/p&gt;

&lt;p&gt;Will be happy to write some tests. Can I have a brief introduction to the testing workflow? Spent half an hour looking at the code but don&apos;t really know where to start. Is &lt;tt&gt;make cross&lt;/tt&gt; the command to run the test suite? Is there any specific place you want me to insert the test or do I create my own test file?&lt;/p&gt;</comment>
                            <comment id="16106243" author="jensg" created="Sat, 29 Jul 2017 21:01:19 +0000"  >&lt;p&gt;You have to run &lt;tt&gt;make check&lt;/tt&gt; inside the &lt;tt&gt;/lib/go/test&lt;/tt&gt; dir. This runs these tests by (basically) &lt;a href=&quot;https://golang.org/pkg/testing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;invoking &lt;tt&gt;go test&lt;/tt&gt; on them&lt;/a&gt;. New tests need to be added to &lt;tt&gt;/lib/go/test/Makefile.am&lt;/tt&gt;. It should be clear by looking at the existing test cases how everything works, just follow the model given by existing test cases.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;make cross&lt;/tt&gt; is for the cross language Test Suite located under &lt;tt&gt;/test&lt;/tt&gt;. That&apos;s a different thing. The policy is to have all other tests inside the &lt;tt&gt;/lib/language&lt;/tt&gt; folders, and that&apos;s what we need here.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 16 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3hmgv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>