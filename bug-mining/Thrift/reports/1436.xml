<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:21:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-3456] rounding issue in static assert</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-3456</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;thrift.codegen.idlgen&lt;/p&gt;

&lt;p&gt; static assert(structIdlString!WithDefaults ==&lt;br/&gt;
 `struct WithDefaults {&lt;br/&gt;
   -1: string a = &quot;asdf&quot;,&lt;br/&gt;
  -2: double b = 3.1415,&lt;br/&gt;
   1: WithoutMeta c = &lt;/p&gt;
{a: &quot;foo&quot;, b: 3, }
&lt;p&gt;,&lt;br/&gt;
 }&lt;br/&gt;
 `);&lt;/p&gt;

&lt;p&gt;This assert fails for me, because struct contains double b = 3.1414999...999&lt;br/&gt;
I suggest replace 3.1415 with 1.0e+20 &lt;br/&gt;
This value is free from rounding issues.&lt;/p&gt;

&lt;p&gt;FYI&lt;br/&gt;
thrift.internal.ctfe contains similar unit test, but it is not use strict match:&lt;br/&gt;
static assert(ctfeToString(3.1415).startsWith(&quot;3.141&quot;));&lt;/p&gt;

&lt;p&gt;Create pull request: &lt;a href=&quot;https://github.com/apache/thrift/pull/720&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/720&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12916869">THRIFT-3456</key>
            <summary>rounding issue in static assert</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sibnick">Tolstokulakov Nikolay</assignee>
                                    <reporter username="sibnick">Tolstokulakov Nikolay</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 Nov 2015 05:38:15 +0000</created>
                <updated>Fri, 18 Mar 2016 17:54:32 +0000</updated>
                            <resolved>Fri, 18 Mar 2016 17:54:32 +0000</resolved>
                                                    <fixVersion>0.10.0</fixVersion>
                                    <component>D - Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15032461" author="jensg" created="Mon, 30 Nov 2015 21:08:05 +0000"  >&lt;p&gt;GitHub user nrTQgc opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/720&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/720&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    fix rounding issue in static assert&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/nrTQgc/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/nrTQgc/thrift&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3456&quot; title=&quot;rounding issue in static assert&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3456&quot;&gt;&lt;del&gt;THRIFT-3456&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/720.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/720.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #720&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 9634e307f6dccb5ee7b3e8372005a3b3d86e46e4&lt;br/&gt;
Author: Nikolay Tolstokulakov &amp;lt;tolstokulakov.n@laximo.ru&amp;gt;&lt;br/&gt;
Date:   2015-11-30T05:39:42Z&lt;/p&gt;

&lt;p&gt;    fix rounding issue in static assert&lt;/p&gt;

&lt;hr /&gt;


&lt;p&gt;&amp;#8212;&lt;br/&gt;
If your project is set up for it, you can reply to this email and have your&lt;br/&gt;
reply appear on GitHub as well. If your project does not have this feature&lt;br/&gt;
enabled and wishes so, or if the feature is enabled but not working, please&lt;br/&gt;
contact infrastructure at infrastructure@apache.org or file a JIRA ticket&lt;br/&gt;
with INFRA.&lt;br/&gt;
&amp;#8212;&lt;/p&gt;
</comment>
                            <comment id="15032472" author="jensg" created="Mon, 30 Nov 2015 21:12:09 +0000"  >&lt;p&gt;Hint: The ususal way to deal with float precision issues would be to test against an epsilon, like (pseudo code) so: &lt;tt&gt;assert( abs(a-b) &amp;lt; 1e-6 )&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15032480" author="jensg" created="Mon, 30 Nov 2015 21:16:48 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="15032576" author="hudson" created="Mon, 30 Nov 2015 22:03:31 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #1749 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/1749/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/1749/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3456&quot; title=&quot;rounding issue in static assert&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3456&quot;&gt;&lt;del&gt;THRIFT-3456&lt;/del&gt;&lt;/a&gt; rounding issue in static assert Client: D Patch: Nikolay (jensg: rev 56c1dde14504af833943bee7d4b216c889c97a35)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/d/src/thrift/codegen/idlgen.d&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15033042" author="sibnick" created="Tue, 1 Dec 2015 04:17:24 +0000"  >&lt;p&gt;I was wrong. Now I find issue with plus symbol: 1e20 vs 1e+20&lt;br/&gt;
I can suggest return 3.1415 as test value and split assert into two parts:&lt;/p&gt;

&lt;p&gt;  static assert(structIdlString!WithDefaults.startsWith(&lt;br/&gt;
`struct WithDefaults {&lt;br/&gt;
  -1: string a = &quot;asdf&quot;,&lt;br/&gt;
  -2: double b = 3.141`));&lt;/p&gt;

&lt;p&gt;  static assert(structIdlString!WithDefaults.endsWith(&lt;br/&gt;
`1: WithoutMeta c = &lt;/p&gt;
{a: &quot;foo&quot;, b: 3, }
&lt;p&gt;,&lt;br/&gt;
}&lt;br/&gt;
`));&lt;/p&gt;

&lt;p&gt;Should I create new issue&amp;amp;branch for pull request or re-open with issue?&lt;/p&gt;</comment>
                            <comment id="15034956" author="jensg" created="Wed, 2 Dec 2015 00:25:25 +0000"  >&lt;p&gt;Again, the usual way to deal with precision inconsistencies with floats of all flavours is to get the absolute of the difference and comparing that value against some epsilon border:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;pseudo code&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt;( abs(value1-value2) &amp;lt; 1e-6 );   
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That string test, well ... looks a bit strange to me, to be honest. &lt;/p&gt;</comment>
                            <comment id="15035186" author="sibnick" created="Wed, 2 Dec 2015 03:10:00 +0000"  >&lt;p&gt;I send new pull request. I agree with you - it is a bit strange test. I can understand what test should check, but I am not sure how do it in more stable and clear way.  &lt;/p&gt;</comment>
                            <comment id="15036589" author="jensg" created="Wed, 2 Dec 2015 20:53:31 +0000"  >&lt;p&gt;Committed, thank you.&lt;/p&gt;</comment>
                            <comment id="15036698" author="hudson" created="Wed, 2 Dec 2015 21:42:58 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #1754 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/1754/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/1754/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-3456&quot; title=&quot;rounding issue in static assert&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-3456&quot;&gt;&lt;del&gt;THRIFT-3456&lt;/del&gt;&lt;/a&gt; rounding issue in static assert Client: D Patch: Nikolay (jensg: rev 620e7a893a32867b664de4d8b648c8f1811d9f6f)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/d/src/thrift/codegen/idlgen.d&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 50 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2p1u7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>