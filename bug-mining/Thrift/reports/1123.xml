<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:15:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-2873] TPipe and TPipeServer don&apos;t compile on Windows with UNICODE enabled</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-2873</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;When compiling the Thrift C++ library with &lt;tt&gt;UNICODE&lt;/tt&gt; enabled &lt;tt&gt;TPipe&lt;/tt&gt; and &lt;tt&gt;TPipeServer&lt;/tt&gt; won&apos;t compile as the are using &lt;tt&gt;LPSTR&lt;/tt&gt; which only works with Multi byte charactersets.&lt;/p&gt;

&lt;p&gt;The appended patch uses &lt;tt&gt;LPTSTR&lt;/tt&gt; instead of &lt;tt&gt;LPSTR&lt;/tt&gt; which is set based on the &lt;tt&gt;UNICODE&lt;/tt&gt; flag by Visual Studio.&lt;br/&gt;
It also does some casts from raw &lt;tt&gt;const char *&lt;/tt&gt; to &lt;tt&gt;LPCSTR&lt;/tt&gt;.&lt;/p&gt;

</description>
                <environment>&lt;p&gt;Visual Studio 2013&lt;/p&gt;</environment>
        <key id="12759143">THRIFT-2873</key>
            <summary>TPipe and TPipeServer don&apos;t compile on Windows with UNICODE enabled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roger">Roger Meier</assignee>
                                    <reporter username="pascal.bach">Pascal Bach</reporter>
                        <labels>
                            <label>unicode</label>
                            <label>windows</label>
                    </labels>
                <created>Wed, 3 Dec 2014 10:48:34 +0000</created>
                <updated>Mon, 26 Jan 2015 02:26:30 +0000</updated>
                            <resolved>Sat, 6 Dec 2014 15:31:08 +0000</resolved>
                                    <version>0.9.3</version>
                                    <fixVersion>0.9.3</fixVersion>
                                    <component>C++ - Library</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14233069" author="ben.craig" created="Wed, 3 Dec 2014 14:49:44 +0000"  >&lt;p&gt;casting from a const char * to a LPCTSTR with UNICODE on will result in undefined behavior.&lt;/p&gt;

&lt;p&gt;You should probably instead change CreateFile -&amp;gt; CreateFileA, WaitNamedPipe -&amp;gt; WaitNamedPipeA, and CreateNamedPipe -&amp;gt; CreateNamedPipeA.&lt;/p&gt;

&lt;p&gt;The cast of &apos;everyone_sid&apos; to an LPTSTR is fine.&lt;/p&gt;</comment>
                            <comment id="14233355" author="jensg" created="Wed, 3 Dec 2014 19:05:21 +0000"  >&lt;p&gt;Why not consequently using LP(C)TSTR? Just asking ... &lt;/p&gt;</comment>
                            <comment id="14233593" author="pascal.bach" created="Wed, 3 Dec 2014 22:07:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ben.craig&quot; class=&quot;user-hover&quot; rel=&quot;ben.craig&quot;&gt;ben.craig&lt;/a&gt; I&apos;m new to windows and also not to familiar with the whole UNICODE story.&lt;br/&gt;
If I understand correctly you can not use &lt;tt&gt;std::string&lt;/tt&gt; with UNICODE and use the macro &lt;tt&gt;WaitNamedPipe&lt;/tt&gt; because this referres to &lt;tt&gt;WaitNamedPipeW&lt;/tt&gt; and excepts an {{&lt;br/&gt;
std::wstring}}. So I agree that the correct solution would be to use the &lt;tt&gt;*A&lt;/tt&gt; functions.&lt;br/&gt;
Are there any consequences in using these in contrast to the &lt;tt&gt;*W&lt;/tt&gt; unicode versions? Or otherwise asked will this cause problems related to unicode?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jensg&quot; class=&quot;user-hover&quot; rel=&quot;jensg&quot;&gt;jensg&lt;/a&gt; What you mean by consequently using LP(C)TSTR? Do you mean replacing std::string with LPTSTR? The question then is do we need to support both MBCS and UNICODE? Microsoft suggests using unicode only. (&lt;a href=&quot;http://msdn.microsoft.com/en-us/library/cwe8bzh0.aspx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://msdn.microsoft.com/en-us/library/cwe8bzh0.aspx&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="14233606" author="ben.craig" created="Wed, 3 Dec 2014 22:21:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pascal.bach&quot; class=&quot;user-hover&quot; rel=&quot;pascal.bach&quot;&gt;pascal.bach&lt;/a&gt; I think you are correct.  TPipe and TPipeServer clients can still get non-ASCII pipe names, so long as the code page is set correctly.  This doesn&apos;t cover every possible UNICODE code point, but it gets most of them.  I don&apos;t think there is a big use case for localized pipe names though, as they typically aren&apos;t something that is customer visible.&lt;/p&gt;

&lt;p&gt;If a client already has a name that they want, and it is in a wchar_t format, then the client can call WideCharToMultiByte() and MultiByteToWideChar() as appropriate.  This doesn&apos;t cover 100% of the use cases, but it should cover 99% of them.&lt;/p&gt;</comment>
                            <comment id="14233998" author="jensg" created="Thu, 4 Dec 2014 08:12:40 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;What Microsoft suggests may not be right for us. I would not care too much here.&lt;/p&gt;

&lt;p&gt;Next re LPTSTR bcraig and I had a short talk on IRC and I think he is right. So ignore that comment from me, no longer valid (it was only an idea anyway)&lt;/p&gt;</comment>
                            <comment id="14234008" author="pascal.bach" created="Thu, 4 Dec 2014 08:27:47 +0000"  >&lt;p&gt;Based on your feedback I propose the following reworked patch.&lt;/p&gt;</comment>
                            <comment id="14234216" author="ben.craig" created="Thu, 4 Dec 2014 14:07:22 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14236851" author="roger.meier" created="Sat, 6 Dec 2014 15:31:08 +0000"  >&lt;p&gt;committed&lt;/p&gt;</comment>
                            <comment id="14236857" author="hudson" created="Sat, 6 Dec 2014 15:46:47 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #1389 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/1389/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/1389/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2873&quot; title=&quot;TPipe and TPipeServer don&amp;#39;t compile on Windows with UNICODE enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2873&quot;&gt;&lt;del&gt;THRIFT-2873&lt;/del&gt;&lt;/a&gt; Make TPipe and TPipeServer working with unicode on windows (roger: rev 3de6b8fe23af201caa86fff51bd6dcd745bd4123)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/cpp/src/thrift/transport/TPipe.cpp&lt;/li&gt;
	&lt;li&gt;lib/cpp/src/thrift/transport/TPipeServer.cpp&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12684869" name="0001-Make-TPipe-and-TPipeServer-working-with-unicode-on-w.patch" size="2564" author="pascal.bach" created="Wed, 3 Dec 2014 10:50:10 +0000"/>
                            <attachment id="12685067" name="0001v2-Make-TPipe-and-TPipeServer-working-with-unicode-on-w.patch" size="2763" author="pascal.bach" created="Thu, 4 Dec 2014 08:27:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 50 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i230b3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>