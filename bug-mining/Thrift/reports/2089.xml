<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:32:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-5125] Swift server does not work using present code.</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-5125</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;TL;DR: Swift server does not work using present code.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;m writing thrift server in swift running on iOS. For reference, I&apos;m using SocketServer, MultiplexedProcessor with BinaryProtocol over FramedTransport. Client is in Java, and we already have Java server running on Android.&lt;/p&gt;

&lt;p&gt;Note that I&apos;m new to swift, iOS and Apple world, so I may not understand everything.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;During development I&apos;ve found these issues:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;em&gt;TSocketServer.init()&lt;/em&gt;: Conversion of port: Int to sin_port: in_port_t (that is UInt16) fails with &quot;... &lt;em&gt;is not representable as&lt;/em&gt;...&quot;. UInt16(truncatingIfNeeded: ).bigEndian is needed instead of port.bigEndian&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/thrift/blob/master/lib/swift/Sources/TSocketServer.swift#L85&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/blob/master/lib/swift/Sources/TSocketServer.swift#L85&lt;/a&gt; tries to deallocate &lt;em&gt;address,&lt;/em&gt; due to &lt;em&gt;nil&lt;/em&gt; deallocator, equivalent to &lt;em&gt;kCFAllocatorDefault&lt;/em&gt;. Proper deallocator seems to be &lt;em&gt;kCFAllocatorNone&lt;/em&gt;.&lt;/li&gt;
	&lt;li&gt;According to &lt;a href=&quot;https://developer.apple.com/documentation/foundation/nsfilehandle/1413309-acceptconnectioninbackgroundandn?language=objc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://developer.apple.com/documentation/foundation/nsfilehandle/1413309-acceptconnectioninbackgroundandn?language=objc&lt;/a&gt; (see last paragraph), &lt;em&gt;socketFileHandle.acceptConnectionInBackgroundAndNotify()&lt;/em&gt; should be called again at the end of &lt;em&gt;TSocketServer.connectionAccepted()&lt;/em&gt;. Old cocoa code does it.&lt;/li&gt;
	&lt;li&gt;&lt;em&gt;TSocketServer.connectionAccepted()&lt;/em&gt; tries to read from the listening socket instead of client socket, resulting in &quot;Socket not connected&quot; error. Client socket handle is in &lt;em&gt;notification.userInfo&lt;span class=&quot;error&quot;&gt;&amp;#91;NSFileHandleNotificationFileHandleItem&amp;#93;&lt;/span&gt;&lt;/em&gt;&lt;/li&gt;
	&lt;li&gt;TSocketServer.handleClientConnection handles only one message. Loop is missing around &lt;em&gt;try processor.process()&lt;/em&gt;. I.e. &lt;em&gt;while true { try processor.process }&lt;/em&gt;&lt;/li&gt;
	&lt;li&gt;It is not possible to pass &lt;em&gt;TFramedTransport&lt;/em&gt; to &lt;em&gt;TSocketServer&lt;/em&gt;&lt;/li&gt;
	&lt;li&gt;&lt;em&gt;TSocketServer.serviceHandle&lt;/em&gt; is not used anymore&lt;/li&gt;
	&lt;li&gt;FileHandle.acceptConnectionInBackgroundAndNotify() is not implemented in Linux swift 4.2. Upgrade to 5.1 is required for this to work on Linux. See&#160; &lt;a href=&quot;https://github.com/apple/swift-corelibs-foundation/commit/fc96d7fd139bc894689b5cc13a22d9c52424caf8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apple/swift-corelibs-foundation/commit/fc96d7fd139bc894689b5cc13a22d9c52424caf8&lt;/a&gt; Cross tests can&apos;t work with 4.2.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;PR with fixes: &lt;a href=&quot;https://github.com/apache/thrift/pull/2038&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/2038&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Notes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Before merging this I suggest merging PR 2036&lt;/li&gt;
	&lt;li&gt;I did not create tests for connection changes. I could not get client and server work in the same process/thread. I will try to write simple test to check the code in cross tests but that may take some time.&lt;/li&gt;
	&lt;li&gt;I&apos;ve tried to create test for socketserver, but could not implement client connect problem with Int to UInt16 is most probably present in client code as well (TSocketTransport)&lt;/li&gt;
	&lt;li&gt;I&apos;ve created separate issue&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-5128&quot; title=&quot;Swift TFramedTransport does not work using present code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-5128&quot;&gt;&lt;del&gt;THRIFT-5128&lt;/del&gt;&lt;/a&gt; for TFramedTransport problems, to keep this one manageable.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13288240">THRIFT-5125</key>
            <summary>Swift server does not work using present code.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="janosvitok">Jano Svitok</assignee>
                                    <reporter username="janosvitok">Jano Svitok</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Feb 2020 10:01:32 +0000</created>
                <updated>Thu, 11 Feb 2021 22:27:20 +0000</updated>
                            <resolved>Tue, 19 May 2020 22:33:12 +0000</resolved>
                                    <version>0.14.0</version>
                                    <fixVersion>0.14.0</fixVersion>
                                    <component>Swift - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 37 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0bzrs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>