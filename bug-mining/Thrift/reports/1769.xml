<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:26:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-4240] Go TSimpleServer does not close properly</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-4240</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;Improper use of &lt;tt&gt;sync.Once&lt;/tt&gt; results in only the first call to &lt;tt&gt;Close()&lt;/tt&gt; in a given process actually executing.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;sync.Once&lt;/tt&gt; object should be a struct member, and not package global.&lt;/p&gt;

&lt;p&gt;Test:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;type mockProcessor struct {
	ProcessFunc func(in, out TProtocol) (bool, TException)
}

func (m *mockProcessor) &lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt;(in, out TProtocol) (bool, TException) {
	&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; m.ProcessFunc(in, out)
}

type mockServerTransport struct {
	ListenFunc    func() error
	AcceptFunc    func() (TTransport, error)
	CloseFunc     func() error
	InterruptFunc func() error
}

func (m *mockServerTransport) Listen() error {
	&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; m.ListenFunc()
}

func (m *mockServerTransport) Accept() (TTransport, error) {
	&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; m.AcceptFunc()
}

func (m *mockServerTransport) Close() error {
	&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; m.CloseFunc()
}

func (m *mockServerTransport) Interrupt() error {
	&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; m.InterruptFunc()
}

func TestMultipleStop(t *testing.T) {
	proc := &amp;amp;mockProcessor{
		ProcessFunc: func(in, out TProtocol) (bool, TException) {
			&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, nil
		},
	}

	&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; interruptCalled bool
	c := make(chan struct{})
	trans := &amp;amp;mockServerTransport{
		ListenFunc: func() error {
			&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; nil
		},
		AcceptFunc: func() (TTransport, error) {
			&amp;lt;-c
			&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; nil, nil
		},
		CloseFunc: func() error {
			c &amp;lt;- struct{}{}
			&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; nil
		},
		InterruptFunc: func() error {
			interruptCalled = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
			&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; nil
		},
	}

	serv := NewTSimpleServer2(proc, trans)
	go serv.Serve()
	serv.Stop()
	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; !interruptCalled {
		t.Error(&lt;span class=&quot;code-quote&quot;&gt;&quot;first server transport should have been interrupted&quot;&lt;/span&gt;)
	}

	serv = NewTSimpleServer2(proc, trans)
	interruptCalled = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
	go serv.Serve()
	serv.Stop()
	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; !interruptCalled {
		t.Error(&lt;span class=&quot;code-quote&quot;&gt;&quot;second server transport should have been interrupted&quot;&lt;/span&gt;)
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;go test -race -run TestMultipleStop
--- FAIL: TestMultipleStop (0.00s)
	simple_server_test.go:96: second server transport should have been interrupted
FAIL
exit status 1
FAIL	github.com/kolide/launcher/vendor/git.apache.org/thrift.git/lib/go/thrift	0.020s
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13082910">THRIFT-4240</key>
            <summary>Go TSimpleServer does not close properly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zwass">Zach Wasserman</assignee>
                                    <reporter username="zwass">Zach Wasserman</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Jun 2017 18:14:57 +0000</created>
                <updated>Thu, 14 Dec 2017 13:55:52 +0000</updated>
                            <resolved>Sat, 1 Jul 2017 14:03:35 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.11.0</fixVersion>
                                    <component>Go - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16065319" author="githubbot" created="Tue, 27 Jun 2017 19:06:42 +0000"  >&lt;p&gt;GitHub user zwass opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1301&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1301&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4240&quot; title=&quot;Go TSimpleServer does not close properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4240&quot;&gt;&lt;del&gt;THRIFT-4240&lt;/del&gt;&lt;/a&gt; Fix use of sync.Once in Go TSimpleServer Stop() method&lt;/p&gt;

&lt;p&gt;    A package global sync.Once was used, which ensured that Stop() could only be&lt;br/&gt;
    called once &lt;b&gt;per process&lt;/b&gt;. The correct semantics should be once &lt;b&gt;per server&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;    This commit makes the sync.Once a member of the server struct so that the&lt;br/&gt;
    correct semantics are applied.&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4240&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/THRIFT-4240&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/zwass/thrift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/zwass/thrift&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4240&quot; title=&quot;Go TSimpleServer does not close properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4240&quot;&gt;&lt;del&gt;THRIFT-4240&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1301.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1301.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1301&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 3f0444f8292a6ca1889e9812b805759eb8a74255&lt;br/&gt;
Author: Zachary Wasserman &amp;lt;zachwass2000@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-06-27T19:03:39Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4240&quot; title=&quot;Go TSimpleServer does not close properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-4240&quot;&gt;&lt;del&gt;THRIFT-4240&lt;/del&gt;&lt;/a&gt; Fix use of sync.Once in Go TSimpleServer Stop() method&lt;/p&gt;

&lt;p&gt;    A package global sync.Once was used, which ensured that Stop() could only be&lt;br/&gt;
    called once &lt;b&gt;per process&lt;/b&gt;. The correct semantics should be once &lt;b&gt;per server&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;    This commit makes the sync.Once a member of the server struct so that the&lt;br/&gt;
    correct semantics are applied.&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-4240&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/THRIFT-4240&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16070499" author="githubbot" created="Fri, 30 Jun 2017 18:06:37 +0000"  >&lt;p&gt;Github user zwass commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1301&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1301&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    If &lt;a href=&quot;https://github.com/apache/thrift/pull/1302&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1302&lt;/a&gt; is merged, this PR can be closed.&lt;/p&gt;</comment>
                            <comment id="16071247" author="githubbot" created="Sat, 1 Jul 2017 14:02:51 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/thrift/pull/1301&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/pull/1301&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16071251" author="jensg" created="Sat, 1 Jul 2017 14:03:35 +0000"  >&lt;p&gt;Committed, thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 20 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3gsuf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>