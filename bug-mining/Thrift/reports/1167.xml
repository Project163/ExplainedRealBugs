<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:16:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-2959] nodejs: fix binary unit tests</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-2959</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description></description>
                <environment>&lt;p&gt;Trusty64 Vagrant Box&lt;/p&gt;</environment>
        <key id="12771206">THRIFT-2959</key>
            <summary>nodejs: fix binary unit tests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="codesf">Randy Abernethy</assignee>
                                    <reporter username="andrewdeandrade">Andrew de Andrade</reporter>
                        <labels>
                    </labels>
                <created>Fri, 30 Jan 2015 03:12:07 +0000</created>
                <updated>Tue, 21 Jul 2015 02:21:10 +0000</updated>
                            <resolved>Mon, 2 Feb 2015 13:59:50 +0000</resolved>
                                                    <fixVersion>0.9.3</fixVersion>
                                    <component>Node.js - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14298151" author="andrewdeandrade" created="Fri, 30 Jan 2015 03:14:11 +0000"  >&lt;p&gt;Binary unit tests were not being run because they were called with the node binary instead of the nodeunit binary. The first commit gets the binary unit tests working again.&lt;/p&gt;

&lt;p&gt;The second commit switches from using nodeunit&apos;s equal check that only performs loose equals (==) check instead of strict equals (===) check. This uncovers a potential source of bugs in readByte, which previously could return an array with a byte in it. This function is almost invariably used to read the type of things (message, field, etc.) so endianness behavior should always be big endian (network order), reading from the beginning of a bytearray.&lt;/p&gt;

&lt;p&gt;This function is still polymorphic (accepting both a byte and a bytearray), but fixing that will be the focus of another patch since it will involve fixing call sites.&lt;/p&gt;</comment>
                            <comment id="14299979" author="codesf" created="Sat, 31 Jan 2015 20:54:19 +0000"  >&lt;p&gt;Hey Andrew,&lt;/p&gt;

&lt;p&gt;Great patch, ran into a couple of issues.&lt;br/&gt;
1) My nodeunit path after npm install on Ubuntu 14.04.1 LTS is: ../node_modules/nodeunit/bin/nodeunit&lt;br/&gt;
2) Would be nice to have a passing test so the commit doesn&apos;t break the build&lt;/p&gt;

&lt;p&gt;(I am going through these in the order listed from your email)&lt;/p&gt;

&lt;p&gt;Best,&lt;br/&gt;
Randy&lt;/p&gt;</comment>
                            <comment id="14299986" author="andrewdeandrade" created="Sat, 31 Jan 2015 20:59:26 +0000"  >&lt;p&gt;I ran `npm test` before every commit using the vagrantfile setup on ubuntu trusty64, so it&apos;s strange that the tests don&apos;t pass for you. &lt;/p&gt;

&lt;p&gt;There should always be two ways to access the binfile with nodejs. The one you mentioned is where the binary actually lives. However npm also puts symlinks for binaries for top level modules (i.e. not nested modules) in the ../node_modules/.bin/ folder.&lt;/p&gt;

&lt;p&gt;Thus, the nodeunit binary lives where you said it does (../node_modules/nodeunit/bin/nodeunit), but there is also a symlink in the ../node_modules/.bin&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;../node_modules/.bin/nodeunit --&amp;gt; ../node_modules/nodeunit/bin/nodeunit&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Can you confirm that nodeunit is in that ((.bin)) folder?&lt;/p&gt;</comment>
                            <comment id="14300018" author="codesf" created="Sat, 31 Jan 2015 22:31:09 +0000"  >&lt;p&gt;I booted a fresh 14.04 vm and installed deps. No .bin folder. I&apos;ll try the vagrant box. &lt;/p&gt;</comment>
                            <comment id="14300020" author="andrewdeandrade" created="Sat, 31 Jan 2015 22:42:05 +0000"  >&lt;p&gt;That is really odd. Run this command: &lt;tt&gt;npm config get bin-links&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;If that shows false, then run &lt;tt&gt;npm config set bin-links true&lt;/tt&gt;. True is the default value and if yours shows false, then that is very strange. I ran npm install locally in the project folder. I&apos;m wondering if there is something unusual about how the makefile scripts are running `npm install`.&lt;/p&gt;

&lt;p&gt;There is also this issue on &lt;a href=&quot;https://github.com/npm/npm/issues/4851&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/npm/npm/issues/4851&lt;/a&gt; but no one has claimed that this issue affects ubuntu and that seems to be about users of n (a node version manager), which AFAICT is not used in the thrift setup, is it?&lt;/p&gt;

&lt;p&gt;Plus, caolan/nodeunit&apos;s package.json definitely has a &quot;bin&quot; prop defined:&lt;br/&gt;
&lt;a href=&quot;https://github.com/caolan/nodeunit/blob/master/package.json#L84&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/caolan/nodeunit/blob/master/package.json#L84&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I will spin up a new vm after lunch and try investigating why the ../node_modules/.bin folder isn&apos;t being created, since that is where the problem appears to lie here. We could change the path to point at the one you used, but the only downside is that you won&apos;t be able to use the binary names in the &quot;scripts&quot; properties in the package.json, since all the `npm run &amp;lt;script&amp;gt;` commands add the ../node_modules/.bin folder to the internal PATH variable npm uses when probing for executables.&lt;/p&gt;</comment>
                            <comment id="14300024" author="andrewdeandrade" created="Sat, 31 Jan 2015 22:54:56 +0000"  >&lt;p&gt;Another possible explanation is the the makefile execution of npm install uses the `--no-bin-links` arg (but I can&apos;t think of any reason why that flag would be set except in conjunction with the --global/-g flag (i.e. I can see why someone, for security or naming conflict reasons with another binary, might want a library available globally, but not want that library to put an executable accessible via $PATH.)&lt;/p&gt;

&lt;p&gt;automake and autoconf are pretty new to me, so I&apos;ll see how far I can get in my sleuthing. Truth is that I found the entire `make check` experience wholly overwhelming since there is so much noise on stdout even for passing tests. (generally I only want to see additional info when things fail or when I set logging levels high).&lt;/p&gt;</comment>
                            <comment id="14300057" author="andrewdeandrade" created="Sun, 1 Feb 2015 02:06:20 +0000"  >&lt;p&gt;I found the culprit: &lt;a href=&quot;https://github.com/apache/thrift/blob/master/lib/nodejs/Makefile.am#L25&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/thrift/blob/master/lib/nodejs/Makefile.am#L25&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14300059" author="andrewdeandrade" created="Sun, 1 Feb 2015 02:10:26 +0000"  >&lt;p&gt;This fixes the bin files problem. I can&apos;t see any reason why the --no-bin-links was used for a local install (i.e. no --global flag).&lt;/p&gt;</comment>
                            <comment id="14300066" author="codesf" created="Sun, 1 Feb 2015 03:50:45 +0000"  >&lt;p&gt;Hey Andrew,&lt;/p&gt;

&lt;p&gt;--no-bin-links was required to get the Vagrant config working. Thrift is accessed from the guest using a shared host folder (the thrift repo where the contrib vagrantfile is located) which appears as a fs that doesn&apos;t support symlinks. Several problems with npm arise in the vagrant guest when this is not set. There may be other ways to skin the cat. If you can get the Vagrant build to take without --no-bin-links I&apos;m all for it. Otherwise maybe the full path is the lowest hanging fruit. &lt;/p&gt;

&lt;p&gt;Another reason to avoid digressing too far into the configuration management of all this is that it looks as if Thrift will be moving to CMake in the not too distant future. Also Docker is showing up as a faster, and in some ways more robust way to test Thrift, so Vagrant may be less important down the road (or important as a container provisioner rather than a VM provisioner).&lt;/p&gt;

&lt;p&gt;Will your patches apply with the double patch committed?&lt;/p&gt;

&lt;p&gt;-Randy&lt;/p&gt;</comment>
                            <comment id="14301287" author="codesf" created="Mon, 2 Feb 2015 13:53:31 +0000"  >&lt;p&gt;updated patch to support unlinked nodeunit path and fixed incorrect test cases&lt;/p&gt;</comment>
                            <comment id="14301297" author="codesf" created="Mon, 2 Feb 2015 13:59:50 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andrewdeandrade&quot; class=&quot;user-hover&quot; rel=&quot;andrewdeandrade&quot;&gt;andrewdeandrade&lt;/a&gt;, &lt;br/&gt;
Thanks for the patch. Added full nodeunit path (as discussed) and repaired incorrect test cases, otherwise as written. Committed.&lt;br/&gt;
Best,&lt;br/&gt;
Randy&lt;/p&gt;</comment>
                            <comment id="14301311" author="hudson" created="Mon, 2 Feb 2015 14:16:19 +0000"  >&lt;p&gt;SUCCESS: Integrated in Thrift #1439 (See &lt;a href=&quot;https://builds.apache.org/job/Thrift/1439/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Thrift/1439/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-2959&quot; title=&quot;nodejs: fix binary unit tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-2959&quot;&gt;&lt;del&gt;THRIFT-2959&lt;/del&gt;&lt;/a&gt;: reenable binary.test.js in testAll.sh (ra: rev cf743d7ac7f198b841f820d9b241569b29c74677)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lib/nodejs/test/testAll.sh&lt;/li&gt;
	&lt;li&gt;lib/nodejs/test/binary.test.js&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14301704" author="andrewdeandrade" created="Mon, 2 Feb 2015 19:07:22 +0000"  >&lt;p&gt;I&apos;ll be sure to make sure all future nodejs binary references do not make reference to the node_modules/.bin/ folder symlinks unless we can find a fix for the vagrant symlink issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12695784" name="0001-npm-install-adds-bin-links-to-node_modules-.bin.patch" size="695" author="andrewdeandrade" created="Sun, 1 Feb 2015 02:10:26 +0000"/>
                            <attachment id="12695924" name="0001-reenabled-binary.test.js-in-testAll.sh.patch" size="6068" author="codesf" created="Mon, 2 Feb 2015 13:53:31 +0000"/>
                            <attachment id="12695441" name="thrift-2959-nodejs-fix-binary-unit-tests.patch" size="5896" author="andrewdeandrade" created="Fri, 30 Jan 2015 03:14:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 42 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i24zjz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>