<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 08:25:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-3935] Incorrect skipping of map and set</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-3935</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;If a new map&amp;lt;&amp;gt; is added to the thrift structure and sending this new serialized thrift to the old version that didn&apos;t included yet this map definition it should skip it. It does so, but it uses read_set_begin/end instead of read_map_begin/end functions.&lt;/p&gt;

&lt;p&gt;Included patch fixes the problem.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Matej&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;diff --git a/lib/c_glib/src/thrift/c_glib/protocol/thrift_protocol.c b/lib/c_glib/src/thrift/c_glib/protocol/thrift_protocol.c
index d6315d8..b274b00 100644
--- a/lib/c_glib/src/thrift/c_glib/protocol/thrift_protocol.c
+++ b/lib/c_glib/src/thrift/c_glib/protocol/thrift_protocol.c
@@ -489,14 +489,16 @@ thrift_protocol_skip (ThriftProtocol *protocol, ThriftType type, GError **error)
       {
         guint32 result = 0;
         ThriftType elem_type;
+        ThriftType key_type;
         guint32 i, size;
-        result += thrift_protocol_read_set_begin (protocol, &amp;amp;elem_type, &amp;amp;size,
+        result += thrift_protocol_read_map_begin (protocol, &amp;amp;key_type, &amp;amp;elem_type, &amp;amp;size,
                                                   error);
         &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (i = 0; i &amp;lt; size; i++)
         {
+          result += thrift_protocol_skip (protocol, key_type, error);
           result += thrift_protocol_skip (protocol, elem_type, error);
         }
-        result += thrift_protocol_read_set_end (protocol, error);
+        result += thrift_protocol_read_map_end (protocol, error);
         &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; result;
       }
     &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; T_LIST:
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Ubuntu&lt;/p&gt;</environment>
        <key id="13008212">THRIFT-3935</key>
            <summary>Incorrect skipping of map and set</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="matejkupljen">Matej Kupljen</assignee>
                                    <reporter username="matejkupljen">Matej Kupljen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Sep 2016 12:14:08 +0000</created>
                <updated>Tue, 11 Oct 2016 01:12:33 +0000</updated>
                            <resolved>Thu, 29 Sep 2016 18:48:25 +0000</resolved>
                                    <version>0.9.3</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>C glib - Library</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15530821" author="jensg" created="Wed, 28 Sep 2016 20:43:55 +0000"  >&lt;p&gt;Good catch, but two things:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;This seems to fix only half of the issue. &lt;tt&gt;T_SET&lt;/tt&gt; should be added to that function as well, it is entirely missing.&lt;/li&gt;
	&lt;li&gt;Please proivide a &lt;b&gt;patch file&lt;/b&gt;, this makes life easier (or Github pull requests). Attachments can be added via &lt;b&gt;More =&amp;gt; Attach Files&lt;/b&gt; above&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="15532170" author="matejkupljen" created="Thu, 29 Sep 2016 08:36:13 +0000"  >&lt;p&gt;I have uploaded the patch that:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;adds the &lt;tt&gt;T_SET&lt;/tt&gt; to the function&lt;/li&gt;
	&lt;li&gt;fixes &lt;tt&gt;T_MAP&lt;/tt&gt; handling&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Patch is uploaded, like you suggested.&lt;/p&gt;</comment>
                            <comment id="15533676" author="jensg" created="Thu, 29 Sep 2016 18:48:25 +0000"  >&lt;p&gt;Committed, thank you.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12830873" name="add-set-and-fix-map-skip.patch" size="1439" author="matejkupljen" created="Thu, 29 Sep 2016 08:38:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i346sn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>