<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:58:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[THRIFT-897] Don&apos;t allow unqualified constant access to enum values</title>
                <link>https://issues.apache.org/jira/browse/THRIFT-897</link>
                <project id="12310800" key="THRIFT">Thrift</project>
                    <description>&lt;p&gt;Through looking at &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-544&quot; title=&quot;multiple enums with the same key generate invalid code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-544&quot;&gt;&lt;del&gt;THRIFT-544&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-895&quot; title=&quot;Thrift compiler does not allow two different enumerations to have the same key name for one of the enum values&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-895&quot;&gt;&lt;del&gt;THRIFT-895&lt;/del&gt;&lt;/a&gt;, it&apos;s come to my attention that we currently register each of every enum&apos;s values as a global (and scoped) constant. This allows you to do things like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;enum&lt;/span&gt; MyEnum {
 A = 1
 B = 2
}

&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; MyEnum myEnumVar = A;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is handy, insofar as you might want to use the values of an enum in constant or default circumstances. However, this behavior is unstable - if you have two enums with values that have the same name, all constant references will point at the last occurrence of the name. Further, in order to allow this to go on, we must not check if any constant has been declared twice, which means you can get stupid, detectable errors in your IDL very easily.&lt;/p&gt;

&lt;p&gt;I propose that we stop allowing this method of access, and instead require the enum values referenced in constant context to be prefixed with the enum type&apos;s name. For instance:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;enum&lt;/span&gt; MyEnum {
 A = 1
 B = 2
}

&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; MyEnum myEnumVar = MyEnum.A;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12473841">THRIFT-897</key>
            <summary>Don&apos;t allow unqualified constant access to enum values</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bryanduxbury">Bryan Duxbury</assignee>
                                    <reporter username="bryanduxbury">Bryan Duxbury</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Sep 2010 18:59:08 +0000</created>
                <updated>Sun, 12 Sep 2010 14:39:15 +0000</updated>
                            <resolved>Sun, 12 Sep 2010 14:39:15 +0000</resolved>
                                    <version>0.1</version>
                    <version>0.2</version>
                    <version>0.3</version>
                    <version>0.4</version>
                                    <fixVersion>0.5</fixVersion>
                                    <component>Compiler (General)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12908151" author="dreiss" created="Fri, 10 Sep 2010 19:13:24 +0000"  >&lt;p&gt;I think this is a really simple change, but it will break existing files.&lt;/p&gt;</comment>
                            <comment id="12908164" author="mcslee" created="Fri, 10 Sep 2010 19:38:03 +0000"  >&lt;p&gt;YIkes. I&apos;ll defer to whatever people prefer. Seems we can either:&lt;/p&gt;

&lt;p&gt;(1) Require strongly-typed references to enums, as you propose&lt;br/&gt;
(2) Perform enum-lookups in a strongly-typed manner (i.e. when we see &quot;const MyEnum&quot;, we know the only valid values are those in the MyEnum type)&lt;/p&gt;

&lt;p&gt;The former seems cleaner/more-straightforward, but the latter is backwards-compatible.&lt;/p&gt;</comment>
                            <comment id="12908172" author="jdecew" created="Fri, 10 Sep 2010 20:21:16 +0000"  >&lt;p&gt;What would be the cost of doing type resolution?  I think this might be the most convenient (and backward-compatible) behavior, but I have no idea if it is feasible in the current architecture of the compiler.&lt;/p&gt;

&lt;p&gt;This is my proposal:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;enum&lt;/span&gt; MyEnum {
 A = 1
 X = 2
}
&lt;span class=&quot;code-keyword&quot;&gt;enum&lt;/span&gt; OtherEnum {
 B = 1
 X = 2
}

&lt;span class=&quot;code-comment&quot;&gt;// Automatically resolve A to MyEnum.A and allow to compile
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; MyEnum myConst1 = A;

&lt;span class=&quot;code-comment&quot;&gt;// Automatically resolve B to MyEnum.B and FAIL to compile because MyEnum.B does not exist
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; MyEnum myConst2 = B;

&lt;span class=&quot;code-comment&quot;&gt;// Allow to compile
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; MyEnum myConst3 = OtherEnum.B;

&lt;span class=&quot;code-comment&quot;&gt;// Allow to compile
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; MyEnum myConst4 = MyEnum.A;

&lt;span class=&quot;code-comment&quot;&gt;// Automatically resolve X to MyEnum.X and allow to compile (but maybe warn that X was ambiguously resolved)
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; MyEnum myConst5 = X;

&lt;span class=&quot;code-comment&quot;&gt;// Can&apos;t automatically resolve A (even though it is unique), FAIL to compile
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; i32 myConst6 = A;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12908177" author="dreiss" created="Fri, 10 Sep 2010 20:30:18 +0000"  >&lt;p&gt;For simple constants like the ones in your example, I think it would be reasonably easy.  For things like container and structure contants containing enums, it would be harder.&lt;/p&gt;</comment>
                            <comment id="12908188" author="bryanduxbury" created="Fri, 10 Sep 2010 20:57:05 +0000"  >&lt;p&gt;I think the smart resolution thing is only worthwhile if we really want to keep backwards compatibility. I&apos;m not crazy about breaking people&apos;s IDL, but I think that&apos;s preferable in the long term to supporting a more convoluted syntax.&lt;/p&gt;

&lt;p&gt;If we were starting from scratch today, I think that we&apos;d want to use the fully-qualified approach, and the cost of fixing the breakage &lt;b&gt;should&lt;/b&gt; be reasonably low, especially because you&apos;re getting a consistency improvement at the same time. This is certainly my preference.&lt;/p&gt;</comment>
                            <comment id="12908246" author="bryanduxbury" created="Sat, 11 Sep 2010 00:07:42 +0000"  >&lt;p&gt;This patch enforces fully qualified enum value references. &lt;/p&gt;</comment>
                            <comment id="12908393" author="dreiss" created="Sun, 12 Sep 2010 01:01:40 +0000"  >&lt;p&gt;LGTM.  In the main.cc part, you could possibly check the part before the dot matches the name of the enum (possibly with the scope qualifier).  Not critical.&lt;/p&gt;</comment>
                            <comment id="12908476" author="bryanduxbury" created="Sun, 12 Sep 2010 14:39:15 +0000"  >&lt;p&gt;I just committed this.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12473743">THRIFT-895</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12454352" name="thrift-897.patch" size="2763" author="bryanduxbury" created="Sat, 11 Sep 2010 00:07:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38637</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 11 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16dtj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245371</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>