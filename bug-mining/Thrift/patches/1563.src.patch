diff --git a/lib/perl/Makefile.am b/lib/perl/Makefile.am
index 6b0f9dd13..2fb8c5aeb 100644
--- a/lib/perl/Makefile.am
+++ b/lib/perl/Makefile.am
@@ -23,23 +23,18 @@ Makefile-perl.mk : Makefile.PL
 	$(PERL) Makefile.PL MAKEFILE=Makefile-perl.mk INSTALLDIRS=$(INSTALLDIRS) INSTALL_BASE=$(PERL_PREFIX)
 
 all-local: Makefile-perl.mk
-	$(MAKE) -f Makefile-perl.mk
+	$(MAKE) -f $<
 	find blib -name 'Makefile*' -exec rm -f {} \;
 
-check-local:
-	$(PERL) -Iblib/lib -I@abs_srcdir@ -I@builddir@/test/gen-perl \
-		-I@builddir@/test/gen-perl/BenchmarkTest \
-		-I@builddir@/test/gen-perl/Aggr \
-		@abs_srcdir@/test.pl @abs_srcdir@/test/*.t
-
 install-exec-local: Makefile-perl.mk
-	$(MAKE) -f Makefile-perl.mk install DESTDIR=$(DESTDIR)/
+	$(MAKE) -f $< install DESTDIR=$(DESTDIR)/
 
 clean-local:
 	if test -f Makefile-perl.mk ; then \
 		$(MAKE) -f Makefile-perl.mk clean ; \
 	fi
-	rm -f Makefile-perl.mk.old
+	$(RM) Makefile-perl.mk.old
+	$(RM) -r gen-perl gen-perl2
 
 EXTRA_DIST = \
 	coding_standards.md \
@@ -64,3 +59,45 @@ EXTRA_DIST = \
 	lib/Thrift/SSLServerSocket.pm \
 	lib/Thrift/Transport.pm \
 	README.md
+
+THRIFT = @top_builddir@/compiler/cpp/thrift
+THRIFT_IF = @top_srcdir@/test/ThriftTest.thrift
+NAME_BENCHMARKSERVICE =  @top_srcdir@/lib/rb/benchmark/Benchmark.thrift
+NAME_AGGR = @top_srcdir@/contrib/async-test/aggr.thrift
+
+THRIFTTEST_GEN = \
+	gen-perl/ThriftTest/Constants.pm \
+	gen-perl/ThriftTest/SecondService.pm \
+	gen-perl/ThriftTest/ThriftTest.pm \
+	gen-perl/ThriftTest/Types.pm
+
+BENCHMARK_GEN = \
+	gen-perl/BenchmarkService.pm \
+	gen-perl/Constants.pm \
+	gen-perl/Types.pm
+
+AGGR_GEN = \
+	gen-perl2/Aggr.pm \
+	gen-perl2/Constants.pm \
+	gen-perl2/Types.pm
+
+PERL_GEN = \
+	$(THRIFTTEST_GEN) \
+	$(BENCHMARK_GEN) \
+	$(AGGR_GEN)
+
+BUILT_SOURCES = $(PERL_GEN)
+
+check-local: $(PERL_GEN)
+	$(PERL) -Iblib/lib -I@abs_srcdir@ -I@builddir@/gen-perl2 -I@builddir@/gen-perl \
+		@abs_srcdir@/test.pl @abs_srcdir@/test/*.t
+
+$(THRIFTTEST_GEN): $(THRIFT_IF) $(THRIFT)
+	$(THRIFT) --gen perl $<
+
+$(BENCHMARK_GEN): $(NAME_BENCHMARKSERVICE) $(THRIFT)
+	$(THRIFT) --gen perl $<
+
+$(AGGR_GEN): $(NAME_AGGR) $(THRIFT)
+	$(MKDIR_P) gen-perl2
+	$(THRIFT) -out gen-perl2 --gen perl $<
diff --git a/lib/perl/test/Makefile.am b/lib/perl/test/Makefile.am
index 2c9ce2a89..de0397186 100644
--- a/lib/perl/test/Makefile.am
+++ b/lib/perl/test/Makefile.am
@@ -17,26 +17,4 @@
 # under the License.
 #
 
-THRIFT = @top_builddir@/compiler/cpp/thrift
-THRIFT_IF = @top_srcdir@/test/ThriftTest.thrift
-NAME_BENCHMARKSERVICE =  @top_srcdir@/lib/rb/benchmark/Benchmark.thrift
-NAME_AGGR = @top_srcdir@/contrib/async-test/aggr.thrift
-
-check-local: \
-	gen-perl/ThriftTest/Types.pm \
-	gen-perl/BenchmarkTest/BenchmarkService.pm \
-	gen-perl/Aggr/Aggr.pm
-
-gen-perl/ThriftTest/Types.pm: $(THRIFT_IF)
-	$(THRIFT) --gen perl $(THRIFT_IF)
-
-clean-local:
-	rm -rf gen-perl
-	
-gen-perl/BenchmarkTest/BenchmarkService.pm: $(NAME_BENCHMARKSERVICE)
-	$(THRIFT) --gen perl $(NAME_BENCHMARKSERVICE)
-	
-gen-perl/Aggr/Aggr.pm: $(NAME_AGGR)
-	$(THRIFT) --gen perl $(NAME_AGGR)
-
 EXTRA_DIST = memory_buffer.t processor.t multiplex.t
