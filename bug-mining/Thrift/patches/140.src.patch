diff --git a/lib/rb/spec/compact_protocol_spec.rb b/lib/rb/spec/compact_protocol_spec.rb
index 78b1a2a2a..b9a798103 100644
--- a/lib/rb/spec/compact_protocol_spec.rb
+++ b/lib/rb/spec/compact_protocol_spec.rb
@@ -76,21 +76,10 @@ describe Thrift::CompactProtocol do
 
     struct = CompactProtoTestStruct.new
     # sets and maps don't hash well... not sure what to do here.
-    struct.set_byte_map = nil
-    struct.map_byte_map = nil
     struct.write(proto)
-    
-    # puts trans.inspect
-    
-    struct2 = CompactProtoTestStruct.new
-    struct2.instance_variables.each do |ivar|
-      struct2.instance_variable_set(ivar, nil)
-    end
-    
-    struct2.should_not == struct
 
-    struct2.read(proto)
-    
+    struct2 = CompactProtoTestStruct.new
+    struct2.read(proto)    
     struct2.should == struct
   end
 
diff --git a/lib/rb/spec/spec_helper.rb b/lib/rb/spec/spec_helper.rb
index 41bf631e7..3c20bf999 100644
--- a/lib/rb/spec/spec_helper.rb
+++ b/lib/rb/spec/spec_helper.rb
@@ -45,9 +45,11 @@ Spec::Runner.configure do |configuration|
 end
 
 require File.dirname(__FILE__) + "/../debug_proto_test/gen-rb/Srv"
+require File.dirname(__FILE__) + "/../debug_proto_test/gen-rb/debug_proto_test_constants"
 
 module Fixtures
-  COMPACT_PROTOCOL_TEST_STRUCT = CompactProtoTestStruct.new(:a_binary => [0,1,2,3,4,5,6,7,8].pack('c*'))
+  COMPACT_PROTOCOL_TEST_STRUCT = COMPACT_TEST.dup
+  COMPACT_PROTOCOL_TEST_STRUCT.a_binary = [0,1,2,3,4,5,6,7,8].pack('c*')
   COMPACT_PROTOCOL_TEST_STRUCT.set_byte_map = nil
   COMPACT_PROTOCOL_TEST_STRUCT.map_byte_map = nil
 end
\ No newline at end of file
