diff --git a/lib/d/src/thrift/transport/http.d b/lib/d/src/thrift/transport/http.d
index 5186f3d8b..c7d1f5094 100644
--- a/lib/d/src/thrift/transport/http.d
+++ b/lib/d/src/thrift/transport/http.d
@@ -134,7 +134,7 @@ protected:
     }
 
     static bool compToLower(ubyte a, ubyte b) {
-      return a == toLower(cast(char)b);
+      return toLower(cast(char)a) == toLower(cast(char)b);
     }
 
     if (startsWith!compToLower(split[0], cast(ubyte[])"transfer-encoding")) {
