{"url":"https://api.github.com/repos/jhy/jsoup/issues/1250","repository_url":"https://api.github.com/repos/jhy/jsoup","labels_url":"https://api.github.com/repos/jhy/jsoup/issues/1250/labels{/name}","comments_url":"https://api.github.com/repos/jhy/jsoup/issues/1250/comments","events_url":"https://api.github.com/repos/jhy/jsoup/issues/1250/events","html_url":"https://github.com/jhy/jsoup/issues/1250","id":486206012,"node_id":"MDU6SXNzdWU0ODYyMDYwMTI=","number":1250,"title":"`isBinary` detect proper HTML page as binary","user":{"login":"panthony","id":230462,"node_id":"MDQ6VXNlcjIzMDQ2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/230462?v=4","gravatar_id":"","url":"https://api.github.com/users/panthony","html_url":"https://github.com/panthony","followers_url":"https://api.github.com/users/panthony/followers","following_url":"https://api.github.com/users/panthony/following{/other_user}","gists_url":"https://api.github.com/users/panthony/gists{/gist_id}","starred_url":"https://api.github.com/users/panthony/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/panthony/subscriptions","organizations_url":"https://api.github.com/users/panthony/orgs","repos_url":"https://api.github.com/users/panthony/repos","events_url":"https://api.github.com/users/panthony/events{/privacy}","received_events_url":"https://api.github.com/users/panthony/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":22026,"node_id":"MDU6TGFiZWwyMjAyNg==","url":"https://api.github.com/repos/jhy/jsoup/labels/bug","name":"bug","color":"D13131","default":true,"description":"A confirmed bug, that we should fix"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/jhy/jsoup/milestones/16","html_url":"https://github.com/jhy/jsoup/milestone/16","labels_url":"https://api.github.com/repos/jhy/jsoup/milestones/16/labels","id":4306800,"node_id":"MDk6TWlsZXN0b25lNDMwNjgwMA==","number":16,"title":"1.12.2","description":"Changes in 1.22.2 - https://jsoup.org/news/release-1.12.2","creator":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":37,"state":"closed","created_at":"2019-05-13T02:02:11Z","updated_at":"2020-02-09T04:55:33Z","due_on":"2020-02-08T08:00:00Z","closed_at":"2020-02-09T04:55:00Z"},"comments":4,"created_at":"2019-08-28T07:29:00Z","updated_at":"2020-02-02T18:12:23Z","closed_at":"2020-02-02T18:11:51Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Failing test case:\r\n```java\r\n    @Test\r\n    public void testBinaryFail() throws IOException {\r\n        Jsoup.parse(new URL(\"https://www.searspartsdirect.com/repair-parts-for-kenmore-106w14f/0582/0160000.html\"), 50000);\r\n    }\r\n```\r\n\r\nDetecting a binary file is complicated :/\r\n\r\n\r\nAt one point in my own project I was using something like:\r\n\r\n```java\r\npublic abstract class NonPrintableDetector {\r\n\r\n    private final static Pattern NON_PRINTABLE_PATTERN = Pattern.compile(\"\\\\p{C}\", Pattern.UNICODE_CHARACTER_CLASS);\r\n\r\n    /**\r\n     * @param value Sequence of chars to test against non printable characters\r\n     * @param maxRatio Maximum accepted ratio of non printable characters (between 0.0 and 1.0)\r\n     * @return True if ratio of non printable characters is above maxRatio\r\n     */\r\n    public static boolean isAboveThreshold(final CharSequence value, final float maxRatio) {\r\n        if (value == null || value.length() == 0) {\r\n            return false;\r\n        }\r\n\r\n        // check for high ratio of non printable characters\r\n        final Matcher matcher = NON_PRINTABLE_PATTERN.matcher(value);\r\n\r\n        int nonPrintableChars = 0;\r\n        while (matcher.find()) {\r\n            nonPrintableChars++;\r\n        }\r\n\r\n        return nonPrintableChars > Math.ceil(value.length() * maxRatio);\r\n    }\r\n\r\n}\r\n```\r\n\r\nBut even so I had PDF accepted because it had a bunch of textual metadata near the beginning of the file...\r\n\r\nI finally resorted to use the Tika library because of its knowledge of magic bytes, etc.\r\n\r\nIMO JSoup should not even attempt to do this or at least give a way to be disabled because I for-see a lot of false positive or negative.\r\n","closed_by":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/jhy/jsoup/issues/1250/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/jhy/jsoup/issues/1250/timeline","performed_via_github_app":null,"state_reason":"completed"}