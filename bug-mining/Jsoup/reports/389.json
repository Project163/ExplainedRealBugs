{"url":"https://api.github.com/repos/jhy/jsoup/issues/2366","repository_url":"https://api.github.com/repos/jhy/jsoup","labels_url":"https://api.github.com/repos/jhy/jsoup/issues/2366/labels{/name}","comments_url":"https://api.github.com/repos/jhy/jsoup/issues/2366/comments","events_url":"https://api.github.com/repos/jhy/jsoup/issues/2366/events","html_url":"https://github.com/jhy/jsoup/issues/2366","id":3208849863,"node_id":"I_kwDOAAbAPs6_QynH","number":2366,"title":"ArrayIndexOutOfBoundsException regression iterating children","user":{"login":"carlosame","id":38894633,"node_id":"MDQ6VXNlcjM4ODk0NjMz","avatar_url":"https://avatars.githubusercontent.com/u/38894633?v=4","gravatar_id":"","url":"https://api.github.com/users/carlosame","html_url":"https://github.com/carlosame","followers_url":"https://api.github.com/users/carlosame/followers","following_url":"https://api.github.com/users/carlosame/following{/other_user}","gists_url":"https://api.github.com/users/carlosame/gists{/gist_id}","starred_url":"https://api.github.com/users/carlosame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/carlosame/subscriptions","organizations_url":"https://api.github.com/users/carlosame/orgs","repos_url":"https://api.github.com/users/carlosame/repos","events_url":"https://api.github.com/users/carlosame/events{/privacy}","received_events_url":"https://api.github.com/users/carlosame/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":623963149,"node_id":"MDU6TGFiZWw2MjM5NjMxNDk=","url":"https://api.github.com/repos/jhy/jsoup/labels/fixed","name":"fixed","color":"7BE482","default":false,"description":"An {bug|improvement} that has been {fixed|implemented}"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/jhy/jsoup/milestones/37","html_url":"https://github.com/jhy/jsoup/milestone/37","labels_url":"https://api.github.com/repos/jhy/jsoup/milestones/37/labels","id":13135109,"node_id":"MI_kwDOAAbAPs4AyG0F","number":37,"title":"1.21.2","description":"https://jsoup.org/news/release-1.21.2","creator":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":13,"state":"closed","created_at":"2025-06-24T07:21:36Z","updated_at":"2025-08-25T01:20:05Z","due_on":"2025-08-25T07:00:00Z","closed_at":"2025-08-25T01:20:05Z"},"comments":3,"created_at":"2025-07-07T12:33:38Z","updated_at":"2025-07-08T12:37:07Z","closed_at":"2025-07-08T12:11:19Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I have a repository of benchmarks where some Java DOM implementations are compared (JDK DOM, DOM4J, CSS4J-DOM4J, CSS4J DOM and finally Jsoup). You can see the results here: https://css4j.github.io/dom-mark.html\n\nUntil 1.19.1 I could run the basic Jsoup element iterator benchmark that just counts children, but 1.20.1 and 1.21.1 both produce errors. This one is from 1.21.1:\n\n```shell\n$ java -Xmx3G -jar buildMaven/benchmarks.jar DOMIteratorSmallMark.markElementIteratorJsoup\n# JMH version: 1.37\n# VM version: JDK 21.0.7, OpenJDK 64-Bit Server VM, 21.0.7+6-LTS\n# VM invoker: [...]\\jdk-21.0.7.6-hotspot\\bin\\java.exe\n# VM options: -Xmx3G\n# Blackhole mode: compiler (auto-detected, use -Djmh.blackhole.autoDetect=false to disable)\n# Warmup: 6 iterations, 10 s each\n# Measurement: 16 iterations, 10 s each\n# Timeout: 10 min per iteration\n# Threads: 4 threads, will synchronize iterations\n# Benchmark mode: Throughput, ops/time\n# Benchmark: io.sf.carte.mark.dom.DOMIteratorSmallMark.markElementIteratorJsoup\n\n# Run progress: 0,00% complete, ETA 00:07:20\n# Fork: 1 of 2\n# Warmup Iteration   1: <failure>\n\njava.lang.ArrayIndexOutOfBoundsException: Index 3 out of bounds for length 3\n        at org.jsoup.nodes.Attributes.addObject(Attributes.java:147)\n        at org.jsoup.nodes.Attributes.userData(Attributes.java:179)\n        at org.jsoup.nodes.Element.cachedChildren(Element.java:407)\n        at org.jsoup.nodes.Element.childElementsList(Element.java:394)\n        at org.jsoup.nodes.Element.children(Element.java:385)\n        at io.sf.carte.mark.dom.DOMIteratorSmallMark.iterateJsoupElements(DOMIteratorSmallMark.java:157)\n        at io.sf.carte.mark.dom.DOMIteratorSmallMark.iterateJsoupElements(DOMIteratorSmallMark.java:157)\n        at io.sf.carte.mark.dom.DOMIteratorSmallMark.iterateJsoupElements(DOMIteratorSmallMark.java:157)\n        at io.sf.carte.mark.dom.DOMIteratorSmallMark.iterateJsoupElements(DOMIteratorSmallMark.java:157)\n        at io.sf.carte.mark.dom.DOMIteratorSmallMark.iterateJsoupElements(DOMIteratorSmallMark.java:157)\n        at io.sf.carte.mark.dom.DOMIteratorSmallMark.iterateJsoupElements(DOMIteratorSmallMark.java:157)\n        at io.sf.carte.mark.dom.DOMIteratorSmallMark.markElementIteratorJsoup(DOMIteratorSmallMark.java:146)\n        at io.sf.carte.mark.dom.jmh_generated.DOMIteratorSmallMark_markElementIteratorJsoup_jmhTest.markElementIteratorJsoup_Throughput(DOMIteratorSmallMark_markElementIteratorJsoup_jmhTest.java:80)\n        at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)\n        at java.base/java.lang.reflect.Method.invoke(Method.java:580)\n        at org.openjdk.jmh.runner.BenchmarkHandler$BenchmarkTask.call(BenchmarkHandler.java:527)\n        at org.openjdk.jmh.runner.BenchmarkHandler$BenchmarkTask.call(BenchmarkHandler.java:504)\n        at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)\n        at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)\n        at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n        at java.base/java.lang.Thread.run(Thread.java:1583)\n\njava.lang.ArrayIndexOutOfBoundsException: Index 3 out of bounds for length 3\n        at org.jsoup.nodes.Attributes.addObject(Attributes.java:147)\n        at org.jsoup.nodes.Attributes.userData(Attributes.java:179)\n        at org.jsoup.nodes.Element.cachedChildren(Element.java:407)\n        at org.jsoup.nodes.Element.childElementsList(Element.java:394)\n        at org.jsoup.nodes.Element.children(Element.java:385)\n        at io.sf.carte.mark.dom.DOMIteratorSmallMark.iterateJsoupElements(DOMIteratorSmallMark.java:157)\n        at io.sf.carte.mark.dom.DOMIteratorSmallMark.iterateJsoupElements(DOMIteratorSmallMark.java:157)\n        at io.sf.carte.mark.dom.DOMIteratorSmallMark.iterateJsoupElements(DOMIteratorSmallMark.java:157)\n        at io.sf.carte.mark.dom.DOMIteratorSmallMark.iterateJsoupElements(DOMIteratorSmallMark.java:157)\n        at io.sf.carte.mark.dom.DOMIteratorSmallMark.iterateJsoupElements(DOMIteratorSmallMark.java:157)\n        at io.sf.carte.mark.dom.DOMIteratorSmallMark.iterateJsoupElements(DOMIteratorSmallMark.java:157)\n        at io.sf.carte.mark.dom.DOMIteratorSmallMark.markElementIteratorJsoup(DOMIteratorSmallMark.java:146)\n        at io.sf.carte.mark.dom.jmh_generated.DOMIteratorSmallMark_markElementIteratorJsoup_jmhTest.markElementIteratorJsoup_thrpt_jmhStub(DOMIteratorSmallMark_markElementIteratorJsoup_jmhTest.java:147)\n        at io.sf.carte.mark.dom.jmh_generated.DOMIteratorSmallMark_markElementIteratorJsoup_jmhTest.markElementIteratorJsoup_Throughput(DOMIteratorSmallMark_markElementIteratorJsoup_jmhTest.java:86)\n        at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)\n        at java.base/java.lang.reflect.Method.invoke(Method.java:580)\n        at org.openjdk.jmh.runner.BenchmarkHandler$BenchmarkTask.call(BenchmarkHandler.java:527)\n        at org.openjdk.jmh.runner.BenchmarkHandler$BenchmarkTask.call(BenchmarkHandler.java:504)\n        at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)\n        at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)\n        at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n        at java.base/java.lang.Thread.run(Thread.java:1583)\n```\n\nThe code is somewhat simple, just count children: https://github.com/css4j/benchmark/blob/f02fe560c5baba4730379e4a1c203f0d75e9066e/src/io/sf/carte/mark/dom/DOMIteratorSmallMark.java\n\n## How to reproduce\n\nClone the benchmark repository:\n\n```shell\ngit clone https://github.com/css4j/benchmark.git\n```\nIn the repository copy, produce the jar files in any of the supported ways, for example to build with Maven you would modify the `pom.xml` file to bump the Jsoup version to 1.21.1:\n\nhttps://github.com/css4j/benchmark/blob/f02fe560c5baba4730379e4a1c203f0d75e9066e/pom.xml#L86-L90\n\nthen run\n```shell\nmvn\n```\nThen execute the Jsoup element iterator benchmark:\n```shell\njava -Xmx3G -jar buildMaven/benchmarks.jar DOMIteratorSmallMark.markElementIteratorJsoup\n```\n","closed_by":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/jhy/jsoup/issues/2366/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/jhy/jsoup/issues/2366/timeline","performed_via_github_app":null,"state_reason":"completed"}