{"url":"https://api.github.com/repos/jhy/jsoup/issues/552","repository_url":"https://api.github.com/repos/jhy/jsoup","labels_url":"https://api.github.com/repos/jhy/jsoup/issues/552/labels{/name}","comments_url":"https://api.github.com/repos/jhy/jsoup/issues/552/comments","events_url":"https://api.github.com/repos/jhy/jsoup/issues/552/events","html_url":"https://github.com/jhy/jsoup/issues/552","id":68141838,"node_id":"MDU6SXNzdWU2ODE0MTgzOA==","number":552,"title":"Unexpected elements inside table are moved to wrong location","user":{"login":"pfarrel","id":470152,"node_id":"MDQ6VXNlcjQ3MDE1Mg==","avatar_url":"https://avatars.githubusercontent.com/u/470152?v=4","gravatar_id":"","url":"https://api.github.com/users/pfarrel","html_url":"https://github.com/pfarrel","followers_url":"https://api.github.com/users/pfarrel/followers","following_url":"https://api.github.com/users/pfarrel/following{/other_user}","gists_url":"https://api.github.com/users/pfarrel/gists{/gist_id}","starred_url":"https://api.github.com/users/pfarrel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pfarrel/subscriptions","organizations_url":"https://api.github.com/users/pfarrel/orgs","repos_url":"https://api.github.com/users/pfarrel/repos","events_url":"https://api.github.com/users/pfarrel/events{/privacy}","received_events_url":"https://api.github.com/users/pfarrel/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-04-13T16:47:25Z","updated_at":"2015-07-05T22:03:09Z","closed_at":"2015-07-05T21:59:41Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"This commit https://github.com/jhy/jsoup/commit/e99193605b688e923d20054c13db897cff751607 introduced a bug where handling of unexpected elements inside a table element changed, resulting in the unexpected elements being pushed further up the document than before.\n\nI have constructed a minimal repro. Before the commit in question, the unexpected p tag would continue to be positioned after the comment (with some elements being closed early etc. to support this). After the commit, the p tag and its contents are moved up more than one table level, and now appear after the comment tag.\n\nObviously this input HTML is very broken and bad, but it seems that the change in behaviour was unintended. \n\ncopying @jaredstehler  \n\n```\n@Test\npublic void testInvalidTableContents() throws IOException {\n    File in = getFile(\"/htmltests/table-invalid-elements.html\");\n    Document doc = Jsoup.parse(in, \"UTF-8\");\n    doc.outputSettings().prettyPrint(true);\n    String rendered = doc.toString();\n    int endOfEmail = rendered.indexOf(\"Comment\");\n    int guarantee = rendered.indexOf(\"Why am I here?\");\n    assertTrue(\"Comment not found\", endOfEmail > -1);\n    assertTrue(\"Search text not found\", guarantee > -1);\n    assertTrue(\"Search text did not come after comment\", guarantee > endOfEmail);\n}\n```\n\nUses the following fixture:\n\n```\n<html>\n    <body>\n        <table>\n            <tr>\n                <td>\n                    <table>\n                        <tr>\n                            <!--Comment-->\n                            <table>\n                                <p>Why am I here?</p>\n                        </tr>\n                    </table>\n                </td>\n            </tr>\n        </table>\n    </body>\n</html>\n```\n","closed_by":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/jhy/jsoup/issues/552/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/jhy/jsoup/issues/552/timeline","performed_via_github_app":null,"state_reason":"completed"}