{"url":"https://api.github.com/repos/jhy/jsoup/issues/1098","repository_url":"https://api.github.com/repos/jhy/jsoup","labels_url":"https://api.github.com/repos/jhy/jsoup/issues/1098/labels{/name}","comments_url":"https://api.github.com/repos/jhy/jsoup/issues/1098/comments","events_url":"https://api.github.com/repos/jhy/jsoup/issues/1098/events","html_url":"https://github.com/jhy/jsoup/issues/1098","id":342028597,"node_id":"MDU6SXNzdWUzNDIwMjg1OTc=","number":1098,"title":"invalid XML file produced after org.jsoup.nodes.Document to org.w3c.dom.Document conversion","user":{"login":"dportabella","id":976546,"node_id":"MDQ6VXNlcjk3NjU0Ng==","avatar_url":"https://avatars.githubusercontent.com/u/976546?v=4","gravatar_id":"","url":"https://api.github.com/users/dportabella","html_url":"https://github.com/dportabella","followers_url":"https://api.github.com/users/dportabella/followers","following_url":"https://api.github.com/users/dportabella/following{/other_user}","gists_url":"https://api.github.com/users/dportabella/gists{/gist_id}","starred_url":"https://api.github.com/users/dportabella/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dportabella/subscriptions","organizations_url":"https://api.github.com/users/dportabella/orgs","repos_url":"https://api.github.com/users/dportabella/repos","events_url":"https://api.github.com/users/dportabella/events{/privacy}","received_events_url":"https://api.github.com/users/dportabella/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":22026,"node_id":"MDU6TGFiZWwyMjAyNg==","url":"https://api.github.com/repos/jhy/jsoup/labels/bug","name":"bug","color":"D13131","default":true,"description":"A confirmed bug, that we should fix"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/jhy/jsoup/milestones/16","html_url":"https://github.com/jhy/jsoup/milestone/16","labels_url":"https://api.github.com/repos/jhy/jsoup/milestones/16/labels","id":4306800,"node_id":"MDk6TWlsZXN0b25lNDMwNjgwMA==","number":16,"title":"1.12.2","description":"Changes in 1.22.2 - https://jsoup.org/news/release-1.12.2","creator":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":37,"state":"closed","created_at":"2019-05-13T02:02:11Z","updated_at":"2020-02-09T04:55:33Z","due_on":"2020-02-08T08:00:00Z","closed_at":"2020-02-09T04:55:00Z"},"comments":2,"created_at":"2018-07-17T18:13:51Z","updated_at":"2020-02-09T00:47:29Z","closed_at":"2020-02-02T23:49:11Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I have an XML `org.w3c.dom.Document`, coming from an HTML `org.jsoup.nodes.Document`.\r\n\r\nWhen I serialize the `org.w3c.dom.Document`, it produces an invalid XML file: it does not close the `META` tag.\r\n\r\nWhy? Is this a bug? from `jsoup`? from java `org.w3c.dom`?\r\n\r\n\r\nRelated bugs:\r\n\r\n- `W3CDom.fromJsoup fails when xmlns is defined`  https://github.com/jhy/jsoup/issues/1096\r\n- Should `org.jsoup.nodes.Document.toString()` produce a valid XML file?  https://github.com/jhy/jsoup/issues/1097\r\n\r\n\r\nExample code:\r\n\r\n    import org.jsoup.Jsoup;\r\n    import org.jsoup.helper.W3CDom;\r\n    import org.w3c.dom.Document;\r\n    \r\n    import javax.xml.parsers.DocumentBuilder;\r\n    import javax.xml.parsers.DocumentBuilderFactory;\r\n    import javax.xml.transform.OutputKeys;\r\n    import javax.xml.transform.Transformer;\r\n    import javax.xml.transform.TransformerException;\r\n    import javax.xml.transform.TransformerFactory;\r\n    import javax.xml.transform.dom.DOMSource;\r\n    import javax.xml.transform.stream.StreamResult;\r\n    import java.io.ByteArrayInputStream;\r\n    import java.io.StringWriter;\r\n    import java.nio.charset.StandardCharsets;\r\n    \r\n    public class Test130e {\r\n        public static void main(String[] args) throws Exception {\r\n            String html = \"<html><head><script async src=\\\"http://example.com/script.js\\\"></script></head></html>\";\r\n    \r\n            org.jsoup.nodes.Document jsoupDoc = Jsoup.parse(html); \r\n            System.out.println(\"+++ jsoupDoc.toString()\");\r\n            System.out.println(jsoupDoc.toString());\r\n    \r\n    \r\n            Document w3cDoc = new W3CDom().fromJsoup(jsoupDoc);\r\n            String xml = w3cDocToString(w3cDoc);\r\n\r\n            System.out.println(\"+++ xml\");\r\n            System.out.println(xml);\r\n    \r\n            // this previous xml file is invalid, and so it fails to parse it\r\n            // The element type \"META\" must be terminated by the matching end-tag \"</META>\".\r\n            Document w3cDoc2 = parseXml(xml);\r\n        }\r\n    \r\n        static Document parseXml(String content) throws Exception {\r\n            DocumentBuilder documentBuilder = DocumentBuilderFactory.newInstance().newDocumentBuilder();\r\n            return documentBuilder.parse(new ByteArrayInputStream(content.getBytes(StandardCharsets.UTF_8)));\r\n        }\r\n\r\n    private static String w3cDocToString(Document w3cDoc) throws TransformerException {\r\n        Transformer transformer = TransformerFactory.newInstance().newTransformer();\r\n        transformer.setOutputProperty(OutputKeys.INDENT, \"yes\");\r\n        transformer.setOutputProperty(\"{http://xml.apache.org/xslt}indent-amount\", \"2\");\r\n        StreamResult result = new StreamResult(new StringWriter());\r\n        DOMSource source = new DOMSource(w3cDoc);\r\n        transformer.transform(source, result);\r\n        return result.getWriter().toString();\r\n    }\r\n\r\n    }\r\n\r\nOutput:\r\n\r\n    +++ jsoupDoc.toString()\r\n    <html>\r\n     <head>\r\n      <script async src=\"http://example.com/script.js\"></script>\r\n     </head>\r\n     <body></body>\r\n    </html>\r\n\r\n    +++ xml\r\n    <html>\r\n    <head>\r\n    <META http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\r\n    <script async=\"\" src=\"http://example.com/script.js\"></script>\r\n    </head>\r\n    <body></body>\r\n    </html>\r\n    \r\n    [Fatal Error] :5:3: The element type \"META\" must be terminated by the matching end-tag \"</META>\".\r\n    Exception in thread \"main\" org.xml.sax.SAXParseException; lineNumber: 5; columnNumber: 3; The element type \"META\" must be terminated by the matching end-tag \"</META>\".\r\n    \tat org.apache.xerces.parsers.DOMParser.parse(Unknown Source)\r\n    \tat org.apache.xerces.jaxp.DocumentBuilderImpl.parse(Unknown Source)\r\n    \tat javax.xml.parsers.DocumentBuilder.parse(DocumentBuilder.java:121)\r\n    \tat playground.Test130e.parseXml(Test130.java:116)\r\n    \tat playground.Test130e.main(Test130.java:110)\r\n\r\n\r\nWhy does `w3cDocToString` build an invalid XML file (it does not close the `META` tag)?\r\n\r\nIs this a bug? from `jsoup`? from java `org.w3c.dom`?\r\n","closed_by":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/jhy/jsoup/issues/1098/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/jhy/jsoup/issues/1098/timeline","performed_via_github_app":null,"state_reason":"completed"}