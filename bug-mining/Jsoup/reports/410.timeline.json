[{"url":"https://api.github.com/repos/jhy/jsoup/issues/comments/2884796875","html_url":"https://github.com/jhy/jsoup/issues/2326#issuecomment-2884796875","issue_url":"https://api.github.com/repos/jhy/jsoup/issues/2326","id":2884796875,"node_id":"IC_kwDOAAbAPs6r8oHL","user":{"login":"justone","id":8082,"node_id":"MDQ6VXNlcjgwODI=","avatar_url":"https://avatars.githubusercontent.com/u/8082?v=4","gravatar_id":"","url":"https://api.github.com/users/justone","html_url":"https://github.com/justone","followers_url":"https://api.github.com/users/justone/followers","following_url":"https://api.github.com/users/justone/following{/other_user}","gists_url":"https://api.github.com/users/justone/gists{/gist_id}","starred_url":"https://api.github.com/users/justone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justone/subscriptions","organizations_url":"https://api.github.com/users/justone/orgs","repos_url":"https://api.github.com/users/justone/repos","events_url":"https://api.github.com/users/justone/events{/privacy}","received_events_url":"https://api.github.com/users/justone/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-05-15T19:00:31Z","updated_at":"2025-05-15T19:00:31Z","body":"I also noticed that if I use the following:\n\n```java\nString safeHtml = Jsoup.clean(unsafeHtml, Safelist.relaxed().addTags(\"iframe\"));\n```\n\nThe iframe tag is included and the script tag is escaped in 1.19.1:\n```html\n<blockquote>\n <p>Some content</p><iframe>Content inside iframe&lt;script&gt;alert('script between iframe, oh noes!');&lt;/script&gt;</iframe>\n</blockquote>\n```\n\nBut the 1.20.1, the script tag is not escaped:\n```html\n<blockquote>\n <p>Some content</p>\n <iframe>Content inside iframe<script>alert('script between iframe, oh noes!');</script></iframe>\n</blockquote>\n```\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/jhy/jsoup/issues/comments/2884796875/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"justone","id":8082,"node_id":"MDQ6VXNlcjgwODI=","avatar_url":"https://avatars.githubusercontent.com/u/8082?v=4","gravatar_id":"","url":"https://api.github.com/users/justone","html_url":"https://github.com/justone","followers_url":"https://api.github.com/users/justone/followers","following_url":"https://api.github.com/users/justone/following{/other_user}","gists_url":"https://api.github.com/users/justone/gists{/gist_id}","starred_url":"https://api.github.com/users/justone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justone/subscriptions","organizations_url":"https://api.github.com/users/justone/orgs","repos_url":"https://api.github.com/users/justone/repos","events_url":"https://api.github.com/users/justone/events{/privacy}","received_events_url":"https://api.github.com/users/justone/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":17682556158,"node_id":"CE_lADOAAbAPs620LhtzwAAAAQd9mT-","url":"https://api.github.com/repos/jhy/jsoup/issues/events/17682556158","actor":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"39f986b5b3672009ea7fde7647318472c8713e6f","commit_url":"https://api.github.com/repos/jhy/jsoup/commits/39f986b5b3672009ea7fde7647318472c8713e6f","created_at":"2025-05-16T04:48:52Z","state_reason":null,"performed_via_github_app":null},{"id":17682557301,"node_id":"LE_lADOAAbAPs620LhtzwAAAAQd9ml1","url":"https://api.github.com/repos/jhy/jsoup/issues/events/17682557301","actor":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2025-05-16T04:49:01Z","label":{"name":"improvement","color":"4bfa82"},"performed_via_github_app":null},{"id":17682557606,"node_id":"MIE_lADOAAbAPs620LhtzwAAAAQd9mqm","url":"https://api.github.com/repos/jhy/jsoup/issues/events/17682557606","actor":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2025-05-16T04:49:04Z","milestone":{"title":"1.21.1"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/jhy/jsoup/issues/comments/2885654591","html_url":"https://github.com/jhy/jsoup/issues/2326#issuecomment-2885654591","issue_url":"https://api.github.com/repos/jhy/jsoup/issues/2326","id":2885654591,"node_id":"IC_kwDOAAbAPs6r_5g_","user":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-05-16T05:13:18Z","updated_at":"2025-05-16T05:13:18Z","body":"Hi, thanks for the clear report.\n\nIn the revamped Printer & Tag implementations (the commit you linked), I fixed it such that any tag with Data content is inserted as a DataNode. That is,  \"iframe\", \"noembed\", \"noframes\", \"script\", \"style\", \"xmp\". Previously only \"script\" and \"style\" were inserted as DataNodes (vs TextNodes).\n\nThe intention is that these elements do not contain text that should appear in the `text()` methods, but rather actual data (in the case of script and style) or markup that should effectively be ignored by current parsers / UAs. Hence, we place them into DataNodes.\n\nThe Cleaner's behavior is to drop the contents of DataNodes if their tag is not allowed. (V.s. TextNodes which are retained, and always escaped.)\n\nSo, I believe that the current behavior demonstrated here is correct.\n\nFor the avoidance of doubt, the example where you add `iframe` to the safe-list is not an XSS. Browsers and jsoup both parse the contents as data, so the `<script>...` is just that textual data; not an element that could be parsed and executed.\n\nI have updated the HTML parser so that you can configure what text state known-tags like this are parsed as. So, you can now do something like this to get the old behavior if that's what's desired:\n\n```java\nString input = \"<iframe>content is <data></iframe>\";\n\nTagSet tags = TagSet.Html();\ntags.valueOf(\"iframe\", Parser.NamespaceHtml)\n    .clear(Tag.Data)\n    .set(Tag.RcData);\n\nDocument inDoc = Jsoup.parse(input, Parser.htmlParser().tagSet(tags));\nCleaner cleaner = new Cleaner(Safelist.relaxed());\nString cleaned = cleaner.clean(inDoc).body().html();\nassertEquals(\"content is &lt;data&gt;\", cleaned);\n```\n\nIn #2284 I have outlined plans to revamp the Cleaner. I think a nice option would be to make the action on finding a blocked tag configurable -- so you could Drop, Escape, etc if we can think of other options.\n\nCheers,\nJonathan\n\n","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/jhy/jsoup/issues/comments/2885654591/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":17682756446,"node_id":"REFE_lADOAAbAPs620LhtzwAAAAQd-XNe","url":"https://api.github.com/repos/jhy/jsoup/issues/events/17682756446","actor":{"login":"anonyein","id":48914448,"node_id":"MDQ6VXNlcjQ4OTE0NDQ4","avatar_url":"https://avatars.githubusercontent.com/u/48914448?v=4","gravatar_id":"","url":"https://api.github.com/users/anonyein","html_url":"https://github.com/anonyein","followers_url":"https://api.github.com/users/anonyein/followers","following_url":"https://api.github.com/users/anonyein/following{/other_user}","gists_url":"https://api.github.com/users/anonyein/gists{/gist_id}","starred_url":"https://api.github.com/users/anonyein/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anonyein/subscriptions","organizations_url":"https://api.github.com/users/anonyein/orgs","repos_url":"https://api.github.com/users/anonyein/repos","events_url":"https://api.github.com/users/anonyein/events{/privacy}","received_events_url":"https://api.github.com/users/anonyein/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"39f986b5b3672009ea7fde7647318472c8713e6f","commit_url":"https://api.github.com/repos/anonyein/jsoup/commits/39f986b5b3672009ea7fde7647318472c8713e6f","created_at":"2025-05-16T05:15:41Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/jhy/jsoup/issues/comments/2887223089","html_url":"https://github.com/jhy/jsoup/issues/2326#issuecomment-2887223089","issue_url":"https://api.github.com/repos/jhy/jsoup/issues/2326","id":2887223089,"node_id":"IC_kwDOAAbAPs6sF4cx","user":{"login":"justone","id":8082,"node_id":"MDQ6VXNlcjgwODI=","avatar_url":"https://avatars.githubusercontent.com/u/8082?v=4","gravatar_id":"","url":"https://api.github.com/users/justone","html_url":"https://github.com/justone","followers_url":"https://api.github.com/users/justone/followers","following_url":"https://api.github.com/users/justone/following{/other_user}","gists_url":"https://api.github.com/users/justone/gists{/gist_id}","starred_url":"https://api.github.com/users/justone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justone/subscriptions","organizations_url":"https://api.github.com/users/justone/orgs","repos_url":"https://api.github.com/users/justone/repos","events_url":"https://api.github.com/users/justone/events{/privacy}","received_events_url":"https://api.github.com/users/justone/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-05-16T16:47:05Z","updated_at":"2025-05-16T16:47:05Z","body":"Thank you for the thorough explanation and change to enable the older behavior. I tested it locally and can confirm that it works.\n\nThanks again.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/jhy/jsoup/issues/comments/2887223089/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"justone","id":8082,"node_id":"MDQ6VXNlcjgwODI=","avatar_url":"https://avatars.githubusercontent.com/u/8082?v=4","gravatar_id":"","url":"https://api.github.com/users/justone","html_url":"https://github.com/justone","followers_url":"https://api.github.com/users/justone/followers","following_url":"https://api.github.com/users/justone/following{/other_user}","gists_url":"https://api.github.com/users/justone/gists{/gist_id}","starred_url":"https://api.github.com/users/justone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justone/subscriptions","organizations_url":"https://api.github.com/users/justone/orgs","repos_url":"https://api.github.com/users/justone/repos","events_url":"https://api.github.com/users/justone/events{/privacy}","received_events_url":"https://api.github.com/users/justone/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":18465766425,"node_id":"REFE_lADOAAbAPs620LhtzwAAAARMpTwZ","url":"https://api.github.com/repos/jhy/jsoup/issues/events/18465766425","actor":{"login":"benkard","id":57626,"node_id":"MDQ6VXNlcjU3NjI2","avatar_url":"https://avatars.githubusercontent.com/u/57626?v=4","gravatar_id":"","url":"https://api.github.com/users/benkard","html_url":"https://github.com/benkard","followers_url":"https://api.github.com/users/benkard/followers","following_url":"https://api.github.com/users/benkard/following{/other_user}","gists_url":"https://api.github.com/users/benkard/gists{/gist_id}","starred_url":"https://api.github.com/users/benkard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benkard/subscriptions","organizations_url":"https://api.github.com/users/benkard/orgs","repos_url":"https://api.github.com/users/benkard/repos","events_url":"https://api.github.com/users/benkard/events{/privacy}","received_events_url":"https://api.github.com/users/benkard/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"4680b8c94de43569321b29b12deae5a5caf83d49","commit_url":"https://api.github.com/repos/benkard/mulkcms2/commits/4680b8c94de43569321b29b12deae5a5caf83d49","created_at":"2025-07-04T07:01:15Z","performed_via_github_app":null}]