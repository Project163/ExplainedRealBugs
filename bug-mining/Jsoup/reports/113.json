{"url":"https://api.github.com/repos/jhy/jsoup/issues/518","repository_url":"https://api.github.com/repos/jhy/jsoup","labels_url":"https://api.github.com/repos/jhy/jsoup/issues/518/labels{/name}","comments_url":"https://api.github.com/repos/jhy/jsoup/issues/518/comments","events_url":"https://api.github.com/repos/jhy/jsoup/issues/518/events","html_url":"https://github.com/jhy/jsoup/issues/518","id":53317668,"node_id":"MDU6SXNzdWU1MzMxNzY2OA==","number":518,"title":"Selector.select(String query, Iterable<Elements> roots) performance regression","user":{"login":"kzn","id":55851,"node_id":"MDQ6VXNlcjU1ODUx","avatar_url":"https://avatars.githubusercontent.com/u/55851?v=4","gravatar_id":"","url":"https://api.github.com/users/kzn","html_url":"https://github.com/kzn","followers_url":"https://api.github.com/users/kzn/followers","following_url":"https://api.github.com/users/kzn/following{/other_user}","gists_url":"https://api.github.com/users/kzn/gists{/gist_id}","starred_url":"https://api.github.com/users/kzn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kzn/subscriptions","organizations_url":"https://api.github.com/users/kzn/orgs","repos_url":"https://api.github.com/users/kzn/repos","events_url":"https://api.github.com/users/kzn/events{/privacy}","received_events_url":"https://api.github.com/users/kzn/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-01-03T22:40:17Z","updated_at":"2015-03-30T06:04:16Z","closed_at":"2015-03-30T06:04:10Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hello!\n\nThere is a performance regression from selecting elements from multiple roots.\nIt is caused by reparsing of the query string for every root. Which leads to signifiant performance degradation you try to query large number of roots.\n\nThe diff is:\n\n<pre>\n--- a/src/main/java/org/jsoup/select/Selector.java\n+++ b/src/main/java/org/jsoup/select/Selector.java\n@@ -119,10 +119,11 @@ public class Selector {\n     public static Elements select(String query, Iterable<Element> roots) {\n         Validate.notEmpty(query);\n         Validate.notNull(roots);\n+        Evaluator evaluator = QueryParser.parse(query);\n         LinkedHashSet<Element> elements = new LinkedHashSet<Element>();\n \n         for (Element root : roots) {\n-            elements.addAll(select(query, root));\n+            elements.addAll(select(evaluator, root));\n         }\n         return new Elements(elements);\n     }\n</pre>\n","closed_by":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/jhy/jsoup/issues/518/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/jhy/jsoup/issues/518/timeline","performed_via_github_app":null,"state_reason":"completed"}