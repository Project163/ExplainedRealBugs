[{"url":"https://api.github.com/repos/jhy/jsoup/issues/comments/2773853917","html_url":"https://github.com/jhy/jsoup/issues/2295#issuecomment-2773853917","issue_url":"https://api.github.com/repos/jhy/jsoup/issues/2295","id":2773853917,"node_id":"IC_kwDOAAbAPs6lVabd","user":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-04-02T22:16:39Z","updated_at":"2025-04-02T22:22:21Z","body":"Hi there,\n\nThe primary issue in that report is that the user effectively has two iterators, the `forEach` and the `element.toString()`, which will output the element plus all it's children, leading to seeming duplicates. As the answer from Jarez notes.\n\nBut there an issue seen in this example:\n\n```java\nString html = \"<html><head><title>Stream</title></head><body><a href=foo>Link</a></body></html>\";\n\nStreamParser streamParser = new StreamParser(Parser.htmlParser());\nStreamParser parse = streamParser.parse(html, \"\");\nparse.stream().forEach(el -> {\n  System.out.println(String.format(\n    \"El: <%s>; attributes: %s; ownText: %s\", el.tagName(), el.attributes(), el.ownText()));\n});\n```\n\nWe get:\n\n```text\nEl: <title>; attributes: ; ownText: Stream\nEl: <head>; attributes: ; ownText: \nEl: <a>; attributes:  href=\"foo\"; ownText: Link\nEl: <body>; attributes: ; ownText: \nEl: <a>; attributes:  href=\"foo\"; ownText: Link\nEl: <body>; attributes: ; ownText: \nEl: <html>; attributes: ; ownText: \nEl: <#root>; attributes: ; ownText: \n```\n\nThe `a` and the `body` are emitted twice. I guess that we are calling `onNodeRemoved` twice, once when it is actually closed, and once when the document is complete and we pop all the nodes off the final stack. It doesn't happen with the XML parser, only the HTML parser. (The latter keeps the `body` and `html` on the stack even when closed so any content following that can still be added to the body. Will look to suppress emitting those pops).\n\nXML parser version:\n\n```text\nEl: <title>; attributes: ; ownText: Stream\nEl: <head>; attributes: ; ownText: \nEl: <a>; attributes:  href=\"foo\"; ownText: Link\nEl: <body>; attributes: ; ownText: \nEl: <html>; attributes: ; ownText: \nEl: <#root>; attributes: ; ownText: \n```\n\n(If the HTML doesn't have the explicit close tags and just implicitly closes, we only see the emits once, correctly.)","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/jhy/jsoup/issues/comments/2773853917/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":17102398555,"node_id":"AE_lADOAAbAPs6w2PhNzwAAAAP7YeRb","url":"https://api.github.com/repos/jhy/jsoup/issues/events/17102398555","actor":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2025-04-02T23:42:06Z","assignee":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":17102398834,"node_id":"MIE_lADOAAbAPs6w2PhNzwAAAAP7YeVy","url":"https://api.github.com/repos/jhy/jsoup/issues/events/17102398834","actor":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2025-04-02T23:42:10Z","milestone":{"title":"1.20.1"},"performed_via_github_app":null},{"id":17102399833,"node_id":"LE_lADOAAbAPs6w2PhNzwAAAAP7YelZ","url":"https://api.github.com/repos/jhy/jsoup/issues/events/17102399833","actor":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2025-04-02T23:42:20Z","label":{"name":"bug","color":"D13131"},"performed_via_github_app":null},{"id":17102399853,"node_id":"LE_lADOAAbAPs6w2PhNzwAAAAP7Yelt","url":"https://api.github.com/repos/jhy/jsoup/issues/events/17102399853","actor":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2025-04-02T23:42:20Z","label":{"name":"fixed","color":"7BE482"},"performed_via_github_app":null},{"id":17102475984,"node_id":"CE_lADOAAbAPs6w2PhNzwAAAAP7YxLQ","url":"https://api.github.com/repos/jhy/jsoup/issues/events/17102475984","actor":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"df347747385e6d30d2899262125cd20a08bfa9e6","commit_url":"https://api.github.com/repos/jhy/jsoup/commits/df347747385e6d30d2899262125cd20a08bfa9e6","created_at":"2025-04-02T23:50:00Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/jhy/jsoup/issues/comments/2773990068","html_url":"https://github.com/jhy/jsoup/issues/2295#issuecomment-2773990068","issue_url":"https://api.github.com/repos/jhy/jsoup/issues/2295","id":2773990068,"node_id":"IC_kwDOAAbAPs6lV7q0","user":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-04-02T23:51:05Z","updated_at":"2025-04-02T23:52:35Z","body":"Thanks, fixed!\n\nThe sample code above now correctly produces:\n\n```text\nEl: <title>; attributes: ; ownText: Stream\nEl: <head>; attributes: ; ownText: \nEl: <a>; attributes:  href=\"foo\"; ownText: Link\nEl: <body>; attributes: ; ownText: \nEl: <html>; attributes: ; ownText: \nEl: <#root>; attributes: ; ownText: \n```","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/jhy/jsoup/issues/comments/2773990068/reactions","total_count":2,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":2,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":17102510392,"node_id":"RTE_lADOAAbAPs6w2PhNzwAAAAP7Y5k4","url":"https://api.github.com/repos/jhy/jsoup/issues/events/17102510392","actor":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2025-04-02T23:54:03Z","rename":{"from":"Duplicate attributes and elements when parsing using stream() with Jsoup 1.19.1","to":"StreamParser on HtmlParser may emit the final elements twice, if explicitly closed"},"performed_via_github_app":null},{"id":17102560959,"node_id":"REFE_lADOAAbAPs6w2PhNzwAAAAP7ZF6_","url":"https://api.github.com/repos/jhy/jsoup/issues/events/17102560959","actor":{"login":"pull[bot]","id":39814207,"node_id":"MDM6Qm90Mzk4MTQyMDc=","avatar_url":"https://avatars.githubusercontent.com/in/12910?v=4","gravatar_id":"","url":"https://api.github.com/users/pull%5Bbot%5D","html_url":"https://github.com/apps/pull","followers_url":"https://api.github.com/users/pull%5Bbot%5D/followers","following_url":"https://api.github.com/users/pull%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/pull%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/pull%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pull%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/pull%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/pull%5Bbot%5D/repos","events_url":"https://api.github.com/users/pull%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/pull%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"df347747385e6d30d2899262125cd20a08bfa9e6","commit_url":"https://api.github.com/repos/makesoftwaresafe/jsoup/commits/df347747385e6d30d2899262125cd20a08bfa9e6","created_at":"2025-04-03T00:00:13Z","performed_via_github_app":null},{"id":18465766626,"node_id":"REFE_lADOAAbAPs6w2PhNzwAAAARMpTzi","url":"https://api.github.com/repos/jhy/jsoup/issues/events/18465766626","actor":{"login":"benkard","id":57626,"node_id":"MDQ6VXNlcjU3NjI2","avatar_url":"https://avatars.githubusercontent.com/u/57626?v=4","gravatar_id":"","url":"https://api.github.com/users/benkard","html_url":"https://github.com/benkard","followers_url":"https://api.github.com/users/benkard/followers","following_url":"https://api.github.com/users/benkard/following{/other_user}","gists_url":"https://api.github.com/users/benkard/gists{/gist_id}","starred_url":"https://api.github.com/users/benkard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benkard/subscriptions","organizations_url":"https://api.github.com/users/benkard/orgs","repos_url":"https://api.github.com/users/benkard/repos","events_url":"https://api.github.com/users/benkard/events{/privacy}","received_events_url":"https://api.github.com/users/benkard/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"4680b8c94de43569321b29b12deae5a5caf83d49","commit_url":"https://api.github.com/repos/benkard/mulkcms2/commits/4680b8c94de43569321b29b12deae5a5caf83d49","created_at":"2025-07-04T07:01:16Z","performed_via_github_app":null}]