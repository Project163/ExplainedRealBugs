{"url":"https://api.github.com/repos/jhy/jsoup/issues/1496","repository_url":"https://api.github.com/repos/jhy/jsoup","labels_url":"https://api.github.com/repos/jhy/jsoup/issues/1496/labels{/name}","comments_url":"https://api.github.com/repos/jhy/jsoup/issues/1496/comments","events_url":"https://api.github.com/repos/jhy/jsoup/issues/1496/events","html_url":"https://github.com/jhy/jsoup/issues/1496","id":815397929,"node_id":"MDU6SXNzdWU4MTUzOTc5Mjk=","number":1496,"title":"Unicode breaks xml serialization","user":{"login":"lambdaupb","id":1890613,"node_id":"MDQ6VXNlcjE4OTA2MTM=","avatar_url":"https://avatars.githubusercontent.com/u/1890613?v=4","gravatar_id":"","url":"https://api.github.com/users/lambdaupb","html_url":"https://github.com/lambdaupb","followers_url":"https://api.github.com/users/lambdaupb/followers","following_url":"https://api.github.com/users/lambdaupb/following{/other_user}","gists_url":"https://api.github.com/users/lambdaupb/gists{/gist_id}","starred_url":"https://api.github.com/users/lambdaupb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lambdaupb/subscriptions","organizations_url":"https://api.github.com/users/lambdaupb/orgs","repos_url":"https://api.github.com/users/lambdaupb/repos","events_url":"https://api.github.com/users/lambdaupb/events{/privacy}","received_events_url":"https://api.github.com/users/lambdaupb/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-02-24T11:40:39Z","updated_at":"2025-03-10T04:41:53Z","closed_at":"2025-03-10T04:41:53Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The parsed html is clearly weird and broken, but my assumption is that the output, after re-serializing it, should be valid.\r\n\r\n * There are unicode characters in tag names, which does not agree with `document.outputSettings().charset(\"ASCII\");` \r\n\r\nVersion: 1.13.1\r\n\r\n```java\r\n\r\nimport org.jsoup.Jsoup;\r\nimport org.jsoup.nodes.Document;\r\nimport org.jsoup.nodes.Entities;\r\nimport org.xml.sax.InputSource;\r\nimport org.xml.sax.SAXException;\r\nimport org.xml.sax.SAXParseException;\r\nimport org.xml.sax.helpers.DefaultHandler;\r\n\r\nimport javax.xml.parsers.ParserConfigurationException;\r\nimport javax.xml.parsers.SAXParser;\r\nimport javax.xml.parsers.SAXParserFactory;\r\nimport java.io.IOException;\r\nimport java.io.StringReader;\r\n\r\npublic class Test2 {\r\n    public static void main(String[] args) throws ParserConfigurationException, SAXException, IOException {\r\n        Document document = Jsoup.parse(\"  <div id=\\\"emid\\\"> <p\\u226F\\u0322\\u0329\\u032B\\u0320\\u0309\\u030A\\u0366\\u0364\\u036D\\u030A..\\u0337\\u0359\\u036F\\u030A\\u033D\\u0313\\u0346\\u0309\\u036B.\\u0347\\u032A\\u0367\\u0305\\u0301>\\n    &lt; p=\\\"\\\"&gt; \\n   </p\\u226F\\u0322\\u0329\\u032B\\u0320\\u0309\\u030A\\u0366\\u0364\\u036D\\u030A..\\u0337\\u0359\\u036F\\u030A\\u033D\\u0313\\u0346\\u0309\\u036B.\\u0347\\u032A\\u0367\\u0305\\u0301>&lt;&gt; \\n  </div> \");\r\n        document.outputSettings().syntax(Document.OutputSettings.Syntax.xml);\r\n        document.outputSettings().escapeMode(Entities.EscapeMode.xhtml);\r\n        document.outputSettings().prettyPrint(true);\r\n        document.outputSettings().charset(\"ASCII\");\r\n        String html = document.html();\r\n\r\n        System.out.println(html);\r\n\r\n        SAXParserFactory factory = SAXParserFactory.newInstance();\r\n        SAXParser saxParser = factory.newSAXParser();\r\n\r\n        saxParser.parse(new InputSource(new StringReader(html)), new DefaultHandler() {\r\n            @Override\r\n            public void warning(SAXParseException e) throws SAXException {\r\n                e.printStackTrace();\r\n            }\r\n\r\n            @Override\r\n            public void error(SAXParseException e) throws SAXException {\r\n                e.printStackTrace();\r\n            }\r\n\r\n            @Override\r\n            public void fatalError(SAXParseException e) throws SAXException {\r\n                e.printStackTrace();\r\n            }\r\n        });\r\n\r\n    }\r\n}\r\n```\r\n\r\noutput:\r\n```\r\n<html>\r\n <head></head>\r\n <body>\r\n  <div id=\"emid\"> <p≯...>\r\n     &lt; p=\"\"&gt; \r\n   </p≯...>&lt;&gt; \r\n  </div> \r\n </body>\r\n</html>\r\norg.xml.sax.SAXParseException; lineNumber: 4; columnNumber: 21; Element type \"p\" must be followed by either attribute specifications, \">\" or \"/>\".\r\n\tat org.apache.xerces.util.ErrorHandlerWrapper.createSAXParseException(Unknown Source)\r\n\tat org.apache.xerces.util.ErrorHandlerWrapper.fatalError(Unknown Source)\r\n\tat org.apache.xerces.impl.XMLErrorReporter.reportError(Unknown Source)\r\n\tat org.apache.xerces.impl.XMLErrorReporter.reportError(Unknown Source)\r\n\tat org.apache.xerces.impl.XMLErrorReporter.reportError(Unknown Source)\r\n\tat org.apache.xerces.impl.XMLScanner.reportFatalError(Unknown Source)\r\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanStartElement(Unknown Source)\r\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown Source)\r\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)\r\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\r\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\r\n\tat org.apache.xerces.parsers.XMLParser.parse(Unknown Source)\r\n\tat org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)\r\n\tat org.apache.xerces.jaxp.SAXParserImpl$JAXPSAXParser.parse(Unknown Source)\r\n\tat org.apache.xerces.jaxp.SAXParserImpl.parse(Unknown Source)\r\n\tat Test2.main(Test2.java:31)\r\nException in thread \"main\" org.xml.sax.SAXParseException; lineNumber: 4; columnNumber: 21; Element type \"p\" must be followed by either attribute specifications, \">\" or \"/>\".\r\n\tat org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)\r\n\tat org.apache.xerces.jaxp.SAXParserImpl$JAXPSAXParser.parse(Unknown Source)\r\n\tat org.apache.xerces.jaxp.SAXParserImpl.parse(Unknown Source)\r\n\tat Test2.main(Test2.java:31)\r\n\r\nProcess finished with exit code 1\r\n```","closed_by":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/jhy/jsoup/issues/1496/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/jhy/jsoup/issues/1496/timeline","performed_via_github_app":null,"state_reason":"completed"}