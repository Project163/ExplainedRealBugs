{"url":"https://api.github.com/repos/jhy/jsoup/issues/1281","repository_url":"https://api.github.com/repos/jhy/jsoup","labels_url":"https://api.github.com/repos/jhy/jsoup/issues/1281/labels{/name}","comments_url":"https://api.github.com/repos/jhy/jsoup/issues/1281/comments","events_url":"https://api.github.com/repos/jhy/jsoup/issues/1281/events","html_url":"https://github.com/jhy/jsoup/issues/1281","id":530889602,"node_id":"MDU6SXNzdWU1MzA4ODk2MDI=","number":1281,"title":"Performance problem about reindexChildren with replace parentNode","user":{"login":"gjchoi","id":17265090,"node_id":"MDQ6VXNlcjE3MjY1MDkw","avatar_url":"https://avatars.githubusercontent.com/u/17265090?v=4","gravatar_id":"","url":"https://api.github.com/users/gjchoi","html_url":"https://github.com/gjchoi","followers_url":"https://api.github.com/users/gjchoi/followers","following_url":"https://api.github.com/users/gjchoi/following{/other_user}","gists_url":"https://api.github.com/users/gjchoi/gists{/gist_id}","starred_url":"https://api.github.com/users/gjchoi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gjchoi/subscriptions","organizations_url":"https://api.github.com/users/gjchoi/orgs","repos_url":"https://api.github.com/users/gjchoi/repos","events_url":"https://api.github.com/users/gjchoi/events{/privacy}","received_events_url":"https://api.github.com/users/gjchoi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":23217,"node_id":"MDU6TGFiZWwyMzIxNw==","url":"https://api.github.com/repos/jhy/jsoup/labels/improvement","name":"improvement","color":"4bfa82","default":false,"description":"An improvement / new feature idea"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/jhy/jsoup/milestones/16","html_url":"https://github.com/jhy/jsoup/milestone/16","labels_url":"https://api.github.com/repos/jhy/jsoup/milestones/16/labels","id":4306800,"node_id":"MDk6TWlsZXN0b25lNDMwNjgwMA==","number":16,"title":"1.12.2","description":"Changes in 1.22.2 - https://jsoup.org/news/release-1.12.2","creator":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":37,"state":"closed","created_at":"2019-05-13T02:02:11Z","updated_at":"2020-02-09T04:55:33Z","due_on":"2020-02-08T08:00:00Z","closed_at":"2020-02-09T04:55:00Z"},"comments":7,"created_at":"2019-12-02T04:56:14Z","updated_at":"2020-02-10T04:22:56Z","closed_at":"2020-02-02T02:44:36Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hello, \r\nmy application suffers from poor performance in case of over 10Mbyte html data..\r\n\r\nIn my case,\r\nI take a parsed HTML document from jsoup parser, and replace element with wrapperElement class ( custom class RichElement ) to add more custom data with element attributes.\r\n\r\nThis call the method addChildren at Element.class,\r\nwith over 100,000 parsed elements, \r\nbut this is very slow...\r\n\r\nbecause addChildren call reparentChild ( => setParentNode) 100,000 times,\r\neach setParentNode occures u​nnecessary reindexing for sibling children about 1/2 * 100,000 times in this case;;\r\n\r\nDo you hava any idea,\r\nonly replace parent keep children without u​nnecessary reindexing?\r\n\r\nor\r\n\r\nCould you add some method like below?\r\n\r\nElement.class\r\n~~~\r\n    protected Element replaceParent(List<Node> children) {\r\n\r\n        ArrayList<Node> nodes = new ArrayList<>(children);\r\n        Node[] nodeArray = nodes.toArray(new Node[nodes.size()]);\r\n        replaceChildrenWithoutReindex(nodeArray);\r\n        return this;\r\n    }\r\n~~~\r\n\r\nNode.class\r\n~~~\r\n    protected void replaceChildrenWithoutReindex(Node... children) {\r\n        Validate.isTrue(this.childNodeSize() == 0, \"replaceChildrenWithoutReindex valid with new parent (no child)\");\r\n\r\n\r\n        List<Node> nodes = this.ensureChildNodes();\r\n        Node[] var3 = children;\r\n        int var4 = children.length;\r\n\r\n        for(int var5 = 0; var5 < var4; ++var5) {\r\n            Node child = var3[var5];\r\n            //this.reparentChild(child); \r\n            child.parentNode = this;       //without reindex, reparent parent keep sibling indexes;\r\n            nodes.add(child);\r\n            child.setSiblingIndex(nodes.size() - 1);\r\n        }\r\n    }\r\n~~~\r\n","closed_by":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/jhy/jsoup/issues/1281/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/jhy/jsoup/issues/1281/timeline","performed_via_github_app":null,"state_reason":"completed"}