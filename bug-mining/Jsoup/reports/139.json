{"url":"https://api.github.com/repos/jhy/jsoup/issues/906","repository_url":"https://api.github.com/repos/jhy/jsoup","labels_url":"https://api.github.com/repos/jhy/jsoup/issues/906/labels{/name}","comments_url":"https://api.github.com/repos/jhy/jsoup/issues/906/comments","events_url":"https://api.github.com/repos/jhy/jsoup/issues/906/events","html_url":"https://github.com/jhy/jsoup/issues/906","id":238724612,"node_id":"MDU6SXNzdWUyMzg3MjQ2MTI=","number":906,"title":"Incorrect handling of self-closing tags noframes, style and title cause remainder of document to be html-escaped","user":{"login":"hannibal218bc","id":2797744,"node_id":"MDQ6VXNlcjI3OTc3NDQ=","avatar_url":"https://avatars.githubusercontent.com/u/2797744?v=4","gravatar_id":"","url":"https://api.github.com/users/hannibal218bc","html_url":"https://github.com/hannibal218bc","followers_url":"https://api.github.com/users/hannibal218bc/followers","following_url":"https://api.github.com/users/hannibal218bc/following{/other_user}","gists_url":"https://api.github.com/users/hannibal218bc/gists{/gist_id}","starred_url":"https://api.github.com/users/hannibal218bc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hannibal218bc/subscriptions","organizations_url":"https://api.github.com/users/hannibal218bc/orgs","repos_url":"https://api.github.com/users/hannibal218bc/repos","events_url":"https://api.github.com/users/hannibal218bc/events{/privacy}","received_events_url":"https://api.github.com/users/hannibal218bc/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":22026,"node_id":"MDU6TGFiZWwyMjAyNg==","url":"https://api.github.com/repos/jhy/jsoup/labels/bug","name":"bug","color":"D13131","default":true,"description":"A confirmed bug, that we should fix"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/jhy/jsoup/milestones/12","html_url":"https://github.com/jhy/jsoup/milestone/12","labels_url":"https://api.github.com/repos/jhy/jsoup/milestones/12/labels","id":2576111,"node_id":"MDk6TWlsZXN0b25lMjU3NjExMQ==","number":12,"title":"1.11.1","description":"Next feature release","creator":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":21,"state":"closed","created_at":"2017-06-11T16:32:52Z","updated_at":"2017-11-13T20:49:55Z","due_on":null,"closed_at":"2017-11-13T20:49:55Z"},"comments":1,"created_at":"2017-06-27T02:59:41Z","updated_at":"2017-06-29T22:24:36Z","closed_at":"2017-06-29T22:24:19Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Given the input:\r\n\r\n```html\r\n<html>\r\n<head>\r\n\t<style />   <!-- < - - this is the culprit -->\r\n</head>\r\n<body>\r\n\t<p>Whatever</p>\r\n</body>\r\n</html>\r\n```\r\n\r\nJSoup 1.8.2 and also http://try.jsoup.org/~lJwWpjXYUSTBeBZhdEnS3Mt56g4 will produce:\r\n```html\r\n    <html>\r\n     <head> \r\n      <style></style>\r\n     </head>\r\n     <body>\r\n       &lt;/head&gt; &lt;body&gt; &lt;p&gt;Whatever&lt;/p&gt; &lt;/body&gt; &lt;/html&gt;\r\n     </body>\r\n    </html>\r\n```\r\n\r\nWith `<title/>` instead of `<style/>`, the result is different but still wrong (http://try.jsoup.org/~BZ3uoMki-r904fZxUOWJgLJO7r8 ):\r\n```html\r\n<html>\r\n <head> \r\n  <title></title>\r\n </head>\r\n <body>\r\n   &lt;/head&gt;  \r\n  <p>Whatever</p>  \r\n </body>\r\n</html>\r\n```\r\n\r\nThat weirdness was fixed for `<script>` with Issue #305: http://try.jsoup.org/~3Ms6TQCrrdaA_uPgxgURYYvwFAg\r\n```html\r\n<html>\r\n <head> \r\n  <script></script> \r\n </head> \r\n <body> \r\n  <p>Whatever</p>  \r\n </body>\r\n</html>\r\n```\r\n\r\nLooking [at the source](https://github.com/jhy/jsoup/blob/master/src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java#L106), it seems only the HtmlTreeBuilderState handling for `<noframes>`, `<style>` and `<title>` in the methods `handleRawText` and `handleRcData` doesn't get along with the self-closing tags.\r\nAny other tagname I've checked (and I tried to cover all branches of that `case StartTag` switch) results in a good parse similar to the `<script>` case, which is what I'd expect.\r\n\r\nThanks for looking into this!\r\n","closed_by":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/jhy/jsoup/issues/906/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/jhy/jsoup/issues/906/timeline","performed_via_github_app":null,"state_reason":"completed"}