{"url":"https://api.github.com/repos/jhy/jsoup/issues/1026","repository_url":"https://api.github.com/repos/jhy/jsoup","labels_url":"https://api.github.com/repos/jhy/jsoup/issues/1026/labels{/name}","comments_url":"https://api.github.com/repos/jhy/jsoup/issues/1026/comments","events_url":"https://api.github.com/repos/jhy/jsoup/issues/1026/events","html_url":"https://github.com/jhy/jsoup/issues/1026","id":301279896,"node_id":"MDU6SXNzdWUzMDEyNzk4OTY=","number":1026,"title":"Inconsistency: Attributes.html() output differs from Attribute.html() output","user":{"login":"cketti","id":218061,"node_id":"MDQ6VXNlcjIxODA2MQ==","avatar_url":"https://avatars.githubusercontent.com/u/218061?v=4","gravatar_id":"","url":"https://api.github.com/users/cketti","html_url":"https://github.com/cketti","followers_url":"https://api.github.com/users/cketti/followers","following_url":"https://api.github.com/users/cketti/following{/other_user}","gists_url":"https://api.github.com/users/cketti/gists{/gist_id}","starred_url":"https://api.github.com/users/cketti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cketti/subscriptions","organizations_url":"https://api.github.com/users/cketti/orgs","repos_url":"https://api.github.com/users/cketti/repos","events_url":"https://api.github.com/users/cketti/events{/privacy}","received_events_url":"https://api.github.com/users/cketti/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-03-01T05:12:49Z","updated_at":"2021-08-12T08:56:58Z","closed_at":"2021-08-12T08:55:48Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The output of `Attributes.html()` (used when serializing a `Document`) and `Attribute.html()` differs when certain conditions are met. This is because the formatting logic exists twice with subtle differences.\r\n\r\n**Issue 1**:\r\n```java\r\nAttributes attributes = new Attributes();\r\nattributes.put(\"key\", null);\r\nAttribute attribute = attributes.iterator().next();\r\n\r\nassertEquals(\"key=\\\"\\\"\", attribute.html());\r\nassertEquals(\" key=\\\"\\\"\", attributes.html());  // fails; output is ' key' (like it was a boolean attribute)\r\n```\r\n\r\nThe code in `Attribute` suggests that everything but the known boolean attributes should be displayed like `key=\"\"` if the value is `null`, empty, or equal to the key. Due to a misplaced closing parenthesis in `Attributes.html(Appendable, OutputSettings)` a quoted empty attribute value is never appended.\r\n\r\n\r\n**Issue 2:**\r\n```java\r\nAttributes attributes = new Attributes();\r\nattributes.put(\"checked\", \"\");\r\nAttribute attribute = attributes.iterator().next();\r\n\r\nassertEquals(\"checked\", attribute.html());\r\nassertEquals(\" checked\", attributes.html());  // fails; output is ' checked=\"\"'\r\n```\r\n\r\n`Attribute.html()` treats a zero-length `String` like `null` and only outputs the attribute key. `Attributes.html()` is missing that check.\r\n\r\n\r\n**Issue 3:**\r\n```java\r\nAttributes attributes = new Attributes();\r\nattributes.put(\"checked\", \"CHECKED\");\r\nAttribute attribute = attributes.iterator().next();\r\n\r\nassertEquals(\"checked\", attribute.html());\r\nassertEquals(\" checked\", attributes.html());  // fails; output is ' checked=\"CHECKED\"'\r\n```\r\n\r\n`Attribute.html()` uses a case-insensitive comparison when comparing the attribute key to its value. `Attributes.html()` uses a case-sensitive comparison.\r\n\r\n\r\n@jhy: I'd be happy to create a pull request to fix the issues. But I'd like your opinion on what the future behavior should be. My guess is that by now many people depend on arbitrary attributes without value being treated like a boolean attribute in the output. So using the list of known boolean attributes to format unknown attributes might not be the best idea. However, we could use it to make sure jsoup never outputs an explicit value for the attributes in that list.","closed_by":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/jhy/jsoup/issues/1026/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/jhy/jsoup/issues/1026/timeline","performed_via_github_app":null,"state_reason":"completed"}