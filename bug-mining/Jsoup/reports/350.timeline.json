[{"id":10923687398,"node_id":"RTE_lADOAAbAPs52dJO2zwAAAAKLGj3m","url":"https://api.github.com/repos/jhy/jsoup/issues/events/10923687398","actor":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2023-11-10T10:48:33Z","rename":{"from":"provide a way to specify a blacklist of protocols","to":"provide a way to specify a blocklist of protocols"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/jhy/jsoup/issues/comments/1805502990","html_url":"https://github.com/jhy/jsoup/issues/2047#issuecomment-1805502990","issue_url":"https://api.github.com/repos/jhy/jsoup/issues/2047","id":1805502990,"node_id":"IC_kwDOAAbAPs5rncoO","user":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-11-10T10:53:29Z","updated_at":"2023-11-10T10:53:29Z","body":"What protocols do you want to support additionally than HTTP and HTTPS? Gopher?\r\n\r\nMy fundamental concern with blocklists is that it is very easy to forget something -- or the world changes and introduces something -- that will then cause unexpected results. That's why IMO the Cleaner Safelist implementation has proven largely resilient to XSS over time. Only allowing known safe content.\r\n\r\nWhat is the motivating use case here? Are there that many protocols that people are actually using that it is a real chore to add them explicitly, if you know they're safe? Are you confident that in a few years somebody won't add gpt:// as a protocol? Etc.","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/jhy/jsoup/issues/comments/1805502990/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/jhy/jsoup/issues/comments/1805651044","html_url":"https://github.com/jhy/jsoup/issues/2047#issuecomment-1805651044","issue_url":"https://api.github.com/repos/jhy/jsoup/issues/2047","id":1805651044,"node_id":"IC_kwDOAAbAPs5roAxk","user":{"login":"robstoll","id":5557885,"node_id":"MDQ6VXNlcjU1NTc4ODU=","avatar_url":"https://avatars.githubusercontent.com/u/5557885?v=4","gravatar_id":"","url":"https://api.github.com/users/robstoll","html_url":"https://github.com/robstoll","followers_url":"https://api.github.com/users/robstoll/followers","following_url":"https://api.github.com/users/robstoll/following{/other_user}","gists_url":"https://api.github.com/users/robstoll/gists{/gist_id}","starred_url":"https://api.github.com/users/robstoll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robstoll/subscriptions","organizations_url":"https://api.github.com/users/robstoll/orgs","repos_url":"https://api.github.com/users/robstoll/repos","events_url":"https://api.github.com/users/robstoll/events{/privacy}","received_events_url":"https://api.github.com/users/robstoll/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-11-10T12:28:58Z","updated_at":"2023-11-10T12:33:43Z","body":"I actually totally see your point and usually whitelist is what I use. this time I wasn't able to convince the client otherwise. the client want to be able to use all kind of protocols such as tel, callto, mailto, all kind of ftp etc. the client basically doesn't want to restrict itself to use new protocols in the future -- without the need to adjust the software. So it is rather the opposite, the client would want to use gpt: in the future. The only thing I was able to convince is that javascript needs to be forbidden.\r\n\r\nAnyway, I see your concerns and IMO it's OK to keep it that way. Maybe another feature could be helpful which might exist already within jsoup and I did just not find it yet. A way to get the protocol from an href normalized in the sense of all kind of variants of `href=\"javascript:\"`, `href=\"  javascript:\"`, `href=\"java\\tscript:\"` etc. boil down to \"javascript\"\r\n\r\n(side question. if I use `addProtocols(...\"https\")` is then something like \"//google.com\" allowed?)","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/jhy/jsoup/issues/comments/1805651044/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"robstoll","id":5557885,"node_id":"MDQ6VXNlcjU1NTc4ODU=","avatar_url":"https://avatars.githubusercontent.com/u/5557885?v=4","gravatar_id":"","url":"https://api.github.com/users/robstoll","html_url":"https://github.com/robstoll","followers_url":"https://api.github.com/users/robstoll/followers","following_url":"https://api.github.com/users/robstoll/following{/other_user}","gists_url":"https://api.github.com/users/robstoll/gists{/gist_id}","starred_url":"https://api.github.com/users/robstoll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robstoll/subscriptions","organizations_url":"https://api.github.com/users/robstoll/orgs","repos_url":"https://api.github.com/users/robstoll/repos","events_url":"https://api.github.com/users/robstoll/events{/privacy}","received_events_url":"https://api.github.com/users/robstoll/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/jhy/jsoup/issues/comments/1806528320","html_url":"https://github.com/jhy/jsoup/issues/2047#issuecomment-1806528320","issue_url":"https://api.github.com/repos/jhy/jsoup/issues/2047","id":1806528320,"node_id":"IC_kwDOAAbAPs5rrW9A","user":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-11-10T22:43:14Z","updated_at":"2023-11-10T22:43:14Z","body":"> A way to get the protocol from an href normalized in the sense of all kind of variants of href=\"javascript:\", href=\"  javascript:\", href=\"java\\tscript:\" etc. boil down to \"javascript\"\r\n\r\nYes, [`node.absUrl(attribute)`](https://jsoup.org/apidocs/org/jsoup/nodes/Node.html#absUrl(java.lang.String)) returns the normalized and absolute URL form, if it can be coerced into one. Some of those forms will not get parsed as a full URL and will return blank, so you could have code that tests for `.startswith(\"javascript\")` or is `.equals(\"\")`, and handles the link appropriately.\r\n\r\n```java\r\nString html = \"\"\"\r\n  <a href=\"  javascript:alert(1)\">1</a>\r\n  <a href=\"javascript:alert(1)\">2</a>\r\n  <a href=\"java\\tscript:alert(1)\">3</a>\r\n  \"\"\";\r\nDocument doc = Jsoup.parse(html, \"https://example.com/\");\r\nElements links = doc.select(\"a\");\r\nlinks.forEach(el -> print(el.text() + \": \" + el.absUrl(\"href\")));\r\n```\r\nGives: \r\n```text\r\n1: \r\n2: javascript:alert(1)\r\n3: javascript:alert(1)\r\n```\r\n\r\nNote that I'm showing this as an example of using `absUrl`. I 100% don't recommend trying to defang HTML input by using a blocklist approach. The only sane approach is to use a positive known-good assertion test (as the Cleaner / Safelist does).\r\n\r\nThe Safelist isSafeTag and isSafeAttribute methods are overridable, so you could extend it to allow any protocol if you want, or perform other extended assertions.\r\n\r\n> the client basically doesn't want to restrict itself to use new protocols in the future -- without the need to adjust the software\r\n\r\nMy suggestion would be to make it admin configurable - just pipe in a list of accepted, known safe protocols.\r\n\r\n---\r\n\r\n> if I use addProtocols(...\"https\") is then something like \"//google.com\" allowed?\r\n\r\nThe [Safelist.basic](https://jsoup.org/apidocs/org/jsoup/safety/Safelist.html#basic()) already includes https protocols et al. And yes, links that are protocol relative are supported as long as you pass in the baseUri when parsing (either into the `clean` method or the `parse` method).\r\n\r\n```java\r\nString html = \"<a href='//google.com/'>Link</a>\";\r\nString clean = Jsoup.clean(html, \"https://example.com/\", Safelist.basic());\r\nSystem.out.println(clean);\r\n```\r\n\r\nProduces:\r\n\r\n```html\r\n<a href=\"https://google.com/\" rel=\"nofollow\">Link</a>\r\n```","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/jhy/jsoup/issues/comments/1806528320/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10930258790,"node_id":"CE_lADOAAbAPs52dJO2zwAAAAKLfoNm","url":"https://api.github.com/repos/jhy/jsoup/issues/events/10930258790","actor":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2023-11-10T22:43:14Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/jhy/jsoup/issues/comments/1806758940","html_url":"https://github.com/jhy/jsoup/issues/2047#issuecomment-1806758940","issue_url":"https://api.github.com/repos/jhy/jsoup/issues/2047","id":1806758940,"node_id":"IC_kwDOAAbAPs5rsPQc","user":{"login":"robstoll","id":5557885,"node_id":"MDQ6VXNlcjU1NTc4ODU=","avatar_url":"https://avatars.githubusercontent.com/u/5557885?v=4","gravatar_id":"","url":"https://api.github.com/users/robstoll","html_url":"https://github.com/robstoll","followers_url":"https://api.github.com/users/robstoll/followers","following_url":"https://api.github.com/users/robstoll/following{/other_user}","gists_url":"https://api.github.com/users/robstoll/gists{/gist_id}","starred_url":"https://api.github.com/users/robstoll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robstoll/subscriptions","organizations_url":"https://api.github.com/users/robstoll/orgs","repos_url":"https://api.github.com/users/robstoll/repos","events_url":"https://api.github.com/users/robstoll/events{/privacy}","received_events_url":"https://api.github.com/users/robstoll/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-11-11T09:10:06Z","updated_at":"2023-11-11T09:10:06Z","body":"> My suggestion would be to make it admin configurable - just pipe in a list of accepted, known safe protocols.\r\n\r\nwas my suggestion as well. \r\nthanks for the suggestions","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/jhy/jsoup/issues/comments/1806758940/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"robstoll","id":5557885,"node_id":"MDQ6VXNlcjU1NTc4ODU=","avatar_url":"https://avatars.githubusercontent.com/u/5557885?v=4","gravatar_id":"","url":"https://api.github.com/users/robstoll","html_url":"https://github.com/robstoll","followers_url":"https://api.github.com/users/robstoll/followers","following_url":"https://api.github.com/users/robstoll/following{/other_user}","gists_url":"https://api.github.com/users/robstoll/gists{/gist_id}","starred_url":"https://api.github.com/users/robstoll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robstoll/subscriptions","organizations_url":"https://api.github.com/users/robstoll/orgs","repos_url":"https://api.github.com/users/robstoll/repos","events_url":"https://api.github.com/users/robstoll/events{/privacy}","received_events_url":"https://api.github.com/users/robstoll/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":11132629538,"node_id":"REFE_lADOAAbAPs52dJO2zwAAAAKXjnIi","url":"https://api.github.com/repos/jhy/jsoup/issues/events/11132629538","actor":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"954c46a92a1a0c5052ed241d4398db8b0331e1f3","commit_url":"https://api.github.com/repos/jhy/jsoup/commits/954c46a92a1a0c5052ed241d4398db8b0331e1f3","created_at":"2023-12-03T23:16:24Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/jhy/jsoup/issues/comments/1837969614","html_url":"https://github.com/jhy/jsoup/issues/2047#issuecomment-1837969614","issue_url":"https://api.github.com/repos/jhy/jsoup/issues/2047","id":1837969614,"node_id":"IC_kwDOAAbAPs5tjTDO","user":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-04T07:19:06Z","updated_at":"2023-12-04T07:19:06Z","body":"(The above commit is not related to this issue, and should point to #2074 instead)","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/jhy/jsoup/issues/comments/1837969614/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jhy","id":76934,"node_id":"MDQ6VXNlcjc2OTM0","avatar_url":"https://avatars.githubusercontent.com/u/76934?v=4","gravatar_id":"","url":"https://api.github.com/users/jhy","html_url":"https://github.com/jhy","followers_url":"https://api.github.com/users/jhy/followers","following_url":"https://api.github.com/users/jhy/following{/other_user}","gists_url":"https://api.github.com/users/jhy/gists{/gist_id}","starred_url":"https://api.github.com/users/jhy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhy/subscriptions","organizations_url":"https://api.github.com/users/jhy/orgs","repos_url":"https://api.github.com/users/jhy/repos","events_url":"https://api.github.com/users/jhy/events{/privacy}","received_events_url":"https://api.github.com/users/jhy/received_events","type":"User","user_view_type":"public","site_admin":false}}]