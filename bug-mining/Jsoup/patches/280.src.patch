diff --git a/src/main/java/org/jsoup/parser/HtmlTreeBuilder.java b/src/main/java/org/jsoup/parser/HtmlTreeBuilder.java
index 2748e3c4..8a06312b 100644
--- a/src/main/java/org/jsoup/parser/HtmlTreeBuilder.java
+++ b/src/main/java/org/jsoup/parser/HtmlTreeBuilder.java
@@ -478,7 +478,7 @@ public class HtmlTreeBuilder extends TreeBuilder {
 
         LOOP: for (int pos = bottom; pos >= upper; pos--) {
             Element node = stack.get(pos);
-            if (pos == 0) {
+            if (pos == upper) {
                 last = true;
                 if (fragmentParsing)
                     node = contextElement;
diff --git a/src/test/resources/fuzztests/1642.html.gz b/src/test/resources/fuzztests/1642.html.gz
new file mode 100644
index 00000000..e63d8bef
Binary files /dev/null and b/src/test/resources/fuzztests/1642.html.gz differ
