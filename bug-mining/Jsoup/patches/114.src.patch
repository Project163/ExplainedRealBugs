diff --git a/CHANGES b/CHANGES
index 36229230..de2b50af 100644
--- a/CHANGES
+++ b/CHANGES
@@ -4,6 +4,9 @@ jsoup changelog
  * In XML documents, detect the charset from the XML prolog - <?xml encoding="UTF-8"?>
    <https://github.com/jhy/jsoup/issues/701>
 
+ * Fixed an issue where created XML documents would have an incorrect prolog.
+   <https://github.com/jhy/jsoup/issues/652>
+
  * Fixed an issue where namespaced tags (like <fb:comment>) would cause Element.cssSelector() to fail.
    <https://github.com/jhy/jsoup/pull/677>
 
diff --git a/src/test/java/org/jsoup/parser/XmlTreeBuilderTest.java b/src/test/java/org/jsoup/parser/XmlTreeBuilderTest.java
index 0759c7b1..e7b37e77 100644
--- a/src/test/java/org/jsoup/parser/XmlTreeBuilderTest.java
+++ b/src/test/java/org/jsoup/parser/XmlTreeBuilderTest.java
@@ -15,6 +15,7 @@ import java.io.FileInputStream;
 import java.io.IOException;
 import java.io.InputStream;
 import java.net.URISyntaxException;
+import java.nio.charset.Charset;
 import java.util.List;
 
 import static org.jsoup.nodes.Document.OutputSettings.Syntax;
@@ -154,4 +155,16 @@ public class XmlTreeBuilderTest {
         assertEquals("version=\"1\" encoding=\"UTF-8\" something=\"else\"", decl.getWholeDeclaration());
         assertEquals("<?xml version=\"1\" encoding=\"UTF-8\" something=\"else\"?>", decl.outerHtml());
     }
+
+    @Test
+    public void testCreatesValidProlog() {
+        Document document = Document.createShell("");
+        document.outputSettings().syntax(Syntax.xml);
+        document.charset(Charset.forName("utf-8"));
+        assertEquals("<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n" +
+            "<html>\n" +
+            " <head></head>\n" +
+            " <body></body>\n" +
+            "</html>", document.outerHtml());
+    }
 }
