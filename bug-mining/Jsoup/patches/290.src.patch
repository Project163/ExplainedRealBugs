diff --git a/CHANGES b/CHANGES
index 45172d45..f2a6dae6 100644
--- a/CHANGES
+++ b/CHANGES
@@ -40,6 +40,10 @@ jsoup changelog
     elements with many attributes.
     <https://github.com/jhy/jsoup/issues/1695>
 
+  * Bugfix [Fuzz]: during parsing, a StackOverflowException was possible given crafted HTML with hundreds of nested
+    table elements followed by invalid formatting elements.
+    <https://github.com/jhy/jsoup/issues/1697>
+
 *** Release 1.14.3 [2021-Sep-30]
   * Improvement: added native XPath support in Element#selectXpath(String)
     <https://github.com/jhy/jsoup/pull/1629>
diff --git a/src/main/java/org/jsoup/parser/HtmlTreeBuilder.java b/src/main/java/org/jsoup/parser/HtmlTreeBuilder.java
index aaf415ff..ad048bb0 100644
--- a/src/main/java/org/jsoup/parser/HtmlTreeBuilder.java
+++ b/src/main/java/org/jsoup/parser/HtmlTreeBuilder.java
@@ -466,11 +466,17 @@ public class HtmlTreeBuilder extends TreeBuilder {
         queue.set(i, in);
     }
 
-    void resetInsertionMode() {
+    /**
+     * Reset the insertion mode, by searching up the stack for an appropriate insertion mode. The stack search depth
+     * is limited to {@link #maxQueueDepth}.
+     * @return true if the insertion mode was actually changed.
+     */
+    boolean resetInsertionMode() {
         // https://html.spec.whatwg.org/multipage/parsing.html#the-insertion-mode
         boolean last = false;
         final int bottom = stack.size() - 1;
         final int upper = bottom >= maxQueueDepth ? bottom - maxQueueDepth : 0;
+        final HtmlTreeBuilderState origState = this.state;
 
         if (stack.size() == 0) { // nothing left of stack, just get to body
             transition(HtmlTreeBuilderState.InBody);
@@ -539,6 +545,7 @@ public class HtmlTreeBuilder extends TreeBuilder {
                 break;
             }
         }
+        return state != origState;
     }
 
     // todo: tidy up in specific scope methods
diff --git a/src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java b/src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java
index ae461e92..3a5236e6 100644
--- a/src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java
+++ b/src/main/java/org/jsoup/parser/HtmlTreeBuilderState.java
@@ -997,8 +997,7 @@ enum HtmlTreeBuilderState {
                         return false;
                     } else {
                         tb.popStackToClose(name);
-                        tb.resetInsertionMode();
-                        if (tb.state() == InTable) {
+                        if (!tb.resetInsertionMode()) {
                             // not per spec - but haven't transitioned out of table. so try something else
                             tb.insert(startTag);
                             return true;
diff --git a/src/test/resources/fuzztests/1697.html.gz b/src/test/resources/fuzztests/1697.html.gz
new file mode 100644
index 00000000..507fec4f
Binary files /dev/null and b/src/test/resources/fuzztests/1697.html.gz differ
