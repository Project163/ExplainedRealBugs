diff --git a/CHANGES b/CHANGES
index b10b96a8..02d4d978 100644
--- a/CHANGES
+++ b/CHANGES
@@ -1,6 +1,12 @@
 jsoup changelog
 
 *** Release 1.1.2 (pending)
+ * Added :has(selector) pseudo-selector
+     <http://github.com/jhy/jsoup/issues/issue/20>
+
+ * Added Element#parents and Elements#parents to retrieve an element's ancestor chain
+     <http://github.com/jhy/jsoup/issues/issue/20>
+
  * Fixes an issue where text content after a script (or other data-node) was
      incorrectly added to the data node.
        <http://github.com/jhy/jsoup/issues/issue/22>
diff --git a/src/main/java/org/jsoup/nodes/Document.java b/src/main/java/org/jsoup/nodes/Document.java
index 6ed4c127..831e5620 100644
--- a/src/main/java/org/jsoup/nodes/Document.java
+++ b/src/main/java/org/jsoup/nodes/Document.java
@@ -120,10 +120,11 @@ public class Document extends Element {
             }
         }
 
-        for (Node node: toMove) {
+        for (int i = toMove.size()-1; i >= 0; i--) {
+            Node node = toMove.get(i);
             element.removeChild(node);
-            body().prependChild(node);
             body().prependChild(new TextNode(" ", ""));
+            body().prependChild(node);
         }
     }
 
diff --git a/src/main/java/org/jsoup/nodes/Element.java b/src/main/java/org/jsoup/nodes/Element.java
index 2f42b3a6..6c16137e 100644
--- a/src/main/java/org/jsoup/nodes/Element.java
+++ b/src/main/java/org/jsoup/nodes/Element.java
@@ -109,6 +109,24 @@ public class Element extends Node {
         return (Element) super.parent();
     }
 
+    /**
+     * Get this element's parent and ancestors, up to the document root.
+     * @return this element's stack of parents, closest first.
+     */
+    public Elements parents() {
+        Elements parents = new Elements();
+        accumulateParents(this, parents);
+        return parents;
+    }
+
+    private static void accumulateParents(Element el, Elements parents) {
+        Element parent = el.parent();
+        if (parent != null && !parent.tagName().equals("#root")) {
+            parents.add(parent);
+            accumulateParents(parent, parents);
+        }
+    }
+
     /**
      * Get a child element of this element, by its 0-based index number.
      * <p/>
diff --git a/src/main/java/org/jsoup/select/Elements.java b/src/main/java/org/jsoup/select/Elements.java
index bf32d9cb..aef9fd7d 100644
--- a/src/main/java/org/jsoup/select/Elements.java
+++ b/src/main/java/org/jsoup/select/Elements.java
@@ -301,6 +301,18 @@ public class Elements implements List<Element> {
         return !children.isEmpty();
     }
 
+    /**
+     * Get all of the parents and ancestor elements of the matched elements.
+     * @return
+     */
+    public Elements parents() {
+        HashSet<Element> combo = new LinkedHashSet<Element>();
+        for (Element e: contents) {
+            combo.addAll(e.parents());
+        }
+        return new Elements(combo);
+    }
+
     // list-like methods
     /**
      Get the first matched element.
diff --git a/src/main/java/org/jsoup/select/Selector.java b/src/main/java/org/jsoup/select/Selector.java
index 3ef3caf3..98a9ea4c 100644
--- a/src/main/java/org/jsoup/select/Selector.java
+++ b/src/main/java/org/jsoup/select/Selector.java
@@ -40,6 +40,7 @@ import java.util.LinkedHashSet;
  <tr><td><code>E:lt(<em>n</em>)</code></td><td>an Element whose sibling index is less than <em>n</em></td><td><code>td:lt(3)</code> finds the first 2 cells of each row</td></tr>
  <tr><td><code>E:gt(<em>n</em>)</code></td><td>an Element whose sibling index is greater than <em>n</em></td><td><code>td:gt(1)</code> finds cells after skipping the first two</td></tr>
  <tr><td><code>E:eq(<em>n</em>)</code></td><td>an Element whose sibling index is equal to <em>n</em></td><td><code>td:eq(1)</code> finds the first cell of each row</td></tr>
+ <tr><td><code>E:has(<em>selector</em>)</code></td><td>an Element that contains at least one element matching the <em>selector</em></td><td><code>div:has(p)</code> finds divs that contain p elements </td></tr>
  </table>
 
  @see Element#select(String)
@@ -157,6 +158,8 @@ public class Selector {
             return indexGreaterThan();
         } else if (tq.matchChomp(":eq(")) {
             return indexEquals();
+        } else if (tq.matchChomp(":has(")) {
+            return has();
         } else { // unhandled
             throw new SelectorParseException("Could not parse query " + query);
         }
@@ -242,9 +245,15 @@ public class Selector {
     private int consumeIndex() {
         String indexS = tq.chompTo(")").trim();
         Validate.isTrue(StringUtils.isNumeric(indexS), "Index must be numeric");
-        int index = Integer.parseInt(indexS);
+        return Integer.parseInt(indexS);
+    }
+
+    // pseudo selector :has(el)
+    private Elements has() {
+        String subQuery = tq.chompTo(")");
+        Validate.notEmpty(subQuery, ":has(el) subselect must not be empty");
 
-        return index;
+        return filterForParentsOfDescendants(elements, select(subQuery, elements));
     }
 
     // direct child descendants
@@ -266,18 +275,28 @@ public class Selector {
     private static Elements filterForDescendants(Collection<Element> parents, Collection<Element> candidates) {
         Elements children = new Elements();
         CHILD: for (Element c : candidates) {
-            boolean found = false;
             for (Element p : parents) {
                 if (c.equals(p)) {
-                    found = true;
                     continue CHILD;
                 }
             }
-            if (!found)
-                children.add(c);
+            children.add(c);
         }
         return children;
     }
+
+    // implements :has(el). Finds elements that contain the matched elements
+    private static Elements filterForParentsOfDescendants(Collection<Element> parents, Collection<Element> children) {
+        Elements filteredParents = new Elements();
+        for (Element p : parents) {
+            for (Element c : children) {
+                if (c.parents().contains(p)) {
+                    filteredParents.add(p);
+                }
+            }
+        }
+        return filteredParents;
+    }
     
     // adjacent siblings
     private static Elements filterForAdjacentSiblings(Collection<Element> elements, Collection<Element> candidates) {
diff --git a/src/test/java/org/jsoup/nodes/ElementTest.java b/src/test/java/org/jsoup/nodes/ElementTest.java
index 08ebf2f2..7fc4ac57 100644
--- a/src/test/java/org/jsoup/nodes/ElementTest.java
+++ b/src/test/java/org/jsoup/nodes/ElementTest.java
@@ -87,6 +87,18 @@ public class ElementTest {
         assertEquals("Hello", p.firstElementSibling().text());
         assertEquals("element", p.lastElementSibling().text());
     }
+
+    @Test public void testGetParents() {
+        Document doc = Jsoup.parse("<div><p>Hello <span>there</span></div>");
+        Element span = doc.select("span").first();
+        Elements parents = span.parents();
+
+        assertEquals(4, parents.size());
+        assertEquals("p", parents.get(0).tagName());
+        assertEquals("div", parents.get(1).tagName());
+        assertEquals("body", parents.get(2).tagName());
+        assertEquals("html", parents.get(3).tagName());
+    }
     
     @Test public void testElementSiblingIndex() {
         Document doc = Jsoup.parse("<div><p>One</p>...<p>Two</p>...<p>Three</p>");
diff --git a/src/test/java/org/jsoup/parser/ParserTest.java b/src/test/java/org/jsoup/parser/ParserTest.java
index c6a62356..8102530c 100644
--- a/src/test/java/org/jsoup/parser/ParserTest.java
+++ b/src/test/java/org/jsoup/parser/ParserTest.java
@@ -268,7 +268,7 @@ public class ParserTest {
     @Test public void normalisesDocument() {
         String h = "<!doctype html>One<html>Two<head>Three<link></head>Four<body>Five </body>Six </html>Seven ";
         Document doc = Jsoup.parse(h);
-        assertEquals("<!doctype html><html><head><link /></head><body>Five Six Seven  One Two Four Three</body></html>",
+        assertEquals("<!doctype html><html><head><link /></head><body>One Two Four Three Five Six Seven </body></html>",
                 TextUtil.stripNewlines(doc.html())); // is spaced OK if not newline & space stripped
     }
 
diff --git a/src/test/java/org/jsoup/select/ElementsTest.java b/src/test/java/org/jsoup/select/ElementsTest.java
index b9afa6fc..f5b495ce 100644
--- a/src/test/java/org/jsoup/select/ElementsTest.java
+++ b/src/test/java/org/jsoup/select/ElementsTest.java
@@ -135,4 +135,14 @@ public class ElementsTest {
         assertTrue(ps.is("[title=foo]"));
         assertFalse(ps.is("[title=bar]"));
     }
+
+    @Test public void parents() {
+        Document doc = Jsoup.parse("<div><p>Hello</p></div><p>There</p>");
+        Elements parents = doc.select("p").parents();
+
+        assertEquals(3, parents.size());
+        assertEquals("div", parents.get(0).tagName());
+        assertEquals("body", parents.get(1).tagName());
+        assertEquals("html", parents.get(2).tagName());
+    }
 }
diff --git a/src/test/java/org/jsoup/select/SelectorTest.java b/src/test/java/org/jsoup/select/SelectorTest.java
index 9b2b3336..f3fccba8 100644
--- a/src/test/java/org/jsoup/select/SelectorTest.java
+++ b/src/test/java/org/jsoup/select/SelectorTest.java
@@ -351,4 +351,23 @@ public class SelectorTest {
         assertEquals(1, ps.size());
         assertEquals("Two", ps.get(0).text());
     }
+
+    @Test public void testPseudoHas() {
+        Document doc = Jsoup.parse("<div id=0><p><span>Hello</span></p></div> <div id=1><span class=foo>There</span></div> <div id=2><p>Not</p></div>");
+
+        Elements divs1 = doc.select("div:has(span)");
+        assertEquals(2, divs1.size());
+        assertEquals("0", divs1.get(0).id());
+        assertEquals("1", divs1.get(1).id());
+
+        Elements divs2 = doc.select("div:has([class]");
+        assertEquals(1, divs2.size());
+        assertEquals("1", divs2.get(0).id());
+
+        Elements divs3 = doc.select("div:has(span, p)");
+        assertEquals(3, divs3.size());
+        assertEquals("0", divs3.get(0).id());
+        assertEquals("1", divs3.get(1).id());
+        assertEquals("2", divs3.get(2).id());
+    }
 }
