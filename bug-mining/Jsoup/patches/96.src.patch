diff --git a/CHANGES b/CHANGES
index a698a859..8cff2878 100644
--- a/CHANGES
+++ b/CHANGES
@@ -1,7 +1,17 @@
 jsoup changelog
 
-*** Release 1.7.4 [PENDING]
- * Improved the performance of Element.text() by 2.2x
+*** Release 1.8.1 [PENDING]
+ * Introduced the ability to chose between HTML and XML output, and made HTML the default. This means img tags are
+   output as <img>, not <img />. XML is the default when using the XmlTreeBuilder. Control this with the
+   Document.OutputSettings.syntax() method.
+
+ * Improved the performance of Element.text() by 3.2x
+
+ * Improved the performance of Element.html() by 1.7x
+
+ * Tightened the scope of what characters are escaped in attributes and textnodes, to align with the spec. Also, when
+   using the extended escape entities map, only escape a character if the current output charset does not support it.
+   This produces smaller, more legible HTML, with greated control over the output (by setting charset and escape mode).
 
  * If pretty-print is disabled, don't trim outer whitespace in Element.html()
    <https://github.com/jhy/jsoup/issues/368>
diff --git a/src/main/java/org/jsoup/nodes/Attribute.java b/src/main/java/org/jsoup/nodes/Attribute.java
index 02eb29db..72f9c887 100644
--- a/src/main/java/org/jsoup/nodes/Attribute.java
+++ b/src/main/java/org/jsoup/nodes/Attribute.java
@@ -2,6 +2,7 @@ package org.jsoup.nodes;
 
 import org.jsoup.helper.Validate;
 
+import java.util.Arrays;
 import java.util.Map;
 
 /**
@@ -9,6 +10,13 @@ import java.util.Map;
 
  @author Jonathan Hedley, jonathan@hedley.net */
 public class Attribute implements Map.Entry<String, String>, Cloneable  {
+    private static final String[] booleanAttributes = {
+            "allowfullscreen", "async", "autofocus", "checked", "compact", "declare", "default", "defer", "disabled",
+            "formnovalidate", "hidden", "inert", "ismap", "itemscope", "multiple", "muted", "nohref", "noresize",
+            "noshade", "novalidate", "nowrap", "open", "readonly", "required", "reversed", "seamless", "selected",
+            "sortable", "truespeed", "typemustmatch"
+    };
+
     private String key;
     private String value;
 
@@ -66,15 +74,18 @@ public class Attribute implements Map.Entry<String, String>, Cloneable  {
      @return HTML
      */
     public String html() {
-        return key + "=\"" + Entities.escape(value, (new Document("")).outputSettings()) + "\"";
+        StringBuilder accum = new StringBuilder();
+        html(accum, (new Document("")).outputSettings());
+        return accum.toString();
     }
     
     protected void html(StringBuilder accum, Document.OutputSettings out) {
-        accum
-            .append(key)
-            .append("=\"")
-            .append(Entities.escape(value, out))
-            .append("\"");
+        accum.append(key);
+        if (!shouldCollapseAttribute(out)) {
+            accum.append("=\"");
+            Entities.escape(accum, value, out, true, false, false);
+            accum.append('"');
+        }
     }
 
     /**
@@ -100,6 +111,15 @@ public class Attribute implements Map.Entry<String, String>, Cloneable  {
         return key.startsWith(Attributes.dataPrefix) && key.length() > Attributes.dataPrefix.length();
     }
 
+    /**
+     * Collapsible if it's a boolean attribute and value is empty or same as name
+     */
+    protected final boolean shouldCollapseAttribute(Document.OutputSettings out) {
+        return ("".equals(value) || value.equalsIgnoreCase(key))
+                && out.syntax() == Document.OutputSettings.Syntax.html
+                && Arrays.binarySearch(booleanAttributes, key) >= 0;
+    }
+
     @Override
     public boolean equals(Object o) {
         if (this == o) return true;
diff --git a/src/main/java/org/jsoup/nodes/Document.java b/src/main/java/org/jsoup/nodes/Document.java
index 6da06fbd..571a5121 100644
--- a/src/main/java/org/jsoup/nodes/Document.java
+++ b/src/main/java/org/jsoup/nodes/Document.java
@@ -218,12 +218,18 @@ public class Document extends Element {
      * A Document's output settings control the form of the text() and html() methods.
      */
     public static class OutputSettings implements Cloneable {
+        /**
+         * The output serialization syntax.
+         */
+        public enum Syntax {html, xml}
+
         private Entities.EscapeMode escapeMode = Entities.EscapeMode.base;
         private Charset charset = Charset.forName("UTF-8");
         private CharsetEncoder charsetEncoder = charset.newEncoder();
         private boolean prettyPrint = true;
         private boolean outline = false;
         private int indentAmount = 1;
+        private Syntax syntax = Syntax.html;
 
         public OutputSettings() {}
 
@@ -240,7 +246,8 @@ public class Document extends Element {
         }
 
         /**
-         * Set the document's escape mode
+         * Set the document's escape mode, which determines how characters are escaped when the output character set
+         * does not support a given character:- using either a named or a numbered escape.
          * @param escapeMode the new escape mode to use
          * @return the document's output settings, for chaining
          */
@@ -287,6 +294,25 @@ public class Document extends Element {
             return charsetEncoder;
         }
 
+        /**
+         * Get the document's current output syntax.
+         * @return current syntax
+         */
+        public Syntax syntax() {
+            return syntax;
+        }
+
+        /**
+         * Set the document's output syntax. Either {@code html}, with empty tags and boolean attributes (etc), or
+         * {@code xml}, with self-closing tags.
+         * @param syntax serialization syntax
+         * @return the document's output settings, for chaining
+         */
+        public OutputSettings syntax(Syntax syntax) {
+            this.syntax = syntax;
+            return this;
+        }
+
         /**
          * Get if pretty printing is enabled. Default is true. If disabled, the HTML output methods will not re-format
          * the output, and the output will generally look like the input.
diff --git a/src/main/java/org/jsoup/nodes/DocumentType.java b/src/main/java/org/jsoup/nodes/DocumentType.java
index 478c2345..e4621573 100644
--- a/src/main/java/org/jsoup/nodes/DocumentType.java
+++ b/src/main/java/org/jsoup/nodes/DocumentType.java
@@ -34,9 +34,9 @@ public class DocumentType extends Node {
     void outerHtmlHead(StringBuilder accum, int depth, Document.OutputSettings out) {
         accum.append("<!DOCTYPE ").append(attr("name"));
         if (!StringUtil.isBlank(attr("publicId")))
-            accum.append(" PUBLIC \"").append(attr("publicId")).append("\"");
+            accum.append(" PUBLIC \"").append(attr("publicId")).append('"');
         if (!StringUtil.isBlank(attr("systemId")))
-            accum.append(" \"").append(attr("systemId")).append("\"");
+            accum.append(" \"").append(attr("systemId")).append('"');
         accum.append('>');
     }
 
diff --git a/src/main/java/org/jsoup/nodes/Element.java b/src/main/java/org/jsoup/nodes/Element.java
index dcfa72ce..15c6a9d0 100644
--- a/src/main/java/org/jsoup/nodes/Element.java
+++ b/src/main/java/org/jsoup/nodes/Element.java
@@ -1072,8 +1072,13 @@ public class Element extends Node {
                 .append(tagName());
         attributes.html(accum, out);
 
-        if (childNodes.isEmpty() && tag.isSelfClosing())
-            accum.append(" />");
+        // selfclosing includes unknown tags, isEmpty defines tags that are always empty
+        if (childNodes.isEmpty() && tag.isSelfClosing()) {
+            if (out.syntax() == Document.OutputSettings.Syntax.html && tag.isEmpty())
+                accum.append('>');
+            else
+                accum.append(" />"); // <img> in html, <img /> in xml
+        }
         else
             accum.append(">");
     }
diff --git a/src/main/java/org/jsoup/nodes/Entities.java b/src/main/java/org/jsoup/nodes/Entities.java
index 76f841c0..0b7b9c86 100644
--- a/src/main/java/org/jsoup/nodes/Entities.java
+++ b/src/main/java/org/jsoup/nodes/Entities.java
@@ -1,5 +1,6 @@
 package org.jsoup.nodes;
 
+import org.jsoup.helper.StringUtil;
 import org.jsoup.parser.Parser;
 
 import java.io.IOException;
@@ -16,7 +17,7 @@ import java.util.regex.Pattern;
  */
 public class Entities {
     public enum EscapeMode {
-        /** Restricted entities suitable for XHTML output: lt, gt, amp, apos, and quot only. */
+        /** Restricted entities suitable for XHTML output: lt, gt, amp, and quot only. */
         xhtml(xhtmlByVal),
         /** Default HTML output entities. */
         base(baseByVal),
@@ -71,26 +72,78 @@ public class Entities {
     }
     
     static String escape(String string, Document.OutputSettings out) {
-        return escape(string, out.encoder(), out.escapeMode());
+        StringBuilder accum = new StringBuilder(string.length() * 2);
+        escape(accum, string, out, false, false, false);
+        return accum.toString();
     }
 
-    static String escape(String string, CharsetEncoder encoder, EscapeMode escapeMode) {
-        StringBuilder accum = new StringBuilder(string.length() * 2);
-        Map<Character, String> map = escapeMode.getMap();
+    // this method is ugly, and does a lot. but other breakups cause rescanning and stringbuilder generations
+    static void escape(StringBuilder accum, String string, Document.OutputSettings out,
+                       boolean inAttribute, boolean normaliseWhite, boolean stripLeadingWhite) {
 
+        boolean lastWasWhite = false;
+        boolean reachedNonWhite = false;
+        EscapeMode escapeMode = out.escapeMode();
+        CharsetEncoder encoder = out.encoder();
+        Map<Character, String> map = escapeMode.getMap();
         final int length = string.length();
-        for (int offset = 0; offset < length; ) {
-            final int codePoint = string.codePointAt(offset);
 
+        int codePoint;
+        for (int offset = 0; offset < length; offset += Character.charCount(codePoint)) {
+            codePoint = string.codePointAt(offset);
+
+            if (normaliseWhite) {
+                if (StringUtil.isWhitespace(codePoint)) {
+                    if ((stripLeadingWhite && !reachedNonWhite) || lastWasWhite)
+                        continue;
+                    accum.append(' ');
+                    lastWasWhite = true;
+                    continue;
+                } else {
+                    lastWasWhite = false;
+                    reachedNonWhite = true;
+                }
+            }
             // surrogate pairs, split implementation for efficiency on single char common case (saves creating strings, char[]):
             if (codePoint < Character.MIN_SUPPLEMENTARY_CODE_POINT) {
                 final char c = (char) codePoint;
-                if (map.containsKey(c))
-                    accum.append('&').append(map.get(c)).append(';');
-                else if (encoder.canEncode(c))
-                    accum.append(c);
-                else
-                    accum.append("&#x").append(Integer.toHexString(codePoint)).append(';');
+                // html specific and required escapes:
+                switch (c) {
+                    case '&':
+                        accum.append("&amp;");
+                        break;
+                    case 0xA0:
+                        if (escapeMode != EscapeMode.xhtml)
+                            accum.append("&nbsp;");
+                        else
+                            accum.append(c);
+                        break;
+                    case '<':
+                        if (!inAttribute)
+                            accum.append("&lt;");
+                        else
+                            accum.append(c);
+                        break;
+                    case '>':
+                        if (!inAttribute)
+                            accum.append("&gt;");
+                        else
+                            accum.append(c);
+                        break;
+                    case '"':
+                        if (inAttribute)
+                            accum.append("&quot;");
+                        else
+                            accum.append(c);
+                        break;
+                    default:
+                        if (encoder.canEncode(c))
+                            accum.append(c);
+                        else if (map.containsKey(c))
+                            accum.append('&').append(map.get(c)).append(';');
+                        else
+                            accum.append("&#x").append(Integer.toHexString(codePoint)).append(';');
+                }
             } else {
                 final String c = new String(Character.toChars(codePoint));
                 if (encoder.canEncode(c))
@@ -98,11 +151,7 @@ public class Entities {
                 else
                     accum.append("&#x").append(Integer.toHexString(codePoint)).append(';');
             }
-
-            offset += Character.charCount(codePoint);
         }
-
-        return accum.toString();
     }
 
     static String unescape(String string) {
@@ -119,11 +168,11 @@ public class Entities {
         return Parser.unescapeEntities(string, strict);
     }
 
+
     // xhtml has restricted entities
     private static final Object[][] xhtmlArray = {
             {"quot", 0x00022},
             {"amp", 0x00026},
-            {"apos", 0x00027},
             {"lt", 0x0003C},
             {"gt", 0x0003E}
     };
diff --git a/src/main/java/org/jsoup/nodes/TextNode.java b/src/main/java/org/jsoup/nodes/TextNode.java
index a0dfefe1..8e16d00c 100644
--- a/src/main/java/org/jsoup/nodes/TextNode.java
+++ b/src/main/java/org/jsoup/nodes/TextNode.java
@@ -93,11 +93,9 @@ public class TextNode extends Node {
         if (out.prettyPrint() && ((siblingIndex() == 0 && parentNode instanceof Element && ((Element) parentNode).tag().formatAsBlock() && !isBlank()) || (out.outline() && siblingNodes().size()>0 && !isBlank()) ))
             indent(accum, depth, out);
 
-        String html = Entities.escape(getWholeText(), out);
-        if (out.prettyPrint() && parent() instanceof Element && !Element.preserveWhitespace((Element) parent()))
-            StringUtil.appendNormalisedWhitespace(accum, html, false);
-        else
-            accum.append(html);
+        boolean normaliseWhite = out.prettyPrint() && parent() instanceof Element
+                && !Element.preserveWhitespace((Element) parent());
+        Entities.escape(accum, getWholeText(), out, false, normaliseWhite, false);
     }
 
     void outerHtmlTail(StringBuilder accum, int depth, Document.OutputSettings out) {}
diff --git a/src/main/java/org/jsoup/parser/Tag.java b/src/main/java/org/jsoup/parser/Tag.java
index a777dfd8..5796de4c 100644
--- a/src/main/java/org/jsoup/parser/Tag.java
+++ b/src/main/java/org/jsoup/parser/Tag.java
@@ -230,11 +230,11 @@ public class Tag {
             "var", "cite", "abbr", "time", "acronym", "mark", "ruby", "rt", "rp", "a", "img", "br", "wbr", "map", "q",
             "sub", "sup", "bdo", "iframe", "embed", "span", "input", "select", "textarea", "label", "button", "optgroup",
             "option", "legend", "datalist", "keygen", "output", "progress", "meter", "area", "param", "source", "track",
-            "summary", "command", "device"
+            "summary", "command", "device", "area", "basefont", "bgsound", "menuitem", "param", "source", "track"
     };
     private static final String[] emptyTags = {
             "meta", "link", "base", "frame", "img", "br", "wbr", "embed", "hr", "input", "keygen", "col", "command",
-            "device"
+            "device", "area", "basefont", "bgsound", "menuitem", "param", "source", "track"
     };
     private static final String[] formatAsInlineTags = {
             "title", "a", "p", "h1", "h2", "h3", "h4", "h5", "h6", "pre", "address", "li", "th", "td", "script", "style",
diff --git a/src/main/java/org/jsoup/parser/XmlTreeBuilder.java b/src/main/java/org/jsoup/parser/XmlTreeBuilder.java
index a62ddaae..633720f0 100644
--- a/src/main/java/org/jsoup/parser/XmlTreeBuilder.java
+++ b/src/main/java/org/jsoup/parser/XmlTreeBuilder.java
@@ -7,6 +7,10 @@ import java.util.Iterator;
 import java.util.List;
 
 /**
+ * Use the {@code XmlTreeBuilder} when you want to parse XML without any of the HTML DOM rules being applied to the
+ * document.
+ * <p>Usage example: {@code Document xmlDoc = Jsoup.parse(html, baseUrl, Parser.xmlParser());}</p>
+ *
  * @author Jonathan Hedley
  */
 public class XmlTreeBuilder extends TreeBuilder {
@@ -14,6 +18,7 @@ public class XmlTreeBuilder extends TreeBuilder {
     protected void initialiseParse(String input, String baseUri, ParseErrorList errors) {
         super.initialiseParse(input, baseUri, errors);
         stack.add(doc); // place the document onto the stack. differs from HtmlTreeBuilder (not on stack)
+        doc.outputSettings().syntax(Document.OutputSettings.Syntax.xml);
     }
 
     @Override
diff --git a/src/test/java/org/jsoup/nodes/DocumentTest.java b/src/test/java/org/jsoup/nodes/DocumentTest.java
index 60f87bdf..e293637e 100644
--- a/src/test/java/org/jsoup/nodes/DocumentTest.java
+++ b/src/test/java/org/jsoup/nodes/DocumentTest.java
@@ -9,6 +9,7 @@ import org.jsoup.integration.ParseTest;
 import org.junit.Test;
 import org.junit.Ignore;
 
+import static org.jsoup.nodes.Document.OutputSettings.Syntax;
 import static org.junit.Assert.*;
 
 /**
@@ -59,7 +60,7 @@ public class DocumentTest {
     @Test public void testXhtmlReferences() {
         Document doc = Jsoup.parse("&lt; &gt; &amp; &quot; &apos; &times;");
         doc.outputSettings().escapeMode(Entities.EscapeMode.xhtml);
-        assertEquals("&lt; &gt; &amp; &quot; &apos; ×", doc.body().html());
+        assertEquals("&lt; &gt; &amp; \" ' ×", doc.body().html());
     }
 
     @Test public void testNormalisesStructure() {
@@ -100,7 +101,36 @@ public class DocumentTest {
         baseUri = doc.baseUri();
         assertEquals("http://www.nytimes.com/2010/07/26/business/global/26bp.html?hp",location);
         assertEquals("http://www.nytimes.com/2010/07/26/business/global/26bp.html?hp",baseUri);
-        
+    }
+
+    @Test public void testHtmlAndXmlSyntax() {
+        String h = "<!DOCTYPE html><body><img async checked='checked' src='&<>\"'>&lt;&gt;&amp;&quot;<foo />bar";
+        Document doc = Jsoup.parse(h);
+
+        doc.outputSettings().syntax(Syntax.html);
+        assertEquals("<!DOCTYPE html>\n" +
+                "<html>\n" +
+                " <head></head>\n" +
+                " <body>\n" +
+                "  <img async checked src=\"&amp;<>&quot;\">&lt;&gt;&amp;\"\n" +
+                "  <foo />bar\n" +
+                " </body>\n" +
+                "</html>", doc.html());
+
+        doc.outputSettings().syntax(Document.OutputSettings.Syntax.xml);
+        assertEquals("<!DOCTYPE html>\n" +
+                "<html>\n" +
+                " <head></head>\n" +
+                " <body>\n" +
+                "  <img async=\"\" checked=\"checked\" src=\"&amp;<>&quot;\" />&lt;&gt;&amp;\"\n" +
+                "  <foo />bar\n" +
+                " </body>\n" +
+                "</html>", doc.html());
+    }
+
+    @Test public void htmlParseDefaultsToHtmlOutputSyntax() {
+        Document doc = Jsoup.parse("x");
+        assertEquals(Syntax.html, doc.outputSettings().syntax());
     }
 
     // Ignored since this test can take awhile to run.
diff --git a/src/test/java/org/jsoup/nodes/ElementTest.java b/src/test/java/org/jsoup/nodes/ElementTest.java
index cd4d348a..cb9b1e06 100644
--- a/src/test/java/org/jsoup/nodes/ElementTest.java
+++ b/src/test/java/org/jsoup/nodes/ElementTest.java
@@ -212,7 +212,7 @@ public class ElementTest {
 
     @Test public void testOuterHtml() {
         Document doc = Jsoup.parse("<div title='Tags &amp;c.'><img src=foo.png><p><!-- comment -->Hello<p>there");
-        assertEquals("<html><head></head><body><div title=\"Tags &amp;c.\"><img src=\"foo.png\" /><p><!-- comment -->Hello</p><p>there</p></div></body></html>",
+        assertEquals("<html><head></head><body><div title=\"Tags &amp;c.\"><img src=\"foo.png\"><p><!-- comment -->Hello</p><p>there</p></div></body></html>",
                 TextUtil.stripNewlines(doc.outerHtml()));
     }
 
@@ -457,10 +457,10 @@ public class ElementTest {
     @Test public void parentlessToString() {
         Document doc = Jsoup.parse("<img src='foo'>");
         Element img = doc.select("img").first();
-        assertEquals("<img src=\"foo\" />", img.toString());
+        assertEquals("<img src=\"foo\">", img.toString());
 
         img.remove(); // lost its parent
-        assertEquals("<img src=\"foo\" />", img.toString());
+        assertEquals("<img src=\"foo\">", img.toString());
     }
 
     @Test public void testClone() {
diff --git a/src/test/java/org/jsoup/nodes/EntitiesTest.java b/src/test/java/org/jsoup/nodes/EntitiesTest.java
index c671badc..aebaf103 100644
--- a/src/test/java/org/jsoup/nodes/EntitiesTest.java
+++ b/src/test/java/org/jsoup/nodes/EntitiesTest.java
@@ -3,6 +3,8 @@ package org.jsoup.nodes;
 import org.jsoup.Jsoup;
 import org.junit.Test;
 
+import static org.jsoup.nodes.Document.OutputSettings;
+import static org.jsoup.nodes.Entities.EscapeMode.*;
 import static org.junit.Assert.*;
 
 import java.nio.charset.Charset;
@@ -10,16 +12,16 @@ import java.nio.charset.Charset;
 public class EntitiesTest {
     @Test public void escape() {
         String text = "Hello &<> Å å π 新 there ¾ ©";
-        String escapedAscii = Entities.escape(text, Charset.forName("ascii").newEncoder(), Entities.EscapeMode.base);
-        String escapedAsciiFull = Entities.escape(text, Charset.forName("ascii").newEncoder(), Entities.EscapeMode.extended);
-        String escapedAsciiXhtml = Entities.escape(text, Charset.forName("ascii").newEncoder(), Entities.EscapeMode.xhtml);
-        String escapedUtfFull = Entities.escape(text, Charset.forName("UTF-8").newEncoder(), Entities.EscapeMode.base);
-        String escapedUtfMin = Entities.escape(text, Charset.forName("UTF-8").newEncoder(), Entities.EscapeMode.xhtml);
+        String escapedAscii = Entities.escape(text, new OutputSettings().charset("ascii").escapeMode(base));
+        String escapedAsciiFull = Entities.escape(text, new OutputSettings().charset("ascii").escapeMode(extended));
+        String escapedAsciiXhtml = Entities.escape(text, new OutputSettings().charset("ascii").escapeMode(xhtml));
+        String escapedUtfFull = Entities.escape(text, new OutputSettings().charset("UTF-8").escapeMode(base));
+        String escapedUtfMin = Entities.escape(text, new OutputSettings().charset("UTF-8").escapeMode(xhtml));
 
         assertEquals("Hello &amp;&lt;&gt; &Aring; &aring; &#x3c0; &#x65b0; there &frac34; &copy;", escapedAscii);
         assertEquals("Hello &amp;&lt;&gt; &angst; &aring; &pi; &#x65b0; there &frac34; &copy;", escapedAsciiFull);
         assertEquals("Hello &amp;&lt;&gt; &#xc5; &#xe5; &#x3c0; &#x65b0; there &#xbe; &#xa9;", escapedAsciiXhtml);
-        assertEquals("Hello &amp;&lt;&gt; &Aring; &aring; π 新 there &frac34; &copy;", escapedUtfFull);
+        assertEquals("Hello &amp;&lt;&gt; Å å π 新 there ¾ ©", escapedUtfFull);
         assertEquals("Hello &amp;&lt;&gt; Å å π 新 there ¾ ©", escapedUtfMin);
         // odd that it's defined as aring in base but angst in full
 
@@ -33,9 +35,9 @@ public class EntitiesTest {
 
     @Test public void escapeSupplementaryCharacter(){
         String text = new String(Character.toChars(135361));
-        String escapedAscii = Entities.escape(text, Charset.forName("ascii").newEncoder(), Entities.EscapeMode.base);
+        String escapedAscii = Entities.escape(text, new OutputSettings().charset("ascii").escapeMode(base));
         assertEquals("&#x210c1;", escapedAscii);
-        String escapedUtf = Entities.escape(text, Charset.forName("UTF-8").newEncoder(), Entities.EscapeMode.base);
+        String escapedUtf = Entities.escape(text, new OutputSettings().charset("UTF-8").escapeMode(base));
         assertEquals(text, escapedUtf);
     }
 
@@ -56,7 +58,8 @@ public class EntitiesTest {
     
     @Test public void caseSensitive() {
         String unescaped = "Ü ü & &";
-        assertEquals("&Uuml; &uuml; &amp; &amp;", Entities.escape(unescaped, Charset.forName("ascii").newEncoder(), Entities.EscapeMode.extended));
+        assertEquals("&Uuml; &uuml; &amp; &amp;",
+                Entities.escape(unescaped, new OutputSettings().charset("ascii").escapeMode(extended)));
         
         String escaped = "&Uuml; &uuml; &amp; &AMP";
         assertEquals("Ü ü & &", Entities.unescape(escaped));
@@ -72,9 +75,12 @@ public class EntitiesTest {
     @Test public void letterDigitEntities() {
         String html = "<p>&sup1;&sup2;&sup3;&frac14;&frac12;&frac34;</p>";
         Document doc = Jsoup.parse(html);
+        doc.outputSettings().charset("ascii");
         Element p = doc.select("p").first();
         assertEquals("&sup1;&sup2;&sup3;&frac14;&frac12;&frac34;", p.html());
         assertEquals("¹²³¼½¾", p.text());
+        doc.outputSettings().charset("UTF-8");
+        assertEquals("¹²³¼½¾", p.html());
     }
 
     @Test public void noSpuriousDecodes() {
diff --git a/src/test/java/org/jsoup/parser/HtmlParserTest.java b/src/test/java/org/jsoup/parser/HtmlParserTest.java
index e0604b43..dcfe4e0d 100644
--- a/src/test/java/org/jsoup/parser/HtmlParserTest.java
+++ b/src/test/java/org/jsoup/parser/HtmlParserTest.java
@@ -234,7 +234,7 @@ public class HtmlParserTest {
     @Test public void handlesWhatWgExpensesTableExample() {
         // http://www.whatwg.org/specs/web-apps/current-work/multipage/tabular-data.html#examples-0
         Document doc = Jsoup.parse("<table> <colgroup> <col> <colgroup> <col> <col> <col> <thead> <tr> <th> <th>2008 <th>2007 <th>2006 <tbody> <tr> <th scope=rowgroup> Research and development <td> $ 1,109 <td> $ 782 <td> $ 712 <tr> <th scope=row> Percentage of net sales <td> 3.4% <td> 3.3% <td> 3.7% <tbody> <tr> <th scope=rowgroup> Selling, general, and administrative <td> $ 3,761 <td> $ 2,963 <td> $ 2,433 <tr> <th scope=row> Percentage of net sales <td> 11.6% <td> 12.3% <td> 12.6% </table>");
-        assertEquals("<table> <colgroup> <col /> </colgroup><colgroup> <col /> <col /> <col /> </colgroup><thead> <tr> <th> </th><th>2008 </th><th>2007 </th><th>2006 </th></tr></thead><tbody> <tr> <th scope=\"rowgroup\"> Research and development </th><td> $ 1,109 </td><td> $ 782 </td><td> $ 712 </td></tr><tr> <th scope=\"row\"> Percentage of net sales </th><td> 3.4% </td><td> 3.3% </td><td> 3.7% </td></tr></tbody><tbody> <tr> <th scope=\"rowgroup\"> Selling, general, and administrative </th><td> $ 3,761 </td><td> $ 2,963 </td><td> $ 2,433 </td></tr><tr> <th scope=\"row\"> Percentage of net sales </th><td> 11.6% </td><td> 12.3% </td><td> 12.6% </td></tr></tbody></table>", TextUtil.stripNewlines(doc.body().html()));
+        assertEquals("<table> <colgroup> <col> </colgroup><colgroup> <col> <col> <col> </colgroup><thead> <tr> <th> </th><th>2008 </th><th>2007 </th><th>2006 </th></tr></thead><tbody> <tr> <th scope=\"rowgroup\"> Research and development </th><td> $ 1,109 </td><td> $ 782 </td><td> $ 712 </td></tr><tr> <th scope=\"row\"> Percentage of net sales </th><td> 3.4% </td><td> 3.3% </td><td> 3.7% </td></tr></tbody><tbody> <tr> <th scope=\"rowgroup\"> Selling, general, and administrative </th><td> $ 3,761 </td><td> $ 2,963 </td><td> $ 2,433 </td></tr><tr> <th scope=\"row\"> Percentage of net sales </th><td> 11.6% </td><td> 12.3% </td><td> 12.6% </td></tr></tbody></table>", TextUtil.stripNewlines(doc.body().html()));
     }
 
     @Test public void handlesTbodyTable() {
@@ -335,7 +335,7 @@ public class HtmlParserTest {
         // if a known tag, allow self closing outside of spec, but force an end tag. unknown tags can be self closing.
         String h = "<div id='1' /><script src='/foo' /><div id=2><img /><img></div><a id=3 /><i /><foo /><foo>One</foo> <hr /> hr text <hr> hr text two";
         Document doc = Jsoup.parse(h);
-        assertEquals("<div id=\"1\"></div><script src=\"/foo\"></script><div id=\"2\"><img /><img /></div><a id=\"3\"></a><i></i><foo /><foo>One</foo> <hr /> hr text <hr /> hr text two", TextUtil.stripNewlines(doc.body().html()));
+        assertEquals("<div id=\"1\"></div><script src=\"/foo\"></script><div id=\"2\"><img><img></div><a id=\"3\"></a><i></i><foo /><foo>One</foo> <hr> hr text <hr> hr text two", TextUtil.stripNewlines(doc.body().html()));
     }
 
     @Test public void handlesSolidusAtAttributeEnd() {
@@ -375,7 +375,7 @@ public class HtmlParserTest {
     @Test public void handlesFrames() {
         String h = "<html><head><script></script><noscript></noscript></head><frameset><frame src=foo></frame><frame src=foo></frameset></html>";
         Document doc = Jsoup.parse(h);
-        assertEquals("<html><head><script></script><noscript></noscript></head><frameset><frame src=\"foo\" /><frame src=\"foo\" /></frameset></html>",
+        assertEquals("<html><head><script></script><noscript></noscript></head><frameset><frame src=\"foo\"><frame src=\"foo\"></frameset></html>",
                 TextUtil.stripNewlines(doc.html()));
         // no body auto vivification
     }
@@ -383,7 +383,7 @@ public class HtmlParserTest {
     @Test public void ignoresContentAfterFrameset() {
         String h = "<html><head><title>One</title></head><frameset><frame /><frame /></frameset><table></table></html>";
         Document doc = Jsoup.parse(h);
-        assertEquals("<html><head><title>One</title></head><frameset><frame /><frame /></frameset></html>", TextUtil.stripNewlines(doc.html()));
+        assertEquals("<html><head><title>One</title></head><frameset><frame><frame></frameset></html>", TextUtil.stripNewlines(doc.html()));
         // no body, no table. No crash!
     }
 
@@ -407,7 +407,7 @@ public class HtmlParserTest {
     @Test public void normalisesDocument() {
         String h = "<!doctype html>One<html>Two<head>Three<link></head>Four<body>Five </body>Six </html>Seven ";
         Document doc = Jsoup.parse(h);
-        assertEquals("<!DOCTYPE html><html><head></head><body>OneTwoThree<link />FourFive Six Seven </body></html>",
+        assertEquals("<!DOCTYPE html><html><head></head><body>OneTwoThree<link>FourFive Six Seven </body></html>",
                 TextUtil.stripNewlines(doc.html()));
     }
 
@@ -462,7 +462,7 @@ public class HtmlParserTest {
     @Test public void testNoImagesInNoScriptInHead() {
         // jsoup used to allow, but against spec if parsing with noscript
         Document doc = Jsoup.parse("<html><head><noscript><img src='foo'></noscript></head><body><p>Hello</p></body></html>");
-        assertEquals("<html><head><noscript></noscript></head><body><img src=\"foo\" /><p>Hello</p></body></html>", TextUtil.stripNewlines(doc.html()));
+        assertEquals("<html><head><noscript></noscript></head><body><img src=\"foo\"><p>Hello</p></body></html>", TextUtil.stripNewlines(doc.html()));
     }
 
     @Test public void testAFlowContents() {
@@ -742,8 +742,8 @@ public class HtmlParserTest {
         // extended entities need a ; at the end to match, base does not
         String html = "&amp &quot &reg &icy &hopf &icy; &hopf;";
         Document doc = Jsoup.parse(html);
-        doc.outputSettings().escapeMode(Entities.EscapeMode.extended); // modifies output only to clarify test
-        assertEquals(StringUtil.normaliseWhitespace("&amp; &quot; &reg; &amp;icy &amp;hopf &icy; &hopf;"), doc.body().html());
+        doc.outputSettings().escapeMode(Entities.EscapeMode.extended).charset("ascii"); // modifies output only to clarify test
+        assertEquals("&amp; \" &reg; &amp;icy &amp;hopf &icy; &hopf;", doc.body().html());
     }
 
     @Test public void handlesXmlDeclarationAsBogusComment() {
@@ -785,7 +785,7 @@ public class HtmlParserTest {
         assertEquals("1", controls.get(0).id());
         assertEquals("2", controls.get(1).id());
 
-        assertEquals("<table><tbody><tr><form></form><input type=\"hidden\" id=\"1\" /><td><input type=\"text\" id=\"2\" /></td></tr><tr></tr></tbody></table>", TextUtil.stripNewlines(doc.body().html()));
+        assertEquals("<table><tbody><tr><form></form><input type=\"hidden\" id=\"1\"><td><input type=\"text\" id=\"2\"></td></tr><tr></tr></tbody></table>", TextUtil.stripNewlines(doc.body().html()));
     }
 
     @Test public void handlesInputInTable() {
@@ -804,6 +804,6 @@ public class HtmlParserTest {
         // image to img, unless in a svg. old html cruft.
         String h = "<body><image><svg><image /></svg></body>";
         Document doc = Jsoup.parse(h);
-        assertEquals("<img />\n<svg>\n <image />\n</svg>", doc.body().html());
+        assertEquals("<img>\n<svg>\n <image />\n</svg>", doc.body().html());
     }
 }
diff --git a/src/test/java/org/jsoup/parser/XmlTreeBuilderTest.java b/src/test/java/org/jsoup/parser/XmlTreeBuilderTest.java
index caa15a59..5c2c0a78 100644
--- a/src/test/java/org/jsoup/parser/XmlTreeBuilderTest.java
+++ b/src/test/java/org/jsoup/parser/XmlTreeBuilderTest.java
@@ -17,6 +17,7 @@ import java.io.InputStream;
 import java.net.URISyntaxException;
 import java.util.List;
 
+import static org.jsoup.nodes.Document.OutputSettings.Syntax;
 import static org.junit.Assert.assertEquals;
 import static org.junit.Assert.assertNotSame;
 
@@ -90,9 +91,9 @@ public class XmlTreeBuilderTest {
 
     @Test
     public void testDoesNotForceSelfClosingKnownTags() {
-        // html will force "<br>one</br>" to "<br />One<br />". XML should be stay "<br>one</br> -- don't recognise tag.
+        // html will force "<br>one</br>" to logically "<br />One<br />". XML should be stay "<br>one</br> -- don't recognise tag.
         Document htmlDoc = Jsoup.parse("<br>one</br>");
-        assertEquals("<br />one\n<br />", htmlDoc.body().html());
+        assertEquals("<br>one\n<br>", htmlDoc.body().html());
 
         Document xmlDoc = Jsoup.parse("<br>one</br>", "", Parser.xmlParser());
         assertEquals("<br>one</br>", xmlDoc.html());
@@ -116,4 +117,9 @@ public class XmlTreeBuilderTest {
         assertEquals("one", nodes.get(0).nodeName());
         assertEquals("Two", ((TextNode)nodes.get(1)).text());
     }
+
+    @Test public void xmlParseDefaultsToHtmlOutputSyntax() {
+        Document doc = Jsoup.parse("x", "", Parser.xmlParser());
+        assertEquals(Syntax.xml, doc.outputSettings().syntax());
+    }
 }
diff --git a/src/test/java/org/jsoup/safety/CleanerTest.java b/src/test/java/org/jsoup/safety/CleanerTest.java
index 36bfa266..49bcbb29 100644
--- a/src/test/java/org/jsoup/safety/CleanerTest.java
+++ b/src/test/java/org/jsoup/safety/CleanerTest.java
@@ -37,7 +37,7 @@ public class CleanerTest {
     @Test public void basicWithImagesTest() {
         String h = "<div><p><img src='http://example.com/' alt=Image></p><p><img src='ftp://ftp.example.com'></p></div>";
         String cleanHtml = Jsoup.clean(h, Whitelist.basicWithImages());
-        assertEquals("<p><img src=\"http://example.com/\" alt=\"Image\" /></p><p><img /></p>", TextUtil.stripNewlines(cleanHtml));
+        assertEquals("<p><img src=\"http://example.com/\" alt=\"Image\"></p><p><img></p>", TextUtil.stripNewlines(cleanHtml));
     }
     
     @Test public void testRelaxed() {
@@ -67,7 +67,7 @@ public class CleanerTest {
     @Test public void testDropImageScript() {
         String h = "<IMG SRC=\"javascript:alert('XSS')\">";
         String cleanHtml = Jsoup.clean(h, Whitelist.relaxed());
-        assertEquals("<img />", cleanHtml);
+        assertEquals("<img>", cleanHtml);
     }
     
     @Test public void testCleanJavascriptHref() {
@@ -85,7 +85,7 @@ public class CleanerTest {
     @Test public void testHandlesEmptyAttributes() {
         String h = "<img alt=\"\" src= unknown=''>";
         String cleanHtml = Jsoup.clean(h, Whitelist.basicWithImages());
-        assertEquals("<img alt=\"\" />", cleanHtml);
+        assertEquals("<img alt=\"\">", cleanHtml);
     }
 
     @Test public void testIsValid() {
@@ -102,13 +102,13 @@ public class CleanerTest {
     @Test public void resolvesRelativeLinks() {
         String html = "<a href='/foo'>Link</a><img src='/bar'>";
         String clean = Jsoup.clean(html, "http://example.com/", Whitelist.basicWithImages());
-        assertEquals("<a href=\"http://example.com/foo\" rel=\"nofollow\">Link</a>\n<img src=\"http://example.com/bar\" />", clean);
+        assertEquals("<a href=\"http://example.com/foo\" rel=\"nofollow\">Link</a>\n<img src=\"http://example.com/bar\">", clean);
     }
 
     @Test public void preservesRelativeLinksIfConfigured() {
         String html = "<a href='/foo'>Link</a><img src='/bar'> <img src='javascript:alert()'>";
         String clean = Jsoup.clean(html, "http://example.com/", Whitelist.basicWithImages().preserveRelativeLinks(true));
-        assertEquals("<a href=\"/foo\" rel=\"nofollow\">Link</a>\n<img src=\"/bar\" /> \n<img />", clean);
+        assertEquals("<a href=\"/foo\" rel=\"nofollow\">Link</a>\n<img src=\"/bar\"> \n<img>", clean);
     }
     
     @Test public void dropsUnresolvableRelativeLinks() {
@@ -120,10 +120,10 @@ public class CleanerTest {
     @Test public void handlesCustomProtocols() {
         String html = "<img src='cid:12345' /> <img src='data:gzzt' />";
         String dropped = Jsoup.clean(html, Whitelist.basicWithImages());
-        assertEquals("<img /> \n<img />", dropped);
+        assertEquals("<img> \n<img>", dropped);
 
         String preserved = Jsoup.clean(html, Whitelist.basicWithImages().addProtocols("img", "src", "cid", "data"));
-        assertEquals("<img src=\"cid:12345\" /> \n<img src=\"data:gzzt\" />", preserved);
+        assertEquals("<img src=\"cid:12345\"> \n<img src=\"data:gzzt\">", preserved);
     }
 
     @Test public void handlesAllPseudoTag() {
@@ -151,6 +151,7 @@ public class CleanerTest {
         Document.OutputSettings os = new Document.OutputSettings();
         os.prettyPrint(false);
         os.escapeMode(Entities.EscapeMode.extended);
+        os.charset("ascii");
 
         String html = "<div><p>&bernou;</p></div>";
         String customOut = Jsoup.clean(html, "http://foo.com/", Whitelist.relaxed(), os);
