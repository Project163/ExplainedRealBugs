diff --git a/CHANGES b/CHANGES
index a5185c7f..d346ebb0 100644
--- a/CHANGES
+++ b/CHANGES
@@ -64,6 +64,10 @@ jsoup changelog
   * Bugfix: Removed binary input detection as it was causing too many false positives.
     <https://github.com/jhy/jsoup/issues/1250>
 
+  * Bugfix: The W3CDom#asString method (that converts a Jsoup Document to a W3C DOM and outputs it as a String) would
+    make invalid XML output (the Transformer was switching into HTML output mode).
+    <https://github.com/jhy/jsoup/issues/1098>
+
   * Various code hygiene updates.
 
 **** Release 1.12.1 [2019-May-12]
diff --git a/src/main/java/org/jsoup/helper/W3CDom.java b/src/main/java/org/jsoup/helper/W3CDom.java
index cc769eb1..59575b5b 100644
--- a/src/main/java/org/jsoup/helper/W3CDom.java
+++ b/src/main/java/org/jsoup/helper/W3CDom.java
@@ -20,8 +20,12 @@ import javax.xml.transform.dom.DOMSource;
 import javax.xml.transform.stream.StreamResult;
 import java.io.StringWriter;
 import java.util.HashMap;
+import java.util.Properties;
 import java.util.Stack;
 
+import static javax.xml.transform.OutputKeys.INDENT;
+import static javax.xml.transform.OutputKeys.METHOD;
+
 /**
  * Helper class to transform a {@link org.jsoup.nodes.Document} to a {@link org.w3c.dom.Document org.w3c.dom.Document},
  * for integration with toolsets that use the W3C DOM.
@@ -165,12 +169,25 @@ public class W3CDom {
      * @return Document as string
      */
     public String asString(Document doc) {
+        return asString(doc, null);
+    }
+
+    /**
+     * Serialize a W3C document to a String.
+     *
+     * @param doc Document
+     * @param properties the transformer output properties to use. See {@link Transformer#setOutputProperties(Properties)}
+     * @return Document as string
+     */
+    public String asString(Document doc, Properties properties) {
         try {
             DOMSource domSource = new DOMSource(doc);
             StringWriter writer = new StringWriter();
             StreamResult result = new StreamResult(writer);
             TransformerFactory tf = TransformerFactory.newInstance();
             Transformer transformer = tf.newTransformer();
+            transformer.setOutputProperties(properties);
+            transformer.setOutputProperty(METHOD, "xml");
             transformer.transform(domSource, result);
             return writer.toString();
         } catch (TransformerException e) {
diff --git a/src/test/java/org/jsoup/TextUtil.java b/src/test/java/org/jsoup/TextUtil.java
index 2dac4b6d..ca49bef8 100644
--- a/src/test/java/org/jsoup/TextUtil.java
+++ b/src/test/java/org/jsoup/TextUtil.java
@@ -8,8 +8,13 @@ import java.util.regex.Pattern;
  @author Jonathan Hedley, jonathan@hedley.net */
 public class TextUtil {
     static Pattern stripper = Pattern.compile("\\r?\\n\\s*");
+    static Pattern stripCRs = Pattern.compile("\\r*");
 
     public static String stripNewlines(String text) {
         return stripper.matcher(text).replaceAll("");
     }
+
+    public static String stripCRs(String text) {
+        return stripCRs.matcher(text).replaceAll("");
+    }
 }
diff --git a/src/test/java/org/jsoup/helper/W3CDomTest.java b/src/test/java/org/jsoup/helper/W3CDomTest.java
index e209321e..038cc3c6 100644
--- a/src/test/java/org/jsoup/helper/W3CDomTest.java
+++ b/src/test/java/org/jsoup/helper/W3CDomTest.java
@@ -7,15 +7,30 @@ import org.jsoup.nodes.Element;
 import org.junit.Test;
 import org.w3c.dom.Document;
 import org.w3c.dom.Node;
+import org.w3c.dom.NodeList;
 
+import javax.xml.parsers.DocumentBuilder;
+import javax.xml.parsers.DocumentBuilderFactory;
+import javax.xml.transform.OutputKeys;
+import java.io.ByteArrayInputStream;
 import java.io.File;
 import java.io.IOException;
+import java.nio.charset.StandardCharsets;
+import java.util.Properties;
 
-import static org.junit.Assert.assertEquals;
-import static org.junit.Assert.assertNull;
-import static org.junit.Assert.assertTrue;
+import static org.junit.Assert.*;
 
 public class W3CDomTest {
+    private static Document parseXml(String xml) {
+        DocumentBuilder documentBuilder = null;
+        try {
+            documentBuilder = DocumentBuilderFactory.newInstance().newDocumentBuilder();
+            return documentBuilder.parse(new ByteArrayInputStream(xml.getBytes(StandardCharsets.UTF_8)));
+        } catch (Exception e) {
+            throw new IllegalStateException(e);
+        }
+    }
+
     @Test
     public void simpleConversion() {
         String html = "<html><head><title>W3c</title></head><body><p class='one' id=12>Text</p><!-- comment --><invalid>What<script>alert('!')";
@@ -23,13 +38,36 @@ public class W3CDomTest {
 
         W3CDom w3c = new W3CDom();
         Document wDoc = w3c.fromJsoup(doc);
-        String out = TextUtil.stripNewlines(w3c.asString(wDoc));
-        String expected = TextUtil.stripNewlines(
-                "<html><head><META http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"><title>W3c</title>" +
-                "</head><body><p class=\"one\" id=\"12\">Text</p><!-- comment --><invalid>What<script>alert('!')</script>" +
-                "</invalid></body></html>"
-        );
+        NodeList meta = wDoc.getElementsByTagName("META");
+        assertEquals(0, meta.getLength());
+
+        String out = w3c.asString(wDoc);
+        String expected = "<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?><html><head><title>W3c</title></head><body><p class=\"one\" id=\"12\">Text</p><!-- comment --><invalid>What<script>alert('!')</script></invalid></body></html>";
         assertEquals(expected, out);
+
+        Document roundTrip = parseXml(out);
+        assertEquals("Text", roundTrip.getElementsByTagName("p").item(0).getTextContent());
+
+        // check we can set properties
+        Properties properties = new Properties();
+        properties.put(OutputKeys.INDENT, "yes");
+        String furtherOut = w3c.asString(wDoc, properties);
+        String furtherExpected =
+            "<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n" +
+            "<html>\n" +
+            "    <head>\n" +
+            "        <title>W3c</title>\n" +
+            "    </head>\n" +
+            "    <body>\n" +
+            "        <p class=\"one\" id=\"12\">Text</p>\n" +
+            "        <!-- comment -->\n" +
+            "        <invalid>\n" +
+            "            What\n" +
+            "            <script>alert('!')</script>\n" +
+            "        </invalid>\n" +
+            "    </body>\n" +
+            "</html>\n";
+        assertEquals(furtherExpected, TextUtil.stripCRs(furtherOut)); // on windows, DOM will write newlines as \r\n
     }
 
     @Test
@@ -40,12 +78,15 @@ public class W3CDomTest {
         W3CDom w3c = new W3CDom();
         Document wDoc = w3c.fromJsoup(doc);
         Node htmlEl = wDoc.getChildNodes().item(0);
-        assertEquals(null, htmlEl.getNamespaceURI());
+        assertNull(htmlEl.getNamespaceURI());
         assertEquals("html", htmlEl.getLocalName());
         assertEquals("html", htmlEl.getNodeName());
 
         String out = w3c.asString(wDoc);
         assertTrue(out.contains("ipod"));
+
+        Document roundTrip = parseXml(out);
+        assertEquals("Images", roundTrip.getElementsByTagName("a").item(0).getTextContent());
     }
     
     
