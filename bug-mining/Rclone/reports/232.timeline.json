[{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/260175024","html_url":"https://github.com/rclone/rclone/issues/874#issuecomment-260175024","issue_url":"https://api.github.com/repos/rclone/rclone/issues/874","id":260175024,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MDE3NTAyNA==","user":{"login":"thechile","id":3511504,"node_id":"MDQ6VXNlcjM1MTE1MDQ=","avatar_url":"https://avatars.githubusercontent.com/u/3511504?v=4","gravatar_id":"","url":"https://api.github.com/users/thechile","html_url":"https://github.com/thechile","followers_url":"https://api.github.com/users/thechile/followers","following_url":"https://api.github.com/users/thechile/following{/other_user}","gists_url":"https://api.github.com/users/thechile/gists{/gist_id}","starred_url":"https://api.github.com/users/thechile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thechile/subscriptions","organizations_url":"https://api.github.com/users/thechile/orgs","repos_url":"https://api.github.com/users/thechile/repos","events_url":"https://api.github.com/users/thechile/events{/privacy}","received_events_url":"https://api.github.com/users/thechile/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-11-13T09:19:49Z","updated_at":"2016-11-13T09:19:49Z","body":"Just some more info which i noticed and seems odd\n\nIf i try to cp the below local file to rclone mount point\n\n```\n$ stat .viminfo \n\nFile: ‘.viminfo’\nSize: 5895          Blocks: 16         IO Block: 4096   regular file\nDevice: fc01h/64513d    Inode: 441488      Links: 1\n```\n\nI get the below error which seems to suggest it detects the file size correctly as `5895` and then fails because of a miss-match between the actual size and the one send in http header `Error: http: ContentLength=430 with Body length 6325`\n\n```\n2016/11/13 17:12:27 >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\n2016/11/13 17:12:27 .viminfo: WriteFileHandle.Write len=5895\n2016/11/13 17:12:28 <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<\n2016/11/13 17:12:28 HTTP RESPONSE (req 0xc4200d05a0)\n2016/11/13 17:12:28 HTTP/1.1 200 OK\nCache-Control: no-store\nConnection: keep-alive\nContent-Type: application/json\nDate: Sun, 13 Nov 2016 09:12:28 GMT\nPragma: no-cache\nServer: Server\nVary: User-Agent\nX-Amzn-Requestid: 4cf3a4e1-a981-11e6-8878-XXXXXXXXXXXX\n\n2016/11/13 17:12:28 <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<\n2016/11/13 17:12:28 >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\n2016/11/13 17:12:29 HTTP REQUEST (req 0xc4200d0b40)\n2016/11/13 17:12:29 POST /cdproxy/nodes?suppress=deduplication HTTP/1.1\nHost: content-eu.drive.amazonaws.com\nUser-Agent: rclone/v1.34-DEV\nContent-Length: 430\nAuthorization: XXXX\nContent-Type: multipart/form-data; boundary=231ee268c16bb03cde80501ecc73f18e585163d95af8e8a48c3ae0a38b4b\nAccept-Encoding: gzip\n\n2016/11/13 17:12:29 >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\n2016/11/13 17:12:30 .viminfo: WriteFileHandle.Write OK (5895 bytes written)\n2016/11/13 17:12:30 .viminfo: WriteFileHandle.Flush\n2016/11/13 17:12:30 <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<\n2016/11/13 17:12:30 HTTP RESPONSE (req 0xc4200d0b40)\n2016/11/13 17:12:30 Error: http: ContentLength=430 with Body length 6325\n2016/11/13 17:12:30 <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<\n2016/11/13 17:12:30 .viminfo: Error detected after finished upload - waiting to see if object was uploaded correctly: Post https://content-eu.drive.amazonaws.com/cdproxy/nodes?suppress=deduplication: http: ContentLength=430 with Body length 6325 (\"HTTP status UNKNOWN\")\n2016/11/13 17:12:30 .viminfo: Giving up waiting for object - returning original error: Post https://content-eu.drive.amazonaws.com/cdproxy/nodes?suppress=deduplication: http: ContentLength=430 with Body length 6325 (\"HTTP status UNKNOWN\")\n2016/11/13 17:12:30 .viminfo: WriteFileHandle.Flush error: Post https://content-eu.drive.amazonaws.com/cdproxy/nodes?suppress=deduplication: http: ContentLength=430 with Body length 6325\n2016/11/13 17:12:30 .viminfo: WriteFileHandle.Release nothing to do\n```\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/260175024/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"thechile","id":3511504,"node_id":"MDQ6VXNlcjM1MTE1MDQ=","avatar_url":"https://avatars.githubusercontent.com/u/3511504?v=4","gravatar_id":"","url":"https://api.github.com/users/thechile","html_url":"https://github.com/thechile","followers_url":"https://api.github.com/users/thechile/followers","following_url":"https://api.github.com/users/thechile/following{/other_user}","gists_url":"https://api.github.com/users/thechile/gists{/gist_id}","starred_url":"https://api.github.com/users/thechile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thechile/subscriptions","organizations_url":"https://api.github.com/users/thechile/orgs","repos_url":"https://api.github.com/users/thechile/repos","events_url":"https://api.github.com/users/thechile/events{/privacy}","received_events_url":"https://api.github.com/users/thechile/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/260179854","html_url":"https://github.com/rclone/rclone/issues/874#issuecomment-260179854","issue_url":"https://api.github.com/repos/rclone/rclone/issues/874","id":260179854,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MDE3OTg1NA==","user":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-11-13T11:17:21Z","updated_at":"2016-11-13T11:23:08Z","body":"> Can you explain this problem in some more detail please because i also read #669 which seems to suggest that the file size isn't required in advance.\n\nThis is how the fuse API works. It doesn't tell you \"here's a file with 6 kB, please store it\", but rather `open file x`, `store 4kB at position 0 in handle for file x`, `store 2kB at position 4k in handle for file x`, `close handle`. It also works the same way when reading files; see http://engineering.facile.it/blog/eng/write-filesystem-fuse/ for a nice tutorial. \n\nRegardless if it's actually possible to somehow figure out the \"source file\" for regular copy operations, there are a lot of cases where the file size is not known in advance. Think `cat somefile > acd/someotherfile` or when there is no source file to begin with, say when you directly save to the file system.\n\n> Looking through the acd API documentation it does mention here that the size is required.\n\nInteresting, I didn't read that before. Anyway, I presume they just accept [chunked transfer encoding](https://en.wikipedia.org/wiki/Chunked_transfer_encoding) since they most likely speak HTTP 1.1. I didn't actually check that, though, but I would be surprised if it works differently. Case in point, this is how acd_cli handles uploads (cmp. http://docs.python-requests.org/en/master/user/advanced/#streaming-uploads and following section). I didn't read enough code in `go-acd` which rclone uses, though, and am now wondering if it keeps everything in memory instead of streaming it. Will have to check that!\n\n> Fingers crossed that write support is possible on mount to allow use of common tools/scripts to shift data into acd like cp or rsync etc..\n\ncp yes, but rsync is a totally different beast: it relies on modification time (#371) among other attributes. There is a pull request to acd_cli that stores these in the extended attributes, but that is non-standard. I.e. at least in the case of AmazonDrive, any rsync support would be non-standard (fragile or incompatible with other, but similar, implementations) \n\nAs for your 2nd comment: I am a bit surprised it actually figured out the file size in one go. I guess this must be the read buffer being used. I would expect it to print `.viminfo: WriteFileHandle.Write`  multiple times when the file size exceeds the buffer though. The mismatch you observed is probably caused by these lines:\nhttps://github.com/ncw/rclone/blob/master/amazonclouddrive/amazonclouddrive.go#L593-L597\n`src.Size()` is `0` here, because it doesn't actually get set and this default stays. You can see what happens now: it tries to write the file with a length of 0, even though it isn't. The `Content-Length: 430` is coming from all the metadata (which filename, which parent, etc) and the incorrectly assumed length. The actual file is then still added to the request, which leads to the mismatch.\n\nMakes sense?\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/260179854/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/260200358","html_url":"https://github.com/rclone/rclone/issues/874#issuecomment-260200358","issue_url":"https://api.github.com/repos/rclone/rclone/issues/874","id":260200358,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MDIwMDM1OA==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-11-13T17:41:57Z","updated_at":"2016-11-13T17:41:57Z","body":"Nice explanation @breunigs \n\nI note that the [bit of code you linked to](https://github.com/ncw/rclone/blob/master/amazonclouddrive/amazonclouddrive.go#L593-L597) is a work around for uploading 0 length files.  If the Put() method could be changed so it could upload 0 length files then uploading would work via FUSE.\n\nThe `Put` method in go-acd was written by me and it seems very complicated - perhaps there is a better way...\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/260200358/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":857062132,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50ODU3MDYyMTMy","url":"https://api.github.com/repos/rclone/rclone/issues/events/857062132","actor":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2016-11-13T17:41:57Z","performed_via_github_app":null},{"id":857062133,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDg1NzA2MjEzMw==","url":"https://api.github.com/repos/rclone/rclone/issues/events/857062133","actor":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2016-11-13T17:41:57Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/260209306","html_url":"https://github.com/rclone/rclone/issues/874#issuecomment-260209306","issue_url":"https://api.github.com/repos/rclone/rclone/issues/874","id":260209306,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MDIwOTMwNg==","user":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-11-13T20:13:36Z","updated_at":"2016-11-13T20:13:36Z","body":"You will always have an if/else to some extent, because ACD does _not_ support creating 0 byte files using chunked transfer encoding¹. And of course, for streaming upload the file size is not known in advance. So regardless of how you put it, there will always be two cases.\n\nBut that's not a big issue, because you can just try to read a byte and then act appropriately (or maybe use `bufio`'s `Peek`). Long story short, @ncw implicitly answered [my question from the other issue](https://github.com/ncw/rclone/issues/669#issuecomment-260124145) and I will make the hack I posted there into a decent patch. Incoming write support \\o/\n\n¹ I checked this ~6 months ago for acd_cli for a related issue, I guess this didn't change.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/260209306/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":857099076,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50ODU3MDk5MDc2","url":"https://api.github.com/repos/rclone/rclone/issues/events/857099076","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2016-11-13T20:13:36Z","performed_via_github_app":null},{"id":857099077,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDg1NzA5OTA3Nw==","url":"https://api.github.com/repos/rclone/rclone/issues/events/857099077","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2016-11-13T20:13:36Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/260244934","html_url":"https://github.com/rclone/rclone/issues/874#issuecomment-260244934","issue_url":"https://api.github.com/repos/rclone/rclone/issues/874","id":260244934,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MDI0NDkzNA==","user":{"login":"thechile","id":3511504,"node_id":"MDQ6VXNlcjM1MTE1MDQ=","avatar_url":"https://avatars.githubusercontent.com/u/3511504?v=4","gravatar_id":"","url":"https://api.github.com/users/thechile","html_url":"https://github.com/thechile","followers_url":"https://api.github.com/users/thechile/followers","following_url":"https://api.github.com/users/thechile/following{/other_user}","gists_url":"https://api.github.com/users/thechile/gists{/gist_id}","starred_url":"https://api.github.com/users/thechile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thechile/subscriptions","organizations_url":"https://api.github.com/users/thechile/orgs","repos_url":"https://api.github.com/users/thechile/repos","events_url":"https://api.github.com/users/thechile/events{/privacy}","received_events_url":"https://api.github.com/users/thechile/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-11-14T04:14:01Z","updated_at":"2016-11-14T04:14:01Z","body":"OK many thanks for the helpful info.. helped me understand. \n\n@breunigs Looking forward to testing the write support when it drops :) \n\nFor rsync i'd try something like this, just for file transfer functionality. Using `--size-only` should work around the time stamp issue and be accurate enough for my requirements. \n\n`rsync -v --inplace --size-only --whole-file --info=progress2 /path/to/src_files rclone_fuse_mnt/`\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/260244934/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"thechile","id":3511504,"node_id":"MDQ6VXNlcjM1MTE1MDQ=","avatar_url":"https://avatars.githubusercontent.com/u/3511504?v=4","gravatar_id":"","url":"https://api.github.com/users/thechile","html_url":"https://github.com/thechile","followers_url":"https://api.github.com/users/thechile/followers","following_url":"https://api.github.com/users/thechile/following{/other_user}","gists_url":"https://api.github.com/users/thechile/gists{/gist_id}","starred_url":"https://api.github.com/users/thechile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thechile/subscriptions","organizations_url":"https://api.github.com/users/thechile/orgs","repos_url":"https://api.github.com/users/thechile/repos","events_url":"https://api.github.com/users/thechile/events{/privacy}","received_events_url":"https://api.github.com/users/thechile/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":857269860,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50ODU3MjY5ODYw","url":"https://api.github.com/repos/rclone/rclone/issues/events/857269860","actor":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2016-11-14T04:14:01Z","performed_via_github_app":null},{"id":857269861,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDg1NzI2OTg2MQ==","url":"https://api.github.com/repos/rclone/rclone/issues/events/857269861","actor":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2016-11-14T04:14:01Z","performed_via_github_app":null},{"actor":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-11-17T20:53:16Z","updated_at":"2016-11-17T20:53:16Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/ncw/go-acd/issues/3","repository_url":"https://api.github.com/repos/ncw/go-acd","labels_url":"https://api.github.com/repos/ncw/go-acd/issues/3/labels{/name}","comments_url":"https://api.github.com/repos/ncw/go-acd/issues/3/comments","events_url":"https://api.github.com/repos/ncw/go-acd/issues/3/events","html_url":"https://github.com/ncw/go-acd/pull/3","id":190161032,"node_id":"MDExOlB1bGxSZXF1ZXN0OTQyNDgxODI=","number":3,"title":"automatic detection of zero byte files during upload","user":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-11-17T20:53:16Z","updated_at":"2016-11-19T09:39:16Z","closed_at":"2016-11-19T09:39:16Z","author_association":"NONE","active_lock_reason":null,"draft":false,"repository":{"id":41997585,"node_id":"MDEwOlJlcG9zaXRvcnk0MTk5NzU4NQ==","name":"go-acd","full_name":"ncw/go-acd","private":false,"owner":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"html_url":"https://github.com/ncw/go-acd","description":"Go library for accessing Amazon Cloud Drive","fork":true,"url":"https://api.github.com/repos/ncw/go-acd","forks_url":"https://api.github.com/repos/ncw/go-acd/forks","keys_url":"https://api.github.com/repos/ncw/go-acd/keys{/key_id}","collaborators_url":"https://api.github.com/repos/ncw/go-acd/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/ncw/go-acd/teams","hooks_url":"https://api.github.com/repos/ncw/go-acd/hooks","issue_events_url":"https://api.github.com/repos/ncw/go-acd/issues/events{/number}","events_url":"https://api.github.com/repos/ncw/go-acd/events","assignees_url":"https://api.github.com/repos/ncw/go-acd/assignees{/user}","branches_url":"https://api.github.com/repos/ncw/go-acd/branches{/branch}","tags_url":"https://api.github.com/repos/ncw/go-acd/tags","blobs_url":"https://api.github.com/repos/ncw/go-acd/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/ncw/go-acd/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/ncw/go-acd/git/refs{/sha}","trees_url":"https://api.github.com/repos/ncw/go-acd/git/trees{/sha}","statuses_url":"https://api.github.com/repos/ncw/go-acd/statuses/{sha}","languages_url":"https://api.github.com/repos/ncw/go-acd/languages","stargazers_url":"https://api.github.com/repos/ncw/go-acd/stargazers","contributors_url":"https://api.github.com/repos/ncw/go-acd/contributors","subscribers_url":"https://api.github.com/repos/ncw/go-acd/subscribers","subscription_url":"https://api.github.com/repos/ncw/go-acd/subscription","commits_url":"https://api.github.com/repos/ncw/go-acd/commits{/sha}","git_commits_url":"https://api.github.com/repos/ncw/go-acd/git/commits{/sha}","comments_url":"https://api.github.com/repos/ncw/go-acd/comments{/number}","issue_comment_url":"https://api.github.com/repos/ncw/go-acd/issues/comments{/number}","contents_url":"https://api.github.com/repos/ncw/go-acd/contents/{+path}","compare_url":"https://api.github.com/repos/ncw/go-acd/compare/{base}...{head}","merges_url":"https://api.github.com/repos/ncw/go-acd/merges","archive_url":"https://api.github.com/repos/ncw/go-acd/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/ncw/go-acd/downloads","issues_url":"https://api.github.com/repos/ncw/go-acd/issues{/number}","pulls_url":"https://api.github.com/repos/ncw/go-acd/pulls{/number}","milestones_url":"https://api.github.com/repos/ncw/go-acd/milestones{/number}","notifications_url":"https://api.github.com/repos/ncw/go-acd/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/ncw/go-acd/labels{/name}","releases_url":"https://api.github.com/repos/ncw/go-acd/releases{/id}","deployments_url":"https://api.github.com/repos/ncw/go-acd/deployments","created_at":"2015-09-06T09:51:27Z","updated_at":"2020-10-19T17:08:07Z","pushed_at":"2020-10-19T17:08:03Z","git_url":"git://github.com/ncw/go-acd.git","ssh_url":"git@github.com:ncw/go-acd.git","clone_url":"https://github.com/ncw/go-acd.git","svn_url":"https://github.com/ncw/go-acd","homepage":null,"size":48,"stargazers_count":5,"watchers_count":5,"language":"Go","has_issues":false,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":7,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":0,"license":{"key":"isc","name":"ISC License","spdx_id":"ISC","url":"https://api.github.com/licenses/isc","node_id":"MDc6TGljZW5zZTEw"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":7,"open_issues":0,"watchers":5,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/ncw/go-acd/pulls/3","html_url":"https://github.com/ncw/go-acd/pull/3","diff_url":"https://github.com/ncw/go-acd/pull/3.diff","patch_url":"https://github.com/ncw/go-acd/pull/3.patch","merged_at":null},"body":"This patch allows go-acd to upload zero byte files similarly to how it uploads other files. As I mentioned in https://github.com/ncw/rclone/issues/874#issuecomment-260209306, it's not possible to do this without any logic as AmazonDrive requires Content-Length to be set when uploading 0 byte files.\r\n\r\nI suggest to review using `git diff --patience` for a more pleasant diff.\r\n\r\nI kept the public \"Sized\" methods, although they are obsolete. I have a patch for rclone that stops calling them, so I can remove if you prefer.\r\n\r\nThe part to determine the content length for the 0 byte case is a bit ugly, but I have not found a better way to determine the size of a reader. And of course, go-acd's `Client.NewContentRequest` requires it to be an `io.Reader` again. This approach seemed to be the best of the bunch I tried, but I am open for suggestions.\r\n\r\nCheers\r\nStefan\r\n\r\nPS: I tested this using an rclone mount, and roughly this:\r\n```\r\necho -n '' > test && sleep 1 && [ -e test ] && [ ! -s test ] && echo \"Zero Byte Test Success\"\r\necho ' ' > test && sleep 1 && [ -e test ] && [ -s test ] && echo \"Two Byte Test Success\"\r\nmd5sum $(which rclone)\r\ncp $(which rclone) test && sleep 1 && md5sum test\r\ncat $(which rclone) > test && sleep 1 && md5sum test\r\n```","reactions":{"url":"https://api.github.com/repos/ncw/go-acd/issues/3/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ncw/go-acd/issues/3/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":865314652,"node_id":"MDEyOkxhYmVsZWRFdmVudDg2NTMxNDY1Mg==","url":"https://api.github.com/repos/rclone/rclone/issues/events/865314652","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2016-11-19T10:56:47Z","label":{"name":"enhancement","color":"84b6eb"},"performed_via_github_app":null},{"id":865314653,"node_id":"MDEyOkxhYmVsZWRFdmVudDg2NTMxNDY1Mw==","url":"https://api.github.com/repos/rclone/rclone/issues/events/865314653","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2016-11-19T10:56:47Z","label":{"name":"FUSE","color":"0e8a16"},"performed_via_github_app":null},{"id":865314682,"node_id":"MDE1Ok1pbGVzdG9uZWRFdmVudDg2NTMxNDY4Mg==","url":"https://api.github.com/repos/rclone/rclone/issues/events/865314682","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2016-11-19T10:56:54Z","milestone":{"title":"v1.35"},"performed_via_github_app":null},{"id":865314734,"node_id":"MDEyOkxhYmVsZWRFdmVudDg2NTMxNDczNA==","url":"https://api.github.com/repos/rclone/rclone/issues/events/865314734","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2016-11-19T10:57:06Z","label":{"name":"Remote: Amazon Cloud Drive","color":"fbca04"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/261707268","html_url":"https://github.com/rclone/rclone/issues/874#issuecomment-261707268","issue_url":"https://api.github.com/repos/rclone/rclone/issues/874","id":261707268,"node_id":"MDEyOklzc3VlQ29tbWVudDI2MTcwNzI2OA==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-11-19T10:57:17Z","updated_at":"2016-11-19T10:57:17Z","body":"This should be fixed in http://beta.rclone.org/v1.34-22-g0b562bc/ (will be uploaded in 15-30 mins)\n\nPlease re-open if it doesn't work for you.\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/261707268/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":865314946,"node_id":"MDExOkNsb3NlZEV2ZW50ODY1MzE0OTQ2","url":"https://api.github.com/repos/rclone/rclone/issues/events/865314946","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"1e41a015b5bcce912625880f07c8e43f02318942","commit_url":"https://api.github.com/repos/rclone/rclone/commits/1e41a015b5bcce912625880f07c8e43f02318942","created_at":"2016-11-19T10:58:00Z","state_reason":null,"performed_via_github_app":null}]