{"url":"https://api.github.com/repos/rclone/rclone/issues/2336","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/2336/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/2336/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/2336/events","html_url":"https://github.com/rclone/rclone/issues/2336","id":328837369,"node_id":"MDU6SXNzdWUzMjg4MzczNjk=","number":2336,"title":"Problem with Windows shadowcopy and junctions","user":{"login":"arfycat","id":3708619,"node_id":"MDQ6VXNlcjM3MDg2MTk=","avatar_url":"https://avatars.githubusercontent.com/u/3708619?v=4","gravatar_id":"","url":"https://api.github.com/users/arfycat","html_url":"https://github.com/arfycat","followers_url":"https://api.github.com/users/arfycat/followers","following_url":"https://api.github.com/users/arfycat/following{/other_user}","gists_url":"https://api.github.com/users/arfycat/gists{/gist_id}","starred_url":"https://api.github.com/users/arfycat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arfycat/subscriptions","organizations_url":"https://api.github.com/users/arfycat/orgs","repos_url":"https://api.github.com/users/arfycat/repos","events_url":"https://api.github.com/users/arfycat/events{/privacy}","received_events_url":"https://api.github.com/users/arfycat/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/29","html_url":"https://github.com/rclone/rclone/milestone/29","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/29/labels","id":3198914,"node_id":"MDk6TWlsZXN0b25lMzE5ODkxNA==","number":29,"title":"v1.42","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":20,"state":"closed","created_at":"2018-03-19T15:23:31Z","updated_at":"2018-06-17T16:06:33Z","due_on":"2018-06-17T07:00:00Z","closed_at":"2018-06-17T16:06:33Z"},"comments":9,"created_at":"2018-06-03T15:23:48Z","updated_at":"2018-06-10T23:38:06Z","closed_at":"2018-06-10T11:28:13Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### What is the problem you are having with rclone?\r\n\r\nI have a script which creates a Windows shadowcopy.  I then use rclone to sync the files to Google Drive.  When doing it on my Windows home directory (C:\\Users\\meow), it has issues as Windows has a bunch of Junctions it needs.\r\n\r\n> cd C:\\Users\\meow\r\n> dir /al\r\n\r\n```\r\n05/20/2018  01:05 AM    <JUNCTION>     Application Data [C:\\Users\\meow\\AppData\\Roaming]\r\n05/20/2018  01:05 AM    <JUNCTION>     Cookies [C:\\Users\\meow\\AppData\\Local\\Microsoft\\Windows\\INetCookies]\r\n05/20/2018  01:05 AM    <JUNCTION>     Local Settings [C:\\Users\\meow\\AppData\\Local]\r\n05/20/2018  01:05 AM    <JUNCTION>     My Documents [C:\\Users\\meow\\Documents]\r\n05/20/2018  01:05 AM    <JUNCTION>     NetHood [C:\\Users\\meow\\AppData\\Roaming\\Microsoft\\Windows\\Network Shortcuts]\r\n05/20/2018  01:05 AM    <JUNCTION>     PrintHood [C:\\Users\\meow\\AppData\\Roaming\\Microsoft\\Windows\\Printer Shortcuts]\r\n05/20/2018  01:05 AM    <JUNCTION>     Recent [C:\\Users\\meow\\AppData\\Roaming\\Microsoft\\Windows\\Recent]\r\n05/20/2018  01:05 AM    <JUNCTION>     SendTo [C:\\Users\\meow\\AppData\\Roaming\\Microsoft\\Windows\\SendTo]\r\n05/20/2018  01:05 AM    <JUNCTION>     Start Menu [C:\\Users\\meow\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu]\r\n05/20/2018  01:05 AM    <JUNCTION>     Templates [C:\\Users\\meow\\AppData\\Roaming\\Microsoft\\Windows\\Templates]\r\n```\r\n\r\nrclone gets an error on these junctions.\r\n\r\n\r\nBash (on Cygwin) Script:\r\nCreates a shadowcopy of C: and D:, then creates a link in C: and D: to the shadowcopy.  Runs rclone on the C: drive shadowcopy (the D: is unused) in the user's home directory.\r\n\r\n```\r\n#!/usr/bin/bash\r\n###############################################################################\r\n\r\nDATE=`date +%Y%m%d_%H%M%S`\r\nUUID=`uuidgen`\r\nLOG=\"rclone-GoogleDrive.${DATE}.log\"\r\nRCLONE=\"/cygdrive/c/Users/meow/Google Drive/Program Files/rclone/rclone.exe\"\r\n\r\n###############################################################################\r\n\r\nSHADOWID_C=`wmic shadowcopy call create Volume='C:\\' | grep ShadowID | awk {'print $NF'} | sed s/[^A-Z0-9\\-]//g`\r\nif [ \"${SHADOWID_C}\" == \"\" ] || [ \"${SHADOWID_D}\" == \"00000000-0000-0000-0000-000000000000\" ]; then\r\n\techo \"Failed to create shadow copy.\" >> ~/logs/${LOG}\r\n\texit\r\nfi\r\necho \"Shadow ID C: ${SHADOWID_C}\" >> ~/logs/${LOG}\r\nSHADOWID_D=`wmic shadowcopy call create Volume='D:\\' | grep ShadowID | awk {'print $NF'} | sed s/[^A-Z0-9\\-]//g`\r\nif [ \"${SHADOWID_D}\" == \"\" ] || [ \"${SHADOWID_D}\" == \"00000000-0000-0000-0000-000000000000\" ]; then\r\n\techo \"Failed to create shadow copy.\" >> ~/logs/${LOG}\r\n\texit\r\nfi\r\necho \"Shadow ID D: ${SHADOWID_D}\" >> ~/logs/${LOG}\r\n\r\nSHADOWVOL_C=`vssadmin list shadows /Shadow={${SHADOWID_C}} | grep 'Shadow Copy Volume' | awk {'print $NF'}`\r\nif [ \"${SHADOWVOL_C}\" == \"\" ]; then\r\n\techo \"Failed to list shadow copy by ID: ${SHADOWID_C}\" >> ~/logs/${LOG}\r\n\texit\r\nfi\r\necho \"Shadow Volume C: ${SHADOWVOL_C}\" >> ~/logs/${LOG}\r\nSHADOWVOL_D=`vssadmin list shadows /Shadow={${SHADOWID_D}} | grep 'Shadow Copy Volume' | awk {'print $NF'}`\r\nif [ \"${SHADOWVOL_D}\" == \"\" ]; then\r\n\techo \"Failed to list shadow copy by ID: ${SHADOWID_D}\" >> ~/logs/${LOG}\r\n\texit\r\nfi\r\necho \"Shadow Volume D: ${SHADOWVOL_D}\" >> ~/logs/${LOG}\r\n\r\ncmd /c mklink /D C:\\\\${UUID} ${SHADOWVOL_C}\\\\ >& /dev/null\r\nSHADOWDIR_C=/cygdrive/c/${UUID}\r\nSHADOWDIR_CW=C:\\\\${UUID}\r\nif [ `ls ${SHADOWDIR_C} 2>/dev/null | wc -l` -le 0 ]; then\r\n\techo \"Failed to list shadow copy directory: ${SHADOWDIR_C}\" >> ~/logs/${LOG}\r\n\texit\r\nfi\r\necho \"Shadow Directory C: ${SHADOWDIR_C}\" >> ~/logs/${LOG}\r\ncmd /c mklink /D D:\\\\${UUID} ${SHADOWVOL_D}\\\\ >& /dev/null\r\nSHADOWDIR_D=/cygdrive/d/${UUID}\r\nSHADOWDIR_DW=D:\\\\${UUID}\r\nif [ `ls ${SHADOWDIR_D} 2>/dev/null | wc -l` -le 0 ]; then\r\n\techo \"Failed to list shadow copy directory: ${SHADOWDIR_D}\" >> ~/logs/${LOG}\r\n\texit\r\nfi\r\necho \"Shadow Directory D: ${SHADOWDIR_D}\" >> ~/logs/${LOG}\r\n\r\n###############################################################################\r\n\r\n\"${RCLONE}\" sync ${SHADOWDIR_CW}\\\\Users\\\\meow GoogleDrive:/meow --exclude-from ${SHADOWDIR_CW}\\\\Users\\\\meow\\\\Google\\ Drive\\\\Cygwin\\\\home\\\\meow\\\\rclone.exclude --skip-links --delete-during --delete-excluded --backup-dir=GoogleDrive:/old/meow/${DATE} --log-file C:\\\\cygwin64\\\\tmp\\\\${LOG} -vv --track-renames --fast-list --local-no-check-updated\r\ncat /tmp/${LOG} >> ~/logs/${LOG}\r\nrm /tmp/${LOG}\r\n\r\n###############################################################################\r\n\r\ncmd /C rmdir ${SHADOWDIR_CW}\r\ncmd /C rmdir ${SHADOWDIR_DW}\r\n\r\nvssadmin delete shadows /Shadow={${SHADOWID_C}} /Quiet >& /dev/null\r\nvssadmin delete shadows /Shadow={${SHADOWID_D}} /Quiet >& /dev/null\r\n\r\n```\r\n\r\n#### What is your rclone version (eg output from `rclone -V`)\r\n\r\nrclone v1.41\r\n- os/arch: windows/amd64\r\n- go version: go1.10\r\n\r\n#### Which OS you are using and how many bits (eg Windows 7, 64 bit)\r\n\r\nWindows 10 Pro 64-bit\r\nMicrosoft Windows [Version 10.0.17134.48]\r\n\r\n####  Which cloud storage system are you using? (eg Google Drive)\r\n\r\nLocal  -> Google Drive\r\n\r\n#### The command you were trying to run (eg `rclone copy /tmp remote:tmp`)\r\n\r\n> \"${RCLONE}\" sync ${SHADOWDIR_CW}\\\\Users\\\\meow GoogleDrive:/meow --exclude-from ${SHADOWDIR_CW}\\\\Users\\\\meow\\\\Google\\ Drive\\\\Cygwin\\\\home\\\\meow\\\\rclone.exclude --skip-links --delete-during --delete-excluded --backup-dir=GoogleDrive:/old/meow/${DATE} --log-file C:\\\\cygwin64\\\\tmp\\\\${LOG} -vv --track-renames --fast-list --local-no-check-updated\r\n\r\n\r\n#### A log from the command with the `-vv` flag (eg output from `rclone -vv copy /tmp remote:tmp`)\r\n\r\n```\r\n2018/06/03 11:10:38 ERROR : Attempt 1/3 failed with 14 errors and: read \\\\?\\C:\\7e551a29-766f-4761-8289-252861cbba09\\Users\\meow\\AppData\\Local\\Temporary Internet Files: The handle is invalid.\r\n2018/06/03 11:10:38 DEBUG : Application Data: Clearing symlink bit to allow a file with reparse points to be copied\r\n2018/06/03 11:10:38 DEBUG : Cookies: Clearing symlink bit to allow a file with reparse points to be copied\r\n2018/06/03 11:10:38 DEBUG : Local Settings: Clearing symlink bit to allow a file with reparse points to be copied\r\n2018/06/03 11:10:38 DEBUG : My Documents: Clearing symlink bit to allow a file with reparse points to be copied\r\n2018/06/03 11:10:38 DEBUG : NetHood: Clearing symlink bit to allow a file with reparse points to be copied\r\n2018/06/03 11:10:38 DEBUG : PrintHood: Clearing symlink bit to allow a file with reparse points to be copied\r\n2018/06/03 11:10:38 DEBUG : Recent: Clearing symlink bit to allow a file with reparse points to be copied\r\n2018/06/03 11:10:38 DEBUG : SendTo: Clearing symlink bit to allow a file with reparse points to be copied\r\n2018/06/03 11:10:38 DEBUG : Start Menu: Clearing symlink bit to allow a file with reparse points to be copied\r\n2018/06/03 11:10:38 DEBUG : Templates: Clearing symlink bit to allow a file with reparse points to be copied\r\n```\r\n\r\n```\r\n2018/06/03 11:10:28 INFO  : Google drive root 'meow': Making map for --track-renames\r\n2018/06/03 11:10:28 INFO  : Google drive root 'meow': Finished making map for --track-renames\r\n2018/06/03 11:10:28 DEBUG : SendTo: Hash failed: hash: failed to read: read \\\\?\\C:\\7e551a29-766f-4761-8289-252861cbba09\\Users\\meow\\SendTo: The handle is invalid.\r\n2018/06/03 11:10:28 DEBUG : Cookies: Hash failed: hash: failed to read: read \\\\?\\C:\\7e551a29-766f-4761-8289-252861cbba09\\Users\\meow\\Cookies: The handle is invalid.\r\n2018/06/03 11:10:28 DEBUG : NetHood: Hash failed: hash: failed to read: read \\\\?\\C:\\7e551a29-766f-4761-8289-252861cbba09\\Users\\meow\\NetHood: The handle is invalid.\r\n2018/06/03 11:10:28 DEBUG : My Documents: Hash failed: hash: failed to open: open \\\\?\\C:\\7e551a29-766f-4761-8289-252861cbba09\\Users\\meow\\My Documents: Access is denied.\r\n2018/06/03 11:10:28 DEBUG : Recent: Hash failed: hash: failed to read: read \\\\?\\C:\\7e551a29-766f-4761-8289-252861cbba09\\Users\\meow\\Recent: The handle is invalid.\r\n2018/06/03 11:10:28 DEBUG : Local Settings: Hash failed: hash: failed to read: read \\\\?\\C:\\7e551a29-766f-4761-8289-252861cbba09\\Users\\meow\\Local Settings: The handle is invalid.\r\n2018/06/03 11:10:28 DEBUG : Start Menu: Hash failed: hash: failed to read: read \\\\?\\C:\\7e551a29-766f-4761-8289-252861cbba09\\Users\\meow\\Start Menu: The handle is invalid.\r\n2018/06/03 11:10:28 DEBUG : PrintHood: Hash failed: hash: failed to read: read \\\\?\\C:\\7e551a29-766f-4761-8289-252861cbba09\\Users\\meow\\PrintHood: The handle is invalid.\r\n2018/06/03 11:10:28 INFO  : Google drive root 'meow': Waiting for checks to finish\r\n2018/06/03 11:10:28 DEBUG : Application Data: Hash failed: hash: failed to read: read \\\\?\\C:\\7e551a29-766f-4761-8289-252861cbba09\\Users\\meow\\Application Data: The handle is invalid.\r\n2018/06/03 11:10:28 DEBUG : Templates: Hash failed: hash: failed to read: read \\\\?\\C:\\7e551a29-766f-4761-8289-252861cbba09\\Users\\meow\\Templates: The handle is invalid.\r\n2018/06/03 11:10:28 DEBUG : AppData/Local/History: Hash failed: hash: failed to read: read \\\\?\\C:\\7e551a29-766f-4761-8289-252861cbba09\\Users\\meow\\AppData\\Local\\History: The handle is invalid.\r\n2018/06/03 11:10:28 DEBUG : AppData/Local/Application Data: Hash failed: hash: failed to read: read \\\\?\\C:\\7e551a29-766f-4761-8289-252861cbba09\\Users\\meow\\AppData\\Local\\Application Data: The handle is invalid.\r\n2018/06/03 11:10:28 DEBUG : AppData/Local/Temporary Internet Files: Hash failed: hash: failed to read: read \\\\?\\C:\\7e551a29-766f-4761-8289-252861cbba09\\Users\\meow\\AppData\\Local\\Temporary Internet Files: The handle is invalid.\r\n2018/06/03 11:10:28 ERROR : My Documents: Failed to copy: failed to open source object: open \\\\?\\C:\\7e551a29-766f-4761-8289-252861cbba09\\Users\\meow\\My Documents: Access is denied.\r\n2018/06/03 11:10:28 DEBUG : AppData/Local/Microsoft/Windows/Temporary Internet Files: Hash failed: hash: failed to read: read \\\\?\\C:\\7e551a29-766f-4761-8289-252861cbba09\\Users\\meow\\AppData\\Local\\Microsoft\\Windows\\Temporary Internet Files: The handle is invalid.\r\n2018/06/03 11:10:29 ERROR : NetHood: Failed to copy: read \\\\?\\C:\\7e551a29-766f-4761-8289-252861cbba09\\Users\\meow\\NetHood: The handle is invalid.\r\n2018/06/03 11:10:29 ERROR : Recent: Failed to copy: read \\\\?\\C:\\7e551a29-766f-4761-8289-252861cbba09\\Users\\meow\\Recent: The handle is invalid.\r\n2018/06/03 11:10:29 ERROR : SendTo: Failed to copy: read \\\\?\\C:\\7e551a29-766f-4761-8289-252861cbba09\\Users\\meow\\SendTo: The handle is invalid.\r\n2018/06/03 11:10:29 ERROR : Cookies: Failed to copy: read \\\\?\\C:\\7e551a29-766f-4761-8289-252861cbba09\\Users\\meow\\Cookies: The handle is invalid.\r\n```\r\n","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/2336/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/2336/timeline","performed_via_github_app":null,"state_reason":"completed"}