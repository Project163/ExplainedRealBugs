{"url":"https://api.github.com/repos/rclone/rclone/issues/2912","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/2912/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/2912/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/2912/events","html_url":"https://github.com/rclone/rclone/issues/2912","id":399015490,"node_id":"MDU6SXNzdWUzOTkwMTU0OTA=","number":2912,"title":"rclone hangs on CLOSE when transferring large FTP files","user":{"login":"qwwqwwq","id":4935495,"node_id":"MDQ6VXNlcjQ5MzU0OTU=","avatar_url":"https://avatars.githubusercontent.com/u/4935495?v=4","gravatar_id":"","url":"https://api.github.com/users/qwwqwwq","html_url":"https://github.com/qwwqwwq","followers_url":"https://api.github.com/users/qwwqwwq/followers","following_url":"https://api.github.com/users/qwwqwwq/following{/other_user}","gists_url":"https://api.github.com/users/qwwqwwq/gists{/gist_id}","starred_url":"https://api.github.com/users/qwwqwwq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/qwwqwwq/subscriptions","organizations_url":"https://api.github.com/users/qwwqwwq/orgs","repos_url":"https://api.github.com/users/qwwqwwq/repos","events_url":"https://api.github.com/users/qwwqwwq/events{/privacy}","received_events_url":"https://api.github.com/users/qwwqwwq/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":608259284,"node_id":"MDU6TGFiZWw2MDgyNTkyODQ=","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20FTP","name":"Remote: FTP","color":"fbca04","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/33","html_url":"https://github.com/rclone/rclone/milestone/33","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/33/labels","id":3752396,"node_id":"MDk6TWlsZXN0b25lMzc1MjM5Ng==","number":33,"title":"v1.46","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":43,"state":"closed","created_at":"2018-10-19T14:56:28Z","updated_at":"2019-02-09T18:12:01Z","due_on":"2019-02-09T08:00:00Z","closed_at":"2019-02-09T18:11:23Z"},"comments":5,"created_at":"2019-01-14T18:24:24Z","updated_at":"2019-01-16T13:44:50Z","closed_at":"2019-01-16T13:44:28Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### What is the problem you are having with rclone?\r\n\r\nrclone is hanging when transferring large files from FTP to google storage, file size was about 36 GB. The files are successfully transferred to google storage, but rclone never exits.\r\n\r\nI captured this stackdump  (below) during the hang. I believe it shows the process is hanging waiting for a response after sending the remote FTP server the CLOSE command. Sending CLOSE is nice but not necessary to complete the transfer, so maybe we could add a timeout to that after which rclone gives up on hearing back a response to the CLOSE command.\r\n\r\n```\r\ngithub.com/ncw/rclone/vendor/github.com/spf13/cobra.(*Command).Execute(0x1cff800, 0xc00003c0b8, 0x0)\r\n        /home/travis/gopath/src/github.com/ncw/rclone/vendor/github.com/spf13/cobra/command.go:800 +0x2b\r\ngithub.com/ncw/rclone/cmd.Main()\r\n        /home/travis/gopath/src/github.com/ncw/rclone/cmd/cmd.go:482 +0x46\r\nmain.main()\r\n        /home/travis/gopath/src/github.com/ncw/rclone/rclone.go:13 +0x20\r\n\r\ngoroutine 32 [select]:\r\ngithub.com/ncw/rclone/cmd.startProgress.func2(0xc000a16cc0, 0xc0004fcf60, 0x1275688)\r\n        /home/travis/gopath/src/github.com/ncw/rclone/cmd/progress.go:49 +0x113\r\ncreated by github.com/ncw/rclone/cmd.startProgress\r\n        /home/travis/gopath/src/github.com/ncw/rclone/cmd/progress.go:41 +0xcf\r\n\r\ngoroutine 41 [IO wait, 8 minutes]:\r\ninternal/poll.runtime_pollWait(0x7f93b0e40e30, 0x72, 0xc0000ab7f8)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/runtime/netpoll.go:173 +0x66\r\ninternal/poll.(*pollDesc).wait(0xc0000fbd18, 0x72, 0xffffffffffffff00, 0x13a1ca0, 0x1c9d570)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/internal/poll/fd_poll_runtime.go:85 +0x9a\r\ninternal/poll.(*pollDesc).waitRead(0xc0000fbd18, 0xc000341000, 0x1000, 0x1000)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/internal/poll/fd_poll_runtime.go:90 +0x3d\r\ninternal/poll.(*FD).Read(0xc0000fbd00, 0xc000341000, 0x1000, 0x1000, 0x0, 0x0, 0x0)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/internal/poll/fd_unix.go:169 +0x179\r\nnet.(*netFD).Read(0xc0000fbd00, 0xc000341000, 0x1000, 0x1000, 0x1e, 0x1cfbbe0, 0x1d14d80)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/net/fd_unix.go:202 +0x4f\r\nnet.(*conn).Read(0xc000183900, 0xc000341000, 0x1000, 0x1000, 0x0, 0x0, 0x0)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/net/net.go:177 +0x68\r\nbufio.(*Reader).fill(0xc000257920)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/bufio/bufio.go:100 +0x106\r\nbufio.(*Reader).ReadSlice(0xc000257920, 0xb0cd0a, 0xc0002c8b60, 0xc000130a00, 0x0, 0x0, 0x18)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/bufio/bufio.go:341 +0x36\r\nbufio.(*Reader).ReadLine(0xc000257920, 0xc00003ae00, 0xc0000aba58, 0x43473c, 0xc00033d800, 0x300000002, 0xc00033d800)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/bufio/bufio.go:370 +0x34\r\nnet/textproto.(*Reader).readLineSlice(0xc00026a900, 0x43e7bc, 0xc0005aaf28, 0xc0000aba01, 0x43e69b, 0xc0005aaf28)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/net/textproto/reader.go:55 +0x6f\r\nnet/textproto.(*Reader).ReadLine(0xc00026a900, 0x0, 0x0, 0xc0000abb28, 0x43e5b9)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/net/textproto/reader.go:36 +0x2b\r\nnet/textproto.(*Reader).readCodeLine(0xc00026a900, 0xe2, 0x0, 0x0, 0xc0000abb90, 0x50eaef, 0xc0005aaf00, 0x0)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/net/textproto/reader.go:177 +0x2f\r\nnet/textproto.(*Reader).ReadResponse(0xc00026a900, 0xe2, 0x0, 0xc0000abc30, 0x4057bb, 0xc00042f200, 0x1276f88)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/net/textproto/reader.go:255 +0x4d\r\ngithub.com/ncw/rclone/vendor/github.com/jlaffaye/ftp.(*Response).Close(0xc000602600, 0xc0000abc58, 0xc0002c8b00)\r\n        /home/travis/gopath/src/github.com/ncw/rclone/vendor/github.com/jlaffaye/ftp/ftp.go:590 +0x89\r\ngithub.com/ncw/rclone/backend/ftp.(*ftpReadCloser).Close(0xc0006d5f80, 0xc0000b4977, 0x18)\r\n        /home/travis/gopath/src/github.com/ncw/rclone/backend/ftp/ftp.go:649 +0x37\r\ngithub.com/ncw/rclone/fs/asyncreader.(*AsyncReader).Close(0xc0002c8af0, 0xc0000b4977, 0x18)\r\n        /home/travis/gopath/src/github.com/ncw/rclone/fs/asyncreader/asyncreader.go:286 +0x62\r\ngithub.com/ncw/rclone/fs/accounting.(*Account).Close(0xc000104780, 0x0, 0x0)\r\n        /home/travis/gopath/src/github.com/ncw/rclone/fs/accounting/accounting.go:200 +0xe8\r\ngithub.com/ncw/rclone/fs/operations.Copy(0x13b6380, 0xc00035a680, 0x0, 0xc0002c8b60, 0xc0000b4977, 0x18, 0x13b6300, 0xc000602400, 0xc000a016e0, 0x4, ...)\r\n        /home/travis/gopath/src/github.com/ncw/rclone/fs/operations/operations.go:297 +0x1176\r\ngithub.com/ncw/rclone/fs/sync.(*syncCopyMove).pairCopyOrMove(0xc000976540, 0xc0001391c0, 0x13b6380, 0xc00035a680, 0xc000976618)\r\n        /home/travis/gopath/src/github.com/ncw/rclone/fs/sync/sync.go:280 +0x23c\r\ncreated by github.com/ncw/rclone/fs/sync.(*syncCopyMove).startTransfers\r\n        /home/travis/gopath/src/github.com/ncw/rclone/fs/sync/sync.go:306 +0x9f\r\n\r\ngoroutine 53 [chan receive, 30 minutes]:\r\ngithub.com/ncw/rclone/fs/march.(*March).Run.func2(0xc0000fb080, 0xc00002f860, 0xc000a16cf0)\r\n        /home/travis/gopath/src/github.com/ncw/rclone/fs/march/march.go:174 +0x4e\r\ncreated by github.com/ncw/rclone/fs/march.(*March).Run\r\n        /home/travis/gopath/src/github.com/ncw/rclone/fs/march/march.go:172 +0x240\r\n```\r\n\r\n#### What is your rclone version (output from `rclone version`)\r\n\r\nrclone v1.45\r\n- os/arch: linux/amd64\r\n- go version: go1.11.2\r\n\r\n#### Which OS you are using and how many bits (eg Windows 7, 64 bit)\r\n\r\nDebian stretch, 64bit\r\n\r\n####  Which cloud storage system are you using? (eg Google Drive)\r\n\r\nFTP -> Google Storage\r\n\r\n#### The command you were trying to run (eg `rclone copy /tmp remote:tmp`)\r\n\r\nrclone copy -P --ignore-checksum xxx:xxx  gcp:test-bucket/jq-test-rclone9\r\n\r\n#### A log from the command with the `-vv` flag (eg output from `rclone -vv copy /tmp remote:tmp`)\r\n\r\n```\r\n$ rclone copy -vv -P --ignore-checksum xxx:xxx  gcp:test-bucket/jq-test-rclone9\r\n2019/01/12 00:54:20 DEBUG : rclone: Version \"v1.45\" starting with parameters [\"rclone\" \"copy\" \"-vv\" \"-P\" \"--ignore-checksum\" â€œxxx:xxx\" \"gcp:test-bucket/jq-test-rclone9\"]\r\n2019/01/12 00:54:20 DEBUG : Using config file from \"/home/xxx/.config/rclone/rclone.conf\"\r\n2019/01/12 00:54:20 DEBUG : ftp://xxx.com:21/xxx: Connecting to FTP server\r\n2019-01-12 00:54:23 DEBUG : ftp://xxx.com:21/xxx: Connecting to FTP server\r\n2019-01-12 00:54:23 INFO  : Storage bucket btest-bucket path jq-test-rclone9/: Waiting for checks to finish\r\n2019-01-12 00:54:23 INFO  : Storage bucket test-bucket path jq-test-rclone9/: Waiting for transfers to finish\r\n2019-01-12 00:54:25 INFO  : xxx.csv.gz.SHA2: Copied (new)\r\nTransferred:       36.107G / 36.107 GBytes, 100%, 161.105 kBytes/s, ETA 0s\r\nErrors:                 0\r\nChecks:                 0 / 0, -\r\nTransferred:            1 / 2, 50%\r\nElapsed time:  65h16m44.8s\r\nTransferring:\r\n * xxx.csv.gz\r\n```\r\n\r\nAs you can see I let it run over the weekend, it hangs pretty much forever with this FTP server, which does not respond to the FTP CLOSE command.","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/2912/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/2912/timeline","performed_via_github_app":null,"state_reason":"completed"}