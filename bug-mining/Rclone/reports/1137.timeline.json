[{"id":7344308987,"node_id":"RTE_lADOAQ-n5M5RZSxGzwAAAAG1wUL7","url":"https://api.github.com/repos/rclone/rclone/issues/events/7344308987","actor":{"login":"sriccio","id":5239282,"node_id":"MDQ6VXNlcjUyMzkyODI=","avatar_url":"https://avatars.githubusercontent.com/u/5239282?v=4","gravatar_id":"","url":"https://api.github.com/users/sriccio","html_url":"https://github.com/sriccio","followers_url":"https://api.github.com/users/sriccio/followers","following_url":"https://api.github.com/users/sriccio/following{/other_user}","gists_url":"https://api.github.com/users/sriccio/gists{/gist_id}","starred_url":"https://api.github.com/users/sriccio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sriccio/subscriptions","organizations_url":"https://api.github.com/users/sriccio/orgs","repos_url":"https://api.github.com/users/sriccio/repos","events_url":"https://api.github.com/users/sriccio/events{/privacy}","received_events_url":"https://api.github.com/users/sriccio/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2022-09-08T06:02:00Z","rename":{"from":"FTP upload always delete file after upload","to":"FTP upload always delete file after upload when file size >40k"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1243638235","html_url":"https://github.com/rclone/rclone/issues/6426#issuecomment-1243638235","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6426","id":1243638235,"node_id":"IC_kwDOAQ-n5M5KIGnb","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-12T12:03:25Z","updated_at":"2022-09-12T12:03:25Z","body":"Can you do your transfer with FTP debugging enabled too?\r\n\r\n    rclone copy test.41K web23:/ -vv --log-file\" \"bug.log\" --dump headers --retries 1 --low-level-retries 1\r\n\r\nThis is the root cause of the problem\r\n\r\n```\r\n2022/09/08 07:49:57 DEBUG : test.41K: Removed after failed upload: 1 error occurred:\r\n        * 451 Error during read from data connection\r\nTransfer aborted\r\n0.002 seconds (measured here), 4.17 Mbytes per second\r\n```\r\n\r\nThis could be a networking problem. Maybe an MTU problem?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1243638235/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1243766893","html_url":"https://github.com/rclone/rclone/issues/6426#issuecomment-1243766893","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6426","id":1243766893,"node_id":"IC_kwDOAQ-n5M5KImBt","user":{"login":"sriccio","id":5239282,"node_id":"MDQ6VXNlcjUyMzkyODI=","avatar_url":"https://avatars.githubusercontent.com/u/5239282?v=4","gravatar_id":"","url":"https://api.github.com/users/sriccio","html_url":"https://github.com/sriccio","followers_url":"https://api.github.com/users/sriccio/followers","following_url":"https://api.github.com/users/sriccio/following{/other_user}","gists_url":"https://api.github.com/users/sriccio/gists{/gist_id}","starred_url":"https://api.github.com/users/sriccio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sriccio/subscriptions","organizations_url":"https://api.github.com/users/sriccio/orgs","repos_url":"https://api.github.com/users/sriccio/repos","events_url":"https://api.github.com/users/sriccio/events{/privacy}","received_events_url":"https://api.github.com/users/sriccio/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-12T13:44:52Z","updated_at":"2022-09-12T13:47:39Z","body":"Hello, thanks for your reply.\r\n\r\nHere is the log with dump headers\r\n\r\n```\r\n2022/09/12 15:18:10 DEBUG : rclone: Version \"v1.60.0-beta.6438.bd787e8f4\" starting with parameters [\"rclone\" \"copy\" \"test.41K\" \"web23:/test\" \"-vv\" \"--log-file\" \"bug.log\" \"--dump\" \"headers\" \"--retries\" \"1\" \"--low-level-retries\" \"1\"]\r\n2022/09/12 15:18:10 DEBUG : Creating backend with remote \"test.41K\"\r\n2022/09/12 15:18:10 DEBUG : Using config file from \"/root/.config/rclone/rclone.conf\"\r\n2022/09/12 15:18:10 DEBUG : fs cache: adding new entry for parent of \"test.41K\", \"/root\"\r\n2022/09/12 15:18:10 DEBUG : Creating backend with remote \"web23:/test\"\r\n2022/09/12 15:18:10 DEBUG : ftp://web23.somedomain.com:21/test: Connecting to FTP server\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"220---------- Welcome to Pure-FTPd [privsep] [TLS] ----------\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"220-You are user number 4 of 200 allowed.\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"220-Local time is now 15:18. Server port: 21.\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"220-This is a private system - No anonymous login\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"220 You will be disconnected after 15 minutes of inactivity.\"\r\n2022/09/12 15:18:10 DEBUG : FTP Tx: \"AUTH TLS\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"234 AUTH TLS OK.\"\r\n2022/09/12 15:18:10 DEBUG : FTP Tx: \"USER user\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"331 User user OK. Password required\"\r\n2022/09/12 15:18:10 DEBUG : FTP Tx: PASS *****\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"230-This server supports FXP transfers\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"230 OK. Current directory is /\"\r\n2022/09/12 15:18:10 DEBUG : FTP Tx: \"FEAT\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"211-Extensions supported:\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \" UTF8\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \" EPRT\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \" IDLE\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \" MDTM\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \" SIZE\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \" MFMT\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \" REST STREAM\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \" MLST type*;size*;sizd*;modify*;UNIX.mode*;UNIX.uid*;UNIX.gid*;unique*;\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \" MLSD\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \" PRET\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \" AUTH TLS\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \" PBSZ\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \" PROT\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \" ESTA\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \" PASV\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \" EPSV\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \" SPSV\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \" ESTP\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"211 End.\"\r\n2022/09/12 15:18:10 DEBUG : FTP Tx: \"TYPE I\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"200 TYPE is now 8-bit binary\"\r\n2022/09/12 15:18:10 DEBUG : FTP Tx: \"OPTS UTF8 ON\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"504 Unknown command\"\r\n2022/09/12 15:18:10 DEBUG : FTP Tx: \"PBSZ 0\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"200 PBSZ=0\"\r\n2022/09/12 15:18:10 DEBUG : FTP Tx: \"PROT P\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"200 Data protection level set to \\\"private\\\"\"\r\n2022/09/12 15:18:10 DEBUG : FTP Tx: \"PRET MLSD /\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"200 Ready to proceed\"\r\n2022/09/12 15:18:10 DEBUG : FTP Tx: \"EPSV\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"229 Extended Passive mode OK (|||47064|)\"\r\n2022/09/12 15:18:10 DEBUG : FTP Tx: \"MLSD /\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"150 Accepted data connection\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=cdir;sizd=4096;modify=20220912131726;UNIX.mode=0710;UNIX.uid=17441;UNIX.gid=17441;unique=810g5382; .\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=pdir;sizd=4096;modify=20220912131726;UNIX.mode=0710;UNIX.uid=17441;UNIX.gid=17441;unique=810g5382; ..\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=file;size=18;modify=20210421140404;UNIX.mode=0644;UNIX.uid=17441;UNIX.gid=17441;unique=810g5383; .bash_logout\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=file;size=141;modify=20210421140404;UNIX.mode=0644;UNIX.uid=17441;UNIX.gid=17441;unique=810g5384; .bash_profile\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=file;size=376;modify=20210421140404;UNIX.mode=0644;UNIX.uid=17441;UNIX.gid=17441;unique=810g5385; .bashrc\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=4096;modify=20220829132849;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g200001d5; .cl.selector\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=39;modify=20211001152700;UNIX.mode=0771;UNIX.uid=17441;UNIX.gid=17441;unique=810g400e119f; .cagefs\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=30;modify=20211012125621;UNIX.mode=0755;UNIX.uid=0;UNIX.gid=0;unique=810g200001de; backup\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=134;modify=20220830061456;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g6000014d; cybermind.ch\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=240;modify=20220901164534;UNIX.mode=0755;UNIX.uid=0;UNIX.gid=0;unique=810g5395; .data\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=file;size=1166;modify=20220912040246;UNIX.mode=0644;UNIX.uid=0;UNIX.gid=0;unique=810g5396; .htaccess\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=82;modify=20211007121906;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g200001e1; syndroma.ch\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=321;modify=20211205125404;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g200001ed; vinyls.syndroma.ch\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=29;modify=20211001153604;UNIX.mode=0700;UNIX.uid=17441;UNIX.gid=17441;unique=810g400e1156; .ssh\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=41;modify=20220119062248;UNIX.mode=0775;UNIX.uid=17441;UNIX.gid=17441;unique=810g2000f8bc; .config\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=33;modify=20220626071413;UNIX.mode=0775;UNIX.uid=17441;UNIX.gid=17441;unique=810g60011496; .cache\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=19;modify=20211001155744;UNIX.mode=0775;UNIX.uid=17441;UNIX.gid=17441;unique=810g2000f8bd; .local\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=file;size=24984;modify=20220830064608;UNIX.mode=0600;UNIX.uid=17441;UNIX.gid=17441;unique=810g227b3; .bash_history\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=4096;modify=20220829132550;UNIX.mode=0710;UNIX.uid=17441;UNIX.gid=17441;unique=810g400f7902; .awstats\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=83;modify=20220627085247;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g4046f8cf; logs\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=36;modify=20211029155901;UNIX.mode=0775;UNIX.uid=17441;UNIX.gid=17441;unique=810g2244c3fe; .composer\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=file;size=326;modify=20220722044553;UNIX.mode=0600;UNIX.uid=17441;UNIX.gid=17441;unique=810g733ebb; .mysql_history\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=120;modify=20220626181101;UNIX.mode=0775;UNIX.uid=17441;UNIX.gid=17441;unique=810g65c40134; .npm\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=file;size=978432;modify=20220617105458;UNIX.mode=0644;UNIX.uid=17441;UNIX.gid=17441;unique=810g8bf0d7e; .duc.db\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=88;modify=20220626023126;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g4053eeda; nodejs.cybermind.ch\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=88;modify=20220626071412;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g29dbbaf5; python.cybermind.ch\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=88;modify=20220704071929;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g8cb6cbc; ruby.cybermind.ch\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=21;modify=20220626072355;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g8f72883; .pip\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=file;size=0;modify=20220626072812;UNIX.mode=0600;UNIX.uid=17441;UNIX.gid=17441;unique=810g88068c7; .python_history\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=18;modify=20220627102422;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g23bf2570; nodevenv\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=85;modify=20220705072016;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g26544653; apps\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=18;modify=20220627103321;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g43db370d; virtualenv\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=36;modify=20220704074017;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g6204d26e; rubyvenv\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=28;modify=20220704071933;UNIX.mode=0775;UNIX.uid=17441;UNIX.gid=17441;unique=810g36a6d230; .passenger\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=19;modify=20220704073724;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g8046b5d0; .gem\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=71;modify=20220705154415;UNIX.mode=0755;UNIX.uid=1\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"7441;UNIX.gid=17441;unique=810g711e6b; pouette.cybermind.ch\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=71;modify=20220821051221;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g223ea462; yaya.cybermind.ch\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=71;modify=20211109130600;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810ga00039f5; bibounette.ch\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=20;modify=20220908004706;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g6f445d0e; home\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=6;modify=20220912131726;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g61878f8c; test\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"226 40 matches total\"\r\n2022/09/12 15:18:10 DEBUG : FTP Tx: \"PRET MLSD /test\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"200 Ready to proceed\"\r\n2022/09/12 15:18:10 DEBUG : FTP Tx: \"EPSV\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"229 Extended Passive mode OK (|||47798|)\"\r\n2022/09/12 15:18:10 DEBUG : FTP Tx: \"MLSD /test\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"150 Accepted data connection\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=cdir;sizd=6;modify=20220912131726;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g61878f8c; .\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=pdir;sizd=4096;modify=20220912131726;UNIX.mode=0710;UNIX.uid=17441;UNIX.gid=17441;unique=810g5382; ..\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"226 2 matches total\"\r\n2022/09/12 15:18:10 DEBUG : test.41K: Need to transfer - File not found at Destination\r\n2022/09/12 15:18:10 DEBUG : FTP Tx: \"PRET MLSD /\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"200 Ready to proceed\"\r\n2022/09/12 15:18:10 DEBUG : FTP Tx: \"EPSV\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"229 Extended Passive mode OK (|||47068|)\"\r\n2022/09/12 15:18:10 DEBUG : FTP Tx: \"MLSD /\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"150 Accepted data connection\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=cdir;sizd=4096;modify=20220912131726;UNIX.mode=0710;UNIX.uid=17441;UNIX.gid=17441;unique=810g5382; .\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=pdir;sizd=4096;modify=20220912131726;UNIX.mode=0710;UNIX.uid=17441;UNIX.gid=17441;unique=810g5382; ..\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=file;size=18;modify=20210421140404;UNIX.mode=0644;UNIX.uid=17441;UNIX.gid=17441;unique=810g5383; .bash_logout\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=file;size=141;modify=20210421140404;UNIX.mode=0644;UNIX.uid=17441;UNIX.gid=17441;unique=810g5384; .bash_profile\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=file;size=376;modify=20210421140404;UNIX.mode=0644;UNIX.uid=17441;UNIX.gid=17441;unique=810g5385; .bashrc\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=4096;modify=20220829132849;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g200001d5; .cl.selector\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=39;modify=20211001152700;UNIX.mode=0771;UNIX.uid=17441;UNIX.gid=17441;unique=810g400e119f; .cagefs\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=30;modify=20211012125621;UNIX.mode=0755;UNIX.uid=0;UNIX.gid=0;unique=810g200001de; backup\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=134;modify=20220830061456;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g6000014d; cybermind.ch\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=240;modify=20220901164534;UNIX.mode=0755;UNIX.uid=0;UNIX.gid=0;unique=810g5395; .data\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=file;size=1166;modify=20220912040246;UNIX.mode=0644;UNIX.uid=0;UNIX.gid=0;unique=810g5396; .htaccess\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=82;modify=20211007121906;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g200001e1; syndroma.ch\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=321;modify=20211205125404;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g200001ed; vinyls.syndroma.ch\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=29;modify=20211001153604;UNIX.mode=0700;UNIX.uid=17441;UNIX.gid=17441;unique=810g400e1156; .ssh\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=41;modify=20220119062248;UNIX.mode=0775;UNIX.uid=17441;UNIX.gid=17441;unique=810g2000f8bc; .config\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=33;modify=20220626071413;UNIX.mode=0775;UNIX.uid=17441;UNIX.gid=17441;unique=810g60011496; .cache\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=19;modify=20211001155744;UNIX.mode=0775;UNIX.uid=17441;UNIX.gid=17441;unique=810g2000f8bd; .local\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=file;size=24984;modify=20220830064608;UNIX.mode=0600;UNIX.uid=17441;UNIX.gid=17441;unique=810g227b3; .bash_history\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=4096;modify=20220829132550;UNIX.mode=0710;UNIX.uid=17441;UNIX.gid=17441;unique=810g400f7902; .awstats\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=83;modify=20220627085247;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g4046f8cf; logs\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=36;modify=20211029155901;UNIX.mode=0775;UNIX.uid=17441;UNIX.gid=17441;unique=810g2244c3fe; .composer\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=file;size=326;modify=20220722044553;UNIX.mode=0600;UNIX.uid=17441;UNIX.gid=17441;unique=810g733ebb; .mysql_history\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=120;modify=20220626181101;UNIX.mode=0775;UNIX.uid=17441;UNIX.gid=17441;unique=810g65c40134; .npm\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=file;size=978432;modify=20220617105458;UNIX.mode=0644;UNIX.uid=17441;UNIX.gid=17441;unique=810g8bf0d7e; .duc.db\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=88;modify=20220626023126;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g4053eeda; nodejs.cybermind.ch\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=88;modify=20220626071412;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g29dbbaf5; python.cybermind.ch\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=88;modify=20220704071929;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g8cb6cbc; ruby.cybermind.ch\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=21;modify=20220626072355;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g8f72883; .pip\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=file;size=0;modify=20220626072812;UNIX.mode=0600;UNIX.uid=17441;UNIX.gid=17441;unique=810g88068c7; .python_history\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=18;modify=20220627102422;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g23bf2570; nodevenv\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=85;modify=20220705072016;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g26544653; apps\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=18;modify=20220627103321;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g43db370d; virtualenv\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=36;modify=20220704074017;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g6204d26e; rubyvenv\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=28;modify=20220704071933;UNIX.mode=0775;UNIX.uid=17441;UNIX.gid=17441;unique=810g36a6d230; .passenger\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=19;modify=20220704073724;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g8046b5d0; .gem\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=71;modify=20220705154415;UNIX.mode=0755;UNIX.uid=1\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"7441;UNIX.gid=17441;unique=810g711e6b; pouette.cybermind.ch\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=71;modify=20220821051221;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g223ea462; yaya.cybermind.ch\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=71;modify=20211109130600;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810ga00039f5; bibounette.ch\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=20;modify=20220908004706;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g6f445d0e; home\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"type=dir;sizd=6;modify=20220912131726;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g61878f8c; test\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"226 40 matches total\"\r\n2022/09/12 15:18:10 DEBUG : FTP Tx: \"PRET STOR /test/test.41K\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"200 Ready to proceed\"\r\n2022/09/12 15:18:10 DEBUG : FTP Tx: \"EPSV\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"229 Extended Passive mode OK (|||47965|)\"\r\n2022/09/12 15:18:10 DEBUG : FTP Tx: \"STOR /test/test.41K\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"150 Accepted data connection\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"451-Error during read from data connection\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"451-Transfer aborted\"\r\n2022/09/12 15:18:10 DEBUG : FTP Rx: \"451 0.002 seconds (measured here), 16.31 Mbytes per second\"\r\n2022/09/12 15:18:10 DEBUG : FTP Tx: \"QUIT\"\r\n2022/09/12 15:18:11 DEBUG : ftp://web23.somedomain.com:21/test: Connecting to FTP server\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"220---------- Welcome to Pure-FTPd [privsep] [TLS] ----------\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"220-You are user number 3 of 200 allowed.\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"220-Local time is now 15:18. Server port: 21.\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"220-This is a private system - No anonymous login\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"220 You will be disconnected after 15 minutes of inactivity.\"\r\n2022/09/12 15:18:11 DEBUG : FTP Tx: \"AUTH TLS\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"234 AUTH TLS OK.\"\r\n2022/09/12 15:18:11 DEBUG : FTP Tx: \"USER user\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"331 User user OK. Password required\"\r\n2022/09/12 15:18:11 DEBUG : FTP Tx: PASS *****\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"230-This server supports FXP transfers\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"230 OK. Current directory is /\"\r\n2022/09/12 15:18:11 DEBUG : FTP Tx: \"FEAT\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"211-Extensions supported:\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \" UTF8\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \" EPRT\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \" IDLE\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \" MDTM\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \" SIZE\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \" MFMT\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \" REST STREAM\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \" MLST type*;size*;sizd*;modify*;UNIX.mode*;UNIX.uid*;UNIX.gid*;unique*;\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \" MLSD\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \" PRET\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \" AUTH TLS\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \" PBSZ\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \" PROT\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \" ESTA\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \" PASV\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \" EPSV\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \" SPSV\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \" ESTP\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"211 End.\"\r\n2022/09/12 15:18:11 DEBUG : FTP Tx: \"TYPE I\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"200 TYPE is now 8-bit binary\"\r\n2022/09/12 15:18:11 DEBUG : FTP Tx: \"OPTS UTF8 ON\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"504 Unknown command\"\r\n2022/09/12 15:18:11 DEBUG : FTP Tx: \"PBSZ 0\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"200 PBSZ=0\"\r\n2022/09/12 15:18:11 DEBUG : FTP Tx: \"PROT P\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"200 Data protection level set to \\\"private\\\"\"\r\n2022/09/12 15:18:11 DEBUG : FTP Tx: \"PRET MLSD /test\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"200 Ready to proceed\"\r\n2022/09/12 15:18:11 DEBUG : FTP Tx: \"EPSV\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"229 Extended Passive mode OK (|||47098|)\"\r\n2022/09/12 15:18:11 DEBUG : FTP Tx: \"MLSD /test\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"150 Accepted data connection\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"type=cdir;sizd=22;modify=20220912131810;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g61878f8c; .\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"type=pdir;sizd=4096;modify=20220912131726;UNIX.mode=0710;UNIX.uid=17441;UNIX.gid=17441;unique=810g5382; ..\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"type=file;size=32768;modify=20220912131810;UNIX.mode=0644;UNIX.uid=17441;UNIX.gid=17441;unique=810g618d0e40; test.41K\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"226 3 matches total\"\r\n2022/09/12 15:18:11 DEBUG : FTP Tx: \"DELE /test/test.41K\"\r\n2022/09/12 15:18:11 DEBUG : FTP Rx: \"250 Deleted /test/test.41K\"\r\n2022/09/12 15:18:11 DEBUG : test.41K: Removed after failed upload: 1 error occurred:\r\n        * 451 Error during read from data connection\r\nTransfer aborted\r\n0.002 seconds (measured here), 16.31 Mbytes per second\r\n\r\n2022/09/12 15:18:11 ERROR : test.41K: Failed to copy: update stor: 1 error occurred:\r\n        * 451 Error during read from data connection\r\nTransfer aborted\r\n0.002 seconds (measured here), 16.31 Mbytes per second\r\n\r\n2022/09/12 15:18:11 ERROR : Attempt 1/1 failed with 1 errors and: update stor: 1 error occurred:\r\n        * 451 Error during read from data connection\r\nTransfer aborted\r\n0.002 seconds (measured here), 16.31 Mbytes per second\r\n\r\n2022/09/12 15:18:11 INFO  : \r\nTransferred:           41 KiB / 41 KiB, 100%, 40.956 KiB/s, ETA 0s\r\nErrors:                 1 (retrying may help)\r\nElapsed time:         1.3s\r\n\r\n2022/09/12 15:18:11 DEBUG : 4 go routines active\r\n2022/09/12 15:18:11 DEBUG : ftp://web23.somedomain.com:21/test: closing 1 unused connections\r\n2022/09/12 15:18:11 DEBUG : FTP Tx: \"QUIT\"\r\n2022/09/12 15:18:11 Failed to copy: update stor: 1 error occurred:\r\n        * 451 Error during read from data connection\r\nTransfer aborted\r\n0.002 seconds (measured here), 16.31 Mbytes per second\r\n```\r\n\r\nOf interrest, I ran the test multiple times and always before it deletes the file, it lists it after the upload and it always has a size of `32768`.\r\n\r\n```\r\n\"type=file;size=32768;modify=20220912131810;UNIX.mode=0644;UNIX.uid=17441;UNIX.gid=17441;unique=810g618d0e40; test.41K\"\r\n```\r\nI also thought it could be a network issue but if I upload the file with `lftp` from the same box there is no issue.\r\nThe interface has no special MTU config\r\n\r\n```\r\nens18: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\r\n        inet 94.103.96.98  netmask 255.255.255.192  broadcast 94.103.96.127\r\n        inet6 2a00:a500:0:93::dead:beef  prefixlen 64  scopeid 0x0<global>\r\n        inet6 fe80::4c31:f1ff:fed0:6be  prefixlen 64  scopeid 0x20<link>\r\n        ether 4e:31:f1:d0:06:be  txqueuelen 1000  (Ethernet)\r\n        RX packets 815858748  bytes 2143486878198 (2.1 TB)\r\n        RX errors 0  dropped 10  overruns 0  frame 0\r\n        TX packets 573715544  bytes 12770280936843 (12.7 TB)\r\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\r\n```\r\n\r\nHowerver,  I discovered something that might be interresting; As both source and target have both `ipv4` and `ipv6`, `rclone` is using `ipv6` by default to upload the file.\r\n\r\nIf I force it to use `ipv4` (using the `ipv4` ipaddress in config instead of the `fqdn`) the upload is successful.\r\n\r\nThat could indicate a problem with our `ipv6` layer, but also my tests with `lftp` were using ipv6 and no issues are showing.\r\nCould it be a problem with `ipv6` in some libs used by `rclone` (for ftp handling?).\r\n\r\nMaybe you have the opportunity to try to reproduce the problem between two `ipv6` boxes to exclude this possibility ?\r\n\r\nThanks again","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1243766893/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sriccio","id":5239282,"node_id":"MDQ6VXNlcjUyMzkyODI=","avatar_url":"https://avatars.githubusercontent.com/u/5239282?v=4","gravatar_id":"","url":"https://api.github.com/users/sriccio","html_url":"https://github.com/sriccio","followers_url":"https://api.github.com/users/sriccio/followers","following_url":"https://api.github.com/users/sriccio/following{/other_user}","gists_url":"https://api.github.com/users/sriccio/gists{/gist_id}","starred_url":"https://api.github.com/users/sriccio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sriccio/subscriptions","organizations_url":"https://api.github.com/users/sriccio/orgs","repos_url":"https://api.github.com/users/sriccio/repos","events_url":"https://api.github.com/users/sriccio/events{/privacy}","received_events_url":"https://api.github.com/users/sriccio/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1243787427","html_url":"https://github.com/rclone/rclone/issues/6426#issuecomment-1243787427","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6426","id":1243787427,"node_id":"IC_kwDOAQ-n5M5KIrCj","user":{"login":"sriccio","id":5239282,"node_id":"MDQ6VXNlcjUyMzkyODI=","avatar_url":"https://avatars.githubusercontent.com/u/5239282?v=4","gravatar_id":"","url":"https://api.github.com/users/sriccio","html_url":"https://github.com/sriccio","followers_url":"https://api.github.com/users/sriccio/followers","following_url":"https://api.github.com/users/sriccio/following{/other_user}","gists_url":"https://api.github.com/users/sriccio/gists{/gist_id}","starred_url":"https://api.github.com/users/sriccio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sriccio/subscriptions","organizations_url":"https://api.github.com/users/sriccio/orgs","repos_url":"https://api.github.com/users/sriccio/repos","events_url":"https://api.github.com/users/sriccio/events{/privacy}","received_events_url":"https://api.github.com/users/sriccio/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-12T14:00:43Z","updated_at":"2022-09-12T14:00:43Z","body":"Could be related ?\r\n\r\nhttps://github.com/jlaffaye/ftp/issues/240\r\nand\r\nhttps://github.com/jlaffaye/ftp/issues/249\r\n\r\nI've set `disable_tls13 = true` and it now also works correctly with `ipv6`. That's interresting :)\r\n\r\n\r\n\r\n\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1243787427/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sriccio","id":5239282,"node_id":"MDQ6VXNlcjUyMzkyODI=","avatar_url":"https://avatars.githubusercontent.com/u/5239282?v=4","gravatar_id":"","url":"https://api.github.com/users/sriccio","html_url":"https://github.com/sriccio","followers_url":"https://api.github.com/users/sriccio/followers","following_url":"https://api.github.com/users/sriccio/following{/other_user}","gists_url":"https://api.github.com/users/sriccio/gists{/gist_id}","starred_url":"https://api.github.com/users/sriccio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sriccio/subscriptions","organizations_url":"https://api.github.com/users/sriccio/orgs","repos_url":"https://api.github.com/users/sriccio/repos","events_url":"https://api.github.com/users/sriccio/events{/privacy}","received_events_url":"https://api.github.com/users/sriccio/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1243895963","html_url":"https://github.com/rclone/rclone/issues/6426#issuecomment-1243895963","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6426","id":1243895963,"node_id":"IC_kwDOAQ-n5M5KJFib","user":{"login":"sriccio","id":5239282,"node_id":"MDQ6VXNlcjUyMzkyODI=","avatar_url":"https://avatars.githubusercontent.com/u/5239282?v=4","gravatar_id":"","url":"https://api.github.com/users/sriccio","html_url":"https://github.com/sriccio","followers_url":"https://api.github.com/users/sriccio/followers","following_url":"https://api.github.com/users/sriccio/following{/other_user}","gists_url":"https://api.github.com/users/sriccio/gists{/gist_id}","starred_url":"https://api.github.com/users/sriccio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sriccio/subscriptions","organizations_url":"https://api.github.com/users/sriccio/orgs","repos_url":"https://api.github.com/users/sriccio/repos","events_url":"https://api.github.com/users/sriccio/events{/privacy}","received_events_url":"https://api.github.com/users/sriccio/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-12T15:17:15Z","updated_at":"2022-09-12T15:17:15Z","body":"A bit off-topic or maybe somehow related I'm not sure but I noticed that 0 byte files upload are also a problem.\r\n\r\n```\r\nrclone copy 0byte.txt web23:/test -vv --log-file \"bug2.log\" --dump headers --retries 1 --low-level-retries 1\r\n```\r\n\r\n```\r\n2022/09/12 17:03:42 DEBUG : FTP Tx: \"EPSV\"\r\n2022/09/12 17:03:42 DEBUG : FTP Rx: \"229 Entering Extended Passive Mode (|||61575|)\"\r\n2022/09/12 17:03:42 DEBUG : FTP Tx: \"STOR /test/0byte.txt\"\r\n2022/09/12 17:03:42 DEBUG : FTP Rx: \"150 Opening BINARY mode SSL data connection for '/test/0byte.txt'.\"\r\n2022/09/12 17:03:42 DEBUG : FTP Rx: \"425 SSL_accept DATA connection error (null).: Success.\"\r\n2022/09/12 17:03:42 DEBUG : FTP Tx: \"QUIT\"\r\n```\r\n\r\nIf I put a content (one char) in 0byte.txt it works\r\n\r\n```\r\n2022/09/12 17:05:26 DEBUG : FTP Tx: \"EPSV\"\r\n2022/09/12 17:05:26 DEBUG : FTP Rx: \"229 Entering Extended Passive Mode (|||61436|)\"\r\n2022/09/12 17:05:26 DEBUG : FTP Tx: \"STOR /test/0byte.txt\"\r\n2022/09/12 17:05:26 DEBUG : FTP Rx: \"150 Opening BINARY mode SSL data connection for '/test/0byte.txt'.\"\r\n2022/09/12 17:05:26 DEBUG : FTP Rx: \"226 Transfer complete.\"\r\n2022/09/12 17:05:26 DEBUG : FTP Tx: \"MFMT 20220912150509 test/0byte.txt\"\r\n2022/09/12 17:05:26 DEBUG : FTP Rx: \"213 Modify=20220912150509; test/0byte.txt\"\r\n2022/09/12 17:05:26 DEBUG : FTP Tx: \"EPSV\"\r\n2022/09/12 17:05:26 DEBUG : FTP Rx: \"229 Entering Extended Passive Mode (|||61872|)\"\r\n```\r\n\r\nSeems to be related to explicit SSL ?\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1243895963/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sriccio","id":5239282,"node_id":"MDQ6VXNlcjUyMzkyODI=","avatar_url":"https://avatars.githubusercontent.com/u/5239282?v=4","gravatar_id":"","url":"https://api.github.com/users/sriccio","html_url":"https://github.com/sriccio","followers_url":"https://api.github.com/users/sriccio/followers","following_url":"https://api.github.com/users/sriccio/following{/other_user}","gists_url":"https://api.github.com/users/sriccio/gists{/gist_id}","starred_url":"https://api.github.com/users/sriccio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sriccio/subscriptions","organizations_url":"https://api.github.com/users/sriccio/orgs","repos_url":"https://api.github.com/users/sriccio/repos","events_url":"https://api.github.com/users/sriccio/events{/privacy}","received_events_url":"https://api.github.com/users/sriccio/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1243911912","html_url":"https://github.com/rclone/rclone/issues/6426#issuecomment-1243911912","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6426","id":1243911912,"node_id":"IC_kwDOAQ-n5M5KJJbo","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-12T15:28:38Z","updated_at":"2022-09-12T15:28:38Z","body":"> Of interrest, I ran the test multiple times and always before it deletes the file, it lists it after the upload and it always has a size of `32768`.\r\n\r\nSo one buffers worth...\r\n\r\n> ```\r\n> \"type=file;size=32768;modify=20220912131810;UNIX.mode=0644;UNIX.uid=17441;UNIX.gid=17441;unique=810g618d0e40; test.41K\"\r\n> ```\r\n> \r\n> I also thought it could be a network issue but if I upload the file with `lftp` from the same box there is no issue. The interface has no special MTU config\r\n\r\nOK\r\n\r\n> Howerver, I discovered something that might be interresting; As both source and target have both `ipv4` and `ipv6`, `rclone` is using `ipv6` by default to upload the file.\r\n> \r\n> If I force it to use `ipv4` (using the `ipv4` ipaddress in config instead of the `fqdn`) the upload is successful.\r\n> \r\n> That could indicate a problem with our `ipv6` layer, but also my tests with `lftp` were using ipv6 and no issues are showing. Could it be a problem with `ipv6` in some libs used by `rclone` (for ftp handling?).\r\n\r\nIts always a possibility, but if the connection got made then it is down to the kernel from that point from a basic networking point of view.\r\n\r\n> Could be related ?\r\n> \r\n> [jlaffaye/ftp#240](https://github.com/jlaffaye/ftp/issues/240)\r\n\r\nThis looks like exactly your problem\r\n\r\n> and [jlaffaye/ftp#249](https://github.com/jlaffaye/ftp/issues/249)\r\n> \r\n> I've set `disable_tls13 = true` and it now also works correctly with `ipv6`. That's interresting :)\r\n\r\nHmm, so some kind of TLS incompatibility that only happens over IPv6? Odd!\r\n\r\nThere is an excellent summary here of various TLS 1.3 incompatibilities: https://github.com/rclone/rclone/issues/5412#issuecomment-862626884 which possibly indicates that this is a problem in openssl.\r\n\r\nDisabling TLS1.3 seems like a good workaround for the moment!\r\n\r\n> A bit off-topic or maybe somehow related I'm not sure but I noticed that 0 byte files upload are also a problem.\r\n\r\nI'm pretty sure we've seen that before... The error `425 SSL_accept DATA connection error (null).: Success` makes me think that its a bug in pureftpd TLS. I can't find the reference though.\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1243911912/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1243959814","html_url":"https://github.com/rclone/rclone/issues/6426#issuecomment-1243959814","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6426","id":1243959814,"node_id":"IC_kwDOAQ-n5M5KJVIG","user":{"login":"sriccio","id":5239282,"node_id":"MDQ6VXNlcjUyMzkyODI=","avatar_url":"https://avatars.githubusercontent.com/u/5239282?v=4","gravatar_id":"","url":"https://api.github.com/users/sriccio","html_url":"https://github.com/sriccio","followers_url":"https://api.github.com/users/sriccio/followers","following_url":"https://api.github.com/users/sriccio/following{/other_user}","gists_url":"https://api.github.com/users/sriccio/gists{/gist_id}","starred_url":"https://api.github.com/users/sriccio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sriccio/subscriptions","organizations_url":"https://api.github.com/users/sriccio/orgs","repos_url":"https://api.github.com/users/sriccio/repos","events_url":"https://api.github.com/users/sriccio/events{/privacy}","received_events_url":"https://api.github.com/users/sriccio/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-12T16:05:38Z","updated_at":"2022-09-12T16:05:38Z","body":"> Hmm, so some kind of TLS incompatibility that only happens over IPv6? Odd!\r\n\r\nYes indeed, very strange.\r\n\r\n> There is an excellent summary here of various TLS 1.3 incompatibilities: https://github.com/rclone/rclone/issues/5412#issuecomment-862626884 which possibly indicates that this is a problem in openssl.\r\n\r\nThanks a lot. I'll take a look at it.\r\n\r\n> Disabling TLS1.3 seems like a good workaround for the moment!\r\n\r\nYes that's the way I'll be going for now :)\r\n\r\nAbout the empty file transfer glitch, and to be (almost) sure it's not a server issue, I've tried an empty file upload from lftp (same client machine as rclone):\r\n\r\n```\r\nlftp user@web23.somedomain.com:/test> put empty_file \r\n---> PASV\r\n<--- 227 Entering Passive Mode (94,103,96,188,240,62)\r\n---- Connecting data socket to (94.103.96.188) port 61502\r\n---- Data connection established                    \r\n---> STOR empty_file\r\n<--- 150 Opening BINARY mode SSL data connection for 'empty_file'.\r\n---- Closing data socket\r\n<--- 226 Transfer complete.                                \r\n---> MFMT 20220912155302 empty_file\r\n<--- 213 Modify=20220912155302; empty_file                 \r\n\r\nlftp user@web23.somedomain.com:/test> ls\r\n---> TYPE A\r\n<--- 200 Type set to A.              \r\n---> PASV\r\n<--- 227 Entering Passive Mode (94,103,96,188,240,72)\r\n---- Connecting data socket to (94.103.96.188) port 61512\r\n---- Data connection established       \r\n---> LIST\r\n<--- 150 Opening ASCII mode SSL data connection for 'file list'.\r\n---- Got EOF on data connection \r\n---- Closing data socket\r\n<--- 226 Transfer complete.\r\n-rwxr-xr-x   1 user users               0 Sep 12 15:53 empty_file\r\n```\r\n\r\nAnd also from a FTP client on Windows\r\n\r\n```\r\n[17:44:13] [L] TYPE I\r\n[17:44:13] [L] 200 Type set to I.\r\n[17:44:13] [L] PASV\r\n[17:44:13] [L] 227 Entering Passive Mode (94,103,96,188,240,19)\r\n[17:44:13] [L] Opening data connection IP: 94.103.96.188 PORT: 61459\r\n[17:44:14] [L] STOR 0byte.txt\r\n[17:44:14] [L] TLSv1.2 negotiation successful...\r\n[17:44:14] [L] TLSv1.2 encrypted session using cipher ECDHE-RSA-AES256-GCM-SHA384 (256 bits)\r\n[17:44:14] [L] 150 Opening BINARY mode SSL data connection for '0byte.txt'.\r\n[17:44:14] [L] 226 Transfer complete.\r\n[17:44:14] Upload: 0byte.txt 0 bytes in 0,05 seconds (0,0 KB/s)\r\n```\r\n\r\nFrom both, the empty file is transferred without any apparent issue.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1243959814/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sriccio","id":5239282,"node_id":"MDQ6VXNlcjUyMzkyODI=","avatar_url":"https://avatars.githubusercontent.com/u/5239282?v=4","gravatar_id":"","url":"https://api.github.com/users/sriccio","html_url":"https://github.com/sriccio","followers_url":"https://api.github.com/users/sriccio/followers","following_url":"https://api.github.com/users/sriccio/following{/other_user}","gists_url":"https://api.github.com/users/sriccio/gists{/gist_id}","starred_url":"https://api.github.com/users/sriccio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sriccio/subscriptions","organizations_url":"https://api.github.com/users/sriccio/orgs","repos_url":"https://api.github.com/users/sriccio/repos","events_url":"https://api.github.com/users/sriccio/events{/privacy}","received_events_url":"https://api.github.com/users/sriccio/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1243993039","html_url":"https://github.com/rclone/rclone/issues/6426#issuecomment-1243993039","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6426","id":1243993039,"node_id":"IC_kwDOAQ-n5M5KJdPP","user":{"login":"sriccio","id":5239282,"node_id":"MDQ6VXNlcjUyMzkyODI=","avatar_url":"https://avatars.githubusercontent.com/u/5239282?v=4","gravatar_id":"","url":"https://api.github.com/users/sriccio","html_url":"https://github.com/sriccio","followers_url":"https://api.github.com/users/sriccio/followers","following_url":"https://api.github.com/users/sriccio/following{/other_user}","gists_url":"https://api.github.com/users/sriccio/gists{/gist_id}","starred_url":"https://api.github.com/users/sriccio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sriccio/subscriptions","organizations_url":"https://api.github.com/users/sriccio/orgs","repos_url":"https://api.github.com/users/sriccio/repos","events_url":"https://api.github.com/users/sriccio/events{/privacy}","received_events_url":"https://api.github.com/users/sriccio/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-12T16:31:56Z","updated_at":"2022-09-12T16:45:54Z","body":"I tried with another  target FTP server (different daemon) and an empty file upload. It also \"QUIT\" right after the file upload.\r\n\r\n```\r\n2022/09/12 18:19:19 DEBUG : FTP Tx: \"PRET STOR /test/empty_file\"\r\n2022/09/12 18:19:19 DEBUG : FTP Rx: \"200 Ready to proceed\"\r\n2022/09/12 18:19:19 DEBUG : FTP Tx: \"EPSV\"\r\n2022/09/12 18:19:19 DEBUG : FTP Rx: \"229 Extended Passive mode OK (|||47968|)\"\r\n2022/09/12 18:19:19 DEBUG : FTP Tx: \"STOR /test/empty_file\"\r\n2022/09/12 18:19:19 DEBUG : FTP Rx: \"150 Accepted data connection\"\r\n2022/09/12 18:19:19 DEBUG : FTP Tx: \"QUIT\"\r\n[cut -- here it reconnects and list the file in the target directory, then delete the previously uploaded file ]\r\n2022/09/12 18:19:20 DEBUG : FTP Tx: \"MLSD /test\"\r\n2022/09/12 18:19:20 DEBUG : FTP Rx: \"150 Accepted data connection\"\r\n2022/09/12 18:19:20 DEBUG : FTP Rx: \"type=cdir;sizd=68;modify=20220912161919;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g61878f8c; .\"\r\n2022/09/12 18:19:20 DEBUG : FTP Rx: \"type=pdir;sizd=4096;modify=20220912161725;UNIX.mode=0710;UNIX.uid=17441;UNIX.gid=17441;unique=810g5382; ..\"\r\n2022/09/12 18:19:20 DEBUG : FTP Rx: \"type=file;size=0;modify=20220912161919;UNIX.mode=0644;UNIX.uid=17441;UNIX.gid=17441;unique=810g623f5cc8; empty_file\"\r\n2022/09/12 18:19:20 DEBUG : FTP Rx: \"226 3 matches total\"\r\n2022/09/12 18:19:20 DEBUG : FTP Tx: \"DELE /test/empty_file\"\r\n2022/09/12 18:19:20 DEBUG : FTP Rx: \"250 Deleted /test/empty_file\"\r\n2022/09/12 18:19:20 DEBUG : empty_file: Removed after failed upload: 1 error occurred:\r\n        * EOF\r\n2022/09/12 18:19:20 ERROR : empty_file: Failed to copy: update stor: 1 error occurred:\r\n        * EOF\r\n2022/09/12 18:19:20 ERROR : Attempt 1/1 failed with 1 errors and: update stor: 1 error occurred:\r\n```\r\n\r\nIf I transfer a file with content (2 bytes), it receive back a 226 answer from server and proceed file updating file timestamp (if I understand correctly) :\r\n\r\n```\r\n2022/09/12 18:23:27 DEBUG : FTP Tx: \"PRET STOR /test/not_empty_file\"\r\n2022/09/12 18:23:27 DEBUG : FTP Rx: \"200 Ready to proceed\"\r\n2022/09/12 18:23:27 DEBUG : FTP Tx: \"EPSV\"\r\n2022/09/12 18:23:27 DEBUG : FTP Rx: \"229 Extended Passive mode OK (|||47687|)\"\r\n2022/09/12 18:23:27 DEBUG : FTP Tx: \"STOR /test/not_empty_file\"\r\n2022/09/12 18:23:27 DEBUG : FTP Rx: \"150 Accepted data connection\"\r\n2022/09/12 18:23:27 DEBUG : FTP Rx: \"226-File successfully transferred\"\r\n2022/09/12 18:23:27 DEBUG : FTP Rx: \"226 0.000 seconds (measured here), 24.38 Kbytes per second\"\r\n2022/09/12 18:23:27 DEBUG : FTP Tx: \"MFMT 20220912162324 /test/not_empty_file\"\r\n```\r\n\r\nCould it be the file time stamp not being updated when it's an empty file, the reason why it keeps on deleting it ?\r\n\r\nStill with lftp and the windows client there is a \"226 Transfer complete\" returned from the server. Not sure why rclone is not receiving this though.\r\n\r\nEDIT: To check that the two remote FTP servers I've tested correctly answer after a file upload (empty file or not) I ran a quick test from the windows FTP client (FlashFXP).\r\n\r\n```\r\n[pure-ftpd - empty file]\r\n\r\n[18:39:36] [L] 226 File successfully transferred\r\n[18:39:36] Upload: 0byte.txt 0 bytes in 0,01 seconds (0,0 KB/s)\r\n\r\n[pure-ftpd - file with content]\r\n\r\n[18:39:48] [L] 226-File successfully transferred\r\n[18:39:48] [L] 226 1.223 seconds (measured here), 4.19 Mbytes per second\r\n[18:39:48] Upload: adm.rar 5,12 MB in 1 second (4,16 MB/s)\r\n\r\n[smbftpd (synology) - empty file]\r\n\r\n[18:42:10] [L] 226 Transfer complete.\r\n[18:42:10] Upload: 0byte.txt 0 bytes in 0,06 seconds (0,0 KB/s)\r\n\r\n[smbftpd (synology) - file with content]\r\n\r\n[18:42:14] [L] 226 Transfer complete.\r\n[18:42:14] Upload: adm.rar 5,12 MB in 1 second (3,74 MB/s)\r\n```\r\n\r\nOn all transfers it returns the 226 message. Tt seems rclone is not getting it or close the connection before getting it.\r\n\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1243993039/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sriccio","id":5239282,"node_id":"MDQ6VXNlcjUyMzkyODI=","avatar_url":"https://avatars.githubusercontent.com/u/5239282?v=4","gravatar_id":"","url":"https://api.github.com/users/sriccio","html_url":"https://github.com/sriccio","followers_url":"https://api.github.com/users/sriccio/followers","following_url":"https://api.github.com/users/sriccio/following{/other_user}","gists_url":"https://api.github.com/users/sriccio/gists{/gist_id}","starred_url":"https://api.github.com/users/sriccio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sriccio/subscriptions","organizations_url":"https://api.github.com/users/sriccio/orgs","repos_url":"https://api.github.com/users/sriccio/repos","events_url":"https://api.github.com/users/sriccio/events{/privacy}","received_events_url":"https://api.github.com/users/sriccio/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7375725044,"node_id":"REFE_lADOAQ-n5M5RZSxGzwAAAAG3oKH0","url":"https://api.github.com/repos/rclone/rclone/issues/events/7375725044","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"4a476da9c367005c8104564bdc2948861d0e9eeb","commit_url":"https://api.github.com/repos/ncw/ftp/commits/4a476da9c367005c8104564bdc2948861d0e9eeb","created_at":"2022-09-13T11:30:31Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1245284799","html_url":"https://github.com/rclone/rclone/issues/6426#issuecomment-1245284799","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6426","id":1245284799,"node_id":"IC_kwDOAQ-n5M5KOYm_","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-13T11:36:38Z","updated_at":"2022-09-13T11:36:38Z","body":"I remember (finally!) why this rings a bell.\r\n\r\nThis is a bug I fixed in the upstream library already: https://github.com/jlaffaye/ftp/pull/221\r\n\r\nIt looks like the code I added got accidentally removed.\r\n\r\nCan you try this which contains the patched library and if that works, I'll submit it upstream again!\r\n\r\n[v1.60.0-beta.6442.ae38d8ed8.fix-6426-ftp-zero-length](https://beta.rclone.org/branch/fix-6426-ftp-zero-length/v1.60.0-beta.6442.ae38d8ed8.fix-6426-ftp-zero-length/) on branch [fix-6426-ftp-zero-length](https://github.com/rclone/rclone/tree/fix-6426-ftp-zero-length) (uploaded in 15-30 mins)\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1245284799/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1245518340","html_url":"https://github.com/rclone/rclone/issues/6426#issuecomment-1245518340","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6426","id":1245518340,"node_id":"IC_kwDOAQ-n5M5KPRoE","user":{"login":"sriccio","id":5239282,"node_id":"MDQ6VXNlcjUyMzkyODI=","avatar_url":"https://avatars.githubusercontent.com/u/5239282?v=4","gravatar_id":"","url":"https://api.github.com/users/sriccio","html_url":"https://github.com/sriccio","followers_url":"https://api.github.com/users/sriccio/followers","following_url":"https://api.github.com/users/sriccio/following{/other_user}","gists_url":"https://api.github.com/users/sriccio/gists{/gist_id}","starred_url":"https://api.github.com/users/sriccio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sriccio/subscriptions","organizations_url":"https://api.github.com/users/sriccio/orgs","repos_url":"https://api.github.com/users/sriccio/repos","events_url":"https://api.github.com/users/sriccio/events{/privacy}","received_events_url":"https://api.github.com/users/sriccio/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-13T14:43:19Z","updated_at":"2022-09-13T14:43:19Z","body":"Hello,\r\n\r\nOh okay, thanks !\r\n\r\nHmm, the folder of the build contains binaries for free/netbsd but not for linux :)\r\n\r\nI guess I could compile it from source but maybe there was an issue on the CI that prevented all binaries to be built ?\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1245518340/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sriccio","id":5239282,"node_id":"MDQ6VXNlcjUyMzkyODI=","avatar_url":"https://avatars.githubusercontent.com/u/5239282?v=4","gravatar_id":"","url":"https://api.github.com/users/sriccio","html_url":"https://github.com/sriccio","followers_url":"https://api.github.com/users/sriccio/followers","following_url":"https://api.github.com/users/sriccio/following{/other_user}","gists_url":"https://api.github.com/users/sriccio/gists{/gist_id}","starred_url":"https://api.github.com/users/sriccio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sriccio/subscriptions","organizations_url":"https://api.github.com/users/sriccio/orgs","repos_url":"https://api.github.com/users/sriccio/repos","events_url":"https://api.github.com/users/sriccio/events{/privacy}","received_events_url":"https://api.github.com/users/sriccio/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7377857894,"node_id":"LE_lADOAQ-n5M5RZSxGzwAAAAG3wS1m","url":"https://api.github.com/repos/rclone/rclone/issues/events/7377857894","actor":{"login":"animosity022","id":5088712,"node_id":"MDQ6VXNlcjUwODg3MTI=","avatar_url":"https://avatars.githubusercontent.com/u/5088712?v=4","gravatar_id":"","url":"https://api.github.com/users/animosity022","html_url":"https://github.com/animosity022","followers_url":"https://api.github.com/users/animosity022/followers","following_url":"https://api.github.com/users/animosity022/following{/other_user}","gists_url":"https://api.github.com/users/animosity022/gists{/gist_id}","starred_url":"https://api.github.com/users/animosity022/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/animosity022/subscriptions","organizations_url":"https://api.github.com/users/animosity022/orgs","repos_url":"https://api.github.com/users/animosity022/repos","events_url":"https://api.github.com/users/animosity022/events{/privacy}","received_events_url":"https://api.github.com/users/animosity022/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-09-13T15:32:43Z","label":{"name":"Remote: FTP","color":"fbca04"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1246005898","html_url":"https://github.com/rclone/rclone/issues/6426#issuecomment-1246005898","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6426","id":1246005898,"node_id":"IC_kwDOAQ-n5M5KRIqK","user":{"login":"sriccio","id":5239282,"node_id":"MDQ6VXNlcjUyMzkyODI=","avatar_url":"https://avatars.githubusercontent.com/u/5239282?v=4","gravatar_id":"","url":"https://api.github.com/users/sriccio","html_url":"https://github.com/sriccio","followers_url":"https://api.github.com/users/sriccio/followers","following_url":"https://api.github.com/users/sriccio/following{/other_user}","gists_url":"https://api.github.com/users/sriccio/gists{/gist_id}","starred_url":"https://api.github.com/users/sriccio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sriccio/subscriptions","organizations_url":"https://api.github.com/users/sriccio/orgs","repos_url":"https://api.github.com/users/sriccio/repos","events_url":"https://api.github.com/users/sriccio/events{/privacy}","received_events_url":"https://api.github.com/users/sriccio/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-13T22:18:27Z","updated_at":"2022-09-13T22:20:07Z","body":"I compiled it and gave it a shot, but seems this build is broken.\r\n\r\nIt hangs at the first MLSD to list remote content\r\n\r\n```\r\n2022/09/14 00:10:36 DEBUG : FTP Rx: \"200 Ready to proceed\"\r\n2022/09/14 00:10:36 DEBUG : FTP Tx: \"EPSV\"\r\n2022/09/14 00:10:36 DEBUG : FTP Rx: \"229 Extended Passive mode OK (|||47422|)\"\r\n2022/09/14 00:10:36 DEBUG : FTP Tx: \"MLSD /\"\r\n2022/09/14 00:15:36 DEBUG : FTP Tx: \"NOOP\"\r\n2022/09/14 00:15:36 DEBUG : ftp://web23.somedomain.com:21/test: Connection failed, closing: write tcp [2a00:xxx:0:93::dead:beef]:54696->[2a00:xxx:0:96::188]:21: use of closed network connection\r\n```\r\n\r\n```\r\nsnowden@paradise:~/go/src/github.com/rclone# ./rclone version\r\nrclone v1.60.0-DEV\r\n- os/version: ubuntu 22.04 (64 bit)\r\n- os/kernel: 5.15.0-47-generic (x86_64)\r\n- os/type: linux\r\n- os/arch: amd64\r\n- go/version: go1.18.1\r\n- go/linking: dynamic\r\n- go/tags: none\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1246005898/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sriccio","id":5239282,"node_id":"MDQ6VXNlcjUyMzkyODI=","avatar_url":"https://avatars.githubusercontent.com/u/5239282?v=4","gravatar_id":"","url":"https://api.github.com/users/sriccio","html_url":"https://github.com/sriccio","followers_url":"https://api.github.com/users/sriccio/followers","following_url":"https://api.github.com/users/sriccio/following{/other_user}","gists_url":"https://api.github.com/users/sriccio/gists{/gist_id}","starred_url":"https://api.github.com/users/sriccio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sriccio/subscriptions","organizations_url":"https://api.github.com/users/sriccio/orgs","repos_url":"https://api.github.com/users/sriccio/repos","events_url":"https://api.github.com/users/sriccio/events{/privacy}","received_events_url":"https://api.github.com/users/sriccio/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7382884381,"node_id":"REFE_lADOAQ-n5M5RZSxGzwAAAAG4DeAd","url":"https://api.github.com/repos/rclone/rclone/issues/events/7382884381","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"a2f63f63c5ce3a9c440ee7f0da6c65a86a2373af","commit_url":"https://api.github.com/repos/ncw/ftp/commits/a2f63f63c5ce3a9c440ee7f0da6c65a86a2373af","created_at":"2022-09-14T07:17:42Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1246356604","html_url":"https://github.com/rclone/rclone/issues/6426#issuecomment-1246356604","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6426","id":1246356604,"node_id":"IC_kwDOAQ-n5M5KSeR8","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-14T07:27:20Z","updated_at":"2022-09-14T07:27:20Z","body":"I've fixed the build here - can you give this a try please?\r\n\r\n[v1.60.0-beta.6442.03f7c993a.fix-6426-ftp-zero-length](https://beta.rclone.org/branch/fix-6426-ftp-zero-length/v1.60.0-beta.6442.03f7c993a.fix-6426-ftp-zero-length/) on branch [fix-6426-ftp-zero-length](https://github.com/rclone/rclone/tree/fix-6426-ftp-zero-length) (uploaded in 15-30 mins)\r\n\r\n> I compiled it and gave it a shot, but seems this build is broken.\r\n> \r\n> It hangs at the first MLSD to list remote content\r\n\r\nThe only thing this has changed from [the latest beta](https://beta.rclone.org/) is to add my patch to fix the TLS problem and upgrade the ftp library with these commits https://github.com/jlaffaye/ftp/compare/11536801d1ff...master\r\n\r\nSo either my patch is broken or one of those commits introduced a new problem.\r\n\r\nAssuming the latter, I made another version which rebases my patch on the FTP library version that rclone was using previously in the beta, so there is only one change - my patch.\r\n\r\n[v1.60.0-beta.6442.bc111faaa.fix-ftp-error-11536801d1ff](https://beta.rclone.org/branch/fix-ftp-error-11536801d1ff/v1.60.0-beta.6442.bc111faaa.fix-ftp-error-11536801d1ff/) on branch [fix-ftp-error-11536801d1ff](https://github.com/rclone/rclone/tree/fix-ftp-error-11536801d1ff) (uploaded in 15-30 mins)\r\n\r\nCan you give that a go too please?\r\n\r\nIf that works, I'll submit the patch upstream and we can work on narrowing down which upstream change broke things for you.\r\n\r\nIf it doesn't work then my patch must be the problem and I'll stare at it some more!","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1246356604/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1246587454","html_url":"https://github.com/rclone/rclone/issues/6426#issuecomment-1246587454","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6426","id":1246587454,"node_id":"IC_kwDOAQ-n5M5KTWo-","user":{"login":"sriccio","id":5239282,"node_id":"MDQ6VXNlcjUyMzkyODI=","avatar_url":"https://avatars.githubusercontent.com/u/5239282?v=4","gravatar_id":"","url":"https://api.github.com/users/sriccio","html_url":"https://github.com/sriccio","followers_url":"https://api.github.com/users/sriccio/followers","following_url":"https://api.github.com/users/sriccio/following{/other_user}","gists_url":"https://api.github.com/users/sriccio/gists{/gist_id}","starred_url":"https://api.github.com/users/sriccio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sriccio/subscriptions","organizations_url":"https://api.github.com/users/sriccio/orgs","repos_url":"https://api.github.com/users/sriccio/repos","events_url":"https://api.github.com/users/sriccio/events{/privacy}","received_events_url":"https://api.github.com/users/sriccio/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-14T10:49:37Z","updated_at":"2022-09-14T10:53:10Z","body":"Thanks !\r\n\r\n> I've fixed the build here - can you give this a try please?\r\n> \r\n> [v1.60.0-beta.6442.03f7c993a.fix-6426-ftp-zero-length](https://beta.rclone.org/branch/fix-6426-ftp-zero-length/v1.60.0-beta.6442.03f7c993a.fix-6426-ftp-zero-length/) on branch [fix-6426-ftp-zero-length](https://github.com/rclone/rclone/tree/fix-6426-ftp-zero-length) (uploaded in 15-30 mins)\r\n> \r\n\r\nThis one still hangs at first MLSD /, so yes there must be another change breaking it.\r\n\r\n> [v1.60.0-beta.6442.bc111faaa.fix-ftp-error-11536801d1ff](https://beta.rclone.org/branch/fix-ftp-error-11536801d1ff/v1.60.0-beta.6442.bc111faaa.fix-ftp-error-11536801d1ff/) on branch [fix-ftp-error-11536801d1ff](https://github.com/rclone/rclone/tree/fix-ftp-error-11536801d1ff) (uploaded in 15-30 mins)\r\n\r\nThis one on the other hand is looking good. The empty_file is now transferred successfully !\r\n\r\n\r\n```\r\n2022/09/14 12:51:53 DEBUG : FTP Tx: \"PRET STOR /test/empty_file\"\r\n2022/09/14 12:51:53 DEBUG : FTP Rx: \"200 Ready to proceed\"\r\n2022/09/14 12:51:53 DEBUG : FTP Tx: \"EPSV\"\r\n2022/09/14 12:51:53 DEBUG : FTP Rx: \"229 Extended Passive mode OK (|||47733|)\"\r\n2022/09/14 12:51:53 DEBUG : FTP Tx: \"STOR /test/empty_file\"\r\n2022/09/14 12:51:53 DEBUG : FTP Rx: \"150 Accepted data connection\"\r\n2022/09/14 12:51:53 DEBUG : FTP Rx: \"226 File successfully transferred\"\r\n2022/09/14 12:51:53 DEBUG : FTP Tx: \"MFMT 20220914105012 /test/empty_file\"\r\n2022/09/14 12:51:53 DEBUG : FTP Rx: \"213 UTIME OK\"\r\n2022/09/14 12:51:53 DEBUG : FTP Tx: \"PRET MLSD /test\"\r\n2022/09/14 12:51:53 DEBUG : FTP Rx: \"200 Ready to proceed\"\r\n2022/09/14 12:51:53 DEBUG : FTP Tx: \"EPSV\"\r\n2022/09/14 12:51:53 DEBUG : FTP Rx: \"229 Extended Passive mode OK (|||47814|)\"\r\n2022/09/14 12:51:53 DEBUG : FTP Tx: \"MLSD /test\"\r\n2022/09/14 12:51:53 DEBUG : FTP Rx: \"150 Accepted data connection\"\r\n2022/09/14 12:51:53 DEBUG : FTP Rx: \"type=cdir;sizd=24;modify=20220914105153;UNIX.mode=0755;UNIX.uid=17441;UNIX.gid=17441;unique=810g62386172; .\"\r\n2022/09/14 12:51:53 DEBUG : FTP Rx: \"type=pdir;sizd=4096;modify=20220913061252;UNIX.mode=0710;UNIX.uid=17441;UNIX.gid=17441;unique=810g5382; ..\"\r\n2022/09/14 12:51:53 DEBUG : FTP Rx: \"type=file;size=0;modify=20220914105012;UNIX.mode=0644;UNIX.uid=17441;UNIX.gid=17441;unique=810g62388c4a; empty_file\"\r\n2022/09/14 12:51:53 DEBUG : FTP Rx: \"226 3 matches total\"\r\n2022/09/14 12:51:53 INFO  : empty_file: Copied (new)\r\n2022/09/14 12:51:53 INFO  : \r\nTransferred:              0 B / 0 B, -, 0 B/s, ETA -\r\nTransferred:            1 / 1, 100%\r\nElapsed time:         0.1s\r\n```\r\n\r\nI tried it on both target FTP servers and all is good, congrats!\r\n\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1246587454/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sriccio","id":5239282,"node_id":"MDQ6VXNlcjUyMzkyODI=","avatar_url":"https://avatars.githubusercontent.com/u/5239282?v=4","gravatar_id":"","url":"https://api.github.com/users/sriccio","html_url":"https://github.com/sriccio","followers_url":"https://api.github.com/users/sriccio/followers","following_url":"https://api.github.com/users/sriccio/following{/other_user}","gists_url":"https://api.github.com/users/sriccio/gists{/gist_id}","starred_url":"https://api.github.com/users/sriccio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sriccio/subscriptions","organizations_url":"https://api.github.com/users/sriccio/orgs","repos_url":"https://api.github.com/users/sriccio/repos","events_url":"https://api.github.com/users/sriccio/events{/privacy}","received_events_url":"https://api.github.com/users/sriccio/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-14T16:07:42Z","updated_at":"2022-09-14T16:07:42Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/jlaffaye/ftp/issues/281","repository_url":"https://api.github.com/repos/jlaffaye/ftp","labels_url":"https://api.github.com/repos/jlaffaye/ftp/issues/281/labels{/name}","comments_url":"https://api.github.com/repos/jlaffaye/ftp/issues/281/comments","events_url":"https://api.github.com/repos/jlaffaye/ftp/issues/281/events","html_url":"https://github.com/jlaffaye/ftp/pull/281","id":1373245479,"node_id":"PR_kwDOABoiRM4-9XdQ","number":281,"title":"Fix STOR of zero length files to ProFTPd/pureftpd with TLS (again)","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2022-09-14T16:07:42Z","updated_at":"2022-09-15T07:41:46Z","closed_at":"2022-09-15T07:41:46Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"repository":{"id":1712708,"node_id":"MDEwOlJlcG9zaXRvcnkxNzEyNzA4","name":"ftp","full_name":"jlaffaye/ftp","private":false,"owner":{"login":"jlaffaye","id":92914,"node_id":"MDQ6VXNlcjkyOTE0","avatar_url":"https://avatars.githubusercontent.com/u/92914?v=4","gravatar_id":"","url":"https://api.github.com/users/jlaffaye","html_url":"https://github.com/jlaffaye","followers_url":"https://api.github.com/users/jlaffaye/followers","following_url":"https://api.github.com/users/jlaffaye/following{/other_user}","gists_url":"https://api.github.com/users/jlaffaye/gists{/gist_id}","starred_url":"https://api.github.com/users/jlaffaye/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jlaffaye/subscriptions","organizations_url":"https://api.github.com/users/jlaffaye/orgs","repos_url":"https://api.github.com/users/jlaffaye/repos","events_url":"https://api.github.com/users/jlaffaye/events{/privacy}","received_events_url":"https://api.github.com/users/jlaffaye/received_events","type":"User","user_view_type":"public","site_admin":false},"html_url":"https://github.com/jlaffaye/ftp","description":"FTP client package for Go","fork":false,"url":"https://api.github.com/repos/jlaffaye/ftp","forks_url":"https://api.github.com/repos/jlaffaye/ftp/forks","keys_url":"https://api.github.com/repos/jlaffaye/ftp/keys{/key_id}","collaborators_url":"https://api.github.com/repos/jlaffaye/ftp/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/jlaffaye/ftp/teams","hooks_url":"https://api.github.com/repos/jlaffaye/ftp/hooks","issue_events_url":"https://api.github.com/repos/jlaffaye/ftp/issues/events{/number}","events_url":"https://api.github.com/repos/jlaffaye/ftp/events","assignees_url":"https://api.github.com/repos/jlaffaye/ftp/assignees{/user}","branches_url":"https://api.github.com/repos/jlaffaye/ftp/branches{/branch}","tags_url":"https://api.github.com/repos/jlaffaye/ftp/tags","blobs_url":"https://api.github.com/repos/jlaffaye/ftp/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/jlaffaye/ftp/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/jlaffaye/ftp/git/refs{/sha}","trees_url":"https://api.github.com/repos/jlaffaye/ftp/git/trees{/sha}","statuses_url":"https://api.github.com/repos/jlaffaye/ftp/statuses/{sha}","languages_url":"https://api.github.com/repos/jlaffaye/ftp/languages","stargazers_url":"https://api.github.com/repos/jlaffaye/ftp/stargazers","contributors_url":"https://api.github.com/repos/jlaffaye/ftp/contributors","subscribers_url":"https://api.github.com/repos/jlaffaye/ftp/subscribers","subscription_url":"https://api.github.com/repos/jlaffaye/ftp/subscription","commits_url":"https://api.github.com/repos/jlaffaye/ftp/commits{/sha}","git_commits_url":"https://api.github.com/repos/jlaffaye/ftp/git/commits{/sha}","comments_url":"https://api.github.com/repos/jlaffaye/ftp/comments{/number}","issue_comment_url":"https://api.github.com/repos/jlaffaye/ftp/issues/comments{/number}","contents_url":"https://api.github.com/repos/jlaffaye/ftp/contents/{+path}","compare_url":"https://api.github.com/repos/jlaffaye/ftp/compare/{base}...{head}","merges_url":"https://api.github.com/repos/jlaffaye/ftp/merges","archive_url":"https://api.github.com/repos/jlaffaye/ftp/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/jlaffaye/ftp/downloads","issues_url":"https://api.github.com/repos/jlaffaye/ftp/issues{/number}","pulls_url":"https://api.github.com/repos/jlaffaye/ftp/pulls{/number}","milestones_url":"https://api.github.com/repos/jlaffaye/ftp/milestones{/number}","notifications_url":"https://api.github.com/repos/jlaffaye/ftp/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/jlaffaye/ftp/labels{/name}","releases_url":"https://api.github.com/repos/jlaffaye/ftp/releases{/id}","deployments_url":"https://api.github.com/repos/jlaffaye/ftp/deployments","created_at":"2011-05-06T18:31:51Z","updated_at":"2025-11-04T10:03:03Z","pushed_at":"2025-10-27T16:20:43Z","git_url":"git://github.com/jlaffaye/ftp.git","ssh_url":"git@github.com:jlaffaye/ftp.git","clone_url":"https://github.com/jlaffaye/ftp.git","svn_url":"https://github.com/jlaffaye/ftp","homepage":"","size":354,"stargazers_count":1372,"watchers_count":1372,"language":"Go","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":379,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":46,"license":{"key":"isc","name":"ISC License","spdx_id":"ISC","url":"https://api.github.com/licenses/isc","node_id":"MDc6TGljZW5zZTEw"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["ftp","ftp-client","go"],"visibility":"public","forks":379,"open_issues":46,"watchers":1372,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/jlaffaye/ftp/pulls/281","html_url":"https://github.com/jlaffaye/ftp/pull/281","diff_url":"https://github.com/jlaffaye/ftp/pull/281.diff","patch_url":"https://github.com/jlaffaye/ftp/pull/281.patch","merged_at":null},"body":"Before this change, uploading a zero length file via TLS meant that the tls.Handshake function was never called.\r\n\r\nProFTPd and pureftpd refuse to accept an empty TCP connection with no TLS handshake as a zero length upload and gives the error\r\n\r\n    425 Unable to build data connection: Operation not\r\n\r\nThis fix was originally merged in\r\na4e9650823896675ddb6c11a88f6362912810874\r\nhowever it got accidentally reverted in\r\n212daf295f0e6ae44131ea12ee353a13fca71091\r\nso this patch re-adds the code, reworked for the subsequent changes.\r\n\r\nSee: https://forum.rclone.org/t/rclone-ftps-explicit-rclone-touch-empty-files-proftpd-unable-to-build-data-connection-operation-not-permitted/22522\r\nSee: https://github.com/rclone/rclone/issues/6426#issuecomment-1243993039","reactions":{"url":"https://api.github.com/repos/jlaffaye/ftp/issues/281/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/jlaffaye/ftp/issues/281/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1247059898","html_url":"https://github.com/rclone/rclone/issues/6426#issuecomment-1247059898","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6426","id":1247059898,"node_id":"IC_kwDOAQ-n5M5KVJ-6","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-14T17:04:26Z","updated_at":"2022-09-14T17:04:26Z","body":"Thanks for testing :-)\r\n\r\nI've submitted the patch upstream here: https://github.com/jlaffaye/ftp/pull/281\r\n\r\nNow let's work on the hang...\r\n\r\nHere are the possible bad commits\r\n\r\n```\r\n6512c2a (HEAD -> master, origin/master, origin/HEAD) Bump actions/setup-go from 2.2.0 to 3.3.0 (#280)  <=== BAD\r\na2b3f08 Bump coverallsapp/github-action from 1.1.2 to 1.1.3 (#274)\r\nb40593b Bump jandelgado/gcov2lcov-action from 1.0.8 to 1.0.9 (#273)\r\ndca029e Bump golangci/golangci-lint-action from 2.5.2 to 3.2.0 (#278)\r\n08a9ec3 Bump actions/cache from 2.1.7 to 3.0.8 (#279)\r\n260999f Secure GitHub workflows\r\nf1ba131 Add dependabot for github-actions\r\n9c3c2fd Add CodeQL and golangci-lint badges\r\nbe12fe0 Create codeql-analysis.yml\r\n99be063 (tag: v0.1.0) Add forceListHidden dial option to force the use of 'LIST -a' command (#271) <=== Beta 6446.67240bd54\r\nb85cf1e Add default timeout to instantiate connection\r\n0aeb866 Add MLST command in the form of a Get method (#269)\r\n4d1d644 Mark Connect() and DialWithTimeout() as deprecated\r\n5a2fd50 ioutil is deprecated, use io package instead\r\n9cda781 Fix transferring spelling.\r\n39592b9 Assign type to TransferType constants\r\nfa83b53 Use tls.Dialer to be able to use DialContext\r\n45482d0 Use assert package to simplify tests\r\n560423f DialWithNetConn is a special case of DialWithDialFunc\r\nOK HERE\r\n```\r\n\r\nIn https://pub.rclone.org/issue-6426.zip  you will find a binary for each one of those commits (compiled for ubuntu 64 bit).\r\n\r\nCan you start from the highest numbered one `-19` (which should succeed, though it might not) and report the first one which fails when going down the numbers to `-01`. You can stop when you get a failure which might even be the first one.\r\n\r\nThen I can work on a fix!\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1247059898/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7387881501,"node_id":"REFE_lADOAQ-n5M5RZSxGzwAAAAG4WiAd","url":"https://api.github.com/repos/rclone/rclone/issues/events/7387881501","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"05061065a30d1ba3d267fe71792b97aae9257df5","commit_url":"https://api.github.com/repos/ncw/ftp/commits/05061065a30d1ba3d267fe71792b97aae9257df5","created_at":"2022-09-14T17:08:29Z","performed_via_github_app":null},{"id":7387984964,"node_id":"REFE_lADOAQ-n5M5RZSxGzwAAAAG4W7RE","url":"https://api.github.com/repos/rclone/rclone/issues/events/7387984964","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"1ef15136d8d5baa670e9c3137c26406f57cdc514","commit_url":"https://api.github.com/repos/ncw/ftp/commits/1ef15136d8d5baa670e9c3137c26406f57cdc514","created_at":"2022-09-14T17:21:49Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1247082518","html_url":"https://github.com/rclone/rclone/issues/6426#issuecomment-1247082518","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6426","id":1247082518,"node_id":"IC_kwDOAQ-n5M5KVPgW","user":{"login":"sriccio","id":5239282,"node_id":"MDQ6VXNlcjUyMzkyODI=","avatar_url":"https://avatars.githubusercontent.com/u/5239282?v=4","gravatar_id":"","url":"https://api.github.com/users/sriccio","html_url":"https://github.com/sriccio","followers_url":"https://api.github.com/users/sriccio/followers","following_url":"https://api.github.com/users/sriccio/following{/other_user}","gists_url":"https://api.github.com/users/sriccio/gists{/gist_id}","starred_url":"https://api.github.com/users/sriccio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sriccio/subscriptions","organizations_url":"https://api.github.com/users/sriccio/orgs","repos_url":"https://api.github.com/users/sriccio/repos","events_url":"https://api.github.com/users/sriccio/events{/privacy}","received_events_url":"https://api.github.com/users/sriccio/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-14T17:25:08Z","updated_at":"2022-09-14T17:25:56Z","body":"> Thanks for testing :-)\r\n\r\nYou're welcome :)\r\n\r\n> In https://pub.rclone.org/issue-6426.zip you will find a binary for each one of those commits (compiled for ubuntu 64 bit).\r\n\r\nSure. But humm, I tried each of them and they all hangs at MLSD\r\n\r\n```\r\n./rclone-ftp-19-560423f copy file.txt web23:/test -vv --log-file \"bug.log\" --dump headers --retries 1 --low-level-retries 1\r\n```\r\n\r\nLast lines of the log\r\n\r\n```\r\n2022/09/14 19:22:01 DEBUG : FTP Tx: \"PBSZ 0\"\r\n2022/09/14 19:22:01 DEBUG : FTP Rx: \"200 PBSZ=0\"\r\n2022/09/14 19:22:01 DEBUG : FTP Tx: \"PROT P\"\r\n2022/09/14 19:22:01 DEBUG : FTP Rx: \"200 Data protection level set to \\\"private\\\"\"\r\n2022/09/14 19:22:01 DEBUG : FTP Tx: \"PRET MLSD /\"\r\n2022/09/14 19:22:01 DEBUG : FTP Rx: \"200 Ready to proceed\"\r\n2022/09/14 19:22:01 DEBUG : FTP Tx: \"EPSV\"\r\n2022/09/14 19:22:01 DEBUG : FTP Rx: \"229 Extended Passive mode OK (|||47438|)\"\r\n2022/09/14 19:22:01 DEBUG : FTP Tx: \"MLSD /\"\r\n```\r\n\r\nAre there other commits or changes between the beta version with fixed zero-length  ([1.60.0-beta.6442.bc111faaa.fix-ftp-error-11536801d1ff](https://beta.rclone.org/branch/fix-ftp-error-11536801d1ff/v1.60.0-beta.6442.bc111faaa.fix-ftp-error-11536801d1ff/))\r\n and `rclone-ftp-19-560423f ` ?\r\n\r\nCheers","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1247082518/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sriccio","id":5239282,"node_id":"MDQ6VXNlcjUyMzkyODI=","avatar_url":"https://avatars.githubusercontent.com/u/5239282?v=4","gravatar_id":"","url":"https://api.github.com/users/sriccio","html_url":"https://github.com/sriccio","followers_url":"https://api.github.com/users/sriccio/followers","following_url":"https://api.github.com/users/sriccio/following{/other_user}","gists_url":"https://api.github.com/users/sriccio/gists{/gist_id}","starred_url":"https://api.github.com/users/sriccio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sriccio/subscriptions","organizations_url":"https://api.github.com/users/sriccio/orgs","repos_url":"https://api.github.com/users/sriccio/repos","events_url":"https://api.github.com/users/sriccio/events{/privacy}","received_events_url":"https://api.github.com/users/sriccio/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7392634217,"node_id":"REFE_lADOAQ-n5M5RZSxGzwAAAAG4oqVp","url":"https://api.github.com/repos/rclone/rclone/issues/events/7392634217","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"4e9a4c057dcf9744693859e18d9b5eecb2741a48","commit_url":"https://api.github.com/repos/ncw/ftp/commits/4e9a4c057dcf9744693859e18d9b5eecb2741a48","created_at":"2022-09-15T08:22:41Z","performed_via_github_app":null},{"id":7392689638,"node_id":"REFE_lADOAQ-n5M5RZSxGzwAAAAG4o33m","url":"https://api.github.com/repos/rclone/rclone/issues/events/7392689638","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"9f626dab1ddec564f1dc2db61583305ac18180d8","commit_url":"https://api.github.com/repos/rclone/rclone/commits/9f626dab1ddec564f1dc2db61583305ac18180d8","created_at":"2022-09-15T08:29:28Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1247766492","html_url":"https://github.com/rclone/rclone/issues/6426#issuecomment-1247766492","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6426","id":1247766492,"node_id":"IC_kwDOAQ-n5M5KX2fc","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-15T08:31:35Z","updated_at":"2022-09-15T08:31:35Z","body":"No that is all the commits so assuming that is correct, then this commit must be the problem one\r\n\r\nhttps://github.com/jlaffaye/ftp/commit/560423fa8a0d5487c0d066e42a00e65196be7c68\r\n\r\nI see the problem now, because you are using `explicit_tls = true` rclone is passing in a `conn` and that patch takes away the check to see if conn is already set. This means that we are trying to connect twice and hence the error `use of closed network connection` I think.\r\n\r\nThis commit attempts to adapt to the library changes - hopefully it will work now.\r\n\r\n[v1.60.0-beta.6447.65bb298b4.fix-6426-ftp-dial](https://beta.rclone.org/branch/fix-6426-ftp-dial/v1.60.0-beta.6447.65bb298b4.fix-6426-ftp-dial/) on branch [fix-6426-ftp-dial](https://github.com/rclone/rclone/tree/fix-6426-ftp-dial) (uploaded in 15-30 mins)\r\n\r\nI think it should have the 0 sized file bug though, and I've come up with a better fix for that so if you could try this too which has both the fixes\r\n\r\n[v1.60.0-beta.6448.de841a3e3.fix-6426-ftp-dial](https://beta.rclone.org/branch/fix-6426-ftp-dial/v1.60.0-beta.6448.de841a3e3.fix-6426-ftp-dial/) on branch [fix-6426-ftp-dial](https://github.com/rclone/rclone/tree/fix-6426-ftp-dial) (uploaded in 15-30 mins)\r\n\r\nCross fingers they both work! If they do I'll resubmit a better patch upstream.\r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1247766492/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1248512271","html_url":"https://github.com/rclone/rclone/issues/6426#issuecomment-1248512271","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6426","id":1248512271,"node_id":"IC_kwDOAQ-n5M5KaskP","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-15T19:17:53Z","updated_at":"2022-09-15T19:17:53Z","body":"I've managaged to replicate this problem with the Hetzner storage box with explicit TLS and with that at least the fix doesn't work :-( Will continue tomorrow.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1248512271/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-16T12:32:31Z","updated_at":"2022-09-16T12:32:31Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/jlaffaye/ftp/issues/282","repository_url":"https://api.github.com/repos/jlaffaye/ftp","labels_url":"https://api.github.com/repos/jlaffaye/ftp/issues/282/labels{/name}","comments_url":"https://api.github.com/repos/jlaffaye/ftp/issues/282/comments","events_url":"https://api.github.com/repos/jlaffaye/ftp/issues/282/events","html_url":"https://github.com/jlaffaye/ftp/issues/282","id":1375885450,"node_id":"I_kwDOABoiRM5SAliK","number":282,"title":"Data connections with ExplicitTLS hang forever","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":562340280,"node_id":"MDU6TGFiZWw1NjIzNDAyODA=","url":"https://api.github.com/repos/jlaffaye/ftp/labels/defect","name":"defect","color":"b60205","default":false,"description":"The code does not work as intended"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2022-09-16T12:32:31Z","updated_at":"2023-02-08T16:46:44Z","closed_at":"2023-02-08T16:46:44Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":1712708,"node_id":"MDEwOlJlcG9zaXRvcnkxNzEyNzA4","name":"ftp","full_name":"jlaffaye/ftp","private":false,"owner":{"login":"jlaffaye","id":92914,"node_id":"MDQ6VXNlcjkyOTE0","avatar_url":"https://avatars.githubusercontent.com/u/92914?v=4","gravatar_id":"","url":"https://api.github.com/users/jlaffaye","html_url":"https://github.com/jlaffaye","followers_url":"https://api.github.com/users/jlaffaye/followers","following_url":"https://api.github.com/users/jlaffaye/following{/other_user}","gists_url":"https://api.github.com/users/jlaffaye/gists{/gist_id}","starred_url":"https://api.github.com/users/jlaffaye/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jlaffaye/subscriptions","organizations_url":"https://api.github.com/users/jlaffaye/orgs","repos_url":"https://api.github.com/users/jlaffaye/repos","events_url":"https://api.github.com/users/jlaffaye/events{/privacy}","received_events_url":"https://api.github.com/users/jlaffaye/received_events","type":"User","user_view_type":"public","site_admin":false},"html_url":"https://github.com/jlaffaye/ftp","description":"FTP client package for Go","fork":false,"url":"https://api.github.com/repos/jlaffaye/ftp","forks_url":"https://api.github.com/repos/jlaffaye/ftp/forks","keys_url":"https://api.github.com/repos/jlaffaye/ftp/keys{/key_id}","collaborators_url":"https://api.github.com/repos/jlaffaye/ftp/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/jlaffaye/ftp/teams","hooks_url":"https://api.github.com/repos/jlaffaye/ftp/hooks","issue_events_url":"https://api.github.com/repos/jlaffaye/ftp/issues/events{/number}","events_url":"https://api.github.com/repos/jlaffaye/ftp/events","assignees_url":"https://api.github.com/repos/jlaffaye/ftp/assignees{/user}","branches_url":"https://api.github.com/repos/jlaffaye/ftp/branches{/branch}","tags_url":"https://api.github.com/repos/jlaffaye/ftp/tags","blobs_url":"https://api.github.com/repos/jlaffaye/ftp/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/jlaffaye/ftp/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/jlaffaye/ftp/git/refs{/sha}","trees_url":"https://api.github.com/repos/jlaffaye/ftp/git/trees{/sha}","statuses_url":"https://api.github.com/repos/jlaffaye/ftp/statuses/{sha}","languages_url":"https://api.github.com/repos/jlaffaye/ftp/languages","stargazers_url":"https://api.github.com/repos/jlaffaye/ftp/stargazers","contributors_url":"https://api.github.com/repos/jlaffaye/ftp/contributors","subscribers_url":"https://api.github.com/repos/jlaffaye/ftp/subscribers","subscription_url":"https://api.github.com/repos/jlaffaye/ftp/subscription","commits_url":"https://api.github.com/repos/jlaffaye/ftp/commits{/sha}","git_commits_url":"https://api.github.com/repos/jlaffaye/ftp/git/commits{/sha}","comments_url":"https://api.github.com/repos/jlaffaye/ftp/comments{/number}","issue_comment_url":"https://api.github.com/repos/jlaffaye/ftp/issues/comments{/number}","contents_url":"https://api.github.com/repos/jlaffaye/ftp/contents/{+path}","compare_url":"https://api.github.com/repos/jlaffaye/ftp/compare/{base}...{head}","merges_url":"https://api.github.com/repos/jlaffaye/ftp/merges","archive_url":"https://api.github.com/repos/jlaffaye/ftp/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/jlaffaye/ftp/downloads","issues_url":"https://api.github.com/repos/jlaffaye/ftp/issues{/number}","pulls_url":"https://api.github.com/repos/jlaffaye/ftp/pulls{/number}","milestones_url":"https://api.github.com/repos/jlaffaye/ftp/milestones{/number}","notifications_url":"https://api.github.com/repos/jlaffaye/ftp/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/jlaffaye/ftp/labels{/name}","releases_url":"https://api.github.com/repos/jlaffaye/ftp/releases{/id}","deployments_url":"https://api.github.com/repos/jlaffaye/ftp/deployments","created_at":"2011-05-06T18:31:51Z","updated_at":"2025-11-04T10:03:03Z","pushed_at":"2025-10-27T16:20:43Z","git_url":"git://github.com/jlaffaye/ftp.git","ssh_url":"git@github.com:jlaffaye/ftp.git","clone_url":"https://github.com/jlaffaye/ftp.git","svn_url":"https://github.com/jlaffaye/ftp","homepage":"","size":354,"stargazers_count":1372,"watchers_count":1372,"language":"Go","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":379,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":46,"license":{"key":"isc","name":"ISC License","spdx_id":"ISC","url":"https://api.github.com/licenses/isc","node_id":"MDc6TGljZW5zZTEw"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["ftp","ftp-client","go"],"visibility":"public","forks":379,"open_issues":46,"watchers":1372,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"**Describe the bug**\r\n\r\nData connections with TLS Explicit mode seem to be broken\r\n\r\n**To Reproduce**\r\n\r\n```go\r\npackage main\r\n\r\nimport (\r\n\t\"crypto/tls\"\r\n\t\"log\"\r\n\t\"os\"\r\n\t\"time\"\r\n\r\n\t\"github.com/jlaffaye/ftp\"\r\n)\r\n\r\nfunc main() {\r\n\tif len(os.Args) != 4 {\r\n\t\tlog.Fatalf(\"Expecting %s ftp.example.org username password\", os.Args[0])\r\n\t}\r\n\thost, username, password := os.Args[1], os.Args[2], os.Args[3]\r\n\tport := \"21\"\r\n\r\n\tvar tlsConf = &tls.Config{\r\n\t\tServerName: host,\r\n\t}\r\n\r\n\tc, err := ftp.Dial(host+\":\"+port,\r\n\t\tftp.DialWithExplicitTLS(tlsConf),\r\n\t\tftp.DialWithTimeout(20*time.Second),\r\n\t\tftp.DialWithDebugOutput(os.Stdout),\r\n\t)\r\n\tif err != nil {\r\n\t\tlog.Fatal(err)\r\n\t}\r\n\r\n\terr = c.Login(username, password)\r\n\tif err != nil {\r\n\t\tlog.Fatal(err)\r\n\t}\r\n\r\n\t// Make a listing\r\n\tentries, err := c.List(\".\")\r\n\tif err != nil {\r\n\t\tlog.Fatal(err)\r\n\t}\r\n\tfor _, entry := range entries {\r\n\t\tlog.Printf(\"%#v\", entry)\r\n\t}\r\n\r\n\tif err := c.Quit(); err != nil {\r\n\t\tlog.Fatal(err)\r\n\t}\r\n}\r\n```\r\n\r\nUsing this program to connect hangs on the listing\r\n\r\n\r\n**Expected behavior**\r\n\r\nI expected to see a listing\r\n\r\n**FTP server**\r\n\r\nThis is connecting to a Hetzner storage box. I've also had reports of the same problem with pureftpd (See https://github.com/rclone/rclone/issues/6426 )\r\n\r\n**Debug output**\r\n\r\n```\r\n220 ProFTPD Server (Hetzner Backup) [::ffff:78.47.22.109]\r\nAUTH TLS\r\n234 AUTH TLS successful\r\nUSER uXXXXXX\r\n331 Password required for uXXXXXX\r\nPASS supersecretpassword\r\n230 User uXXXXXX logged in\r\nFEAT\r\n211-Features:\r\n AUTH TLS\r\n CCC\r\n CLNT\r\n EPRT\r\n EPSV\r\n HOST\r\n LANG fr-FR.UTF-8;fr-FR;en-US.UTF-8;en-US;it-IT.UTF-8;it-IT;es-ES.UTF-8;es-ES;bg-BG.UTF-8;bg-BG;ko-KR.UTF-8;ko-KR;zh-TW.UTF-8;zh-TW;ru-RU.UTF-8;ru-RU;ja-JP.UTF-8;ja-JP;zh-CN.UTF-8;zh-CN\r\n MDTM\r\n MFF modify;UNIX.group;UNIX.mode;\r\n MFMT\r\n MLST modify*;perm*;size*;type*;unique*;UNIX.group*;UNIX.groupname*;UNIX.mode*;UNIX.owner*;UNIX.ownername*;\r\n PBSZ\r\n PROT\r\n RANG STREAM\r\n REST STREAM\r\n SIZE\r\n SSCN\r\n TVFS\r\n UTF8\r\n211 End\r\nTYPE I\r\n200 Type set to I\r\nOPTS UTF8 ON\r\n200 UTF8 set to on\r\nPBSZ 0\r\n200 PBSZ 0 successful\r\nPROT P\r\n200 Protection set to Private\r\nEPSV\r\n229 Entering Extended Passive Mode (|||59900|)\r\n2022/09/16 13:19:41 context deadline exceeded\r\n```\r\n\r\n**Additional context**\r\n\r\nI bisected the problem to this commit 212daf295f0e6ae44131ea12ee353a13fca71091\r\n\r\n```\r\ncommit 212daf295f0e6ae44131ea12ee353a13fca71091\r\nAuthor: Julien Laffaye <jlaffaye@freebsd.org>\r\nDate:   Mon Feb 28 20:43:42 2022 -0500\r\n\r\n    Use tls.DialWithDialer which does the handshake\r\n    \r\n    tls.DialWithDialer also better handle special error cases\r\n\r\n ftp.go | 26 +++-----------------------\r\n 1 file changed, 3 insertions(+), 23 deletions(-)\r\n```\r\n\r\nWhat appears to be happening is that the connection hangs in the tls Handshake.\r\n\r\nIf I make this small patch to HEAD everything works fine\r\n\r\n```patch\r\n--- a/ftp.go\r\n+++ b/ftp.go\r\n@@ -559,7 +559,12 @@ func (c *ServerConn) openDataConn() (net.Conn, error) {\r\n \t}\r\n \r\n \tif c.options.tlsConfig != nil {\r\n-\t\treturn tls.DialWithDialer(&c.options.dialer, \"tcp\", addr, c.options.tlsConfig)\r\n+\t\tconn, err := c.options.dialer.Dial(\"tcp\", addr)\r\n+\t\tif err != nil {\r\n+\t\t\treturn nil, err\r\n+\t\t}\r\n+\t\ttlsConn := tls.Client(conn, c.options.tlsConfig)\r\n+\t\treturn tlsConn, nil\r\n \t}\r\n \r\n \treturn c.options.dialer.Dial(\"tcp\", addr)\r\n```\r\n\r\nBUT if I do a tls.Handshake as well (which is what `tls.DialWithDialer`) does then it hangs up\r\n\r\n```patch\r\n--- a/ftp.go\r\n+++ b/ftp.go\r\n@@ -559,7 +559,16 @@ func (c *ServerConn) openDataConn() (net.Conn, error) {\r\n \t}\r\n \r\n \tif c.options.tlsConfig != nil {\r\n-\t\treturn tls.DialWithDialer(&c.options.dialer, \"tcp\", addr, c.options.tlsConfig)\r\n+\t\tconn, err := c.options.dialer.Dial(\"tcp\", addr)\r\n+\t\tif err != nil {\r\n+\t\t\treturn nil, err\r\n+\t\t}\r\n+\t\ttlsConn := tls.Client(conn, c.options.tlsConfig)\r\n+\t\terr = tlsConn.Handshake()\r\n+\t\tif err != nil {\r\n+\t\t\treturn nil, err\r\n+\t\t}\r\n+\t\treturn tlsConn, nil\r\n \t}\r\n \r\n \treturn c.options.dialer.Dial(\"tcp\", addr)\r\n```\r\n\r\nI can only think this is either a bug in Go TLS or a bug in openSSL as used by proftpd and pureftpd, but I'm not sure and I'd appreciate any help!","reactions":{"url":"https://api.github.com/repos/jlaffaye/ftp/issues/282/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/jlaffaye/ftp/issues/282/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1249308086","html_url":"https://github.com/rclone/rclone/issues/6426#issuecomment-1249308086","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6426","id":1249308086,"node_id":"IC_kwDOAQ-n5M5Kdu22","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-16T12:33:29Z","updated_at":"2022-09-16T12:33:29Z","body":"This is proving tricky! I have a workaround now, but I think this might be a TLS bug in Go or openssl... I reported the bug upstream here: https://github.com/jlaffaye/ftp/issues/282","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1249308086/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7404075201,"node_id":"REFE_lADOAQ-n5M5RZSxGzwAAAAG5UTjB","url":"https://api.github.com/repos/rclone/rclone/issues/events/7404075201","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"909597844e2a07b7a2ad7522271399b1475a516c","commit_url":"https://api.github.com/repos/ncw/ftp/commits/909597844e2a07b7a2ad7522271399b1475a516c","created_at":"2022-09-16T15:15:12Z","performed_via_github_app":null},{"actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-16T15:16:16Z","updated_at":"2022-09-16T15:16:16Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/jlaffaye/ftp/issues/283","repository_url":"https://api.github.com/repos/jlaffaye/ftp","labels_url":"https://api.github.com/repos/jlaffaye/ftp/issues/283/labels{/name}","comments_url":"https://api.github.com/repos/jlaffaye/ftp/issues/283/comments","events_url":"https://api.github.com/repos/jlaffaye/ftp/issues/283/events","html_url":"https://github.com/jlaffaye/ftp/pull/283","id":1376092669,"node_id":"PR_kwDOABoiRM4_G3lr","number":283,"title":"Fix hang when using ExplicitTLS to certain servers.","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2022-09-16T15:16:16Z","updated_at":"2023-10-19T18:35:17Z","closed_at":"2023-02-08T16:46:42Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"draft":false,"repository":{"id":1712708,"node_id":"MDEwOlJlcG9zaXRvcnkxNzEyNzA4","name":"ftp","full_name":"jlaffaye/ftp","private":false,"owner":{"login":"jlaffaye","id":92914,"node_id":"MDQ6VXNlcjkyOTE0","avatar_url":"https://avatars.githubusercontent.com/u/92914?v=4","gravatar_id":"","url":"https://api.github.com/users/jlaffaye","html_url":"https://github.com/jlaffaye","followers_url":"https://api.github.com/users/jlaffaye/followers","following_url":"https://api.github.com/users/jlaffaye/following{/other_user}","gists_url":"https://api.github.com/users/jlaffaye/gists{/gist_id}","starred_url":"https://api.github.com/users/jlaffaye/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jlaffaye/subscriptions","organizations_url":"https://api.github.com/users/jlaffaye/orgs","repos_url":"https://api.github.com/users/jlaffaye/repos","events_url":"https://api.github.com/users/jlaffaye/events{/privacy}","received_events_url":"https://api.github.com/users/jlaffaye/received_events","type":"User","user_view_type":"public","site_admin":false},"html_url":"https://github.com/jlaffaye/ftp","description":"FTP client package for Go","fork":false,"url":"https://api.github.com/repos/jlaffaye/ftp","forks_url":"https://api.github.com/repos/jlaffaye/ftp/forks","keys_url":"https://api.github.com/repos/jlaffaye/ftp/keys{/key_id}","collaborators_url":"https://api.github.com/repos/jlaffaye/ftp/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/jlaffaye/ftp/teams","hooks_url":"https://api.github.com/repos/jlaffaye/ftp/hooks","issue_events_url":"https://api.github.com/repos/jlaffaye/ftp/issues/events{/number}","events_url":"https://api.github.com/repos/jlaffaye/ftp/events","assignees_url":"https://api.github.com/repos/jlaffaye/ftp/assignees{/user}","branches_url":"https://api.github.com/repos/jlaffaye/ftp/branches{/branch}","tags_url":"https://api.github.com/repos/jlaffaye/ftp/tags","blobs_url":"https://api.github.com/repos/jlaffaye/ftp/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/jlaffaye/ftp/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/jlaffaye/ftp/git/refs{/sha}","trees_url":"https://api.github.com/repos/jlaffaye/ftp/git/trees{/sha}","statuses_url":"https://api.github.com/repos/jlaffaye/ftp/statuses/{sha}","languages_url":"https://api.github.com/repos/jlaffaye/ftp/languages","stargazers_url":"https://api.github.com/repos/jlaffaye/ftp/stargazers","contributors_url":"https://api.github.com/repos/jlaffaye/ftp/contributors","subscribers_url":"https://api.github.com/repos/jlaffaye/ftp/subscribers","subscription_url":"https://api.github.com/repos/jlaffaye/ftp/subscription","commits_url":"https://api.github.com/repos/jlaffaye/ftp/commits{/sha}","git_commits_url":"https://api.github.com/repos/jlaffaye/ftp/git/commits{/sha}","comments_url":"https://api.github.com/repos/jlaffaye/ftp/comments{/number}","issue_comment_url":"https://api.github.com/repos/jlaffaye/ftp/issues/comments{/number}","contents_url":"https://api.github.com/repos/jlaffaye/ftp/contents/{+path}","compare_url":"https://api.github.com/repos/jlaffaye/ftp/compare/{base}...{head}","merges_url":"https://api.github.com/repos/jlaffaye/ftp/merges","archive_url":"https://api.github.com/repos/jlaffaye/ftp/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/jlaffaye/ftp/downloads","issues_url":"https://api.github.com/repos/jlaffaye/ftp/issues{/number}","pulls_url":"https://api.github.com/repos/jlaffaye/ftp/pulls{/number}","milestones_url":"https://api.github.com/repos/jlaffaye/ftp/milestones{/number}","notifications_url":"https://api.github.com/repos/jlaffaye/ftp/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/jlaffaye/ftp/labels{/name}","releases_url":"https://api.github.com/repos/jlaffaye/ftp/releases{/id}","deployments_url":"https://api.github.com/repos/jlaffaye/ftp/deployments","created_at":"2011-05-06T18:31:51Z","updated_at":"2025-11-04T10:03:03Z","pushed_at":"2025-10-27T16:20:43Z","git_url":"git://github.com/jlaffaye/ftp.git","ssh_url":"git@github.com:jlaffaye/ftp.git","clone_url":"https://github.com/jlaffaye/ftp.git","svn_url":"https://github.com/jlaffaye/ftp","homepage":"","size":354,"stargazers_count":1372,"watchers_count":1372,"language":"Go","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":379,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":46,"license":{"key":"isc","name":"ISC License","spdx_id":"ISC","url":"https://api.github.com/licenses/isc","node_id":"MDc6TGljZW5zZTEw"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["ftp","ftp-client","go"],"visibility":"public","forks":379,"open_issues":46,"watchers":1372,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/jlaffaye/ftp/pulls/283","html_url":"https://github.com/jlaffaye/ftp/pull/283","diff_url":"https://github.com/jlaffaye/ftp/pull/283.diff","patch_url":"https://github.com/jlaffaye/ftp/pull/283.patch","merged_at":"2023-02-08T16:46:42Z"},"body":"In #282 it was discovered that doing the tls Handshake immediately on connection causes some FTP servers (proftpd and pureftpd) to hang.\r\n\r\nThe exact cause of this is unknown, but this patch works around the problem by not doing the Handsake initially, and only doing it at the end if we were attempting to upload a zero length file.\r\n\r\nDoing the Handshake at the end was originally added in a4e9650823896675 however it got reverted in 212daf295f0e6ae4 which used tls.DialWithDialer to do the handshake. Unfortunately tls.DialWithDialer seems to trigger the hanging bug.\r\n\r\nSee: https://forum.rclone.org/t/rclone-ftps-explicit-rclone-touch-empty-files-proftpd-unable-to-build-data-connection-operation-not-permitted/22522\r\nSee: https://github.com/rclone/rclone/issues/6426#issuecomment-1243993039\r\nFixes #282","reactions":{"url":"https://api.github.com/repos/jlaffaye/ftp/issues/283/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/jlaffaye/ftp/issues/283/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":7404117564,"node_id":"REFE_lADOAQ-n5M5RZSxGzwAAAAG5Ud48","url":"https://api.github.com/repos/rclone/rclone/issues/events/7404117564","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"7a34fe8d8287c5558e6f318993a556bf4f3596d0","commit_url":"https://api.github.com/repos/rclone/rclone/commits/7a34fe8d8287c5558e6f318993a556bf4f3596d0","created_at":"2022-09-16T15:20:59Z","performed_via_github_app":null}]