{"url":"https://api.github.com/repos/rclone/rclone/issues/4882","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/4882/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/4882/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/4882/events","html_url":"https://github.com/rclone/rclone/issues/4882","id":772229752,"node_id":"MDU6SXNzdWU3NzIyMjk3NTI=","number":4882,"title":"Sftp serve password input holding connection hostage","user":{"login":"regnos24","id":2692199,"node_id":"MDQ6VXNlcjI2OTIxOTk=","avatar_url":"https://avatars.githubusercontent.com/u/2692199?v=4","gravatar_id":"","url":"https://api.github.com/users/regnos24","html_url":"https://github.com/regnos24","followers_url":"https://api.github.com/users/regnos24/followers","following_url":"https://api.github.com/users/regnos24/following{/other_user}","gists_url":"https://api.github.com/users/regnos24/gists{/gist_id}","starred_url":"https://api.github.com/users/regnos24/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/regnos24/subscriptions","organizations_url":"https://api.github.com/users/regnos24/orgs","repos_url":"https://api.github.com/users/regnos24/repos","events_url":"https://api.github.com/users/regnos24/events{/privacy}","received_events_url":"https://api.github.com/users/regnos24/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":86399007,"node_id":"MDU6TGFiZWw4NjM5OTAwNw==","url":"https://api.github.com/repos/rclone/rclone/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null},{"id":2510153547,"node_id":"MDU6TGFiZWwyNTEwMTUzNTQ3","url":"https://api.github.com/repos/rclone/rclone/labels/Serving","name":"Serving","color":"5cf2b8","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2020-12-21T14:56:35Z","updated_at":"2021-01-06T15:34:47Z","closed_at":"2021-01-06T15:34:38Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n\r\nWelcome :-) We understand you are having a problem with rclone; we want to help you with that!\r\n\r\nIf you've just got a question or aren't sure if you've found a bug then please use the rclone forum:\r\n\r\n    https://forum.rclone.org/\r\n\r\ninstead of filing an issue for a quick response.\r\n\r\nIf you think you might have found a bug, please can you try to replicate it with the latest beta?\r\n\r\n    https://beta.rclone.org/\r\n    \r\nIf you can still replicate it with the latest beta, then please fill in the info below which makes our lives much easier.  A log with -vv will make our day :-)\r\n\r\nThank you\r\n\r\nThe Rclone Developers\r\n\r\n-->\r\nAttempted to solve via the forum and was asked to make a ticket: https://forum.rclone.org/t/sftp-serve-password-input-holding-connection-hostage/21139\r\n\r\nThe problem I am having with rclone, is when we serve sftp using an auth proxy. We allow users to input a username and password in some instances. When a user does this and the terminal prompts for a password, this hangs the process so if any other user attempts to connect to the server are held up by the initial request for the user to input the password field.\r\nI have tried this locally and on a remote server and having another person lock the password stdin and it holding the process until they either enter a password or cancel.\r\n\r\n**What is your rclone version (output from rclone version)**\r\nrclone v1.52.2\r\n\r\nos/arch: darwin/amd64\r\ngo version: go1.14.4\r\n**Which OS you are using and how many bits (eg Windows 7, 64 bit)**\r\nOSX 11.1 (20C69) locally and Scratch Docker container host for the server.\r\n\r\n**Which cloud storage system are you using? (eg Google Drive)**\r\nGoogle Cloud Storage\r\n\r\n**The command you were trying to run (eg rclone copy /tmp remote:tmp)**\r\n```rclone serve sftp --addr 0.0.0.0:2022 --vfs-cache-mode off --auth-proxy `pwd`/auth --key `pwd`/tmp/keys/id_rsa -vv```\r\nThe rclone config contents with secrets removed.\r\nUsing default config\r\nA log from the command with the -vv flag\r\n```2020/12/18 15:21:10 DEBUG : Loaded private key from \"/Users/someguy/Projects/x-sftp/tmp/keys/id_rsa\"\r\n2020/12/18 15:21:10 NOTICE: SFTP server listening on [::]:2022\r\n2020/12/18 15:21:13 DEBUG : serve sftp [::1]:60337->[::1]:2022: ssh auth \"none\" from \"SSH-2.0-OpenSSH_8.1\": ssh: no auth passed yet\r\n2020/12/18 15:21:13 DEBUG : serve sftp [::1]:60337->[::1]:2022: Public key login attempt for sftp_auth_test\r\n2020/12/18 15:21:13 DEBUG : Calling proxy [/Users/someguy/Projects/x-sftp/auth]\r\n2020/12/18 15:21:13 DEBUG : serve sftp [::1]:60337->[::1]:2022: ssh auth \"publickey\" from \"SSH-2.0-OpenSSH_8.1\": proxy: failed to read output: \"\": unexpected end of JSON input\r\n2020/12/18 15:21:13 DEBUG : serve sftp [::1]:60337->[::1]:2022: Password login attempt for sftp_auth_test\r\n2020/12/18 15:21:14 DEBUG : Calling proxy [/Users/someguy/Projects/x-sftp/auth]\r\n2020/12/18 15:21:14 DEBUG : serve sftp [::1]:60337->[::1]:2022: ssh auth \"password\" from \"SSH-2.0-OpenSSH_8.1\": proxy: failed on [/Users/someguy/Projects/x-sftp/auth]: \"Authentication failed\": exit status 255```","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/4882/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/4882/timeline","performed_via_github_app":null,"state_reason":"completed"}