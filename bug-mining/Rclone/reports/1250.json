{"url":"https://api.github.com/repos/rclone/rclone/issues/7072","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/7072/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/7072/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/7072/events","html_url":"https://github.com/rclone/rclone/issues/7072","id":1767114373,"node_id":"I_kwDOAQ-n5M5pVAaF","number":7072,"title":"new feature: VFS auto normalization","user":{"login":"kapitainsky","id":15635386,"node_id":"MDQ6VXNlcjE1NjM1Mzg2","avatar_url":"https://avatars.githubusercontent.com/u/15635386?v=4","gravatar_id":"","url":"https://api.github.com/users/kapitainsky","html_url":"https://github.com/kapitainsky","followers_url":"https://api.github.com/users/kapitainsky/followers","following_url":"https://api.github.com/users/kapitainsky/following{/other_user}","gists_url":"https://api.github.com/users/kapitainsky/gists{/gist_id}","starred_url":"https://api.github.com/users/kapitainsky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kapitainsky/subscriptions","organizations_url":"https://api.github.com/users/kapitainsky/orgs","repos_url":"https://api.github.com/users/kapitainsky/repos","events_url":"https://api.github.com/users/kapitainsky/events{/privacy}","received_events_url":"https://api.github.com/users/kapitainsky/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399007,"node_id":"MDU6TGFiZWw4NjM5OTAwNw==","url":"https://api.github.com/repos/rclone/rclone/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null},{"id":430778096,"node_id":"MDU6TGFiZWw0MzA3NzgwOTY=","url":"https://api.github.com/repos/rclone/rclone/labels/VFS%20/%20mount","name":"VFS / mount","color":"0e8a16","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/54","html_url":"https://github.com/rclone/rclone/milestone/54","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/54/labels","id":9909337,"node_id":"MI_kwDOAQ-n5M4AlzRZ","number":54,"title":"v1.66","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":5,"closed_issues":25,"state":"closed","created_at":"2023-09-11T16:50:18Z","updated_at":"2024-08-15T14:36:39Z","due_on":"2024-02-29T08:00:00Z","closed_at":"2024-03-10T12:33:48Z"},"comments":38,"created_at":"2023-06-21T08:56:32Z","updated_at":"2024-03-06T16:12:14Z","closed_at":"2024-03-06T16:12:14Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Immediate goal of this enhancement is to fix macOS `rclone mount` which at the moment does not work properly regardless of mounting method used - macOSFUSE or FUSE-T. Optionally normalized VFS can bring other benefits as well e.g. some less common or future filesystems rclone users can work with and normalization constraints imposed.\r\n\r\nThe background issue and possible solutions have been discussed on the forum:\r\n\r\nhttps://forum.rclone.org/t/possible-special-character-encoding-issue-on-macos/39048/30\r\n\r\nAt the moment many cloud storage destinations (and rclone virtual crypt remote) allow to store both NFC and NFD encoded files/directories names. Also rclone allows to upload/download both forms.\r\n\r\nThis in general works trouble free on Linux and Windows but breaks rclone mount functionality in macOS - depending on mount options either only NFC or only NFD content is visible/accessible - this is [unfortunate](https://eclecticlight.co/2021/05/08/explainer-unicode-normalization-and-apfs/) consequence of Apple design decision to be different than rest of the world and use exclusively NFD in their APIs. We won't change it.\r\n\r\nExperimentation and testing, including [attempts](https://github.com/macos-fuse-t/fuse-t/issues/16) to improve situation with FUSE-T (it has now - since v1.0.20 - `-o nfc` option which should help with NFC path) lead me to believe that last missing part of the puzzle is rclone VFS lack of normalization.\r\n\r\nI would like to propose to add optional normalization to VFS.\r\n\r\nNew option:\r\n\r\n--vfs-normalize OFF/NFC/NFD - with OFF being default \r\n\r\nWhen set to NFC or NFD it would apply characters normalization to served content.\r\n\r\nEdge case to watch is situation where two names differ only by normalization and coexist in the same folder e.g.:\r\n\r\n```\r\n$ rclone lsf crypt:TEST\r\n\r\nCONFLICTéééFILE.txt\r\nCONFLICTéééFILE.txt\r\n```\r\n\r\none file is NFC and other is NFD. Only solution I see for such case is use only one name and log ERROR.\r\n","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/7072/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/7072/timeline","performed_via_github_app":null,"state_reason":"completed"}