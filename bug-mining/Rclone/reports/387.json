{"url":"https://api.github.com/repos/rclone/rclone/issues/1919","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/1919/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/1919/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/1919/events","html_url":"https://github.com/rclone/rclone/issues/1919","id":282107443,"node_id":"MDU6SXNzdWUyODIxMDc0NDM=","number":1919,"title":"Issue when providing an invalid token to authenticate (SIGSEGV)","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":306062816,"node_id":"MDU6TGFiZWwzMDYwNjI4MTY=","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20Swift","name":"Remote: Swift","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/26","html_url":"https://github.com/rclone/rclone/milestone/26","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/26/labels","id":2656431,"node_id":"MDk6TWlsZXN0b25lMjY1NjQzMQ==","number":26,"title":"v1.39","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":35,"state":"closed","created_at":"2017-07-23T14:09:07Z","updated_at":"2018-01-11T14:25:36Z","due_on":"2017-12-22T08:00:00Z","closed_at":"2018-01-11T14:25:36Z"},"comments":7,"created_at":"2017-12-14T13:51:37Z","updated_at":"2017-12-14T16:09:52Z","closed_at":"2017-12-14T14:26:50Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"_From @giovannipizzi on December 7, 2017 15:35_\n\nWhile testing [my PR #1888 on the rclone repository](https://github.com/ncw/rclone/pull/1888) I found what I think is a bug (and I imagine it's in the swift library, that's why I'm opening it here - if it's a bug in rclone, feel free to move this issue there).\r\n\r\nBasically (when using the alternate auth method and providing `StorageUrl` and `AuthToken` only) if I provide an invalid token (wrong or expired), I get the following segmentation fault:\r\n```\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x28 pc=0x16fcfe2]\r\n\r\ngoroutine 20 [running]:\r\ngithub.com/ncw/rclone/swift.(*auth).Request(0xc4202f8320, 0xc42022e9a0, 0xc420026600, 0xc42027c900, 0x1bf32c0)\r\n\t<autogenerated>:1 +0x32\r\ngithub.com/ncw/rclone/vendor/github.com/ncw/swift.(*Connection).authenticate(0xc42022e9a0, 0x1bf32c0, 0xc42022eaf0)\r\n\t/Users/pizzi/go/src/github.com/ncw/rclone/vendor/github.com/ncw/swift/swift.go:468 +0x161\r\ngithub.com/ncw/rclone/vendor/github.com/ncw/swift.(*Connection).getUrlAndAuthToken(0xc42022e9a0, 0xc4201e43ce, 0x43, 0xc42017e040, 0xc4201e43ce, 0x43, 0x0, 0x0, 0x0, 0x0)\r\n\t/Users/pizzi/go/src/github.com/ncw/rclone/vendor/github.com/ncw/swift/swift.go:522 +0x10b\r\ngithub.com/ncw/rclone/vendor/github.com/ncw/swift.(*Connection).Call(0xc42022e9a0, 0xc4201e43ce, 0x43, 0x0, 0x0, 0x0, 0x0, 0x1ba5acf, 0x3, 0xc4201820c0, ...)\r\n\t/Users/pizzi/go/src/github.com/ncw/rclone/vendor/github.com/ncw/swift/swift.go:677 +0x1b1\r\ngithub.com/ncw/rclone/vendor/github.com/ncw/swift.(*Connection).storage(0xc42022e9a0, 0x0, 0x0, 0x0, 0x0, 0x1ba5acf, 0x3, 0xc4201820c0, 0x0, 0xc420190f00, ...)\r\n\t/Users/pizzi/go/src/github.com/ncw/rclone/vendor/github.com/ncw/swift/swift.go:779 +0x112\r\ngithub.com/ncw/rclone/vendor/github.com/ncw/swift.(*Connection).Containers(0xc42022e9a0, 0xc420042be0, 0x0, 0x2210af0, 0x0, 0x0, 0x2)\r\n\t/Users/pizzi/go/src/github.com/ncw/rclone/vendor/github.com/ncw/swift/swift.go:877 +0x18c\r\ngithub.com/ncw/rclone/vendor/github.com/ncw/swift.(*Connection).ContainersAll(0xc42022e9a0, 0x0, 0x0, 0x0, 0xc420042f08, 0x0, 0x0)\r\n\t/Users/pizzi/go/src/github.com/ncw/rclone/vendor/github.com/ncw/swift/swift.go:914 +0x128\r\ngithub.com/ncw/rclone/swift.(*Fs).listContainers(0xc4202f0c40, 0x0, 0x0, 0xc420042f6c, 0x2, 0x2, 0xc420042f68, 0x2)\r\n\t/Users/pizzi/go/src/github.com/ncw/rclone/swift/swift.go:425 +0x5e\r\ngithub.com/ncw/rclone/swift.(*Fs).List(0xc4202f0c40, 0x0, 0x0, 0x0, 0xc420025300, 0x0, 0x0, 0x0)\r\n\t/Users/pizzi/go/src/github.com/ncw/rclone/swift/swift.go:447 +0x4c\r\ngithub.com/ncw/rclone/fs.ListDirSorted(0x2192d00, 0xc4202f0c40, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n\t/Users/pizzi/go/src/github.com/ncw/rclone/fs/operations.go:629 +0x63\r\ngithub.com/ncw/rclone/fs.walk.func2(0xc4202bb1f0, 0xc4201c7380, 0x1bf1a68, 0x2192d00, 0xc4202f0c40, 0x0, 0xc4202bb1e8, 0xc4202f8340, 0xc4202bb200, 0xc4202beea0, ...)\r\n\t/Users/pizzi/go/src/github.com/ncw/rclone/fs/walk.go:120 +0x1e3\r\ncreated by github.com/ncw/rclone/fs.walk\r\n\t/Users/pizzi/go/src/github.com/ncw/rclone/fs/walk.go:112 +0x265\r\n```\r\nMy very little experience with go makes me think that clone asks the swift library to authenticate. The library tries once; if it manages, all goes well (as this is the behaviour when the token is valid). Otherwise, it tries to reauthenticate, but in this case there is some unallocated memory that is referenced.\r\n\r\nI don't know if this is due to a problem in the swift library itself, or because in rclone some internal variables of the connection object are not set up properly, or something else...\n\n_Copied from original issue: ncw/swift#108_","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/1919/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/1919/timeline","performed_via_github_app":null,"state_reason":"completed"}