{"url":"https://api.github.com/repos/rclone/rclone/issues/7787","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/7787/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/7787/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/7787/events","html_url":"https://github.com/rclone/rclone/issues/7787","id":2254915914,"node_id":"I_kwDOAQ-n5M6GZ0lK","number":7787,"title":"I encountered several errors while uploading to the PIKPAK cloud drive (investigated for over a week, identified the issues, hoping to assist in fixing).","user":{"login":"cj-neo","id":35209118,"node_id":"MDQ6VXNlcjM1MjA5MTE4","avatar_url":"https://avatars.githubusercontent.com/u/35209118?v=4","gravatar_id":"","url":"https://api.github.com/users/cj-neo","html_url":"https://github.com/cj-neo","followers_url":"https://api.github.com/users/cj-neo/followers","following_url":"https://api.github.com/users/cj-neo/following{/other_user}","gists_url":"https://api.github.com/users/cj-neo/gists{/gist_id}","starred_url":"https://api.github.com/users/cj-neo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cj-neo/subscriptions","organizations_url":"https://api.github.com/users/cj-neo/orgs","repos_url":"https://api.github.com/users/cj-neo/repos","events_url":"https://api.github.com/users/cj-neo/events{/privacy}","received_events_url":"https://api.github.com/users/cj-neo/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":5350216513,"node_id":"LA_kwDOAQ-n5M8AAAABPuXTQQ","url":"https://api.github.com/repos/rclone/rclone/labels/remote:%20PikPak","name":"remote: PikPak","color":"FBCA04","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"wiserain","id":20354654,"node_id":"MDQ6VXNlcjIwMzU0NjU0","avatar_url":"https://avatars.githubusercontent.com/u/20354654?v=4","gravatar_id":"","url":"https://api.github.com/users/wiserain","html_url":"https://github.com/wiserain","followers_url":"https://api.github.com/users/wiserain/followers","following_url":"https://api.github.com/users/wiserain/following{/other_user}","gists_url":"https://api.github.com/users/wiserain/gists{/gist_id}","starred_url":"https://api.github.com/users/wiserain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wiserain/subscriptions","organizations_url":"https://api.github.com/users/wiserain/orgs","repos_url":"https://api.github.com/users/wiserain/repos","events_url":"https://api.github.com/users/wiserain/events{/privacy}","received_events_url":"https://api.github.com/users/wiserain/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"wiserain","id":20354654,"node_id":"MDQ6VXNlcjIwMzU0NjU0","avatar_url":"https://avatars.githubusercontent.com/u/20354654?v=4","gravatar_id":"","url":"https://api.github.com/users/wiserain","html_url":"https://github.com/wiserain","followers_url":"https://api.github.com/users/wiserain/followers","following_url":"https://api.github.com/users/wiserain/following{/other_user}","gists_url":"https://api.github.com/users/wiserain/gists{/gist_id}","starred_url":"https://api.github.com/users/wiserain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wiserain/subscriptions","organizations_url":"https://api.github.com/users/wiserain/orgs","repos_url":"https://api.github.com/users/wiserain/repos","events_url":"https://api.github.com/users/wiserain/events{/privacy}","received_events_url":"https://api.github.com/users/wiserain/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":35,"created_at":"2024-04-21T05:51:44Z","updated_at":"2024-07-28T02:16:49Z","closed_at":"2024-06-10T17:08:08Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### What is the problem you are having with rclone?\r\n\r\nRecently, while using PIKPAK to upload a large amount of data, I discovered several issues (rclone shows 100% upload complete with no error messages):\r\n\r\nBecause these error will cause the uploaded files to be damaged and data to be lost, please consider repairing them as a priority if possible.\r\n\r\n1.Duplicate Files: I found numerous duplicate files within individual directories. For instance, an original file named \"file.jpg\" might have duplicates named \"file(1).jpg\", \"file(2).jpg\", and so on. These duplicate files have identical sizes and almost identical hash codes (due to some being corrupted).\r\n\r\n2.Unreadable Files: Some files uploaded cannot be read.\r\n\r\n3.Missing Original Files: Occasionally, only derivative files like \"file(1).jpg\" are present without the original file. When attempting to manually rename these files back to their original names, an error occurs stating that the file already exists!\r\n\r\n4.Files Sent to Trash: Some uploaded files end up in the trash.\r\n\r\nMoreover, it's highly probable for issues 1, 2, 3, and 4 to coexist within the same folder simultaneously, without rclone displaying any upload errors! However, reproducing the issue is straightforward: by uploading a large number of files (regardless of file size), there's roughly a 1/50 chance of encountering an error!\r\n\r\nAs I've already uploaded a significant amount of data and cannot wait for rclone to be fixed, I've taken it upon myself to write a repair program in Python (apologies for not being proficient in Go and unable to assist in modifying rclone source code).\r\n\r\nBelow are detailed observations and some of the source code used in my repair program:\r\n\r\n1.Identifying Unreadable Files:\r\nI observed and compared file attributes to distinguish unreadable files from those that can be read. After uploading, files with reading issues have attributes where the \"platform\" parameter within the \"params\" section equals \"Upload\". Normally, there should be a \"task_id\" parameter, but unreadable files lack this parameter. However, there's one exception: files with a size of zero, even if they are readable, won't have the \"task_id\" parameter.\r\n\r\n```python\r\n# List files in a folder\r\nfor f in files:\r\n  if \"task_id\" not in params and \"platform\" in params and params[\"platform\"] == \"Upload\":\r\n      if int(size) > 0:\r\n          # Code to delete unreadable files here ...\r\n```\r\n\r\n2.Identifying Hidden Files:\r\nAs some duplicated files couldn't be renamed back to their original names, I suspected that some files might be hidden. Even official software or websites couldn't detect these hidden files; I had to compare file attributes to find them. After completion of some uploads, the processing status of these files would forever remain at \"PHASE_TYPE_PENDING,\" resulting in them becoming hidden and unreadable.\r\n\r\n```python\r\n# List files in a folder\r\nfor f in files:\r\n  if phase == \"PHASE_TYPE_PENDING\":\r\n     # Code to delete hidden files here ...\r\n```\r\n\r\n3.Identifying Duplicate Files:\r\nIdentifying duplicate files is straightforward; if their hash codes are the same, they are duplicates.\r\n\r\n```python\r\ngrouped_data = {}\r\n# List files in a folder\r\nfor f in files:\r\n  if hash not in grouped_data:\r\n      grouped_data[hash] = []\r\n  grouped_data[hash].append(f)\r\nfor duplicate_list in grouped_data.values():\r\n  # Code to delete duplicate files here ...\r\n```\r\n\r\nThe parts that need to be fixed in rclone aren't complex; it just needs to check the attributes mentioned above during the upload process, identify upload failures (unreadable files), and abnormal statuses (hidden files). Only files with correct attributes should be counted as successfully uploaded; otherwise, retry the upload. As for the remaining issues (where files are duplicated or sent to the trash) , they may be caused by repeated attempts to upload failed files! Additionally, it might be worth considering adding a \"dedupe\" parameter to handle previously failed uploads (currently ineffective). \r\n\r\nSince my repair code is written in Chinese, I won't provide it here as it might appear as gibberish to non-Chinese language systems.\r\nI'm Taiwanese, and English is not my native language. This is my first time report here, so please forgive any mistakes I might make.\r\nI would like to express my gratitude for everyone's assistance. If more information is needed, please let me know.\r\n\r\n\r\n#### What is your rclone version (output from `rclone version`)\r\n1.66\r\n\r\n\r\n#### Which OS you are using and how many bits (e.g. Windows 7, 64 bit)\r\nUbuntu 22.04, 64 bit\r\n\r\n\r\n#### Which cloud storage system are you using? (e.g. Google Drive)\r\nlocal or google drive upload to pikpak\r\n\r\n\r\n#### The command you were trying to run (e.g. `rclone copy /tmp remote:tmp`)\r\nrclone copy & sync\r\n\r\n\r\n#### A log from the command with the `-vv` flag (e.g. output from `rclone -vv copy /tmp remote:tmp`)\r\nno error message\r\n\r\n\r\n<!--- Please keep the note below for others who read your bug report. -->\r\n\r\n#### How to use GitHub\r\n\r\n* Please use the üëç [reaction](https://blog.github.com/2016-03-10-add-reactions-to-pull-requests-issues-and-comments/) to show that you are affected by the same issue.\r\n* Please don't comment if you have no relevant information to add. It's just extra noise for everyone subscribed to this issue.\r\n* Subscribe to receive notifications on status change and new comments.\r\n","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/7787/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/7787/timeline","performed_via_github_app":null,"state_reason":"completed"}