{"url":"https://api.github.com/repos/rclone/rclone/issues/5468","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/5468/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/5468/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/5468/events","html_url":"https://github.com/rclone/rclone/issues/5468","id":949260271,"node_id":"MDU6SXNzdWU5NDkyNjAyNzE=","number":5468,"title":"`--s3-profile` option does not work with `role_arn` when AWS_PROFILE does","user":{"login":"arulparthiban","id":54913256,"node_id":"MDQ6VXNlcjU0OTEzMjU2","avatar_url":"https://avatars.githubusercontent.com/u/54913256?v=4","gravatar_id":"","url":"https://api.github.com/users/arulparthiban","html_url":"https://github.com/arulparthiban","followers_url":"https://api.github.com/users/arulparthiban/followers","following_url":"https://api.github.com/users/arulparthiban/following{/other_user}","gists_url":"https://api.github.com/users/arulparthiban/gists{/gist_id}","starred_url":"https://api.github.com/users/arulparthiban/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arulparthiban/subscriptions","organizations_url":"https://api.github.com/users/arulparthiban/orgs","repos_url":"https://api.github.com/users/arulparthiban/repos","events_url":"https://api.github.com/users/arulparthiban/events{/privacy}","received_events_url":"https://api.github.com/users/arulparthiban/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":314138213,"node_id":"MDU6TGFiZWwzMTQxMzgyMTM=","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20S3","name":"Remote: S3","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/45","html_url":"https://github.com/rclone/rclone/milestone/45","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/45/labels","id":6621711,"node_id":"MDk6TWlsZXN0b25lNjYyMTcxMQ==","number":45,"title":"v1.57","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":60,"state":"closed","created_at":"2021-04-03T13:03:06Z","updated_at":"2021-11-03T06:43:26Z","due_on":"2021-10-30T07:00:00Z","closed_at":"2021-11-01T17:01:17Z"},"comments":34,"created_at":"2021-07-21T02:27:16Z","updated_at":"2022-09-14T14:04:25Z","closed_at":"2021-10-30T10:55:01Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### The associated forum post URL from `https://forum.rclone.org`\r\nhttps://forum.rclone.org/t/unable-to-connect-to-s3-using-s3-profile-with-role-arn/25347\r\n\r\n\r\n#### What is the problem you are having with rclone?\r\nI believe this is a bug introduced with v1.55.x. We are currently using rclone v1.53.3 and trying to upgrade to latest version v1.55.1. During smoke test, we noticed that below feature has stopped working in v1.55.1. \r\n\r\n`~/.aws/credentials:`\r\n```\r\n[test-profile-1]\r\nrole_arn = arn:aws:iam::00000000000:role/test-role\r\nsource_profile = default\r\n\r\n[test-profile-2]\r\naws_access_key_id = XXXXXXXXXXXX\r\naws_secret_access_key = YYYYYYYYY\r\n```\r\n\r\n`~/.rclone.conf:`\r\n\r\n```\r\n[s3]\r\ntype = s3\r\nprovider = AWS\r\nenv_auth = true\r\nregion = us-east-1\r\nacl = private\r\n```\r\n\r\nHere **test-profile-1** is based on `role_arn`, whereas **test-profile-2** is based on `access_key_id` and `secret_access_key`. When trying to connect using these profiles, below are the status.\r\n```\r\naws s3 ls s3://test-logs/2021-07-13/ --profile test-profile-1 (Works !)\r\nrclone ls s3://test-logs/2021-07-13/ --s3-profile test-profile-1 (Fails !!!)\r\n\r\naws s3 ls s3://test-logs/2021-07-13/ --profile test-profile-2 (Works !)\r\nrclone ls s3://test-logs/2021-07-13/ --s3-profile test-profile-2 (Works !)\r\n```\r\n\r\n#### What is your rclone version (output from `rclone version`)\r\n```\r\nrclone v1.55.1\r\n\r\nos/type: linux\r\nos/arch: amd64\r\ngo/version: go1.16.3\r\ngo/linking: static\r\ngo/tags: none\r\n```\r\n\r\n\r\n#### Which OS you are using and how many bits (e.g. Windows 7, 64 bit)\r\nAmazon Linux 2\r\n\r\n\r\n#### Which cloud storage system are you using? (e.g. Google Drive)\r\nS3\r\n\r\n\r\n#### The command you were trying to run (e.g. `rclone copy /tmp remote:tmp`)\r\n`rclone ls s3://test-logs/2021-07-13/ --s3-profile test-profile-1`\r\n\r\n#### A log from the command with the `-vv` flag (e.g. output from `rclone -vv copy /tmp remote:tmp`)\r\n```\r\n2021/07/14 14:13:23 DEBUG : Using config file from \"/home/ec2-user/.config/rclone/rclone.conf\"\r\n2021/07/14 14:13:23 DEBUG : rclone: Version \"v1.55.1\" starting with parameters [\"rclone\" \"ls\" \"s3://test-logs/2021-07-13/\" \"--s3-profile\" \"testlogs\" \"-vv\"]\r\n2021/07/14 14:13:23 DEBUG : Creating backend with remote \"s3://test-logs/2021-07-13/\"\r\n2021/07/14 14:13:23 DEBUG : s3: detected overridden config - adding \"{jb+DA}\" suffix to name\r\n2021/07/14 14:13:24 DEBUG : fs cache: renaming cache item \"s3://test-logs/2021-07-13/\" to be canonical \"s3{jb+DA}:test-logs/2021-07-13\"\r\n2021/07/14 14:13:24 DEBUG : 4 go routines active\r\n2021/07/14 14:13:24 Failed to ls: AccessDenied: Access Denied\r\n        status code: 403, request id: 8TVCK7CVEXPF781T, host id: wEo+4KMswde6lETjLs6QnEbRpRF/+8dyhsRxBnTo3nNXgYRrJ91BDkrmuBOuid8vy0sv5UYjY5s=\r\n```\r\n\r\n\r\n<!--- Please keep the note below for others who read your bug report. -->\r\n\r\n#### How to use GitHub\r\n\r\n* Please use the üëç [reaction](https://blog.github.com/2016-03-10-add-reactions-to-pull-requests-issues-and-comments/) to show that you are affected by the same issue.\r\n* Please don't comment if you have no relevant information to add. It's just extra noise for everyone subscribed to this issue.\r\n* Subscribe to receive notifications on status change and new comments.\r\n","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/5468/reactions","total_count":4,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/5468/timeline","performed_via_github_app":null,"state_reason":"completed"}