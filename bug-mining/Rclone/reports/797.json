{"url":"https://api.github.com/repos/rclone/rclone/issues/3206","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/3206/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/3206/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/3206/events","html_url":"https://github.com/rclone/rclone/issues/3206","id":445719612,"node_id":"MDU6SXNzdWU0NDU3MTk2MTI=","number":3206,"title":"cache: server side copy not supported with --cache-tmp-upload-path","user":{"login":"jimaan","id":6625922,"node_id":"MDQ6VXNlcjY2MjU5MjI=","avatar_url":"https://avatars.githubusercontent.com/u/6625922?v=4","gravatar_id":"","url":"https://api.github.com/users/jimaan","html_url":"https://github.com/jimaan","followers_url":"https://api.github.com/users/jimaan/followers","following_url":"https://api.github.com/users/jimaan/following{/other_user}","gists_url":"https://api.github.com/users/jimaan/gists{/gist_id}","starred_url":"https://api.github.com/users/jimaan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimaan/subscriptions","organizations_url":"https://api.github.com/users/jimaan/orgs","repos_url":"https://api.github.com/users/jimaan/repos","events_url":"https://api.github.com/users/jimaan/events{/privacy}","received_events_url":"https://api.github.com/users/jimaan/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":753811007,"node_id":"MDU6TGFiZWw3NTM4MTEwMDc=","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20Cache","name":"Remote: Cache","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/18","html_url":"https://github.com/rclone/rclone/milestone/18","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/18/labels","id":1832726,"node_id":"MDk6TWlsZXN0b25lMTgzMjcyNg==","number":18,"title":"Known Problem","description":"This milestone contains issues which are known problems which are proving difficult to fix, or are awaiting an external fix or we haven't got round to yet.","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":70,"closed_issues":148,"state":"open","created_at":"2016-06-16T16:59:54Z","updated_at":"2025-08-25T17:05:37Z","due_on":null,"closed_at":null},"comments":8,"created_at":"2019-05-18T14:12:35Z","updated_at":"2020-05-19T11:17:44Z","closed_at":"2020-05-19T11:17:44Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n\r\nWelcome :-) We understand you are having a problem with rclone; we want to help you with that!\r\n\r\nIf you've just got a question or aren't sure if you've found a bug then please use the rclone forum:\r\n\r\n    https://forum.rclone.org/\r\n\r\ninstead of filing an issue for a quick response.\r\n\r\nIf you think you might have found a bug, please can you try to replicate it with the latest beta?\r\n\r\n    https://beta.rclone.org/\r\n    \r\nIf you can still replicate it with the latest beta, then please fill in the info below which makes our lives much easier.  A log with -vv will make our day :-)\r\n\r\nThank you\r\n\r\nThe Rclone Developers\r\n\r\n-->\r\n\r\n#### What is the problem you are having with rclone?\r\nrclone does not seem to fallback to Copy&Delete if Move is unavailable for S3/DigitalOcean Storage Spaces. This seems supported based on: https://rclone.org/overview/#move\r\n\r\nor maby the detection of Copy support/features fails for DigitalOcean Storage Spaces?\r\nhttps://github.com/ncw/rclone/blob/cff85f0b9551881be535a4847b56742451e6b476/vfs/file.go#L112\r\nfeatures.Copy for DigitalOcean should exist.\r\n\r\nWhen trying to move an existing file the following error is thrown:\r\nERROR : /dodata/data/movie.mkv.partial~: Dir.Rename error: Fs \"Encrypted drive 'dodata:'\" can't rename files (no server side Move or Copy)\r\n\r\nBut a copy and delete works just fine. ex.:\r\nuser@HOSTNAME:/dodata/data# touch a.txt\r\nuser@HOSTNAME:/dodata/data# mv a.txt b.txt\r\nmv: cannot move 'a.txt' to 'b.txt': Input/output error\r\nuser@HOSTNAME:/dodata/data# cp a.txt b.txt\r\nuser@HOSTNAME:/dodata/data# rm -rf a.txt\r\n\r\n/var/log/rclone.log contains:\r\nERROR : data/a.txt: Dir.Rename error: Fs \"Encrypted drive 'dodata:'\" can't rename files (no server side Move or Copy)\r\n\r\nSome relevance to:\r\nhttps://github.com/ncw/rclone/issues/2109 --> movie.mkv.partial~ is not uploaded yet and still exists only in local cache but will be uploaded if the timer of '--cache-tmp-wait-time' comes by.\r\n\r\nhttps://github.com/ncw/rclone/issues/3184 --> As said by @ncw in this issue: 'Unfortunately B2 is the only remote which doesn't support server side move or server side copy. I've talked to the B2 team about this and they are planning it, but it isn't released yet.' which seems to indicate that S3/DigitalOcean should support the fallback if Move is not supported.\r\n\r\nhttps://github.com/ncw/rclone/issues/2569 --> seems to be the original issue which fixed/supported this behavior. Commit: https://github.com/ncw/rclone/commit/a9fc86f5292005c7ce4b82e7720ea20a73ce8d9f\r\n\r\nDigitalOcean seems to support the Bucket Object Copy operation: https://developers.digitalocean.com/documentation/spaces/#copy-object\r\n\r\n#### What is your rclone version (output from `rclone version`)\r\nrclone v1.47.0\r\n- os/arch: linux/amd64\r\n- go version: go1.12.4\r\n\r\n\r\n#### Which OS you are using and how many bits (eg Windows 7, 64 bit)\r\n- os/arch: linux/amd64 --> Ubuntu 18.04 x64\r\n\r\n\r\n####  Which cloud storage system are you using? (eg Google Drive)\r\nDigitalOcean Storage Spaces\r\nremotes setup: dospaces(DO) --> cache(docache) --> crypt(dodata:)\r\nrclone.conf:\r\n[DO]\r\ntype = s3\r\nprovider = DigitalOcean\r\nenv_auth = false\r\naccess_key_id = KEY\r\nsecret_access_key = KEY2\r\nendpoint = ENDPOINT\r\n\r\n[docache]\r\ntype = cache\r\nremote = DO:BUCKETNAME\r\nchunk_total_size = 32G\r\n\r\n[dodata]\r\ntype = crypt\r\nremote = docache:\r\nfilename_encryption = standard\r\ndirectory_name_encryption = true\r\npassword = PASSWORD\r\npassword2 = PASSWORD2\r\n\r\n\r\n\r\n#### The command you were trying to run (eg `rclone copy /tmp remote:tmp`)\r\n/usr/bin/rclone mount dodata: /dodata \\\r\n   --allow-other \\\r\n   --dir-cache-time=20h \\\r\n   --cache-chunk-size=10M \\\r\n   --cache-info-age=24h \\\r\n   --cache-workers=4 \\\r\n   --buffer-size=100M \\\r\n   --attr-timeout=1s \\\r\n   --log-file=/var/log/rclone.log \\\r\n   --umask 002 \\\r\n   --rc \\\r\n   --cache-tmp-upload-path \"/data/rclone_upload\" \\\r\n   --cache-chunk-path \"/data/rclone_cache\" \\\r\n   --cache-db-path \"/data/rclone_db\" \\\r\n   --cache-tmp-wait-time 30m \\\r\n   --log-level INFO\r\n\r\n\r\n#### A log from the command with the `-vv` flag (eg output from `rclone -vv copy /tmp remote:tmp`)\r\nRelevant Lines:\r\n\r\n> DEBUG : data/: Lookup: name=\"b.txt\"\r\n DEBUG : data/: >Lookup: node=<nil>, err=no such file or directory\r\n DEBUG : data/: Lookup: name=\"a.txt\"\r\n DEBUG : data/: >Lookup: node=data/a.txt, err=<nil>\r\n DEBUG : data/a.txt: Attr: \r\n DEBUG : data/a.txt: >Attr: a=valid=1s ino=0 size=0 mode=-rw-rw-r--, err=<nil>\r\n DEBUG : data/: Lookup: name=\"a.txt\"\r\n DEBUG : data/: >Lookup: node=data/a.txt, err=<nil>\r\n DEBUG : data/a.txt: Attr: \r\n DEBUG : data/a.txt: >Attr: a=valid=1s ino=0 size=0 mode=-rw-rw-r--, err=<nil>\r\n DEBUG : data/: Lookup: name=\"b.txt\"\r\n DEBUG : data/: >Lookup: node=<nil>, err=no such file or directory\r\n DEBUG : data/: Lookup: name=\"b.txt\"\r\n DEBUG : data/: >Lookup: node=<nil>, err=no such file or directory\r\n DEBUG : data/: Rename: oldName=\"a.txt\", newName=\"b.txt\", newDir=data/\r\n ERROR : data/a.txt: Dir.Rename error: Fs \"Encrypted drive 'dodata:'\" can't rename files (no server side Move or Copy)\r\n ERROR : data/a.txt: Dir.Rename error: Fs \"Encrypted drive 'dodata:'\" can't rename files (no server side Move or Copy)\r\n DEBUG : data/: >Rename: err=Fs \"Encrypted drive 'dodata:'\" can't rename files (no server side Move or Copy)","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/3206/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/3206/timeline","performed_via_github_app":null,"state_reason":"completed"}