[{"id":1451028987,"node_id":"MDEyOkxhYmVsZWRFdmVudDE0NTEwMjg5ODc=","url":"https://api.github.com/repos/rclone/rclone/issues/events/1451028987","actor":{"login":"B4dM4n","id":448169,"node_id":"MDQ6VXNlcjQ0ODE2OQ==","avatar_url":"https://avatars.githubusercontent.com/u/448169?v=4","gravatar_id":"","url":"https://api.github.com/users/B4dM4n","html_url":"https://github.com/B4dM4n","followers_url":"https://api.github.com/users/B4dM4n/followers","following_url":"https://api.github.com/users/B4dM4n/following{/other_user}","gists_url":"https://api.github.com/users/B4dM4n/gists{/gist_id}","starred_url":"https://api.github.com/users/B4dM4n/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/B4dM4n/subscriptions","organizations_url":"https://api.github.com/users/B4dM4n/orgs","repos_url":"https://api.github.com/users/B4dM4n/repos","events_url":"https://api.github.com/users/B4dM4n/events{/privacy}","received_events_url":"https://api.github.com/users/B4dM4n/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2018-01-31T15:43:46Z","label":{"name":"bug","color":"fc2929"},"performed_via_github_app":null},{"id":1451028989,"node_id":"MDEyOkxhYmVsZWRFdmVudDE0NTEwMjg5ODk=","url":"https://api.github.com/repos/rclone/rclone/issues/events/1451028989","actor":{"login":"B4dM4n","id":448169,"node_id":"MDQ6VXNlcjQ0ODE2OQ==","avatar_url":"https://avatars.githubusercontent.com/u/448169?v=4","gravatar_id":"","url":"https://api.github.com/users/B4dM4n","html_url":"https://github.com/B4dM4n","followers_url":"https://api.github.com/users/B4dM4n/followers","following_url":"https://api.github.com/users/B4dM4n/following{/other_user}","gists_url":"https://api.github.com/users/B4dM4n/gists{/gist_id}","starred_url":"https://api.github.com/users/B4dM4n/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/B4dM4n/subscriptions","organizations_url":"https://api.github.com/users/B4dM4n/orgs","repos_url":"https://api.github.com/users/B4dM4n/repos","events_url":"https://api.github.com/users/B4dM4n/events{/privacy}","received_events_url":"https://api.github.com/users/B4dM4n/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2018-01-31T15:43:46Z","label":{"name":"FUSE","color":"0e8a16"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/362063996","html_url":"https://github.com/rclone/rclone/issues/2034#issuecomment-362063996","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2034","id":362063996,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjA2Mzk5Ng==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-31T20:42:18Z","updated_at":"2018-01-31T20:42:18Z","body":"I have to say I've been kind of ignoring the multiple file opens on the same file problem and hoping it will never happen :-)\r\n\r\n> I think, close() should check whether there is another RWFileHandle opened for it's file. Hopefully this fixes the race condition.\r\n\r\nOK, so assume we put a mutex in File for the use of Handles.\r\n\r\nWe should probably use it in Open and close()\r\n\r\nIf close() decided it didn't need to transfer the file then it should exit as it currently does.\r\n\r\nHowever if it did need to transfer the file and there were other writers then it should set a pending transfer flag in the File object and exit for the next close() to check.\r\n\r\nHow does something like that sound?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/362063996/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/362116101","html_url":"https://github.com/rclone/rclone/issues/2034#issuecomment-362116101","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2034","id":362116101,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjExNjEwMQ==","user":{"login":"B4dM4n","id":448169,"node_id":"MDQ6VXNlcjQ0ODE2OQ==","avatar_url":"https://avatars.githubusercontent.com/u/448169?v=4","gravatar_id":"","url":"https://api.github.com/users/B4dM4n","html_url":"https://github.com/B4dM4n","followers_url":"https://api.github.com/users/B4dM4n/followers","following_url":"https://api.github.com/users/B4dM4n/following{/other_user}","gists_url":"https://api.github.com/users/B4dM4n/gists{/gist_id}","starred_url":"https://api.github.com/users/B4dM4n/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/B4dM4n/subscriptions","organizations_url":"https://api.github.com/users/B4dM4n/orgs","repos_url":"https://api.github.com/users/B4dM4n/repos","events_url":"https://api.github.com/users/B4dM4n/events{/privacy}","received_events_url":"https://api.github.com/users/B4dM4n/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-01T00:21:42Z","updated_at":"2018-02-01T00:21:42Z","body":"> I have to say I've been kind of ignoring the multiple file opens on the same file problem and hoping it will never happen :-)\r\n\r\nYou never heard of Murphy's law, don't you? :laughing: \r\n\r\n> We should probably use it in Open and close()\r\n\r\nI'm not sure whether open needs to be protected by the same mutex. Only file.addWriter and file.delWriter should need to be synchronized.\r\n\r\nThis is a list of functions i think need to be synchronized:\r\n- newRWFileHandle: synchronized via cache.open + addWriter via file.muWriter\r\n- *RWFileHandle.openPending: synchronized via file.muOpen\r\n- *RWFileHandle.close(upload phase): synchronized via file.muClose + delWriter via file.muWriter\r\n- *RWFileHandle.close(remove phase): synchronized via cache.close\r\n\r\nAnd now the part how this works in my head :smile: \r\n\r\nopenPending needs to be synchronized to other openPending of the same file, so only one copy gets downloaded. A open with O_TRUNC could cancel a running copy and clear the cache file.\r\n\r\nRWFileHandle.close is mostly run with file.muClose held. file.delWriter is called to determine whether this handle was the last writer and when this is true do a operations.CopyFile to upload the cache file. Now file.muClose is released and cache.close is called, which removes the cache file when no reader is present.\r\n\r\nIt's pretty late here, so i can not guarantee this locking scheme is complete. I will look at it again tomorrow.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/362116101/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"B4dM4n","id":448169,"node_id":"MDQ6VXNlcjQ0ODE2OQ==","avatar_url":"https://avatars.githubusercontent.com/u/448169?v=4","gravatar_id":"","url":"https://api.github.com/users/B4dM4n","html_url":"https://github.com/B4dM4n","followers_url":"https://api.github.com/users/B4dM4n/followers","following_url":"https://api.github.com/users/B4dM4n/following{/other_user}","gists_url":"https://api.github.com/users/B4dM4n/gists{/gist_id}","starred_url":"https://api.github.com/users/B4dM4n/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/B4dM4n/subscriptions","organizations_url":"https://api.github.com/users/B4dM4n/orgs","repos_url":"https://api.github.com/users/B4dM4n/repos","events_url":"https://api.github.com/users/B4dM4n/events{/privacy}","received_events_url":"https://api.github.com/users/B4dM4n/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/362211930","html_url":"https://github.com/rclone/rclone/issues/2034#issuecomment-362211930","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2034","id":362211930,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjIxMTkzMA==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-01T09:42:10Z","updated_at":"2018-02-01T09:42:10Z","body":"> openPending needs to be synchronized to other openPending of the same file, so only one copy gets downloaded.\r\n\r\nI think openPending should probably be synchronized to close also, so `file.muOpen` and `file.muClose` above should be the same mutex, otherwise won't we have the problem where the file is being both downloaded and uploaded at the same time?\r\n\r\n> A open with O_TRUNC could cancel a running copy and clear the cache file.\r\n\r\nDo you see there being a separate download phase which is running without the `file.muOpen`?\r\n\r\n(Aside: one thing I'd like to do at some point is run the download in the background in `openPending` to allow the file to be accessed before it is completely downloaded, and just block on operations which require bits of the file which aren't downloaded yet.  That is a whole heap of extra complication I suggest we don't attempt yet!)\r\n\r\n> RWFileHandle.close is mostly run with file.muClose held. file.delWriter is called to determine whether this handle was the last writer and when this is true do a operations.CopyFile to upload the cache file.\r\n\r\nThough note not all the close() operations do transfer the file.\r\n\r\n> It's pretty late here, so i can not guarantee this locking scheme is complete. I will look at it again tomorrow.\r\n\r\nI think it is an excellent start :-)\r\n\r\nI think for the next evolution we should try to keep the changes as minimal as possible even if it is less than perfectly efficient - that has been my strategy in the VFS layer, correctness over efficiency.  Not always achieved though!\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/362211930/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/362220994","html_url":"https://github.com/rclone/rclone/issues/2034#issuecomment-362220994","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2034","id":362220994,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjIyMDk5NA==","user":{"login":"B4dM4n","id":448169,"node_id":"MDQ6VXNlcjQ0ODE2OQ==","avatar_url":"https://avatars.githubusercontent.com/u/448169?v=4","gravatar_id":"","url":"https://api.github.com/users/B4dM4n","html_url":"https://github.com/B4dM4n","followers_url":"https://api.github.com/users/B4dM4n/followers","following_url":"https://api.github.com/users/B4dM4n/following{/other_user}","gists_url":"https://api.github.com/users/B4dM4n/gists{/gist_id}","starred_url":"https://api.github.com/users/B4dM4n/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/B4dM4n/subscriptions","organizations_url":"https://api.github.com/users/B4dM4n/orgs","repos_url":"https://api.github.com/users/B4dM4n/repos","events_url":"https://api.github.com/users/B4dM4n/events{/privacy}","received_events_url":"https://api.github.com/users/B4dM4n/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-01T10:16:51Z","updated_at":"2018-02-01T10:16:51Z","body":"> I think openPending should probably be synchronized to close also, so file.muOpen and file.muClose above should be the same mutex, otherwise won't we have the problem where the file is being both downloaded and uploaded at the same time?\r\n\r\nA download is only done once per cache file (this is how it should work) and close is doing an openPending. This way only one can happen at the same time.\r\n\r\nI want to make sure open and close use separate locks to allow the cache file to be opened while being uploaded.\r\n\r\n> A open with O_TRUNC could cancel a running copy and clear the cache file.\r\n>> Do you see there being a separate download phase which is running without the file.muOpen?\r\n\r\nThis was just an idea which could speed up the open process in case the file get's opened with O_TRUNC, while another handle is downloading it.\r\n\r\n> Though note not all the close() operations do transfer the file.\r\n\r\nRight, only when the last writer is closing and the cache file has be modified.\r\n\r\nThe modified flag count be passed via the delWriter call like this:\r\n```\r\nfunc delWriter(h Handle, modified bool) (lastWriterAndModified bool)\r\n```\r\n\r\n> I think for the next evolution we should try to keep the changes as minimal as possible even if it is less than perfectly efficient - that has been my strategy in the VFS layer, correctness over efficiency. Not always achieved though!\r\n\r\nYou are right, the vfs layer is pretty complicated. As it is mostly working great we should be careful to not break any existing use case.\r\n\r\nI will start working today on the changes we outlined until now.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/362220994/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"B4dM4n","id":448169,"node_id":"MDQ6VXNlcjQ0ODE2OQ==","avatar_url":"https://avatars.githubusercontent.com/u/448169?v=4","gravatar_id":"","url":"https://api.github.com/users/B4dM4n","html_url":"https://github.com/B4dM4n","followers_url":"https://api.github.com/users/B4dM4n/followers","following_url":"https://api.github.com/users/B4dM4n/following{/other_user}","gists_url":"https://api.github.com/users/B4dM4n/gists{/gist_id}","starred_url":"https://api.github.com/users/B4dM4n/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/B4dM4n/subscriptions","organizations_url":"https://api.github.com/users/B4dM4n/orgs","repos_url":"https://api.github.com/users/B4dM4n/repos","events_url":"https://api.github.com/users/B4dM4n/events{/privacy}","received_events_url":"https://api.github.com/users/B4dM4n/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/362226773","html_url":"https://github.com/rclone/rclone/issues/2034#issuecomment-362226773","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2034","id":362226773,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjIyNjc3Mw==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-01T10:39:36Z","updated_at":"2018-02-01T10:39:36Z","body":"> A download is only done once per cache file (this is how it should work) and close is doing an openPending. This way only one can happen at the same time.\r\n\r\nOK\r\n\r\n> I want to make sure open and close use separate locks to allow the cache file to be opened while being uploaded.\r\n\r\n> This was just an idea which could speed up the open process in case the file get's opened with O_TRUNC, while another handle is downloading it.\r\n\r\nOh I see...  You'd have to block if it wasn't opened with truncate though.  I guess if opened read only you are OK, but if not then I guess you have to block until the upload has finished otherwise?\r\n\r\nGetting complicated :-)\r\n\r\n> The modified flag count be passed via the delWriter call like this:\r\n\r\nLooks perfect.\r\n\r\n> You are right, the vfs layer is pretty complicated. As it is mostly working great we should be careful to not break any existing use case.\r\n\r\nThere are some exhaustive tests for the RW handles, however there aren't any tests for concurrent opens, so it might be worth writing some of those first, see them break then fix them!\r\n\r\n> I will start working today on the changes we outlined until now.\r\n\r\nExcellent :-)\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/362226773/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"B4dM4n","id":448169,"node_id":"MDQ6VXNlcjQ0ODE2OQ==","avatar_url":"https://avatars.githubusercontent.com/u/448169?v=4","gravatar_id":"","url":"https://api.github.com/users/B4dM4n","html_url":"https://github.com/B4dM4n","followers_url":"https://api.github.com/users/B4dM4n/followers","following_url":"https://api.github.com/users/B4dM4n/following{/other_user}","gists_url":"https://api.github.com/users/B4dM4n/gists{/gist_id}","starred_url":"https://api.github.com/users/B4dM4n/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/B4dM4n/subscriptions","organizations_url":"https://api.github.com/users/B4dM4n/orgs","repos_url":"https://api.github.com/users/B4dM4n/repos","events_url":"https://api.github.com/users/B4dM4n/events{/privacy}","received_events_url":"https://api.github.com/users/B4dM4n/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-06T11:08:11Z","updated_at":"2018-02-06T11:08:11Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rclone/rclone/issues/2052","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/2052/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/2052/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/2052/events","html_url":"https://github.com/rclone/rclone/pull/2052","id":294719223,"node_id":"MDExOlB1bGxSZXF1ZXN0MTY3MzgzNDc0","number":2052,"title":"vfs: fix race between multiple RWFileHandle #2034","user":{"login":"B4dM4n","id":448169,"node_id":"MDQ6VXNlcjQ0ODE2OQ==","avatar_url":"https://avatars.githubusercontent.com/u/448169?v=4","gravatar_id":"","url":"https://api.github.com/users/B4dM4n","html_url":"https://github.com/B4dM4n","followers_url":"https://api.github.com/users/B4dM4n/followers","following_url":"https://api.github.com/users/B4dM4n/following{/other_user}","gists_url":"https://api.github.com/users/B4dM4n/gists{/gist_id}","starred_url":"https://api.github.com/users/B4dM4n/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/B4dM4n/subscriptions","organizations_url":"https://api.github.com/users/B4dM4n/orgs","repos_url":"https://api.github.com/users/B4dM4n/repos","events_url":"https://api.github.com/users/B4dM4n/events{/privacy}","received_events_url":"https://api.github.com/users/B4dM4n/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-02-06T11:08:11Z","updated_at":"2018-02-25T10:22:08Z","closed_at":"2018-02-18T13:12:27Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":17803236,"node_id":"MDEwOlJlcG9zaXRvcnkxNzgwMzIzNg==","name":"rclone","full_name":"rclone/rclone","private":false,"owner":{"login":"rclone","id":24937341,"node_id":"MDEyOk9yZ2FuaXphdGlvbjI0OTM3MzQx","avatar_url":"https://avatars.githubusercontent.com/u/24937341?v=4","gravatar_id":"","url":"https://api.github.com/users/rclone","html_url":"https://github.com/rclone","followers_url":"https://api.github.com/users/rclone/followers","following_url":"https://api.github.com/users/rclone/following{/other_user}","gists_url":"https://api.github.com/users/rclone/gists{/gist_id}","starred_url":"https://api.github.com/users/rclone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rclone/subscriptions","organizations_url":"https://api.github.com/users/rclone/orgs","repos_url":"https://api.github.com/users/rclone/repos","events_url":"https://api.github.com/users/rclone/events{/privacy}","received_events_url":"https://api.github.com/users/rclone/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rclone/rclone","description":"\"rsync for cloud storage\" - Google Drive, S3, Dropbox, Backblaze B2, One Drive, Swift, Hubic, Wasabi, Google Cloud Storage, Azure Blob, Azure Files, Yandex Files","fork":false,"url":"https://api.github.com/repos/rclone/rclone","forks_url":"https://api.github.com/repos/rclone/rclone/forks","keys_url":"https://api.github.com/repos/rclone/rclone/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rclone/rclone/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rclone/rclone/teams","hooks_url":"https://api.github.com/repos/rclone/rclone/hooks","issue_events_url":"https://api.github.com/repos/rclone/rclone/issues/events{/number}","events_url":"https://api.github.com/repos/rclone/rclone/events","assignees_url":"https://api.github.com/repos/rclone/rclone/assignees{/user}","branches_url":"https://api.github.com/repos/rclone/rclone/branches{/branch}","tags_url":"https://api.github.com/repos/rclone/rclone/tags","blobs_url":"https://api.github.com/repos/rclone/rclone/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rclone/rclone/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rclone/rclone/git/refs{/sha}","trees_url":"https://api.github.com/repos/rclone/rclone/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rclone/rclone/statuses/{sha}","languages_url":"https://api.github.com/repos/rclone/rclone/languages","stargazers_url":"https://api.github.com/repos/rclone/rclone/stargazers","contributors_url":"https://api.github.com/repos/rclone/rclone/contributors","subscribers_url":"https://api.github.com/repos/rclone/rclone/subscribers","subscription_url":"https://api.github.com/repos/rclone/rclone/subscription","commits_url":"https://api.github.com/repos/rclone/rclone/commits{/sha}","git_commits_url":"https://api.github.com/repos/rclone/rclone/git/commits{/sha}","comments_url":"https://api.github.com/repos/rclone/rclone/comments{/number}","issue_comment_url":"https://api.github.com/repos/rclone/rclone/issues/comments{/number}","contents_url":"https://api.github.com/repos/rclone/rclone/contents/{+path}","compare_url":"https://api.github.com/repos/rclone/rclone/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rclone/rclone/merges","archive_url":"https://api.github.com/repos/rclone/rclone/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rclone/rclone/downloads","issues_url":"https://api.github.com/repos/rclone/rclone/issues{/number}","pulls_url":"https://api.github.com/repos/rclone/rclone/pulls{/number}","milestones_url":"https://api.github.com/repos/rclone/rclone/milestones{/number}","notifications_url":"https://api.github.com/repos/rclone/rclone/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rclone/rclone/labels{/name}","releases_url":"https://api.github.com/repos/rclone/rclone/releases{/id}","deployments_url":"https://api.github.com/repos/rclone/rclone/deployments","created_at":"2014-03-16T16:19:57Z","updated_at":"2025-11-09T20:38:02Z","pushed_at":"2025-11-08T21:33:38Z","git_url":"git://github.com/rclone/rclone.git","ssh_url":"git@github.com:rclone/rclone.git","clone_url":"https://github.com/rclone/rclone.git","svn_url":"https://github.com/rclone/rclone","homepage":"https://rclone.org","size":217990,"stargazers_count":53422,"watchers_count":53422,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":4767,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1169,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["azure-blob","azure-blob-storage","azure-files","backblaze-b2","cloud-storage","dropbox","encryption","ftp","fuse-filesystem","go","golang","google-cloud-storage","google-drive","onedrive","openstack-swift","rclone","s3","sftp","sync","webdav"],"visibility":"public","forks":4767,"open_issues":1169,"watchers":53422,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/rclone/rclone/pulls/2052","html_url":"https://github.com/rclone/rclone/pull/2052","diff_url":"https://github.com/rclone/rclone/pull/2052.diff","patch_url":"https://github.com/rclone/rclone/pull/2052.patch","merged_at":"2018-02-18T13:12:27Z"},"body":"I think this is finally a working fix for #2034.\r\n\r\nIt introduces synchronization between multiple `RWFileHandle.openPending()` and between multiple `RWFileHandle.close()` of the same file.\r\n\r\n`RWFileHandle.openPending()` will try to reuse an existing cache file if one exists.\r\n\r\nIn `read_write_test.go` I had to perform a full vfs cleanup after each test to ensure there are no existing cache files. This also stops old `cache.cleaner()`'s from interfering the tests, in case the tests use more time than usual (like during debugging).\r\n\r\nShould the test changes go into a separate commit?","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/2052/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/2052/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":1479495652,"node_id":"MDExOkNsb3NlZEV2ZW50MTQ3OTQ5NTY1Mg==","url":"https://api.github.com/repos/rclone/rclone/issues/events/1479495652","actor":{"login":"B4dM4n","id":448169,"node_id":"MDQ6VXNlcjQ0ODE2OQ==","avatar_url":"https://avatars.githubusercontent.com/u/448169?v=4","gravatar_id":"","url":"https://api.github.com/users/B4dM4n","html_url":"https://github.com/B4dM4n","followers_url":"https://api.github.com/users/B4dM4n/followers","following_url":"https://api.github.com/users/B4dM4n/following{/other_user}","gists_url":"https://api.github.com/users/B4dM4n/gists{/gist_id}","starred_url":"https://api.github.com/users/B4dM4n/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/B4dM4n/subscriptions","organizations_url":"https://api.github.com/users/B4dM4n/orgs","repos_url":"https://api.github.com/users/B4dM4n/repos","events_url":"https://api.github.com/users/B4dM4n/events{/privacy}","received_events_url":"https://api.github.com/users/B4dM4n/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"62e72801bee8f20546c1a4382a8473a754b18215","commit_url":"https://api.github.com/repos/rclone/rclone/commits/62e72801bee8f20546c1a4382a8473a754b18215","created_at":"2018-02-18T13:12:29Z","state_reason":null,"performed_via_github_app":null}]