{"url":"https://api.github.com/repos/rclone/rclone/issues/7759","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/7759/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/7759/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/7759/events","html_url":"https://github.com/rclone/rclone/issues/7759","id":2239357158,"node_id":"I_kwDOAQ-n5M6FeeDm","number":7759,"title":"Improperly set \"Range\" header when retrying file download from Dropbox","user":{"login":"janvostry","id":19797524,"node_id":"MDQ6VXNlcjE5Nzk3NTI0","avatar_url":"https://avatars.githubusercontent.com/u/19797524?v=4","gravatar_id":"","url":"https://api.github.com/users/janvostry","html_url":"https://github.com/janvostry","followers_url":"https://api.github.com/users/janvostry/followers","following_url":"https://api.github.com/users/janvostry/following{/other_user}","gists_url":"https://api.github.com/users/janvostry/gists{/gist_id}","starred_url":"https://api.github.com/users/janvostry/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janvostry/subscriptions","organizations_url":"https://api.github.com/users/janvostry/orgs","repos_url":"https://api.github.com/users/janvostry/repos","events_url":"https://api.github.com/users/janvostry/events{/privacy}","received_events_url":"https://api.github.com/users/janvostry/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":306062879,"node_id":"MDU6TGFiZWwzMDYwNjI4Nzk=","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20Dropbox","name":"Remote: Dropbox","color":"fbca04","default":false,"description":null},{"id":431089529,"node_id":"MDU6TGFiZWw0MzEwODk1Mjk=","url":"https://api.github.com/repos/rclone/rclone/labels/IMPORTANT","name":"IMPORTANT","color":"d93f0b","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-04-12T08:09:35Z","updated_at":"2024-04-13T18:26:15Z","closed_at":"2024-04-13T18:25:22Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### What is the problem you are having with rclone?\r\n\r\nRclone consistently fails to sync huge files from Dropbox to Backblaze (wrapped in rclone crypt). When doing so the percentage counter goes way beyond 100% (170%+) and then it fails because of an invalid target size.\r\nThis is due to an improperly set \"Range\" header when retrying download from Dropbox, which results in re-downloading already processed data and inflating the target file - resulting in sync failure.\r\nLooks like rclone does not update the start of the range when it was already set.\r\n\r\n#### Correct behavior\r\n- Line 205 Request 0xc0008fd320 - Rclone starts downloading the file from Dropbox (1st attempt)\r\n- Line 5309 - Latest uploaded chunk before reading failure (chunk 202 size 96Mi offset 18.938Gi/67.258Gi - 20333985792 bytes sent)\r\n- Line 5310 - A reading error occurred on offset 20766346465 due to an unexpected end-of-file\r\n- Line 5311 Request 0xc0001b27e0 - Rclone starts downloading the file from Dropbox (2nd attempt), using range 20766346465-72200451298\r\n\r\n#### Incorrect behavior\r\n- Line 5632 - Latest uploaded chunk before reading failure (chunk 214 size 96Mi offset 20.062Gi/67.258Gi - 21541945344 bytes sent)\r\n- Line 5633 - A reading error occurred on offset 21662613633 due to a timeout\r\n- Line 5634 Request 0xc0008fca20 - Rclone starts downloading the file from Dropbox (3rd attempt), using a wrong range 20766346465-72200451298\r\n- However correct request range from Dropbox should be 21662613633-72200451298\r\n- Rclone is now reprocessing range 20766346465-21662613633 (854.74MB of data) from Dropbox which is already (or will be) on Backblaze\r\n\r\n#### Incorrect behavior\r\n- Line 9012 - Latest uploaded chunk before reading failure (chunk 342 size 96Mi offset 32.062Gi/67.258Gi - 34426847232 bytes sent)\r\n- Line 9013 - A reading error occurred on offset 34544399248 due to a timeout\r\n- Line 9046 Request 0xc0008fcea0 - Rclone starts downloading the file from Dropbox (4th attempt), using a wrong range 20766346465-72200451298\r\n- However correct request range from Dropbox should be 34544399248-72200451298\r\n- Rclone is now reprocessing range 20766346465-34544399248 (12.83GB of data) from Dropbox which is already (or will be) on Backblaze\r\n\r\n\r\n#### What is your rclone version (output from `rclone version`)\r\n\r\nrclone v1.66.0\r\n- os/version: Microsoft Windows 11 Pro 23H2 (64 bit)\r\n- os/kernel: 10.0.22631.3374 (x86_64)\r\n- os/type: windows\r\n- os/arch: amd64\r\n- go/version: go1.22.1\r\n- go/linking: static\r\n- go/tags: cmount\r\n\r\n\r\n#### Which OS you are using and how many bits (e.g. Windows 7, 64 bit)\r\n\r\nWindows 11 23H2 (22631.3374) 64-bit\r\n\r\n\r\n#### Which cloud storage system are you using? (e.g. Google Drive)\r\n\r\nDropbox and Backblaze B2\r\n\r\n\r\n#### The command you were trying to run (e.g. `rclone copy /tmp remote:tmp`)\r\n\r\nrclone sync DropboxArchive: BackblazeSecure:\r\n\r\n\r\n#### A log from the command with the `-vv` flag (e.g. output from `rclone -vv copy /tmp remote:tmp`)\r\n\r\n[12042024_07464315.zip](https://github.com/rclone/rclone/files/14955929/12042024_07464315.zip)\r\n\r\n\r\n#### How to use GitHub\r\n\r\n* Please use the üëç [reaction](https://blog.github.com/2016-03-10-add-reactions-to-pull-requests-issues-and-comments/) to show that you are affected by the same issue.\r\n* Please don't comment if you have no relevant information to add. It's just extra noise for everyone subscribed to this issue.\r\n* Subscribe to receive notifications on status change and new comments.\r\n","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/7759/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/7759/timeline","performed_via_github_app":null,"state_reason":"completed"}