{"url":"https://api.github.com/repos/rclone/rclone/issues/6112","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/6112/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/6112/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/6112/events","html_url":"https://github.com/rclone/rclone/issues/6112","id":1207465428,"node_id":"I_kwDOAQ-n5M5H-HXU","number":6112,"title":"Jottacloud server-side copy fails when destination is a file in trash","user":{"login":"albertony","id":12441419,"node_id":"MDQ6VXNlcjEyNDQxNDE5","avatar_url":"https://avatars.githubusercontent.com/u/12441419?v=4","gravatar_id":"","url":"https://api.github.com/users/albertony","html_url":"https://github.com/albertony","followers_url":"https://api.github.com/users/albertony/followers","following_url":"https://api.github.com/users/albertony/following{/other_user}","gists_url":"https://api.github.com/users/albertony/gists{/gist_id}","starred_url":"https://api.github.com/users/albertony/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertony/subscriptions","organizations_url":"https://api.github.com/users/albertony/orgs","repos_url":"https://api.github.com/users/albertony/repos","events_url":"https://api.github.com/users/albertony/events{/privacy}","received_events_url":"https://api.github.com/users/albertony/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1045816570,"node_id":"MDU6TGFiZWwxMDQ1ODE2NTcw","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20Jottacloud","name":"Remote: Jottacloud","color":"fbca04","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"albertony","id":12441419,"node_id":"MDQ6VXNlcjEyNDQxNDE5","avatar_url":"https://avatars.githubusercontent.com/u/12441419?v=4","gravatar_id":"","url":"https://api.github.com/users/albertony","html_url":"https://github.com/albertony","followers_url":"https://api.github.com/users/albertony/followers","following_url":"https://api.github.com/users/albertony/following{/other_user}","gists_url":"https://api.github.com/users/albertony/gists{/gist_id}","starred_url":"https://api.github.com/users/albertony/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertony/subscriptions","organizations_url":"https://api.github.com/users/albertony/orgs","repos_url":"https://api.github.com/users/albertony/repos","events_url":"https://api.github.com/users/albertony/events{/privacy}","received_events_url":"https://api.github.com/users/albertony/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"albertony","id":12441419,"node_id":"MDQ6VXNlcjEyNDQxNDE5","avatar_url":"https://avatars.githubusercontent.com/u/12441419?v=4","gravatar_id":"","url":"https://api.github.com/users/albertony","html_url":"https://github.com/albertony","followers_url":"https://api.github.com/users/albertony/followers","following_url":"https://api.github.com/users/albertony/following{/other_user}","gists_url":"https://api.github.com/users/albertony/gists{/gist_id}","starred_url":"https://api.github.com/users/albertony/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertony/subscriptions","organizations_url":"https://api.github.com/users/albertony/orgs","repos_url":"https://api.github.com/users/albertony/repos","events_url":"https://api.github.com/users/albertony/events{/privacy}","received_events_url":"https://api.github.com/users/albertony/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":3,"created_at":"2022-04-18T21:20:31Z","updated_at":"2022-04-27T15:48:47Z","closed_at":"2022-04-27T10:06:37Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### What is the problem you are having with rclone?\r\n\r\nWhile testing Jottacloud's API from personal projects, I found a strange case with the copy operation, i.e. post query parameter \"cp\" in Jottacloud API. If the destination file is in trash, the copy operation succeeds but the destination will still be in trash!\r\n\r\nKnowing this, I investigated how it affects rclone. The Jottacloud backend has server-side copy using the same post query with \"cp\" parameter. Ran some commands with rclone to provoke the situation, and the result was that a `copyto` command where the destination path matches a file in trash fails with \"Failed to copyto: object not found\". This error message comes from the fact that rclone uses the response from the, apparently successful, copy request to `newObjectWithInfo`, and there it is checked if it is a `validFile`, which in turn checks `!info.Deleted` which obviously is false.\r\n\r\nI would say this is a bug in Jottacloud's API. Being an unofficial API, the question is how should we handle it, work around it, in rclone.\r\n\r\n#### What is your rclone version (output from `rclone version`)\r\n\r\nrclone v1.59.0-DEV\r\n- os/version: Microsoft Windows 10 Enterprise 21H2 (64 bit)\r\n- os/kernel: 10.0.19044.1586 (x86_64)\r\n- os/type: windows\r\n- os/arch: amd64\r\n- go/version: go1.18.1\r\n- go/linking: dynamic\r\n- go/tags: cmount\r\n\r\n#### Which cloud storage system are you using? (e.g. Google Drive)\r\n\r\nJottacloud\r\n\r\n#### The command you were trying to run (e.g. `rclone copy /tmp remote:tmp`)\r\n\r\nThe following command sequence illustrates the case. It performs a copy of a single file with source and destination on same Jottacloud remote - such that server-side copy will be performed. The initially the copy succeeds. Then the destination is deleted by moving into trash. New copy fails. Emptying the trash and performing a new copy succeeds. Deleting the destination again, but this time without using trash, and then performing a new copy succeeds.\r\n\r\n```\r\n> rclone copyto remote:dir/file.txt remote:dir/copy/file.txt\r\n> rclone deletefile remote:dir/copy/file.txt\r\n> rclone copyto remote:dir/file.txt remote:dir/copy/file.txt\r\n2022/04/18 22:58:41 ERROR : test.txt: Failed to copy: object not found\r\n2022/04/18 22:58:41 ERROR : Attempt 1/3 failed with 1 errors and: object not found\r\n2022/04/18 22:58:41 ERROR : test.txt: Failed to copy: object not found\r\n2022/04/18 22:58:41 ERROR : Attempt 2/3 failed with 1 errors and: object not found\r\n2022/04/18 22:58:41 ERROR : test.txt: Failed to copy: object not found\r\n2022/04/18 22:58:41 ERROR : Attempt 3/3 failed with 1 errors and: object not found\r\n2022/04/18 22:58:41 Failed to copyto: object not found\r\n> rclone cleanup remote:\r\n> rclone copyto remote:dir/file.txt remote:dir/copy/file.txt\r\n> rclone deletefile remote:dir/copy/file.txt --jottacloud-hard-delete\r\n> rclone copyto remote:dir/file.txt remote:dir/copy/file.txt\r\n```\r\n\r\n<!--- Please keep the note below for others who read your bug report. -->\r\n\r\n#### How to use GitHub\r\n\r\n* Please use the üëç [reaction](https://blog.github.com/2016-03-10-add-reactions-to-pull-requests-issues-and-comments/) to show that you are affected by the same issue.\r\n* Please don't comment if you have no relevant information to add. It's just extra noise for everyone subscribed to this issue.\r\n* Subscribe to receive notifications on status change and new comments.\r\n","closed_by":{"login":"albertony","id":12441419,"node_id":"MDQ6VXNlcjEyNDQxNDE5","avatar_url":"https://avatars.githubusercontent.com/u/12441419?v=4","gravatar_id":"","url":"https://api.github.com/users/albertony","html_url":"https://github.com/albertony","followers_url":"https://api.github.com/users/albertony/followers","following_url":"https://api.github.com/users/albertony/following{/other_user}","gists_url":"https://api.github.com/users/albertony/gists{/gist_id}","starred_url":"https://api.github.com/users/albertony/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertony/subscriptions","organizations_url":"https://api.github.com/users/albertony/orgs","repos_url":"https://api.github.com/users/albertony/repos","events_url":"https://api.github.com/users/albertony/events{/privacy}","received_events_url":"https://api.github.com/users/albertony/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/6112/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/6112/timeline","performed_via_github_app":null,"state_reason":"completed"}