{"url":"https://api.github.com/repos/rclone/rclone/issues/3002","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/3002/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/3002/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/3002/events","html_url":"https://github.com/rclone/rclone/issues/3002","id":414544028,"node_id":"MDU6SXNzdWU0MTQ1NDQwMjg=","number":3002,"title":"standardize rclone webdav implementation valid for duplicacy","user":{"login":"cvillabrille","id":38108596,"node_id":"MDQ6VXNlcjM4MTA4NTk2","avatar_url":"https://avatars.githubusercontent.com/u/38108596?v=4","gravatar_id":"","url":"https://api.github.com/users/cvillabrille","html_url":"https://github.com/cvillabrille","followers_url":"https://api.github.com/users/cvillabrille/followers","following_url":"https://api.github.com/users/cvillabrille/following{/other_user}","gists_url":"https://api.github.com/users/cvillabrille/gists{/gist_id}","starred_url":"https://api.github.com/users/cvillabrille/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cvillabrille/subscriptions","organizations_url":"https://api.github.com/users/cvillabrille/orgs","repos_url":"https://api.github.com/users/cvillabrille/repos","events_url":"https://api.github.com/users/cvillabrille/events{/privacy}","received_events_url":"https://api.github.com/users/cvillabrille/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/35","html_url":"https://github.com/rclone/rclone/milestone/35","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/35/labels","id":4043942,"node_id":"MDk6TWlsZXN0b25lNDA0Mzk0Mg==","number":35,"title":"v1.48","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":22,"state":"closed","created_at":"2019-02-09T18:12:59Z","updated_at":"2019-06-19T08:41:20Z","due_on":"2019-06-15T07:00:00Z","closed_at":"2019-06-19T08:41:20Z"},"comments":23,"created_at":"2019-02-26T10:40:40Z","updated_at":"2019-06-07T10:56:00Z","closed_at":"2019-06-07T10:55:22Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n\r\nWelcome :-) We understand you are having a problem with rclone; we want to help you with that!\r\n\r\nIf you've just got a question or aren't sure if you've found a bug then please use the rclone forum:\r\n\r\n    https://forum.rclone.org/\r\n\r\ninstead of filing an issue for a quick response.\r\n\r\nIf you think you might have found a bug, please can you try to replicate it with the latest beta?\r\n\r\n    https://beta.rclone.org/\r\n    \r\nIf you can still replicate it with the latest beta, then please fill in the info below which makes our lives much easier.  A log with -vv will make our day :-)\r\n\r\nThank you\r\n\r\nThe Rclone Developers\r\n\r\n-->\r\n\r\n#### What is the problem you are having with rclone?\r\n\r\nTrying to set up duplicacy webdav respository through rclone webdav sharing.\r\n\r\nLinked to [Rclone webdav Storage path test/ does not exist ](https://forum.duplicacy.com/t/rclone-webdav-storage-path-test-does-not-exist/1821)\r\n\r\nIn order to do so, I have configured a remote storage (oneDrive, openDrive, JottaCloud, does not matter) and I am sharing it through rclone serve webdav . I can access through davfs to the share and create files and folders however if I try to set up a repository with webdav support within duplicacy, it fails with the error:\r\n**ERROR STORAGE_CREATE Failed to load the WebDAV storage at webdav://iguana@localhost/test: Storage path test/ does not exist**\r\n\r\n\r\n#### What is your rclone version (output from `rclone version`)\r\n\r\n**rclone v1.46.0-028-g972e27a8-beta**\r\n\r\n\r\n#### Which OS you are using and how many bits (eg Windows 7, 64 bit)\r\n\r\ndebian in arm rock64 board. But tried also in x86/64.\r\n\r\n####  Which cloud storage system are you using? (eg Google Drive)\r\n\r\nthe issue is not with any storage specifically, but with the webdav implementation of rclone to share files. **rclone serve webdav**.\r\n\r\n#### The command you were trying to run (eg `rclone copy /tmp remote:tmp`)\r\n\r\nExample of access through webdav.\r\n\r\nSetup:\r\n\r\nrclone side (htpasswd file contains username and pass, rootCA keys are added to the trusted root CA certs within the system and Duplicacy seems to accept the rootCA correctly). For any other interested in… [Auto generated certs for localhost](https://support.citrix.com/article/CTX135602) and [include your rootCA locally](https://superuser.com/questions/437330/how-do-you-add-a-certificate-authority-ca-to-ubuntu), I am not sure if duplicacy accepts webdav without certs, hence I created a new one based on the links.\r\n\r\nWebdav serve:\r\n\r\n `# /usr/bin/rclone serve webdav oneDrive:/Duplicacy/dataReady64/ --addr localhost:443 --htpasswd /root/certs/htpasswd --cert /root/certs/rootCA.pem --key /root/certs/rootCA.key -v -v`\r\n\r\nAccess through davfs.\r\n\r\n```\r\n# mount.davfs   https://127.0.0.1:443/ /mnt/temporal\r\nPlease enter the username to authenticate with server\r\nhttps://127.0.0.1:443/ or hit enter for none.\r\n  Username: username\r\nPlease enter the password to authenticate user iguana with server\r\nhttps://127.0.0.1:443/ or hit enter for none.\r\n  Password:\r\n# ls /mnt/temporal\r\nlost+found test\r\n# mkdir /mnt/temporal/deleteme\r\n# ls /mnt/temporal\r\ndeleteme  lost+found test\r\n```\r\n\r\n\r\nHowever, using duplicacy with webdav on the same service:\r\n\r\n```\r\nduplicacy -d -v -v -v -log  init -e -c 8M -max 16M -min 4M  dataDroid webdav://iguana@localhost/test\r\n2019-02-21 11:12:30.460 DEBUG PASSWORD_ENV_VAR Reading the environment variable DUPLICACY_WEBDAV_PASSWORD\r\n2019-02-21 11:12:31.016 ERROR STORAGE_CREATE Failed to load the WebDAV storage at webdav://iguana@localhost/test: Storage path test/ does not exist\r\n```\r\n\r\n\r\nIn the rclone debug side everything looks fine with davfs (i.e listing files and creating a folder deleteme)\r\n\r\n```\r\n2019/02/21 11:57:24 DEBUG : Using config file from \"/root/.config/rclone/rclone.conf\"\r\n2019/02/21 11:57:27 INFO  : One drive root 'Duplicacy/dataReady64': poll-interval is not supported by this remote\r\n2019/02/21 11:57:27 DEBUG : Adding path \"vfs/forget\" to remote control registry\r\n2019/02/21 11:57:27 DEBUG : Adding path \"vfs/refresh\" to remote control registry\r\n2019/02/21 11:57:27 DEBUG : Adding path \"vfs/poll-interval\" to remote control registry\r\n2019/02/21 11:57:27 INFO  : Using \"/root/certs/htpasswd\" as htpasswd storage\r\n2019/02/21 11:57:27 NOTICE: One drive root 'Duplicacy/dataReady64': WebDav Server started on https://127.0.0.1:443/\r\n2019/02/21 11:57:41 INFO  : /test/: 127.0.0.1:50648: Basic auth challenge sent\r\n2019/02/21 11:57:41 DEBUG : /test/: Stat:\r\n2019/02/21 11:57:41 DEBUG : /test/: >Stat: fi={FileInfo:test/}, err = <nil>\r\n2019/02/21 11:57:41 INFO  : /test/: OPTIONS from 127.0.0.1:50648\r\n2019/02/21 11:57:41 DEBUG : /test/: Stat:\r\n2019/02/21 11:57:41 DEBUG : /test/: >Stat: fi={FileInfo:test/}, err = <nil>\r\n2019/02/21 11:57:41 DEBUG : /test/: OpenFile: flags=0, perm=----------\r\n2019/02/21 11:57:41 DEBUG : /test/: OpenFile: flags=O_RDONLY, perm=----------\r\n2019/02/21 11:57:41 DEBUG : /test/: >OpenFile: fd=test/ (r), err=<nil>\r\n2019/02/21 11:57:41 DEBUG : /test/: >OpenFile: err = <nil>\r\n2019/02/21 11:57:41 DEBUG : /test/: OpenFile: flags=0, perm=----------\r\n2019/02/21 11:57:41 DEBUG : /test/: OpenFile: flags=O_RDONLY, perm=----------\r\n2019/02/21 11:57:41 DEBUG : /test/: >OpenFile: fd=test/ (r), err=<nil>\r\n2019/02/21 11:57:41 DEBUG : /test/: >OpenFile: err = <nil>\r\n2019/02/21 11:57:42 INFO  : /test/: PROPFIND from 127.0.0.1:50648\r\n2019/02/21 11:57:42 DEBUG : /test/: Stat:\r\n2019/02/21 11:57:42 DEBUG : /test/: >Stat: fi={FileInfo:test/}, err = <nil>\r\n2019/02/21 11:57:42 DEBUG : /test/: OpenFile: flags=0, perm=----------\r\n2019/02/21 11:57:42 DEBUG : /test/: OpenFile: flags=O_RDONLY, perm=----------\r\n2019/02/21 11:57:42 DEBUG : /test/: >OpenFile: fd=test/ (r), err=<nil>\r\n2019/02/21 11:57:42 DEBUG : /test/: >OpenFile: err = <nil>\r\n2019/02/21 11:57:42 INFO  : /test/: PROPFIND from 127.0.0.1:50648\r\n2019/02/21 11:57:51 DEBUG : /test/: Stat:\r\n2019/02/21 11:57:51 DEBUG : /test/: >Stat: fi={FileInfo:test/}, err = <nil>\r\n2019/02/21 11:57:51 DEBUG : /test/: OpenFile: flags=0, perm=----------\r\n2019/02/21 11:57:51 DEBUG : /test/: OpenFile: flags=O_RDONLY, perm=----------\r\n2019/02/21 11:57:51 DEBUG : /test/: >OpenFile: fd=test/ (r), err=<nil>\r\n2019/02/21 11:57:51 DEBUG : /test/: >OpenFile: err = <nil>\r\n2019/02/21 11:57:51 DEBUG : /test/: OpenFile: flags=0, perm=----------\r\n2019/02/21 11:57:51 DEBUG : /test/: OpenFile: flags=O_RDONLY, perm=----------\r\n2019/02/21 11:57:51 DEBUG : /test/: >OpenFile: fd=test/ (r), err=<nil>\r\n2019/02/21 11:57:51 DEBUG : /test/: >OpenFile: err = <nil>\r\n2019/02/21 11:57:51 INFO  : /test/: PROPFIND from 127.0.0.1:50648\r\n2019/02/21 11:57:51 DEBUG : /test/deleteme/: Mkdir: perm=-rwxrwxrwx\r\n2019/02/21 11:57:54 DEBUG : /test/deleteme/: >Mkdir: err = <nil>\r\n2019/02/21 11:57:54 INFO  : /test/deleteme/: MKCOL from 127.0.0.1:50648\r\n```\r\n\r\n\r\nduplicacy seems to access to with no errors from rclone side…\r\n\r\n```\r\n2019/02/21 11:58:55 DEBUG : /test/: Stat:\r\n2019/02/21 11:58:55 DEBUG : /test/: >Stat: fi={FileInfo:test/}, err = <nil>\r\n2019/02/21 11:58:55 DEBUG : /test/: OpenFile: flags=0, perm=----------\r\n2019/02/21 11:58:55 DEBUG : /test/: OpenFile: flags=O_RDONLY, perm=----------\r\n2019/02/21 11:58:55 DEBUG : /test/: >OpenFile: fd=test/ (r), err=<nil>\r\n2019/02/21 11:58:55 DEBUG : /test/: >OpenFile: err = <nil>\r\n2019/02/21 11:58:55 INFO  : /test/: PROPFIND from 127.0.0.1:50698\r\n```\r\n\r\nbut it generates the error initializing or accessing any folder…\r\n\r\n```\r\n2019-02-21 12:00:07.253 DEBUG PASSWORD_ENV_VAR Reading the environment variable DUPLICACY_WEBDAV_PASSWORD\r\n2019-02-21 12:00:07.774 ERROR STORAGE_CREATE Failed to load the WebDAV storage at webdav://iguana@localhost/test: Storage path test/ does not exist\r\n```\r\n\r\n\r\n#### A log from the command with the `-vv` flag (eg output from `rclone -vv copy /tmp remote:tmp`)\r\n\r\nprovided above.\r\n\r\n\r\n\r\nNote for the certs creation for localhost (duplicacy does not accept certs without the correct sign off)... here is how I made them for a quick reference...\r\n\r\ncreate a file called req.conf with the following content:\r\n\r\n```\r\n[req]\r\ndistinguished_name = req_distinguished_name\r\nx509_extensions = v3_req\r\nprompt = no\r\n[req_distinguished_name]\r\nC = ES\r\nST = Asturias\r\nL = Oviedo\r\nO = AnaSoft\r\nOU = Consultancy\r\nCN = localhost\r\n[v3_req]\r\nkeyUsage = keyEncipherment, dataEncipherment\r\nextendedKeyUsage = serverAuth\r\nsubjectAltName = @alt_names\r\n[alt_names]\r\nDNS.1 = 127.0.0.1\r\nDNS.2 = localhost\r\nDNS.3 = company.net\r\n```\r\n\r\nthen, run the following commands.... (this is for debian, specifically the /usr/local/share/ca-certificates folder)\r\n\r\n```\r\n# openssl genrsa -out rootCA.key 2048\r\n# openssl req -x509 -new -nodes -key rootCA.key -sha256 -days 1024 -out rootCA.pem -config req.conf -extensions 'v3_req'\r\n# cp rootCA.pem /usr/local/share/ca-certificates/rootCA.crt\r\n# sudo update-ca-certificates\r\n```\r\n","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/3002/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/3002/timeline","performed_via_github_app":null,"state_reason":"completed"}