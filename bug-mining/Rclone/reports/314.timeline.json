[{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/306276080","html_url":"https://github.com/rclone/rclone/issues/1467#issuecomment-306276080","issue_url":"https://api.github.com/repos/rclone/rclone/issues/1467","id":306276080,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjI3NjA4MA==","user":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-05T19:14:52Z","updated_at":"2017-06-05T19:30:59Z","body":"@breunigs Also looking at that commit, I believe another problem is present if multiple rclone processes are running at the same time. \t\r\nIf the config file is renamed to an old one first then any other process trying to read that file at that time will fail.  Perhaps instead of renaming the file, the file is 'copied' to 'old' then it gets renamed to the new config. Then remove the old....   There is still a race condition between multiple rclone's writing to that file but at least it isn't both read and writing.\r\n\r\nread config\r\nwrite config.new\r\ndelete config.old if it exists\r\n**COPY** config config.old\r\n**MOVE**  config.new config\r\n\r\n\r\n```\r\n+ if err = os.Rename(ConfigPath, ConfigPath+\".old\"); err != nil && !os.IsNotExist(err) {\r\n +\t\tlog.Fatalf(\"Failed to move previous config to backup location: %v\", err)\r\n +\t}\r\n +\tif err = os.Rename(f.Name(), ConfigPath); err != nil {\r\n +\t\tlog.Fatalf(\"Failed to move newly written config from %s to final location: %v\", f.Name(), err)\r\n +\t}\r\n +\tif err := os.Remove(ConfigPath + \".old\"); err != nil && !os.IsNotExist(err) {\r\n +\t\tErrorf(nil, \"Failed to remove backup config file: %v\", err)\r\n +\t}\r\n```","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/306276080/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1110523268,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTExMDUyMzI2OA==","url":"https://api.github.com/repos/rclone/rclone/issues/events/1110523268","actor":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2017-06-05T19:19:41Z","performed_via_github_app":null},{"id":1110523269,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDExMTA1MjMyNjk=","url":"https://api.github.com/repos/rclone/rclone/issues/events/1110523269","actor":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2017-06-05T19:19:41Z","performed_via_github_app":null},{"id":1110547183,"node_id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50MTExMDU0NzE4Mw==","url":"https://api.github.com/repos/rclone/rclone/issues/events/1110547183","actor":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2017-06-05T19:33:27Z","rename":{"from":".rclone.conf becoming owned by a different user","to":".rclone.conf becoming owned by a different user with different permissions"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/306286487","html_url":"https://github.com/rclone/rclone/issues/1467#issuecomment-306286487","issue_url":"https://api.github.com/repos/rclone/rclone/issues/1467","id":306286487,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjI4NjQ4Nw==","user":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-05T19:57:26Z","updated_at":"2017-06-05T19:57:26Z","body":"Regarding the permissions: rclone has always set those to `0600`. I guess it previously worked for you because rclone would continue even if it couldn't set the permissions. For instance, if a file is owned by `root:root` with `0777`, any user can write to it, but not change permissions. I am not sure what's a good approach here, as `0600` is a sensible permission to have, considering the config file contains credentials.\r\n\r\nRegarding the user: It can be kept, if and only if the current user is privileged enough. This would work for root+user, but probably not for root+user1+user2.\r\n\r\nRegarding the race condition: I would use a lock file instead, which should solve everything nicely, both reading and writing.\r\n\r\nTo sum things up:\r\n- the race condition is an obvious flaw, that is straightforward to fix. Good catch!\r\n- I don't see any decent solution for the owner/permission issue yet. As a workaround you can copy the file to every user that needs it when you do manual changes (and adjust permissions).","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/306286487/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/306287939","html_url":"https://github.com/rclone/rclone/issues/1467#issuecomment-306287939","issue_url":"https://api.github.com/repos/rclone/rclone/issues/1467","id":306287939,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjI4NzkzOQ==","user":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-05T20:01:05Z","updated_at":"2017-06-05T20:04:44Z","body":"For hte permissions, instead of recreating the files, if you simply change the contents, the permissions do not get changed.  For example in Linux If I 'cat' new data into an existing file the permissions on that file and the ownership remains the same.  Perhaps instead of moving/renaming the main file you change the contents.  The only file that 'matters' is that main config file and NOT hte .old as that is just transient data.  \r\n\r\nread config\r\nwrite config.new\r\ndelete config.old if it exists\r\nCOPY config config.old\r\ngo equivalent of 'cat' into the existing config.\r\n\r\nThe key here is never to remove the original 'config' and instead just replace the contents of that file.  \r\n\r\nThat would solve all the permissions problems and ownership. This also helps if the current user is NOT privileged enough:\r\n\r\n\"Regarding the user: It can be kept, if and only if the current user is privileged enough. This would work for root+user, but probably not for root+user1+user2.\"\r\n\r\nIf the user has write, then it simply works.\r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/306287939/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1110591540,"node_id":"MDExOkNsb3NlZEV2ZW50MTExMDU5MTU0MA==","url":"https://api.github.com/repos/rclone/rclone/issues/events/1110591540","actor":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2017-06-05T20:01:05Z","state_reason":null,"performed_via_github_app":null},{"id":1110591767,"node_id":"MDEzOlJlb3BlbmVkRXZlbnQxMTEwNTkxNzY3","url":"https://api.github.com/repos/rclone/rclone/issues/events/1110591767","actor":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"reopened","commit_id":null,"commit_url":null,"created_at":"2017-06-05T20:01:11Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/306294271","html_url":"https://github.com/rclone/rclone/issues/1467#issuecomment-306294271","issue_url":"https://api.github.com/repos/rclone/rclone/issues/1467","id":306294271,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjI5NDI3MQ==","user":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-05T20:23:01Z","updated_at":"2017-06-05T20:23:01Z","body":"`cat`, `copy` and \"write to file\" are essentially the same: read some bytes, write some bytes, repeat until done. `copy`, or at least the tool `cp` also sets permissions on the new file. Writing bytes is unfortunately not atomic, so we might need multiple system calls to actually write a file. If the disk is full, we might end up with a half-written and thus broken file.\r\n\r\nIf I am not mistaken, your last suggestion would re-open #1287 when `cat` fails due to the disk being full. That's why the patch uses `rename` in the first place: this action is atomic and thus doesn't leave files in an undetermined state – it either works or doesn't.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/306294271/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/306297391","html_url":"https://github.com/rclone/rclone/issues/1467#issuecomment-306297391","issue_url":"https://api.github.com/repos/rclone/rclone/issues/1467","id":306297391,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjI5NzM5MQ==","user":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-05T20:35:04Z","updated_at":"2017-06-05T20:42:28Z","body":"Hmm.  Agreed but there has to be a better way to protect the file on a full disk without breaking changed permissions/ownership of the config and existing use cases.  My thought process was if the disk is full then the last write would fail and if that were the case, rclone should fail anyway and remove the half written file if it exists.  On the next run, rclone should be able to determine that it failed previously by detecting the presence of the old file and adjusting itself by using that backup file.\r\n\r\nread config\r\nwrite config.new\r\ndelete config.old if it exists\r\nCOPY config config.old  \r\n<===== Disk FULL\r\nif write to new config FAILS then abort and attempt to rewrite to that file from the old file.\r\n\r\nNext time rclone starts, if there is a 'old' file then rclone KNOWS it aborted last time and it should use the 'old' file as the correct one and again try to WRITE to the config from config.old.  It should NEVER remove the config and instead always try to WRITE to it again.\r\n\r\n\r\n\r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/306297391/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1110661357,"node_id":"MDExOkNsb3NlZEV2ZW50MTExMDY2MTM1Nw==","url":"https://api.github.com/repos/rclone/rclone/issues/events/1110661357","actor":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2017-06-05T20:44:13Z","state_reason":null,"performed_via_github_app":null},{"id":1110661537,"node_id":"MDEzOlJlb3BlbmVkRXZlbnQxMTEwNjYxNTM3","url":"https://api.github.com/repos/rclone/rclone/issues/events/1110661537","actor":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"reopened","commit_id":null,"commit_url":null,"created_at":"2017-06-05T20:44:21Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/306303813","html_url":"https://github.com/rclone/rclone/issues/1467#issuecomment-306303813","issue_url":"https://api.github.com/repos/rclone/rclone/issues/1467","id":306303813,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjMwMzgxMw==","user":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-05T20:49:28Z","updated_at":"2017-06-05T20:49:28Z","body":"This is sort of what I was thinking to prevent the loss of permissions/owners while still protecting the config.\r\n\r\nif  config.old then \r\n    assume previous write failure\r\n    write config.old config\r\nend if\r\n\r\nread config\r\nobtain lock\r\nwrite config.new\r\ndelete config.old if it exists\r\ncopy config config.old\r\ncat config.new >> config\r\ndelete config.new\r\ndelete config.old\r\nrelease lock","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/306303813/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/306322574","html_url":"https://github.com/rclone/rclone/issues/1467#issuecomment-306322574","issue_url":"https://api.github.com/repos/rclone/rclone/issues/1467","id":306322574,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjMyMjU3NA==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-05T21:58:56Z","updated_at":"2017-06-05T21:58:56Z","body":"The traditional way of avoiding races under unix is with a hard link & rename\r\n\r\n  * remove config.old if it exists\r\n  * hard link config -> config.old\r\n  * write config.new\r\n  * rename config.new config\r\n\r\nThose are all atomic operations and there will never be a moment when there isn't a valid config file.\r\n\r\nHowever that is not cross platform and it doesn't fix the ownership problem.\r\n\r\nCross platform locking is a nightmare, however this appears to be a module which does the right things: [lockfile](https://github.com/nightlyone/lockfile) if we want to go in that direction.\r\n\r\nI think I'd suggest as a compromise to use the current sequence but if rclone is running as root to preserve the ownership of the config file (or attempt to preserve it regardless).  That will mean that we can still have a nice atomic rename to fix the original bug, and it will fix this issue too.  It won't fix user1+user2 with a 777 config file, but no-one has reported that problem!\r\n\r\n[os.Chown](https://golang.org/pkg/os/#Chown) exists for all platforms so this might actually be an easy fix.\r\n\r\nCopying the config to config.old (or hard linking it) instead of renaming it would fix the race window.  Unfortunately Windows is fussy about renaming files over existing files.\r\n\r\nGah, saving config files is hard ;-)\r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/306322574/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/306330218","html_url":"https://github.com/rclone/rclone/issues/1467#issuecomment-306330218","issue_url":"https://api.github.com/repos/rclone/rclone/issues/1467","id":306330218,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjMzMDIxOA==","user":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-05T22:37:59Z","updated_at":"2017-06-05T22:37:59Z","body":"If we're going to use os.chown, can we also ensure we keep the permissions of the original file as well?  At least that will ensure that my user1+user2+root use case continues to function correctly.  I believe if I give write permissions to the group both of those users are part of it should work. The ownership will bounce back and forth between the two users but it should still work.  I'd really rather not have to maintain two conf files if possible but I do understand the cross platform complexity.\r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/306330218/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/306557297","html_url":"https://github.com/rclone/rclone/issues/1467#issuecomment-306557297","issue_url":"https://api.github.com/repos/rclone/rclone/issues/1467","id":306557297,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjU1NzI5Nw==","user":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-06T17:22:21Z","updated_at":"2017-06-06T17:22:21Z","body":"regarding nightlyone/lockfile: I had already a look at the code and it seems decent (so definitely worth using over rolling our own)\r\n\r\nregarding renaming over existing files: did you check that? At least godoc claims the renaming over existing files overwrites them: https://golang.org/pkg/os/#Rename I guess I could give it a try using one of those IE11 TestDrive VMs…","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/306557297/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1133365293,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDExMzMzNjUyOTM=","url":"https://api.github.com/repos/rclone/rclone/issues/events/1133365293","actor":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"32e14d6361a825e52dfc725a8cf192ba160224a6","commit_url":"https://api.github.com/repos/breunigs/rclone/commits/32e14d6361a825e52dfc725a8cf192ba160224a6","created_at":"2017-06-21T17:37:00Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/310168460","html_url":"https://github.com/rclone/rclone/issues/1467#issuecomment-310168460","issue_url":"https://api.github.com/repos/rclone/rclone/issues/1467","id":310168460,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMDE2ODQ2MA==","user":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-21T18:39:18Z","updated_at":"2017-06-21T18:40:16Z","body":"@calisro Here's a patched rclone version that will keep permissions and *group* only. I think that goes in more in line with the permission model's idea and should support unlimited amount of users (well, it does not include locking, so the race conditions will be a an issue at some point).\r\n\r\nI can make it so that rclone keeps the owner the same, if it runs as root. The logic is already quite complex, so I would like to only do so if absolutely necessary. \r\n\r\nLogn story short, to make your use case work:\r\n- use this version: https://www.breunig.xyz/share/2017-06-21/rclone-df293e3e884eb8cce2b58cc5d331ff9727c70f1a\r\n- you can (must) symlink the directory the config file resides in, if you were sym/hardlinking the config file before. All rclone users must be able to read/write in that directory.\r\n- option A: if it's okay that everyone can read/write the file, ensure you call `chmod o+rw` on the config file. This should be it.\r\n- option B: if only rclone users should be able to read/write the file, ensure every rclone user has at least one group in common. I guess `rclone` is a sensible name. Then ensure that the config file has `chmod g+rw` and `chown DoesNotMatter:rlcone`, i.e. that the config file belongs to the correct group. The owner will change all the time, as you mentioned before, but the group will stay the same ensuring everyone can read/write it.\r\n\r\nCan you give it a try and see if it works?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/310168460/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1133462782,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTEzMzQ2Mjc4Mg==","url":"https://api.github.com/repos/rclone/rclone/issues/events/1133462782","actor":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2017-06-21T18:39:18Z","performed_via_github_app":null},{"id":1133462783,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDExMzM0NjI3ODM=","url":"https://api.github.com/repos/rclone/rclone/issues/events/1133462783","actor":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2017-06-21T18:39:18Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/310169573","html_url":"https://github.com/rclone/rclone/issues/1467#issuecomment-310169573","issue_url":"https://api.github.com/repos/rclone/rclone/issues/1467","id":310169573,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMDE2OTU3Mw==","user":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-21T18:43:13Z","updated_at":"2017-06-21T18:43:13Z","body":"code is in this branch: https://github.com/ncw/rclone/tree/1467-fix-config-ownership","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/310169573/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/310189141","html_url":"https://github.com/rclone/rclone/issues/1467#issuecomment-310189141","issue_url":"https://api.github.com/repos/rclone/rclone/issues/1467","id":310189141,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMDE4OTE0MQ==","user":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-21T20:02:32Z","updated_at":"2017-06-21T20:02:32Z","body":"I think this will work ok.  I can simply change the permissions to 660 and when root overwrites the file it will become owned by root but the group remained the original group and that original user can still read/write the file because it has group write.  I'll run it like this for a few days and see if anything weird occurs.\r\n\r\nI did test a few scenarios where multiple mounts running (1 as the user and 4 as root) as well as adhoc rclone commands while doing the following:\r\n-- letting it renew tokens\r\n-- creating new remotes via 'config' as root and user\r\n-- deleting entries as root and user\r\n\r\nIt appears to be working great.  I can live without keeping the owner consistent and rely on the group and group permissions to manage it.\r\n\r\nAnyway, thanks a LOT for this and i'll report back if this appears to break something.  Feel free to close this issue once merged and i'll reopen if I find something broken.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/310189141/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1137658221,"node_id":"MDExOkNsb3NlZEV2ZW50MTEzNzY1ODIyMQ==","url":"https://api.github.com/repos/rclone/rclone/issues/events/1137658221","actor":{"login":"breunigs","id":307954,"node_id":"MDQ6VXNlcjMwNzk1NA==","avatar_url":"https://avatars.githubusercontent.com/u/307954?v=4","gravatar_id":"","url":"https://api.github.com/users/breunigs","html_url":"https://github.com/breunigs","followers_url":"https://api.github.com/users/breunigs/followers","following_url":"https://api.github.com/users/breunigs/following{/other_user}","gists_url":"https://api.github.com/users/breunigs/gists{/gist_id}","starred_url":"https://api.github.com/users/breunigs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breunigs/subscriptions","organizations_url":"https://api.github.com/users/breunigs/orgs","repos_url":"https://api.github.com/users/breunigs/repos","events_url":"https://api.github.com/users/breunigs/events{/privacy}","received_events_url":"https://api.github.com/users/breunigs/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"52b042971a6f9bb72db18b5ef88445e9ebc6d220","commit_url":"https://api.github.com/repos/rclone/rclone/commits/52b042971a6f9bb72db18b5ef88445e9ebc6d220","created_at":"2017-06-25T07:05:42Z","state_reason":null,"performed_via_github_app":null}]