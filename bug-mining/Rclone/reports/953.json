{"url":"https://api.github.com/repos/rclone/rclone/issues/5210","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/5210/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/5210/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/5210/events","html_url":"https://github.com/rclone/rclone/issues/5210","id":849917350,"node_id":"MDU6SXNzdWU4NDk5MTczNTA=","number":5210,"title":"FTPS (FTP with implicit TLS) issues in rclone-v1.55.0-windows-amd64","user":{"login":"aliron19","id":47508555,"node_id":"MDQ6VXNlcjQ3NTA4NTU1","avatar_url":"https://avatars.githubusercontent.com/u/47508555?v=4","gravatar_id":"","url":"https://api.github.com/users/aliron19","html_url":"https://github.com/aliron19","followers_url":"https://api.github.com/users/aliron19/followers","following_url":"https://api.github.com/users/aliron19/following{/other_user}","gists_url":"https://api.github.com/users/aliron19/gists{/gist_id}","starred_url":"https://api.github.com/users/aliron19/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aliron19/subscriptions","organizations_url":"https://api.github.com/users/aliron19/orgs","repos_url":"https://api.github.com/users/aliron19/repos","events_url":"https://api.github.com/users/aliron19/events{/privacy}","received_events_url":"https://api.github.com/users/aliron19/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":608259284,"node_id":"MDU6TGFiZWw2MDgyNTkyODQ=","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20FTP","name":"Remote: FTP","color":"fbca04","default":false,"description":""},{"id":1710413418,"node_id":"MDU6TGFiZWwxNzEwNDEzNDE4","url":"https://api.github.com/repos/rclone/rclone/labels/Point%20Release%20Candidate","name":"Point Release Candidate","color":"b60205","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"ivandeex","id":9028053,"node_id":"MDQ6VXNlcjkwMjgwNTM=","avatar_url":"https://avatars.githubusercontent.com/u/9028053?v=4","gravatar_id":"","url":"https://api.github.com/users/ivandeex","html_url":"https://github.com/ivandeex","followers_url":"https://api.github.com/users/ivandeex/followers","following_url":"https://api.github.com/users/ivandeex/following{/other_user}","gists_url":"https://api.github.com/users/ivandeex/gists{/gist_id}","starred_url":"https://api.github.com/users/ivandeex/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivandeex/subscriptions","organizations_url":"https://api.github.com/users/ivandeex/orgs","repos_url":"https://api.github.com/users/ivandeex/repos","events_url":"https://api.github.com/users/ivandeex/events{/privacy}","received_events_url":"https://api.github.com/users/ivandeex/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"ivandeex","id":9028053,"node_id":"MDQ6VXNlcjkwMjgwNTM=","avatar_url":"https://avatars.githubusercontent.com/u/9028053?v=4","gravatar_id":"","url":"https://api.github.com/users/ivandeex","html_url":"https://github.com/ivandeex","followers_url":"https://api.github.com/users/ivandeex/followers","following_url":"https://api.github.com/users/ivandeex/following{/other_user}","gists_url":"https://api.github.com/users/ivandeex/gists{/gist_id}","starred_url":"https://api.github.com/users/ivandeex/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivandeex/subscriptions","organizations_url":"https://api.github.com/users/ivandeex/orgs","repos_url":"https://api.github.com/users/ivandeex/repos","events_url":"https://api.github.com/users/ivandeex/events{/privacy}","received_events_url":"https://api.github.com/users/ivandeex/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/44","html_url":"https://github.com/rclone/rclone/milestone/44","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/44/labels","id":6389295,"node_id":"MDk6TWlsZXN0b25lNjM4OTI5NQ==","number":44,"title":"v1.56","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":36,"state":"closed","created_at":"2021-02-03T16:05:32Z","updated_at":"2021-07-20T20:07:10Z","due_on":"2021-07-16T07:00:00Z","closed_at":"2021-07-20T20:07:10Z"},"comments":17,"created_at":"2021-04-04T17:05:06Z","updated_at":"2021-04-08T22:43:50Z","closed_at":"2021-04-08T22:43:50Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hello,\r\n\r\nI've been using rclone (on a Windows 10 Pro 64bits machine) to sync a local directory with a remote FTPS server (FileZilla Server v0.9.60.2, configured to use implicit TLS) without issues, until rclone v1.54.1.\r\n\r\nHowever, after testing rclone v1.55.0 I've found that it doesn't work with FTPS (implicit TLS) any more, but it seems to work fine with FTPES (FTP over explicit TLS).\r\n\r\nIf I try to list the remote, this is what I get:\r\n\r\n```\r\n>rclone.exe ls -vv ftps_remote://\r\n\r\n2021/04/04 18:40:37 DEBUG : Using config file from \"C:\\\\Users\\\\MyUsername\\\\.config\\\\rclone\\\\rclone.conf\"\r\n2021/04/04 18:40:37 DEBUG : rclone: Version \"v1.55.0\" starting with parameters [\"rclone\" \"ls\" \"-vv\" \"ftps_remote://\"]\r\n2021/04/04 18:40:37 DEBUG : Creating backend with remote \"ftps_remote://\"\r\n2021/04/04 18:40:37 DEBUG : ftps://MY_IP:MY_PORT: Connecting to FTP server\r\n2021/04/04 18:40:37 ERROR : : error listing: 521 PROT P required\r\n2021/04/04 18:40:37 DEBUG : 2 go routines active\r\n2021/04/04 18:40:37 Failed to ls with 2 errors: last error was: 521 PROT P required\r\n```\r\n\r\nOn my FileZilla server, using restic v1.55.0 I get the following log:\r\n\r\n```\r\n(000070)04/04/2021 18:45:13 - (not logged in) (MY_IP)> Connected on port MY_PORT, sending welcome message...\r\n(000070)04/04/2021 18:45:13 - (not logged in) (MY_IP)> 220 Welcome message\r\n(000070)04/04/2021 18:45:13 - (not logged in) (MY_IP)> TLS connection established\r\n(000070)04/04/2021 18:45:13 - (not logged in) (MY_IP)> USER username\r\n(000070)04/04/2021 18:45:13 - (not logged in) (MY_IP)> 331 Password required for username\r\n(000070)04/04/2021 18:45:13 - (not logged in) (MY_IP)> PASS ******\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)> 230 Logged on\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)> FEAT\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)> 211-Features:\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)>  MDTM\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)>  REST STREAM\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)>  SIZE\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)>  MLST type*;size*;modify*;\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)>  MLSD\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)>  AUTH SSL\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)>  AUTH TLS\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)>  PROT\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)>  PBSZ\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)>  UTF8\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)>  CLNT\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)>  MFMT\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)>  EPSV\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)>  EPRT\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)> 211 End\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)> TYPE I\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)> 200 Type set to I\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)> OPTS UTF8 ON\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)> 202 UTF8 mode is always enabled. No need to send this command.\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)> EPSV\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)> 229 Entering Extended Passive Mode (|||RANDOM_PORT_NUMBER|)\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)> MLSD /\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)> 521 PROT P required\r\n(000070)04/04/2021 18:45:13 - username (MY_IP)> disconnected.\r\n```\r\n\r\nWhile using rclone v1.54.1, I get this other log on my FileZilla Server:\r\n```\r\n(000071)04/04/2021 18:45:48 - (not logged in) (MY_IP)> Connected on port MY_PORT, sending welcome message...\r\n(000071)04/04/2021 18:45:48 - (not logged in) (MY_IP)> 220 Welcome message\r\n(000071)04/04/2021 18:45:48 - (not logged in) (MY_IP)> TLS connection established\r\n(000071)04/04/2021 18:45:48 - (not logged in) (MY_IP)> USER username\r\n(000071)04/04/2021 18:45:48 - (not logged in) (MY_IP)> 331 Password required for username\r\n(000071)04/04/2021 18:45:48 - (not logged in) (MY_IP)> PASS ******\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> 230 Logged on\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> FEAT\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> 211-Features:\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)>  MDTM\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)>  REST STREAM\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)>  SIZE\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)>  MLST type*;size*;modify*;\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)>  MLSD\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)>  AUTH SSL\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)>  AUTH TLS\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)>  PROT\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)>  PBSZ\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)>  UTF8\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)>  CLNT\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)>  MFMT\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)>  EPSV\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)>  EPRT\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> 211 End\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> TYPE I\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> 200 Type set to I\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> OPTS UTF8 ON\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> 202 UTF8 mode is always enabled. No need to send this command.\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> PBSZ 0\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> 200 PBSZ=0\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> PROT P\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> 200 Protection level set to P\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> EPSV\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> 229 Entering Extended Passive Mode (|||RANDOM_PORT_NUMBER|)\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> MLSD /\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> 150 Opening data channel for directory listing of \"/\"\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> TLS connection for data connection established\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> 226 Successfully transferred \"/\"\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> EPSV\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> 229 Entering Extended Passive Mode (|||RANDOM_PORT_NUMBER|)\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> MLSD /test_dir1\r\n(000071)04/04/2021 18:45:48 - username (MY_IP)> 150 Opening data channel for directory listing of \"/test_dir1\"\r\n```\r\n\r\nThe only difference I can spot on both FileZilla logs is that, rclone v1.54.1 sends:\r\n \r\n```\r\n...\r\nOPTS UTF8 ON\r\nPBSZ 0\r\nPROT P\r\nEPSV\r\nMLSD /\r\n```\r\n\r\nWhile rclone v1.55.0 only sends the following commands\r\n\r\n```\r\n...\r\nOPTS UTF8 ON\r\nEPSV\r\nMLSD /\r\n```\r\n\r\nAnd those missing `PBSZ 0` and `PROT P` seem to break the session negotiation.\r\n\r\nHow can I help to debug this issue?\r\n\r\nThanks.\r\n\r\n","closed_by":{"login":"ivandeex","id":9028053,"node_id":"MDQ6VXNlcjkwMjgwNTM=","avatar_url":"https://avatars.githubusercontent.com/u/9028053?v=4","gravatar_id":"","url":"https://api.github.com/users/ivandeex","html_url":"https://github.com/ivandeex","followers_url":"https://api.github.com/users/ivandeex/followers","following_url":"https://api.github.com/users/ivandeex/following{/other_user}","gists_url":"https://api.github.com/users/ivandeex/gists{/gist_id}","starred_url":"https://api.github.com/users/ivandeex/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivandeex/subscriptions","organizations_url":"https://api.github.com/users/ivandeex/orgs","repos_url":"https://api.github.com/users/ivandeex/repos","events_url":"https://api.github.com/users/ivandeex/events{/privacy}","received_events_url":"https://api.github.com/users/ivandeex/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/5210/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/5210/timeline","performed_via_github_app":null,"state_reason":"completed"}