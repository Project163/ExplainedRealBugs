{"url":"https://api.github.com/repos/rclone/rclone/issues/1733","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/1733/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/1733/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/1733/events","html_url":"https://github.com/rclone/rclone/issues/1733","id":264123700,"node_id":"MDU6SXNzdWUyNjQxMjM3MDA=","number":1733,"title":"Backblaze B2 large file copy fault tolerance","user":{"login":"eodrap","id":31686420,"node_id":"MDQ6VXNlcjMxNjg2NDIw","avatar_url":"https://avatars.githubusercontent.com/u/31686420?v=4","gravatar_id":"","url":"https://api.github.com/users/eodrap","html_url":"https://github.com/eodrap","followers_url":"https://api.github.com/users/eodrap/followers","following_url":"https://api.github.com/users/eodrap/following{/other_user}","gists_url":"https://api.github.com/users/eodrap/gists{/gist_id}","starred_url":"https://api.github.com/users/eodrap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eodrap/subscriptions","organizations_url":"https://api.github.com/users/eodrap/orgs","repos_url":"https://api.github.com/users/eodrap/repos","events_url":"https://api.github.com/users/eodrap/events{/privacy}","received_events_url":"https://api.github.com/users/eodrap/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":306063207,"node_id":"MDU6TGFiZWwzMDYwNjMyMDc=","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20Backblaze%20B2","name":"Remote: Backblaze B2","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/26","html_url":"https://github.com/rclone/rclone/milestone/26","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/26/labels","id":2656431,"node_id":"MDk6TWlsZXN0b25lMjY1NjQzMQ==","number":26,"title":"v1.39","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":35,"state":"closed","created_at":"2017-07-23T14:09:07Z","updated_at":"2018-01-11T14:25:36Z","due_on":"2017-12-22T08:00:00Z","closed_at":"2018-01-11T14:25:36Z"},"comments":15,"created_at":"2017-10-10T07:24:12Z","updated_at":"2017-12-15T13:37:11Z","closed_at":"2017-12-15T11:11:20Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"> What is your rclone version (eg output from `rclone -V`)\r\n\r\nrclone v1.38\r\n\r\n> Which OS you are using and how many bits (eg Windows 7, 64 bit)\r\n\r\nmacOS 10.12.6 64-bit\r\n\r\n> Which cloud storage system are you using? (eg Google Drive)\r\n\r\nBackblaze B2 with crypt\r\n\r\n> The command you were trying to run (eg `rclone copy /tmp remote:tmp`)\r\n\r\nrclone: Version \"v1.38\" starting with parameters [\"rclone\" \"--fast-list\" \"--verbose\" \"--verbose\" \"--buffer-size=256M\" \"--checkers=64\" \"--transfers=32\" \"--b2-chunk-size=256M\" \"--b2-upload-cutoff=256M\" \"--low-level-retries=1000\" \"--retries=500\" \"copy\" \"xxx.tar.gz\" \"crypt_backblaze:xxx/\"]\r\n\r\n> A log from the command with the `-vv` flag (eg output from `rclone -vv copy /tmp remote:tmp`)\r\n\r\nLarge file copies (~180GB) to Backblaze B2 are failing on individual chunks, with a mix of the following errors -\r\n\r\n-  HTTP/1.x transport connection broken: http: ContentLength=268435496 with Body length 86749635\r\n- HTTP/1.x transport connection broken: write tcp x.x.x.x:56063->206.190.208.233:443: write: broken pipe\r\n- Post https://pod-000-1093-18.backblaze.com/xxx: read tcp x.x.x.x:56064->206.190.208.249:443: read: operation timed out\r\n- pacer: low level retry 1/1000 (error Authorization token has expired (401 expired_auth_token))\r\n-- **Similar to #1660**\r\n\r\nMy internet connection isn't dropping but I suspect my WLAN connection is. I've restarted the transfer using a wired connection but it's going over the same Powerline switches as the wireless APs so I expect issues to continue.\r\n\r\nWould it be possible for rclone / Backblaze to be fault tolerant when individual chunks fail? The behaviour at the moment seems to be that a single chunk fails due to a temporary connection drop and this causes the entire transfer to be restarted. I've set high --retries and --low-level-retries values, these work but still require the full transfer operation to be restarted. I was able to upload with v1.37 after multiple attempts, I've not tested in the earlier version but I've made 4x upload attempts all failing in similar ways (issue with a single chunk brings the whole operation down). rclone sync operations with are fault tolerant by virtue of transferring many small files, this is specific to large file transfer and many chunks.\r\n\r\nApologies if this request is asking for the impossible, I appreciate that the behaviour may be down to the Backblaze API. Thanks again for the brilliant work with rclone.\r\n\r\nHere is some debugging output from rclone -\r\n\r\n```\r\n2017/10/07 18:22:45 DEBUG : xxx: Done sending chunk 37\r\n2017/10/07 18:22:45 DEBUG : xxx: Cancelling large file upload due to error: Post https://pod-000-1092-03.backblaze.com/xxx: net/http: HTTP/1.x transport connection broken: http: ContentLength=268435496 with Body length 86749635\r\n2017/10/07 18:22:52 ERROR : xxx.tar.gz: Failed to copy: Post https://pod-000-1092-03.backblaze.com/xxx: net/http: HTTP/1.x transport connection broken: http: ContentLength=268435496 with Body length 86749635\r\n2017/10/07 18:22:52 ERROR : Attempt 1/3 failed with 1 errors and: Post https://pod-000-1092-03.backblaze.com/xxx: net/http: HTTP/1.x transport connection broken: http: ContentLength=268435496 with Body length 86749635\r\n\r\n2017/10/07 18:22:45 DEBUG : xxx: Done sending chunk 37\r\n2017/10/07 18:22:45 DEBUG : xxx: Cancelling large file upload due to error: Post https://pod-000-1092-03.backblaze.com/xxx: net/http: HTTP/1.x transport connection broken: http: ContentLength=268435496 with Body length 86749635\r\n2017/10/07 18:22:52 ERROR : xxx.tar.gz: Failed to copy: Post https://pod-000-1092-03.backblaze.com/xxx: net/http: HTTP/1.x transport connection broken: http: ContentLength=268435496 with Body length 86749635\r\n2017/10/07 18:22:52 ERROR : Attempt 1/3 failed with 1 errors and: Post https://pod-000-1092-03.backblaze.com/xxx: net/http: HTTP/1.x transport connection broken: http: ContentLength=268435496 with Body length 86749635\r\n\r\n2017/10/09 21:39:23 DEBUG : xxx: Done sending chunk 121\r\n2017/10/09 21:39:23 DEBUG : xxx: Cancelling large file upload due to error: Post https://pod-000-1093-09.backblaze.com/xxx: http: ContentLength=268435496 with Body length 0\r\n2017/10/09 21:39:29 ERROR : xxx.tar.gz: Failed to copy: Post https://pod-000-1093-09.backblaze.com/xxx: http: ContentLength=268435496 with Body length 0\r\n2017/10/09 21:39:29 ERROR : Attempt 3/500 failed with 1 errors and: Post https://pod-000-1093-09.backblaze.com/xxx: http: ContentLength=268435496 with Body length 0\r\n\r\n2017/10/09 21:39:23 DEBUG : xxx: Done sending chunk 121\r\n2017/10/09 21:39:23 DEBUG : xxx: Cancelling large file upload due to error: Post https://pod-000-1093-09.backblaze.com/xxx: http: ContentLength=268435496 with Body length 0\r\n2017/10/09 21:39:29 ERROR : xxx.tar.gz: Failed to copy: Post https://pod-000-1093-09.backblaze.com/xxx: http: ContentLength=268435496 with Body length 0\r\n2017/10/09 21:39:29 ERROR : Attempt 3/500 failed with 1 errors and: Post https://pod-000-1093-09.backblaze.com/xxx: http: ContentLength=268435496 with Body length 0\r\n\r\n2017/10/10 06:04:29 DEBUG : xxx: Done sending chunk 16\r\n2017/10/10 06:04:29 DEBUG : xxx: Sending chunk 59 length 268435456\r\n2017/10/10 06:04:29 DEBUG : xxx: Didn't find object to account part transfer\r\n2017/10/10 06:05:06 DEBUG : xxx: Error sending chunk 15: Post https://pod-000-1093-02.backblaze.com/xxx: net/http: HTTP/1.x transport connection broken: write tcp x.x.x.x:56063->206.190.208.233:443: write: broken pipe\r\n2017/10/10 06:05:06 DEBUG : xxx: Sending chunk 60 length 268435456\r\n2017/10/10 06:05:06 DEBUG : xxx: Didn't find object to account part transfer\r\n2017/10/10 06:05:10 INFO  : \r\nTransferred:   139.966 GBytes (1.649 MBytes/s)\r\nErrors:                 0\r\nChecks:                 0\r\nTransferred:            0\r\nElapsed time:   24h9m2.5s\r\nTransferring:\r\n *                           xxx.tar.gz:  8% done, 14.694 MBytes/s, ETA: 3h3m13s\r\n\r\n2017/10/10 06:05:15 DEBUG : xxx: Clearing part upload URL because of error: Post https://pod-000-1093-18.backblaze.com/xxx: read tcp x.x.x.x:56064->206.190.208.249:443: read: operation timed out\r\n2017/10/10 06:05:15 DEBUG : pacer: Rate limited, increasing sleep to 20ms\r\n2017/10/10 06:05:15 DEBUG : pacer: low level retry 1/1000 (error Post https://pod-000-1093-18.backblaze.com/xxx: read tcp x.x.x.x:56064->206.190.208.249:443: read: operation timed out)\r\n2017/10/10 06:05:15 DEBUG : xxx: Sending chunk 59 length 268435456\r\n2017/10/10 06:05:16 DEBUG : B2 bucket xxx path xxx/: Unauthorized: Authorization token has expired (401 expired_auth_token)\r\n2017/10/10 06:05:17 DEBUG : xxx: Clearing part upload URL because of error: Post https://pod-000-1093-15.backblaze.com/xxx: read tcp x.x.x.x:56051->206.190.208.246:443: read: operation timed out\r\n2017/10/10 06:05:17 DEBUG : pacer: Rate limited, increasing sleep to 40ms\r\n2017/10/10 06:05:17 DEBUG : pacer: low level retry 1/1000 (error Post https://pod-000-1093-15.backblaze.com/xxx: read tcp x.x.x.x:56051->206.190.208.246:443: read: operation timed out)\r\n2017/10/10 06:05:17 DEBUG : xxx: Sending chunk 39 length 268435456\r\n2017/10/10 06:05:17 DEBUG : pacer: Reducing sleep to 20ms\r\n2017/10/10 06:05:17 DEBUG : pacer: Rate limited, increasing sleep to 40ms\r\n2017/10/10 06:05:17 DEBUG : pacer: low level retry 1/1000 (error Authorization token has expired (401 expired_auth_token))\r\n2017/10/10 06:05:17 DEBUG : pacer: Reducing sleep to 20ms\r\n2017/10/10 06:05:17 DEBUG : xxx: Didn't find object to account part transfer\r\n2017/10/10 06:05:17 DEBUG : pacer: Reducing sleep to 10ms\r\n2017/10/10 06:05:17 DEBUG : xxx: Didn't find object to account part transfer\r\n2017/10/10 06:05:41 DEBUG : xxx: Error sending chunk 40: Post https://pod-000-1093-01.backblaze.com/xxx: read tcp x.x.x.x:56053->206.190.208.232:443: read: network is down\r\n2017/10/10 06:05:44 DEBUG : xxx: Error sending chunk 55: Post https://pod-000-1093-13.backblaze.com/xxx: read tcp x.x.x.x:56069->206.190.208.244:443: read: network is down\r\n```","closed_by":{"login":"eodrap","id":31686420,"node_id":"MDQ6VXNlcjMxNjg2NDIw","avatar_url":"https://avatars.githubusercontent.com/u/31686420?v=4","gravatar_id":"","url":"https://api.github.com/users/eodrap","html_url":"https://github.com/eodrap","followers_url":"https://api.github.com/users/eodrap/followers","following_url":"https://api.github.com/users/eodrap/following{/other_user}","gists_url":"https://api.github.com/users/eodrap/gists{/gist_id}","starred_url":"https://api.github.com/users/eodrap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eodrap/subscriptions","organizations_url":"https://api.github.com/users/eodrap/orgs","repos_url":"https://api.github.com/users/eodrap/repos","events_url":"https://api.github.com/users/eodrap/events{/privacy}","received_events_url":"https://api.github.com/users/eodrap/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/1733/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/1733/timeline","performed_via_github_app":null,"state_reason":"completed"}