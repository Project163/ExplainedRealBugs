[{"id":10297038933,"node_id":"LE_lADOAQ-n5M5wTmRNzwAAAAJlwFhV","url":"https://api.github.com/repos/rclone/rclone/issues/events/10297038933","actor":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-09-06T14:49:37Z","label":{"name":"enhancement","color":"84b6eb"},"performed_via_github_app":null},{"id":10297038947,"node_id":"LE_lADOAQ-n5M5wTmRNzwAAAAJlwFhj","url":"https://api.github.com/repos/rclone/rclone/issues/events/10297038947","actor":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-09-06T14:49:37Z","label":{"name":"IMPORTANT","color":"d93f0b"},"performed_via_github_app":null},{"id":10297038958,"node_id":"LE_lADOAQ-n5M5wTmRNzwAAAAJlwFhu","url":"https://api.github.com/repos/rclone/rclone/issues/events/10297038958","actor":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-09-06T14:49:37Z","label":{"name":"UX","color":"bfd4f2"},"performed_via_github_app":null},{"id":10297038972,"node_id":"LE_lADOAQ-n5M5wTmRNzwAAAAJlwFh8","url":"https://api.github.com/repos/rclone/rclone/issues/events/10297038972","actor":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-09-06T14:49:37Z","label":{"name":"new feature","color":"bfdadc"},"performed_via_github_app":null},{"id":10297038984,"node_id":"LE_lADOAQ-n5M5wTmRNzwAAAAJlwFiI","url":"https://api.github.com/repos/rclone/rclone/issues/events/10297038984","actor":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-09-06T14:49:37Z","label":{"name":"bisync","color":"1D76DB"},"performed_via_github_app":null},{"id":10297038996,"node_id":"LE_lADOAQ-n5M5wTmRNzwAAAAJlwFiU","url":"https://api.github.com/repos/rclone/rclone/issues/events/10297038996","actor":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-09-06T14:49:37Z","label":{"name":"stats","color":"8DD270"},"performed_via_github_app":null},{"id":10297039136,"node_id":"MEE_lADOAQ-n5M5wTmRNzwAAAAJlwFkg","url":"https://api.github.com/repos/rclone/rclone/issues/events/10297039136","actor":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-09-06T14:49:37Z","performed_via_github_app":null},{"id":10297039160,"node_id":"SE_lADOAQ-n5M5wTmRNzwAAAAJlwFk4","url":"https://api.github.com/repos/rclone/rclone/issues/events/10297039160","actor":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-09-06T14:49:38Z","performed_via_github_app":null},{"id":10297039180,"node_id":"MEE_lADOAQ-n5M5wTmRNzwAAAAJlwFlM","url":"https://api.github.com/repos/rclone/rclone/issues/events/10297039180","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-09-06T14:49:38Z","performed_via_github_app":null},{"id":10297039201,"node_id":"SE_lADOAQ-n5M5wTmRNzwAAAAJlwFlh","url":"https://api.github.com/repos/rclone/rclone/issues/events/10297039201","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-09-06T14:49:38Z","performed_via_github_app":null},{"actor":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-06T14:50:56Z","updated_at":"2023-09-06T14:50:56Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rclone/rclone/issues/6797","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/6797/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/6797/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/6797/events","html_url":"https://github.com/rclone/rclone/issues/6797","id":1604772184,"node_id":"I_kwDOAQ-n5M5fpuFY","number":6797,"title":"accounting: merge checkers and transfers","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399007,"node_id":"MDU6TGFiZWw4NjM5OTAwNw==","url":"https://api.github.com/repos/rclone/rclone/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null},{"id":252555516,"node_id":"MDU6TGFiZWwyNTI1NTU1MTY=","url":"https://api.github.com/repos/rclone/rclone/labels/maintenance","name":"maintenance","color":"5319e7","default":false,"description":null}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/11","html_url":"https://github.com/rclone/rclone/milestone/11","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/11/labels","id":1480382,"node_id":"MDk6TWlsZXN0b25lMTQ4MDM4Mg==","number":11,"title":"Soon","description":"Issues which are a good idea but haven't been assigned a specific release yet.","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":75,"closed_issues":94,"state":"open","created_at":"2016-01-02T12:56:46Z","updated_at":"2025-10-12T21:14:16Z","due_on":null,"closed_at":null},"comments":6,"created_at":"2023-03-01T11:17:08Z","updated_at":"2024-08-16T05:16:49Z","closed_at":null,"author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":17803236,"node_id":"MDEwOlJlcG9zaXRvcnkxNzgwMzIzNg==","name":"rclone","full_name":"rclone/rclone","private":false,"owner":{"login":"rclone","id":24937341,"node_id":"MDEyOk9yZ2FuaXphdGlvbjI0OTM3MzQx","avatar_url":"https://avatars.githubusercontent.com/u/24937341?v=4","gravatar_id":"","url":"https://api.github.com/users/rclone","html_url":"https://github.com/rclone","followers_url":"https://api.github.com/users/rclone/followers","following_url":"https://api.github.com/users/rclone/following{/other_user}","gists_url":"https://api.github.com/users/rclone/gists{/gist_id}","starred_url":"https://api.github.com/users/rclone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rclone/subscriptions","organizations_url":"https://api.github.com/users/rclone/orgs","repos_url":"https://api.github.com/users/rclone/repos","events_url":"https://api.github.com/users/rclone/events{/privacy}","received_events_url":"https://api.github.com/users/rclone/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rclone/rclone","description":"\"rsync for cloud storage\" - Google Drive, S3, Dropbox, Backblaze B2, One Drive, Swift, Hubic, Wasabi, Google Cloud Storage, Azure Blob, Azure Files, Yandex Files","fork":false,"url":"https://api.github.com/repos/rclone/rclone","forks_url":"https://api.github.com/repos/rclone/rclone/forks","keys_url":"https://api.github.com/repos/rclone/rclone/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rclone/rclone/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rclone/rclone/teams","hooks_url":"https://api.github.com/repos/rclone/rclone/hooks","issue_events_url":"https://api.github.com/repos/rclone/rclone/issues/events{/number}","events_url":"https://api.github.com/repos/rclone/rclone/events","assignees_url":"https://api.github.com/repos/rclone/rclone/assignees{/user}","branches_url":"https://api.github.com/repos/rclone/rclone/branches{/branch}","tags_url":"https://api.github.com/repos/rclone/rclone/tags","blobs_url":"https://api.github.com/repos/rclone/rclone/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rclone/rclone/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rclone/rclone/git/refs{/sha}","trees_url":"https://api.github.com/repos/rclone/rclone/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rclone/rclone/statuses/{sha}","languages_url":"https://api.github.com/repos/rclone/rclone/languages","stargazers_url":"https://api.github.com/repos/rclone/rclone/stargazers","contributors_url":"https://api.github.com/repos/rclone/rclone/contributors","subscribers_url":"https://api.github.com/repos/rclone/rclone/subscribers","subscription_url":"https://api.github.com/repos/rclone/rclone/subscription","commits_url":"https://api.github.com/repos/rclone/rclone/commits{/sha}","git_commits_url":"https://api.github.com/repos/rclone/rclone/git/commits{/sha}","comments_url":"https://api.github.com/repos/rclone/rclone/comments{/number}","issue_comment_url":"https://api.github.com/repos/rclone/rclone/issues/comments{/number}","contents_url":"https://api.github.com/repos/rclone/rclone/contents/{+path}","compare_url":"https://api.github.com/repos/rclone/rclone/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rclone/rclone/merges","archive_url":"https://api.github.com/repos/rclone/rclone/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rclone/rclone/downloads","issues_url":"https://api.github.com/repos/rclone/rclone/issues{/number}","pulls_url":"https://api.github.com/repos/rclone/rclone/pulls{/number}","milestones_url":"https://api.github.com/repos/rclone/rclone/milestones{/number}","notifications_url":"https://api.github.com/repos/rclone/rclone/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rclone/rclone/labels{/name}","releases_url":"https://api.github.com/repos/rclone/rclone/releases{/id}","deployments_url":"https://api.github.com/repos/rclone/rclone/deployments","created_at":"2014-03-16T16:19:57Z","updated_at":"2025-11-09T20:38:02Z","pushed_at":"2025-11-08T21:33:38Z","git_url":"git://github.com/rclone/rclone.git","ssh_url":"git@github.com:rclone/rclone.git","clone_url":"https://github.com/rclone/rclone.git","svn_url":"https://github.com/rclone/rclone","homepage":"https://rclone.org","size":217990,"stargazers_count":53422,"watchers_count":53422,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":4767,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1169,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["azure-blob","azure-blob-storage","azure-files","backblaze-b2","cloud-storage","dropbox","encryption","ftp","fuse-filesystem","go","golang","google-cloud-storage","google-drive","onedrive","openstack-swift","rclone","s3","sftp","sync","webdav"],"visibility":"public","forks":4767,"open_issues":1169,"watchers":53422,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"In 019a486d5be719adf4fcfe54de3fb45c474730ba and 9baa4d1c3c5b592510af75495c718faadeaf9cd0 we made an effort to show what checkers and transfers are doing better.\r\n\r\nHowever, as discussed in https://forum.rclone.org/t/what-is-rclone-checking-during-a-purge/35931 this needs more work.\r\n\r\nIn order to do this work properly, the checkers and transfers need to be unified into a single datastructure. They need to be properly reference counted.\r\n\r\nIf a transfer is started, then if a checker is started on the same file then it should return the existing transfer but update the tag while the checker is running.\r\n\r\n#### How to use GitHub\r\n\r\n* Please use the ðŸ‘ [reaction](https://blog.github.com/2016-03-10-add-reactions-to-pull-requests-issues-and-comments/) to show that you are affected by the same issue.\r\n* Please don't comment if you have no relevant information to add. It's just extra noise for everyone subscribed to this issue.\r\n* Subscribe to receive notifications on status change and new comments.\r\n","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/6797/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/6797/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1712466820","html_url":"https://github.com/rclone/rclone/issues/7282#issuecomment-1712466820","issue_url":"https://api.github.com/repos/rclone/rclone/issues/7282","id":1712466820,"node_id":"IC_kwDOAQ-n5M5mEiuE","user":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-09T09:21:36Z","updated_at":"2023-09-09T09:21:36Z","body":"@ncw I started working on a proof-of-concept for this. If you have a moment, could you let me know if it's generally headed in the right direction? https://github.com/nielash/rclone/commit/50bf6a62fd823b1fde34022a6cdc0961ec8dadb7 ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1712466820/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10323906493,"node_id":"MEE_lADOAQ-n5M5wTmRNzwAAAAJnWk-9","url":"https://api.github.com/repos/rclone/rclone/issues/events/10323906493","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-09-09T09:21:37Z","performed_via_github_app":null},{"id":10323906495,"node_id":"SE_lADOAQ-n5M5wTmRNzwAAAAJnWk-_","url":"https://api.github.com/repos/rclone/rclone/issues/events/10323906495","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-09-09T09:21:37Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1712475397","html_url":"https://github.com/rclone/rclone/issues/7282#issuecomment-1712475397","issue_url":"https://api.github.com/repos/rclone/rclone/issues/7282","id":1712475397,"node_id":"IC_kwDOAQ-n5M5mEk0F","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-09T10:10:07Z","updated_at":"2023-09-09T10:10:07Z","body":"I see you have instrumented `Copy`, `Move`, `Delete` so the fundamental operations. This won't get you all of the things here\r\n\r\n```\r\n\tCombined     io.Writer // a file with file names with leading sigils\r\n\tMissingOnSrc io.Writer // files only in the destination\r\n\tMissingOnDst io.Writer // files only in the source\r\n\tMatch        io.Writer // matching files\r\n\tDiffer       io.Writer // differing files\r\n\tError        io.Writer // files with errors of some kind\r\n```\r\n\r\nI was thinking to instrument the `sync.Sync` routine where you know exactly what status each thing is. Check out how `operations.Check` is instrumented with `c.report` and `c.reportFilename`.\r\n\r\nI think there only needs to be one function with a signature like this\r\n\r\n    func(sigil rune, src fs.Object, dst fs.Object)\r\n\r\nThe sigils define exactly what is happening. These could of course be constants which might make the code easier to read.\r\n\r\n```\r\n= path means path was found in source and destination and was identical\r\n- path means path was missing on the source, so only in the destination\r\n+ path means path was missing on the destination, so only in the source\r\n* path means path was present in source and destination but different.\r\n! path means there was an error reading or hashing the source or dest\r\n```\r\n\r\nYou can then read filenames, modtimes or hashes from the objects. However you **must** only read them if you are going to need them as reading modtimes or hashes can both be expensive on some backends. If you aren't sure then just store the object until you do know.\r\n\r\nRather than changing all the function prototypes for everything, the modern go way of passing a function through lots of layers would be to add it to the context.\r\n\r\nSo you'd export a function from `fs/sync` to add a function pointer to the context, say `sync.WithLogger` and then you'd extract this logger function in sync.newSyncCopyMove and store it in the `syncCopyMove` structure if found or a no-op function if not so you can call it without checking it for `nil`. This will make the patch much smaller!\r\n\r\n```go\r\ntype LoggerFn func(sigil rune, src fs.Object, dst fs.Object)\r\ntype loggerContextKey struct{}\r\nvar loggerKey = loggerContextKey{}\r\nfunc WithLogger(ctx context.Context, logger LoggerFn) context.Context {\r\n    return context.WithValue(ctx, loggerKey, logger)\r\n}\r\n```\r\n\r\nThen in the `newSyncCopyMove` something like this (though thinking ahead this should probably be in operations in `operations.GetLogger(ctx)` as should the `WithLogger` and definitions.\r\n\r\n```go\r\n    logger, ok := ctx.Value(loggerKey).(LoggerFn)\r\n    if ok {\r\n        s.logger = logger\r\n    } else {\r\n        s.logger = func(sigil rune, src fs.Object, dst fs.Object) { }\r\n    }\r\n```\r\n\r\nThen to close the circle we can do the same thing in `operations.Check` and factor the duplicate code into `operations`.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1712475397/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1712684860","html_url":"https://github.com/rclone/rclone/issues/7282#issuecomment-1712684860","issue_url":"https://api.github.com/repos/rclone/rclone/issues/7282","id":1712684860,"node_id":"IC_kwDOAQ-n5M5mFX88","user":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-10T02:00:16Z","updated_at":"2023-09-10T02:00:16Z","body":"Thanks so much! Excellent feedback. I will take another stab at it with this in mind.\r\n\r\nI think one challenge this approach will present for Bisync is that the sigils indicate the state _before_ the transfers, not _after_. For example, `*` indicates that the file differed on src and dst, but that does not necessarily mean that sync updated the dst -- perhaps we did not attempt to due to `--ignore-existing`, or perhaps we did attempt to but there was an error. The sigils tell us \"here's how the src and dst were different before my changes\", whereas what Bisync really wants is \"here's a complete list of every change I made on the dest\". This could maybe be solved by adding an additional sigil, but I'm not exactly sure where in the code would be the cleanest place to call it from.\r\n\r\n> You can then read filenames, modtimes or hashes from the objects. However you must only read them if you are going to need them as reading modtimes or hashes can both be expensive on some backends.\r\n\r\nTotally agree, and that's why I was hoping to record them while copy is already using them, to avoid having to request them twice. For example, we already print hashes to the log here:\r\n\r\nhttps://github.com/rclone/rclone/blob/d4d530bd8e9de2a85f77a2f3a7f76ef19c28a711/fs/operations/operations.go#L538-L549\r\nBut I realize this may not be possible in some cases -- ex. renames and server-side copies.\r\n\r\nBisync does always need all modtimes, as it's currently the only way it can detect whether a file changed between bisync runs. If we do have to read modtimes/hashes a second time, what is crucial is that we do it _during_ the sync, not _after_, to minimize the possibility of the file changing again before we have a chance to read it (for instance, in an hours-long sync). (This is why I'm pretty sure the code for this will have to live in `sync` or `operations`, as opposed to `bisync`, even if it will only be called during bisync.)\r\n\r\nTotally agree about passing it through the context -- much cleaner ðŸ™‚ ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1712684860/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1712800678","html_url":"https://github.com/rclone/rclone/issues/7282#issuecomment-1712800678","issue_url":"https://api.github.com/repos/rclone/rclone/issues/7282","id":1712800678,"node_id":"IC_kwDOAQ-n5M5mF0Om","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-10T12:25:19Z","updated_at":"2023-09-10T12:25:19Z","body":"> Thanks so much! Excellent feedback. I will take another stab at it with this in mind.\r\n\r\n:-)\r\n \r\n> I think one challenge this approach will present for Bisync is that the sigils indicate the state _before_ the transfers, not _after_. For example, `*` indicates that the file differed on src and dst, but that does not necessarily mean that sync updated the dst -- perhaps we did not attempt to due to `--ignore-existing`, or perhaps we did attempt to but there was an error.\r\n\r\nThat is a good point. The set of sigils was designed for `rclone check` which doesn't alter the state. Probably all the existing sigils should have an implied meaning for `sync` that `sync` successfully corrected the situation.\r\n\r\nOr maybe the logger should take an `error` too and if it is not `nil` we assume that the operation failed?\r\n\r\nNot quite sure how to report `--ignore-existing` - I'd be tempted to report `=` as ok and didn't need copying.\r\n\r\n> The sigils tell us \"here's how the src and dst were different before my changes\", whereas what Bisync really wants is \"here's a complete list of every change I made on the dest\". This could maybe be solved by adding an additional sigil, but I'm not exactly sure where in the code would be the cleanest place to call it from.\r\n\r\nYou'll see in the sync code that there is a log or a debug at all these terminal places. There are no logs in the Copy/Move section as Copy and Move themselves make the logs. This is so that every file makes one log.\r\n\r\n> > You can then read filenames, modtimes or hashes from the objects. However you must only read them if you are going to need them as reading modtimes or hashes can both be expensive on some backends.\r\n> \r\n> Totally agree, and that's why I was hoping to record them while copy is already using them, to avoid having to request them twice.\r\n\r\nModtimes and hashes will be cached in the object so if they've been looked up once, then it is cheap to look them up again.\r\n\r\n> Bisync does always need all modtimes, as it's currently the only way it can detect whether a file changed between bisync runs. If we do have to read modtimes/hashes a second time, what is crucial is that we do it _during_ the sync, not _after_, to minimize the possibility of the file changing again before we have a chance to read it (for instance, in an hours-long sync). (This is why I'm pretty sure the code for this will have to live in `sync` or `operations`, as opposed to `bisync`, even if it will only be called during bisync.)\r\n\r\nHopefully the caching will fix that.\r\n\r\nI can see it is going to be quite tricky getting the correct logging in to sync so I expect we'll have to collaborate on that.\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1712800678/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1715365892","html_url":"https://github.com/rclone/rclone/issues/7282#issuecomment-1715365892","issue_url":"https://api.github.com/repos/rclone/rclone/issues/7282","id":1715365892,"node_id":"IC_kwDOAQ-n5M5mPmgE","user":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-12T09:37:18Z","updated_at":"2023-09-12T09:37:18Z","body":"New version based on your feedback: https://github.com/nielash/rclone/commit/60fc9c7447931c26d98ef689ab529d6f0008a766 Still very much a work-in-progress, but I think it's a lot closer to what you had in mind. I included an example of how [`rclone sync`](https://github.com/nielash/rclone/commit/60fc9c7447931c26d98ef689ab529d6f0008a766#diff-daa41a9f67e301e462fe0a99775137abd583148bc1af5c98a4add2f09cb4810aR32-R37) could use the same flags as `rclone check` and output the same file lists.\r\n\r\nI wrote a very basic [test script](https://github.com/nielash/rclone/blob/sync-writer-v2/testlogger.sh) to test whether `rclone check` and `rclone sync` output exactly the same file lists, and so far it seems that they do, in all the scenarios I tried. But more testing is needed. (Relatedly: is there a better way to do this kind of thing within the actual go testing framework? i.e. run a trusted command with CLI args from a different rclone package, as opposed to trying to recreate it with internal functions.)\r\n\r\n`--error` is not fully implemented yet. [`processError()`](https://github.com/rclone/rclone/blob/master/fs/sync/sync.go#L279) seems like the obvious place to do it, but it doesn't have the `fs.Object`s in scope, so it might need to be one layer back. \r\n\r\nThe [`Completed`](https://github.com/nielash/rclone/commit/60fc9c7447931c26d98ef689ab529d6f0008a766#diff-dea86f791790da6907974fcb46363041fd49f392a674366a5bef26a1d231c621R2557) stream is also not done -- it's the trickiest part, as we discussed. I will probably need your help with it. I'm also coming around to the idea that it may not be totally necessary, since we can infer that the dst should always end up matching the src, unless there were errors. One concern is high-level retries, if the src could be changing during the course of a long sync. Does it refresh the src object each high-level retry or is the src cached the first time only? If the former, we may want to add some logic to de-dupe the stream in favor of the newest line for each path.\r\n\r\nAlso, scratch what I said about the bisync code having to live elsewhere... after I wrote that, it occurred to me that I could pass in a custom `LoggerFn` ðŸ˜Š","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1715365892/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1715513547","html_url":"https://github.com/rclone/rclone/issues/7282#issuecomment-1715513547","issue_url":"https://api.github.com/repos/rclone/rclone/issues/7282","id":1715513547,"node_id":"IC_kwDOAQ-n5M5mQKjL","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-12T11:04:40Z","updated_at":"2023-09-12T11:04:40Z","body":"> New version based on your feedback: [nielash@60fc9c7](https://github.com/nielash/rclone/commit/60fc9c7447931c26d98ef689ab529d6f0008a766) Still very much a work-in-progress, but I think it's a lot closer to what you had in mind. I included an example of how [`rclone sync`](https://github.com/nielash/rclone/commit/60fc9c7447931c26d98ef689ab529d6f0008a766#diff-daa41a9f67e301e462fe0a99775137abd583148bc1af5c98a4add2f09cb4810aR32-R37) could use the same flags as `rclone check` and output the same file lists.\r\n\r\nYes that is looking very neat now - I like it! I put a few more comments on it.\r\n\r\n> I wrote a very basic [test script](https://github.com/nielash/rclone/blob/sync-writer-v2/testlogger.sh) to test whether `rclone check` and `rclone sync` output exactly the same file lists, and so far it seems that they do, in all the scenarios I tried. But more testing is needed.\r\n\r\nVery nice.\r\n\r\n> (Relatedly: is there a better way to do this kind of thing within the actual go testing framework? i.e. run a trusted command with CLI args from a different rclone package, as opposed to trying to recreate it with internal functions.)\r\n\r\nYes there is the https://pkg.go.dev/github.com/rogpeppe/go-internal@v1.11.0/testscript package which is for exactly this purpose. \r\n\r\nThough I'm not sure how you make sure you've built an rclone binary first. I guess it could be a separate step in the CI build process.\r\n\r\nYour test script could fairly easily be wrapped up into a separate script, though it might be better to add a logger to the operations and sync tests and check the outputs there were as expected - that would then give you more chance to track down the problems as the individual features get exercised.\r\n\r\n> `--error` is not fully implemented yet. [`processError()`](https://github.com/rclone/rclone/blob/master/fs/sync/sync.go#L279) seems like the obvious place to do it, but it doesn't have the `fs.Object`s in scope, so it might need to be one layer back.\r\n\r\nI think `processError` is probably too low level as lots of things can hit that (eg directory reading error).\r\n\r\n> The [`Completed`](https://github.com/nielash/rclone/commit/60fc9c7447931c26d98ef689ab529d6f0008a766#diff-dea86f791790da6907974fcb46363041fd49f392a674366a5bef26a1d231c621R2557) stream is also not done -- it's the trickiest part, as we discussed. I will probably need your help with it.\r\n\r\nI think completed probably has to be logged in the sync routine.\r\n\r\n> I'm also coming around to the idea that it may not be totally necessary, since we can infer that the dst should always end up matching the src, unless there were errors.\r\n\r\nYes that should be true!\r\n\r\n> One concern is high-level retries, if the src could be changing during the course of a long sync. Does it refresh the src object each high-level retry\r\n\r\nYes it does\r\n\r\n> or is the src cached the first time only? If the former, we may want to add some logic to de-dupe the stream in favor of the newest line for each path.\r\n\r\nHigh level retries throw a bit of a spanner in the works here... If we were just logging to files what would you expect to see?\r\n\r\nHere are some ideas\r\n\r\n- Just log the first run through\r\n- Just log the last run through (rewind the stream maybe, though not going to work on stdout)\r\n- Log a `#` sigil meaning start of next try (would need to be written to all logs)\r\n- Attempt to deduplicate the logs\r\n- Force `--retries 1` (this will be how bisync calls the code anyway as internal calls don't have retries).\r\n\r\nDeduplicating the logs (so trying to make them appear as if there was only one run) sounds attractive but I think will be very hard and might use up lots of memory.\r\n\r\n> Also, scratch what I said about the bisync code having to live elsewhere... after I wrote that, it occurred to me that I could pass in a custom `LoggerFn` ðŸ˜Š\r\n\r\n:-)","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1715513547/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1721608370","html_url":"https://github.com/rclone/rclone/issues/7282#issuecomment-1721608370","issue_url":"https://api.github.com/repos/rclone/rclone/issues/7282","id":1721608370,"node_id":"IC_kwDOAQ-n5M5mnaiy","user":{"login":"DarrenPIngram","id":7067136,"node_id":"MDQ6VXNlcjcwNjcxMzY=","avatar_url":"https://avatars.githubusercontent.com/u/7067136?v=4","gravatar_id":"","url":"https://api.github.com/users/DarrenPIngram","html_url":"https://github.com/DarrenPIngram","followers_url":"https://api.github.com/users/DarrenPIngram/followers","following_url":"https://api.github.com/users/DarrenPIngram/following{/other_user}","gists_url":"https://api.github.com/users/DarrenPIngram/gists{/gist_id}","starred_url":"https://api.github.com/users/DarrenPIngram/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DarrenPIngram/subscriptions","organizations_url":"https://api.github.com/users/DarrenPIngram/orgs","repos_url":"https://api.github.com/users/DarrenPIngram/repos","events_url":"https://api.github.com/users/DarrenPIngram/events{/privacy}","received_events_url":"https://api.github.com/users/DarrenPIngram/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-15T17:21:07Z","updated_at":"2023-09-15T17:21:07Z","body":"I cannot add much to the programming side, but I am excited about this feature plan [even though I probably must script some hack to achieve similar over the weekend]. I would just like to highlight, if possible, it would be desirable for any output to be configured and parseable, so one could, for example, act on the transferred data file list with other scripting,\r\n\r\ne.g. /path/to/dog1.txt\r\n/path/to/dogstories/dog2.txt\r\n\r\nSo you could add this to a list, a report, or other action of your choosing [outside of rclone]. \r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1721608370/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"DarrenPIngram","id":7067136,"node_id":"MDQ6VXNlcjcwNjcxMzY=","avatar_url":"https://avatars.githubusercontent.com/u/7067136?v=4","gravatar_id":"","url":"https://api.github.com/users/DarrenPIngram","html_url":"https://github.com/DarrenPIngram","followers_url":"https://api.github.com/users/DarrenPIngram/followers","following_url":"https://api.github.com/users/DarrenPIngram/following{/other_user}","gists_url":"https://api.github.com/users/DarrenPIngram/gists{/gist_id}","starred_url":"https://api.github.com/users/DarrenPIngram/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DarrenPIngram/subscriptions","organizations_url":"https://api.github.com/users/DarrenPIngram/orgs","repos_url":"https://api.github.com/users/DarrenPIngram/repos","events_url":"https://api.github.com/users/DarrenPIngram/events{/privacy}","received_events_url":"https://api.github.com/users/DarrenPIngram/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1721622542","html_url":"https://github.com/rclone/rclone/issues/7282#issuecomment-1721622542","issue_url":"https://api.github.com/repos/rclone/rclone/issues/7282","id":1721622542,"node_id":"IC_kwDOAQ-n5M5mneAO","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-15T17:34:08Z","updated_at":"2023-09-15T17:34:08Z","body":"@DarrenPIngram the plan is to make the output match that of [rclone check](https://rclone.org/commands/rclone_check/) which is very easy to parse.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1721622542/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10385937275,"node_id":"MEE_lADOAQ-n5M5wTmRNzwAAAAJrDNN7","url":"https://api.github.com/repos/rclone/rclone/issues/events/10385937275","actor":{"login":"DarrenPIngram","id":7067136,"node_id":"MDQ6VXNlcjcwNjcxMzY=","avatar_url":"https://avatars.githubusercontent.com/u/7067136?v=4","gravatar_id":"","url":"https://api.github.com/users/DarrenPIngram","html_url":"https://github.com/DarrenPIngram","followers_url":"https://api.github.com/users/DarrenPIngram/followers","following_url":"https://api.github.com/users/DarrenPIngram/following{/other_user}","gists_url":"https://api.github.com/users/DarrenPIngram/gists{/gist_id}","starred_url":"https://api.github.com/users/DarrenPIngram/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DarrenPIngram/subscriptions","organizations_url":"https://api.github.com/users/DarrenPIngram/orgs","repos_url":"https://api.github.com/users/DarrenPIngram/repos","events_url":"https://api.github.com/users/DarrenPIngram/events{/privacy}","received_events_url":"https://api.github.com/users/DarrenPIngram/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-09-15T17:34:08Z","performed_via_github_app":null},{"id":10385937283,"node_id":"SE_lADOAQ-n5M5wTmRNzwAAAAJrDNOD","url":"https://api.github.com/repos/rclone/rclone/issues/events/10385937283","actor":{"login":"DarrenPIngram","id":7067136,"node_id":"MDQ6VXNlcjcwNjcxMzY=","avatar_url":"https://avatars.githubusercontent.com/u/7067136?v=4","gravatar_id":"","url":"https://api.github.com/users/DarrenPIngram","html_url":"https://github.com/DarrenPIngram","followers_url":"https://api.github.com/users/DarrenPIngram/followers","following_url":"https://api.github.com/users/DarrenPIngram/following{/other_user}","gists_url":"https://api.github.com/users/DarrenPIngram/gists{/gist_id}","starred_url":"https://api.github.com/users/DarrenPIngram/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DarrenPIngram/subscriptions","organizations_url":"https://api.github.com/users/DarrenPIngram/orgs","repos_url":"https://api.github.com/users/DarrenPIngram/repos","events_url":"https://api.github.com/users/DarrenPIngram/events{/privacy}","received_events_url":"https://api.github.com/users/DarrenPIngram/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-09-15T17:34:08Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1721634813","html_url":"https://github.com/rclone/rclone/issues/7282#issuecomment-1721634813","issue_url":"https://api.github.com/repos/rclone/rclone/issues/7282","id":1721634813,"node_id":"IC_kwDOAQ-n5M5mng_9","user":{"login":"DarrenPIngram","id":7067136,"node_id":"MDQ6VXNlcjcwNjcxMzY=","avatar_url":"https://avatars.githubusercontent.com/u/7067136?v=4","gravatar_id":"","url":"https://api.github.com/users/DarrenPIngram","html_url":"https://github.com/DarrenPIngram","followers_url":"https://api.github.com/users/DarrenPIngram/followers","following_url":"https://api.github.com/users/DarrenPIngram/following{/other_user}","gists_url":"https://api.github.com/users/DarrenPIngram/gists{/gist_id}","starred_url":"https://api.github.com/users/DarrenPIngram/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DarrenPIngram/subscriptions","organizations_url":"https://api.github.com/users/DarrenPIngram/orgs","repos_url":"https://api.github.com/users/DarrenPIngram/repos","events_url":"https://api.github.com/users/DarrenPIngram/events{/privacy}","received_events_url":"https://api.github.com/users/DarrenPIngram/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-15T17:45:40Z","updated_at":"2023-09-15T17:45:40Z","body":"> @DarrenPIngram [1] the plan is to make the output match that of rclone\n> check [2] which is very easy to parse.\n\nThat would be perfect. I wish \"good programming speed\" to the relevant \ncontributors!\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1721634813/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"DarrenPIngram","id":7067136,"node_id":"MDQ6VXNlcjcwNjcxMzY=","avatar_url":"https://avatars.githubusercontent.com/u/7067136?v=4","gravatar_id":"","url":"https://api.github.com/users/DarrenPIngram","html_url":"https://github.com/DarrenPIngram","followers_url":"https://api.github.com/users/DarrenPIngram/followers","following_url":"https://api.github.com/users/DarrenPIngram/following{/other_user}","gists_url":"https://api.github.com/users/DarrenPIngram/gists{/gist_id}","starred_url":"https://api.github.com/users/DarrenPIngram/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DarrenPIngram/subscriptions","organizations_url":"https://api.github.com/users/DarrenPIngram/orgs","repos_url":"https://api.github.com/users/DarrenPIngram/repos","events_url":"https://api.github.com/users/DarrenPIngram/events{/privacy}","received_events_url":"https://api.github.com/users/DarrenPIngram/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10386020111,"node_id":"MEE_lADOAQ-n5M5wTmRNzwAAAAJrDhcP","url":"https://api.github.com/repos/rclone/rclone/issues/events/10386020111","actor":{"login":"DarrenPIngram","id":7067136,"node_id":"MDQ6VXNlcjcwNjcxMzY=","avatar_url":"https://avatars.githubusercontent.com/u/7067136?v=4","gravatar_id":"","url":"https://api.github.com/users/DarrenPIngram","html_url":"https://github.com/DarrenPIngram","followers_url":"https://api.github.com/users/DarrenPIngram/followers","following_url":"https://api.github.com/users/DarrenPIngram/following{/other_user}","gists_url":"https://api.github.com/users/DarrenPIngram/gists{/gist_id}","starred_url":"https://api.github.com/users/DarrenPIngram/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DarrenPIngram/subscriptions","organizations_url":"https://api.github.com/users/DarrenPIngram/orgs","repos_url":"https://api.github.com/users/DarrenPIngram/repos","events_url":"https://api.github.com/users/DarrenPIngram/events{/privacy}","received_events_url":"https://api.github.com/users/DarrenPIngram/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-09-15T17:45:41Z","performed_via_github_app":null},{"id":10386020122,"node_id":"SE_lADOAQ-n5M5wTmRNzwAAAAJrDhca","url":"https://api.github.com/repos/rclone/rclone/issues/events/10386020122","actor":{"login":"DarrenPIngram","id":7067136,"node_id":"MDQ6VXNlcjcwNjcxMzY=","avatar_url":"https://avatars.githubusercontent.com/u/7067136?v=4","gravatar_id":"","url":"https://api.github.com/users/DarrenPIngram","html_url":"https://github.com/DarrenPIngram","followers_url":"https://api.github.com/users/DarrenPIngram/followers","following_url":"https://api.github.com/users/DarrenPIngram/following{/other_user}","gists_url":"https://api.github.com/users/DarrenPIngram/gists{/gist_id}","starred_url":"https://api.github.com/users/DarrenPIngram/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DarrenPIngram/subscriptions","organizations_url":"https://api.github.com/users/DarrenPIngram/orgs","repos_url":"https://api.github.com/users/DarrenPIngram/repos","events_url":"https://api.github.com/users/DarrenPIngram/events{/privacy}","received_events_url":"https://api.github.com/users/DarrenPIngram/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-09-15T17:45:41Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1721762430","html_url":"https://github.com/rclone/rclone/issues/7282#issuecomment-1721762430","issue_url":"https://api.github.com/repos/rclone/rclone/issues/7282","id":1721762430,"node_id":"IC_kwDOAQ-n5M5moAJ-","user":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-15T19:48:37Z","updated_at":"2023-09-15T19:48:37Z","body":"> That would be perfect. I wish \"good programming speed\" to the relevant contributors!\r\n\r\nThanks! I'm working on it now! I found a good way to hook into the existing sync tests and it has been very helpful in showing me what I missed ðŸ˜„ ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1721762430/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-23T23:32:57Z","updated_at":"2023-09-23T23:32:57Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rclone/rclone/issues/7332","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/7332/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/7332/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/7332/events","html_url":"https://github.com/rclone/rclone/issues/7332","id":1909912958,"node_id":"I_kwDOAQ-n5M5x1vV-","number":7332,"title":"bisync: performance","user":{"login":"crocinsocks","id":88002608,"node_id":"MDQ6VXNlcjg4MDAyNjA4","avatar_url":"https://avatars.githubusercontent.com/u/88002608?v=4","gravatar_id":"","url":"https://api.github.com/users/crocinsocks","html_url":"https://github.com/crocinsocks","followers_url":"https://api.github.com/users/crocinsocks/followers","following_url":"https://api.github.com/users/crocinsocks/following{/other_user}","gists_url":"https://api.github.com/users/crocinsocks/gists{/gist_id}","starred_url":"https://api.github.com/users/crocinsocks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/crocinsocks/subscriptions","organizations_url":"https://api.github.com/users/crocinsocks/orgs","repos_url":"https://api.github.com/users/crocinsocks/repos","events_url":"https://api.github.com/users/crocinsocks/events{/privacy}","received_events_url":"https://api.github.com/users/crocinsocks/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399007,"node_id":"MDU6TGFiZWw4NjM5OTAwNw==","url":"https://api.github.com/repos/rclone/rclone/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null},{"id":2547621549,"node_id":"MDU6TGFiZWwyNTQ3NjIxNTQ5","url":"https://api.github.com/repos/rclone/rclone/labels/concurrency","name":"concurrency","color":"9090e4","default":false,"description":""},{"id":3427818774,"node_id":"LA_kwDOAQ-n5M7MUF0W","url":"https://api.github.com/repos/rclone/rclone/labels/bisync","name":"bisync","color":"1D76DB","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/11","html_url":"https://github.com/rclone/rclone/milestone/11","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/11/labels","id":1480382,"node_id":"MDk6TWlsZXN0b25lMTQ4MDM4Mg==","number":11,"title":"Soon","description":"Issues which are a good idea but haven't been assigned a specific release yet.","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":75,"closed_issues":94,"state":"open","created_at":"2016-01-02T12:56:46Z","updated_at":"2025-10-12T21:14:16Z","due_on":null,"closed_at":null},"comments":13,"created_at":"2023-09-23T15:42:18Z","updated_at":"2024-01-20T19:50:12Z","closed_at":"2024-01-20T19:50:11Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":17803236,"node_id":"MDEwOlJlcG9zaXRvcnkxNzgwMzIzNg==","name":"rclone","full_name":"rclone/rclone","private":false,"owner":{"login":"rclone","id":24937341,"node_id":"MDEyOk9yZ2FuaXphdGlvbjI0OTM3MzQx","avatar_url":"https://avatars.githubusercontent.com/u/24937341?v=4","gravatar_id":"","url":"https://api.github.com/users/rclone","html_url":"https://github.com/rclone","followers_url":"https://api.github.com/users/rclone/followers","following_url":"https://api.github.com/users/rclone/following{/other_user}","gists_url":"https://api.github.com/users/rclone/gists{/gist_id}","starred_url":"https://api.github.com/users/rclone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rclone/subscriptions","organizations_url":"https://api.github.com/users/rclone/orgs","repos_url":"https://api.github.com/users/rclone/repos","events_url":"https://api.github.com/users/rclone/events{/privacy}","received_events_url":"https://api.github.com/users/rclone/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rclone/rclone","description":"\"rsync for cloud storage\" - Google Drive, S3, Dropbox, Backblaze B2, One Drive, Swift, Hubic, Wasabi, Google Cloud Storage, Azure Blob, Azure Files, Yandex Files","fork":false,"url":"https://api.github.com/repos/rclone/rclone","forks_url":"https://api.github.com/repos/rclone/rclone/forks","keys_url":"https://api.github.com/repos/rclone/rclone/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rclone/rclone/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rclone/rclone/teams","hooks_url":"https://api.github.com/repos/rclone/rclone/hooks","issue_events_url":"https://api.github.com/repos/rclone/rclone/issues/events{/number}","events_url":"https://api.github.com/repos/rclone/rclone/events","assignees_url":"https://api.github.com/repos/rclone/rclone/assignees{/user}","branches_url":"https://api.github.com/repos/rclone/rclone/branches{/branch}","tags_url":"https://api.github.com/repos/rclone/rclone/tags","blobs_url":"https://api.github.com/repos/rclone/rclone/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rclone/rclone/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rclone/rclone/git/refs{/sha}","trees_url":"https://api.github.com/repos/rclone/rclone/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rclone/rclone/statuses/{sha}","languages_url":"https://api.github.com/repos/rclone/rclone/languages","stargazers_url":"https://api.github.com/repos/rclone/rclone/stargazers","contributors_url":"https://api.github.com/repos/rclone/rclone/contributors","subscribers_url":"https://api.github.com/repos/rclone/rclone/subscribers","subscription_url":"https://api.github.com/repos/rclone/rclone/subscription","commits_url":"https://api.github.com/repos/rclone/rclone/commits{/sha}","git_commits_url":"https://api.github.com/repos/rclone/rclone/git/commits{/sha}","comments_url":"https://api.github.com/repos/rclone/rclone/comments{/number}","issue_comment_url":"https://api.github.com/repos/rclone/rclone/issues/comments{/number}","contents_url":"https://api.github.com/repos/rclone/rclone/contents/{+path}","compare_url":"https://api.github.com/repos/rclone/rclone/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rclone/rclone/merges","archive_url":"https://api.github.com/repos/rclone/rclone/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rclone/rclone/downloads","issues_url":"https://api.github.com/repos/rclone/rclone/issues{/number}","pulls_url":"https://api.github.com/repos/rclone/rclone/pulls{/number}","milestones_url":"https://api.github.com/repos/rclone/rclone/milestones{/number}","notifications_url":"https://api.github.com/repos/rclone/rclone/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rclone/rclone/labels{/name}","releases_url":"https://api.github.com/repos/rclone/rclone/releases{/id}","deployments_url":"https://api.github.com/repos/rclone/rclone/deployments","created_at":"2014-03-16T16:19:57Z","updated_at":"2025-11-09T20:38:02Z","pushed_at":"2025-11-08T21:33:38Z","git_url":"git://github.com/rclone/rclone.git","ssh_url":"git@github.com:rclone/rclone.git","clone_url":"https://github.com/rclone/rclone.git","svn_url":"https://github.com/rclone/rclone","homepage":"https://rclone.org","size":217990,"stargazers_count":53422,"watchers_count":53422,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":4767,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1169,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["azure-blob","azure-blob-storage","azure-files","backblaze-b2","cloud-storage","dropbox","encryption","ftp","fuse-filesystem","go","golang","google-cloud-storage","google-drive","onedrive","openstack-swift","rclone","s3","sftp","sync","webdav"],"visibility":"public","forks":4767,"open_issues":1169,"watchers":53422,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"### setup\r\n\r\n11,265 files - 290.743MiB (90MB in ~5 files the rest are smaller and more equal in size)\r\n\r\nResults the same regardless of Wasabi or iDrive (iDrive typically performs a little faster in every test but only ~5-10% on average)\r\n\r\nRemote is using crypt and base32768 encoding. \r\n\r\nBW: ~1.5MiB UP ~5MiB DOWN\r\n\r\n### default/common flags\r\n\r\nAfter testing best performing filters are: --transfers 64 --checkers 128 --fast-list\r\n\r\nAlong with this (--filter-from) or (--filters-file) is also used\r\n\r\ne.g. --transfers 64 --checkers 128 --fast-list --filter-from/--filters-file ..\r\n\r\n### check\r\n\r\n~8s on average and between 6.8s to 9.6s\r\n\r\n### ls\r\n\r\n(using `time` as no info given with -v)\r\n\r\nls: 0m4.088s\r\nlsl: 7m36.975s\r\n\r\n### sync\r\n\r\nupload:\r\n\tinitial: 3m57.0s\r\n\tsubsequent: 18.6s\r\n\t\r\ndownload:\r\n\tinitial: 2m9.0s\r\n\tsubsequent: 17.8s\r\n\r\n### copy\r\n\r\nupload:\r\n\tinitial: 4m0.0s\r\n\tsubsequent 18.6s\r\n\t\r\ndownload:\r\n\tinitial: 2m6.5s\r\n\tsubsequent: 16.8s\r\n\r\n### bisync\r\n\r\nThese are some of the best and would say are usually a little longer by upto 5 mins this is likely when resync is run when data is already present vs copying the data itself.. There are no changes made to files when moving between a --resync and normal run.  \r\n\r\ndefaults:\r\n\tresync: 10m47.0s\r\n\tnormal: 6m44.7s\r\n\r\ndefaults with ignore checksum: (--ignore-listing-checksum --ignore-checksum)\r\n\tresync: 10m36.5s\r\n\tnormal: 6m31.9s\r\n\r\n### overview\r\n\r\nSo as you can see bisync is orders of magnitude slower than `copy` or `sync` . `ls` is incredibly fast as is `sync` and `copy` in both directions (e.g. uses up almost 100% of bandwidth)\r\n\r\nI only ran the test of `lsl` and `ls` at the very end and now thinking that bisync relies on lsl as this so incredibly slow (as I believe bisync does not use checksum so would need `lsl` info to compare?).\r\n\r\nI can do a local to crypt (local) bisync in 15s (--resync) and 8.7s for subsequent. \r\n\r\nIs there something I am doing wrong? If not, are there plans/options available to rclone to improve the speed of bisync so that it is more in line with 2 x sync/copy commands (e.g. one upload, one download) or is this a limitation that is unlikely to be overcome? Also, if this is due to lsl taking so long is there a way to speed up lsl? \r\n\r\nThanks to you all for your hard work and a special thank you @nielash for all you've been doing on bisync and continue to do. I as many others massively appreciate it and when this tool is out of experimental stages it will be a game changer for so many. If I had any free time or money right now I would help out but unfortunately the best I can do is give you some benchmarks and user feedback.\r\n\r\nThanks ","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/7332/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/7332/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1742308115","html_url":"https://github.com/rclone/rclone/issues/7282#issuecomment-1742308115","issue_url":"https://api.github.com/repos/rclone/rclone/issues/7282","id":1742308115,"node_id":"IC_kwDOAQ-n5M5n2YMT","user":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-02T02:03:00Z","updated_at":"2023-10-02T02:03:00Z","body":"A little update here: I have a [new draft](https://github.com/nielash/rclone/commits/logger-v3), still in need of some cleanup but the functionality works and tests pass. I added  several [new tests](https://github.com/nielash/rclone/commit/7e6fe3d42a2212cd0636ac8b5408da94cf14f60a#diff-b6405bbf1b3260847b78c2be001ee0920ecc846093350956d5f3123a1856c462) and also added a logger to [nearly every existing sync test](https://github.com/nielash/rclone/commit/7e6fe3d42a2212cd0636ac8b5408da94cf14f60a#diff-faf1e9a4e38adaa6c100c5b918b4b21a533d358fc2262d5b6db13b12bded7530) to look for edge cases. These don't necessarily need to stay in, but it was a very useful exercise as I did find quite a lot of them. I ended up [writing a new function](https://github.com/nielash/rclone/blob/a1d6bae439839729463e574ef3be987ed51179be/fs/operations/operations.go#L2730-L2824) to keep track of them and make it easy to reuse this logic. (I'm interested to know if you think I missed any...) I also tested on the entire Bisync testing suite.\r\n\r\nAs noted in the comments, there are a few cases that I think are probably not supportable right now. Namely:\r\n\r\n- `--max-duration` / `CutoffModeHard`\r\n- `--compare-dest` / `--copy-dest` (because `equal()` is called multiple times for the same file)\r\n- server-side moves of an entire dir at once (because we never get the individual file objects in the dir)\r\n- High-level retries, because there would be dupes, as we discussed\r\n- Possibly some error scenarios that didn't come up on the tests\r\n\r\nI think the high-level retries issue is ok, as it doesn't affect bisync and users of copy/sync/etc. can use `--retries 1` if they wish to avoid duplicates.\r\n\r\nFor the `sync` command I added an option to output a `--dest-after` file using the [same ListFormat flags as `lsf`](https://github.com/nielash/rclone/blob/a1d6bae439839729463e574ef3be987ed51179be/fs/operations/operations.go#L2646-L2666). Conceptually it is similar to rsync's `--itemize-changes`, but not identical -- it should output an accurate list of what will be on the destination after the sync. \r\n\r\nAs far as bisync is concerned, it seems to work beautifully so far. Although it has been a much bigger project than I anticipated ðŸ˜… ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1742308115/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10877458686,"node_id":"REFE_lADOAQ-n5M5wTmRNzwAAAAKIWNj-","url":"https://api.github.com/repos/rclone/rclone/issues/events/10877458686","actor":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"a96ce39b1fc313ab29758e8281ca03780a8282bd","commit_url":"https://api.github.com/repos/nielash/rclone/commits/a96ce39b1fc313ab29758e8281ca03780a8282bd","created_at":"2023-11-06T19:13:07Z","performed_via_github_app":null}]