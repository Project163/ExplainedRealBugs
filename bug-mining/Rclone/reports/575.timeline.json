[{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/454335489","html_url":"https://github.com/rclone/rclone/issues/2912#issuecomment-454335489","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2912","id":454335489,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NDMzNTQ4OQ==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-15T10:04:51Z","updated_at":"2019-01-15T10:04:51Z","body":"> rclone is hanging when transferring large files from FTP to google storage, file size was about 36 GB. The files are successfully transferred to google storage, but rclone never exits.\r\n> \r\n> I captured this stackdump (below) during the hang. I believe it shows the process is hanging waiting for a response after sending the remote FTP server the CLOSE command. Sending CLOSE is nice but not necessary to complete the transfer, so maybe we could add a timeout to that after which rclone gives up on hearing back a response to the CLOSE command.\r\n\r\nYour analysis looks good.\r\n\r\nDoes this FTP server do the same things on smaller files too?\r\n\r\nWe could put a work-around in rclone easily enough.  To put a timeout on properly would require a patch to the upstream library I think.\r\n\r\nDo you want to work on this?\r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/454335489/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":2074136603,"node_id":"MDEyOkxhYmVsZWRFdmVudDIwNzQxMzY2MDM=","url":"https://api.github.com/repos/rclone/rclone/issues/events/2074136603","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-01-15T10:04:57Z","label":{"name":"bug","color":"fc2929"},"performed_via_github_app":null},{"id":2074136758,"node_id":"MDE1Ok1pbGVzdG9uZWRFdmVudDIwNzQxMzY3NTg=","url":"https://api.github.com/repos/rclone/rclone/issues/events/2074136758","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2019-01-15T10:05:00Z","milestone":{"title":"v1.46"},"performed_via_github_app":null},{"id":2074137017,"node_id":"MDEyOkxhYmVsZWRFdmVudDIwNzQxMzcwMTc=","url":"https://api.github.com/repos/rclone/rclone/issues/events/2074137017","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-01-15T10:05:06Z","label":{"name":"Remote FTP","color":"fbca04"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/454445805","html_url":"https://github.com/rclone/rclone/issues/2912#issuecomment-454445805","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2912","id":454445805,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NDQ0NTgwNQ==","user":{"login":"qwwqwwq","id":4935495,"node_id":"MDQ6VXNlcjQ5MzU0OTU=","avatar_url":"https://avatars.githubusercontent.com/u/4935495?v=4","gravatar_id":"","url":"https://api.github.com/users/qwwqwwq","html_url":"https://github.com/qwwqwwq","followers_url":"https://api.github.com/users/qwwqwwq/followers","following_url":"https://api.github.com/users/qwwqwwq/following{/other_user}","gists_url":"https://api.github.com/users/qwwqwwq/gists{/gist_id}","starred_url":"https://api.github.com/users/qwwqwwq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/qwwqwwq/subscriptions","organizations_url":"https://api.github.com/users/qwwqwwq/orgs","repos_url":"https://api.github.com/users/qwwqwwq/repos","events_url":"https://api.github.com/users/qwwqwwq/events{/privacy}","received_events_url":"https://api.github.com/users/qwwqwwq/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-15T16:01:21Z","updated_at":"2019-01-15T16:01:21Z","body":"This particular server only does it for larger files.\n\nI built a patched rclone binary the other day that doesn’t send the close\ncommand at all, and confirmed it fixed the issue. I assume that is too\nextreme a solution to be accepted.\n\nI’m not very experienced with Golang but I’ll poke around to see if there’s\nsome way to put a timeout in there.\n\nOn Tue, Jan 15, 2019 at 2:05 AM Nick Craig-Wood <notifications@github.com>\nwrote:\n\n> rclone is hanging when transferring large files from FTP to google\n> storage, file size was about 36 GB. The files are successfully transferred\n> to google storage, but rclone never exits.\n>\n> I captured this stackdump (below) during the hang. I believe it shows the\n> process is hanging waiting for a response after sending the remote FTP\n> server the CLOSE command. Sending CLOSE is nice but not necessary to\n> complete the transfer, so maybe we could add a timeout to that after which\n> rclone gives up on hearing back a response to the CLOSE command.\n>\n> Your analysis looks good.\n>\n> Does this FTP server do the same things on smaller files too?\n>\n> We could put a work-around in rclone easily enough. To put a timeout on\n> properly would require a patch to the upstream library I think.\n>\n> Do you want to work on this?\n>\n> —\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/ncw/rclone/issues/2912#issuecomment-454335489>, or mute\n> the thread\n> <https://github.com/notifications/unsubscribe-auth/AEtPR5oGNyaY5VOnReox8gHTJo_7ZBV-ks5vDafNgaJpZM4Z_WdY>\n> .\n>\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/454445805/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"qwwqwwq","id":4935495,"node_id":"MDQ6VXNlcjQ5MzU0OTU=","avatar_url":"https://avatars.githubusercontent.com/u/4935495?v=4","gravatar_id":"","url":"https://api.github.com/users/qwwqwwq","html_url":"https://github.com/qwwqwwq","followers_url":"https://api.github.com/users/qwwqwwq/followers","following_url":"https://api.github.com/users/qwwqwwq/following{/other_user}","gists_url":"https://api.github.com/users/qwwqwwq/gists{/gist_id}","starred_url":"https://api.github.com/users/qwwqwwq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/qwwqwwq/subscriptions","organizations_url":"https://api.github.com/users/qwwqwwq/orgs","repos_url":"https://api.github.com/users/qwwqwwq/repos","events_url":"https://api.github.com/users/qwwqwwq/events{/privacy}","received_events_url":"https://api.github.com/users/qwwqwwq/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":2075268617,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDIwNzUyNjg2MTc=","url":"https://api.github.com/repos/rclone/rclone/issues/events/2075268617","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"4846d9393d5dcd6993bbff9ec3f85ed813911e21","commit_url":"https://api.github.com/repos/rclone/rclone/commits/4846d9393d5dcd6993bbff9ec3f85ed813911e21","created_at":"2019-01-15T17:33:15Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/454480531","html_url":"https://github.com/rclone/rclone/issues/2912#issuecomment-454480531","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2912","id":454480531,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NDQ4MDUzMQ==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-15T17:34:02Z","updated_at":"2019-01-15T17:34:02Z","body":"> I built a patched rclone binary the other day that doesn’t send the close command at all, and confirmed it fixed the issue. I assume that is too extreme a solution to be accepted.\r\n\r\nAh that is good confirmation.\r\n\r\nThe timeout is happening on reading the response code from the data channel.\r\n\r\nI think we should still call close, but what we could do is give it 60s (say) to do its stuff, and if it doesn't then\r\n\r\nHere is a potential fix which does that.  It passes the integration tests - does it fix your issue?\r\n\r\nhttps://beta.rclone.org/branch/v1.45-094-g4846d939-fix-2912-ftp-hang-beta/ (uploaded in 15-30 mins)\r\n\r\nThe code change looks like this...\r\n\r\n```diff\r\ndiff --git a/backend/ftp/ftp.go b/backend/ftp/ftp.go\r\nindex fafe6b702..fafe7bc53 100644\r\n--- a/backend/ftp/ftp.go\r\n+++ b/backend/ftp/ftp.go\r\n@@ -646,7 +646,21 @@ func (f *ftpReadCloser) Read(p []byte) (n int, err error) {\r\n \r\n // Close the FTP reader and return the connection to the pool\r\n func (f *ftpReadCloser) Close() error {\r\n-\terr := f.rc.Close()\r\n+\tvar err error\r\n+\terrchan := make(chan error, 1)\r\n+\tgo func() {\r\n+\t\terrchan <- f.rc.Close()\r\n+\t}()\r\n+\t// Wait for Close for up to 60 seconds\r\n+\ttimer := time.NewTimer(60 * time.Second)\r\n+\tselect {\r\n+\tcase err = <-errchan:\r\n+\t\ttimer.Stop()\r\n+\tcase <-timer.C:\r\n+\t\t// if timer fired assume no error but connection dead\r\n+\t\tfs.Errorf(f.f, \"Timeout when waiting for connection Close\")\r\n+\t\treturn nil\r\n+\t}\r\n \t// if errors while reading or closing, dump the connection\r\n \tif err != nil || f.err != nil {\r\n \t\t_ = f.c.Quit()\r\n```","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/454480531/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/454505820","html_url":"https://github.com/rclone/rclone/issues/2912#issuecomment-454505820","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2912","id":454505820,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NDUwNTgyMA==","user":{"login":"qwwqwwq","id":4935495,"node_id":"MDQ6VXNlcjQ5MzU0OTU=","avatar_url":"https://avatars.githubusercontent.com/u/4935495?v=4","gravatar_id":"","url":"https://api.github.com/users/qwwqwwq","html_url":"https://github.com/qwwqwwq","followers_url":"https://api.github.com/users/qwwqwwq/followers","following_url":"https://api.github.com/users/qwwqwwq/following{/other_user}","gists_url":"https://api.github.com/users/qwwqwwq/gists{/gist_id}","starred_url":"https://api.github.com/users/qwwqwwq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/qwwqwwq/subscriptions","organizations_url":"https://api.github.com/users/qwwqwwq/orgs","repos_url":"https://api.github.com/users/qwwqwwq/repos","events_url":"https://api.github.com/users/qwwqwwq/events{/privacy}","received_events_url":"https://api.github.com/users/qwwqwwq/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-15T18:48:26Z","updated_at":"2019-01-15T18:48:26Z","body":"Confirmed that binary works!\n\nOn Tue, Jan 15, 2019 at 9:34 AM Nick Craig-Wood <notifications@github.com>\nwrote:\n\n> I built a patched rclone binary the other day that doesn’t send the close\n> command at all, and confirmed it fixed the issue. I assume that is too\n> extreme a solution to be accepted.\n>\n> Ah that is good confirmation.\n>\n> The timeout is happening on reading the response code from the data\n> channel.\n>\n> I think we should still call close, but what we could do is give it 60s\n> (say) to do its stuff, and if it doesn't then\n>\n> Here is a potential fix which does that. It passes the integration tests -\n> does it fix your issue?\n>\n> https://beta.rclone.org/branch/v1.45-094-g4846d939-fix-2912-ftp-hang-beta/\n> (uploaded in 15-30 mins)\n>\n> The code change looks like this...\n>\n> diff --git a/backend/ftp/ftp.go b/backend/ftp/ftp.go\n>\n> index fafe6b702..fafe7bc53 100644\n> --- a/backend/ftp/ftp.go\n> +++ b/backend/ftp/ftp.go\n> @@ -646,7 +646,21 @@ func (f *ftpReadCloser) Read(p []byte) (n int, err error) {\n>\n>\n>\n>  // Close the FTP reader and return the connection to the pool\n>\n>  func (f *ftpReadCloser) Close() error {\n> -\terr := f.rc.Close()\n> +\tvar err error\n> +\terrchan := make(chan error, 1)\n> +\tgo func() {\n> +\t\terrchan <- f.rc.Close()\n> +\t}()\n> +\t// Wait for Close for up to 60 seconds\n> +\ttimer := time.NewTimer(60 * time.Second)\n> +\tselect {\n> +\tcase err = <-errchan:\n> +\t\ttimer.Stop()\n> +\tcase <-timer.C:\n> +\t\t// if timer fired assume no error but connection dead\n> +\t\tfs.Errorf(f.f, \"Timeout when waiting for connection Close\")\n> +\t\treturn nil\n> +\t}\n>\n>  \t// if errors while reading or closing, dump the connection\n>\n>  \tif err != nil || f.err != nil {\n>\n>  \t\t_ = f.c.Quit()\n>\n> —\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/ncw/rclone/issues/2912#issuecomment-454480531>, or mute\n> the thread\n> <https://github.com/notifications/unsubscribe-auth/AEtPR44mVgl1NbyUzk8HNDjh6Yk4wwmjks5vDhEZgaJpZM4Z_WdY>\n> .\n>\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/454505820/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"qwwqwwq","id":4935495,"node_id":"MDQ6VXNlcjQ5MzU0OTU=","avatar_url":"https://avatars.githubusercontent.com/u/4935495?v=4","gravatar_id":"","url":"https://api.github.com/users/qwwqwwq","html_url":"https://github.com/qwwqwwq","followers_url":"https://api.github.com/users/qwwqwwq/followers","following_url":"https://api.github.com/users/qwwqwwq/following{/other_user}","gists_url":"https://api.github.com/users/qwwqwwq/gists{/gist_id}","starred_url":"https://api.github.com/users/qwwqwwq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/qwwqwwq/subscriptions","organizations_url":"https://api.github.com/users/qwwqwwq/orgs","repos_url":"https://api.github.com/users/qwwqwwq/repos","events_url":"https://api.github.com/users/qwwqwwq/events{/privacy}","received_events_url":"https://api.github.com/users/qwwqwwq/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":2077430803,"node_id":"MDExOkNsb3NlZEV2ZW50MjA3NzQzMDgwMw==","url":"https://api.github.com/repos/rclone/rclone/issues/events/2077430803","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"4846d9393d5dcd6993bbff9ec3f85ed813911e21","commit_url":"https://api.github.com/repos/rclone/rclone/commits/4846d9393d5dcd6993bbff9ec3f85ed813911e21","created_at":"2019-01-16T13:44:28Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/454783457","html_url":"https://github.com/rclone/rclone/issues/2912#issuecomment-454783457","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2912","id":454783457,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1NDc4MzQ1Nw==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-16T13:44:50Z","updated_at":"2019-01-16T13:44:50Z","body":"Thanks for testing :-)\r\n\r\nI merged that to master and it will be in [the latest beta](https://beta.rclone.org) in 15-30 mins and released in 1.46","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/454783457/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":2207597585,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDIyMDc1OTc1ODU=","url":"https://api.github.com/repos/rclone/rclone/issues/events/2207597585","actor":{"login":"gcornut","id":939567,"node_id":"MDQ6VXNlcjkzOTU2Nw==","avatar_url":"https://avatars.githubusercontent.com/u/939567?v=4","gravatar_id":"","url":"https://api.github.com/users/gcornut","html_url":"https://github.com/gcornut","followers_url":"https://api.github.com/users/gcornut/followers","following_url":"https://api.github.com/users/gcornut/following{/other_user}","gists_url":"https://api.github.com/users/gcornut/gists{/gist_id}","starred_url":"https://api.github.com/users/gcornut/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gcornut/subscriptions","organizations_url":"https://api.github.com/users/gcornut/orgs","repos_url":"https://api.github.com/users/gcornut/repos","events_url":"https://api.github.com/users/gcornut/events{/privacy}","received_events_url":"https://api.github.com/users/gcornut/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"8ecb03e6854b353bf711f47012df18c8f42e3a4b","commit_url":"https://api.github.com/repos/gcornut/rclone/commits/8ecb03e6854b353bf711f47012df18c8f42e3a4b","created_at":"2019-03-15T20:54:18Z","performed_via_github_app":null},{"id":2207610654,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDIyMDc2MTA2NTQ=","url":"https://api.github.com/repos/rclone/rclone/issues/events/2207610654","actor":{"login":"gcornut","id":939567,"node_id":"MDQ6VXNlcjkzOTU2Nw==","avatar_url":"https://avatars.githubusercontent.com/u/939567?v=4","gravatar_id":"","url":"https://api.github.com/users/gcornut","html_url":"https://github.com/gcornut","followers_url":"https://api.github.com/users/gcornut/followers","following_url":"https://api.github.com/users/gcornut/following{/other_user}","gists_url":"https://api.github.com/users/gcornut/gists{/gist_id}","starred_url":"https://api.github.com/users/gcornut/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gcornut/subscriptions","organizations_url":"https://api.github.com/users/gcornut/orgs","repos_url":"https://api.github.com/users/gcornut/repos","events_url":"https://api.github.com/users/gcornut/events{/privacy}","received_events_url":"https://api.github.com/users/gcornut/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"9fecf8d00b3803e7e685b70395f07df469953baa","commit_url":"https://api.github.com/repos/gcornut/rclone/commits/9fecf8d00b3803e7e685b70395f07df469953baa","created_at":"2019-03-15T21:00:58Z","performed_via_github_app":null},{"actor":{"login":"jeffquinn-outvote","id":39918508,"node_id":"MDQ6VXNlcjM5OTE4NTA4","avatar_url":"https://avatars.githubusercontent.com/u/39918508?v=4","gravatar_id":"","url":"https://api.github.com/users/jeffquinn-outvote","html_url":"https://github.com/jeffquinn-outvote","followers_url":"https://api.github.com/users/jeffquinn-outvote/followers","following_url":"https://api.github.com/users/jeffquinn-outvote/following{/other_user}","gists_url":"https://api.github.com/users/jeffquinn-outvote/gists{/gist_id}","starred_url":"https://api.github.com/users/jeffquinn-outvote/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeffquinn-outvote/subscriptions","organizations_url":"https://api.github.com/users/jeffquinn-outvote/orgs","repos_url":"https://api.github.com/users/jeffquinn-outvote/repos","events_url":"https://api.github.com/users/jeffquinn-outvote/events{/privacy}","received_events_url":"https://api.github.com/users/jeffquinn-outvote/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-04-03T17:13:25Z","updated_at":"2019-04-03T17:13:25Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rclone/rclone/issues/3086","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/3086/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/3086/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/3086/events","html_url":"https://github.com/rclone/rclone/issues/3086","id":428881400,"node_id":"MDU6SXNzdWU0Mjg4ODE0MDA=","number":3086,"title":"`copy` hangs on FTP LIST command","user":{"login":"jeffquinn-outvote","id":39918508,"node_id":"MDQ6VXNlcjM5OTE4NTA4","avatar_url":"https://avatars.githubusercontent.com/u/39918508?v=4","gravatar_id":"","url":"https://api.github.com/users/jeffquinn-outvote","html_url":"https://github.com/jeffquinn-outvote","followers_url":"https://api.github.com/users/jeffquinn-outvote/followers","following_url":"https://api.github.com/users/jeffquinn-outvote/following{/other_user}","gists_url":"https://api.github.com/users/jeffquinn-outvote/gists{/gist_id}","starred_url":"https://api.github.com/users/jeffquinn-outvote/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeffquinn-outvote/subscriptions","organizations_url":"https://api.github.com/users/jeffquinn-outvote/orgs","repos_url":"https://api.github.com/users/jeffquinn-outvote/repos","events_url":"https://api.github.com/users/jeffquinn-outvote/events{/privacy}","received_events_url":"https://api.github.com/users/jeffquinn-outvote/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":608259284,"node_id":"MDU6TGFiZWw2MDgyNTkyODQ=","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20FTP","name":"Remote: FTP","color":"fbca04","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/18","html_url":"https://github.com/rclone/rclone/milestone/18","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/18/labels","id":1832726,"node_id":"MDk6TWlsZXN0b25lMTgzMjcyNg==","number":18,"title":"Known Problem","description":"This milestone contains issues which are known problems which are proving difficult to fix, or are awaiting an external fix or we haven't got round to yet.","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":70,"closed_issues":148,"state":"open","created_at":"2016-06-16T16:59:54Z","updated_at":"2025-08-25T17:05:37Z","due_on":null,"closed_at":null},"comments":6,"created_at":"2019-04-03T17:13:25Z","updated_at":"2019-05-11T16:26:33Z","closed_at":"2019-05-11T16:26:33Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":17803236,"node_id":"MDEwOlJlcG9zaXRvcnkxNzgwMzIzNg==","name":"rclone","full_name":"rclone/rclone","private":false,"owner":{"login":"rclone","id":24937341,"node_id":"MDEyOk9yZ2FuaXphdGlvbjI0OTM3MzQx","avatar_url":"https://avatars.githubusercontent.com/u/24937341?v=4","gravatar_id":"","url":"https://api.github.com/users/rclone","html_url":"https://github.com/rclone","followers_url":"https://api.github.com/users/rclone/followers","following_url":"https://api.github.com/users/rclone/following{/other_user}","gists_url":"https://api.github.com/users/rclone/gists{/gist_id}","starred_url":"https://api.github.com/users/rclone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rclone/subscriptions","organizations_url":"https://api.github.com/users/rclone/orgs","repos_url":"https://api.github.com/users/rclone/repos","events_url":"https://api.github.com/users/rclone/events{/privacy}","received_events_url":"https://api.github.com/users/rclone/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rclone/rclone","description":"\"rsync for cloud storage\" - Google Drive, S3, Dropbox, Backblaze B2, One Drive, Swift, Hubic, Wasabi, Google Cloud Storage, Azure Blob, Azure Files, Yandex Files","fork":false,"url":"https://api.github.com/repos/rclone/rclone","forks_url":"https://api.github.com/repos/rclone/rclone/forks","keys_url":"https://api.github.com/repos/rclone/rclone/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rclone/rclone/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rclone/rclone/teams","hooks_url":"https://api.github.com/repos/rclone/rclone/hooks","issue_events_url":"https://api.github.com/repos/rclone/rclone/issues/events{/number}","events_url":"https://api.github.com/repos/rclone/rclone/events","assignees_url":"https://api.github.com/repos/rclone/rclone/assignees{/user}","branches_url":"https://api.github.com/repos/rclone/rclone/branches{/branch}","tags_url":"https://api.github.com/repos/rclone/rclone/tags","blobs_url":"https://api.github.com/repos/rclone/rclone/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rclone/rclone/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rclone/rclone/git/refs{/sha}","trees_url":"https://api.github.com/repos/rclone/rclone/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rclone/rclone/statuses/{sha}","languages_url":"https://api.github.com/repos/rclone/rclone/languages","stargazers_url":"https://api.github.com/repos/rclone/rclone/stargazers","contributors_url":"https://api.github.com/repos/rclone/rclone/contributors","subscribers_url":"https://api.github.com/repos/rclone/rclone/subscribers","subscription_url":"https://api.github.com/repos/rclone/rclone/subscription","commits_url":"https://api.github.com/repos/rclone/rclone/commits{/sha}","git_commits_url":"https://api.github.com/repos/rclone/rclone/git/commits{/sha}","comments_url":"https://api.github.com/repos/rclone/rclone/comments{/number}","issue_comment_url":"https://api.github.com/repos/rclone/rclone/issues/comments{/number}","contents_url":"https://api.github.com/repos/rclone/rclone/contents/{+path}","compare_url":"https://api.github.com/repos/rclone/rclone/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rclone/rclone/merges","archive_url":"https://api.github.com/repos/rclone/rclone/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rclone/rclone/downloads","issues_url":"https://api.github.com/repos/rclone/rclone/issues{/number}","pulls_url":"https://api.github.com/repos/rclone/rclone/pulls{/number}","milestones_url":"https://api.github.com/repos/rclone/rclone/milestones{/number}","notifications_url":"https://api.github.com/repos/rclone/rclone/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rclone/rclone/labels{/name}","releases_url":"https://api.github.com/repos/rclone/rclone/releases{/id}","deployments_url":"https://api.github.com/repos/rclone/rclone/deployments","created_at":"2014-03-16T16:19:57Z","updated_at":"2025-11-09T20:38:02Z","pushed_at":"2025-11-08T21:33:38Z","git_url":"git://github.com/rclone/rclone.git","ssh_url":"git@github.com:rclone/rclone.git","clone_url":"https://github.com/rclone/rclone.git","svn_url":"https://github.com/rclone/rclone","homepage":"https://rclone.org","size":217990,"stargazers_count":53422,"watchers_count":53422,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":4767,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1169,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["azure-blob","azure-blob-storage","azure-files","backblaze-b2","cloud-storage","dropbox","encryption","ftp","fuse-filesystem","go","golang","google-cloud-storage","google-drive","onedrive","openstack-swift","rclone","s3","sftp","sync","webdav"],"visibility":"public","forks":4767,"open_issues":1169,"watchers":53422,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"#### What is the problem you are having with rclone?\r\n\r\nRunning a copy command from FTP to GS, the process hangs indefinitely. The thread dump of the hanging process (running for 16 hours, with essentially no network activity) seems to indicate it is waiting for the FTP list command to return:\r\n\r\n```\r\ngoroutine 72 [IO wait, 2361 minutes]:\r\ninternal/poll.runtime_pollWait(0x7ff5de1a8e30, 0x72, 0xc0000cb780)\r\n\t/usr/local/go/src/runtime/netpoll.go:173 +0x66\r\ninternal/poll.(*pollDesc).wait(0xc000344118, 0x72, 0xffffffffffffff00, 0x146c4e0, 0x1d58830)\r\n\t/usr/local/go/src/internal/poll/fd_poll_runtime.go:85 +0x9a\r\ninternal/poll.(*pollDesc).waitRead(0xc000344118, 0xc000348000, 0x1000, 0x1000)\r\n\t/usr/local/go/src/internal/poll/fd_poll_runtime.go:90 +0x3d\r\ninternal/poll.(*FD).Read(0xc000344100, 0xc000348000, 0x1000, 0x1000, 0x0, 0x0, 0x0)\r\n\t/usr/local/go/src/internal/poll/fd_unix.go:169 +0x179\r\nnet.(*netFD).Read(0xc000344100, 0xc000348000, 0x1000, 0x1000, 0xc000522a80, 0x300000002, 0xc000522a80)\r\n\t/usr/local/go/src/net/fd_unix.go:202 +0x4f\r\nnet.(*conn).Read(0xc00000ec40, 0xc000348000, 0x1000, 0x1000, 0x0, 0x0, 0x0)\r\n\t/usr/local/go/src/net/net.go:177 +0x68\r\nbufio.(*Reader).fill(0xc000229800)\r\n\t/usr/local/go/src/bufio/bufio.go:100 +0x10f\r\nbufio.(*Reader).ReadSlice(0xc000229800, 0x4a7c0a, 0xc000345b00, 0x1, 0xc0000cb900, 0xc0000cb9a0, 0x4a9050)\r\n\t/usr/local/go/src/bufio/bufio.go:341 +0x36\r\nbufio.(*Reader).ReadLine(0xc000229800, 0xc0000cba00, 0xc0000cb9e0, 0x43660c, 0xc000522a80, 0x300000002, 0xc000522a80)\r\n\t/usr/local/go/src/bufio/bufio.go:370 +0x34\r\nnet/textproto.(*Reader).readLineSlice(0xc000227e60, 0x4406dc, 0xc000345b28, 0xc0000cba01, 0x4405bb, 0xc000345b28)\r\n\t/usr/local/go/src/net/textproto/reader.go:55 +0x6f\r\nnet/textproto.(*Reader).ReadLine(0xc000227e60, 0x0, 0x0, 0xc0000cbab0, 0x4404d9)\r\n\t/usr/local/go/src/net/textproto/reader.go:36 +0x2b\r\nnet/textproto.(*Reader).readCodeLine(0xc000227e60, 0xe2, 0x0, 0x0, 0xc0000cbb18, 0x511b3f, 0xc000345b00, 0x0)\r\n\t/usr/local/go/src/net/textproto/reader.go:177 +0x2f\r\nnet/textproto.(*Reader).ReadResponse(0xc000227e60, 0xe2, 0x0, 0xc0000cbbb8, 0x18, 0xc000522a80, 0x1325f68)\r\n\t/usr/local/go/src/net/textproto/reader.go:255 +0x4d\r\ngithub.com/jlaffaye/ftp.(*Response).Close(0xc00054a900, 0x5, 0xc0000cbc70)\r\n\t/root/go/pkg/mod/github.com/jlaffaye/ftp@v0.0.0-20190126081051-8019e6774408/ftp.go:595 +0x89\r\ngithub.com/jlaffaye/ftp.(*ServerConn).List(0xc000288a00, 0xc000504660, 0x19, 0xc00372c000, 0x12e7d, 0x17800, 0x0, 0x0)\r\n\t/root/go/pkg/mod/github.com/jlaffaye/ftp@v0.0.0-20190126081051-8019e6774408/ftp.go:394 +0x483\r\ngithub.com/ncw/rclone/backend/ftp.(*Fs).List(0xc0002e91e0, 0x0, 0x0, 0x8, 0xc0002885c0, 0xc0007d4360, 0xc000951e10, 0xc000817fb0)\r\n\t/containers/deps/rclone/backend/ftp/ftp.go:333 +0x111\r\ngithub.com/ncw/rclone/fs/list.DirSorted(0x1481300, 0xc0002e91e0, 0x0, 0x0, 0x0, 0x42cc72, 0xffffffff00000008, 0xc000288980, 0x0, 0xc000817f48)\r\n\t/containers/deps/rclone/fs/list/list.go:23 +0x63\r\ngithub.com/ncw/rclone/fs/march.(*March).makeListDir.func1(0x0, 0x0, 0xc000546080, 0x0, 0xc0007d4360, 0x0, 0x1)\r\n\t/containers/deps/rclone/fs/march/march.go:73 +0x53\r\ngithub.com/ncw/rclone/fs/march.(*March).processJob.func1(0xc000546080, 0xc000345780, 0x0, 0x0, 0x0, 0x0, 0xffffffffffffffff, 0xffffffffffffffff, 0x0, 0xc00054a720, ...)\r\n\t/containers/deps/rclone/fs/march/march.go:347 +0x6c\r\ncreated by github.com/ncw/rclone/fs/march.(*March).processJob\r\n\t/containers/deps/rclone/fs/march/march.go:345 +0x117d\r\n```\r\n\r\nSimilar to #2912 I suspect we just need a timeout here (and maybe in other places too eventually).\r\n\r\n#### What is your rclone version (output from `rclone version`)\r\n\r\n`1.46`\r\n\r\n#### Which OS you are using and how many bits (eg Windows 7, 64 bit)\r\n\r\nAlpine Linux, 64 bit\r\n\r\n####  Which cloud storage system are you using? (eg Google Drive)\r\n\r\nGoogle Storage\r\n\r\n#### The command you were trying to run (eg `rclone copy /tmp remote:tmp`)\r\n\r\n`rclone copy --transfers 16 --use-mmap '--include=full_*.csv.gz' --max-depth 0 ftp:remote-ftp-folder gcp:mybucket/myprefix`\r\n\r\n#### A log from the command with the `-vv` flag (eg output from `rclone -vv copy /tmp remote:tmp`)\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/3086/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/3086/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"}]