{"url":"https://api.github.com/repos/rclone/rclone/issues/2610","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/2610/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/2610/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/2610/events","html_url":"https://github.com/rclone/rclone/issues/2610","id":363836484,"node_id":"MDU6SXNzdWUzNjM4MzY0ODQ=","number":2610,"title":"backend/s3/s3.go: SetModTime() ignores server-side-encryption and storage class options","user":{"login":"paulkohout","id":21349865,"node_id":"MDQ6VXNlcjIxMzQ5ODY1","avatar_url":"https://avatars.githubusercontent.com/u/21349865?v=4","gravatar_id":"","url":"https://api.github.com/users/paulkohout","html_url":"https://github.com/paulkohout","followers_url":"https://api.github.com/users/paulkohout/followers","following_url":"https://api.github.com/users/paulkohout/following{/other_user}","gists_url":"https://api.github.com/users/paulkohout/gists{/gist_id}","starred_url":"https://api.github.com/users/paulkohout/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paulkohout/subscriptions","organizations_url":"https://api.github.com/users/paulkohout/orgs","repos_url":"https://api.github.com/users/paulkohout/repos","events_url":"https://api.github.com/users/paulkohout/events{/privacy}","received_events_url":"https://api.github.com/users/paulkohout/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":314138213,"node_id":"MDU6TGFiZWwzMTQxMzgyMTM=","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20S3","name":"Remote: S3","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/31","html_url":"https://github.com/rclone/rclone/milestone/31","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/31/labels","id":3430251,"node_id":"MDk6TWlsZXN0b25lMzQzMDI1MQ==","number":31,"title":"v1.44","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":39,"state":"closed","created_at":"2018-06-17T16:06:43Z","updated_at":"2018-12-20T12:12:18Z","due_on":"2018-10-13T07:00:00Z","closed_at":"2018-10-19T14:55:35Z"},"comments":4,"created_at":"2018-09-26T02:42:51Z","updated_at":"2018-10-04T07:26:33Z","closed_at":"2018-10-04T07:25:21Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### What is the problem you are having with rclone?\r\n\r\nIn backend/s3/s3.go, SetModTime() calls o.fs.c.CopyObject(), but without adding the configured server-side-encryption and storage class options to the request (as done in Update()). The server-side-encryption and storage class **are not copied from the source**. This causes files to always be stored without server-side-encryption and in the standard storage class, **despite the configured options**.\r\n\r\nThe likelihood of this problem occurring could be significant in the right conditions. For instance, during sync operations to an s3 remote, when source and destination files have the same content, but different modification times.\r\n\r\n_NOTE: By looking at the code, a similar problem appears to exist in Copy()._\r\n\r\n\r\n#### What is your rclone version (output from `rclone version`)\r\nrclone v1.38\r\n- os/arch: freebsd/amd64\r\n- go version: go1.9\r\n\r\n\r\n#### Which OS you are using and how many bits\r\nFreeBSD-11.1 64-bit\r\n\r\n\r\n####  Which cloud storage system are you using?\r\nAmazon s3\r\n\r\n\r\n#### The command you were trying to run\r\nrclone -vv --retries 1 --config rclone.conf sync ./data remote:XXXX\r\n\r\n\r\n#### A log from the command with the `-vv` flag\r\nSetModTime() succeedes, **BUT it disables server-side-encryption despite the configured options**.\r\nHere is a dump (modified):\r\n\r\n2018/09/25 22:16:13 DEBUG : Using config file from \"/mnt/volume1/temp/rclone_testing/rclone.conf\"\r\n2018/09/25 22:16:13 DEBUG : rclone: Version \"v1.38\" starting with parameters [\"rclone\" \"-vv\" \"--retries\" \"1\" \"--config\" \"rclone.conf\" \"sync\" \"./data\" \"remote:XXXX\"]\r\n2018/09/25 22:16:13 INFO  : S3 bucket XXXX: Modify window is 1Âµs\r\n2018/09/25 22:16:15 INFO  : S3 bucket XXXX: Waiting for checks to finish\r\n2018/09/25 22:16:19 DEBUG : data.txt: Modification times differ by -47h10m58.288201986s: 2018-09-25 20:34:48.134560992 -0400 EDT, 2018-09-23 21:23:49.846359006 -0400 EDT\r\n2018/09/25 22:16:21 INFO  : data.txt: Updated modification time in destination\r\n2018/09/25 22:16:21 DEBUG : data.txt: Unchanged skipping\r\n2018/09/25 22:16:21 INFO  : S3 bucket XXXX: Waiting for transfers to finish\r\n2018/09/25 22:16:21 INFO  : Waiting for deletions to finish\r\n2018/09/25 22:16:21 INFO  :\r\nTransferred:      0 Bytes (0 Bytes/s)\r\nErrors:                 0\r\nChecks:                 1\r\nTransferred:            0\r\nElapsed time:        7.8s\r\n\r\n2018/09/25 22:16:21 DEBUG : Go routines at exit 4\r\n2018/09/25 22:16:21 DEBUG : rclone: Version \"v1.38\" finishing with parameters [\"rclone\" \"-vv\" \"--retries\" \"1\" \"--config\" \"rclone.conf\" \"sync\" \"./data\" \"remote:XXXX\"]","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/2610/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/2610/timeline","performed_via_github_app":null,"state_reason":"completed"}