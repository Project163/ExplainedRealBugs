{"url":"https://api.github.com/repos/rclone/rclone/issues/7896","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/7896/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/7896/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/7896/events","html_url":"https://github.com/rclone/rclone/issues/7896","id":2341692140,"node_id":"I_kwDOAQ-n5M6Lk2Ls","number":7896,"title":"backend: pcloud: support block level sync (upload only)","user":{"login":"gfelbing","id":10872874,"node_id":"MDQ6VXNlcjEwODcyODc0","avatar_url":"https://avatars.githubusercontent.com/u/10872874?v=4","gravatar_id":"","url":"https://api.github.com/users/gfelbing","html_url":"https://github.com/gfelbing","followers_url":"https://api.github.com/users/gfelbing/followers","following_url":"https://api.github.com/users/gfelbing/following{/other_user}","gists_url":"https://api.github.com/users/gfelbing/gists{/gist_id}","starred_url":"https://api.github.com/users/gfelbing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gfelbing/subscriptions","organizations_url":"https://api.github.com/users/gfelbing/orgs","repos_url":"https://api.github.com/users/gfelbing/repos","events_url":"https://api.github.com/users/gfelbing/events{/privacy}","received_events_url":"https://api.github.com/users/gfelbing/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399007,"node_id":"MDU6TGFiZWw4NjM5OTAwNw==","url":"https://api.github.com/repos/rclone/rclone/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null},{"id":1768147634,"node_id":"MDU6TGFiZWwxNzY4MTQ3NjM0","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20PCloud","name":"Remote: PCloud","color":"fbca04","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2024-06-08T14:55:54Z","updated_at":"2024-08-22T21:42:34Z","closed_at":"2024-08-22T21:42:34Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n\r\nWelcome :-)\r\n\r\nSo you've got an idea to improve rclone? We love that!\r\nYou'll be glad to hear we've incorporated hundreds of ideas from contributors already.\r\n\r\nProbably the latest beta (or stable) release has your feature, so try to update your rclone.\r\nThe update instructions are available at https://rclone.org/commands/rclone_selfupdate/\r\n\r\nIf it still isn't there, here is a checklist of things to do:\r\n\r\n  1. Search the old issues for your idea and +1 or comment on an existing issue if possible.\r\n  2. Discuss on the forum: https://forum.rclone.org/\r\n  3. Make a feature request issue (this is the right place!).\r\n  4. Be prepared to get involved making the feature :-)\r\n\r\nLooking forward to your great idea!\r\n\r\nThe Rclone Developers\r\n\r\n-->\r\n\r\n#### The associated forum post URL from `https://forum.rclone.org`\r\n\r\n- Block level sync in general was requests in the forum [here](https://forum.rclone.org/t/pcloud-block-level-sync/43455)\r\n- It helps fixing the the rate limit issues discussed [here](https://forum.rclone.org/t/how-to-handle-pcloud-rate-limit/31279/19):\r\n  - The described work around only helps when uploading multiple smaller files by increasing `--transfers`\r\n  - For single large files, I haven't found any workaround.\r\n  - Block level sync seems to be slightly faster, but the main point is: With this, we can resume failed uploads of large files (e.g. due to timeouts caused by rate limit)\r\n\r\n#### What is your current rclone version (output from `rclone version`)?\r\n\r\n- master\r\n\r\n#### What problem are you are trying to solve?\r\n\r\n- Implement object.SetModTime to reduce unecessary re-uploads on mtime mismatch\r\n  - This is an undocumented API feature (reverse-engineered), using server-side copy with same target, only changing metadata.\r\n  - This is necessary for block level support, otherwise uploaded files will have mtime from time of upload.\r\n- Implement new option `upload_chunk_size`\r\n  - Enables chunk-wise uploads of files.\r\n  - Successful uploaded chunks are skipped when upload needs retry, thanks to block-wise hashing capability.\r\n\r\nFocusing on the upload in this issue, block level download can easily be added in follow-up.\r\n\r\n---\r\n\r\ntl;dr\r\n\r\nUploading large files to pcloud using the uploadfile API is error prone, as any connection reset / package loss will cause the full file to be retried. \r\nAdditionally, I can see that pcloud applies some sort of rate limiting, causing large uploads to be throttled down. \r\n(Their \"support\" claims that there is no such rate limit and blames my ISP. But by increasing the `--transfers` with multiple files, I can multiply the throughput by amount of transfers until I reach my ISPs upload lim. Also 32kbps is such a round number, I doubt that its coincidence.)\r\n\r\nIn my case, this renders it almost impossible to upload any file larger than ~200MB via rclone.\r\n\r\nFortunately, pcloud offers a [fileops API](https://docs.pcloud.com/methods/fileops/), which enables chunked uploads on block level üéâ\r\nPR #7895  adds an advanced option `upload_chunk_size` to the pcloud backend.\r\nWhen set, files will be uploaded in chunks using the fileops API. Otherwise, current behavior is used (backwards compatibility).\r\n\r\n#### How do you think rclone should be changed to solve that?\r\n\r\nI created a draft PR #7895 that implements it. \r\nFeature is drafty, but works on my machine :). Before I invest more time in writing tests and documentation, I'd appreciate a first review, whether the feature itself / the way I built it goes into the right direction.\r\n\r\n<!--- Please keep the note below for others who read your feature request. -->\r\n\r\n#### How to use GitHub\r\n\r\n* Please use the üëç [reaction](https://blog.github.com/2016-03-10-add-reactions-to-pull-requests-issues-and-comments/) to show that you are affected by the same issue.\r\n* Please don't comment if you have no relevant information to add. It's just extra noise for everyone subscribed to this issue.\r\n* Subscribe to receive notifications on status change and new comments.\r\n","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/7896/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/7896/timeline","performed_via_github_app":null,"state_reason":"completed"}