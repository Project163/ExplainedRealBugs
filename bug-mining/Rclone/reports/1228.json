{"url":"https://api.github.com/repos/rclone/rclone/issues/5676","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/5676/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/5676/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/5676/events","html_url":"https://github.com/rclone/rclone/issues/5676","id":1021201169,"node_id":"I_kwDOAQ-n5M483ksR","number":5676,"title":"bisync: handle volatile changes consistently","user":{"login":"ivandeex","id":9028053,"node_id":"MDQ6VXNlcjkwMjgwNTM=","avatar_url":"https://avatars.githubusercontent.com/u/9028053?v=4","gravatar_id":"","url":"https://api.github.com/users/ivandeex","html_url":"https://github.com/ivandeex","followers_url":"https://api.github.com/users/ivandeex/followers","following_url":"https://api.github.com/users/ivandeex/following{/other_user}","gists_url":"https://api.github.com/users/ivandeex/gists{/gist_id}","starred_url":"https://api.github.com/users/ivandeex/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivandeex/subscriptions","organizations_url":"https://api.github.com/users/ivandeex/orgs","repos_url":"https://api.github.com/users/ivandeex/repos","events_url":"https://api.github.com/users/ivandeex/events{/privacy}","received_events_url":"https://api.github.com/users/ivandeex/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":431089529,"node_id":"MDU6TGFiZWw0MzEwODk1Mjk=","url":"https://api.github.com/repos/rclone/rclone/labels/IMPORTANT","name":"IMPORTANT","color":"d93f0b","default":false,"description":null},{"id":3427818774,"node_id":"LA_kwDOAQ-n5M7MUF0W","url":"https://api.github.com/repos/rclone/rclone/labels/bisync","name":"bisync","color":"1D76DB","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"ivandeex","id":9028053,"node_id":"MDQ6VXNlcjkwMjgwNTM=","avatar_url":"https://avatars.githubusercontent.com/u/9028053?v=4","gravatar_id":"","url":"https://api.github.com/users/ivandeex","html_url":"https://github.com/ivandeex","followers_url":"https://api.github.com/users/ivandeex/followers","following_url":"https://api.github.com/users/ivandeex/following{/other_user}","gists_url":"https://api.github.com/users/ivandeex/gists{/gist_id}","starred_url":"https://api.github.com/users/ivandeex/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivandeex/subscriptions","organizations_url":"https://api.github.com/users/ivandeex/orgs","repos_url":"https://api.github.com/users/ivandeex/repos","events_url":"https://api.github.com/users/ivandeex/events{/privacy}","received_events_url":"https://api.github.com/users/ivandeex/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"ivandeex","id":9028053,"node_id":"MDQ6VXNlcjkwMjgwNTM=","avatar_url":"https://avatars.githubusercontent.com/u/9028053?v=4","gravatar_id":"","url":"https://api.github.com/users/ivandeex","html_url":"https://github.com/ivandeex","followers_url":"https://api.github.com/users/ivandeex/followers","following_url":"https://api.github.com/users/ivandeex/following{/other_user}","gists_url":"https://api.github.com/users/ivandeex/gists{/gist_id}","starred_url":"https://api.github.com/users/ivandeex/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivandeex/subscriptions","organizations_url":"https://api.github.com/users/ivandeex/orgs","repos_url":"https://api.github.com/users/ivandeex/repos","events_url":"https://api.github.com/users/ivandeex/events{/privacy}","received_events_url":"https://api.github.com/users/ivandeex/received_events","type":"User","user_view_type":"public","site_admin":false},{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/11","html_url":"https://github.com/rclone/rclone/milestone/11","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/11/labels","id":1480382,"node_id":"MDk6TWlsZXN0b25lMTQ4MDM4Mg==","number":11,"title":"Soon","description":"Issues which are a good idea but haven't been assigned a specific release yet.","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":75,"closed_issues":94,"state":"open","created_at":"2016-01-02T12:56:46Z","updated_at":"2025-10-12T21:14:16Z","due_on":null,"closed_at":null},"comments":1,"created_at":"2021-10-08T15:08:10Z","updated_at":"2024-01-20T19:50:11Z","closed_at":"2024-01-20T19:50:11Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Synopsis\r\n\r\nThis problem can be also title `recover after transient failures`.\r\n\r\n@cjnaz once wrote in https://github.com/rclone/rclone/pull/5164#issuecomment-843406665\r\n\r\nOne perpetual problem I ran into was with a dynamically changing file system.  rclonesync is not robust for the case of a file no longer there after the current LSL snapshot was taken.  Also, if a file is being written to / blocked when rclonesync wants to copy it.  In such cases rclonesync throws up its hands and forces user interaction via a `--resync`.\r\n\r\n## Prior discussions\r\n\r\nRelated to https://github.com/cjnaz/rclonesync-V2/issues/56\r\nRelated to #1316\r\n\r\n### https://github.com/rclone/rclone/pull/5164#issuecomment-843426747 (JWink3101)\r\n\r\nI agree with these issues of sorts. This isn't new in rclone either. If you change the filesystem while it is running, things can break. For my tool, I [enumated what would happen](https://github.com/Jwink3101/syncrclone/blob/master/docs/misc.md#interruptions) if it is interrupted. Something similar happens if a file changes.\r\n\r\nBut again, this is the beauty of the not-using-history-to-make-a-changelog approach (\\#2). You only need history to figure out what to do!. So if a file was  added between the lsl, it will still copy.\r\n\r\n### https://github.com/rclone/rclone/pull/5164#issuecomment-843460561 (ivandeex)\r\n\r\nPretty close to #840 (recheck source during operation, open)\r\nRelated to #3770 (_.partial_ file support in LocalFS / FTP / SFTP, which can be _filtered out_ by bisync)\r\n\r\nCovered by postponed item \"Use temporary files with FTP, SFTP\"\r\nI guess it will change nothing in bisync but improve FTP/SFTP and only add related tests to bisync.\r\n\r\n### https://github.com/rclone/rclone/pull/5164#issuecomment-843851607 (ivandeex)\r\n\r\n@cjnaz\r\n\r\n> \r\n> > rclonesync is not robust for the case of a file no longer there after the current LSL snapshot was taken.\r\n\r\nSuch files should be just **skipped** (by default or under a command-line flag) similar to https://github.com/rclone/rclone/pull/5297#pullrequestreview-649944326\r\n\r\n> \r\n> > Also, if a file is being written to / blocked when rclonesync wants to copy it.  In such cases rclonesync throws up its hands and forces user interaction via a --first-sync.\r\n>\r\n> Pretty close to #840 (recheck source during operation, open)\r\n> Related to #3770 (_.partial_ file support in LocalFS / FTP / SFTP, which can be _filtered out_ by bisync)\r\n\r\nI think rclonesync approach is right. If bisync detects a mutating file, it should abort operation or just skip the file (depending on a flag e.g. `--force`), then request a resync **and recommend adding this file to a filter.**\r\n\r\n### https://github.com/rclone/rclone/pull/5164#issuecomment-844237183 (cjnaz)\r\n\r\nOne critical design feature / flaw / weakness of rclonesync is that at the\r\nend of the operation the two paths, and thus the two LSL files must match.\r\nIf not, then the sync has failed and a --first-sync is forced.  So if an\r\nindividual file can't be copied then there is no recovery other than a\r\n--first-sync.  In the future this will be something to be fixed - so that\r\ntransient out-of-sync can be recovered from.  Perhaps track mismatches and\r\nretry in the next run?\r\n\r\n## How to use GitHub\r\n\r\n* Please use the üëç [reaction](https://blog.github.com/2016-03-10-add-reactions-to-pull-requests-issues-and-comments/) to show that you are affected by the same issue.\r\n* Please don't comment if you have no relevant information to add. It's just extra noise for everyone subscribed to this issue.\r\n* Subscribe to receive notifications on status change and new comments.\r\n","closed_by":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/5676/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/5676/timeline","performed_via_github_app":null,"state_reason":"completed"}