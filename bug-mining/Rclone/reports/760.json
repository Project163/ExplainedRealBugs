{"url":"https://api.github.com/repos/rclone/rclone/issues/3445","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/3445/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/3445/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/3445/events","html_url":"https://github.com/rclone/rclone/issues/3445","id":481056988,"node_id":"MDU6SXNzdWU0ODEwNTY5ODg=","number":3445,"title":"FTP:  multi thread copies hang when server is pure-ftpd","user":{"login":"berniegp","id":881558,"node_id":"MDQ6VXNlcjg4MTU1OA==","avatar_url":"https://avatars.githubusercontent.com/u/881558?v=4","gravatar_id":"","url":"https://api.github.com/users/berniegp","html_url":"https://github.com/berniegp","followers_url":"https://api.github.com/users/berniegp/followers","following_url":"https://api.github.com/users/berniegp/following{/other_user}","gists_url":"https://api.github.com/users/berniegp/gists{/gist_id}","starred_url":"https://api.github.com/users/berniegp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/berniegp/subscriptions","organizations_url":"https://api.github.com/users/berniegp/orgs","repos_url":"https://api.github.com/users/berniegp/repos","events_url":"https://api.github.com/users/berniegp/events{/privacy}","received_events_url":"https://api.github.com/users/berniegp/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":608259284,"node_id":"MDU6TGFiZWw2MDgyNTkyODQ=","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20FTP","name":"Remote: FTP","color":"fbca04","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/39","html_url":"https://github.com/rclone/rclone/milestone/39","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/39/labels","id":4787007,"node_id":"MDk6TWlsZXN0b25lNDc4NzAwNw==","number":39,"title":"v1.52","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":35,"state":"closed","created_at":"2019-10-26T17:18:37Z","updated_at":"2020-05-29T14:52:38Z","due_on":"2020-03-14T07:00:00Z","closed_at":"2020-05-29T14:52:38Z"},"comments":14,"created_at":"2019-08-15T08:52:14Z","updated_at":"2020-03-04T12:17:39Z","closed_at":"2020-03-01T09:18:25Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### What is the problem you are having with rclone?\r\nrclone hangs when copying from an ftp remote to a local directory.\r\n\r\nI can see the transfer rate steadily doing down and the ETA going up. No bytes are transferred after the reported error and the command must be killed with ^C.\r\n\r\nIt looks like rclone is choking on status messages from the ftp server (3.969 seconds (measured here), 63.77 Mbytes per second).\r\n\r\n#### What is your rclone version (output from `rclone version`)\r\n```\r\nrclone v1.48.0-191-g712f7e38-beta\r\n- os/arch: linux/amd64\r\n- go version: go1.12.8\r\n```\r\n\r\n#### Which OS you are using and how many bits (eg Windows 7, 64 bit)\r\nUbuntu server 18.04LTS 64 bit\r\n\r\n####  Which cloud storage system are you using? (eg Google Drive)\r\nFTP\r\n\r\n\r\n#### The command you were trying to run (eg `rclone copy /tmp remote:tmp`)\r\nrclone copy ftp_backup:borg /srv/backups/data/backup-repo --progress\r\n\r\n\r\n#### A log from the command with the `-vv` flag (eg output from `rclone -vv copy /tmp remote:tmp`)\r\n```\r\n2019/08/15 08:34:15 DEBUG : rclone: Version \"v1.48.0-191-g712f7e38-beta\" starting with parameters [\"rclone\" \"copy\" \"ftp_backup:borg\" \"/srv/backups/data/back]\r\n2019/08/15 08:34:15 DEBUG : Using config file from \"/root/.config/rclone/rclone.conf\"\r\n2019/08/15 08:34:15 DEBUG : ftp://ftp.redacted.net:21/borg: Connecting to FTP server\r\n2019-08-15 08:34:15 INFO  : README: Copied (new)\r\n2019-08-15 08:34:15 INFO  : hints.156: Copied (new)\r\n2019-08-15 08:34:15 INFO  : config: Copied (new)\r\n2019-08-15 08:34:15 INFO  : index.156: Copied (new)\r\n2019-08-15 08:34:15 INFO  : integrity.156: Copied (new)\r\n2019-08-15 08:34:15 INFO  : lock.roster: Copied (new)\r\n2019-08-15 08:34:15 INFO  : nonce: Copied (new)\r\n2019-08-15 08:34:15 INFO  : lock.exclusive/redacted.server.com@181140264486654.30488-0: Copied (new)\r\n2019-08-15 08:34:15 INFO  : Local file system at /srv/backups/data/backup-repo: Waiting for checks to finish\r\n2019-08-15 08:34:15 INFO  : Local file system at /srv/backups/data/backup-repo: Waiting for transfers to finish\r\n2019-08-15 08:34:15 INFO  : data/0/1: Copied (new)\r\n2019-08-15 08:34:15 DEBUG : data/0/100: Starting multi-thread copy with 2 parts of size 250.500M\r\n2019-08-15 08:34:15 DEBUG : data/0/10: Starting multi-thread copy with 2 parts of size 251.188M\r\n2019-08-15 08:34:15 DEBUG : data/0/101: Starting multi-thread copy with 2 parts of size 250.125M\r\n2019-08-15 08:34:15 DEBUG : data/0/102: Starting multi-thread copy with 2 parts of size 250.125M\r\n2019-08-15 08:34:15 DEBUG : data/0/100: multi-thread copy: stream 1/2 (0-262668288) size 250.500M starting\r\n2019-08-15 08:34:15 DEBUG : data/0/100: multi-thread copy: stream 2/2 (262668288-525279867) size 250.446M starting\r\n2019-08-15 08:34:15 DEBUG : data/0/10: multi-thread copy: stream 1/2 (0-263389184) size 251.188M starting\r\n2019-08-15 08:34:15 DEBUG : data/0/10: multi-thread copy: stream 2/2 (263389184-526659407) size 251.074M starting\r\n2019-08-15 08:34:15 DEBUG : data/0/101: multi-thread copy: stream 1/2 (0-262275072) size 250.125M starting\r\n2019-08-15 08:34:15 DEBUG : data/0/101: multi-thread copy: stream 2/2 (262275072-524447128) size 250.027M starting\r\n2019-08-15 08:34:15 DEBUG : data/0/102: multi-thread copy: stream 1/2 (0-262275072) size 250.125M starting\r\n2019-08-15 08:34:15 DEBUG : data/0/102: multi-thread copy: stream 2/2 (262275072-524446376) size 250.026M starting\r\n2019-08-15 08:34:19 DEBUG : data/0/100: multi-thread copy: stream 1/2 (0-262668288) size 250.500M finished\r\n2019-08-15 08:34:19 DEBUG : data/0/100: multi-thread copy: stream 1/2 failed: 150 3.969 seconds (measured here), 63.77 Mbytes per second\r\nTransferred:      253.002M / 59.451 GBytes, 0%, 6.529 MBytes/s, ETA 2h34m44s\r\nErrors:                 0\r\nChecks:                 0 / 0, -\r\nTransferred:            9 / 152, 6%\r\nElapsed time:       38.7s\r\nTransferring:\r\n *                                     data/0/10:  0% /502.262M, 0/s, -\r\n *                                    data/0/100: 50% /500.946M, 12.900M/s, 19s\r\n *                                    data/0/101:  0% /500.152M, 0/s, -\r\n *                                    data/0/102:  0% /500.151M, 0/s, -\r\n```\r\n\r\n#### Remote config\r\n```\r\n[ftp_backup]\r\ntype = ftp\r\nhost = ftp.redacted.net\r\nuser = user.redacted\r\npass = password.redacted\r\nconcurrency = 1\r\n```\r\n\r\n#### Appendix\r\nThis is what I get from an ftp session downloading a file\r\n```\r\n$ ftp ftp.redacted.net\r\nConnected to ftp.redacted.net.\r\n220-#########################################\r\n220-#                                       #\r\n220-#  Welcome on ftp.redacted.net          #\r\n220-#########################################\r\n220 This is a private system - No anonymous login\r\nName (ftp.redacted.net:user): user.redacted\r\n331 User user.redacted OK. Password required\r\nPassword:\r\n230-OK. Current directory is /\r\n230 79949946 Kbytes used (15%) - authorized: 524185600 Kb\r\nRemote system type is UNIX.\r\nUsing binary mode to transfer files.\r\nftp> cd borg/data/0\r\n250 OK. Current directory is /borg/data/0\r\nftp> get 100\r\nlocal: 100 remote: 100\r\n200 PORT command successful\r\n150-Connecting to port 43755\r\n150 512968.6 kbytes to download\r\n226-File successfully transferred\r\n226 4.705 seconds (measured here), 106.48 Mbytes per second\r\n525279867 bytes received in 4.72 secs (106.2328 MB/s)\r\n```","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/3445/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/3445/timeline","performed_via_github_app":null,"state_reason":"completed"}