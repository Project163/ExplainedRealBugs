{"url":"https://api.github.com/repos/rclone/rclone/issues/7109","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/7109/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/7109/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/7109/events","html_url":"https://github.com/rclone/rclone/issues/7109","id":1784850598,"node_id":"I_kwDOAQ-n5M5qYqim","number":7109,"title":"webdav: nextcloud: rclone incorrectly retries long server-side chunks merge operations before they complete","user":{"login":"devnoname120","id":2824100,"node_id":"MDQ6VXNlcjI4MjQxMDA=","avatar_url":"https://avatars.githubusercontent.com/u/2824100?v=4","gravatar_id":"","url":"https://api.github.com/users/devnoname120","html_url":"https://github.com/devnoname120","followers_url":"https://api.github.com/users/devnoname120/followers","following_url":"https://api.github.com/users/devnoname120/following{/other_user}","gists_url":"https://api.github.com/users/devnoname120/gists{/gist_id}","starred_url":"https://api.github.com/users/devnoname120/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/devnoname120/subscriptions","organizations_url":"https://api.github.com/users/devnoname120/orgs","repos_url":"https://api.github.com/users/devnoname120/repos","events_url":"https://api.github.com/users/devnoname120/events{/privacy}","received_events_url":"https://api.github.com/users/devnoname120/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":795993695,"node_id":"MDU6TGFiZWw3OTU5OTM2OTU=","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20WebDAV","name":"Remote: WebDAV","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/57","html_url":"https://github.com/rclone/rclone/milestone/57","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/57/labels","id":11258698,"node_id":"MI_kwDOAQ-n5M4Aq8tK","number":57,"title":"v1.69","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":1,"closed_issues":23,"state":"closed","created_at":"2024-07-01T16:37:57Z","updated_at":"2025-05-27T14:40:10Z","due_on":"2025-01-12T08:00:00Z","closed_at":"2025-01-13T10:54:46Z"},"comments":32,"created_at":"2023-07-02T20:51:10Z","updated_at":"2024-10-22T20:13:29Z","closed_at":"2024-09-17T15:47:45Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### What is the problem you are having with rclone?\r\n\r\nUploading very large files (e.g. 20 GB) always fails because rclone keeps restarting the transfer while the server is still under the process of merging the chunks together.\r\n\r\n\r\n#### What is your rclone version?\r\n```\r\n‚ùØ rclone --version\r\nrclone v1.63.0\r\n- os/version: darwin 13.3.1 (64 bit)\r\n- os/kernel: 22.4.0 (arm64)\r\n- os/type: darwin\r\n- os/arch: arm64 (ARMv8 compatible)\r\n- go/version: go1.20.5\r\n- go/linking: dynamic\r\n- go/tags: none\r\n```\r\n\r\n\r\n#### Which OS you are using and how many bits?\r\n\r\n```\r\n‚ùØ neofetch\r\n                    'c.          paul@Pauls-Air\r\n                 ,xNMM.          --------------\r\n               .OMMMMo           OS: macOS 13.3.1 22E261 arm64\r\n               OMMM0,            Host: MacBookAir10,1\r\n     .;loddo:' loolloddol;.      Kernel: 22.4.0\r\n   cKMMMMMMMMMMNWMMMMMMMMMM0:    Uptime: 12 hours, 32 mins\r\n .KMMMMMMMMMMMMMMMMMMMMMMMWd.    Packages: 331 (brew)\r\n XMMMMMMMMMMMMMMMMMMMMMMMX.      Shell: zsh 5.9\r\n;MMMMMMMMMMMMMMMMMMMMMMMM:       Resolution: 1920x1080\r\n:MMMMMMMMMMMMMMMMMMMMMMMM:       DE: Aqua\r\n.MMMMMMMMMMMMMMMMMMMMMMMMX.      WM: yabai\r\n kMMMMMMMMMMMMMMMMMMMMMMMMWd.    Terminal: iTerm2\r\n .XMMMMMMMMMMMMMMMMMMMMMMMMMMk   Terminal Font: MesloLGS-NF-Regular 13\r\n  .XMMMMMMMMMMMMMMMMMMMMMMMMK.   CPU: Apple M1\r\n    kMMMMMMMMMMMMMMMMMMMMMMd     GPU: Apple M1\r\n     ;KMMMMMMMWXXWMMMMMMMk.      Memory: 2991MiB / 16384MiB\r\n       .cooc,.    .,coo:.\r\n```\r\n\r\n\r\n#### Which cloud storage system are you using?\r\n\r\nWebDAV (NextCloud)\r\n\r\n\r\n#### The command you were trying to run?\r\n\r\n```\r\nrclone copy verybigfile.bin nextcloud:\r\n```\r\n\r\n\r\n#### A log from the command with the `-vv` flag\r\n\r\nMy NextCloud instance is running out of storage so unfortunately I'm not able to provide such a log. It has been a long-standing issue though.\r\n\r\n@ncw I remember looking into it a very long time ago.\r\n- For long operations, the HTTP `MOVE` request for merging chunks eventually times out (but the merge is actually still in progress).\r\n- When trying to merge again then NextCloud returns a `LOCKED` error which I [tried to ignore](https://github.com/rclone/rclone/blob/2234feb23d1f9c50e94ad1c5b2d854282748cc03/backend/webdav/chunking.go#L30-L33).\r\n- `rclone` seems to somehow figure out that the file isn't actually there, deletes the chunks, reuploads them, and tries to merge them again.\r\n- Rinse and repeat.\r\n\r\nThere is [no API to check whether the `MOVE` operation is still in progress or not](https://github.com/nextcloud/server/issues/28395). The only way I know of is to check if it's still in progress is to [retry the `MOVE` until we don't receive a `LOCKED` error any longer](https://github.com/rclone/rclone/pull/6133#issuecomment-1184336893).\r\n\r\nIf I recall correctly, this workaround didn't work out: rclone eventually restarted the transfer anyway. Maybe rclone has some kind of mechanism to force retry \"staled\" transfers even if the backend asks it to wait?\r\n\r\nüëâ Would there be a way to work around this NextCloud limitation?\r\n\r\n<!--- Please keep the note below for others who read your bug report. -->\r\n\r\n#### How to use GitHub\r\n\r\n* Please use the üëç [reaction](https://blog.github.com/2016-03-10-add-reactions-to-pull-requests-issues-and-comments/) to show that you are affected by the same issue.\r\n* Please don't comment if you have no relevant information to add. It's just extra noise for everyone subscribed to this issue.\r\n* Subscribe to receive notifications on status change and new comments.\r\n","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/7109/reactions","total_count":3,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/7109/timeline","performed_via_github_app":null,"state_reason":"completed"}