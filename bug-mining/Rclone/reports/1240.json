{"url":"https://api.github.com/repos/rclone/rclone/issues/7471","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/7471/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/7471/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/7471/events","html_url":"https://github.com/rclone/rclone/issues/7471","id":2017631523,"node_id":"I_kwDOAQ-n5M54Qp0j","number":7471,"title":"bisync: auto-resolve conflicts","user":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399007,"node_id":"MDU6TGFiZWw4NjM5OTAwNw==","url":"https://api.github.com/repos/rclone/rclone/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null},{"id":2504903272,"node_id":"MDU6TGFiZWwyNTA0OTAzMjcy","url":"https://api.github.com/repos/rclone/rclone/labels/configuration","name":"configuration","color":"8ccedb","default":false,"description":""},{"id":2533004918,"node_id":"MDU6TGFiZWwyNTMzMDA0OTE4","url":"https://api.github.com/repos/rclone/rclone/labels/change%20detection","name":"change detection","color":"54d3cf","default":false,"description":""},{"id":3427818774,"node_id":"LA_kwDOAQ-n5M7MUF0W","url":"https://api.github.com/repos/rclone/rclone/labels/bisync","name":"bisync","color":"1D76DB","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/11","html_url":"https://github.com/rclone/rclone/milestone/11","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/11/labels","id":1480382,"node_id":"MDk6TWlsZXN0b25lMTQ4MDM4Mg==","number":11,"title":"Soon","description":"Issues which are a good idea but haven't been assigned a specific release yet.","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":75,"closed_issues":94,"state":"open","created_at":"2016-01-02T12:56:46Z","updated_at":"2025-10-12T21:14:16Z","due_on":null,"closed_at":null},"comments":12,"created_at":"2023-11-29T23:59:56Z","updated_at":"2024-01-20T22:17:04Z","closed_at":"2024-01-20T22:17:03Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"This is a proposal for a new bisync feature to optionally auto-resolve sync conflicts (and customize bisync's change detection behavior more generally), inspired in part by discussions with @crocinsocks on #7332 and #5681.\r\n\r\n### What problem are you are trying to solve?\r\nCurrently, when a file is new/changed on both paths (relative to the prior sync), and the versions on each side are not identical, bisync will keep both versions, renaming them with `..path1` and `..path2` suffixes, respectively. Many users have requested more control over how bisync handles such conflicts -- including an option to automatically select one version as the \"winner\" and rename or delete the \"loser\".\r\n\r\nSimilarly, users have requested more control over how conflicting files are handled during `--resync`. Currently the `path1` version prevails by default, but users have requested options to automatically select the winner based on characteristics such as `newer`, `older`, `larger`, and `smaller`.\r\n\r\nSome users have additionally requested the ability to use the above-described auto-resolve features _as an alternative to needing `--resync` at all._ In other words, in an error scenario where bisync would otherwise demand a manual `--resync` to recover, this option would tell bisync to **automatically** run a `--resync` and auto-resolve any conflicts according to the rules described above. Such an option would maximize resilience at the possible expense of perfection (for example, [deleted files could occasionally re-appear](https://github.com/rclone/rclone/issues/5681#:~:text=Bidirectional%20sync%20can,has%20suddenly%20reappeared%3F).) Because bisync takes an approach of \"safe by default\", such an option would be disabled by default, but made available to advanced users via a new flag.\r\n\r\n### How do you think rclone should be changed to solve that?\r\n\r\nI propose the following new options:\r\n```\r\n--auto-resolve CHOICE     Automatically resolve conflicts by preferring the version that is: \r\n                            newer | older | larger | smaller | path1 | path2 (default: none)\r\n--conflict-loser CHOICE   When --auto-resolve selects a winner, do this to the loser:\r\n                            delete | num | pathname (default: num)\r\n``` \r\nFor example, suppose there is a sync conflict of `file` and the version on Path1 is newer.\r\n\r\n- With `--auto-resolve newer`, `path2/file` is renamed to `path2/file..conflict1` (or, if that already exists, `path2/file..conflict2`, etc.) and copied to path1, and `path1/file` is copied to path2 (without renaming).\r\n- If `--conflict-loser pathname` is added, path2 version is renamed to `path2/file..path2` instead of `path2/file..conflict1` (overwriting any `path2/file..path2` that already exists.)\r\n- If `--conflict-loser delete` is added, path2 version is deleted instead of renamed.\r\n\r\nOptions specific to `--resync`:\r\n```\r\n--resync-prefer OPTION    During --resync only, prefer the version that is: newer | older | larger | smaller | path1 | path2 (default: path1)\r\n--auto-resync             If set, automatically run --resync to recover after critical errors. WARNING: only use if you are SURE you know what you are doing! (default: false)\r\n--max-lock DURATION       Consider lock files older than this to be \"expired\" (default: 1d if --auto-resync=true, otherwise 0 (never expire))\r\n```\r\n`--resync-prefer` and `--auto-resync` can be used together, and either one can also be used without the other.\r\n\r\n`--max-lock` is a compromise necessary to balance `--auto-resync` with [lock files](https://rclone.org/bisync/#lock-file). Otherwise, if `--auto-resync` always respected lock files, a single interrupted run would break `--auto-resync` forever. But if `--auto-resync` always _ignored_ lock files, it could start resyncing while a prior non-resync is still running. The implementation of `--max-lock` could possibly include a mechanism for alive runs to renew themselves periodically, to determine with more certainty whether a lock file was left by an interrupted run or one that is still running, just taking awhile.\r\n\r\nNote that the `newer` and `older` options require modtime support for both paths, and will be ignored if either remote lacks modtimes (or if the user has requested to ignore them with [`--checksum`](https://github.com/rclone/rclone/issues/5683) or [`--size-only`](https://github.com/rclone/rclone/issues/5684).) \r\n\r\nAn open question is what should happen when a winner can't be determined by the requested method. For example: `--auto-resolve newer` where the sizes differ but modtimes are identical. Probably the easiest would be to revert to the current behavior (keep both, do `..path1` / `..path2` rename), but I am open to other ideas!\r\n\r\n### Further thoughts\r\n\r\nBisync users tend to fall into one of two camps:\r\n\r\n- User A demands perfection every time. If Bisync is ever unsure of what to do, User A would prefer that Bisync stop and ask for help rather than take its best guess and continue.\r\n- User B wants to \"set it and forget it\", and values resilience above perfection. Often this user is syncing something like a movie collection which could be easily re-downloaded from the internet or backups if necessary, so total perfection isn't required, and sync conflicts may not be worth the time to resolve. User B prefers that Bisync take its best guess and continue, rather than stopping to bother them every time it has a question, or worse -- refusing to run again until it gets an answer.\r\n\r\nBisync in its current form is a great fit for User A, and likely to cause a bit of frustration to User B. The features discussed above are aimed at making both camps happy -- it is User A's way by default, but User B can make it behave their way by adding flags.\r\n\r\nFellow bisync users, feel free to comment here with any thoughts on the above! I'd love to consider any and all feedback before developing a proof-of-concept (which I hope to do shortly.)\r\n<!--- Please keep the note below for others who read your feature request. -->\r\n\r\n### How to use GitHub\r\n\r\n* Please use the üëç [reaction](https://blog.github.com/2016-03-10-add-reactions-to-pull-requests-issues-and-comments/) to show that you are affected by the same issue.\r\n* Please don't comment if you have no relevant information to add. It's just extra noise for everyone subscribed to this issue.\r\n* Subscribe to receive notifications on status change and new comments.\r\n","closed_by":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/7471/reactions","total_count":4,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/7471/timeline","performed_via_github_app":null,"state_reason":"completed"}