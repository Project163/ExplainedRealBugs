{"url":"https://api.github.com/repos/rclone/rclone/issues/6920","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/6920/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/6920/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/6920/events","html_url":"https://github.com/rclone/rclone/issues/6920","id":1655742105,"node_id":"I_kwDOAQ-n5M5isJ6Z","number":6920,"title":"Google Photos: max concurrent write request 429 RESOURCE_EXHAUSTED","user":{"login":"sahilnarain","id":3143331,"node_id":"MDQ6VXNlcjMxNDMzMzE=","avatar_url":"https://avatars.githubusercontent.com/u/3143331?v=4","gravatar_id":"","url":"https://api.github.com/users/sahilnarain","html_url":"https://github.com/sahilnarain","followers_url":"https://api.github.com/users/sahilnarain/followers","following_url":"https://api.github.com/users/sahilnarain/following{/other_user}","gists_url":"https://api.github.com/users/sahilnarain/gists{/gist_id}","starred_url":"https://api.github.com/users/sahilnarain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sahilnarain/subscriptions","organizations_url":"https://api.github.com/users/sahilnarain/orgs","repos_url":"https://api.github.com/users/sahilnarain/repos","events_url":"https://api.github.com/users/sahilnarain/events{/privacy}","received_events_url":"https://api.github.com/users/sahilnarain/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2023-04-05T14:30:13Z","updated_at":"2024-12-06T19:33:53Z","closed_at":"2023-10-03T17:06:30Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### Output of `rclone version`\r\nrclone v1.61.1\r\n- os/version: oracle 9.1 (64 bit)\r\n- os/kernel: 5.15.0-7.86.6.1.el9uek.aarch64 (aarch64)\r\n- os/type: linux\r\n- os/arch: arm64\r\n- go/version: go1.19.4\r\n- go/linking: static\r\n- go/tags: none\r\n\r\n\r\n#### Describe the issue\r\n   Google Photos backend hits the write quota, even though very small amounts of files are being written.\r\n\r\n   Google Photos backend hits write quota, both with the default and my own Google Photo Library client IDs. I have tried reducing the `tpslimit` to an unreasonably low amount (~=0.05 which means, 1 transaction every 20 seconds) but that gets rate limited very soon. I am only able to upload a small amount of photos before being rate limited.\r\n\r\n    rclone move $file gphotos:album/$album/ --transfers 1 --checkers 1 --no-check-dest --low-level-retries 1 --retries 2 --tpslimit 0.05 -vvP\r\n\r\nSample output:\r\n```\r\n...\r\n2023-04-05 13:47:24 DEBUG : pacer: low level retry 1/1 (error Quota exceeded for quota 'concurrent write request' of service 'photoslibrary.googleapis.com'. (429 RESOURCE_EXHAUSTED))\r\n2023-04-05 13:47:24 DEBUG : pacer: Rate limited, increasing sleep to 1.258731557s\r\n2023-04-05 13:47:24 DEBUG : test.jpeg : >Update: err=failed to create media item: Quota exceeded for quota 'concurrent write request' of service 'photoslibrary.googleapis.com'. (429 RESOURCE_EXHAUSTED)\r\n2023-04-05 13:47:24 DEBUG : Google Photos path \"album/test-album\": >Put:\r\n2023-04-05 13:47:24 ERROR : test.jpeg : Failed to copy: failed to create media item: Quota exceeded for quota 'concurrent write request' of service 'photoslibrary.googleapis.com'. (429 RESOURCE_EXHAUSTED)\r\n2023-04-05 13:47:24 ERROR : test.jpeg : Not deleting source as copy failed: failed to create media item: Quota exceeded for quota 'concurrent write request' of service 'photoslibrary.googleapis.com'. (429 RESOURCE_EXHAUSTED)\r\n...\r\n```\r\n\r\nThis _could_ possibly mean that the write handle is not being closed properly, causing this to max out soon, after which I wait for a couple of hours before the rate limit gets lifted.\r\n\r\nWhat's interesting is that no quotas are being hit on the API that I can see in my cloud console while using my own client ID. However, the 429 errors are for ```BatchCreateMediaItems``` method only.\r\n\r\nPlease reach out If I can provide any additional information, and if someone can guide me in the right direction, I can try taking a shot at fixing this too.\r\n\r\nThanks in advance!\r\n\r\n","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/6920/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/6920/timeline","performed_via_github_app":null,"state_reason":"completed"}