{"url":"https://api.github.com/repos/rclone/rclone/issues/3278","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/3278/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/3278/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/3278/events","html_url":"https://github.com/rclone/rclone/issues/3278","id":458299441,"node_id":"MDU6SXNzdWU0NTgyOTk0NDE=","number":3278,"title":"Implement --compare-dest & --copy-dest from rsync","user":{"login":"yparitcher","id":38916402,"node_id":"MDQ6VXNlcjM4OTE2NDAy","avatar_url":"https://avatars.githubusercontent.com/u/38916402?v=4","gravatar_id":"","url":"https://api.github.com/users/yparitcher","html_url":"https://github.com/yparitcher","followers_url":"https://api.github.com/users/yparitcher/followers","following_url":"https://api.github.com/users/yparitcher/following{/other_user}","gists_url":"https://api.github.com/users/yparitcher/gists{/gist_id}","starred_url":"https://api.github.com/users/yparitcher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yparitcher/subscriptions","organizations_url":"https://api.github.com/users/yparitcher/orgs","repos_url":"https://api.github.com/users/yparitcher/repos","events_url":"https://api.github.com/users/yparitcher/events{/privacy}","received_events_url":"https://api.github.com/users/yparitcher/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399007,"node_id":"MDU6TGFiZWw4NjM5OTAwNw==","url":"https://api.github.com/repos/rclone/rclone/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/13","html_url":"https://github.com/rclone/rclone/milestone/13","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/13/labels","id":1575401,"node_id":"MDk6TWlsZXN0b25lMTU3NTQwMQ==","number":13,"title":"Help Wanted","description":"Enhancements which might be useful, but currently aren't planned.\r\n\r\nAny help doing these much appreciated.","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":228,"closed_issues":302,"state":"open","created_at":"2016-02-10T17:44:20Z","updated_at":"2025-11-04T14:55:57Z","due_on":null,"closed_at":null},"comments":1,"created_at":"2019-06-20T02:04:36Z","updated_at":"2019-07-22T18:42:40Z","closed_at":"2019-07-22T18:42:39Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n\r\nWelcome :-)\r\n\r\nSo you've got an idea to improve rclone? We love that! You'll be glad to hear we've incorporated hundreds of ideas from contributors already.\r\n\r\nHere is a checklist of things to do:\r\n\r\n  1. Please search the old issues first for your idea and +1 or comment on an existing issue if possible.\r\n  2. Discuss on the forum first: https://forum.rclone.org/\r\n  3. Make a feature request issue (this is the right place!).\r\n  4. Be prepared to get involved making the feature :-)\r\n\r\nLooking forward to your great idea!\r\n\r\nThe Rclone Developers\r\n\r\n-->\r\n\r\n\r\n#### What is your current rclone version (output from `rclone version`)?\r\n```\r\nrclone v1.48.0\r\n- os/arch: linux/amd64\r\n- go version: go1.12.5\r\n```\r\n\r\n\r\n#### What problem are you are trying to solve?\r\n\r\ni would like to implement rsync's --compare-dest & --copy-dest flags to complement the existing --backup-dir to help with incremental backup strategies \r\n\r\nfrom the rsync man page:\r\n```\r\n--compare-dest=DIR\r\n    This option instructs rsync to use DIR on the destination machine as an \r\nadditional hierarchy to compare destination files against doing transfers \r\n(if the files are missing in the destination directory). If a file is found in \r\nDIR that is identical to the sender's file, the file will NOT be transferred \r\nto the destination directory. This is useful for creating a sparse backup of \r\njust files that have changed from an earlier backup. \r\n\r\n--copy-dest=DIR\r\n    This option behaves like --compare-dest, but rsync will also copy unchanged \r\nfiles found in DIR to the destination directory using a local copy. This is useful \r\nfor doing transfers to a new destination while leaving existing files intact, and \r\nthen doing a flash-cutover when all files have been successfully transferred. \r\n```\r\n#### How do you think rclone should be changed to solve that?\r\n\r\nI would add the appropriate flags in fs/config/configflags/configflags.go & fs/config.go\r\n\r\nthen implement a check here in `NeedTransfer` on the compare dir to either return false or do a server side copy\r\nhttps://github.com/ncw/rclone/blob/71a19a1972a7c1d85f966e199b1677379105834b/fs/operations/operations.go#L1399-L1406\r\nadd tests in fs/sync/sync_test.go & docs\r\n\r\nplease let me know if that is good and i will submit a pull request","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/3278/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/3278/timeline","performed_via_github_app":null,"state_reason":"completed"}