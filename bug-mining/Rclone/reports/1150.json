{"url":"https://api.github.com/repos/rclone/rclone/issues/6273","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/6273/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/6273/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/6273/events","html_url":"https://github.com/rclone/rclone/issues/6273","id":1280114072,"node_id":"I_kwDOAQ-n5M5MTP2Y","number":6273,"title":"Add staticcheck to build pipeline","user":{"login":"albertony","id":12441419,"node_id":"MDQ6VXNlcjEyNDQxNDE5","avatar_url":"https://avatars.githubusercontent.com/u/12441419?v=4","gravatar_id":"","url":"https://api.github.com/users/albertony","html_url":"https://github.com/albertony","followers_url":"https://api.github.com/users/albertony/followers","following_url":"https://api.github.com/users/albertony/following{/other_user}","gists_url":"https://api.github.com/users/albertony/gists{/gist_id}","starred_url":"https://api.github.com/users/albertony/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertony/subscriptions","organizations_url":"https://api.github.com/users/albertony/orgs","repos_url":"https://api.github.com/users/albertony/repos","events_url":"https://api.github.com/users/albertony/events{/privacy}","received_events_url":"https://api.github.com/users/albertony/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2330137373,"node_id":"MDU6TGFiZWwyMzMwMTM3Mzcz","url":"https://api.github.com/repos/rclone/rclone/labels/build","name":"build","color":"5319e7","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/50","html_url":"https://github.com/rclone/rclone/milestone/50","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/50/labels","id":8720373,"node_id":"MI_kwDOAQ-n5M4AhQ_1","number":50,"title":"v1.62","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":6,"state":"closed","created_at":"2022-12-05T11:11:19Z","updated_at":"2023-05-09T17:05:53Z","due_on":"2023-03-14T07:00:00Z","closed_at":"2023-05-09T17:05:53Z"},"comments":4,"created_at":"2022-06-22T13:05:56Z","updated_at":"2023-03-26T12:28:19Z","closed_at":"2023-03-26T12:28:18Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### What problem are you are trying to solve?\r\n\r\nAdd [staticcheck](<https://staticcheck.io>) based linting to the build pipeline. Maybe as an advisory to start with.\r\n\r\nStaticcheck is the default linter in VSCode-based golang dev environment, and from my experience it gives many relevant suggestions that the current linter does not consider.\r\n\r\nFirst we need to fix as many as possible of the reported \"problems\", and if necessary add ignores of any false positives or suggestions we for other reasons don't agree with (and then decide on the best strategy for managing such ignores, see https://staticcheck.io/docs/configuration/#ignoring-problems). I've started going through them myself, fixing in different PRs:\r\n- https://github.com/rclone/rclone/pull/6228\r\n- https://github.com/rclone/rclone/pull/6239\r\n- https://github.com/rclone/rclone/pull/6238\r\n- https://github.com/rclone/rclone/pull/6236\r\n- https://github.com/rclone/rclone/pull/6237\r\n- https://github.com/rclone/rclone/pull/6275\r\n- https://github.com/rclone/rclone/pull/6276\r\n- https://github.com/rclone/rclone/pull/6277\r\n- https://github.com/rclone/rclone/pull/6389 (New: Deprecations starting with go 1.16, detected after minimum was raised to go 1.17)\r\n- https://github.com/rclone/rclone/pull/6387 (New)\r\n\r\nWhen I started it reported about 300 \"problems\", if/when all these are merged we are down to below 30 (with staticcheck v0.3.2 and go v1.18.3). Remaining includes:\r\n- func is unused (13 occurrences)\r\n- httplib is deprecated and has been replaced with lib/http (8 occurrences)\r\n- infinite recursive call, here: https://github.com/rclone/rclone/blob/73e3bb09d71c31814e00ebcad2eec9be3b74ccf0/fs/pacer.go#L76\r\n- argument err is overwritten before first use, here: https://github.com/rclone/rclone/blob/73e3bb09d71c31814e00ebcad2eec9be3b74ccf0/backend/onedrive/onedrive.go#L1670\r\n- argument should be pointer-like to avoid allocations, here: https://github.com/rclone/rclone/blob/73e3bb09d71c31814e00ebcad2eec9be3b74ccf0/backend/crypt/cipher.go#L242\r\n\r\n#### How do you think rclone should be changed to solve that?\r\n\r\nSee the mentioned PRs in general, and this: https://github.com/rclone/rclone/pull/6228#issuecomment-1154869610\r\n\r\nWe should probably try with `golangci-lint` (<https://golangci-lint.run/usage/quick-start>) first, instead of `staticcheck` directly, since we already are using it.  It does have a staticcheck linter (<https://golangci-lint.run/usage/linters/>), which we can add to our list:\r\n\r\nhttps://github.com/rclone/rclone/blob/fdd2f8e6d21d1cf95b33fd2bb09f9c1caef0069d/.golangci.yml#L3-L15\r\n\r\nThough its not the actual staticcheck, so must be tested and compared first:\r\n\r\n> It's a set of rules from staticcheck. It's not the same thing as the staticcheck binary. The author of staticcheck doesn't support or approve the use of staticcheck as a library inside golangci-lint.\r\n\r\nWould be good if the standalone staticcheck, which is also run from go integration in VSCode, do not produce different results.\r\n\r\n<!--- Please keep the note below for others who read your feature request. -->\r\n\r\n#### How to use GitHub\r\n\r\n* Please use the üëç [reaction](https://blog.github.com/2016-03-10-add-reactions-to-pull-requests-issues-and-comments/) to show that you are affected by the same issue.\r\n* Please don't comment if you have no relevant information to add. It's just extra noise for everyone subscribed to this issue.\r\n* Subscribe to receive notifications on status change and new comments.\r\n","closed_by":{"login":"albertony","id":12441419,"node_id":"MDQ6VXNlcjEyNDQxNDE5","avatar_url":"https://avatars.githubusercontent.com/u/12441419?v=4","gravatar_id":"","url":"https://api.github.com/users/albertony","html_url":"https://github.com/albertony","followers_url":"https://api.github.com/users/albertony/followers","following_url":"https://api.github.com/users/albertony/following{/other_user}","gists_url":"https://api.github.com/users/albertony/gists{/gist_id}","starred_url":"https://api.github.com/users/albertony/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertony/subscriptions","organizations_url":"https://api.github.com/users/albertony/orgs","repos_url":"https://api.github.com/users/albertony/repos","events_url":"https://api.github.com/users/albertony/events{/privacy}","received_events_url":"https://api.github.com/users/albertony/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/6273/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/6273/timeline","performed_via_github_app":null,"state_reason":"completed"}