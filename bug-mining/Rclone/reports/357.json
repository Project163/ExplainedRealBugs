{"url":"https://api.github.com/repos/rclone/rclone/issues/1477","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/1477/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/1477/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/1477/events","html_url":"https://github.com/rclone/rclone/issues/1477","id":235095431,"node_id":"MDU6SXNzdWUyMzUwOTU0MzE=","number":1477,"title":"Investigate not normalising file names and normalising them in the sync routine instead","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":252555516,"node_id":"MDU6TGFiZWwyNTI1NTU1MTY=","url":"https://api.github.com/repos/rclone/rclone/labels/maintenance","name":"maintenance","color":"5319e7","default":false,"description":null},{"id":431089529,"node_id":"MDU6TGFiZWw0MzEwODk1Mjk=","url":"https://api.github.com/repos/rclone/rclone/labels/IMPORTANT","name":"IMPORTANT","color":"d93f0b","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/25","html_url":"https://github.com/rclone/rclone/milestone/25","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/25/labels","id":2395138,"node_id":"MDk6TWlsZXN0b25lMjM5NTEzOA==","number":25,"title":"v1.38","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":53,"state":"closed","created_at":"2017-03-18T12:00:38Z","updated_at":"2018-05-22T10:35:24Z","due_on":"2017-09-30T07:00:00Z","closed_at":"2017-09-30T13:33:53Z"},"comments":2,"created_at":"2017-06-11T22:08:58Z","updated_at":"2017-09-16T18:51:59Z","closed_at":"2017-09-16T18:51:59Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Investigate this: I'm beginning to think I've made a mistake normalizing the file names, what I should be doing is normalizing them in the sync routine when rclone is comparing source and destination directory, rather than normalizing them all the time.\r\n\r\nNormalizing the file names causes issues with other tools which don't (it doesn't seem to be the expected way of doing things).\r\n\r\nOriginally from #1472\r\n\r\nSee also #1515 for normalization problems when using a single file copy (and thus --files-from and all the other filters...)\r\n\r\nNote from #62 \r\n\r\n> One other thing I noticed regarding the drive code, is for directories ending in one or more spaces. The Google Drive Windows App will replace the ending spaces with \"_\", because Windows doesn't like directories ending in blank spaces. For Linux, it doesn't matter.\r\n\r\nIt occurs to me that the filename matching code should transform the input strings using the OS transformation before comparison. so if either src or remote is local on windows, it should transform the input into the Windows safe version before doing the comparison.\r\n\r\nLikewise if one of the remotes is case insensitive then it should transform everything into lower case (checking for case folded matches).\r\n\r\nWould also need to convert the check routine to use this framework.\r\n\r\nSo the pipeline of filename transformations might look like\r\n\r\n  * -> normalize unicode\r\n  * -> lower case (if dst is case insensitive, or possibly if src | dst case insensitive for bidirectional goodness)\r\n  * -> make Windows safe\r\n\r\nAnd then do the name comparisons in `matchListings`\r\n\r\nCould have an optional transform function for each Fs which does lossy translation of unacceptable characters.  Local would do the Windows transforms on windows.  Others might get rid of control characters (or perhaps there should be a default one which does that).  Fses would then use their Transform function when writing objects.\r\n\r\nNeed to think carefully about\r\n\r\n  * copyto/moveto\r\n  * filters - especially single file copies\r\n\r\n**Update** after a bit of testing with `rclone info` there are no remotes which complain about denormalized UTF-8.  There are some (eg onedrive, dropbox) which will read denormalized UTF-8 or normalized UTF-8.\r\n\r\nHave two types of transform, one for comparison purposes and one for writing the file purposes.  Perhaps these are identical except for the case insensitivity.\r\n","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/1477/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/1477/timeline","performed_via_github_app":null,"state_reason":"completed"}