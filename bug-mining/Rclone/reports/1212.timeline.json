[{"id":10542119060,"node_id":"LE_lADOAQ-n5M5ytOa8zwAAAAJ0W_iU","url":"https://api.github.com/repos/rclone/rclone/issues/events/10542119060","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-10-03T18:48:29Z","label":{"name":"enhancement","color":"84b6eb"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1745569642","html_url":"https://github.com/rclone/rclone/issues/7350#issuecomment-1745569642","issue_url":"https://api.github.com/repos/rclone/rclone/issues/7350","id":1745569642,"node_id":"IC_kwDOAQ-n5M5oC0dq","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-03T19:13:19Z","updated_at":"2023-10-03T19:13:19Z","body":"I see 3 possible buffering schemes\r\n\r\n1. `RAM`: Buffer in RAM like we have at the moment\r\n2. `Disk`: Buffer on disk as suggested here\r\n3. `None`: Don't buffer, but re-read from the source if necessary.\r\n\r\nThe `b2` backend only rewinds the stream if there is a retry. Retries are rare, so we could use scheme `None` when uploading to `b2`. (We need a backend feature to identify this, or maybe a parameter in the chunking protocol.)\r\n\r\nIf we are using `local` as a source we could also use `None` for all backends as buffering to disk doesn't seem sensible when the file is on disk anyway.\r\n\r\nExactly which scheme gets used is up for discussion, but here is my suggestion\r\n\r\n| Source backend | Destination backend| High Memory | Low Memory |\r\n| --- | --- | --- | --- |\r\n| local | any | NoneÂ¹ | None |\r\n| any | local | NoneÂ² | None |\r\n| any | b2 | None | None |\r\n| any | s3/azureblob/oos | RAM | Disk |\r\n\r\nÂ¹ Needs performance testing to see if it slows stuff down a lot! Might need to be RAM\r\n\r\nÂ² It works like this at the moment as the local backend never needs retries.\r\n\r\nImplementing the `None` scheme requires extending `operations.Open` to into a `ReadSeeker`. This isn't a lot of work.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1745569642/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10584715345,"node_id":"REFE_lADOAQ-n5M5ytOa8zwAAAAJ25fBR","url":"https://api.github.com/repos/rclone/rclone/issues/events/10584715345","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"f4e2ae30a8ca2f55260afbe23f227a738e6186b1","commit_url":"https://api.github.com/repos/rclone/rclone/commits/f4e2ae30a8ca2f55260afbe23f227a738e6186b1","created_at":"2023-10-08T17:13:20Z","performed_via_github_app":null},{"id":10584715346,"node_id":"REFE_lADOAQ-n5M5ytOa8zwAAAAJ25fBS","url":"https://api.github.com/repos/rclone/rclone/issues/events/10584715346","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"87aa029f5f4d319090827ffb89508008c69f5095","commit_url":"https://api.github.com/repos/rclone/rclone/commits/87aa029f5f4d319090827ffb89508008c69f5095","created_at":"2023-10-08T17:13:20Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1752108969","html_url":"https://github.com/rclone/rclone/issues/7350#issuecomment-1752108969","issue_url":"https://api.github.com/repos/rclone/rclone/issues/7350","id":1752108969,"node_id":"IC_kwDOAQ-n5M5obw-p","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-08T17:15:55Z","updated_at":"2023-10-08T17:15:55Z","body":"I had a go at this in the \"High Memory\" case above. Most transfers (which are to and from disk)  won't need to use buffering any more which is a big win.\r\n\r\n@maxim can you give this a test and see what you think?\r\n\r\n[v1.65.0-beta.7413.87aa029f5.fix-7350-multithread-memory](https://beta.rclone.org/branch/fix-7350-multithread-memory/v1.65.0-beta.7413.87aa029f5.fix-7350-multithread-memory/) on branch [fix-7350-multithread-memory](https://github.com/rclone/rclone/tree/fix-7350-multithread-memory) (uploaded in 15-30 mins)","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1752108969/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10584724292,"node_id":"MEE_lADOAQ-n5M5ytOa8zwAAAAJ25hNE","url":"https://api.github.com/repos/rclone/rclone/issues/events/10584724292","actor":{"login":"maxim","id":7758,"node_id":"MDQ6VXNlcjc3NTg=","avatar_url":"https://avatars.githubusercontent.com/u/7758?v=4","gravatar_id":"","url":"https://api.github.com/users/maxim","html_url":"https://github.com/maxim","followers_url":"https://api.github.com/users/maxim/followers","following_url":"https://api.github.com/users/maxim/following{/other_user}","gists_url":"https://api.github.com/users/maxim/gists{/gist_id}","starred_url":"https://api.github.com/users/maxim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxim/subscriptions","organizations_url":"https://api.github.com/users/maxim/orgs","repos_url":"https://api.github.com/users/maxim/repos","events_url":"https://api.github.com/users/maxim/events{/privacy}","received_events_url":"https://api.github.com/users/maxim/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-10-08T17:15:55Z","performed_via_github_app":null},{"id":10584724297,"node_id":"SE_lADOAQ-n5M5ytOa8zwAAAAJ25hNJ","url":"https://api.github.com/repos/rclone/rclone/issues/events/10584724297","actor":{"login":"maxim","id":7758,"node_id":"MDQ6VXNlcjc3NTg=","avatar_url":"https://avatars.githubusercontent.com/u/7758?v=4","gravatar_id":"","url":"https://api.github.com/users/maxim","html_url":"https://github.com/maxim","followers_url":"https://api.github.com/users/maxim/followers","following_url":"https://api.github.com/users/maxim/following{/other_user}","gists_url":"https://api.github.com/users/maxim/gists{/gist_id}","starred_url":"https://api.github.com/users/maxim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxim/subscriptions","organizations_url":"https://api.github.com/users/maxim/orgs","repos_url":"https://api.github.com/users/maxim/repos","events_url":"https://api.github.com/users/maxim/events{/privacy}","received_events_url":"https://api.github.com/users/maxim/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-10-08T17:15:55Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1752112691","html_url":"https://github.com/rclone/rclone/issues/7350#issuecomment-1752112691","issue_url":"https://api.github.com/repos/rclone/rclone/issues/7350","id":1752112691,"node_id":"IC_kwDOAQ-n5M5obx4z","user":{"login":"maxim","id":7758,"node_id":"MDQ6VXNlcjc3NTg=","avatar_url":"https://avatars.githubusercontent.com/u/7758?v=4","gravatar_id":"","url":"https://api.github.com/users/maxim","html_url":"https://github.com/maxim","followers_url":"https://api.github.com/users/maxim/followers","following_url":"https://api.github.com/users/maxim/following{/other_user}","gists_url":"https://api.github.com/users/maxim/gists{/gist_id}","starred_url":"https://api.github.com/users/maxim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxim/subscriptions","organizations_url":"https://api.github.com/users/maxim/orgs","repos_url":"https://api.github.com/users/maxim/repos","events_url":"https://api.github.com/users/maxim/events{/privacy}","received_events_url":"https://api.github.com/users/maxim/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-08T17:31:12Z","updated_at":"2023-10-08T17:31:12Z","body":"@ncw Looks like a great win in a small change! To try this, I have questions on what I should reconfigure:\r\n\r\n1. What is the new RAM usage math for B2 uploads? (Values such as `--b2-upload-concurrency`, `--b2-chunk-size`, `--transfers`, `--multi-thread-streams`).\r\n2. What is the new math for B2 downloads? (Values such as `--buffer-size`, `--transfers`, `--multi-thread-streams`)\r\n3. Do you know if reconfiguring will invalidate my vfs full cache again (the canonical name) and how to avoid that?","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1752112691/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"maxim","id":7758,"node_id":"MDQ6VXNlcjc3NTg=","avatar_url":"https://avatars.githubusercontent.com/u/7758?v=4","gravatar_id":"","url":"https://api.github.com/users/maxim","html_url":"https://github.com/maxim","followers_url":"https://api.github.com/users/maxim/followers","following_url":"https://api.github.com/users/maxim/following{/other_user}","gists_url":"https://api.github.com/users/maxim/gists{/gist_id}","starred_url":"https://api.github.com/users/maxim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxim/subscriptions","organizations_url":"https://api.github.com/users/maxim/orgs","repos_url":"https://api.github.com/users/maxim/repos","events_url":"https://api.github.com/users/maxim/events{/privacy}","received_events_url":"https://api.github.com/users/maxim/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10584782815,"node_id":"MEE_lADOAQ-n5M5ytOa8zwAAAAJ25vff","url":"https://api.github.com/repos/rclone/rclone/issues/events/10584782815","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-10-08T17:31:12Z","performed_via_github_app":null},{"id":10584782819,"node_id":"SE_lADOAQ-n5M5ytOa8zwAAAAJ25vfj","url":"https://api.github.com/repos/rclone/rclone/issues/events/10584782819","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-10-08T17:31:12Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1752166340","html_url":"https://github.com/rclone/rclone/issues/7350#issuecomment-1752166340","issue_url":"https://api.github.com/repos/rclone/rclone/issues/7350","id":1752166340,"node_id":"IC_kwDOAQ-n5M5ob-_E","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-08T21:27:03Z","updated_at":"2023-10-08T21:27:03Z","body":"> @ncw Looks like a great win in a small change! To try this, I have questions on what I should reconfigure:\r\n> \r\n> 1. What is the new RAM usage math for B2 uploads? (Values such as `--b2-upload-concurrency`, `--b2-chunk-size`, `--transfers`, `--multi-thread-streams`).\r\n\r\n\r\nUploads from local disk to B2 shouldn't use significantly extra ram whatever the parameters.\r\n\r\n\r\n> 2. What is the new math for B2 downloads? (Values such as `--buffer-size`, `--transfers`, `--multi-thread-streams`)\r\n\r\nDownloads will use --buffer-size * --transfers\r\n\r\n> 3. Do you know if reconfiguring will invalidate my vfs full cache again (the canonical name) and how to avoid that?\r\n\r\nPut any B2 config changes in the config file, not on the command line and it won't change the canonical name.\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1752166340/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10585476229,"node_id":"MEE_lADOAQ-n5M5ytOa8zwAAAAJ28YyF","url":"https://api.github.com/repos/rclone/rclone/issues/events/10585476229","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-10-08T21:27:04Z","performed_via_github_app":null},{"id":10585476233,"node_id":"SE_lADOAQ-n5M5ytOa8zwAAAAJ28YyJ","url":"https://api.github.com/repos/rclone/rclone/issues/events/10585476233","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-10-08T21:27:04Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1752294796","html_url":"https://github.com/rclone/rclone/issues/7350#issuecomment-1752294796","issue_url":"https://api.github.com/repos/rclone/rclone/issues/7350","id":1752294796,"node_id":"IC_kwDOAQ-n5M5oceWM","user":{"login":"maxim","id":7758,"node_id":"MDQ6VXNlcjc3NTg=","avatar_url":"https://avatars.githubusercontent.com/u/7758?v=4","gravatar_id":"","url":"https://api.github.com/users/maxim","html_url":"https://github.com/maxim","followers_url":"https://api.github.com/users/maxim/followers","following_url":"https://api.github.com/users/maxim/following{/other_user}","gists_url":"https://api.github.com/users/maxim/gists{/gist_id}","starred_url":"https://api.github.com/users/maxim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxim/subscriptions","organizations_url":"https://api.github.com/users/maxim/orgs","repos_url":"https://api.github.com/users/maxim/repos","events_url":"https://api.github.com/users/maxim/events{/privacy}","received_events_url":"https://api.github.com/users/maxim/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-09T03:23:16Z","updated_at":"2023-10-09T03:23:16Z","body":"Thanks for clarifications. I installed this branch without changing config for now. Will have to wait and see as more uploads take place.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1752294796/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"maxim","id":7758,"node_id":"MDQ6VXNlcjc3NTg=","avatar_url":"https://avatars.githubusercontent.com/u/7758?v=4","gravatar_id":"","url":"https://api.github.com/users/maxim","html_url":"https://github.com/maxim","followers_url":"https://api.github.com/users/maxim/followers","following_url":"https://api.github.com/users/maxim/following{/other_user}","gists_url":"https://api.github.com/users/maxim/gists{/gist_id}","starred_url":"https://api.github.com/users/maxim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxim/subscriptions","organizations_url":"https://api.github.com/users/maxim/orgs","repos_url":"https://api.github.com/users/maxim/repos","events_url":"https://api.github.com/users/maxim/events{/privacy}","received_events_url":"https://api.github.com/users/maxim/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1753253162","html_url":"https://github.com/rclone/rclone/issues/7350#issuecomment-1753253162","issue_url":"https://api.github.com/repos/rclone/rclone/issues/7350","id":1753253162,"node_id":"IC_kwDOAQ-n5M5ogIUq","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-09T15:44:42Z","updated_at":"2023-10-09T15:44:42Z","body":"Let me know what happens!","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1753253162/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1759613176","html_url":"https://github.com/rclone/rclone/issues/7350#issuecomment-1759613176","issue_url":"https://api.github.com/repos/rclone/rclone/issues/7350","id":1759613176,"node_id":"IC_kwDOAQ-n5M5o4ZD4","user":{"login":"maxim","id":7758,"node_id":"MDQ6VXNlcjc3NTg=","avatar_url":"https://avatars.githubusercontent.com/u/7758?v=4","gravatar_id":"","url":"https://api.github.com/users/maxim","html_url":"https://github.com/maxim","followers_url":"https://api.github.com/users/maxim/followers","following_url":"https://api.github.com/users/maxim/following{/other_user}","gists_url":"https://api.github.com/users/maxim/gists{/gist_id}","starred_url":"https://api.github.com/users/maxim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxim/subscriptions","organizations_url":"https://api.github.com/users/maxim/orgs","repos_url":"https://api.github.com/users/maxim/repos","events_url":"https://api.github.com/users/maxim/events{/privacy}","received_events_url":"https://api.github.com/users/maxim/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-12T13:27:22Z","updated_at":"2023-10-12T13:27:22Z","body":"@ncw After 3 days of running, which included downloads and uploads, rclone seems to have been sitting at <50mb of RAM, even according to `systemctl status` (which tends to show the highest RAM ever reached, or something like that). It appears so far that this is working!\r\n\r\nWe could wait until I observe RAM directly during an upload. I think I caught it once, and it was still under 50mb, but not 100% sure. Would have to catch it one of these days. It has definitely uploaded stuff over 3 days, but I just haven't observed _as it was happening_.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1759613176/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"maxim","id":7758,"node_id":"MDQ6VXNlcjc3NTg=","avatar_url":"https://avatars.githubusercontent.com/u/7758?v=4","gravatar_id":"","url":"https://api.github.com/users/maxim","html_url":"https://github.com/maxim","followers_url":"https://api.github.com/users/maxim/followers","following_url":"https://api.github.com/users/maxim/following{/other_user}","gists_url":"https://api.github.com/users/maxim/gists{/gist_id}","starred_url":"https://api.github.com/users/maxim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxim/subscriptions","organizations_url":"https://api.github.com/users/maxim/orgs","repos_url":"https://api.github.com/users/maxim/repos","events_url":"https://api.github.com/users/maxim/events{/privacy}","received_events_url":"https://api.github.com/users/maxim/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10631650259,"node_id":"MEE_lADOAQ-n5M5ytOa8zwAAAAJ5shvT","url":"https://api.github.com/repos/rclone/rclone/issues/events/10631650259","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-10-12T13:27:22Z","performed_via_github_app":null},{"id":10631650269,"node_id":"SE_lADOAQ-n5M5ytOa8zwAAAAJ5shvd","url":"https://api.github.com/repos/rclone/rclone/issues/events/10631650269","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-10-12T13:27:23Z","performed_via_github_app":null},{"actor":{"login":"maxim","id":7758,"node_id":"MDQ6VXNlcjc3NTg=","avatar_url":"https://avatars.githubusercontent.com/u/7758?v=4","gravatar_id":"","url":"https://api.github.com/users/maxim","html_url":"https://github.com/maxim","followers_url":"https://api.github.com/users/maxim/followers","following_url":"https://api.github.com/users/maxim/following{/other_user}","gists_url":"https://api.github.com/users/maxim/gists{/gist_id}","starred_url":"https://api.github.com/users/maxim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxim/subscriptions","organizations_url":"https://api.github.com/users/maxim/orgs","repos_url":"https://api.github.com/users/maxim/repos","events_url":"https://api.github.com/users/maxim/events{/privacy}","received_events_url":"https://api.github.com/users/maxim/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-12T16:00:29Z","updated_at":"2023-10-12T16:00:29Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rclone/rclone/issues/7364","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/7364/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/7364/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/7364/events","html_url":"https://github.com/rclone/rclone/issues/7364","id":1940307198,"node_id":"I_kwDOAQ-n5M5zprz-","number":7364,"title":"VFS cache for B2 is invalidated too easily","user":{"login":"maxim","id":7758,"node_id":"MDQ6VXNlcjc3NTg=","avatar_url":"https://avatars.githubusercontent.com/u/7758?v=4","gravatar_id":"","url":"https://api.github.com/users/maxim","html_url":"https://github.com/maxim","followers_url":"https://api.github.com/users/maxim/followers","following_url":"https://api.github.com/users/maxim/following{/other_user}","gists_url":"https://api.github.com/users/maxim/gists{/gist_id}","starred_url":"https://api.github.com/users/maxim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxim/subscriptions","organizations_url":"https://api.github.com/users/maxim/orgs","repos_url":"https://api.github.com/users/maxim/repos","events_url":"https://api.github.com/users/maxim/events{/privacy}","received_events_url":"https://api.github.com/users/maxim/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":306063207,"node_id":"MDU6TGFiZWwzMDYwNjMyMDc=","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20Backblaze%20B2","name":"Remote: Backblaze B2","color":"fbca04","default":false,"description":null},{"id":430778096,"node_id":"MDU6TGFiZWw0MzA3NzgwOTY=","url":"https://api.github.com/repos/rclone/rclone/labels/VFS%20/%20mount","name":"VFS / mount","color":"0e8a16","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2023-10-12T16:00:27Z","updated_at":"2025-01-13T17:34:58Z","closed_at":"2025-01-13T17:34:58Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":17803236,"node_id":"MDEwOlJlcG9zaXRvcnkxNzgwMzIzNg==","name":"rclone","full_name":"rclone/rclone","private":false,"owner":{"login":"rclone","id":24937341,"node_id":"MDEyOk9yZ2FuaXphdGlvbjI0OTM3MzQx","avatar_url":"https://avatars.githubusercontent.com/u/24937341?v=4","gravatar_id":"","url":"https://api.github.com/users/rclone","html_url":"https://github.com/rclone","followers_url":"https://api.github.com/users/rclone/followers","following_url":"https://api.github.com/users/rclone/following{/other_user}","gists_url":"https://api.github.com/users/rclone/gists{/gist_id}","starred_url":"https://api.github.com/users/rclone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rclone/subscriptions","organizations_url":"https://api.github.com/users/rclone/orgs","repos_url":"https://api.github.com/users/rclone/repos","events_url":"https://api.github.com/users/rclone/events{/privacy}","received_events_url":"https://api.github.com/users/rclone/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rclone/rclone","description":"\"rsync for cloud storage\" - Google Drive, S3, Dropbox, Backblaze B2, One Drive, Swift, Hubic, Wasabi, Google Cloud Storage, Azure Blob, Azure Files, Yandex Files","fork":false,"url":"https://api.github.com/repos/rclone/rclone","forks_url":"https://api.github.com/repos/rclone/rclone/forks","keys_url":"https://api.github.com/repos/rclone/rclone/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rclone/rclone/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rclone/rclone/teams","hooks_url":"https://api.github.com/repos/rclone/rclone/hooks","issue_events_url":"https://api.github.com/repos/rclone/rclone/issues/events{/number}","events_url":"https://api.github.com/repos/rclone/rclone/events","assignees_url":"https://api.github.com/repos/rclone/rclone/assignees{/user}","branches_url":"https://api.github.com/repos/rclone/rclone/branches{/branch}","tags_url":"https://api.github.com/repos/rclone/rclone/tags","blobs_url":"https://api.github.com/repos/rclone/rclone/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rclone/rclone/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rclone/rclone/git/refs{/sha}","trees_url":"https://api.github.com/repos/rclone/rclone/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rclone/rclone/statuses/{sha}","languages_url":"https://api.github.com/repos/rclone/rclone/languages","stargazers_url":"https://api.github.com/repos/rclone/rclone/stargazers","contributors_url":"https://api.github.com/repos/rclone/rclone/contributors","subscribers_url":"https://api.github.com/repos/rclone/rclone/subscribers","subscription_url":"https://api.github.com/repos/rclone/rclone/subscription","commits_url":"https://api.github.com/repos/rclone/rclone/commits{/sha}","git_commits_url":"https://api.github.com/repos/rclone/rclone/git/commits{/sha}","comments_url":"https://api.github.com/repos/rclone/rclone/comments{/number}","issue_comment_url":"https://api.github.com/repos/rclone/rclone/issues/comments{/number}","contents_url":"https://api.github.com/repos/rclone/rclone/contents/{+path}","compare_url":"https://api.github.com/repos/rclone/rclone/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rclone/rclone/merges","archive_url":"https://api.github.com/repos/rclone/rclone/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rclone/rclone/downloads","issues_url":"https://api.github.com/repos/rclone/rclone/issues{/number}","pulls_url":"https://api.github.com/repos/rclone/rclone/pulls{/number}","milestones_url":"https://api.github.com/repos/rclone/rclone/milestones{/number}","notifications_url":"https://api.github.com/repos/rclone/rclone/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rclone/rclone/labels{/name}","releases_url":"https://api.github.com/repos/rclone/rclone/releases{/id}","deployments_url":"https://api.github.com/repos/rclone/rclone/deployments","created_at":"2014-03-16T16:19:57Z","updated_at":"2025-11-09T20:38:02Z","pushed_at":"2025-11-08T21:33:38Z","git_url":"git://github.com/rclone/rclone.git","ssh_url":"git@github.com:rclone/rclone.git","clone_url":"https://github.com/rclone/rclone.git","svn_url":"https://github.com/rclone/rclone","homepage":"https://rclone.org","size":217990,"stargazers_count":53422,"watchers_count":53422,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":4767,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1169,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["azure-blob","azure-blob-storage","azure-files","backblaze-b2","cloud-storage","dropbox","encryption","ftp","fuse-filesystem","go","golang","google-cloud-storage","google-drive","onedrive","openstack-swift","rclone","s3","sftp","sync","webdav"],"visibility":"public","forks":4767,"open_issues":1169,"watchers":53422,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"#### The associated forum post URL from `https://forum.rclone.org`\r\n\r\nhttps://forum.rclone.org/t/multiple-cache-dir-subdirs-for-the-same-remote/42044/14\r\n\r\n#### What is the problem you are having with rclone?\r\n\r\nI run a B2 `--vfs-cache-mode full` mount. All mount settings are listed as command line arguments, because I prefer to keep rclone config file limited to just credentials.\r\n\r\nThen I needed to tune some settings on my mount, namely these:\r\n\r\n```\r\n--transfers\r\n--buffer-size\r\n--b2-upload-concurrency\r\n--multi-thread-streams\r\n```\r\n\r\nWhen I restarted the mount, rclone created a new cache directory because it generated a new B2 canonical name. This unfortunately invalidated the existing cache.\r\n\r\nSilently invalidating the cache leads to 3 problems:\r\n\r\n1. For large caches (in my case 1.4TB) this could lead to a lot of new network usage.\r\n2. Files that were written to cache and pending upload are now abandoned in the old cache. They will never upload.\r\n3. Since old cache doesn't go away, your disk will start filling up beyond the allotted cache size, and that's how you will probably notice that something's wrong.\r\n\r\n##### What to do?\r\n\r\nAccording to [ncw's comment](https://github.com/rclone/rclone/issues/7350#issuecomment-1752166340), this wouldn't happen if those settings were declared in the config file.\r\n\r\nBased on this, I propose 2 actions:\r\n\r\n1. Remove the distinction between settings provided in a config file, command line, or ENV. The only thing that should matter is _which_ settings invalidate cache (its name and value).\r\n2. Document which settings invalidate cache.\r\n\r\n#### What is your rclone version (output from `rclone version`)\r\n\r\n```\r\nrclone v1.65.0-beta.7413.87aa029f5.fix-7350-multithread-memory\r\n- os/version: ubuntu 22.04 (64 bit)\r\n- os/kernel: 5.15.0-86-generic (x86_64)\r\n- os/type: linux\r\n- os/arch: amd64\r\n- go/version: go1.21.1\r\n- go/linking: static\r\n- go/tags: none\r\n```\r\n\r\n#### Which OS you are using and how many bits (e.g. Windows 7, 64 bit)\r\n\r\nUbuntu 22.04.3 LTS, 64 bit\r\n\r\n#### Which cloud storage system are you using? (e.g. Google Drive)\r\n\r\nB2\r\n\r\n#### The command you were trying to run (e.g. `rclone copy /tmp remote:tmp`)\r\n\r\n```\r\n/usr/bin/rclone mount B2:Bucket/path /path/to/mount \\\r\n  --allow-other \\\r\n  --b2-chunk-size 50M \\\r\n  --b2-upload-concurrency 20 \\\r\n  --multi-thread-streams 20 \\\r\n  --b2-hard-delete \\\r\n  --buffer-size 50M \\\r\n  --bwlimit \"07:00,1M:off 23:45,off\" \\\r\n  --cache-dir /home/htpc/RCloneCache \\\r\n  --config /home/htpc/.config/rclone/rclone.conf \\\r\n  --dir-cache-time 87600h \\\r\n  --disable-http2 \\\r\n  --fast-list \\\r\n  --log-level DEBUG \\\r\n  --poll-interval 0 \\\r\n  --transfers 2 \\\r\n  --use-mmap \\\r\n  --vfs-cache-max-age 8760h \\\r\n  --vfs-cache-max-size 1400G \\\r\n  --vfs-cache-mode full \\\r\n  --vfs-write-back 15m \\\r\n  --vfs-read-ahead 200M \\\r\n  --vfs-read-chunk-size-limit 500M \\\r\n  --rc \\\r\n  --rc-no-auth\r\n```\r\n\r\n#### A log from the command with the `-vv` flag (e.g. output from `rclone -vv copy /tmp remote:tmp`)\r\n\r\n\r\n```\r\nSep 25 23:35:58 htpc rclone[164069]: INFO  : vfs cache: cleaned: objects 2011 (was 2011) in use 94, to upload 74, uploading 20, total size 63.731Gi (was 63.731Gi)\r\nSep 25 23:36:38 htpc systemd[1]: htpc-mount.service: Failed with result 'timeout'.\r\nSep 25 23:36:38 htpc systemd[1]: Stopped B2 HTPC Mount.\r\nSep 25 23:36:38 htpc systemd[1]: htpc-mount.service: Consumed 46min 3.574s CPU time.\r\nSep 25 23:37:16 htpc systemd[1]: Starting B2 HTPC Mount...\r\nSep 25 23:37:16 htpc rclone[252704]: INFO  : Starting bandwidth limiter at 1Mi:off Byte/s\r\nSep 25 23:37:16 htpc rclone[252704]: DEBUG : rclone: systemd logging support activated\r\nSep 25 23:37:16 htpc rclone[252704]: NOTICE: Serving remote control on http://127.0.0.1:5572/\r\nSep 25 23:37:16 htpc rclone[252704]: NOTICE: --fast-list does nothing on a mount\r\nSep 25 23:37:16 htpc rclone[252704]: DEBUG : Creating backend with remote \"B2:Bucket/path\"\r\nSep 25 23:37:16 htpc rclone[252704]: DEBUG : Using config file from \"/home/htpc/.config/rclone/rclone.conf\"\r\nSep 25 23:37:16 htpc rclone[252704]: DEBUG : B2: detected overridden config - adding \"{BBBBB}\" suffix to name\r\nSep 25 23:37:17 htpc rclone[252704]: DEBUG : Couldn't decode error response: EOF\r\nSep 25 23:37:17 htpc rclone[252704]: DEBUG : fs cache: renaming cache item \"B2:Bucket/path\" to be canonical \"B2{BBBBB}:Bucket/path\"\r\nSep 25 23:37:17 htpc rclone[252704]: DEBUG : vfs cache: root is \"/home/htpc/RCloneCache\"\r\nSep 25 23:37:17 htpc rclone[252704]: DEBUG : vfs cache: data root is \"/home/htpc/RCloneCache/vfs/B2{BBBBB}/Bucket/path\"\r\nSep 25 23:37:17 htpc rclone[252704]: DEBUG : vfs cache: metadata root is \"/home/htpc/RCloneCache/vfsMeta/B2{BBBBB}/Bucket/path\"\r\nSep 25 23:37:17 htpc rclone[252704]: DEBUG : Creating backend with remote \"/home/htpc/RCloneCache/vfs/B2{BBBBB}/Bucket/path\"\r\nSep 25 23:37:17 htpc rclone[252704]: DEBUG : Creating backend with remote \"/home/htpc/RCloneCache/vfsMeta/B2{BBBBB}/Bucket/path\"\r\n```\r\n\r\n`{BBBBB}` = 5 random characters.\r\n\r\n#### How to use GitHub\r\n\r\n* Please use the ðŸ‘ [reaction](https://blog.github.com/2016-03-10-add-reactions-to-pull-requests-issues-and-comments/) to show that you are affected by the same issue.\r\n* Please don't comment if you have no relevant information to add. It's just extra noise for everyone subscribed to this issue.\r\n* Subscribe to receive notifications on status change and new comments.\r\n","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/7364/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/7364/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":10855053997,"node_id":"MIE_lADOAQ-n5M5ytOa8zwAAAAKHAvqt","url":"https://api.github.com/repos/rclone/rclone/issues/events/10855053997","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2023-11-03T12:07:07Z","milestone":{"title":"v1.65"},"performed_via_github_app":null},{"id":11015113232,"node_id":"REFE_lADOAQ-n5M5ytOa8zwAAAAKQjUoQ","url":"https://api.github.com/repos/rclone/rclone/issues/events/11015113232","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"c0fb9ebfcea1c3337b9bf5081520403436efeb4f","commit_url":"https://api.github.com/repos/rclone/rclone/commits/c0fb9ebfcea1c3337b9bf5081520403436efeb4f","created_at":"2023-11-20T18:07:14Z","performed_via_github_app":null},{"id":11015113310,"node_id":"CE_lADOAQ-n5M5ytOa8zwAAAAKQjUpe","url":"https://api.github.com/repos/rclone/rclone/issues/events/11015113310","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"1f9a79ef09fe9f1720040073992f7dc06030cebf","commit_url":"https://api.github.com/repos/rclone/rclone/commits/1f9a79ef09fe9f1720040073992f7dc06030cebf","created_at":"2023-11-20T18:07:14Z","state_reason":null,"performed_via_github_app":null},{"id":11605291771,"node_id":"REFE_lADOAQ-n5M5ytOa8zwAAAAKzurL7","url":"https://api.github.com/repos/rclone/rclone/issues/events/11605291771","actor":{"login":"GerHobbelt","id":402462,"node_id":"MDQ6VXNlcjQwMjQ2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/402462?v=4","gravatar_id":"","url":"https://api.github.com/users/GerHobbelt","html_url":"https://github.com/GerHobbelt","followers_url":"https://api.github.com/users/GerHobbelt/followers","following_url":"https://api.github.com/users/GerHobbelt/following{/other_user}","gists_url":"https://api.github.com/users/GerHobbelt/gists{/gist_id}","starred_url":"https://api.github.com/users/GerHobbelt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GerHobbelt/subscriptions","organizations_url":"https://api.github.com/users/GerHobbelt/orgs","repos_url":"https://api.github.com/users/GerHobbelt/repos","events_url":"https://api.github.com/users/GerHobbelt/events{/privacy}","received_events_url":"https://api.github.com/users/GerHobbelt/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"1f9a79ef09fe9f1720040073992f7dc06030cebf","commit_url":"https://api.github.com/repos/GerHobbelt/rclone/commits/1f9a79ef09fe9f1720040073992f7dc06030cebf","created_at":"2024-01-26T06:09:43Z","performed_via_github_app":null},{"actor":{"login":"vitorog","id":1168448,"node_id":"MDQ6VXNlcjExNjg0NDg=","avatar_url":"https://avatars.githubusercontent.com/u/1168448?v=4","gravatar_id":"","url":"https://api.github.com/users/vitorog","html_url":"https://github.com/vitorog","followers_url":"https://api.github.com/users/vitorog/followers","following_url":"https://api.github.com/users/vitorog/following{/other_user}","gists_url":"https://api.github.com/users/vitorog/gists{/gist_id}","starred_url":"https://api.github.com/users/vitorog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vitorog/subscriptions","organizations_url":"https://api.github.com/users/vitorog/orgs","repos_url":"https://api.github.com/users/vitorog/repos","events_url":"https://api.github.com/users/vitorog/events{/privacy}","received_events_url":"https://api.github.com/users/vitorog/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-07-31T16:11:03Z","updated_at":"2025-07-31T16:11:03Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rclone/rclone/issues/8720","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/8720/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/8720/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/8720/events","html_url":"https://github.com/rclone/rclone/pull/8720","id":3281015958,"node_id":"PR_kwDOAQ-n5M6hkOta","number":8720,"title":"Increase copy speed by re-enabling buffering for multithreaded copies from local filesystems","user":{"login":"vitorog","id":1168448,"node_id":"MDQ6VXNlcjExNjg0NDg=","avatar_url":"https://avatars.githubusercontent.com/u/1168448?v=4","gravatar_id":"","url":"https://api.github.com/users/vitorog","html_url":"https://github.com/vitorog","followers_url":"https://api.github.com/users/vitorog/followers","following_url":"https://api.github.com/users/vitorog/following{/other_user}","gists_url":"https://api.github.com/users/vitorog/gists{/gist_id}","starred_url":"https://api.github.com/users/vitorog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vitorog/subscriptions","organizations_url":"https://api.github.com/users/vitorog/orgs","repos_url":"https://api.github.com/users/vitorog/repos","events_url":"https://api.github.com/users/vitorog/events{/privacy}","received_events_url":"https://api.github.com/users/vitorog/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":314138213,"node_id":"MDU6TGFiZWwzMTQxMzgyMTM=","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20S3","name":"Remote: S3","color":"fbca04","default":false,"description":null}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/60","html_url":"https://github.com/rclone/rclone/milestone/60","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/60/labels","id":13114399,"node_id":"MI_kwDOAQ-n5M4AyBwf","number":60,"title":"v1.72","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":14,"closed_issues":16,"state":"open","created_at":"2025-06-19T17:12:26Z","updated_at":"2025-11-04T12:09:49Z","due_on":"2025-11-21T08:00:00Z","closed_at":null},"comments":6,"created_at":"2025-07-31T16:11:02Z","updated_at":"2025-09-04T10:20:30Z","closed_at":null,"author_association":"NONE","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":17803236,"node_id":"MDEwOlJlcG9zaXRvcnkxNzgwMzIzNg==","name":"rclone","full_name":"rclone/rclone","private":false,"owner":{"login":"rclone","id":24937341,"node_id":"MDEyOk9yZ2FuaXphdGlvbjI0OTM3MzQx","avatar_url":"https://avatars.githubusercontent.com/u/24937341?v=4","gravatar_id":"","url":"https://api.github.com/users/rclone","html_url":"https://github.com/rclone","followers_url":"https://api.github.com/users/rclone/followers","following_url":"https://api.github.com/users/rclone/following{/other_user}","gists_url":"https://api.github.com/users/rclone/gists{/gist_id}","starred_url":"https://api.github.com/users/rclone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rclone/subscriptions","organizations_url":"https://api.github.com/users/rclone/orgs","repos_url":"https://api.github.com/users/rclone/repos","events_url":"https://api.github.com/users/rclone/events{/privacy}","received_events_url":"https://api.github.com/users/rclone/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rclone/rclone","description":"\"rsync for cloud storage\" - Google Drive, S3, Dropbox, Backblaze B2, One Drive, Swift, Hubic, Wasabi, Google Cloud Storage, Azure Blob, Azure Files, Yandex Files","fork":false,"url":"https://api.github.com/repos/rclone/rclone","forks_url":"https://api.github.com/repos/rclone/rclone/forks","keys_url":"https://api.github.com/repos/rclone/rclone/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rclone/rclone/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rclone/rclone/teams","hooks_url":"https://api.github.com/repos/rclone/rclone/hooks","issue_events_url":"https://api.github.com/repos/rclone/rclone/issues/events{/number}","events_url":"https://api.github.com/repos/rclone/rclone/events","assignees_url":"https://api.github.com/repos/rclone/rclone/assignees{/user}","branches_url":"https://api.github.com/repos/rclone/rclone/branches{/branch}","tags_url":"https://api.github.com/repos/rclone/rclone/tags","blobs_url":"https://api.github.com/repos/rclone/rclone/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rclone/rclone/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rclone/rclone/git/refs{/sha}","trees_url":"https://api.github.com/repos/rclone/rclone/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rclone/rclone/statuses/{sha}","languages_url":"https://api.github.com/repos/rclone/rclone/languages","stargazers_url":"https://api.github.com/repos/rclone/rclone/stargazers","contributors_url":"https://api.github.com/repos/rclone/rclone/contributors","subscribers_url":"https://api.github.com/repos/rclone/rclone/subscribers","subscription_url":"https://api.github.com/repos/rclone/rclone/subscription","commits_url":"https://api.github.com/repos/rclone/rclone/commits{/sha}","git_commits_url":"https://api.github.com/repos/rclone/rclone/git/commits{/sha}","comments_url":"https://api.github.com/repos/rclone/rclone/comments{/number}","issue_comment_url":"https://api.github.com/repos/rclone/rclone/issues/comments{/number}","contents_url":"https://api.github.com/repos/rclone/rclone/contents/{+path}","compare_url":"https://api.github.com/repos/rclone/rclone/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rclone/rclone/merges","archive_url":"https://api.github.com/repos/rclone/rclone/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rclone/rclone/downloads","issues_url":"https://api.github.com/repos/rclone/rclone/issues{/number}","pulls_url":"https://api.github.com/repos/rclone/rclone/pulls{/number}","milestones_url":"https://api.github.com/repos/rclone/rclone/milestones{/number}","notifications_url":"https://api.github.com/repos/rclone/rclone/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rclone/rclone/labels{/name}","releases_url":"https://api.github.com/repos/rclone/rclone/releases{/id}","deployments_url":"https://api.github.com/repos/rclone/rclone/deployments","created_at":"2014-03-16T16:19:57Z","updated_at":"2025-11-09T20:38:02Z","pushed_at":"2025-11-08T21:33:38Z","git_url":"git://github.com/rclone/rclone.git","ssh_url":"git@github.com:rclone/rclone.git","clone_url":"https://github.com/rclone/rclone.git","svn_url":"https://github.com/rclone/rclone","homepage":"https://rclone.org","size":217990,"stargazers_count":53422,"watchers_count":53422,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":4767,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1169,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["azure-blob","azure-blob-storage","azure-files","backblaze-b2","cloud-storage","dropbox","encryption","ftp","fuse-filesystem","go","golang","google-cloud-storage","google-drive","onedrive","openstack-swift","rclone","s3","sftp","sync","webdav"],"visibility":"public","forks":4767,"open_issues":1169,"watchers":53422,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/rclone/rclone/pulls/8720","html_url":"https://github.com/rclone/rclone/pull/8720","diff_url":"https://github.com/rclone/rclone/pull/8720.diff","patch_url":"https://github.com/rclone/rclone/pull/8720.patch","merged_at":null},"body":"#### What is the purpose of this change?\r\nMake multithreaded copies from local to S3 fast again (by re-enabling buffering)!\r\n\r\nFrom v1.64.2 to v1.65+, the performance of multithreaded copies from local to S3 decreased. \r\nAfter some investigation and debugging, it seems this is a side effect of this [commit](https://github.com/rclone/rclone/commit/1f9a79ef09fe9f1720040073992f7dc06030cebf?diff=split#diff-57914b2dca5f9b6573400f20eb94657c8fcb57b692e0636af96d7a74ec228016R146) / issue https://github.com/rclone/rclone/issues/7350 - more specifically disabling buffering when copying from local filesystems.\r\n\r\nI executed some tests in a **m6a.2xlarge** AWS EC2 instance (Network up to 12.5 Gbps and EBS up to 10 Gbps) and here are the results:\r\n\r\nCopy of a 64 GB file from the local filesystem to S3\r\n`time ./rclone copyto --s3-no-check-bucket --ignore-checksum --s3-disable-checksum --progress --s3-upload-cutoff=0 --multi-thread-cutoff=256M --multi-thread-streams 20 --disable=copy --no-check-dest <Local File> <S3 Bucket>`\r\n\r\n| Buffering | Time | Avg Speed |\r\n|:---|---|---:|\r\n| `disabled` | 18 min 46s | ~58 MB/s |\r\n| `enabled` | 9m 10s | ~121 MB/s |\r\n\r\nI'm not completely sure about the memory consumption implications - but alternatively if it cannot be enabled by default - could we consider making it configurable?\r\n\r\nWhat do you think? Looking forward to some input and feedback!\r\n\r\n#### Was the change discussed in an issue or in the forum before?\r\nNo\r\n\r\n#### Checklist\r\n\r\n- [x] I have read the [contribution guidelines](https://github.com/rclone/rclone/blob/master/CONTRIBUTING.md#submitting-a-new-feature-or-bug-fix).\r\n- [x] I have added tests for all changes in this PR if appropriate.\r\n- [x] I have added documentation for the changes if appropriate.\r\n- [x] All commit messages are in [house style](https://github.com/rclone/rclone/blob/master/CONTRIBUTING.md#commit-messages).\r\n- [x] I'm done, this Pull Request is ready for review :-)\r\n","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/8720/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/8720/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"}]