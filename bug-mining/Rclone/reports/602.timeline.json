[{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/468915705","html_url":"https://github.com/rclone/rclone/issues/3014#issuecomment-468915705","issue_url":"https://api.github.com/repos/rclone/rclone/issues/3014","id":468915705,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2ODkxNTcwNQ==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-02T12:21:22Z","updated_at":"2019-03-02T12:21:22Z","body":"Did you try editing the config to set an empty string for the object ACL?\r\n\r\nDo you think a new object ACL type is needed? Say bucketpolicyonly or something like that?\r\n\r\nDid you try the latest beta? It will be using a later version of the SDK which could help.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/468915705/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/468935642","html_url":"https://github.com/rclone/rclone/issues/3014#issuecomment-468935642","issue_url":"https://api.github.com/repos/rclone/rclone/issues/3014","id":468935642,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2ODkzNTY0Mg==","user":{"login":"daltschu22","id":10089354,"node_id":"MDQ6VXNlcjEwMDg5MzU0","avatar_url":"https://avatars.githubusercontent.com/u/10089354?v=4","gravatar_id":"","url":"https://api.github.com/users/daltschu22","html_url":"https://github.com/daltschu22","followers_url":"https://api.github.com/users/daltschu22/followers","following_url":"https://api.github.com/users/daltschu22/following{/other_user}","gists_url":"https://api.github.com/users/daltschu22/gists{/gist_id}","starred_url":"https://api.github.com/users/daltschu22/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daltschu22/subscriptions","organizations_url":"https://api.github.com/users/daltschu22/orgs","repos_url":"https://api.github.com/users/daltschu22/repos","events_url":"https://api.github.com/users/daltschu22/events{/privacy}","received_events_url":"https://api.github.com/users/daltschu22/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-02T16:28:01Z","updated_at":"2019-03-02T17:30:40Z","body":"Thanks for getting back so quick. \r\n\r\n**Did you try the latest beta? It will be using a later version of the SDK which could help.**\r\nJust pulled the latest, no go:\r\n```\r\nrclone v1.46.0-053-gd233efbf-beta\r\nos/arch: linux/amd64\r\ngo version: go1.12\r\n```\r\n\r\nIt seems like the Master branch is using the deprecated API as you mention in your code as a comment. \r\nWhen you say a later version of the SDK, do you mean the same package https://godoc.org/google.golang.org/api/storage/v1\r\nthat you seem to be using in the master branch, but a newer release?\r\n\r\nOr have you transitioned to the latest package on one of the branches?\r\nhttps://godoc.org/cloud.google.com/go/storage\r\n\r\n**Did you try editing the config to set an empty string for the object ACL?**\r\nI just tried this. Heres my current config (Ive tried all sorts of different variations to fix this, none successful)\r\n\r\n```\r\n[test-perms]\r\ntype = google cloud storage\r\nclient_id =\r\nclient_secret =\r\nproject_number = **********\r\nservice_account_file = /****/****/****/****\r\nobject_acl = \"\"\r\nbucket_acl = private\r\nlocation = us-east4\r\nstorage_class = REGIONAL\r\n\r\n```\r\nThis results in:\r\n```\r\nFailed to copy: googleapi: Error 400: Invalid string value: '\"\"'. Allowed values: [authenticatedread, bucketownerfullcontrol, bucketownerread, private, projectprivate, publicread], invalidParameter\r\n```\r\n\r\nMy GO experience is limited, so apologies if this is wrong, but I believe the code preventing the empty string is:\r\nhttps://github.com/ncw/rclone/blob/master/backend/googlecloudstorage/googlecloudstorage.go#L364-L366\r\n\r\n**Do you think a new object ACL type is needed? Say bucketpolicyonly or something like that?**\r\nThis is an interesting question. I guess it matters how you would like to handle something like this in rclone. \r\n\r\nIm pouring over the docs to try and figure out how to architect this. But according to the document:\r\n`Requests to set, read, or modify bucket and object ACLs fail with 400 Bad Request errors.`\r\nSo it seems its both bucket and object ACL's that will no longer work.\r\nIAM is the concept used to control permissions everywhere else inside google cloud, the only exceptions is buckets/objects. So it makes sense they are moving towards supporting the IAM model.\r\n\r\nSo it seems in order to support this setting you would need to move away from using ACL's over to IAM entirely if you find that this setting is enabled.\r\n\r\nIf you query the buckets metadata it does indeed return that it has this policy enabled\r\n```\r\n\"iamConfiguration\": {\r\n  \"bucketPolicyOnly\": {\r\n   \"enabled\": true,\r\n```\r\nSo its a thing we can discover before trying to copy files. \r\n\r\nIts possible you might want to have a setting in the config for GCS that will define `bucketpolicyonly = true` and that would switch things over to using IAM. But then would we define each IAM policy in the config also? Im not sure.\r\n\r\nIm going to continue digging through the documentation to see if we can wholesale translate the \"canned ACL's\" that rclone normally uses into IAM roles. Its possible we could keep the same configurations, but use IAM under the covers if detected that bucketpolicyonly is enabled. Avoiding the need for a config option, just check if its enabled, if so use IAM. Just not sure how you want the changes on this the be handled, design wise.  Maybe thats a bad practice to hide that from the user.\r\n\r\nAnother thought, if this does become something rclone is able to handle, then it would be nice to have support for enabling the 'bucketonlypolicy' on bucket creation. This can be updated with this config in the BucketAttrs section on the API https://godoc.org/cloud.google.com/go/storage#BucketAttrs\r\n```\r\n    // BucketPolicyOnly configures access checks to use only bucket-level IAM\r\n    // policies.\r\n    BucketPolicyOnly BucketPolicyOnly\r\n```\r\n\r\nMore reading if you are also curious in digging into this:\r\nhttps://cloud.google.com/storage/docs/access-control/iam-reference\r\nhttps://cloud.google.com/storage/docs/access-control/lists#default\r\nhttps://cloud.google.com/storage/docs/access-control/iam#acls","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/468935642/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"daltschu22","id":10089354,"node_id":"MDQ6VXNlcjEwMDg5MzU0","avatar_url":"https://avatars.githubusercontent.com/u/10089354?v=4","gravatar_id":"","url":"https://api.github.com/users/daltschu22","html_url":"https://github.com/daltschu22","followers_url":"https://api.github.com/users/daltschu22/followers","following_url":"https://api.github.com/users/daltschu22/following{/other_user}","gists_url":"https://api.github.com/users/daltschu22/gists{/gist_id}","starred_url":"https://api.github.com/users/daltschu22/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daltschu22/subscriptions","organizations_url":"https://api.github.com/users/daltschu22/orgs","repos_url":"https://api.github.com/users/daltschu22/repos","events_url":"https://api.github.com/users/daltschu22/events{/privacy}","received_events_url":"https://api.github.com/users/daltschu22/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":2178137234,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDIxNzgxMzcyMzQ=","url":"https://api.github.com/repos/rclone/rclone/issues/events/2178137234","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"b9a8ec3df6a7c17e34781867340bb436ec0495b6","commit_url":"https://api.github.com/repos/rclone/rclone/commits/b9a8ec3df6a7c17e34781867340bb436ec0495b6","created_at":"2019-03-04T14:57:39Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/469283031","html_url":"https://github.com/rclone/rclone/issues/3014#issuecomment-469283031","issue_url":"https://api.github.com/repos/rclone/rclone/issues/3014","id":469283031,"node_id":"MDEyOklzc3VlQ29tbWVudDQ2OTI4MzAzMQ==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-04T14:59:24Z","updated_at":"2019-03-04T14:59:24Z","body":"I had a go at implementing a fix for this b9a8ec3df6a7c17e34781867340bb436ec0495b6\r\n\r\nThis introduces a new config variable bucket_policy_only.  If this is\r\nset then rclone:\r\n- ignores ACLs set on buckets\r\n- ignores ACLs set on objects\r\n\r\nI think rclone should probably be creating the bucket differently - at the moment all is does ignore the bucket ACL.\r\n\r\nThoughts?\r\n\r\nhttps://beta.rclone.org/branch/v1.46.0-054-gb9a8ec3d-fix-3014-gcs-bucket-policy-beta/\r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/469283031/reactions","total_count":7,"+1":4,"-1":0,"laugh":0,"hooray":3,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/470666424","html_url":"https://github.com/rclone/rclone/issues/3014#issuecomment-470666424","issue_url":"https://api.github.com/repos/rclone/rclone/issues/3014","id":470666424,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MDY2NjQyNA==","user":{"login":"daltschu22","id":10089354,"node_id":"MDQ6VXNlcjEwMDg5MzU0","avatar_url":"https://avatars.githubusercontent.com/u/10089354?v=4","gravatar_id":"","url":"https://api.github.com/users/daltschu22","html_url":"https://github.com/daltschu22","followers_url":"https://api.github.com/users/daltschu22/followers","following_url":"https://api.github.com/users/daltschu22/following{/other_user}","gists_url":"https://api.github.com/users/daltschu22/gists{/gist_id}","starred_url":"https://api.github.com/users/daltschu22/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daltschu22/subscriptions","organizations_url":"https://api.github.com/users/daltschu22/orgs","repos_url":"https://api.github.com/users/daltschu22/repos","events_url":"https://api.github.com/users/daltschu22/events{/privacy}","received_events_url":"https://api.github.com/users/daltschu22/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-07T19:43:30Z","updated_at":"2019-03-07T19:43:30Z","body":"This works! Data copies successfully, im still doing some testing but it seems like this is a working fix for the moment.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/470666424/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"daltschu22","id":10089354,"node_id":"MDQ6VXNlcjEwMDg5MzU0","avatar_url":"https://avatars.githubusercontent.com/u/10089354?v=4","gravatar_id":"","url":"https://api.github.com/users/daltschu22","html_url":"https://github.com/daltschu22","followers_url":"https://api.github.com/users/daltschu22/followers","following_url":"https://api.github.com/users/daltschu22/following{/other_user}","gists_url":"https://api.github.com/users/daltschu22/gists{/gist_id}","starred_url":"https://api.github.com/users/daltschu22/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daltschu22/subscriptions","organizations_url":"https://api.github.com/users/daltschu22/orgs","repos_url":"https://api.github.com/users/daltschu22/repos","events_url":"https://api.github.com/users/daltschu22/events{/privacy}","received_events_url":"https://api.github.com/users/daltschu22/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/471061623","html_url":"https://github.com/rclone/rclone/issues/3014#issuecomment-471061623","issue_url":"https://api.github.com/repos/rclone/rclone/issues/3014","id":471061623,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MTA2MTYyMw==","user":{"login":"daltschu22","id":10089354,"node_id":"MDQ6VXNlcjEwMDg5MzU0","avatar_url":"https://avatars.githubusercontent.com/u/10089354?v=4","gravatar_id":"","url":"https://api.github.com/users/daltschu22","html_url":"https://github.com/daltschu22","followers_url":"https://api.github.com/users/daltschu22/followers","following_url":"https://api.github.com/users/daltschu22/following{/other_user}","gists_url":"https://api.github.com/users/daltschu22/gists{/gist_id}","starred_url":"https://api.github.com/users/daltschu22/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daltschu22/subscriptions","organizations_url":"https://api.github.com/users/daltschu22/orgs","repos_url":"https://api.github.com/users/daltschu22/repos","events_url":"https://api.github.com/users/daltschu22/events{/privacy}","received_events_url":"https://api.github.com/users/daltschu22/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-08T20:13:14Z","updated_at":"2019-03-08T20:13:14Z","body":"Ive done some more testing. It seems when you invoke a server side copy, this issue is not present (on the existing stable versions of rclone). \r\n\r\nFor example, my config being:\r\n```\r\n[test-perms]\r\ntype = google cloud storage\r\nproject_number = ****\r\nservice_account_file = ****\r\nbucket_acl = private\r\nobject_acl = bucketOwnerFullControl\r\n```\r\nI run a copy to my first bucket. Which has normal ACL permissions enabled.\r\n\r\n```\r\nAccess control model\t\r\nPermissions set at object-level (ACL) and bucket-level (IAM)\r\n```\r\n\r\n ```\r\n$ rclone copy -vvv ~/test/ test-perms:daltschu-test-bucket-1\r\n2019/03/08 15:04:55 DEBUG : rclone: Version \"v1.46\" starting with parameters [\"rclone\" \"copy\" \"-vvv\" \"/home/unix/daltschu/test/\" \"test-perms:daltschu-test-bucket-1\"]\r\n*******snipped*******\r\nTransferred:        4.419k / 4.419 kBytes, 100%, 9.753 kBytes/s, ETA 0s\r\nErrors:                 0\r\nChecks:                 0 / 0, -\r\nTransferred:            3 / 3, 100%\r\nElapsed time:       400ms\r\n```\r\n\r\nThen, copy over to the bucket that has the bucket wide permissions enabled:\r\n```\r\nAccess control model\t\r\nPermissions set uniformly via bucket-level IAM (Bucket Policy Only)\r\n```\r\n\r\n```\r\n $ rclone copy -vvv test-perms:daltschu-test-bucket-1 test-perms:daltschu-test-bucket-2\r\n2019/03/08 15:09:26 DEBUG : rclone: Version \"v1.46\" starting with parameters [\"rclone\" \"copy\" \"-vvv\" \"test-perms:daltschu-test-bucket-1\" \"test-perms:daltschu-test-bucket-2\"]\r\n******snipped******\r\n2019/03/08 15:09:27 INFO  :\r\nTransferred:             0 / 0 Bytes, -, 0 Bytes/s, ETA -\r\nErrors:                 0\r\nChecks:                 0 / 0, -\r\nTransferred:            3 / 3, 100%\r\nElapsed time:       800ms\r\n```\r\nNo problem. So this seems to be an insert issue and not a copy issue. \r\n\r\nDuring my testing I did notice something strange, im still confirming but it seems the storage class is not respected for objects differing from the bucket storage class.\r\nNot sure if this is intentional or not.\r\nGCS has the option of defining a storage class per object (Even if the bucket is a different default class).\r\nIt would be excellent if support for individual object classes existed. I can open a feature request if thats something you think would be doable?\r\n\r\nThanks so much! (Ive moved multiple petabytes with rclone, so many thanks for your amazing work)","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/471061623/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"daltschu22","id":10089354,"node_id":"MDQ6VXNlcjEwMDg5MzU0","avatar_url":"https://avatars.githubusercontent.com/u/10089354?v=4","gravatar_id":"","url":"https://api.github.com/users/daltschu22","html_url":"https://github.com/daltschu22","followers_url":"https://api.github.com/users/daltschu22/followers","following_url":"https://api.github.com/users/daltschu22/following{/other_user}","gists_url":"https://api.github.com/users/daltschu22/gists{/gist_id}","starred_url":"https://api.github.com/users/daltschu22/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daltschu22/subscriptions","organizations_url":"https://api.github.com/users/daltschu22/orgs","repos_url":"https://api.github.com/users/daltschu22/repos","events_url":"https://api.github.com/users/daltschu22/events{/privacy}","received_events_url":"https://api.github.com/users/daltschu22/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":2192225908,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDIxOTIyMjU5MDg=","url":"https://api.github.com/repos/rclone/rclone/issues/events/2192225908","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"35a8761b55752e8b3a56cec1641fa2229fa58f00","commit_url":"https://api.github.com/repos/rclone/rclone/commits/35a8761b55752e8b3a56cec1641fa2229fa58f00","created_at":"2019-03-10T10:08:37Z","performed_via_github_app":null},{"id":2192261325,"node_id":"MDExOkNsb3NlZEV2ZW50MjE5MjI2MTMyNQ==","url":"https://api.github.com/repos/rclone/rclone/issues/events/2192261325","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"2078ad68a523567f4e1ae3e0d93923f84480d107","commit_url":"https://api.github.com/repos/rclone/rclone/commits/2078ad68a523567f4e1ae3e0d93923f84480d107","created_at":"2019-03-10T11:46:47Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/471281128","html_url":"https://github.com/rclone/rclone/issues/3014#issuecomment-471281128","issue_url":"https://api.github.com/repos/rclone/rclone/issues/3014","id":471281128,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MTI4MTEyOA==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-10T11:53:05Z","updated_at":"2019-03-10T11:53:05Z","body":"I've merged the bucket policy only fix to master now which means it will be in [the latest beta](https://beta.rclone.org) in 15-30 mins and released in v1.47\r\n\r\n> Ive done some more testing. It seems when you invoke a server side copy, this issue is not present (on the existing stable versions of rclone).\r\n\r\nThat is probably what I'd expect as rclone doesn't override any of the metadata.\r\n\r\n> During my testing I did notice something strange, im still confirming but it seems the storage class is not respected for objects differing from the bucket storage class.\r\n\r\nDid you mean with a server side copy or a fresh insert?\r\n\r\nThe server side copy code doesn't set any flags, so will do what ever the default is.\r\n\r\nI would have thought if you set --gcs-object-acl differently to that of the bucket then it would respect it.\r\n\r\n> GCS has the option of defining a storage class per object (Even if the bucket is a different default class).\r\n> It would be excellent if support for individual object classes existed. I can open a feature request if thats something you think would be doable?\r\n\r\nDoes `--gcs-object-acl` do what you want? I think that should work for uploading an object with a different ACL.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/471281128/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/471324469","html_url":"https://github.com/rclone/rclone/issues/3014#issuecomment-471324469","issue_url":"https://api.github.com/repos/rclone/rclone/issues/3014","id":471324469,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MTMyNDQ2OQ==","user":{"login":"daltschu22","id":10089354,"node_id":"MDQ6VXNlcjEwMDg5MzU0","avatar_url":"https://avatars.githubusercontent.com/u/10089354?v=4","gravatar_id":"","url":"https://api.github.com/users/daltschu22","html_url":"https://github.com/daltschu22","followers_url":"https://api.github.com/users/daltschu22/followers","following_url":"https://api.github.com/users/daltschu22/following{/other_user}","gists_url":"https://api.github.com/users/daltschu22/gists{/gist_id}","starred_url":"https://api.github.com/users/daltschu22/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daltschu22/subscriptions","organizations_url":"https://api.github.com/users/daltschu22/orgs","repos_url":"https://api.github.com/users/daltschu22/repos","events_url":"https://api.github.com/users/daltschu22/events{/privacy}","received_events_url":"https://api.github.com/users/daltschu22/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-10T17:08:34Z","updated_at":"2019-03-10T17:12:08Z","body":">I've merged the bucket policy only fix to master now which means it will be in the latest beta in 15-30 >mins and released in v1.47\r\n\r\nThats awesome! Much appreciated!\r\n\r\n>Did you mean with a server side copy or a fresh insert?\r\n>The server side copy code doesn't set any flags, so will do what ever the default is.\r\n>I would have thought if you set --gcs-object-acl differently to that of the bucket then it would respect\r\n\r\nApologies, I should have been more clear on this. The issue im describing here is entirely separate from the original issue. \r\nWhat im seeing is during non server side copies, so new object inserts. The StorageClass, not the ACL is not getting applied. So for example, I could have a bucket with a default of `StorageClass = REGIONAL`, but I want to upload a series of files into the bucket with the `StorageClass = COLDLINE`, it seems right now you arent setting a storage class on the individual new objects, only the bucket.\r\nSo I dont believe `--gcs-object-acl` is going to do what im hoping for.\r\n\r\nIf im understanding the code right, you dont set the StorageClass in the objects metadata\r\n```\r\n\tobject := storage.Object{\r\n\t\tBucket:      o.fs.bucket,\r\n\t\tName:        o.fs.root + o.remote,\r\n\t\tContentType: fs.MimeType(src),\r\n\t\tUpdated:     modTime.Format(timeFormatOut), // Doesn't get set\r\n\t\tMetadata:    metadataFromModTime(modTime),\r\n\t}\r\n```\r\n\r\nGCS supports the option of setting an individual object storage class, different from the bucket class default. So I could have half my objects be Regional, and half Nearline in the same bucket for example.\r\nOr my buckets default could be set to Regional, but I decide to upload any new objects as Coldline.\r\nThis is described here:\r\nhttps://cloud.google.com/storage/docs/per-object-storage-class\r\nhttps://cloud.google.com/storage/docs/storage-classes#bucket_vs_object_storage_class\r\nThe reason for this is generally so people can do tiering within the bucket.\r\n\r\nThe metadata field on the Object for that setting is:\r\n```\r\n    // StorageClass: Storage class of the object.\r\n    StorageClass string `json:\"storageClass,omitempty\"`\r\n```\r\n\r\nSo, right now whats happening is I can have my configuration setup with the line `storage_class=COLDLINE`, but if the bucket already exists, and has a default class of `REGIONAL`, it will set each new object to the default storage class of `REGIONAL`.\r\nThe buckets default storage class metadata field is:\r\n```\r\n    // StorageClass: The bucket's default storage class, used whenever no\r\n    // storageClass is specified for a newly-created object. This defines\r\n    // how objects in the bucket are stored and determines the SLA and the\r\n    // cost of storage. Values include MULTI_REGIONAL, REGIONAL, STANDARD,\r\n    // NEARLINE, COLDLINE, and DURABLE_REDUCED_AVAILABILITY. If this value\r\n    // is not specified when the bucket is created, it will default to\r\n    // STANDARD. For more information, see storage classes.\r\n    StorageClass string `json:\"storageClass,omitempty\"`\r\n```\r\n\r\nI wonder if there should be another option added called `object_storage_class` to distinguish it from the bucket storage class? Either that, or just go about setting the objects storage class individually based on the existing `storage_class` configuration setting. \r\n\r\nThanks!","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/471324469/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"daltschu22","id":10089354,"node_id":"MDQ6VXNlcjEwMDg5MzU0","avatar_url":"https://avatars.githubusercontent.com/u/10089354?v=4","gravatar_id":"","url":"https://api.github.com/users/daltschu22","html_url":"https://github.com/daltschu22","followers_url":"https://api.github.com/users/daltschu22/followers","following_url":"https://api.github.com/users/daltschu22/following{/other_user}","gists_url":"https://api.github.com/users/daltschu22/gists{/gist_id}","starred_url":"https://api.github.com/users/daltschu22/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daltschu22/subscriptions","organizations_url":"https://api.github.com/users/daltschu22/orgs","repos_url":"https://api.github.com/users/daltschu22/repos","events_url":"https://api.github.com/users/daltschu22/events{/privacy}","received_events_url":"https://api.github.com/users/daltschu22/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/471361929","html_url":"https://github.com/rclone/rclone/issues/3014#issuecomment-471361929","issue_url":"https://api.github.com/repos/rclone/rclone/issues/3014","id":471361929,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MTM2MTkyOQ==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-10T22:45:53Z","updated_at":"2019-03-10T22:45:53Z","body":"> Apologies, I should have been more clear on this. The issue im describing here is entirely separate from the original issue.\r\n\r\nAh I see - great explanation.\r\n\r\n> I wonder if there should be another option added called object_storage_class to distinguish it from the bucket storage class?\r\n\r\nThat would be easy enough to do, then you could set `--gcs-object-storage-class` when you wanted to do something different to what is set on the bucket.\r\n\r\n> Either that, or just go about setting the objects storage class individually based on the existing storage_class configuration setting.\r\n\r\nThat would be easy enough too.\r\n\r\nI think the first idea is probably the most flexible, but I wonder whether it is overkill?\r\n\r\nCan you make a new issue about this please then we can discuss further - thanks :-)","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/471361929/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"a6","id":26192908,"node_id":"MDQ6VXNlcjI2MTkyOTA4","avatar_url":"https://avatars.githubusercontent.com/u/26192908?v=4","gravatar_id":"","url":"https://api.github.com/users/a6","html_url":"https://github.com/a6","followers_url":"https://api.github.com/users/a6/followers","following_url":"https://api.github.com/users/a6/following{/other_user}","gists_url":"https://api.github.com/users/a6/gists{/gist_id}","starred_url":"https://api.github.com/users/a6/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/a6/subscriptions","organizations_url":"https://api.github.com/users/a6/orgs","repos_url":"https://api.github.com/users/a6/repos","events_url":"https://api.github.com/users/a6/events{/privacy}","received_events_url":"https://api.github.com/users/a6/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-19T21:38:02Z","updated_at":"2024-02-19T21:38:02Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rclone/rclone/issues/7641","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/7641/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/7641/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/7641/events","html_url":"https://github.com/rclone/rclone/issues/7641","id":2143181243,"node_id":"I_kwDOAQ-n5M5_vlm7","number":7641,"title":"Add an \"ignore\" option for object_acl in Google Cloud Storage","user":{"login":"a6","id":26192908,"node_id":"MDQ6VXNlcjI2MTkyOTA4","avatar_url":"https://avatars.githubusercontent.com/u/26192908?v=4","gravatar_id":"","url":"https://api.github.com/users/a6","html_url":"https://github.com/a6","followers_url":"https://api.github.com/users/a6/followers","following_url":"https://api.github.com/users/a6/following{/other_user}","gists_url":"https://api.github.com/users/a6/gists{/gist_id}","starred_url":"https://api.github.com/users/a6/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/a6/subscriptions","organizations_url":"https://api.github.com/users/a6/orgs","repos_url":"https://api.github.com/users/a6/repos","events_url":"https://api.github.com/users/a6/events{/privacy}","received_events_url":"https://api.github.com/users/a6/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399007,"node_id":"MDU6TGFiZWw4NjM5OTAwNw==","url":"https://api.github.com/repos/rclone/rclone/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null},{"id":306063008,"node_id":"MDU6TGFiZWwzMDYwNjMwMDg=","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20Google%20Cloud%20Storage","name":"Remote: Google Cloud Storage","color":"fbca04","default":false,"description":null}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2024-02-19T21:38:02Z","updated_at":"2025-01-14T14:40:48Z","closed_at":null,"author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":17803236,"node_id":"MDEwOlJlcG9zaXRvcnkxNzgwMzIzNg==","name":"rclone","full_name":"rclone/rclone","private":false,"owner":{"login":"rclone","id":24937341,"node_id":"MDEyOk9yZ2FuaXphdGlvbjI0OTM3MzQx","avatar_url":"https://avatars.githubusercontent.com/u/24937341?v=4","gravatar_id":"","url":"https://api.github.com/users/rclone","html_url":"https://github.com/rclone","followers_url":"https://api.github.com/users/rclone/followers","following_url":"https://api.github.com/users/rclone/following{/other_user}","gists_url":"https://api.github.com/users/rclone/gists{/gist_id}","starred_url":"https://api.github.com/users/rclone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rclone/subscriptions","organizations_url":"https://api.github.com/users/rclone/orgs","repos_url":"https://api.github.com/users/rclone/repos","events_url":"https://api.github.com/users/rclone/events{/privacy}","received_events_url":"https://api.github.com/users/rclone/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rclone/rclone","description":"\"rsync for cloud storage\" - Google Drive, S3, Dropbox, Backblaze B2, One Drive, Swift, Hubic, Wasabi, Google Cloud Storage, Azure Blob, Azure Files, Yandex Files","fork":false,"url":"https://api.github.com/repos/rclone/rclone","forks_url":"https://api.github.com/repos/rclone/rclone/forks","keys_url":"https://api.github.com/repos/rclone/rclone/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rclone/rclone/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rclone/rclone/teams","hooks_url":"https://api.github.com/repos/rclone/rclone/hooks","issue_events_url":"https://api.github.com/repos/rclone/rclone/issues/events{/number}","events_url":"https://api.github.com/repos/rclone/rclone/events","assignees_url":"https://api.github.com/repos/rclone/rclone/assignees{/user}","branches_url":"https://api.github.com/repos/rclone/rclone/branches{/branch}","tags_url":"https://api.github.com/repos/rclone/rclone/tags","blobs_url":"https://api.github.com/repos/rclone/rclone/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rclone/rclone/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rclone/rclone/git/refs{/sha}","trees_url":"https://api.github.com/repos/rclone/rclone/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rclone/rclone/statuses/{sha}","languages_url":"https://api.github.com/repos/rclone/rclone/languages","stargazers_url":"https://api.github.com/repos/rclone/rclone/stargazers","contributors_url":"https://api.github.com/repos/rclone/rclone/contributors","subscribers_url":"https://api.github.com/repos/rclone/rclone/subscribers","subscription_url":"https://api.github.com/repos/rclone/rclone/subscription","commits_url":"https://api.github.com/repos/rclone/rclone/commits{/sha}","git_commits_url":"https://api.github.com/repos/rclone/rclone/git/commits{/sha}","comments_url":"https://api.github.com/repos/rclone/rclone/comments{/number}","issue_comment_url":"https://api.github.com/repos/rclone/rclone/issues/comments{/number}","contents_url":"https://api.github.com/repos/rclone/rclone/contents/{+path}","compare_url":"https://api.github.com/repos/rclone/rclone/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rclone/rclone/merges","archive_url":"https://api.github.com/repos/rclone/rclone/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rclone/rclone/downloads","issues_url":"https://api.github.com/repos/rclone/rclone/issues{/number}","pulls_url":"https://api.github.com/repos/rclone/rclone/pulls{/number}","milestones_url":"https://api.github.com/repos/rclone/rclone/milestones{/number}","notifications_url":"https://api.github.com/repos/rclone/rclone/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rclone/rclone/labels{/name}","releases_url":"https://api.github.com/repos/rclone/rclone/releases{/id}","deployments_url":"https://api.github.com/repos/rclone/rclone/deployments","created_at":"2014-03-16T16:19:57Z","updated_at":"2025-11-09T20:38:02Z","pushed_at":"2025-11-08T21:33:38Z","git_url":"git://github.com/rclone/rclone.git","ssh_url":"git@github.com:rclone/rclone.git","clone_url":"https://github.com/rclone/rclone.git","svn_url":"https://github.com/rclone/rclone","homepage":"https://rclone.org","size":217990,"stargazers_count":53422,"watchers_count":53422,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":4767,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1169,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["azure-blob","azure-blob-storage","azure-files","backblaze-b2","cloud-storage","dropbox","encryption","ftp","fuse-filesystem","go","golang","google-cloud-storage","google-drive","onedrive","openstack-swift","rclone","s3","sftp","sync","webdav"],"visibility":"public","forks":4767,"open_issues":1169,"watchers":53422,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"There is an interesting interaction with rclone and default ACLs that the `bucket_policy_only` parameter introduced in #3014 solved in a non-intuitive way.\r\n\r\nFor buckets with [fine-grained access control](https://cloud.google.com/storage/docs/access-control#choose_between_uniform_and_fine-grained_access) enabled (not those with uniform access policies), rclone will always clobber the object's [default ACLs](https://cloud.google.com/storage/docs/access-control/lists#default) unless this `bucket_policy_only` parameter is set. Don't get me wrong, I'm grateful that the parameter exists, otherwise this would be quite problematic, but it's not an intuitive find since it's useful for buckets with fine-grained access policies as well as those with uniform access policy buckets. Currently, the feature is somewhat misleadingly named/described.\r\n\r\nFor these cases, it would have been more intuitive to have an additional option for `object_acl` such as `ignore`, or something similar. That would be more intuitive for users. Thank you for the consideration!","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/7641/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/7641/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"}]