{"url":"https://api.github.com/repos/rclone/rclone/issues/5758","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/5758/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/5758/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/5758/events","html_url":"https://github.com/rclone/rclone/issues/5758","id":1035927149,"node_id":"I_kwDOAQ-n5M49vv5t","number":5758,"title":"Windows sha1sum via SFTP","user":{"login":"SteveBox0","id":86661487,"node_id":"MDQ6VXNlcjg2NjYxNDg3","avatar_url":"https://avatars.githubusercontent.com/u/86661487?v=4","gravatar_id":"","url":"https://api.github.com/users/SteveBox0","html_url":"https://github.com/SteveBox0","followers_url":"https://api.github.com/users/SteveBox0/followers","following_url":"https://api.github.com/users/SteveBox0/following{/other_user}","gists_url":"https://api.github.com/users/SteveBox0/gists{/gist_id}","starred_url":"https://api.github.com/users/SteveBox0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SteveBox0/subscriptions","organizations_url":"https://api.github.com/users/SteveBox0/orgs","repos_url":"https://api.github.com/users/SteveBox0/repos","events_url":"https://api.github.com/users/SteveBox0/events{/privacy}","received_events_url":"https://api.github.com/users/SteveBox0/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":608259405,"node_id":"MDU6TGFiZWw2MDgyNTk0MDU=","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20SFTP","name":"Remote: SFTP","color":"fbca04","default":false,"description":""},{"id":2464788588,"node_id":"MDU6TGFiZWwyNDY0Nzg4NTg4","url":"https://api.github.com/repos/rclone/rclone/labels/OS:%20Windows","name":"OS: Windows","color":"1999d1","default":false,"description":""},{"id":2504883054,"node_id":"MDU6TGFiZWwyNTA0ODgzMDU0","url":"https://api.github.com/repos/rclone/rclone/labels/hashing","name":"hashing","color":"54d3cf","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"albertony","id":12441419,"node_id":"MDQ6VXNlcjEyNDQxNDE5","avatar_url":"https://avatars.githubusercontent.com/u/12441419?v=4","gravatar_id":"","url":"https://api.github.com/users/albertony","html_url":"https://github.com/albertony","followers_url":"https://api.github.com/users/albertony/followers","following_url":"https://api.github.com/users/albertony/following{/other_user}","gists_url":"https://api.github.com/users/albertony/gists{/gist_id}","starred_url":"https://api.github.com/users/albertony/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertony/subscriptions","organizations_url":"https://api.github.com/users/albertony/orgs","repos_url":"https://api.github.com/users/albertony/repos","events_url":"https://api.github.com/users/albertony/events{/privacy}","received_events_url":"https://api.github.com/users/albertony/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"albertony","id":12441419,"node_id":"MDQ6VXNlcjEyNDQxNDE5","avatar_url":"https://avatars.githubusercontent.com/u/12441419?v=4","gravatar_id":"","url":"https://api.github.com/users/albertony","html_url":"https://github.com/albertony","followers_url":"https://api.github.com/users/albertony/followers","following_url":"https://api.github.com/users/albertony/following{/other_user}","gists_url":"https://api.github.com/users/albertony/gists{/gist_id}","starred_url":"https://api.github.com/users/albertony/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertony/subscriptions","organizations_url":"https://api.github.com/users/albertony/orgs","repos_url":"https://api.github.com/users/albertony/repos","events_url":"https://api.github.com/users/albertony/events{/privacy}","received_events_url":"https://api.github.com/users/albertony/received_events","type":"User","user_view_type":"public","site_admin":false},{"login":"SteveBox0","id":86661487,"node_id":"MDQ6VXNlcjg2NjYxNDg3","avatar_url":"https://avatars.githubusercontent.com/u/86661487?v=4","gravatar_id":"","url":"https://api.github.com/users/SteveBox0","html_url":"https://github.com/SteveBox0","followers_url":"https://api.github.com/users/SteveBox0/followers","following_url":"https://api.github.com/users/SteveBox0/following{/other_user}","gists_url":"https://api.github.com/users/SteveBox0/gists{/gist_id}","starred_url":"https://api.github.com/users/SteveBox0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SteveBox0/subscriptions","organizations_url":"https://api.github.com/users/SteveBox0/orgs","repos_url":"https://api.github.com/users/SteveBox0/repos","events_url":"https://api.github.com/users/SteveBox0/events{/privacy}","received_events_url":"https://api.github.com/users/SteveBox0/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/47","html_url":"https://github.com/rclone/rclone/milestone/47","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/47/labels","id":7313007,"node_id":"MI_kwDOAQ-n5M4Ab5Zv","number":47,"title":"v1.59","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":18,"state":"closed","created_at":"2021-11-01T17:02:19Z","updated_at":"2022-07-09T20:30:36Z","due_on":"2022-07-08T07:00:00Z","closed_at":"2022-07-09T20:30:36Z"},"comments":47,"created_at":"2021-10-26T07:18:13Z","updated_at":"2022-06-08T19:14:54Z","closed_at":"2022-06-08T19:14:54Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### What is the problem you are having with rclone?\r\n\r\nI am using the official OpenSSH that is now part of windows (link below). This works well for file transfer but hash checks do not seem to work. \r\nhttps://docs.microsoft.com/en-us/windows-server/administration/openssh/openssh_install_firstuse\r\n\r\nI have tested using both sha1sum and md5sums. \r\n\r\nhttps://www.adaic.org/resources/add_content/standards/sha1sum.exe\r\n--sftp-sha1sum-command \"sha1sum\"\r\n\r\nhttp://www.pc-tools.net/files/win32/freeware/md5sums-1.2.zip\r\n--sftp-md5sum-command \"md5sums -u\"\r\n\r\nThe first issue seems to be the path being different to sftp and i got around this using --sftp-path-override \"C:\\test folder\". \r\n\r\nLooking at the console output the issue seems to be the way rclone handles the escape characters and backslashes. \r\n\r\nI think the best way forward would most likely just be an OS detection on SSH connect or a optional flag for Windows.\r\n\r\n#### What is your rclone version (output from `rclone version`)\r\n\r\nv1.57.0-beta.5801.bb11803f1\r\n\r\n#### Which OS you are using and how many bits (e.g. Windows 7, 64 bit)\r\n\r\nClient - Ubuntu 21.10\r\nServer - Windows Server 2019\r\n\r\n#### Which cloud storage system are you using? (e.g. Google Drive)\r\n\r\nSFTP\r\n\r\n#### The command you were trying to run (e.g. `rclone copy /tmp remote:tmp`)\r\n\r\nrclone sha1sum \"windows:/C:/test folder/example1/\" --sftp-sha1sum-command \"sha1sum\" -vv\r\n\r\n#### A log from the command with the `-vv` flag (e.g. output from `rclone -vv copy /tmp remote:tmp`)\r\n\r\n```\r\n2021/10/26 18:08:39 DEBUG : rclone: Version \"v1.57.0-beta.5801.bb11803f1\" starting with parameters [\"rclone\" \"sha1sum\" \"windows:/C:/test folder/example1/\" \"--sftp-sha1sum-command\" \"sha1sum\" \"-vv\"]\r\n2021/10/26 18:08:39 DEBUG : Creating backend with remote \"windows:/C:/test folder/example1/\"\r\n2021/10/26 18:08:39 DEBUG : Using config file from \"/home/user/.config/rclone/rclone.conf\"\r\n2021/10/26 18:08:39 DEBUG : windows: detected overridden config - adding \"{h5EBD}\" suffix to name\r\n2021/10/26 18:08:40 DEBUG : sftp://*****@*****//C:/test folder/example1/: New connection *****:39518->*****:22 to \"SSH-2.0-OpenSSH_for_Windows_8.1\"\r\n2021/10/26 18:08:40 DEBUG : fs cache: renaming cache item \"windows:/C:/test folder/example1/\" to be canonical \"windows{h5EBD}:/C:/test folder/example1/\"\r\n2021/10/26 18:08:40 DEBUG : sftp cmd = /C:/test\\ folder/example1/file1.txt\r\n2021/10/26 18:08:40 DEBUG : file1.txt: Failed to calculate sha1 hash: Process exited with status 1 (can't open `/C:/test\\': Invalid argument)\r\n                                          file1.txt\r\n2021/10/26 18:08:40 DEBUG : 11 go routines active\r\n\r\n```","closed_by":{"login":"albertony","id":12441419,"node_id":"MDQ6VXNlcjEyNDQxNDE5","avatar_url":"https://avatars.githubusercontent.com/u/12441419?v=4","gravatar_id":"","url":"https://api.github.com/users/albertony","html_url":"https://github.com/albertony","followers_url":"https://api.github.com/users/albertony/followers","following_url":"https://api.github.com/users/albertony/following{/other_user}","gists_url":"https://api.github.com/users/albertony/gists{/gist_id}","starred_url":"https://api.github.com/users/albertony/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albertony/subscriptions","organizations_url":"https://api.github.com/users/albertony/orgs","repos_url":"https://api.github.com/users/albertony/repos","events_url":"https://api.github.com/users/albertony/events{/privacy}","received_events_url":"https://api.github.com/users/albertony/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/5758/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/5758/timeline","performed_via_github_app":null,"state_reason":"completed"}