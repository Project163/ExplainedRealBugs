{"url":"https://api.github.com/repos/rclone/rclone/issues/7444","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/7444/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/7444/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/7444/events","html_url":"https://github.com/rclone/rclone/issues/7444","id":2004265549,"node_id":"I_kwDOAQ-n5M53dqpN","number":7444,"title":"WebDAV partly unusable when CORS applied","user":{"login":"alensiljak","id":462445,"node_id":"MDQ6VXNlcjQ2MjQ0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/462445?v=4","gravatar_id":"","url":"https://api.github.com/users/alensiljak","html_url":"https://github.com/alensiljak","followers_url":"https://api.github.com/users/alensiljak/followers","following_url":"https://api.github.com/users/alensiljak/following{/other_user}","gists_url":"https://api.github.com/users/alensiljak/gists{/gist_id}","starred_url":"https://api.github.com/users/alensiljak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alensiljak/subscriptions","organizations_url":"https://api.github.com/users/alensiljak/orgs","repos_url":"https://api.github.com/users/alensiljak/repos","events_url":"https://api.github.com/users/alensiljak/events{/privacy}","received_events_url":"https://api.github.com/users/alensiljak/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2023-11-21T13:16:13Z","updated_at":"2023-12-04T11:20:13Z","closed_at":"2023-11-23T16:49:04Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"This is a follow-up to #5078. First of all, thank you very much for implementing that request!\r\nAs my main goal was to access WebDAV via rclone from the browser (a PWA), that is unfortunately still not completely possible. Let's try to dig into details.\r\n\r\nIt is still not 100% clear to me what/where the problem lies, as the messages are different in different browsers.\r\nThe test case can be accessed from https://cashier-ii.alensiljak.eu.org/webdav-demo\r\nThis is the (PWA) page that issues the requests.\r\n\r\nI'll provide here some general info that does not fit into the answers below.\r\n\r\nAs noted in #5078, these headers are included in the Response and I'm wondering if that is the source of the issue:\r\n```\r\nAccess-Control-Allow-Origin  | *\r\nAccess-Control-Request-Method | POST, OPTIONS, GET, HEAD\r\n```\r\nThis would explain the failure of PROPFIND. PUT also does not work.\r\nThere's a failure of POST, as well, but I suspect there is something wrong with how I'm using it (?).\r\n\r\n#### The associated forum post URL from `https://forum.rclone.org`\r\n\r\nN/A\r\n\r\n#### What is the problem you are having with rclone?\r\n\r\nAccessing the Rclone WebDAV server from a browser does not work as expected.\r\n\r\nInitially I've tried a few WebDAV-specific libraries. These all use PROPFIND request, which seems to be blocked in this scenario.\r\n\r\nAfter that, I've used the HttpClient directly, to issue HTTP commands. For the following commands:\r\n- simple get (root)\r\n- get a file\r\n- propfind (root)\r\n- post a file\r\n\r\n```\r\nGET http://localhost:8080\r\n\r\nGET http://localhost:8080/rates.ledger\r\n\r\nPROPFIND http://localhost:8080\r\n\r\nPOST http://localhost:8080/upload-test.txt\r\nwith string stream attached.\r\n```\r\nonly the first two succeed. PROPFIND and POST fail. \r\nI may be using POST wrong. I'll adjust the request as we troubleshoot.\r\n\r\nHowever, when other tools are used (non-browser, Total Commander on Android, curl, Windows Explorer), things seem fine. I believe the reason for this is that these do not care about CORS.\r\n\r\nLet me know if you have questions or need clarifications. I'd be happy to help to try to narrow this down.\r\n\r\n#### What is your rclone version (output from `rclone version`)\r\n\r\nrclone v1.64.2\r\n- os/version: Microsoft Windows 11 Pro for Workstations 22H2 (64 bit)\r\n- os/kernel: 10.0.23570.1000 (x86_64)\r\n- os/type: windows\r\n- os/arch: amd64\r\n- go/version: go1.21.3\r\n- go/linking: static\r\n- go/tags: cmount\r\n\r\n#### Which OS you are using and how many bits (e.g. Windows 7, 64 bit)\r\n\r\nWindows 11, 64-bit\r\n\r\n#### Which cloud storage system are you using? (e.g. Google Drive)\r\n\r\nLocal drive/folder, for this case.\r\n\r\n#### The command you were trying to run (e.g. `rclone copy /tmp remote:tmp`)\r\n\r\n```sh\r\nrclone serve webdav . --allow-origin \"*\" -vv --log-file bug.log\r\n```\r\n\r\n\r\n\r\n#### A log from the command with the `-vv` flag (e.g. output from `rclone -vv copy /tmp remote:tmp`)\r\n\r\n```\r\n2023/11/21 13:57:29 DEBUG : Creating backend with remote \".\"\r\n2023/11/21 13:57:29 DEBUG : Using config file from \"C:\\\\Users\\\\Alen\\\\AppData\\\\Roaming\\\\rclone\\\\rclone.conf\"\r\n2023/11/21 13:57:29 DEBUG : fs cache: renaming cache item \".\" to be canonical \"//?/D:/tmp\"\r\n2023/11/21 13:57:29 INFO  : Local file system at //?/D:/tmp: poll-interval is not supported by this remote\r\n2023/11/21 13:57:29 NOTICE: Warning: Allow origin set to *. This can cause serious security problems.\r\n2023/11/21 13:57:29 NOTICE: Local file system at //?/D:/tmp: WebDav Server started on [http://127.0.0.1:8080/]\r\n2023/11/21 13:57:43 INFO  : : 127.0.0.1:57907: Serving directory\r\n2023/11/21 13:57:44 DEBUG : /rates.ledger: OpenFile: flags=O_RDONLY, perm=----------\r\n2023/11/21 13:57:44 DEBUG : rates.ledger: Open: flags=O_RDONLY\r\n2023/11/21 13:57:44 DEBUG : rates.ledger: >Open: fd=rates.ledger (r), err=<nil>\r\n2023/11/21 13:57:44 DEBUG : /rates.ledger: >OpenFile: fd=rates.ledger (r), err=<nil>\r\n2023/11/21 13:57:44 DEBUG : rates.ledger: ChunkedReader.openRange at 0 length 134217728\r\n2023/11/21 13:57:44 DEBUG : rates.ledger: ChunkedReader.Read at 0 length 512 chunkOffset 0 chunkSize 134217728\r\n2023/11/21 13:57:44 DEBUG : rates.ledger: ReadFileHandle.seek from 512 to 0 (fs.RangeSeeker)\r\n2023/11/21 13:57:44 DEBUG : rates.ledger: ChunkedReader.RangeSeek from 512 to 0 length -1\r\n2023/11/21 13:57:44 DEBUG : rates.ledger: ChunkedReader.Read at -1 length 541 chunkOffset 0 chunkSize 134217728\r\n2023/11/21 13:57:44 DEBUG : rates.ledger: ChunkedReader.openRange at 0 length 134217728\r\n2023/11/21 13:57:44 INFO  : /rates.ledger: GET from 127.0.0.1:57907\r\n2023/11/21 13:57:46 INFO  : /: OPTIONS from 127.0.0.1:57907\r\n2023/11/21 13:57:48 DEBUG : /upload-test.txt: OpenFile: flags=O_RDONLY, perm=----------\r\n2023/11/21 13:57:48 DEBUG : /upload-test.txt: >OpenFile: fd=<nil>, err=file does not exist\r\n2023/11/21 13:57:48 INFO  : /upload-test.txt: POST from 127.0.0.1:57907\r\n2023/11/21 13:57:50 INFO  : Signal received: interrupt\r\n2023/11/21 13:57:50 DEBUG : 7 go routines active\r\n2023/11/21 13:57:50 INFO  : Exiting...\r\n```\r\n\r\nThe log seems to indicate that there was no PROPFIND request at all. This may be blocked by the browser itself. It hints that this method might need to be explicitly allowed by the server.\r\n\r\nI also don't see the GET request for \"/\".\r\n\r\n#### How to use GitHub\r\n\r\n* Please use the üëç [reaction](https://blog.github.com/2016-03-10-add-reactions-to-pull-requests-issues-and-comments/) to show that you are affected by the same issue.\r\n* Please don't comment if you have no relevant information to add. It's just extra noise for everyone subscribed to this issue.\r\n* Subscribe to receive notifications on status change and new comments.\r\n","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/7444/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/7444/timeline","performed_via_github_app":null,"state_reason":"completed"}