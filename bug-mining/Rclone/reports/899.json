{"url":"https://api.github.com/repos/rclone/rclone/issues/4700","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/4700/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/4700/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/4700/events","html_url":"https://github.com/rclone/rclone/issues/4700","id":727484980,"node_id":"MDU6SXNzdWU3Mjc0ODQ5ODA=","number":4700,"title":"onedrive: remove `%` and `#` from the set of encoded characters","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399007,"node_id":"MDU6TGFiZWw4NjM5OTAwNw==","url":"https://api.github.com/repos/rclone/rclone/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null},{"id":306063114,"node_id":"MDU6TGFiZWwzMDYwNjMxMTQ=","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20One%20Drive","name":"Remote: One Drive","color":"fbca04","default":false,"description":null},{"id":2510652221,"node_id":"MDU6TGFiZWwyNTEwNjUyMjIx","url":"https://api.github.com/repos/rclone/rclone/labels/encoding","name":"encoding","color":"b3baf2","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"Cnly","id":3103188,"node_id":"MDQ6VXNlcjMxMDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/3103188?v=4","gravatar_id":"","url":"https://api.github.com/users/Cnly","html_url":"https://github.com/Cnly","followers_url":"https://api.github.com/users/Cnly/followers","following_url":"https://api.github.com/users/Cnly/following{/other_user}","gists_url":"https://api.github.com/users/Cnly/gists{/gist_id}","starred_url":"https://api.github.com/users/Cnly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Cnly/subscriptions","organizations_url":"https://api.github.com/users/Cnly/orgs","repos_url":"https://api.github.com/users/Cnly/repos","events_url":"https://api.github.com/users/Cnly/events{/privacy}","received_events_url":"https://api.github.com/users/Cnly/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"Cnly","id":3103188,"node_id":"MDQ6VXNlcjMxMDMxODg=","avatar_url":"https://avatars.githubusercontent.com/u/3103188?v=4","gravatar_id":"","url":"https://api.github.com/users/Cnly","html_url":"https://github.com/Cnly","followers_url":"https://api.github.com/users/Cnly/followers","following_url":"https://api.github.com/users/Cnly/following{/other_user}","gists_url":"https://api.github.com/users/Cnly/gists{/gist_id}","starred_url":"https://api.github.com/users/Cnly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Cnly/subscriptions","organizations_url":"https://api.github.com/users/Cnly/orgs","repos_url":"https://api.github.com/users/Cnly/repos","events_url":"https://api.github.com/users/Cnly/events{/privacy}","received_events_url":"https://api.github.com/users/Cnly/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/41","html_url":"https://github.com/rclone/rclone/milestone/41","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/41/labels","id":5478342,"node_id":"MDk6TWlsZXN0b25lNTQ3ODM0Mg==","number":41,"title":"v1.54","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":55,"state":"closed","created_at":"2020-05-29T14:52:51Z","updated_at":"2021-02-03T16:09:01Z","due_on":"2021-01-30T08:00:00Z","closed_at":"2021-02-03T16:05:14Z"},"comments":7,"created_at":"2020-10-22T15:16:51Z","updated_at":"2021-01-08T12:08:09Z","closed_at":"2021-01-08T12:07:20Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The [microsoft onedrive docs](https://support.microsoft.com/en-us/office/invalid-file-names-and-file-types-in-onedrive-and-sharepoint-64883a5d-228e-48f5-b3d2-eb39e07630fa#invalidcharacters) has this table about invalid characters in onedrive and onedrive business\r\n\r\n![image](https://user-images.githubusercontent.com/536803/96891876-fee93d80-1480-11eb-87b3-4e3681008c5d.png)\r\n\r\nHowever the set rclone uses is\r\n\r\n| Character | Value | Replacement |\r\n| --------- |:-----:|:-----------:|\r\n| \"         | 0x22  | ＂          |\r\n| *         | 0x2A  | ＊          |\r\n| :         | 0x3A  | ：          |\r\n| <         | 0x3C  | ＜          |\r\n| >         | 0x3E  | ＞          |\r\n| ?         | 0x3F  | ？          |\r\n| \\         | 0x5C  | ＼          |\r\n| \\|        | 0x7C  | ｜          |\r\n| #         | 0x23  | ＃          |\r\n| %         | 0x25  | ％          |\r\n\r\n\r\nWhich includes `%` and `#` where it probably shouldn't for onedrive home.\r\n\r\nHowever if I actually use rclone's test program to see what characters you can store I get this\r\n\r\n![image](https://user-images.githubusercontent.com/536803/96891961-11fc0d80-1481-11eb-8baf-9d33a342a7f2.png)\r\n\r\nThis is a little difficult to interpret but it tries each character at the Left, Middle and Right of a file and checks it can Write it, Get it and List it.\r\n\r\nOnedrive home and business test remarkably similar with onedrive business not allowing a `'` on the end of a string but both allowing `#` and `%` which rclone currently escapes.\r\n\r\nSo probably the correct thing (ignoring backwards compatibility) would be to remove `#` and `%` from the onedrive encoding. This will then match the Windows encoding which is probably sensible and this will match what onedrive and onedrive business actually allow.\r\n\r\nRemoving characters from the encoding has the potential for rclone to have to re-upload files which can confuse users though.\r\n\r\n@Cnly do you have any thoughts about this?\r\n\r\nAlso I haven't got a sharepoint to test.\r\n\r\nSee: https://forum.rclone.org/t/onedrive-file-names-with-converted-to-non-ascii-equivalent/19871/","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/4700/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/4700/timeline","performed_via_github_app":null,"state_reason":"completed"}