{"url":"https://api.github.com/repos/rclone/rclone/issues/3912","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/3912/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/3912/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/3912/events","html_url":"https://github.com/rclone/rclone/issues/3912","id":556501162,"node_id":"MDU6SXNzdWU1NTY1MDExNjI=","number":3912,"title":"rclone sync (& others) interference with size_as_quota configuration value","user":{"login":"Alvaro-Santos","id":19858704,"node_id":"MDQ6VXNlcjE5ODU4NzA0","avatar_url":"https://avatars.githubusercontent.com/u/19858704?v=4","gravatar_id":"","url":"https://api.github.com/users/Alvaro-Santos","html_url":"https://github.com/Alvaro-Santos","followers_url":"https://api.github.com/users/Alvaro-Santos/followers","following_url":"https://api.github.com/users/Alvaro-Santos/following{/other_user}","gists_url":"https://api.github.com/users/Alvaro-Santos/gists{/gist_id}","starred_url":"https://api.github.com/users/Alvaro-Santos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Alvaro-Santos/subscriptions","organizations_url":"https://api.github.com/users/Alvaro-Santos/orgs","repos_url":"https://api.github.com/users/Alvaro-Santos/repos","events_url":"https://api.github.com/users/Alvaro-Santos/events{/privacy}","received_events_url":"https://api.github.com/users/Alvaro-Santos/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2020-01-28T22:07:49Z","updated_at":"2020-01-31T10:10:41Z","closed_at":"2020-01-31T10:10:15Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### What is the problem you are having with rclone?\r\n\r\nrclone sync fails to upload anything to google drive using my current config (more accurately, it manages to replicate my local directory structure, but remotely deletes every file after copying it to the remote due to google drive reporting the correct size -- 45 bytes -- but rclone believing that the actual size is 0 bytes). The issue is dependent on the value of size_as_quota, although I have not tinkered with other configuration parameters to figure out whether the issue is just size_as_quota xor an interference between size_as_quota and some other parameter.\r\n\r\nThis behaviour is also present in other commands (at least copy; possibly others). However, I have only properly tested/debugged sync specifically. This behaviour seems to be independent of the number of files present either locally or remotely (i.e., various combinations of 1/multiple local files, empty/partially filled remote directories).\r\n\r\n#### What is your rclone version (output from `rclone version`)\r\n\r\nThe issue is present on both the stable and beta versions:\r\n\r\n> rclone v1.50.2-194-gbfd9f321-beta\r\n> \\- os/arch: linux/amd64\r\n> \\- go version: go1.13.6\r\n\r\n> rclone v1.50.2\r\n> \\- os/arch: linux/amd64\r\n> \\- go version: go1.13.4\r\n\r\n#### Which OS you are using and how many bits (eg Windows 7, 64 bit)\r\n\r\nUbuntu 18.04.3 LTS, 64 bit.\r\n\r\n####  Which cloud storage system are you using? (eg Google Drive)\r\n\r\nGoogle Drive.\r\n\r\n#### The command you were trying to run (eg `rclone copy /tmp remote:tmp`)\r\n\r\n> rclone sync . gdrive:\r\n\r\nThe issue is present even when various miscellaneous (& probably uninteresting for the issue at hand) flags are enabled. Specifically:\r\n\r\n> --exclude .git/\r\n> --retries X, for X = 1, 2\r\n> -vv\r\n> --dump-bodies and --dump-headers in any combination with -vv\r\n\r\nFor obvious reasons, the issue disappears with either of the following flags enabled:\r\n\r\n> --dry-run\r\n> --ignore-size\r\n\r\n#### A log from the command with the `-vv` flag (eg output from `rclone -vv copy /tmp remote:tmp`)\r\n\r\n2020/01/28 21:36:38 DEBUG : rclone: Version \"v1.50.2\" starting with parameters [\"rclone\" \"sync\" \".\" \"gdrive:\" \"--exclude\" \".git/\" \"-vv\"]\r\n2020/01/28 21:36:38 DEBUG : Using config file from \"/home/penguin/.config/rclone/rclone.conf\"\r\n2020/01/28 21:36:38 DEBUG : .git: Excluded\r\n2020/01/28 21:36:38 INFO  : Google drive root '': Waiting for checks to finish\r\n2020/01/28 21:36:38 INFO  : Google drive root '': Waiting for transfers to finish\r\n2020/01/28 21:36:42 ERROR : 1st/config: corrupted on transfer: sizes differ 45 vs 0\r\n2020/01/28 21:36:42 INFO  : 1st/config: Removing failed copy\r\n2020/01/28 21:36:43 ERROR : Google drive root '': not deleting files as there were IO errors\r\n2020/01/28 21:36:43 ERROR : Google drive root '': not deleting directories as there were IO errors\r\n2020/01/28 21:36:43 ERROR : Attempt 1/3 failed with 3 errors and: corrupted on transfer: sizes differ 45 vs 0\r\n2020/01/28 21:36:43 DEBUG : .git: Excluded\r\n2020/01/28 21:36:43 INFO  : Google drive root '': Waiting for checks to finish\r\n2020/01/28 21:36:43 INFO  : Google drive root '': Waiting for transfers to finish\r\n2020/01/28 21:36:46 ERROR : 1st/config: corrupted on transfer: sizes differ 45 vs 0\r\n2020/01/28 21:36:46 INFO  : 1st/config: Removing failed copy\r\n2020/01/28 21:36:46 ERROR : Google drive root '': not deleting files as there were IO errors\r\n2020/01/28 21:36:46 ERROR : Google drive root '': not deleting directories as there were IO errors\r\n2020/01/28 21:36:46 ERROR : Attempt 2/3 failed with 3 errors and: corrupted on transfer: sizes differ 45 vs 0\r\n2020/01/28 21:36:46 DEBUG : .git: Excluded\r\n2020/01/28 21:36:47 INFO  : Google drive root '': Waiting for checks to finish\r\n2020/01/28 21:36:47 INFO  : Google drive root '': Waiting for transfers to finish\r\n2020/01/28 21:36:49 ERROR : 1st/config: corrupted on transfer: sizes differ 45 vs 0\r\n2020/01/28 21:36:49 INFO  : 1st/config: Removing failed copy\r\n2020/01/28 21:36:50 ERROR : Google drive root '': not deleting files as there were IO errors\r\n2020/01/28 21:36:50 ERROR : Google drive root '': not deleting directories as there were IO errors\r\n2020/01/28 21:36:50 ERROR : Attempt 3/3 failed with 3 errors and: corrupted on transfer: sizes differ 45 vs 0\r\n2020/01/28 21:36:50 Failed to sync with 3 errors: last error was: corrupted on transfer: sizes differ 45 vs 0\r\n\r\n#### Attachments\r\n\r\nI have attached the following files:\r\n- A copy of the file I am trying to upload to gdrive [config.txt](https://github.com/rclone/rclone/files/4124732/config.txt). This file was kept in \"./1st/\" locally;\r\n- A dump of my rclone config [rclone_config.txt](https://github.com/rclone/rclone/files/4124761/rclone_config.txt) (generated using rclone config dump; root_folder_id obtained as per https://rclone.org/drive/#root-folder-id);\r\n\r\n#### Temporary fixes\r\n\r\nCurrently, either using --ignore-size or setting size_as_quota to false in the previously attached configuration file seem to resolve the issue, without any negative effect on the usage of rclone.\r\n\r\n#### Keywords to help other users affected by this bug to find this issue on search engines\r\n\r\nrclone size bug, rclone gdrive size bug, rclone size always 0, rclone sync size is wrong, rclone corrupted on transfer: sizes differ, rclone sync only works with --ignore-size\r\n","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/3912/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/3912/timeline","performed_via_github_app":null,"state_reason":"completed"}