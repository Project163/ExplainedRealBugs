{"url":"https://api.github.com/repos/rclone/rclone/issues/1660","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/1660/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/1660/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/1660/events","html_url":"https://github.com/rclone/rclone/issues/1660","id":255509442,"node_id":"MDU6SXNzdWUyNTU1MDk0NDI=","number":1660,"title":"Expired authorisation tokens with Backblaze B2 large file uploads ","user":{"login":"eodrap","id":31686420,"node_id":"MDQ6VXNlcjMxNjg2NDIw","avatar_url":"https://avatars.githubusercontent.com/u/31686420?v=4","gravatar_id":"","url":"https://api.github.com/users/eodrap","html_url":"https://github.com/eodrap","followers_url":"https://api.github.com/users/eodrap/followers","following_url":"https://api.github.com/users/eodrap/following{/other_user}","gists_url":"https://api.github.com/users/eodrap/gists{/gist_id}","starred_url":"https://api.github.com/users/eodrap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eodrap/subscriptions","organizations_url":"https://api.github.com/users/eodrap/orgs","repos_url":"https://api.github.com/users/eodrap/repos","events_url":"https://api.github.com/users/eodrap/events{/privacy}","received_events_url":"https://api.github.com/users/eodrap/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/25","html_url":"https://github.com/rclone/rclone/milestone/25","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/25/labels","id":2395138,"node_id":"MDk6TWlsZXN0b25lMjM5NTEzOA==","number":25,"title":"v1.38","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":53,"state":"closed","created_at":"2017-03-18T12:00:38Z","updated_at":"2018-05-22T10:35:24Z","due_on":"2017-09-30T07:00:00Z","closed_at":"2017-09-30T13:33:53Z"},"comments":3,"created_at":"2017-09-06T07:40:22Z","updated_at":"2017-09-14T17:02:55Z","closed_at":"2017-09-14T17:02:55Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"> What is your rclone version (eg output from `rclone -V`)\r\n\r\n2017/09/04 13:21:47 DEBUG : rclone: Version \"v1.37\" starting with parameters [\"rclone\" \"--fast-list\" \"--verbose\" \"--verbose\" \"--buffer-size=256M\" \"--checkers=64\" \"--transfers=32\" \"--b2-chunk-size=256M\" \"--b2-upload-cutoff=256M\" \"copy\" \"/Volumes/xxx/xxx.tar.gz\" \"crypt_backblaze:xxx/\"]\r\n\r\n> Which OS you are using and how many bits (eg Windows 7, 64 bit)\r\n\r\nmacOS 10.12.6 running on a MacBook Pro 11,3 (late 2013)\r\n\r\n> Which cloud storage system are you using? (eg Google Drive)\r\n\r\nBackblaze B2 with crypt (standard filename encryption, underlying remote includes a path (backblaze:bucket))\r\n\r\n> The command you were trying to run (eg `rclone copy /tmp remote:tmp`)\r\n\r\nrclone copy xxx.tar.gz crypt_backblaze:xxx/\r\n\r\nWhere xxx.tar.gz is a ~200GB file on a VeraCrypt whole disk encryption USB 3.0 volume.\r\nWhere xxx/ is an existing folder in the crypt bucket.\r\nSee above for parameters used.\r\n\r\n> A log from the command with the `-vv` flag (eg output from `rclone -vv copy /tmp remote:tmp`)\r\n\r\nA large file / chunked copy operation has failed after running for ~27 hours. The logs show that some chunks began to fail after 24 hours with the B2 response 401 expired_auth_token. Other chunks uploaded after the first B2 401 response were successfully uploaded. Eventually a B2 500 internal_error response was received which triggered a low level retry cycle from rclon. This failed with a broken pipe and the operation was retried, my internet connection did not drop (router shows continuous DSL uptime with no errors recorded).\r\n\r\nI've previously used the same version of rclone and parameters to upload a similar size archive. This worked fine. I'm not sure if this is the same underlying issue fixed in rclone v1.36 (ticket #825) which explains the B2 401 responses, or an example of B2 API rate limiting which may explain the B2 500 responses and broken pipe. Let me know if you need anything else, and thanks for all your hard work with rclone. It makes (encrypted) cloud storage straightforward. Logs below -\r\n\r\n```\r\n2017/09/05 14:18:54 DEBUG : xxx: Done sending chunk 475\r\n2017/09/05 14:18:55 DEBUG : xxx: Sending chunk 511 length 268435456\r\n2017/09/05 14:18:55 DEBUG : xxx: Didn't find object to account part transfer\r\n2017/09/05 14:18:55 DEBUG : B2 bucket xxx path xxx/: Unauthorized: Authorization token has expired (401 expired_auth_token)\r\n2017/09/05 14:18:56 DEBUG : xxx: Clearing part upload URL because of error: Authorization token has expired (401 expired_auth_token)\r\n2017/09/05 14:18:56 DEBUG : pacer: Rate limited, increasing sleep to 20ms\r\n2017/09/05 14:18:56 DEBUG : pacer: low level retry 1/10 (error Authorization token has expired (401 expired_auth_token))\r\n2017/09/05 14:18:56 DEBUG : xxx: Sending chunk 511 length 268435456\r\n2017/09/05 14:18:56 DEBUG : pacer: Reducing sleep to 10ms\r\n2017/09/05 14:18:56 DEBUG : xxx: Didn't find object to account part transfer\r\n\r\n2017/09/05 14:25:31 DEBUG : xxx: Done sending chunk 491\r\n2017/09/05 14:25:32 DEBUG : xxx: Sending chunk 513 length 268435456\r\n2017/09/05 14:25:32 DEBUG : xxx: Didn't find object to account part transfer\r\n2017/09/05 14:25:39 DEBUG : xxx: Done sending chunk 473\r\n2017/09/05 14:25:43 DEBUG : xxx: Sending chunk 514 length 268435456\r\n2017/09/05 14:25:43 DEBUG : xxx: Didn't find object to account part transfer\r\n2017/09/05 14:25:43 DEBUG : B2 bucket xxx path xxx/: Unauthorized: Authorization token has expired (401 expired_auth_token)\r\n2017/09/05 14:25:44 DEBUG : xxx: Clearing part upload URL because of error: Authorization token has expired (401 expired_auth_token)\r\n2017/09/05 14:25:44 DEBUG : pacer: Rate limited, increasing sleep to 20ms\r\n2017/09/05 14:25:44 DEBUG : pacer: low level retry 1/10 (error Authorization token has expired (401 expired_auth_token))\r\n2017/09/05 14:25:44 DEBUG : xxx: Sending chunk 514 length 268435456\r\n2017/09/05 14:25:45 DEBUG : pacer: Reducing sleep to 10ms\r\n2017/09/05 14:25:45 DEBUG : xxx: Didn't find object to account part transfer\r\n\r\n2017/09/05 14:29:14 DEBUG : xxx: Done sending chunk 478\r\n2017/09/05 14:29:14 DEBUG : xxx: Sending chunk 515 length 268435456\r\n2017/09/05 14:29:14 DEBUG : xxx: Didn't find object to account part transfer\r\n2017/09/05 14:29:15 DEBUG : B2 bucket xxx path xxx/: Unauthorized: Authorization token has expired (401 expired_auth_token)\r\n2017/09/05 14:29:16 DEBUG : xxx: Clearing part upload URL because of error: Authorization token has expired (401 expired_auth_token)\r\n2017/09/05 14:29:16 DEBUG : pacer: Rate limited, increasing sleep to 20ms\r\n2017/09/05 14:29:16 DEBUG : pacer: low level retry 1/10 (error Authorization token has expired (401 expired_auth_token))\r\n2017/09/05 14:29:16 DEBUG : xxx: Sending chunk 515 length 268435456\r\n2017/09/05 14:29:16 DEBUG : pacer: Reducing sleep to 10ms\r\n2017/09/05 14:29:16 DEBUG : xxx: Didn't find object to account part transfer\r\n2017/09/05 14:29:42 DEBUG : xxx: Done sending chunk 477\r\n2017/09/05 14:29:43 DEBUG : xxx: Sending chunk 516 length 268435456\r\n2017/09/05 14:29:43 DEBUG : xxx: Didn't find object to account part transfer\r\n2017/09/05 14:29:43 DEBUG : B2 bucket xxx path xxx/: Unauthorized: Authorization token has expired (401 expired_auth_token)\r\n2017/09/05 14:29:44 DEBUG : xxx: Clearing part upload URL because of error: Authorization token has expired (401 expired_auth_token)\r\n2017/09/05 14:29:44 DEBUG : pacer: Rate limited, increasing sleep to 20ms\r\n2017/09/05 14:29:44 DEBUG : pacer: low level retry 1/10 (error Authorization token has expired (401 expired_auth_token))\r\n2017/09/05 14:29:44 DEBUG : xxx: Sending chunk 516 length 268435456\r\n2017/09/05 14:29:45 DEBUG : pacer: Reducing sleep to 10ms\r\n2017/09/05 14:29:45 DEBUG : xxx: Didn't find object to account part transfer\r\n2017/09/05 14:29:46 DEBUG : B2 bucket xxx path xxx/: Setting sleep to 1s after error: c001_v0001044_t0004 is too busy (503 service_unavailable)\r\n2017/09/05 14:29:46 DEBUG : xxx: Clearing part upload URL because of error: c001_v0001044_t0004 is too busy (503 service_unavailable)\r\n2017/09/05 14:29:46 DEBUG : pacer: Rate limited, increasing sleep to 1s\r\n2017/09/05 14:29:46 DEBUG : pacer: low level retry 2/10 (error c001_v0001044_t0004 is too busy (503 service_unavailable))\r\n2017/09/05 14:29:46 DEBUG : xxx: Sending chunk 516 length 268435456\r\n2017/09/05 14:29:47 DEBUG : pacer: Reducing sleep to 500ms\r\n2017/09/05 14:29:47 DEBUG : xxx: Didn't find object to account part transfer\r\n\r\n2017/09/05 14:30:35 DEBUG : pacer: Reducing sleep to 250ms\r\n2017/09/05 14:30:35 DEBUG : xxx: Done sending chunk 496\r\n2017/09/05 14:30:36 DEBUG : xxx: Sending chunk 517 length 268435456\r\n2017/09/05 14:30:36 DEBUG : xxx: Didn't find object to account part transfer\r\n\r\n2017/09/05 17:32:44 DEBUG : xxx: Clearing part upload URL because of error: Interrupted (500 internal_error)\r\n2017/09/05 17:32:44 DEBUG : pacer: Rate limited, increasing sleep to 20ms\r\n2017/09/05 17:32:44 DEBUG : pacer: low level retry 1/10 (error Interrupted (500 internal_error))\r\n2017/09/05 17:32:44 DEBUG : xxx: Sending chunk 578 length 268435456\r\n2017/09/05 17:32:44 DEBUG : xxx: Clearing part upload URL because of error: Interrupted (500 internal_error)\r\n2017/09/05 17:32:44 DEBUG : pacer: Rate limited, increasing sleep to 40ms\r\n2017/09/05 17:32:44 DEBUG : pacer: low level retry 1/10 (error Interrupted (500 internal_error))\r\n2017/09/05 17:32:44 DEBUG : xxx: Sending chunk 548 length 268435456\r\n2017/09/05 17:32:45 DEBUG : pacer: Reducing sleep to 20ms\r\n2017/09/05 17:32:45 DEBUG : xxx: Didn't find object to account part transfer\r\n2017/09/05 17:32:45 DEBUG : pacer: Reducing sleep to 10ms\r\n2017/09/05 17:32:45 DEBUG : xxx: Didn't find object to account part transfer\r\n2017/09/05 17:32:45 DEBUG : xxx: Error sending chunk 581: Post https://pod-000-1044-19.backblaze.com/b2api/v1/b2_upload_part/xxx write tcp 192.168.0.100:55531->206.190.208.170:443: write: broken pipe\r\n2017/09/05 17:32:46 DEBUG : xxx: Sending chunk 586 length 268435456\r\n2017/09/05 17:32:46 DEBUG : xxx: Didn't find object to account part transfer\r\n2017/09/05 17:32:47 DEBUG : xxx: Error sending chunk 586: Post https://pod-000-1044-19.backblaze.com/b2api/v1/b2_upload_part/xxx dial tcp 206.190.208.170:443: getsockopt: connection refused\r\n```","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/1660/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/1660/timeline","performed_via_github_app":null,"state_reason":"completed"}