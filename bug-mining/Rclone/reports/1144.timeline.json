[{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1469799820","html_url":"https://github.com/rclone/rclone/issues/6846#issuecomment-1469799820","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6846","id":1469799820,"node_id":"IC_kwDOAQ-n5M5Xm12M","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-15T11:03:58Z","updated_at":"2023-03-15T11:03:58Z","body":"Thank you for the nice clear bug report.\r\n\r\nIs this something rclone has enough info to workaround? How could rclone know the destination bucket is object locked? Or should it be part of the config?\r\n\r\nRclone could decide to set the upload cutoff to 0 on this error\r\n\r\n> 2023/03/14 15:24:40 ERROR : Attempt 1/3 failed with 1 errors and: InvalidRequest: Content-MD5 OR x-amz-checksum- HTTP header is required for Put Object requests with Object Lock parameters\r\n> \tstatus code: 400, request id: XQBQGE8MCPMYSNCQ, host id: wKO/SwFouAbXiyzi1jvce4s3zvw2q0PMcp+hbSIOHuSi96pFJ9NzSjfHhzkWluol6nggfZKFRLk=\r\n\r\nThat isn't a very specific error code though: `InvalidRequest`\r\n\r\nI guess at the minimum we could document this.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1469799820/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1470417925","html_url":"https://github.com/rclone/rclone/issues/6846#issuecomment-1470417925","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6846","id":1470417925,"node_id":"IC_kwDOAQ-n5M5XpMwF","user":{"login":"jamshid","id":8549,"node_id":"MDQ6VXNlcjg1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/8549?v=4","gravatar_id":"","url":"https://api.github.com/users/jamshid","html_url":"https://github.com/jamshid","followers_url":"https://api.github.com/users/jamshid/followers","following_url":"https://api.github.com/users/jamshid/following{/other_user}","gists_url":"https://api.github.com/users/jamshid/gists{/gist_id}","starred_url":"https://api.github.com/users/jamshid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamshid/subscriptions","organizations_url":"https://api.github.com/users/jamshid/orgs","repos_url":"https://api.github.com/users/jamshid/repos","events_url":"https://api.github.com/users/jamshid/events{/privacy}","received_events_url":"https://api.github.com/users/jamshid/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-15T17:04:15Z","updated_at":"2023-03-15T17:04:15Z","body":"Yeah unfortunately there's not a specific error and I doubt it's worth adding a separate `GET /?object-lock` of the destination bucket to determine if it's locked.\r\n\r\nIMO rclone should assume the bucket requires PUT to include a Content-MD5. If there is no `X-Amz-Meta-Md5chksum` (i.e. it was not uploaded by rclone) and the ETag is the multipart format with the \"-N\" suffix then it should upload the object as multipart.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1470417925/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jamshid","id":8549,"node_id":"MDQ6VXNlcjg1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/8549?v=4","gravatar_id":"","url":"https://api.github.com/users/jamshid","html_url":"https://github.com/jamshid","followers_url":"https://api.github.com/users/jamshid/followers","following_url":"https://api.github.com/users/jamshid/following{/other_user}","gists_url":"https://api.github.com/users/jamshid/gists{/gist_id}","starred_url":"https://api.github.com/users/jamshid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamshid/subscriptions","organizations_url":"https://api.github.com/users/jamshid/orgs","repos_url":"https://api.github.com/users/jamshid/repos","events_url":"https://api.github.com/users/jamshid/events{/privacy}","received_events_url":"https://api.github.com/users/jamshid/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":8770449033,"node_id":"REFE_lADOAQ-n5M5g0CVtzwAAAAIKwm6J","url":"https://api.github.com/repos/rclone/rclone/issues/events/8770449033","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"9cd95780a2a906d80f715a74759ae2f2941a1ddc","commit_url":"https://api.github.com/repos/rclone/rclone/commits/9cd95780a2a906d80f715a74759ae2f2941a1ddc","created_at":"2023-03-16T17:54:32Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1472451535","html_url":"https://github.com/rclone/rclone/issues/6846#issuecomment-1472451535","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6846","id":1472451535,"node_id":"IC_kwDOAQ-n5M5Xw9PP","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-16T17:55:20Z","updated_at":"2023-03-16T17:55:20Z","body":"Single part uploads are preferable if at all possible as they have a proper `ETag` and hence an md5sum.\r\n\r\nI guess this is only a problem on a source which doesn't have an MD5SUM. If this is an S3 source, then it will only be for files that have been multipart uploaded.\r\n\r\nThinking about it further (and examining the HTTP headers), if rclone doesn't have an md5sum for the source then the single part uploads are being uploaded without checksum protection which is ultimately what AWS is complaining about.\r\n\r\nI've given that a go here - can you check it out please?\r\n\r\n[v1.63.0-beta.6814.9cd95780a.fix-6846-s3-checksum](https://beta.rclone.org/branch/fix-6846-s3-checksum/v1.63.0-beta.6814.9cd95780a.fix-6846-s3-checksum/) on branch [fix-6846-s3-checksum](https://github.com/rclone/rclone/tree/fix-6846-s3-checksum) (uploaded in 15-30 mins)\r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1472451535/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1472756267","html_url":"https://github.com/rclone/rclone/issues/6846#issuecomment-1472756267","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6846","id":1472756267,"node_id":"IC_kwDOAQ-n5M5XyHor","user":{"login":"jamshid","id":8549,"node_id":"MDQ6VXNlcjg1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/8549?v=4","gravatar_id":"","url":"https://api.github.com/users/jamshid","html_url":"https://github.com/jamshid","followers_url":"https://api.github.com/users/jamshid/followers","following_url":"https://api.github.com/users/jamshid/following{/other_user}","gists_url":"https://api.github.com/users/jamshid/gists{/gist_id}","starred_url":"https://api.github.com/users/jamshid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamshid/subscriptions","organizations_url":"https://api.github.com/users/jamshid/orgs","repos_url":"https://api.github.com/users/jamshid/repos","events_url":"https://api.github.com/users/jamshid/events{/privacy}","received_events_url":"https://api.github.com/users/jamshid/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-16T21:18:46Z","updated_at":"2023-03-16T21:18:46Z","body":"Thanks Nick that was a fast! I just verified it works so looking forward to v1.63.0.\r\n[nohup.txt](https://github.com/rclone/rclone/files/10995937/nohup.txt)\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1472756267/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jamshid","id":8549,"node_id":"MDQ6VXNlcjg1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/8549?v=4","gravatar_id":"","url":"https://api.github.com/users/jamshid","html_url":"https://github.com/jamshid","followers_url":"https://api.github.com/users/jamshid/followers","following_url":"https://api.github.com/users/jamshid/following{/other_user}","gists_url":"https://api.github.com/users/jamshid/gists{/gist_id}","starred_url":"https://api.github.com/users/jamshid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamshid/subscriptions","organizations_url":"https://api.github.com/users/jamshid/orgs","repos_url":"https://api.github.com/users/jamshid/repos","events_url":"https://api.github.com/users/jamshid/events{/privacy}","received_events_url":"https://api.github.com/users/jamshid/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":8777330114,"node_id":"CE_lADOAQ-n5M5g0CVtzwAAAAILK23C","url":"https://api.github.com/repos/rclone/rclone/issues/events/8777330114","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"e5a1bcb1ce771bc80fee0072565bb4bfa1e86dca","commit_url":"https://api.github.com/repos/rclone/rclone/commits/e5a1bcb1ce771bc80fee0072565bb4bfa1e86dca","created_at":"2023-03-17T11:36:12Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1473701697","html_url":"https://github.com/rclone/rclone/issues/6846#issuecomment-1473701697","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6846","id":1473701697,"node_id":"IC_kwDOAQ-n5M5X1udB","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-17T11:36:55Z","updated_at":"2023-03-17T11:36:55Z","body":"Thanks for testing. I've merged this to master now which means it will be in [the latest beta](https://beta.rclone.org/) in 15-30 minutes and released in v1.63.\r\n\r\nI won't put it in a point release as I could see it could break stuff for people (unlikely but I prefer not to take the risk in point releases).","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1473701697/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1477788381","html_url":"https://github.com/rclone/rclone/issues/6846#issuecomment-1477788381","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6846","id":1477788381,"node_id":"IC_kwDOAQ-n5M5YFULd","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-21T12:54:31Z","updated_at":"2023-03-21T12:54:31Z","body":"I had to revert this change in 542677d8074fcac91f1caffdaf9d5576da4012b6 as it is causing lots of integration test failures.\r\n\r\nThe failures are due to two things\r\n\r\n1. It seems that you can't upload multipart uploads with control characters in as this breaks the XML parser. This is a well known bug that amazon even outline here: https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListObjectsV2.html\r\n\r\n> A 200 OK response can contain valid or invalid XML\r\n\r\nI'm not sure what to do about this. This is edge cases certainly but some people will be relying on control characters in names working.\r\n\r\n2. Missing MD5 sums\r\n\r\nSome of the unit tests rely on there being MD5SUMs for uploaded objects. This is more of an rclone problem but may indicate that there is a bigger problem.\r\n\r\n@jamshid - what I can do is put this feature behind an option - what do you think of that idea?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1477788381/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":8805208674,"node_id":"REE_lADOAQ-n5M5g0CVtzwAAAAIM1NJi","url":"https://api.github.com/repos/rclone/rclone/issues/events/8805208674","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"reopened","commit_id":null,"commit_url":null,"created_at":"2023-03-21T12:54:31Z","state_reason":"reopened","performed_via_github_app":null},{"id":8805208745,"node_id":"MEE_lADOAQ-n5M5g0CVtzwAAAAIM1NKp","url":"https://api.github.com/repos/rclone/rclone/issues/events/8805208745","actor":{"login":"jamshid","id":8549,"node_id":"MDQ6VXNlcjg1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/8549?v=4","gravatar_id":"","url":"https://api.github.com/users/jamshid","html_url":"https://github.com/jamshid","followers_url":"https://api.github.com/users/jamshid/followers","following_url":"https://api.github.com/users/jamshid/following{/other_user}","gists_url":"https://api.github.com/users/jamshid/gists{/gist_id}","starred_url":"https://api.github.com/users/jamshid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamshid/subscriptions","organizations_url":"https://api.github.com/users/jamshid/orgs","repos_url":"https://api.github.com/users/jamshid/repos","events_url":"https://api.github.com/users/jamshid/events{/privacy}","received_events_url":"https://api.github.com/users/jamshid/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-03-21T12:54:32Z","performed_via_github_app":null},{"id":8805208755,"node_id":"SE_lADOAQ-n5M5g0CVtzwAAAAIM1NKz","url":"https://api.github.com/repos/rclone/rclone/issues/events/8805208755","actor":{"login":"jamshid","id":8549,"node_id":"MDQ6VXNlcjg1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/8549?v=4","gravatar_id":"","url":"https://api.github.com/users/jamshid","html_url":"https://github.com/jamshid","followers_url":"https://api.github.com/users/jamshid/followers","following_url":"https://api.github.com/users/jamshid/following{/other_user}","gists_url":"https://api.github.com/users/jamshid/gists{/gist_id}","starred_url":"https://api.github.com/users/jamshid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamshid/subscriptions","organizations_url":"https://api.github.com/users/jamshid/orgs","repos_url":"https://api.github.com/users/jamshid/repos","events_url":"https://api.github.com/users/jamshid/events{/privacy}","received_events_url":"https://api.github.com/users/jamshid/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-03-21T12:54:32Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1478769085","html_url":"https://github.com/rclone/rclone/issues/6846#issuecomment-1478769085","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6846","id":1478769085,"node_id":"IC_kwDOAQ-n5M5YJDm9","user":{"login":"jamshid","id":8549,"node_id":"MDQ6VXNlcjg1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/8549?v=4","gravatar_id":"","url":"https://api.github.com/users/jamshid","html_url":"https://github.com/jamshid","followers_url":"https://api.github.com/users/jamshid/followers","following_url":"https://api.github.com/users/jamshid/following{/other_user}","gists_url":"https://api.github.com/users/jamshid/gists{/gist_id}","starred_url":"https://api.github.com/users/jamshid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamshid/subscriptions","organizations_url":"https://api.github.com/users/jamshid/orgs","repos_url":"https://api.github.com/users/jamshid/repos","events_url":"https://api.github.com/users/jamshid/events{/privacy}","received_events_url":"https://api.github.com/users/jamshid/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-22T00:43:13Z","updated_at":"2023-03-22T00:43:13Z","body":"Darn but I understand, that would break scenarios that work now and would require a lot of test changes. \r\n\r\nSure, an option seems better than setting the cutoff. Multipart will only be used when necessary, Content-MD5 won't be lost.\r\n\r\nMaybe something like this?\r\n\r\n`--s3-locked-bucket` to copy any source objects written as multipart to the destination bucket using  a multipart write instead of a single PUT. Objects written as multipart have an Etag that is a composite MD5 of parts followed by a dash and the number of parts e.g. \"25324e31b9dd9ff5358d9fb92f14060c-22\". Use this option when writing to a bucket with a default retention lock, so that multipart is used whenever Content-MD5 cannot be supplied.\r\nThe default is false -- a multipart write is only used if the source object is larger than `--s3-upload-cutoff`.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1478769085/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jamshid","id":8549,"node_id":"MDQ6VXNlcjg1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/8549?v=4","gravatar_id":"","url":"https://api.github.com/users/jamshid","html_url":"https://github.com/jamshid","followers_url":"https://api.github.com/users/jamshid/followers","following_url":"https://api.github.com/users/jamshid/following{/other_user}","gists_url":"https://api.github.com/users/jamshid/gists{/gist_id}","starred_url":"https://api.github.com/users/jamshid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamshid/subscriptions","organizations_url":"https://api.github.com/users/jamshid/orgs","repos_url":"https://api.github.com/users/jamshid/repos","events_url":"https://api.github.com/users/jamshid/events{/privacy}","received_events_url":"https://api.github.com/users/jamshid/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1479401171","html_url":"https://github.com/rclone/rclone/issues/6846#issuecomment-1479401171","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6846","id":1479401171,"node_id":"IC_kwDOAQ-n5M5YLd7T","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-22T11:37:03Z","updated_at":"2023-03-22T11:37:03Z","body":"I guess another option would be to cache the files on disk / in memory and calculate the MD5 sum properly.\r\n\r\nWe are only talking about files less that --s3-upload-cutoff in size which is 200MiB by default.\r\n\r\nWe could reasonably cache `--s3-chunk-size` * `--s3-concurrency` = 5MB * 4 = 20MB of that in memory as a multipart upload would use that much memory.\r\n\r\nI guess we could take that in memory cutoff and cache the file in memory and calculate the md5sum otherwise do a multipart upload.\r\n\r\nThat would most likely fix the  integration tests and be mostly backwards compatible.\r\n\r\nWhat do you think?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1479401171/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1480546500","html_url":"https://github.com/rclone/rclone/issues/6846#issuecomment-1480546500","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6846","id":1480546500,"node_id":"IC_kwDOAQ-n5M5YP1jE","user":{"login":"jamshid","id":8549,"node_id":"MDQ6VXNlcjg1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/8549?v=4","gravatar_id":"","url":"https://api.github.com/users/jamshid","html_url":"https://github.com/jamshid","followers_url":"https://api.github.com/users/jamshid/followers","following_url":"https://api.github.com/users/jamshid/following{/other_user}","gists_url":"https://api.github.com/users/jamshid/gists{/gist_id}","starred_url":"https://api.github.com/users/jamshid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamshid/subscriptions","organizations_url":"https://api.github.com/users/jamshid/orgs","repos_url":"https://api.github.com/users/jamshid/repos","events_url":"https://api.github.com/users/jamshid/events{/privacy}","received_events_url":"https://api.github.com/users/jamshid/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-23T03:18:42Z","updated_at":"2023-03-23T03:18:42Z","body":"That does seem better, avoids user having to specify that the destination is a locked bucket. \r\nHopefully the memory usage doesn't cause problems for users not needing this feature.\r\nThanks you I'll test it whenever it's ready.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1480546500/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jamshid","id":8549,"node_id":"MDQ6VXNlcjg1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/8549?v=4","gravatar_id":"","url":"https://api.github.com/users/jamshid","html_url":"https://github.com/jamshid","followers_url":"https://api.github.com/users/jamshid/followers","following_url":"https://api.github.com/users/jamshid/following{/other_user}","gists_url":"https://api.github.com/users/jamshid/gists{/gist_id}","starred_url":"https://api.github.com/users/jamshid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamshid/subscriptions","organizations_url":"https://api.github.com/users/jamshid/orgs","repos_url":"https://api.github.com/users/jamshid/repos","events_url":"https://api.github.com/users/jamshid/events{/privacy}","received_events_url":"https://api.github.com/users/jamshid/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1706894518","html_url":"https://github.com/rclone/rclone/issues/6846#issuecomment-1706894518","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6846","id":1706894518,"node_id":"IC_kwDOAQ-n5M5lvSS2","user":{"login":"jamshid","id":8549,"node_id":"MDQ6VXNlcjg1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/8549?v=4","gravatar_id":"","url":"https://api.github.com/users/jamshid","html_url":"https://github.com/jamshid","followers_url":"https://api.github.com/users/jamshid/followers","following_url":"https://api.github.com/users/jamshid/following{/other_user}","gists_url":"https://api.github.com/users/jamshid/gists{/gist_id}","starred_url":"https://api.github.com/users/jamshid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamshid/subscriptions","organizations_url":"https://api.github.com/users/jamshid/orgs","repos_url":"https://api.github.com/users/jamshid/repos","events_url":"https://api.github.com/users/jamshid/events{/privacy}","received_events_url":"https://api.github.com/users/jamshid/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-05T15:57:30Z","updated_at":"2023-09-05T15:57:30Z","body":"To be clear this is *not* fixed in v1.63 right? Is it targeted to an upcoming release?","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1706894518/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jamshid","id":8549,"node_id":"MDQ6VXNlcjg1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/8549?v=4","gravatar_id":"","url":"https://api.github.com/users/jamshid","html_url":"https://github.com/jamshid","followers_url":"https://api.github.com/users/jamshid/followers","following_url":"https://api.github.com/users/jamshid/following{/other_user}","gists_url":"https://api.github.com/users/jamshid/gists{/gist_id}","starred_url":"https://api.github.com/users/jamshid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamshid/subscriptions","organizations_url":"https://api.github.com/users/jamshid/orgs","repos_url":"https://api.github.com/users/jamshid/repos","events_url":"https://api.github.com/users/jamshid/events{/privacy}","received_events_url":"https://api.github.com/users/jamshid/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1811819309","html_url":"https://github.com/rclone/rclone/issues/6846#issuecomment-1811819309","issue_url":"https://api.github.com/repos/rclone/rclone/issues/6846","id":1811819309,"node_id":"IC_kwDOAQ-n5M5r_ist","user":{"login":"jamshid","id":8549,"node_id":"MDQ6VXNlcjg1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/8549?v=4","gravatar_id":"","url":"https://api.github.com/users/jamshid","html_url":"https://github.com/jamshid","followers_url":"https://api.github.com/users/jamshid/followers","following_url":"https://api.github.com/users/jamshid/following{/other_user}","gists_url":"https://api.github.com/users/jamshid/gists{/gist_id}","starred_url":"https://api.github.com/users/jamshid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamshid/subscriptions","organizations_url":"https://api.github.com/users/jamshid/orgs","repos_url":"https://api.github.com/users/jamshid/repos","events_url":"https://api.github.com/users/jamshid/events{/privacy}","received_events_url":"https://api.github.com/users/jamshid/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-11-15T05:11:20Z","updated_at":"2023-11-15T05:11:20Z","body":"> The failures are due to two things\r\n> It seems that you can't upload multipart uploads with control characters in as this breaks the XML parser. This is a well known bug that amazon even outline here: https://docs.aws.amazon.com/AmazonS3/latest/API/API_ListObjectsV2.html\r\n> A 200 OK response can contain valid or invalid XML\r\n> I'm not sure what to do about this. This is edge cases certainly but some people will be relying on control characters in names working.\r\n\r\nIf you use `?encoding-type=url` on the listing request (and check for the `<EncodingType>url</EncodingType>` in the response to be sure the S3-compatible system supports it), doesn't that avoid control characters generating invalid xml? The key names do have to be url-decoded though.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/1811819309/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jamshid","id":8549,"node_id":"MDQ6VXNlcjg1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/8549?v=4","gravatar_id":"","url":"https://api.github.com/users/jamshid","html_url":"https://github.com/jamshid","followers_url":"https://api.github.com/users/jamshid/followers","following_url":"https://api.github.com/users/jamshid/following{/other_user}","gists_url":"https://api.github.com/users/jamshid/gists{/gist_id}","starred_url":"https://api.github.com/users/jamshid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamshid/subscriptions","organizations_url":"https://api.github.com/users/jamshid/orgs","repos_url":"https://api.github.com/users/jamshid/repos","events_url":"https://api.github.com/users/jamshid/events{/privacy}","received_events_url":"https://api.github.com/users/jamshid/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":11635038829,"node_id":"REFE_lADOAQ-n5M5g0CVtzwAAAAK1gJpt","url":"https://api.github.com/repos/rclone/rclone/issues/events/11635038829","actor":{"login":"deyarchit","id":4198802,"node_id":"MDQ6VXNlcjQxOTg4MDI=","avatar_url":"https://avatars.githubusercontent.com/u/4198802?v=4","gravatar_id":"","url":"https://api.github.com/users/deyarchit","html_url":"https://github.com/deyarchit","followers_url":"https://api.github.com/users/deyarchit/followers","following_url":"https://api.github.com/users/deyarchit/following{/other_user}","gists_url":"https://api.github.com/users/deyarchit/gists{/gist_id}","starred_url":"https://api.github.com/users/deyarchit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deyarchit/subscriptions","organizations_url":"https://api.github.com/users/deyarchit/orgs","repos_url":"https://api.github.com/users/deyarchit/repos","events_url":"https://api.github.com/users/deyarchit/events{/privacy}","received_events_url":"https://api.github.com/users/deyarchit/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"e5a1bcb1ce771bc80fee0072565bb4bfa1e86dca","commit_url":"https://api.github.com/repos/deyarchit/rclone/commits/e5a1bcb1ce771bc80fee0072565bb4bfa1e86dca","created_at":"2024-01-30T00:42:30Z","performed_via_github_app":null},{"id":15903852085,"node_id":"LE_lADOAQ-n5M5g0CVtzwAAAAOz8YY1","url":"https://api.github.com/repos/rclone/rclone/issues/events/15903852085","actor":{"login":"edc-w","id":138211970,"node_id":"U_kgDOCDzygg","avatar_url":"https://avatars.githubusercontent.com/u/138211970?v=4","gravatar_id":"","url":"https://api.github.com/users/edc-w","html_url":"https://github.com/edc-w","followers_url":"https://api.github.com/users/edc-w/followers","following_url":"https://api.github.com/users/edc-w/following{/other_user}","gists_url":"https://api.github.com/users/edc-w/gists{/gist_id}","starred_url":"https://api.github.com/users/edc-w/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edc-w/subscriptions","organizations_url":"https://api.github.com/users/edc-w/orgs","repos_url":"https://api.github.com/users/edc-w/repos","events_url":"https://api.github.com/users/edc-w/events{/privacy}","received_events_url":"https://api.github.com/users/edc-w/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2025-01-13T12:01:17Z","label":{"name":"Remote: S3","color":"fbca04"},"performed_via_github_app":null},{"id":15903854662,"node_id":"LE_lADOAQ-n5M5g0CVtzwAAAAOz8ZBG","url":"https://api.github.com/repos/rclone/rclone/issues/events/15903854662","actor":{"login":"edc-w","id":138211970,"node_id":"U_kgDOCDzygg","avatar_url":"https://avatars.githubusercontent.com/u/138211970?v=4","gravatar_id":"","url":"https://api.github.com/users/edc-w","html_url":"https://github.com/edc-w","followers_url":"https://api.github.com/users/edc-w/followers","following_url":"https://api.github.com/users/edc-w/following{/other_user}","gists_url":"https://api.github.com/users/edc-w/gists{/gist_id}","starred_url":"https://api.github.com/users/edc-w/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edc-w/subscriptions","organizations_url":"https://api.github.com/users/edc-w/orgs","repos_url":"https://api.github.com/users/edc-w/repos","events_url":"https://api.github.com/users/edc-w/events{/privacy}","received_events_url":"https://api.github.com/users/edc-w/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2025-01-13T12:01:30Z","label":{"name":"bug","color":"fc2929"},"performed_via_github_app":null}]