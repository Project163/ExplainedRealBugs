{"url":"https://api.github.com/repos/rclone/rclone/issues/7673","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/7673/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/7673/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/7673/events","html_url":"https://github.com/rclone/rclone/issues/7673","id":2181512953,"node_id":"I_kwDOAQ-n5M6CBz75","number":7673,"title":"\"optional feature not implemented\" with crypt-on-sftp in 1.66","user":{"login":"uusijani","id":4244772,"node_id":"MDQ6VXNlcjQyNDQ3NzI=","avatar_url":"https://avatars.githubusercontent.com/u/4244772?v=4","gravatar_id":"","url":"https://api.github.com/users/uusijani","html_url":"https://github.com/uusijani","followers_url":"https://api.github.com/users/uusijani/followers","following_url":"https://api.github.com/users/uusijani/following{/other_user}","gists_url":"https://api.github.com/users/uusijani/gists{/gist_id}","starred_url":"https://api.github.com/users/uusijani/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/uusijani/subscriptions","organizations_url":"https://api.github.com/users/uusijani/orgs","repos_url":"https://api.github.com/users/uusijani/repos","events_url":"https://api.github.com/users/uusijani/events{/privacy}","received_events_url":"https://api.github.com/users/uusijani/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":1710413418,"node_id":"MDU6TGFiZWwxNzEwNDEzNDE4","url":"https://api.github.com/repos/rclone/rclone/labels/Point%20Release%20Candidate","name":"Point Release Candidate","color":"b60205","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/55","html_url":"https://github.com/rclone/rclone/milestone/55","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/55/labels","id":10370070,"node_id":"MI_kwDOAQ-n5M4AnjwW","number":55,"title":"v1.67","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":27,"state":"closed","created_at":"2024-01-03T12:08:00Z","updated_at":"2024-10-17T09:00:34Z","due_on":"2024-04-21T07:00:00Z","closed_at":"2024-07-01T16:37:48Z"},"comments":9,"created_at":"2024-03-12T12:35:25Z","updated_at":"2024-03-22T17:37:07Z","closed_at":"2024-03-22T17:36:37Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n\r\nWe understand you are having a problem with rclone; we want to help you with that!\r\n\r\n**STOP and READ**\r\n**YOUR POST WILL BE REMOVED IF IT IS LOW QUALITY**:\r\nPlease show the effort you've put into solving the problem and please be specific.\r\nPeople are volunteering their time to help! Low effort posts are not likely to get good answers!\r\n\r\nIf you think you might have found a bug, try to replicate it with the latest beta (or stable).\r\nThe update instructions are available at https://rclone.org/commands/rclone_selfupdate/\r\n\r\nIf you can still replicate it or just got a question then please use the rclone forum:\r\n\r\n    https://forum.rclone.org/\r\n\r\nfor a quick response instead of filing an issue on this repo.\r\n\r\nIf nothing else helps, then please fill in the info below which helps us help you.\r\n\r\n**DO NOT REDACT** any information except passwords/keys/personal info.\r\n\r\nYou should use 3 backticks to begin and end your paste to make it readable.\r\n\r\nMake sure to include a log obtained with '-vv'.\r\n\r\nYou can also use '-vv --log-file bug.log' and a service such as https://pastebin.com or https://gist.github.com/\r\n\r\nThank you\r\n\r\nThe Rclone Developers\r\n\r\n-->\r\n\r\n#### What is the problem you are having with rclone?\r\nI'm using a crypt-on-sftp remote, which was working just fine up until v1.65.2. With v1.66, attempts to sync to it now fail with \"optional feature not implemented\". I've not narrowed down whether it's the crypt or the sftp layer, so I'm just reporting my (failing) test case below.\r\n\r\nI did a bisect, and apparently this issue came in at f5f86786b27290964d3b6b29790f1d245f66aa1d (which was a fix for #6685).\r\n\r\n\r\n\r\n#### What is your rclone version (output from `rclone version`)\r\n1.66.0\r\n\r\n\r\n#### Which OS you are using and how many bits (e.g. Windows 7, 64 bit)\r\nUbuntu 22.04 (64-bit)\r\n\r\n\r\n#### Which cloud storage system are you using? (e.g. Google Drive)\r\nsftp\r\n\r\n\r\n#### The command you were trying to run (e.g. `rclone copy /tmp remote:tmp`)\r\n`rclone sync a/ C:`\r\n\r\n\r\n#### Steps to reproduce\r\n1. `rclone --config test.conf config`\r\n2. set up sftp (44) remote called S\r\n   * for test purposes here I'm using localhost as the underlying remote server\r\n   * set user & password\r\n   * leave everything else at defaults\r\n3. set up crypt remote C, with\r\n   * \"S:ftp\" as the underlying remote\r\n   * Very simple filename obfuscation (obfuscate)\r\n   * Encrypt directory names (true)\r\n   * set password, no password2\r\n4. `mkdir -p ftp a/b # on the sftp remote; here I'm using localhost`\r\n5. `touch a/test1 # on the sftp remote`\r\n6. `rclone --config test.conf sync a/ C: -vv # no problems`\r\n7. `touch a/b/test2 # on the sftp remote`\r\n8. `rclone --config test.conf sync a/ C: -vv`\r\n\r\n\r\n#### A log from the command with the `-vv` flag (e.g. output from `rclone -vv copy /tmp remote:tmp`)\r\n\r\n    2024/03/12 14:33:36 DEBUG : rclone: Version \"v1.66.0\" starting with parameters [\"rclone\" \"--config\" \"test.conf\" \"sync\" \"a/\" \"C:\" \"-vv\"]\r\n    2024/03/12 14:33:36 DEBUG : Creating backend with remote \"a/\"\r\n    2024/03/12 14:33:36 DEBUG : Using config file from \"/home/jani/test.conf\"\r\n    2024/03/12 14:33:36 DEBUG : fs cache: renaming cache item \"a/\" to be canonical \"/home/jani/a\"\r\n    2024/03/12 14:33:36 DEBUG : Creating backend with remote \"C:\"\r\n    2024/03/12 14:33:37 DEBUG : Creating backend with remote \"S:ftp\"\r\n    2024/03/12 14:33:37 DEBUG : sftp://jani@localhost:22/ftp: New connection 127.0.0.1:48814->127.0.0.1:22 to \"SSH-2.0-OpenSSH_8.9p1 Ubuntu-3ubuntu0.6\"\r\n    2024/03/12 14:33:37 DEBUG : sftp://jani@localhost:22/ftp: Shell type \"unix\" from config\r\n    2024/03/12 14:33:37 DEBUG : sftp://jani@localhost:22/ftp: Relative path resolved to \"/home/jani/ftp\"\r\n    2024/03/12 14:33:37 DEBUG : sftp://jani@localhost:22/ftp: Using root directory \"/home/jani/ftp\"\r\n    2024/03/12 14:33:37 DEBUG : test1: Size and modification time the same (differ by -995.288851ms, within tolerance 1s)\r\n    2024/03/12 14:33:37 DEBUG : test1: Unchanged skipping\r\n    2024/03/12 14:33:37 DEBUG : b/test2: Need to transfer - File not found at Destination\r\n    2024/03/12 14:33:37 DEBUG : Encrypted drive 'C:': Waiting for checks to finish\r\n    2024/03/12 14:33:37 DEBUG : Encrypted drive 'C:': Waiting for transfers to finish\r\n    2024/03/12 14:33:37 DEBUG : sftp://jani@localhost:22/ftp: Shell path \"/home/jani/ftp/98.g/149.zkyz4.EACoEuq1.vgxzogr\"\r\n    2024/03/12 14:33:37 DEBUG : sftp://jani@localhost:22/ftp: Running remote command: md5sum /home/jani/ftp/98.g/149.zkyz4.EACoEuq1.vgxzogr\r\n    2024/03/12 14:33:37 DEBUG : sftp://jani@localhost:22/ftp: Remote command result: ac83867dee807f03ee4f8f307cda1257  /home/jani/ftp/98.g/149.zkyz4.EACoEuq1.vgxzogr\r\n    2024/03/12 14:33:37 DEBUG : 98.g/149.zkyz4.EACoEuq1.vgxzogr: Parsed hash: ac83867dee807f03ee4f8f307cda1257\r\n    2024/03/12 14:33:37 DEBUG : b/test2.yuwiyok9.partial: md5 = ac83867dee807f03ee4f8f307cda1257 OK\r\n    2024/03/12 14:33:37 DEBUG : b/test2.yuwiyok9.partial: renamed to: b/test2\r\n    2024/03/12 14:33:37 INFO  : b/test2: Copied (new)\r\n    2024/03/12 14:33:37 ERROR : Encrypted drive 'C:': not deleting files as there were IO errors\r\n    2024/03/12 14:33:37 ERROR : Encrypted drive 'C:': not deleting directories as there were IO errors\r\n    2024/03/12 14:33:37 ERROR : Attempt 1/3 failed with 1 errors and: optional feature not implemented\r\n    2024/03/12 14:33:37 DEBUG : test1: Size and modification time the same (differ by -995.288851ms, within tolerance 1s)\r\n    2024/03/12 14:33:37 DEBUG : test1: Unchanged skipping\r\n    2024/03/12 14:33:37 DEBUG : b/test2: Size and modification time the same (differ by -116.891668ms, within tolerance 1s)\r\n    2024/03/12 14:33:37 DEBUG : b/test2: Unchanged skipping\r\n    2024/03/12 14:33:37 DEBUG : Encrypted drive 'C:': Waiting for checks to finish\r\n    2024/03/12 14:33:37 DEBUG : Encrypted drive 'C:': Waiting for transfers to finish\r\n    2024/03/12 14:33:37 ERROR : Encrypted drive 'C:': not deleting files as there were IO errors\r\n    2024/03/12 14:33:37 ERROR : Encrypted drive 'C:': not deleting directories as there were IO errors\r\n    2024/03/12 14:33:37 ERROR : Attempt 2/3 failed with 1 errors and: optional feature not implemented\r\n    2024/03/12 14:33:37 DEBUG : test1: Size and modification time the same (differ by -995.288851ms, within tolerance 1s)\r\n    2024/03/12 14:33:37 DEBUG : test1: Unchanged skipping\r\n    2024/03/12 14:33:37 DEBUG : b/test2: Size and modification time the same (differ by -116.891668ms, within tolerance 1s)\r\n    2024/03/12 14:33:37 DEBUG : b/test2: Unchanged skipping\r\n    2024/03/12 14:33:37 DEBUG : Encrypted drive 'C:': Waiting for checks to finish\r\n    2024/03/12 14:33:37 DEBUG : Encrypted drive 'C:': Waiting for transfers to finish\r\n    2024/03/12 14:33:37 ERROR : Encrypted drive 'C:': not deleting files as there were IO errors\r\n    2024/03/12 14:33:37 ERROR : Encrypted drive 'C:': not deleting directories as there were IO errors\r\n    2024/03/12 14:33:37 ERROR : Attempt 3/3 failed with 1 errors and: optional feature not implemented\r\n    2024/03/12 14:33:37 INFO  : \r\n    Transferred:   \t         32 B / 32 B, 100%, 0 B/s, ETA -\r\n    Errors:                 1 (retrying may help)\r\n    Checks:                 5 / 5, 100%\r\n    Transferred:            1 / 1, 100%\r\n    Elapsed time:         0.3s\r\n\r\n    2024/03/12 14:33:37 DEBUG : 15 go routines active\r\n    2024/03/12 14:33:37 DEBUG : sftp://jani@localhost:22/ftp: Closing 1 unused connections\r\n    2024/03/12 14:33:37 Failed to sync: optional feature not implemented\r\n\r\n<!--- Please keep the note below for others who read your bug report. -->\r\n\r\n#### How to use GitHub\r\n\r\n* Please use the üëç [reaction](https://blog.github.com/2016-03-10-add-reactions-to-pull-requests-issues-and-comments/) to show that you are affected by the same issue.\r\n* Please don't comment if you have no relevant information to add. It's just extra noise for everyone subscribed to this issue.\r\n* Subscribe to receive notifications on status change and new comments.\r\n","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/7673/reactions","total_count":12,"+1":12,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/7673/timeline","performed_via_github_app":null,"state_reason":"completed"}