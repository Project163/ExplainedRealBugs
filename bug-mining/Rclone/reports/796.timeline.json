[{"id":3105353605,"node_id":"MDEyOkxhYmVsZWRFdmVudDMxMDUzNTM2MDU=","url":"https://api.github.com/repos/rclone/rclone/issues/events/3105353605","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-03-06T13:29:56Z","label":{"name":"bug","color":"fc2929"},"performed_via_github_app":null},{"id":3105353607,"node_id":"MDEyOkxhYmVsZWRFdmVudDMxMDUzNTM2MDc=","url":"https://api.github.com/repos/rclone/rclone/issues/events/3105353607","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-03-06T13:29:56Z","label":{"name":"VFS / mount","color":"0e8a16"},"performed_via_github_app":null},{"id":3105353962,"node_id":"MDE1Ok1pbGVzdG9uZWRFdmVudDMxMDUzNTM5NjI=","url":"https://api.github.com/repos/rclone/rclone/issues/events/3105353962","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2020-03-06T13:30:02Z","milestone":{"title":"v1.52"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/595775139","html_url":"https://github.com/rclone/rclone/issues/4039#issuecomment-595775139","issue_url":"https://api.github.com/repos/rclone/rclone/issues/4039","id":595775139,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NTc3NTEzOQ==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-03-06T13:48:11Z","updated_at":"2020-03-06T13:48:11Z","body":"Hmm, have you got the full backtrace?\r\n\r\nI'd like to see if the go routine started at line 242 was still running.\r\n\r\nHow did you get this to happen? Does it happen often?\r\n\r\n> If `timeout` fires before it gets down to `fh.cond.Wait()` on line 254, I believe it will be stuck waiting for a broadcast that will never occur.\r\n\r\nWhat you are saying I think is that the `fh.cond.Broadcast()` on line 248 runs before the `fh.cond.Wait() ` on line 254 and hence the `Wait` waits forever.\r\n\r\nI'll just note that we set `atomic.StoreInt32(&abort, 1) ` on line 246 which is tested at line 252.\r\n\r\nI think this makes the race window quite small, but I think it is still there.\r\n\r\nAny ideas for a fix? Unfortunately go doesn't have a Cond lock with timeout otherwise this would be a lot easier...\r\n\r\nI've re-written this code already as a message sending code which makes it much easier to reason about, but I'm not sure about the performance.\r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/595775139/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/595837371","html_url":"https://github.com/rclone/rclone/issues/4039#issuecomment-595837371","issue_url":"https://api.github.com/repos/rclone/rclone/issues/4039","id":595837371,"node_id":"MDEyOklzc3VlQ29tbWVudDU5NTgzNzM3MQ==","user":{"login":"cafarm","id":797390,"node_id":"MDQ6VXNlcjc5NzM5MA==","avatar_url":"https://avatars.githubusercontent.com/u/797390?v=4","gravatar_id":"","url":"https://api.github.com/users/cafarm","html_url":"https://github.com/cafarm","followers_url":"https://api.github.com/users/cafarm/followers","following_url":"https://api.github.com/users/cafarm/following{/other_user}","gists_url":"https://api.github.com/users/cafarm/gists{/gist_id}","starred_url":"https://api.github.com/users/cafarm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cafarm/subscriptions","organizations_url":"https://api.github.com/users/cafarm/orgs","repos_url":"https://api.github.com/users/cafarm/repos","events_url":"https://api.github.com/users/cafarm/events{/privacy}","received_events_url":"https://api.github.com/users/cafarm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-03-06T16:05:45Z","updated_at":"2020-03-06T16:08:14Z","body":"The full backtrace is below.\r\n\r\n> How did you get this to happen? Does it happen often?\r\n\r\nIt occurs infrequently (probably less than a percent of a percent). We can fairly reliably get it to occur by looping over an `rclone mount` sequence a few hundred times. That sequence will mount a remote, access some data for about a minute, unmount and repeat.\r\n\r\n> I'll just note that we set atomic.StoreInt32(&abort, 1) on line 246 which is tested at line 252.\r\n> \r\n> I think this makes the race window quite small, but I think it is still there.\r\n\r\nIndeed. I think the main goroutine would need to make it to the `waiting for in-sequence...` debug statement before `abort` is set to 1. Then the timeout goroutine would need to set `abort` to 1 and broadcast before the main routine hits wait. It is definitely a small window but the frequency of occurrence seems to indicate the issue would be caused by something with a small window.\r\n\r\n> Any ideas for a fix?\r\n\r\nPerhaps using the `cond` Locker to make sure wait is called before broadcast?\r\n\r\n```go\r\nmaxWait := fh.file.d.vfs.Opt.ReadWait\r\ntimeout := time.NewTimer(maxWait)\r\ndone := make(chan struct{})\r\nabort := int32(0)\r\ngo func() {\r\n\tselect {\r\n\tcase <-timeout.C:\r\n\t\tfh.cond.L.Lock()\r\n\t\t// set abort flag an give all the waiting goroutines a kick on timeout\r\n\t\tatomic.StoreInt32(&abort, 1)\r\n\t\tfs.Debugf(fh.remote, \"aborting in-sequence read wait, off=%d\", off)\r\n\t\tfh.cond.Broadcast()\r\n\t\tfh.cond.L.Unlock()\r\n\tcase <-done:\r\n\t}\r\n}()\r\nfor fh.offset != off && atomic.LoadInt32(&abort) == 0 {\r\n\tfs.Debugf(fh.remote, \"waiting for in-sequence read to %d for %v\", off, maxWait)\r\n\tfh.cond.Wait()\r\n}\r\nfh.cond.L.Unlock()\r\n```\r\n\r\nI'm not super knowledgable about what else is going on in vfs, so I might be making some poor assumptions here.\r\n\r\n```\r\ngoroutine 0 [idle]:\r\nruntime.futex(0x3784e68, 0x80, 0x0, 0x0, 0xc000000000, 0xb251b7, 0x3784700, 0xb0b08d, 0x7ffd10ecb278, 0xb0b3af, ...)\r\n      /usr/local/go/src/runtime/sys_linux_amd64.s:535 +0x21\r\nruntime.futexsleep(0x3784e68, 0x100000000, 0xffffffffffffffff)\r\n      /usr/local/go/src/runtime/os_linux.go:44 +0x46\r\nruntime.notesleep(0x3784e68)\r\n      /usr/local/go/src/runtime/lock_futex.go:151 +0x9f\r\nruntime.stopm()\r\n      /usr/local/go/src/runtime/proc.go:1928 +0xc0\r\nruntime.findrunnable(0xc00004aa00, 0x0)\r\n      /usr/local/go/src/runtime/proc.go:2391 +0x53f\r\nruntime.schedule()\r\n      /usr/local/go/src/runtime/proc.go:2524 +0x2be\r\nruntime.park_m(0xc00009ec00)\r\n      /usr/local/go/src/runtime/proc.go:2610 +0x9d\r\nruntime.mcall(0x213c5c0)\r\n      /usr/local/go/src/runtime/asm_amd64.s:318 +0x5b\r\n \r\ngoroutine 1 [select, 81 minutes]:\r\ngithub.com/rclone/rclone/cmd/mount.Mount(0x2a323c0, 0xc00011e780, 0x7ffd10ecbdf4, 0x8, 0x2592a88, 0x1)\r\n      /go/rclone/cmd/mount/mount.go:150 +0x3db\r\ngithub.com/rclone/rclone/cmd/mountlib.NewMountCommand.func1(0xc000484f00, 0xc000578210, 0x2, 0xb)\r\n      /go/rclone/cmd/mountlib/mount.go:295 +0x3e0\r\ngithub.com/spf13/cobra.(*Command).execute(0xc000484f00, 0xc0000f8b00, 0xb, 0xb, 0xc000484f00, 0xc0000f8b00)\r\n      /root/go/pkg/mod/github.com/spf13/cobra@v0.0.5/command.go:830 +0x8e1\r\ngithub.com/spf13/cobra.(*Command).ExecuteC(0x36fe460, 0x5e616adb, 0x3783a60, 0xc0000ac010)\r\n      /root/go/pkg/mod/github.com/spf13/cobra@v0.0.5/command.go:914 +0x41b\r\ngithub.com/spf13/cobra.(*Command).Execute(...)\r\n      /root/go/pkg/mod/github.com/spf13/cobra@v0.0.5/command.go:864\r\ngithub.com/rclone/rclone/cmd.Main()\r\n      /go/rclone/cmd/cmd.go:506 +0x105\r\nmain.main()\r\n      /go/rclone/rclone.go:14 +0x30\r\n \r\ngoroutine 19 [syscall, 81 minutes]:\r\nos/signal.signal_recv(0xb623b1)\r\n      /usr/local/go/src/runtime/sigqueue.go:147 +0x9c\r\nos/signal.loop()\r\n      /usr/local/go/src/os/signal/signal_unix.go:23 +0x30\r\ncreated by os/signal.init.0\r\n      /usr/local/go/src/os/signal/signal_unix.go:29 +0x4f\r\n \r\ngoroutine 22 [select]:\r\ngo.opencensus.io/stats/view.(*worker).start(0xc0000deeb0)\r\n      /root/go/pkg/mod/go.opencensus.io@v0.22.2/stats/view/worker.go:154 +0x1d6\r\ncreated by go.opencensus.io/stats/view.init.0\r\n      /root/go/pkg/mod/go.opencensus.io@v0.22.2/stats/view/worker.go:32 +0x9a\r\n \r\ngoroutine 51 [syscall, 79 minutes]:\r\nsyscall.Syscall(0x0, 0x9, 0xc000892000, 0x21000, 0xc00075a180, 0x21000, 0xc000892000)\r\n      /usr/local/go/src/syscall/asm_linux_amd64.s:18 +0x5\r\nsyscall.read(0x9, 0xc000892000, 0x21000, 0x21000, 0xc000138310, 0xc0005dad50, 0xb774ca)\r\n      /usr/local/go/src/syscall/zsyscall_linux_amd64.go:732 +0x68\r\nsyscall.Read(0x9, 0xc000892000, 0x21000, 0x21000, 0x50, 0x0, 0x0)\r\n      /usr/local/go/src/syscall/syscall_unix.go:183 +0x5b\r\nbazil.org/fuse.(*Conn).ReadRequest(0xc0000927e0, 0x2628810, 0xc0002e23c0, 0x2a0fba0, 0xc000122310)\r\n      /root/go/pkg/mod/bazil.org/fuse@v0.0.0-20191225233854-3a99aca11732/fuse.go:558 +0x147\r\nbazil.org/fuse/fs.(*Server).Serve(0xc0002e23c0, 0x29e9f20, 0xc0000c4260, 0x0, 0x0)\r\n      /root/go/pkg/mod/bazil.org/fuse@v0.0.0-20191225233854-3a99aca11732/fs/serve.go:413 +0x627\r\ngithub.com/rclone/rclone/cmd/mount.mount.func1(0xc0002e23c0, 0xc0000c4260, 0xc0000927e0, 0xc000138360)\r\n      /go/rclone/cmd/mount/mount.go:96 +0x53\r\ncreated by github.com/rclone/rclone/cmd/mount.mount\r\n      /go/rclone/cmd/mount/mount.go:95 +0x443\r\n \r\ngoroutine 68 [select]:\r\ngithub.com/rclone/rclone/fs/accounting.(*Account).averageLoop(0xc0000bb790)\r\n      /go/rclone/fs/accounting/accounting.go:146 +0x1d7\r\ncreated by github.com/rclone/rclone/fs/accounting.newAccountSizeName\r\n      /go/rclone/fs/accounting/accounting.go:66 +0x3a7\r\n \r\ngoroutine 8157 [sync.Cond.Wait, 79 minutes]:\r\nruntime.goparkunlock(...)\r\n      /usr/local/go/src/runtime/proc.go:310\r\nsync.runtime_notifyListWait(0xc00008e210, 0x16d)\r\n      /usr/local/go/src/runtime/sema.go:510 +0xf8\r\nsync.(*Cond).Wait(0xc00008e200)\r\n      /usr/local/go/src/sync/cond.go:56 +0x8e\r\ngithub.com/rclone/rclone/vfs.(*ReadFileHandle).readAt(0xc000606000, 0xc0001f6000, 0x2000, 0x2000, 0x298b2a000, 0xc0001f6000, 0x17, 0x4)\r\n      /go/rclone/vfs/read.go:253 +0x1dd\r\ngithub.com/rclone/rclone/vfs.(*ReadFileHandle).ReadAt(0xc000606000, 0xc0001f6000, 0x2000, 0x2000, 0x298b2a000, 0x0, 0x0, 0x0)\r\n      /go/rclone/vfs/read.go:213 +0xec\r\ngithub.com/rclone/rclone/cmd/mount.(*FileHandle).Read(0xc00057e240, 0x2a18ce0, 0xc0000aa4c0, 0xc0001222a0, 0xc000682200, 0x1, 0xc000237100)\r\n      /go/rclone/cmd/mount/handle.go:29 +0x3eb\r\nbazil.org/fuse/fs.(*Server).handleRequest(0xc0002e23c0, 0x2a18ce0, 0xc0000aa4c0, 0x29e9f40, 0xc0003198c8, 0xc0000aaac0, 0x2a0fba0, 0xc0001222a0, 0xc000273ec0, 0xc00036ce58, ...)\r\n      /root/go/pkg/mod/bazil.org/fuse@v0.0.0-20191225233854-3a99aca11732/fs/serve.go:1246 +0xe14\r\nbazil.org/fuse/fs.(*Server).serve(0xc0002e23c0, 0x2a0fba0, 0xc0001222a0)\r\n      /root/go/pkg/mod/bazil.org/fuse@v0.0.0-20191225233854-3a99aca11732/fs/serve.go:875 +0x54c\r\nbazil.org/fuse/fs.(*Server).Serve.func1(0xc0002e23c0, 0x2a0fba0, 0xc0001222a0)\r\n      /root/go/pkg/mod/bazil.org/fuse@v0.0.0-20191225233854-3a99aca11732/fs/serve.go:424 +0x8a\r\ncreated by bazil.org/fuse/fs.(*Server).Serve\r\n      /root/go/pkg/mod/bazil.org/fuse@v0.0.0-20191225233854-3a99aca11732/fs/serve.go:422 +0x602\r\n \r\ngoroutine 8112 [select, 79 minutes]:\r\ngithub.com/rclone/rclone/fs/asyncreader.(*AsyncReader).init.func1(0xc0000e4000)\r\n      /go/rclone/fs/asyncreader/asyncreader.go:83 +0x1e2\r\ncreated by github.com/rclone/rclone/fs/asyncreader.(*AsyncReader).init\r\n      /go/rclone/fs/asyncreader/asyncreader.go:78 +0x293\r\n```\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/595837371/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"cafarm","id":797390,"node_id":"MDQ6VXNlcjc5NzM5MA==","avatar_url":"https://avatars.githubusercontent.com/u/797390?v=4","gravatar_id":"","url":"https://api.github.com/users/cafarm","html_url":"https://github.com/cafarm","followers_url":"https://api.github.com/users/cafarm/followers","following_url":"https://api.github.com/users/cafarm/following{/other_user}","gists_url":"https://api.github.com/users/cafarm/gists{/gist_id}","starred_url":"https://api.github.com/users/cafarm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cafarm/subscriptions","organizations_url":"https://api.github.com/users/cafarm/orgs","repos_url":"https://api.github.com/users/cafarm/repos","events_url":"https://api.github.com/users/cafarm/events{/privacy}","received_events_url":"https://api.github.com/users/cafarm/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/630118437","html_url":"https://github.com/rclone/rclone/issues/4039#issuecomment-630118437","issue_url":"https://api.github.com/repos/rclone/rclone/issues/4039","id":630118437,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDExODQzNw==","user":{"login":"Rootax","id":22431162,"node_id":"MDQ6VXNlcjIyNDMxMTYy","avatar_url":"https://avatars.githubusercontent.com/u/22431162?v=4","gravatar_id":"","url":"https://api.github.com/users/Rootax","html_url":"https://github.com/Rootax","followers_url":"https://api.github.com/users/Rootax/followers","following_url":"https://api.github.com/users/Rootax/following{/other_user}","gists_url":"https://api.github.com/users/Rootax/gists{/gist_id}","starred_url":"https://api.github.com/users/Rootax/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rootax/subscriptions","organizations_url":"https://api.github.com/users/Rootax/orgs","repos_url":"https://api.github.com/users/Rootax/repos","events_url":"https://api.github.com/users/Rootax/events{/privacy}","received_events_url":"https://api.github.com/users/Rootax/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-05-18T11:25:09Z","updated_at":"2020-05-18T11:25:09Z","body":"Even if I have no way to help, i hope this problem is not forgotten : )","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/630118437/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Rootax","id":22431162,"node_id":"MDQ6VXNlcjIyNDMxMTYy","avatar_url":"https://avatars.githubusercontent.com/u/22431162?v=4","gravatar_id":"","url":"https://api.github.com/users/Rootax","html_url":"https://github.com/Rootax","followers_url":"https://api.github.com/users/Rootax/followers","following_url":"https://api.github.com/users/Rootax/following{/other_user}","gists_url":"https://api.github.com/users/Rootax/gists{/gist_id}","starred_url":"https://api.github.com/users/Rootax/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rootax/subscriptions","organizations_url":"https://api.github.com/users/Rootax/orgs","repos_url":"https://api.github.com/users/Rootax/repos","events_url":"https://api.github.com/users/Rootax/events{/privacy}","received_events_url":"https://api.github.com/users/Rootax/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3347874735,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDMzNDc4NzQ3MzU=","url":"https://api.github.com/repos/rclone/rclone/issues/events/3347874735","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"47be13b0ee5b90e36b7f60e38c25be5cbb762acb","commit_url":"https://api.github.com/repos/rclone/rclone/commits/47be13b0ee5b90e36b7f60e38c25be5cbb762acb","created_at":"2020-05-18T15:24:40Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/630300706","html_url":"https://github.com/rclone/rclone/issues/4039#issuecomment-630300706","issue_url":"https://api.github.com/repos/rclone/rclone/issues/4039","id":630300706,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDMwMDcwNg==","user":{"login":"Rootax","id":22431162,"node_id":"MDQ6VXNlcjIyNDMxMTYy","avatar_url":"https://avatars.githubusercontent.com/u/22431162?v=4","gravatar_id":"","url":"https://api.github.com/users/Rootax","html_url":"https://github.com/Rootax","followers_url":"https://api.github.com/users/Rootax/followers","following_url":"https://api.github.com/users/Rootax/following{/other_user}","gists_url":"https://api.github.com/users/Rootax/gists{/gist_id}","starred_url":"https://api.github.com/users/Rootax/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rootax/subscriptions","organizations_url":"https://api.github.com/users/Rootax/orgs","repos_url":"https://api.github.com/users/Rootax/repos","events_url":"https://api.github.com/users/Rootax/events{/privacy}","received_events_url":"https://api.github.com/users/Rootax/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-05-18T16:37:07Z","updated_at":"2020-05-18T16:37:07Z","body":"Thx for the commit :)","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/630300706/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Rootax","id":22431162,"node_id":"MDQ6VXNlcjIyNDMxMTYy","avatar_url":"https://avatars.githubusercontent.com/u/22431162?v=4","gravatar_id":"","url":"https://api.github.com/users/Rootax","html_url":"https://github.com/Rootax","followers_url":"https://api.github.com/users/Rootax/followers","following_url":"https://api.github.com/users/Rootax/following{/other_user}","gists_url":"https://api.github.com/users/Rootax/gists{/gist_id}","starred_url":"https://api.github.com/users/Rootax/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rootax/subscriptions","organizations_url":"https://api.github.com/users/Rootax/orgs","repos_url":"https://api.github.com/users/Rootax/repos","events_url":"https://api.github.com/users/Rootax/events{/privacy}","received_events_url":"https://api.github.com/users/Rootax/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3348201403,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDMzNDgyMDE0MDM=","url":"https://api.github.com/repos/rclone/rclone/issues/events/3348201403","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"85b6e968afc3af4e6f9873a640f992a13c7278c0","commit_url":"https://api.github.com/repos/rclone/rclone/commits/85b6e968afc3af4e6f9873a640f992a13c7278c0","created_at":"2020-05-18T16:42:47Z","performed_via_github_app":null},{"id":3348305910,"node_id":"MDExOkNsb3NlZEV2ZW50MzM0ODMwNTkxMA==","url":"https://api.github.com/repos/rclone/rclone/issues/events/3348305910","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"3de9bd9d0411ab9ba78f6072c12a5a89fbeea2e7","commit_url":"https://api.github.com/repos/rclone/rclone/commits/3de9bd9d0411ab9ba78f6072c12a5a89fbeea2e7","created_at":"2020-05-18T17:09:45Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/630318776","html_url":"https://github.com/rclone/rclone/issues/4039#issuecomment-630318776","issue_url":"https://api.github.com/repos/rclone/rclone/issues/4039","id":630318776,"node_id":"MDEyOklzc3VlQ29tbWVudDYzMDMxODc3Ng==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-05-18T17:10:30Z","updated_at":"2020-05-18T17:10:30Z","body":"I managed to replicate this locally\r\n\r\nIn one terminal\r\n\r\n```\r\nmkdir /tmp/src\r\ntruncate -s 1GB /tmp/src/1GB\r\nrclone mount -vv /tmp/src /mnt/tmp/ --vfs-read-wait 0.1ms\r\n```\r\n\r\nAnd in another\r\n\r\n```\r\nfor i in `seq 100` ; do echo $i ; cat /mnt/tmp/1GB >/dev/null ;done\r\n```\r\n\r\nThis locked up after 7,5,19,15,24 iterations in 5 tests so an average of 14 tests....\r\n\r\nI ran this with the fix 300 times without failure for a probability of [2E-277](https://www.wolframalpha.com/input/?i=1-Q%28300%2C14%29) of this being a fluke (everyone loves a poisson distrubution ;-)\r\n\r\nI also ran it with the race detector for 20 iterations (it was veeeery slow).\r\n\r\nI've merged this fix to master now which means it will be in [the latest beta](https://beta.rclone.org) in 15-30 mins and released in v1.50\r\n\r\n\r\n\r\n\r\n\r\nI was hoping to fix this code with a reinvention of how it works but I haven't finished doing that yet...","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/630318776/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}}]