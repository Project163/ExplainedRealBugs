{"url":"https://api.github.com/repos/rclone/rclone/issues/8601","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/8601/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/8601/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/8601/events","html_url":"https://github.com/rclone/rclone/issues/8601","id":3144151204,"node_id":"I_kwDOAQ-n5M67Z_Ck","number":8601,"title":"Rclone unnecessarily wait for token availability when downloading from PikPak","user":{"login":"Neppu-Nep","id":38392948,"node_id":"MDQ6VXNlcjM4MzkyOTQ4","avatar_url":"https://avatars.githubusercontent.com/u/38392948?v=4","gravatar_id":"","url":"https://api.github.com/users/Neppu-Nep","html_url":"https://github.com/Neppu-Nep","followers_url":"https://api.github.com/users/Neppu-Nep/followers","following_url":"https://api.github.com/users/Neppu-Nep/following{/other_user}","gists_url":"https://api.github.com/users/Neppu-Nep/gists{/gist_id}","starred_url":"https://api.github.com/users/Neppu-Nep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Neppu-Nep/subscriptions","organizations_url":"https://api.github.com/users/Neppu-Nep/orgs","repos_url":"https://api.github.com/users/Neppu-Nep/repos","events_url":"https://api.github.com/users/Neppu-Nep/events{/privacy}","received_events_url":"https://api.github.com/users/Neppu-Nep/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":5350216513,"node_id":"LA_kwDOAQ-n5M8AAAABPuXTQQ","url":"https://api.github.com/repos/rclone/rclone/labels/remote:%20PikPak","name":"remote: PikPak","color":"FBCA04","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2025-06-13T16:46:17Z","updated_at":"2025-09-19T03:46:28Z","closed_at":"2025-09-19T03:46:28Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### What is the problem you are having with rclone?\nrclone seems to unnecessarily (?) wait for token availability for downloading files from pikpak.\n\nFrom the logs below, you can see that rclone keep saying \"error no link\" until at some point it started working. So I tried to see what was happening underneath with `--dump bodies`.\n\nIt seems to me like rclone tries to check if the `token` field is filled in download structure used (either `links[\"application/octet-stream\"]` or the item in the `medias` list) depending on what rclone chooses.\n\nRclone keeps giving error and retrying if it receives the following format with an empty token field\n```\n\"links\": {\n      \"application/octet-stream\": {\n          \"expire\": \"2025-06-13T23:59:50.604+08:00\",\n          \"token\": \"\",\n          \"type\": \"\",\n          \"url\": \"https://dl-b07-0409.mypikpak.com/download/?...\"\n      }\n  },\n  \"md5_checksum\": \"\",\n  \"medias\": [\n      {\n          \"category\": \"category_origin\",\n          \"ext_icon\": \"\",\n          \"icon_link\": \"\",\n          \"is_default\": true,\n          \"is_origin\": true,\n          \"is_visible\": true,\n          \"link\": {\n              \"expire\": \"2025-06-13T23:59:50.142+08:00\",\n              \"token\": \"\",\n              \"type\": \"\",\n              \"url\": \"https://dl-b07-0409.mypikpak.com/download/?...\"\n          },\n          \"media_id\": \"...\",\n          \"media_name\": \"Original\",\n          \"need_more_quota\": false,\n          \"priority\": 0,\n          \"redirect_link\": \"\",\n          \"resolution_name\": \"\",\n          \"vip_types\": []\n      }\n  ],\n```\n\nbut it started working as soon as the token field is filled with a token `eyJhbGc...`. Not sure what's the condition for it to get filled? Seems to get filled randomly. \n\nThe issue here is that I can copy and use the download url (the one without a token in the response) directly and download just fine using external downloader or just copy pasting into the browser. So I'm not sure why it is necessary for rclone to wait for the token to be available.\n\nThis time, I got lucky and it started downloading after 7 retries from the log below but sometimes it goes up to 10~20 retries for each file causing unnecessary delays especially if you have lots of files to download.\n\n#### What is your rclone version (output from `rclone version`)\nrclone v1.69.3\n\n\n#### Which OS you are using and how many bits (e.g. Windows 7, 64 bit)\nWindows 11 24H2 (64 bit)\n\n\n#### Which cloud storage system are you using? (e.g. Google Drive)\nPikpak\n\n\n#### The command you were trying to run (e.g. `rclone copy /tmp remote:tmp`)\nrclone copy \"pp:My Pack/Temp.mp4\" . -P\n\n\n#### A log from the command with the `-vv` flag (e.g. output from `rclone -vv copy /tmp remote:tmp`)\n```\nF:\\PikPak>rclone copy \"pp:My Pack/Temp.mp4\" . -P -vvv\n2025/06/13 12:25:41 DEBUG : rclone: Version \"v1.69.3\" starting with parameters [\"rclone\" \"copy\" \"pp:My Pack/Temp.mp4\" \".\" \"-P\" \"-vvv\"]\n2025/06/13 12:25:41 DEBUG : Creating backend with remote \"pp:My Pack/Temp.mp4\"\n2025/06/13 12:25:41 DEBUG : Using config file from \"C:\\\\Users\\\\Nep\\\\AppData\\\\Roaming\\\\rclone\\\\rclone.conf\"\n2025/06/13 12:25:43 DEBUG : fs cache: renaming child cache item \"pp:My Pack/Temp.mp4\" to be canonical for parent \"pp:My Pack\"\n2025/06/13 12:25:43 DEBUG : Creating backend with remote \".\"\n2025/06/13 12:25:43 DEBUG : fs cache: renaming cache item \".\" to be canonical \"//?/F:/PikPak\"\n2025/06/13 12:25:43 DEBUG : Temp.mp4: Need to transfer - File not found at Destination\n2025/06/13 12:25:45 DEBUG : pacer: low level retry 1/10 (error no link)\n2025/06/13 12:25:45 DEBUG : pacer: Rate limited, increasing sleep to 200ms\n2025/06/13 12:25:47 DEBUG : pacer: low level retry 2/10 (error no link)\n2025/06/13 12:25:47 DEBUG : pacer: Rate limited, increasing sleep to 400ms\n2025/06/13 12:25:50 DEBUG : pacer: low level retry 3/10 (error no link)\n2025/06/13 12:25:50 DEBUG : pacer: Rate limited, increasing sleep to 800ms\n2025/06/13 12:25:52 DEBUG : pacer: low level retry 4/10 (error no link)\n2025/06/13 12:25:52 DEBUG : pacer: Rate limited, increasing sleep to 1.6s\n2025/06/13 12:25:54 DEBUG : pacer: low level retry 5/10 (error no link)\n2025/06/13 12:25:54 DEBUG : pacer: Rate limited, increasing sleep to 2s\n2025/06/13 12:25:57 DEBUG : pacer: low level retry 6/10 (error no link)\n2025/06/13 12:25:59 DEBUG : pacer: low level retry 7/10 (error no link)\n2025/06/13 12:26:01 DEBUG : pacer: Reducing sleep to 1.5s\n2025/06/13 12:26:01 DEBUG : Temp.mp4: Using a media link\n2025/06/13 12:26:03 DEBUG : pacer: Reducing sleep to 1.125s\n2025/06/13 12:29:03 DEBUG : Temp.mp4: Src hash empty - aborting Dst hash check\n2025/06/13 12:29:03 DEBUG : Temp.mp4.935f778b.partial: renamed to: Temp.mp4\n2025/06/13 12:29:03 INFO  : Temp.mp4: Copied (new)\nTransferred:      679.445 MiB / 679.445 MiB, 100%, 4.219 MiB/s, ETA 0s\nTransferred:            1 / 1, 100%\nElapsed time:      3m19.8s\n2025/06/13 12:29:03 INFO  :\nTransferred:      679.445 MiB / 679.445 MiB, 100%, 4.219 MiB/s, ETA 0s\nTransferred:            1 / 1, 100%\nElapsed time:      3m19.8s\n\n2025/06/13 12:29:03 DEBUG : 6 go routines active\n```\n\n<!--- Please keep the note below for others who read your bug report. -->\n\n#### How to use GitHub\n\n* Please use the üëç [reaction](https://blog.github.com/2016-03-10-add-reactions-to-pull-requests-issues-and-comments/) to show that you are affected by the same issue.\n* Please don't comment if you have no relevant information to add. It's just extra noise for everyone subscribed to this issue.\n* Subscribe to receive notifications on status change and new comments.\n","closed_by":{"login":"wiserain","id":20354654,"node_id":"MDQ6VXNlcjIwMzU0NjU0","avatar_url":"https://avatars.githubusercontent.com/u/20354654?v=4","gravatar_id":"","url":"https://api.github.com/users/wiserain","html_url":"https://github.com/wiserain","followers_url":"https://api.github.com/users/wiserain/followers","following_url":"https://api.github.com/users/wiserain/following{/other_user}","gists_url":"https://api.github.com/users/wiserain/gists{/gist_id}","starred_url":"https://api.github.com/users/wiserain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wiserain/subscriptions","organizations_url":"https://api.github.com/users/wiserain/orgs","repos_url":"https://api.github.com/users/wiserain/repos","events_url":"https://api.github.com/users/wiserain/events{/privacy}","received_events_url":"https://api.github.com/users/wiserain/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/8601/reactions","total_count":6,"+1":6,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/8601/timeline","performed_via_github_app":null,"state_reason":"completed"}