{"url":"https://api.github.com/repos/rclone/rclone/issues/3330","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/3330/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/3330/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/3330/events","html_url":"https://github.com/rclone/rclone/issues/3330","id":464887117,"node_id":"MDU6SXNzdWU0NjQ4ODcxMTc=","number":3330,"title":"vfs: --vfs-cache-mode writes reads files from source even when they are in the VFS cache","user":{"login":"thestigma","id":11866923,"node_id":"MDQ6VXNlcjExODY2OTIz","avatar_url":"https://avatars.githubusercontent.com/u/11866923?v=4","gravatar_id":"","url":"https://api.github.com/users/thestigma","html_url":"https://github.com/thestigma","followers_url":"https://api.github.com/users/thestigma/followers","following_url":"https://api.github.com/users/thestigma/following{/other_user}","gists_url":"https://api.github.com/users/thestigma/gists{/gist_id}","starred_url":"https://api.github.com/users/thestigma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thestigma/subscriptions","organizations_url":"https://api.github.com/users/thestigma/orgs","repos_url":"https://api.github.com/users/thestigma/repos","events_url":"https://api.github.com/users/thestigma/events{/privacy}","received_events_url":"https://api.github.com/users/thestigma/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":430778096,"node_id":"MDU6TGFiZWw0MzA3NzgwOTY=","url":"https://api.github.com/repos/rclone/rclone/labels/VFS%20/%20mount","name":"VFS / mount","color":"0e8a16","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/38","html_url":"https://github.com/rclone/rclone/milestone/38","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/38/labels","id":4606532,"node_id":"MDk6TWlsZXN0b25lNDYwNjUzMg==","number":38,"title":"v1.51","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":45,"state":"closed","created_at":"2019-08-27T09:35:50Z","updated_at":"2020-02-01T14:10:46Z","due_on":"2020-02-01T08:00:00Z","closed_at":"2020-02-01T14:09:58Z"},"comments":22,"created_at":"2019-07-06T20:15:35Z","updated_at":"2019-12-04T11:05:24Z","closed_at":"2019-12-04T11:05:24Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### What is your current rclone version (output from `rclone version`)?\r\nrclone v1.48.0-063-gd7016866-beta\r\n- os/arch: windows/amd64\r\n- go version: go1.12.3\r\nWindows 10\r\n\r\n#### What problem are you are trying to solve?\r\nCurrently the cache backend's writes = true seems to be designed purely to provide safe upload in case retries are needed. Once files are confirmed uploaded to the destination the written files are removed from cache. (redundant for mounted drives that use mode writes).\r\n\r\nAs far as I can tell the cache can't actually do \"proper\" write caching with retention to quickly re-serve files that were recently written to a remote. Nor can the VFS cache apparently. That seems to be an important missing feature. Re-accessing uploaded files not long after they were uploaded I think is fairly frequent use-case for many - not to mention massively useful if you want to sync one remote to several other remotes. There should be no need to re-download such recently uploaded files if you just set up the cache to be large enough.\r\n\r\n#### How do you think rclone should be changed to solve that?\r\nIt seems to me like this functionality could be created mostly by shortcutting existing code - hopefully making it not require much work. (perhaps naive...)\r\n\r\nI would recommend adding a flag for \"writes-retention\".\r\nWhen flag is enabled, simply skip the delete/invalidate step in the cache that normally happens after a confirmed successful transfer. The files then remain in cache - and there already exists functionality for serving in-cache files to the user rather than accessing the slower remote - so hopefully that part should require no changes.\r\n\r\nThis is a related issue, but I think the problem was attacked at the wrong place (temp-uploads rather than the writes=true functionality). It makes much more sense to let the cache do the caching, not a temp upload folder:\r\nhttps://github.com/ncw/rclone/issues/2700\r\n\r\n#### How I am prepared to help\r\nI volunteer for any beta testing and bug-hunting you require.\r\nI really don't know if I have the knowhow to mess with the code myself (as I have never used go).","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/3330/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/3330/timeline","performed_via_github_app":null,"state_reason":"completed"}