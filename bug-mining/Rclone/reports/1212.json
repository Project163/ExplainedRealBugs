{"url":"https://api.github.com/repos/rclone/rclone/issues/7350","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/7350/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/7350/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/7350/events","html_url":"https://github.com/rclone/rclone/issues/7350","id":1924458172,"node_id":"I_kwDOAQ-n5M5ytOa8","number":7350,"title":"Reduce RAM usage by relying on temp files","user":{"login":"maxim","id":7758,"node_id":"MDQ6VXNlcjc3NTg=","avatar_url":"https://avatars.githubusercontent.com/u/7758?v=4","gravatar_id":"","url":"https://api.github.com/users/maxim","html_url":"https://github.com/maxim","followers_url":"https://api.github.com/users/maxim/followers","following_url":"https://api.github.com/users/maxim/following{/other_user}","gists_url":"https://api.github.com/users/maxim/gists{/gist_id}","starred_url":"https://api.github.com/users/maxim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxim/subscriptions","organizations_url":"https://api.github.com/users/maxim/orgs","repos_url":"https://api.github.com/users/maxim/repos","events_url":"https://api.github.com/users/maxim/events{/privacy}","received_events_url":"https://api.github.com/users/maxim/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399007,"node_id":"MDU6TGFiZWw4NjM5OTAwNw==","url":"https://api.github.com/repos/rclone/rclone/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/53","html_url":"https://github.com/rclone/rclone/milestone/53","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/53/labels","id":9606295,"node_id":"MI_kwDOAQ-n5M4AkpSX","number":53,"title":"v1.65","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":1,"closed_issues":7,"state":"closed","created_at":"2023-07-01T14:43:56Z","updated_at":"2025-07-17T19:38:12Z","due_on":"2023-11-03T07:00:00Z","closed_at":"2024-01-03T12:07:28Z"},"comments":7,"created_at":"2023-10-03T16:00:42Z","updated_at":"2023-11-20T18:07:14Z","closed_at":"2023-11-20T18:07:14Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### The associated forum post URL from `https://forum.rclone.org`\r\n\r\nhttps://forum.rclone.org/t/1-64-0-and-latest-beta-1-65-0-both-crash-on-rclone-crypt-sync-b2-on-large-files/41987\r\n\r\n#### What is your current rclone version (output from `rclone version`)?\r\n\r\n```\r\nrclone v1.65.0-beta.7391.55c3c221b.fix-b2-upload-url-lock\r\n- os/version: ubuntu 22.04 (64 bit)\r\n- os/kernel: 5.15.0-84-generic (x86_64)\r\n- os/type: linux\r\n- os/arch: amd64\r\n- go/version: go1.21.1\r\n- go/linking: static\r\n- go/tags: none\r\n```\r\n\r\n#### What problem are you are trying to solve?\r\n\r\nRclone currently stores chunks in RAM. Recently, RAM usage increased for B2 users, when a refactor changed the RAM formula from\r\n\r\n`--transfers * --b2-chunk-size`\r\n\r\nto\r\n\r\n`--transfers * --b2-chunk-size * --b2-upload-concurrency`\r\n\r\nA possible way to reduce RAM usage across the board is to move most chunk manipulations into temporary files on disk.\r\n\r\n#### How do you think rclone should be changed to solve that?\r\n\r\nTo summarize the forum post, we could add an alternative implementation of `io.ReadSeeker` interface, that reads disk (file handles) rather than objects in RAM.\r\n\r\nIn a more abstract framing: any chunk-data operation that writes/reads RAM could instead do so with temporary files on disk. This includes activity such as caching data coming from network, and hashing data to calculate checksums. Every chunk manipulation should be done via streaming to/from temporary files rather than RAM.\r\n\r\nThis behavior could be exposed to an end user as an option such as `--low-memory` or the opposite `--slow-disk`, depending on which mode ends up being the default.\r\n\r\n\r\n#### How to use GitHub\r\n\r\n* Please use the üëç [reaction](https://blog.github.com/2016-03-10-add-reactions-to-pull-requests-issues-and-comments/) to show that you are affected by the same issue.\r\n* Please don't comment if you have no relevant information to add. It's just extra noise for everyone subscribed to this issue.\r\n* Subscribe to receive notifications on status change and new comments.\r\n","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/7350/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/7350/timeline","performed_via_github_app":null,"state_reason":"completed"}