{"url":"https://api.github.com/repos/rclone/rclone/issues/3967","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/3967/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/3967/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/3967/events","html_url":"https://github.com/rclone/rclone/issues/3967","id":565426326,"node_id":"MDU6SXNzdWU1NjU0MjYzMjY=","number":3967,"title":"Inefficient memory allocations during S3 multipart uploads","user":{"login":"zimnx","id":3951334,"node_id":"MDQ6VXNlcjM5NTEzMzQ=","avatar_url":"https://avatars.githubusercontent.com/u/3951334?v=4","gravatar_id":"","url":"https://api.github.com/users/zimnx","html_url":"https://github.com/zimnx","followers_url":"https://api.github.com/users/zimnx/followers","following_url":"https://api.github.com/users/zimnx/following{/other_user}","gists_url":"https://api.github.com/users/zimnx/gists{/gist_id}","starred_url":"https://api.github.com/users/zimnx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zimnx/subscriptions","organizations_url":"https://api.github.com/users/zimnx/orgs","repos_url":"https://api.github.com/users/zimnx/repos","events_url":"https://api.github.com/users/zimnx/events{/privacy}","received_events_url":"https://api.github.com/users/zimnx/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399007,"node_id":"MDU6TGFiZWw4NjM5OTAwNw==","url":"https://api.github.com/repos/rclone/rclone/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null},{"id":314138213,"node_id":"MDU6TGFiZWwzMTQxMzgyMTM=","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20S3","name":"Remote: S3","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/39","html_url":"https://github.com/rclone/rclone/milestone/39","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/39/labels","id":4787007,"node_id":"MDk6TWlsZXN0b25lNDc4NzAwNw==","number":39,"title":"v1.52","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":35,"state":"closed","created_at":"2019-10-26T17:18:37Z","updated_at":"2020-05-29T14:52:38Z","due_on":"2020-03-14T07:00:00Z","closed_at":"2020-05-29T14:52:38Z"},"comments":2,"created_at":"2020-02-14T16:19:57Z","updated_at":"2020-02-24T12:32:38Z","closed_at":"2020-02-24T12:32:38Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### What is the problem you are having with rclone?\r\nWhen uploading big files to S3 storage, memory graphs looks like a rollercoaster. Each upload request allocates his own memory buffers for chunks, and once file is uploaded they are garbaged.\r\n![heap_released_bytes](https://user-images.githubusercontent.com/3951334/74548379-0483a080-4f4e-11ea-8a07-b5af1a139da1.png)\r\nIn total allocation space per function graph, we can see that multipart upload allocated 14GB in total throught workflow. This should be constant and equal to number of concurrent requests times chunk size.\r\n![Selection_027](https://user-images.githubusercontent.com/3951334/74548441-2b41d700-4f4e-11ea-8d89-77116c5159f0.png)\r\n\r\n#### What is your rclone version (output from `rclone version`)\r\nmaster\r\n\r\n####  Which cloud storage system are you using? (eg Google Drive)\r\nS3\r\n\r\n","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/3967/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/3967/timeline","performed_via_github_app":null,"state_reason":"completed"}