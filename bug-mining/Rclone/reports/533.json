{"url":"https://api.github.com/repos/rclone/rclone/issues/2653","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/2653/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/2653/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/2653/events","html_url":"https://github.com/rclone/rclone/issues/2653","id":370033218,"node_id":"MDU6SXNzdWUzNzAwMzMyMTg=","number":2653,"title":"azureblob: a file of exactly the chunk size can't be uploaded","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":1043114791,"node_id":"MDU6TGFiZWwxMDQzMTE0Nzkx","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20Azure%20Blob","name":"Remote: Azure Blob","color":"fbca04","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/31","html_url":"https://github.com/rclone/rclone/milestone/31","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/31/labels","id":3430251,"node_id":"MDk6TWlsZXN0b25lMzQzMDI1MQ==","number":31,"title":"v1.44","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":39,"state":"closed","created_at":"2018-06-17T16:06:43Z","updated_at":"2018-12-20T12:12:18Z","due_on":"2018-10-13T07:00:00Z","closed_at":"2018-10-19T14:55:35Z"},"comments":0,"created_at":"2018-10-15T07:31:47Z","updated_at":"2018-10-15T08:07:03Z","closed_at":"2018-10-15T08:07:03Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"```\r\ntruncate -s 4M 4M\r\nrclone -vv copyto --azureblob-chunk-size 4M  --azureblob-upload-cutoff 100M 4M azure:rclone-test1/4M.11\r\n```\r\n\r\nWhich produces the error\r\n\r\n```\r\n2018/10/15 08:12:50 ERROR : 4M: Failed to copy: -> github.com/ncw/rclone/vendor/github.com/Azure/azure-storage-blob-go/2018-03-28/azblob.NewResponseError, /home/ncw/go/src/github.com/ncw/rclone/vendor/github.com/Azure/azure-storage-blob-go/2018-03-28/azblob/zz_generated_response_error.go:28\r\n===== RESPONSE ERROR (ServiceCode=Md5Mismatch) =====\r\nDescription=The MD5 value specified in the request did not match with the MD5 value calculated by the server.\r\nRequestId:a8b67947-601e-0057-6e56-647399000000\r\nTime:2018-10-15T07:12:50.1784098Z, Details: \r\n   Code: Md5Mismatch\r\n   ServerCalculatedMd5: 1B2M2Y8AsgTpgAmY7PhCfg==\r\n   UserSpecifiedMd5: tc+p1sj+vWGPkawoQ9UKHA==\r\n   PUT https://rclone.blob.core.windows.net/rclone-test1/4M.11?timeout=61\r\n   Authorization: REDACTED\r\n   Content-Length: [0]\r\n   User-Agent: [Azure-Storage/0.1 (go1.11; linux)]\r\n   X-Ms-Blob-Cache-Control: []\r\n   X-Ms-Blob-Content-Disposition: []\r\n   X-Ms-Blob-Content-Encoding: []\r\n   X-Ms-Blob-Content-Language: []\r\n   X-Ms-Blob-Content-Md5: [tc+p1sj+vWGPkawoQ9UKHA==]\r\n   X-Ms-Blob-Content-Type: [application/octet-stream]\r\n   X-Ms-Blob-Type: [BlockBlob]\r\n   X-Ms-Client-Request-Id: [f2406fff-cd95-43da-6caf-4859f52144d0]\r\n   X-Ms-Date: [Mon, 15 Oct 2018 07:12:50 GMT]\r\n   X-Ms-Meta-Mtime: [2018-10-15T08:11:58.111712681+01:00]\r\n   X-Ms-Version: [2018-03-28]\r\n   --------------------------------------------------------------------------------\r\n   RESPONSE Status: 400 The MD5 value specified in the request did not match with the MD5 value calculated by the server.\r\n   Content-Length: [405]\r\n   Content-Type: [application/xml]\r\n   Date: [Mon, 15 Oct 2018 07:12:49 GMT]\r\n   Server: [Windows-Azure-Blob/1.0 Microsoft-HTTPAPI/2.0]\r\n   X-Ms-Error-Code: [Md5Mismatch]\r\n   X-Ms-Request-Id: [a8b67947-601e-0057-6e56-647399000000]\r\n   X-Ms-Version: [2018-03-28]\r\n```\r\n\r\nThis was tracked down to an off-by-one error in the azureblob SDK and a PR made: https://github.com/Azure/azure-storage-blob-go/pull/75\r\n\r\nAn initial fix for this was made in 6a773289e7b8aab46b2dda0b5fa89fbae022409d however in https://github.com/ncw/rclone/issues/2647#issuecomment-429652655 it was pointed out that this breaks setting the chunk_size to the maximum value.\r\n\r\n```\r\ntruncate -s 101M 101M\r\nrclone --retries 1 --low-level-retries 1 -vv copyto --azureblob-chunk-size 100M  --azureblob-upload-cutoff 200M 101M azure:rclone-test1/101M.1\r\n```\r\n\r\nProduces\r\n\r\n```\r\n2018/10/15 08:29:50 Failed to copyto: -> github.com/ncw/rclone/vendor/github.com/Azure/azure-storage-blob-go/2018-03-28/azblob.NewResponseError, /home/ncw/go/src/github.com/ncw/rclone/vendor/github.com/Azure/azure-storage-blob-go/2018-03-28/azblob/zz_generated_response_error.go:28\r\n===== RESPONSE ERROR (ServiceCode=RequestBodyTooLarge) =====\r\nDescription=The request body is too large and exceeds the maximum permissible limit.\r\nRequestId:17f56a55-601e-003a-7858-64d9b7000000\r\nTime:2018-10-15T07:29:50.6114345Z, Details: \r\n   Code: RequestBodyTooLarge\r\n   MaxLimit: 104857600\r\n   PUT https://rclone.blob.core.windows.net/rclone-test1/101M.1?blockid=nVa7f3paSkVyDiTwJw6atAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA%3D%3D&comp=block&timeout=61\r\n   Authorization: REDACTED\r\n   Content-Length: [104857601]\r\n   User-Agent: [Azure-Storage/0.1 (go1.11; linux)]\r\n   X-Ms-Client-Request-Id: [54c44a61-4b1a-4cd3-6763-aa9feefe8ac2]\r\n   X-Ms-Date: [Mon, 15 Oct 2018 07:29:50 GMT]\r\n   X-Ms-Version: [2018-03-28]\r\n   --------------------------------------------------------------------------------\r\n   RESPONSE Status: 413 The request body is too large and exceeds the maximum permissible limit.\r\n   Content-Length: [290]\r\n   Content-Type: [application/xml]\r\n   Date: [Mon, 15 Oct 2018 07:29:50 GMT]\r\n   Server: [Windows-Azure-Blob/1.0 Microsoft-HTTPAPI/2.0]\r\n   X-Ms-Error-Code: [RequestBodyTooLarge]\r\n   X-Ms-Request-Id: [17f56a55-601e-003a-7858-64d9b7000000]\r\n   X-Ms-Version: [2018-03-28]\r\n```\r\n\r\nIndicating that a better fix is needed.","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/2653/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/2653/timeline","performed_via_github_app":null,"state_reason":"completed"}