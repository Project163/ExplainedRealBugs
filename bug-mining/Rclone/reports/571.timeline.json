[{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/447886535","html_url":"https://github.com/rclone/rclone/issues/2845#issuecomment-447886535","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2845","id":447886535,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Nzg4NjUzNQ==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-17T15:32:26Z","updated_at":"2018-12-17T15:32:26Z","body":"Can you narrow it down to a particular activity? Uploading/downloading/listing etc?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/447886535/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/447936176","html_url":"https://github.com/rclone/rclone/issues/2845#issuecomment-447936176","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2845","id":447936176,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzkzNjE3Ng==","user":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-17T17:52:17Z","updated_at":"2018-12-17T17:52:17Z","body":"This is while uploading on my server. I don't use it for downloads at all.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/447936176/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/447936955","html_url":"https://github.com/rclone/rclone/issues/2845#issuecomment-447936955","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2845","id":447936955,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzkzNjk1NQ==","user":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-17T17:54:31Z","updated_at":"2018-12-17T17:54:31Z","body":"If you tell me what kind of debugging settings I can set I can do that and recreate it pretty quickly","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/447936955/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/448583085","html_url":"https://github.com/rclone/rclone/issues/2845#issuecomment-448583085","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2845","id":448583085,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0ODU4MzA4NQ==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-19T12:43:47Z","updated_at":"2018-12-19T12:43:47Z","body":"The most helpful thing would be if you can get the sever to leak some file handles (more is better!) then kill the process with SIGINT.  This will produce a backtrace to stderr of all the running go-routines - this is usually enough to figure out where the leak comes from.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/448583085/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":2035572274,"node_id":"MDEyOkxhYmVsZWRFdmVudDIwMzU1NzIyNzQ=","url":"https://api.github.com/repos/rclone/rclone/issues/events/2035572274","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2018-12-19T12:44:04Z","label":{"name":"bug","color":"fc2929"},"performed_via_github_app":null},{"id":2035572359,"node_id":"MDE1Ok1pbGVzdG9uZWRFdmVudDIwMzU1NzIzNTk=","url":"https://api.github.com/repos/rclone/rclone/issues/events/2035572359","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2018-12-19T12:44:07Z","milestone":{"title":"v1.46"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/448612255","html_url":"https://github.com/rclone/rclone/issues/2845#issuecomment-448612255","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2845","id":448612255,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0ODYxMjI1NQ==","user":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-19T14:21:02Z","updated_at":"2018-12-19T14:21:02Z","body":"Killing SIGINT isn't producing a back trace.\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/448612255/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/448617828","html_url":"https://github.com/rclone/rclone/issues/2845#issuecomment-448617828","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2845","id":448617828,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0ODYxNzgyOA==","user":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-19T14:38:09Z","updated_at":"2018-12-19T14:39:34Z","body":"I may have figured out what is happening though.  The devices that I have uploading to the FTP server have a AUTO setting where it will figure out if it is a PORT or PASV connection.  These cannot use PORT because of a NAT and a firewall.  It looks like the way it works is for each connection it will try PORT and fallback to PASV.  I changed that setting on those devices specifically to PASV and I don't see file handles creeping up.\r\n\r\nIt looks like on the rclone side when PORT is tried, those connections perhaps don't timeout quick enough and creep up file handles till they do.  But there are more connections coming in than can be timed out.  I've been running now for a bit and the open files count is remaining consistent.\r\n\r\nAlthough this is fixed, vsftpd handles these and doesn't leave them there and rclone should close them before this happens.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/448617828/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/448653807","html_url":"https://github.com/rclone/rclone/issues/2845#issuecomment-448653807","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2845","id":448653807,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0ODY1MzgwNw==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-19T16:18:16Z","updated_at":"2018-12-19T16:18:16Z","body":"> Killing SIGINT isn't producing a back trace.\r\n\r\n:man_facepalming: I mean `kill -QUIT` or `CTRL-\\` - sorry!\r\n\r\n\r\n> It looks like on the rclone side when PORT is tried, those connections perhaps don't timeout quick enough and creep up file handles till they do. But there are more connections coming in than can be timed out. I've been running now for a bit and the open files count is remaining consistent.\r\n\r\nAh I see.  If you can get the backtrace then I can see exactly which bit of code that is.  I suspect the timeout code (in the upstream ftp library) needs fixing, you are correct.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/448653807/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/448689648","html_url":"https://github.com/rclone/rclone/issues/2845#issuecomment-448689648","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2845","id":448689648,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0ODY4OTY0OA==","user":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-19T18:03:37Z","updated_at":"2018-12-19T18:03:37Z","body":"[stack.gz](https://github.com/ncw/rclone/files/2696027/stack.gz)\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/448689648/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/448971397","html_url":"https://github.com/rclone/rclone/issues/2845#issuecomment-448971397","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2845","id":448971397,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0ODk3MTM5Nw==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-20T11:47:37Z","updated_at":"2018-12-20T11:47:37Z","body":"Thanks for that - very helpful :-)\r\n\r\nThere are ~650 of this go routine traceback\r\n\r\n```\r\ngoroutine 8 [semacquire, 51 minutes]:\r\nsync.runtime_SemacquireMutex(0xc0001640bc, 0xc00014c100)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/runtime/sema.go:71 +0x3d\r\nsync.(*Mutex).Lock(0xc0001640b8)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/sync/mutex.go:134 +0xff\r\ngithub.com/ncw/rclone/vendor/github.com/goftp/server.(*ftpPassiveSocket).Close(0xc000164070, 0x0, 0x0)\r\n        /home/travis/gopath/src/github.com/ncw/rclone/vendor/github.com/goftp/server/socket.go:196 +0x42\r\ngithub.com/ncw/rclone/vendor/github.com/goftp/server.(*Conn).Close(0xc00009a680)\r\n        /home/travis/gopath/src/github.com/ncw/rclone/vendor/github.com/goftp/server/conn.go:132 +0x60\r\ngithub.com/ncw/rclone/vendor/github.com/goftp/server.commandQuit.Execute(0xc00009a680, 0x0, 0x0)\r\n        /home/travis/gopath/src/github.com/ncw/rclone/vendor/github.com/goftp/server/cmd.go:671 +0x57\r\ngithub.com/ncw/rclone/vendor/github.com/goftp/server.(*Conn).receiveLine(0xc00009a680, 0xc00038e666, 0x6)\r\n        /home/travis/gopath/src/github.com/ncw/rclone/vendor/github.com/goftp/server/conn.go:165 +0x169\r\ngithub.com/ncw/rclone/vendor/github.com/goftp/server.(*Conn).Serve(0xc00009a680)\r\n        /home/travis/gopath/src/github.com/ncw/rclone/vendor/github.com/goftp/server/conn.go:116 +0x100\r\ncreated by github.com/ncw/rclone/vendor/github.com/goftp/server.(*Server).Serve\r\n        /home/travis/gopath/src/github.com/ncw/rclone/vendor/github.com/goftp/server/server.go:263 +0x21d\r\n```\r\n\r\nAnd the same number of these\r\n\r\n```\r\ngoroutine 43 [IO wait, 51 minutes]:\r\ninternal/poll.runtime_pollWait(0x7f77df9dba20, 0x72, 0x0)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/runtime/netpoll.go:173 +0x66\r\ninternal/poll.(*pollDesc).wait(0xc00014ce98, 0x72, 0xc000149300, 0x0, 0x0)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/internal/poll/fd_poll_runtime.go:85 +0x9a\r\ninternal/poll.(*pollDesc).waitRead(0xc00014ce98, 0xffffffffffffff00, 0x0, 0x0)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/internal/poll/fd_poll_runtime.go:90 +0x3d\r\ninternal/poll.(*FD).Accept(0xc00014ce80, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/internal/poll/fd_unix.go:384 +0x1a0\r\nnet.(*netFD).accept(0xc00014ce80, 0x0, 0x0, 0x0)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/net/fd_unix.go:238 +0x42\r\nnet.(*TCPListener).accept(0xc000142020, 0x42adc2, 0x8, 0xc000149380)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/net/tcpsock_posix.go:139 +0x2e\r\nnet.(*TCPListener).Accept(0xc000142020, 0x12890b8, 0xc000164048, 0x0, 0x0)\r\n        /home/travis/.gimme/versions/go1.11.2.linux.amd64/src/net/tcpsock.go:260 +0x47\r\ngithub.com/ncw/rclone/vendor/github.com/goftp/server.(*ftpPassiveSocket).GoListenAndServe.func1(0xc000164000, 0x13c4860, 0xc000142020)\r\n        /home/travis/gopath/src/github.com/ncw/rclone/vendor/github.com/goftp/server/socket.go:235 +0x65\r\ncreated by github.com/ncw/rclone/vendor/github.com/goftp/server.(*ftpPassiveSocket).GoListenAndServe\r\n        /home/travis/gopath/src/github.com/ncw/rclone/vendor/github.com/goftp/server/socket.go:232 +0x326\r\n```\r\n\r\nThe second of those is waiting for a connection which never comes - I suspect that is the result of the PORT connection which never arrives and I think that is causing the mutex to be locked which is causing the first one.\r\n\r\nCan you try this?\r\n\r\nI set a timeout for 60 seconds (which is the default value vsftp uses) - I think that should fix the issue.\r\n\r\nhttps://beta.rclone.org/branch/v1.45-036-g1d96f9a1-fix-2845-serve-ftp-beta/ (uploaded in 15-30 mins)\r\n\r\nI patched rclone's vendored copy of the upstream library - if it works for you then I'll submit the patch upstream properly.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/448971397/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/449028366","html_url":"https://github.com/rclone/rclone/issues/2845#issuecomment-449028366","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2845","id":449028366,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0OTAyODM2Ng==","user":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-20T15:05:51Z","updated_at":"2018-12-20T15:16:00Z","body":"Testing now..  \r\n\r\nJust thinking though.  Even with a 60 second timeout, its possible to spam a ftp site with port requests and DOS the server  pretty easily by filling open files.  Perhaps a flag to to force PORT,PASV, BOTH?  I wonder how vsftp handles this.  I left vsftpd server on BOTH but I still didn't see the open files climb at all.  Right now open files with rclone is climbing with the new beta (slower though)  and as long as requests come quicker than 1 a minute, it will continue if I understood properly.  Perhaps the timeout should be configurable?\r\n\r\nEDIT:  I suppose it can be iptables rate limited.  Maybe all ftp servers have this issue and rate limit.  Im not sure.\r\n\r\nEDIT2: I bet to protect ftp servers they use this:\r\nmax_per_ip\r\nIf vsftpd is in standalone mode, this is the maximum number of clients which may be connected from the same source internet address. A client will get an error message if they go over this limit.\r\n\r\n\r\n\r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/449028366/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/449034610","html_url":"https://github.com/rclone/rclone/issues/2845#issuecomment-449034610","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2845","id":449034610,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0OTAzNDYxMA==","user":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-20T15:24:54Z","updated_at":"2018-12-20T15:24:54Z","body":"For my needs, I believe the patch addressed the core of this issue.  I still think this should be a flag though to configure it as needed.  \r\n\r\nI think ftp should have a flag to allow for forcing  PORT, PASV, BOTH.  If you agree this should probably be a new issue.  \r\n\r\nI also think **serve** remote in general should have some rate limiting perhaps through a flag of connections per source address to help with DOS (of course it could be done with iptables.  Not sure about windows hence why I say it here).","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/449034610/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"calisro","id":5018276,"node_id":"MDQ6VXNlcjUwMTgyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/5018276?v=4","gravatar_id":"","url":"https://api.github.com/users/calisro","html_url":"https://github.com/calisro","followers_url":"https://api.github.com/users/calisro/followers","following_url":"https://api.github.com/users/calisro/following{/other_user}","gists_url":"https://api.github.com/users/calisro/gists{/gist_id}","starred_url":"https://api.github.com/users/calisro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/calisro/subscriptions","organizations_url":"https://api.github.com/users/calisro/orgs","repos_url":"https://api.github.com/users/calisro/repos","events_url":"https://api.github.com/users/calisro/events{/privacy}","received_events_url":"https://api.github.com/users/calisro/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/453467623","html_url":"https://github.com/rclone/rclone/issues/2845#issuecomment-453467623","issue_url":"https://api.github.com/repos/rclone/rclone/issues/2845","id":453467623,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MzQ2NzYyMw==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-11T10:19:23Z","updated_at":"2019-01-11T10:19:23Z","body":"I sent the patch upstream here: https://github.com/goftp/server/pull/62","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/453467623/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":2070177075,"node_id":"MDExOkNsb3NlZEV2ZW50MjA3MDE3NzA3NQ==","url":"https://api.github.com/repos/rclone/rclone/issues/events/2070177075","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"8d16a5693c3a06cdebfd582ada3e2592f3ca863a","commit_url":"https://api.github.com/repos/rclone/rclone/commits/8d16a5693c3a06cdebfd582ada3e2592f3ca863a","created_at":"2019-01-12T17:11:17Z","state_reason":null,"performed_via_github_app":null},{"id":2207597576,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDIyMDc1OTc1NzY=","url":"https://api.github.com/repos/rclone/rclone/issues/events/2207597576","actor":{"login":"gcornut","id":939567,"node_id":"MDQ6VXNlcjkzOTU2Nw==","avatar_url":"https://avatars.githubusercontent.com/u/939567?v=4","gravatar_id":"","url":"https://api.github.com/users/gcornut","html_url":"https://github.com/gcornut","followers_url":"https://api.github.com/users/gcornut/followers","following_url":"https://api.github.com/users/gcornut/following{/other_user}","gists_url":"https://api.github.com/users/gcornut/gists{/gist_id}","starred_url":"https://api.github.com/users/gcornut/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gcornut/subscriptions","organizations_url":"https://api.github.com/users/gcornut/orgs","repos_url":"https://api.github.com/users/gcornut/repos","events_url":"https://api.github.com/users/gcornut/events{/privacy}","received_events_url":"https://api.github.com/users/gcornut/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"9ae408d2a830a0ddf4dd857c79a07afb0fb488da","commit_url":"https://api.github.com/repos/gcornut/rclone/commits/9ae408d2a830a0ddf4dd857c79a07afb0fb488da","created_at":"2019-03-15T20:54:18Z","performed_via_github_app":null},{"id":2207610645,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDIyMDc2MTA2NDU=","url":"https://api.github.com/repos/rclone/rclone/issues/events/2207610645","actor":{"login":"gcornut","id":939567,"node_id":"MDQ6VXNlcjkzOTU2Nw==","avatar_url":"https://avatars.githubusercontent.com/u/939567?v=4","gravatar_id":"","url":"https://api.github.com/users/gcornut","html_url":"https://github.com/gcornut","followers_url":"https://api.github.com/users/gcornut/followers","following_url":"https://api.github.com/users/gcornut/following{/other_user}","gists_url":"https://api.github.com/users/gcornut/gists{/gist_id}","starred_url":"https://api.github.com/users/gcornut/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gcornut/subscriptions","organizations_url":"https://api.github.com/users/gcornut/orgs","repos_url":"https://api.github.com/users/gcornut/repos","events_url":"https://api.github.com/users/gcornut/events{/privacy}","received_events_url":"https://api.github.com/users/gcornut/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"3b6110987d2672fca406361818b02ee1856c9d59","commit_url":"https://api.github.com/repos/gcornut/rclone/commits/3b6110987d2672fca406361818b02ee1856c9d59","created_at":"2019-03-15T21:00:57Z","performed_via_github_app":null}]