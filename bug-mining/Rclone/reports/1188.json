{"url":"https://api.github.com/repos/rclone/rclone/issues/7247","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/7247/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/7247/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/7247/events","html_url":"https://github.com/rclone/rclone/issues/7247","id":1865249222,"node_id":"I_kwDOAQ-n5M5vLXHG","number":7247,"title":"`--s3-directory-markers` flag  and not working `rclone purge`","user":{"login":"kapitainsky","id":15635386,"node_id":"MDQ6VXNlcjE1NjM1Mzg2","avatar_url":"https://avatars.githubusercontent.com/u/15635386?v=4","gravatar_id":"","url":"https://api.github.com/users/kapitainsky","html_url":"https://github.com/kapitainsky","followers_url":"https://api.github.com/users/kapitainsky/followers","following_url":"https://api.github.com/users/kapitainsky/following{/other_user}","gists_url":"https://api.github.com/users/kapitainsky/gists{/gist_id}","starred_url":"https://api.github.com/users/kapitainsky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kapitainsky/subscriptions","organizations_url":"https://api.github.com/users/kapitainsky/orgs","repos_url":"https://api.github.com/users/kapitainsky/repos","events_url":"https://api.github.com/users/kapitainsky/events{/privacy}","received_events_url":"https://api.github.com/users/kapitainsky/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2023-08-24T14:08:06Z","updated_at":"2023-08-26T10:40:17Z","closed_at":"2023-08-25T16:49:08Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When`--s3-directory-markers` flag is set for S3 compatible remote it is possible to simulate empty \"directories\" by uploading an empty object with a trailing slash when a new directory is created. This works perfectly fine.\r\n\r\nThe problem is when attempting to delete such \"directory\".  It is impossible.\r\n\r\nRemote:\r\n\r\n```\r\n[iDrive]\r\ntype = s3\r\nprovider = IDrive\r\naccess_key_id = XXX\r\nsecret_access_key = XXX\r\nendpoint = XXX\r\ndirectory_markers = true\r\n```\r\n\r\n\r\n```\r\n$ rclone mkdir iDrive:test2/test\r\n\r\n$ rclone lsf iDrive:test2\r\ntest/\r\n\r\n$ rclone purge iDrive:test2/test -vv\r\n2023/08/24 15:03:56 DEBUG : rclone: Version \"v1.63.1\" starting with parameters [\"rclone\" \"purge\" \"iDrive:test2/test\" \"-vv\"]\r\n2023/08/24 15:03:56 DEBUG : Creating backend with remote \"iDrive:test2/test\"\r\n2023/08/24 15:03:56 DEBUG : Using config file from \"/Users/kptsky/.config/rclone/rclone.conf\"\r\n2023/08/24 15:03:56 DEBUG : name = \"iDrive\", root = \"test2/test\", opt = &s3.Options{Provider:\"IDrive\", EnvAuth:false, AccessKeyID:\"XXX\", SecretAccessKey:\"XXX\", Region:\"\", Endpoint:\"p7v1.ldn.idrivee2-40.com\", STSEndpoint:\"\", LocationConstraint:\"\", ACL:\"\", BucketACL:\"\", RequesterPays:false, ServerSideEncryption:\"\", SSEKMSKeyID:\"\", SSECustomerAlgorithm:\"\", SSECustomerKey:\"\", SSECustomerKeyBase64:\"\", SSECustomerKeyMD5:\"\", StorageClass:\"\", UploadCutoff:209715200, CopyCutoff:4999341932, ChunkSize:5242880, MaxUploadParts:10000, DisableChecksum:false, SharedCredentialsFile:\"\", Profile:\"\", SessionToken:\"\", UploadConcurrency:4, ForcePathStyle:true, V2Auth:false, UseAccelerateEndpoint:false, LeavePartsOnError:false, ListChunk:1000, ListVersion:0, ListURLEncode:fs.Tristate{Value:false, Valid:false}, NoCheckBucket:false, NoHead:false, NoHeadObject:false, Enc:0x3000002, MemoryPoolFlushTime:60000000000, MemoryPoolUseMmap:false, DisableHTTP2:false, DownloadURL:\"\", DirectoryMarkers:true, UseMultipartEtag:fs.Tristate{Value:false, Valid:false}, UsePresignedRequest:false, Versions:false, VersionAt:fs.Time{wall:0x0, ext:0, loc:(*time.Location)(nil)}, Decompress:false, MightGzip:fs.Tristate{Value:false, Valid:false}, UseAcceptEncodingGzip:fs.Tristate{Value:false, Valid:false}, NoSystemMetadata:false}\r\n2023/08/24 15:03:56 DEBUG : Resolving service \"s3\" region \"us-east-1\"\r\n2023/08/24 15:03:56 DEBUG : S3 bucket test2 path test: bucket is versioned: false\r\n2023/08/24 15:03:56 DEBUG : Waiting for deletions to finish\r\n2023/08/24 15:03:56 DEBUG : \"\" version false\r\n2023/08/24 15:03:56 DEBUG : : Deleting (id \"\")\r\n2023/08/24 15:03:57 INFO  : : Deleted\r\n2023/08/24 15:03:57 DEBUG : 7 go routines active\r\n\r\n$ rclone lsf  iDrive:test2\r\ntest/\r\n```\r\n\r\nI have tested it with AWS and iDrive remotes.","closed_by":{"login":"kapitainsky","id":15635386,"node_id":"MDQ6VXNlcjE1NjM1Mzg2","avatar_url":"https://avatars.githubusercontent.com/u/15635386?v=4","gravatar_id":"","url":"https://api.github.com/users/kapitainsky","html_url":"https://github.com/kapitainsky","followers_url":"https://api.github.com/users/kapitainsky/followers","following_url":"https://api.github.com/users/kapitainsky/following{/other_user}","gists_url":"https://api.github.com/users/kapitainsky/gists{/gist_id}","starred_url":"https://api.github.com/users/kapitainsky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kapitainsky/subscriptions","organizations_url":"https://api.github.com/users/kapitainsky/orgs","repos_url":"https://api.github.com/users/kapitainsky/repos","events_url":"https://api.github.com/users/kapitainsky/events{/privacy}","received_events_url":"https://api.github.com/users/kapitainsky/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/7247/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/7247/timeline","performed_via_github_app":null,"state_reason":"completed"}