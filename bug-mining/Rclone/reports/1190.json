{"url":"https://api.github.com/repos/rclone/rclone/issues/7259","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/7259/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/7259/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/7259/events","html_url":"https://github.com/rclone/rclone/issues/7259","id":1874030644,"node_id":"I_kwDOAQ-n5M5vs3A0","number":7259,"title":"Serve DLNA not working properly with OneDrive for Business","user":{"login":"dxzdxz1","id":5876517,"node_id":"MDQ6VXNlcjU4NzY1MTc=","avatar_url":"https://avatars.githubusercontent.com/u/5876517?v=4","gravatar_id":"","url":"https://api.github.com/users/dxzdxz1","html_url":"https://github.com/dxzdxz1","followers_url":"https://api.github.com/users/dxzdxz1/followers","following_url":"https://api.github.com/users/dxzdxz1/following{/other_user}","gists_url":"https://api.github.com/users/dxzdxz1/gists{/gist_id}","starred_url":"https://api.github.com/users/dxzdxz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dxzdxz1/subscriptions","organizations_url":"https://api.github.com/users/dxzdxz1/orgs","repos_url":"https://api.github.com/users/dxzdxz1/repos","events_url":"https://api.github.com/users/dxzdxz1/events{/privacy}","received_events_url":"https://api.github.com/users/dxzdxz1/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2023-08-30T16:39:30Z","updated_at":"2023-09-01T17:10:30Z","closed_at":"2023-09-01T15:22:09Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### What is the problem you are having with rclone?\r\n\r\n`rclone serve dlna` is giving me the 'unrecognized file type' error with some files.\r\n\r\n### What is your rclone version (output from `rclone version`)\r\n\r\nrclone v1.63.1\r\nand also\r\nrclone v1.64.0-beta.7299.11eeaaf79\r\n\r\n### Which OS you are using and how many bits (e.g. Windows 7, 64 bit)\r\n\r\n- os/version: Microsoft Windows 11 Pro 23H2 (64 bit)\r\n- os/kernel: 10.0.22631.2215 (x86_64)\r\n\r\n### Which cloud storage system are you using? (e.g. Google Drive)\r\n\r\nOneDrive for Business\r\n\r\n### The command you were trying to run (e.g. `rclone copy /tmp remote:tmp`)\r\n\r\n```\r\ncd /d \"%~dp0\"\r\nstart rclone serve dlna obusiness:/Videos/test ^\r\n--config=rclone.conf ^\r\n--vfs-cache-mode writes ^\r\n--vfs-read-chunk-size-limit 1G ^\r\n--read-only ^\r\n--cache-dir=appdata\\cache ^\r\n--log-level=DEBUG\r\n```\r\n\r\n### A log from the command with the `-vv` flag (e.g. output from `rclone -vv copy /tmp remote:tmp`)\r\n\r\n```\r\n2023/08/30 11:46:25 DEBUG : Creating backend with remote \"obusiness:/Videos/test\"\r\n2023/08/30 11:46:25 DEBUG : Using config file from \"D:\\\\Apps\\\\rClone\\\\rclone.conf\"\r\n2023/08/30 11:46:26 DEBUG : fs cache: renaming cache item \"obusiness:/Videos/test\" to be canonical \"obusiness:Videos/test\"\r\n2023/08/30 11:46:26 DEBUG : OneDrive root 'Videos/test': Next delta token is: \r\n2023/08/30 11:46:26 DEBUG : vfs cache: root is \"D:\\\\Apps\\\\rClone\\\\appdata\\\\cache\"\r\n2023/08/30 11:46:26 DEBUG : vfs cache: data root is \"\\\\\\\\?\\\\D:\\\\Apps\\\\rClone\\\\appdata\\\\cache\\\\vfs\\\\obusiness\\\\Videos\\\\test\"\r\n2023/08/30 11:46:26 DEBUG : vfs cache: metadata root is \"\\\\\\\\?\\\\D:\\\\Apps\\\\rClone\\\\appdata\\\\cache\\\\vfsMeta\\\\obusiness\\\\Videos\\\\test\"\r\n2023/08/30 11:46:26 DEBUG : Creating backend with remote \"D:/Apps/rClone/appdata/cache/vfs/obusiness/Videos/test\"\r\n2023/08/30 11:46:26 DEBUG : fs cache: renaming cache item \"D:/Apps/rClone/appdata/cache/vfs/obusiness/Videos/test\" to be canonical \"//?/D:/Apps/rClone/appdata/cache/vfs/obusiness/Videos/test\"\r\n2023/08/30 11:46:26 DEBUG : Creating backend with remote \"D:/Apps/rClone/appdata/cache/vfsMeta/obusiness/Videos/test\"\r\n2023/08/30 11:46:26 DEBUG : fs cache: renaming cache item \"D:/Apps/rClone/appdata/cache/vfsMeta/obusiness/Videos/test\" to be canonical \"//?/D:/Apps/rClone/appdata/cache/vfsMeta/obusiness/Videos/test\"\r\n2023/08/30 11:46:26 INFO  : vfs cache: cleaned: objects 0 (was 0) in use 0, to upload 0, uploading 0, total size 0 (was 0)\r\n2023/08/30 11:46:26 NOTICE: OneDrive root 'Videos/test': Serving HTTP on 0.0.0.0:7879\r\n2023/08/30 11:46:26 NOTICE: DLNA server on :7879: Started SSDP on Ethernet\r\n2023/08/30 11:46:38 INFO  : /static/ContentDirectory.xml: 192.168.15.3:60226 GET 200\r\n2023/08/30 11:46:38 INFO  : /static/ContentDirectory.xml: 192.168.15.3:60224 GET 200\r\n2023/08/30 11:46:38 INFO  : /static/ConnectionManager.xml: 192.168.15.3:60226 GET 200\r\n2023/08/30 11:46:38 INFO  : /static/ConnectionManager.xml: 192.168.15.3:60224 GET 200\r\n2023/08/30 11:46:38 INFO  : /static/X_MS_MediaReceiverRegistrar.xml: 192.168.15.3:60226 GET 200\r\n2023/08/30 11:46:38 INFO  : /static/X_MS_MediaReceiverRegistrar.xml: 192.168.15.3:60224 GET 200\r\n2023/08/30 11:46:39 ERROR : /: 192.168.15.3:60226 SUBSCRIBE 404\r\n2023/08/30 11:46:39 ERROR : /: 192.168.15.3:60224 SUBSCRIBE 404\r\n2023/08/30 11:46:39 ERROR : /: 192.168.15.3:60230 SUBSCRIBE 404\r\n2023/08/30 11:46:39 ERROR : /: 192.168.15.3:60232 SUBSCRIBE 404\r\n2023/08/30 11:46:43 DEBUG : DLNA server on :7879: unrecognized file type: 10.mkv\r\n2023/08/30 11:46:43 DEBUG : DLNA server on :7879: unrecognized file type: 2.ts\r\n2023/08/30 11:46:43 DEBUG : DLNA server on :7879: unrecognized file type: 5.3gp\r\n2023/08/30 11:46:43 DEBUG : DLNA server on :7879: unrecognized file type: 6.vob\r\n```\r\n\r\nI noticed that most of my files weren't showing on my TV, so I create a test scenario to try to narrow down what's the problem.\r\nI created a folder with 10 files that my TV and my phone can read through DLNA: mkv, mp4, ts, avi, mpg, vob, wmv, webm, mov and 3gp. From these 10 files, 4 are being ignored on both my TV and on VLC for Android: mkv, ts, vob, 3gp\r\n\r\nI've only tested with video files so far, but the problem seems to be the way rclone parses the files from onedrive for business or a problem with onedrive for business itself. I have the same files on my OneDrive personal account, and all of them are playing if I start `rclone serve dlna` using my OneDrive personal config.\r\n\r\nFor instance, if i use `rclone lsjson` to get the info from the files that aren't showing on OneDrive for Business, it shows the following:\r\n\r\n` \"Path\":\"2.ts\",\"Name\":\"2.ts\",\"Size\":1332695387,\"MimeType\":\"application/octet-stream\" `\r\n`\"Path\":\"10.mkv\",\"Name\":\"10.mkv\",\"Size\":1331362846,\"MimeType\":\"application/octet-stream\"`\r\n\r\nAnd if I use `rclone lsjson` for the same file on my personal account, it shows:\r\n\r\n` \"Path\":\"2.ts\",\"Name\":\"2.ts\",\"Size\":1332695387,\"MimeType\":\"video/MP2T\" `\r\n`\"Path\":\"10.mkv\",\"Name\":\"10.mkv\",\"Size\":1331362846,\"MimeType\":\"video/x-matroska\"`\r\n\r\nIs this a problem with rclone or with onedrive? If it's a problem with Onedrive, is there a way to fix using rclone?\r\n\r\nI can also do more tests and provide more logs if necessary. Thanks\r\n‚Äé‚Äé‚Äé‚Äé‚Äé‚Äé‚Äé‚Äé„Ö§\r\n‚Äé‚Äé‚Äé‚Äé‚Äé‚Äé‚Äé‚Äé„Ö§\r\n‚Äé‚Äé‚Äé‚Äé‚Äé‚Äé‚Äé‚Äé„Ö§\r\n‚Äé‚Äé‚Äé‚Äé‚Äé‚Äé‚Äé‚Äé„Ö§\r\n‚Äé‚Äé‚Äé‚Äé‚Äé‚Äé‚Äé‚Äé„Ö§\r\n<!--- Please keep the note below for others who read your bug report. -->\r\n\r\n#### How to use GitHub\r\n\r\n* Please use the üëç [reaction](https://blog.github.com/2016-03-10-add-reactions-to-pull-requests-issues-and-comments/) to show that you are affected by the same issue.\r\n* Please don't comment if you have no relevant information to add. It's just extra noise for everyone subscribed to this issue.\r\n* Subscribe to receive notifications on status change and new comments.\r\n","closed_by":{"login":"dxzdxz1","id":5876517,"node_id":"MDQ6VXNlcjU4NzY1MTc=","avatar_url":"https://avatars.githubusercontent.com/u/5876517?v=4","gravatar_id":"","url":"https://api.github.com/users/dxzdxz1","html_url":"https://github.com/dxzdxz1","followers_url":"https://api.github.com/users/dxzdxz1/followers","following_url":"https://api.github.com/users/dxzdxz1/following{/other_user}","gists_url":"https://api.github.com/users/dxzdxz1/gists{/gist_id}","starred_url":"https://api.github.com/users/dxzdxz1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dxzdxz1/subscriptions","organizations_url":"https://api.github.com/users/dxzdxz1/orgs","repos_url":"https://api.github.com/users/dxzdxz1/repos","events_url":"https://api.github.com/users/dxzdxz1/events{/privacy}","received_events_url":"https://api.github.com/users/dxzdxz1/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/7259/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/7259/timeline","performed_via_github_app":null,"state_reason":"completed"}