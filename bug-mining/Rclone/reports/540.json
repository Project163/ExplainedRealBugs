{"url":"https://api.github.com/repos/rclone/rclone/issues/2691","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/2691/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/2691/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/2691/events","html_url":"https://github.com/rclone/rclone/issues/2691","id":373231904,"node_id":"MDU6SXNzdWUzNzMyMzE5MDQ=","number":2691,"title":"aws s3 - Can't use same remote config and have Object ACL copy cross account.","user":{"login":"bkruger99","id":2036412,"node_id":"MDQ6VXNlcjIwMzY0MTI=","avatar_url":"https://avatars.githubusercontent.com/u/2036412?v=4","gravatar_id":"","url":"https://api.github.com/users/bkruger99","html_url":"https://github.com/bkruger99","followers_url":"https://api.github.com/users/bkruger99/followers","following_url":"https://api.github.com/users/bkruger99/following{/other_user}","gists_url":"https://api.github.com/users/bkruger99/gists{/gist_id}","starred_url":"https://api.github.com/users/bkruger99/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bkruger99/subscriptions","organizations_url":"https://api.github.com/users/bkruger99/orgs","repos_url":"https://api.github.com/users/bkruger99/repos","events_url":"https://api.github.com/users/bkruger99/events{/privacy}","received_events_url":"https://api.github.com/users/bkruger99/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2018-10-23T22:39:01Z","updated_at":"2018-11-02T16:24:03Z","closed_at":"2018-11-02T16:23:40Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"```\r\nrclone v1.44\r\n- os/arch: linux/amd64\r\n- go version: go1.11.1\r\n```\r\n#### What is the problem you are having with rclone?\r\n\r\nYou cannot use a same remote and have Object ACLs copy with AWS S3 cross account.   I am logged into one account, but I have sufficient permissions on a bucket created in a second account to be able to place objects.\r\n\r\nTake the example rclone.conf (identical except for name):\r\n```\r\n[s3-usw2-bofc]\r\ntype = s3\r\nprovider = AWS\r\nenv_auth = true\r\nregion = us-west-2\r\nlocation_constraint = us-west-2\r\nacl = bucket-owner-full-control\r\n\r\n[blah]\r\ntype = s3\r\nprovider = AWS\r\nenv_auth = true\r\nregion = us-west-2\r\nlocation_constraint = us-west-2\r\nacl = bucket-owner-full-control\r\n```\r\n\r\nRunning this command (note the same remote names referenced):\r\n```\r\nroot@jnlp-ondemand-f3xnc:~/.config/rclone# rclone --log-level DEBUG copy s3-usw2-bofc:<REDACTED>/__6z s3-usw2-bofc:bkruger-test/\r\n\r\n2018/10/23 22:07:04 DEBUG : rclone: Version \"v1.44\" starting with parameters [\"rclone\" \"--log-level\" \"DEBUG\" \"copy\" \"s3-usw2-bofc:<REDACTED>/__6z\" \"s3-usw2-bofc:bkruger-test/\"]\r\n2018/10/23 22:07:04 DEBUG : Using config file from \"/home/bkruger/.config/rclone/rclone.conf\"\r\n2018/10/23 22:07:05 DEBUG : pacer: Reducing sleep to 0s\r\n2018/10/23 22:07:05 DEBUG : pacer: Reducing sleep to 0s\r\n2018/10/23 22:07:05 DEBUG : __6z: Couldn't find file - need to transfer\r\n2018/10/23 22:07:05 INFO  : __6z: Copied (server side copy)\r\n2018/10/23 22:07:05 INFO  :\r\nTransferred:   \t         0 / 0 Bytes, -, 0 Bytes/s, ETA -\r\nErrors:                 0\r\nChecks:                 0 / 0, -\r\nTransferred:            1 / 1, 100%\r\nElapsed time:       500ms\r\n\r\n2018/10/23 22:07:05 DEBUG : 4 go routines active\r\n2018/10/23 22:07:05 DEBUG : rclone: Version \"v1.44\" finishing with parameters [\"rclone\" \"--log-level\" \"DEBUG\" \"copy\" \"s3-usw2-bofc:<REDACTED>/__6z\" \"s3-usw2-bofc:bkruger-test/\"]\r\n\r\n```\r\nHas the following S3 permissions on the object:\r\n```\r\nroot@jnlp-ondemand-f3xnc:~/.config/rclone# aws s3api get-object-acl --bucket bkruger-test --key __6z\r\n\r\n{\r\n    \"Owner\": {\r\n        \"DisplayName\": \"<REDACTED>\",\r\n        \"ID\": \"<REDACTED>e0797e78fc\"\r\n    },\r\n    \"Grants\": [\r\n        {\r\n            \"Grantee\": {\r\n                \"Type\": \"CanonicalUser\",\r\n                \"DisplayName\": \"<REDACTED>\",\r\n                \"ID\": \"<REDACTED>e0797e78fc\"\r\n            },\r\n            \"Permission\": \"FULL_CONTROL\"\r\n        }\r\n    ]\r\n}\r\n```\r\n\r\nI'd expect behavior would copy ObjectACL regardless, since I am cloning S3 to S3, but it does not.  In this case, the bucket owner should be added, but it is not.\r\n\r\n**WORKAROUND**:\r\nYou can work around this, by using two different remotes above:\r\n\r\n```\r\nroot@jnlp-ondemand-f3xnc:~/.config/rclone# rclone --log-level DEBUG copy s3-usw2-bofc:<REDACTED>/__6z blah:bkruger-test/\r\n\r\n2018/10/23 22:09:03 DEBUG : rclone: Version \"v1.44\" starting with parameters [\"rclone\" \"--log-level\" \"DEBUG\" \"copy\" \"s3-usw2-bofc:<REDACTED>/__6z\" \"blah:bkruger-test/\"]\r\n2018/10/23 22:09:03 DEBUG : Using config file from \"/home/bkruger/.config/rclone/rclone.conf\"\r\n2018/10/23 22:09:04 DEBUG : pacer: Reducing sleep to 0s\r\n2018/10/23 22:09:04 DEBUG : pacer: Reducing sleep to 0s\r\n2018/10/23 22:09:04 DEBUG : __6z: Modification times differ by 13212h56m2s: 2017-04-21 09:11:04 +0000 UTC, 2018-10-23 22:07:06 +0000 UTC\r\n2018/10/23 22:09:04 INFO  : __6z: Copied (replaced existing)\r\n2018/10/23 22:09:04 INFO  :\r\nTransferred:   \t   10.717M / 10.717 MBytes, 100%, 12.410 MBytes/s, ETA 0s\r\nErrors:                 0\r\nChecks:                 0 / 0, -\r\nTransferred:            1 / 1, 100%\r\nElapsed time:       800ms\r\n\r\n2018/10/23 22:09:04 DEBUG : 6 go routines active\r\n2018/10/23 22:09:04 DEBUG : rclone: Version \"v1.44\" finishing with parameters [\"rclone\" \"--log-level\" \"DEBUG\" \"copy\" \"s3-usw2-bofc:<REDACTED>/__6z\" \"blah:bkruger-test/\"]\r\n```\r\n\r\nThis yields correct result:\r\n```\r\nroot@jnlp-ondemand-f3xnc:~/.config/rclone# aws s3api get-object-acl --bucket bkruger-test --key __6z\r\n{\r\n    \"Owner\": {\r\n        \"DisplayName\": \"<REDACTED>\",\r\n        \"ID\": \"<REDACTED>e0797e78fc\"\r\n    },\r\n    \"Grants\": [\r\n        {\r\n            \"Grantee\": {\r\n                \"Type\": \"CanonicalUser\",\r\n                \"DisplayName\": \"<REDACTED>\",\r\n                \"ID\": \"<REDACTED>e0797e78fc\"\r\n            },\r\n            \"Permission\": \"FULL_CONTROL\"\r\n        },\r\n        {\r\n            \"Grantee\": {\r\n                \"Type\": \"CanonicalUser\",\r\n                \"DisplayName\": \"<REDACTED>\",\r\n                \"ID\": \"<REDACTED>a1f4719d43\"\r\n            },\r\n            \"Permission\": \"FULL_CONTROL\"\r\n        }\r\n    ]\r\n}\r\n```\r\nPerhaps this is a known issue, but it wasn't obvious on the s3 page if it is.   The workaround seems to do the trick, but one would expect the behavior to be correct with a single remote configured.  Due to ability to workaround, minor bug perhaps, but filing report incase someone else gets bit by this one.\r\n\r\n","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/2691/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/2691/timeline","performed_via_github_app":null,"state_reason":"completed"}