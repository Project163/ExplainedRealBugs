{"url":"https://api.github.com/repos/rclone/rclone/issues/7555","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/7555/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/7555/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/7555/events","html_url":"https://github.com/rclone/rclone/issues/7555","id":2071714001,"node_id":"I_kwDOAQ-n5M57e9jR","number":7555,"title":"bisync: retries and delay on locked files","user":{"login":"martind69","id":103326240,"node_id":"U_kgDOBiiiIA","avatar_url":"https://avatars.githubusercontent.com/u/103326240?v=4","gravatar_id":"","url":"https://api.github.com/users/martind69","html_url":"https://github.com/martind69","followers_url":"https://api.github.com/users/martind69/followers","following_url":"https://api.github.com/users/martind69/following{/other_user}","gists_url":"https://api.github.com/users/martind69/gists{/gist_id}","starred_url":"https://api.github.com/users/martind69/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/martind69/subscriptions","organizations_url":"https://api.github.com/users/martind69/orgs","repos_url":"https://api.github.com/users/martind69/repos","events_url":"https://api.github.com/users/martind69/events{/privacy}","received_events_url":"https://api.github.com/users/martind69/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":3427818774,"node_id":"LA_kwDOAQ-n5M7MUF0W","url":"https://api.github.com/repos/rclone/rclone/labels/bisync","name":"bisync","color":"1D76DB","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/54","html_url":"https://github.com/rclone/rclone/milestone/54","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/54/labels","id":9909337,"node_id":"MI_kwDOAQ-n5M4AlzRZ","number":54,"title":"v1.66","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":5,"closed_issues":25,"state":"closed","created_at":"2023-09-11T16:50:18Z","updated_at":"2024-08-15T14:36:39Z","due_on":"2024-02-29T08:00:00Z","closed_at":"2024-03-10T12:33:48Z"},"comments":7,"created_at":"2024-01-09T06:30:19Z","updated_at":"2024-02-12T18:24:56Z","closed_at":"2024-02-12T18:24:55Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"In relation to #7471 i will split off this issue as an extra feature request.\r\n\r\nI tried using --retries=1000 --retries-sleep=30 for cases where MS Office files are occupied or locked!\r\nThe bisync task will end up with a fatal error and needs to be resynced.\r\n\r\n@nielash [posted a preview.](https://github.com/nielash/rclone/releases/tag/v1.65.0-beta.7566.68eb6f5b2.bisync-feature-preview-2024-01-01) **Many THANKS for that!**\r\nI share my test results with this preview beta here:\r\n\r\n```\r\nrclone bisync \"path1\" \"C:\\TBD\\Test\" --config=\"rclone.conf\" --workdir=\"cache\" --exclude=\"{~$*,*.tmp,*.bak}\" --check-first --fast-list --remove-empty-dirs --retries=1000 --retries-sleep=30 --conflict-resolve=newer --conflict-loser=delete --resilient --recover --max-lock 5m -v\r\n2024/01/09 06:31:11 NOTICE: bisync is IN BETA. Don't use in production!\r\n2024/01/09 06:31:11 INFO  : Setting --ignore-listing-checksum as neither --checksum nor --compare checksum are set.\r\n2024/01/09 06:31:11 INFO  : Bisyncing with Comparison Settings:\r\n{\r\n        \"Modtime\": true,\r\n        \"Size\": true,\r\n        \"Checksum\": false,\r\n        \"HashType1\": 0,\r\n        \"HashType2\": 0,\r\n        \"NoSlowHash\": false,\r\n        \"SlowHashSyncOnly\": false,\r\n        \"SlowHashDetected\": true,\r\n        \"DownloadHash\": false\r\n}\r\n2024/01/09 06:31:11 INFO  : lock file renewed for 5m0s. New expiration: 2024-01-09 06:36:11.3875714 +0100 CET m=+300.422610101\r\n2024/01/09 06:31:11 INFO  : Synching Path1 \"path1\" with Path2 \"C:\\TBD\\Test\\\"\r\n2024/01/09 06:31:11 INFO  : Building Path1 and Path2 listings\r\n2024/01/09 06:31:11 INFO  : Path1 checking for diffs\r\n2024/01/09 06:31:11 INFO  : - Path1    File changed: size (smaller), time (newer) - Ship-to form.docx\r\n2024/01/09 06:31:11 INFO  : Path1:    1 changes:    0 new,    1 modified,    0 deleted\r\n2024/01/09 06:31:11 INFO  : (Modified:    1 newer,    0 older,    0 larger,    1 smaller)\r\n2024/01/09 06:31:11 INFO  : Path2 checking for diffs\r\n2024/01/09 06:31:11 INFO  : Applying changes\r\n2024/01/09 06:31:11 INFO  : - Path1    Queue copy to Path2       - C:\\TBD\\Test\\Ship-to form.docx\r\n2024/01/09 06:31:11 INFO  : - Path1    Do queued copies to                - Path2\r\n2024/01/09 06:31:11 INFO  : Local file system at //?/C:/TBD/Test: Running all checks before starting transfers\r\n2024/01/09 06:31:11 INFO  : Local file system at //?/C:/TBD/Test: Checks finished, now starting transfers\r\n2024/01/09 06:31:11 ERROR : Ship-to form.docx.cagiyuw2.partial: partial file rename failed: rename \\\\?\\C:\\TBD\\Test\\Ship-to form.docx.cagiyuw2.partial \\\\?\\C:\\TBD\\Test\\Ship-to form.docx: Access is denied.\r\n2024/01/09 06:31:11 INFO  : Ship-to form.docx.cagiyuw2.partial: Removing failed copy\r\n2024/01/09 06:31:11 ERROR : Local file system at //?/C:/TBD/Test: not deleting files as there were IO errors\r\n2024/01/09 06:31:11 ERROR : Local file system at //?/C:/TBD/Test: not deleting directories as there were IO errors\r\n2024/01/09 06:31:11 NOTICE: copy1to2: Received error: rename \\\\?\\C:\\TBD\\Test\\Ship-to form.docx.cagiyuw2.partial \\\\?\\C:\\TBD\\Test\\Ship-to form.docx: Access is denied. - retrying as --resilient is set. Retry 1/1000\r\n2024/01/09 06:31:11 INFO  : Local file system at //?/C:/TBD/Test: Running all checks before starting transfers\r\n2024/01/09 06:31:11 INFO  : Local file system at //?/C:/TBD/Test: Checks finished, now starting transfers\r\n2024/01/09 06:31:11 ERROR : Ship-to form.docx.zeluram5.partial: partial file rename failed: rename \\\\?\\C:\\TBD\\Test\\Ship-to form.docx.zeluram5.partial \\\\?\\C:\\TBD\\Test\\Ship-to form.docx: Access is denied.\r\n2024/01/09 06:31:11 INFO  : Ship-to form.docx.zeluram5.partial: Removing failed copy\r\n2024/01/09 06:31:11 ERROR : Local file system at //?/C:/TBD/Test: not deleting files as there were IO errors\r\n2024/01/09 06:31:11 ERROR : Local file system at //?/C:/TBD/Test: not deleting directories as there were IO errors\r\n2024/01/09 06:31:11 NOTICE: copy1to2: Received error: rename \\\\?\\C:\\TBD\\Test\\Ship-to form.docx.zeluram5.partial \\\\?\\C:\\TBD\\Test\\Ship-to form.docx: Access is denied. - retrying as --resilient is set. Retry 2/1000\r\n```\r\n\r\nThis loop runs very quick without any sleep time. So the `--retries-sleep=30` was ignored!\r\n\r\nAt this moment i unlocked the file.\r\n\r\n```\r\n2024/01/09 06:31:26 INFO  : Local file system at //?/C:/TBD/Test: Running all checks before starting transfers\r\n2024/01/09 06:31:26 INFO  : Local file system at //?/C:/TBD/Test: Checks finished, now starting transfers\r\n2024/01/09 06:31:26 INFO  : Ship-to form.docx: Copied (replaced existing)\r\n2024/01/09 06:31:26 ERROR : Local file system at //?/C:/TBD/Test: not deleting files as there were IO errors\r\n2024/01/09 06:31:26 ERROR : Local file system at //?/C:/TBD/Test: not deleting directories as there were IO errors\r\n2024/01/09 06:31:26 NOTICE: copy1to2: Received error: not deleting files as there were IO errors - retrying as --resilient is set. Retry 174/1000\r\n2024/01/09 06:31:26 INFO  : Local file system at //?/C:/TBD/Test: Running all checks before starting transfers\r\n2024/01/09 06:31:26 INFO  : Local file system at //?/C:/TBD/Test: Checks finished, now starting transfers\r\n2024/01/09 06:31:26 ERROR : Local file system at //?/C:/TBD/Test: not deleting files as there were IO errors\r\n2024/01/09 06:31:26 ERROR : Local file system at //?/C:/TBD/Test: not deleting directories as there were IO errors\r\n2024/01/09 06:31:26 NOTICE: copy1to2: Received error: not deleting files as there were IO errors - retrying as --resilient is set. Retry 175/1000\r\n```\r\n\r\nThe loop keeps running...\r\nSo i ended up with sending an exit signal.\r\n\r\n```\r\n2024/01/09 06:31:31 INFO  : Local file system at //?/C:/TBD/Test: Running all checks before starting transfers\r\n2024/01/09 06:31:31 INFO  : Local file system at //?/C:/TBD/Test: Checks finished, now starting transfers\r\n2024/01/09 06:31:31 ERROR : Local file system at //?/C:/TBD/Test: not deleting files as there were IO errors\r\n2024/01/09 06:31:31 ERROR : Local file system at //?/C:/TBD/Test: not deleting directories as there were IO errors\r\n2024/01/09 06:31:31 NOTICE: copy1to2: Received error: not deleting files as there were IO errors - retrying as --resilient is set. Retry 281/1000\r\n2024/01/09 06:31:31 INFO  : Local file system at //?/C:/TBD/Test: Running all checks before starting transfers\r\n2024/01/09 06:31:31 INFO  : Signal received: interrupt\r\n2024/01/09 06:31:31 NOTICE: Attempting to gracefully shutdown. (Send exit signal again for immediate un-graceful shutdown.)\r\n2024/01/09 06:31:31 INFO  : Telling Sync to wrap up early.\r\n2024/01/09 06:31:31 INFO  : Canceling Sync if not done in: 30\r\n2024/01/09 06:31:31 INFO  : Local file system at //?/C:/TBD/Test: Checks finished, now starting transfers\r\n2024/01/09 06:31:31 ERROR : Local file system at //?/C:/TBD/Test: not deleting files as there were IO errors\r\n2024/01/09 06:31:31 ERROR : Local file system at //?/C:/TBD/Test: not deleting directories as there were IO errors\r\n2024/01/09 06:31:31 NOTICE: copy1to2: Received error: not deleting files as there were IO errors - retrying as --resilient is set. Retry 282/1000\r\n2024/01/09 06:31:31 NOTICE: copy1to2: Received error: <nil> - retrying as --resilient is set. Retry 283/1000\r\n2024/01/09 06:31:31 NOTICE: copy1to2: Received error: <nil> - retrying as --resilient is set. Retry 284/1000\r\n...\r\n...\r\n2024/01/09 06:31:31 NOTICE: copy1to2: Received error: <nil> - retrying as --resilient is set. Retry 999/1000\r\n2024/01/09 06:31:31 NOTICE: copy1to2: Received error: <nil> - retrying as --resilient is set. Retry 1000/1000\r\n2024/01/09 06:31:31 INFO  : Updating listings\r\n2024/01/09 06:31:31 INFO  : Validating listings for Path1 \"path1\" vs Path2 \"C:\\TBD\\Test\\\"\r\n2024/01/09 06:31:31 INFO  : Removing empty directories\r\n2024/01/09 06:31:31 NOTICE: Graceful shutdown completed successfully.\r\n2024/01/09 06:31:31 INFO  : Bisync successful\r\n2024/01/09 06:31:31 INFO  :\r\nTransferred:       14.388 MiB / 14.388 MiB, 100%, 711.230 KiB/s, ETA 0s\r\nErrors:               173 (retrying may help)\r\nChecks:               396 / 396, 100%\r\nTransferred:            1 / 1, 100%\r\nElapsed time:        20.5s\r\n\r\n2024/01/09 06:31:31 Failed to bisync with 173 errors: last error was: rename \\\\?\\C:\\TBD\\Test\\Ship-to form.docx.lebeqic0.partial \\\\?\\C:\\TBD\\Test\\Ship-to form.docx: Access is denied.\r\n2024/01/09 06:31:32 INFO  : Exiting...\r\n```\r\n\r\nI was wondering why 14.388 MiB are transferred. Every loop the partial file was copied.\r\nSo the `--retries-sleep=30` would be reduce the amount.\r\n\r\nMy summary of the bisync-feature-preview:\r\nanything causes tons of verbose output.\r\nstability seems good. next run recovers automatically.","closed_by":{"login":"nielash","id":31582349,"node_id":"MDQ6VXNlcjMxNTgyMzQ5","avatar_url":"https://avatars.githubusercontent.com/u/31582349?v=4","gravatar_id":"","url":"https://api.github.com/users/nielash","html_url":"https://github.com/nielash","followers_url":"https://api.github.com/users/nielash/followers","following_url":"https://api.github.com/users/nielash/following{/other_user}","gists_url":"https://api.github.com/users/nielash/gists{/gist_id}","starred_url":"https://api.github.com/users/nielash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielash/subscriptions","organizations_url":"https://api.github.com/users/nielash/orgs","repos_url":"https://api.github.com/users/nielash/repos","events_url":"https://api.github.com/users/nielash/events{/privacy}","received_events_url":"https://api.github.com/users/nielash/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/7555/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/7555/timeline","performed_via_github_app":null,"state_reason":"completed"}