{"url":"https://api.github.com/repos/rclone/rclone/issues/3015","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/3015/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/3015/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/3015/events","html_url":"https://github.com/rclone/rclone/issues/3015","id":416414908,"node_id":"MDU6SXNzdWU0MTY0MTQ5MDg=","number":3015,"title":"Ceph mount write 403 since v1.46","user":{"login":"ctrox","id":2719925,"node_id":"MDQ6VXNlcjI3MTk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/2719925?v=4","gravatar_id":"","url":"https://api.github.com/users/ctrox","html_url":"https://github.com/ctrox","followers_url":"https://api.github.com/users/ctrox/followers","following_url":"https://api.github.com/users/ctrox/following{/other_user}","gists_url":"https://api.github.com/users/ctrox/gists{/gist_id}","starred_url":"https://api.github.com/users/ctrox/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctrox/subscriptions","organizations_url":"https://api.github.com/users/ctrox/orgs","repos_url":"https://api.github.com/users/ctrox/repos","events_url":"https://api.github.com/users/ctrox/events{/privacy}","received_events_url":"https://api.github.com/users/ctrox/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":314138213,"node_id":"MDU6TGFiZWwzMTQxMzgyMTM=","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20S3","name":"Remote: S3","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/34","html_url":"https://github.com/rclone/rclone/milestone/34","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/34/labels","id":3845049,"node_id":"MDk6TWlsZXN0b25lMzg0NTA0OQ==","number":34,"title":"v1.47","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":30,"state":"closed","created_at":"2018-11-24T15:22:45Z","updated_at":"2019-04-16T14:08:10Z","due_on":"2019-04-13T07:00:00Z","closed_at":"2019-04-15T17:13:00Z"},"comments":5,"created_at":"2019-03-02T16:41:21Z","updated_at":"2019-03-06T11:51:30Z","closed_at":"2019-03-06T07:57:15Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### What is the problem you are having with rclone?\r\nWrites to a Ceph S3 mount stopped working with version v1.46. Version v1.45 and earlier works fine.\r\n\r\n#### What is your rclone version (output from `rclone version`)\r\n\r\nv1.46\r\n\r\n#### Which OS you are using and how many bits (eg Windows 7, 64 bit)\r\n\r\nDebian GNU/Linux 9.8\r\n\r\n####  Which cloud storage system are you using? (eg Google Drive)\r\n\r\nCeph S3\r\n\r\n#### The command you were trying to run (eg `rclone copy /tmp remote:tmp`)\r\n\r\n```\r\nrclone -vv mount ceph:bucket/dir /mnt/test\r\ntouch /mnt/test/a\r\n```\r\n\r\nOnly writing seems to fail, I can read and even delete files.\r\n\r\nConfig:\r\n\r\n```\r\n[ceph]\r\ntype = s3\r\nprovider = Ceph\r\nenv_auth = false\r\naccess_key_id = <key>\r\nsecret_access_key = <key>\r\nregion = \r\nendpoint = ceph.host.com\r\nlocation_constraint = \r\nacl = \r\n```\r\n\r\n#### A log from the command with the `-vv` flag (eg output from `rclone -vv copy /tmp remote:tmp`)\r\n\r\n```\r\n2019/03/02 16:32:35 DEBUG : rclone: Version \"v1.46\" starting with parameters [\"./rclone\" \"-vv\" \"mount\" \"ceph:bucket/dir\" \"/mnt/test\"]\r\n2019/03/02 16:32:35 DEBUG : Using config file from \"/root/.config/rclone/rclone.conf\"\r\n2019/03/02 16:32:35 DEBUG : pacer: Reducing sleep to 0s\r\n2019/03/02 16:32:35 DEBUG : S3 bucket bucket path dir/: Mounting on \"/mnt/test\"\r\n2019/03/02 16:32:35 INFO  : S3 bucket bucket path dir/: poll-interval is not supported by this remote\r\n2019/03/02 16:32:35 DEBUG : Adding path \"vfs/forget\" to remote control registry\r\n2019/03/02 16:32:35 DEBUG : Adding path \"vfs/refresh\" to remote control registry\r\n2019/03/02 16:32:35 DEBUG : Adding path \"vfs/poll-interval\" to remote control registry\r\n2019/03/02 16:32:35 DEBUG : : Root: \r\n2019/03/02 16:32:35 DEBUG : : >Root: node=/, err=<nil>\r\n2019/03/02 16:32:44 DEBUG : /: Lookup: name=\"a\"\r\n2019/03/02 16:32:44 DEBUG : /: >Lookup: node=<nil>, err=no such file or directory\r\n2019/03/02 16:32:44 DEBUG : /: Create: name=\"a\"\r\n2019/03/02 16:32:44 DEBUG : a: Open: flags=O_WRONLY|O_CREATE|0x800\r\n2019/03/02 16:32:44 DEBUG : a: >Open: fd=a (w), err=<nil>\r\n2019/03/02 16:32:44 DEBUG : /: >Create: node=a, handle=&{a (w)}, err=<nil>\r\n2019/03/02 16:32:44 DEBUG : a: Attr: \r\n2019/03/02 16:32:44 DEBUG : a: >Attr: a=valid=1s ino=0 size=0 mode=-rw-r--r--, err=<nil>\r\n2019/03/02 16:32:44 DEBUG : &{a (w)}: Flush: \r\n2019/03/02 16:32:44 DEBUG : a: WriteFileHandle.Flush unwritten handle, writing 0 bytes to avoid race conditions\r\n2019/03/02 16:32:44 DEBUG : &{a (w)}: >Flush: err=<nil>\r\n2019/03/02 16:32:44 DEBUG : a: Setattr: a=Setattr [ID=0x5 Node=0x2 Uid=0 Gid=0 Pid=29319] atime=2019-03-02 16:32:44.976972353 +0000 UTC atime=now mtime=2019-03-02 16:32:44.976972353 +0000 UTC mtime=now handle=INVALID-0x0\r\n2019/03/02 16:32:44 DEBUG : a: >Setattr: err=<nil>\r\n2019/03/02 16:32:44 DEBUG : a: Attr: \r\n2019/03/02 16:32:44 DEBUG : a: >Attr: a=valid=1s ino=0 size=0 mode=-rw-r--r--, err=<nil>\r\n2019/03/02 16:32:44 DEBUG : &{a (w)}: Flush: \r\n2019/03/02 16:32:44 DEBUG : S3 bucket bucket path dir/: File to upload is small (0 bytes), uploading instead of streaming\r\n2019/03/02 16:32:44 ERROR : a: Failed to copy: s3 upload: 403 Forbidden: <?xml version=\"1.0\" encoding=\"UTF-8\"?><Error><Code>SignatureDoesNotMatch</Code><RequestId>tx0000000000000011a56dd-005c7ab02c-4ab3b0-default</RequestId><HostId>4ab3b0-default-default</HostId></Error>\r\n2019/03/02 16:32:44 ERROR : a: WriteFileHandle.New Rcat failed: s3 upload: 403 Forbidden: <?xml version=\"1.0\" encoding=\"UTF-8\"?><Error><Code>SignatureDoesNotMatch</Code><RequestId>tx0000000000000011a56dd-005c7ab02c-4ab3b0-default</RequestId><HostId>4ab3b0-default-default</HostId></Error>\r\n2019/03/02 16:32:44 ERROR : a: WriteFileHandle.Flush error: s3 upload: 403 Forbidden: <?xml version=\"1.0\" encoding=\"UTF-8\"?><Error><Code>SignatureDoesNotMatch</Code><RequestId>tx0000000000000011a56dd-005c7ab02c-4ab3b0-default</RequestId><HostId>4ab3b0-default-default</HostId></Error>\r\n2019/03/02 16:32:44 DEBUG : &{a (w)}: >Flush: err=s3 upload: 403 Forbidden: <?xml version=\"1.0\" encoding=\"UTF-8\"?><Error><Code>SignatureDoesNotMatch</Code><RequestId>tx0000000000000011a56dd-005c7ab02c-4ab3b0-default</RequestId><HostId>4ab3b0-default-default</HostId></Error>\r\n2019/03/02 16:32:44 DEBUG : &{a (w)}: Release: \r\n2019/03/02 16:32:44 DEBUG : a: WriteFileHandle.Release nothing to do\r\n2019/03/02 16:32:44 DEBUG : &{a (w)}: >Release: err=<nil>\r\n```\r\nI also tried using `--s3-v2-auth` which just changes the error messages:\r\n\r\n```\r\n2019/03/02 16:37:12 ERROR : a: Failed to copy: s3 upload: 403 Forbidden: <?xml version=\"1.0\" encoding=\"UTF-8\"?><Error><Code>AccessDenied</Code><BucketName>bucket</BucketName><RequestId>tx0000000000000011a571d-005c7ab138-4ab3b0-default</RequestId><HostId>4ab3b0-default-default</HostId></Error>\r\n2019/03/02 16:37:12 ERROR : a: WriteFileHandle.New Rcat failed: s3 upload: 403 Forbidden: <?xml version=\"1.0\" encoding=\"UTF-8\"?><Error><Code>AccessDenied</Code><BucketName>bucket</BucketName><RequestId>tx0000000000000011a571d-005c7ab138-4ab3b0-default</RequestId><HostId>4ab3b0-default-default</HostId></Error>\r\n2019/03/02 16:37:12 ERROR : a: WriteFileHandle.Flush error: s3 upload: 403 Forbidden: <?xml version=\"1.0\" encoding=\"UTF-8\"?><Error><Code>AccessDenied</Code><BucketName>bucket</BucketName><RequestId>tx0000000000000011a571d-005c7ab138-4ab3b0-default</RequestId><HostId>4ab3b0-default-default</HostId></Error>\r\n2019/03/02 16:37:12 DEBUG : &{a (w)}: >Flush: err=s3 upload: 403 Forbidden: <?xml version=\"1.0\" encoding=\"UTF-8\"?><Error><Code>AccessDenied</Code><BucketName>bucket</BucketName><RequestId>tx0000000000000011a571d-005c7ab138-4ab3b0-default</RequestId><HostId>4ab3b0-default-default</HostId></Error>\r\n```","closed_by":{"login":"ctrox","id":2719925,"node_id":"MDQ6VXNlcjI3MTk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/2719925?v=4","gravatar_id":"","url":"https://api.github.com/users/ctrox","html_url":"https://github.com/ctrox","followers_url":"https://api.github.com/users/ctrox/followers","following_url":"https://api.github.com/users/ctrox/following{/other_user}","gists_url":"https://api.github.com/users/ctrox/gists{/gist_id}","starred_url":"https://api.github.com/users/ctrox/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctrox/subscriptions","organizations_url":"https://api.github.com/users/ctrox/orgs","repos_url":"https://api.github.com/users/ctrox/repos","events_url":"https://api.github.com/users/ctrox/events{/privacy}","received_events_url":"https://api.github.com/users/ctrox/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/3015/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/3015/timeline","performed_via_github_app":null,"state_reason":"completed"}