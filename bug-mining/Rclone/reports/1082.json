{"url":"https://api.github.com/repos/rclone/rclone/issues/6322","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/6322/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/6322/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/6322/events","html_url":"https://github.com/rclone/rclone/issues/6322","id":1307012320,"node_id":"I_kwDOAQ-n5M5N52zg","number":6322,"title":"s3: --s3-no-head causing: panic: reflect: Elem of invalid type s3.PutObjectInput","user":{"login":"BernhardGruen","id":9251824,"node_id":"MDQ6VXNlcjkyNTE4MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/9251824?v=4","gravatar_id":"","url":"https://api.github.com/users/BernhardGruen","html_url":"https://github.com/BernhardGruen","followers_url":"https://api.github.com/users/BernhardGruen/followers","following_url":"https://api.github.com/users/BernhardGruen/following{/other_user}","gists_url":"https://api.github.com/users/BernhardGruen/gists{/gist_id}","starred_url":"https://api.github.com/users/BernhardGruen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BernhardGruen/subscriptions","organizations_url":"https://api.github.com/users/BernhardGruen/orgs","repos_url":"https://api.github.com/users/BernhardGruen/repos","events_url":"https://api.github.com/users/BernhardGruen/events{/privacy}","received_events_url":"https://api.github.com/users/BernhardGruen/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":314138213,"node_id":"MDU6TGFiZWwzMTQxMzgyMTM=","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20S3","name":"Remote: S3","color":"fbca04","default":false,"description":null},{"id":1710413418,"node_id":"MDU6TGFiZWwxNzEwNDEzNDE4","url":"https://api.github.com/repos/rclone/rclone/labels/Point%20Release%20Candidate","name":"Point Release Candidate","color":"b60205","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/48","html_url":"https://github.com/rclone/rclone/milestone/48","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/48/labels","id":7671787,"node_id":"MI_kwDOAQ-n5M4AdQ_r","number":48,"title":"v1.60","description":"Due date tentatively set based on 3-month release sprint.\r\ncc @ncw","creator":{"login":"ivandeex","id":9028053,"node_id":"MDQ6VXNlcjkwMjgwNTM=","avatar_url":"https://avatars.githubusercontent.com/u/9028053?v=4","gravatar_id":"","url":"https://api.github.com/users/ivandeex","html_url":"https://github.com/ivandeex","followers_url":"https://api.github.com/users/ivandeex/followers","following_url":"https://api.github.com/users/ivandeex/following{/other_user}","gists_url":"https://api.github.com/users/ivandeex/gists{/gist_id}","starred_url":"https://api.github.com/users/ivandeex/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivandeex/subscriptions","organizations_url":"https://api.github.com/users/ivandeex/orgs","repos_url":"https://api.github.com/users/ivandeex/repos","events_url":"https://api.github.com/users/ivandeex/events{/privacy}","received_events_url":"https://api.github.com/users/ivandeex/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":8,"state":"closed","created_at":"2022-02-13T11:28:10Z","updated_at":"2022-12-05T11:22:10Z","due_on":"2022-09-02T07:00:00Z","closed_at":"2022-12-05T11:22:10Z"},"comments":4,"created_at":"2022-07-17T07:21:40Z","updated_at":"2022-07-18T22:39:43Z","closed_at":"2022-07-18T22:39:03Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hello,\r\n\r\nWe are using rclone to transfer files between S3 buckets (disaster recovery plan).\r\nUsing **1.59.0** we get a strange error. This error is reproducible. Using version 1.58.1 of rclone everything worked fine. \r\nIf it matters we are using the bitnami/rclone docker image.\r\n\r\nThis is the command we use:\r\n```shell\r\nrclone --config /tmp/rclones.conf \\\r\n    copy s3-source:/bucket-source s3-target:/bucket-target \\\r\n    -P --stats 10s --stats-log-level NOTICE --max-backlog 20000 --checkers=96 --transfers=32 \\\r\n    --buffer-size 4Mi --checksum --tpslimit 150 --s3-no-head --s3-no-head-object --fast-list\r\n```\r\nIn case it matters we copy files from DigitalOcean Spaces (FRA1) to ScaleWay Object Storage (PAR). The source bucket has about 1.1 mio objects (target about the same).\r\n\r\nThis is the error message we see:\r\n```\r\npanic: reflect: Elem of invalid type s3.PutObjectInput\r\n\r\ngoroutine 258 [running]:\r\nreflect.(*rtype).Elem(0x0?)\r\n\t/usr/local/go-1.18.4/src/reflect/type.go:965 +0x134\r\ngithub.com/rclone/rclone/lib/structs.SetFrom({0x27b54e0?, 0xc1788e4480}, {0x27d9ec0?, 0xc1787568c0})\r\n\t/bitnami/blacksmith-sandox/rclone-1.59.0/src/github.com/rclone/rclone/lib/structs/structs.go:22 +0xdf\r\ngithub.com/rclone/rclone/backend/s3.(*Object).Update(0xc16927b0e0, {0x2c95da0, 0xc000640700}, {0x2c842c0, 0xc16991e700}, {0x2c9d518?, 0xc016435320?}, {0xc1697c8830, 0x1, 0x1})\r\n\t/bitnami/blacksmith-sandox/rclone-1.59.0/src/github.com/rclone/rclone/backend/s3/s3.go:4573 +0x1345\r\ngithub.com/rclone/rclone/backend/s3.(*Fs).Put(0xc00037ed80, {0x2c95da0, 0xc000640700}, {0x2c842c0, 0xc16991e700}, {0x2c9d518?, 0xc016435320?}, {0xc1697c8830, 0x1, 0x1})\r\n\t/bitnami/blacksmith-sandox/rclone-1.59.0/src/github.com/rclone/rclone/backend/s3/s3.go:3085 +0x125\r\ngithub.com/rclone/rclone/fs/operations.Copy({0x2c95da0, 0xc000640700}, {0x2ca66d0, 0xc00037ed80}, {0x0?, 0x0?}, {0xc0161ef810, 0x68}, {0x2ca6740, 0xc016435320})\r\n\t/bitnami/blacksmith-sandox/rclone-1.59.0/src/github.com/rclone/rclone/fs/operations/operations.go:501 +0x1b24\r\ngithub.com/rclone/rclone/fs/sync.(*syncCopyMove).pairCopyOrMove(0xc00049efc0, {0x2c95da0, 0xc000640700}, 0x0?, {0x2ca66d0, 0xc00037ed80}, 0x0?, 0x0?)\r\n\t/bitnami/blacksmith-sandox/rclone-1.59.0/src/github.com/rclone/rclone/fs/sync/sync.go:416 +0x1bb\r\ncreated by github.com/rclone/rclone/fs/sync.(*syncCopyMove).startTransfers\r\n\t/bitnami/blacksmith-sandox/rclone-1.59.0/src/github.com/rclone/rclone/fs/sync/sync.go:443 +0x45\r\n```\r\n\r\nI assume the error is printend after fast-list has finished its work because it took about 17 minutes to get there and there were no`checking` or `transfering` output.\r\n\r\nIf more information is needed I can try to provide that.","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/6322/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/6322/timeline","performed_via_github_app":null,"state_reason":"completed"}