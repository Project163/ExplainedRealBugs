[{"id":427771588,"node_id":"MDEyOkxhYmVsZWRFdmVudDQyNzc3MTU4OA==","url":"https://api.github.com/repos/rclone/rclone/issues/events/427771588","actor":{"login":"klauspost","id":5663952,"node_id":"MDQ6VXNlcjU2NjM5NTI=","avatar_url":"https://avatars.githubusercontent.com/u/5663952?v=4","gravatar_id":"","url":"https://api.github.com/users/klauspost","html_url":"https://github.com/klauspost","followers_url":"https://api.github.com/users/klauspost/followers","following_url":"https://api.github.com/users/klauspost/following{/other_user}","gists_url":"https://api.github.com/users/klauspost/gists{/gist_id}","starred_url":"https://api.github.com/users/klauspost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klauspost/subscriptions","organizations_url":"https://api.github.com/users/klauspost/orgs","repos_url":"https://api.github.com/users/klauspost/repos","events_url":"https://api.github.com/users/klauspost/events{/privacy}","received_events_url":"https://api.github.com/users/klauspost/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2015-10-06T10:03:13Z","label":{"name":"enhancement","color":"84b6eb"},"performed_via_github_app":null},{"id":427771589,"node_id":"MDEzOkFzc2lnbmVkRXZlbnQ0Mjc3NzE1ODk=","url":"https://api.github.com/repos/rclone/rclone/issues/events/427771589","actor":{"login":"klauspost","id":5663952,"node_id":"MDQ6VXNlcjU2NjM5NTI=","avatar_url":"https://avatars.githubusercontent.com/u/5663952?v=4","gravatar_id":"","url":"https://api.github.com/users/klauspost","html_url":"https://github.com/klauspost","followers_url":"https://api.github.com/users/klauspost/followers","following_url":"https://api.github.com/users/klauspost/following{/other_user}","gists_url":"https://api.github.com/users/klauspost/gists{/gist_id}","starred_url":"https://api.github.com/users/klauspost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klauspost/subscriptions","organizations_url":"https://api.github.com/users/klauspost/orgs","repos_url":"https://api.github.com/users/klauspost/repos","events_url":"https://api.github.com/users/klauspost/events{/privacy}","received_events_url":"https://api.github.com/users/klauspost/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2015-10-06T10:03:13Z","assignee":{"login":"klauspost","id":5663952,"node_id":"MDQ6VXNlcjU2NjM5NTI=","avatar_url":"https://avatars.githubusercontent.com/u/5663952?v=4","gravatar_id":"","url":"https://api.github.com/users/klauspost","html_url":"https://github.com/klauspost","followers_url":"https://api.github.com/users/klauspost/followers","following_url":"https://api.github.com/users/klauspost/following{/other_user}","gists_url":"https://api.github.com/users/klauspost/gists{/gist_id}","starred_url":"https://api.github.com/users/klauspost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klauspost/subscriptions","organizations_url":"https://api.github.com/users/klauspost/orgs","repos_url":"https://api.github.com/users/klauspost/repos","events_url":"https://api.github.com/users/klauspost/events{/privacy}","received_events_url":"https://api.github.com/users/klauspost/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/145819019","html_url":"https://github.com/rclone/rclone/issues/164#issuecomment-145819019","issue_url":"https://api.github.com/repos/rclone/rclone/issues/164","id":145819019,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NTgxOTAxOQ==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-10-06T10:42:58Z","updated_at":"2015-10-06T10:42:58Z","body":"I spent some time thinking about this sort of thing earlier this year - there was [a long thread on go-nuts](https://groups.google.com/d/msg/golang-nuts/Mwn9buVnLmY/HFMRQm8JPNkJ) about it.  The conclusion was that the async buffer is really hard to get right under all circumstances.  It didn't cross my mind that this is relevant to `rclone` but it certainly is!\n\nHere is a repo of code which came out of that discussion\n- https://godoc.org/github.com/karalabe/bufioprop\n\nProbably the highest performing solution would be to use a buffered pipe and an io.Copy in a go routine to decouple the reading from the writing and batch them up into bigger batches.\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/145819019/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/145859394","html_url":"https://github.com/rclone/rclone/issues/164#issuecomment-145859394","issue_url":"https://api.github.com/repos/rclone/rclone/issues/164","id":145859394,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NTg1OTM5NA==","user":{"login":"klauspost","id":5663952,"node_id":"MDQ6VXNlcjU2NjM5NTI=","avatar_url":"https://avatars.githubusercontent.com/u/5663952?v=4","gravatar_id":"","url":"https://api.github.com/users/klauspost","html_url":"https://github.com/klauspost","followers_url":"https://api.github.com/users/klauspost/followers","following_url":"https://api.github.com/users/klauspost/following{/other_user}","gists_url":"https://api.github.com/users/klauspost/gists{/gist_id}","starred_url":"https://api.github.com/users/klauspost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klauspost/subscriptions","organizations_url":"https://api.github.com/users/klauspost/orgs","repos_url":"https://api.github.com/users/klauspost/repos","events_url":"https://api.github.com/users/klauspost/events{/privacy}","received_events_url":"https://api.github.com/users/klauspost/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-10-06T13:40:27Z","updated_at":"2015-10-06T13:40:27Z","body":"Ah yes, now I remember that. Unless I am mistaking, if the input is read-ahead buffered we should have enough \"buffering\" to not need the copy.\n\nI've asked on the [Go forum](https://forum.golangbridge.org/t/async-buffered-reader-package/1126/4) if anyone has a package for this, but i might try to cook one up.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/145859394/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"klauspost","id":5663952,"node_id":"MDQ6VXNlcjU2NjM5NTI=","avatar_url":"https://avatars.githubusercontent.com/u/5663952?v=4","gravatar_id":"","url":"https://api.github.com/users/klauspost","html_url":"https://github.com/klauspost","followers_url":"https://api.github.com/users/klauspost/followers","following_url":"https://api.github.com/users/klauspost/following{/other_user}","gists_url":"https://api.github.com/users/klauspost/gists{/gist_id}","starred_url":"https://api.github.com/users/klauspost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klauspost/subscriptions","organizations_url":"https://api.github.com/users/klauspost/orgs","repos_url":"https://api.github.com/users/klauspost/repos","events_url":"https://api.github.com/users/klauspost/events{/privacy}","received_events_url":"https://api.github.com/users/klauspost/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/145875435","html_url":"https://github.com/rclone/rclone/issues/164#issuecomment-145875435","issue_url":"https://api.github.com/repos/rclone/rclone/issues/164","id":145875435,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NTg3NTQzNQ==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-10-06T14:34:25Z","updated_at":"2015-10-06T14:34:25Z","body":"The bufioprop package has the right logic in, but not quite in the right form - the implementation is worth a look. It might be reading from net or disk and writing to net or disk so getting it to run quickly in all cases might be tricky.\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/145875435/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":428017945,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQyODAxNzk0NQ==","url":"https://api.github.com/repos/rclone/rclone/issues/events/428017945","actor":{"login":"klauspost","id":5663952,"node_id":"MDQ6VXNlcjU2NjM5NTI=","avatar_url":"https://avatars.githubusercontent.com/u/5663952?v=4","gravatar_id":"","url":"https://api.github.com/users/klauspost","html_url":"https://github.com/klauspost","followers_url":"https://api.github.com/users/klauspost/followers","following_url":"https://api.github.com/users/klauspost/following{/other_user}","gists_url":"https://api.github.com/users/klauspost/gists{/gist_id}","starred_url":"https://api.github.com/users/klauspost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klauspost/subscriptions","organizations_url":"https://api.github.com/users/klauspost/orgs","repos_url":"https://api.github.com/users/klauspost/repos","events_url":"https://api.github.com/users/klauspost/events{/privacy}","received_events_url":"https://api.github.com/users/klauspost/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"e8a576f5ce6951dd4ae71a48002a4ecdcfb8cea7","commit_url":"https://api.github.com/repos/klauspost/rclone/commits/e8a576f5ce6951dd4ae71a48002a4ecdcfb8cea7","created_at":"2015-10-06T14:35:37Z","performed_via_github_app":null},{"actor":{"login":"klauspost","id":5663952,"node_id":"MDQ6VXNlcjU2NjM5NTI=","avatar_url":"https://avatars.githubusercontent.com/u/5663952?v=4","gravatar_id":"","url":"https://api.github.com/users/klauspost","html_url":"https://github.com/klauspost","followers_url":"https://api.github.com/users/klauspost/followers","following_url":"https://api.github.com/users/klauspost/following{/other_user}","gists_url":"https://api.github.com/users/klauspost/gists{/gist_id}","starred_url":"https://api.github.com/users/klauspost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klauspost/subscriptions","organizations_url":"https://api.github.com/users/klauspost/orgs","repos_url":"https://api.github.com/users/klauspost/repos","events_url":"https://api.github.com/users/klauspost/events{/privacy}","received_events_url":"https://api.github.com/users/klauspost/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-10-06T14:36:26Z","updated_at":"2015-10-06T14:36:26Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rclone/rclone/issues/166","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/166/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/166/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/166/events","html_url":"https://github.com/rclone/rclone/pull/166","id":110021791,"node_id":"MDExOlB1bGxSZXF1ZXN0NDY5MTA5MDA=","number":166,"title":"Add async copy buffering","user":{"login":"klauspost","id":5663952,"node_id":"MDQ6VXNlcjU2NjM5NTI=","avatar_url":"https://avatars.githubusercontent.com/u/5663952?v=4","gravatar_id":"","url":"https://api.github.com/users/klauspost","html_url":"https://github.com/klauspost","followers_url":"https://api.github.com/users/klauspost/followers","following_url":"https://api.github.com/users/klauspost/following{/other_user}","gists_url":"https://api.github.com/users/klauspost/gists{/gist_id}","starred_url":"https://api.github.com/users/klauspost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klauspost/subscriptions","organizations_url":"https://api.github.com/users/klauspost/orgs","repos_url":"https://api.github.com/users/klauspost/repos","events_url":"https://api.github.com/users/klauspost/events{/privacy}","received_events_url":"https://api.github.com/users/klauspost/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2015-10-06T14:36:26Z","updated_at":"2015-10-16T10:00:04Z","closed_at":"2015-10-12T07:35:47Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":17803236,"node_id":"MDEwOlJlcG9zaXRvcnkxNzgwMzIzNg==","name":"rclone","full_name":"rclone/rclone","private":false,"owner":{"login":"rclone","id":24937341,"node_id":"MDEyOk9yZ2FuaXphdGlvbjI0OTM3MzQx","avatar_url":"https://avatars.githubusercontent.com/u/24937341?v=4","gravatar_id":"","url":"https://api.github.com/users/rclone","html_url":"https://github.com/rclone","followers_url":"https://api.github.com/users/rclone/followers","following_url":"https://api.github.com/users/rclone/following{/other_user}","gists_url":"https://api.github.com/users/rclone/gists{/gist_id}","starred_url":"https://api.github.com/users/rclone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rclone/subscriptions","organizations_url":"https://api.github.com/users/rclone/orgs","repos_url":"https://api.github.com/users/rclone/repos","events_url":"https://api.github.com/users/rclone/events{/privacy}","received_events_url":"https://api.github.com/users/rclone/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rclone/rclone","description":"\"rsync for cloud storage\" - Google Drive, S3, Dropbox, Backblaze B2, One Drive, Swift, Hubic, Wasabi, Google Cloud Storage, Azure Blob, Azure Files, Yandex Files","fork":false,"url":"https://api.github.com/repos/rclone/rclone","forks_url":"https://api.github.com/repos/rclone/rclone/forks","keys_url":"https://api.github.com/repos/rclone/rclone/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rclone/rclone/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rclone/rclone/teams","hooks_url":"https://api.github.com/repos/rclone/rclone/hooks","issue_events_url":"https://api.github.com/repos/rclone/rclone/issues/events{/number}","events_url":"https://api.github.com/repos/rclone/rclone/events","assignees_url":"https://api.github.com/repos/rclone/rclone/assignees{/user}","branches_url":"https://api.github.com/repos/rclone/rclone/branches{/branch}","tags_url":"https://api.github.com/repos/rclone/rclone/tags","blobs_url":"https://api.github.com/repos/rclone/rclone/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rclone/rclone/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rclone/rclone/git/refs{/sha}","trees_url":"https://api.github.com/repos/rclone/rclone/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rclone/rclone/statuses/{sha}","languages_url":"https://api.github.com/repos/rclone/rclone/languages","stargazers_url":"https://api.github.com/repos/rclone/rclone/stargazers","contributors_url":"https://api.github.com/repos/rclone/rclone/contributors","subscribers_url":"https://api.github.com/repos/rclone/rclone/subscribers","subscription_url":"https://api.github.com/repos/rclone/rclone/subscription","commits_url":"https://api.github.com/repos/rclone/rclone/commits{/sha}","git_commits_url":"https://api.github.com/repos/rclone/rclone/git/commits{/sha}","comments_url":"https://api.github.com/repos/rclone/rclone/comments{/number}","issue_comment_url":"https://api.github.com/repos/rclone/rclone/issues/comments{/number}","contents_url":"https://api.github.com/repos/rclone/rclone/contents/{+path}","compare_url":"https://api.github.com/repos/rclone/rclone/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rclone/rclone/merges","archive_url":"https://api.github.com/repos/rclone/rclone/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rclone/rclone/downloads","issues_url":"https://api.github.com/repos/rclone/rclone/issues{/number}","pulls_url":"https://api.github.com/repos/rclone/rclone/pulls{/number}","milestones_url":"https://api.github.com/repos/rclone/rclone/milestones{/number}","notifications_url":"https://api.github.com/repos/rclone/rclone/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rclone/rclone/labels{/name}","releases_url":"https://api.github.com/repos/rclone/rclone/releases{/id}","deployments_url":"https://api.github.com/repos/rclone/rclone/deployments","created_at":"2014-03-16T16:19:57Z","updated_at":"2025-11-09T20:38:02Z","pushed_at":"2025-11-08T21:33:38Z","git_url":"git://github.com/rclone/rclone.git","ssh_url":"git@github.com:rclone/rclone.git","clone_url":"https://github.com/rclone/rclone.git","svn_url":"https://github.com/rclone/rclone","homepage":"https://rclone.org","size":217990,"stargazers_count":53422,"watchers_count":53422,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":4767,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1169,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["azure-blob","azure-blob-storage","azure-files","backblaze-b2","cloud-storage","dropbox","encryption","ftp","fuse-filesystem","go","golang","google-cloud-storage","google-drive","onedrive","openstack-swift","rclone","s3","sftp","sync","webdav"],"visibility":"public","forks":4767,"open_issues":1169,"watchers":53422,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/rclone/rclone/pulls/166","html_url":"https://github.com/rclone/rclone/pull/166","diff_url":"https://github.com/rclone/rclone/pull/166.diff","patch_url":"https://github.com/rclone/rclone/pull/166.patch","merged_at":null},"body":"Edit: Can be merged after review.\n\nProposal for #164 - This adds 4x4MB async buffers to the input when copying files.\n\nThis needs a little polish before begin ready for a merge, but should give a general impression.\n\nIt should be adjusted for input size, so it is only added when files are above a certain size.\n","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/166/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/166/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":428884912,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQyODg4NDkxMg==","url":"https://api.github.com/repos/rclone/rclone/issues/events/428884912","actor":{"login":"klauspost","id":5663952,"node_id":"MDQ6VXNlcjU2NjM5NTI=","avatar_url":"https://avatars.githubusercontent.com/u/5663952?v=4","gravatar_id":"","url":"https://api.github.com/users/klauspost","html_url":"https://github.com/klauspost","followers_url":"https://api.github.com/users/klauspost/followers","following_url":"https://api.github.com/users/klauspost/following{/other_user}","gists_url":"https://api.github.com/users/klauspost/gists{/gist_id}","starred_url":"https://api.github.com/users/klauspost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klauspost/subscriptions","organizations_url":"https://api.github.com/users/klauspost/orgs","repos_url":"https://api.github.com/users/klauspost/repos","events_url":"https://api.github.com/users/klauspost/events{/privacy}","received_events_url":"https://api.github.com/users/klauspost/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"2b83830401cb1516f2fd3744623907b9c120d9d3","commit_url":"https://api.github.com/repos/klauspost/rclone/commits/2b83830401cb1516f2fd3744623907b9c120d9d3","created_at":"2015-10-07T09:01:25Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/146296126","html_url":"https://github.com/rclone/rclone/issues/164#issuecomment-146296126","issue_url":"https://api.github.com/repos/rclone/rclone/issues/164","id":146296126,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NjI5NjEyNg==","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-10-07T19:04:37Z","updated_at":"2015-10-07T19:04:37Z","body":"I've added some general comments on the commit 2b83830401cb1516f2fd3744623907b9c120d9d3\n\nI think the code looks very nice.\n\nThere are 3 magic numbers it would be nice to have a better justification for \n- the cutoff size before we engage the buffer\n- the size of buffer\n- the number of buffers\n\nA bit of testing with rclone could help.  Probably want 10s of largish file so rclone can transfer them in parallel and measure the throughput for\n- disk -> disk\n- disk -> remote\n- remote -> disk\n- remote -> remote\n\nI wonder whether it might be better to have a larger number of smaller (say 32k) buffers. These could then be managed with a `sync.Pool` which would mean that they wouldn't be used if necessary (eg when the output is keeping up with the input). The buffer size should certainly be a multiple of the page size.\n\nAnother thing I was wondering was whether we should implement the [ReaderAt](https://golang.org/pkg/io/#ReaderAt) interface which would save copying the data?\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/146296126/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/146591954","html_url":"https://github.com/rclone/rclone/issues/164#issuecomment-146591954","issue_url":"https://api.github.com/repos/rclone/rclone/issues/164","id":146591954,"node_id":"MDEyOklzc3VlQ29tbWVudDE0NjU5MTk1NA==","user":{"login":"klauspost","id":5663952,"node_id":"MDQ6VXNlcjU2NjM5NTI=","avatar_url":"https://avatars.githubusercontent.com/u/5663952?v=4","gravatar_id":"","url":"https://api.github.com/users/klauspost","html_url":"https://github.com/klauspost","followers_url":"https://api.github.com/users/klauspost/followers","following_url":"https://api.github.com/users/klauspost/following{/other_user}","gists_url":"https://api.github.com/users/klauspost/gists{/gist_id}","starred_url":"https://api.github.com/users/klauspost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klauspost/subscriptions","organizations_url":"https://api.github.com/users/klauspost/orgs","repos_url":"https://api.github.com/users/klauspost/repos","events_url":"https://api.github.com/users/klauspost/events{/privacy}","received_events_url":"https://api.github.com/users/klauspost/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-10-08T15:59:25Z","updated_at":"2015-10-08T16:04:56Z","body":"I did a bit of provisional benchmarking, and getting some hard numbers beyond what I have presented is tricky. The buffers are there mainly to handle uneven and smooth out bursty reads/writes. I cannot think of a good way to benchmark that. I think that no matter how we benchmark we will just end up optimizing for the specific benchmark.\n\nSo for me, the goal is to make sure there aren't any regression cases, while improving a proven worst case.\n\nThe gist of this is dealing with spinning disk thrashing and OS read scheduling. If we just test what you propose, there isn't going to be any significant changes unless you start pressuring the OS, by reading something else while you are running rclone.\n\nI verified this by running 10GB HD->SSD, HD->HD and SSD->HD rclone copy with and without the change. There wasn't any significant difference. There are of course rather high variance in these tests, since harddisk thrashing isn't predictable. So local file-copy at least has no regressions.\n\nI also tried benchmarking HD->SSD rclone while running a copy from the HD. It is depending on a _lot_ of factors.\n\n## Master when copying files:\n\n![master-with-copy](https://cloud.githubusercontent.com/assets/5663952/10369673/c14bf1da-6ddb-11e5-8471-1e2cad533c8a.png)\nAfter 2 minutes: 9512.02 kByte/s\n\n## New when copying files:\n\n![new-with-copy](https://cloud.githubusercontent.com/assets/5663952/10369690/d5b47fac-6ddb-11e5-8404-c74453be6d3d.png)\nAfter 2 minutes: 76382.85 kByte/s\n\nHowever, it seems like this is also very Windows specific. It seems that Windows gives preference to file reads with the biggest buffer, so it really depends on which method you use for copying, and explains why small reads are penalized so much.\n\nI tried remote -> remote, and the numbers are the same (612 vs 617KB/s).\n\n# magic numbers\n\nThe thresholds are set to limit the downsides. They could of course be user specified, but I don't like pushing the \"problem\" on to the user. Mainly unneeded overhead on small files. Let's take them one by one:\n\n## number of buffers\n\nThis is mainly a memory concern. More buffers are able to smooth out longer input drought or output bursts, but adding to many will eat too much memory. 3 or 4 seems reasonable.\n\n## buffer size\n\nSpinning disks likes sequential reads, so we want to make buffers a \"reasonable\" size. I choose 4MB, since that will allow the OS to read up to 4MB sequentially. Bigger buffers means more memory and longer latency - time from read request until data is ready for upstream. 1-16MB all seems reasonable.\n\nMaking buffers, say 32KB, will begin to give a significant overhead just by the number of channel send/receives needed to hand buffers between the goroutines. If we want that, we might as well slap in a bufio.Reader in and be done with it. In my experience `sync.Pool` doesn't help \"enough\" - it has significant synchronization overhead and the pool is flushed on every GC.\n\n## threshold\n\nLimit for when we don't expect to get much benefit. It is set rather high, but it is set where the 4MB initial read latency will have little overall effect. Could be anything from 1-50MB, but should reflect on the size of a buffer.\n\nEither way, making anything less than a 10x adjustment on any of them will only have an extremely limited effect. The current magic numbers are meant to catch the \"bad\" effects and not display any significant downsides.\n\nedit: Forgot `ReaderAt` - wouldn't that require random seeking on file? Do you mean [WriterTo](https://golang.org/pkg/io/#WriterTo)? I guess implementing that would save some Read roundtrips and avoid the byte copy.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/comments/146591954/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"klauspost","id":5663952,"node_id":"MDQ6VXNlcjU2NjM5NTI=","avatar_url":"https://avatars.githubusercontent.com/u/5663952?v=4","gravatar_id":"","url":"https://api.github.com/users/klauspost","html_url":"https://github.com/klauspost","followers_url":"https://api.github.com/users/klauspost/followers","following_url":"https://api.github.com/users/klauspost/following{/other_user}","gists_url":"https://api.github.com/users/klauspost/gists{/gist_id}","starred_url":"https://api.github.com/users/klauspost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klauspost/subscriptions","organizations_url":"https://api.github.com/users/klauspost/orgs","repos_url":"https://api.github.com/users/klauspost/repos","events_url":"https://api.github.com/users/klauspost/events{/privacy}","received_events_url":"https://api.github.com/users/klauspost/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":430792555,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQzMDc5MjU1NQ==","url":"https://api.github.com/repos/rclone/rclone/issues/events/430792555","actor":{"login":"klauspost","id":5663952,"node_id":"MDQ6VXNlcjU2NjM5NTI=","avatar_url":"https://avatars.githubusercontent.com/u/5663952?v=4","gravatar_id":"","url":"https://api.github.com/users/klauspost","html_url":"https://github.com/klauspost","followers_url":"https://api.github.com/users/klauspost/followers","following_url":"https://api.github.com/users/klauspost/following{/other_user}","gists_url":"https://api.github.com/users/klauspost/gists{/gist_id}","starred_url":"https://api.github.com/users/klauspost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klauspost/subscriptions","organizations_url":"https://api.github.com/users/klauspost/orgs","repos_url":"https://api.github.com/users/klauspost/repos","events_url":"https://api.github.com/users/klauspost/events{/privacy}","received_events_url":"https://api.github.com/users/klauspost/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"2892bd01742f05dc0ceba73c4d7b3d5488b39bb7","commit_url":"https://api.github.com/repos/klauspost/rclone/commits/2892bd01742f05dc0ceba73c4d7b3d5488b39bb7","created_at":"2015-10-08T21:01:32Z","performed_via_github_app":null},{"id":431230642,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQzMTIzMDY0Mg==","url":"https://api.github.com/repos/rclone/rclone/issues/events/431230642","actor":{"login":"klauspost","id":5663952,"node_id":"MDQ6VXNlcjU2NjM5NTI=","avatar_url":"https://avatars.githubusercontent.com/u/5663952?v=4","gravatar_id":"","url":"https://api.github.com/users/klauspost","html_url":"https://github.com/klauspost","followers_url":"https://api.github.com/users/klauspost/followers","following_url":"https://api.github.com/users/klauspost/following{/other_user}","gists_url":"https://api.github.com/users/klauspost/gists{/gist_id}","starred_url":"https://api.github.com/users/klauspost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klauspost/subscriptions","organizations_url":"https://api.github.com/users/klauspost/orgs","repos_url":"https://api.github.com/users/klauspost/repos","events_url":"https://api.github.com/users/klauspost/events{/privacy}","received_events_url":"https://api.github.com/users/klauspost/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"254586ad0384d93162293a135642374821dccd4d","commit_url":"https://api.github.com/repos/klauspost/rclone/commits/254586ad0384d93162293a135642374821dccd4d","created_at":"2015-10-09T09:41:05Z","performed_via_github_app":null},{"id":431237409,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQzMTIzNzQwOQ==","url":"https://api.github.com/repos/rclone/rclone/issues/events/431237409","actor":{"login":"klauspost","id":5663952,"node_id":"MDQ6VXNlcjU2NjM5NTI=","avatar_url":"https://avatars.githubusercontent.com/u/5663952?v=4","gravatar_id":"","url":"https://api.github.com/users/klauspost","html_url":"https://github.com/klauspost","followers_url":"https://api.github.com/users/klauspost/followers","following_url":"https://api.github.com/users/klauspost/following{/other_user}","gists_url":"https://api.github.com/users/klauspost/gists{/gist_id}","starred_url":"https://api.github.com/users/klauspost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klauspost/subscriptions","organizations_url":"https://api.github.com/users/klauspost/orgs","repos_url":"https://api.github.com/users/klauspost/repos","events_url":"https://api.github.com/users/klauspost/events{/privacy}","received_events_url":"https://api.github.com/users/klauspost/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"3ddccade9fe0425102a8aee4744414bfe806c5ca","commit_url":"https://api.github.com/repos/klauspost/rclone/commits/3ddccade9fe0425102a8aee4744414bfe806c5ca","created_at":"2015-10-09T09:49:35Z","performed_via_github_app":null},{"id":432654075,"node_id":"MDExOkNsb3NlZEV2ZW50NDMyNjU0MDc1","url":"https://api.github.com/repos/rclone/rclone/issues/events/432654075","actor":{"login":"klauspost","id":5663952,"node_id":"MDQ6VXNlcjU2NjM5NTI=","avatar_url":"https://avatars.githubusercontent.com/u/5663952?v=4","gravatar_id":"","url":"https://api.github.com/users/klauspost","html_url":"https://github.com/klauspost","followers_url":"https://api.github.com/users/klauspost/followers","following_url":"https://api.github.com/users/klauspost/following{/other_user}","gists_url":"https://api.github.com/users/klauspost/gists{/gist_id}","starred_url":"https://api.github.com/users/klauspost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/klauspost/subscriptions","organizations_url":"https://api.github.com/users/klauspost/orgs","repos_url":"https://api.github.com/users/klauspost/repos","events_url":"https://api.github.com/users/klauspost/events{/privacy}","received_events_url":"https://api.github.com/users/klauspost/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"6344c3051caf06c3ecd2da5148bd01391ef22b99","commit_url":"https://api.github.com/repos/rclone/rclone/commits/6344c3051caf06c3ecd2da5148bd01391ef22b99","created_at":"2015-10-12T07:34:45Z","state_reason":null,"performed_via_github_app":null}]