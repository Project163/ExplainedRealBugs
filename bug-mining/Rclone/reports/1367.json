{"url":"https://api.github.com/repos/rclone/rclone/issues/8465","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/8465/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/8465/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/8465/events","html_url":"https://github.com/rclone/rclone/issues/8465","id":2939510342,"node_id":"I_kwDOAQ-n5M6vNV5G","number":8465,"title":"Sort Graph permissions with users ahead of groups","user":{"login":"chscott","id":9805298,"node_id":"MDQ6VXNlcjk4MDUyOTg=","avatar_url":"https://avatars.githubusercontent.com/u/9805298?v=4","gravatar_id":"","url":"https://api.github.com/users/chscott","html_url":"https://github.com/chscott","followers_url":"https://api.github.com/users/chscott/followers","following_url":"https://api.github.com/users/chscott/following{/other_user}","gists_url":"https://api.github.com/users/chscott/gists{/gist_id}","starred_url":"https://api.github.com/users/chscott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chscott/subscriptions","organizations_url":"https://api.github.com/users/chscott/orgs","repos_url":"https://api.github.com/users/chscott/repos","events_url":"https://api.github.com/users/chscott/events{/privacy}","received_events_url":"https://api.github.com/users/chscott/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":6919867104,"node_id":"LA_kwDOAQ-n5M8AAAABnHTK4A","url":"https://api.github.com/repos/rclone/rclone/labels/Support%20Contract","name":"Support Contract","color":"D93F0B","default":false,"description":"Issues made for customers with support contracts"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/58","html_url":"https://github.com/rclone/rclone/milestone/58","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/58/labels","id":11570782,"node_id":"MI_kwDOAQ-n5M4AsI5e","number":58,"title":"v1.70","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":30,"state":"closed","created_at":"2024-09-11T21:18:44Z","updated_at":"2025-06-23T15:40:38Z","due_on":"2025-06-17T07:00:00Z","closed_at":"2025-06-19T17:12:14Z"},"comments":23,"created_at":"2025-03-21T21:10:37Z","updated_at":"2025-04-11T09:40:21Z","closed_at":"2025-04-11T09:39:02Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### The associated forum post URL from `https://forum.rclone.org`\n\nDiscussed in email.\n\n#### What is your current rclone version (output from `rclone version`)?\n\n`v1.69.1`\n\n#### What problem are you are trying to solve?\n\nGraph has a quirk that manifests when all of these conditions apply:\n\n1. You are adding permissions for both a group and a user.\n2. The user is a member of the group.\n3. The permissions for the group and user are the same.\n4. You are adding the group permission before the user permission.\n\nWhen all of the above are true, Graph indicates it has added the user permission, but it immediately drops it. For example:\n\n```\n2025/03/21 15:08:01 DEBUG : HTTP REQUEST (req 0xc0005bf040)\n2025/03/21 15:08:01 DEBUG : POST /v1.0/drives/b!ssbqQHJ0v0Ki4mBGkrRBXWvDWPc3piNIl8WI29g4XaD8jOMrJ7J6RKVhFAqRVq5-/items/01N4X3HM6FM5BTRUMZGVDKZS7JNQWOAEX3/invite HTTP/1.1\n{\"recipients\":[{\"email\":\"reviewers@cdsconsulting.org\"}],\"requireSignIn\":true,\"roles\":[\"write\"]}\n2025/03/21 15:08:01 DEBUG : HTTP RESPONSE (req 0xc0005bf040)\n2025/03/21 15:08:01 DEBUG : HTTP/2.0 200 OK\n{\n    \"@odata.context\": \"https://graph.microsoft.com/v1.0/$metadata#Collection(microsoft.graph.permission)\",\n    \"value\": [{\n            \"id\": \"Yzowby5jfGZlZGVyYXRlZGRpcmVjdG9yeWNsYWltcHJvdmlkZXJ8ZmVjMjNjZGYtYTZkZS00OTU1LWFkZWItMDE3OTM2NWU2Yjdi\",\n            \"roles\": [\"write\"],\n            \"grantedTo\": {\n                \"user\": {\n                    \"email\": \"reviewers@cdsconsultingllc.onmicrosoft.com\",\n                    \"displayName\": \"Reviewers Members\"\n                }\n            }\n        }\n    ]\n}\n\n2025/03/21 15:08:01 DEBUG : HTTP REQUEST (req 0xc000bb1400)\n2025/03/21 15:08:01 DEBUG : POST /v1.0/drives/b!ssbqQHJ0v0Ki4mBGkrRBXWvDWPc3piNIl8WI29g4XaD8jOMrJ7J6RKVhFAqRVq5-/items/01N4X3HM6FM5BTRUMZGVDKZS7JNQWOAEX3/invite HTTP/1.1\n{\"recipients\":[{\"email\":\"angie.scott@cdsconsulting.org\"}],\"requireSignIn\":true,\"roles\":[\"write\"]}\n2025/03/21 15:08:02 DEBUG : HTTP RESPONSE (req 0xc000bb1400)\n2025/03/21 15:08:02 DEBUG : HTTP/2.0 200 OK\n{\n    \"@odata.context\": \"https://graph.microsoft.com/v1.0/$metadata#Collection(microsoft.graph.permission)\",\n    \"value\": [{\n            \"id\": \"aTowIy5mfG1lbWJlcnNoaXB8YW5naWUuc2NvdHRAY2RzY29uc3VsdGluZy5vcmc\",\n            \"roles\": [\"write\"],\n            \"grantedTo\": {\n                \"user\": {\n                    \"email\": \"angie@cdsconsulting.org\",\n                    \"id\": \"4b9c56cb-83b3-4b1a-a66f-5e108a840bf4\",\n                    \"displayName\": \"Angie Scott\"\n                }\n            }\n        }\n    ]\n}\n\n2025/03/21 15:08:02 DEBUG : HTTP REQUEST (req 0xc0005bfe00)\n2025/03/21 15:08:02 DEBUG : GET /v1.0/drives/b!ssbqQHJ0v0Ki4mBGkrRBXWvDWPc3piNIl8WI29g4XaD8jOMrJ7J6RKVhFAqRVq5-/items/01N4X3HM6FM5BTRUMZGVDKZS7JNQWOAEX3/permissions HTTP/1.1\n2025/03/21 15:08:02 DEBUG : HTTP RESPONSE (req 0xc0005bfe00)\n2025/03/21 15:08:02 DEBUG : HTTP/2.0 200 OK\n{\n    \"@odata.context\": \"https://graph.microsoft.com/v1.0/$metadata#drives('b%21ssbqQHJ0v0Ki4mBGkrRBXWvDWPc3piNIl8WI29g4XaD8jOMrJ7J6RKVhFAqRVq5-')/items('01N4X3HM6FM5BTRUMZGVDKZS7JNQWOAEX3')/permissions\",\n    \"value\": [{\n            \"id\": \"Yzowby5jfGZlZGVyYXRlZGRpcmVjdG9yeWNsYWltcHJvdmlkZXJ8ZmVjMjNjZGYtYTZkZS00OTU1LWFkZWItMDE3OTM2NWU2Yjdi\",\n            \"roles\": [\"write\"],\n            \"shareId\": \"Yzowby5jfGZlZGVyYXRlZGRpcmVjdG9yeWNsYWltcHJvdmlkZXJ8ZmVjMjNjZGYtYTZkZS00OTU1LWFkZWItMDE3OTM2NWU2Yjdi\",\n            \"grantedToV2\": {\n                \"group\": {\n                    \"@odata.type\": \"#microsoft.graph.sharePointIdentity\",\n                    \"displayName\": \"Reviewers Members\",\n                    \"email\": \"reviewers@cdsconsultingllc.onmicrosoft.com\",\n                    \"id\": \"fec23cdf-a6de-4955-adeb-0179365e6b7b\"\n                },\n                \"siteUser\": {\n                    \"displayName\": \"Reviewers Members\",\n                    \"email\": \"reviewers@cdsconsultingllc.onmicrosoft.com\",\n                    \"id\": \"16\",\n                    \"loginName\": \"c:0o.c|federateddirectoryclaimprovider|fec23cdf-a6de-4955-adeb-0179365e6b7b\"\n                }\n            },\n            \"grantedTo\": {\n                \"user\": {\n                    \"displayName\": \"Reviewers Members\",\n                    \"email\": \"reviewers@cdsconsultingllc.onmicrosoft.com\",\n                    \"id\": \"fec23cdf-a6de-4955-adeb-0179365e6b7b\"\n                }\n            }\n        }, {\n            \"id\": \"aTowIy5mfG1lbWJlcnNoaXB8Y2hhZC5zY290dEBjZHNjb25zdWx0aW5nLm9yZw\",\n            \"roles\": [\"owner\"],\n            \"shareId\": \"aTowIy5mfG1lbWJlcnNoaXB8Y2hhZC5zY290dEBjZHNjb25zdWx0aW5nLm9yZw\",\n            \"grantedToV2\": {\n                \"user\": {\n                    \"@odata.type\": \"#microsoft.graph.sharePointIdentity\",\n                    \"displayName\": \"Chad Scott\",\n                    \"email\": \"chad@cdsconsulting.org\",\n                    \"id\": \"7ecdcdf3-e69a-4194-8ad8-e290ea289fd5\"\n                },\n                \"siteUser\": {\n                    \"displayName\": \"Chad Scott\",\n                    \"email\": \"chad@cdsconsulting.org\",\n                    \"id\": \"3\",\n                    \"loginName\": \"i:0#.f|membership|chad.scott@cdsconsulting.org\"\n                }\n            },\n            \"grantedTo\": {\n                \"user\": {\n                    \"displayName\": \"Chad Scott\",\n                    \"email\": \"chad@cdsconsulting.org\",\n                    \"id\": \"7ecdcdf3-e69a-4194-8ad8-e290ea289fd5\"\n                }\n            }\n        }\n    ]\n}\n```\n\n#### How do you think rclone should be changed to solve that?\n\nAttempt to apply user permissions before group permissions, which works around the issue. Note that you can force this to be the case today by returning a sorted permissions object from the mapper, but it's probably not obvious that this is required.\n\n<!--- Please keep the note below for others who read your feature request. -->\n\n#### How to use GitHub\n\n* Please use the üëç [reaction](https://blog.github.com/2016-03-10-add-reactions-to-pull-requests-issues-and-comments/) to show that you are affected by the same issue.\n* Please don't comment if you have no relevant information to add. It's just extra noise for everyone subscribed to this issue.\n* Subscribe to receive notifications on status change and new comments.\n","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/8465/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/8465/timeline","performed_via_github_app":null,"state_reason":"completed"}