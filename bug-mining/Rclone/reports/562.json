{"url":"https://api.github.com/repos/rclone/rclone/issues/2811","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/2811/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/2811/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/2811/events","html_url":"https://github.com/rclone/rclone/issues/2811","id":386607342,"node_id":"MDU6SXNzdWUzODY2MDczNDI=","number":2811,"title":"vfs: deadlock on accessing a directory with --poll-changes","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":430778096,"node_id":"MDU6TGFiZWw0MzA3NzgwOTY=","url":"https://api.github.com/repos/rclone/rclone/labels/VFS%20/%20mount","name":"VFS / mount","color":"0e8a16","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/33","html_url":"https://github.com/rclone/rclone/milestone/33","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/33/labels","id":3752396,"node_id":"MDk6TWlsZXN0b25lMzc1MjM5Ng==","number":33,"title":"v1.46","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":43,"state":"closed","created_at":"2018-10-19T14:56:28Z","updated_at":"2019-02-09T18:12:01Z","due_on":"2019-02-09T08:00:00Z","closed_at":"2019-02-09T18:11:23Z"},"comments":13,"created_at":"2018-12-02T22:25:06Z","updated_at":"2021-10-01T10:20:35Z","closed_at":"2018-12-26T09:08:55Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### What is the problem you are having with rclone?\r\n\r\nSometimes the VFS deadlocks when\r\n- multiple programs are reading / writing a directory\r\n- and a directory change comes in\r\n\r\nSee: https://forum.rclone.org/t/vfs-mount-freezes/7566\r\n\r\n#### What is your rclone version (output from `rclone version`)\r\n\r\nlatest master\r\n\r\n#### Which OS you are using and how many bits (eg Windows 7, 64 bit)\r\n\r\nlinux 64 bit\r\n\r\n####  Which cloud storage system are you using? (eg Google Drive)\r\n\r\ngoogle drive\r\n\r\n#### The command you were trying to run (eg `rclone copy /tmp remote:tmp`)\r\n\r\nTo reproduce\r\n\r\nRun this in one window\r\n\r\n    rclone mount -vv --poll-interval 0.2s --vfs-cache-mode writes --dir-cache-time=720h drive:test /mnt/tmp/\r\n\r\nAnd this in another\r\n\r\n    export i=1 ; while true ; do ls /mnt/tmp/test-deadlock ; echo \"hello\" > /mnt/tmp/test-deadlock/$i ; rm /mnt/tmp/test-deadlock/$i ; done\r\n\r\nAnd this in a 3rd\r\n\r\n    export i=2 ; while true ; do ls /mnt/tmp/test-deadlock ; echo \"hello\" > /mnt/tmp/test-deadlock/$i ; rm /mnt/tmp/test-deadlock/$i ; done\r\n\r\nThis deadlocks quite soon after the `i=2` command is run.\r\n\r\nIt doesn't deadlock if only the `i=1` command is run.\r\n\r\nIt doesn't deadlock if the `--poll-interval` is set very large.\r\n\r\nThe deadlock looks like this\r\n\r\n```\r\n2018/12/02 22:06:53 DEBUG : Google drive root 'test': Checking for changes on remote\r\n2018/12/02 22:06:53 DEBUG : Google drive root 'test': Checking for changes on remote\r\n2018/12/02 22:06:54 DEBUG : Google drive root 'test': Checking for changes on remote\r\n2018/12/02 22:06:54 DEBUG : test-deadlock/1: Removed from cache\r\n2018/12/02 22:06:54 DEBUG : test-deadlock/: >Remove: err=<nil>\r\n2018/12/02 22:06:54 DEBUG : fuse: -> [ID=0xa7] Remove\r\n2018/12/02 22:06:54 DEBUG : fuse: <- Forget [ID=0xa8 Node=0x5 Uid=0 Gid=0 Pid=0] 1\r\n2018/12/02 22:06:54 DEBUG : fuse: -> [ID=0xa8] Forget\r\n2018/12/02 22:06:54 DEBUG : fuse: <- Lookup [ID=0xa9 Node=0x1 Uid=502 Gid=502 Pid=11555] \"test-deadlock\"\r\n2018/12/02 22:06:54 DEBUG : /: Lookup: name=\"test-deadlock\"\r\n2018/12/02 22:06:54 DEBUG : /: >Lookup: node=test-deadlock/, err=<nil>\r\n2018/12/02 22:06:54 DEBUG : test-deadlock/: Attr: \r\n2018/12/02 22:06:54 DEBUG : test-deadlock/: >Attr: attr=valid=1s ino=0 size=0 mode=drwxrwxr-x, err=<nil>\r\n2018/12/02 22:06:54 DEBUG : fuse: -> [ID=0xa9] Lookup 0x5 gen=38 valid=1s attr={valid=1s ino=2334695540606880430 size=0 mode=drwxrwxr-x}\r\n2018/12/02 22:06:54 DEBUG : fuse: <- Forget [ID=0xaa Node=0x5 Uid=0 Gid=0 Pid=0] 1\r\n2018/12/02 22:06:54 DEBUG : fuse: <- Lookup [ID=0xab Node=0x1 Uid=502 Gid=502 Pid=11555] \"test-deadlock\"\r\n2018/12/02 22:06:54 DEBUG : /: Lookup: name=\"test-deadlock\"\r\n2018/12/02 22:06:54 DEBUG : /: >Lookup: node=test-deadlock/, err=<nil>\r\n2018/12/02 22:06:54 DEBUG : test-deadlock/: Attr: \r\n2018/12/02 22:06:54 DEBUG : test-deadlock/: >Attr: attr=valid=1s ino=0 size=0 mode=drwxrwxr-x, err=<nil>\r\n2018/12/02 22:06:54 DEBUG : fuse: -> [ID=0xab] Lookup 0x5 gen=39 valid=1s attr={valid=1s ino=2334695540606880430 size=0 mode=drwxrwxr-x}\r\n2018/12/02 22:06:54 DEBUG : fuse: <- Forget [ID=0xac Node=0x2 Uid=0 Gid=0 Pid=0] 1\r\n2018/12/02 22:06:54 DEBUG : fuse: -> [ID=0xac] Forget\r\n2018/12/02 22:06:54 DEBUG : fuse: -> [ID=0xaa] Forget\r\n2018/12/02 22:06:54 DEBUG : fuse: <- Open [ID=0xad Node=0x5 Uid=502 Gid=502 Pid=11555] dir=true fl=OpenReadOnly+OpenDirectory+OpenNonblock\r\n2018/12/02 22:06:54 DEBUG : fuse: -> [ID=0xad] Open 0x1 fl=0\r\n2018/12/02 22:06:54 DEBUG : fuse: <- Read [ID=0xae Node=0x5 Uid=502 Gid=502 Pid=11555] 0x1 4096 @0x0 dir=true fl=0 lock=0 ffl=OpenReadOnly+OpenDirectory+OpenNonblock\r\n2018/12/02 22:06:54 DEBUG : test-deadlock/: ReadDirAll: \r\n2018/12/02 22:06:54 DEBUG : test-deadlock/: >ReadDirAll: item=1, err=<nil>\r\n2018/12/02 22:06:54 DEBUG : fuse: -> [ID=0xae] Read 32\r\n2018/12/02 22:06:54 DEBUG : fuse: <- Lookup [ID=0xaf Node=0x5 Uid=502 Gid=502 Pid=11555] \"2\"\r\n2018/12/02 22:06:54 DEBUG : test-deadlock/: Lookup: name=\"2\"\r\n2018/12/02 22:06:54 DEBUG : test-deadlock/: >Lookup: node=test-deadlock/2, err=<nil>\r\n2018/12/02 22:06:54 DEBUG : test-deadlock/2: Attr: \r\n2018/12/02 22:06:54 DEBUG : test-deadlock/2: >Attr: a=valid=1s ino=0 size=6 mode=-rw-rw-r--, err=<nil>\r\n2018/12/02 22:06:54 DEBUG : fuse: -> [ID=0xaf] Lookup 0x2 gen=40 valid=1s attr={valid=1s ino=4004752764195615492 size=6 mode=-rw-rw-r--}\r\n2018/12/02 22:06:54 DEBUG : fuse: <- Read [ID=0xb0 Node=0x5 Uid=502 Gid=502 Pid=11555] 0x1 4096 @0x20 dir=true fl=0 lock=0 ffl=OpenReadOnly+OpenDirectory+OpenNonblock\r\n2018/12/02 22:06:54 DEBUG : fuse: -> [ID=0xb0] Read 0\r\n2018/12/02 22:06:54 DEBUG : fuse: <- Release [ID=0xb1 Node=0x5 Uid=0 Gid=0 Pid=0] 0x1 fl=OpenReadOnly+OpenDirectory+OpenNonblock rfl=0 owner=0x0\r\n2018/12/02 22:06:54 DEBUG : fuse: -> [ID=0xb1] Release\r\n2018/12/02 22:06:54 DEBUG : fuse: <- Lookup [ID=0xb2 Node=0x5 Uid=502 Gid=502 Pid=32351] \"1\"\r\n2018/12/02 22:06:54 DEBUG : test-deadlock/: Lookup: name=\"1\"\r\n2018/12/02 22:06:54 DEBUG : test-deadlock/: >Lookup: node=<nil>, err=no such file or directory\r\n2018/12/02 22:06:54 DEBUG : fuse: -> [ID=0xb2] Lookup error=ENOENT\r\n2018/12/02 22:06:54 DEBUG : fuse: <- Create [ID=0xb3 Node=0x5 Uid=502 Gid=502 Pid=32351] \"1\" fl=OpenWriteOnly+OpenCreate+OpenTruncate mode=-rw-rw-r-- umask=--------w-\r\n2018/12/02 22:06:54 DEBUG : test-deadlock/: Create: name=\"1\"\r\n2018/12/02 22:06:54 DEBUG : test-deadlock/1: Open: flags=O_WRONLY|O_CREATE|O_TRUNC\r\n2018/12/02 22:06:54 DEBUG : test-deadlock/1(0xc0000bdb00): Opening cached copy with flags=O_WRONLY|O_CREATE|O_TRUNC\r\n2018/12/02 22:06:54 DEBUG : test-deadlock/1: >Open: fd=test-deadlock/1 (rw), err=<nil>\r\n2018/12/02 22:06:54 DEBUG : test-deadlock/: >Create: node=test-deadlock/1, handle=&{test-deadlock/1 (rw)}, err=<nil>\r\n2018/12/02 22:06:54 DEBUG : test-deadlock/1: Attr: \r\n2018/12/02 22:06:54 DEBUG : test-deadlock/1: >Attr: a=valid=1s ino=0 size=0 mode=-rw-rw-r--, err=<nil>\r\n2018/12/02 22:06:54 DEBUG : fuse: -> [ID=0xb3] Create {0x3 gen=41 valid=1m0s attr={valid=1s ino=4004756062730500125 size=0 mode=-rw-rw-r--}} {0x1 fl=0}\r\n2018/12/02 22:06:54 DEBUG : fuse: <- Flush [ID=0xb4 Node=0x3 Uid=502 Gid=502 Pid=32351] 0x1 fl=0x0 lk=0xb8ca17e21032f904\r\n2018/12/02 22:06:54 DEBUG : &{test-deadlock/1 (rw)}: Flush: \r\n2018/12/02 22:06:54 DEBUG : test-deadlock/1(0xc0000bdb00): RWFileHandle.Flush ignoring flush on unwritten handle\r\n2018/12/02 22:06:54 DEBUG : &{test-deadlock/1 (rw)}: >Flush: err=<nil>\r\n2018/12/02 22:06:54 DEBUG : fuse: -> [ID=0xb4] Flush\r\n2018/12/02 22:06:54 DEBUG : fuse: <- Write [ID=0xb5 Node=0x3 Uid=502 Gid=502 Pid=32351] 0x1 6 @0 fl=0 lock=0 ffl=OpenWriteOnly\r\n2018/12/02 22:06:54 DEBUG : &{test-deadlock/1 (rw)}: Write: len=6, offset=0\r\n2018/12/02 22:06:54 DEBUG : &{test-deadlock/1 (rw)}: >Write: written=6, err=<nil>\r\n2018/12/02 22:06:54 DEBUG : fuse: -> [ID=0xb5] Write 6\r\n2018/12/02 22:06:54 DEBUG : fuse: <- Flush [ID=0xb6 Node=0x3 Uid=502 Gid=502 Pid=32351] 0x1 fl=0x0 lk=0xb8ca17e21032f904\r\n2018/12/02 22:06:54 DEBUG : &{test-deadlock/1 (rw)}: Flush: \r\n2018/12/02 22:06:54 DEBUG : test-deadlock/1(0xc0000bdb00): close: \r\n2018/12/02 22:06:54 DEBUG : test-deadlock/1: Couldn't find file - need to transfer\r\n2018/12/02 22:06:54 DEBUG : test-deadlock: invalidating directory cache\r\n2018/12/02 22:06:54 DEBUG : Google drive root 'test': Checking for changes on remote\r\n2018/12/02 22:06:54 DEBUG : Google drive root 'test': Checking for changes on remote\r\n2018/12/02 22:06:55 DEBUG : Google drive root 'test': Checking for changes on remote\r\n2018/12/02 22:06:55 DEBUG : fuse: <- Lookup [ID=0xb7 Node=0x1 Uid=502 Gid=502 Pid=11559] \"test-deadlock\"\r\n2018/12/02 22:06:55 DEBUG : /: Lookup: name=\"test-deadlock\"\r\n2018/12/02 22:06:55 DEBUG : /: >Lookup: node=test-deadlock/, err=<nil>\r\n2018/12/02 22:06:55 DEBUG : test-deadlock/: Attr: \r\n2018/12/02 22:06:55 DEBUG : test-deadlock/: >Attr: attr=valid=1s ino=0 size=0 mode=drwxrwxr-x, err=<nil>\r\n2018/12/02 22:06:55 DEBUG : fuse: -> [ID=0xb7] Lookup 0x4 gen=42 valid=1s attr={valid=1s ino=2334695540606880430 size=0 mode=drwxrwxr-x}\r\n2018/12/02 22:06:55 DEBUG : fuse: <- Forget [ID=0xb8 Node=0x4 Uid=0 Gid=0 Pid=0] 1\r\n2018/12/02 22:06:55 DEBUG : fuse: -> [ID=0xb8] Forget\r\n2018/12/02 22:06:55 DEBUG : fuse: <- Forget [ID=0xba Node=0x2 Uid=0 Gid=0 Pid=0] 1\r\n2018/12/02 22:06:55 DEBUG : fuse: <- Lookup [ID=0xb9 Node=0x1 Uid=502 Gid=502 Pid=11559] \"test-deadlock\"\r\n2018/12/02 22:06:55 DEBUG : fuse: -> [ID=0xba] Forget\r\n2018/12/02 22:06:55 DEBUG : /: Lookup: name=\"test-deadlock\"\r\n2018/12/02 22:06:55 DEBUG : /: >Lookup: node=test-deadlock/, err=<nil>\r\n2018/12/02 22:06:55 DEBUG : test-deadlock/: Attr: \r\n2018/12/02 22:06:55 DEBUG : test-deadlock/: >Attr: attr=valid=1s ino=0 size=0 mode=drwxrwxr-x, err=<nil>\r\n2018/12/02 22:06:55 DEBUG : fuse: -> [ID=0xb9] Lookup 0x2 gen=43 valid=1s attr={valid=1s ino=2334695540606880430 size=0 mode=drwxrwxr-x}\r\n2018/12/02 22:06:55 DEBUG : fuse: <- Open [ID=0xbb Node=0x2 Uid=502 Gid=502 Pid=11559] dir=true fl=OpenReadOnly+OpenDirectory+OpenNonblock\r\n2018/12/02 22:06:55 DEBUG : fuse: -> [ID=0xbb] Open 0x2 fl=0\r\n2018/12/02 22:06:55 DEBUG : fuse: <- Read [ID=0xbc Node=0x2 Uid=502 Gid=502 Pid=11559] 0x2 4096 @0x0 dir=true fl=0 lock=0 ffl=OpenReadOnly+OpenDirectory+OpenNonblock\r\n2018/12/02 22:06:55 DEBUG : test-deadlock/: ReadDirAll: \r\n2018/12/02 22:06:55 DEBUG : Google drive root 'test': Checking for changes on remote\r\n2018/12/02 22:06:55 INFO  : test-deadlock/1: Copied (new)\r\n2018/12/02 22:06:55 DEBUG : Google drive root 'test': Checking for changes on remote\r\n2018/12/02 22:07:01 DEBUG : fuse: <- Lookup [ID=0xbd Node=0x1 Uid=502 Gid=502 Pid=11574] \"test-deadlock\"\r\n2018/12/02 22:07:01 DEBUG : /: Lookup: name=\"test-deadlock\"\r\n2018/12/02 22:07:01 DEBUG : /: >Lookup: node=test-deadlock/, err=<nil>\r\n2018/12/02 22:07:01 DEBUG : test-deadlock/: Attr: \r\n2018/12/02 22:07:01 DEBUG : test-deadlock/: >Attr: attr=valid=1s ino=0 size=0 mode=drwxrwxr-x, err=<nil>\r\n2018/12/02 22:07:01 DEBUG : fuse: -> [ID=0xbd] Lookup 0x4 gen=44 valid=1s attr={valid=1s ino=2334695540606880430 size=0 mode=drwxrwxr-x}\r\n2018/12/02 22:07:01 DEBUG : fuse: <- Forget [ID=0xbe Node=0x4 Uid=0 Gid=0 Pid=0] 1\r\n2018/12/02 22:07:01 DEBUG : fuse: -> [ID=0xbe] Forget\r\n2018/12/02 22:07:01 DEBUG : fuse: <- Lookup [ID=0xbf Node=0x1 Uid=502 Gid=502 Pid=11574] \"test-deadlock\"\r\n2018/12/02 22:07:01 DEBUG : /: Lookup: name=\"test-deadlock\"\r\n2018/12/02 22:07:01 DEBUG : /: >Lookup: node=test-deadlock/, err=<nil>\r\n2018/12/02 22:07:01 DEBUG : test-deadlock/: Attr: \r\n2018/12/02 22:07:01 DEBUG : test-deadlock/: >Attr: attr=valid=1s ino=0 size=0 mode=drwxrwxr-x, err=<nil>\r\n2018/12/02 22:07:01 DEBUG : fuse: -> [ID=0xbf] Lookup 0x4 gen=45 valid=1s attr={valid=1s ino=2334695540606880430 size=0 mode=drwxrwxr-x}\r\n2018/12/02 22:07:01 DEBUG : fuse: <- Open [ID=0xc0 Node=0x4 Uid=502 Gid=502 Pid=11574] dir=true fl=OpenReadOnly+OpenDirectory+OpenNonblock\r\n2018/12/02 22:07:01 DEBUG : fuse: -> [ID=0xc0] Open 0x3 fl=0\r\n2018/12/02 22:07:01 DEBUG : fuse: <- Read [ID=0xc1 Node=0x4 Uid=502 Gid=502 Pid=11574] 0x3 4096 @0x0 dir=true fl=0 lock=0 ffl=OpenReadOnly+OpenDirectory+OpenNonblock\r\n2018/12/02 22:07:01 DEBUG : test-deadlock/: ReadDirAll: \r\n```\r\n\r\nSIGQUIT gives this - 3 goroutines blocked on semacquire\r\n- ForgetPath\r\n- setObjectNoUpdate\r\n- addObject\r\n\r\n```\r\ngoroutine 14 [semacquire]:\r\nsync.runtime_SemacquireMutex(0xc0006bdd14, 0xc0004f0800)\r\n\t/opt/go/go1.11/src/runtime/sema.go:71 +0x3d\r\nsync.(*Mutex).Lock(0xc0006bdd10)\r\n\t/opt/go/go1.11/src/sync/mutex.go:134 +0xff\r\ngithub.com/ncw/rclone/vfs.(*Dir).ForgetPath(0xc000358240, 0xc0004f08c0, 0xf, 0x3)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vfs/dir.go:116 +0x173\r\ngithub.com/ncw/rclone/vfs.(*Dir).ForgetPath-fm(0xc0004f08c0, 0xf, 0x3)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vfs/vfs.go:230 +0x48\r\ngithub.com/ncw/rclone/backend/drive.(*Fs).changeNotifyRunner(0xc0001be900, 0xc00006c570, 0xc00015e180, 0x7, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/backend/drive/drive.go:2182 +0xa24\r\ngithub.com/ncw/rclone/backend/drive.(*Fs).ChangeNotify.func1(0xc0001be900, 0xc0002ce000, 0xc00006c570)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/backend/drive/drive.go:2095 +0x2e2\r\ncreated by github.com/ncw/rclone/backend/drive.(*Fs).ChangeNotify\r\n\t/home/ncw/go/src/github.com/ncw/rclone/backend/drive/drive.go:2061 +0x53\r\n\r\ngoroutine 84 [semacquire]:\r\nsync.runtime_SemacquireMutex(0xc0005ab5fc, 0x14e0900)\r\n\t/opt/go/go1.11/src/runtime/sema.go:71 +0x3d\r\nsync.(*Mutex).Lock(0xc0005ab5f8)\r\n\t/opt/go/go1.11/src/sync/mutex.go:134 +0xff\r\ngithub.com/ncw/rclone/vfs.(*File).setObjectNoUpdate(0xc0005ab5e0, 0x14e09e0, 0xc0007b4680)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vfs/file.go:343 +0x3a\r\ngithub.com/ncw/rclone/vfs.(*Dir)._readDirFromEntries(0xc0006bdcb0, 0xc00022e6e0, 0x2, 0x2, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vfs/dir.go:250 +0x4e5\r\ngithub.com/ncw/rclone/vfs.(*Dir)._readDir(0xc0006bdcb0, 0x1387b40, 0xc0006bdd10)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vfs/dir.go:217 +0x124\r\ngithub.com/ncw/rclone/vfs.(*Dir).ReadDirAll(0xc0006bdcb0, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vfs/dir.go:418 +0xa5\r\ngithub.com/ncw/rclone/cmd/mount.(*Dir).ReadDirAll(0xc00022d5b0, 0x14d4c60, 0xc000174840, 0x0, 0x0, 0x0, 0xe0, 0xa5)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/cmd/mount/dir.go:94 +0x193\r\ngithub.com/ncw/rclone/vendor/bazil.org/fuse/fs.(*Server).handleRequest(0xc000774000, 0x14d4c60, 0xc000174840, 0x14c5260, 0xc00022d5b0, 0xc0001e3c80, 0x14d19e0, 0xc0000be000, 0xc0007c5ef8, 0xc0002b7690, ...)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vendor/bazil.org/fuse/fs/serve.go:1209 +0x3dc\r\ngithub.com/ncw/rclone/vendor/bazil.org/fuse/fs.(*Server).serve(0xc000774000, 0x14d19e0, 0xc0000be000)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vendor/bazil.org/fuse/fs/serve.go:878 +0x410\r\ngithub.com/ncw/rclone/vendor/bazil.org/fuse/fs.(*Server).Serve.func1(0xc000774000, 0x14d19e0, 0xc0000be000)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vendor/bazil.org/fuse/fs/serve.go:425 +0x6e\r\ncreated by github.com/ncw/rclone/vendor/bazil.org/fuse/fs.(*Server).Serve\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vendor/bazil.org/fuse/fs/serve.go:423 +0x31e\r\n\r\ngoroutine 106 [semacquire]:\r\nsync.runtime_SemacquireMutex(0xc0006bdd14, 0xc0007c9800)\r\n\t/opt/go/go1.11/src/runtime/sema.go:71 +0x3d\r\nsync.(*Mutex).Lock(0xc0006bdd10)\r\n\t/opt/go/go1.11/src/sync/mutex.go:134 +0xff\r\ngithub.com/ncw/rclone/vfs.(*Dir).addObject(0xc0006bdcb0, 0x14e35a0, 0xc0005ab5e0)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vfs/dir.go:187 +0x3a\r\ngithub.com/ncw/rclone/vfs.(*File).setObject(0xc0005ab5e0, 0x14e09e0, 0xc00016e300)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vfs/file.go:337 +0xac\r\ngithub.com/ncw/rclone/vfs.(*RWFileHandle).close(0xc00035d3e0, 0x1387b40, 0xc00035d3e8)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vfs/read_write.go:311 +0x740\r\ngithub.com/ncw/rclone/vfs.(*RWFileHandle).Flush(0xc00035d3e0, 0x0, 0x0)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vfs/read_write.go:350 +0xb8\r\ngithub.com/ncw/rclone/cmd/mount.(*FileHandle).Flush(0xc00015bde0, 0x14d4c60, 0xc00007fbc0, 0xc0000156d0, 0xc00015bde0, 0x1)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/cmd/mount/handle.go:72 +0x116\r\ngithub.com/ncw/rclone/vendor/bazil.org/fuse/fs.(*Server).handleRequest(0xc000774000, 0x14d4c60, 0xc00007fbc0, 0x14c52a0, 0xc00022d888, 0xc00007fa80, 0x14d1660, 0xc0000156d0, 0xc0007c9ef8, 0x553141476b414d4c, ...)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vendor/bazil.org/fuse/fs/serve.go:1282 +0x2bec\r\ngithub.com/ncw/rclone/vendor/bazil.org/fuse/fs.(*Server).serve(0xc000774000, 0x14d1660, 0xc0000156d0)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vendor/bazil.org/fuse/fs/serve.go:878 +0x410\r\ngithub.com/ncw/rclone/vendor/bazil.org/fuse/fs.(*Server).Serve.func1(0xc000774000, 0x14d1660, 0xc0000156d0)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vendor/bazil.org/fuse/fs/serve.go:425 +0x6e\r\ncreated by github.com/ncw/rclone/vendor/bazil.org/fuse/fs.(*Server).Serve\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vendor/bazil.org/fuse/fs/serve.go:423 +0x31e\r\n```\r\n\r\nAnd again\r\n- ForgetPath\r\n- setObjectNoUpdate\r\n- addObject\r\n\r\n```\r\ngoroutine 332 [semacquire]:\r\nsync.runtime_SemacquireMutex(0xc0003f57dc, 0x14e0900)\r\n\t/opt/go/go1.11/src/runtime/sema.go:71 +0x3d\r\nsync.(*Mutex).Lock(0xc0003f57d8)\r\n\t/opt/go/go1.11/src/sync/mutex.go:134 +0xff\r\ngithub.com/ncw/rclone/vfs.(*File).setObjectNoUpdate(0xc0003f57c0, 0x14e09e0, 0xc000626780)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vfs/file.go:343 +0x3a\r\ngithub.com/ncw/rclone/vfs.(*Dir)._readDirFromEntries(0xc0005246c0, 0xc00015e830, 0x1, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vfs/dir.go:250 +0x4e5\r\ngithub.com/ncw/rclone/vfs.(*Dir)._readDir(0xc0005246c0, 0x1387b40, 0xc000524720)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vfs/dir.go:217 +0x124\r\ngithub.com/ncw/rclone/vfs.(*Dir).ReadDirAll(0xc0005246c0, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vfs/dir.go:418 +0xa5\r\ngithub.com/ncw/rclone/cmd/mount.(*Dir).ReadDirAll(0xc00000e068, 0x14d4c60, 0xc00016f840, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/cmd/mount/dir.go:94 +0x193\r\ngithub.com/ncw/rclone/vendor/bazil.org/fuse/fs.(*Server).handleRequest(0xc0002f0240, 0x14d4c60, 0xc00016f840, 0x14c5260, 0xc00000e068, 0xc00019a940, 0x14d19e0, 0xc000452000, 0xc000661ef8, 0x0, ...)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vendor/bazil.org/fuse/fs/serve.go:1209 +0x3dc\r\ngithub.com/ncw/rclone/vendor/bazil.org/fuse/fs.(*Server).serve(0xc0002f0240, 0x14d19e0, 0xc000452000)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vendor/bazil.org/fuse/fs/serve.go:878 +0x410\r\ngithub.com/ncw/rclone/vendor/bazil.org/fuse/fs.(*Server).Serve.func1(0xc0002f0240, 0x14d19e0, 0xc000452000)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vendor/bazil.org/fuse/fs/serve.go:425 +0x6e\r\ncreated by github.com/ncw/rclone/vendor/bazil.org/fuse/fs.(*Server).Serve\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vendor/bazil.org/fuse/fs/serve.go:423 +0x31e\r\n\r\ngoroutine 16 [semacquire]:\r\nsync.runtime_SemacquireMutex(0xc000524724, 0xc0002f4400)\r\n\t/opt/go/go1.11/src/runtime/sema.go:71 +0x3d\r\nsync.(*Mutex).Lock(0xc000524720)\r\n\t/opt/go/go1.11/src/sync/mutex.go:134 +0xff\r\ngithub.com/ncw/rclone/vfs.(*Dir).ForgetPath(0xc0005a0000, 0xc0002f44c0, 0xf, 0x3)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vfs/dir.go:116 +0x173\r\ngithub.com/ncw/rclone/vfs.(*Dir).ForgetPath-fm(0xc0002f44c0, 0xf, 0x3)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vfs/vfs.go:230 +0x48\r\ngithub.com/ncw/rclone/backend/drive.(*Fs).changeNotifyRunner(0xc0000c0d80, 0xc0001afc40, 0xc00043c230, 0x7, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/backend/drive/drive.go:2182 +0xa24\r\ngithub.com/ncw/rclone/backend/drive.(*Fs).ChangeNotify.func1(0xc0000c0d80, 0xc0000426c0, 0xc0001afc40)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/backend/drive/drive.go:2095 +0x2e2\r\ncreated by github.com/ncw/rclone/backend/drive.(*Fs).ChangeNotify\r\n\t/home/ncw/go/src/github.com/ncw/rclone/backend/drive/drive.go:2061 +0x53\r\n\r\ngoroutine 293 [semacquire]:\r\nsync.runtime_SemacquireMutex(0xc000524724, 0xc00002d800)\r\n\t/opt/go/go1.11/src/runtime/sema.go:71 +0x3d\r\nsync.(*Mutex).Lock(0xc000524720)\r\n\t/opt/go/go1.11/src/sync/mutex.go:134 +0xff\r\ngithub.com/ncw/rclone/vfs.(*Dir).addObject(0xc0005246c0, 0x14e35a0, 0xc0003f57c0)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vfs/dir.go:187 +0x3a\r\ngithub.com/ncw/rclone/vfs.(*File).setObject(0xc0003f57c0, 0x14e09e0, 0xc000626280)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vfs/file.go:337 +0xac\r\ngithub.com/ncw/rclone/vfs.(*RWFileHandle).close(0xc0000bfe60, 0x1387b40, 0xc0000bfe68)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vfs/read_write.go:311 +0x740\r\ngithub.com/ncw/rclone/vfs.(*RWFileHandle).Flush(0xc0000bfe60, 0x0, 0x0)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vfs/read_write.go:350 +0xb8\r\ngithub.com/ncw/rclone/cmd/mount.(*FileHandle).Flush(0xc0001aeda0, 0x14d4c60, 0xc00007f2c0, 0xc0006b46e0, 0xc0001aeda0, 0x1)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/cmd/mount/handle.go:72 +0x116\r\ngithub.com/ncw/rclone/vendor/bazil.org/fuse/fs.(*Server).handleRequest(0xc0002f0240, 0x14d4c60, 0xc00007f2c0, 0x14c52a0, 0xc00000e170, 0xc00007f180, 0x14d1660, 0xc0006b46e0, 0xc00002def8, 0xa, ...)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vendor/bazil.org/fuse/fs/serve.go:1282 +0x2bec\r\ngithub.com/ncw/rclone/vendor/bazil.org/fuse/fs.(*Server).serve(0xc0002f0240, 0x14d1660, 0xc0006b46e0)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vendor/bazil.org/fuse/fs/serve.go:878 +0x410\r\ngithub.com/ncw/rclone/vendor/bazil.org/fuse/fs.(*Server).Serve.func1(0xc0002f0240, 0x14d1660, 0xc0006b46e0)\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vendor/bazil.org/fuse/fs/serve.go:425 +0x6e\r\ncreated by github.com/ncw/rclone/vendor/bazil.org/fuse/fs.(*Server).Serve\r\n\t/home/ncw/go/src/github.com/ncw/rclone/vendor/bazil.org/fuse/fs/serve.go:423 +0x31e\r\n```","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/2811/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/2811/timeline","performed_via_github_app":null,"state_reason":"completed"}