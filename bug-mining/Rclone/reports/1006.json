{"url":"https://api.github.com/repos/rclone/rclone/issues/5509","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/5509/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/5509/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/5509/events","html_url":"https://github.com/rclone/rclone/issues/5509","id":959347544,"node_id":"MDU6SXNzdWU5NTkzNDc1NDQ=","number":5509,"title":"S3 multipart upload initialization does not refresh credentials","user":{"login":"macklin-10x","id":53452532,"node_id":"MDQ6VXNlcjUzNDUyNTMy","avatar_url":"https://avatars.githubusercontent.com/u/53452532?v=4","gravatar_id":"","url":"https://api.github.com/users/macklin-10x","html_url":"https://github.com/macklin-10x","followers_url":"https://api.github.com/users/macklin-10x/followers","following_url":"https://api.github.com/users/macklin-10x/following{/other_user}","gists_url":"https://api.github.com/users/macklin-10x/gists{/gist_id}","starred_url":"https://api.github.com/users/macklin-10x/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/macklin-10x/subscriptions","organizations_url":"https://api.github.com/users/macklin-10x/orgs","repos_url":"https://api.github.com/users/macklin-10x/repos","events_url":"https://api.github.com/users/macklin-10x/events{/privacy}","received_events_url":"https://api.github.com/users/macklin-10x/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":314138213,"node_id":"MDU6TGFiZWwzMTQxMzgyMTM=","url":"https://api.github.com/repos/rclone/rclone/labels/Remote:%20S3","name":"Remote: S3","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/45","html_url":"https://github.com/rclone/rclone/milestone/45","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/45/labels","id":6621711,"node_id":"MDk6TWlsZXN0b25lNjYyMTcxMQ==","number":45,"title":"v1.57","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":60,"state":"closed","created_at":"2021-04-03T13:03:06Z","updated_at":"2021-11-03T06:43:26Z","due_on":"2021-10-30T07:00:00Z","closed_at":"2021-11-01T17:01:17Z"},"comments":13,"created_at":"2021-08-03T17:44:40Z","updated_at":"2021-10-16T10:12:38Z","closed_at":"2021-10-16T10:12:38Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### What is the problem you are having with rclone?\r\n\r\nThe S3 backend appears to fail to refresh expired S3 credentials when initializing a multipart upload.  During a long-running transfer operation during which credentials may expire and need to be refreshed, the transfer fails to refresh AWS credentials for new multipart uploads, and the remaining uploads and overall transfer operation fail with errors like\r\n`Failed to copy: multipart upload failed to initialise: ExpiredToken: The provided token has expired. status code: 400`. We're commonly running into this issue when uploading very large files, such that the checksum computation potentially takes longer than the token lifetime.\r\n\r\nI would expect either rclone or the underlying call to the AWS SDK to refresh the credentials when this happens.\r\n\r\n#### What is your rclone version (output from `rclone version`)\r\n\r\nI'm running a fork/using rclone as a library, but it is based on v1.55.1\r\nThe fork injects a custom AWS credential provider that appears to work correctly under all other circumstances (long-running uploads refresh credentials correctly).\r\n\r\n#### Which OS you are using and how many bits (e.g. Windows 7, 64 bit)\r\n\r\nWindows 10, 64 bit\r\n\r\n#### Which cloud storage system are you using? (e.g. Google Drive)\r\n\r\nAWS S3\r\n\r\n<!--- Please keep the note below for others who read your bug report. -->\r\n\r\n#### How to use GitHub\r\n\r\n* Please use the üëç [reaction](https://blog.github.com/2016-03-10-add-reactions-to-pull-requests-issues-and-comments/) to show that you are affected by the same issue.\r\n* Please don't comment if you have no relevant information to add. It's just extra noise for everyone subscribed to this issue.\r\n* Subscribe to receive notifications on status change and new comments.\r\n","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/5509/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/5509/timeline","performed_via_github_app":null,"state_reason":"completed"}