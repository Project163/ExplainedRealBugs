{"url":"https://api.github.com/repos/rclone/rclone/issues/4783","repository_url":"https://api.github.com/repos/rclone/rclone","labels_url":"https://api.github.com/repos/rclone/rclone/issues/4783/labels{/name}","comments_url":"https://api.github.com/repos/rclone/rclone/issues/4783/comments","events_url":"https://api.github.com/repos/rclone/rclone/issues/4783/events","html_url":"https://github.com/rclone/rclone/issues/4783","id":745607458,"node_id":"MDU6SXNzdWU3NDU2MDc0NTg=","number":4783,"title":"Rclone generating weak passwords - CVE-2020-28924","user":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":86399005,"node_id":"MDU6TGFiZWw4NjM5OTAwNQ==","url":"https://api.github.com/repos/rclone/rclone/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":2515219582,"node_id":"MDU6TGFiZWwyNTE1MjE5NTgy","url":"https://api.github.com/repos/rclone/rclone/labels/security","name":"security","color":"ff0000","default":false,"description":"Potential security problem"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/rclone/rclone/milestones/41","html_url":"https://github.com/rclone/rclone/milestone/41","labels_url":"https://api.github.com/repos/rclone/rclone/milestones/41/labels","id":5478342,"node_id":"MDk6TWlsZXN0b25lNTQ3ODM0Mg==","number":41,"title":"v1.54","description":"","creator":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":55,"state":"closed","created_at":"2020-05-29T14:52:51Z","updated_at":"2021-02-03T16:09:01Z","due_on":"2021-01-30T08:00:00Z","closed_at":"2021-02-03T16:05:14Z"},"comments":0,"created_at":"2020-11-18T12:13:24Z","updated_at":"2020-11-19T18:21:13Z","closed_at":"2020-11-19T16:55:47Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"# Rclone security problem - CVE-2020-28924\r\n\r\nPasswords users have generated using `rclone config` with rclone 1.49.0 (released 2019-08-26) to 1.53.2 (released 2020-10-26) may be insecure and should be changed.\r\n\r\nPasswords you made up yourself are fine.\r\n\r\nThis is known as [CVE-2020-28924](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-28924).\r\n\r\nThere is a tool to check your rclone config file for bad passwords here: https://github.com/rclone/passwordcheck\r\n\r\nSee [this forum post](https://forum.rclone.org/t/rclone-1-53-3-release/20569) for additional help.\r\n\r\n## Analysis\r\n\r\nIn this commit\r\n\r\nhttps://github.com/rclone/rclone/commit/193c30d57038017370594d5bc8ee9bc32580ddf2\r\n\r\n`random.Password` was factored out into `lib/random`.\r\n\r\nAt that time the library `crypto/rand` was accidentally replaced with `math/rand` leading to the pseudo random number generator being used instead of the crypto strong random number generator.\r\n\r\nConsequences:\r\n\r\nCallers of `random.Password` will have been getting a password based on `math/rand` instead of `crypto/rand` which reduces the amount of entropy for passwords enormously.\r\n\r\n- `fs/config/config.go: Password = random.Password`\r\n    - This is choosing random passwords for users in the config generator.\r\n    - This is a problem since users may have used these to configure services.\r\n- `fs/rc/rcserver/rcserver.go: randomPass, err := random.Password(128)`\r\n    - This is choosing short lived random passwords for use with the web ui.\r\n    - This is a minor problem since these passwords are regenerated every time rclone is run.\r\n- `lib/oauthutil/oauthutil.go: state, err := random.Password(128)`\r\n    - This is making some random state for the oauth callback.\r\n    - This isn't a security problem\r\n\r\nRclone initialised the seed of `math/rand` in cmd/cmd.go Main with\r\n\r\n    rand.Seed(time.Now().Unix())\r\n\r\nHowever `time.Now().Unix()` only changes every second, meaning passwords generated only change every second. The passwords generated by `random.Password` are therefore completely determinstic based on the unix second that rclone was started.\r\n\r\n## Consequences\r\n\r\nPasswords users have generated using `rclone config` may be insecure. In particular if you generated a password like this with `rclone config` using rclone 1.49.0 (released 2019-08-26) to 1.53.2 (released 2020-10-26) then it will have been selected from a limited set of passwords and should be changed.\r\n\r\n```\r\nPassword or pass phrase for encryption.\r\ny) Yes type in my own password\r\ng) Generate random password\r\ny/g> g\r\nPassword strength in bits.\r\n64 is just about memorable\r\n128 is secure\r\n1024 is the maximum\r\nBits> 64 <- the number you typed in here is irrelevant\r\nYour password is: XXXXXXXXXXXX\r\n```\r\n\r\n## Versions\r\n\r\nThis commit is present in these released version of rclone\r\n\r\n- `v1.49.0`\r\n- `v1.49.1`\r\n- `v1.49.2`\r\n- `v1.49.3`\r\n- `v1.49.4`\r\n- `v1.49.5`\r\n- `v1.50.0`\r\n- `v1.50.1`\r\n- `v1.50.2`\r\n- `v1.51.0`\r\n- `v1.52.0`\r\n- `v1.52.1`\r\n- `v1.52.2`\r\n- `v1.52.3`\r\n- `v1.53.0`\r\n- `v1.53.1`\r\n- `v1.53.2`\r\n\r\nThe faulty commit went into rclone at \"Sun Aug 25 08:39:31 2019 +0100\"\r\n\r\n## Fixes\r\n\r\nThis issue is easily fixed with commit 7985df37681f54d013816a4641da4f9b085b3aa5\r\n\r\nAll uses of `math/rand` were reviewed in the code\r\n\r\nAn additional commit f0905499e340f9e73e2552cf0c8b79cbf14ecbc4  was added to seed the random number generator with a crypto strong seed as a mitigation for any future problems.\r\n\r\n## Demonstration of the problem\r\n\r\nSave this bash script to a file called `test-rclone-password.sh` and make it executable.\r\n\r\n```sh\r\n#!/bin/bash\r\n# Test the password generation of rclone\r\n# optionally pass in a path to an rclone binary to use as the first argument\r\n\r\nRCLONE=\"${1:-rclone}\"\r\n\r\n# Check the binary exists\r\nif ! ${RCLONE} version >/dev/null 2>&1; then\r\n    echo \"Rclone binary ${RCLONE} not found\"\r\n    exit 1\r\nfi\r\n\r\n(\r\n    # Run through the rclone config generator creating a crypt backend\r\n    echo \"n\" ; sleep .1\r\n    echo \"test\" ; sleep .1\r\n    echo \"crypt\" ; sleep .1\r\n    echo \"/tmp\" ; sleep .1\r\n    echo \"1\" ; sleep .1\r\n    echo \"1\" ; sleep .1\r\n    echo \"g\" ; sleep .1\r\n    echo \"64\" ; sleep .1\r\n) | ${RCLONE} config 2>&1 | grep \"Your password is\"\r\n```\r\n\r\nIf you run multiple copies of it at once which start at the same second, you can see that with a vulnerable rclone all the passwords generated are the same. Pass it an rclone binary to test (or leave off to use the one on the path)\r\n\r\n```\r\n$ ./test-rclone-password.sh rclone-v1.53.2 & ./test-rclone-password.sh rclone-v1.53.2 & ./test-rclone-password.sh rclone-v1.53.2\r\nBits> Your password is: eULvaUR9A_A\r\nBits> Your password is: eULvaUR9A_A\r\nBits> Your password is: eULvaUR9A_A\r\n```\r\n\r\nHowever if this is done with a non vulnerable rclone you will get all different passwords\r\n\r\n```\r\n$ ./test-rclone-password.sh rclone-v1.48 & ./test-rclone-password.sh rclone-v1.48 & ./test-rclone-password.sh rclone-v1.48\r\nBits> Your password is: G5dODi-AoFo\r\nBits> Your password is: KL1QRvaRSXw\r\nBits> Your password is: b6sVRzjfdkg\r\n```\r\n\r\n## Authors\r\n\r\nThis problem was reported to the rclone team by Victor9. Nick Craig-Wood (@ncw) fixed the problem, wrote up the advisory and made the checking tool. Klaus Post (@klauspost) reviewed the post and patches.\r\n","closed_by":{"login":"ncw","id":536803,"node_id":"MDQ6VXNlcjUzNjgwMw==","avatar_url":"https://avatars.githubusercontent.com/u/536803?v=4","gravatar_id":"","url":"https://api.github.com/users/ncw","html_url":"https://github.com/ncw","followers_url":"https://api.github.com/users/ncw/followers","following_url":"https://api.github.com/users/ncw/following{/other_user}","gists_url":"https://api.github.com/users/ncw/gists{/gist_id}","starred_url":"https://api.github.com/users/ncw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ncw/subscriptions","organizations_url":"https://api.github.com/users/ncw/orgs","repos_url":"https://api.github.com/users/ncw/repos","events_url":"https://api.github.com/users/ncw/events{/privacy}","received_events_url":"https://api.github.com/users/ncw/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rclone/rclone/issues/4783/reactions","total_count":6,"+1":5,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rclone/rclone/issues/4783/timeline","performed_via_github_app":null,"state_reason":"completed"}