{"url":"https://api.github.com/repos/babel/babel/issues/9331","repository_url":"https://api.github.com/repos/babel/babel","labels_url":"https://api.github.com/repos/babel/babel/issues/9331/labels{/name}","comments_url":"https://api.github.com/repos/babel/babel/issues/9331/comments","events_url":"https://api.github.com/repos/babel/babel/issues/9331/events","html_url":"https://github.com/babel/babel/issues/9331","id":398878971,"node_id":"MDU6SXNzdWUzOTg4Nzg5NzE=","number":9331,"title":"Optional function params are not marked as optional after going through @babel/template","user":{"login":"unconfident","id":30427068,"node_id":"MDQ6VXNlcjMwNDI3MDY4","avatar_url":"https://avatars.githubusercontent.com/u/30427068?v=4","gravatar_id":"","url":"https://api.github.com/users/unconfident","html_url":"https://github.com/unconfident","followers_url":"https://api.github.com/users/unconfident/followers","following_url":"https://api.github.com/users/unconfident/following{/other_user}","gists_url":"https://api.github.com/users/unconfident/gists{/gist_id}","starred_url":"https://api.github.com/users/unconfident/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/unconfident/subscriptions","organizations_url":"https://api.github.com/users/unconfident/orgs","repos_url":"https://api.github.com/users/unconfident/repos","events_url":"https://api.github.com/users/unconfident/events{/privacy}","received_events_url":"https://api.github.com/users/unconfident/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":516500452,"node_id":"MDU6TGFiZWw1MTY1MDA0NTI=","url":"https://api.github.com/repos/babel/babel/labels/Has%20PR","name":"Has PR","color":"bfdadc","default":false,"description":null},{"id":667603683,"node_id":"MDU6TGFiZWw2Njc2MDM2ODM=","url":"https://api.github.com/repos/babel/babel/labels/7.x:%20regression","name":"7.x: regression","color":"d93f0b","default":false,"description":null},{"id":919437103,"node_id":"MDU6TGFiZWw5MTk0MzcxMDM=","url":"https://api.github.com/repos/babel/babel/labels/outdated","name":"outdated","color":"ededed","default":false,"description":"A closed issue/PR that is archived due to age. Recommended to make a new issue"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-01-14T13:03:27Z","updated_at":"2019-04-18T22:18:03Z","closed_at":"2019-01-17T22:12:17Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"# v7 Regression\r\n\r\n**Describe the regression**\r\nIf code passed to `@babel/template` had Flow type annotations and some of the function parameters were marked as optional (`?`) they won't be marked as optional in the produced code. This information gets lost\r\n\r\n**Input Code**\r\n\r\n```js\r\nconst pick = require('lodash.pick');\r\nconst template6 = require(\"babel-template\");\r\nconst template7 = require(\"@babel/template\").default;\r\n\r\nconst code = 'function f(foo?: number) {}';\r\n\r\nconst b6 = template6(code, { plugins: [ 'flow' ] })();\r\nconst b7 = template7(code, { plugins: [ 'flow' ] })();\r\n\r\nconsole.log('Babel 6:', pick(b6.params[0], ['name', 'type', 'optional']));\r\nconsole.log('Babel 7:', pick(b7.params[0], ['name', 'type', 'optional']));\r\n\r\n// › Babel 6: {name: \"bar\", optional: true, type: \"Identifier\"}\r\n// › Babel 7: {name: \"bar\", type: \"Identifier\"}\r\n```\r\n\r\n**Potential Commit/PR that introduced the regression**\r\nSorry, couldn't even find the place in `@babel/template` at which point it goes missing. `optional: true` is still in the AST produced by the `@babel/parser`. This rabbit hole is too deep\r\n\r\n**Expected behavior/code**\r\nI expect result of executed template to match the code that was passed to it, especially if no replacements has been made\r\n\r\n**Environment**\r\n- Babel version(s): **v6.26.0** (behaves correctly), **v7.2.2** (behaves incorrectly)\r\n- Node version: **8.12.0**, **10.15.0**\r\n- How you are using Babel: generating code with it\r\n","closed_by":{"login":"hzoo","id":588473,"node_id":"MDQ6VXNlcjU4ODQ3Mw==","avatar_url":"https://avatars.githubusercontent.com/u/588473?v=4","gravatar_id":"","url":"https://api.github.com/users/hzoo","html_url":"https://github.com/hzoo","followers_url":"https://api.github.com/users/hzoo/followers","following_url":"https://api.github.com/users/hzoo/following{/other_user}","gists_url":"https://api.github.com/users/hzoo/gists{/gist_id}","starred_url":"https://api.github.com/users/hzoo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hzoo/subscriptions","organizations_url":"https://api.github.com/users/hzoo/orgs","repos_url":"https://api.github.com/users/hzoo/repos","events_url":"https://api.github.com/users/hzoo/events{/privacy}","received_events_url":"https://api.github.com/users/hzoo/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/babel/babel/issues/9331/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/babel/babel/issues/9331/timeline","performed_via_github_app":null,"state_reason":"completed"}