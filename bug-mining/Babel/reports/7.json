{"url":"https://api.github.com/repos/babel/babel/issues/7371","repository_url":"https://api.github.com/repos/babel/babel","labels_url":"https://api.github.com/repos/babel/babel/issues/7371/labels{/name}","comments_url":"https://api.github.com/repos/babel/babel/issues/7371/comments","events_url":"https://api.github.com/repos/babel/babel/issues/7371/events","html_url":"https://github.com/babel/babel/issues/7371","id":296288979,"node_id":"MDU6SXNzdWUyOTYyODg5Nzk=","number":7371,"title":"class property initializer of extended class is duplicated in nested extended class constructor","user":{"login":"kentor","id":240493,"node_id":"MDQ6VXNlcjI0MDQ5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/240493?v=4","gravatar_id":"","url":"https://api.github.com/users/kentor","html_url":"https://github.com/kentor","followers_url":"https://api.github.com/users/kentor/followers","following_url":"https://api.github.com/users/kentor/following{/other_user}","gists_url":"https://api.github.com/users/kentor/gists{/gist_id}","starred_url":"https://api.github.com/users/kentor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kentor/subscriptions","organizations_url":"https://api.github.com/users/kentor/orgs","repos_url":"https://api.github.com/users/kentor/repos","events_url":"https://api.github.com/users/kentor/events{/privacy}","received_events_url":"https://api.github.com/users/kentor/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":711596574,"node_id":"MDU6TGFiZWw3MTE1OTY1NzQ=","url":"https://api.github.com/repos/babel/babel/labels/Spec:%20Class%20Fields","name":"Spec: Class Fields","color":"1d76db","default":false,"description":""},{"id":919437103,"node_id":"MDU6TGFiZWw5MTk0MzcxMDM=","url":"https://api.github.com/repos/babel/babel/labels/outdated","name":"outdated","color":"ededed","default":false,"description":"A closed issue/PR that is archived due to age. Recommended to make a new issue"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-02-12T07:49:24Z","updated_at":"2018-07-14T17:53:14Z","closed_at":"2018-04-14T17:48:39Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!---\r\nThanks for filing an issue ðŸ˜„ ! Before you submit, please read the following:\r\n\r\nSearch open/closed issues before submitting since someone might have asked the same thing before!\r\n\r\nIf you have a support request or question please submit them to one of this resources:\r\n\r\n* Slack Community: https://slack.babeljs.io/\r\n* StackOverflow: http://stackoverflow.com/questions/tagged/babeljs using the tag `babeljs`\r\n* Also have a look at the readme for more information on how to get support:\r\n  https://github.com/babel/babel/blob/master/README.md\r\n\r\nIssues on GitHub are only related to problems of Babel itself and we cannot answer \r\nsupport questions here.\r\n-->\r\n\r\n## This is a bug report\r\n\r\nWith the `@babel/plugin-proposal-class-properties` plugin, it appears that property initializers get duplicated in the nested class' constructor when both classes are extended classes that call super.\r\n\r\n### Input Code\r\nMinimum repro:\r\n```js\r\nclass A extends C {\r\n  B;\r\n  constructor() {\r\n    super();\r\n    this.B = class B extends C {\r\n      constructor() {\r\n        super();\r\n      }\r\n    };\r\n  }\r\n}\r\n\r\n```\r\n\r\n### Babel/Babylon Configuration (.babelrc, package.json, cli command)\r\n<!--- If describing a bug, tell us what your babel configuration looks like -->\r\n\r\n```js\r\nmodule.exports = {\r\n  plugins: [\r\n    ['@babel/plugin-proposal-class-properties', { loose: true }],\r\n  ],\r\n  presets: [\r\n    ['@babel/preset-env', { targets: { node: 'current' } }],\r\n  ],\r\n};\r\n```\r\n\r\n### Expected Behavior\r\n```js\r\nclass A extends C {\r\n  constructor() {\r\n    super();\r\n    this.B = void 0;\r\n    this.B = class B extends C {\r\n      constructor() {\r\n        super();\r\n      }\r\n    };\r\n  }\r\n}\r\n```\r\n\r\n### Current Behavior\r\n```js\r\nclass A extends C {\r\n  constructor() {\r\n    super();\r\n    this.B = void 0;\r\n    this.B = class B extends C {\r\n      constructor() {\r\n        super();\r\n        this.B = void 0; // THIS LINE SHOULDN'T BE HERE!\r\n      }\r\n    };\r\n  }\r\n}\r\n```\r\n\r\nexample (same deal, but with `B = 1;`): https://babeljs.io/repl/#?babili=false&browsers=&build=&builtIns=false&code_lz=MYGwhgzhAECC0FMAeAXBA7AJjAwtA3gFDTQBC0AvNAIwDcx0wA9uhCgE4CuwKT7AFAEoCDEhE4AHBAMH0SJFAAsAlhAB05KqEgxyyNFlwj585qw7deM4yfnipMubYC-o6M6evnQA&debug=false&forceAllTransforms=false&shippedProposals=false&circleciRepo=&evaluate=false&fileSize=false&lineWrap=false&presets=stage-2&prettier=false&targets=&version=6.26.0&envVersion=\r\n\r\nThere is an extra `this.B = void 0;` which is problematic because it will make `this.B = undefined` if the inner class is instantiated at any point, overwriting `this.B = class ...`. \r\n\r\n### Possible Solution\r\nThere's probably some logic that just naively inserts the initializer based on the constructor pattern without accounting for context?\r\n\r\n### Context\r\nI am implementing some React components, where a nested component is defined during the parent's constructor call because it will need to read props from the parent. The reason why there's a property initializer that's set to `undefined` in the first place is for flow types.\r\n\r\n### Your Environment\r\n<!--- Include as many relevant details about the environment you experienced the bug in -->\r\n\r\n| software         | version(s)\r\n| ---------------- | -------\r\n| Babel            |  7.0.0-beta.39\r\n| Babylon          | <!-- This is only needed if you are using Babylon directly -->\r\n| node             |  8.9.0\r\n| npm              | 5.5.1\r\n| Operating System | macos \r\n","closed_by":{"login":"jridgewell","id":112982,"node_id":"MDQ6VXNlcjExMjk4Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112982?v=4","gravatar_id":"","url":"https://api.github.com/users/jridgewell","html_url":"https://github.com/jridgewell","followers_url":"https://api.github.com/users/jridgewell/followers","following_url":"https://api.github.com/users/jridgewell/following{/other_user}","gists_url":"https://api.github.com/users/jridgewell/gists{/gist_id}","starred_url":"https://api.github.com/users/jridgewell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jridgewell/subscriptions","organizations_url":"https://api.github.com/users/jridgewell/orgs","repos_url":"https://api.github.com/users/jridgewell/repos","events_url":"https://api.github.com/users/jridgewell/events{/privacy}","received_events_url":"https://api.github.com/users/jridgewell/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/babel/babel/issues/7371/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/babel/babel/issues/7371/timeline","performed_via_github_app":null,"state_reason":"completed"}