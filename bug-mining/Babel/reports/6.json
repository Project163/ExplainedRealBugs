{"url":"https://api.github.com/repos/babel/babel/issues/7350","repository_url":"https://api.github.com/repos/babel/babel","labels_url":"https://api.github.com/repos/babel/babel/issues/7350/labels{/name}","comments_url":"https://api.github.com/repos/babel/babel/issues/7350/comments","events_url":"https://api.github.com/repos/babel/babel/issues/7350/events","html_url":"https://github.com/babel/babel/issues/7350","id":295335659,"node_id":"MDU6SXNzdWUyOTUzMzU2NTk=","number":7350,"title":"Spec change: Tagged template literals are no longer cached globally","user":{"login":"loganfsmyth","id":132260,"node_id":"MDQ6VXNlcjEzMjI2MA==","avatar_url":"https://avatars.githubusercontent.com/u/132260?v=4","gravatar_id":"","url":"https://api.github.com/users/loganfsmyth","html_url":"https://github.com/loganfsmyth","followers_url":"https://api.github.com/users/loganfsmyth/followers","following_url":"https://api.github.com/users/loganfsmyth/following{/other_user}","gists_url":"https://api.github.com/users/loganfsmyth/gists{/gist_id}","starred_url":"https://api.github.com/users/loganfsmyth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/loganfsmyth/subscriptions","organizations_url":"https://api.github.com/users/loganfsmyth/orgs","repos_url":"https://api.github.com/users/loganfsmyth/repos","events_url":"https://api.github.com/users/loganfsmyth/events{/privacy}","received_events_url":"https://api.github.com/users/loganfsmyth/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":438612746,"node_id":"MDU6TGFiZWw0Mzg2MTI3NDY=","url":"https://api.github.com/repos/babel/babel/labels/good%20first%20issue","name":"good first issue","color":"bfdadc","default":true,"description":null},{"id":441915610,"node_id":"MDU6TGFiZWw0NDE5MTU2MTA=","url":"https://api.github.com/repos/babel/babel/labels/help%20wanted","name":"help wanted","color":"bfdadc","default":true,"description":null},{"id":711629232,"node_id":"MDU6TGFiZWw3MTE2MjkyMzI=","url":"https://api.github.com/repos/babel/babel/labels/Spec:%20Template%20Literal%20Revision","name":"Spec: Template Literal Revision","color":"1d76db","default":false,"description":null},{"id":919437103,"node_id":"MDU6TGFiZWw5MTk0MzcxMDM=","url":"https://api.github.com/repos/babel/babel/labels/outdated","name":"outdated","color":"ededed","default":false,"description":"A closed issue/PR that is archived due to age. Recommended to make a new issue"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":16,"created_at":"2018-02-07T23:48:28Z","updated_at":"2018-07-13T15:57:56Z","closed_at":"2018-04-13T15:51:01Z","author_association":"MEMBER","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Spec PR: https://github.com/tc39/ecma262/pull/890\r\n\r\nBabel has never been able to implement a true global cache anyway, but now we can remove the file-level caching. e.g.\r\n\r\nCurrently say we have [this example](https://babeljs.io/repl/#?babili=false&browsers=chrome%20%3E%2055%20%20&build=&builtIns=false&code_lz=MYewdgzgLgBFCGBzGBeGA3VA-DBuAUPgBQBmArmMFAJbhECUA3vjHEgAYQgC2ApnL24AHADbwovdgVYJEnHvwnCxEqfgC-9BriA&debug=false&forceAllTransforms=false&shippedProposals=false&circleciRepo=&evaluate=false&fileSize=false&lineWrap=false&presets=es2015%2Cenv&prettier=false&targets=&version=6.26.0&envVersion=1.6.2)\r\n```\r\nconst tag = v => v;\r\n\r\n(function(){\r\n  tag`some template`;\r\n  tag`some template`;\r\n})();\r\n```\r\nwe generate\r\n```\r\nvar _templateObject = _taggedTemplateLiteral([\"some template\"], [\"some template\"]);\r\n\r\nfunction _taggedTemplateLiteral(strings, raw) { return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }\r\n\r\nvar tag = function tag(v) {\r\n  return v;\r\n};\r\n\r\n(function () {\r\n  tag(_templateObject);\r\n  tag(_templateObject);\r\n})();\r\n```\r\nNote how the `_taggedTemplateLiteral` call is hoisted to the top of the function, and _both_ tagged examples reference the same `_templateObject` object.\r\n\r\nWith the current spec changes we'd at least want to change this logic to be\r\n```\r\nvar _templateObject = _taggedTemplateLiteral([\"some template\"], [\"some template\"]);\r\nvar _templateObject2 = _taggedTemplateLiteral([\"some template\"], [\"some template\"]);\r\n\r\nfunction _taggedTemplateLiteral(strings, raw) { return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }\r\n\r\nvar tag = function tag(v) {\r\n  return v;\r\n};\r\n\r\n(function () {\r\n  tag(_templateObject);\r\n  tag(_templateObject2);\r\n})();\r\n```\r\nso that each template literal has its own `_templateObject`.\r\n\r\nBut now that that things aren't shared anymore, there's really no reason to hoist the initialization at all, so I'd like to see us update this to\r\n```\r\nvar _templateObject, _templateObject2;\r\n\r\nfunction _taggedTemplateLiteral(strings, raw) { return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }\r\n\r\nvar tag = function tag(v) {\r\n  return v;\r\n};\r\n\r\n(function () {\r\n  tag(_templateObject || (_templateObject = _taggedTemplateLiteral([\"some template\"], [\"some template\"])));\r\n  tag(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"some template\"], [\"some template\"])));\r\n})();\r\n```\r\nso we only initialize the template literal object when it is needed.\r\n\r\nAll of this should be doable in https://github.com/babel/babel/blob/dd0337cc85c341b36b0657e05964532a650fd088/packages/babel-plugin-transform-template-literals/src/index.js#L73\r\n\r\nMarking as good first issues because it is relatively self-contained, but it will likely require some time to understand what needs to change in the AST.","closed_by":{"login":"jridgewell","id":112982,"node_id":"MDQ6VXNlcjExMjk4Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112982?v=4","gravatar_id":"","url":"https://api.github.com/users/jridgewell","html_url":"https://github.com/jridgewell","followers_url":"https://api.github.com/users/jridgewell/followers","following_url":"https://api.github.com/users/jridgewell/following{/other_user}","gists_url":"https://api.github.com/users/jridgewell/gists{/gist_id}","starred_url":"https://api.github.com/users/jridgewell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jridgewell/subscriptions","organizations_url":"https://api.github.com/users/jridgewell/orgs","repos_url":"https://api.github.com/users/jridgewell/repos","events_url":"https://api.github.com/users/jridgewell/events{/privacy}","received_events_url":"https://api.github.com/users/jridgewell/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/babel/babel/issues/7350/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/babel/babel/issues/7350/timeline","performed_via_github_app":null,"state_reason":"completed"}