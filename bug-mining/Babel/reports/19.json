{"url":"https://api.github.com/repos/babel/babel/issues/8057","repository_url":"https://api.github.com/repos/babel/babel","labels_url":"https://api.github.com/repos/babel/babel/issues/8057/labels{/name}","comments_url":"https://api.github.com/repos/babel/babel/issues/8057/comments","events_url":"https://api.github.com/repos/babel/babel/issues/8057/events","html_url":"https://github.com/babel/babel/issues/8057","id":326799237,"node_id":"MDU6SXNzdWUzMjY3OTkyMzc=","number":8057,"title":"Flow `ObjectTypeProperty` adds an entry to `scope.globals`","user":{"login":"peter-leonov","id":57961,"node_id":"MDQ6VXNlcjU3OTYx","avatar_url":"https://avatars.githubusercontent.com/u/57961?v=4","gravatar_id":"","url":"https://api.github.com/users/peter-leonov","html_url":"https://github.com/peter-leonov","followers_url":"https://api.github.com/users/peter-leonov/followers","following_url":"https://api.github.com/users/peter-leonov/following{/other_user}","gists_url":"https://api.github.com/users/peter-leonov/gists{/gist_id}","starred_url":"https://api.github.com/users/peter-leonov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/peter-leonov/subscriptions","organizations_url":"https://api.github.com/users/peter-leonov/orgs","repos_url":"https://api.github.com/users/peter-leonov/repos","events_url":"https://api.github.com/users/peter-leonov/events{/privacy}","received_events_url":"https://api.github.com/users/peter-leonov/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":919437103,"node_id":"MDU6TGFiZWw5MTk0MzcxMDM=","url":"https://api.github.com/repos/babel/babel/labels/outdated","name":"outdated","color":"ededed","default":false,"description":"A closed issue/PR that is archived due to age. Recommended to make a new issue"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-05-27T08:49:00Z","updated_at":"2018-08-29T22:20:48Z","closed_at":"2018-05-30T22:07:57Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Bug Report\r\n\r\nFirstly, thanks for the great job you guys do! ‚ù§Ô∏è\r\nI think I'm able to find the root cause and fix the issue. Where do I need to sign? ü§ì\r\n\r\n**EDIT**: it [looks like](https://github.com/babel/babel/pull/8058) the function `isReferenced()` needs to be updated to know about `ObjectTypeProperty` node type and treat it as not a reference.\r\n\r\n**Current Behavior**\r\nHaving a Flow type definition with `OobjectTypeProperty` node adds an identifier to `scope.globals` in `Program`:\r\n\r\n**Input Code**\r\n```js\r\ntype A = {\r\n  localVar: number,\r\n};\r\n```\r\n\r\n**Expected behavior/code**\r\nThe `localVar` has not been added to `scope.globals` during initial traversing.\r\n\r\n**Babel Configuration (.babelrc, package.json, cli command)**\r\n\r\n```js\r\n{\r\n  sourceType: 'module',\r\n  plugins: [\r\n    'syntax-flow',\r\n    'syntax-object-rest-spread',\r\n    'introscope/babel-plugin',\r\n  ],\r\n}\r\n```\r\n\r\nThe last one `introscope/babel-plugin` is mine, there I expect the `globals` array to be correct to auto-mock it in testing.\r\n\r\n**Environment**\r\n- Babel version(s): v6.26.0\r\n- Node/npm version: v8.7.0/5.7.1\r\n- OS: OSX 10.13.4\r\n- Monorepo no\r\n- How you are using Babel: for plugin development\r\n\r\n**Possible Solution**\r\nMaybe, during initial traversing the is a bug with labelled expressions, which somehow can be misunderstood by parser?\r\n\r\n**Additional context/Screenshots**\r\nI'm building a yet another mocking library called [Introscope](https://github.com/peter-leonov/introscope) like Rewire and it need to know which identifiers are local to the module and which are just globals. This helps save some CPU on traversing the whole AST and redoing the work of `traverse.js` üòÄ","closed_by":{"login":"nicolo-ribaudo","id":7000710,"node_id":"MDQ6VXNlcjcwMDA3MTA=","avatar_url":"https://avatars.githubusercontent.com/u/7000710?v=4","gravatar_id":"","url":"https://api.github.com/users/nicolo-ribaudo","html_url":"https://github.com/nicolo-ribaudo","followers_url":"https://api.github.com/users/nicolo-ribaudo/followers","following_url":"https://api.github.com/users/nicolo-ribaudo/following{/other_user}","gists_url":"https://api.github.com/users/nicolo-ribaudo/gists{/gist_id}","starred_url":"https://api.github.com/users/nicolo-ribaudo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicolo-ribaudo/subscriptions","organizations_url":"https://api.github.com/users/nicolo-ribaudo/orgs","repos_url":"https://api.github.com/users/nicolo-ribaudo/repos","events_url":"https://api.github.com/users/nicolo-ribaudo/events{/privacy}","received_events_url":"https://api.github.com/users/nicolo-ribaudo/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/babel/babel/issues/8057/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/babel/babel/issues/8057/timeline","performed_via_github_app":null,"state_reason":"completed"}