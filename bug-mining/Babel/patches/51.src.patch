diff --git a/packages/babel-plugin-transform-function-name/test/fixtures/function-name/export-default-arrow-renaming-module-umd/output.js b/packages/babel-plugin-transform-function-name/test/fixtures/function-name/export-default-arrow-renaming-module-umd/output.js
index 318c2544cd..aca8014334 100644
--- a/packages/babel-plugin-transform-function-name/test/fixtures/function-name/export-default-arrow-renaming-module-umd/output.js
+++ b/packages/babel-plugin-transform-function-name/test/fixtures/function-name/export-default-arrow-renaming-module-umd/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/src/index.js b/packages/babel-plugin-transform-modules-umd/src/index.js
index cd8000febb..037c70f2b4 100644
--- a/packages/babel-plugin-transform-modules-umd/src/index.js
+++ b/packages/babel-plugin-transform-modules-umd/src/index.js
@@ -27,7 +27,11 @@ const buildWrapper = template(`
 
       GLOBAL_TO_ASSIGN;
     }
-  })(this, function(IMPORT_NAMES) {
+  })(
+    typeof globalThis === "object" ? globalThis
+      : typeof self === "object" ? self
+      : this,
+    function(IMPORT_NAMES) {
   })
 `);
 
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-10/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-10/output.js
index f8e0cb66ef..32501cb431 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-10/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-10/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-11/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-11/output.js
index 44e4e41f16..0633fe90d0 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-11/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-11/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-2/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-2/output.js
index 690c27a48c..34e8e2fa3d 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-2/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-2/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-3/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-3/output.js
index 956a4b228e..aa3b89c8d7 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-3/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-3/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-4/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-4/output.js
index dcc999f2fb..7e144092f4 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-4/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-4/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-5/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-5/output.js
index 255345ddc4..6766df0861 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-5/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-5/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-6/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-6/output.js
index c10daf4270..4fd6be58e8 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-6/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-6/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-7/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-7/output.js
index 7cfc99ccd1..fa009a30d6 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-7/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-7/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-8/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-8/output.js
index 605b6c2762..f221e56a8c 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-8/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-8/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-9/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-9/output.js
index 493509da29..f840c25e6f 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-9/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default-9/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default/output.js
index 406ad75ef7..5b666da90d 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-default/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from-2/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from-2/output.js
index b03b7b38d0..14961ba262 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from-2/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from-2/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports, global.foo);
     global.input = mod.exports;
   }
-})(this, function (_exports, _foo) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports, _foo) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from-3/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from-3/output.js
index 99cc2cff28..fb7da87c3f 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from-3/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from-3/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports, global.foo);
     global.input = mod.exports;
   }
-})(this, function (_exports, _foo) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports, _foo) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from-4/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from-4/output.js
index 36925b4517..dc7a24f5f4 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from-4/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from-4/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports, global.foo);
     global.input = mod.exports;
   }
-})(this, function (_exports, _foo) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports, _foo) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from-5/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from-5/output.js
index eaa85ea93a..2e900d34ed 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from-5/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from-5/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports, global.foo);
     global.input = mod.exports;
   }
-})(this, function (_exports, _foo) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports, _foo) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from-6/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from-6/output.js
index b7d54d8219..feaf9c4c81 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from-6/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from-6/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports, global.foo);
     global.input = mod.exports;
   }
-})(this, function (_exports, _foo) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports, _foo) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from/output.js
index cde17ba821..c9634daa1b 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-from/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports, global.foo);
     global.input = mod.exports;
   }
-})(this, function (_exports, _foo) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports, _foo) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-named-2/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-named-2/output.js
index 493509da29..f840c25e6f 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-named-2/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-named-2/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-named-3/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-named-3/output.js
index c0e16dfcdf..d8434b6384 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-named-3/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-named-3/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-named-4/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-named-4/output.js
index b612eb59ae..9f6a74975f 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-named-4/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-named-4/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-named-5/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-named-5/output.js
index 37b7013b66..60d36f6a31 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-named-5/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-named-5/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-named/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-named/output.js
index e1e04041f8..e12b16c662 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-named/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/export-named/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/exports-variable/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/exports-variable/output.js
index 5606fe898c..34f0969295 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/exports-variable/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/exports-variable/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/get-module-name-option/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/get-module-name-option/output.js
index d5c9406620..9ef9726b81 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/get-module-name-option/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/get-module-name-option/output.js
@@ -10,6 +10,6 @@
     factory();
     global.myCustomModuleName = mod.exports;
   }
-})(this, function () {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function () {
   "use strict";
 });
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/hoist-function-exports/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/hoist-function-exports/output.js
index 87e3e02268..3894e1d635 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/hoist-function-exports/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/hoist-function-exports/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports, global.evens);
     global.input = mod.exports;
   }
-})(this, function (_exports, _evens) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports, _evens) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-default/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-default/output.js
index bdc895976f..733966a5af 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-default/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-default/output.js
@@ -10,7 +10,7 @@
     factory(global.foo);
     global.input = mod.exports;
   }
-})(this, function (_foo) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_foo) {
   "use strict";
 
   _foo = babelHelpers.interopRequireDefault(_foo);
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-exact-globals-false-with-overrides/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-exact-globals-false-with-overrides/output.js
index 79531c289c..9d38e1ce05 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-exact-globals-false-with-overrides/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-exact-globals-false-with-overrides/output.js
@@ -10,7 +10,7 @@
     factory(global.fooBAR, global.fooBAR, global.fizzBuzz);
     global.input = mod.exports;
   }
-})(this, function (_fooBar, _fooBar2, _fizzbuzz) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_fooBar, _fooBar2, _fizzbuzz) {
   "use strict";
 
   _fooBar = babelHelpers.interopRequireDefault(_fooBar);
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-exact-globals-false/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-exact-globals-false/output.js
index 72d8bf864d..18307048ec 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-exact-globals-false/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-exact-globals-false/output.js
@@ -10,7 +10,7 @@
     factory(global.fooBar, global.fooBar, global.fizzbuzz);
     global.input = mod.exports;
   }
-})(this, function (_fooBar, _fooBar2, _fizzbuzz) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_fooBar, _fooBar2, _fizzbuzz) {
   "use strict";
 
   _fooBar = babelHelpers.interopRequireDefault(_fooBar);
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-exact-globals-true-with-overrides/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-exact-globals-true-with-overrides/output.js
index bd083836e4..05b85cc763 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-exact-globals-true-with-overrides/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-exact-globals-true-with-overrides/output.js
@@ -10,7 +10,7 @@
     factory(global.fooBAR, global.mylib.fooBar, global.fizz.buzz);
     global.input = mod.exports;
   }
-})(this, function (_fooBar, _fooBar2, _fizzbuzz) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_fooBar, _fooBar2, _fizzbuzz) {
   "use strict";
 
   _fooBar = babelHelpers.interopRequireDefault(_fooBar);
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-exact-globals-true/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-exact-globals-true/output.js
index c16c74d6d6..baea395d14 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-exact-globals-true/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-exact-globals-true/output.js
@@ -10,7 +10,7 @@
     factory(global.fooBar, global.mylibFooBar, global.fizzbuzz);
     global.input = mod.exports;
   }
-})(this, function (_fooBar, _fooBar2, _fizzbuzz) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_fooBar, _fooBar2, _fizzbuzz) {
   "use strict";
 
   _fooBar = babelHelpers.interopRequireDefault(_fooBar);
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-glob/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-glob/output.js
index 3f403ba8ad..2820bf461f 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-glob/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-glob/output.js
@@ -10,7 +10,7 @@
     factory(global.foo);
     global.input = mod.exports;
   }
-})(this, function (foo) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (foo) {
   "use strict";
 
   foo = babelHelpers.interopRequireWildcard(foo);
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-mixing/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-mixing/output.js
index f51c2d99ae..37b9f152be 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-mixing/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-mixing/output.js
@@ -10,7 +10,7 @@
     factory(global.foo);
     global.input = mod.exports;
   }
-})(this, function (_foo) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_foo) {
   "use strict";
 
   _foo = babelHelpers.interopRequireWildcard(_foo);
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-named/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-named/output.js
index d0629b1666..f8fb2a0217 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-named/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports-named/output.js
@@ -10,7 +10,7 @@
     factory(global.foo);
     global.input = mod.exports;
   }
-})(this, function (_foo) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_foo) {
   "use strict";
 
   _foo.bar;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports/output.js
index c625f2ad0f..0e773a28c1 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/imports/output.js
@@ -10,6 +10,6 @@
     factory(global.foo, global.fooBar, global.fooBar);
     global.input = mod.exports;
   }
-})(this, function (_foo, _fooBar, _fooBar2) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_foo, _fooBar, _fooBar2) {
   "use strict";
 });
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-id-with-overridden-global-in-namespace/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-id-with-overridden-global-in-namespace/output.js
index b1b88602b1..5c79efde09 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-id-with-overridden-global-in-namespace/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-id-with-overridden-global-in-namespace/output.js
@@ -11,7 +11,7 @@
     global.foo = global.foo || {};
     global.foo.bar = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-id-with-overridden-global-in-very-nested-namespace/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-id-with-overridden-global-in-very-nested-namespace/output.js
index bcae91ef80..55ebfb1b8c 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-id-with-overridden-global-in-very-nested-namespace/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-id-with-overridden-global-in-very-nested-namespace/output.js
@@ -13,7 +13,7 @@
     global.foo.bar.baz = global.foo.bar.baz || {};
     global.foo.bar.baz.qux = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-id-with-overridden-global/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-id-with-overridden-global/output.js
index e643ca1729..0085a705c5 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-id-with-overridden-global/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-id-with-overridden-global/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.baz = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-id/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-id/output.js
index 2e8e731219..7dc12234cd 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-id/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-id/output.js
@@ -10,7 +10,7 @@
     factory();
     global.MyLib = mod.exports;
   }
-})(this, function () {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function () {
   "use strict";
 
   foobar();
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-name-with-overridden-global/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-name-with-overridden-global/output.js
index 516c1e9a10..db9e9b200d 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-name-with-overridden-global/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-name-with-overridden-global/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.looseModuleNameWithOverriddenGlobalInput = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-name/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-name/output.js
index 37b3679166..01c2ce86f9 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-name/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/module-name/output.js
@@ -10,7 +10,7 @@
     factory();
     global.looseModuleNameInput = mod.exports;
   }
-})(this, function () {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function () {
   "use strict";
 
   foobar();
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/non-default-imports/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/non-default-imports/output.js
index a9273b54d4..10c4c15c9b 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/non-default-imports/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/non-default-imports/output.js
@@ -10,6 +10,6 @@
     factory(global.render);
     global.input = mod.exports;
   }
-})(this, function (_render) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_render) {
   "use strict";
 });
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/override-export-name/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/override-export-name/output.js
index 406ad75ef7..5b666da90d 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/override-export-name/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/override-export-name/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/override-import-name/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/override-import-name/output.js
index 21f8cbe8bd..c6850dc1ab 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/override-import-name/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/override-import-name/output.js
@@ -10,6 +10,6 @@
     factory(global.Promise);
     global.input = mod.exports;
   }
-})(this, function (_es6Promise) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_es6Promise) {
   "use strict";
 });
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/overview/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/overview/output.js
index b66382de94..0ec5e6cb6d 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/overview/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/overview/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports, global.foo, global.fooBar, global.fooBar);
     global.input = mod.exports;
   }
-})(this, function (_exports, foo2, _fooBar, _fooBar2) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports, foo2, _fooBar, _fooBar2) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/remap/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/remap/output.js
index 32e24f80c8..a8503bc29b 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/remap/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/loose/remap/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   _exports.__esModule = true;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/regression/4192/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/regression/4192/output.js
index 83495f9586..f0c22802cb 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/regression/4192/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/regression/4192/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-10/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-10/output.js
index b4d81f7d48..49e75d5bc9 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-10/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-10/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-11/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-11/output.js
index 053cce392d..5447cc116b 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-11/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-11/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-2/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-2/output.js
index 91736c0197..04d3f90de3 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-2/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-2/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-3/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-3/output.js
index 3ca1ff7d74..6579e72a0b 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-3/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-3/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-4/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-4/output.js
index 006b7c2877..5478384d3b 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-4/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-4/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-5/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-5/output.js
index e9d30703b2..ae92ef86e7 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-5/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-5/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-6/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-6/output.js
index 7fdc39f6ad..38bb552b8f 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-6/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-6/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-7/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-7/output.js
index 15cad508a2..b5b988ee20 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-7/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-7/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-8/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-8/output.js
index c92a85338f..a9d3a15498 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-8/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-8/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-9/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-9/output.js
index b6a052ac66..e0c54835f5 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-9/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default-9/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default/output.js
index 3f5a188475..3650a0e70a 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-default/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from-2/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from-2/output.js
index fe946f300c..24f7b0cac3 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from-2/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from-2/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports, global.foo);
     global.input = mod.exports;
   }
-})(this, function (_exports, _foo) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports, _foo) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from-3/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from-3/output.js
index 126e1be461..5d59222a6a 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from-3/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from-3/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports, global.foo);
     global.input = mod.exports;
   }
-})(this, function (_exports, _foo) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports, _foo) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from-4/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from-4/output.js
index dc6f562b4e..a71a3dc3af 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from-4/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from-4/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports, global.foo);
     global.input = mod.exports;
   }
-})(this, function (_exports, _foo) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports, _foo) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from-5/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from-5/output.js
index f0381a2ddb..c580668106 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from-5/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from-5/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports, global.foo);
     global.input = mod.exports;
   }
-})(this, function (_exports, _foo) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports, _foo) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from-6/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from-6/output.js
index ec91801335..69ed1878b9 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from-6/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from-6/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports, global.foo);
     global.input = mod.exports;
   }
-})(this, function (_exports, _foo) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports, _foo) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from/output.js
index 116bc25773..3f4e37cb95 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-from/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports, global.foo);
     global.input = mod.exports;
   }
-})(this, function (_exports, _foo) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports, _foo) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-named-2/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-named-2/output.js
index b6a052ac66..e0c54835f5 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-named-2/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-named-2/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-named-3/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-named-3/output.js
index 7263e5f91f..0174dbf05c 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-named-3/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-named-3/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-named-4/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-named-4/output.js
index 14c4273fdc..b39c655190 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-named-4/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-named-4/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-named-5/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-named-5/output.js
index 0ac1f5a990..ea7c9ea477 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-named-5/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-named-5/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-named/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-named/output.js
index 009aedbfef..ba76f746df 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-named/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/export-named/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/exports-variable/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/exports-variable/output.js
index 90292c4609..116ca5633a 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/exports-variable/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/exports-variable/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/get-module-name-option/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/get-module-name-option/output.js
index d5c9406620..9ef9726b81 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/get-module-name-option/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/get-module-name-option/output.js
@@ -10,6 +10,6 @@
     factory();
     global.myCustomModuleName = mod.exports;
   }
-})(this, function () {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function () {
   "use strict";
 });
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/hoist-function-exports/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/hoist-function-exports/output.js
index f5427d448f..6b33b55fdd 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/hoist-function-exports/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/hoist-function-exports/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports, global.evens);
     global.input = mod.exports;
   }
-})(this, function (_exports, _evens) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports, _evens) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-default/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-default/output.js
index bdc895976f..733966a5af 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-default/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-default/output.js
@@ -10,7 +10,7 @@
     factory(global.foo);
     global.input = mod.exports;
   }
-})(this, function (_foo) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_foo) {
   "use strict";
 
   _foo = babelHelpers.interopRequireDefault(_foo);
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-exact-globals-false-with-overrides/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-exact-globals-false-with-overrides/output.js
index 79531c289c..9d38e1ce05 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-exact-globals-false-with-overrides/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-exact-globals-false-with-overrides/output.js
@@ -10,7 +10,7 @@
     factory(global.fooBAR, global.fooBAR, global.fizzBuzz);
     global.input = mod.exports;
   }
-})(this, function (_fooBar, _fooBar2, _fizzbuzz) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_fooBar, _fooBar2, _fizzbuzz) {
   "use strict";
 
   _fooBar = babelHelpers.interopRequireDefault(_fooBar);
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-exact-globals-false/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-exact-globals-false/output.js
index 72d8bf864d..18307048ec 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-exact-globals-false/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-exact-globals-false/output.js
@@ -10,7 +10,7 @@
     factory(global.fooBar, global.fooBar, global.fizzbuzz);
     global.input = mod.exports;
   }
-})(this, function (_fooBar, _fooBar2, _fizzbuzz) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_fooBar, _fooBar2, _fizzbuzz) {
   "use strict";
 
   _fooBar = babelHelpers.interopRequireDefault(_fooBar);
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-exact-globals-true-with-overrides/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-exact-globals-true-with-overrides/output.js
index bd083836e4..05b85cc763 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-exact-globals-true-with-overrides/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-exact-globals-true-with-overrides/output.js
@@ -10,7 +10,7 @@
     factory(global.fooBAR, global.mylib.fooBar, global.fizz.buzz);
     global.input = mod.exports;
   }
-})(this, function (_fooBar, _fooBar2, _fizzbuzz) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_fooBar, _fooBar2, _fizzbuzz) {
   "use strict";
 
   _fooBar = babelHelpers.interopRequireDefault(_fooBar);
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-exact-globals-true/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-exact-globals-true/output.js
index c16c74d6d6..baea395d14 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-exact-globals-true/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-exact-globals-true/output.js
@@ -10,7 +10,7 @@
     factory(global.fooBar, global.mylibFooBar, global.fizzbuzz);
     global.input = mod.exports;
   }
-})(this, function (_fooBar, _fooBar2, _fizzbuzz) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_fooBar, _fooBar2, _fizzbuzz) {
   "use strict";
 
   _fooBar = babelHelpers.interopRequireDefault(_fooBar);
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-glob/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-glob/output.js
index 3f403ba8ad..2820bf461f 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-glob/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-glob/output.js
@@ -10,7 +10,7 @@
     factory(global.foo);
     global.input = mod.exports;
   }
-})(this, function (foo) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (foo) {
   "use strict";
 
   foo = babelHelpers.interopRequireWildcard(foo);
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-mixing/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-mixing/output.js
index f51c2d99ae..37b9f152be 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-mixing/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-mixing/output.js
@@ -10,7 +10,7 @@
     factory(global.foo);
     global.input = mod.exports;
   }
-})(this, function (_foo) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_foo) {
   "use strict";
 
   _foo = babelHelpers.interopRequireWildcard(_foo);
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-named/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-named/output.js
index d0629b1666..f8fb2a0217 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-named/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports-named/output.js
@@ -10,7 +10,7 @@
     factory(global.foo);
     global.input = mod.exports;
   }
-})(this, function (_foo) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_foo) {
   "use strict";
 
   _foo.bar;
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports/output.js
index c625f2ad0f..0e773a28c1 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/imports/output.js
@@ -10,6 +10,6 @@
     factory(global.foo, global.fooBar, global.fooBar);
     global.input = mod.exports;
   }
-})(this, function (_foo, _fooBar, _fooBar2) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_foo, _fooBar, _fooBar2) {
   "use strict";
 });
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-id-with-overridden-global-in-namespace/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-id-with-overridden-global-in-namespace/output.js
index 3f43c94781..b45744b064 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-id-with-overridden-global-in-namespace/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-id-with-overridden-global-in-namespace/output.js
@@ -11,7 +11,7 @@
     global.foo = global.foo || {};
     global.foo.bar = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-id-with-overridden-global-in-very-nested-namespace/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-id-with-overridden-global-in-very-nested-namespace/output.js
index 1ddcae3472..0b358a9b20 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-id-with-overridden-global-in-very-nested-namespace/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-id-with-overridden-global-in-very-nested-namespace/output.js
@@ -13,7 +13,7 @@
     global.foo.bar.baz = global.foo.bar.baz || {};
     global.foo.bar.baz.qux = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-id-with-overridden-global/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-id-with-overridden-global/output.js
index a9feedf656..3a3fb1a0cb 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-id-with-overridden-global/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-id-with-overridden-global/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.baz = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-id/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-id/output.js
index 2e8e731219..7dc12234cd 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-id/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-id/output.js
@@ -10,7 +10,7 @@
     factory();
     global.MyLib = mod.exports;
   }
-})(this, function () {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function () {
   "use strict";
 
   foobar();
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-name-with-overridden-global/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-name-with-overridden-global/output.js
index b17d582429..1d76a5b0d6 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-name-with-overridden-global/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-name-with-overridden-global/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.umdModuleNameWithOverriddenGlobalInput = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-name/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-name/output.js
index 3967f52000..07c787a92f 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-name/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/module-name/output.js
@@ -10,7 +10,7 @@
     factory();
     global.umdModuleNameInput = mod.exports;
   }
-})(this, function () {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function () {
   "use strict";
 
   foobar();
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/non-default-imports/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/non-default-imports/output.js
index a9273b54d4..10c4c15c9b 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/non-default-imports/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/non-default-imports/output.js
@@ -10,6 +10,6 @@
     factory(global.render);
     global.input = mod.exports;
   }
-})(this, function (_render) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_render) {
   "use strict";
 });
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/override-export-name/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/override-export-name/output.js
index 3f5a188475..3650a0e70a 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/override-export-name/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/override-export-name/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/override-import-name/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/override-import-name/output.js
index 21f8cbe8bd..c6850dc1ab 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/override-import-name/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/override-import-name/output.js
@@ -10,6 +10,6 @@
     factory(global.Promise);
     global.input = mod.exports;
   }
-})(this, function (_es6Promise) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_es6Promise) {
   "use strict";
 });
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/overview/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/overview/output.js
index e60dd5dcb0..4d7a91b322 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/overview/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/overview/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports, global.foo, global.fooBar, global.fooBar);
     global.input = mod.exports;
   }
-})(this, function (_exports, foo2, _fooBar, _fooBar2) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports, foo2, _fooBar, _fooBar2) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/remap/output.js b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/remap/output.js
index e5d904ca99..c374f3aa79 100644
--- a/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/remap/output.js
+++ b/packages/babel-plugin-transform-modules-umd/test/fixtures/umd/remap/output.js
@@ -10,7 +10,7 @@
     factory(mod.exports);
     global.input = mod.exports;
   }
-})(this, function (_exports) {
+})(typeof globalThis === "object" ? globalThis : typeof self === "object" ? self : this, function (_exports) {
   "use strict";
 
   Object.defineProperty(_exports, "__esModule", {
diff --git a/packages/babel-preset-env/test/fixtures/dynamic-import/modules-umd/output.js b/packages/babel-preset-env/test/fixtures/dynamic-import/modules-umd/output.js
index f66adb1fb3..8e25ad4506 100644
--- a/packages/babel-preset-env/test/fixtures/dynamic-import/modules-umd/output.js
+++ b/packages/babel-preset-env/test/fixtures/dynamic-import/modules-umd/output.js
@@ -1,3 +1,5 @@
+function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }
+
 (function (global, factory) {
   if (typeof define === "function" && define.amd) {
     define([], factory);
@@ -10,7 +12,7 @@
     factory();
     global.input = mod.exports;
   }
-})(this, function () {
+})((typeof globalThis === "undefined" ? "undefined" : _typeof(globalThis)) === "object" ? globalThis : (typeof self === "undefined" ? "undefined" : _typeof(self)) === "object" ? self : this, function () {
   "use strict";
 
   import("foo"); // warns
diff --git a/packages/babel-preset-env/test/fixtures/modules/modules-umd/output.js b/packages/babel-preset-env/test/fixtures/modules/modules-umd/output.js
index 231614902d..5f1d193f30 100644
--- a/packages/babel-preset-env/test/fixtures/modules/modules-umd/output.js
+++ b/packages/babel-preset-env/test/fixtures/modules/modules-umd/output.js
@@ -1,3 +1,5 @@
+function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }
+
 (function (global, factory) {
   if (typeof define === "function" && define.amd) {
     define(["a"], factory);
@@ -10,7 +12,7 @@
     factory(global.a);
     global.input = mod.exports;
   }
-})(this, function (_a) {
+})((typeof globalThis === "undefined" ? "undefined" : _typeof(globalThis)) === "object" ? globalThis : (typeof self === "undefined" ? "undefined" : _typeof(self)) === "object" ? self : this, function (_a) {
   "use strict";
 
   _a = _interopRequireDefault(_a);
