{"url":"https://api.github.com/repos/pallets/jinja/issues/1068","repository_url":"https://api.github.com/repos/pallets/jinja","labels_url":"https://api.github.com/repos/pallets/jinja/issues/1068/labels{/name}","comments_url":"https://api.github.com/repos/pallets/jinja/issues/1068/comments","events_url":"https://api.github.com/repos/pallets/jinja/issues/1068/events","html_url":"https://github.com/pallets/jinja/issues/1068","id":501902201,"node_id":"MDU6SXNzdWU1MDE5MDIyMDE=","number":1068,"title":"Show some equivalent list comprehensions in filter examples","user":{"login":"mdavis-xyz","id":7035647,"node_id":"MDQ6VXNlcjcwMzU2NDc=","avatar_url":"https://avatars.githubusercontent.com/u/7035647?v=4","gravatar_id":"","url":"https://api.github.com/users/mdavis-xyz","html_url":"https://github.com/mdavis-xyz","followers_url":"https://api.github.com/users/mdavis-xyz/followers","following_url":"https://api.github.com/users/mdavis-xyz/following{/other_user}","gists_url":"https://api.github.com/users/mdavis-xyz/gists{/gist_id}","starred_url":"https://api.github.com/users/mdavis-xyz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdavis-xyz/subscriptions","organizations_url":"https://api.github.com/users/mdavis-xyz/orgs","repos_url":"https://api.github.com/users/mdavis-xyz/repos","events_url":"https://api.github.com/users/mdavis-xyz/events{/privacy}","received_events_url":"https://api.github.com/users/mdavis-xyz/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":193352435,"node_id":"MDU6TGFiZWwxOTMzNTI0MzU=","url":"https://api.github.com/repos/pallets/jinja/labels/docs","name":"docs","color":"fef2c0","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-10-03T07:37:02Z","updated_at":"2020-11-13T20:23:29Z","closed_at":"2019-10-18T19:25:28Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I'm willing to write a pull-request for this, but I just want to see what people think before I write it.\r\n\r\nSo the issue is this.\r\nI'm very familiar with python.\r\nI'm new to Jinja2.\r\n\r\nOften I find myself with complex data structures in my Ansible playbook (e.g. list of dicts with a list inside that), and I want to do some basic filtering, mapping etc.\r\n\r\nI think\r\n\r\n> I could do this in one line in python. I'm sure it's possible in Jinja, but I just can't figure out how. \r\n\r\nLooking up how `map`, `selectattr` etc work, then playing around with trial and errors takes a long time, especially when you're combining them.\r\n\r\nSo what if we had a \"quick start\" page, or another FAQ answer, which just listed a few list comprehension statements in python, and their equivalent in Jinja?\r\n\r\nHow do people feel about that?\r\n(Feel free to correct my draft, or propose new examples.)\r\n\r\n# Draft\r\n\r\n## List Comprehension with a filter or getting the attribute\r\n\r\nIn python\r\n\r\n```\r\ndata = [\r\n    {\r\n        'c': 'A',\r\n        'x': 1\r\n    },\r\n    {\r\n        'c': 'B',\r\n        'x': 2\r\n    },\r\n    {\r\n        'c': 'C',\r\n        'x': 1\r\n    },\r\n    {\r\n        'c': 'D',\r\n        'x': 1\r\n    }\r\n]\r\n\r\n# filter out all elements not with x > 5\r\na = [el for el in data if el['x'] > 5]\r\n\r\n# get all the 'c' attributes as a list\r\nb = [el['c'] for el in data]\r\n\r\n# get all the 'c' attributes for the elements with x > 5\r\nc = [el['c'] for el in data if el['x'] > 5]\r\n```\r\n\r\nIn Jinja2:\r\n\r\n```\r\na: {{ data | selectattr('x', 'gt', 5) | list }}\r\nb: {{ data | map(attribute='c') | list }} \r\nc: {{ data | selectattr('x', 'gt', 5) | map(attribute='c') | list }} \r\n```\r\n\r\n## Reversing\r\n\r\nIn python \r\n\r\n```\r\nx = [1, 2, 3]\r\ny = x[::-1]\r\n```\r\n\r\nIn Ansible\r\n\r\n```\r\ny: {{ x | reverse }}\r\n```\r\n\r\n\r\n## Json and Yaml\r\n\r\nIn python:\r\n\r\n```\r\nimport json\r\nd = {'a':'b'}\r\ns = json.dumps(d)\r\nx = json.loads(s)\r\n```\r\n\r\nIn Jinja2, to convert to json, just print as string.\r\n\r\n```\r\n{{ d }}\r\n```\r\n\r\nTo convert to yaml use\r\n\r\n```\r\n{{ d | to_yaml }}\r\n```\r\n\r\nIn Jinja2, to load from json, just use \r\n\r\n```\r\n{{ d | from_json }}\r\n```\r\n\r\nIn Jinja2, to load from yaml, use\r\n\r\n```\r\n{{ d | from_yaml }}\r\n```\r\n\r\n## Load from file\r\n\r\nIn python\r\n\r\n```\r\nwith open('file.txt', 'r') as f:\r\n  s = f.read()\r\n```\r\n\r\nIn Jinja2:\r\n\r\n```\r\n{{ lookup('file', 'file.txt') }}\r\n```\r\n\r\nTo read a yaml file into a variable, use\r\n\r\n```\r\nx: {{ lookup('file', 'file.yaml') | from_yaml }}\r\n```\r\n","closed_by":{"login":"davidism","id":1242887,"node_id":"MDQ6VXNlcjEyNDI4ODc=","avatar_url":"https://avatars.githubusercontent.com/u/1242887?v=4","gravatar_id":"","url":"https://api.github.com/users/davidism","html_url":"https://github.com/davidism","followers_url":"https://api.github.com/users/davidism/followers","following_url":"https://api.github.com/users/davidism/following{/other_user}","gists_url":"https://api.github.com/users/davidism/gists{/gist_id}","starred_url":"https://api.github.com/users/davidism/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidism/subscriptions","organizations_url":"https://api.github.com/users/davidism/orgs","repos_url":"https://api.github.com/users/davidism/repos","events_url":"https://api.github.com/users/davidism/events{/privacy}","received_events_url":"https://api.github.com/users/davidism/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pallets/jinja/issues/1068/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pallets/jinja/issues/1068/timeline","performed_via_github_app":null,"state_reason":"completed"}