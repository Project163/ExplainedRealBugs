{"url":"https://api.github.com/repos/pallets/jinja/issues/650","repository_url":"https://api.github.com/repos/pallets/jinja","labels_url":"https://api.github.com/repos/pallets/jinja/issues/650/labels{/name}","comments_url":"https://api.github.com/repos/pallets/jinja/issues/650/comments","events_url":"https://api.github.com/repos/pallets/jinja/issues/650/events","html_url":"https://github.com/pallets/jinja/issues/650","id":199507690,"node_id":"MDU6SXNzdWUxOTk1MDc2OTA=","number":650,"title":"Bytecode cache does not invalidate old items, leading to spurious errors after 2.8->2.9 upgrade","user":{"login":"rbu","id":65913,"node_id":"MDQ6VXNlcjY1OTEz","avatar_url":"https://avatars.githubusercontent.com/u/65913?v=4","gravatar_id":"","url":"https://api.github.com/users/rbu","html_url":"https://github.com/rbu","followers_url":"https://api.github.com/users/rbu/followers","following_url":"https://api.github.com/users/rbu/following{/other_user}","gists_url":"https://api.github.com/users/rbu/gists{/gist_id}","starred_url":"https://api.github.com/users/rbu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rbu/subscriptions","organizations_url":"https://api.github.com/users/rbu/orgs","repos_url":"https://api.github.com/users/rbu/repos","events_url":"https://api.github.com/users/rbu/events{/privacy}","received_events_url":"https://api.github.com/users/rbu/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-01-09T09:27:21Z","updated_at":"2020-11-13T21:23:25Z","closed_at":"2017-01-09T10:06:07Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I've performed a 2.8.1->2.9.3 upgrade and experienced inexplicable macro errors*. When debugging these, the errors went away, and it turned out they were caused by the bytecode cache. Entries generated with Jinja 2.8 stayed in the cache and were found by 2.9.\r\n\r\nThe documentation or changelog makes no mention of a necessity for cleaning the bytecode during a version upgrade, so I would consider it a bug Jinja does not invalidate entries made using a previous version automatically. Thoughts?\r\n\r\n\r\n* For example, the macro argument count would be identified incorrectly, leading to runtime errors such as this:\r\n```\r\n    {{ abc.ABC(request, \"one\", \"two\") }}\r\nTypeError: macro() takes exactly 3 arguments (4 given)\r\n```\r\n\r\neven when the macro is defined as\r\n```\r\n{% macro ABC(request, class_one=\"\", class_two=\"\") %}\r\n```\r\n","closed_by":{"login":"mitsuhiko","id":7396,"node_id":"MDQ6VXNlcjczOTY=","avatar_url":"https://avatars.githubusercontent.com/u/7396?v=4","gravatar_id":"","url":"https://api.github.com/users/mitsuhiko","html_url":"https://github.com/mitsuhiko","followers_url":"https://api.github.com/users/mitsuhiko/followers","following_url":"https://api.github.com/users/mitsuhiko/following{/other_user}","gists_url":"https://api.github.com/users/mitsuhiko/gists{/gist_id}","starred_url":"https://api.github.com/users/mitsuhiko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitsuhiko/subscriptions","organizations_url":"https://api.github.com/users/mitsuhiko/orgs","repos_url":"https://api.github.com/users/mitsuhiko/repos","events_url":"https://api.github.com/users/mitsuhiko/events{/privacy}","received_events_url":"https://api.github.com/users/mitsuhiko/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pallets/jinja/issues/650/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pallets/jinja/issues/650/timeline","performed_via_github_app":null,"state_reason":"completed"}