[{"url":"https://api.github.com/repos/pallets/jinja/issues/comments/564707","html_url":"https://github.com/pallets/jinja/issues/8#issuecomment-564707","issue_url":"https://api.github.com/repos/pallets/jinja/issues/8","id":564707,"node_id":"MDEyOklzc3VlQ29tbWVudDU2NDcwNw==","user":{"login":"jvs","id":405353,"node_id":"MDQ6VXNlcjQwNTM1Mw==","avatar_url":"https://avatars.githubusercontent.com/u/405353?v=4","gravatar_id":"","url":"https://api.github.com/users/jvs","html_url":"https://github.com/jvs","followers_url":"https://api.github.com/users/jvs/followers","following_url":"https://api.github.com/users/jvs/following{/other_user}","gists_url":"https://api.github.com/users/jvs/gists{/gist_id}","starred_url":"https://api.github.com/users/jvs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jvs/subscriptions","organizations_url":"https://api.github.com/users/jvs/orgs","repos_url":"https://api.github.com/users/jvs/repos","events_url":"https://api.github.com/users/jvs/events{/privacy}","received_events_url":"https://api.github.com/users/jvs/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2010-11-24T18:16:11Z","updated_at":"2010-11-24T18:16:11Z","body":"[Markdown messed up my report.  Let me try again.]\n\nI think the LRUCache class in Jinja2 has a bug.  The problem is that the \"__getitem__\" method may mutate the cache, but that method does not acquire the write lock, \"_wlock\".\n\nFor example, here's one scenario:\n- Thread A calls \"getitem\" with the key \"K\".\n- \"K\" is not the last element of the queue, so Thread A removes it.\n- Thread A is suspended before it appends \"K\" to the queue.\n- Thread B calls \"setitem\" with the key \"K\".\n- Thread B finds \"K\" in the \"mapping\" dictionary.\n- Thread B tries to remove \"K\" from the queue.\n- The queue raises an exception, because it does not contain \"K\".\n\nIn my project I've seen the \"__setitem__\" method raise a KeyError.  I assume that there's a similar execution scenario behind those exceptions, but I could be wrong.\n\nIn any case, I think \"__getitem__\" clearly needs to acquire \"_wlock\" before it removes and appends keys.\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/pallets/jinja/issues/comments/564707/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jvs","id":405353,"node_id":"MDQ6VXNlcjQwNTM1Mw==","avatar_url":"https://avatars.githubusercontent.com/u/405353?v=4","gravatar_id":"","url":"https://api.github.com/users/jvs","html_url":"https://github.com/jvs","followers_url":"https://api.github.com/users/jvs/followers","following_url":"https://api.github.com/users/jvs/following{/other_user}","gists_url":"https://api.github.com/users/jvs/gists{/gist_id}","starred_url":"https://api.github.com/users/jvs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jvs/subscriptions","organizations_url":"https://api.github.com/users/jvs/orgs","repos_url":"https://api.github.com/users/jvs/repos","events_url":"https://api.github.com/users/jvs/events{/privacy}","received_events_url":"https://api.github.com/users/jvs/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/pallets/jinja/issues/comments/13527104","html_url":"https://github.com/pallets/jinja/issues/8#issuecomment-13527104","issue_url":"https://api.github.com/repos/pallets/jinja/issues/8","id":13527104,"node_id":"MDEyOklzc3VlQ29tbWVudDEzNTI3MTA0","user":{"login":"tonytargonski","id":27450,"node_id":"MDQ6VXNlcjI3NDUw","avatar_url":"https://avatars.githubusercontent.com/u/27450?v=4","gravatar_id":"","url":"https://api.github.com/users/tonytargonski","html_url":"https://github.com/tonytargonski","followers_url":"https://api.github.com/users/tonytargonski/followers","following_url":"https://api.github.com/users/tonytargonski/following{/other_user}","gists_url":"https://api.github.com/users/tonytargonski/gists{/gist_id}","starred_url":"https://api.github.com/users/tonytargonski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonytargonski/subscriptions","organizations_url":"https://api.github.com/users/tonytargonski/orgs","repos_url":"https://api.github.com/users/tonytargonski/repos","events_url":"https://api.github.com/users/tonytargonski/events{/privacy}","received_events_url":"https://api.github.com/users/tonytargonski/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2013-02-14T00:35:36Z","updated_at":"2013-02-14T00:35:36Z","body":"To add to this 2 year old ticket... I have also observed the same exception in my system.\n\n```\n[Tue Feb 12 19:48:16 2013] [error]   File \"/local/python_envs/www/local/lib/python2.7/site-packages/jinja2/utils.py\", line 473, in __setitem__\n[Tue Feb 12 19:48:16 2013] [error]     del self._mapping[self._popleft()]\n[Tue Feb 12 19:48:16 2013] [error] KeyError: '_breadcrumbs.html\n```\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/pallets/jinja/issues/comments/13527104/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"tonytargonski","id":27450,"node_id":"MDQ6VXNlcjI3NDUw","avatar_url":"https://avatars.githubusercontent.com/u/27450?v=4","gravatar_id":"","url":"https://api.github.com/users/tonytargonski","html_url":"https://github.com/tonytargonski","followers_url":"https://api.github.com/users/tonytargonski/followers","following_url":"https://api.github.com/users/tonytargonski/following{/other_user}","gists_url":"https://api.github.com/users/tonytargonski/gists{/gist_id}","starred_url":"https://api.github.com/users/tonytargonski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonytargonski/subscriptions","organizations_url":"https://api.github.com/users/tonytargonski/orgs","repos_url":"https://api.github.com/users/tonytargonski/repos","events_url":"https://api.github.com/users/tonytargonski/events{/privacy}","received_events_url":"https://api.github.com/users/tonytargonski/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":45075796,"node_id":"MDExOkNsb3NlZEV2ZW50NDUwNzU3OTY=","url":"https://api.github.com/repos/pallets/jinja/issues/events/45075796","actor":{"login":"mitsuhiko","id":7396,"node_id":"MDQ6VXNlcjczOTY=","avatar_url":"https://avatars.githubusercontent.com/u/7396?v=4","gravatar_id":"","url":"https://api.github.com/users/mitsuhiko","html_url":"https://github.com/mitsuhiko","followers_url":"https://api.github.com/users/mitsuhiko/followers","following_url":"https://api.github.com/users/mitsuhiko/following{/other_user}","gists_url":"https://api.github.com/users/mitsuhiko/gists{/gist_id}","starred_url":"https://api.github.com/users/mitsuhiko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitsuhiko/subscriptions","organizations_url":"https://api.github.com/users/mitsuhiko/orgs","repos_url":"https://api.github.com/users/mitsuhiko/repos","events_url":"https://api.github.com/users/mitsuhiko/events{/privacy}","received_events_url":"https://api.github.com/users/mitsuhiko/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"d4e54382cbe6c9760d01fec22655851bd54f02bc","commit_url":"https://api.github.com/repos/pallets/jinja/commits/d4e54382cbe6c9760d01fec22655851bd54f02bc","created_at":"2013-04-12T23:38:33Z","state_reason":null,"performed_via_github_app":null},{"actor":{"login":"MrkGrgsn","id":3621881,"node_id":"MDQ6VXNlcjM2MjE4ODE=","avatar_url":"https://avatars.githubusercontent.com/u/3621881?v=4","gravatar_id":"","url":"https://api.github.com/users/MrkGrgsn","html_url":"https://github.com/MrkGrgsn","followers_url":"https://api.github.com/users/MrkGrgsn/followers","following_url":"https://api.github.com/users/MrkGrgsn/following{/other_user}","gists_url":"https://api.github.com/users/MrkGrgsn/gists{/gist_id}","starred_url":"https://api.github.com/users/MrkGrgsn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MrkGrgsn/subscriptions","organizations_url":"https://api.github.com/users/MrkGrgsn/orgs","repos_url":"https://api.github.com/users/MrkGrgsn/repos","events_url":"https://api.github.com/users/MrkGrgsn/events{/privacy}","received_events_url":"https://api.github.com/users/MrkGrgsn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-05T23:37:45Z","updated_at":"2017-06-05T23:37:45Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/ckan/ckan/issues/2808","repository_url":"https://api.github.com/repos/ckan/ckan","labels_url":"https://api.github.com/repos/ckan/ckan/issues/2808/labels{/name}","comments_url":"https://api.github.com/repos/ckan/ckan/issues/2808/comments","events_url":"https://api.github.com/repos/ckan/ckan/issues/2808/events","html_url":"https://github.com/ckan/ckan/issues/2808","id":123448441,"node_id":"MDU6SXNzdWUxMjM0NDg0NDE=","number":2808,"title":"KeyError: 'snippets/facet_list.html'","user":{"login":"pwalsh","id":791678,"node_id":"MDQ6VXNlcjc5MTY3OA==","avatar_url":"https://avatars.githubusercontent.com/u/791678?v=4","gravatar_id":"","url":"https://api.github.com/users/pwalsh","html_url":"https://github.com/pwalsh","followers_url":"https://api.github.com/users/pwalsh/followers","following_url":"https://api.github.com/users/pwalsh/following{/other_user}","gists_url":"https://api.github.com/users/pwalsh/gists{/gist_id}","starred_url":"https://api.github.com/users/pwalsh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pwalsh/subscriptions","organizations_url":"https://api.github.com/users/pwalsh/orgs","repos_url":"https://api.github.com/users/pwalsh/repos","events_url":"https://api.github.com/users/pwalsh/events{/privacy}","received_events_url":"https://api.github.com/users/pwalsh/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":55783996,"node_id":"MDU6TGFiZWw1NTc4Mzk5Ng==","url":"https://api.github.com/repos/ckan/ckan/labels/Good%20for%20Contribution","name":"Good for Contribution","color":"009800","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2015-12-22T09:42:39Z","updated_at":"2019-01-22T15:33:19Z","closed_at":"2019-01-22T15:33:19Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":2750721,"node_id":"MDEwOlJlcG9zaXRvcnkyNzUwNzIx","name":"ckan","full_name":"ckan/ckan","private":false,"owner":{"login":"ckan","id":1630326,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE2MzAzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/1630326?v=4","gravatar_id":"","url":"https://api.github.com/users/ckan","html_url":"https://github.com/ckan","followers_url":"https://api.github.com/users/ckan/followers","following_url":"https://api.github.com/users/ckan/following{/other_user}","gists_url":"https://api.github.com/users/ckan/gists{/gist_id}","starred_url":"https://api.github.com/users/ckan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ckan/subscriptions","organizations_url":"https://api.github.com/users/ckan/orgs","repos_url":"https://api.github.com/users/ckan/repos","events_url":"https://api.github.com/users/ckan/events{/privacy}","received_events_url":"https://api.github.com/users/ckan/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/ckan/ckan","description":"CKAN is an open-source DMS (data management system) for powering data hubs and data portals. CKAN makes it easy to publish, share and use data. It powers catalog.data.gov, open.canada.ca/data, data.humdata.org among many other sites.","fork":false,"url":"https://api.github.com/repos/ckan/ckan","forks_url":"https://api.github.com/repos/ckan/ckan/forks","keys_url":"https://api.github.com/repos/ckan/ckan/keys{/key_id}","collaborators_url":"https://api.github.com/repos/ckan/ckan/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/ckan/ckan/teams","hooks_url":"https://api.github.com/repos/ckan/ckan/hooks","issue_events_url":"https://api.github.com/repos/ckan/ckan/issues/events{/number}","events_url":"https://api.github.com/repos/ckan/ckan/events","assignees_url":"https://api.github.com/repos/ckan/ckan/assignees{/user}","branches_url":"https://api.github.com/repos/ckan/ckan/branches{/branch}","tags_url":"https://api.github.com/repos/ckan/ckan/tags","blobs_url":"https://api.github.com/repos/ckan/ckan/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/ckan/ckan/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/ckan/ckan/git/refs{/sha}","trees_url":"https://api.github.com/repos/ckan/ckan/git/trees{/sha}","statuses_url":"https://api.github.com/repos/ckan/ckan/statuses/{sha}","languages_url":"https://api.github.com/repos/ckan/ckan/languages","stargazers_url":"https://api.github.com/repos/ckan/ckan/stargazers","contributors_url":"https://api.github.com/repos/ckan/ckan/contributors","subscribers_url":"https://api.github.com/repos/ckan/ckan/subscribers","subscription_url":"https://api.github.com/repos/ckan/ckan/subscription","commits_url":"https://api.github.com/repos/ckan/ckan/commits{/sha}","git_commits_url":"https://api.github.com/repos/ckan/ckan/git/commits{/sha}","comments_url":"https://api.github.com/repos/ckan/ckan/comments{/number}","issue_comment_url":"https://api.github.com/repos/ckan/ckan/issues/comments{/number}","contents_url":"https://api.github.com/repos/ckan/ckan/contents/{+path}","compare_url":"https://api.github.com/repos/ckan/ckan/compare/{base}...{head}","merges_url":"https://api.github.com/repos/ckan/ckan/merges","archive_url":"https://api.github.com/repos/ckan/ckan/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/ckan/ckan/downloads","issues_url":"https://api.github.com/repos/ckan/ckan/issues{/number}","pulls_url":"https://api.github.com/repos/ckan/ckan/pulls{/number}","milestones_url":"https://api.github.com/repos/ckan/ckan/milestones{/number}","notifications_url":"https://api.github.com/repos/ckan/ckan/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/ckan/ckan/labels{/name}","releases_url":"https://api.github.com/repos/ckan/ckan/releases{/id}","deployments_url":"https://api.github.com/repos/ckan/ckan/deployments","created_at":"2011-11-10T18:42:17Z","updated_at":"2025-11-10T09:13:55Z","pushed_at":"2025-11-06T13:06:14Z","git_url":"git://github.com/ckan/ckan.git","ssh_url":"git@github.com:ckan/ckan.git","clone_url":"https://github.com/ckan/ckan.git","svn_url":"https://github.com/ckan/ckan","homepage":"https://ckan.org/","size":223905,"stargazers_count":4874,"watchers_count":4874,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":2067,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":836,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["api","catalog","ckan","ckanext","data","digitalpublicgoods","dpg","open-data","python","sdg16"],"visibility":"public","forks":2067,"open_issues":836,"watchers":4874,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"# Background\n\nI'm seeing a range of simple exceptions coming out of datahub.io (running CKAN 2.4). These errors are not critical, but should be addressed and are probably easy \"good for contribution\" tasks.\n# Issue\n\n```\nKeyError: 'snippets/facet_list.html'\n  File \"raven/middleware.py\", line 35, in __call__\n    iterable = self.application(environ, start_response)\n  File \"webob/dec.py\", line 147, in __call__\n    resp = self.call_func(req, *args, **self.kwargs)\n  File \"webob/dec.py\", line 208, in call_func\n    return self.func(req, *args, **kwargs)\n  File \"fanstatic/publisher.py\", line 234, in __call__\n    return request.get_response(self.app)\n  File \"webob/request.py\", line 1053, in get_response\n    application, catch_exc_info=False)\n  File \"webob/request.py\", line 1022, in call_application\n    app_iter = application(self.environ, start_response)\n  File \"webob/dec.py\", line 147, in __call__\n    resp = self.call_func(req, *args, **self.kwargs)\n  File \"webob/dec.py\", line 208, in call_func\n    return self.func(req, *args, **kwargs)\n  File \"fanstatic/injector.py\", line 54, in __call__\n    response = request.get_response(self.app)\n  File \"webob/request.py\", line 1053, in get_response\n    application, catch_exc_info=False)\n  File \"webob/request.py\", line 1022, in call_application\n    app_iter = application(self.environ, start_response)\n  File \"ckan/config/middleware.py\", line 389, in inner\n    result = application(environ, start_response)\n  File \"beaker/middleware.py\", line 73, in __call__\n    return self.app(environ, start_response)\n  File \"beaker/middleware.py\", line 155, in __call__\n    return self.wrap_app(environ, session_start_response)\n  File \"routes/middleware.py\", line 131, in __call__\n    response = self.app(environ, start_response)\n  File \"pylons/wsgiapp.py\", line 125, in __call__\n    response = self.dispatch(controller, environ, start_response)\n  File \"pylons/wsgiapp.py\", line 324, in dispatch\n    return controller(environ, start_response)\n  File \"ckan/lib/base.py\", line 338, in __call__\n    res = WSGIController.__call__(self, environ, start_response)\n  File \"pylons/controllers/core.py\", line 221, in __call__\n    response = self._dispatch_call()\n  File \"pylons/controllers/core.py\", line 172, in _dispatch_call\n    response = self._inspect_call(func)\n  File \"pylons/controllers/core.py\", line 107, in _inspect_call\n    result = self._perform_call(func, args)\n  File \"ckan/controllers/group.py\", line 230, in read\n    extra_vars={'group_type': group_type})\n  File \"ckan/lib/base.py\", line 217, in render\n    loader_class=loader_class)\n  File \"pylons/templating.py\", line 249, in cached_template\n    return render_func()\n  File \"ckan/lib/base.py\", line 155, in render_template\n    return render_jinja2(template_name, globs)\n  File \"ckan/lib/base.py\", line 103, in render_jinja2\n    template = env.get_template(template_name)\n  File \"jinja2/environment.py\", line 719, in get_template\n    return self._load_template(name, self.make_globals(globals))\n  File \"jinja2/environment.py\", line 695, in _load_template\n    self.cache[name] = template\n  File \"jinja2/utils.py\", line 473, in __setitem__\n    del self._mapping[self._popleft()]\n```\n","reactions":{"url":"https://api.github.com/repos/ckan/ckan/issues/2808/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/ckan/ckan/issues/2808/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":3995572935,"node_id":"MDExOkxvY2tlZEV2ZW50Mzk5NTU3MjkzNQ==","url":"https://api.github.com/repos/pallets/jinja/issues/events/3995572935","actor":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"event":"locked","commit_id":null,"commit_url":null,"created_at":"2020-11-13T22:14:11Z","lock_reason":"resolved","performed_via_github_app":null}]