{"url":"https://api.github.com/repos/pallets/jinja/issues/1141","repository_url":"https://api.github.com/repos/pallets/jinja","labels_url":"https://api.github.com/repos/pallets/jinja/issues/1141/labels{/name}","comments_url":"https://api.github.com/repos/pallets/jinja/issues/1141/comments","events_url":"https://api.github.com/repos/pallets/jinja/issues/1141/events","html_url":"https://github.com/pallets/jinja/issues/1141","id":557509910,"node_id":"MDU6SXNzdWU1NTc1MDk5MTA=","number":1141,"title":"'coroutine' object is not subscriptable in async template","user":{"login":"ddelange","id":14880945,"node_id":"MDQ6VXNlcjE0ODgwOTQ1","avatar_url":"https://avatars.githubusercontent.com/u/14880945?v=4","gravatar_id":"","url":"https://api.github.com/users/ddelange","html_url":"https://github.com/ddelange","followers_url":"https://api.github.com/users/ddelange/followers","following_url":"https://api.github.com/users/ddelange/following{/other_user}","gists_url":"https://api.github.com/users/ddelange/gists{/gist_id}","starred_url":"https://api.github.com/users/ddelange/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ddelange/subscriptions","organizations_url":"https://api.github.com/users/ddelange/orgs","repos_url":"https://api.github.com/users/ddelange/repos","events_url":"https://api.github.com/users/ddelange/events{/privacy}","received_events_url":"https://api.github.com/users/ddelange/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1814542669,"node_id":"MDU6TGFiZWwxODE0NTQyNjY5","url":"https://api.github.com/repos/pallets/jinja/labels/async","name":"async","color":"b489d3","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/pallets/jinja/milestones/4","html_url":"https://github.com/pallets/jinja/milestone/4","labels_url":"https://api.github.com/repos/pallets/jinja/milestones/4/labels","id":5053048,"node_id":"MDk6TWlsZXN0b25lNTA1MzA0OA==","number":4,"title":"2.11.1","description":"","creator":{"login":"davidism","id":1242887,"node_id":"MDQ6VXNlcjEyNDI4ODc=","avatar_url":"https://avatars.githubusercontent.com/u/1242887?v=4","gravatar_id":"","url":"https://api.github.com/users/davidism","html_url":"https://github.com/davidism","followers_url":"https://api.github.com/users/davidism/followers","following_url":"https://api.github.com/users/davidism/following{/other_user}","gists_url":"https://api.github.com/users/davidism/gists{/gist_id}","starred_url":"https://api.github.com/users/davidism/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidism/subscriptions","organizations_url":"https://api.github.com/users/davidism/orgs","repos_url":"https://api.github.com/users/davidism/repos","events_url":"https://api.github.com/users/davidism/events{/privacy}","received_events_url":"https://api.github.com/users/davidism/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":2,"state":"closed","created_at":"2020-01-29T14:36:19Z","updated_at":"2020-01-30T18:10:28Z","due_on":null,"closed_at":"2020-01-30T18:10:28Z"},"comments":13,"created_at":"2020-01-30T13:55:00Z","updated_at":"2020-11-13T19:56:16Z","closed_at":"2020-01-30T17:56:27Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Expected Behavior\r\nRendering was succesfull with Jinja2 2.10.3\r\n\r\n## Actual Behavior\r\nWhen upgrading from 2.10.3 to 2.11.0, our async Quart application breaks, HTTP ERROR 500 thrown at user.\r\n\r\n## Template Code\r\nhere, Candidate is a Quart Model which we loop over to show all Candidates in a Demand. I tried extracting the relevant part of the template:\r\n\r\n`simple.html`\r\n```jinja\r\n{% extends \"base.html\" %}\r\n\r\nPaste the template code (ideally a minimal example) that causes the issue\r\n {% for item in candidates %}\r\n <form>\r\n   <div class=\"row result-row\">\r\n   <div class=\"col-6\">\r\n     <h4>\r\n         <a href=\"{{ item.domain }}\" target=\"_blank\">{{ item.unified_domain }}</a>\r\n        <span class=\"badge badge-primary\" title=\"Relevance Score. {{ item.score_message }}\"><small>{{ item.score|round|int }}</small></span>\r\n     </h4>\r\n     <div>\r\n\r\n         {% if item.data['findings'] %}\r\n         <span class=\"badge badge-info\" title=\"Matches\"><small>Google Matches ({{ item.data['findings']|length }})</small></span>\r\n         {% endif  %}\r\n     </div>\r\n\r\n     <div style=\"overflow: hidden; margin-bottom: 10px;\">\r\n\r\n      {% for finding in item.data['findings'][:1] %}\r\n        <b>{{ finding['title'] }}</b>\r\n        <br/>\r\n        <a  target=\"_blank\" href=\"{{ finding['url'] }}\"><small>{{ finding['url'] }}</small></a>\r\n        <br/>\r\n        <p class=\"text-muted\">{{ finding['description'] }}</p>\r\n      {% endfor %}\r\n\r\n     </div>\r\n\r\n   </div>\r\n   </div>\r\n   </form>\r\n {% endfor %}\r\n```\r\n\r\ncalled in Quart via [`quart.render_template`](https://github.com/pgjones/quart/blob/0.10.0/quart/templating.py#L79)\r\n```py\r\nreturn await quart.render_template(\r\n    \"simple.html\",\r\n    demand=demand,\r\n    candidates=candidates,\r\n)\r\n```\r\n\r\n## Full Traceback\r\n```pytb\r\n//templates/simple.html:178: RuntimeWarning: coroutine 'auto_await' was never awaited\r\n\r\nRuntimeWarning: Enable tracemalloc to get the object allocation traceback\r\nERROR:quart.app:Exception on request GET /demand/96\r\nTraceback (most recent call last):\r\nFile \"/usr/local/lib/python3.7/site-packages/quart/app.py\", line 1524, in handle_request\r\nreturn await self.full_dispatch_request(request_context)\r\nFile \"/usr/local/lib/python3.7/site-packages/quart/app.py\", line 1546, in full_dispatch_request\r\nresult = await self.handle_user_exception(error)\r\nFile \"/usr/local/lib/python3.7/site-packages/quart/app.py\", line 957, in handle_user_exception\r\nraise error\r\nFile \"/usr/local/lib/python3.7/site-packages/quart/app.py\", line 1544, in full_dispatch_request\r\nresult = await self.dispatch_request(request_context)\r\nFile \"/usr/local/lib/python3.7/site-packages/quart/app.py\", line 1592, in dispatch_request\r\nreturn await handler(**request_.view_args)\r\nFile \"server.py\", line 318, in view_demand\r\nall_score_keywords=[x.strip() for x in demand.score_keywords.split(\"\\n\")],\r\nFile \"/usr/local/lib/python3.7/site-packages/quart/templating.py\", line 89, in render_template\r\nreturn await _render(template, context)\r\nFile \"/usr/local/lib/python3.7/site-packages/quart/templating.py\", line 107, in _render\r\nrendered_template = await template.render_async(context)\r\nFile \"/usr/local/lib/python3.7/site-packages/jinja2/asyncsupport.py\", line 65, in render_async\r\nreturn self.environment.handle_exception()\r\nFile \"/usr/local/lib/python3.7/site-packages/jinja2/environment.py\", line 832, in handle_exception\r\nreraise(*rewrite_traceback_stack(source=source))\r\nFile \"/usr/local/lib/python3.7/site-packages/jinja2/_compat.py\", line 28, in reraise\r\nraise value.with_traceback(tb)\r\nFile \"/usr/local/lib/python3.7/site-packages/jinja2/asyncsupport.py\", line 25, in concat_async\r\nawait collect()\r\nFile \"/usr/local/lib/python3.7/site-packages/jinja2/asyncsupport.py\", line 22, in collect\r\nasync for event in async_gen:\r\nFile \"//templates/simple.html\", line 1, in top-level template code\r\n{% extends \"base.html\" %}\r\nFile \"//templates/base.html\", line 43, in top-level template code\r\n{% block content %}\r\nFile \"//templates/simple.html\", line 286, in block \"content\"\r\n{% for finding in item.data['findings'][:1] %}\r\nTypeError: 'coroutine' object is not subscriptable\r\n```\r\n\r\n## Your Environment\r\n* Python version: 3.7.5\r\n* Jinja version: 2.11.0\r\n","closed_by":{"login":"davidism","id":1242887,"node_id":"MDQ6VXNlcjEyNDI4ODc=","avatar_url":"https://avatars.githubusercontent.com/u/1242887?v=4","gravatar_id":"","url":"https://api.github.com/users/davidism","html_url":"https://github.com/davidism","followers_url":"https://api.github.com/users/davidism/followers","following_url":"https://api.github.com/users/davidism/following{/other_user}","gists_url":"https://api.github.com/users/davidism/gists{/gist_id}","starred_url":"https://api.github.com/users/davidism/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidism/subscriptions","organizations_url":"https://api.github.com/users/davidism/orgs","repos_url":"https://api.github.com/users/davidism/repos","events_url":"https://api.github.com/users/davidism/events{/privacy}","received_events_url":"https://api.github.com/users/davidism/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pallets/jinja/issues/1141/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pallets/jinja/issues/1141/timeline","performed_via_github_app":null,"state_reason":"completed"}