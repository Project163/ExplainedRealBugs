{"url":"https://api.github.com/repos/pallets/jinja/issues/1448","repository_url":"https://api.github.com/repos/pallets/jinja","labels_url":"https://api.github.com/repos/pallets/jinja/issues/1448/labels{/name}","comments_url":"https://api.github.com/repos/pallets/jinja/issues/1448/comments","events_url":"https://api.github.com/repos/pallets/jinja/issues/1448/events","html_url":"https://github.com/pallets/jinja/issues/1448","id":898144372,"node_id":"MDU6SXNzdWU4OTgxNDQzNzI=","number":1448,"title":"containment should only fail for `StrictUndefined`, not regular `Undefined`","user":{"login":"abadger","id":209242,"node_id":"MDQ6VXNlcjIwOTI0Mg==","avatar_url":"https://avatars.githubusercontent.com/u/209242?v=4","gravatar_id":"","url":"https://api.github.com/users/abadger","html_url":"https://github.com/abadger","followers_url":"https://api.github.com/users/abadger/followers","following_url":"https://api.github.com/users/abadger/following{/other_user}","gists_url":"https://api.github.com/users/abadger/gists{/gist_id}","starred_url":"https://api.github.com/users/abadger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abadger/subscriptions","organizations_url":"https://api.github.com/users/abadger/orgs","repos_url":"https://api.github.com/users/abadger/repos","events_url":"https://api.github.com/users/abadger/events{/privacy}","received_events_url":"https://api.github.com/users/abadger/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/pallets/jinja/milestones/9","html_url":"https://github.com/pallets/jinja/milestone/9","labels_url":"https://api.github.com/repos/pallets/jinja/milestones/9/labels","id":6765777,"node_id":"MDk6TWlsZXN0b25lNjc2NTc3Nw==","number":9,"title":"3.0.2","description":"","creator":{"login":"davidism","id":1242887,"node_id":"MDQ6VXNlcjEyNDI4ODc=","avatar_url":"https://avatars.githubusercontent.com/u/1242887?v=4","gravatar_id":"","url":"https://api.github.com/users/davidism","html_url":"https://github.com/davidism","followers_url":"https://api.github.com/users/davidism/followers","following_url":"https://api.github.com/users/davidism/following{/other_user}","gists_url":"https://api.github.com/users/davidism/gists{/gist_id}","starred_url":"https://api.github.com/users/davidism/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidism/subscriptions","organizations_url":"https://api.github.com/users/davidism/orgs","repos_url":"https://api.github.com/users/davidism/repos","events_url":"https://api.github.com/users/davidism/events{/privacy}","received_events_url":"https://api.github.com/users/davidism/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":15,"state":"closed","created_at":"2021-05-17T13:53:03Z","updated_at":"2021-10-05T01:09:25Z","due_on":null,"closed_at":"2021-10-05T01:09:25Z"},"comments":3,"created_at":"2021-05-21T15:15:10Z","updated_at":"2021-08-24T00:07:32Z","closed_at":"2021-08-09T18:10:10Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Summary\r\nHello, I'm looking into a change of behaviour between jinja2-2.11.x (and previous... this section of our template has been around for a long time) and jinja2-3.0.x.  I have a feeling it was a bug in 2.11 that got fixed but since I don't see the behaviour change spelled out in the changelog I decided to report it in case it was an unintended side effect of a different bugfix.\r\n\r\nWith jinja2-2.11.x, certain `{% if x in dictionary[key] %}` constructs will evaluate False if key is not present in the dictionary.  In jinja2-3.0.x, the construct will raise an UndefinedException instead. \r\n\r\n### Reproducer\r\n\r\nHere's a small template that triggers the behaviour:\r\n``` jinja\r\n{# Called with d = {'test': {}} #}\r\nStart\r\n{% for entry, value in d.items() %}\r\n{%     if 'n' in value.a %}\r\n    Condition triggered\r\n{%     endif %}\r\n{% endfor %}\r\nEnd\r\n```\r\nAnd here's my test script with the template embedded in a python string:\r\n``` python\r\n#!/usr/bin/python3    \r\n    \r\nimport jinja2    \r\ndata = \"\"\"    \r\n{# Called with d = {'test': {}} #}\r\nStart\r\n{% for entry, value in d.items() %}\r\n{%     if 'n' in value.a %} \r\nCondition triggered\r\n{%     endif %}\r\n{% endfor %}\r\nEnd\r\n\"\"\"    \r\nt = jinja2.Template(data)    \r\nprint(t.render(d={'test': {}}))\r\n```\r\n\r\n#### Behaviour in 2.11\r\n```\r\n    \r\n\r\nStart\r\n\r\n\r\n\r\nEnd\r\n```\r\n\r\n#### Behaviour in 3.0\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/srv/ansible/jinja2-3.x-bug/test2.py\", line 15, in <module>\r\n    print(t.render(d={'test': {}}))\r\n  File \"/home/badger/.local/lib/python3.9/site-packages/jinja2/environment.py\", line 1304, in render\r\n    self.environment.handle_exception()\r\n  File \"/home/badger/.local/lib/python3.9/site-packages/jinja2/environment.py\", line 925, in handle_exception\r\n    raise rewrite_traceback_stack(source=source)\r\n  File \"<template>\", line 5, in top-level template code\r\njinja2.exceptions.UndefinedError: 'dict object' has no attribute 'a'\r\n```\r\n### Additional information\r\n\r\nI have done a little bit of experimentation and the change is caused by https://github.com/pallets/jinja/pull/1204/ (If I remove that change from a jinja2-3.0.1 install, it reverts to the 2.11.x behaviour).  However, since my template does not traceback with a TypeError in 2.11.x (which is the bug being fixed by that PR: https://github.com/pallets/jinja/issues/1198  ), I'm unsure if the new behaviour is desired or not.\r\n\r\nPersonally, I feel the new behaviour is more intuitive and want to point it out to people as a reason they should normalize their data before passing it off to be rendered but I just wanted to make sure it was an intended change before I open my big mouth ;-)\r\n\r\n\r\nEnvironment:\r\n\r\n- Python version: Tested in both 3.9 and 3.8\r\n- Jinja version: 2.11.2 versus 3.0.1\r\n\r\n","closed_by":{"login":"davidism","id":1242887,"node_id":"MDQ6VXNlcjEyNDI4ODc=","avatar_url":"https://avatars.githubusercontent.com/u/1242887?v=4","gravatar_id":"","url":"https://api.github.com/users/davidism","html_url":"https://github.com/davidism","followers_url":"https://api.github.com/users/davidism/followers","following_url":"https://api.github.com/users/davidism/following{/other_user}","gists_url":"https://api.github.com/users/davidism/gists{/gist_id}","starred_url":"https://api.github.com/users/davidism/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidism/subscriptions","organizations_url":"https://api.github.com/users/davidism/orgs","repos_url":"https://api.github.com/users/davidism/repos","events_url":"https://api.github.com/users/davidism/events{/privacy}","received_events_url":"https://api.github.com/users/davidism/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pallets/jinja/issues/1448/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pallets/jinja/issues/1448/timeline","performed_via_github_app":null,"state_reason":"completed"}