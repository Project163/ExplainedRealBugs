{"url":"https://api.github.com/repos/pallets/jinja/issues/654","repository_url":"https://api.github.com/repos/pallets/jinja","labels_url":"https://api.github.com/repos/pallets/jinja/issues/654/labels{/name}","comments_url":"https://api.github.com/repos/pallets/jinja/issues/654/comments","events_url":"https://api.github.com/repos/pallets/jinja/issues/654/events","html_url":"https://github.com/pallets/jinja/issues/654","id":199912921,"node_id":"MDU6SXNzdWUxOTk5MTI5MjE=","number":654,"title":"groupby filter returns _GroupTuple instead of tuple","user":{"login":"major","id":89910,"node_id":"MDQ6VXNlcjg5OTEw","avatar_url":"https://avatars.githubusercontent.com/u/89910?v=4","gravatar_id":"","url":"https://api.github.com/users/major","html_url":"https://github.com/major","followers_url":"https://api.github.com/users/major/followers","following_url":"https://api.github.com/users/major/following{/other_user}","gists_url":"https://api.github.com/users/major/gists{/gist_id}","starred_url":"https://api.github.com/users/major/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/major/subscriptions","organizations_url":"https://api.github.com/users/major/orgs","repos_url":"https://api.github.com/users/major/repos","events_url":"https://api.github.com/users/major/events{/privacy}","received_events_url":"https://api.github.com/users/major/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2017-01-10T19:33:49Z","updated_at":"2020-11-13T21:11:28Z","closed_at":"2017-01-12T14:53:45Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Expected Behavior\r\nIn jinja < 2.9, the groupby filter returns its data as a tuple.\r\n\r\n## Actual Behavior\r\nIn jinja >= 2.9, the groupby filter returns its data as a namedtuple.\r\n\r\n## Template Code\r\nHere's what I'm using along with Ansible right now:\r\n```yaml\r\n---\r\n\r\n- hosts: all\r\n  vars:\r\n    fruits:\r\n      - name: apple\r\n        enjoy: yes\r\n      - name: orange\r\n        enjoy: no\r\n      - name: strawberry\r\n        enjoy: yes\r\n  tasks:\r\n\r\n    - name: Loop through my fruits\r\n      debug:\r\n        msg: |\r\n          {% set fruit_list = [] %}\r\n          {% for fruit_dict in item[1] %}\r\n          {{ fruit_dict.name }}\r\n          {% endfor %}\r\n      with_items:\r\n        - \"{{ fruits | groupby('enjoy') }}\"\r\n```\r\n\r\nIn jinja 2.8, the result of the groupby() is a tuple and Ansible is able to parse it with python's AST module without an issue. In jinja 2.9 and later, the groupby() returns a namedtuple and this cannot be parsed with AST. This causes an exception in Ansible.\r\n\r\nThis may not be considered a bug within jinja, but this change is fairly disruptive for downstream users.\r\n\r\nAnsible bug: ansible/ansible#20098\r\n\r\n## Your Environment\r\n* Python version: 2.7.12\r\n* Jinja version: 2.9.4\r\n","closed_by":{"login":"mitsuhiko","id":7396,"node_id":"MDQ6VXNlcjczOTY=","avatar_url":"https://avatars.githubusercontent.com/u/7396?v=4","gravatar_id":"","url":"https://api.github.com/users/mitsuhiko","html_url":"https://github.com/mitsuhiko","followers_url":"https://api.github.com/users/mitsuhiko/followers","following_url":"https://api.github.com/users/mitsuhiko/following{/other_user}","gists_url":"https://api.github.com/users/mitsuhiko/gists{/gist_id}","starred_url":"https://api.github.com/users/mitsuhiko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitsuhiko/subscriptions","organizations_url":"https://api.github.com/users/mitsuhiko/orgs","repos_url":"https://api.github.com/users/mitsuhiko/repos","events_url":"https://api.github.com/users/mitsuhiko/events{/privacy}","received_events_url":"https://api.github.com/users/mitsuhiko/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pallets/jinja/issues/654/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pallets/jinja/issues/654/timeline","performed_via_github_app":null,"state_reason":"completed"}