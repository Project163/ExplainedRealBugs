diff --git a/jinja2/compiler.py b/jinja2/compiler.py
index 59d770f5..02df8c52 100644
--- a/jinja2/compiler.py
+++ b/jinja2/compiler.py
@@ -1066,6 +1066,7 @@ class CodeGenerator(NodeVisitor):
         # make sure the loop variable is a special one and raise a template
         # assertion error if a loop tries to write to loop
         if extended_loop:
+            self.writeline('l_loop = missing')
             loop_frame.identifiers.add_special('loop')
         for name in node.find_all(nodes.Name):
             if name.ctx == 'store' and name.name == 'loop':
diff --git a/jinja2/testsuite/regression.py b/jinja2/testsuite/regression.py
index 4198259f..a4e66311 100644
--- a/jinja2/testsuite/regression.py
+++ b/jinja2/testsuite/regression.py
@@ -237,6 +237,16 @@ class BugTestCase(JinjaTestCase):
         {% endfor %}
         """)
 
+    def test_else_loop_bug(self):
+        t = Template('''
+            {% for x in y %}
+                {{ loop.index0 }}
+            {% else %}
+                {% for i in range(3) %}{{ i }}{% endfor %}
+            {% endfor %}
+        ''')
+        self.assertEqual(t.render(y=[]).strip(), '012')
+
     def test_correct_prefix_loader_name(self):
         env = Environment(loader=PrefixLoader({
             'foo':  DictLoader({})
