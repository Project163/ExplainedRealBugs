{"url":"https://api.github.com/repos/go-chi/chi/issues/314","repository_url":"https://api.github.com/repos/go-chi/chi","labels_url":"https://api.github.com/repos/go-chi/chi/issues/314/labels{/name}","comments_url":"https://api.github.com/repos/go-chi/chi/issues/314/comments","events_url":"https://api.github.com/repos/go-chi/chi/issues/314/events","html_url":"https://github.com/go-chi/chi/issues/314","id":316380215,"node_id":"MDU6SXNzdWUzMTYzODAyMTU=","number":314,"title":"Panic/nil pointer dereference in example.","user":{"login":"freb","id":1723508,"node_id":"MDQ6VXNlcjE3MjM1MDg=","avatar_url":"https://avatars.githubusercontent.com/u/1723508?v=4","gravatar_id":"","url":"https://api.github.com/users/freb","html_url":"https://github.com/freb","followers_url":"https://api.github.com/users/freb/followers","following_url":"https://api.github.com/users/freb/following{/other_user}","gists_url":"https://api.github.com/users/freb/gists{/gist_id}","starred_url":"https://api.github.com/users/freb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/freb/subscriptions","organizations_url":"https://api.github.com/users/freb/orgs","repos_url":"https://api.github.com/users/freb/repos","events_url":"https://api.github.com/users/freb/events{/privacy}","received_events_url":"https://api.github.com/users/freb/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-04-20T19:11:30Z","updated_at":"2018-07-10T13:45:14Z","closed_at":"2018-07-10T13:45:14Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I've been following the patterns demonstrated in the rest example and I just discovered that you can cause a panic with a `POST` request to `/articles`.\r\n\r\n`*Article` is embedded in `ArticleRequest`([here](https://github.com/go-chi/chi/blob/master/_examples/rest/main.go#L323)), and the `Bind` method checks a field on `*Article` [here](https://github.com/go-chi/chi/blob/master/_examples/rest/main.go#L333). In my testing, it seems that unmarshalling JSON leaves nested pointers as nil unless there are fields in the JSON requiring the embedded object to be created and populated. If you issue a `POST` to `/articles` where the JSON body isn't empty (which would cause an EOF error), but also doesn't contain any fields that would get unmarshalled to the embedded `*Article`, then you will get a panic when the `Bind` method tries to access `Article.Title`.\r\n\r\nMy question is, what do you typically do about this, if anything. The are a few approaches:\r\n\r\n1. Don't add any extra code and rely on `Recoverer` middleware\r\n2. Enforce the practice of checking inside `Bind` if any embeds are nil and either return an error (something like \"missing required fields\") or update the reference to a zero-valued reference so that it is no longer nil (in the case where no fields are required, but you still want the embedded type to be non-nil for other checks and future referencing)\r\n3. Ensure what you are passing into ` render.Bind` contains no nil pointers, e.g. `&ArticleRequest{Article: &Article{}, User: &UserPayload{}}` (I don't like this method).\r\n\r\nIf approach `2` is common or there is another approach which is standard/best practice, I'm happy to update the rest example.","closed_by":{"login":"pkieltyka","id":18831,"node_id":"MDQ6VXNlcjE4ODMx","avatar_url":"https://avatars.githubusercontent.com/u/18831?v=4","gravatar_id":"","url":"https://api.github.com/users/pkieltyka","html_url":"https://github.com/pkieltyka","followers_url":"https://api.github.com/users/pkieltyka/followers","following_url":"https://api.github.com/users/pkieltyka/following{/other_user}","gists_url":"https://api.github.com/users/pkieltyka/gists{/gist_id}","starred_url":"https://api.github.com/users/pkieltyka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pkieltyka/subscriptions","organizations_url":"https://api.github.com/users/pkieltyka/orgs","repos_url":"https://api.github.com/users/pkieltyka/repos","events_url":"https://api.github.com/users/pkieltyka/events{/privacy}","received_events_url":"https://api.github.com/users/pkieltyka/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/go-chi/chi/issues/314/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/go-chi/chi/issues/314/timeline","performed_via_github_app":null,"state_reason":"completed"}