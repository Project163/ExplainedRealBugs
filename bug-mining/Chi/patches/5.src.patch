diff --git a/.travis.yml b/.travis.yml
index 3d6c1b1..5d56a81 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -1,7 +1,7 @@
 language: go
 
 go:
-  - 1.7.3
+  - 1.7.4
   - tip
 
 install:
diff --git a/middleware/closenotify.go b/middleware/closenotify.go
index 4f27a2c..d374705 100644
--- a/middleware/closenotify.go
+++ b/middleware/closenotify.go
@@ -1,9 +1,8 @@
+// +build go1.8
+
 package middleware
 
-import (
-	"context"
-	"net/http"
-)
+import "net/http"
 
 // StatusClientClosedRequest represents a 499 Client Closed Request (Nginx) HTTP status.
 // See: https://en.wikipedia.org/wiki/List_of_HTTP_status_codes
@@ -20,21 +19,14 @@ func CloseNotify(next http.Handler) http.Handler {
 		}
 		closeNotifyCh := cn.CloseNotify()
 
-		ctx, cancel := context.WithCancel(r.Context())
-		defer cancel()
-
 		go func() {
 			select {
-			case <-ctx.Done():
-				return
 			case <-closeNotifyCh:
-				cancel()
 				w.WriteHeader(StatusClientClosedRequest)
 				return
 			}
 		}()
 
-		r = r.WithContext(ctx)
 		next.ServeHTTP(w, r)
 	}
 
diff --git a/middleware/closenotify_17.go b/middleware/closenotify_17.go
new file mode 100644
index 0000000..a772f4f
--- /dev/null
+++ b/middleware/closenotify_17.go
@@ -0,0 +1,43 @@
+// +build go1.7,!go1.8
+
+package middleware
+
+import (
+	"context"
+	"net/http"
+)
+
+// StatusClientClosedRequest represents a 499 Client Closed Request (Nginx) HTTP status.
+// See: https://en.wikipedia.org/wiki/List_of_HTTP_status_codes
+const StatusClientClosedRequest = 499
+
+// CloseNotify is a middleware that cancels ctx when the underlying
+// connection has gone away. It can be used to cancel long operations
+// on the server when the client disconnects before the response is ready.
+func CloseNotify(next http.Handler) http.Handler {
+	fn := func(w http.ResponseWriter, r *http.Request) {
+		cn, ok := w.(http.CloseNotifier)
+		if !ok {
+			panic("chi/middleware: CloseNotify expects http.ResponseWriter to implement http.CloseNotifier interface")
+		}
+		closeNotifyCh := cn.CloseNotify()
+
+		ctx, cancel := context.WithCancel(r.Context())
+		defer cancel()
+
+		go func() {
+			select {
+			case <-ctx.Done():
+				return
+			case <-closeNotifyCh:
+				cancel()
+				return
+			}
+		}()
+
+		r = r.WithContext(ctx)
+		next.ServeHTTP(w, r)
+	}
+
+	return http.HandlerFunc(fn)
+}
diff --git a/middleware/closenotify_test.go b/middleware/closenotify_test.go
deleted file mode 100644
index d03aac4..0000000
--- a/middleware/closenotify_test.go
+++ /dev/null
@@ -1,44 +0,0 @@
-package middleware
-
-import (
-	"io/ioutil"
-	"net/http"
-	"net/http/httptest"
-	"sync"
-	"testing"
-
-	"github.com/pressly/chi"
-)
-
-func TestCloseNotify(t *testing.T) {
-	testContent := []byte("hi")
-
-	r := chi.NewRouter()
-	r.Use(CloseNotify)
-	r.Get("/", func(w http.ResponseWriter, r *http.Request) {
-		w.Write(testContent)
-	})
-
-	server := httptest.NewServer(r)
-
-	var wg sync.WaitGroup
-
-	for i := 0; i < 50; i++ {
-		wg.Add(1)
-		go func(i int) {
-			defer wg.Done()
-
-			res, err := http.Get(server.URL)
-			assertNoError(t, err)
-
-			assertEqual(t, http.StatusOK, res.StatusCode)
-			buf, err := ioutil.ReadAll(res.Body)
-			assertNoError(t, err)
-			assertEqual(t, testContent, buf)
-		}(i)
-	}
-
-	wg.Wait()
-
-	server.Close()
-}
diff --git a/middleware/throttler_test.go b/middleware/throttler_test.go
index 5593dd5..0bbd7ca 100644
--- a/middleware/throttler_test.go
+++ b/middleware/throttler_test.go
@@ -26,6 +26,7 @@ func TestThrottleBacklog(t *testing.T) {
 	})
 
 	server := httptest.NewServer(r)
+	defer server.Close()
 
 	client := http.Client{
 		Timeout: time.Second * 5, // Maximum waiting time.
@@ -52,8 +53,6 @@ func TestThrottleBacklog(t *testing.T) {
 	}
 
 	wg.Wait()
-
-	server.Close()
 }
 
 func TestThrottleClientTimeout(t *testing.T) {
@@ -68,6 +67,7 @@ func TestThrottleClientTimeout(t *testing.T) {
 	})
 
 	server := httptest.NewServer(r)
+	defer server.Close()
 
 	client := http.Client{
 		Timeout: time.Second * 3, // Maximum waiting time.
@@ -85,8 +85,6 @@ func TestThrottleClientTimeout(t *testing.T) {
 	}
 
 	wg.Wait()
-
-	server.Close()
 }
 
 func TestThrottleTriggerGatewayTimeout(t *testing.T) {
@@ -101,6 +99,7 @@ func TestThrottleTriggerGatewayTimeout(t *testing.T) {
 	})
 
 	server := httptest.NewServer(r)
+	defer server.Close()
 
 	client := http.Client{
 		Timeout: time.Second * 60, // Maximum waiting time.
@@ -142,8 +141,6 @@ func TestThrottleTriggerGatewayTimeout(t *testing.T) {
 	}
 
 	wg.Wait()
-
-	server.Close()
 }
 
 func TestThrottleMaximum(t *testing.T) {
@@ -158,6 +155,7 @@ func TestThrottleMaximum(t *testing.T) {
 	})
 
 	server := httptest.NewServer(r)
+	defer server.Close()
 
 	client := http.Client{
 		Timeout: time.Second * 60, // Maximum waiting time.
@@ -203,6 +201,4 @@ func TestThrottleMaximum(t *testing.T) {
 	}
 
 	wg.Wait()
-
-	server.Close()
 }
