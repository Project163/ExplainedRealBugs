{"url":"https://api.github.com/repos/less/less.js/issues/2089","repository_url":"https://api.github.com/repos/less/less.js","labels_url":"https://api.github.com/repos/less/less.js/issues/2089/labels{/name}","comments_url":"https://api.github.com/repos/less/less.js/issues/2089/comments","events_url":"https://api.github.com/repos/less/less.js/issues/2089/events","html_url":"https://github.com/less/less.js/issues/2089","id":37040992,"node_id":"MDU6SXNzdWUzNzA0MDk5Mg==","number":2089,"title":"Import breaks when file structure nested 3 deep or more if using relativeUrls flag","user":{"login":"robertinglin","id":184690,"node_id":"MDQ6VXNlcjE4NDY5MA==","avatar_url":"https://avatars.githubusercontent.com/u/184690?v=4","gravatar_id":"","url":"https://api.github.com/users/robertinglin","html_url":"https://github.com/robertinglin","followers_url":"https://api.github.com/users/robertinglin/followers","following_url":"https://api.github.com/users/robertinglin/following{/other_user}","gists_url":"https://api.github.com/users/robertinglin/gists{/gist_id}","starred_url":"https://api.github.com/users/robertinglin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robertinglin/subscriptions","organizations_url":"https://api.github.com/users/robertinglin/orgs","repos_url":"https://api.github.com/users/robertinglin/repos","events_url":"https://api.github.com/users/robertinglin/events{/privacy}","received_events_url":"https://api.github.com/users/robertinglin/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2103265,"node_id":"MDU6TGFiZWwyMTAzMjY1","url":"https://api.github.com/repos/less/less.js/labels/bug","name":"bug","color":"e10c02","default":true,"description":null},{"id":9603654,"node_id":"MDU6TGFiZWw5NjAzNjU0","url":"https://api.github.com/repos/less/less.js/labels/medium%20priority","name":"medium priority","color":"0000E0","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2014-07-03T02:01:54Z","updated_at":"2014-09-07T13:41:18Z","closed_at":"2014-09-07T13:41:18Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Here's the directory structure:\n\n```\n├── alpha.less\n├── folder-1\n    ├── beta.less\n    ├── folder-2\n        ├── gamma.less\n        ├── fail.less\n```\n\nHere what each file imports:\nalpha.less\n@import url(\"folder-1/beta.less\");\n\nfolder-1/beta.less\n@import url(\"folder-2/gamma.less\");\n\nfolder-1/folder-2/gamma.less\n\n@import url(\"fail.less\");\n\nThe error happens when trying to import fail.less when the relativeUrls flag is true. This happens because tree.URL.js always converts relative urls and when the relativeUrls flag is active the importer also converts the url causing the importer to look for \"fail.less\" in \"folder-1/folder-1/folder-2\" instead of \"folder-1/folder-2\".\n\nI was able to fix it by passing in a flag to tree.URL when using a relative url and stopping it from converting the imported relative url. Css urls still need to be parsed through tree.URL.\n\nHere's the lines that I added.\n\nparser.js @entity:911\n\n```\nurl: function (imported) {\n```\n\nparser.js @entity:924\n\n```\n? value : new(tree.Anonymous)(value), env.currentFileInfo, imported);\n```\n\nparser.js @entity:1333\n\n```\n... this.entities.url(false) ...\n```\n\nparser.js @\"import\":1627\n\n```\n... this.entities.url(true) ...\n```\n\ntree/url.js @eval:3\n\n```\ntree.URL = function (val, currentFileInfo, isImported, isEvald) {\n    this.value = val;\n    this.currentFileInfo = currentFileInfo;\n    this.isImported = isImported\n```\n\ntree/url.js @eval:26\n\n```\nif ((!this.currentFileInfo.relativeUrls || !this.isImported)\n                    && rootpath && typeof val.value === \"string\" && ctx.isPathRelative(val.value)) {\n```\n\ntree/url.js @eval:51\n\n```\nreturn new(tree.URL)(val, this.currentFileInfo, this.isImported, true);\n```\n\nEDIT: Changed it to not use currentFileInfo.\n","closed_by":{"login":"lukeapage","id":309321,"node_id":"MDQ6VXNlcjMwOTMyMQ==","avatar_url":"https://avatars.githubusercontent.com/u/309321?v=4","gravatar_id":"","url":"https://api.github.com/users/lukeapage","html_url":"https://github.com/lukeapage","followers_url":"https://api.github.com/users/lukeapage/followers","following_url":"https://api.github.com/users/lukeapage/following{/other_user}","gists_url":"https://api.github.com/users/lukeapage/gists{/gist_id}","starred_url":"https://api.github.com/users/lukeapage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukeapage/subscriptions","organizations_url":"https://api.github.com/users/lukeapage/orgs","repos_url":"https://api.github.com/users/lukeapage/repos","events_url":"https://api.github.com/users/lukeapage/events{/privacy}","received_events_url":"https://api.github.com/users/lukeapage/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/less/less.js/issues/2089/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/less/less.js/issues/2089/timeline","performed_via_github_app":null,"state_reason":"completed"}