diff --git a/lib/less/tree/media.js b/lib/less/tree/media.js
index 4531cf4c..095e43e8 100644
--- a/lib/less/tree/media.js
+++ b/lib/less/tree/media.js
@@ -74,6 +74,7 @@ tree.Media.prototype = {
     },
     markReferenced: function () {
         var i, rules = this.rules[0].rules;
+        this.rules[0].markReferenced();
         this.isReferenced = true;
         for (i = 0; i < rules.length; i++) {
             if (rules[i].markReferenced) {
diff --git a/test/css/import-reference.css b/test/css/import-reference.css
index d61df816..f25f4b1d 100644
--- a/test/css/import-reference.css
+++ b/test/css/import-reference.css
@@ -1,7 +1,17 @@
-/*
-  The media statement above is invalid (no selector)
-  We should ban invalid media queries with properties and no selector?
-*/
+input[type="text"].class#id[attr=32]:not(1) {
+  color: white;
+}
+div#id.class[a=1][b=2].class:not(1) {
+  color: white;
+}
+@media print {
+  .class {
+    color: blue;
+  }
+  .class .sub {
+    width: 42;
+  }
+}
 .visible {
   color: red;
 }
@@ -47,3 +57,12 @@
 .visible {
   extend: test;
 }
+.test-mediaq-import {
+  color: green;
+  test: 340px;
+}
+@media (max-size: 450px) {
+  .test-mediaq-import {
+    color: red;
+  }
+}
diff --git a/test/less/import-reference.less b/test/less/import-reference.less
index cf9da168..93160ab5 100644
--- a/test/less/import-reference.less
+++ b/test/less/import-reference.less
@@ -1,10 +1,6 @@
 @import (reference) url("import-once.less");
 @import (reference) url("css-3.less");
 @import (reference) url("media.less");
-/*
-  The media statement above is invalid (no selector)
-  We should ban invalid media queries with properties and no selector?
-*/
 @import (reference) url("import/import-reference.less");
 
 .b {
@@ -15,4 +11,11 @@
 
 .visible:extend(.z all) {
   extend: test;
+}
+
+.test-mediaq-import {
+  .mixin-with-mediaq(340px);
+}
+
+.class:extend(.class all) {
 }
\ No newline at end of file
diff --git a/test/less/import/import-reference.less b/test/less/import/import-reference.less
index 9eac45fc..c77f692e 100644
--- a/test/less/import/import-reference.less
+++ b/test/less/import/import-reference.less
@@ -40,4 +40,12 @@
     pulled-in: yes;
   }
   /* comment pulled in */
+}
+@max-size: 450px;
+.mixin-with-mediaq(@num) {
+  color: green;
+  test: @num;
+  @media (max-size: @max-size) {
+    color: red;
+  }
 }
\ No newline at end of file
