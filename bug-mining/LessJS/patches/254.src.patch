diff --git a/packages/less/Gruntfile.js b/packages/less/Gruntfile.js
index 829d25d9..6aea4158 100644
--- a/packages/less/Gruntfile.js
+++ b/packages/less/Gruntfile.js
@@ -261,6 +261,7 @@ module.exports = function(grunt) {
                     `node bin/lessc --clean-css="--s1 --advanced" ${lessFolder}/_main/lazy-eval.less tmp/lazy-eval.css`,
                     "cd lib",
                     `node ../bin/lessc --clean-css="--s1 --advanced" ../${lessFolder}/_main/lazy-eval.less ../tmp/lazy-eval.css`,
+                    `node ../bin/lessc --source-map=lazy-eval.css.map --autoprefix ../${lessFolder}/_main/lazy-eval.less ../tmp/lazy-eval.css`,
                     "cd ..",
                     // Test multiple plugins
                     `node bin/lessc --plugin=clean-css="--s1 --advanced" --plugin=autoprefix="ie 11,Edge >= 13,Chrome >= 47,Firefox >= 45,iOS >= 9.2,Safari >= 9" ${lessFolder}/_main/lazy-eval.less tmp/lazy-eval.css`
diff --git a/packages/less/bin/lessc b/packages/less/bin/lessc
index 6037df5e..2a7427a1 100755
--- a/packages/less/bin/lessc
+++ b/packages/less/bin/lessc
@@ -180,6 +180,9 @@ function render() {
       var filename = sourceMapOptions.sourceMapFullFilename;
       ensureDirectory(filename);
 
+      //To fix https://github.com/less/less.js/issues/3646
+      output=output.toString();
+      
       fs.writeFile(filename, output, 'utf8', function (err) {
         if (err) {
           var description = 'Error: ';
