diff --git a/packages/less/src/less/visitors/to-css-visitor.js b/packages/less/src/less/visitors/to-css-visitor.js
index d49987ea..6654f8a8 100644
--- a/packages/less/src/less/visitors/to-css-visitor.js
+++ b/packages/less/src/less/visitors/to-css-visitor.js
@@ -39,9 +39,9 @@ class CSSVisitorUtils {
             ? (rulesetNode.paths.length > 0) : false;
     }
 
-    resolveVisibility(node, originalRules) {
+    resolveVisibility(node) {
         if (!node.blocksVisibility()) {
-            if (this.isEmpty(node) && !this.containsSilentNonBlockedChild(originalRules)) {
+            if (this.isEmpty(node)) {
                 return ;
             }
 
diff --git a/packages/test-data/css/_main/css-3.css b/packages/test-data/css/_main/css-3.css
index 95725b87..d1316def 100644
--- a/packages/test-data/css/_main/css-3.css
+++ b/packages/test-data/css/_main/css-3.css
@@ -136,8 +136,6 @@ body > .shadow {
   symbols: â€£;
   suffix: " ";
 }
-@-ms-viewport {
-}
 @unknown foo 42 (bar) {
   x {
     y: z;
diff --git a/packages/test-data/less/_main/import-reference-issues.less b/packages/test-data/less/_main/import-reference-issues.less
index f35e90fe..63ecc30a 100644
--- a/packages/test-data/less/_main/import-reference-issues.less
+++ b/packages/test-data/less/_main/import-reference-issues.less
@@ -5,6 +5,7 @@
 // * #2716 - A file imported by reference and then normally - multiple imports should be independent
 // * #1968 - When using an @import (reference), mixins that contain an & selector get added to the compiled output improperly
 // * #2162 - Cannot put import by reference inside of a mixin (also doubles #1896)
+// * #2991 - Empty @media queries generated through line comments when compiling less file with (reference)
 
 // #1878: extend inside referenced file should not extend outside selectors
 @import (reference) "import-reference-issues/global-scope-import.less";
@@ -48,3 +49,5 @@ show-all-content {
 call-mixin-with-import-by-reference-inside {
   .mixin-with-import-by-reference-inside();
 }
+
+@import (reference) "import-reference-issues/comments-2991.less";
\ No newline at end of file
diff --git a/packages/test-data/less/_main/import-reference-issues/comments-2991.less b/packages/test-data/less/_main/import-reference-issues/comments-2991.less
new file mode 100644
index 00000000..da15b244
--- /dev/null
+++ b/packages/test-data/less/_main/import-reference-issues/comments-2991.less
@@ -0,0 +1,25 @@
+.referenced {
+	// This file should not output anything if referenced.
+    @media (hover) {
+        // This file should not output anything if referenced.
+    }
+	// This file should not output anything if referenced.
+    @media (hover) {
+		// This file should not output anything if referenced.
+    }
+	// This file should not output anything if referenced.
+    @media (hover) {
+        /* This file should not output anything if referenced. */
+    }
+	// This file should not output anything if referenced.
+    @media (hover) {
+        color: #000000;
+    }
+}
+// This file should not output anything if referenced.
+@media (hover) {
+	// This file should not output anything if referenced.
+}
+@media (hover) {
+	/* This file should not output anything if referenced. */
+}
