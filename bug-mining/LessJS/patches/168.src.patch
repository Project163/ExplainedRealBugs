diff --git a/bin/lessc b/bin/lessc
index fe963d72..6cf6cf7e 100755
--- a/bin/lessc
+++ b/bin/lessc
@@ -353,24 +353,6 @@ var parseLessFile = function (e, data) {
     options.paths = [path.dirname(input)].concat(options.paths);
     options.filename = input;
 
-    if (options.depends) {
-        var parser = new(less.Parser)(options);
-        parser.parse(data, function (err, tree) {
-            if (err) {
-                less.writeError(err, options);
-                currentErrorcode = 1;
-                return;
-            }
-            for(var file in parser.imports.files) {
-                if (parser.imports.files.hasOwnProperty(file)) {
-                    process.stdout.write(file + " ");
-                }
-            }
-            console.log("");
-        });
-        return;
-    }
-
     if (options.lint) {
         options.sourceMap = false;
     }
@@ -403,12 +385,19 @@ var parseLessFile = function (e, data) {
                     ensureDirectory(output);
                     fs.writeFileSync(output, result.css, 'utf8');
                     less.logger.info('lessc: wrote ' + output);
-                } else {
+                } else if (!options.depends) {
                     process.stdout.write(result.css);
                 }
                 if (options.sourceMap && !sourceMapFileInline) {
                     writeSourceMap(result.map);
                 }
+                if (options.depends) {
+                    var depends = "";
+                    for(var i = 0; i < result.imports.length; i++) {
+                        depends += result.imports[i] + " ";
+                    }
+                    console.log(depends);
+                }
             }
         },
         function(err) {
diff --git a/lib/less/import-manager.js b/lib/less/import-manager.js
index 6188b1de..a370e59f 100644
--- a/lib/less/import-manager.js
+++ b/lib/less/import-manager.js
@@ -22,7 +22,7 @@ module.exports = function(environment) {
         this.context = context;
         // Deprecated? Unused outside of here, could be useful.
         this.queue = [];        // Files which haven't been imported yet
-        this.files = [];        // Holds the imported parse trees.
+        this.files = {};        // Holds the imported parse trees.
     };
     /**
      * Add an import to be imported
diff --git a/lib/less/parse-tree.js b/lib/less/parse-tree.js
index 6b64709d..143cf2e7 100644
--- a/lib/less/parse-tree.js
+++ b/lib/less/parse-tree.js
@@ -41,6 +41,13 @@ ParseTree.prototype.toCSS = function(options) {
     if (options.sourceMap) {
         result.map = sourceMapBuilder.getExternalSourceMap();
     }
+
+    result.imports = [];
+    for(var file in this.imports.files) {
+        if (this.imports.files.hasOwnProperty(file) && file !== this.imports.rootFilename) {
+            result.imports.push(file);
+        }
+    }
     return result;
 };
 return ParseTree;
