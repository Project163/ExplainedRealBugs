<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:32:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SCXML-211] Bug in current SCXML specification for addDescendantStatesToEnter algorithm can lead to illegal configurations</title>
                <link>https://issues.apache.org/jira/browse/SCXML-211</link>
                <project id="12310492" key="SCXML">Commons SCXML</project>
                    <description>&lt;p&gt;While testing the SCXML specification using the &lt;a href=&quot;http://www.w3.org/Voice/2013/scxml-irp/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;IRP Plan tests&lt;/a&gt; I discovered a bug in the current specification addDescendantStatesToEnter algorithm:  &lt;a href=&quot;http://www.w3.org/TR/2014/WD-scxml-20140529/#addDescendantStatesToEnter&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.w3.org/TR/2014/WD-scxml-20140529/#addDescendantStatesToEnter&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve already send a notice about this bug to the SCXML specification mailing list, see: &lt;a href=&quot;http://lists.w3.org/Archives/Public/www-voice/2014OctDec/0000.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://lists.w3.org/Archives/Public/www-voice/2014OctDec/0000.html&lt;/a&gt;&lt;br/&gt;
which I&apos;m copying verbatim below:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Hi there,&lt;/p&gt;

&lt;p&gt;I think I detected a bug in the addDescendantStatesToEnter algorithm in the specification concerning &lt;b&gt;when&lt;/b&gt; to invoke the addAncestorsStatesToEnter.&lt;/p&gt;

&lt;p&gt;Currently the algorithm defines the following logic for a compound state, after having added it to the statesForDefaultEntry:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;     for s in getEffectiveTargetStates(state.initial.transition):
         addDescendantStatesToEnter(s,statesToEnter,statesForDefaultEntry, defaultHistoryContent)
         addAncestorStatesToEnter(s, state, statesToEnter, statesForDefaultEntry, defaultHistoryContent)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If not first for all effective target states addDescendantStatesToEnter is  executed, the addAncestorStatesToEnter might,&lt;br/&gt;
when in involves an ancestor parallel with nested compound states of which one also happens to be one of the effective&lt;br/&gt;
desendant target &lt;b&gt;but not yet resolved&lt;/b&gt;, end up initializing a different (default) sibling child of such a compound state.&lt;br/&gt;
End result: an invalid configuration with a compound state having multiple active child states.&lt;/p&gt;

&lt;p&gt;I detected this issue when testing &lt;a href=&quot;http://www.w3.org/Voice/2013/scxml-irp/364/test364.txml&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;irp test364&lt;/a&gt;, which indeed defines such a SCXML document.&lt;br/&gt;
If the algorithm is implemented as currently defined in the specification, you&apos;ll end up with both s11p121 and s11p122&lt;br/&gt;
being on the statesToEnter set (or s11p111 and s11p112, depending on the processing order of the s1 initial targets).&lt;/p&gt;

&lt;p&gt;In Apache Commons SCXML I&apos;ve implemented a legal configuration check before executing enterStates, and that fails on&lt;br/&gt;
this point for irp test364.&lt;/p&gt;

&lt;p&gt;Maybe important to note is that if I disable the check, the test actually passes, so maybe others might have this same&lt;br/&gt;
bug but going unnoticed?&lt;/p&gt;

&lt;p&gt;Solving this bug however should be pretty trivial.&lt;br/&gt;
To ensure explicit descendant target states are recorded first, I just changed the above logic to:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;     for s in getEffectiveTargetStates(state.initial.transition):
         addDescendantStatesToEnter(s,statesToEnter,statesForDefaultEntry, defaultHistoryContent)
     for s in getEffectiveTargetStates(state.initial.transition):
         addAncestorStatesToEnter(s, state, statesToEnter, statesForDefaultEntry, defaultHistoryContent)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And I did the same for the two similar/same for loops in the handling for history states in addDescendantStatesToEnter&lt;br/&gt;
where likewise both descendant and ancestors states to enter are resolved within a single loop.&lt;/p&gt;

&lt;p&gt;Note: the description of addDescendantStatesToEnter actually does seem to say it more correctly where it breaks these&lt;br/&gt;
two separate &apos;steps&apos; down in two separate sentences:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;     Then if state is a compound state, add state to statesForDefaultEntry and recursively call addStatesToEnter on its
     default initial state(s).

     Then, since the default initial states may not be children of &apos;state&apos;, add any ancestors between the default
     initial states and &apos;state&apos;.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above description at least gives the right direction how this should be implemented, namely as separate consecutive steps,&lt;br/&gt;
but not &apos;optimized&apos; into a single loop as currently done.&lt;br/&gt;
Confusingly and incorrectly though this description names the &quot;addDescendantStatesToEnter&quot; routine &quot;addStatesToEnter&quot;.&lt;br/&gt;
It probably would be good to correct that as well.&lt;/p&gt;

&lt;p&gt;Kind regards,&lt;/p&gt;

&lt;p&gt;Ate Douma&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="12747496">SCXML-211</key>
            <summary>Bug in current SCXML specification for addDescendantStatesToEnter algorithm can lead to illegal configurations</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ate">Ate Douma</assignee>
                                    <reporter username="ate">Ate Douma</reporter>
                        <labels>
                    </labels>
                <created>Sat, 11 Oct 2014 10:54:39 +0000</created>
                <updated>Sat, 11 Oct 2014 11:10:09 +0000</updated>
                            <resolved>Sat, 11 Oct 2014 11:08:19 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14168094" author="adouma" created="Sat, 11 Oct 2014 11:08:19 +0000"  >&lt;p&gt;Resolved as described above.&lt;br/&gt;
I will keep this issue non-closed until verification/confirmation from the SCXML specification group on my reported bug.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 6 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i212dr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>