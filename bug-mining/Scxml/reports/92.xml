<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:32:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SCXML-205] finalStep gets called twice</title>
                <link>https://issues.apache.org/jira/browse/SCXML-205</link>
                <project id="12310492" key="SCXML">Commons SCXML</project>
                    <description>&lt;p&gt;In the current trunk version, finalStep and hence all onexit actions of the final state are called twice. The following scxml can be used to reproduce the problem.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;scxml xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2005/07/scxml&quot;&lt;/span&gt; version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; initial=&lt;span class=&quot;code-quote&quot;&gt;&quot;Start&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;PublishEvent&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;final id=&lt;span class=&quot;code-quote&quot;&gt;&quot;Start&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;onentry&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;log expr=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-quote&quot;&gt;&apos;Entering state Start&apos;&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/log&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/onentry&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;onexit&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;log expr=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-quote&quot;&gt;&apos;Leaving state Start&apos;&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/log&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/onexit&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/final&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/scxml&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The onexit log message appears twice when running this example.&lt;/p&gt;

&lt;p&gt;I digged a bit in the source code and through a debugger I could find the cause for this effect: The finalStep method of SCXMLSemanticsImpl gets called twice. One backtrace looks like this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SCXMLSemanticsImpl.finalStep(SCXMLExecutionContext) line: 215	
SCXMLSemanticsImpl.firstStep(SCXMLExecutionContext) line: 132	
SCXMLExecutor.reset() line: 331	
SCXMLExecutor.go() line: 318	
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the seconds looks like this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SCXMLSemanticsImpl.finalStep(SCXMLExecutionContext) line: 215	
SCXMLExecutor.reset() line: 334	
SCXMLExecutor.go() line: 318	
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I am not sure about what should be the correct behavior, but to my mind, the second call looks suspicious.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12737099">SCXML-205</key>
            <summary>finalStep gets called twice</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ate">Ate Douma</assignee>
                                    <reporter username="languitar">Johannes Wienke</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Aug 2014 13:06:05 +0000</created>
                <updated>Mon, 1 Sep 2014 21:18:43 +0000</updated>
                            <resolved>Mon, 1 Sep 2014 21:18:43 +0000</resolved>
                                    <version>2.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14112236" author="languitar" created="Wed, 27 Aug 2014 13:20:49 +0000"  >&lt;p&gt;Ok, If I completely remove the suspicious call in the reset method by deleting these lines:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!exctx.isRunning()) {
            semantics.finalStep(exctx);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;then still all tests pass perfectly.&lt;/p&gt;</comment>
                            <comment id="14112255" author="woon_san" created="Wed, 27 Aug 2014 13:50:49 +0000"  >&lt;p&gt;Looks like a regression since &lt;a href=&quot;https://issues.apache.org/jira/browse/SCXML-197&quot; title=&quot;Better separation of concern between SCXMLExecutor and SCInstance and introducing a new SCXMLExecutionContext&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SCXML-197&quot;&gt;&lt;del&gt;SCXML-197&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
I&apos;d like to ask Ate to look into this.&lt;br/&gt;
Thanks for reporting the problem!&lt;/p&gt;</comment>
                            <comment id="14117729" author="adouma" created="Mon, 1 Sep 2014 21:18:43 +0000"  >&lt;p&gt;Thanks Johannes for catching and reporting this!&lt;/p&gt;

&lt;p&gt;The SCXMLSemantics.finalStep() indeed is incorrectly invoked twice, and not just from SCXMLExecutor.reset() but also .eventStep().&lt;/p&gt;

&lt;p&gt;As Woonsan already indicated, this is an regression since &lt;a href=&quot;https://issues.apache.org/jira/browse/SCXML-197&quot; title=&quot;Better separation of concern between SCXMLExecutor and SCInstance and introducing a new SCXMLExecutionContext&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SCXML-197&quot;&gt;&lt;del&gt;SCXML-197&lt;/del&gt;&lt;/a&gt; where I moved the handling of the finalStep into the SCXMLSemantics.firstStep() and .nextStep() but forgot to remove them from SCXMLExecutor logic.&lt;/p&gt;

&lt;p&gt;I&apos;ve removed the old .finalStep() calls from SCXMLExecutor so it should now work again as expected.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 11 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ze4n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>