<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:32:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SCXML-239] Groovy Context lose sync after serialize/deserialize of SCinstance</title>
                <link>https://issues.apache.org/jira/browse/SCXML-239</link>
                <project id="12310492" key="SCXML">Commons SCXML</project>
                    <description>&lt;p&gt;Groovy Context lose sync after serialize/deserialize SC instance&lt;/p&gt;

&lt;p&gt;Steps to reproduce issue:&lt;br/&gt;
	1. detach SC instance&lt;br/&gt;
	2. serialize SC instance&lt;br/&gt;
	3. deserialize SC instance&lt;br/&gt;
	4. attach SC instance&lt;br/&gt;
Result:&lt;br/&gt;
	Groovy context loose sync, and afterwards In(&apos;state&apos;) condition is not working properly&lt;/p&gt;</description>
                <environment></environment>
        <key id="12901279">SCXML-239</key>
            <summary>Groovy Context lose sync after serialize/deserialize of SCinstance</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ate">Ate Douma</assignee>
                                    <reporter username="gkadnar">Goran Kadnar</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Sep 2015 11:02:47 +0000</created>
                <updated>Sat, 2 Jan 2016 22:26:16 +0000</updated>
                            <resolved>Sat, 2 Jan 2016 20:52:51 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14935016" author="gkadnar" created="Tue, 29 Sep 2015 11:24:44 +0000"  >&lt;p&gt;added test case and trace files&lt;/p&gt;</comment>
                            <comment id="15076654" author="adouma" created="Sat, 2 Jan 2016 20:20:52 +0000"  >&lt;p&gt;Thanks for reporting this!&lt;br/&gt;
Clearly a bug and it took me a while to figure out what goes wrong.&lt;/p&gt;

&lt;p&gt;The problem lies in the custom GroovyContext serialization handling, for which I added (&lt;a href=&quot;https://issues.apache.org/jira/browse/SCXML-186&quot; title=&quot;Groovy expression evaluator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SCXML-186&quot;&gt;&lt;del&gt;SCXML-186&lt;/del&gt;&lt;/a&gt;) overriding readObject and writeObject methods.&lt;br/&gt;
Within the readObject method, Groovy objects stored in the context variables their deserialization class name needs to be dynamically resolved.&lt;br/&gt;
For that purpose an extra extended ByteInputStream is used with an override for the resolveClass() method.&lt;br/&gt;
Long story short, while this technically is working correct, it goes wrong if the variables contain an object &lt;b&gt;also&lt;/b&gt; otherwise deserialized by the &apos;main&apos; ObjectInputStream, in which case this object will be deserialized &lt;b&gt;twice&lt;/b&gt; (separate instances) as these two ObjectInputStreams don&apos;t know about each other &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;br/&gt;
And this occurs with the SCInstance Status instance variable which also is referenced from the protected variables within the SCXMLSystemContext.&lt;br/&gt;
Hence, after SCInstance deserialization these two Statuses are no longer the same, causing the problem you detected.&lt;/p&gt;

&lt;p&gt;For now, I&apos;ll fix this &apos;quick and dirty&apos;, by no longer using an language specific Context (e.g. GroovyContext) for this protected SCXMLSystemContext internal context, nor the (default) root Context.&lt;br/&gt;
Those two contexts don&apos;t need to be, nor IMO should be, language specific anyway.&lt;br/&gt;
With these fixes the SCXMLSystemContext internal context will just use the default (de)serializing ObjectInputStream and thus no longer create two &apos;disconnected&apos; Status objects. &lt;/p&gt;

&lt;p&gt;However, this still leaves the door open for GroovyContext deserialization problems if/when its variables contain an object also otherwise referenced by SCInstance.&lt;/p&gt;

&lt;p&gt;I&apos;ve created &lt;a href=&quot;https://issues.apache.org/jira/browse/SCXML-247&quot; title=&quot;Provide dedicated SCInstanceObjectInputStream to support proper dynamic class resolution in GroovyContext&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SCXML-247&quot;&gt;&lt;del&gt;SCXML-247&lt;/del&gt;&lt;/a&gt; which will provide a more resilient solution. &lt;/p&gt;</comment>
                            <comment id="15076695" author="adouma" created="Sat, 2 Jan 2016 22:26:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SCXML-247&quot; title=&quot;Provide dedicated SCInstanceObjectInputStream to support proper dynamic class resolution in GroovyContext&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SCXML-247&quot;&gt;&lt;del&gt;SCXML-247&lt;/del&gt;&lt;/a&gt; has been implemented. You now must use dedicated SCInstanceObjectInputStream instead of plain ObjectInputStream for de-serializing SCInstances.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12925242">SCXML-247</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12764225" name="testNOK.trc" size="2056" author="gkadnar" created="Tue, 29 Sep 2015 11:24:44 +0000"/>
                            <attachment id="12764226" name="testOK.trc" size="2571" author="gkadnar" created="Tue, 29 Sep 2015 11:24:44 +0000"/>
                            <attachment id="12764227" name="test_case.7z" size="3716215" author="gkadnar" created="Tue, 29 Sep 2015 11:24:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 45 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mefr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>