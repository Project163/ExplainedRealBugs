<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:32:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SCXML-234] Unit test (ScriptTest) fails on Java 1.8 due to new JS Engine</title>
                <link>https://issues.apache.org/jira/browse/SCXML-234</link>
                <project id="12310492" key="SCXML">Commons SCXML</project>
                    <description>&lt;p&gt;One unit test fails:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Running org.apache.commons.scxml2.model.ScriptTest
Tests run: 2, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.226 sec &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.commons.scxml2.model.ScriptTest
testJavaScriptExecution(org.apache.commons.scxml2.model.ScriptTest)  Time elapsed: 0.218 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!
org.junit.ComparisonFailure: expected:&amp;lt;[end]&amp;gt; but was:&amp;lt;[script]&amp;gt;
	at org.junit.Assert.assertEquals(Assert.java:115)
	at org.junit.Assert.assertEquals(Assert.java:144)
	at org.apache.commons.scxml2.model.ScriptTest.testJavaScriptExecution(ScriptTest.java:49)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Tested on JDK 1.8.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12843178">SCXML-234</key>
            <summary>Unit test (ScriptTest) fails on Java 1.8 due to new JS Engine</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="woon_san">Woonsan Ko</assignee>
                                    <reporter username="woon_san">Woonsan Ko</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Jul 2015 13:09:55 +0000</created>
                <updated>Sun, 12 Jul 2015 15:13:41 +0000</updated>
                            <resolved>Sun, 12 Jul 2015 15:13:41 +0000</resolved>
                                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14619575" author="adouma" created="Wed, 8 Jul 2015 23:21:43 +0000"  >&lt;p&gt;I was aware this test fails on Java 8.&lt;br/&gt;
However right now SCXML (javascript support) is still assuming Java 6 (or 7) only, and thereby implemented assuming the outdated/limited Mozilla Rhino Javascript engine.   &lt;br/&gt;
As result, the current javascript support and implementation is quite incomplete, broken even, and non-compliant compared to the Jexl and Groovy scripting support.&lt;/p&gt;

&lt;p&gt;I actually we better switch to Java 8 as minimum and completely remove/replace the current implementation and re-implement based on the new and much better Java 8 nashorn Javascript engine instead.&lt;br/&gt;
I don&apos;t have the cycles to work on this right now, but I think this is the only path forward.&lt;br/&gt;
Fixing or trying to workaround the incompatibilities and limitations of the Java 6 Javascript engine is a dead-end.&lt;/p&gt;</comment>
                            <comment id="14623846" author="woon_san" created="Sun, 12 Jul 2015 15:13:20 +0000"  >&lt;p&gt;Fixed by merging this PR: &lt;a href=&quot;https://github.com/apache/commons-scxml/pull/1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-scxml/pull/1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The main difference made in nashorn JavaScriptEngine (Java 1.8), from user&apos;s perspective, is &quot;user can supply any ScriptContext implementation containing any Bindings object as ENGINE_SCOPE, nashorn engine cannot always assume ENGINE_SCOPE Bindings to be backed by a nashorn Global instance.&quot; &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&lt;br/&gt;
So, the user should retrieve the nashorn global object (the only location where the evaluated variables are stored) like the example &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// nashorn engine associates a fresh nashorn Global with the ENGINE_SCOPE
&lt;/span&gt;   &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; obj = myNewContext.getBindings(ScriptContext.ENGINE_SCOPE);
   &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; nashornGlobal = ((Bindings)obj).get(&lt;span class=&quot;code-quote&quot;&gt;&quot;nashorn.global&quot;&lt;/span&gt;); 
   &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-quote&quot;&gt;&quot;nashorn.global&quot;&lt;/span&gt; is the key used to associate
&lt;/span&gt;   ScriptObjectMirror globalMirror = (ScriptObjectMirror) nashornGlobal;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Luckily ScriptObjectMirror is javax.script.Bindings type, so I used Bindings to cast the nashorn.globals when available. This makes it compatible with standard API usages, without having to depend on nashorn specific APIs.&lt;br/&gt;
Also, I was able to check if nashorn.globals is available or not, so this fix would make the test work on both Java 1.8 and earlier versions.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://wiki.openjdk.java.net/display/Nashorn/Nashorn+jsr223+engine+notes&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://wiki.openjdk.java.net/display/Nashorn/Nashorn+jsr223+engine+notes&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 18 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2gxqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>