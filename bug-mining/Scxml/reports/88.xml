<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:32:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SCXML-188] OpenJDK 1.6 Rhino ScriptEngine error causes JSEvaluationTest to fail</title>
                <link>https://issues.apache.org/jira/browse/SCXML-188</link>
                <project id="12310492" key="SCXML">Commons SCXML</project>
                    <description>&lt;p&gt;On OpenJDK 1.7 and Sun/Oracle java 6 and 7 the following JS expression &quot;1 + 1 + 2 + 3 + 5&quot; returns a Double value (12.0)&lt;br/&gt;
On OpenJDK 1.6 the returned value is an Integer (12), causing the JSEvaluatorTest to fail.&lt;/p&gt;

&lt;p&gt;Seems like the OpenJDK Mozilla Rhino implementation/embedding is broken, and until a newer version of OpenJDK 1.6 comes out which fixes this (unlikely any time soon?) we might want to exclude support for OpenJDK 1.6 when using the Rhino Javscript ScriptEngine.&lt;/p&gt;

&lt;p&gt;The question is though: (how) can we handle this conditionally in the test?&lt;/p&gt;</description>
                <environment>&lt;p&gt;continuum-ci.apache.org, OpenJDK 1.6.2 (6b27-1.12.6-1ubuntu0.12.04, amd64)&lt;/p&gt;</environment>
        <key id="12689831">SCXML-188</key>
            <summary>OpenJDK 1.6 Rhino ScriptEngine error causes JSEvaluationTest to fail</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ate">Ate Douma</assignee>
                                    <reporter username="ate">Ate Douma</reporter>
                        <labels>
                    </labels>
                <created>Mon, 20 Jan 2014 16:03:55 +0000</created>
                <updated>Mon, 20 Jan 2014 20:16:24 +0000</updated>
                            <resolved>Mon, 20 Jan 2014 20:16:16 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13876548" author="sebb@apache.org" created="Mon, 20 Jan 2014 16:15:38 +0000"  >&lt;p&gt;I noticed the same problem - though I was a bit surprised that the return type is Double rather than Integer which seems more natural for the particular expresssion.&lt;/p&gt;

&lt;p&gt;One way to avoid the test failure would be to check the return type of the eval, and allow for Integer as well as Double.&lt;/p&gt;

&lt;p&gt;Or change the test to include non-integral values, e.g. 1.0 + 2 + etc - that might force OJDK 1.6 to use Double.&lt;/p&gt;

&lt;p&gt;Or even both - add another test to force double usage.&lt;/p&gt;

&lt;p&gt;I guess it depends what the test is trying to prove.&lt;/p&gt;</comment>
                            <comment id="13876555" author="adouma" created="Mon, 20 Jan 2014 16:26:22 +0000"  >&lt;p&gt;Yeah, I&apos;ve been thinking around similar solutions. &lt;br/&gt;
I also didn&apos;t expect the Double, but it seems like proper in this case, and even OpenJDK 1.7 returns a Double.&lt;/p&gt;

&lt;p&gt;So I&apos;m inclined to interpret the Integer returned by OpenJDK 1.6 as a bug.&lt;br/&gt;
Of course we can workaround this in the test case by allowing both, but I don&apos;t really like it.&lt;/p&gt;</comment>
                            <comment id="13876563" author="sebb@apache.org" created="Mon, 20 Jan 2014 16:34:28 +0000"  >&lt;p&gt;One solution is to allow Integer (assuming the value is correct) but display a message to say it is unexpected - i.e. the test generates a warning rather than a failure. That way the result is not completely hidden, but it does not cause annoyance.&lt;/p&gt;

&lt;p&gt;What does the real Rhino engine do? Is there any Javadoc on the expression evaluator?&lt;br/&gt;
It&apos;s just possible that OJDK1.6 is correct, and the others are all wrong ... its behaviour is arguably more logical&lt;/p&gt;</comment>
                            <comment id="13876656" author="sebb@apache.org" created="Mon, 20 Jan 2014 18:27:31 +0000"  >&lt;p&gt;I&apos;ve fixed the test so it does not fail.&lt;/p&gt;

&lt;p&gt;OpenJDK 1.6 generates the following:&lt;/p&gt;

&lt;p&gt;Evaluated: 1 + 1 + 2 + 3 + 5. Expected: java.lang.Double, actual: Integer&lt;br/&gt;
Evaluated: 1.0 + 1.0 + 2.0 + 3.0 + 5.0. Expected: java.lang.Double, actual: Integer&lt;/p&gt;

&lt;p&gt;The latter definitely looks like a bug.&lt;/p&gt;</comment>
                            <comment id="13876661" author="sebb@apache.org" created="Mon, 20 Jan 2014 18:32:21 +0000"  >&lt;p&gt;Java 1.7 on Continuum does not show the warnings (as expected)&lt;/p&gt;</comment>
                            <comment id="13876793" author="adouma" created="Mon, 20 Jan 2014 19:50:17 +0000"  >&lt;p&gt;Thanks Sebb.&lt;/p&gt;

&lt;p&gt;I&apos;ve did some more research and actually I now think there should be no assumption made on the specific numeric return type, other than that it should be of type java.lang.Number.&lt;br/&gt;
The Javascript language only knows about Number &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;, so mapping that to a concrete Java type always is going to be tricky.&lt;br/&gt;
I found a similar issue &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4634&quot; title=&quot;Fix test bugs in Javascript tests to work with Java 8&amp;#39;s Mozilla-Rhino-replacement &amp;quot;Nashorn&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4634&quot;&gt;&lt;del&gt;SOLR-4634&lt;/del&gt;&lt;/a&gt; which Uwe Schindler IMO correctly fixed by only expecting a return type of java.lang.Number.&lt;/p&gt;

&lt;p&gt;So, maybe we should conclude the current test never should have expected a Double in the first place, and it only just so happen to work because of same/similar implementations in OpenJDK 1.7/Oracle 1.6/1.7.&lt;br/&gt;
But saying OpenJDK 1.6 is returning a &apos;wrong&apos; answer isn&apos;t right either.&lt;/p&gt;

&lt;p&gt;So, I think we should fix this issue by only expecting a java.lang.Number result and checking its intValue being 12. Agreed?&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Rhino/Runtime&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://developer.mozilla.org/en-US/docs/Rhino/Runtime&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13876811" author="sebb@apache.org" created="Mon, 20 Jan 2014 20:05:47 +0000"  >&lt;p&gt;For this particular expression, intValue is OK.&lt;br/&gt;
Unfortunately Number is abstract so the expected class cannot be encoded in the test case data currently - the static class TestItem would need to be extended.&lt;/p&gt;

&lt;p&gt;There might be numeric expressions for which Double (or Float) is required; these should be tested too.&lt;/p&gt;</comment>
                            <comment id="13876818" author="adouma" created="Mon, 20 Jan 2014 20:12:18 +0000"  >&lt;p&gt;I added a test which should return a Double, and test it as such. This succeeds on all JDK versions I&apos;ve installed (1.6 and 1.7 for both OpenJDK and Oracle).&lt;br/&gt;
This should be &apos;good enough&apos; testing from an SCXML POV.&lt;br/&gt;
Checking the Javascript engine compliance IMO is out-of-scope here. &lt;/p&gt;</comment>
                            <comment id="13876820" author="sebb@apache.org" created="Mon, 20 Jan 2014 20:14:43 +0000"  >&lt;p&gt;Yes, I think the tests are OK now&lt;/p&gt;</comment>
                            <comment id="13876824" author="adouma" created="Mon, 20 Jan 2014 20:16:16 +0000"  >&lt;p&gt;Thanks Sebb, closing the issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>368798</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 43 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1rkdr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>369102</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>