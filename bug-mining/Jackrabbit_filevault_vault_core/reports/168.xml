<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:33:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JCRVLT-751] ExportOptions.rootPath not properly converted to platform name format</title>
                <link>https://issues.apache.org/jira/browse/JCRVLT-751</link>
                <project id="12314920" key="JCRVLT">Jackrabbit FileVault</project>
                    <description>&lt;p&gt;AEM has a user synchronisation capability in the publish tier. The synchronisation mechanism relies on FileVault to export and import content.&lt;/p&gt;

&lt;p&gt;Users stored in the repository under a path that starts with a _ and that contain another _ can be exported but fail to be re-imported. For instance, the user stored under the path /home/users/test/_6k_test-user-a won&apos;t be imported.&lt;/p&gt;

&lt;p&gt;Debugging this issue, it seems that FileVault treats the &lt;em&gt;6k&lt;/em&gt; pattern as a namespace and thus skip the resource upon import because the paths don&apos;t match.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13576933">JCRVLT-751</key>
            <summary>ExportOptions.rootPath not properly converted to platform name format</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kwin">Konrad Windszus</assignee>
                                    <reporter username="tmaret">Timoth&#233;e Maret</reporter>
                        <labels>
                            <label>vault</label>
                    </labels>
                <created>Tue, 23 Apr 2024 14:35:31 +0000</created>
                <updated>Tue, 6 Aug 2024 07:21:20 +0000</updated>
                            <resolved>Wed, 8 May 2024 09:16:49 +0000</resolved>
                                    <version>3.7.2</version>
                                    <fixVersion>3.8.0</fixVersion>
                                    <component>vlt</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17840119" author="tmaret" created="Tue, 23 Apr 2024 14:38:29 +0000"  >&lt;p&gt;Attached an integration test that reproduces the issue.&lt;/p&gt;</comment>
                            <comment id="17840123" author="tmaret" created="Tue, 23 Apr 2024 14:45:16 +0000"  >&lt;p&gt;Add a breakpoint &lt;a href=&quot;https://github.com/apache/jackrabbit-filevault/blob/81fa88f1d7af07e77871e2c0bb03515107f18d74/vault-core/src/main/java/org/apache/jackrabbit/vault/fs/io/Importer.java#L1047&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; when running the test.&#160;&lt;/p&gt;</comment>
                            <comment id="17840140" author="kwin" created="Tue, 23 Apr 2024 15:31:35 +0000"  >&lt;p&gt;In my tests the node path&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/home/users/test/_6k_test-user-a
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; is exported as ZIP path&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/home/users/test/__6k_test-user-a
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(which is correct according to &lt;a href=&quot;https://jackrabbit.apache.org/filevault/vaultfs.html#filename-escaping&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jackrabbit.apache.org/filevault/vaultfs.html#filename-escaping&lt;/a&gt;) and correctly unescaped to node path &lt;tt&gt;/home/users/test/_6k_test-user-a&lt;/tt&gt; during import.&lt;/p&gt;</comment>
                            <comment id="17840153" author="reschke" created="Tue, 23 Apr 2024 16:33:58 +0000"  >&lt;p&gt;OK, so then the question is: what was the package created with?&lt;/p&gt;</comment>
                            <comment id="17840188" author="tmaret" created="Tue, 23 Apr 2024 18:34:08 +0000"  >&lt;p&gt;With the PackageManager.assemble(session, opts, export) signature.&lt;/p&gt;

&lt;p&gt;Here&apos;s the code that serialises the authorizable. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] serialize(Session session, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; authorizablePath) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException, RepositoryException {

        /*
         * Serialize the authorizable node and it&apos;s deep
         * subtree (ACL, profile, etc.) in binary-less mode.
         * Skip auto-generated nodes and properties.
         */

        PathFilterSet nodeFilters = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PathFilterSet(authorizablePath);
        nodeFilters.addExclude(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultPathFilter(&lt;span class=&quot;code-quote&quot;&gt;&quot;.*/.tokens&quot;&lt;/span&gt;));
        nodeFilters.addExclude(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultPathFilter(&lt;span class=&quot;code-quote&quot;&gt;&quot;.*/rep:cache&quot;&lt;/span&gt;));

        PathFilterSet propertyFilters = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PathFilterSet(authorizablePath);
        propertyFilters.addExclude(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultPathFilter(&lt;span class=&quot;code-quote&quot;&gt;&quot;^.*/cq:lastReplicated&quot;&lt;/span&gt;));
        propertyFilters.addExclude(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultPathFilter(&lt;span class=&quot;code-quote&quot;&gt;&quot;^.*/cq:lastReplicatedBy&quot;&lt;/span&gt;));
        propertyFilters.addExclude(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultPathFilter(&lt;span class=&quot;code-quote&quot;&gt;&quot;^.*/cq:lastReplicationAction&quot;&lt;/span&gt;));

        DefaultWorkspaceFilter filter = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultWorkspaceFilter();
        filter.add(nodeFilters, propertyFilters);

        DefaultMetaInf inf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultMetaInf();
        inf.setFilter(filter);

        Properties props = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Properties();
        props.setProperty(VaultPackage.NAME_GROUP, &lt;span class=&quot;code-quote&quot;&gt;&quot;granite/sync&quot;&lt;/span&gt;);
        props.setProperty(VaultPackage.NAME_NAME, UUID.randomUUID().toString());
        props.setProperty(VaultPackage.NAME_VERSION, &lt;span class=&quot;code-quote&quot;&gt;&quot;0.0.1&quot;&lt;/span&gt;);
        props.setProperty(PackageProperties.NAME_USE_BINARY_REFERENCES, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;));
        inf.setProperties(props);

        ExportOptions opts = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ExportOptions();
        opts.setMetaInf(inf);

        opts.setRootPath(authorizablePath);
        opts.setMountPath(authorizablePath);

        opts.setCompressionLevel(Deflater.BEST_SPEED);

        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (ByteArrayOutputStream export = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayOutputStream()) {
            packaging.getPackageManager().assemble(session, opts, export);
            export.flush();
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; export.toByteArray();
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17840233" author="tmaret" created="Tue, 23 Apr 2024 21:17:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwin&quot; class=&quot;user-hover&quot; rel=&quot;kwin&quot;&gt;kwin&lt;/a&gt; as suggested in the PR I have added the test `UserExportIT` that covers the export + import in &lt;a href=&quot;https://github.com/apache/jackrabbit-filevault/pull/334&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-filevault/pull/334&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17840721" author="marett" created="Thu, 25 Apr 2024 09:22:46 +0000"  >&lt;p&gt;This appears to be related to how the resource hierarchy is serialised in the package.&lt;/p&gt;

&lt;p&gt;When the node is serialised as a folder (like in the failing test) the test fails.&lt;/p&gt;

&lt;p&gt;When the node is serialised inside a .content.xml document, the test succeeds (mounting at the / triggers this behaviour, see &lt;a href=&quot;https://github.com/apache/jackrabbit-filevault/pull/335/commits/6e8169916e7479dbe440fab239f898ac4d2967fe&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="17844597" author="kwin" created="Wed, 8 May 2024 09:16:49 +0000"  >&lt;p&gt;Fixed in &lt;a href=&quot;https://github.com/apache/jackrabbit-filevault/commit/33b23e126e7e7260582dd43d4b9f4c93958da674&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-filevault/commit/33b23e126e7e7260582dd43d4b9f4c93958da674&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 26 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1otnc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>