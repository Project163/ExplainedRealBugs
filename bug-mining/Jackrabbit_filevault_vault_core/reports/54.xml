<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:32:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JCRVLT-128] System maintained cache nodes should be ignored</title>
                <link>https://issues.apache.org/jira/browse/JCRVLT-128</link>
                <project id="12314920" key="JCRVLT">Jackrabbit FileVault</project>
                    <description>&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-3003&quot; title=&quot;Improve login performance with huge group membership&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-3003&quot;&gt;&lt;del&gt;OAK-3003&lt;/del&gt;&lt;/a&gt; a persisted &lt;a href=&quot;http://jackrabbit.apache.org/oak/docs/security/principal/cache.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;principal cache&lt;/a&gt; was introduced that creates &lt;em&gt;rep:cache&lt;/em&gt; nodes under authorizables.&lt;br/&gt;
Creating a package for such authorizables will result in including the cache node in there, which sounds wrong as that node is an implementation detail which doesn&apos;t make sense to install anywhere; however that can be avoided by proper filters.&lt;br/&gt;
What is problematic is the installation phase, if an authorizable gets packaged with FileVault (no rep:cache in the package) and the target user/group has a rep:cache node itself the importer will try (and fail as it&apos;s protected) to delete the persisted cache node if ImportMode is set to UPDATE.&lt;br/&gt;
In my opinion this is wrong, it should be possible to not touch such nodes on package installation, regardless of the chosen ImportMode.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.jackrabbit.vault.packaging.impl.ZipVaultPackage Error during install.
javax.jcr.nodetype.ConstraintViolationException: OakConstraint0034: Attempt to create or change the system maintained cache.
	at org.apache.jackrabbit.oak.api.CommitFailedException.asRepositoryException(CommitFailedException.java:225)
	at org.apache.jackrabbit.oak.api.CommitFailedException.asRepositoryException(CommitFailedException.java:212)
	at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.newRepositoryException(SessionDelegate.java:670)
	at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.save(SessionDelegate.java:496)
	at org.apache.jackrabbit.oak.jcr.session.SessionImpl$8.performVoid(SessionImpl.java:419)
	at org.apache.jackrabbit.oak.jcr.delegate.SessionDelegate.performVoid(SessionDelegate.java:274)
	at org.apache.jackrabbit.oak.jcr.session.SessionImpl.save(SessionImpl.java:416)
	at org.apache.jackrabbit.vault.fs.io.AutoSave.save(AutoSave.java:175)
	at org.apache.jackrabbit.vault.fs.io.Importer.run(Importer.java:416)
	at org.apache.jackrabbit.vault.packaging.impl.ZipVaultPackage.extract(ZipVaultPackage.java:234)
	at org.apache.jackrabbit.vault.packaging.impl.ZipVaultPackage.extract(ZipVaultPackage.java:153)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13006451">JCRVLT-128</key>
            <summary>System maintained cache nodes should be ignored</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tripod">Tobias Bocanegra</assignee>
                                    <reporter username="teofili">Tommaso Teofili</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Sep 2016 10:21:16 +0000</created>
                <updated>Mon, 27 Mar 2017 05:24:04 +0000</updated>
                            <resolved>Tue, 11 Oct 2016 09:28:11 +0000</resolved>
                                    <version>3.1.28</version>
                                    <fixVersion>3.1.38</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15509810" author="teofili" created="Wed, 21 Sep 2016 12:47:57 +0000"  >&lt;p&gt;attaching dummy patch which avoids restoring &lt;em&gt;rep:cache&lt;/em&gt; nodes from stashed ones in &lt;tt&gt;JcrSysViewTransformer&lt;/tt&gt;; so the side effect is that the cache nodes are removed after package installation.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tripod&quot; class=&quot;user-hover&quot; rel=&quot;tripod&quot;&gt;tripod&lt;/a&gt; WDYT? I&apos;m pretty sure there&apos;s a better way of doing that.&lt;/p&gt;</comment>
                            <comment id="15509901" author="catholicon" created="Wed, 21 Sep 2016 13:27:38 +0000"  >&lt;p&gt;I wonder if vault should rather do such stuff for nodes with some specific mixin (&lt;tt&gt;rep:do_not_copy_past&lt;/tt&gt;... of course with a better name &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)... and rep:cache nodes come with that mixin.&lt;br/&gt;
&lt;em&gt;Disclaimer: I don&apos;t know a lot of details around the requirement of rep cache... so, please take this comment with a grain of salt&lt;/em&gt;&lt;/p&gt;</comment>
                            <comment id="15522208" author="tripod" created="Mon, 26 Sep 2016 06:25:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=teofili&quot; class=&quot;user-hover&quot; rel=&quot;teofili&quot;&gt;teofili&lt;/a&gt; I fixed something in r1762273 [0]  but I don&apos;t know if it helps. I have a hard time to reproduce this. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anchela&quot; class=&quot;user-hover&quot; rel=&quot;anchela&quot;&gt;anchela&lt;/a&gt; how can I create a user that has a &lt;tt&gt;rep:cache&lt;/tt&gt; node?&lt;/p&gt;

&lt;p&gt;[0] &lt;a href=&quot;http://svn.apache.org/viewvc/jackrabbit/commons/filevault/trunk/vault-core/src/main/java/org/apache/jackrabbit/vault/fs/impl/io/DocViewSAXImporter.java?r1=1762273&amp;amp;r2=1762272&amp;amp;pathrev=1762273&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/jackrabbit/commons/filevault/trunk/vault-core/src/main/java/org/apache/jackrabbit/vault/fs/impl/io/DocViewSAXImporter.java?r1=1762273&amp;amp;r2=1762272&amp;amp;pathrev=1762273&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15529500" author="teofili" created="Wed, 28 Sep 2016 12:50:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tripod%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tripod@apache.org&quot;&gt;tripod@apache.org&lt;/a&gt; that fix doesn&apos;t seem to help, as the problem on the importer side is with &lt;em&gt;UPDATE&lt;/em&gt; ImportMode. Do you think your changes make sense for that case too ?&lt;/p&gt;</comment>
                            <comment id="15529718" author="tripod" created="Wed, 28 Sep 2016 14:01:36 +0000"  >&lt;p&gt;my fix exactly fixes the update case &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; but I would like to create a test for it. for that I need to create a test user with a &lt;tt&gt;rep:cache&lt;/tt&gt; node. any hints on how to do this?&lt;/p&gt;</comment>
                            <comment id="15532185" author="teofili" created="Thu, 29 Sep 2016 08:41:28 +0000"  >&lt;p&gt;the reason why I had thought it is for REPLACE is that I see the special handling is guarded by &lt;em&gt;if (wspFilter.getImportMode(path) == ImportMode.REPLACE)&lt;/em&gt;. However I agree we need a test in order to fix and guard from any regression there.&lt;/p&gt;</comment>
                            <comment id="15532271" author="tripod" created="Thu, 29 Sep 2016 09:19:06 +0000"  >&lt;p&gt;hmm...ok. I check again.&lt;/p&gt;</comment>
                            <comment id="15564547" author="tripod" created="Tue, 11 Oct 2016 05:37:21 +0000"  >&lt;p&gt;ok. i could reproduce it:&lt;/p&gt;

&lt;p&gt;1. change usermanager configuration to enable cache (see &lt;a href=&quot;https://jackrabbit.apache.org/oak/docs/security/principal/cache.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jackrabbit.apache.org/oak/docs/security/principal/cache.html&lt;/a&gt;)&lt;br/&gt;
2. create a user XYZ&lt;br/&gt;
3. create a package of this user. doesn&apos;t really matter if it contains the cache node or not, or if it&apos;s exlucded by the filter.&lt;br/&gt;
4. delete the user, and recreate it (basically move it to a different location, due to the random path algo)&lt;br/&gt;
5. assign a group and login as this user&lt;br/&gt;
6. verify that the user now has a cache node&lt;br/&gt;
7. install the package from above:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;org.apache.jackrabbit.vault.packaging.PackageException: javax.jcr.nodetype.ConstraintViolationException: OakConstraint0034: Attempt to create or change the system maintained cache.&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Added test case in: r1764211&lt;/p&gt;</comment>
                            <comment id="15565011" author="tripod" created="Tue, 11 Oct 2016 09:28:12 +0000"  >&lt;p&gt;fixed in r1764217&lt;/p&gt;</comment>
                            <comment id="15567945" author="teofili" created="Wed, 12 Oct 2016 07:43:56 +0000"  >&lt;p&gt;thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tripod%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tripod@apache.org&quot;&gt;tripod@apache.org&lt;/a&gt; for your help.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12829568" name="JCRVLT-128.0.patch" size="784" author="teofili" created="Wed, 21 Sep 2016 13:07:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 5 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33vyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>