<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:33:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JCRVLT-549] node cannot be deleted if it&apos;s a residual mandatory child node</title>
                <link>https://issues.apache.org/jira/browse/JCRVLT-549</link>
                <project id="12314920" key="JCRVLT">Jackrabbit FileVault</project>
                    <description>&lt;p&gt;Let say we have a rule in nodetype.cnd file&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
[a:RolloutConfig] &amp;gt; mix:title
 orderable
 - a:trigger (string) mandatory
 + * (a:LiveSyncAction) mandatory

[a:LiveSyncAction] &amp;gt; nt:unstructured
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When a package(first) is installed where parent node&apos;s(rolloutconfigs) .content.xml has:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;&lt;/span&gt;
&amp;lt;jcr:root &lt;span class=&quot;code-keyword&quot;&gt;xmlns:sling&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://sling.apache.org/jcr/sling/1.0&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;xmlns:jcr&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.jcp.org/jcr/1.0&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;xmlns:rep&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;internal&quot;&lt;/span&gt;
    jcr:mixinTypes=&lt;span class=&quot;code-quote&quot;&gt;&quot;[rep:AccessControllable]&quot;&lt;/span&gt;
    jcr:primaryType=&lt;span class=&quot;code-quote&quot;&gt;&quot;sling:OrderedFolder&quot;&lt;/span&gt;
    jcr:title=&lt;span class=&quot;code-quote&quot;&gt;&quot;Rollout Configurations&quot;&lt;/span&gt;&amp;gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;default/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;pushonmodify/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;activate/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;deactivate/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/jcr:root&amp;gt;&lt;/span&gt;
&#160;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&#160;and default node&apos;s has .content.xml&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;&lt;/span&gt;
&amp;lt;jcr:root &lt;span class=&quot;code-keyword&quot;&gt;xmlns:a&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.day.com/jcr/a/1.0&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;xmlns:jcr&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.jcp.org/jcr/1.0&quot;&lt;/span&gt;
    a:trigger=&lt;span class=&quot;code-quote&quot;&gt;&quot;rollout&quot;&lt;/span&gt;
    jcr:description=&lt;span class=&quot;code-quote&quot;&gt;&quot;abc&quot;&lt;/span&gt;
    jcr:primaryType=&lt;span class=&quot;code-quote&quot;&gt;&quot;a:RolloutConfig&quot;&lt;/span&gt;
    jcr:title=&lt;span class=&quot;code-quote&quot;&gt;&quot;Standard rollout config&quot;&lt;/span&gt;&amp;gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;contentUpdate jcr:primaryType=&lt;span class=&quot;code-quote&quot;&gt;&quot;a:LiveSyncAction&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;contentCopy jcr:primaryType=&lt;span class=&quot;code-quote&quot;&gt;&quot;a:LiveSyncAction&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;contentDelete jcr:primaryType=&lt;span class=&quot;code-quote&quot;&gt;&quot;a:LiveSyncAction&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;referencesUpdate jcr:primaryType=&lt;span class=&quot;code-quote&quot;&gt;&quot;a:LiveSyncAction&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;personalizationContentRollout jcr:primaryType=&lt;span class=&quot;code-quote&quot;&gt;&quot;a:LiveSyncAction&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/jcr:root&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Installing another package(second) with the same cnd file but with different child node&apos;s(default node) content.xml:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;&lt;/span&gt;
&amp;lt;jcr:root &lt;span class=&quot;code-keyword&quot;&gt;xmlns:a&lt;span&lt;/span&gt; class=&quot;code-quote&quot;&gt;&quot;http://www.day.com/jcr/a/1.0&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;xmlns:jcr&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.jcp.org/jcr/1.0&quot;&lt;/span&gt;
    a:trigger=&lt;span class=&quot;code-quote&quot;&gt;&quot;rollout&quot;&lt;/span&gt;
    jcr:description=&lt;span class=&quot;code-quote&quot;&gt;&quot;abc&quot;&lt;/span&gt;
    jcr:primaryType=&lt;span class=&quot;code-quote&quot;&gt;&quot;a:RolloutConfig&quot;&lt;/span&gt;
    jcr:title=&lt;span class=&quot;code-quote&quot;&gt;&quot;Standard rollout config&quot;&lt;/span&gt;&amp;gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;activate jcr:primaryType=&lt;span class=&quot;code-quote&quot;&gt;&quot;a:LiveSyncAction&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;contentCopy jcr:primaryType=&lt;span class=&quot;code-quote&quot;&gt;&quot;a:LiveSyncAction&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/jcr:root&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; marks the below node for Deletion but doesn&apos;t delete them because it&apos;s a mandatory node &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
D /x/y/z/rolloutconfigs/default/contentDelete
D /x/y/z/rolloutconfigs/default/contentUpdate
D /x/y/z/rolloutconfigs/default/orderChildren
D /x/y/z/rolloutconfigs/default/personalizationContentRollout
D /x/y/z/rolloutconfigs/default/referencesUpdate
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;The issue lies at &lt;a href=&quot;https://github.com/apache/jackrabbit-filevault/blob/jackrabbit-filevault-3.2.8/vault-core/src/main/java/org/apache/jackrabbit/vault/fs/impl/io/DocViewSAXImporter.java#L1190&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-filevault/blob/jackrabbit-filevault-3.2.8/vault-core/src/main/java/org/apache/jackrabbit/vault/fs/impl/io/DocViewSAXImporter.java#L1190&lt;/a&gt; . Here, check for the child node is mandatory or not is done after marking it for delete importInfo.onDeleted(path) which gives wrong information that the child node is deleted but in the repository, it still exists.&lt;/p&gt;


</description>
                <environment></environment>
        <key id="13394579">JCRVLT-549</key>
            <summary>node cannot be deleted if it&apos;s a residual mandatory child node</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kwin">Konrad Windszus</assignee>
                                    <reporter username="ankitaagar">Ankita Agarwal</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Aug 2021 07:41:34 +0000</created>
                <updated>Fri, 12 Nov 2021 11:48:40 +0000</updated>
                            <resolved>Fri, 12 Nov 2021 09:33:32 +0000</resolved>
                                    <version>3.4.0</version>
                                    <fixVersion>3.5.6</fixVersion>
                                    <component>vlt</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17397266" author="kwin" created="Wed, 11 Aug 2021 10:42:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ankitaagar&quot; class=&quot;user-hover&quot; rel=&quot;ankitaagar&quot;&gt;ankitaagar&lt;/a&gt; Sorry but this error report lacks details. I don&apos;t have an idea what is meant with the summary. Please add description and steps to reproduce.&lt;/p&gt;</comment>
                            <comment id="17397269" author="ankitaagar" created="Wed, 11 Aug 2021 10:44:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwin&quot; class=&quot;user-hover&quot; rel=&quot;kwin&quot;&gt;kwin&lt;/a&gt; Sure, I will also provide a patch&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17397332" author="ankitaagar" created="Wed, 11 Aug 2021 12:55:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwin&quot; class=&quot;user-hover&quot; rel=&quot;kwin&quot;&gt;kwin&lt;/a&gt;&#160;I am working on it will provide the patch&lt;/p&gt;</comment>
                            <comment id="17400968" author="tripod" created="Wed, 18 Aug 2021 10:53:00 +0000"  >&lt;p&gt;the problem is, that &lt;tt&gt;cq:LiveSyncAction&lt;/tt&gt; are mandatory child nodes, but with the &lt;tt&gt;*&lt;/tt&gt; names, i.e. you can actually delete them when at least 1 remains.&lt;/p&gt;

&lt;p&gt;but the check in the import just rejects mandatory child nodes in general. it would probably be better to check if it has a fix mandatory name.&lt;/p&gt;</comment>
                            <comment id="17405650" author="kwin" created="Fri, 27 Aug 2021 07:42:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ankitaagar&quot; class=&quot;user-hover&quot; rel=&quot;ankitaagar&quot;&gt;ankitaagar&lt;/a&gt; I will do a release of FileVault soon. Can you come up with a patch or at least a failing test case?&lt;/p&gt;</comment>
                            <comment id="17406760" author="ankitaagar" created="Mon, 30 Aug 2021 14:40:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwin&quot; class=&quot;user-hover&quot; rel=&quot;kwin&quot;&gt;kwin&lt;/a&gt; I will provide the patch within this week.&lt;/p&gt;</comment>
                            <comment id="17406832" author="ankitaagar" created="Mon, 30 Aug 2021 16:49:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwin&quot; class=&quot;user-hover&quot; rel=&quot;kwin&quot;&gt;kwin&lt;/a&gt;/ &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tripod&quot; class=&quot;user-hover&quot; rel=&quot;tripod&quot;&gt;tripod&lt;/a&gt; Raised a PR &lt;a href=&quot;https://github.com/apache/jackrabbit-filevault/pull/163&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-filevault/pull/163&lt;/a&gt; &lt;br/&gt;
Request you to review the PR.&lt;/p&gt;</comment>
                            <comment id="17424102" author="ankitaagar" created="Mon, 4 Oct 2021 18:35:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwin&quot; class=&quot;user-hover&quot; rel=&quot;kwin&quot;&gt;kwin&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tripod&quot; class=&quot;user-hover&quot; rel=&quot;tripod&quot;&gt;tripod&lt;/a&gt; Could you please review the PR -&amp;gt; &lt;a href=&quot;https://github.com/apache/jackrabbit-oak/pull/382&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-oak/pull/382&lt;/a&gt;, raised as per comments on &lt;a href=&quot;https://github.com/apache/jackrabbit-filevault/pull/163&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-filevault/pull/163&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17424105" author="kwin" created="Mon, 4 Oct 2021 18:42:16 +0000"  >&lt;p&gt;Please find a solution which works with older Oak versions.&lt;/p&gt;</comment>
                            <comment id="17442320" author="kwin" created="Thu, 11 Nov 2021 15:47:16 +0000"  >&lt;p&gt;Actually JCR 2.0 mandates that mandatory residual definitions are not supported (&lt;a href=&quot;https://www.adobe.io/experience-manager/reference-materials/spec/jcr/2.0/3_Repository_Model.html#3.7.2.4%20Mandatory&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.adobe.io/experience-manager/reference-materials/spec/jcr/2.0/3_Repository_Model.html#3.7.2.4%20Mandatory&lt;/a&gt;) and therefore these constraint are subsequently not enforced. That means that for a nodetype&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[a:RolloutConfig] &amp;gt; mix:title
 orderable
 - a:trigger (string) mandatory
 + * (a:LiveSyncAction) mandatory
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;all LiveSyncAction child nodes can be safely removed (although being mandatory).&lt;/p&gt;</comment>
                            <comment id="17442614" author="reschke" created="Fri, 12 Nov 2021 08:28:33 +0000"  >&lt;p&gt;Hmmm. Good find.&lt;/p&gt;

&lt;p&gt;One could argue that it&apos;s a bug in Oak that it supports these, and that should be fixed. That may be hard now that it apparently is used in practice. Would be good to find out what &lt;b&gt;exactly&lt;/b&gt; Oak is enforcing here (to see whether that support is actually meaningful and could be considered an &quot;extension&quot; of JCR).&lt;/p&gt;

&lt;p&gt;For &lt;b&gt;this&lt;/b&gt; ticket, I would suggest to put it aside (and not wait for its resolution for the next filevault release), until we have made our homework on the Oak side of things.&lt;/p&gt;</comment>
                            <comment id="17442633" author="kwin" created="Fri, 12 Nov 2021 09:33:22 +0000"  >&lt;p&gt;Fixed in &lt;a href=&quot;https://github.com/apache/jackrabbit-filevault/commit/3eb928da8cbe21b42a2b5ed9bda8d72e1722856a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/jackrabbit-filevault/commit/3eb928da8cbe21b42a2b5ed9bda8d72e1722856a&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13404824">OAK-9591</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13411290">OAK-9621</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0tsjs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>