diff --git a/vault-core/src/main/java/org/apache/jackrabbit/vault/fs/impl/io/FolderArtifactHandler.java b/vault-core/src/main/java/org/apache/jackrabbit/vault/fs/impl/io/FolderArtifactHandler.java
index ea75bb2d..1e637e76 100644
--- a/vault-core/src/main/java/org/apache/jackrabbit/vault/fs/impl/io/FolderArtifactHandler.java
+++ b/vault-core/src/main/java/org/apache/jackrabbit/vault/fs/impl/io/FolderArtifactHandler.java
@@ -78,7 +78,18 @@ public class FolderArtifactHandler extends AbstractArtifactHandler {
             return info;
         }
         if (!parent.hasNode(dir.getRelativePath())) {
-            Node node = parent.addNode(dir.getRelativePath(), nodeType);
+            final Node node;
+            if (wspFilter.contains(parent.getPath() + "/" + dir.getRelativePath())) {
+                node = parent.addNode(dir.getRelativePath(), nodeType);
+            } else {
+                // preferably use default node type for intermediate nodes
+                if (parent.getPrimaryNodeType().canAddChildNode(dir.getRelativePath())) {
+                    node = parent.addNode(dir.getRelativePath());
+                } else {
+                    node = parent.addNode(dir.getRelativePath(), nodeType);
+                }
+                
+            }
             info.onCreated(node.getPath());
         } else {
             // sync nodes
diff --git a/vault-core/src/main/java/org/apache/jackrabbit/vault/fs/io/MemoryArchive.java b/vault-core/src/main/java/org/apache/jackrabbit/vault/fs/io/MemoryArchive.java
index b4c9dba6..b784a83c 100644
--- a/vault-core/src/main/java/org/apache/jackrabbit/vault/fs/io/MemoryArchive.java
+++ b/vault-core/src/main/java/org/apache/jackrabbit/vault/fs/io/MemoryArchive.java
@@ -273,7 +273,7 @@ public class MemoryArchive extends AbstractArchive implements InputStreamPump.Pu
          * @return the new entry
          */
         @NotNull
-        public VirtualEntry add(@NotNull String name, long time, @Nullable byte[] data) {
+        public VirtualEntry add(@NotNull String name, long time, byte[] data) {
             if (children != null) {
                 VirtualEntry ret = children.get(name);
                 if (ret != null) {
diff --git a/vault-core/src/test/java/org/apache/jackrabbit/vault/packaging/integration/IntegrationTestBase.java b/vault-core/src/test/java/org/apache/jackrabbit/vault/packaging/integration/IntegrationTestBase.java
index 89ff39d2..9d894d55 100644
--- a/vault-core/src/test/java/org/apache/jackrabbit/vault/packaging/integration/IntegrationTestBase.java
+++ b/vault-core/src/test/java/org/apache/jackrabbit/vault/packaging/integration/IntegrationTestBase.java
@@ -394,6 +394,21 @@ public class IntegrationTestBase  {
         return extractVaultPackage(name, null);
     }
 
+    /**
+     * Returns an ZipVaultPackage which has been extracted in the repository.
+     * 
+     * @param name either the name of a zip file or the name of a directory which contains an exploded package
+     * @return an extracted vault package
+     * @throws IOException
+     * @throws PackageException
+     * @throws RepositoryException
+     */
+    public VaultPackage extractVaultPackageStrict(String name) throws IOException, PackageException, RepositoryException {
+        ImportOptions  opts = getDefaultOptions();
+        opts.setStrict(true);
+        return extractVaultPackage(name, opts);
+    }
+
     public VaultPackage extractVaultPackage(String name, ImportOptions opts) throws IOException, PackageException, RepositoryException {
         if (opts == null) {
             opts = getDefaultOptions();
diff --git a/vault-core/src/test/java/org/apache/jackrabbit/vault/packaging/integration/TestFolderArtifactHandler.java b/vault-core/src/test/java/org/apache/jackrabbit/vault/packaging/integration/TestFolderArtifactHandler.java
index 63271db2..87050691 100644
--- a/vault-core/src/test/java/org/apache/jackrabbit/vault/packaging/integration/TestFolderArtifactHandler.java
+++ b/vault-core/src/test/java/org/apache/jackrabbit/vault/packaging/integration/TestFolderArtifactHandler.java
@@ -33,12 +33,13 @@ public class TestFolderArtifactHandler extends IntegrationTestBase {
     /* JCRVLT-415 */
     @Test
     public void testModifyingContainedNodeNonNtFolderPrimaryType() throws RepositoryException, IOException, PackageException {
-        // create node "/test/foo" with node type "nt:unstructured"
+        // create node "/testroot/foo" with node type "nt:unstructured"
         Node rootNode = admin.getRootNode();
         Node testNode = rootNode.addNode("testroot", "nt:unstructured");
         Node fooNode = testNode.addNode("foo", "nt:unstructured");
         fooNode.setProperty("testProperty", "test");
-        try (VaultPackage vltPackage = extractVaultPackage("/test-packages/folder-without-docview-element.zip")) {
+        admin.save();
+        try (VaultPackage vltPackage = extractVaultPackageStrict("/test-packages/folder-without-docview-element.zip")) {
             // make sure the primary type from "/test/foo" got overwritten!
             assertPropertyMissing("/testroot/foo/testProperty");
             assertNodeHasPrimaryType("/testroot/foo", "nt:folder");
@@ -47,12 +48,13 @@ public class TestFolderArtifactHandler extends IntegrationTestBase {
 
     @Test
     public void testNotModifyingContainedNodeNtFolderPrimaryType() throws RepositoryException, IOException, PackageException {
-        // create node "/test/foo" with node type "nt:unstructured"
+        // create node "/testroot/foo" with node type "nt:unstructured"
         Node rootNode = admin.getRootNode();
         Node testNode = rootNode.addNode("testroot", "nt:unstructured");
         Node fooNode = testNode.addNode("foo", "nt:folder");
         String oldId = fooNode.getIdentifier();
-        try (VaultPackage vltPackage = extractVaultPackage("/test-packages/folder-without-docview-element.zip")) {
+        admin.save();
+        try (VaultPackage vltPackage = extractVaultPackageStrict("/test-packages/folder-without-docview-element.zip")) {
             assertNodeHasPrimaryType("/testroot/foo", "nt:folder");
             assertPropertyMissing("/testroot/value");
             assertEquals(oldId, admin.getNode("/testroot/foo").getIdentifier());
@@ -61,16 +63,40 @@ public class TestFolderArtifactHandler extends IntegrationTestBase {
 
     @Test
     public void testNotModifyingIntermediateNodePrimaryType() throws RepositoryException, IOException, PackageException {
-        // create node "/test/foo" with node type "nt:unstructured"
+        // create node "/var/foo" with node type "nt:unstructured"
         Node rootNode = admin.getRootNode();
         Node testNode = rootNode.addNode("var", "nt:unstructured");
-        //assertNodeMissing("/test2/foo");
         Node fooNode = testNode.addNode("foo", "nt:unstructured");
         assertNodeHasPrimaryType("/var/foo", "nt:unstructured");
         fooNode.setProperty("testProperty", "test");
-        try (VaultPackage vltPackage = extractVaultPackage("/test-packages/folder-without-docview-element.zip")) {
+        admin.save();
+        try (VaultPackage vltPackage = extractVaultPackageStrict("/test-packages/folder-without-docview-element.zip")) {
             assertNodeHasPrimaryType("/var/foo", "nt:unstructured");
             assertProperty("/var/foo/testProperty", "test");
         }
     }
+
+    @Test
+    public void testCreatingIntermediateNodesWithDefaultType() throws RepositoryException, IOException, PackageException {
+        // create node "/var/foo" with node type "nt:unstructured"
+        Node rootNode = admin.getRootNode();
+        Node testNode = rootNode.addNode("var", "nt:unstructured");
+        admin.save();
+        try (VaultPackage vltPackage = extractVaultPackageStrict("/test-packages/folder-without-docview-element.zip")) {
+            assertNodeHasPrimaryType("/var/foo", "nt:unstructured");
+        }
+    }
+
+    @Test
+    public void testCreatingIntermediateNodesWithFallbackType() throws RepositoryException, IOException, PackageException {
+        // create node "/var/foo" with node type "nt:unstructured"
+        Node rootNode = admin.getRootNode();
+        Node testNode = rootNode.addNode("var", "nt:folder");
+        admin.save();
+        assertNodeHasPrimaryType("/var", "nt:folder");
+        try (VaultPackage vltPackage = extractVaultPackage("/test-packages/folder-without-docview-element.zip")) {
+            assertNodeHasPrimaryType("/var", "nt:folder");
+            assertNodeHasPrimaryType("/var/foo", "nt:folder");
+        }
+    }
 }
diff --git a/vault-core/src/test/resources/test-packages/folder-without-docview-element.zip/META-INF/vault/definition/.content.xml b/vault-core/src/test/resources/test-packages/folder-without-docview-element.zip/META-INF/vault/definition/.content.xml
deleted file mode 100644
index bfe893cd..00000000
--- a/vault-core/src/test/resources/test-packages/folder-without-docview-element.zip/META-INF/vault/definition/.content.xml
+++ /dev/null
@@ -1,25 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<jcr:root xmlns:vlt="http://www.day.com/jcr/vault/1.0" xmlns:jcr="http://www.jcp.org/jcr/1.0" xmlns:nt="http://www.jcp.org/jcr/nt/1.0"
-    jcr:created="{Date}2020-02-24T22:42:03.705Z"
-    jcr:createdBy="admin"
-    jcr:description=""
-    jcr:lastModified="{Date}2020-02-24T22:42:03.705Z"
-    jcr:lastModifiedBy="admin"
-    jcr:primaryType="vlt:PackageDefinition"
-    buildCount="1"
-    builtWith="Adobe Experience Manager-6.5.0"
-    group="my_packages"
-    lastUnwrapped="{Date}2020-02-24T22:42:03.705Z"
-    lastUnwrappedBy="admin"
-    lastWrapped="{Date}2020-02-24T22:42:03.705Z"
-    lastWrappedBy="admin"
-    name="test"
-    version="">
-    <filter jcr:primaryType="nt:unstructured">
-        <f0
-            jcr:primaryType="nt:unstructured"
-            mode="replace"
-            root="/test"
-            rules="[]"/>
-    </filter>
-</jcr:root>
