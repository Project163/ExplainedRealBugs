diff --git a/vault-core/src/test/java/org/apache/jackrabbit/vault/packaging/integration/TestSubPackages.java b/vault-core/src/test/java/org/apache/jackrabbit/vault/packaging/integration/TestSubPackages.java
index b49b06f3..b3d5b7b1 100644
--- a/vault-core/src/test/java/org/apache/jackrabbit/vault/packaging/integration/TestSubPackages.java
+++ b/vault-core/src/test/java/org/apache/jackrabbit/vault/packaging/integration/TestSubPackages.java
@@ -30,6 +30,7 @@ import javax.jcr.RepositoryException;
 
 import org.apache.jackrabbit.vault.fs.io.ImportOptions;
 import org.apache.jackrabbit.vault.packaging.Dependency;
+import org.apache.jackrabbit.vault.packaging.DependencyHandling;
 import org.apache.jackrabbit.vault.packaging.JcrPackage;
 import org.apache.jackrabbit.vault.packaging.PackageException;
 import org.apache.jackrabbit.vault.packaging.PackageId;
@@ -699,4 +700,33 @@ public class TestSubPackages extends IntegrationTestBase {
                 "jcr_root/etc/packages/my_packages/sub_b.zip.dir/_jcr_content/_vlt_definition/\n" +
                 "jcr_root/etc/packages/my_packages/sub_b.zip.dir/_jcr_content/_vlt_definition/.content.xml\n", result.toString());
     }
+
+    /**
+     * Test extracts a multipackage-a-1.0 which contains content and a subpackage. The subpackage will add a dependency
+     * on the parent package. later installs newer version multi-package-a-2.0 which will try to reinstall the subpackage,
+     * but the dependency needs to update. see JCRVLT-264
+     */
+    @Test
+    public void testMixedPackageUpdatesCorrectly() throws Exception {
+       // install 1.0
+        JcrPackage pack = packMgr.upload(getStream("testpackages/multipackage-a-1.0.zip"), false);
+        assertNotNull(pack);
+
+        ImportOptions opts = getDefaultOptions();
+        pack.install(opts);
+
+        assertNodeExists("/tmp/testroot/sub");
+        assertProperty("/apps/test/version","1.0");
+
+        // install 2.0
+        pack = packMgr.upload(getStream("testpackages/multipackage-a-2.0.zip"), false);
+        assertNotNull(pack);
+        opts = getDefaultOptions();
+        opts.setDependencyHandling(DependencyHandling.REQUIRED);
+        pack.install(opts);
+
+        assertNodeExists("/tmp/testroot/sub");
+        assertProperty("/apps/test/version","2.0");
+
+    }
 }
\ No newline at end of file
diff --git a/vault-core/src/test/resources/org/apache/jackrabbit/vault/packaging/integration/testpackages/multipackage-a-1.0.zip b/vault-core/src/test/resources/org/apache/jackrabbit/vault/packaging/integration/testpackages/multipackage-a-1.0.zip
new file mode 100644
index 00000000..c7518151
Binary files /dev/null and b/vault-core/src/test/resources/org/apache/jackrabbit/vault/packaging/integration/testpackages/multipackage-a-1.0.zip differ
diff --git a/vault-core/src/test/resources/org/apache/jackrabbit/vault/packaging/integration/testpackages/multipackage-a-2.0.zip b/vault-core/src/test/resources/org/apache/jackrabbit/vault/packaging/integration/testpackages/multipackage-a-2.0.zip
new file mode 100644
index 00000000..d1fe5bd3
Binary files /dev/null and b/vault-core/src/test/resources/org/apache/jackrabbit/vault/packaging/integration/testpackages/multipackage-a-2.0.zip differ
