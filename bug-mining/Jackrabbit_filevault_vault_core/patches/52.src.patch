diff --git a/vault-core/src/main/java/org/apache/jackrabbit/vault/fs/impl/io/DocViewSAXImporter.java b/vault-core/src/main/java/org/apache/jackrabbit/vault/fs/impl/io/DocViewSAXImporter.java
index 7c35e6c0..c347e636 100644
--- a/vault-core/src/main/java/org/apache/jackrabbit/vault/fs/impl/io/DocViewSAXImporter.java
+++ b/vault-core/src/main/java/org/apache/jackrabbit/vault/fs/impl/io/DocViewSAXImporter.java
@@ -867,7 +867,11 @@ public class DocViewSAXImporter extends RejectingEntityDefaultHandler implements
 
             // set new primary type (but never set rep:root)
             if (!"rep:root".equals(ni.primary)) {
-                node.setPrimaryType(ni.primary);
+                if (!node.getPrimaryNodeType().getName().equals(ni.primary)) {
+                    vs.ensureCheckedOut();
+                    node.setPrimaryType(ni.primary);
+                    modified = true;
+                }
             }
 
             // remove the 'system' properties from the set
diff --git a/vault-core/src/test/java/org/apache/jackrabbit/vault/packaging/integration/TestPackageInstall.java b/vault-core/src/test/java/org/apache/jackrabbit/vault/packaging/integration/TestPackageInstall.java
index ad320128..f52f091b 100644
--- a/vault-core/src/test/java/org/apache/jackrabbit/vault/packaging/integration/TestPackageInstall.java
+++ b/vault-core/src/test/java/org/apache/jackrabbit/vault/packaging/integration/TestPackageInstall.java
@@ -457,6 +457,63 @@ public class TestPackageInstall extends IntegrationTestBase {
         assertEquals(admin.getNode("/tmp").getPrimaryNodeType().getName(), "nt:folder");
     }
 
+    /**
+     * Installs a package with versioned nodes
+     */
+    @Test
+    public void testVersionInstall() throws RepositoryException, IOException, PackageException {
+        JcrPackage pack = packMgr.upload(getStream("testpackages/test_version.zip"), false);
+        assertNotNull(pack);
+
+        ImportOptions opts = getDefaultOptions();
+        pack.install(opts);
+
+        assertProperty("/testroot/a/test", "123");
+        assertProperty("/testroot/a/jcr:isCheckedOut", "false");
+
+        // modify
+        admin.getWorkspace().getVersionManager().checkout("/testroot/a");
+        admin.getProperty("/testroot/a/test").setValue("test");
+        admin.save();
+        admin.getWorkspace().getVersionManager().checkin("/testroot/a");
+
+        // install a 2nd time
+        opts = getDefaultOptions();
+        pack.install(opts);
+
+        assertProperty("/testroot/a/test", "123");
+        assertProperty("/testroot/a/jcr:isCheckedOut", "false");
+
+    }
+
+
+    /**
+     * Installs a package with versions retains checked out state
+     */
+    @Test
+    public void testVersionInstallCheckedOut() throws RepositoryException, IOException, PackageException {
+        JcrPackage pack = packMgr.upload(getStream("testpackages/test_version.zip"), false);
+        assertNotNull(pack);
+
+        ImportOptions opts = getDefaultOptions();
+        pack.install(opts);
+
+        assertProperty("/testroot/a/test", "123");
+        assertProperty("/testroot/a/jcr:isCheckedOut", "false");
+
+        // modify
+        admin.getWorkspace().getVersionManager().checkout("/testroot/a");
+        admin.getProperty("/testroot/a/test").setValue("test");
+        admin.save();
+
+        // install a 2nd time
+        opts = getDefaultOptions();
+        pack.install(opts);
+
+        assertProperty("/testroot/a/test", "123");
+        assertProperty("/testroot/a/jcr:isCheckedOut", "false");
+    }
+
 
     // todo: upload with version
     // todo: rename
diff --git a/vault-core/src/test/resources/org/apache/jackrabbit/vault/packaging/integration/testpackages/test_version.zip b/vault-core/src/test/resources/org/apache/jackrabbit/vault/packaging/integration/testpackages/test_version.zip
new file mode 100644
index 00000000..79d850c9
Binary files /dev/null and b/vault-core/src/test/resources/org/apache/jackrabbit/vault/packaging/integration/testpackages/test_version.zip differ
