diff --git a/vault-core/src/main/java/org/apache/jackrabbit/vault/fs/SerializerArtifact.java b/vault-core/src/main/java/org/apache/jackrabbit/vault/fs/SerializerArtifact.java
index c57606e4..e780bc2b 100644
--- a/vault-core/src/main/java/org/apache/jackrabbit/vault/fs/SerializerArtifact.java
+++ b/vault-core/src/main/java/org/apache/jackrabbit/vault/fs/SerializerArtifact.java
@@ -18,6 +18,7 @@
 package org.apache.jackrabbit.vault.fs;
 
 import java.io.ByteArrayInputStream;
+import java.io.FileNotFoundException;
 import java.io.IOException;
 import java.io.InputStream;
 import java.io.OutputStream;
@@ -111,40 +112,44 @@ public class SerializerArtifact extends AbstractArtifact implements ExportArtifa
      * {@inheritDoc}
      */
     public VaultInputSource getInputSource() throws IOException, RepositoryException {
-        final InputStream in;
-        final long size;
         try (DeferredFileOutputStream out = new DeferredFileOutputStream(8192, "vlttmp", ".tmp", null)) {
             spool(out);
-        
-            if (out.isInMemory()) {
-                in = new ByteArrayInputStream(out.getData());
-                size = out.getData().length;
-            } else {
-                in = new TempFileInputStream(out.getFile());
-                size = out.getFile().length();
-            }
-        }
-        return new VaultInputSource() {
 
-            @Override
-            public String getSystemId() {
-                return SerializerArtifact.this.getRelativePath();
-            }
-
-            @Override
-            public InputStream getByteStream() {
-                return in;
-            }
-
-
-            public long getContentLength() {
-                return size;
-            }
-
-            public long getLastModified() {
-                return lastModified;
-            }
-        };
+            return new VaultInputSource() {
+                private InputStream in = null;
+                private long size = -1;
+                @Override
+                public String getSystemId() {
+                    return SerializerArtifact.this.getRelativePath();
+                }
+
+                @Override
+                public InputStream getByteStream() {
+                    if (in == null) {
+                        if (out.isInMemory()) {
+                            in = new ByteArrayInputStream(out.getData());
+                            size = out.getData().length;
+                        } else {
+                            try {
+                                in = new TempFileInputStream(out.getFile());
+                            } catch (FileNotFoundException e) {
+                                throw new IllegalStateException("Could not find temp file", e);
+                            }
+                            size = out.getFile().length();
+                        }
+                    }
+                    return in;
+                }
+
+                public long getContentLength() {
+                    return size;
+                }
+
+                public long getLastModified() {
+                    return lastModified;
+                }
+            };
+        }
     }
 
     /**
diff --git a/vault-core/src/main/java/org/apache/jackrabbit/vault/packaging/impl/JcrPackageImpl.java b/vault-core/src/main/java/org/apache/jackrabbit/vault/packaging/impl/JcrPackageImpl.java
index f98db07b..96006fb0 100644
--- a/vault-core/src/main/java/org/apache/jackrabbit/vault/packaging/impl/JcrPackageImpl.java
+++ b/vault-core/src/main/java/org/apache/jackrabbit/vault/packaging/impl/JcrPackageImpl.java
@@ -305,9 +305,10 @@ public class JcrPackageImpl implements JcrPackage {
             }
             if (!forceFileArchive && size >= 0 && size < MAX_MEMORY_ARCHIVE_SIZE) {
                 MemoryArchive archive = new MemoryArchive(false);
-                try (InputStream in = getData().getStream()) {
+                try (InputStream in = getData().getBinary().getStream()) {
                     archive.run(in);
                 } catch (Exception e) {
+                    archive.close();
                     throw new IOException("Error while reading stream", e);
                 }
                 // workaround for shallow packages that don't have a meta-inf anymore (JCRVLT-188)
@@ -321,15 +322,11 @@ public class JcrPackageImpl implements JcrPackage {
                 pack = new ZipVaultPackage(archive, true);
             } else {
                 File tmpFile = File.createTempFile("vaultpack", ".zip");
-                FileOutputStream out = FileUtils.openOutputStream(tmpFile);
                 Binary bin = getData().getBinary();
-                InputStream in = null;
-                try {
-                    in = bin.getStream();
+                try (FileOutputStream out = FileUtils.openOutputStream(tmpFile); 
+                    InputStream in = bin.getStream()) {
                     IOUtils.copy(in, out);
                 } finally {
-                    IOUtils.closeQuietly(in);
-                    IOUtils.closeQuietly(out);
                     bin.dispose();
                 }
                 pack = new ZipVaultPackage(tmpFile, true);
@@ -619,53 +616,12 @@ public class JcrPackageImpl implements JcrPackage {
         // process the discovered sub-packages
         for (Archive.Entry e: entries) {
             VaultInputSource in = a.getInputSource(e);
-            InputStream ins = null;
-            try {
-                ins = in.getByteStream();
-                JcrPackageImpl subPackage;
+            try (InputStream ins = in.getByteStream()) {
                 try {
-                    PackageId subPid = mgr.register(ins, true);
-                    JcrRegisteredPackage subPkg = (JcrRegisteredPackage) mgr.open(subPid);
-                    if (subPkg == null) {
-                        log.error("Package {}: Newly extracted subpackage is gone: {}", pId, subPid);
-                        continue;
-                    } else {
-                        subPackage = (JcrPackageImpl) subPkg.getJcrPackage();
-                    }
+                    PackageId id = extractSubpackage(pId, ins, opts, processed, hasOwnContent);
+                    log.debug("Package {}: Extracted sub-package: {}", pId, id);
                 } catch (IOException e1) {
-                    log.error("Package {}: Error while extracting subpackage {}: {}", pId, in.getSystemId());
-                    continue;
-                }
-
-                if (hasOwnContent) {
-                    // add dependency to this package
-                    Dependency[] oldDeps = subPackage.getDefinition().getDependencies();
-                    Dependency[] newDeps = DependencyUtil.addExact(oldDeps, pId);
-                    if (oldDeps != newDeps) {
-                        subPackage.getDefinition().setDependencies(newDeps, true);
-                    }
-                } else {
-                    // add parent dependencies to this package
-                    Dependency[] oldDeps = subPackage.getDefinition().getDependencies();
-                    Dependency[] newDeps = oldDeps;
-                    for (Dependency d: getDefinition().getDependencies()) {
-                        newDeps = DependencyUtil.add(newDeps, d);
-                    }
-                    if (oldDeps != newDeps) {
-                        subPackage.getDefinition().setDependencies(newDeps, true);
-                    }
-                }
-
-                PackageId id = subPackage.getDefinition().getId();
-                processed.add(id);
-                log.debug("Package {}: Extracted sub-package: {}", pId, id);
-
-                if (!opts.isNonRecursive()) {
-                    subPackage.extractSubpackages(opts, processed);
-                }
-            } finally {
-                if (ins != null) {
-                    ins.close();
+                    log.error("Package {}: Error while extracting subpackage {}: {}", pId, in.getSystemId(), e1);
                 }
             }
         }
@@ -680,6 +636,46 @@ public class JcrPackageImpl implements JcrPackage {
         }
     }
 
+    private PackageId extractSubpackage(@NotNull PackageId containerPackageId, @NotNull InputStream input, @NotNull ImportOptions opts, @NotNull Set<PackageId> processed, boolean hasOwnContent) throws RepositoryException, IOException, PackageException {
+        JcrPackageImpl subPackage;
+        
+        PackageId subPid = mgr.register(input, true);
+        try (JcrRegisteredPackage subPkg = (JcrRegisteredPackage) mgr.open(subPid)) {
+            if (subPkg == null) {
+                log.error("Package {}: Newly extracted subpackage is gone: {}", containerPackageId, subPid);
+                return null;
+            } else {
+                subPackage = (JcrPackageImpl) subPkg.getJcrPackage();
+            }
+
+            if (hasOwnContent) {
+                // add dependency to this package
+                Dependency[] oldDeps = subPackage.getDefinition().getDependencies();
+                Dependency[] newDeps = DependencyUtil.addExact(oldDeps, containerPackageId);
+                if (oldDeps != newDeps) {
+                    subPackage.getDefinition().setDependencies(newDeps, true);
+                }
+            } else {
+                // add parent dependencies to this package
+                Dependency[] oldDeps = subPackage.getDefinition().getDependencies();
+                Dependency[] newDeps = oldDeps;
+                for (Dependency d: getDefinition().getDependencies()) {
+                    newDeps = DependencyUtil.add(newDeps, d);
+                }
+                if (oldDeps != newDeps) {
+                    subPackage.getDefinition().setDependencies(newDeps, true);
+                }
+            }
+
+            PackageId id = subPackage.getDefinition().getId();
+            processed.add(id);
+            if (!opts.isNonRecursive()) {
+                subPackage.extractSubpackages(opts, processed);
+            }
+            return id;
+        }
+    }
+
     private void findSubPackageEntries(@NotNull List<Archive.Entry> entries, @NotNull Archive.Entry folder) {
         for (Archive.Entry e: folder.getChildren()) {
             final String name = e.getName();
@@ -1004,12 +1000,13 @@ public class JcrPackageImpl implements JcrPackage {
             if (!opts.isNonRecursive() && subPackages.size() > 0) {
                 JcrPackageManagerImpl packMgr = new JcrPackageManagerImpl(mgr);
                 for (PackageId id : subPackages) {
-                    JcrPackage pack = packMgr.open(id);
-                    if (pack != null) {
-                        if (pack.getSnapshot() == null) {
-                            log.warn("Unable to uninstall sub package {}. Snapshot missing.", id);
-                        } else {
-                            pack.uninstall(opts);
+                    try (JcrPackage pack = packMgr.open(id)) {
+                        if (pack != null) {
+                            if (pack.getSnapshot() == null) {
+                                log.warn("Unable to uninstall sub package {}. Snapshot missing.", id);
+                            } else {
+                                pack.uninstall(opts);
+                            }
                         }
                     }
                 }
diff --git a/vault-core/src/main/java/org/apache/jackrabbit/vault/packaging/impl/JcrPackageManagerImpl.java b/vault-core/src/main/java/org/apache/jackrabbit/vault/packaging/impl/JcrPackageManagerImpl.java
index c1a43ba9..6b02ab37 100644
--- a/vault-core/src/main/java/org/apache/jackrabbit/vault/packaging/impl/JcrPackageManagerImpl.java
+++ b/vault-core/src/main/java/org/apache/jackrabbit/vault/packaging/impl/JcrPackageManagerImpl.java
@@ -573,19 +573,29 @@ public class JcrPackageManagerImpl extends PackageManagerImpl implements JcrPack
                     continue;
                 }
                 JcrPackageImpl pack = new JcrPackageImpl(registry, child);
-                if (pack.isValid()) {
-                    // skip packages with illegal names
-                    JcrPackageDefinition jDef = pack.getDefinition();
-                    if (jDef != null && !jDef.getId().isValid()) {
-                        continue;
-                    }
-                    if (filter == null || filter.contains(child.getPath())) {
-                        if (!built || pack.getSize() > 0) {
-                            packages.add(pack);
+                try {
+                    if (pack.isValid()) {
+                        // skip packages with illegal names
+                        JcrPackageDefinition jDef = pack.getDefinition();
+                        if (jDef != null && !jDef.getId().isValid()) {
+                            pack.close();
+                            continue;
+                        }
+                        if (filter == null || filter.contains(child.getPath())) {
+                            if (!built || pack.getSize() > 0) {
+                                packages.add(pack);
+                                continue;
+                            }
                         }
+                        pack.close();
+                    } else if (child.hasNodes() && !shallow){
+                        listPackages(child, packages, filter, built, false);
+                    } else {
+                        pack.close();
                     }
-                } else if (child.hasNodes() && !shallow){
-                    listPackages(child, packages, filter, built, false);
+                } catch (RepositoryException e) {
+                    pack.close();
+                    throw e;
                 }
             }
         }
diff --git a/vault-core/src/main/java/org/apache/jackrabbit/vault/packaging/registry/impl/FSPackageRegistry.java b/vault-core/src/main/java/org/apache/jackrabbit/vault/packaging/registry/impl/FSPackageRegistry.java
index 81254366..6fe1bbb2 100644
--- a/vault-core/src/main/java/org/apache/jackrabbit/vault/packaging/registry/impl/FSPackageRegistry.java
+++ b/vault-core/src/main/java/org/apache/jackrabbit/vault/packaging/registry/impl/FSPackageRegistry.java
@@ -527,8 +527,7 @@ public class FSPackageRegistry extends AbstractPackageRegistry {
     @NotNull
     @Override
     public PackageId register(@NotNull File file, boolean replace) throws IOException, PackageExistsException {
-        ZipVaultPackage pack = new ZipVaultPackage(file, false, true);
-        try {
+        try (ZipVaultPackage pack = new ZipVaultPackage(file, false, true)) {
             File pkgFile = buildPackageFile(pack.getId());
             if (pkgFile.exists()) {
                 if (replace) {
@@ -550,10 +549,6 @@ public class FSPackageRegistry extends AbstractPackageRegistry {
                     .withExternal(false);
             setInstallState(state);
             return pack.getId();
-        } finally {
-            if (!pack.isClosed()) {
-                pack.close();
-            }
         }
     }
 
diff --git a/vault-core/src/main/java/org/apache/jackrabbit/vault/packaging/registry/impl/JcrPackageRegistry.java b/vault-core/src/main/java/org/apache/jackrabbit/vault/packaging/registry/impl/JcrPackageRegistry.java
index 5a62712d..843b20af 100644
--- a/vault-core/src/main/java/org/apache/jackrabbit/vault/packaging/registry/impl/JcrPackageRegistry.java
+++ b/vault-core/src/main/java/org/apache/jackrabbit/vault/packaging/registry/impl/JcrPackageRegistry.java
@@ -296,6 +296,7 @@ public class JcrPackageRegistry extends AbstractPackageRegistry {
                 && node.hasProperty(JcrConstants.JCR_CONTENT + "/" + JcrConstants.JCR_DATA)) {
             return pack;
         } else {
+            pack.close();
             return null;
         }
     }
@@ -365,6 +366,7 @@ public class JcrPackageRegistry extends AbstractPackageRegistry {
             Exception error = pump.getError();
             log.error("Error while reading from input stream.", error);
             bin.dispose();
+            archive.close();
             throw new IOException("Error while reading from input stream", error);
         }
 
@@ -372,6 +374,7 @@ public class JcrPackageRegistry extends AbstractPackageRegistry {
             String msg = "Stream is not a content package. Missing 'jcr_root'.";
             log.error(msg);
             bin.dispose();
+            archive.close();
             throw new IOException(msg);
         }
 
@@ -384,6 +387,7 @@ public class JcrPackageRegistry extends AbstractPackageRegistry {
         }
         if (!pid.isValid()) {
             bin.dispose();
+            archive.close();
             throw new RepositoryException("Unable to create package. Illegal package name.");
         }
 
@@ -409,6 +413,7 @@ public class JcrPackageRegistry extends AbstractPackageRegistry {
             if (replace) {
                 parent.getNode(name).remove();
             } else {
+                archive.close();
                 throw new PackageExistsException("Package already exists: " + pid).setId(pid);
             }
         }
