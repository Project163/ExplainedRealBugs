{"url":"https://api.github.com/repos/fmtlib/fmt/issues/4561","repository_url":"https://api.github.com/repos/fmtlib/fmt","labels_url":"https://api.github.com/repos/fmtlib/fmt/issues/4561/labels{/name}","comments_url":"https://api.github.com/repos/fmtlib/fmt/issues/4561/comments","events_url":"https://api.github.com/repos/fmtlib/fmt/issues/4561/events","html_url":"https://github.com/fmtlib/fmt/issues/4561","id":3474728543,"node_id":"I_kwDOAGurSs7PHCZf","number":4561,"title":"`std::optional<const T>` doesn't work","user":{"login":"OleksandrKvl","id":37271580,"node_id":"MDQ6VXNlcjM3MjcxNTgw","avatar_url":"https://avatars.githubusercontent.com/u/37271580?v=4","gravatar_id":"","url":"https://api.github.com/users/OleksandrKvl","html_url":"https://github.com/OleksandrKvl","followers_url":"https://api.github.com/users/OleksandrKvl/followers","following_url":"https://api.github.com/users/OleksandrKvl/following{/other_user}","gists_url":"https://api.github.com/users/OleksandrKvl/gists{/gist_id}","starred_url":"https://api.github.com/users/OleksandrKvl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OleksandrKvl/subscriptions","organizations_url":"https://api.github.com/users/OleksandrKvl/orgs","repos_url":"https://api.github.com/users/OleksandrKvl/repos","events_url":"https://api.github.com/users/OleksandrKvl/events{/privacy}","received_events_url":"https://api.github.com/users/OleksandrKvl/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2025-10-01T18:56:41Z","updated_at":"2025-10-03T11:40:45Z","closed_at":"2025-10-03T11:40:45Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"`fmt::print(\"{}\", std::optional<const int>{});` doesn't compile. Below is my initial analysis (I'm not really familiar with `fmt` internals):\n- `is_formattable<std::optional<const int>>` is `false` because\n- `has_formatter` is `false` because\n- `decltype(formatter<U, Char>().format(*p, *ctx), std::true_type())` is SFINAEd out because\n- `formatter<U, Char>()` is invalid because\n- default ctor for `formatter<std::optional<const int>>` is deleted because\n- default ctor for `formatter<T, Char> underlying_` [here](https://github.com/fmtlib/fmt/blob/master/include/fmt/std.h#L356) is deleted because\n- default ctor for `formatter<const int>` is deleted [here](https://github.com/fmtlib/fmt/blob/4801f54e59d4478a2fe150b7e3ee8327541431aa/include/fmt/base.h#L652) *probably* because\n- `native_formatter` is not selected because `type_constant<const int>::value` is `custom_type` instead of `int_type`\n\nI can only guess that `remove_cv_t` is required somewhere in that chain.","closed_by":{"login":"vitaut","id":576385,"node_id":"MDQ6VXNlcjU3NjM4NQ==","avatar_url":"https://avatars.githubusercontent.com/u/576385?v=4","gravatar_id":"","url":"https://api.github.com/users/vitaut","html_url":"https://github.com/vitaut","followers_url":"https://api.github.com/users/vitaut/followers","following_url":"https://api.github.com/users/vitaut/following{/other_user}","gists_url":"https://api.github.com/users/vitaut/gists{/gist_id}","starred_url":"https://api.github.com/users/vitaut/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vitaut/subscriptions","organizations_url":"https://api.github.com/users/vitaut/orgs","repos_url":"https://api.github.com/users/vitaut/repos","events_url":"https://api.github.com/users/vitaut/events{/privacy}","received_events_url":"https://api.github.com/users/vitaut/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/fmtlib/fmt/issues/4561/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/fmtlib/fmt/issues/4561/timeline","performed_via_github_app":null,"state_reason":"completed"}