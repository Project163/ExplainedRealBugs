{"url":"https://api.github.com/repos/fmtlib/fmt/issues/4360","repository_url":"https://api.github.com/repos/fmtlib/fmt","labels_url":"https://api.github.com/repos/fmtlib/fmt/issues/4360/labels{/name}","comments_url":"https://api.github.com/repos/fmtlib/fmt/issues/4360/comments","events_url":"https://api.github.com/repos/fmtlib/fmt/issues/4360/events","html_url":"https://github.com/fmtlib/fmt/issues/4360","id":2870880445,"node_id":"I_kwDOAGurSs6rHii9","number":4360,"title":"Named arguments failing to compile with \"unmatched '}' in format string\"","user":{"login":"dinomight","id":628102,"node_id":"MDQ6VXNlcjYyODEwMg==","avatar_url":"https://avatars.githubusercontent.com/u/628102?v=4","gravatar_id":"","url":"https://api.github.com/users/dinomight","html_url":"https://github.com/dinomight","followers_url":"https://api.github.com/users/dinomight/followers","following_url":"https://api.github.com/users/dinomight/following{/other_user}","gists_url":"https://api.github.com/users/dinomight/gists{/gist_id}","starred_url":"https://api.github.com/users/dinomight/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dinomight/subscriptions","organizations_url":"https://api.github.com/users/dinomight/orgs","repos_url":"https://api.github.com/users/dinomight/repos","events_url":"https://api.github.com/users/dinomight/events{/privacy}","received_events_url":"https://api.github.com/users/dinomight/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":894899120,"node_id":"MDU6TGFiZWw4OTQ4OTkxMjA=","url":"https://api.github.com/repos/fmtlib/fmt/labels/help%20wanted","name":"help wanted","color":"7455fc","default":true,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2025-02-22T15:31:24Z","updated_at":"2025-03-15T16:34:13Z","closed_at":"2025-03-15T16:34:13Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Consider the following format call.\n\n```cpp\nfmt::format(\"{enum:<{size}d}\", fmt::arg(\"enum\", 1), fmt::arg(\"size\", 10));\n```\nThis results in a compile time failure reporting an \"unmatched '}' in format string\". This is happening in VS17.14 Preview 1 and with GCC 14.2. I've reproduced the issue over on godbolt using {fmt} from trunk [0]. The above string compiled with 11.0.2 and fails with 11.1.3. I was unable to reproduce this compile failure within the {fmt} test code, so I was wondering if it was somehow fixed. However, checking out the tag for 11.1.3 locally, I was also unable to repro in the test code. Not sure what that's about.\n\nIf you wrap the above example into an `fmt::runtime()`, compilation is successful and output is what is expected. The godbolt link includes this example. Additionally, other format variations appear to work both with auto-indexed values as well as when not providing any explicit reference. The following example does compile. It also appears to be related to the dynamic width field as an explicit value there will compile.\n\n```cpp\nstd::cout << fmt::format(fmt::runtime(\"'{enum:<{size}d}'\\n\"), fmt::arg(\"enum\", 1),\n        fmt::arg(\"size\", 10));\nstd::cout << fmt::format(\"'{enum:<10d}'\\n\", fmt::arg(\"enum\", 2),\n        fmt::arg(\"size\", 10));\nstd::cout << fmt::format(\"'{:<{}d}'\\n\", fmt::arg(\"enum\", 2),\n        fmt::arg(\"size\", 10));\nstd::cout << fmt::format(\"'{0:<{1}d}'\\n\", fmt::arg(\"enum\", 3),\n        fmt::arg(\"size\", 10));\n```\n\nFull error output from GCC 14.2:\n```\n<source>: In function 'int main()':\n<source>:7:29: error: call to consteval function 'fmt::v11::fstring<fmt::v11::detail::named_arg<char, int>, fmt::v11::detail::named_arg<char, int> >(\"\\'{enum:<{size}d}\\'\\012\")' is not a constant expression\n    7 |     std::cout << fmt::format(\"'{enum:<{size}d}'\\n\", fmt::arg(\"enum\", 1),\n      |                  ~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n    8 |         fmt::arg(\"size\", 10));\n      |         ~~~~~~~~~~~~~~~~~~~~~\nIn file included from /opt/compiler-explorer/libs/fmt/trunk/include/fmt/format.h:41,\n                 from <source>:1:\n<source>:7:29:   in 'constexpr' expansion of 'fmt::v11::fstring<fmt::v11::detail::named_arg<char, int>, fmt::v11::detail::named_arg<char, int> >(\"\\'{enum:<{size}d}\\'\\012\")'\n/opt/compiler-explorer/libs/fmt/trunk/include/fmt/base.h:2708:53:   in 'constexpr' expansion of 'fmt::v11::detail::parse_format_string<char, format_string_checker<char, 2, 0, true> >(fmt::v11::basic_string_view<char>(((const char*)s)), fmt::v11::detail::format_string_checker<char, 2, 0, true>(fmt::v11::basic_string_view<char>(((const char*)s)), (fmt::v11::fstring<fmt::v11::detail::named_arg<char, int>, fmt::v11::detail::named_arg<char, int> >::arg_pack(), fmt::v11::fstring<fmt::v11::detail::named_arg<char, int>, fmt::v11::detail::named_arg<char, int> >::arg_pack())))'\n/opt/compiler-explorer/libs/fmt/trunk/include/fmt/base.h:1624:32: error: 'constexpr void fmt::v11::detail::format_string_checker<Char, NUM_ARGS, NUM_NAMED_ARGS, DYNAMIC_NAMES>::on_error(const char*) [with Char = char; int NUM_ARGS = 2; int NUM_NAMED_ARGS = 0; bool DYNAMIC_NAMES = true]' called in a constant expression\n 1624 |         return handler.on_error(\"unmatched '}' in format string\");\n      |                ~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n/opt/compiler-explorer/libs/fmt/trunk/include/fmt/base.h:1713:35: note: 'constexpr void fmt::v11::detail::format_string_checker<Char, NUM_ARGS, NUM_NAMED_ARGS, DYNAMIC_NAMES>::on_error(const char*) [with Char = char; int NUM_ARGS = 2; int NUM_NAMED_ARGS = 0; bool DYNAMIC_NAMES = true]' is not usable as a 'constexpr' function because:\n 1713 |   FMT_NORETURN FMT_CONSTEXPR void on_error(const char* message) {\n      |                                   ^~~~~~~~\n/opt/compiler-explorer/libs/fmt/trunk/include/fmt/base.h:1714:17: error: call to non-'constexpr' function 'void fmt::v11::report_error(const char*)'\n 1714 |     report_error(message);\n      |     ~~~~~~~~~~~~^~~~~~~~~\n/opt/compiler-explorer/libs/fmt/trunk/include/fmt/base.h:673:27: note: 'void fmt::v11::report_error(const char*)' declared here\n  673 | FMT_NORETURN FMT_API void report_error(const char* message);\n      |                           ^~~~~~~~~~~~\n```\n\n[0] https://godbolt.org/z/qvxo5qrTf","closed_by":{"login":"vitaut","id":576385,"node_id":"MDQ6VXNlcjU3NjM4NQ==","avatar_url":"https://avatars.githubusercontent.com/u/576385?v=4","gravatar_id":"","url":"https://api.github.com/users/vitaut","html_url":"https://github.com/vitaut","followers_url":"https://api.github.com/users/vitaut/followers","following_url":"https://api.github.com/users/vitaut/following{/other_user}","gists_url":"https://api.github.com/users/vitaut/gists{/gist_id}","starred_url":"https://api.github.com/users/vitaut/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vitaut/subscriptions","organizations_url":"https://api.github.com/users/vitaut/orgs","repos_url":"https://api.github.com/users/vitaut/repos","events_url":"https://api.github.com/users/vitaut/events{/privacy}","received_events_url":"https://api.github.com/users/vitaut/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/fmtlib/fmt/issues/4360/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/fmtlib/fmt/issues/4360/timeline","performed_via_github_app":null,"state_reason":"completed"}