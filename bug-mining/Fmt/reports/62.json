{"url":"https://api.github.com/repos/fmtlib/fmt/issues/4379","repository_url":"https://api.github.com/repos/fmtlib/fmt","labels_url":"https://api.github.com/repos/fmtlib/fmt/issues/4379/labels{/name}","comments_url":"https://api.github.com/repos/fmtlib/fmt/issues/4379/comments","events_url":"https://api.github.com/repos/fmtlib/fmt/issues/4379/events","html_url":"https://github.com/fmtlib/fmt/issues/4379","id":2907788342,"node_id":"I_kwDOAGurSs6tUVQ2","number":4379,"title":"Module version can't compile fmt::join<std::string_view>","user":{"login":"Algunenano","id":664253,"node_id":"MDQ6VXNlcjY2NDI1Mw==","avatar_url":"https://avatars.githubusercontent.com/u/664253?v=4","gravatar_id":"","url":"https://api.github.com/users/Algunenano","html_url":"https://github.com/Algunenano","followers_url":"https://api.github.com/users/Algunenano/followers","following_url":"https://api.github.com/users/Algunenano/following{/other_user}","gists_url":"https://api.github.com/users/Algunenano/gists{/gist_id}","starred_url":"https://api.github.com/users/Algunenano/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Algunenano/subscriptions","organizations_url":"https://api.github.com/users/Algunenano/orgs","repos_url":"https://api.github.com/users/Algunenano/repos","events_url":"https://api.github.com/users/Algunenano/events{/privacy}","received_events_url":"https://api.github.com/users/Algunenano/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2025-03-10T16:16:07Z","updated_at":"2025-10-16T18:25:21Z","closed_at":"2025-10-16T18:25:21Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Minimal repro:\n\nBuilding with:\n* clang 19.1.7. Also reproduces with gcc 14.2.1\n* ninja 1.12.1\n* cmake 3.31.6\n\nMinimal cmake project to reproduce: [proj.zip](https://github.com/user-attachments/files/19166317/proj.zip)\n\nFiles inside (just in case):\nCMakeLists.txt:\n```\ncmake_minimum_required(VERSION 3.30 FATAL_ERROR)\n\nset(CMAKE_CXX_STANDARD 23)\n\nproject(main LANGUAGES CXX)\n\nadd_executable(main main.cpp)\n\ninclude(FetchContent)\nFetchContent_Declare(\n        fmt\n        GIT_REPOSITORY https://github.com/fmtlib/fmt\n        GIT_TAG        123913715afeb8a437e6388b4473fcc4753e1c9a) # 11.1.4\nFetchContent_MakeAvailable(fmt)\n\n\n# Comment to disable fmt module\n\ntarget_sources(main\n        PUBLIC FILE_SET CXX_MODULES\n        FILES\n        ${fmt_SOURCE_DIR}/src/fmt.cc\n)\ntarget_include_directories(main PRIVATE ${fmt_SOURCE_DIR}/include)\n\n\n# Uncomment for header only\n# target_link_libraries(main PRIVATE fmt::fmt-header-only)\n```\n\n```main.cpp\n#include <string>\n#include <vector>\n\nimport fmt;\n// #include <fmt/format.h>\n// #include <fmt/ranges.h>\n\n\nint main(int argc, char* argv[])\n{\n    std::vector<std::string> strings { \"AAA\", \"BBB\", \"CCC\" };\n    std::vector<std::string_view> svs;\n\n    for (size_t i = 0; i < strings.size(); ++i)\n        svs.emplace_back(strings[i]);\n\n    fmt::print(\"{}\\n\", fmt::join(svs, \", \"));\n    return 0;\n}\n\n```\n\n```\n$ mkdir build\n$ cd build/\n$ CC=clang CXX=clang++ cmake .. -DCMAKE_GENERATOR=Ninja\n-- The CXX compiler identification is Clang 19.1.7\n-- Detecting CXX compiler ABI info\n-- Detecting CXX compiler ABI info - done\n-- Check for working CXX compiler: /usr/lib/ccache/bin/clang++ - skipped\n-- Detecting CXX compile features\n-- Detecting CXX compile features - done\nCloning into 'fmt-src'...\nHEAD is now at 12391371 Update version\n-- {fmt} version: 11.1.4\n-- Build type: \n-- Performing Test HAS_NULLPTR_WARNING\n-- Performing Test HAS_NULLPTR_WARNING - Success\n-- Configuring done (4.4s)\n-- Generating done (0.0s)\n-- Build files have been written to: /tmp/other/proj/build\n```\n\n```\n$ ninja\n[8/9] Building CXX object CMakeFiles/main.dir/main.cpp.o\nFAILED: CMakeFiles/main.dir/main.cpp.o \n/usr/lib/ccache/bin/clang++  -I/tmp/other/proj/build/_deps/fmt-src/include -std=gnu++23 -MD -MT CMakeFiles/main.dir/main.cpp.o -MF CMakeFiles/main.dir/main.cpp.o.d @CMakeFiles/main.dir/main.cpp.o.modmap -o CMakeFiles/main.dir/main.cpp.o -c /tmp/other/proj/main.cpp\nIn module 'fmt' imported from /tmp/other/proj/main.cpp:4:\n/tmp/other/proj/build/_deps/fmt-src/include/fmt/base.h:2235:45: error: implicit instantiation of undefined template 'fmt::detail::type_is_unformattable_for<fmt::join_view<__gnu_cxx::__normal_iterator<std::basic_string_view<char> *, std::vector<std::basic_string_view<char>>>, __gnu_cxx::__normal_iterator<std::basic_string_view<char> *, std::vector<std::basic_string_view<char>>>>, char>'\n 2235 |     type_is_unformattable_for<T, char_type> _;\n      |                                             ^\n/tmp/other/proj/build/_deps/fmt-src/include/fmt/base.h:2208:44: note: in instantiation of function template specialization 'fmt::detail::value<fmt::context>::value<fmt::join_view<__gnu_cxx::__normal_iterator<std::basic_string_view<char> *, std::vector<std::basic_string_view<char>>>, __gnu_cxx::__normal_iterator<std::basic_string_view<char> *, std::vector<std::basic_string_view<char>>>>, 0>' requested here\n 2208 |   FMT_CONSTEXPR20 FMT_INLINE value(T& x) : value(x, custom_tag()) {}\n      |                                            ^\n/tmp/other/proj/build/_deps/fmt-src/include/fmt/base.h:2913:22: note: in instantiation of function template specialization 'fmt::detail::value<fmt::context>::value<fmt::join_view<__gnu_cxx::__normal_iterator<std::basic_string_view<char> *, std::vector<std::basic_string_view<char>>>, __gnu_cxx::__normal_iterator<std::basic_string_view<char> *, std::vector<std::basic_string_view<char>>>>, 0>' requested here\n 2913 |   vargs<T...> va = {{args...}};\n      |                      ^\n/tmp/other/proj/main.cpp:17:10: note: in instantiation of function template specialization 'fmt::print<fmt::join_view<__gnu_cxx::__normal_iterator<std::basic_string_view<char> *, std::vector<std::basic_string_view<char>>>, __gnu_cxx::__normal_iterator<std::basic_string_view<char> *, std::vector<std::basic_string_view<char>>>>>' requested here\n   17 |     fmt::print(\"{}\\n\", fmt::join(svs, \", \"));\n      |          ^\n/tmp/other/proj/build/_deps/fmt-src/include/fmt/base.h:2075:45: note: template is declared here\n 2075 | template <typename T, typename Char> struct type_is_unformattable_for;\n      |                                             ^\n1 error generated.\nninja: build stopped: subcommand failed.\n```\n\nNote that this works fine if:\n* fmt::join is used with std::string instead of std::string_view (replace `fmt::join(svs, \", \")` with `fmt::join(strings, \", \")`)\n* The non-module version (header only or library) is used (edit  `CMakeLists.txt` and `main.cpp` to use the default build instead of a module).\n\nThat is, it only fails when using **both** std::string_view and the module build. It happens with other range iterators, like std::unordered_map and so on.\n\nI though it might be some missing export but I can't find what's missing.\n\n\nSimple patch to change from module to non-module version:\n```patch\ndiff --git a/CMakeLists.txt b/CMakeLists.txt\nindex 60cf589..69c6acb 100644\n--- a/CMakeLists.txt\n+++ b/CMakeLists.txt\n@@ -16,13 +16,13 @@ FetchContent_MakeAvailable(fmt)\n \n # Comment to disable fmt module\n \n-target_sources(main\n-        PUBLIC FILE_SET CXX_MODULES\n-        FILES\n-        ${fmt_SOURCE_DIR}/src/fmt.cc\n-)\n-target_include_directories(main PRIVATE ${fmt_SOURCE_DIR}/include)\n+# target_sources(main\n+#         PUBLIC FILE_SET CXX_MODULES\n+#         FILES\n+#         ${fmt_SOURCE_DIR}/src/fmt.cc\n+# )\n+# target_include_directories(main PRIVATE ${fmt_SOURCE_DIR}/include)\n \n \n # Uncomment for header only\n-# target_link_libraries(main PRIVATE fmt::fmt-header-only)\n+target_link_libraries(main PRIVATE fmt::fmt-header-only)\ndiff --git a/main.cpp b/main.cpp\nindex 6b5fb4e..4c06e60 100644\n--- a/main.cpp\n+++ b/main.cpp\n@@ -1,9 +1,9 @@\n #include <string>\n #include <vector>\n \n-import fmt;\n-// #include <fmt/format.h>\n-// #include <fmt/ranges.h>\n+// import fmt;\n+#include <fmt/format.h>\n+#include <fmt/ranges.h>\n \n \n int main(int argc, char* argv[])\n```","closed_by":{"login":"vitaut","id":576385,"node_id":"MDQ6VXNlcjU3NjM4NQ==","avatar_url":"https://avatars.githubusercontent.com/u/576385?v=4","gravatar_id":"","url":"https://api.github.com/users/vitaut","html_url":"https://github.com/vitaut","followers_url":"https://api.github.com/users/vitaut/followers","following_url":"https://api.github.com/users/vitaut/following{/other_user}","gists_url":"https://api.github.com/users/vitaut/gists{/gist_id}","starred_url":"https://api.github.com/users/vitaut/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vitaut/subscriptions","organizations_url":"https://api.github.com/users/vitaut/orgs","repos_url":"https://api.github.com/users/vitaut/repos","events_url":"https://api.github.com/users/vitaut/events{/privacy}","received_events_url":"https://api.github.com/users/vitaut/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/fmtlib/fmt/issues/4379/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/fmtlib/fmt/issues/4379/timeline","performed_via_github_app":null,"state_reason":"completed"}