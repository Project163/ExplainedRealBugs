{"url":"https://api.github.com/repos/fmtlib/fmt/issues/751","repository_url":"https://api.github.com/repos/fmtlib/fmt","labels_url":"https://api.github.com/repos/fmtlib/fmt/issues/751/labels{/name}","comments_url":"https://api.github.com/repos/fmtlib/fmt/issues/751/comments","events_url":"https://api.github.com/repos/fmtlib/fmt/issues/751/events","html_url":"https://github.com/fmtlib/fmt/issues/751","id":327315014,"node_id":"MDU6SXNzdWUzMjczMTUwMTQ=","number":751,"title":"Can't specialize formatter for templated ranged class","user":{"login":"drrlvn","id":38856,"node_id":"MDQ6VXNlcjM4ODU2","avatar_url":"https://avatars.githubusercontent.com/u/38856?v=4","gravatar_id":"","url":"https://api.github.com/users/drrlvn","html_url":"https://github.com/drrlvn","followers_url":"https://api.github.com/users/drrlvn/followers","following_url":"https://api.github.com/users/drrlvn/following{/other_user}","gists_url":"https://api.github.com/users/drrlvn/gists{/gist_id}","starred_url":"https://api.github.com/users/drrlvn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/drrlvn/subscriptions","organizations_url":"https://api.github.com/users/drrlvn/orgs","repos_url":"https://api.github.com/users/drrlvn/repos","events_url":"https://api.github.com/users/drrlvn/events{/privacy}","received_events_url":"https://api.github.com/users/drrlvn/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-05-29T13:13:33Z","updated_at":"2018-06-06T19:49:16Z","closed_at":"2018-06-06T19:49:16Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"If I include `fmt/ranges.h` I cannot specialize `fmt::formatter` for my type that is ranged and templated.\r\nSay I have this class:\r\n\r\n```c++\r\ntemplate<typename T>\r\nclass Foo {\r\npublic:\r\n    ...\r\n    const_iterator begin() const { ... }\r\n    const_iterator cbegin() const { ... }\r\n    ...\r\n};\r\n```\r\n\r\nWhen trying to provide a specialization of `fmt::formatter` for this class:\r\n\r\n```c++\r\ntemplate<typename T>\r\nstruct formatter<Foo<T>> {\r\n    ...\r\n};\r\n```\r\n\r\nI get an ambiguous template instantiation error because of the specialization in `fmt/ranges.h`:\r\n\r\n```\r\ninclude/fmt/core.h:529:56: error: ambiguous template instantiation for ‘struct fmt::v5::formatter<Foo<int>, char, void>’\r\n     typename Context::template formatter_type<T>::type f;\r\n                                                        ^\r\nIn file included from ...:\r\ninclude/fmt/ranges.h:199:8: note: candidates are: ‘template<class RangeT, class Char> struct fmt::v5::formatter<RangeT, Char, typename std::enable_if<fmt::v5::internal::is_range<T>::value>::type> [with RangeT = Foo<int>; Char = char]’\r\n struct formatter< RangeT, Char,\r\n        ^~~~~~~~~~~~~~~~~~~~~~~~\r\n     typename std::enable_if<fmt::internal::is_range<RangeT>::value>::type> {\r\n     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\nIn file included from ...:\r\nfoo.cpp: note:                 ‘template<class T> struct fmt::v5::formatter<Foo<T> > [with T = int]’\r\n     struct formatter<Foo<T>> {\r\n            ^~~~~~~~~~~~~~~~~\r\n```\r\n\r\nAs a workaround I can force `fmt::internal::is_range` to be false:\r\n\r\n```c++\r\nnamespace fmt::internal {\r\n\r\ntemplate<typename T>\r\nstruct is_range<Foo<T>> : std::false_type {};\r\n\r\n} // namespace fmt::internal\r\n```\r\n\r\nBut obviously I would want to avoid defining anything in an internal namespace.","closed_by":{"login":"vitaut","id":576385,"node_id":"MDQ6VXNlcjU3NjM4NQ==","avatar_url":"https://avatars.githubusercontent.com/u/576385?v=4","gravatar_id":"","url":"https://api.github.com/users/vitaut","html_url":"https://github.com/vitaut","followers_url":"https://api.github.com/users/vitaut/followers","following_url":"https://api.github.com/users/vitaut/following{/other_user}","gists_url":"https://api.github.com/users/vitaut/gists{/gist_id}","starred_url":"https://api.github.com/users/vitaut/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vitaut/subscriptions","organizations_url":"https://api.github.com/users/vitaut/orgs","repos_url":"https://api.github.com/users/vitaut/repos","events_url":"https://api.github.com/users/vitaut/events{/privacy}","received_events_url":"https://api.github.com/users/vitaut/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/fmtlib/fmt/issues/751/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/fmtlib/fmt/issues/751/timeline","performed_via_github_app":null,"state_reason":"completed"}