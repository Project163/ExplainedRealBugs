{"url":"https://api.github.com/repos/fmtlib/fmt/issues/2116","repository_url":"https://api.github.com/repos/fmtlib/fmt","labels_url":"https://api.github.com/repos/fmtlib/fmt/issues/2116/labels{/name}","comments_url":"https://api.github.com/repos/fmtlib/fmt/issues/2116/comments","events_url":"https://api.github.com/repos/fmtlib/fmt/issues/2116/events","html_url":"https://github.com/fmtlib/fmt/issues/2116","id":795694821,"node_id":"MDU6SXNzdWU3OTU2OTQ4MjE=","number":2116,"title":"Unable to get `FMT_COMPILE` to compile on ESP32","user":{"login":"summivox","id":1770521,"node_id":"MDQ6VXNlcjE3NzA1MjE=","avatar_url":"https://avatars.githubusercontent.com/u/1770521?v=4","gravatar_id":"","url":"https://api.github.com/users/summivox","html_url":"https://github.com/summivox","followers_url":"https://api.github.com/users/summivox/followers","following_url":"https://api.github.com/users/summivox/following{/other_user}","gists_url":"https://api.github.com/users/summivox/gists{/gist_id}","starred_url":"https://api.github.com/users/summivox/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/summivox/subscriptions","organizations_url":"https://api.github.com/users/summivox/orgs","repos_url":"https://api.github.com/users/summivox/repos","events_url":"https://api.github.com/users/summivox/events{/privacy}","received_events_url":"https://api.github.com/users/summivox/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2021-01-28T05:54:04Z","updated_at":"2021-03-25T22:13:44Z","closed_at":"2021-01-28T14:56:28Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Platform**: https://github.com/espressif/esp-idf\r\n\r\n**Compiler**: \r\n```\r\n$ xtensa-esp32-elf-g++ --version\r\nxtensa-esp32-elf-g++ (crosstool-NG esp-2020r3) 8.4.0\r\nCopyright (C) 2018 Free Software Foundation, Inc.\r\nThis is free software; see the source for copying conditions.  There is NO\r\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n```\r\n\r\n**Code**:\r\n```cpp\r\nauto result = fmt::format(FMT_COMPILE(\"{}\"), 12345);\r\n```\r\n\r\n**Expected Result**:\r\nCode compiles.\r\n\r\n**Actual Result**:\r\nCode does not compile. Error message:\r\n```\r\n$ cmake\r\n[1/9] Performing build step for 'bootloader'\r\nninja: no work to do.\r\n[2/7] Building CXX object esp-idf/main/CMakeFiles/__idf_main.dir/app_main.cpp.obj\r\nFAILED: esp-idf/main/CMakeFiles/__idf_main.dir/app_main.cpp.obj \r\n/home/summivox/.espressif/tools/xtensa-esp32-elf/esp-2020r3-8.4.0/xtensa-esp32-elf/bin/xtensa-esp32-elf-g++  -DHAVE_CONFIG_H -DMBEDTLS_CONFIG_FILE=\\\"mbedtls/esp_config.h\\\" -DUNITY_INCLUDE_CONFIG_H -DWITH_POSIX -Iconfig -I../main -I/home/summivox/lib/esp-idf/components/newlib/platform_include -I/home/summivox/lib/esp-idf/components/freertos/include -I/home/summivox/lib/esp-idf/components/freertos/port/xtensa/include -I/home/summivox/lib/esp-idf/components/esp_hw_support/include -I/home/summivox/lib/esp-idf/components/esp_hw_support/port/esp32/. -I/home/summivox/lib/esp-idf/components/heap/include -I/home/summivox/lib/esp-idf/components/log/include -I/home/summivox/lib/esp-idf/components/lwip/include/apps -I/home/summivox/lib/esp-idf/components/lwip/include/apps/sntp -I/home/summivox/lib/esp-idf/components/lwip/lwip/src/include -I/home/summivox/lib/esp-idf/components/lwip/port/esp32/include -I/home/summivox/lib/esp-idf/components/lwip/port/esp32/include/arch -I/home/summivox/lib/esp-idf/components/soc/include -I/home/summivox/lib/esp-idf/components/soc/esp32/. -I/home/summivox/lib/esp-idf/components/soc/esp32/include -I/home/summivox/lib/esp-idf/components/hal/esp32/include -I/home/summivox/lib/esp-idf/components/hal/include -I/home/summivox/lib/esp-idf/components/esp_rom/include -I/home/summivox/lib/esp-idf/components/esp_rom/esp32 -I/home/summivox/lib/esp-idf/components/esp_common/include -I/home/summivox/lib/esp-idf/components/esp_system/include -I/home/summivox/lib/esp-idf/components/esp32/include -I/home/summivox/lib/esp-idf/components/driver/include -I/home/summivox/lib/esp-idf/components/driver/esp32/include -I/home/summivox/lib/esp-idf/components/esp_ringbuf/include -I/home/summivox/lib/esp-idf/components/efuse/include -I/home/summivox/lib/esp-idf/components/efuse/esp32/include -I/home/summivox/lib/esp-idf/components/xtensa/include -I/home/summivox/lib/esp-idf/components/xtensa/esp32/include -I/home/summivox/lib/esp-idf/components/espcoredump/include -I/home/summivox/lib/esp-idf/components/esp_timer/include -I/home/summivox/lib/esp-idf/components/esp_ipc/include -I/home/summivox/lib/esp-idf/components/esp_pm/include -I/home/summivox/lib/esp-idf/components/vfs/include -I/home/summivox/lib/esp-idf/components/esp_wifi/include -I/home/summivox/lib/esp-idf/components/esp_wifi/esp32/include -I/home/summivox/lib/esp-idf/components/esp_event/include -I/home/summivox/lib/esp-idf/components/esp_netif/include -I/home/summivox/lib/esp-idf/components/esp_eth/include -I/home/summivox/lib/esp-idf/components/tcpip_adapter/include -I/home/summivox/lib/esp-idf/components/app_trace/include -I/home/summivox/lib/esp-idf/components/mbedtls/port/include -I/home/summivox/lib/esp-idf/components/mbedtls/mbedtls/include -I/home/summivox/lib/esp-idf/components/mbedtls/esp_crt_bundle/include -I/home/summivox/lib/esp-idf/components/bootloader_support/include -I/home/summivox/lib/esp-idf/components/app_update/include -I/home/summivox/lib/esp-idf/components/spi_flash/include -I/home/summivox/lib/esp-idf/components/nvs_flash/include -I/home/summivox/lib/esp-idf/components/pthread/include -I/home/summivox/lib/esp-idf/components/esp_gdbstub/include -I/home/summivox/lib/esp-idf/components/esp_gdbstub/xtensa -I/home/summivox/lib/esp-idf/components/esp_gdbstub/esp32 -I/home/summivox/lib/esp-idf/components/wpa_supplicant/include -I/home/summivox/lib/esp-idf/components/wpa_supplicant/port/include -I/home/summivox/lib/esp-idf/components/wpa_supplicant/include/esp_supplicant -I/home/summivox/lib/esp-idf/components/perfmon/include -I/home/summivox/lib/esp-idf/components/asio/asio/asio/include -I/home/summivox/lib/esp-idf/components/asio/port/include -I/home/summivox/lib/esp-idf/components/cbor/port/include -I/home/summivox/lib/esp-idf/components/unity/include -I/home/summivox/lib/esp-idf/components/unity/unity/src -I/home/summivox/lib/esp-idf/components/cmock/CMock/src -I/home/summivox/lib/esp-idf/components/coap/port/include -I/home/summivox/lib/esp-idf/components/coap/port/include/coap -I/home/summivox/lib/espummivox/lib/esp-idf/components/coap/libcoap/include/coap2 -I/home/summivox/lib/esp-idf/components/console -I/home/summivox/lib/esp-idf/components/nghttp/port/include -I/home/summivox/lib/esp-idf/components/nghttp/nghttp2/lib/includes -I/home/summivox/lib/esp-idf/components/esp-tls -I/home/summivox/lib/esp-idf/components/esp-tls/esp-tls-crypto -I/home/summivox/lib/esp-idf/components/esp_adc_cal/include -I/home/summivox/lib/esp-idf/components/esp_hid/include -I/home/summivox/lib/esp-idf/components/tcp_transport/include -I/home/summivox/lib/esp-idf/components/esp_http_client/include -I/home/summivox/lib/esp-idf/components/esp_http_server/include -I/home/summivox/lib/esp-idf/components/esp_https_ota/include -I/home/summivox/lib/esp-idf/components/esp_littlefs/src -I/home/summivox/lib/esp-idf/components/esp_littlefs/include -I/home/summivox/lib/esp-idf/components/protobuf-c/protobuf-c -I/home/summivox/lib/esp-idf/components/protocomm/include/common -I/home/summivox/lib/esp-idf/components/protocomm/include/security -I/home/summivox/lib/esp-idf/components/protocomm/include/transports -I/home/summivox/lib/esp-idf/components/mdns/include -I/home/summivox/lib/esp-idf/components/esp_local_ctrl/include -I/home/summivox/lib/esp-idf/components/sdmmc/include -I/home/summivox/lib/esp-idf/components/esp_serial_slave_link/include -I/home/summivox/lib/esp-idf/components/esp_websocket_client/include -I/home/summivox/lib/esp-idf/components/expat/expat/expat/lib -I/home/summivox/lib/esp-idf/components/expat/port/include -I/home/summivox/lib/esp-idf/components/wear_levelling/include -I/home/summivox/lib/esp-idf/components/fatfs/diskio -I/home/summivox/lib/esp-idf/components/fatfs/vfs -I/home/summivox/lib/esp-idf/components/fatfs/src -I/home/summivox/lib/esp-idf/components/freemodbus/common/include -I/home/summivox/lib/esp-idf/components/idf_test/include -I/home/summivox/lib/esp-idf/components/idf_test/include/esp32 -I/home/summivox/lib/esp-idf/components/jsmn/include -I/home/summivox/lib/esp-idf/components/json/cJSON -I/home/summivox/lib/esp-idf/components/libsodium/libsodium/src/libsodium/include -I/home/summivox/lib/esp-idf/components/libsodium/port_include -I/home/summivox/lib/esp-idf/components/mqtt/esp-mqtt/include -I/home/summivox/lib/esp-idf/components/openssl/include -I/home/summivox/lib/esp-idf/components/spiffs/include -I/home/summivox/lib/esp-idf/components/ulp/include -I/home/summivox/lib/esp-idf/components/wifi_provisioning/include -I../components/fmtlib/fmt/include -I../components/minmea/minmea -mlongcalls -Wno-frame-address   -ffunction-sections -fdata-sections -fstrict-volatile-bitfields -Wall -Werror=all -Wno-error=unused-function -Wno-error=unused-but-set-variable -Wno-error=unused-variable -Wno-error=deprecated-declarations -Wextra -Wno-unused-parameter -Wno-sign-compare -ggdb -O2 -std=gnu++11 -fno-exceptions -fno-rtti -D_GNU_SOURCE -DIDF_VER=\\\"v4.3-dev-2398-g2bfdd036b-dirty\\\" -DESP_PLATFORM -std=gnu++2a -MD -MT esp-idf/main/CMakeFiles/__idf_main.dir/app_main.cpp.obj -MF esp-idf/main/CMakeFiles/__idf_main.dir/app_main.cpp.obj.d -o esp-idf/main/CMakeFiles/__idf_main.dir/app_main.cpp.obj -c ../main/app_main.cpp\r\nIn file included from ../main/app_main.cpp:10:\r\n../components/fmtlib/fmt/include/fmt/compile.h: In instantiation of 'constexpr auto fmt::v7::detail::compile_format_string(S) [with Args = fmt::v7::detail::type_list<int>; unsigned int POS = 0; int ID = 0; S = MainTask(void*)::<lambda()>::FMT_COMPILE_STRING]':\r\n../components/fmtlib/fmt/include/fmt/compile.h:598:72:   required from 'constexpr auto fmt::v7::detail::compile(S) [with Args = {int}; S = MainTask(void*)::<lambda()>::FMT_COMPILE_STRING; typename std::enable_if<(fmt::v7::is_compile_string<S>::value || fmt::v7::detail::is_compiled_string<S>::value), int>::type <anonymous> = 0]'\r\n../components/fmtlib/fmt/include/fmt/compile.h:677:53:   required from 'std::__cxx11::basic_string<typename S::char_type> fmt::v7::format(const S&, Args&& ...) [with S = MainTask(void*)::<lambda()>::FMT_COMPILE_STRING; Args = {int}; typename std::enable_if<fmt::v7::detail::is_compiled_string<S>::value, int>::type <anonymous> = 0; typename S::char_type = char; typename Context::char_type = char]'\r\n../main/app_main.cpp:63:48:   required from here\r\n../components/fmtlib/fmt/include/fmt/compile.h:558:58: error: exception handling disabled, use -fexceptions to enable\r\n       throw format_error(\"unmatched '{' in format string\");\r\n                                                          ^\r\nninja: build stopped: subcommand failed.\r\nThe terminal process terminated with exit code: 1.\r\n\r\n```\r\n\r\n**Workaround**:\r\n```cpp\r\nauto result = fmt::format(fmt::compile(\"{}\"), 12345);\r\n```\r\nThis does compile, but complains about `fmt::compile` being deprecated.\r\n\r\n**Investigation**:\r\nHere: https://github.com/fmtlib/fmt/blob/373262f9fbacab7d868ab10f1f0b20978c096572/include/fmt/compile.h#L553\r\nEven though I had no prior experience with debugging constexpr stuff in compile time, after inserting some \"if (...) throw ...\", I found out that `format_str.size() == 1` which does not make sense.\r\n","closed_by":{"login":"vitaut","id":576385,"node_id":"MDQ6VXNlcjU3NjM4NQ==","avatar_url":"https://avatars.githubusercontent.com/u/576385?v=4","gravatar_id":"","url":"https://api.github.com/users/vitaut","html_url":"https://github.com/vitaut","followers_url":"https://api.github.com/users/vitaut/followers","following_url":"https://api.github.com/users/vitaut/following{/other_user}","gists_url":"https://api.github.com/users/vitaut/gists{/gist_id}","starred_url":"https://api.github.com/users/vitaut/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vitaut/subscriptions","organizations_url":"https://api.github.com/users/vitaut/orgs","repos_url":"https://api.github.com/users/vitaut/repos","events_url":"https://api.github.com/users/vitaut/events{/privacy}","received_events_url":"https://api.github.com/users/vitaut/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/fmtlib/fmt/issues/2116/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/fmtlib/fmt/issues/2116/timeline","performed_via_github_app":null,"state_reason":"completed"}