<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:35:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SHIRO-323] DelegatingSubject class cannot be serialized.</title>
                <link>https://issues.apache.org/jira/browse/SHIRO-323</link>
                <project id="12310950" key="SHIRO">Shiro</project>
                    <description>&lt;p&gt;I am attempting to send a instance of DelegatingSubject over a JMS topic via serialization, however when I send the object through JMS I get this Exception&lt;/p&gt;


&lt;p&gt;java.lang.RuntimeException: org.apache.shiro.subject.support.DelegatingSubject$StoppingAwareProxiedSession&lt;br/&gt;
	at org.apache.activemq.command.ActiveMQObjectMessage.storeContent(ActiveMQObjectMessage.java:111) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-all-5.6-SNAPSHOT.jar:5.6-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.activemq.command.ActiveMQObjectMessage.setObject(ActiveMQObjectMessage.java:162) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-all-5.6-SNAPSHOT.jar:5.6-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at com.xmlnamespace.panel.server.core.communication.event.EventManager.doSendMessage(EventManager.java:233) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;com.xmlnamespace.panel.server.core/:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at com.xmlnamespace.panel.server.core.communication.event.EventManager.sendMessage(EventManager.java:208) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;com.xmlnamespace.panel.server.core/:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at com.xmlnamespace.panel.server.core.communication.mtl.ModelDispatcher.add(ModelDispatcher.java:122) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;com.xmlnamespace.panel.server.core/:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at com.xmlnamespace.panel.server.core.communication.mtl.ModelDispatcher.collectionChange(ModelDispatcher.java:181) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;com.xmlnamespace.panel.server.core/:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at com.xmlnamespace.panel.core.shared.communication.mtl.api.CollectionChangeSupport.doFireCollectionChange(CollectionChangeSupport.java:182) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;shared-objects.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at com.xmlnamespace.panel.core.shared.communication.mtl.api.CollectionChangeSupport.fireCollectionChange(CollectionChangeSupport.java:47) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;shared-objects.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at com.xmlnamespace.panel.core.shared.user.model.internal.UserModelImpl.addUserLogin(UserModelImpl.java:96) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;shared-objects.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at com.xmlnamespace.panel.server.core.login.LoginManager.authenticateConnection(LoginManager.java:1013) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;com.xmlnamespace.panel.server.core/:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at com.xmlnamespace.panel.server.core.communication.broker.BrokerAuthenticationFilter.addConnection(BrokerAuthenticationFilter.java:69) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;com.xmlnamespace.panel.server.core/:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.activemq.broker.MutableBrokerFilter.addConnection(MutableBrokerFilter.java:91) &lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-all-5.6-SNAPSHOT.jar:5.6-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.activemq.broker.TransportConnection.processAddConnection(TransportConnection.java:705) &lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-all-5.6-SNAPSHOT.jar:5.6-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.activemq.broker.jmx.ManagedTransportConnection.processAddConnection(ManagedTransportConnection.java:83) &lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-all-5.6-SNAPSHOT.jar:5.6-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.activemq.command.ConnectionInfo.visit(ConnectionInfo.java:139) &lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-all-5.6-SNAPSHOT.jar:5.6-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:316) &lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-all-5.6-SNAPSHOT.jar:5.6-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:180) &lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-all-5.6-SNAPSHOT.jar:5.6-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:69) &lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-all-5.6-SNAPSHOT.jar:5.6-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113) &lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-all-5.6-SNAPSHOT.jar:5.6-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:227) &lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-all-5.6-SNAPSHOT.jar:5.6-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83) &lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-all-5.6-SNAPSHOT.jar:5.6-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.activemq.transport.tcp.SslTransport.doConsume(SslTransport.java:91) &lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-all-5.6-SNAPSHOT.jar:5.6-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:217) &lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-all-5.6-SNAPSHOT.jar:5.6-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:199) &lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-all-5.6-SNAPSHOT.jar:5.6-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:662) &lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.6.0_26&amp;#93;&lt;/span&gt;&lt;br/&gt;
Caused by: java.io.NotSerializableException: org.apache.shiro.subject.support.DelegatingSubject$StoppingAwareProxiedSession&lt;br/&gt;
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1164) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.6.0_26&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1518) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.6.0_26&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1483) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.6.0_26&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1400) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.6.0_26&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1158) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.6.0_26&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1518) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.6.0_26&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1483) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.6.0_26&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1400) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.6.0_26&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1158) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.6.0_26&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:330) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.6.0_26&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.activemq.command.ActiveMQObjectMessage.storeContent(ActiveMQObjectMessage.java:105) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-all-5.6-SNAPSHOT.jar:5.6-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	... 24 common frames omitted&lt;/p&gt;

&lt;p&gt;I assume that DelegatingSubject is meant to be serialized since it does implement serializable. I noticed that the class inner class StoppingAwareProxiedSession is the culprit. Would the issue be resolved by simply making the Session interface, ProxiedSession class, and StoppingAwareProxiedSession serializable? &lt;/p&gt;</description>
                <environment>Linux</environment>
        <key id="12523390">SHIRO-323</key>
            <summary>DelegatingSubject class cannot be serialized.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lhazlewood">Les Hazlewood</assignee>
                                    <reporter username="mwolf9">Michael Yara</reporter>
                        <labels>
                            <label>serialization</label>
                    </labels>
                <created>Fri, 16 Sep 2011 20:42:29 +0000</created>
                <updated>Fri, 30 Oct 2015 03:10:24 +0000</updated>
                            <resolved>Sat, 7 Jan 2012 03:59:41 +0000</resolved>
                                    <version>1.1.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>Subject</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13176694" author="lhazlewood" created="Wed, 28 Dec 2011 16:00:29 +0000"  >&lt;p&gt;Hi Michael,&lt;/p&gt;

&lt;p&gt;I&apos;m not sure if the DelegatingSubject should be serializable: the implementation always needs a SecurityManager to function, and a SecurityManager instance is not serializable.  If a DelegatingSubject instance was passed across the wire, something would need to acquire the local SecurityManager, associate it with the de-serialized DelegatingSubject, and then bind it to the thread for duration of the invocation.&lt;/p&gt;

&lt;p&gt;Did you get this working in your JMS environment?  If so, how?  Did you use the Subject.Builder to recreate the Subject on the receiving side?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Les&lt;/p&gt;</comment>
                            <comment id="13176713" author="mwolf9" created="Wed, 28 Dec 2011 17:29:07 +0000"  >&lt;p&gt;Les,&lt;/p&gt;

&lt;p&gt;I never actually got this part working since this piece got placed on the back burner of our current project. &lt;/p&gt;

&lt;p&gt;Here are some details on what we currently have and what we are trying to accomplish:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Our system is a client server system utilizing JMS for communication.&lt;/li&gt;
	&lt;li&gt;User authentication is preformed via the JMS Broker utilizing a custom authentication plugin so when the clients authenticate they are actually authenticating with the broker.&lt;/li&gt;
	&lt;li&gt;The Broker plugin intercepts the authentication request and passes it off to a custom class that utilizes Shiro to perform the final authentication and reports the authentication status to the broker plugin.&lt;/li&gt;
	&lt;li&gt;The server side holds a model of the currently logged in users utilizing the created Shiro objects.&lt;/li&gt;
	&lt;li&gt;We have developed a proprietary one way persistence framework to persist models between the server and the client. This framework utilizes serialization with Java reflection over JMS.&lt;/li&gt;
	&lt;li&gt;Our goal is to persist the user model to the client in order for the client to determine it&apos;s permissions/authorization client side for specific actions without having to send messages back to the server for authorization of these actions.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I believe i was planning on creating another client side instance of the SecurityManager.&lt;br/&gt;
I am not using the Subject.Builder to make the subjects. i am using the org.apache.shiro.subject.support.DelegatingSubject.DelegatingSubject(SecurityManager securityManager) constructor.&lt;/p&gt;

&lt;p&gt;I am very new to Shiro so I may be taking the completely wrong path and I understand that this is a very unique implementation and not exactly a standard. Any advice on this would be helpful.&lt;/p&gt;





</comment>
                            <comment id="13177678" author="lhazlewood" created="Fri, 30 Dec 2011 15:37:32 +0000"  >&lt;p&gt;Hi Michael,&lt;/p&gt;

&lt;p&gt;The DelegatingSubject is an implementation class typically not exposed to Shiro API end-users.  Probably the best way to solve your problem is the following:&lt;/p&gt;

&lt;p&gt;When sending a message, attach to the message (e.g. as a header, or part of the payload) the information Shiro needs to re-create the Subject instance on the message consumer side.  Typically this will be subject.getPrincipals(), the authentication state (i.e. subject.isAuthenticated()) and the host (subject.getHost()).  I wouldn&apos;t send the session across the wire as that would imply a lot of plumbing to get that to work correctly as well as potential performance issues if the Session is large.&lt;/p&gt;

&lt;p&gt;The message consumer side retrieves the information attached to the message and uses the Subject.Builder to re-create the Subject instance on that side of the wire.  Once re-created, bind the Subject to the thread if you want SecurityUtils.getSubject() to work during the message processing thread (most people use subject.execute() to do this automatically - see Shiro&apos;s Subject documentation and &apos;Thread Association&apos;: &lt;a href=&quot;http://shiro.apache.org/subject.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://shiro.apache.org/subject.html&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;And yes, I would have two Shiro SecurityManager instances - one on the message producer side, the other on the message consumer side.  You will need a SecurityManager to use the Subject.Builder correctly.&lt;/p&gt;

&lt;p&gt;Now, given this result, perhaps the resolution to this issue should be that DelegatingSubject &lt;em&gt;should not&lt;/em&gt; implement serializable?&lt;/p&gt;</comment>
                            <comment id="13177679" author="lhazlewood" created="Fri, 30 Dec 2011 15:40:26 +0000"  >&lt;p&gt;P.S. Can we please keep architectural discussions and associated help on the user list?  These types of discussions in a Jira issue are hard to grok for the development team.  Thanks!&lt;/p&gt;</comment>
                            <comment id="13181838" author="lhazlewood" created="Sat, 7 Jan 2012 03:59:41 +0000"  >&lt;p&gt;I removed Serializable from the implements clause.  DelegatingSubject was never really intended to function automatically across VM boundaries.  The Subject.Builder should be used to reconstitute Subject instances across VM boundaries.&lt;/p&gt;</comment>
                            <comment id="13191751" author="lhazlewood" created="Tue, 24 Jan 2012 01:11:42 +0000"  >&lt;p&gt;Closing with the 1.2.0 release.&lt;/p&gt;</comment>
                            <comment id="14981803" author="frankis.x.hummel" created="Fri, 30 Oct 2015 03:10:24 +0000"  >&lt;p&gt;Dear Les:&lt;br/&gt;
        I have encountered this problem when tried to serialize the Subject object in my application.I am developing an distributed application,and the Subject will generate at the Provider end,then I restore it in redis and in Consumer end find it use sessionId.&lt;br/&gt;
but when debugging I get an Exception says DelegatingSubject cannot be serialized...I have tried to decrease the version of Shiro to 1.0.0-incubating,whose Subject had implemented the Java.io.Serizlizable interface so that can be serialized.But I find its contents seems not complete  in redis server,can you give me some advices,I will very appreciate it &lt;span class=&quot;error&quot;&gt;Unable to render embedded object: File (Lookkkkkking forward to your reply) not found.&lt;/span&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>60352</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 3 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i102h3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>208535</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>