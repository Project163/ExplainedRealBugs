<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:34:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SHIRO-156] SimpleAuthenticationInfo.merge does not merge principals if its internal principal collection is not mutable</title>
                <link>https://issues.apache.org/jira/browse/SHIRO-156</link>
                <project id="12310950" key="SHIRO">Shiro</project>
                    <description>&lt;p&gt;In SimpleAuthenticationInfo.merge(AuthenticationInfo), there is the following code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.principals == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.principals = info.getPrincipals();
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.principals &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; MutablePrincipalCollection) {
                ((MutablePrincipalCollection) &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.principals).addAll(info.getPrincipals());
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.principals = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimplePrincipalCollection(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.principals);
            }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The logic in the nested else block appears incorrect. If the current &quot;principals&quot; collection is not MutablePrincipalCollection, a new SimplePrincipalCollection, which is mutable, is constructed from it. However, it does not copy the principals from other.getPrincipals(), which by that point in the method is known to be non-null and non-empty, after it makes a mutable principal collection.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12464073">SHIRO-156</key>
            <summary>SimpleAuthenticationInfo.merge does not merge principals if its internal principal collection is not mutable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kaosko">Kalle Korhonen</assignee>
                                    <reporter username="bturner">Bryan Turner</reporter>
                        <labels>
                    </labels>
                <created>Sun, 9 May 2010 04:21:44 +0000</created>
                <updated>Fri, 11 Jun 2010 22:01:06 +0000</updated>
                            <resolved>Sat, 15 May 2010 05:45:02 +0000</resolved>
                                    <version>0.9</version>
                                    <fixVersion>1.0.0</fixVersion>
                                    <component>Authentication (log-in)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12865534" author="bturner" created="Sun, 9 May 2010 04:24:54 +0000"  >&lt;p&gt;I believe the logic should look like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.principals == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) { 
            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.principals = info.getPrincipals(); 
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; { 
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.principals &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; MutablePrincipalCollection)) { 
                &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.principals = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimplePrincipalCollection(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.principals); 
            }
            ((MutablePrincipalCollection) &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.principals).addAll(info.getPrincipals()); 
        } 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This will transform the internal principal collection into a mutable one if necessary and will always merge info.getPrincipals() into it.&lt;/p&gt;</comment>
                            <comment id="12865535" author="lhazlewood" created="Sun, 9 May 2010 04:27:20 +0000"  >&lt;p&gt;Scheduling for 1.0 since this will be easy to fix&lt;/p&gt;</comment>
                            <comment id="12865551" author="kaosko" created="Sun, 9 May 2010 06:31:10 +0000"  >&lt;p&gt;I&apos;ll throw in a unit test for good measure as well.&lt;/p&gt;</comment>
                            <comment id="12867562" author="kaosko" created="Fri, 14 May 2010 17:00:11 +0000"  >&lt;p&gt;The suggested change does what is intended, but is this the right thing to do? I mean, if the the collection is meant as immutable, shouldn&apos;t merge just throw an exception rather than make it mutable?&lt;/p&gt;</comment>
                            <comment id="12867765" author="lhazlewood" created="Sat, 15 May 2010 00:47:44 +0000"  >&lt;p&gt;I think it&apos;s ok that the new PrincipalCollection is mutable - it is really there as an aggregation construct to pull in data from all realms, and to just add to what might exist already.  If we wanted to create a new immutable PrincipalCollection every time, that would be OK too (and probably a little safer).  We just don&apos;t have an immutable PrincipalCollection implementation at the moment.&lt;/p&gt;</comment>
                            <comment id="12878091" author="lhazlewood" created="Fri, 11 Jun 2010 22:01:06 +0000"  >&lt;p&gt;Closing all resolved issues due to a successful 1.0.0-incubating release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>174887</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 24 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0jxzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114439</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>