diff --git a/client/src/main/java/org/apache/qpid/client/AMQConnection.java b/client/src/main/java/org/apache/qpid/client/AMQConnection.java
index 8ebb0b89e..690423550 100644
--- a/client/src/main/java/org/apache/qpid/client/AMQConnection.java
+++ b/client/src/main/java/org/apache/qpid/client/AMQConnection.java
@@ -1818,47 +1818,6 @@ public class AMQConnection extends Closeable implements CommonConnection, Refere
         return _messageCompressionThresholdSize;
     }
 
-    void doWithAllLocks(Runnable r)
-    {
-        doWithAllLocks(r, _sessions.values());
-
-    }
-
-    private void doWithAllLocks(final Runnable r, final List<AMQSession> sessions)
-    {
-        if (!sessions.isEmpty())
-        {
-            AMQSession session = sessions.remove(0);
-
-            final Object dispatcherLock = session.getDispatcherLock();
-            if (dispatcherLock != null)
-            {
-                synchronized (dispatcherLock)
-                {
-                    synchronized (session.getMessageDeliveryLock())
-                    {
-                        doWithAllLocks(r, sessions);
-                    }
-                }
-            }
-            else
-            {
-                synchronized (session.getMessageDeliveryLock())
-                {
-                    doWithAllLocks(r, sessions);
-                }
-            }
-        }
-        else
-        {
-            synchronized (getFailoverMutex())
-            {
-                r.run();
-            }
-        }
-    }
-
-
     public String getTemporaryQueuePrefix()
     {
         if(_delegate.isVirtualHostPropertiesSupported())
diff --git a/client/src/main/java/org/apache/qpid/client/AMQConnectionDelegate_0_10.java b/client/src/main/java/org/apache/qpid/client/AMQConnectionDelegate_0_10.java
index 0cb3800d3..410424d0e 100644
--- a/client/src/main/java/org/apache/qpid/client/AMQConnectionDelegate_0_10.java
+++ b/client/src/main/java/org/apache/qpid/client/AMQConnectionDelegate_0_10.java
@@ -313,7 +313,7 @@ public class AMQConnectionDelegate_0_10 implements AMQConnectionDelegate, Connec
 
             final AtomicBoolean failoverDone = new AtomicBoolean();
 
-            _conn.doWithAllLocks(new Runnable()
+            ConnectionHelper.doWithAllConnectionAndSessionLocks(_conn, new Runnable()
             {
                 @Override
                 public void run()
diff --git a/client/src/main/java/org/apache/qpid/client/AMQSession.java b/client/src/main/java/org/apache/qpid/client/AMQSession.java
index a84c093d8..d0ef2e314 100644
--- a/client/src/main/java/org/apache/qpid/client/AMQSession.java
+++ b/client/src/main/java/org/apache/qpid/client/AMQSession.java
@@ -3693,17 +3693,24 @@ public abstract class AMQSession<C extends BasicMessageConsumer, P extends Basic
     {
         if (!_queue.isEmpty())
         {
-            setUsingDispatcherForCleanup(true);
-            drainDispatchQueue();
-            setUsingDispatcherForCleanup(false);
+            try
+            {
+                setUsingDispatcherForCleanup(true);
+                drainDispatchQueue();
+            }
+            finally
+            {
+                setUsingDispatcherForCleanup(false);
+            }
         }
     }
 
     protected void stopExistingDispatcher()
     {
-        if (_dispatcher != null)
+        Dispatcher dispatcher = _dispatcher;
+        if (dispatcher != null)
         {
-            _dispatcher.setConnectionStopped(true);
+            dispatcher.setConnectionStopped(true);
         }
     }
 
@@ -3714,5 +3721,10 @@ public abstract class AMQSession<C extends BasicMessageConsumer, P extends Basic
             suspendChannel(true);
         }
     }
+
+    protected void clearDispatchQueue()
+    {
+        _queue.clear();
+    }
 }
 
diff --git a/client/src/main/java/org/apache/qpid/client/AMQSession_0_8.java b/client/src/main/java/org/apache/qpid/client/AMQSession_0_8.java
index e62ac8f95..259a5bab9 100644
--- a/client/src/main/java/org/apache/qpid/client/AMQSession_0_8.java
+++ b/client/src/main/java/org/apache/qpid/client/AMQSession_0_8.java
@@ -182,8 +182,7 @@ public class AMQSession_0_8 extends AMQSession<BasicMessageConsumer_0_8, BasicMe
     @Override
     void resubscribe() throws QpidException
     {
-        // drain dispatch queue
-        drainDispatchQueueWithDispatcher();
+        clearDispatchQueue();
 
         getDeliveredMessageTags().clear();
         super.resubscribe();
diff --git a/client/src/main/java/org/apache/qpid/client/ConnectionHelper.java b/client/src/main/java/org/apache/qpid/client/ConnectionHelper.java
new file mode 100644
index 000000000..95a405379
--- /dev/null
+++ b/client/src/main/java/org/apache/qpid/client/ConnectionHelper.java
@@ -0,0 +1,65 @@
+/*
+ *
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *   http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing,
+ * software distributed under the License is distributed on an
+ * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+ * KIND, either express or implied.  See the License for the
+ * specific language governing permissions and limitations
+ * under the License.
+ *
+ */
+package org.apache.qpid.client;
+
+import java.util.List;
+
+public class ConnectionHelper
+{
+
+    public static void doWithAllConnectionAndSessionLocks(AMQConnection connection, Runnable runnable)
+    {
+        doWithAllLocks(runnable, connection.getSessions().values(), connection.getFailoverMutex());
+    }
+
+    private static void doWithAllLocks(final Runnable r, final List<AMQSession> sessions, Object failoverMutex)
+    {
+        if (!sessions.isEmpty())
+        {
+            AMQSession session = sessions.remove(0);
+            final Object dispatcherLock = session.getDispatcherLock();
+            if (dispatcherLock != null)
+            {
+                synchronized (dispatcherLock)
+                {
+                    synchronized (session.getMessageDeliveryLock())
+                    {
+                        doWithAllLocks(r, sessions, failoverMutex);
+                    }
+                }
+            }
+            else
+            {
+                synchronized (session.getMessageDeliveryLock())
+                {
+                    doWithAllLocks(r, sessions, failoverMutex);
+                }
+            }
+        }
+        else
+        {
+            synchronized (failoverMutex)
+            {
+                r.run();
+            }
+        }
+    }
+}
diff --git a/client/src/main/java/org/apache/qpid/client/failover/FailoverHandler.java b/client/src/main/java/org/apache/qpid/client/failover/FailoverHandler.java
index 7331540c8..e298953df 100644
--- a/client/src/main/java/org/apache/qpid/client/failover/FailoverHandler.java
+++ b/client/src/main/java/org/apache/qpid/client/failover/FailoverHandler.java
@@ -23,6 +23,7 @@ package org.apache.qpid.client.failover;
 import java.util.concurrent.CountDownLatch;
 
 import org.apache.qpid.client.AMQConnection;
+import org.apache.qpid.client.ConnectionHelper;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -118,10 +119,23 @@ public class FailoverHandler implements Runnable
 
         final AMQConnection connection = _amqProtocolHandler.getConnection();
 
-        // Since failover impacts several structures we protect them all with a single mutex. These structures
-        // are also in child objects of the connection. This allows us to manipulate them without affecting
-        // client code which runs in a separate thread.
-        synchronized (connection.getFailoverMutex())
+        ConnectionHelper.doWithAllConnectionAndSessionLocks(connection, new Runnable()
+        {
+            @Override
+            public void run()
+            {
+                performFailover();
+            }
+        });
+
+        _amqProtocolHandler.getFailoverLatch().countDown();
+    }
+
+    private void performFailover()
+    {
+        AMQConnection connection = _amqProtocolHandler.getConnection();
+
+        // brace to keep indentation
         {
             //Clear the exception now that we have the failover mutex there can be no one else waiting for a frame so
             // we can clear the exception.
@@ -236,8 +250,6 @@ public class FailoverHandler implements Runnable
                 }
             }
         }
-
-        _amqProtocolHandler.getFailoverLatch().countDown();
     }
 
     /**
diff --git a/client/src/main/java/org/apache/qpid/client/util/FlowControllingBlockingQueue.java b/client/src/main/java/org/apache/qpid/client/util/FlowControllingBlockingQueue.java
index 41f263b5d..fd7ca02da 100644
--- a/client/src/main/java/org/apache/qpid/client/util/FlowControllingBlockingQueue.java
+++ b/client/src/main/java/org/apache/qpid/client/util/FlowControllingBlockingQueue.java
@@ -172,6 +172,26 @@ public class FlowControllingBlockingQueue<T>
         return _queue.iterator();
     }
 
+    public void clear()
+    {
+        _queue.clear();
+
+        if (!disableFlowControl && _listener != null)
+        {
+            synchronized (_listener)
+            {
+                int count = _count;
+                _count = 0;
+
+                if (count >= _flowControlLowThreshold)
+                {
+                    _listener.underThreshold(0);
+                }
+            }
+
+        }
+    }
+
     private void reportAboveIfNecessary()
     {
         synchronized (_listener)
