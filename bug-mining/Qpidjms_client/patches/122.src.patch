diff --git a/client/src/test/java/org/apache/qpid/test/unit/topic/TopicSessionTest.java b/client/src/test/java/org/apache/qpid/test/unit/topic/TopicSessionTest.java
index 31862cf5c..3479dfae0 100644
--- a/client/src/test/java/org/apache/qpid/test/unit/topic/TopicSessionTest.java
+++ b/client/src/test/java/org/apache/qpid/test/unit/topic/TopicSessionTest.java
@@ -339,7 +339,7 @@ public class TopicSessionTest extends QpidTestCase
         m = (TextMessage) noLocal.receive(100);
         assertNull(m);
 
-        AMQConnection con2 = (AMQConnection) getConnection("guest", "guest");
+        AMQConnection con2 = (AMQConnection) getConnection("guest", "guest", "foo");
         TopicSession session2 = con2.createTopicSession(false, AMQSession.NO_ACKNOWLEDGE);
         TopicPublisher publisher2 = session2.createPublisher(topic);
 
diff --git a/client/src/test/java/org/apache/qpid/testutil/QpidTestCase.java b/client/src/test/java/org/apache/qpid/testutil/QpidTestCase.java
index ca9bdee51..094790fb7 100644
--- a/client/src/test/java/org/apache/qpid/testutil/QpidTestCase.java
+++ b/client/src/test/java/org/apache/qpid/testutil/QpidTestCase.java
@@ -238,4 +238,19 @@ public class QpidTestCase extends TestCase
         }
         return con;
     }
+
+     public Connection getConnection(String username, String password, String id) throws Exception
+    {
+        _logger.info("get Connection");
+        Connection con;
+        if (_shel.equals(BROKER_VM))
+        {
+            con = new AMQConnection("vm://:1", username, password, id, "test");
+        }
+        else
+        {
+            con = getConnectionFactory().createConnection(username, password);
+        }
+        return con;
+    }
 }
