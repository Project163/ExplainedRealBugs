<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:21:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-3177] JMS Failover Not Working</title>
                <link>https://issues.apache.org/jira/browse/QPID-3177</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;The JMS failover is not working due to a regression introduced in rev 1071631.&lt;br/&gt;
More specifically the reason is the following line being removed.&lt;/p&gt;

&lt;p&gt;@@ -257,12 +256,14 @@&lt;br/&gt;
         ConnectionClose close = exc.getClose();&lt;br/&gt;
         if (close == null)&lt;br/&gt;
         {&lt;br/&gt;
+            _conn.getProtocolHandler().setFailoverLatch(new CountDownLatch(1));&lt;br/&gt;
+            &lt;br/&gt;
             try&lt;br/&gt;
             {&lt;br/&gt;
                 if (_conn.firePreFailover(false) &amp;amp;&amp;amp; _conn.attemptReconnection())&lt;/p&gt;
                 {
                     _conn.failoverPrep();
-                    _qpidConnection.resume();   ---- &amp;gt; This line is removed in this commit.
+                    _conn.resubscribeSessions();
                     _conn.fireFailoverComplete();
                     return;
                 }

&lt;p&gt;On the surface this seems like a unintended omission. However I&apos;d like to investigate it further and find out if this was intentional.&lt;br/&gt;
It if it was, then what was the reason behind it? &lt;/p&gt;

&lt;p&gt;The obvious fix is to re-introduce this line. I have done so and preliminary tests indicates that it will resolve the issue. I haven&apos;t seen any other issues.&lt;br/&gt;
However I&apos;d like to look at more information regarding the context of the above change before making a final decision.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12503076">QPID-3177</key>
            <summary>JMS Failover Not Working</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="robbie">Robbie Gemmell</assignee>
                                    <reporter username="rajith">Rajith Muditha Attapattu</reporter>
                        <labels>
                    </labels>
                <created>Thu, 31 Mar 2011 21:24:16 +0000</created>
                <updated>Tue, 14 Mar 2017 20:07:17 +0000</updated>
                            <resolved>Tue, 5 Apr 2011 16:06:32 +0000</resolved>
                                    <version>0.10</version>
                                    <fixVersion>0.10</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13014817" author="andrew.kennedy" created="Fri, 1 Apr 2011 20:47:01 +0000"  >&lt;p&gt;Yes, this is accidental. Thank&apos;s for spotting it. I had intended to refactor this more completely, and part of that involved moving the connection resume to resubscribeSessions, which is called indirectly. I have replaced this call.&lt;/p&gt;</comment>
                            <comment id="13014818" author="andrew.kennedy" created="Fri, 1 Apr 2011 20:49:34 +0000"  >&lt;p&gt;Fixed on trunk. As this is a regression, it should be ported to the 0.10 branch as well.&lt;/p&gt;</comment>
                            <comment id="13014820" author="rajith" created="Fri, 1 Apr 2011 20:52:46 +0000"  >&lt;p&gt;Andrew thanks for putting the missing method call back into the code.&lt;/p&gt;

&lt;p&gt;I am reopening the JIRA until we port the fix to 0.10 release branch.&lt;/p&gt;

&lt;p&gt;At this point I am treating this as a blocker for the 0.10 release as the JMS failover is a critical piece and is obviously a regression from our previous release.&lt;/p&gt;</comment>
                            <comment id="13014834" author="justi9" created="Fri, 1 Apr 2011 21:15:31 +0000"  >&lt;p&gt;This issue is still awaiting review by a component maintainer.  I&apos;ll go ahead and give my approval for 0.10, conditioned upon favorable said review, so that this can be committed promptly.&lt;/p&gt;</comment>
                            <comment id="13014840" author="andrew.kennedy" created="Fri, 1 Apr 2011 21:31:46 +0000"  >&lt;p&gt;I thought Rajith was responsible for the broker component changes?&lt;/p&gt;</comment>
                            <comment id="13014843" author="justi9" created="Fri, 1 Apr 2011 21:44:12 +0000"  >&lt;p&gt;This is close enough to the end that I&apos;d like to get Rob or Robbie to weigh in as well.&lt;/p&gt;</comment>
                            <comment id="13015025" author="andrew.kennedy" created="Sat, 2 Apr 2011 12:53:40 +0000"  >&lt;p&gt;Can you review this fix, for potential inclusion in the 0.10 releaase, please?&lt;/p&gt;</comment>
                            <comment id="13015321" author="gemmellr" created="Mon, 4 Apr 2011 09:07:15 +0000"  >&lt;p&gt;The change looks to restore the original behaviour and so seems ok from that perspective, however I am concerned it took around 6 weeks to notice it wasn&apos;t working though; can we really be sure it is working after the change in that case?&lt;/p&gt;

&lt;p&gt;The JIRA needs updated with a fix-for of 0.10 if it is backported.&lt;/p&gt;</comment>
                            <comment id="13015409" author="rajith" created="Mon, 4 Apr 2011 13:44:25 +0000"  >&lt;p&gt;The failover issue was noticed before (due to test failures) and it was on my todo list to investigate.&lt;br/&gt;
But there was a steady stream of issues that I had to deal with, hence the delay in getting to it.&lt;/p&gt;

&lt;p&gt;I have spent a lot of time working on the failover/transport code for several bugs Ex. &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-3043&quot; title=&quot;If a new session is created during failover, but before &amp;#39;resume&amp;#39; is completed, the new session gets reattached again.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-3043&quot;&gt;&lt;del&gt;QPID-3043&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-3042&quot; title=&quot;Session.attach could be sent before the connection is open.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-3042&quot;&gt;&lt;del&gt;QPID-3042&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-2876&quot; title=&quot;Design issues in Java client failover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-2876&quot;&gt;&lt;del&gt;QPID-2876&lt;/del&gt;&lt;/a&gt;,&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-2861&quot; title=&quot;JMS client needs to handle duplicate commands replayed after failover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-2861&quot;&gt;&lt;del&gt;QPID-2861&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-2808&quot; title=&quot;JMS client failover fails due to a locking issue present in the Connection/Session classes in the transport package.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-2808&quot;&gt;&lt;del&gt;QPID-2808&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-2994&quot; title=&quot;transactions atomicity violated by &amp;#39;transparent&amp;#39; failover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-2994&quot;&gt;&lt;del&gt;QPID-2994&lt;/del&gt;&lt;/a&gt; ..etc&lt;br/&gt;
The failover code is probably one of more fragile areas in the code base to say the least.&lt;br/&gt;
Some of these issues cannot be tested with automated test cases due to various limitations, hence difficult to catch certain regressions/bugs.&lt;br/&gt;
I need to get the python testkit working properly as it&apos;s a lot more flexible than the ant tests. It also seems to be able to reproduce a few of the client and broker bugs we had in the past.&lt;/p&gt;

&lt;p&gt;I plan to retest the failover area manually for some of the above issues. Post release I am planning to get the testkit running more frequently.&lt;br/&gt;
I have tested this particular fix, but also plan more comprehensive tests around this area.&lt;/p&gt;</comment>
                            <comment id="13015976" author="rajith" created="Tue, 5 Apr 2011 16:06:32 +0000"  >&lt;p&gt;Committed the fix to the 0.10 release branch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>169800</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 33 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0bo7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66035</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>