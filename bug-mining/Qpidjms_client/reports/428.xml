<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:21:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-3715] On receiving an empty ObjectMessage java client hangs forever</title>
                <link>https://issues.apache.org/jira/browse/QPID-3715</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;If ObjectMessage message is created and sent without a body than on receiving such a message the consumer hangs regardless whether timeout specified or not.&lt;/p&gt;

&lt;p&gt;The following snippet demonstrates the problem&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Sending and receiving an empty object message&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Message message = session.createObjectMessage();
producer.send(message);
ObjectMessage receivedMessage = (ObjectMessage) consumer.receive(1000);&lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;--- hanging here&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12536595">QPID-3715</key>
            <summary>On receiving an empty ObjectMessage java client hangs forever</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kwall">Keith Wall</assignee>
                                    <reporter username="orudyy">Alex Rudyy</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Dec 2011 16:51:31 +0000</created>
                <updated>Sat, 7 Jan 2012 19:00:32 +0000</updated>
                            <resolved>Sat, 7 Jan 2012 19:00:19 +0000</resolved>
                                    <version>0.15</version>
                                    <fixVersion>0.15</fixVersion>
                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13177284" author="alex.rufous" created="Thu, 29 Dec 2011 17:28:31 +0000"  >&lt;p&gt;Patch with a fix attached.&lt;/p&gt;</comment>
                            <comment id="13177307" author="alex.rufous" created="Thu, 29 Dec 2011 18:32:32 +0000"  >&lt;p&gt;Keith,&lt;/p&gt;

&lt;p&gt;Do you mind to review and commit the patch attached?&lt;/p&gt;</comment>
                            <comment id="13179498" author="k-wall" created="Wed, 4 Jan 2012 14:08:07 +0000"  >&lt;p&gt;Hi Alex,&lt;/p&gt;

&lt;p&gt;I can&apos;t fault your implementation, but I wonder if there is a reason not to use org.apache.qpid.server.util.ByteBufferInputStream?  Admittedly, we&apos;d need to move the class from broker to common (and add a new ByteBufferInputStreamTest). What do you think?&lt;/p&gt;


</comment>
                            <comment id="13179560" author="alex.rufous" created="Wed, 4 Jan 2012 15:34:17 +0000"  >&lt;p&gt;Hi Keith,&lt;/p&gt;

&lt;p&gt;It seems like ByteBufferInputStream can be used in this case.&lt;/p&gt;

&lt;p&gt;However, IMHO, it requires one modification in its method &quot;int read()&quot;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; read() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
    {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; _buffer.get() &amp;amp; 0xFF;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I am not sure that operation &quot;&amp;amp; 0xFF&quot; is necessary here.&lt;/p&gt;

&lt;p&gt;Do you mind if I change org.apache.qpid.server.util.ByteBufferInputStream and remove &quot;&amp;amp; 0xFF&quot;?&lt;/p&gt;</comment>
                            <comment id="13179579" author="k-wall" created="Wed, 4 Jan 2012 15:51:22 +0000"  >&lt;p&gt;Isn&apos;t it because an implementation of InputStream#read() is required to return the byte as an int in the range 0..255 rather than value -127..128?   I think ByteBufferInputStream#read() should be guarding the get() with hasRemaining (in the way you did in your patch) and returning -1 when the ByteBuffer is exhausted.&lt;/p&gt;</comment>
                            <comment id="13181654" author="alex.rufous" created="Fri, 6 Jan 2012 22:32:36 +0000"  >&lt;p&gt;Hi Keith,&lt;/p&gt;

&lt;p&gt;Could you please review the attached patch again?&lt;/p&gt;

&lt;p&gt;As agreed I changed JMSObjectMessage to use ByteBufferInputStream, moved ByteBufferInputStream from server module into common and added junit tests for ByteBufferInputStream.&lt;/p&gt;</comment>
                            <comment id="13182065" author="k-wall" created="Sat, 7 Jan 2012 19:00:19 +0000"  >&lt;p&gt;No further comments, patch applied.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12509725" name="0001-QPID-3715-Fix-the-receiving-of-an-empty-ObjectMessag.patch" size="16860" author="orudyy" created="Fri, 6 Jan 2012 22:21:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>222278</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 46 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0bjuf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>65327</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>