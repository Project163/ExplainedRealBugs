<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:22:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-4541] Messages are replayed after XA commit in a failover scenario</title>
                <link>https://issues.apache.org/jira/browse/QPID-4541</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;Currently we are seeing an issue in failover scenarios where messages that are received and the XA transaction completes are replayed on the nth node of a cluster when failover is invoked. This appears to be similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-2294&quot; title=&quot;The Unix python client can erroneously throw exceptions from select due to interrupted system call&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-2294&quot;&gt;&lt;del&gt;QPID-2294&lt;/del&gt;&lt;/a&gt; in the violation of transaction atomicity.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;All supported OS platforms, all supported JEE platforms&lt;/p&gt;</environment>
        <key id="12628072">QPID-4541</key>
            <summary>Messages are replayed after XA commit in a failover scenario</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajith">Rajith Muditha Attapattu</assignee>
                                    <reporter username="wprice">Weston M. Price</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Jan 2013 17:24:37 +0000</created>
                <updated>Tue, 14 Mar 2017 20:07:25 +0000</updated>
                            <resolved>Tue, 29 Jan 2013 16:07:49 +0000</resolved>
                                    <version>Future</version>
                                    <fixVersion>0.21</fixVersion>
                                    <component>JCA</component>
                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13557694" author="rajith" created="Fri, 18 Jan 2013 22:32:33 +0000"  >&lt;p&gt;The XA Session is using AUTO_ACK mode hence by default messages replayed when the session is recreated.&lt;br/&gt;
The solution to this is to allow message replay to be turned on/off using a boolean flag when creating a session.&lt;/p&gt;

&lt;p&gt;This solution could be useful outside of the context of this bug as in some cases the client will not worry about message loss, hence does not need to keep messages in it&apos;s replay buffer which can have an affect on memory consumption and eventually slowing down the client.&lt;/p&gt;</comment>
                            <comment id="13561232" author="k-wall" created="Wed, 23 Jan 2013 23:36:07 +0000"  >&lt;p&gt;Hi Rajith, Weston,&lt;/p&gt;

&lt;p&gt;I&apos;ve spent sometime looking at the patch tonight, but I&apos;m lacking some background to review the patch properly.&lt;/p&gt;

&lt;p&gt;I need some more details about the sequence of events that allow this defect to occur.   Perhaps if you could summarise what is happening (at protocol level) between the client and the two brokers (the original broker and the failover). &lt;/p&gt;

&lt;p&gt;Also, how does this defect manifest itself to the end-user application?  What are they seeing?  If there is a stack trace please attach it here.&lt;/p&gt;

&lt;p&gt;Thanks, Keith.&lt;/p&gt;
</comment>
                            <comment id="13561290" author="rajith" created="Thu, 24 Jan 2013 00:48:00 +0000"  >&lt;p&gt;Kieth, I would let Weston to explain the exact use case from an XA pov, as he has more details and knowledge about the use case.&lt;/p&gt;

&lt;p&gt;Instead I will try to explain the root cause and the fix I made.&lt;/p&gt;

&lt;p&gt;By default the JMS client will replay unacked message transfers (after failover) in it&apos;s replay buffer unless the session is marked transacted.&lt;br/&gt;
(If we allow replay in a transacted session, then we will have messages produced or consumed outside of the transaction boundaries, which violates atomocity).&lt;/p&gt;

&lt;p&gt;For XA transactions the same applies. If we replay messages after failover it will result in messages consumed or produced outside of the transaction boundaries.&lt;br/&gt;
However the XA implementation does not use a transacted JMS session underneath as the transaction is governed by the XA manager.&lt;br/&gt;
So it uses an AUTO_ACKED session underneath, which replays message transfers after failover.&lt;/p&gt;

&lt;p&gt;The patch I submitted allows this to be turned off based on a boolean argument.&lt;/p&gt;

&lt;p&gt;Does that make sense? If it&apos;s still not clear please feel free to ask further questions.&lt;/p&gt;

&lt;p&gt;Rajith.&lt;/p&gt;</comment>
                            <comment id="13565480" author="rajith" created="Tue, 29 Jan 2013 16:07:49 +0000"  >&lt;p&gt;The following commit fixes this issue.&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?rev=1438725&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1438725&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>304923</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 42 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i17wwn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>254300</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>