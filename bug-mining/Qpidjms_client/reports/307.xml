<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:21:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-2471] Java client releases messages in an unpredictable order on recover</title>
                <link>https://issues.apache.org/jira/browse/QPID-2471</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;As per the JMS spec, If &quot;recover&quot; is called on a session, the client should stop message delivery for that session, and restarts message delivery with the oldest unacknowledged message. &lt;br/&gt;
It also says that &quot;Redelivered messages do not have to be delivered in exactly their original delivery order&quot;.&lt;/p&gt;

&lt;p&gt;However it&apos;s nice to ensure ordering where possible.&lt;br/&gt;
Looking at the code (alteast the 0-10 codepath) it seems we are not making a reasonable effort in ensuring we release all messages when in prefetch mode.&lt;br/&gt;
Quite often messages are stuck in the pre-delivery dispatch queue or the individual consumer queues. &lt;br/&gt;
This results in the messages being delivered out of order.&lt;/p&gt;

&lt;p&gt;Here the steps that would need to do to ensure recovery is done properly and if possible to ensure ordering.&lt;br/&gt;
------------------------------------------------------------------------------------------------------------------------------------------------&lt;br/&gt;
1. Flush any message acks kept in buffer.&lt;br/&gt;
2. Stop the message flow.&lt;br/&gt;
3. Drain the dispatch queue and the queues in each consumer&lt;br/&gt;
4. Reject/release all unacked messages.&lt;br/&gt;
5. Start the message flow again.&lt;/p&gt;

&lt;p&gt;It is also nice to have a test case to ensure that ordering is maintained under reasonable circumstances.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12460386">QPID-2471</key>
            <summary>Java client releases messages in an unpredictable order on recover</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajith">Rajith Muditha Attapattu</assignee>
                                    <reporter username="rajith">Rajith Muditha Attapattu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Mar 2010 18:56:52 +0000</created>
                <updated>Tue, 14 Mar 2017 20:07:40 +0000</updated>
                            <resolved>Mon, 18 Oct 2010 16:45:43 +0000</resolved>
                                    <version>0.6</version>
                                    <fixVersion>0.7</fixVersion>
                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12851042" author="rajith" created="Mon, 29 Mar 2010 18:40:55 +0000"  >&lt;p&gt;This patch contains a fix for the problem described in the JIRA.&lt;br/&gt;
The patch passes the RecoverTest for the C++ Broker.&lt;br/&gt;
However it fails with the Java broker. The failures are random and are due to messages not arriving on time.&lt;br/&gt;
I am yet to investigate the issues around this.&lt;/p&gt;

&lt;p&gt;Once the issues are resolved I will be checking in two other test cases for recover that tests the problem described in the JIRA.&lt;/p&gt;</comment>
                            <comment id="12922143" author="rajith" created="Mon, 18 Oct 2010 16:45:43 +0000"  >&lt;p&gt;Fixed along with a test case.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12440090" name="QPID-2471.patch" size="8868" author="rajith" created="Mon, 29 Mar 2010 18:40:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49912</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 5 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0bqpb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66438</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>