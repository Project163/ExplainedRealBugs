<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:22:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-6055] [Java Broker] BDB Message Store can thow java.lang.IndexOutOfBoundsException on trying to retrieve the message content</title>
                <link>https://issues.apache.org/jira/browse/QPID-6055</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;Perftests failed because Broker crashed and disconnected the clients in result of the following Exception:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2014-08-28 06:36:00,595 ERROR [IoReceiver - /127.0.0.1:43858] (v0_8.AMQProtocolEngine) - Error informing channel that receiving is complete. Channel: (false, false, false) [/127.0.0.1:43858(guest):1]
java.lang.IndexOutOfBoundsException
        at java.nio.ByteBuffer.wrap(ByteBuffer.java:371)
        at org.apache.qpid.server.store.berkeleydb.AbstractBDBMessageStore$StoredBDBMessage.getContent(AbstractBDBMessageStore.java:1336)
        at org.apache.qpid.server.message.AbstractServerMessageImpl.getContent(AbstractServerMessageImpl.java:171)
        at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl$MessageContentSourceBody.writePayload(ProtocolOutputConverterImpl.java:251)
        at org.apache.qpid.framing.AMQFrame.writeFrames(AMQFrame.java:123)
        at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl$CompositeAMQBodyBlock.writePayload(ProtocolOutputConverterImpl.java:461)
        at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine.asByteBuffer(AMQProtocolEngine.java:590)
        at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine.writeFrame(AMQProtocolEngine.java:704)
        at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl.writeFrame(ProtocolOutputConverterImpl.java:423)
        at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl.writeMessageDeliveryUnchanged(ProtocolOutputConverterImpl.java:207)
        at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl.writeMessageDelivery(ProtocolOutputConverterImpl.java:141)
        at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl.writeMessageDelivery(ProtocolOutputConverterImpl.java:101)
        at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl.writeDeliver(ProtocolOutputConverterImpl.java:78)
        at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine$WriteDeliverMethod.deliverToClient(AMQProtocolEngine.java:1621)
        at org.apache.qpid.server.protocol.v0_8.ConsumerTarget_0_8.sendToClient(ConsumerTarget_0_8.java:513)
        at org.apache.qpid.server.protocol.v0_8.ConsumerTarget_0_8$AckConsumer.send(ConsumerTarget_0_8.java:317)
        at org.apache.qpid.server.queue.QueueConsumerImpl.send(QueueConsumerImpl.java:474)
        at org.apache.qpid.server.queue.AbstractQueue.deliverMessage(AbstractQueue.java:1252)
        at org.apache.qpid.server.queue.AbstractQueue.deliverToConsumer(AbstractQueue.java:1166)
        at org.apache.qpid.server.queue.AbstractQueue.tryDeliverStraightThrough(AbstractQueue.java:1122)
        at org.apache.qpid.server.queue.AbstractQueue.access$100(AbstractQueue.java:96)
        at org.apache.qpid.server.queue.AbstractQueue$6.run(AbstractQueue.java:1010)
        at org.apache.qpid.server.queue.AbstractQueue$6.run(AbstractQueue.java:1006)
        at java.security.AccessController.doPrivileged(Native Method)
        at javax.security.auth.Subject.doAs(Subject.java:356)
        at org.apache.qpid.server.queue.AbstractQueue.doEnqueue(AbstractQueue.java:1004)
        at org.apache.qpid.server.queue.SortedQueueImpl.doEnqueue(SortedQueueImpl.java:61)
        at org.apache.qpid.server.queue.AbstractQueue.enqueue(AbstractQueue.java:953)
        at org.apache.qpid.server.exchange.AbstractExchange$2.postCommit(AbstractExchange.java:560)
        at org.apache.qpid.server.protocol.v0_8.AMQChannel$AsyncCommand.complete(AMQChannel.java:1696)
        at org.apache.qpid.server.protocol.v0_8.AMQChannel.sync(AMQChannel.java:1666)
        at org.apache.qpid.server.protocol.v0_8.AMQChannel.receivedComplete(AMQChannel.java:266)
        at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine.receivedComplete(AMQProtocolEngine.java:368)
        at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine.access$1200(AMQProtocolEngine.java:89)
        at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine$2.run(AMQProtocolEngine.java:328)
        at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine$2.run(AMQProtocolEngine.java:283)
        at java.security.AccessController.doPrivileged(Native Method)
        at javax.security.auth.Subject.doAs(Subject.java:356)
        at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine.received(AMQProtocolEngine.java:282)
        at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine.received(AMQProtocolEngine.java:89)
        at org.apache.qpid.server.protocol.MultiVersionProtocolEngine.received(MultiVersionProtocolEngine.java:133)
        at org.apache.qpid.server.protocol.MultiVersionProtocolEngine.received(MultiVersionProtocolEngine.java:49)
        at org.apache.qpid.transport.network.io.IoReceiver.run(IoReceiver.java:161)
        at java.lang.Thread.run(Thread.java:745)
2014-08-28 06:36:00,598 ERROR [IoReceiver - /127.0.0.1:43858] (v0_8.AMQProtocolEngine) - Exception caught in /127.0.0.1:43858(guest), closing connection explicitly: java.lang.IndexOutOfBoundsException
java.lang.IndexOutOfBoundsException
        at java.nio.ByteBuffer.wrap(ByteBuffer.java:371)
        at org.apache.qpid.server.store.berkeleydb.AbstractBDBMessageStore$StoredBDBMessage.getContent(AbstractBDBMessageStore.java:1336)
        at org.apache.qpid.server.message.AbstractServerMessageImpl.getContent(AbstractServerMessageImpl.java:171)
        at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl$MessageContentSourceBody.writePayload(ProtocolOutputConverterImpl.java:251)
        at org.apache.qpid.framing.AMQFrame.writeFrames(AMQFrame.java:123)
        at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl$CompositeAMQBodyBlock.writePayload(ProtocolOutputConverterImpl.java:461)
        at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine.asByteBuffer(AMQProtocolEngine.java:590)
        at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine.writeFrame(AMQProtocolEngine.java:704)
        at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl.writeFrame(ProtocolOutputConverterImpl.java:423)
        at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl.writeMessageDeliveryUnchanged(ProtocolOutputConverterImpl.java:207)
        at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl.writeMessageDelivery(ProtocolOutputConverterImpl.java:141)
        at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl.writeMessageDelivery(ProtocolOutputConverterImpl.java:101)
        at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl.writeDeliver(ProtocolOutputConverterImpl.java:78)
        at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine$WriteDeliverMethod.deliverToClient(AMQProtocolEngine.java:1621)
        at org.apache.qpid.server.protocol.v0_8.ConsumerTarget_0_8.sendToClient(ConsumerTarget_0_8.java:513)
        at org.apache.qpid.server.protocol.v0_8.ConsumerTarget_0_8$AckConsumer.send(ConsumerTarget_0_8.java:317)
        at org.apache.qpid.server.queue.QueueConsumerImpl.send(QueueConsumerImpl.java:474)
        at org.apache.qpid.server.queue.AbstractQueue.deliverMessage(AbstractQueue.java:1252)
        at org.apache.qpid.server.queue.AbstractQueue.deliverToConsumer(AbstractQueue.java:1166)
        at org.apache.qpid.server.queue.AbstractQueue.tryDeliverStraightThrough(AbstractQueue.java:1122)
        at org.apache.qpid.server.queue.AbstractQueue.access$100(AbstractQueue.java:96)
        at org.apache.qpid.server.queue.AbstractQueue$6.run(AbstractQueue.java:1010)
        at org.apache.qpid.server.queue.AbstractQueue$6.run(AbstractQueue.java:1006)
        at java.security.AccessController.doPrivileged(Native Method)
        at javax.security.auth.Subject.doAs(Subject.java:356)
        at org.apache.qpid.server.queue.AbstractQueue.doEnqueue(AbstractQueue.java:1004)
        at org.apache.qpid.server.queue.SortedQueueImpl.doEnqueue(SortedQueueImpl.java:61)
        at org.apache.qpid.server.queue.AbstractQueue.enqueue(AbstractQueue.java:953)
        at org.apache.qpid.server.exchange.AbstractExchange$2.postCommit(AbstractExchange.java:560)
        at org.apache.qpid.server.protocol.v0_8.AMQChannel$AsyncCommand.complete(AMQChannel.java:1696)
        at org.apache.qpid.server.protocol.v0_8.AMQChannel.sync(AMQChannel.java:1666)
        at org.apache.qpid.server.protocol.v0_8.AMQChannel.receivedComplete(AMQChannel.java:266)
        at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine.receivedComplete(AMQProtocolEngine.java:368)
        at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine.access$1200(AMQProtocolEngine.java:89)
        at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine$2.run(AMQProtocolEngine.java:328)
        at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine$2.run(AMQProtocolEngine.java:283)
        at java.security.AccessController.doPrivileged(Native Method)
        at javax.security.auth.Subject.doAs(Subject.java:356)
        at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine.received(AMQProtocolEngine.java:282)
        at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine.received(AMQProtocolEngine.java:89)
        at org.apache.qpid.server.protocol.MultiVersionProtocolEngine.received(MultiVersionProtocolEngine.java:133)
        at org.apache.qpid.server.protocol.MultiVersionProtocolEngine.received(MultiVersionProtocolEngine.java:49)
        at org.apache.qpid.transport.network.io.IoReceiver.run(IoReceiver.java:161)
        at java.lang.Thread.run(Thread.java:745)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2014-08-28 06:37:30,624 ERROR [pool-3-thread-13] (server.Main) - Uncaught exception, shutting down.
java.lang.IndexOutOfBoundsException
        at java.nio.ByteBuffer.wrap(ByteBuffer.java:371)
        at org.apache.qpid.server.store.berkeleydb.AbstractBDBMessageStore$StoredBDBMessage.getContent(AbstractBDBMessageStore.java:1336)
        at org.apache.qpid.server.message.AbstractServerMessageImpl.getContent(AbstractServerMessageImpl.java:171)
        at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl$MessageContentSourceBody.writePayload(ProtocolOutputConverterImpl.java:251)
        at org.apache.qpid.framing.AMQFrame.writeFrames(AMQFrame.java:123)
        at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl$CompositeAMQBodyBlock.writePayload(ProtocolOutputConverterImpl.java:461)
        at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine.asByteBuffer(AMQProtocolEngine.java:590)
        at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine.writeFrame(AMQProtocolEngine.java:704)
        at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl.writeFrame(ProtocolOutputConverterImpl.java:423)
        at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl.writeMessageDeliveryUnchanged(ProtocolOutputConverterImpl.java:207)
        at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl.writeMessageDelivery(ProtocolOutputConverterImpl.java:141)
        at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl.writeMessageDelivery(ProtocolOutputConverterImpl.java:101)
        at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl.writeDeliver(ProtocolOutputConverterImpl.java:78)
        at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine$WriteDeliverMethod.deliverToClient(AMQProtocolEngine.java:1621)
        at org.apache.qpid.server.protocol.v0_8.ConsumerTarget_0_8.sendToClient(ConsumerTarget_0_8.java:513)
        at org.apache.qpid.server.protocol.v0_8.ConsumerTarget_0_8$NoAckConsumer.send(ConsumerTarget_0_8.java:213)
        at org.apache.qpid.server.queue.QueueConsumerImpl.send(QueueConsumerImpl.java:474)
        at org.apache.qpid.server.queue.AbstractQueue.deliverMessage(AbstractQueue.java:1252)
        at org.apache.qpid.server.queue.AbstractQueue.attemptDelivery(AbstractQueue.java:2007)
        at org.apache.qpid.server.queue.AbstractQueue.processQueue(AbstractQueue.java:2178)
        at org.apache.qpid.server.queue.QueueRunner$1.run(QueueRunner.java:77)
        at java.security.AccessController.doPrivileged(Native Method)
        at javax.security.auth.Subject.doAs(Subject.java:356)
        at org.apache.qpid.server.queue.QueueRunner.run(QueueRunner.java:68)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at java.lang.Thread.run(Thread.java:745)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12737773">QPID-6055</key>
            <summary>[Java Broker] BDB Message Store can thow java.lang.IndexOutOfBoundsException on trying to retrieve the message content</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="orudyy">Alex Rudyy</assignee>
                                    <reporter username="orudyy">Alex Rudyy</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 Aug 2014 11:15:27 +0000</created>
                <updated>Tue, 14 Mar 2017 21:28:57 +0000</updated>
                            <resolved>Sun, 31 Aug 2014 12:34:42 +0000</resolved>
                                    <version>0.30</version>
                                    <fixVersion>0.31</fixVersion>
                                    <component>Broker-J</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14115723" author="rgodfrey" created="Fri, 29 Aug 2014 19:42:54 +0000"  >&lt;p&gt;Can you give a little more information on how to reproduce this error?&lt;/p&gt;

&lt;p&gt;Looking at the stack trace the error occurs here &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;1336                return ByteBuffer.wrap(data,offsetInMessage,Math.min(size,data.length-offsetInMessage));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;which comes (via one intermediate call) from here in MessageContentSourceBody.writePayload:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;249         public void writePayload(DataOutput buffer) throws IOException
250         {
251             ByteBuffer buf = _message.getContent(_offset, _length);
252 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the MessageContentSourceBody would come from line 202 here (because the path up from the exception leads through line 207&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;195             int maxBodySize = (int) getProtocolSession().getMaxFrameSize() - AMQFrame.getFrameOverhead();
196 
197 
198             int capacity = bodySize &amp;gt; maxBodySize ? maxBodySize : bodySize;
199 
200             int writtenSize = capacity;
201 
202             AMQBody firstContentBody = new MessageContentSourceBody(message, 0, capacity);
203 
204             CompositeAMQBodyBlock
205                     compositeBlock =
206                     new CompositeAMQBodyBlock(channelId, deliverBody, contentHeaderBody, firstContentBody);
207             writeFrame(compositeBlock);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;which would imply that the MessageContentSourceBody encountering the error is the one created with offset 0 and length capacity.  To get an index out of bounds that would mean that the data array is smaller than capacity.  But capacity is defined to be less than bodySize from line 198 above... so something very fishy would appear to be going on &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="14115915" author="alex.rufous" created="Fri, 29 Aug 2014 21:57:35 +0000"  >&lt;p&gt;Rob,&lt;br/&gt;
IndexOutOfBoundsException was thrown on running perftests from &lt;a href=&quot;https://svn.apache.org/repos/asf/qpid/trunk/qpid/java/perftests/etc/testdefs/QueueTypes.json&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;QueueTypes.json&lt;/a&gt;. I have not tried to run that test alone. I&apos;ve seen it happened twice in QueueTypes as part of running entire performance suite.&lt;/p&gt;</comment>
                            <comment id="14115917" author="rgodfrey" created="Fri, 29 Aug 2014 21:59:00 +0000"  >&lt;p&gt;Thanks Alex.  I think as a first step I&apos;ll add some more logging in there to see if we can figure out what is going on.&lt;/p&gt;</comment>
                            <comment id="14115955" author="jira-bot" created="Fri, 29 Aug 2014 22:24:44 +0000"  >&lt;p&gt;Commit 1621395 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfrer&quot; class=&quot;user-hover&quot; rel=&quot;godfrer&quot;&gt;godfrer&lt;/a&gt; in branch &apos;qpid/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1621395&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1621395&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6055&quot; title=&quot;[Java Broker] BDB Message Store can thow java.lang.IndexOutOfBoundsException on trying to retrieve the message content&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6055&quot;&gt;&lt;del&gt;QPID-6055&lt;/del&gt;&lt;/a&gt; : &lt;span class=&quot;error&quot;&gt;&amp;#91;Java Broker&amp;#93;&lt;/span&gt; add extra information to exception to help isolate cause of exception&lt;/p&gt;</comment>
                            <comment id="14116281" author="rgodfrey" created="Sat, 30 Aug 2014 07:27:31 +0000"  >&lt;p&gt;One issue I hit with that test straight away is that it is trying to send a message headers frame which is larger than the default max frame size on the broker.  This doesn&apos;t cause an exception on the client, and the exception on the broker is cryptic to say the least.  I think we should probably fix this (both on the client and the broker). I have created &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6058&quot; title=&quot;[Java Client] The client does not fail with a sensible error message if it tries to send a message header that is larger than the max frame size&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6058&quot;&gt;&lt;del&gt;QPID-6058&lt;/del&gt;&lt;/a&gt; for this issue.&lt;/p&gt;</comment>
                            <comment id="14116432" author="alex.rufous" created="Sat, 30 Aug 2014 15:46:20 +0000"  >&lt;p&gt;Rob,&lt;br/&gt;
I can repeatedly  reproduce the issue on the trunk using the following steps:&lt;br/&gt;
1) start the Java broker with overridden qpid.broker_frame_size=4294967295&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;export QPID_WORK=`pwd`/systests/target/qpid-broker/0.30-SNAPSHOT/my-work
./systests/target/qpid-broker/0.32-SNAPSHOT/bin/qpid-server  -prop qpid.broker_frame_size=4294967295

create json node with bdb VH
set BDB VH to be a  default VH  
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2) Run perf test QueueTypes.js&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;cd perftests
mvn dependency:copy-dependencies
mkdir test
cp ./etc/testdefs/QueueTypes.json ./test/
java -cp &quot;./target/*:./target/dependency/*&quot;  -Dqpid.dest_syntax=BURL  -Dlog4j.configuration=file:etc/log4j.properties  -Dqpid.amqp.version=0-9  -Dqpid.disttest.duration=90000  org.apache.qpid.disttest.ControllerRunner  jndi-config=etc/perftests-jndi.properties test-config=test/QueueTypes.js distributed=false  writeToDb=false
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14116439" author="rgodfrey" created="Sat, 30 Aug 2014 15:55:30 +0000"  >&lt;p&gt;which results in an error:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2014-08-30 17:53:52,705 ERROR [IoReceiver - /127.0.0.1:64455] (v0_8.AMQProtocolEngine) - Error informing channel that receiving is complete. Channel: (false, false, false) [/127.0.0.1:64455(guest):1]
java.lang.IndexOutOfBoundsException: Error wrapping data (data.length: 1024 offsetInMessage: 0 size: -9
	at org.apache.qpid.server.store.berkeleydb.AbstractBDBMessageStore$StoredBDBMessage.getContent(AbstractBDBMessageStore.java:1342)
	at org.apache.qpid.server.message.AbstractServerMessageImpl.getContent(AbstractServerMessageImpl.java:171)
	at org.apache.qpid.server.protocol.v0_8.output.ProtocolOutputConverterImpl$MessageContentSourceBody.writePayload(ProtocolOutputConverterImpl.java:251)
	at org.apache.qpid.framing.AMQFrame.writeFrames(AMQFrame.java:123)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so, size is obviously wrong...&lt;/p&gt;</comment>
                            <comment id="14116440" author="rgodfrey" created="Sat, 30 Aug 2014 16:00:01 +0000"  >&lt;p&gt;And a further bit of investigation shows that the issue is due to the fact that max frame size is being set to &amp;gt; Integer.MAX_VALUE... So I&apos;m not sure this is a block per se (you kind of have to go out of your way to cause the issue)... but the fix will be relatively trivial I think... &lt;/p&gt;</comment>
                            <comment id="14116490" author="alex.rufous" created="Sat, 30 Aug 2014 17:32:23 +0000"  >&lt;p&gt;Ah.. I did not realized that the limit value was greater then Integer.MAX_VALUE&lt;/p&gt;

&lt;p&gt;I took the value from ConnectionTuneOkMethodHandler (line 123):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;session.setMaxFrameSize(body.getFrameMax()== 0l ? (brokerFrameMax == 0l ? 0xFFFFFFFFl : brokerFrameMax) : body.getFrameMax());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It seems it needs to be fixed as well.&lt;/p&gt;</comment>
                            <comment id="14116497" author="rgodfrey" created="Sat, 30 Aug 2014 17:46:52 +0000"  >&lt;p&gt;Yes - the commit I just made should fix that line as well.  Basically we&apos;ve always been a bit lax about the fact that the max frame size could theoretically be 2^64 - 1, while in practice the code could only handle 2^63 - 1.  The enforcement of max frame size has meant that we could identify the bug even without a very large frame, whereas previously the bug would only have actually hit us when a ridiculously large frame arrived.&lt;/p&gt;</comment>
                            <comment id="14116498" author="jira-bot" created="Sat, 30 Aug 2014 17:47:49 +0000"  >&lt;p&gt;Commit 1621498 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfrer&quot; class=&quot;user-hover&quot; rel=&quot;godfrer&quot;&gt;godfrer&lt;/a&gt; in branch &apos;qpid/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1621498&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1621498&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6055&quot; title=&quot;[Java Broker] BDB Message Store can thow java.lang.IndexOutOfBoundsException on trying to retrieve the message content&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6055&quot;&gt;&lt;del&gt;QPID-6055&lt;/del&gt;&lt;/a&gt; : &lt;span class=&quot;error&quot;&gt;&amp;#91;Java Broker&amp;#93;&lt;/span&gt; Ensure max frame size is always less than Integer.MAX_VALUE&lt;/p&gt;</comment>
                            <comment id="14116500" author="rgodfrey" created="Sat, 30 Aug 2014 17:52:25 +0000"  >&lt;p&gt;Alex - can you review the changes I made?&lt;/p&gt;</comment>
                            <comment id="14116787" author="alex.rufous" created="Sun, 31 Aug 2014 12:34:42 +0000"  >&lt;p&gt;The changes look good to me&lt;/p&gt;</comment>
                            <comment id="14369092" author="justi9" created="Thu, 19 Mar 2015 12:22:57 +0000"  >&lt;p&gt;Released in Qpid 0.32, &lt;a href=&quot;http://qpid.apache.org/releases/qpid-0.32/index.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://qpid.apache.org/releases/qpid-0.32/index.html&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 35 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zhcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>