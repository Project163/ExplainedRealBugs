<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:20:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-1374] Java client throws NullPointerException  when header &quot; message properties&quot;  is not set </title>
                <link>https://issues.apache.org/jira/browse/QPID-1374</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;The java JMS layer expects that all messages have message properties set. This is however not always  the case as AMQP doesn&apos;t mandate the message properties header to always be set. For example the python client doesn&apos;t set the message properties when they are empty. &lt;/p&gt;

&lt;p&gt;How to reproduce: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Send messages using the python client&lt;/li&gt;
	&lt;li&gt;Consume those messages with a java consumer&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Solution: &lt;br/&gt;
update AbstractJMSMessageFactory and MessageFactoryRegistry for dealing with null message properties header  &lt;/p&gt;</description>
                <environment></environment>
        <key id="12406785">QPID-1374</key>
            <summary>Java client throws NullPointerException  when header &quot; message properties&quot;  is not set </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajith">Rajith Muditha Attapattu</assignee>
                                    <reporter username="arnaudsimon">Arnaud Simon</reporter>
                        <labels>
                    </labels>
                <created>Mon, 20 Oct 2008 09:17:52 +0000</created>
                <updated>Thu, 19 Feb 2009 18:07:10 +0000</updated>
                            <resolved>Thu, 19 Feb 2009 18:06:42 +0000</resolved>
                                    <version>M4</version>
                                    <fixVersion>0.5</fixVersion>
                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12640961" author="arnaudsimon" created="Mon, 20 Oct 2008 09:40:22 +0000"  >&lt;p&gt;Revision: 706166&lt;br/&gt;
Modified:&lt;br/&gt;
    incubator/qpid/trunk/qpid/java/client/src/main/java/org/apache/qpid/client/message/AbstractJMSMessageFactory.java&lt;br/&gt;
    incubator/qpid/trunk/qpid/java/client/src/main/java/org/apache/qpid/client/message/MessageFactoryRegistry.java&lt;/p&gt;

&lt;p&gt;Modified: incubator/qpid/trunk/qpid/java/client/src/main/java/org/apache/qpid/client/message/AbstractJMSMessageFactory.java&lt;br/&gt;
URL: &lt;a href=&quot;http://svn.apache.org/viewvc/incubator/qpid/trunk/qpid/java/client/src/main/java/org/apache/qpid/client/message/AbstractJMSMessageFactory.java?rev=706166&amp;amp;r1=706165&amp;amp;r2=706166&amp;amp;view=diff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/incubator/qpid/trunk/qpid/java/client/src/main/java/org/apache/qpid/client/message/AbstractJMSMessageFactory.java?rev=706166&amp;amp;r1=706165&amp;amp;r2=706166&amp;amp;view=diff&lt;/a&gt;&lt;br/&gt;
==============================================================================&lt;br/&gt;
&amp;#8212; incubator/qpid/trunk/qpid/java/client/src/main/java/org/apache/qpid/client/message/AbstractJMSMessageFactory.java (original)&lt;br/&gt;
+++ incubator/qpid/trunk/qpid/java/client/src/main/java/org/apache/qpid/client/message/AbstractJMSMessageFactory.java Mon Oct 20 02:36:38 2008&lt;br/&gt;
@@ -131,8 +131,18 @@&lt;br/&gt;
                     .remaining());&lt;br/&gt;
         }&lt;br/&gt;
         // set the properties of this message&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;MessageProperties mprop = (MessageProperties) contentHeader&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;;&lt;/li&gt;
	&lt;li&gt;DeliveryProperties devprop = (DeliveryProperties) contentHeader&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;;&lt;br/&gt;
+        MessageProperties mprop;&lt;br/&gt;
+        DeliveryProperties devprop;&lt;br/&gt;
+        if( contentHeader.length &amp;gt;1 )&lt;br/&gt;
+        
{
+          mprop = (MessageProperties) contentHeader[0];
+          devprop = (DeliveryProperties) contentHeader[1];
+        }
&lt;p&gt;+        else&lt;br/&gt;
+        &lt;/p&gt;
{
+          mprop = new MessageProperties();
+          devprop = (DeliveryProperties) contentHeader[0];
+        }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         AMQMessageDelegate delegate = new AMQMessageDelegate_0_10(mprop, devprop, messageNbr);&lt;/p&gt;


&lt;p&gt;Modified: incubator/qpid/trunk/qpid/java/client/src/main/java/org/apache/qpid/client/message/MessageFactoryRegistry.java&lt;br/&gt;
URL: &lt;a href=&quot;http://svn.apache.org/viewvc/incubator/qpid/trunk/qpid/java/client/src/main/java/org/apache/qpid/client/message/MessageFactoryRegistry.java?rev=706166&amp;amp;r1=706165&amp;amp;r2=706166&amp;amp;view=diff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/incubator/qpid/trunk/qpid/java/client/src/main/java/org/apache/qpid/client/message/MessageFactoryRegistry.java?rev=706166&amp;amp;r1=706165&amp;amp;r2=706166&amp;amp;view=diff&lt;/a&gt;&lt;br/&gt;
==============================================================================&lt;br/&gt;
&amp;#8212; incubator/qpid/trunk/qpid/java/client/src/main/java/org/apache/qpid/client/message/MessageFactoryRegistry.java (original)&lt;br/&gt;
+++ incubator/qpid/trunk/qpid/java/client/src/main/java/org/apache/qpid/client/message/MessageFactoryRegistry.java Mon Oct 20 02:36:38 2008&lt;br/&gt;
@@ -125,12 +125,16 @@&lt;br/&gt;
     {&lt;/p&gt;

&lt;p&gt;         MessageProperties mprop = transfer.getHeader().get(MessageProperties.class);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String messageType = mprop.getContentType();&lt;/li&gt;
	&lt;li&gt;if (messageType == null)&lt;br/&gt;
+        String messageType = &quot;&quot;;&lt;br/&gt;
+        if ( mprop == null || mprop.getContentType() == null)
         {
             _logger.debug(&quot;no message type specified, building a byte message&quot;);
             messageType = JMSBytesMessage.MIME_TYPE;
         }
&lt;p&gt;+        else&lt;br/&gt;
+        &lt;/p&gt;
{
+           messageType = mprop.getContentType();
+        }
&lt;p&gt;         MessageFactory mf = _mimeStringToFactoryMap.get(messageType);&lt;br/&gt;
         if (mf == null)&lt;br/&gt;
         {&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12641045" author="aidan" created="Mon, 20 Oct 2008 15:42:29 +0000"  >&lt;p&gt;No test for this. &lt;/p&gt;</comment>
                            <comment id="12643051" author="rhs" created="Mon, 27 Oct 2008 20:46:15 +0000"  >&lt;p&gt;The fix for this isn&apos;t safe. (Nor is the original code for this safe.) There is no guarantee that the headers will be delivered in a particular order or that if only one header Struct is delivered it is the delivery properties header struct.&lt;/p&gt;

&lt;p&gt;We should really not use a Struct[] at all. The code in MessageFactoryRegistry pulls out the MessageProperties correctly. It could simply pass them in directly or pass in the whole Header or the MessageTransfer object to the AbstractJMSMessageFactory and allow the appropriate accessors to be used there.&lt;/p&gt;</comment>
                            <comment id="12653796" author="arnaudsimon" created="Fri, 5 Dec 2008 14:28:32 +0000"  >&lt;p&gt;The status of this ug may have changed with the latest major code update. &lt;/p&gt;</comment>
                            <comment id="12657563" author="rgodfrey" created="Wed, 17 Dec 2008 21:25:08 +0000"  >&lt;p&gt;AFAICT there have been no changes to this class since the changes described here which are (as Rafi points out) unsafe, but no more so than the previous code.&lt;/p&gt;

&lt;p&gt;Therefore I propose we descope from M4 and fix in M5 or some other coming release.&lt;/p&gt;
</comment>
                            <comment id="12669917" author="aidan" created="Tue, 3 Feb 2009 10:20:04 +0000"  >&lt;p&gt;Not really sure why this got assigned to me...&lt;/p&gt;</comment>
                            <comment id="12671352" author="rajith" created="Fri, 6 Feb 2009 22:07:33 +0000"  >&lt;p&gt;I have commented a fix to this issue in Qpid trunk rev 741754.&lt;/p&gt;</comment>
                            <comment id="12675065" author="rhs" created="Thu, 19 Feb 2009 18:07:10 +0000"  >&lt;p&gt;I&apos;ve reviewed the change and the issue I mentioned is fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>168278</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 40 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0bvu7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>67270</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>