<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:22:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-6786] (0-10) ServerAssembler fails with IndexOutOfBoundsException on receipt of message with large headers</title>
                <link>https://issues.apache.org/jira/browse/QPID-6786</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;In a regression since 0.32, if I run the following program, the Java Broker fails with the following IOOBE.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ava.lang.IndexOutOfBoundsException: Index: 1, Size: 1
	at java.util.Collections$SingletonList.get(Collections.java:3375)
	at org.apache.qpid.server.protocol.v0_10.ServerDecoder.getCurrentBuffer(ServerDecoder.java:111)
	at org.apache.qpid.server.protocol.v0_10.ServerDecoder.advanceIfNecessary(ServerDecoder.java:41)
	at org.apache.qpid.server.protocol.v0_10.ServerDecoder.getBuffer(ServerDecoder.java:49)
	at org.apache.qpid.server.protocol.v0_10.ServerDecoder.readUint16(ServerDecoder.java:142)
	at org.apache.qpid.server.protocol.v0_10.ServerAssembler.assemble(ServerAssembler.java:201)
	at org.apache.qpid.server.protocol.v0_10.ServerAssembler.frame(ServerAssembler.java:152)
	at org.apache.qpid.server.protocol.v0_10.ServerAssembler.received(ServerAssembler.java:80)
	at org.apache.qpid.server.protocol.v0_10.ServerInputHandler.parse(ServerInputHandler.java:175)
	at org.apache.qpid.server.protocol.v0_10.ServerInputHandler.received(ServerInputHandler.java:82)
	at org.apache.qpid.server.protocol.v0_10.AMQPConnection_0_10$3.run(AMQPConnection_0_10.java:199)
	at java.security.AccessController.doPrivileged(Native Method)
	at org.apache.qpid.server.protocol.v0_10.AMQPConnection_0_10.received(AMQPConnection_0_10.java:191)
	at org.apache.qpid.server.transport.MultiVersionProtocolEngine.received(MultiVersionProtocolEngine.java:141)
	at org.apache.qpid.server.transport.NonBlockingConnection.processAmqpData(NonBlockingConnection.java:446)
	at org.apache.qpid.server.transport.NonBlockingConnectionPlainDelegate.processData(NonBlockingConnectionPlainDelegate.java:58)
	at org.apache.qpid.server.transport.NonBlockingConnection.doRead(NonBlockingConnection.java:349)
	at org.apache.qpid.server.transport.NonBlockingConnection.doWork(NonBlockingConnection.java:223)
	at org.apache.qpid.server.transport.NetworkConnectionScheduler.processConnection(NetworkConnectionScheduler.java:143)
	at org.apache.qpid.server.transport.NetworkConnectionScheduler.access$000(NetworkConnectionScheduler.java:37)
	at org.apache.qpid.server.transport.NetworkConnectionScheduler$2.run(NetworkConnectionScheduler.java:112)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;            ConnectionFactory connectionFactory = (ConnectionFactory) context.lookup(&quot;qpidConnectionfactory&quot;);
            Connection connection = connectionFactory.createConnection();
            connection.start();

            Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);
            Destination destination = (Destination) context.lookup(&quot;topicExchange&quot;);

            MessageProducer messageProducer = session.createProducer(destination);
            MessageConsumer messageConsumer = session.createConsumer(destination);

            TextMessage message = session.createTextMessage(&quot;Hello world!&quot;);
            message.setStringProperty(&quot;str1&quot;, new String(new byte[32000]));
            message.setStringProperty(&quot;str2&quot;, new String(new byte[32000]));
            message.setStringProperty(&quot;str3&quot;, new String(new byte[32000]));
            messageProducer.send(message);

            message = (TextMessage)messageConsumer.receive();
            System.out.println(message.getText());
            System.out.println(message.getStringProperty(&quot;str1&quot;).length());
            System.out.println(message.getStringProperty(&quot;str2&quot;).length());
            System.out.println(message.getStringProperty(&quot;str3&quot;).length());
            System.out.println(message.getText());

            connection.close();
            context.close();

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Same program passed successfully against 0.32.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12904037">QPID-6786</key>
            <summary>(0-10) ServerAssembler fails with IndexOutOfBoundsException on receipt of message with large headers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lorenz.quack">Lorenz Quack</assignee>
                                    <reporter username="kwall">Keith Wall</reporter>
                        <labels>
                    </labels>
                <created>Sun, 11 Oct 2015 14:16:57 +0000</created>
                <updated>Wed, 2 Oct 2019 19:22:09 +0000</updated>
                            <resolved>Fri, 16 Oct 2015 12:52:07 +0000</resolved>
                                    <version>qpid-java-6.0</version>
                                    <fixVersion>qpid-java-6.0</fixVersion>
                                    <component>Broker-J</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14957130" author="jira-bot" created="Wed, 14 Oct 2015 15:56:11 +0000"  >&lt;p&gt;Commit 1708636 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lorenz.quack&quot; class=&quot;user-hover&quot; rel=&quot;lorenz.quack&quot;&gt;lorenz.quack&lt;/a&gt; in branch &apos;java/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1708636&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1708636&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6786&quot; title=&quot;(0-10) ServerAssembler fails with IndexOutOfBoundsException on receipt of message with large headers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6786&quot;&gt;&lt;del&gt;QPID-6786&lt;/del&gt;&lt;/a&gt;: &lt;span class=&quot;error&quot;&gt;&amp;#91;Java Broker&amp;#93;&lt;/span&gt; Fix handling of large headers in 0-10&lt;/p&gt;

&lt;p&gt;The ServerDecoder was being reused but the internal _bufferIndex was not being reset. Fix by not reusing the decoder in the first place.&lt;/p&gt;</comment>
                            <comment id="14958801" author="k-wall" created="Thu, 15 Oct 2015 12:10:40 +0000"  >&lt;p&gt;Hi Lorenz, as discussed, currently &lt;tt&gt;AMQConnection.getMaximumFrameSize()&lt;/tt&gt; always returns zero for 0-10 connections, so the new test doesn&apos;t actual test what it intends.   Why maximumFrameSize is not wired up on the 0-10 path is not known to me.  There doesn&apos;t seem to be harm in fixing it to have the expected behaviour.  It looks like adding a &lt;tt&gt;FrameSizeObserver&lt;/tt&gt; call back in AMQConnectionDeletegate_0_10 would be one way to fix this.&lt;/p&gt;</comment>
                            <comment id="14960459" author="jira-bot" created="Fri, 16 Oct 2015 10:07:35 +0000"  >&lt;p&gt;Commit 1708942 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lorenz.quack&quot; class=&quot;user-hover&quot; rel=&quot;lorenz.quack&quot;&gt;lorenz.quack&lt;/a&gt; in branch &apos;java/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1708942&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1708942&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6786&quot; title=&quot;(0-10) ServerAssembler fails with IndexOutOfBoundsException on receipt of message with large headers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6786&quot;&gt;&lt;del&gt;QPID-6786&lt;/del&gt;&lt;/a&gt;: &lt;span class=&quot;error&quot;&gt;&amp;#91;Java Broker&amp;#93;&lt;/span&gt; Fix AMQConnection.getMaximumFrameSize() for AMQP 0-10&lt;/p&gt;

&lt;p&gt;Address review comments from Keith Wall.&lt;br/&gt;
Work around &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6793&quot; title=&quot;(0-10) Sending messages with large header string throws AssertionError&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6793&quot;&gt;&lt;del&gt;QPID-6793&lt;/del&gt;&lt;/a&gt; in the tests for now.&lt;/p&gt;</comment>
                            <comment id="15019064" author="jira-bot" created="Fri, 20 Nov 2015 23:35:50 +0000"  >&lt;p&gt;Commit 1715446 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gemmellr&quot; class=&quot;user-hover&quot; rel=&quot;gemmellr&quot;&gt;gemmellr&lt;/a&gt; in branch &apos;java/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1715446&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1715446&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6874&quot; title=&quot;[java] various failures when running the cpp test profile&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6874&quot;&gt;&lt;del&gt;QPID-6874&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6786&quot; title=&quot;(0-10) ServerAssembler fails with IndexOutOfBoundsException on receipt of message with large headers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6786&quot;&gt;&lt;del&gt;QPID-6786&lt;/del&gt;&lt;/a&gt;: exclude test from the cpp profile since the broker doesnt support the necessary behaviour&lt;/p&gt;</comment>
                            <comment id="15020523" author="rgodfrey" created="Sat, 21 Nov 2015 15:14:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gemmellr&quot; class=&quot;user-hover&quot; rel=&quot;gemmellr&quot;&gt;gemmellr&lt;/a&gt; Your comment in the excludes file &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;ins&gt;// &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6786&quot; title=&quot;(0-10) ServerAssembler fails with IndexOutOfBoundsException on receipt of message with large headers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6786&quot;&gt;&lt;del&gt;QPID-6786&lt;/del&gt;&lt;/a&gt; Sending headers larger than &lt;span class=&quot;error&quot;&gt;&amp;#91;first&amp;#93;&lt;/span&gt; transfer/frame size (which is outside the spec) isn&apos;t supported against the C&lt;/ins&gt;+ broker&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;implies you believe is it outside the spec to have a header segment (or a struct within the header segment) that spans more than frame.  I don&apos;t immediately see where the spec says that.&lt;/p&gt;

&lt;p&gt;Section 5.9.1 of the 0-10 spec says:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The contents of a header segment consists of a set of sized (size=&quot;4&quot;), coded, packed structs. These are sequentially encoded into the segment in an undefined order. When parsing the header segment, an implementation MUST assume that the entries may be in any order, and intermediaries MAY reorder or insert additional entries. A header segment MUST include at most one instance of each type.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Am I missing some other part of the spec which disallows the behaviour being tested by the test?  Or is it just that the C++ broker does not support in-spec functionality.&lt;/p&gt;</comment>
                            <comment id="15020566" author="gemmellr" created="Sat, 21 Nov 2015 16:46:34 +0000"  >&lt;p&gt;Mainly I said that as I beleived it was a limitation in 0-8/9 that was carried forward. Upon checking it does seem to be explicitly stated with regard to the message transfer fragments:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&quot;Only the first fragment carries the delivery-properties and message-properties.&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;With the application-headers being part of the message-properties.&lt;/p&gt;</comment>
                            <comment id="15020570" author="gemmellr" created="Sat, 21 Nov 2015 17:10:12 +0000"  >&lt;p&gt;Reading it a bit further (long time since I&apos;ve looked at the 0-10 spec, and I never really knew it that well to begin with), I&apos;m possibly confusing message fragments with the &apos;segments&apos;? I can&apos;t say that I know what the impl&apos;s do there.&lt;/p&gt;</comment>
                            <comment id="15020574" author="gemmellr" created="Sat, 21 Nov 2015 17:32:07 +0000"  >&lt;p&gt;Looking at the client, it only seems to use segmenting rather than fragmenting, so it seems that it should work. I have raised &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6875&quot; title=&quot;failure when sending 0-10 message to qpidd with multiple frames worth of application headers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6875&quot;&gt;QPID-6875&lt;/a&gt; to cover it.&lt;/p&gt;</comment>
                            <comment id="15020648" author="rgodfrey" created="Sat, 21 Nov 2015 19:40:41 +0000"  >&lt;p&gt;I must admit I had completely forgotten about message fragmentation...  It&apos;s certainly not supported by the Java client or broker.  IIRC that is about transferring a message in multiple separate transfer commands, and the rule you gave above is basically saying the headers/properties must be in the first command (and by implication subsequent transfers regarding the same message will only be carrying body segments).  So I think &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6875&quot; title=&quot;failure when sending 0-10 message to qpidd with multiple frames worth of application headers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6875&quot;&gt;QPID-6875&lt;/a&gt; that you have raised is a genuine defect in the C++ broker&lt;/p&gt;</comment>
                            <comment id="15028725" author="alex.rufous" created="Thu, 26 Nov 2015 13:11:04 +0000"  >&lt;p&gt;Changes under revision &lt;a href=&quot;https://svn.apache.org/r1715446&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1715446&lt;/a&gt; are approved for inclusion into 6.0.x branch&lt;/p&gt;</comment>
                            <comment id="15028822" author="jira-bot" created="Thu, 26 Nov 2015 14:04:00 +0000"  >&lt;p&gt;Commit 1716659 from orudyy@apache.org in branch &apos;java/branches/6.0.x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1716659&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1716659&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6874&quot; title=&quot;[java] various failures when running the cpp test profile&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6874&quot;&gt;&lt;del&gt;QPID-6874&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6786&quot; title=&quot;(0-10) ServerAssembler fails with IndexOutOfBoundsException on receipt of message with large headers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6786&quot;&gt;&lt;del&gt;QPID-6786&lt;/del&gt;&lt;/a&gt;: exclude test from the cpp profile since the broker doesnt support the necessary behaviour&lt;br/&gt;
------------------------------------------------------------------------&lt;br/&gt;
Merged from trunk with command:&lt;br/&gt;
svn merge -c r1715446 &lt;a href=&quot;https://svn.apache.org/repos/asf/qpid/java/trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/qpid/java/trunk&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15034061" author="gsim" created="Tue, 1 Dec 2015 16:58:20 +0000"  >&lt;p&gt;Yes, lack of support for multi-frame header (or command) segments in qpid-cpp (broker and client) is a known limitation.&lt;/p&gt;</comment>
                            <comment id="15636948" author="jira-bot" created="Fri, 4 Nov 2016 16:45:32 +0000"  >&lt;p&gt;Commit 1768064 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwall&quot; class=&quot;user-hover&quot; rel=&quot;kwall&quot;&gt;kwall&lt;/a&gt; in branch &apos;java/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1768064&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1768064&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6786&quot; title=&quot;(0-10) ServerAssembler fails with IndexOutOfBoundsException on receipt of message with large headers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6786&quot;&gt;&lt;del&gt;QPID-6786&lt;/del&gt;&lt;/a&gt;: &lt;span class=&quot;error&quot;&gt;&amp;#91;Java Common&amp;#93;&lt;/span&gt; Prevent AbstractEncoder generating str8 or str16 that exceed the type&apos;s limits&lt;/p&gt;

&lt;p&gt;Also use StandardCharsets.UTF_8 to avoid the exception handling clutter.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12905211">QPID-6793</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 2 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mv33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>