<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:23:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-8285] [JMS AMQP 0-x] Deadlock during receiveMessage when broker connecton fails</title>
                <link>https://issues.apache.org/jira/browse/QPID-8285</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;When a JMS MessageConsumer calls receiveMessage with a timeout, if no message is received during the timeout, BasicMessageConsumer_0_10.getMessageFromQueue() calls the syncDispatchQueue() method.&#160; As not the dispatcher thread, the consumer waits on a method local CountDownLatch which should be decremented when the AMQSession.Dispatcher thread calls dispatch().&lt;/p&gt;

&lt;p&gt;In the AMQSession.Dispatcher thread, the core loop will stop pulling from the queue to dispatch messages when the connection to the broker is lost (isClosing() becomes true).&lt;/p&gt;

&lt;p&gt;In this scenario, the receiveMessage call is waiting forever because the Dispatcher will never call dispatch.&#160; This also leaves the Dispatcher thread in an infinite loop (using 100% CPU) waiting to be fully closed.&lt;/p&gt;

&lt;p&gt;This can fixed by allowing the AMQSession.Dispatcher to always dispatch remaining queue content to ensure a consumer is not waiting forever (see attached).&lt;/p&gt;</description>
                <environment>&lt;ul&gt;
	&lt;li&gt;Java 1.8.0_20, 1.8.0_192, &amp;amp; 1.8.0_172&lt;/li&gt;
	&lt;li&gt;Linux 4.9.0-4-amd64 &amp;amp; 3.10.0-327.13&lt;/li&gt;
	&lt;li&gt;qpidd 1.39.0&lt;/li&gt;
&lt;/ul&gt;
</environment>
        <key id="13221431">QPID-8285</key>
            <summary>[JMS AMQP 0-x] Deadlock during receiveMessage when broker connecton fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="orudyy">Alex Rudyy</assignee>
                                    <reporter username="jbeales">Jonathan Beales</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Mar 2019 15:08:58 +0000</created>
                <updated>Mon, 20 May 2019 09:53:43 +0000</updated>
                            <resolved>Mon, 20 May 2019 08:42:50 +0000</resolved>
                                                    <fixVersion>qpid-java-client-0-x-6.3.4</fixVersion>
                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16791839" author="gemmellr" created="Wed, 13 Mar 2019 16:01:40 +0000"  >&lt;p&gt;QPIDJMS is only the Jira project for the newer AMQP 1.0 JMS client. I&apos;ll move this issue to the QPID Jira project used for the older AMQP 0-x client if I can, or close it if not.&lt;/p&gt;</comment>
                            <comment id="16838712" author="jira-bot" created="Mon, 13 May 2019 17:04:30 +0000"  >&lt;p&gt;Commit d6335fd04ce38f5cfe796f15c177ece988ee2815 in qpid-jms-amqp-0-x&apos;s branch refs/heads/master from Alex Rudyy&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=qpid-jms-amqp-0-x.git;h=d6335fd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=qpid-jms-amqp-0-x.git;h=d6335fd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-8285&quot; title=&quot;[JMS AMQP 0-x] Deadlock during receiveMessage when broker connecton fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-8285&quot;&gt;&lt;del&gt;QPID-8285&lt;/del&gt;&lt;/a&gt;: &lt;span class=&quot;error&quot;&gt;&amp;#91;JMS AMQP 0-x&amp;#93;&lt;/span&gt; Fix syncing of dispatch queue&lt;/p&gt;</comment>
                            <comment id="16838714" author="jira-bot" created="Mon, 13 May 2019 17:07:37 +0000"  >&lt;p&gt;Commit c058fb351ee93e9c7585c82b7e4515ef38339def in qpid-jms-amqp-0-x&apos;s branch refs/heads/6.3.x from Alex Rudyy&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=qpid-jms-amqp-0-x.git;h=c058fb3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=qpid-jms-amqp-0-x.git;h=c058fb3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-8285&quot; title=&quot;[JMS AMQP 0-x] Deadlock during receiveMessage when broker connecton fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-8285&quot;&gt;&lt;del&gt;QPID-8285&lt;/del&gt;&lt;/a&gt;: &lt;span class=&quot;error&quot;&gt;&amp;#91;JMS AMQP 0-x&amp;#93;&lt;/span&gt; Fix syncing of dispatch queue&lt;/p&gt;

&lt;p&gt;(cherry picked from commit d6335fd04ce38f5cfe796f15c177ece988ee2815)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12962351" name="qpid_jms_deaklock.patch" size="1173" author="jbeales" created="Wed, 13 Mar 2019 15:06:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z00nyo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>