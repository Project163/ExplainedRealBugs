<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:21:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-2930]  JMS msg.getPropertyNames() method should not return x-amqp-0-10.routing-key</title>
                <link>https://issues.apache.org/jira/browse/QPID-2930</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;Description of problem:&lt;br/&gt;
JMS msg.getPropertyNames() method should not return x-amqp-0-10.routing-key,&lt;br/&gt;
x-amqp-0-10.routing-key is internal property. It cause exception if loop via&lt;br/&gt;
ProertyName enumeration. &lt;/p&gt;

&lt;p&gt;Code: &lt;br/&gt;
=== &lt;br/&gt;
Enumeration&amp;lt;String&amp;gt; enu = msg.getPropertyNames(); &lt;br/&gt;
while (enu.hasMoreElements()) { &lt;br/&gt;
String name = (String) enu.nextElement(); &lt;br/&gt;
String value = msg.getStringProperty(name); &lt;br/&gt;
} &lt;/p&gt;

&lt;p&gt;Exception&lt;br/&gt;
=========&lt;br/&gt;
Caused by: javax.jms.MessageFormatException:&lt;br/&gt;
getString(&quot;x-amqp-0-10.routing-key&quot;) failed as value of type class [B is an array. &lt;br/&gt;
at&lt;br/&gt;
org.apache.qpid.client.message.AMQMessageDelegate_0_10.getStringProperty(AMQMessageDelegate_0_10.java:639) &lt;br/&gt;
at&lt;br/&gt;
org.apache.qpid.client.message.AbstractJMSMessage.getStringProperty(AbstractJMSMessage.java:254) &lt;/p&gt;</description>
                <environment></environment>
        <key id="12479157">QPID-2930</key>
            <summary> JMS msg.getPropertyNames() method should not return x-amqp-0-10.routing-key</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajith">Rajith Muditha Attapattu</assignee>
                                    <reporter username="rajith">Rajith Muditha Attapattu</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Nov 2010 23:05:45 +0000</created>
                <updated>Tue, 14 Mar 2017 20:08:16 +0000</updated>
                            <resolved>Thu, 17 Mar 2011 22:05:49 +0000</resolved>
                                                    <fixVersion>0.10</fixVersion>
                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12934472" author="andrew.kennedy" created="Mon, 22 Nov 2010 14:22:03 +0000"  >&lt;p&gt;But, why are you trying to get this property value as a String in the first place?&lt;/p&gt;

&lt;p&gt;This is a byte array, so I think the exception is correct in this circumstance. If I set &lt;b&gt;any&lt;/b&gt; byte array property then the code you describe will fail in the same way. Additionally, I don&apos;t think we want to go down the road of special-casing property names to be &apos;hidden&apos; from the returned enumeration of property names. I would think thst if a property is set, on the message, and &lt;b&gt;can&lt;/b&gt; be retreived its name should be returned.&lt;/p&gt;

&lt;p&gt;Finally, would it be possible, instead, to fix this by setting the value as a String in the first place? I assume this is the C++ broker, where OutgoingMessage.cpp and IncomingMessage.cpp seem to define this as const std::string X_ROUTING_KEY(&quot;x-amqp-0-10.routing-key&quot;);&lt;/p&gt;</comment>
                            <comment id="13001875" author="rajith" created="Thu, 3 Mar 2011 05:51:01 +0000"  >&lt;p&gt;The JMS specification allows any message property to be retrieved as a string.&lt;br/&gt;
However the the valid types are boolean, byte, short, int, long, float, double, and String.&lt;br/&gt;
Therefore in JMS, the property value cannot be a byte[] as it&apos;s not a valid type.&lt;/p&gt;

&lt;p&gt;However in AMQP you are allowed to have byte arrays,lists, maps, UUID&apos;s etc.. as property values.&lt;br/&gt;
So a broker or a non JMS client could set such a property in a message that will be consumed by a JMS consumer.&lt;/p&gt;

&lt;p&gt;In such a case there are two possible ways of handling it.&lt;br/&gt;
1) Ignore the properties (from the list provided in response to getPropertyNames() method)  that does not have a value allowed by the JMS spec.&lt;br/&gt;
2) Provide the standard string representation of the value.&lt;/p&gt;

&lt;p&gt;Option #2 is fairly useless if the value is of type array, list or map.&lt;/p&gt;

&lt;p&gt;I think option #1 is probably the best as a JMS client will not expect to receive any property with a value that is not valid as per the spec. Therefore it does not need to even know the name of a property that it cannot access.&lt;/p&gt;</comment>
                            <comment id="13001887" author="rajith" created="Thu, 3 Mar 2011 06:30:05 +0000"  >&lt;p&gt;The Qpid implementation does allow a byte[] to be set using the setObjectProperty method, which is not correct as per the JMS specification.&lt;br/&gt;
I am actually fine with utilizing the set/getObjectProperty method as an extension point to allow maps, lists, UUID, arrays etc to be used.&lt;/p&gt;

&lt;p&gt;But we need to ensure that we have a sane way of handling these extensions while ensure we are also spec complaint.&lt;br/&gt;
Maybe if getStringProperty is called we could print something like, &quot;&amp;lt;list&amp;gt; please use getObjectProperty to retrieve this value correctly&quot;.&lt;br/&gt;
For things like UUID we could provide the toString representation of it.&lt;/p&gt;

&lt;p&gt;Thoughts ?&lt;/p&gt;</comment>
                            <comment id="13008186" author="rajith" created="Thu, 17 Mar 2011 22:05:49 +0000"  >&lt;p&gt;Fixed along with a test case.&lt;/p&gt;</comment>
                            <comment id="13008767" author="andrew.kennedy" created="Sat, 19 Mar 2011 13:16:14 +0000"  >&lt;p&gt;While I approve of adding tests, in this case the only assertion is that a sent message (with no properties set) is received, so this issue is never tested. I think the test case should set some properties, of varying allowed and non-allowed types, and then assert that the returned message still provides an enumeration with a list of those, and only those, properties.&lt;/p&gt;

&lt;p&gt;Since x-amqp-0-10.routing-key is internal, maybe it should be filtered out, along with all other x-amqp-* and x-qpid-* properties?&lt;/p&gt;</comment>
                            <comment id="13008768" author="andrew.kennedy" created="Sat, 19 Mar 2011 13:20:28 +0000"  >&lt;p&gt;Re: using set/getObjectProperty as an extension point, is this documented behaviour, somewhere?&lt;/p&gt;</comment>
                            <comment id="13009529" author="rajith" created="Tue, 22 Mar 2011 03:01:24 +0000"  >&lt;p&gt;Andrew, &lt;/p&gt;

&lt;p&gt;I had modified the test case for testing/debugging another issue and forgot to reapply the deleted contents before checking it in.&lt;br/&gt;
Thanks for catching this. I have reapplied the necessary changes in rev 1084048 which should test the issue highlighted in the JIRA.&lt;/p&gt;

&lt;p&gt;As for documentation for set/getObjectProperty as an extension point, I haven&apos;t really seen any that says we support byte arrays in addition to the supported types listed in the spec.&lt;/p&gt;

&lt;p&gt;I don&apos;t know if filtering out x-amqp* and x-qpid* is the right option, especially if those properties are of a type supported by the JMS spec and some application wants to access them. On the other hand one can argue that these props are for internal purposes and not for applications.&lt;/p&gt;

&lt;p&gt;The reason why I omitted &quot;x-amqp-0-10.routing-key&quot; from the enumerated prop name list, is bcos it&apos;s value was not a supported JMS type. The user who complained about this issue has rightly pointed out that any property in a message should be accessible as &apos;getStringProperty&apos;.&lt;/p&gt;

&lt;p&gt;So if we do decide to use set/getObjectProperty as an extension point then we need to ensure we handle it in a sensible manner and in a way that is also spec complaint. That is if getStringProperty is used to retrieve such a property then we need to provide,&lt;br/&gt;
(a) some form of meaningful string representation&lt;br/&gt;
(b) OR a warning message on how to retrieve it properly rather than throwing an exception. Ex &quot;&amp;lt;list&amp;gt; please use getObjectProperty to retrieve this value correctly&quot;&lt;br/&gt;
(c) Or maybe by throwing a MessageFormatException, all though in this case the user wasn&apos;t happy about it. - However if we had documented the behaviour then I doubt they would have complained about it.&lt;/p&gt;

&lt;p&gt;So going forward we probably need to pay attention to these areas and make sure we document them properly to avoid users misunderstanding them.&lt;/p&gt;

</comment>
                            <comment id="13009922" author="rajith" created="Wed, 23 Mar 2011 00:14:43 +0000"  >&lt;p&gt;should we not apply the same fix for the 0-8 code path ? or should we just leave things as it is and just exclude the test from 0-8 ?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>169595</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 35 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0bobr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66053</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>