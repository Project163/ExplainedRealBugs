<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:20:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-2242] JMS_QPID_DESTTYPE is not set making getJMSDestination unusable.</title>
                <link>https://issues.apache.org/jira/browse/QPID-2242</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;The problem is that Qpid M2.1 (and earlier) sets the JMS_QPID_DESTTYPE header property before sending. &lt;br/&gt;
If you try and do that on a message that doesn&apos;t have the property set then it will attempt to write it into the _encodedForm ByteBuffer if there is one.&lt;/p&gt;

&lt;p&gt;In the scenario where you are receiving messages and then re-sending them not creating new ones. The header has already been read so the buffer limit and position are the same which means any write to the buffer will throw a BufferOverflowException. In short the headers are Read Only.&lt;/p&gt;

&lt;p&gt;I have tested with M2.1 After the merge to trunk for M3 the setting of this property was removed. Which does mean that the JMS Destination is marked as &apos;unknown&apos; rather than &apos;direct&apos; which means if you attempted to do message.getJMSDestination() to send the message back in to the queue for reprocessing it would fail.&lt;/p&gt;

&lt;p&gt;Further investigations:&lt;br/&gt;
Understand why this setting was dropped after the Merge from M2.x to trunk. This property is used to control the type of Destination that message.getJMSDestination() returns.&lt;/p&gt;

&lt;p&gt;Need to check M1 to see if it sets the value on sent Messages.&lt;/p&gt;

&lt;p&gt;Also need to check how the 0-10 code path defines the JMSDestination() as it too appears to never to have a value set and so will be an &apos;unknown&apos; destination.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12442481">QPID-2242</key>
            <summary>JMS_QPID_DESTTYPE is not set making getJMSDestination unusable.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ritchiem">Martin Ritchie</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Dec 2009 17:51:36 +0000</created>
                <updated>Mon, 5 Sep 2011 21:51:09 +0000</updated>
                            <resolved>Mon, 5 Sep 2011 21:50:16 +0000</resolved>
                                    <version>M3</version>
                    <version>M4</version>
                    <version>0.5</version>
                                    <fixVersion>JIRA Cleanup</fixVersion>
                                    <component>Java Common</component>
                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12786914" author="ritchiem" created="Mon, 7 Dec 2009 13:44:04 +0000"  >&lt;p&gt;0-10 code has an ExchangeQuery method that allows the type lookup of the destination to be performed. However, whilst it is currently doing this it is not calling setJMSDestination when it creates the message so null is always returned.&lt;/p&gt;

&lt;p&gt;0-9/8 code set the JMSDestination to be the same as the consumers destination during postDelivery. This means that using receive the value will be set and appear correct. If queried during an onMessage receive then the exchange value will be &apos;unknown&apos;. However, the value is wrong, the spec says that &quot; When a message is received, its JMSDestination value must be equivalent the the value assigned when it was sent.&quot; &lt;/p&gt;

&lt;p&gt;So by testing that a message moved from a topic to a queue the JMSDestination should reflect its original destination. Testing under 0-10 proves that this works correctly (required some work on &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-2244&quot; title=&quot;AMQQueueMBean.viewMessages does not show 0-10 protocol MessageTransferMessage&amp;#39;s &quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-2244&quot;&gt;&lt;del&gt;QPID-2244&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Problem with the 0-8/9 code path is that there is no ExchangeQuery option. However, the same code can be used as it is preloaded with the default exchange names and this will be sufficient for the majority of use cases.&lt;/p&gt;</comment>
                            <comment id="12787568" author="ritchiem" created="Tue, 8 Dec 2009 16:41:12 +0000"  >&lt;p&gt;I have restored the setting of JMS_QPID_DESTTYPE on the 0-8/9 code path during message send.&lt;/p&gt;

&lt;p&gt;When the message is received on the 0-8/9 code path it will consult the JMS_QPID_DESTTYPE first if that fails then it will fallback to use the lookup tables used by the 0-10 code path. &lt;/p&gt;

&lt;p&gt;Testing on trunk has been performed by using the new multi-protocol broker and so is only run with the &apos;java.0.10&apos; profile.&lt;/p&gt;

&lt;p&gt;The changes have all be merged to the 0.5.x-dev branch though the JMS_QPID_DESTTYPE test had to be modified to only validate that we can forward current messages ok. The lack of multi-protocol support means that we are unable to test this functionality.&lt;/p&gt;</comment>
                            <comment id="12835111" author="rajith" created="Thu, 18 Feb 2010 04:02:06 +0000"  >&lt;p&gt;There were several bugs in the 0-10 code path.&lt;br/&gt;
The method &quot;updateExchangeType&apos; is doing a lookup on a map keyed by &quot;exchange-name&quot; using the &quot;exchange-type&quot;.&lt;br/&gt;
In the same method the queried exchange-type is not saved, therefore unable to make use of it in &quot;generateDestination&quot; method&lt;br/&gt;
The code never worked for anything other than the standard exchange types. The only reason why it worked for the standard exchange types was due to the map being pre-populated.&lt;/p&gt;</comment>
                            <comment id="12835120" author="rajith" created="Thu, 18 Feb 2010 04:45:11 +0000"  >&lt;p&gt;I fixed the issues mentioned in above in rev 911251 in Qpid trunk.&lt;br/&gt;
Verified that existing tests pass. I would be adding a test with a custom exchange to test this code.&lt;/p&gt;</comment>
                            <comment id="12848949" author="rajith" created="Tue, 23 Mar 2010 22:49:57 +0000"  >&lt;p&gt;Added a test with a destination containing a custom exchange at rev 926829 in Qpid trunk.&lt;/p&gt;</comment>
                            <comment id="13097577" author="gemmellr" created="Mon, 5 Sep 2011 21:50:16 +0000"  >&lt;p&gt;Review-OK&apos;ing issue as part of JIRA cleanup. Issue could be resolved, but may not be: see &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-3469&quot; title=&quot;JIRA clean up for Java client/broker&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-3469&quot;&gt;&lt;del&gt;QPID-3469&lt;/del&gt;&lt;/a&gt; for further details.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>62419</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0blb3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>65564</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>