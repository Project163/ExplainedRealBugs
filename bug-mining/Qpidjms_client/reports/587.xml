<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:22:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-3521] failover process for the 0-8 client does not clear the pre-dispatch queue</title>
                <link>https://issues.apache.org/jira/browse/QPID-3521</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;failover process for the 0-8 client does not clear the pre-dispatch queue, only the consumer receive queue.&lt;/p&gt;

&lt;p&gt;This is currently masked by an issue with the rollbackMark. The changes made in &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-3546&quot; title=&quot;client can reject/release up to the first &amp;lt;total number of messages received on the session&amp;gt; sent by the broker following the first rollback after failover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-3546&quot;&gt;&lt;del&gt;QPID-3546&lt;/del&gt;&lt;/a&gt; to fix the 0-10 client path need to be applied to the 0-8/9/9-1 client path when this issue is resolved.&lt;/p&gt;

&lt;p&gt;We need to clear the pre-dispatch queue on failover. Additionally, we need to acquire dispatcher and messageDelivery locks in failover thread in order to prevent the dispatcher from dispatching pre-fetched messages whilst failover is in progress. If we are not holding the locks, the dispatcher could continue dispatching prefetched messages into MessageListener which would result in unnecessary JMSExceptions on acknowledge/rollback/commit/recover.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12525797">QPID-3521</key>
            <summary>failover process for the 0-8 client does not clear the pre-dispatch queue</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="orudyy">Alex Rudyy</assignee>
                                    <reporter username="robbie">Robbie Gemmell</reporter>
                        <labels>
                            <label>failover</label>
                    </labels>
                <created>Wed, 5 Oct 2011 11:48:49 +0000</created>
                <updated>Fri, 7 Aug 2015 12:10:36 +0000</updated>
                            <resolved>Fri, 7 Aug 2015 12:09:38 +0000</resolved>
                                                    <fixVersion>qpid-java-6.0</fixVersion>
                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14648928" author="jira-bot" created="Fri, 31 Jul 2015 08:34:38 +0000"  >&lt;p&gt;Commit 1693542 from orudyy@apache.org in branch &apos;java/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1693542&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1693542&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-3521&quot; title=&quot;failover process for the 0-8 client does not clear the pre-dispatch queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-3521&quot;&gt;&lt;del&gt;QPID-3521&lt;/del&gt;&lt;/a&gt;: Clear pre-dispatch queue in 0-8 client on failover process&lt;/p&gt;</comment>
                            <comment id="14648933" author="alex.rufous" created="Fri, 31 Jul 2015 08:37:04 +0000"  >&lt;p&gt;Keith,&lt;br/&gt;
Please review&lt;/p&gt;</comment>
                            <comment id="14648959" author="jira-bot" created="Fri, 31 Jul 2015 09:06:10 +0000"  >&lt;p&gt;Commit 1693549 from orudyy@apache.org in branch &apos;java/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1693549&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1693549&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-3521&quot; title=&quot;failover process for the 0-8 client does not clear the pre-dispatch queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-3521&quot;&gt;&lt;del&gt;QPID-3521&lt;/del&gt;&lt;/a&gt;: Remove not needed thread dump generation in the system test and count down dispatcher blocking latch in the final block&lt;/p&gt;</comment>
                            <comment id="14652040" author="k-wall" created="Mon, 3 Aug 2015 16:09:34 +0000"  >&lt;p&gt;A couple of comments:&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;Code changes seem to make a functional change to the 0-10 Connection#stop path, but this is not called out in the JIRA.  I suggest a new JIRA describing the issue/user impact is appropriate.&lt;/li&gt;
	&lt;li&gt;I like the fact that we are now testing failover + connectio#stop, but it is the test assumes internals of the Java Broker (the  statistic unacknowledgedMessages) and this is distasteful, as is spreading knowledge of the management interfaces across the test suite.  Why is it not sufficient countdown after the message listener&apos;s Connection#stop and kill the Broker to cause failover?&lt;/li&gt;
	&lt;li&gt;AMQSession#stopExistingDispatcher is a check then act with the risk of a NPE if _dispatcher is nulled between. Copy the reference and then use the copy.&lt;/li&gt;
	&lt;li&gt;AMQSession#drainDispatchQueueWithDispatcher use a try/finally to help ensure that the dispatcher cleanup flag is always returned to its unset state.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="14653332" author="alex.rufous" created="Tue, 4 Aug 2015 09:11:15 +0000"  >&lt;p&gt;Keith,&lt;br/&gt;
I raised JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6677&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;QPID-6677&lt;/a&gt; to address your comment #1.&lt;br/&gt;
Regarding comment #2: The test does not only test stop functionality. The primary purpose of it is to make sure that pre-dispatch queue with messages is drained regardless whether dispatcher stopped or not.&lt;br/&gt;
I could not figure out the better way to make sure that messages are prefetched and have not get into the consumers queues. For that purpose, I stopped the queue from a dispatcher thread.&lt;br/&gt;
Regarding comment #3: I fill made the change to address pointed issue.&lt;br/&gt;
Regarding comment #4: I will implement the fix. It seems we got the separate JIRA about the issue &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-3520&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;QPID-3520&lt;/a&gt;. It make sense to do as part of JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-3520&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;QPID-3520&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14653924" author="alex.rufous" created="Tue, 4 Aug 2015 16:30:49 +0000"  >&lt;p&gt;It seems that changes implemented in revision &lt;a href=&quot;https://svn.apache.org/r1693542&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1693542&lt;/a&gt; might cause a deadlock on 0-9 path when Session is closed whilst failover is in progress. Here is the thread dump demonstrating the issue: &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;Failover&quot; prio=10 tid=0x00007fe0d804e000 nid=0x657c waiting on condition [0x00007fe0cf1f0000]
   java.lang.Thread.State: WAITING (parking)
        at sun.misc.Unsafe.park(Native Method)
        - parking to wait for  &amp;lt;0x00000000f41c2528&amp;gt; (a java.util.concurrent.CountDownLatch$Sync)
        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
        at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)
        at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedInterruptibly(AbstractQueuedSynchronizer.java:994)
        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1303)
        at java.util.concurrent.CountDownLatch.await(CountDownLatch.java:236)
        at org.apache.qpid.client.AMQSession.drainDispatchQueue(AMQSession.java:2306)
        at org.apache.qpid.client.AMQSession.drainDispatchQueueWithDispatcher(AMQSession.java:3697)
        at org.apache.qpid.client.AMQSession_0_8.resubscribe(AMQSession_0_8.java:186)
        at org.apache.qpid.client.AMQConnectionDelegate_8_0.resubscribeSessions(AMQConnectionDelegate_8_0.java:379)
        at org.apache.qpid.client.AMQConnection.resubscribeSessions(AMQConnection.java:1387)
        at org.apache.qpid.client.failover.FailoverHandler.run(FailoverHandler.java:221)
        - locked &amp;lt;0x00000000f35412c0&amp;gt; (a java.lang.Object)
        at java.lang.Thread.run(Thread.java:745)

&quot;Dispatcher-2-Conn-84&quot; prio=10 tid=0x00007fe1341c0000 nid=0x657a waiting for monitor entry [0x00007fe0cf4f3000]
   java.lang.Thread.State: BLOCKED (on object monitor)
        at org.apache.qpid.client.AMQSession$Dispatcher.dispatchMessage(AMQSession.java:3492)
        - waiting to lock &amp;lt;0x00000000f35c8e78&amp;gt; (a java.lang.Object)
        - locked &amp;lt;0x00000000f3cbea70&amp;gt; (a java.lang.Object)
        at org.apache.qpid.client.AMQSession$Dispatcher.access$1000(AMQSession.java:3279)
        at org.apache.qpid.client.AMQSession.dispatch(AMQSession.java:3272)
        at org.apache.qpid.client.message.UnprocessedMessage.dispatch(UnprocessedMessage.java:54)
        at org.apache.qpid.client.AMQSession$Dispatcher.run(AMQSession.java:3410)
        - locked &amp;lt;0x00000000f3cbea70&amp;gt; (a java.lang.Object)
        at java.lang.Thread.run(Thread.java:745)

&quot;main&quot; prio=10 tid=0x00007fe134008800 nid=0x58f1 waiting for monitor entry [0x00007fe13d822000]
   java.lang.Thread.State: BLOCKED (on object monitor)
        at org.apache.qpid.client.AMQSession.close(AMQSession.java:728)
        - waiting to lock &amp;lt;0x00000000f35412c0&amp;gt; (a java.lang.Object)
        - locked &amp;lt;0x00000000f35c8e78&amp;gt; (a java.lang.Object)
        at org.apache.qpid.client.AMQSession.close(AMQSession.java:447)
        at org.apache.qpid.client.failover.FailoverBehaviourTest.sessionCloseWhileFailoverImpl(FailoverBehaviourTest.java:1705)
        at org.apache.qpid.client.failover.FailoverBehaviourTest.testClientAcknowledgedSessionCloseWhileFailover(FailoverBehaviourTest.java:702)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:606)
        at junit.framework.TestCase.runTest(TestCase.java:176)
        at org.apache.qpid.test.utils.QpidTestCase.runTest(QpidTestCase.java:171)
        at junit.framework.TestCase.runBare(TestCase.java:141)
        at org.apache.qpid.test.utils.QpidBrokerTestCase.runBare(QpidBrokerTestCase.java:332)
        at junit.framework.TestResult$1.protect(TestResult.java:122)
        at junit.framework.TestResult.runProtected(TestResult.java:142)
        at junit.framework.TestResult.run(TestResult.java:125)
        at junit.framework.TestCase.run(TestCase.java:129)
        at org.apache.qpid.test.utils.QpidTestCase.run(QpidTestCase.java:156)
        at junit.framework.TestSuite.runTest(TestSuite.java:255)
        at junit.framework.TestSuite.run(TestSuite.java:250)
        at org.junit.internal.runners.JUnit38ClassRunner.run(JUnit38ClassRunner.java:84)
        at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:264)
        at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:153)
        at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:124)
        at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:200)
        at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:153)
        at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:103)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On the thread dump above Session#close() is invoked from the &quot;main&quot; thread. As part of Session#close() _messageDeliveryLock is acquired and main thread is waiting for the failover mutex which is acquired by &quot;Failover&quot; thread which is waiting for a Dispatcher thread to drain the pre-dispatch queue.  However, Dispatcher thread requires  _messageDeliveryLock to perform the clean up. Thus, it is in BLOCKED state causing the application hang.&lt;/p&gt;</comment>
                            <comment id="14658427" author="jira-bot" created="Wed, 5 Aug 2015 15:58:29 +0000"  >&lt;p&gt;Commit 1694254 from orudyy@apache.org in branch &apos;java/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1694254&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1694254&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-3521&quot; title=&quot;failover process for the 0-8 client does not clear the pre-dispatch queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-3521&quot;&gt;&lt;del&gt;QPID-3521&lt;/del&gt;&lt;/a&gt;: &lt;span class=&quot;error&quot;&gt;&amp;#91;Java Client&amp;#93;&lt;/span&gt; Stop using dispatcher to clear pre-dispatch queue on 0.8/0.9.x client in order to avoid dead locks.&lt;br/&gt;
           Address review comments.&lt;/p&gt;</comment>
                            <comment id="14658682" author="k-wall" created="Wed, 5 Aug 2015 18:54:52 +0000"  >&lt;p&gt;It appears that commit r1694254 is causing a unit test failure:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Running org.apache.qpid.client.AMQSession_0_8Test
Tests run: 2, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.682 sec &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.qpid.client.AMQSession_0_8Test
testResubscribe(org.apache.qpid.client.AMQSession_0_8Test)  Time elapsed: 0.369 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!
org.mockito.exceptions.verification.WantedButNotInvoked:
Wanted but not invoked:
unprocessedMessage.dispatch(
    org.apache.qpid.client.AMQSession_0_8@6f7923a5
);
-&amp;gt; at org.apache.qpid.client.AMQSession_0_8Test.testResubscribe(AMQSession_0_8Test.java:165)

However, there were other interactions with this mock:
-&amp;gt; at org.apache.qpid.client.AMQSession.messageReceived(AMQSession.java:1712)

	at org.apache.qpid.client.AMQSession_0_8Test.testResubscribe(AMQSession_0_8Test.java:165)


Results :

Failed tests:
  AMQSession_0_8Test&amp;gt;QpidTestCase.run:156-&amp;gt;QpidTestCase.runTest:171-&amp;gt;testResubscribe:165
Wanted but not invoked:
unprocessedMessage.dispatch(
    org.apache.qpid.client.AMQSession_0_8@6f7923a5
);
-&amp;gt; at org.apache.qpid.client.AMQSession_0_8Test.testResubscribe(AMQSession_0_8Test.java:165)

However, there were other interactions with this mock:
-&amp;gt; at org.apache.qpid.client.AMQSession.messageReceived(AMQSession.java:1712)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14658742" author="rgodfrey" created="Wed, 5 Aug 2015 19:38:59 +0000"  >&lt;p&gt;What&apos;s the rationale for adding the ConnectionHelper class - moving the functionality from AMQConnection to a static method which then operates on the connection?&lt;/p&gt;

&lt;p&gt;Refactoring in this way doesn&apos;t seem to add any tangible benefits and seems simply to move methods from the class they affect to a separate file.&lt;/p&gt;

&lt;p&gt;There&apos;s certainly a lot of valuable refactoring that could be done around the client... but I&apos;m not sure this is really an improvement&lt;/p&gt;</comment>
                            <comment id="14658768" author="jira-bot" created="Wed, 5 Aug 2015 19:55:04 +0000"  >&lt;p&gt;Commit 1694307 from orudyy@apache.org in branch &apos;java/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1694307&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1694307&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-3521&quot; title=&quot;failover process for the 0-8 client does not clear the pre-dispatch queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-3521&quot;&gt;&lt;del&gt;QPID-3521&lt;/del&gt;&lt;/a&gt;: Fix failing test and remove FailoverBehaviourTest#testFailoverWhenConnectionStopped from cpp excludes&lt;/p&gt;</comment>
                            <comment id="14659776" author="alex.rufous" created="Thu, 6 Aug 2015 09:59:27 +0000"  >&lt;p&gt;The rational behind moving functionality from AMQConnection#doWithAllLocks(Runnable) into ConnectionHelper#doWithAllConnectionAndSessionLocks(Runnable) was to be able to run 0.8 failover with the all locks acquired without introduction of public method on AMQConnection or changing visibility to public for AMQConnection#doWithAllLocks(Runnable). &lt;/p&gt;

&lt;p&gt;At the moment we are considering to get rid of ConnectionHelper by either of following:&lt;br/&gt;
1) Restoring AMQConnection#doWithAllLocks(Runnable) and introduction of additional interface on AMQProtocolHandler with a single method responsible for failover running and having private implementation on AMQConnection which can be passed into AMQProtocolHandler constructor as a parameter&lt;br/&gt;
2) Restoring AMQConnection#doWithAllLocks(Runnable) and moving FailoverHandler into AMQConnection package, thus it can call  AMQConnection#doWithAllLocks&lt;/p&gt;</comment>
                            <comment id="14659808" author="k-wall" created="Thu, 6 Aug 2015 10:24:54 +0000"  >&lt;p&gt;A couple of comments:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;What is the rationale behind taking of AllConnectionAndSessionLocks for failover on the 0-10 and 0-8..0-91 paths?   I think it would be useful to write this down (on this Jira).&lt;/li&gt;
	&lt;li&gt;We have a plethora on &apos;clean&apos; dispatch queue type methods building up on AMQSession - some exclusively for 0-10 and some for 0-8..0-91 and these contribute to making the code hard to fathom.  I wonder if this methods should be pushed down to the respective subclasses?  (Sorting this out properly is beyond the scope of the Jira).&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="14659826" author="rgodfrey" created="Thu, 6 Aug 2015 10:59:43 +0000"  >&lt;p&gt;Looking at it briefly yesterday, my thoughts were in the same direction - moving more of the responsibility into AMQProtocolHandler and moving AMQProtocolHandler into the same package as AMQConnection.&lt;/p&gt;

&lt;p&gt;In terms of visibility of methods, my view is that it is safer to &quot;hide&quot; the locks as much as possible and expose methods (like doWithAllLocks) where the locking order is guaranteed to be &quot;safe&quot;.  By allowing/encouraging other classes to take out the locks on Connections/Sessions we are making it more difficult to ensure we always use safe lock acquisition orders.&lt;/p&gt;

&lt;p&gt;So... I think I would be doing both 1) and 2) &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14659832" author="alex.rufous" created="Thu, 6 Aug 2015 11:06:13 +0000"  >&lt;p&gt;Keith,&lt;br/&gt;
We updated the JIRA description about the rationale to acquire dispatcher/messageDelivery locks in failover thread.&lt;br/&gt;
Regarding, your comment about sorting out draining queue functionality. Yes, it make sense to move it into the corresponding subclasses&lt;/p&gt;</comment>
                            <comment id="14660086" author="jira-bot" created="Thu, 6 Aug 2015 14:26:53 +0000"  >&lt;p&gt;Commit 1694509 from orudyy@apache.org in branch &apos;java/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1694509&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1694509&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-3521&quot; title=&quot;failover process for the 0-8 client does not clear the pre-dispatch queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-3521&quot;&gt;&lt;del&gt;QPID-3521&lt;/del&gt;&lt;/a&gt;: Restore AMQConnection#doWithAllLocks(Runnable) and move part of failover specific functionality from FailoverHandler into AMQProtocolHandler&lt;br/&gt;
           Reduce coupling between AMQProtocolHandler and AMQProtocolSession by swapping some methods&lt;br/&gt;
           Remove unneeded ConnectionHelper&lt;/p&gt;</comment>
                            <comment id="14660087" author="jira-bot" created="Thu, 6 Aug 2015 14:27:03 +0000"  >&lt;p&gt;Commit 1694510 from orudyy@apache.org in branch &apos;java/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1694510&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1694510&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-3521&quot; title=&quot;failover process for the 0-8 client does not clear the pre-dispatch queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-3521&quot;&gt;&lt;del&gt;QPID-3521&lt;/del&gt;&lt;/a&gt;: Move AMQProtocolHandler into parent package to get access to package protected methods on AMQConnection&lt;/p&gt;</comment>
                            <comment id="14661732" author="k-wall" created="Fri, 7 Aug 2015 12:09:39 +0000"  >&lt;p&gt;Changes look reasonable to me.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12851343">QPID-6677</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12525790">QPID-3520</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12725469">QPID-5876</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12851343">QPID-6677</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12747581" name="clear-dispatch-queue-on-failover.diff" size="16651" author="orudyy" created="Tue, 28 Jul 2015 16:21:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>46405</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 15 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0bhj3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>64952</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>