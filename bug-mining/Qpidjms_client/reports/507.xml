<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:22:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-3769] NPE in client AMQDestination.equals()</title>
                <link>https://issues.apache.org/jira/browse/QPID-3769</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;Code of org.apache.qpid.client.AMQDestination.equals(Object) is buggy, it should test for null on _exchangeClass and _exchangeName before dereferencing them, lines 522 and 526.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12538762">QPID-3769</key>
            <summary>NPE in client AMQDestination.equals()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajith">Rajith Muditha Attapattu</assignee>
                                    <reporter username="jan_bar">Jan Bare&#353;</reporter>
                        <labels>
                            <label>addressing</label>
                    </labels>
                <created>Wed, 18 Jan 2012 09:23:38 +0000</created>
                <updated>Wed, 12 Jun 2013 14:44:00 +0000</updated>
                            <resolved>Wed, 12 Jun 2013 14:44:00 +0000</resolved>
                                    <version>0.12</version>
                                    <fixVersion>0.22</fixVersion>
                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13599289" author="rajith" created="Mon, 11 Mar 2013 21:02:16 +0000"  >&lt;p&gt;There are two options for implementing the equals method (and hashcode).&lt;/p&gt;

&lt;p&gt;1. Check the &quot;type&quot; and &quot;name&quot; to ensure they both point to the same &quot;destination&quot; (which could be a queue or an exchange in pre 1.0 terms).&lt;/p&gt;

&lt;p&gt;2. Do a comprehensive check on the internal address data structure to ensure that all fields, properties, options are the same.&lt;/p&gt;

&lt;p&gt;(Please note that comparing two address strings is not a good idea as there can whitespaces).&lt;/p&gt;

&lt;p&gt;I prefer option one and have attached a patch for that.&lt;br/&gt;
What do others think?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;         &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; AMQDestination that = (AMQDestination) o;
 
-        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!_exchangeClass.equals(that._exchangeClass))
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (_destSyntax != that.getDestSyntax())
         {
             &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
         }
-        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!_exchangeName.equals(that._exchangeName))
+
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (_destSyntax == DestSyntax.ADDR)
         {
-            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (_addressType != that.getAddressType())
+            {
+                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+            }
+            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!_name.equals(that.getAddressName()))
+            {
+                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+            }
         }
-        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((_queueName == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; that._queueName != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) ||
-            (_queueName != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !_queueName.equals(that._queueName)))
+        &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
         {
-            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!_exchangeClass.equals(that._exchangeClass))
+            {
+                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+            }
+            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!_exchangeName.equals(that._exchangeName))
+            {
+                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+            }
+            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((_queueName == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; that._queueName != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) ||
+                (_queueName != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !_queueName.equals(that._queueName)))
+            {
+                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+            }
         }
-
         &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
     }
 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13601289" author="rajith" created="Wed, 13 Mar 2013 16:08:44 +0000"  >&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/r1456007&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1456007&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/r1456008&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1456008&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Committed a modified version of Siddhesh Poyarekar&apos;s  patch.&lt;br/&gt;
Added a fix to hashcode as well and added a test case.&lt;/p&gt;</comment>
                            <comment id="13601411" author="alex.rufous" created="Wed, 13 Mar 2013 17:43:48 +0000"  >&lt;p&gt;Hi Rajith,&lt;/p&gt;

&lt;p&gt;I believe that topic address based destination should also compare the subject.&lt;br/&gt;
For instance the following test fails because really different destinations are considered to be the same:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testEqualsForTopicDestinationsWithDifferentSubjects() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception
    {
        AMQDestination dest1 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AMQAnyDestination(&lt;span class=&quot;code-quote&quot;&gt;&quot;ADDR:Foo/subjectOne; {node :{type:topic}}&quot;&lt;/span&gt;);
        AMQDestination dest2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AMQAnyDestination(&lt;span class=&quot;code-quote&quot;&gt;&quot;ADDR:Foo/subjectTwo; {node :{type:topic}}&quot;&lt;/span&gt;);

        assertFalse(&lt;span class=&quot;code-quote&quot;&gt;&quot;Destination with different subjects cannot be equal&quot;&lt;/span&gt;, dest1.equals(dest2));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also, I would like to point out that AMQDestinationTest#testEqaulsAndHashCodeForAddressBasedDestinations fails if it is ran from Eclipse because the client defaults to address based syntax and parsing of binding URL as address fails. I would like to suggest to prefix the binding destination URL in test with BURL prefix:&lt;/p&gt;

&lt;p&gt;BURL:direct://amq.direct/test-route/Foo?routingkey=&apos;Foo&apos;&lt;/p&gt;

&lt;p&gt;I also noticed that both topic and queue destinations in your test are created using AMQQueue class. Should it possibly use AMQTopic or AMQAnyDestination?&lt;/p&gt;</comment>
                            <comment id="13601414" author="alex.rufous" created="Wed, 13 Mar 2013 17:44:40 +0000"  >&lt;p&gt;Re-opened issue as per comments&lt;/p&gt;</comment>
                            <comment id="13605172" author="rajith" created="Mon, 18 Mar 2013 14:48:12 +0000"  >&lt;p&gt;I discussed this with Rafi a fair bit before arriving at a solution.&lt;/p&gt;

&lt;p&gt;I don&apos;t think comparing the subject is the right approach for every situation.&lt;br/&gt;
Comparing the subjects might make sense for Topics, but not for Queues. Also at the time equals is called we may not know the &apos;type&apos;. We could look at the resolved property to determine this. Otherwise what are we going to do ?&lt;/p&gt;

&lt;p&gt;What should we do for exchanges with more complicated routing algorithms like Headers or XML exchange where the subject is not a factor at all ? It gets complicated real soon when you look beyond the simple cases.&lt;/p&gt;

&lt;p&gt;If you look at it from a high level pov, we send messages to either a Queue or an Exchange. They are the &quot;destinations&quot;. So one could argue that if you are sending to the same  &quot;exchange&quot; then you are sending to the same destination. I think that has a stronger argument that than what you are suggesting.&lt;/p&gt;

&lt;p&gt;How messages are matched onto queues is a function of the exchange. And it&apos;s something that we should not try to factor into our equals implementation.&lt;/p&gt;
</comment>
                            <comment id="13605174" author="rajith" created="Mon, 18 Mar 2013 14:49:13 +0000"  >&lt;p&gt;Alex I will fix the test cases by using the right class and will prefix with BURL for the destination that uses that syntax.&lt;/p&gt;</comment>
                            <comment id="13614594" author="rajith" created="Tue, 26 Mar 2013 21:53:23 +0000"  >&lt;p&gt;Fixed the immediate concerns.&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/r1461324&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1461324&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/r1461329&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1461329&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13614697" author="gemmellr" created="Tue, 26 Mar 2013 23:49:54 +0000"  >&lt;p&gt;Reopening for a couple reasons.&lt;/p&gt;

&lt;p&gt;Half the changes were committed before the 0.22 branch, and half after. The remainder need to be requested for merge if they check out ok. We should then assign the fix-version appropriately.&lt;/p&gt;

&lt;p&gt;I think this needs more tests to ensure the changes check out ok:&lt;/p&gt;

&lt;p&gt;In the test that exists, some bits use AMQTopic destination objects, and that has its own equals() implementation and so isn&apos;t really affected by these changes.&lt;/p&gt;

&lt;p&gt;There doesn&apos;t seem to be any testing using AMQAnyDestination, which gets used for all the Address syntax based destinations created via JNDI and so is affected by these changes.&lt;/p&gt;</comment>
                            <comment id="13615424" author="rajith" created="Wed, 27 Mar 2013 15:59:02 +0000"  >&lt;p&gt;I was going to request a port, but I should have kept this open until then.&lt;/p&gt;

&lt;p&gt;I also agree on the comments about the tests for this.&lt;/p&gt;</comment>
                            <comment id="13618814" author="rajith" created="Mon, 1 Apr 2013 15:02:23 +0000"  >&lt;p&gt;Adjusted the hashcode and equals impl for AMQTopic to take the new implementation (in AMQDestination) into account while preserving the old BURL based logic.  Addressed concerns regarding the tests.&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/r1463158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1463158&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13618822" author="justi9" created="Mon, 1 Apr 2013 15:15:45 +0000"  >&lt;p&gt;Reviewed by Robbie.  Approved for 0.22.&lt;/p&gt;</comment>
                            <comment id="13618955" author="rajith" created="Mon, 1 Apr 2013 17:37:20 +0000"  >&lt;p&gt;Ported the relevant changes to 0.22 branch.&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/r1463215&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1463215&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/r1463216&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1463216&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/r1463217&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1463217&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13681294" author="rajith" created="Wed, 12 Jun 2013 14:44:00 +0000"  >&lt;p&gt;Committed to both trunk and 0.22 branch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>224265</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 23 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0bhhz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>64947</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>