<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:20:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-1816] Unable to acknowledge messages after failover</title>
                <link>https://issues.apache.org/jira/browse/QPID-1816</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;Summary:&lt;/p&gt;

&lt;p&gt;If messages have been consumed during a session but not acknowledged and failover occurs it is not possible to acknowledge subsequent messages.&lt;/p&gt;

&lt;p&gt;In the transacted case calling rollback after failover clears the &apos;dirty&apos; state of the connection.&lt;/p&gt;

&lt;p&gt;However calling recover does not do the same work so the dirty session remains and users are unable to acknowledge messages.&lt;br/&gt;
This occurred on a CLIENT_ACK session but I have not yet investigated the other Acking modes so they may be unaffected.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12422914">QPID-1816</key>
            <summary>Unable to acknowledge messages after failover</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="7">Later</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ritchiem">Martin Ritchie</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Apr 2009 17:53:55 +0000</created>
                <updated>Mon, 5 Sep 2011 21:46:14 +0000</updated>
                            <resolved>Mon, 5 Sep 2011 21:46:14 +0000</resolved>
                                                    <fixVersion>JIRA Cleanup</fixVersion>
                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12707870" author="ritchiem" created="Mon, 11 May 2009 03:01:48 +0000"  >&lt;p&gt;This is too big a change too late for 0.5&lt;/p&gt;</comment>
                            <comment id="12759587" author="ritchiem" created="Fri, 25 Sep 2009 15:47:38 +0000"  >&lt;p&gt;I have completed tests that validate the reception of messages after failover. As the JIRA pointed out CLIENT_ACK was broken. The fix for which is very straight forward. Currently in postDeliver the session is marked dirty.. this is wrong.. as it means in onMessage if the message is acknowlege the session is still marked dirty! Move the dirty setting to preDeliver and adding a markClean in acknowledge. Clears this up.&lt;/p&gt;

&lt;p&gt;However, After testing receive/onMessage paths with and without failover and seeing no errors. Testing that we correctly throw a &apos;dirty session&apos;  exception from Client_Ack and Transacted sessions when the session is dirty seemed sensible... Problem is only client ack works.&lt;/p&gt;

&lt;p&gt;In the transacted case we never mark the session dirty when we receive a message. There for it is possible to receive message 1, failover receive message 2 commit and believe we have commited both messages. Now perhaps my test is a little contrived as in a clustered environment message 1 would be receieved twice unlike my test which is not clustered so preps the new broker with message count... (NUM_MSGS - COUNT).&lt;/p&gt;

&lt;p&gt;Whlist the test may not be ideal the fact that we can commit without an exception is wrong as there is no guarrantee that the second message we receive is a redelivery of the first. &lt;/p&gt;

&lt;p&gt;As I see it this means that in the event of failover any open transaction whilst it may commit cleanly, what it is committing is not clear.&lt;/p&gt;

&lt;p&gt;Testing needs to be done on dirty session due to receive and dirty sessions due to send.&lt;/p&gt;</comment>
                            <comment id="12759590" author="ritchiem" created="Fri, 25 Sep 2009 15:50:59 +0000"  >&lt;p&gt;This trace shows multiple acks are sent but the Java broker ignores the duplicate.&lt;/p&gt;

&lt;p&gt;In a real app the first ack would be for a much higher delivery tag and so would fail.&lt;/p&gt;

&lt;p&gt;main 2009-09-25 16:31:04,163 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.AMQSession.Dispatcher&amp;#93;&lt;/span&gt; Set Dispatcher Connection Started: Currently Started&lt;br/&gt;
main 2009-09-25 16:32:14,501 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Sending ack for delivery tag 1 on channel 1&lt;br/&gt;
main 2009-09-25 16:32:14,530 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.AMQDataBlockEncoder&amp;#93;&lt;/span&gt; Encoded frame byte-buffer is &apos;0x0100010000000d003c0050000000000000000100ce&apos;&lt;br/&gt;
pool-1-thread-4 2009-09-25 16:32:14,572 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQProtocolSession&amp;#93;&lt;/span&gt; Frame Received: Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;BasicAckBodyImpl: deliveryTag=1, multiple=false&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-4 2009-09-25 16:32:14,879 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.handler.BasicAckMethodHandler&amp;#93;&lt;/span&gt; Ack(Tag:1:Mult:false) received on channel 1&lt;br/&gt;
pool-1-thread-4 2009-09-25 16:32:14,881 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.txn.LocalTransactionalContext&amp;#93;&lt;/span&gt; Starting transaction on message store: org.apache.qpid.server.txn.LocalTransactionalContext@159d10&lt;br/&gt;
main 2009-09-25 16:32:31,661 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Sending ack for delivery tag 1 on channel 1&lt;br/&gt;
main 2009-09-25 16:32:31,697 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.AMQDataBlockEncoder&amp;#93;&lt;/span&gt; Encoded frame byte-buffer is &apos;0x0100010000000d003c0050000000000000000100ce&apos;&lt;br/&gt;
pool-1-thread-3 2009-09-25 16:32:32,071 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQProtocolSession&amp;#93;&lt;/span&gt; Frame Received: Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;BasicAckBodyImpl: deliveryTag=1, multiple=false&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-3 2009-09-25 16:32:32,072 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.handler.BasicAckMethodHandler&amp;#93;&lt;/span&gt; Ack(Tag:1:Mult:false) received on channel 1&lt;br/&gt;
main 2009-09-25 16:32:46,049 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.AMQDataBlockEncoder&amp;#93;&lt;/span&gt; Encoded frame byte-buffer is &apos;0x01000100000004005a0014ce&apos;&lt;br/&gt;
pool-1-thread-2 2009-09-25 16:32:46,098 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQProtocolSession&amp;#93;&lt;/span&gt; Frame Received: Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;TxCommitBodyImpl: &amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-2 2009-09-25 16:32:46,129 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.handler.TxCommitHandler&amp;#93;&lt;/span&gt; Commit received on channel 1&lt;br/&gt;
pool-1-thread-2 2009-09-25 16:32:46,153 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.txn.LocalTransactionalContext&amp;#93;&lt;/span&gt; Committing transactional context: org.apache.qpid.server.txn.LocalTransactionalContext@159d10&lt;br/&gt;
pool-1-thread-2 2009-09-25 16:32:46,194 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.txn.TxnBuffer&amp;#93;&lt;/span&gt; Committing 2 ops to commit.:&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.qpid.server.ack.TxAck@f32dde, org.apache.qpid.server.txn.StoreMessageOperation@1487b8b&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-2 2009-09-25 16:32:46,235 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.store.MemoryMessageStore&amp;#93;&lt;/span&gt; Removing message with id 1&lt;br/&gt;
pool-1-thread-2 2009-09-25 16:32:46,262 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.txn.LocalTransactionalContext&amp;#93;&lt;/span&gt; Performing post commit delivery&lt;br/&gt;
pool-1-thread-3 2009-09-25 16:32:46,293 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.AMQDataBlockEncoder&amp;#93;&lt;/span&gt; Encoded frame byte-buffer is &apos;0x01000100000004005a0015ce&apos;&lt;br/&gt;
pool-1-thread-3 2009-09-25 16:32:46,327 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQPFastProtocolHandler&amp;#93;&lt;/span&gt; Message sent: DirectBuffer&lt;span class=&quot;error&quot;&gt;&amp;#91;pos=0 lim=12 cap=16: 01 00 01 00 00 00 04 00 5A 00 15 CE&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-3 2009-09-25 16:32:46,364 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQPFastProtocolHandler&amp;#93;&lt;/span&gt; Message sent: Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;TxCommitOkBodyImpl: &amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-4 2009-09-25 16:32:46,367 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.protocol.AMQProtocolHandler&amp;#93;&lt;/span&gt; (14133705)Method frame received: &lt;span class=&quot;error&quot;&gt;&amp;#91;TxCommitOkBodyImpl: &amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="13097553" author="gemmellr" created="Mon, 5 Sep 2011 21:46:14 +0000"  >&lt;p&gt;Closing issue out as part of JIRA cleanup. Issue may already be resolved, may be invalid, or may never be fixed. See &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-3469&quot; title=&quot;JIRA clean up for Java client/broker&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-3469&quot;&gt;&lt;del&gt;QPID-3469&lt;/del&gt;&lt;/a&gt; for further details.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>62425</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0bldj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>65575</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>