<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:20:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-1864] java 0-10 client sometimes releases messages in non queue order on rollback</title>
                <link>https://issues.apache.org/jira/browse/QPID-1864</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;On rollback, the java client sometimes releases messages from the dispatch thread. These messages are released in an unpredictable order relative to the messages released from the main thread. Also, the messages released from the BMC.rollbackPendingMessages() are released individually and in the opposite order of what would preserve queue order in a single consumer scenario.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12425838">QPID-1864</key>
            <summary>java 0-10 client sometimes releases messages in non queue order on rollback</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="7">Later</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rhs">Rafael H. Schloming</reporter>
                        <labels>
                    </labels>
                <created>Tue, 19 May 2009 15:38:50 +0000</created>
                <updated>Mon, 5 Sep 2011 21:46:05 +0000</updated>
                            <resolved>Mon, 5 Sep 2011 21:46:05 +0000</resolved>
                                    <version>0.6</version>
                    <version>0.7</version>
                    <version>0.8</version>
                                    <fixVersion>JIRA Cleanup</fixVersion>
                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12711516" author="ritchiem" created="Thu, 21 May 2009 08:40:51 +0000"  >&lt;p&gt;Hi Rafi, The new test you added is highlighting a race condition in the 0-8 code path.&lt;/p&gt;

&lt;p&gt;This is the error log:&lt;br/&gt;
Exception in thread &quot;Dispatcher-Channel-1&quot; java.lang.IllegalStateException: dispatcher is not started&lt;br/&gt;
	at org.apache.qpid.client.AMQSession.dispatch(AMQSession.java:2696)&lt;br/&gt;
	at org.apache.qpid.client.message.UnprocessedMessage.dispatch(UnprocessedMessage.java:55)&lt;br/&gt;
	at org.apache.qpid.client.AMQSession$Dispatcher.run(AMQSession.java:2827)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;

&lt;p&gt;I&apos;ll attach the full .out file aswell. Can you take a look and see if the 0-10 change you made would also apply to 0-8?&lt;/p&gt;

&lt;p&gt;Cheers&lt;/p&gt;</comment>
                            <comment id="12711579" author="ritchiem" created="Thu, 21 May 2009 11:44:45 +0000"  >&lt;p&gt;Problem appears to be a race condition between the dispatcher rejecting the message it is currently handling and the sending of the TxRollback request.&lt;/p&gt;

&lt;p&gt;Here is the log output from a failed run. The test was augmented to print &apos;ROLLBACK&apos; before calling rollback and to print out the message and the iteration &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; where the failed message is received.&lt;/p&gt;

&lt;p&gt;I&apos;ve embedded comments in the log starting ****:&lt;/p&gt;

&lt;p&gt;main 2009-05-21 11:54:10,751 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.test.client.RollbackOrderTest&amp;#93;&lt;/span&gt; ROLLBACK&lt;br/&gt;
main 2009-05-21 11:54:10,754 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Setting channel flow : suspended&lt;br/&gt;
main 2009-05-21 11:54:10,754 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.AMQDataBlockEncoder&amp;#93;&lt;/span&gt; Encoded frame byte-buffer is &apos;0x010001000000050014001400ce&apos;&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,755 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQProtocolSession&amp;#93;&lt;/span&gt; Frame Received: Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;ChannelFlowBodyImpl: active=false&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,755 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.handler.ChannelFlowHandler&amp;#93;&lt;/span&gt; Channel.Flow for channel 1, active=false&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,755 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.AMQDataBlockEncoder&amp;#93;&lt;/span&gt; Encoded frame byte-buffer is &apos;0x010001000000050014001500ce&apos;&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,755 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQPFastProtocolHandler&amp;#93;&lt;/span&gt; Message sent: DirectBuffer&lt;span class=&quot;error&quot;&gt;&amp;#91;pos=0 lim=13 cap=16: 01 00 01 00 00 00 05 00 14 00 15 00 CE&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,756 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQPFastProtocolHandler&amp;#93;&lt;/span&gt; Message sent: Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;ChannelFlowOkBodyImpl: active=false&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,754 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.BasicContentHeaderProperties&amp;#93;&lt;/span&gt; Property flags: 63952&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,756 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.protocol&amp;#93;&lt;/span&gt; RECV: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.qpid.client.protocol.AMQProtocolHandler@53c3f5&amp;#93;&lt;/span&gt; Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;BasicDeliverBodyImpl: consumerTag=1, deliveryTag=15, redelivered=true, exchange=amq.direct, routingKey=rollback-order-test-queue&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,757 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.protocol.AMQProtocolHandler&amp;#93;&lt;/span&gt; (5489653)Method frame received: &lt;span class=&quot;error&quot;&gt;&amp;#91;BasicDeliverBodyImpl: consumerTag=1, deliveryTag=15, redelivered=true, exchange=amq.direct, routingKey=rollback-order-test-queue&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,757 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.handler.BasicDeliverMethodHandler&amp;#93;&lt;/span&gt; New JmsDeliver method received:org.apache.qpid.client.protocol.AMQProtocolSession@9b6220&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,757 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.protocol&amp;#93;&lt;/span&gt; RECV: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.qpid.client.protocol.AMQProtocolHandler@53c3f5&amp;#93;&lt;/span&gt; Frame channelId: 1, bodyFrame: org.apache.qpid.framing.ContentHeaderBody@c5122f&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,758 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.protocol&amp;#93;&lt;/span&gt; RECV: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.qpid.client.protocol.AMQProtocolHandler@53c3f5&amp;#93;&lt;/span&gt; Frame channelId: 1, bodyFrame: org.apache.qpid.framing.ContentBody@2d0479&lt;br/&gt;
Dispatcher-Channel-1 2009-05-21 11:54:10,754 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.message.AbstractJMSMessageFactory&amp;#93;&lt;/span&gt; Non-fragmented message body (bodySize=9)&lt;br/&gt;
Dispatcher-Channel-1 2009-05-21 11:54:10,759 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.message.AbstractJMSMessageFactory&amp;#93;&lt;/span&gt; Creating message from buffer with position=0 and remaining=9&lt;br/&gt;
Dispatcher-Channel-1 2009-05-21 11:54:10,759 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.BasicMessageConsumer&amp;#93;&lt;/span&gt; Message is of type: org.apache.qpid.client.message.JMSTextMessage&lt;br/&gt;
main 2009-05-21 11:54:10,758 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.protocol&amp;#93;&lt;/span&gt; SEND: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.qpid.client.protocol.AMQProtocolHandler@53c3f5&amp;#93;&lt;/span&gt; Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;ChannelFlowBodyImpl: active=false&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,758 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Message&lt;span class=&quot;error&quot;&gt;&amp;#91;ContentHeader org.apache.qpid.framing.ContentHeaderBody@c5122f&amp;#93;&lt;/span&gt; received in session&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,760 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.protocol&amp;#93;&lt;/span&gt; RECV: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.qpid.client.protocol.AMQProtocolHandler@53c3f5&amp;#93;&lt;/span&gt; Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;ChannelFlowOkBodyImpl: active=false&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,760 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.protocol.AMQProtocolHandler&amp;#93;&lt;/span&gt; (5489653)Method frame received: &lt;span class=&quot;error&quot;&gt;&amp;#91;ChannelFlowOkBodyImpl: active=false&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,760 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.handler.ChannelFlowOkMethodHandler&amp;#93;&lt;/span&gt; Received Channel.Flow-Ok message, active = false&lt;br/&gt;
main 2009-05-21 11:54:10,761 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Rejecting delivery tag:11:SessionHC:2972067&lt;br/&gt;
main 2009-05-21 11:54:10,761 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.AMQDataBlockEncoder&amp;#93;&lt;/span&gt; Encoded frame byte-buffer is &apos;0x0100010000000d003c005a000000000000000b01ce&apos;&lt;br/&gt;
main 2009-05-21 11:54:10,762 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.protocol&amp;#93;&lt;/span&gt; SEND: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.qpid.client.protocol.AMQProtocolHandler@53c3f5&amp;#93;&lt;/span&gt; Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;BasicRejectBodyImpl: deliveryTag=11, requeue=true&amp;#93;&lt;/span&gt;&lt;br/&gt;
main 2009-05-21 11:54:10,762 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.AMQSession.Dispatcher&amp;#93;&lt;/span&gt; Set Dispatcher Connection Stopped: Currently Started&lt;br/&gt;
main 2009-05-21 11:54:10,762 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.AMQSession.Dispatcher&amp;#93;&lt;/span&gt; Session Pre Dispatch Queue cleared&lt;br/&gt;
main 2009-05-21 11:54:10,762 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.BasicMessageConsumer&amp;#93;&lt;/span&gt; Rejecting the messages(3) in _syncQueue (PRQ)for consumer with tag:1&lt;br/&gt;
main 2009-05-21 11:54:10,762 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Rejecting Abstract message:12&lt;br/&gt;
main 2009-05-21 11:54:10,763 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Rejecting delivery tag:12:SessionHC:2972067&lt;br/&gt;
main 2009-05-21 11:54:10,763 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.AMQDataBlockEncoder&amp;#93;&lt;/span&gt; Encoded frame byte-buffer is &apos;0x0100010000000d003c005a000000000000000c01ce&apos;&lt;br/&gt;
main 2009-05-21 11:54:10,763 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.protocol&amp;#93;&lt;/span&gt; SEND: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.qpid.client.protocol.AMQProtocolHandler@53c3f5&amp;#93;&lt;/span&gt; Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;BasicRejectBodyImpl: deliveryTag=12, requeue=true&amp;#93;&lt;/span&gt;&lt;br/&gt;
main 2009-05-21 11:54:10,763 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.BasicMessageConsumer&amp;#93;&lt;/span&gt; Rejected message:12&lt;br/&gt;
main 2009-05-21 11:54:10,764 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Rejecting Abstract message:13&lt;br/&gt;
main 2009-05-21 11:54:10,764 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Rejecting delivery tag:13:SessionHC:2972067&lt;br/&gt;
main 2009-05-21 11:54:10,764 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.AMQDataBlockEncoder&amp;#93;&lt;/span&gt; Encoded frame byte-buffer is &apos;0x0100010000000d003c005a000000000000000d01ce&apos;&lt;br/&gt;
main 2009-05-21 11:54:10,764 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.protocol&amp;#93;&lt;/span&gt; SEND: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.qpid.client.protocol.AMQProtocolHandler@53c3f5&amp;#93;&lt;/span&gt; Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;BasicRejectBodyImpl: deliveryTag=13, requeue=true&amp;#93;&lt;/span&gt;&lt;br/&gt;
main 2009-05-21 11:54:10,765 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.BasicMessageConsumer&amp;#93;&lt;/span&gt; Rejected message:13&lt;br/&gt;
main 2009-05-21 11:54:10,765 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Rejecting Abstract message:14&lt;br/&gt;
main 2009-05-21 11:54:10,765 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Rejecting delivery tag:14:SessionHC:2972067&lt;br/&gt;
main 2009-05-21 11:54:10,765 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.AMQDataBlockEncoder&amp;#93;&lt;/span&gt; Encoded frame byte-buffer is &apos;0x0100010000000d003c005a000000000000000e01ce&apos;&lt;br/&gt;
main 2009-05-21 11:54:10,766 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.protocol&amp;#93;&lt;/span&gt; SEND: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.qpid.client.protocol.AMQProtocolHandler@53c3f5&amp;#93;&lt;/span&gt; Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;BasicRejectBodyImpl: deliveryTag=14, requeue=true&amp;#93;&lt;/span&gt;&lt;br/&gt;
main 2009-05-21 11:54:10,766 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.BasicMessageConsumer&amp;#93;&lt;/span&gt; Rejected message:14&lt;br/&gt;
main 2009-05-21 11:54:10,766 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.AMQSession.Dispatcher&amp;#93;&lt;/span&gt; Set Dispatcher Connection Started: Currently Stopped&lt;br/&gt;
main 2009-05-21 11:54:10,766 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.AMQDataBlockEncoder&amp;#93;&lt;/span&gt; Encoded frame byte-buffer is &apos;0x01000100000004005a001ece&apos;&lt;br/&gt;
main 2009-05-21 11:54:10,767 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.protocol&amp;#93;&lt;/span&gt; SEND: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.qpid.client.protocol.AMQProtocolHandler@53c3f5&amp;#93;&lt;/span&gt; Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;TxRollbackBodyImpl: &amp;#93;&lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;
			&lt;ul&gt;
				&lt;li&gt;Dispatcher thread Reject message 15 that it was processing when the rollback occured. NOTE this reject occurs AFTER the main thread has sent the Rollback Request&lt;br/&gt;
Dispatcher-Channel-1 2009-05-21 11:54:10,767 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Rejecting Unacked message:15&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,770 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQProtocolSession&amp;#93;&lt;/span&gt; Frame Received: Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;BasicRejectBodyImpl: deliveryTag=11, requeue=true&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,773 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.handler.BasicRejectMethodHandler&amp;#93;&lt;/span&gt; Rejecting:11: Requeue:true on channel:1(6527985)&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,773 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.handler.BasicRejectMethodHandler&amp;#93;&lt;/span&gt; Rejecting: DT:11-(HC:5474676 ID:1 Ref:1): Requeue:true on channel:1(6527985)&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,773 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.subscription.SubscriptionImpl&amp;#93;&lt;/span&gt; Subscription:2148614 rejected message:(HC:5474676 ID:1 Ref:1)&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,773 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.subscription.SubscriptionImpl&amp;#93;&lt;/span&gt; (2148614) checking filters for message ((HC:5474676 ID:1 Ref:1)&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,774 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQProtocolSession&amp;#93;&lt;/span&gt; Frame Received: Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;BasicRejectBodyImpl: deliveryTag=12, requeue=true&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,774 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.handler.BasicRejectMethodHandler&amp;#93;&lt;/span&gt; Rejecting:12: Requeue:true on channel:1(6527985)&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,774 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.handler.BasicRejectMethodHandler&amp;#93;&lt;/span&gt; Rejecting: DT:12-(HC:14846251 ID:2 Ref:1): Requeue:true on channel:1(6527985)&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,775 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQProtocolSession&amp;#93;&lt;/span&gt; Frame Received: Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;BasicRejectBodyImpl: deliveryTag=13, requeue=true&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,775 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.handler.BasicRejectMethodHandler&amp;#93;&lt;/span&gt; Rejecting:13: Requeue:true on channel:1(6527985)&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,775 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.handler.BasicRejectMethodHandler&amp;#93;&lt;/span&gt; Rejecting: DT:13-(HC:10184846 ID:3 Ref:1): Requeue:true on channel:1(6527985)&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,775 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQProtocolSession&amp;#93;&lt;/span&gt; Frame Received: Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;BasicRejectBodyImpl: deliveryTag=14, requeue=true&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,776 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.handler.BasicRejectMethodHandler&amp;#93;&lt;/span&gt; Rejecting:14: Requeue:true on channel:1(6527985)&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,776 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.handler.BasicRejectMethodHandler&amp;#93;&lt;/span&gt; Rejecting: DT:14-(HC:15555997 ID:4 Ref:1): Requeue:true on channel:1(6527985)&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,776 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQProtocolSession&amp;#93;&lt;/span&gt; Frame Received: Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;TxRollbackBodyImpl: &amp;#93;&lt;/span&gt;&lt;/li&gt;
				&lt;li&gt;Rollback Request recevied and we have 1 message in the unacked map which is Message 5, which will correspond to Delivery Tag 15. That the Dispatcher is in the process of rejecting&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,776 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.server.AMQChannel&amp;#93;&lt;/span&gt; unacked map Size:1&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,777 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.server.AMQChannel&amp;#93;&lt;/span&gt; Preparing (1) message to resend.&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,777 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.server.AMQChannel&amp;#93;&lt;/span&gt; 1(6527985) Adding unacked message(Message&lt;span class=&quot;error&quot;&gt;&amp;#91;(HC:27071180 ID:5 Ref:1)&amp;#93;&lt;/span&gt;: 5; ref count: 1 DT:16) with a queue(org.apache.qpid.server.queue.SimpleAMQQueue@1df5f21) for [channel=&lt;span class=&quot;error&quot;&gt;&amp;#91;anonymous(13640204)(guest):1&amp;#93;&lt;/span&gt;, consumerTag=1, session=anonymous(13640204)]&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,778 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.AMQDataBlockEncoder&amp;#93;&lt;/span&gt; Encoded frame byte-buffer is &apos;0x01000100000004005a001fce&apos;&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,778 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQPFastProtocolHandler&amp;#93;&lt;/span&gt; Message sent: DirectBuffer&lt;span class=&quot;error&quot;&gt;&amp;#91;pos=0 lim=12 cap=16: 01 00 01 00 00 00 04 00 5A 00 1F CE&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,778 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQPFastProtocolHandler&amp;#93;&lt;/span&gt; Message sent: Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;TxRollbackOkBodyImpl: &amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,779 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.AMQDataBlockEncoder&amp;#93;&lt;/span&gt; Encoded frame byte-buffer is &apos;&amp;lt;TRIM&amp;gt;&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,779 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.protocol&amp;#93;&lt;/span&gt; RECV: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.qpid.client.protocol.AMQProtocolHandler@53c3f5&amp;#93;&lt;/span&gt; Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;TxRollbackOkBodyImpl: &amp;#93;&lt;/span&gt;&lt;/li&gt;
				&lt;li&gt;: Client receives the Rollback OK&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,782 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.protocol.AMQProtocolHandler&amp;#93;&lt;/span&gt; (5489653)Method frame received: &lt;span class=&quot;error&quot;&gt;&amp;#91;TxRollbackOkBodyImpl: &amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,783 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQPFastProtocolHandler&amp;#93;&lt;/span&gt; Message sent: DirectBuffer&lt;span class=&quot;error&quot;&gt;&amp;#91;pos=0 lim=177 cap=256: &amp;lt;TRIM&amp;gt;&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-3 2009-05-21 11:54:10,784 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.BasicContentHeaderProperties&amp;#93;&lt;/span&gt; Property flags: 63952&lt;br/&gt;
pool-1-thread-3 2009-05-21 11:54:10,784 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.protocol&amp;#93;&lt;/span&gt; RECV: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.qpid.client.protocol.AMQProtocolHandler@53c3f5&amp;#93;&lt;/span&gt; Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;BasicDeliverBodyImpl: consumerTag=1, deliveryTag=16, redelivered=true, exchange=amq.direct, routingKey=rollback-order-test-queue&amp;#93;&lt;/span&gt;&lt;/li&gt;
				&lt;li&gt;Client receives the message that was in the unacked map when the TxRollback was received.&lt;/li&gt;
				&lt;li&gt;Further point : Is the session not suspended here! Is that our plan we resend all the unacked messages for the session again even though ...&lt;/li&gt;
				&lt;li&gt;... the client has requested that we don&apos;t via flow = false!&lt;br/&gt;
pool-1-thread-3 2009-05-21 11:54:10,785 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.protocol.AMQProtocolHandler&amp;#93;&lt;/span&gt; (5489653)Method frame received: &lt;span class=&quot;error&quot;&gt;&amp;#91;BasicDeliverBodyImpl: consumerTag=1, deliveryTag=16, redelivered=true, exchange=amq.direct, routingKey=rollback-order-test-queue&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-3 2009-05-21 11:54:10,785 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.handler.BasicDeliverMethodHandler&amp;#93;&lt;/span&gt; New JmsDeliver method received:org.apache.qpid.client.protocol.AMQProtocolSession@9b6220&lt;br/&gt;
pool-1-thread-3 2009-05-21 11:54:10,785 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.protocol&amp;#93;&lt;/span&gt; RECV: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.qpid.client.protocol.AMQProtocolHandler@53c3f5&amp;#93;&lt;/span&gt; Frame channelId: 1, bodyFrame: org.apache.qpid.framing.ContentHeaderBody@8fbecf&lt;br/&gt;
pool-1-thread-3 2009-05-21 11:54:10,786 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.protocol&amp;#93;&lt;/span&gt; RECV: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.qpid.client.protocol.AMQProtocolHandler@53c3f5&amp;#93;&lt;/span&gt; Frame channelId: 1, bodyFrame: org.apache.qpid.framing.ContentBody@1382926&lt;br/&gt;
pool-1-thread-3 2009-05-21 11:54:10,786 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Message&lt;span class=&quot;error&quot;&gt;&amp;#91;ContentHeader org.apache.qpid.framing.ContentHeaderBody@8fbecf&amp;#93;&lt;/span&gt; received in session&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,786 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQPFastProtocolHandler&amp;#93;&lt;/span&gt; Message sent: org.apache.qpid.server.output.amqp0_9.ProtocolOutputConverterImpl$CompositeAMQBodyBlock@158cc6&lt;/li&gt;
				&lt;li&gt;: The dispatcher now sends the reject for DT 15&lt;br/&gt;
Dispatcher-Channel-1 2009-05-21 11:54:10,782 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Rejecting delivery tag:15:SessionHC:2972067&lt;br/&gt;
Dispatcher-Channel-1 2009-05-21 11:54:10,788 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.AMQDataBlockEncoder&amp;#93;&lt;/span&gt; Encoded frame byte-buffer is &apos;0x0100010000000d003c005a000000000000000f01ce&apos;&lt;br/&gt;
pool-1-thread-3 2009-05-21 11:54:10,788 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQProtocolSession&amp;#93;&lt;/span&gt; Frame Received: Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;BasicRejectBodyImpl: deliveryTag=15, requeue=true&amp;#93;&lt;/span&gt;&lt;/li&gt;
				&lt;li&gt;: Which is then received and the broker drops the request as there is no DT 15 any more as it has been resent as DT 16&lt;br/&gt;
pool-1-thread-3 2009-05-21 11:54:10,788 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.handler.BasicRejectMethodHandler&amp;#93;&lt;/span&gt; Rejecting:15: Requeue:true on channel:1(6527985)&lt;br/&gt;
pool-1-thread-3 2009-05-21 11:54:10,789 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.handler.BasicRejectMethodHandler&amp;#93;&lt;/span&gt; Dropping reject request as message is null for tag:15&lt;br/&gt;
Dispatcher-Channel-1 2009-05-21 11:54:10,789 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.protocol&amp;#93;&lt;/span&gt; SEND: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.qpid.client.protocol.AMQProtocolHandler@53c3f5&amp;#93;&lt;/span&gt; Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;BasicRejectBodyImpl: deliveryTag=15, requeue=true&amp;#93;&lt;/span&gt;&lt;br/&gt;
Dispatcher-Channel-1 2009-05-21 11:54:10,789 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.message.AbstractJMSMessageFactory&amp;#93;&lt;/span&gt; Non-fragmented message body (bodySize=9)&lt;br/&gt;
Dispatcher-Channel-1 2009-05-21 11:54:10,790 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.message.AbstractJMSMessageFactory&amp;#93;&lt;/span&gt; Creating message from buffer with position=0 and remaining=9&lt;br/&gt;
Dispatcher-Channel-1 2009-05-21 11:54:10,790 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.BasicMessageConsumer&amp;#93;&lt;/span&gt; Message is of type: org.apache.qpid.client.message.JMSTextMessage&lt;/li&gt;
				&lt;li&gt;: Unsuspend the session to allow delivery of messages from the queue. Even though as mentioned above we have already sent the unacked msgs.&lt;br/&gt;
main 2009-05-21 11:54:10,787 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Setting channel flow : unsuspended&lt;br/&gt;
main 2009-05-21 11:54:10,790 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.AMQDataBlockEncoder&amp;#93;&lt;/span&gt; Encoded frame byte-buffer is &apos;0x010001000000050014001401ce&apos;&lt;br/&gt;
main 2009-05-21 11:54:10,791 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.protocol&amp;#93;&lt;/span&gt; SEND: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.qpid.client.protocol.AMQProtocolHandler@53c3f5&amp;#93;&lt;/span&gt; Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;ChannelFlowBodyImpl: active=true&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,791 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQProtocolSession&amp;#93;&lt;/span&gt; Frame Received: Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;ChannelFlowBodyImpl: active=true&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,792 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.handler.ChannelFlowHandler&amp;#93;&lt;/span&gt; Channel.Flow for channel 1, active=true&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,792 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.subscription.SubscriptionImpl&amp;#93;&lt;/span&gt; Subscription:2148614 rejected message:(HC:5474676 ID:1 Ref:1)&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,792 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.subscription.SubscriptionImpl&amp;#93;&lt;/span&gt; (2148614) checking filters for message ((HC:5474676 ID:1 Ref:1)&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,792 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.server.AMQChannel&amp;#93;&lt;/span&gt; 1(6527985) Adding unacked message(Message&lt;span class=&quot;error&quot;&gt;&amp;#91;(HC:5474676 ID:1 Ref:1)&amp;#93;&lt;/span&gt;: 1; ref count: 1 DT:17) with a queue(org.apache.qpid.server.queue.SimpleAMQQueue@1df5f21) for [channel=&lt;span class=&quot;error&quot;&gt;&amp;#91;anonymous(13640204)(guest):1&amp;#93;&lt;/span&gt;, consumerTag=1, session=anonymous(13640204)]&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,793 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.subscription.SubscriptionImpl&amp;#93;&lt;/span&gt; Subscription:2148614 rejected message:(HC:14846251 ID:2 Ref:1)&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,793 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.subscription.SubscriptionImpl&amp;#93;&lt;/span&gt; (2148614) checking filters for message ((HC:14846251 ID:2 Ref:1)&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,793 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.server.AMQChannel&amp;#93;&lt;/span&gt; 1(6527985) Adding unacked message(Message&lt;span class=&quot;error&quot;&gt;&amp;#91;(HC:14846251 ID:2 Ref:1)&amp;#93;&lt;/span&gt;: 2; ref count: 1 DT:18) with a queue(org.apache.qpid.server.queue.SimpleAMQQueue@1df5f21) for [channel=&lt;span class=&quot;error&quot;&gt;&amp;#91;anonymous(13640204)(guest):1&amp;#93;&lt;/span&gt;, consumerTag=1, session=anonymous(13640204)]&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,794 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.subscription.SubscriptionImpl&amp;#93;&lt;/span&gt; Subscription:2148614 rejected message:(HC:10184846 ID:3 Ref:1)&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,794 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.subscription.SubscriptionImpl&amp;#93;&lt;/span&gt; (2148614) checking filters for message ((HC:10184846 ID:3 Ref:1)&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,794 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.server.AMQChannel&amp;#93;&lt;/span&gt; 1(6527985) Adding unacked message(Message&lt;span class=&quot;error&quot;&gt;&amp;#91;(HC:10184846 ID:3 Ref:1)&amp;#93;&lt;/span&gt;: 3; ref count: 1 DT:19) with a queue(org.apache.qpid.server.queue.SimpleAMQQueue@1df5f21) for [channel=&lt;span class=&quot;error&quot;&gt;&amp;#91;anonymous(13640204)(guest):1&amp;#93;&lt;/span&gt;, consumerTag=1, session=anonymous(13640204)]&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,795 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.subscription.SubscriptionImpl&amp;#93;&lt;/span&gt; Subscription:2148614 rejected message:(HC:15555997 ID:4 Ref:1)&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,795 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.subscription.SubscriptionImpl&amp;#93;&lt;/span&gt; (2148614) checking filters for message ((HC:15555997 ID:4 Ref:1)&lt;br/&gt;
pool-1-thread-1 2009-05-21 11:54:10,795 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.server.AMQChannel&amp;#93;&lt;/span&gt; 1(6527985) Adding unacked message(Message&lt;span class=&quot;error&quot;&gt;&amp;#91;(HC:15555997 ID:4 Ref:1)&amp;#93;&lt;/span&gt;: 4; ref count: 1 DT:20) with a queue(org.apache.qpid.server.queue.SimpleAMQQueue@1df5f21) for [channel=&lt;span class=&quot;error&quot;&gt;&amp;#91;anonymous(13640204)(guest):1&amp;#93;&lt;/span&gt;, consumerTag=1, session=anonymous(13640204)]&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,795 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.AMQDataBlockEncoder&amp;#93;&lt;/span&gt; Encoded frame byte-buffer is &apos;0x010001000000050014001501ce&apos;&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,796 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQPFastProtocolHandler&amp;#93;&lt;/span&gt; Message sent: DirectBuffer&lt;span class=&quot;error&quot;&gt;&amp;#91;pos=0 lim=13 cap=16: 01 00 01 00 00 00 05 00 14 00 15 01 CE&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-3 2009-05-21 11:54:10,797 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.protocol&amp;#93;&lt;/span&gt; RECV: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.qpid.client.protocol.AMQProtocolHandler@53c3f5&amp;#93;&lt;/span&gt; Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;ChannelFlowOkBodyImpl: active=true&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-3 2009-05-21 11:54:10,797 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.protocol.AMQProtocolHandler&amp;#93;&lt;/span&gt; (5489653)Method frame received: &lt;span class=&quot;error&quot;&gt;&amp;#91;ChannelFlowOkBodyImpl: active=true&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-3 2009-05-21 11:54:10,797 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.handler.ChannelFlowOkMethodHandler&amp;#93;&lt;/span&gt; Received Channel.Flow-Ok message, active = true&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,797 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQPFastProtocolHandler&amp;#93;&lt;/span&gt; Message sent: Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;ChannelFlowOkBodyImpl: active=true&amp;#93;&lt;/span&gt;&lt;br/&gt;
main 2009-05-21 11:54:10,798 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.AMQSession.Dispatcher&amp;#93;&lt;/span&gt; Set Dispatcher Connection Started: Currently Started&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,798 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.AMQDataBlockEncoder&amp;#93;&lt;/span&gt; Encoded frame byte-buffer is &amp;lt;TRIM&amp;gt;&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,799 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQPFastProtocolHandler&amp;#93;&lt;/span&gt; Message sent: DirectBuffer&lt;span class=&quot;error&quot;&gt;&amp;#91;pos=0 lim=177 cap=256: &amp;lt;TRIM&amp;gt;&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-3 2009-05-21 11:54:10,801 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.BasicContentHeaderProperties&amp;#93;&lt;/span&gt; Property flags: 63952&lt;br/&gt;
pool-1-thread-3 2009-05-21 11:54:10,801 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.protocol&amp;#93;&lt;/span&gt; RECV: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.qpid.client.protocol.AMQProtocolHandler@53c3f5&amp;#93;&lt;/span&gt; Frame channelId: 1, bodyFrame: &lt;span class=&quot;error&quot;&gt;&amp;#91;BasicDeliverBodyImpl: consumerTag=1, deliveryTag=17, redelivered=true, exchange=amq.direct, routingKey=rollback-order-test-queue&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-3 2009-05-21 11:54:10,802 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.protocol.AMQProtocolHandler&amp;#93;&lt;/span&gt; (5489653)Method frame received: &lt;span class=&quot;error&quot;&gt;&amp;#91;BasicDeliverBodyImpl: consumerTag=1, deliveryTag=17, redelivered=true, exchange=amq.direct, routingKey=rollback-order-test-queue&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-3 2009-05-21 11:54:10,802 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.handler.BasicDeliverMethodHandler&amp;#93;&lt;/span&gt; New JmsDeliver method received:org.apache.qpid.client.protocol.AMQProtocolSession@9b6220&lt;br/&gt;
pool-1-thread-3 2009-05-21 11:54:10,802 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.protocol&amp;#93;&lt;/span&gt; RECV: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.qpid.client.protocol.AMQProtocolHandler@53c3f5&amp;#93;&lt;/span&gt; Frame channelId: 1, bodyFrame: org.apache.qpid.framing.ContentHeaderBody@153b2cb&lt;br/&gt;
pool-1-thread-3 2009-05-21 11:54:10,803 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.protocol&amp;#93;&lt;/span&gt; RECV: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.qpid.client.protocol.AMQProtocolHandler@53c3f5&amp;#93;&lt;/span&gt; Frame channelId: 1, bodyFrame: org.apache.qpid.framing.ContentBody@1ff2e1b&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,803 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQPFastProtocolHandler&amp;#93;&lt;/span&gt; Message sent: org.apache.qpid.server.output.amqp0_9.ProtocolOutputConverterImpl$CompositeAMQBodyBlock@2bfdff&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,804 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.AMQDataBlockEncoder&amp;#93;&lt;/span&gt; Encoded frame byte-buffer is &amp;lt;TRIM&amp;gt;&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,805 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQPFastProtocolHandler&amp;#93;&lt;/span&gt; Message sent: DirectBuffer&lt;span class=&quot;error&quot;&gt;&amp;#91;pos=0 lim=177 cap=256: &amp;lt;TRIM&amp;gt;&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,806 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQPFastProtocolHandler&amp;#93;&lt;/span&gt; Message sent: org.apache.qpid.server.output.amqp0_9.ProtocolOutputConverterImpl$CompositeAMQBodyBlock@3fa6cd&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,806 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.AMQDataBlockEncoder&amp;#93;&lt;/span&gt; Encoded frame byte-buffer is &amp;lt;TRIM&amp;gt;&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,807 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQPFastProtocolHandler&amp;#93;&lt;/span&gt; Message sent: DirectBuffer&lt;span class=&quot;error&quot;&gt;&amp;#91;pos=0 lim=177 cap=256: &amp;lt;TRIM&amp;gt;&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,808 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQPFastProtocolHandler&amp;#93;&lt;/span&gt; Message sent: org.apache.qpid.server.output.amqp0_9.ProtocolOutputConverterImpl$CompositeAMQBodyBlock@dfe303&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,808 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.framing.AMQDataBlockEncoder&amp;#93;&lt;/span&gt; Encoded frame byte-buffer is &amp;lt;TRIM&amp;gt;&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,809 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQPFastProtocolHandler&amp;#93;&lt;/span&gt; Message sent: DirectBuffer&lt;span class=&quot;error&quot;&gt;&amp;#91;pos=0 lim=177 cap=256: &amp;lt;TRIM&amp;gt;&amp;#93;&lt;/span&gt;&lt;br/&gt;
pool-1-thread-4 2009-05-21 11:54:10,810 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQPFastProtocolHandler&amp;#93;&lt;/span&gt; Message sent: org.apache.qpid.server.output.amqp0_9.ProtocolOutputConverterImpl$CompositeAMQBodyBlock@b0ede5&lt;br/&gt;
main 2009-05-21 11:54:10,801 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.test.client.RollbackOrderTest&amp;#93;&lt;/span&gt; FAIL : Run Number:3:Body:&lt;br/&gt;
message 5&lt;br/&gt;
JMS Correlation ID: null&lt;br/&gt;
JMS timestamp: 1242903248224&lt;br/&gt;
JMS expiration: 0&lt;br/&gt;
JMS priority: 0&lt;br/&gt;
JMS delivery mode: 2&lt;br/&gt;
JMS reply to: null&lt;br/&gt;
JMS Redelivered: true&lt;br/&gt;
JMS Destination: direct://amq.direct/rollback-order-test-queue/rollback-order-test-queue?routingkey=&apos;rollback-order-test-queue&apos;&amp;amp;durable=&apos;true&apos;&lt;br/&gt;
JMS Type: null&lt;br/&gt;
JMS MessageID: ID:b2c6e1ac-3af5-3d9a-9b43-827c9c583df7&lt;br/&gt;
AMQ message number: 16&lt;br/&gt;
Properties:&amp;lt;NONE&amp;gt;&lt;/li&gt;
			&lt;/ul&gt;
			&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12711626" author="rhs" created="Thu, 21 May 2009 14:00:49 +0000"  >&lt;p&gt;Hmm, I suspect the dispatcher thread exception may be unrelated to the test failure. I think I&apos;ve seen that same dispatcher thread exception on successful runs.&lt;/p&gt;

&lt;p&gt;Regarding the test failure, the appropriate fix is dependent on the desired requeue semantics for the java broker. For the cpp broker, released messages are requeued at the head of the queue, so the order that messages are released determines the order in which they are placed back on the queue. If the java broker does something similar for 0-8 &quot;rejected&quot; messages, then I should be able to make a very similar change to the 0-8 rollback code.&lt;/p&gt;</comment>
                            <comment id="12711999" author="ritchiem" created="Fri, 22 May 2009 09:06:11 +0000"  >&lt;p&gt;I think the problem is bigger than a small change on the client code. In fact I think the whole 0-8 message rejection is flawed. &lt;br/&gt;
1) There seems to be a race condition between the dispatcher and the main thread performing the rollback&lt;br/&gt;
 As highlighted above the the dispatcher is still trying to reject a message after the TxRollback has occured.&lt;/p&gt;

&lt;p&gt;2) On receipt of TxRollback the Java Broker resends all the messages in the Unacked map. This is concievably out of order compared with the rest of the queue. &lt;/p&gt;

&lt;p&gt;3) The Java client suspends(Flow=false) the channel before calling TxRollback but to ensure we get delivery of the Unacked Map before the main queue we violate the suspension and send the messages from the Unacked Map.&lt;/p&gt;

&lt;p&gt;I&apos;m going to JIRA these issues separately. Will issue 1) be a problem in the 0-10 code? What would it mean for a message release to occur AFTER the TxRollback has occured? &lt;/p&gt;</comment>
                            <comment id="12792008" author="astitcher" created="Thu, 17 Dec 2009 16:51:44 +0000"  >&lt;p&gt;It&apos;s unclear what the current state of this is or whether there are any separate Jiras linked from this&lt;/p&gt;</comment>
                            <comment id="12869614" author="ritchiem" created="Thu, 20 May 2010 14:21:02 +0000"  >&lt;p&gt;This test just failed locally for me. &lt;br/&gt;
Saving log file for reference.&lt;/p&gt;</comment>
                            <comment id="12926971" author="gemmellr" created="Mon, 1 Nov 2010 12:09:36 +0000"  >&lt;p&gt;Updating &apos;Fix For&apos;  to Unknown on issues not targeted for 0.8&lt;/p&gt;</comment>
                            <comment id="13097500" author="gemmellr" created="Mon, 5 Sep 2011 21:46:05 +0000"  >&lt;p&gt;Closing issue out as part of JIRA cleanup. Issue may already be resolved, may be invalid, or may never be fixed. See &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-3469&quot; title=&quot;JIRA clean up for Java client/broker&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-3469&quot;&gt;&lt;del&gt;QPID-3469&lt;/del&gt;&lt;/a&gt; for further details.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12445062" name="TEST-org.apache.qpid.test.client.RollbackOrderTest.testOrderingAfterRollback.out" size="511534" author="ritchiem" created="Thu, 20 May 2010 14:21:01 +0000"/>
                            <attachment id="12408669" name="TEST-org.apache.qpid.test.client.RollbackOrderTest.testOrderingAfterRollback.out" size="152291" author="ritchiem" created="Thu, 21 May 2009 08:41:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>62480</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0blmv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>65617</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>