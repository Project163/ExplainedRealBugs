<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:20:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-1830] BytesMessage is unreadable</title>
                <link>https://issues.apache.org/jira/browse/QPID-1830</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;This can easily be seen running the interop coordinator:&lt;/p&gt;

&lt;p&gt;2009-04-28 14:24:38,377 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; distributedtesting.Coordinator (Coordinator.java:285) - Found distributed test case: org.apache.qpid.interop.testcases.InteropTestCase4P2PMessageSize&lt;br/&gt;
javax.jms.MessageNotReadableException: You need to call reset() to make the message readable&lt;br/&gt;
        at org.apache.qpid.client.message.AbstractJMSMessage.checkReadable(AbstractJMSMessage.java:433)&lt;br/&gt;
        at org.apache.qpid.client.message.AbstractBytesMessage.toBodyString(AbstractBytesMessage.java:89)&lt;br/&gt;
        at org.apache.qpid.client.message.AbstractJMSMessage.toString(AbstractJMSMessage.java:371)&lt;br/&gt;
        at java.lang.String.valueOf(String.java:2827)&lt;br/&gt;
        at java.lang.StringBuilder.append(StringBuilder.java:115)&lt;br/&gt;
        at org.apache.qpid.test.utils.ConversationFactory$Conversation.send(ConversationFactory.java:263)&lt;br/&gt;
        at org.apache.qpid.test.framework.distributedtesting.Coordinator.start(Coordinator.java:366)&lt;br/&gt;
        at org.apache.qpid.test.framework.distributedtesting.Coordinator.main(Coordinator.java:315)&lt;br/&gt;
2009-04-28 14:24:39,690 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; distributedtesting.Coordinator (Coordinator.java:330) - javax.jms.MessageNotReadableException: You need to call reset() to make the message readable&lt;br/&gt;
java.lang.RuntimeException: javax.jms.MessageNotReadableException: You need to call reset() to make the message readable&lt;br/&gt;
        at org.apache.qpid.client.message.AbstractJMSMessage.toString(AbstractJMSMessage.java:407)&lt;br/&gt;
        at java.lang.String.valueOf(String.java:2827)&lt;br/&gt;
        at java.lang.StringBuilder.append(StringBuilder.java:115)&lt;br/&gt;
        at org.apache.qpid.test.utils.ConversationFactory$Conversation.send(ConversationFactory.java:263)&lt;br/&gt;
        at org.apache.qpid.test.framework.distributedtesting.Coordinator.start(Coordinator.java:366)&lt;br/&gt;
        at org.apache.qpid.test.framework.distributedtesting.Coordinator.main(Coordinator.java:315)&lt;br/&gt;
Caused by: javax.jms.MessageNotReadableException: You need to call reset() to make the message readable&lt;br/&gt;
        at org.apache.qpid.client.message.AbstractJMSMessage.checkReadable(AbstractJMSMessage.java:433)&lt;br/&gt;
        at org.apache.qpid.client.message.AbstractBytesMessage.toBodyString(AbstractBytesMessage.java:89)&lt;br/&gt;
        at org.apache.qpid.client.message.AbstractJMSMessage.toString(AbstractJMSMessage.java:371)&lt;br/&gt;
        ... 5 more&lt;/p&gt;

&lt;p&gt;This works on the 0.5-release branch, so is presumably a recentish break. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12424014">QPID-1830</key>
            <summary>BytesMessage is unreadable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajith">Rajith Muditha Attapattu</assignee>
                                    <reporter username="aidan">Aidan Skinner</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Apr 2009 13:25:59 +0000</created>
                <updated>Tue, 14 Mar 2017 20:07:06 +0000</updated>
                            <resolved>Thu, 17 Dec 2009 17:25:24 +0000</resolved>
                                    <version>0.6</version>
                    <version>0.7</version>
                                    <fixVersion>0.6</fixVersion>
                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12790346" author="marnie" created="Mon, 14 Dec 2009 20:31:14 +0000"  >&lt;p&gt;Moving items unlikely to be completed for 0.6 out to 0.7&lt;/p&gt;</comment>
                            <comment id="12790380" author="aidan" created="Mon, 14 Dec 2009 21:26:19 +0000"  >&lt;p&gt;Moving back to 0.6, this is quite important. I&apos;m actively working on this. &lt;/p&gt;</comment>
                            <comment id="12791154" author="aidan" created="Wed, 16 Dec 2009 03:07:57 +0000"  >&lt;p&gt;This was caused by r756228, could you fix please?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Aidan&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12791479" author="rajith" created="Wed, 16 Dec 2009 17:48:49 +0000"  >&lt;p&gt;I looked at the issue closely and the diff, and I don&apos;t think the change I made is the cause.&lt;br/&gt;
Infact I am not sure how this worked before either.&lt;/p&gt;

&lt;p&gt;This is due to the way in AbstractJMSMessage is designed.&lt;br/&gt;
The reason why you get the MessageNotReadableException is due to &quot;_readableMessage&quot; being false in the AbstractJMSMessage&lt;br/&gt;
There are only 3 places where &quot;_readableMessage&quot; could get updated in AbstractJMSMessage.&lt;br/&gt;
The two constructors set it to false if the content passed in is null and true if otherwise. This is what is being called when we received messages from the broker.&lt;br/&gt;
Also it is set to false in the clearBody()&lt;br/&gt;
Otherwise this is only set to true in reset() in JMSBytesMessage.&lt;/p&gt;

&lt;p&gt;So it seems to me that either&lt;br/&gt;
1. The JMSBytesMessage was not designed to be readable before being sent&lt;br/&gt;
2. Or this is a bug&lt;/p&gt;

&lt;p&gt;I would like to know the answer to the above question before proceeding any further.&lt;/p&gt;</comment>
                            <comment id="12791492" author="ritchiem" created="Wed, 16 Dec 2009 18:01:54 +0000"  >&lt;p&gt;From memory via the JMS API you cannot read a sent message or newly created messasge. You can only read received messages.&lt;/p&gt;

&lt;p&gt;However, calling toString() should always work. If we have something that is trying to read the underlying data using the JMS API to access the data then this IMHO is not correct. If it uses the byte buffer then it must leave it in the state it found it. &lt;/p&gt;

&lt;p&gt;I would suggest that displaying the body of a message should not be done via toString.&lt;/p&gt;</comment>
                            <comment id="12791504" author="rajith" created="Wed, 16 Dec 2009 18:22:54 +0000"  >&lt;p&gt;If the JMS spec dictates that messages can only be read when they are received then we should probably get rid of the checkReadable() function used in the toBodyString() method. (I think this is the right fix).&lt;/p&gt;

&lt;p&gt;Reading of the contents could be easily done without moving the position of the byte buffer.&lt;br/&gt;
The Functions.str() method does exactly that.&lt;/p&gt;

&lt;p&gt;IMO If somebody does a toString() then not displaying the contents defeats the purpose of the method. Displaying something like a hashcode doesn&apos;t really add any value.&lt;/p&gt;

&lt;p&gt;If there are no objections I will commit the above fix with a null check for the data.&lt;/p&gt;</comment>
                            <comment id="12791902" author="aidan" created="Thu, 17 Dec 2009 12:36:04 +0000"  >&lt;p&gt;I don&apos;t think dumping the data in toString is necessarily the right thing, particularly for a byte message that might contain all manner of control characters etc.  &lt;/p&gt;

&lt;p&gt;From &lt;a href=&quot;http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html#toString%28%29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Object.html#toString%28%29&lt;/a&gt; it says &quot;textually represent&quot;, how about &quot;byte message &amp;lt;message-id&amp;gt; of &amp;lt;size&amp;gt; bytes&quot; ? &lt;/p&gt;
</comment>
                            <comment id="12791941" author="rajith" created="Thu, 17 Dec 2009 14:12:45 +0000"  >&lt;p&gt;Control characters are properly handled and we only print the first 100 bytes.&lt;br/&gt;
We also print all the headers. Just printing the message id is not enough for debugging etc.&lt;/p&gt;

&lt;p&gt;As I mentioned the checkReadable() could be removed from the toBodyString(). &lt;br/&gt;
*&lt;b&gt;It will solve the problem&lt;/b&gt;*.&lt;/p&gt;</comment>
                            <comment id="12791991" author="aidan" created="Thu, 17 Dec 2009 16:04:36 +0000"  >&lt;p&gt;OK, I don&apos;t feel &lt;b&gt;that&lt;/b&gt; strongly about. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12792014" author="rajith" created="Thu, 17 Dec 2009 17:25:24 +0000"  >&lt;p&gt;I have committed a fix at rev 891805 on Qpid trunk.&lt;br/&gt;
The checkReadable() is removed from the toBodyString() allowing the toString() to be called anytime.&lt;br/&gt;
If there is no content an empty string is printed.&lt;/p&gt;</comment>
                            <comment id="12798183" author="rajith" created="Fri, 8 Jan 2010 21:21:50 +0000"  >&lt;p&gt;There is mistake in the commit made in rev 891805 in Qpid trunk&lt;br/&gt;
Due to the mistake a get operation could reference an index out of bounds or it could print fewer items than what is required.&lt;br/&gt;
The mistake is correct in rev 897323 in Qpid trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12500037">QPID-3093</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>168649</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 46 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0bov3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66140</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>