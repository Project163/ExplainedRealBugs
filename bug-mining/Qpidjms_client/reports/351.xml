<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:21:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-1670] Errors thrown from onMessage can kill the dispatcher</title>
                <link>https://issues.apache.org/jira/browse/QPID-1670</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;BasicMessageConsumer.notifyMessage catches Exception and handles it, but unchecked throwables will cause the Dispatcher thread in the Session to terminate after logging. It does not kill the session. &lt;/p&gt;

&lt;p&gt;The JMS spec has this to say:&lt;br/&gt;
4.5.2 Asynchronous Delivery&lt;br/&gt;
A client can register an object that implements the JMS MessageListener&lt;br/&gt;
interface with a MessageConsumer. As messages arrive for the consumer, the&lt;br/&gt;
provider delivers them by calling the listener&apos;s onMessage method.&lt;br/&gt;
It is possible for a listener to throw a RuntimeException; however, this is&lt;br/&gt;
considered a client programming error. Well-behaved listeners should catch&lt;br/&gt;
such exceptions and attempt to divert messages causing them to some form of&lt;br/&gt;
application-specific &apos;unprocessable message&apos; destination.&lt;br/&gt;
The result of a listener throwing a RuntimeException depends on the session&apos;s&lt;br/&gt;
acknowledgment mode.&lt;br/&gt;
&#8226; AUTO_ACKNOWLEDGE or DUPS_OK_ACKNOWLEDGE - the message&lt;br/&gt;
will be immediately redelivered. The number of times a JMS provider will&lt;br/&gt;
redeliver the same message before giving up is provider-dependent. The&lt;br/&gt;
JMSRedelivered message header field will be set for a message redelivered&lt;br/&gt;
under these circumstances.&lt;br/&gt;
&#8226; CLIENT_ACKNOWLEDGE - the next message for the listener is delivered.&lt;br/&gt;
If a client wishes to have the previous unacknowledged message&lt;br/&gt;
redelivered, it must manually recover the session.&lt;br/&gt;
&#8226; Transacted Session - the next message for the listener is delivered. The client&lt;br/&gt;
can either commit or roll back the session (in other words, a&lt;br/&gt;
RuntimeException does not automatically rollback the session).&lt;br/&gt;
JMS providers should flag clients with message listeners that are throwing&lt;br/&gt;
RuntimeExceptions as possibly malfunctioning.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12415218">QPID-1670</key>
            <summary>Errors thrown from onMessage can kill the dispatcher</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="robbie">Robbie Gemmell</assignee>
                                    <reporter username="aidan">Aidan Skinner</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Feb 2009 11:12:33 +0000</created>
                <updated>Tue, 14 Mar 2017 20:08:02 +0000</updated>
                            <resolved>Fri, 4 Feb 2011 11:28:55 +0000</resolved>
                                    <version>0.5</version>
                    <version>0.6</version>
                    <version>0.7</version>
                    <version>0.8</version>
                                    <fixVersion>0.9</fixVersion>
                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12682693" author="aidan" created="Tue, 17 Mar 2009 15:16:27 +0000"  >&lt;p&gt;I was about to fix this, but we do actually handle RuntimeException properly. What we don&apos;t handle are things that don&apos;t extend Exception, such as Error. I&apos;m not sure that we want to handle those this way though, death may be a more appropriate response. &lt;/p&gt;</comment>
                            <comment id="12858444" author="gemmellr" created="Mon, 19 Apr 2010 10:20:22 +0000"  >&lt;p&gt;Downgrading severity from Blocker in light of the previous comment and JIRA name change.&lt;/p&gt;</comment>
                            <comment id="12990174" author="k-wall" created="Thu, 3 Feb 2011 16:52:21 +0000"  >&lt;p&gt;It seems to me that it is reasonable for java.lang.Errors thrown within onMessage to cause the Dispatcher thread to die. Errors represent abnormal JVM conditions and the Javadoc for java.lang.Error specifically advises against trying to handle these error.&lt;/p&gt;

&lt;p&gt;However, I think it would improve the client if it were changed to log the exception to the application log (i.e. log via SLF4J) rather than relying on the logging to stderr provided as default behaviour from the JVM&apos;s ThreadGroup.uncaughtException. This would allow any log scraping employed by the user to detect the condition and respond accordingly (generate an alert, or restart the process)..&lt;/p&gt;

&lt;p&gt;Attaching patch that implements/registers an UncaughtExceptionHandler which logs uncaught exceptions that abruptly terminate threads to the application log (via SLF4J) with supporting system and unit tests&lt;/p&gt;</comment>
                            <comment id="12990176" author="k-wall" created="Thu, 3 Feb 2011 16:53:38 +0000"  >&lt;p&gt;Patch to implement UncaughtExceptionHandler to write errors causing abrupt termination of threads to (client) application log.&lt;/p&gt;</comment>
                            <comment id="12990533" author="gemmellr" created="Fri, 4 Feb 2011 11:28:55 +0000"  >&lt;p&gt;Patch applied.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12470158" name="0001-QPID-1670-Implement-an-UncaughtExceptionHandler-to-l.patch" size="44882" author="kwall" created="Thu, 3 Feb 2011 16:53:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>168512</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 42 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0bpe7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66226</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>