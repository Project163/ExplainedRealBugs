<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:22:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-6701] [Regression btw 0.30 - 0.32] If address doesn&apos;t resolve an exception is not thrown</title>
                <link>https://issues.apache.org/jira/browse/QPID-6701</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;If you run &quot;java -cp $CP org.apache.qpid.example.Spout non-existing-node&quot;,&lt;/p&gt;

&lt;p&gt;1. In 0.30 you get an exception with the cause &quot;org.apache.qpid.AMQException: Exception occured while verifying destination&quot;&lt;/p&gt;

&lt;p&gt;2. In 0.32 no such exception is thrown.&lt;/p&gt;

&lt;p&gt;The issue is in the resolveAddress method in AMQSession class.&lt;br/&gt;
If resolved is false no action is taken. There are a couple issues with this.&lt;/p&gt;

&lt;p&gt;1. A producer can be created to a non existent queue or exchange.&lt;/p&gt;

&lt;p&gt;2. Messages being dropped -  While sending to a non existing exchange will result in an error, sending to a non existent queue via an exchange will simply result in messages being dropped. &lt;/p&gt;

&lt;p&gt;3. The address will continue to be resolved as there was no error the previous time.&lt;/p&gt;

&lt;p&gt;We should throw an exception if resolved == false.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12856984">QPID-6701</key>
            <summary>[Regression btw 0.30 - 0.32] If address doesn&apos;t resolve an exception is not thrown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kwall">Keith Wall</assignee>
                                    <reporter username="rajith">Rajith Muditha Attapattu</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Aug 2015 17:58:08 +0000</created>
                <updated>Wed, 2 Oct 2019 19:21:17 +0000</updated>
                            <resolved>Mon, 28 Sep 2015 15:21:10 +0000</resolved>
                                    <version>0.32</version>
                                    <fixVersion>qpid-java-6.0</fixVersion>
                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14703817" author="k-wall" created="Wed, 19 Aug 2015 22:04:58 +0000"  >&lt;p&gt;Against the Java Broker with a 0-30 client, the underlying exception reports &quot;The name &apos;non-existing-node&apos; supplied in the address doesn&apos;t resolve to an exchange or a queue&quot;.  The pertinent part of the code is  AMQSession#resolveAddress which identifies dest as of type 1 (QUEUE_TYPE), but then the control falls all the way through the switch to hit the default and throw the AMQException.  The exception bubbles up as AMQException &quot; Exception occured while verifying destination&quot; and finally as a JMSException &quot;Error creating producer&quot;. &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception in thread &quot;main&quot; javax.jms.JMSException: Error creating producer
	at org.apache.qpid.client.AMQSession.toJMSException(AMQSession.java:3719)
	at org.apache.qpid.client.AMQSession_0_10.createMessageProducer(AMQSession_0_10.java:696)
	at org.apache.qpid.client.AMQSession_0_10.createMessageProducer(AMQSession_0_10.java:69)
	at org.apache.qpid.client.AMQSession$7.execute(AMQSession.java:2791)
	at org.apache.qpid.client.AMQSession$7.execute(AMQSession.java:2782)
	at org.apache.qpid.client.AMQConnectionDelegate_0_10.executeRetrySupport(AMQConnectionDelegate_0_10.java:371)
	at org.apache.qpid.client.AMQConnection.executeRetrySupport(AMQConnection.java:652)
	at org.apache.qpid.client.failover.FailoverRetrySupport.execute(FailoverRetrySupport.java:96)
	at org.apache.qpid.client.AMQSession.createProducerImpl(AMQSession.java:2780)
	at org.apache.qpid.client.AMQSession.createProducer(AMQSession.java:1305)
	at org.apache.qpid.client.AMQSession.createProducer(AMQSession.java:97)
	at org.apache.qpid.example.Spout.&amp;lt;init&amp;gt;(Spout.java:91)
	at org.apache.qpid.example.Spout.main(Spout.java:147)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.intellij.rt.execution.application.AppMain.main(AppMain.java:140)
Caused by: org.apache.qpid.AMQException: Exception occured while verifying destination
	at org.apache.qpid.client.BasicMessageProducer_0_10.declareDestination(BasicMessageProducer_0_10.java:96)
	at org.apache.qpid.client.BasicMessageProducer.&amp;lt;init&amp;gt;(BasicMessageProducer.java:139)
	at org.apache.qpid.client.BasicMessageProducer_0_10.&amp;lt;init&amp;gt;(BasicMessageProducer_0_10.java:65)
	at org.apache.qpid.client.AMQSession_0_10.createMessageProducer(AMQSession_0_10.java:691)
	... 16 more
Caused by: org.apache.qpid.AMQException: The name &apos;nonexistent&apos; supplied in the address doesn&apos;t resolve to an exchange or a queue
	at org.apache.qpid.client.AMQSession.resolveAddress(AMQSession.java:722)
	at org.apache.qpid.client.BasicMessageProducer_0_10.declareDestination(BasicMessageProducer_0_10.java:90)
	... 19 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6040&quot; title=&quot;[Java Broker] Add the ability to create a single consumer that consumes from multiple queues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6040&quot;&gt;&lt;del&gt;QPID-6040&lt;/del&gt;&lt;/a&gt; (rev 1620659) changed the algorithm in  AMQSession#resolveAddress  so that the two switch blocks (QUEUE_TYPE and TOPIC_TYPE) to &apos;break&apos; regardless of whether they consider the destination to be resolved.  It is not immediately clear to me why &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6040&quot; title=&quot;[Java Broker] Add the ability to create a single consumer that consumes from multiple queues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6040&quot;&gt;&lt;del&gt;QPID-6040&lt;/del&gt;&lt;/a&gt; required this, but I see that currently AddressBasedDestinationTest will fail (against the Java Broker - with &quot;The name &apos;$virtualhostProperties&apos; supplied in the address doesn&apos;t resolve to an exchange or a queue&quot;) if this part is reverted.&lt;/p&gt;



&lt;p&gt;&lt;a href=&quot;https://svn.apache.org/viewvc/qpid/trunk/qpid/java/client/src/main/java/org/apache/qpid/client/AMQSession.java?r1=1620659&amp;amp;r2=1620658&amp;amp;pathrev=1620659&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/viewvc/qpid/trunk/qpid/java/client/src/main/java/org/apache/qpid/client/AMQSession.java?r1=1620659&amp;amp;r2=1620658&amp;amp;pathrev=1620659&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14705746" author="rajith" created="Thu, 20 Aug 2015 21:03:31 +0000"  >&lt;p&gt;&quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6040&quot; title=&quot;[Java Broker] Add the ability to create a single consumer that consumes from multiple queues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6040&quot;&gt;&lt;del&gt;QPID-6040&lt;/del&gt;&lt;/a&gt; (rev 1620659) changed the algorithm in AMQSession#resolveAddress so that the two switch blocks (QUEUE_TYPE and TOPIC_TYPE) to &apos;break&apos; regardless of whether they consider the destination to be resolved&quot;&lt;/p&gt;

&lt;p&gt;This is wrong as it will cause the above issues mentioned in the description of this JIRA.&lt;br/&gt;
Instead of reverting, we could simply throw an exception if the address doesn&apos;t resolve. After all that is what we expect from the address resolution method. We have several customers who rely on the address being resolved properly which is why we want this fixed.&lt;/p&gt;

&lt;p&gt;If there are any test failures after the above simple change, then we should adjust the test behavior.&lt;/p&gt;</comment>
                            <comment id="14705783" author="rgodfrey" created="Thu, 20 Aug 2015 21:23:54 +0000"  >&lt;p&gt;If you want to assert the existence of the node, shouldn&apos;t you be using assert: true in the address?  My reading of the code in AMQSession_0_10.isQueueExist and AMQSession_0_10.isExchangeExist is that if assert is true then an exception will be thrown if the queue/exchange does not exist.&lt;/p&gt;

&lt;p&gt;The issue of throwing an exception if there is no queue/exchange, no matter how assert is set, is that it precludes the use of addresses within the broker that are neither queues nor topics, but which may be sent to / received from.  My take on the addressing syntax is that if you don&apos;t specify assert then the creation of the address shouldn&apos;t fail until it is actually unsuccessful in attempting to consume (which will occur as the attempt to create a consumer to a non-existent address will fail)&lt;/p&gt;</comment>
                            <comment id="14706717" author="rajith" created="Fri, 21 Aug 2015 13:07:46 +0000"  >&lt;p&gt;Couple of points,&lt;/p&gt;

&lt;p&gt;1. Assert was to verify if the node has the supplied properties.Ex durable or if it&apos;s a queue or exchange.&lt;/p&gt;

&lt;p&gt;2. Historically if a node didn&apos;t resolved, an exception was thrown. Whether this was right or wrong,  this is behavior that users had relied upon. Changing that is cuasing issues.with existing customers, which is why the users are treating it as a regression.&lt;/p&gt;

&lt;p&gt;3. While a consume might fail, a producer will not. It will continue to send and the exchange will drop the messages.&lt;/p&gt;

&lt;p&gt;4. If you want to allow addresses that are neither queues nor topics, then make that behavior explicitly configurable and leave the existing behavior the default.&lt;/p&gt;
</comment>
                            <comment id="14711561" author="gsim" created="Tue, 25 Aug 2015 16:22:58 +0000"  >&lt;p&gt;The key purpose of the &apos;resolution&apos; is to determine how to construct the message.transfer request in 0-10, specifically what to put in the destination. You still have to know this even if the thing you are sending to is neither a queue nor an exchange.&lt;/p&gt;

&lt;p&gt;The 0-10 protocol strictly speaking only allows transfers to &apos;exchanges&apos; and subscriptions from &apos;queues&apos;, but I think you could argue for a fair degree of leeway in what the actual behaviour is. I would argue that the most obvious way to send to some extension defined thing would be by specifying it&apos;s name in the message.transfer&apos;s destination field. If you did that and the thing named in that field doesn&apos;t exist, you will still get an exception. (Of course it might well also make sense to treat that thing as an exchange for the purposes of an exchange.query (returning as the &apos;type&apos; some indication of what manner of thing it is) and ideally even exchange.bound. That way resolution would work as normal.&lt;/p&gt;

&lt;p&gt;Point 3. in Rajith&apos;s mail would only happen if you were publishing to the default exchange, using the name of the thing as the value for the routing-key. The default exchange is an unfortunate concept. However given the silent dropping of messages, I think it only makes sense to use that for things that can be queried via queue.query (or again exchange.bound), even if it isn&apos;t a queue.&lt;/p&gt;

&lt;p&gt;Having messages get silently dropped where previously an error would result is in my view a real regression. I think either the default in the case of being unable to resolve it as a queue or an exchange, should be to treat it as something that goes in the destination filed of the transfer, meaning transfers would at least fail with an error. Ideally providing a standard way over 0-10 to test the existence of these non-standard things would be good, and that would allow the resolution to proceed as before.&lt;/p&gt;</comment>
                            <comment id="14904052" author="jira-bot" created="Wed, 23 Sep 2015 06:36:54 +0000"  >&lt;p&gt;Commit 1704763 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwall&quot; class=&quot;user-hover&quot; rel=&quot;kwall&quot;&gt;kwall&lt;/a&gt; in branch &apos;java/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1704763&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1704763&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6701&quot; title=&quot;[Regression btw 0.30 - 0.32] If address doesn&amp;#39;t resolve an exception is not thrown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6701&quot;&gt;&lt;del&gt;QPID-6701&lt;/del&gt;&lt;/a&gt;: &lt;span class=&quot;error&quot;&gt;&amp;#91;Java Client/Java Broker&amp;#93;&lt;/span&gt; Ensure that an unknown node is detected when JMS MessageProducer is created&lt;/p&gt;</comment>
                            <comment id="14904096" author="jira-bot" created="Wed, 23 Sep 2015 07:32:37 +0000"  >&lt;p&gt;Commit 1704766 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwall&quot; class=&quot;user-hover&quot; rel=&quot;kwall&quot;&gt;kwall&lt;/a&gt; in branch &apos;java/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1704766&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1704766&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6701&quot; title=&quot;[Regression btw 0.30 - 0.32] If address doesn&amp;#39;t resolve an exception is not thrown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6701&quot;&gt;&lt;del&gt;QPID-6701&lt;/del&gt;&lt;/a&gt;: &lt;span class=&quot;error&quot;&gt;&amp;#91;Java Client/Java Broker&amp;#93;&lt;/span&gt; Remove unused variable&lt;/p&gt;</comment>
                            <comment id="14933436" author="alex.rufous" created="Mon, 28 Sep 2015 15:21:10 +0000"  >&lt;p&gt;The changes look reasonable to me&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2j2d3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>