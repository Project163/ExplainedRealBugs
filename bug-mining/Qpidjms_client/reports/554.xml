<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:22:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-6206] [JMS 0-9 client] AMQDecoder uses buffered data from previous connection to decode broker frames</title>
                <link>https://issues.apache.org/jira/browse/QPID-6206</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;On failover client AMQDecoder might use buffered data from previous connection to decode broker ProtocolInitaiation frame response and fail.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;13:11:24.215 [IoReceiver - myhostname/192.168.0.1:9677] ERROR o.a.q.c.p.AMQProtocolHandler - Exception processing frame
org.apache.qpid.framing.AMQFrameDecodingException: End of frame marker not found. Read 65 length=2052 type=3
	at org.apache.qpid.framing.AMQDataBlockDecoder.createAndPopulateFrame(AMQDataBlockDecoder.java:104)
	at org.apache.qpid.codec.AMQDecoder.decodeBuffer(AMQDecoder.java:250)
	at org.apache.qpid.client.protocol.AMQProtocolHandler.received(AMQProtocolHandler.java:447)
	at org.apache.qpid.client.protocol.AMQProtocolHandler.received(AMQProtocolHandler.java:122)
	at org.apache.qpid.transport.network.io.IoReceiver.run(IoReceiver.java:152) 
	at java.lang.Thread.run(Thread.java:619)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The exception reported indicates that client was not able to decode the response( End of frame marker not found. Read 65 length=2052 type=3).&lt;br/&gt;
It appears that response was not parsed by the client due to presense of the data from previous connection in AMQDecoder.&lt;br/&gt;
AMQDecoder buffers the received bytes in _remainingBufs. On connectivity lost some data remained in the buffer. AMQDecoder is reused between connections and&lt;br/&gt;
on receiving ProtocolInitaiation AMQDecoder was decoding response with buffereed data from previous connection&lt;/p&gt;

&lt;p&gt;In fact 2 issues are found in AMQDecoder:&lt;br/&gt;
1) ProtocolInitialisation should be decoded with ProtocolInitiation.Decoder but AMQDataBlockDecoder was used to decode ProtocolInitialisation on non-first connection&lt;br/&gt;
2) Buffered data in AMQDecoder._remainingBufs from previous connection were used and AMQDataBlockDecoder was using those to decode ProtocolInitiation frame.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12752009">QPID-6206</key>
            <summary>[JMS 0-9 client] AMQDecoder uses buffered data from previous connection to decode broker frames</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rgodfrey">Robert Godfrey</assignee>
                                    <reporter username="kwall">Keith Wall</reporter>
                        <labels>
                    </labels>
                <created>Fri, 31 Oct 2014 17:18:29 +0000</created>
                <updated>Thu, 19 Mar 2015 12:22:39 +0000</updated>
                            <resolved>Tue, 4 Nov 2014 09:59:37 +0000</resolved>
                                    <version>0.18</version>
                    <version>0.22</version>
                    <version>0.30</version>
                                    <fixVersion>0.31</fixVersion>
                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14192102" author="k-wall" created="Fri, 31 Oct 2014 17:18:48 +0000"  >&lt;p&gt;Defect report from Alex Rudyy,.&lt;/p&gt;</comment>
                            <comment id="14192393" author="jira-bot" created="Fri, 31 Oct 2014 20:17:18 +0000"  >&lt;p&gt;Commit 1635855 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfrer&quot; class=&quot;user-hover&quot; rel=&quot;godfrer&quot;&gt;godfrer&lt;/a&gt; in branch &apos;qpid/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1635855&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1635855&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6206&quot; title=&quot;[JMS 0-9 client] AMQDecoder uses buffered data from previous connection to decode broker frames&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6206&quot;&gt;&lt;del&gt;QPID-6206&lt;/del&gt;&lt;/a&gt; : &lt;span class=&quot;error&quot;&gt;&amp;#91;Java Client&amp;#93;&lt;/span&gt; create new AMQDecoder for every reconnection attempt&lt;/p&gt;</comment>
                            <comment id="14195967" author="alex.rufous" created="Tue, 4 Nov 2014 09:59:37 +0000"  >&lt;p&gt;The changes look good to me&lt;/p&gt;</comment>
                            <comment id="14369026" author="justi9" created="Thu, 19 Mar 2015 12:22:39 +0000"  >&lt;p&gt;Released in Qpid 0.32, &lt;a href=&quot;http://qpid.apache.org/releases/qpid-0.32/index.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://qpid.apache.org/releases/qpid-0.32/index.html&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 35 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21tp3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>