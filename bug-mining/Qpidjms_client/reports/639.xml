<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:23:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-8057] [JMS AMQP 0-x][AMQP 0-10] IoReceiver thread can block itself for 60 seconds after sending session close controls and waiting for broker responses</title>
                <link>https://issues.apache.org/jira/browse/QPID-8057</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;IoReceiver thread can &quot;dead lock&quot; itself for 60 seconds after receiving execution exception from broker and sending session controls to close other connection sessions. This issue can occur in the following scenario:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;broker sends execution exception&lt;/li&gt;
	&lt;li&gt;client receives execution exception and populates field &lt;tt&gt;org.apache.qpid.client.AMQSession_0_10#_currentException&lt;/tt&gt; as part of &lt;tt&gt;org.apache.qpid.client.AMQSession_0_10#setCurrentException&lt;/tt&gt;. The field is set using synchronization lock &lt;tt&gt;org.apache.qpid.client.AMQSession_0_10#_currentExceptionLock&lt;/tt&gt;. However, the field is referenced later in &lt;tt&gt;org.apache.qpid.client.AMQSession_0_10#setCurrentException&lt;/tt&gt; without the synchronization lock. It could be reset (set to null) from the application main thread as part of call &lt;tt&gt;org.apache.qpid.client.AMQSession#checkNotClosed&lt;/tt&gt; whilst the execution of &lt;tt&gt;org.apache.qpid.client.AMQSession_0_10#setCurrentException&lt;/tt&gt; is still in progress. As result, &lt;tt&gt;org.apache.qpid.client.AMQSession_0_10#_currentException&lt;/tt&gt; can have null value when method &lt;tt&gt;org.apache.qpid.client.AMQConnection#exceptionReceived&lt;/tt&gt; is invoked from &lt;tt&gt;org.apache.qpid.client.AMQSession_0_10#setCurrentException&lt;/tt&gt;. &quot;&lt;tt&gt;null&lt;/tt&gt; cause&quot; is interpreted as &quot;hard error&quot; causing to close other sessions and connection from IoReceiver thread. Whilst closing session or connection, the client waits for the broker responses, however, it cannot get them as IoReceiver thread is blocked. Wen should not wait for any broker responses in IoReceiver thread.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thus, we have 2 issues here:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;org.apache.qpid.client.AMQSession_0_10#_currentException&lt;/tt&gt; should not be referenced without a synchronization lock&lt;/li&gt;
	&lt;li&gt;the client should not wait for broker responses in IoReceiver thread (i.e. session or connection close should not be performed in IoReceiver thread)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13123171">QPID-8057</key>
            <summary>[JMS AMQP 0-x][AMQP 0-10] IoReceiver thread can block itself for 60 seconds after sending session close controls and waiting for broker responses</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="orudyy">Alex Rudyy</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Dec 2017 11:49:53 +0000</created>
                <updated>Sun, 20 May 2018 09:40:40 +0000</updated>
                            <resolved>Fri, 22 Dec 2017 16:42:38 +0000</resolved>
                                    <version>qpid-java-6.0.8</version>
                    <version>qpid-java-client-0-x-6.3.0</version>
                    <version>qpid-java-6.1.5</version>
                                    <fixVersion>qpid-java-client-0-x-6.3.1</fixVersion>
                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16280083" author="alex.rufous" created="Wed, 6 Dec 2017 11:56:55 +0000"  >&lt;p&gt;Attached logs for the test &lt;tt&gt;org.apache.qpid.test.unit.transacted.TransactionTimeoutTest.testProducerOpenCommit&lt;/tt&gt; which had failed due to running into the issue&lt;/p&gt;</comment>
                            <comment id="16280196" author="jira-bot" created="Wed, 6 Dec 2017 13:46:14 +0000"  >&lt;p&gt;Commit 7fe48d96b4aa5e13b1b33abd6db573904f8aab00 in qpid-jms-amqp-0-x&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alex.rufous&quot; class=&quot;user-hover&quot; rel=&quot;alex.rufous&quot;&gt;alex.rufous&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms-amqp-0-x.git;h=7fe48d9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms-amqp-0-x.git;h=7fe48d9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-8057&quot; title=&quot;[JMS AMQP 0-x][AMQP 0-10] IoReceiver thread can block itself for 60 seconds after sending session close controls and waiting for broker responses&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-8057&quot;&gt;&lt;del&gt;QPID-8057&lt;/del&gt;&lt;/a&gt;: &lt;span class=&quot;error&quot;&gt;&amp;#91;JMS AMQP 0-x&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;AMQP 0-10&amp;#93;&lt;/span&gt; Fix race on handling of execution exception&lt;/p&gt;</comment>
                            <comment id="16285971" author="k-wall" created="Mon, 11 Dec 2017 14:19:56 +0000"  >&lt;p&gt;I think the change made looks reasonable.  There is deeper problem that would be exposed by setting system property &lt;tt&gt;qpid.session.legacy_exception_behaviour&lt;/tt&gt; to true which would also produce the symptoms described by this JIRA.  Given the status of this client, I would not suggest further work.&lt;/p&gt;</comment>
                            <comment id="16287953" author="jira-bot" created="Tue, 12 Dec 2017 17:32:39 +0000"  >&lt;p&gt;Commit 218d0d5ae8b18cc6e05882f281f25fee5c9ac0ac in qpid-jms-amqp-0-x&apos;s branch refs/heads/6.3.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alex.rufous&quot; class=&quot;user-hover&quot; rel=&quot;alex.rufous&quot;&gt;alex.rufous&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms-amqp-0-x.git;h=218d0d5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms-amqp-0-x.git;h=218d0d5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-8057&quot; title=&quot;[JMS AMQP 0-x][AMQP 0-10] IoReceiver thread can block itself for 60 seconds after sending session close controls and waiting for broker responses&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-8057&quot;&gt;&lt;del&gt;QPID-8057&lt;/del&gt;&lt;/a&gt;: &lt;span class=&quot;error&quot;&gt;&amp;#91;JMS AMQP 0-x&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;AMQP 0-10&amp;#93;&lt;/span&gt; Fix race on handling of execution exception&lt;/p&gt;

&lt;p&gt;Cherry-picked from commit 7fe48d96b4aa5e13b1b33abd6db573904f8aab00&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12900852" name="TEST-org.apache.qpid.test.unit.transacted.TransactionTimeoutTest.testProducerOpenCommit.txt" size="678480" author="orudyy" created="Wed, 6 Dec 2017 11:55:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 48 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3nlm7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>