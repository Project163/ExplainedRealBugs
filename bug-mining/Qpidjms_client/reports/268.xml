<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:20:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-2074] If max_prefetch is 0 , FlowControllingBlockingQueue will eventually suspend the message flow</title>
                <link>https://issues.apache.org/jira/browse/QPID-2074</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;The FlowControllingBlockingQueue will suspend and unsuspend the message flow, on reaching the high and low watermarks respectively. &lt;br/&gt;
In 0-10 code path, if the max_prefetch is set to 0, the above class could irrevocably suspend the message flow under the following circumstances.&lt;/p&gt;

&lt;p&gt;1. The _count starts at zero and we receive a message. The _count is incremented to 1 (the high water mark check passes as high-watermark is zero).&lt;/p&gt;

&lt;p&gt;2. If the message is taken from the queue the count will be reduced to zero (fails the low water mark check) .&lt;/p&gt;

&lt;p&gt;3. The client waits for the next message inside take() and gets notified once a message is put on the queue inside the add(). However the code block that decrements _count inside the take() method could execute before the code block that increments _count inside the take()&lt;/p&gt;

&lt;p&gt;4. If the above happened the decrement (in take()) will bring _count to -1 and the increment (in add()) will bring the _count to zero, hence will fail the high water mark check. This will trigger a session suspend which results in sending a message-stop in 0-10 code path.&lt;/p&gt;

&lt;p&gt;5. So even if there are more messages on the brokers queue, and the client calling receive() and sending 1 message credit, the broker will not send any messages to the client due to lack of byte credits as all message/byte credits was wiped out by the previous message-stop. This will make the JMS client block on receive() even when there is messages in the queue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12433851">QPID-2074</key>
            <summary>If max_prefetch is 0 , FlowControllingBlockingQueue will eventually suspend the message flow</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajith">Rajith Muditha Attapattu</assignee>
                                    <reporter username="rajith">Rajith Muditha Attapattu</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 Aug 2009 14:44:37 +0000</created>
                <updated>Tue, 14 Mar 2017 20:07:24 +0000</updated>
                            <resolved>Tue, 12 Jan 2010 21:17:55 +0000</resolved>
                                    <version>0.5</version>
                                    <fixVersion>0.6</fixVersion>
                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12746942" author="rajith" created="Mon, 24 Aug 2009 16:36:05 +0000"  >&lt;p&gt;I committed a fix in rev 807292 in Qpid trunk.&lt;/p&gt;

&lt;p&gt;I added a flag to disable flow control when max prefetch is zero. This will also prevent unnecessary suspend/resume actions (and hence extra threads being spawned) when the non meaningful thresholds (for the above case) are passed.&lt;br/&gt;
I also think that adjusting the count and putting the message into the queue should be an atomic operation. This means notifying the listener will also need to be squeezed inside the same sync block. Another point to note is that this is redundant in the 0-10 code path as we have protocol level flow control. Since a more complete overhaul is needed in this area, for the time being I have only done the bare minimum.&lt;/p&gt;

&lt;p&gt;I also added a timeout for all sync receives in the DurableSubscriptionTest. This will prevent the whole test suite from hanging if messages don&apos;t arrive as expected. The above test was hanging due to the problem described in the JIRA.&lt;/p&gt;</comment>
                            <comment id="12799392" author="rajith" created="Tue, 12 Jan 2010 21:17:55 +0000"  >&lt;p&gt;The DurableSubscriptionTest which was failing due to the issue described in this JIRA have been running successfully during automated runs.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>168851</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 45 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0bsxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66800</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>