<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:22:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-6647] Thread Leak when Connection is closed while a MessageConsumer is in a receive()</title>
                <link>https://issues.apache.org/jira/browse/QPID-6647</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;A thread leak occurs in our environment running the QPID 0.32 Java client over time.  As best as I can tell from the reproduction code and troubleshooting with jconsole the Dispatcher-X-Conn-X threads are not always getting cleaned up.  It appears to happen when the Connection is interrupted / closed while the MessageConsumer is in receive() but I don&apos;t know that for a fact.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached a zip with some demo code and a gradle build script that reproduces the problem.&lt;/p&gt;

&lt;p&gt;Steps to reproduce:&lt;br/&gt;
1. Unzip archive.&lt;br/&gt;
2. Start up a QPID broker (tried with Java and C++, no difference but I didn&apos;t expect to see one)&lt;br/&gt;
3. Run ./gradlew run -PbrokerUrl=&quot;amqp://guest:guest@localhost/default?brokerlist=&apos;tcp://your.qpid.broker:5672?heartbeat=&apos;5&apos;&amp;amp;retries=&apos;5&apos;&amp;amp;connectdelay=&apos;5000&apos;&apos;&quot; -Pconsumers=100 -Pruntime=30&lt;br/&gt;
4. Launch jconsole and connect to the &lt;tt&gt;Main ....&lt;/tt&gt; process.&lt;br/&gt;
5. Switch to the Threads tab and watch that it grows over time and the Dispatcher-X-Conn-X threads continue to accumulate.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Note:&lt;/b&gt; I disabled the WARN and INFO error logging from QPID since it is &lt;em&gt;very&lt;/em&gt; spammy with thrown InterruptedExceptions and makes it hard to see any other errors that pop up.  That can be changed by changing the system property being sent to the slf4j simple logger set in build.gradle.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Tested in the following environments:&lt;br/&gt;
OSX 10.10.4 with Oracle Java SE Runtime 1.8.0_45-b14&lt;br/&gt;
OSX 10.10.4 with Oracle Java SE Runtime 1.7.0_67&lt;br/&gt;
RHEL 6.3 with OpenJDK RE Java 1.7.0_71 (rhel-2.5.3.2.el6_6-x86_64 u71-b14)&lt;/p&gt;</environment>
        <key id="12845697">QPID-6647</key>
            <summary>Thread Leak when Connection is closed while a MessageConsumer is in a receive()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rgodfrey">Robert Godfrey</assignee>
                                    <reporter username="martyb">Marty B</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Jul 2015 20:00:23 +0000</created>
                <updated>Thu, 12 Nov 2015 00:11:33 +0000</updated>
                            <resolved>Thu, 12 Nov 2015 00:11:32 +0000</resolved>
                                    <version>0.32</version>
                                    <fixVersion>qpid-java-6.0</fixVersion>
                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14630237" author="martyb" created="Thu, 16 Jul 2015 20:03:08 +0000"  >&lt;p&gt;tarball with source to reproduce problem.&lt;/p&gt;</comment>
                            <comment id="14631201" author="jira-bot" created="Fri, 17 Jul 2015 11:13:56 +0000"  >&lt;p&gt;Commit 1691516 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfrer&quot; class=&quot;user-hover&quot; rel=&quot;godfrer&quot;&gt;godfrer&lt;/a&gt; in branch &apos;java/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1691516&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1691516&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6647&quot; title=&quot;Thread Leak when Connection is closed while a MessageConsumer is in a receive()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6647&quot;&gt;&lt;del&gt;QPID-6647&lt;/del&gt;&lt;/a&gt; : &lt;span class=&quot;error&quot;&gt;&amp;#91;Java Client&amp;#93;&lt;/span&gt; On closing a session, ensure that the FlowControlBlockingQueue no longer blocks&lt;/p&gt;</comment>
                            <comment id="14631202" author="rgodfrey" created="Fri, 17 Jul 2015 11:14:01 +0000"  >&lt;p&gt;Hi Marty,&lt;/p&gt;

&lt;p&gt;apologies that you&apos;ve run into this issue in the Qpid client.  With your test code I think I was able to reproduce the issue you are seeing.  I&apos;ve applied a change to trunk after which I am no longer seeing stray Dispatcher threads - I think the change should also apply cleanly to 0.32 if you wish to test it that way.&lt;/p&gt;

&lt;p&gt;Hope this helps,&lt;br/&gt;
Rob&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12745680" name="QPID-6647.tar.bz2" size="59467" author="martyb" created="Thu, 16 Jul 2015 20:03:08 +0000"/>
                            <attachment id="12745681" name="Thread usage over time.png" size="99134" author="martyb" created="Thu, 16 Jul 2015 20:04:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 18 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2hcs7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>