<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:23:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-7253] [Java Client 0-10] Application allowed to create new JMS session whilst failover is in progress</title>
                <link>https://issues.apache.org/jira/browse/QPID-7253</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;Unlike the 0-8 path, creating a JMS session &lt;tt&gt;Connection#createSession()&lt;/tt&gt; does not take the failover mutex.  This means that an application&apos;s call to createSession does not block whilst failover is in flight.  This gives rise to a race between application&apos;s creation of the new session and the re-subscription of the existing sessions.  In an unlucky case, this may cause the client to try and attach the same session twice.  This will be rejected by the Broker with a SESSION_BUSY.&lt;/p&gt;

&lt;p&gt;Following annotated log excerpt is from 6.0.2.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;# Failover has just reconnected an application with existing JMS sessions, but failover is not yet &apos;finished&apos;

2016-05-04 17:31:26,778 DEBUG [com/192.168.0.1:18575] [                              Connection] RECV: [conn:eb35720] ch=0 ConnectionOpenOk(knownHosts=[])
2016-05-04 17:31:26,779 INFO  [com/192.168.0.1:18575] [                           AMQConnection] Connection 1 now connected from /192.168.0.2:48956 to myhost.example.com/192.168.0.1:18
575

# Application thread gets in and creates a new session

2016-05-04 17:31:26,779 DEBUG [   app-listener-thread:01] [                              Connection] SEND: [conn:eb35720] ch=2 SessionAttach(name=&quot;916a6c14-069f-4cd0-ba8b-dde789766864&quot;)
2016-05-04 17:31:26,779 DEBUG [   app-listener-thread:01] [                              Connection] FLUSH: [conn:eb35720]
2016-05-04 17:31:26,779 DEBUG [   app-listener-thread:01] [                              Connection] SEND: [conn:eb35720] ch=2 SessionRequestTimeout(timeout=0)

# Failover begins to &apos;rewire&apos; the existing JMS objects
2016-05-04 17:31:26,780 INFO  [com/192.168.0.1:18575] [              AMQConnectionDelegate_0_10] Resuming connection
2016-05-04 17:31:26,780 DEBUG [   app-listener-thread:01] [                              Connection] FLUSH: [conn:eb35720]
2016-05-04 17:31:26,781 DEBUG [com/192.168.0.1:18575] [                              Connection] SEND: [conn:eb35720] ch=3 SessionAttach(name=&quot;edd4afef-052f-4dfc-8af0-ca96a887977c&quot;)
2016-05-04 17:31:26,781 DEBUG [com/192.168.0.1:18575] [                              Connection] FLUSH: [conn:eb35720]
2016-05-04 17:31:26,781 DEBUG [com/192.168.0.1:18575] [                              Connection] SEND: [conn:eb35720] ch=3 SessionRequestTimeout(timeout=0)
2016-05-04 17:31:26,781 DEBUG [com/192.168.0.1:18575] [                              Connection] FLUSH: [conn:eb35720]
2016-05-04 17:31:26,781 DEBUG [com/192.168.0.1:18575] [                              Connection] SEND: [conn:eb35720] ch=3 SessionCommandPoint(commandId=12383, commandOffset=0)
2016-05-04 17:31:26,781 DEBUG [com/192.168.0.1:18575] [                              Connection] FLUSH: [conn:eb35720]
2016-05-04 17:31:26,781 DEBUG [com/192.168.0.1:18575] [                              Connection] SEND: [conn:eb35720] ch=3 id=12383 ExecutionSync()
2016-05-04 17:31:26,781 DEBUG [com/192.168.0.1:18575] [                              Connection] FLUSH: [conn:eb35720]
2016-05-04 17:31:26,781 DEBUG [com/192.168.0.1:18575] [                              Connection] SEND: [conn:eb35720] ch=3 SessionCommandPoint(commandId=12384, commandOffset=0)
2016-05-04 17:31:26,781 DEBUG [com/192.168.0.1:18575] [                              Connection] FLUSH: [conn:eb35720]
2016-05-04 17:31:26,781 DEBUG [com/192.168.0.1:18575] [                              Connection] SEND: [conn:eb35720] ch=3 SessionFlush(completed=true)
2016-05-04 17:31:26,781 DEBUG [com/192.168.0.1:18575] [                              Connection] FLUSH: [conn:eb35720]
2016-05-04 17:31:26,781 DEBUG [com/192.168.0.1:18575] [                              Connection] SEND: [conn:eb35720] ch=3 id=12384 TxSelect()
2016-05-04 17:31:26,781 DEBUG [com/192.168.0.1:18575] [                              Connection] FLUSH: [conn:eb35720]

# DEFECT Failover treats the application&apos;s new session as if it were an existing one
2016-05-04 17:31:26,781 DEBUG [com/192.168.0.1:18575] [                              Connection] SEND: [conn:eb35720] ch=4 SessionAttach(name=&quot;916a6c14-069f-4cd0-ba8b-dde789766864&quot;)
2016-05-04 17:31:26,781 DEBUG [com/192.168.0.1:18575] [                              Connection] FLUSH: [conn:eb35720]
2016-05-04 17:31:26,781 DEBUG [com/192.168.0.1:18575] [                              Connection] SEND: [conn:eb35720] ch=4 SessionRequestTimeout(timeout=0)
2016-05-04 17:31:26,782 DEBUG [com/192.168.0.1:18575] [                              Connection] FLUSH: [conn:eb35720]
2016-05-04 17:31:26,782 DEBUG [com/192.168.0.1:18575] [                              Connection] SEND: [conn:eb35720] ch=4 SessionCommandPoint(commandId=0, commandOffset=0)
2016-05-04 17:31:26,782 DEBUG [com/192.168.0.1:18575] [                              Connection] FLUSH: [conn:eb35720]
2016-05-04 17:31:26,782 DEBUG [com/192.168.0.1:18575] [                              Connection] SEND: [conn:eb35720] ch=4 SessionFlush(completed=true)
2016-05-04 17:31:26,782 DEBUG [com/192.168.0.1:18575] [                              Connection] FLUSH: [conn:eb35720]
...
2016-05-04 17:31:26,782 INFO  [com/192.168.0.1:18575] [              AMQConnectionDelegate_0_10] Resubscribing sessions = [org.apache.qpid.client.AMQSession_0_10@2a3998ec, org.apache.qpid.client.A
MQSession_0_10@4b230bb3] sessions.size=2
2016-05-04 17:31:26,783 DEBUG [com/192.168.0.1:18575] [                              AMQSession] Resubscribing producers = [] producers.size=0
&#8230;

# Broker rejects the attempt to attach the same session to the second transport
2016-05-04 17:31:26,798 DEBUG [com/192.168.0.1:18575] [                              Connection] RECV: [conn:eb35720] ch=4 SessionDetached(name=&quot;916a6c14-069f-4cd0-ba8b-dde789766864&quot;, code=SESSION
_BUSY)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;



</description>
                <environment></environment>
        <key id="12965250">QPID-7253</key>
            <summary>[Java Client 0-10] Application allowed to create new JMS session whilst failover is in progress</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kwall">Keith Wall</assignee>
                                    <reporter username="kwall">Keith Wall</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 May 2016 11:18:32 +0000</created>
                <updated>Wed, 2 Oct 2019 19:22:04 +0000</updated>
                            <resolved>Thu, 12 May 2016 12:54:38 +0000</resolved>
                                    <version>0.30</version>
                    <version>0.32</version>
                    <version>qpid-java-6.0</version>
                    <version>qpid-java-6.0.2</version>
                                    <fixVersion>qpid-java-6.0.3</fixVersion>
                    <fixVersion>qpid-java-6.1</fixVersion>
                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15274043" author="jira-bot" created="Fri, 6 May 2016 13:47:12 +0000"  >&lt;p&gt;Commit 1742544 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwall&quot; class=&quot;user-hover&quot; rel=&quot;kwall&quot;&gt;kwall&lt;/a&gt; in branch &apos;java/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1742544&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1742544&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-7253&quot; title=&quot;[Java Client 0-10] Application allowed to create new JMS session whilst failover is in progress&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-7253&quot;&gt;&lt;del&gt;QPID-7253&lt;/del&gt;&lt;/a&gt;: &lt;span class=&quot;error&quot;&gt;&amp;#91;Java Client&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;0-10&amp;#93;&lt;/span&gt; Ensure session creation awaits failover completion&lt;/p&gt;</comment>
                            <comment id="15274047" author="k-wall" created="Fri, 6 May 2016 13:48:50 +0000"  >&lt;p&gt;Alex, can you review this commit please?&lt;/p&gt;</comment>
                            <comment id="15274309" author="alex.rufous" created="Fri, 6 May 2016 16:30:09 +0000"  >&lt;p&gt;Keith,&lt;br/&gt;
I reviewed the changed code and it does not look that commit completely resolve the issue. AMQConnection#blockUntilNotFailingOver() waits only for 30 seconds and continue execution. If failover process takes more time, then the issue will manifest in the similar way&lt;/p&gt;</comment>
                            <comment id="15276240" author="jira-bot" created="Mon, 9 May 2016 11:29:59 +0000"  >&lt;p&gt;Commit 1742926 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwall&quot; class=&quot;user-hover&quot; rel=&quot;kwall&quot;&gt;kwall&lt;/a&gt; in branch &apos;java/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1742926&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1742926&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-7253&quot; title=&quot;[Java Client 0-10] Application allowed to create new JMS session whilst failover is in progress&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-7253&quot;&gt;&lt;del&gt;QPID-7253&lt;/del&gt;&lt;/a&gt;: &lt;span class=&quot;error&quot;&gt;&amp;#91;Java Client, 0-10&amp;#93;&lt;/span&gt; Take failover mutex when executing operations that may be interrupted by failover&lt;/p&gt;</comment>
                            <comment id="15277856" author="alex.rufous" created="Tue, 10 May 2016 09:30:36 +0000"  >&lt;p&gt;The changes look reasonable to me. We should port them into 6.0.x branch&lt;/p&gt;</comment>
                            <comment id="15281487" author="k-wall" created="Thu, 12 May 2016 12:53:48 +0000"  >&lt;p&gt;Alex merged this, but the comment fail to create here:&lt;/p&gt;

&lt;p&gt;1743386 | orudyy | 2016-05-11 16:02:00 +0100 (Wed, 11 May 2016) | 4 lines&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-7253&quot; title=&quot;[Java Client 0-10] Application allowed to create new JMS session whilst failover is in progress&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-7253&quot;&gt;&lt;del&gt;QPID-7253&lt;/del&gt;&lt;/a&gt;: &lt;span class=&quot;error&quot;&gt;&amp;#91;Java Client&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;0-10&amp;#93;&lt;/span&gt; Ensure session creation awaits failover completion&lt;/p&gt;

&lt;p&gt;          merged from trunk using&lt;br/&gt;
          svn merge -c 1742544,1742926 ^/qpid/java/trunk&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 27 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2x7dj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>