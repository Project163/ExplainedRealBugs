<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:22:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-3912] Client failover fails to reconnect if a previous attempted reconnection has failed &apos;late&apos; in the connection start process.</title>
                <link>https://issues.apache.org/jira/browse/QPID-3912</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;A client uses failover to allow their client to reconnect to a second broker in the event of failure of the primary. &lt;/p&gt;

&lt;p&gt;There is a defect in the Qpid Java client&apos;s failover code that means if an attempted reconnection fails &apos;late&apos; in the connection start process, then the AMQConnection _closed flag get set permanently to true and this prevents all future use of the AMQConnection object, even after a successful reconnection.  By &apos;late&apos; I mean a failure after the TCP/IP connection has been successfully established - such as an authentication or authorisation problem that causes the Broker to decide to close the connection.&lt;/p&gt;

&lt;p&gt;The problem affects both 0-10 and 0-8..0-9-1 code paths.&lt;/p&gt;



</description>
                <environment></environment>
        <key id="12547797">QPID-3912</key>
            <summary>Client failover fails to reconnect if a previous attempted reconnection has failed &apos;late&apos; in the connection start process.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kwall">Keith Wall</assignee>
                                    <reporter username="kwall">Keith Wall</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Mar 2012 13:52:59 +0000</created>
                <updated>Tue, 14 Mar 2017 20:12:58 +0000</updated>
                            <resolved>Wed, 12 Sep 2012 21:40:05 +0000</resolved>
                                    <version>0.17</version>
                                    <fixVersion>0.17</fixVersion>
                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13240295" author="k-wall" created="Wed, 28 Mar 2012 08:46:49 +0000"  >&lt;p&gt;Patch applied, Andrew can you review please?&lt;/p&gt;</comment>
                            <comment id="13240312" author="macbean" created="Wed, 28 Mar 2012 09:23:08 +0000"  >&lt;p&gt;Looks good, thanks Keith.&lt;/p&gt;</comment>
                            <comment id="13281010" author="k-wall" created="Tue, 22 May 2012 14:47:43 +0000"  >&lt;p&gt;There is a second dimension to this defect which affects 0-8..0-9-1 only.&lt;/p&gt;

&lt;p&gt;It becomes apparent if the failover parameters include a short connectdelay=x parameter.  If x is short (&amp;lt;200ms) on my box, and a connection fails, there is a race condition between which means that the state transition from the previous connection (CLOSING_CONNECTION =&amp;gt; CLOSED_CONNECTION) can occur whilst the main thread is trying to reconnect (AMQConnectionDelegate_8_0.makeBrokerConnection).&lt;/p&gt;

&lt;p&gt;This problem manifests itself in a couple of ways:&lt;/p&gt;

&lt;p&gt;1) &quot;CRAM-MD5 authentication already completed&quot;.   Here the above problem effectively allows a loop to form in the client which emits a stream of ProtocolInitiation messages down the wire.    The Broker replies to each with a ConnectionStart, and this goes on to confuse the SASL authentication on the client.  It ends with exception:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.IllegalStateException: CRAM-MD5 authentication already completed
        at com.sun.security.sasl.CramMD5Client.evaluateChallenge(CramMD5Client.java:75)
        at org.apache.qpid.client.handler.ConnectionSecureMethodHandler.methodReceived(ConnectionSecureMethodHandler.java:55)
        at org.apache.qpid.client.handler.ClientMethodDispatcherImpl.dispatchConnectionSecure(ClientMethodDispatcherImpl.java:216)
        at org.apache.qpid.framing.amqp_0_91.ConnectionSecureBodyImpl.execute(ConnectionSecureBodyImpl.java:110)
        at org.apache.qpid.client.state.AMQStateManager.methodReceived(AMQStateManager.java:114)
        at org.apache.qpid.client.protocol.AMQProtocolHandler.methodBodyReceived(AMQProtocolHandler.java:479)
        at org.apache.qpid.client.protocol.AMQProtocolSession.methodFrameReceived(AMQProtocolSession.java:456)
        at org.apache.qpid.framing.AMQMethodBodyImpl.handle(AMQMethodBodyImpl.java:97)
        at org.apache.qpid.client.protocol.AMQProtocolHandler.received(AMQProtocolHandler.java:436)
        at org.apache.qpid.client.protocol.AMQProtocolHandler.received(AMQProtocolHandler.java:121)
        at org.apache.qpid.transport.network.io.IoReceiver.run(IoReceiver.java:152)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2) OutOfMemoryError/Unsupported frame type: 10&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;IoReceiver - localhost/127.0.0.1:10000 2012-05-21 16:11:59,551 DEBUG [apache.qpid.client.AMQConnection] exceptionReceived done by:IoReceiver - localhost/127.0.0.1:10000
java.lang.OutOfMemoryError: Java heap space
        at org.apache.qpid.framing.EncodingUtils.readBytes(EncodingUtils.java:941)
        at org.apache.qpid.framing.AMQMethodBodyImpl.readBytes(AMQMethodBodyImpl.java:186)
        at org.apache.qpid.framing.amqp_0_91.ConnectionStartBodyImpl.&amp;lt;init&amp;gt;(ConnectionStartBodyImpl.java:77)
        at org.apache.qpid.framing.amqp_0_91.ConnectionStartBodyImpl$1.newInstance(ConnectionStartBodyImpl.java:44)
        at org.apache.qpid.framing.amqp_0_91.MethodRegistry_0_91.convertToBody(MethodRegistry_0_91.java:214)
        at org.apache.qpid.framing.AMQMethodBodyFactory.createBody(AMQMethodBodyFactory.java:44)
        at org.apache.qpid.framing.AMQFrame.&amp;lt;init&amp;gt;(AMQFrame.java:45)
        at org.apache.qpid.framing.AMQDataBlockDecoder.createAndPopulateFrame(AMQDataBlockDecoder.java:99)
        at org.apache.qpid.codec.AMQDecoder.decodeBuffer(AMQDecoder.java:250)
        at org.apache.qpid.client.protocol.AMQProtocolHandler.received(AMQProtocolHandler.java:408)
        at org.apache.qpid.client.protocol.AMQProtocolHandler.received(AMQProtocolHandler.java:121)
        at org.apache.qpid.transport.network.io.IoReceiver.run(IoReceiver.java:152)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)
IoReceiver - localhost/127.0.0.1:10000 2012-05-21 16:11:59,551 ERROR [qpid.client.protocol.AMQProtocolHandler] Exception processing frame
org.apache.qpid.framing.AMQFrameDecodingException: Unsupported frame type: 10
        at org.apache.qpid.framing.AMQDataBlockDecoder.createAndPopulateFrame(AMQDataBlockDecoder.java:86)
        at org.apache.qpid.codec.AMQDecoder.decodeBuffer(AMQDecoder.java:250)
        at org.apache.qpid.client.protocol.AMQProtocolHandler.received(AMQProtocolHandler.java:408)
        at org.apache.qpid.client.protocol.AMQProtocolHandler.received(AMQProtocolHandler.java:121)
        at org.apache.qpid.transport.network.io.IoReceiver.run(IoReceiver.java:152)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13454386" author="gemmellr" created="Wed, 12 Sep 2012 21:39:10 +0000"  >&lt;p&gt;Adding link to &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-4289&quot; title=&quot;[Java Client 0-8/0-9.x] Failover functionality sometimes does not restore the connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-4289&quot;&gt;&lt;del&gt;QPID-4289&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13454387" author="gemmellr" created="Wed, 12 Sep 2012 21:40:05 +0000"  >&lt;p&gt;Resolving this issue, I believe the changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-4289&quot; title=&quot;[Java Client 0-8/0-9.x] Failover functionality sometimes does not restore the connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-4289&quot;&gt;&lt;del&gt;QPID-4289&lt;/del&gt;&lt;/a&gt; address the above re-opening, and changes were made for this JIRA and included in 0.18 which is now released os no furhter change should go against this JIRA either way.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12606568">QPID-4289</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>232894</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 10 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0be3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>64395</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>