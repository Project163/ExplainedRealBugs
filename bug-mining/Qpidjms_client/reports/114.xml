<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:19:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-397] Client closeure can be processed before final message ack.</title>
                <link>https://issues.apache.org/jira/browse/QPID-397</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;We may need an AMQ protocol change to sort out this issue.&lt;/p&gt;

&lt;p&gt;Because the Qpid client uses a dispatcher thread to handle the sending of the ack during auto-ack. There is no guarantee it will send the Ack before a different thread calls consumer.close while the ack is in the process of sending to the broker.&lt;/p&gt;

&lt;p&gt;Perhaps.&lt;/p&gt;

&lt;p&gt;Lock whilst receiving message on consumer so the close cannot be sent first.&lt;/p&gt;

&lt;p&gt;Imagine test case..&lt;/p&gt;

&lt;p&gt;onMessage()&lt;/p&gt;
{

if(messageType == &quot;Close&quot;)
{
 _consumer.close();
}

}

&lt;p&gt;Would be good if this could work.&lt;/p&gt;

&lt;p&gt;the close() call should stop receive calls but cannot wait for the receive call to finish. So if there is lock out on receiving request that the person relinquishing the lock performs a close.&lt;br/&gt;
This would allow the close call to return... question is does JMS allow the close() call to return without the connection actually closing?&lt;/p&gt;


&lt;p&gt;Here is a thread trace:&lt;/p&gt;

&lt;p&gt;AnonymousIoService-8 2007-03-02 15:58:42,187 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.protocol.AMQProtocolHandler&amp;#93;&lt;/span&gt; Sent frame Frame channelId: 1, bodyFrame: class org.apache.qpid.framing.BasicCancelBody Class: 60 Method: 30  consumerTag: 1  nowait: false&lt;br/&gt;
pool-1-thread-1 2007-03-02 15:58:42,187 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.server.protocol.AMQProtocolSession&amp;#93;&lt;/span&gt; Method frame received: Frame channelId: 1, bodyFrame: class org.apache.qpid.framing.BasicCancelBody Class: 60 Method: 30  consumerTag: 1  nowait: false&lt;br/&gt;
Dispatcher-Channel-1 2007-03-02 15:58:42,187 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Sending ack for delivery tag 12 on channel 1&lt;/p&gt;</description>
                <environment></environment>
        <key id="12363982">QPID-397</key>
            <summary>Client closeure can be processed before final message ack.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="7">Later</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ritchiem">Martin Ritchie</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Mar 2007 17:05:36 +0000</created>
                <updated>Mon, 5 Sep 2011 21:45:59 +0000</updated>
                            <resolved>Mon, 5 Sep 2011 21:45:59 +0000</resolved>
                                    <version>M1</version>
                    <version>M2</version>
                                    <fixVersion>JIRA Cleanup</fixVersion>
                                    <component>Broker-J</component>
                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12481206" author="rupertlssmith" created="Thu, 15 Mar 2007 16:11:42 +0000"  >&lt;p&gt;The javadoc for javax.jms.Session#close says:&lt;/p&gt;

&lt;p&gt;&quot;This call will block until a receive call or message listener in progress has completed. A blocked message consumer receive call returns null when this session is closed.&quot;&lt;/p&gt;

&lt;p&gt;Therefore, calling close from onMessage ought to mean that the call blocks forever, waiting for onMessage to complete. In other words, you cannot call session.close from onMessage.&lt;/p&gt;

&lt;p&gt;The situation where another thread calls session.close still exists and the close gets send before the ack, still exists. Creating a test case for it.&lt;/p&gt;
</comment>
                            <comment id="12490062" author="marnie" created="Thu, 19 Apr 2007 13:38:18 +0000"  >&lt;p&gt;Discussed severity with Martin/Rob/Rupert and agreed to downgrade and move to M3.&lt;/p&gt;</comment>
                            <comment id="12643840" author="marnie" created="Thu, 30 Oct 2008 11:15:01 +0000"  >&lt;p&gt;Descoping items not being worked on for M4 into Unknown Fix Version for now&lt;/p&gt;</comment>
                            <comment id="12643970" author="ritchiem" created="Thu, 30 Oct 2008 14:09:56 +0000"  >&lt;p&gt;A test for this issue needs to be written to ensure it is confined to the M2 code base.&lt;/p&gt;</comment>
                            <comment id="13097463" author="gemmellr" created="Mon, 5 Sep 2011 21:45:59 +0000"  >&lt;p&gt;Closing issue out as part of JIRA cleanup. Issue may already be resolved, may be invalid, or may never be fixed. See &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-3469&quot; title=&quot;JIRA clean up for Java client/broker&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-3469&quot;&gt;&lt;del&gt;QPID-3469&lt;/del&gt;&lt;/a&gt; for further details.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>62514</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0blu7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>65650</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>