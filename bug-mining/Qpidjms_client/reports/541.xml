<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:22:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-4429] Java Broker allows frame-size to be negotiated to zero then later fails during message delivery with obscure IllegalArgumentException</title>
                <link>https://issues.apache.org/jira/browse/QPID-4429</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;The Java Broker permits a client to negotiate (connection.tune, connection.tune-ok) the AMQP frame-size to zero, only to fail later (during message delivery) with the following obscure exception:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-11-06 15:50:51,550 ERROR [IoReceiver - /127.0.0.1:36210] (AMQProtocolEngine.java:248) - Unexpected exception when processing datablock
java.lang.IllegalArgumentException
        at java.nio.Buffer.limit(Buffer.java:249)
        at org.apache.qpid.server.store.StoredMemoryMessage.getContent(StoredMemoryMessage.java:121)
        at org.apache.qpid.server.message.AMQMessage.getContent(AMQMessage.java:246)
        at org.apache.qpid.server.output.ProtocolOutputConverterImpl$MessageContentSourceBody.writePayload(ProtocolOutputConverterImpl.java:165)
        at org.apache.qpid.framing.AMQFrame.writeFrames(AMQFrame.java:123)
        at org.apache.qpid.server.output.ProtocolOutputConverterImpl$CompositeAMQBodyBlock.writePayload(ProtocolOutputConverterImpl.java:381)
        at org.apache.qpid.server.protocol.AMQProtocolEngine.asByteBuffer(AMQProtocolEngine.java:408)
        at org.apache.qpid.server.protocol.AMQProtocolEngine.writeFrame(AMQProtocolEngine.java:541)
        at org.apache.qpid.server.output.ProtocolOutputConverterImpl.writeFrame(ProtocolOutputConverterImpl.java:342)
        at org.apache.qpid.server.output.ProtocolOutputConverterImpl.writeMessageDelivery(ProtocolOutputConverterImpl.java:126)
        at org.apache.qpid.server.output.ProtocolOutputConverterImpl.writeMessageDelivery(ProtocolOutputConverterImpl.java:96)
        at org.apache.qpid.server.output.ProtocolOutputConverterImpl.writeDeliver(ProtocolOutputConverterImpl.java:71)
        at org.apache.qpid.server.protocol.AMQProtocolEngine$WriteDeliverMethod.deliverToClient(AMQProtocolEngine.java:1449)
        at org.apache.qpid.server.subscription.SubscriptionImpl.sendToClient(SubscriptionImpl.java:666)
        at org.apache.qpid.server.subscription.SubscriptionImpl$AckSubscription.send(SubscriptionImpl.java:286)
        at org.apache.qpid.server.queue.SimpleAMQQueue.deliverMessage(SimpleAMQQueue.java:834)
        at org.apache.qpid.server.queue.SimpleAMQQueue.deliverToSubscription(SimpleAMQQueue.java:753)
        at org.apache.qpid.server.queue.SimpleAMQQueue.enqueue(SimpleAMQQueue.java:701)
        at org.apache.qpid.server.AMQChannel$MessageDeliveryAction.postCommit(AMQChannel.java:1203)
        at org.apache.qpid.server.AMQChannel$AsyncCommand.complete(AMQChannel.java:1623)
        at org.apache.qpid.server.AMQChannel.sync(AMQChannel.java:1593)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It is easy for a user of the Python client to fall foul of this problem as it&apos;s API current requires that the user remembers to pass all tune-parameters (rather than simply those the user wishes to change).  This in itself is probably a defect.&lt;/p&gt;

&lt;p&gt;However, regardless of any client shortcoming, the underlying problem here is the Java Broker. The AMQP spec (0-8..0.10) requires that the Broker should reject an attempt to reduce the frame-size below 4096.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;em&gt;0-8..0-9-1&lt;/em&gt; Until the frame-max has been negotiated, both peers MUST accept frames of up to frame-min-size octets large, and the minimum negotiated value for frame-max is also frame-min-size (frame-min-size=4096) [&lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;em&gt;0-10&lt;/em&gt; Until the max-frame-size has been negotiated, both peers MUST accept frames of up to MIN-MAX-FRAME-SIZE octets large, and the minimum negotiated value for max-frame-size is also MIN-MAX-FRAME-SIZE. (MIN-MAX-FRAME-SIZE=4096)&lt;/p&gt;&lt;/blockquote&gt;



</description>
                <environment></environment>
        <key id="12615471">QPID-4429</key>
            <summary>Java Broker allows frame-size to be negotiated to zero then later fails during message delivery with obscure IllegalArgumentException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kwall">Keith Wall</assignee>
                                    <reporter username="kwall">Keith Wall</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Nov 2012 12:09:00 +0000</created>
                <updated>Fri, 26 Sep 2014 15:42:43 +0000</updated>
                            <resolved>Mon, 18 Aug 2014 16:50:07 +0000</resolved>
                                    <version>0.19</version>
                                    <fixVersion>0.30</fixVersion>
                                    <component>Broker-J</component>
                    <component>Python Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14091803" author="jira-bot" created="Sat, 9 Aug 2014 16:05:37 +0000"  >&lt;p&gt;Commit 1616977 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfrer&quot; class=&quot;user-hover&quot; rel=&quot;godfrer&quot;&gt;godfrer&lt;/a&gt; in branch &apos;qpid/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1616977&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1616977&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-4429&quot; title=&quot;Java Broker allows frame-size to be negotiated to zero then later fails during message delivery with obscure IllegalArgumentException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-4429&quot;&gt;&lt;del&gt;QPID-4429&lt;/del&gt;&lt;/a&gt; : &lt;span class=&quot;error&quot;&gt;&amp;#91;Java&amp;#93;&lt;/span&gt; Implement max frame size negotiation checks in 0-x protocols&lt;/p&gt;</comment>
                            <comment id="14091804" author="rgodfrey" created="Sat, 9 Aug 2014 16:07:35 +0000"  >&lt;p&gt;A frame size of zero should really be interpreted as &quot;I don&apos;t care&quot;, though in 0-8/9/9-1 the client should probably be explicit if the broker has set a value.&lt;/p&gt;

&lt;p&gt;In any case, proper frame size negotiation checking needed to be added to the 0-8/9/9-1 codepath, and the 0-10 codepath simply assume 64K and ignored any attempts to change it.  These issues are addressed in the commit.&lt;/p&gt;</comment>
                            <comment id="14091888" author="jira-bot" created="Sat, 9 Aug 2014 20:11:29 +0000"  >&lt;p&gt;Commit 1617012 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfrer&quot; class=&quot;user-hover&quot; rel=&quot;godfrer&quot;&gt;godfrer&lt;/a&gt; in branch &apos;qpid/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1617012&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1617012&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-4429&quot; title=&quot;Java Broker allows frame-size to be negotiated to zero then later fails during message delivery with obscure IllegalArgumentException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-4429&quot;&gt;&lt;del&gt;QPID-4429&lt;/del&gt;&lt;/a&gt; : Fix 0-8 version of frame too large test&lt;/p&gt;</comment>
                            <comment id="14092947" author="jira-bot" created="Mon, 11 Aug 2014 16:27:00 +0000"  >&lt;p&gt;Commit 1617323 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfrer&quot; class=&quot;user-hover&quot; rel=&quot;godfrer&quot;&gt;godfrer&lt;/a&gt; in branch &apos;qpid/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1617323&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1617323&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-4429&quot; title=&quot;Java Broker allows frame-size to be negotiated to zero then later fails during message delivery with obscure IllegalArgumentException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-4429&quot;&gt;&lt;del&gt;QPID-4429&lt;/del&gt;&lt;/a&gt; : C++ Broker does not enforce max frame size negotiation rules&lt;/p&gt;</comment>
                            <comment id="14100838" author="k-wall" created="Mon, 18 Aug 2014 16:49:59 +0000"  >&lt;p&gt;Changes look reasonable to me.   We should include this defect fix in 0.30&lt;/p&gt;</comment>
                            <comment id="14103965" author="justi9" created="Wed, 20 Aug 2014 14:55:09 +0000"  >&lt;p&gt;Reviewed by Keith.  Approved for 0.30.&lt;/p&gt;</comment>
                            <comment id="14149338" author="justi9" created="Fri, 26 Sep 2014 15:42:43 +0000"  >&lt;p&gt;Released in Qpid 0.30, &lt;a href=&quot;http://qpid.apache.org/releases/qpid-0.30/index.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://qpid.apache.org/releases/qpid-0.30/index.html&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>256757</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 8 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0iqw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>107451</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>