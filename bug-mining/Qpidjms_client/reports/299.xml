<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:20:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-2370] TTR-Qpid-07-NA failed due to channel error 504 during tear down</title>
                <link>https://issues.apache.org/jira/browse/QPID-2370</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;During a full &apos;RunCore.sh&apos; performance test run TTR-Qpid-07-NA hung holding the test run up. This appeared to be as a result of a Channel Error that was thrown during. &lt;/p&gt;

&lt;p&gt;Thread-4 2010-01-26 03:29:48,722 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQConnection&amp;#93;&lt;/span&gt; error:&lt;br/&gt;
org.apache.qpid.AMQConnectionClosedException: Error: channel is closed &lt;span class=&quot;error&quot;&gt;&amp;#91;error code 504: channel error&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;error code 504: channel error&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;This may have occured during test tear down as the following was logged by the same thread just after the stack trace.&lt;br/&gt;
Thread-4 2010-01-26 03:29:48,725 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.ping.PingTestPerf&amp;#93;&lt;/span&gt; There was an exception during per thread tear down.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12446899">QPID-2370</key>
            <summary>TTR-Qpid-07-NA failed due to channel error 504 during tear down</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="robbie">Robbie Gemmell</assignee>
                                    <reporter username="ritchiem">Martin Ritchie</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 Jan 2010 11:00:24 +0000</created>
                <updated>Tue, 14 Mar 2017 20:07:55 +0000</updated>
                            <resolved>Thu, 30 Sep 2010 22:38:31 +0000</resolved>
                                    <version>0.6</version>
                                    <fixVersion>0.7</fixVersion>
                                    <component>Java Performance Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12805869" author="ritchiem" created="Thu, 28 Jan 2010 11:09:26 +0000"  >&lt;p&gt;Given the number of &apos;.&apos;s it does make sence that this error occured at the end of the test run during the tear down. After the exception occurs the &apos;Unable to suspend channel&apos; message is repeated 114 times.&lt;/p&gt;

&lt;p&gt;Whilst killing the test run did not result in the junit test failure (note OK still logged) this is only due to the fact that the exception was not thrown out of the test case.&lt;/p&gt;

&lt;p&gt;.................AnonymousIoService-1 2010-01-26 03:29:48,720 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;qpid.client.state.AMQStateManager&amp;#93;&lt;/span&gt; No Waiters for error saving as last error:Error: channel is closed &lt;span class=&quot;error&quot;&gt;&amp;#91;error code 504: channel error&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;error code 504: channel error&amp;#93;&lt;/span&gt;&lt;br/&gt;
Thread-346184 2010-01-26 03:29:48,721 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Unable to suspend channel&lt;br/&gt;
Thread-4 2010-01-26 03:29:48,722 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQConnection&amp;#93;&lt;/span&gt; error:&lt;br/&gt;
org.apache.qpid.AMQConnectionClosedException: Error: channel is closed &lt;span class=&quot;error&quot;&gt;&amp;#91;error code 504: channel error&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;error code 504: channel error&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.qpid.client.handler.ConnectionCloseMethodHandler.methodReceived(ConnectionCloseMethodHandler.java:85)&lt;br/&gt;
	at org.apache.qpid.client.handler.ClientMethodDispatcherImpl.dispatchConnectionClose(ClientMethodDispatcherImpl.java:180)&lt;br/&gt;
	at org.apache.qpid.framing.amqp_0_9.ConnectionCloseBodyImpl.execute(ConnectionCloseBodyImpl.java:140)&lt;br/&gt;
	at org.apache.qpid.client.state.AMQStateManager.methodReceived(AMQStateManager.java:112)&lt;br/&gt;
	at org.apache.qpid.client.protocol.AMQProtocolHandler.methodBodyReceived(AMQProtocolHandler.java:552)&lt;br/&gt;
	at org.apache.qpid.client.protocol.AMQProtocolSession.methodFrameReceived(AMQProtocolSession.java:533)&lt;br/&gt;
	at org.apache.qpid.framing.AMQMethodBodyImpl.handle(AMQMethodBodyImpl.java:93)&lt;br/&gt;
	at org.apache.qpid.client.protocol.AMQProtocolHandler.messageReceived(AMQProtocolHandler.java:519)&lt;br/&gt;
	at org.apache.mina.common.support.AbstractIoFilterChain$TailFilter.messageReceived(AbstractIoFilterChain.java:703)&lt;br/&gt;
	at org.apache.mina.common.support.AbstractIoFilterChain.callNextMessageReceived(AbstractIoFilterChain.java:362)&lt;br/&gt;
	at org.apache.mina.common.support.AbstractIoFilterChain.access$1200(AbstractIoFilterChain.java:54)&lt;br/&gt;
	at org.apache.mina.common.support.AbstractIoFilterChain$EntryImpl$1.messageReceived(AbstractIoFilterChain.java:800)&lt;br/&gt;
	at org.apache.mina.filter.codec.support.SimpleProtocolDecoderOutput.flush(SimpleProtocolDecoderOutput.java:60)&lt;br/&gt;
	at org.apache.mina.filter.codec.ProtocolCodecFilter.messageReceived(ProtocolCodecFilter.java:184)&lt;br/&gt;
	at org.apache.mina.common.support.AbstractIoFilterChain.callNextMessageReceived(AbstractIoFilterChain.java:362)&lt;br/&gt;
	at org.apache.mina.common.support.AbstractIoFilterChain.access$1200(AbstractIoFilterChain.java:54)&lt;br/&gt;
	at org.apache.mina.common.support.AbstractIoFilterChain$EntryImpl$1.messageReceived(AbstractIoFilterChain.java:800)&lt;br/&gt;
	at org.apache.mina.filter.executor.ExecutorFilter.processEvent(ExecutorFilter.java:243)&lt;br/&gt;
	at org.apache.mina.filter.executor.ExecutorFilter$ProcessEventsRunnable.run(ExecutorFilter.java:305)&lt;br/&gt;
	at edu.emory.mathcs.backport.java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:665)&lt;br/&gt;
	at edu.emory.mathcs.backport.java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:690)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
Thread-346182 2010-01-26 03:29:48,725 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Unable to suspend channel&lt;br/&gt;
Thread-346180 2010-01-26 03:29:48,725 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Unable to suspend channel&lt;br/&gt;
Thread-4 2010-01-26 03:29:48,725 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.ping.PingTestPerf&amp;#93;&lt;/span&gt; There was an exception during per thread tear down.&lt;br/&gt;
Thread-346179 2010-01-26 03:29:48,725 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Unable to suspend channel&lt;br/&gt;
Thread-346178 2010-01-26 03:29:48,725 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Unable to suspend channel&lt;br/&gt;
Thread-346177 2010-01-26 03:29:48,725 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Unable to suspend channel&lt;br/&gt;
Thread-346176 2010-01-26 03:29:48,725 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Unable to suspend channel&lt;br/&gt;
Thread-346175 2010-01-26 03:29:48,725 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Unable to suspend channel&lt;br/&gt;
Thread-346174 2010-01-26 03:29:48,725 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Unable to suspend channel&lt;br/&gt;
Thread-346173 2010-01-26 03:29:48,726 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Unable to suspend channel&lt;/p&gt;

&lt;p&gt;Thread-346172 2010-01-26 03:29:48,726 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Unable to suspend channel&lt;br/&gt;
Thread-346171 2010-01-26 03:29:48,726 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Unable to suspend channel&lt;br/&gt;
Thread-346170 2010-01-26 03:29:48,726 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Unable to suspend channel&lt;br/&gt;
Thread-346169 2010-01-26 03:29:48,726 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Unable to suspend channel&lt;br/&gt;
Thread-346181 2010-01-26 03:29:48,724 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Unable to suspend channel&lt;br/&gt;
Time: 3,601.185&lt;/p&gt;

&lt;p&gt;OK (29307 tests)&lt;/p&gt;

&lt;p&gt;Thread-346183 2010-01-26 03:29:48,724 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Unable to suspend channel&lt;br/&gt;
Thread-346168 2010-01-26 03:29:48,727 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;apache.qpid.client.AMQSession&amp;#93;&lt;/span&gt; Unable to suspend channel&lt;/p&gt;</comment>
                            <comment id="12828076" author="ritchiem" created="Mon, 1 Feb 2010 12:35:57 +0000"  >&lt;p&gt;Added patch that causes a session.closed/closing check to be performed before attempting to send the ChannelFlow method.&lt;/p&gt;

&lt;p&gt;This will not remove the race condition however, it will greatly reduce the chances of a ChannelFlow method occuring AFTER a ChannelClose has been sent.&lt;/p&gt;</comment>
                            <comment id="12828094" author="ritchiem" created="Mon, 1 Feb 2010 12:47:03 +0000"  >&lt;p&gt;I did mean to grant permission&lt;/p&gt;</comment>
                            <comment id="12828104" author="ritchiem" created="Mon, 1 Feb 2010 13:18:12 +0000"  >&lt;p&gt;Additional patch that improves the broker debug statements making diagnosis of issues easier.&lt;/p&gt;</comment>
                            <comment id="12828106" author="ritchiem" created="Mon, 1 Feb 2010 13:41:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-1084&quot; title=&quot;[Java Client] Race condition suspending channel in no-ack flow control situations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-1084&quot;&gt;&lt;del&gt;QPID-1084&lt;/del&gt;&lt;/a&gt; highlighted that we are creating a lot of threads here. &lt;/p&gt;

&lt;p&gt;In the TTR-&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-7&quot; title=&quot;Occasionally messages are ack&amp;#39;d more than once&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-7&quot;&gt;&lt;del&gt;QPID-07&lt;/del&gt;&lt;/a&gt;-NoAck test it is 60 Threads per second! &lt;/p&gt;

&lt;p&gt;The problem is there is no ordering control on the execution of the threads, which whilst the suspension state has been addressed with an AtomicBoolean there is no control to ensure that these threads do not execute AFTER a ChannelClose has occured.&lt;/p&gt;</comment>
                            <comment id="12828107" author="ritchiem" created="Mon, 1 Feb 2010 13:43:30 +0000"  >&lt;p&gt;Updated the patch to check the state of the suspension to before creating a thread. This will reduce thread creations.&lt;/p&gt;</comment>
                            <comment id="12828607" author="ritchiem" created="Tue, 2 Feb 2010 12:08:08 +0000"  >&lt;p&gt;Hi Robbie can you review these changes please. I commited the Broker and the client change (withStateCheck).&lt;/p&gt;

&lt;p&gt;Cheers.&lt;/p&gt;</comment>
                            <comment id="12916720" author="gemmellr" created="Thu, 30 Sep 2010 22:38:31 +0000"  >&lt;p&gt;Reviewed this at the time, not sure why its still RTR.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12396483">QPID-1084</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12434385" name="QPID-2370-Improve-BrokerDebug.patch" size="1967" author="ritchiem" created="Mon, 1 Feb 2010 13:18:12 +0000"/>
                            <attachment id="12434380" name="QPID-2370.CheckClosedBeforeFlow.patch" size="5651" author="ritchiem" created="Mon, 1 Feb 2010 12:47:03 +0000"/>
                            <attachment id="12434386" name="QPID-2370.CheckClosedBeforeFlowWithStateCheck.patch" size="6353" author="ritchiem" created="Mon, 1 Feb 2010 13:43:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>169109</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 8 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0bqvj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66466</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>