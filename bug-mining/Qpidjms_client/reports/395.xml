<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:21:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-3428] Verification of unique client ID does not work with Java Broker</title>
                <link>https://issues.apache.org/jira/browse/QPID-3428</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;On settings client JVM property &quot;qpid.verify_client_id&quot; to &quot;true&quot; Qpid broker should not allow creation of connections with the same client id. However, this functionality does not work at the moment.&lt;/p&gt;

&lt;p&gt;JUnit test  org.apache.qpid.test.unit.client.connection.ConnectionTest#testClientIDVerification fails with the following message:&lt;br/&gt;
&quot;The client should throw a ConnectionException stating the client ID is not unique&quot;&lt;/p&gt;

&lt;p&gt;junit.framework.AssertionFailedError: The client should throw a ConnectionException stating the client ID is not unique&lt;br/&gt;
at org.apache.qpid.test.unit.client.connection.ConnectionTest.testClientIDVerification(ConnectionTest.java:307)&lt;br/&gt;
at org.apache.qpid.test.utils.QpidBrokerTestCase.runBare(QpidBrokerTestCase.java:243)&lt;br/&gt;
at org.apache.qpid.test.utils.QpidTestCase.run(QpidTestCase.java:125)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12519118">QPID-3428</key>
            <summary>Verification of unique client ID does not work with Java Broker</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="robbie">Robbie Gemmell</assignee>
                                    <reporter username="orudyy">Alex Rudyy</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Aug 2011 14:13:27 +0000</created>
                <updated>Sun, 30 Oct 2011 18:46:29 +0000</updated>
                            <resolved>Sun, 30 Oct 2011 18:46:29 +0000</resolved>
                                    <version>0.10</version>
                                    <fixVersion>0.13</fixVersion>
                                    <component>Broker-J</component>
                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13095213" author="macbean" created="Thu, 1 Sep 2011 10:09:15 +0000"  >&lt;p&gt;Based on test case and implementation in Java client and C++ broker for (&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-3269&quot; title=&quot; Concurrently executing connections are allowed to use the same client ID&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-3269&quot;&gt;&lt;del&gt;QPID-3269&lt;/del&gt;&lt;/a&gt;) the broker has been changed to validate that the client id used is unique when creating a new session and attaching.&lt;/p&gt;

&lt;p&gt;If the client id is null or is unique then the session is attached as before, otherwise it invokes session detached and sets the session detach code to SESSION_BUSY and calls session.closed().&lt;/p&gt;

&lt;p&gt;A patch has been attached for review.  The patch also includes some minor client changes to fix a small bug found during development in the Session.awaitOpen() method which was throwing a SessionException even if the state was OPEN as expected. This was &quot;swallowed&quot; later so had no real knock on effect anyway.&lt;/p&gt;</comment>
                            <comment id="13095218" author="macbean" created="Thu, 1 Sep 2011 10:21:34 +0000"  >&lt;p&gt;Robbie, could you please review the attached patch and apply if suitable.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Andrew&lt;/p&gt;</comment>
                            <comment id="13099277" author="gemmellr" created="Wed, 7 Sep 2011 20:20:17 +0000"  >&lt;p&gt;Changes look good overall, but theres a some bits I think could be improved:&lt;/p&gt;

&lt;p&gt;In ServerConnectionDelegate.sessionAttach, the clientId (sessionName, rather?) variable can never be null so the check is redundant.Also, in the new &apos;isSessionNameUnique&apos; method, we can probably be mroe efficient than iterating over every Session in the broker and comparing ClientIDs. Each Connection object has a Map of session names to their Session, so it should be possible to just ask query connection whether it has a Session with a given name, with the 0-8/9/9-1 connections simply returning false since they dont support that.&lt;/p&gt;

&lt;p&gt;In AMQConnectionDelegate / AMQConnection, it seems like it would be better to use a boolean for the result normally and rethrow any unexpected exceptions, rather than detecting whether or not there is a linked exception set to distinguish between two JMSExceptions.&lt;/p&gt;

&lt;p&gt;Finally, in ConnectionTest you could use the setTestSystemProperty() method from QpidTestCase method to update and revert the &apos;qpid.verify_client_id&apos; property (which should probably be a constant; there should be one in ClientProperties, but if there isnt it needs added).&lt;/p&gt;</comment>
                            <comment id="13102505" author="macbean" created="Mon, 12 Sep 2011 08:45:27 +0000"  >&lt;p&gt;Review comments actioned, please review.&lt;/p&gt;</comment>
                            <comment id="13102543" author="gemmellr" created="Mon, 12 Sep 2011 11:05:41 +0000"  >&lt;p&gt;Looks good, but I missed something in my original review that still needs addressed. The 0-10 session naming should be per-principal, so currently the verification being done is too strict in that it checks only if the name exists, not whether it is for the same principal, so we need to relax that accordingly.&lt;/p&gt;</comment>
                            <comment id="13102719" author="macbean" created="Mon, 12 Sep 2011 15:08:49 +0000"  >&lt;p&gt;Checked this vs the C++ broker and you were right, modified the patch and added a new test to highlight the difference.&lt;/p&gt;</comment>
                            <comment id="13103214" author="gemmellr" created="Tue, 13 Sep 2011 00:30:48 +0000"  >&lt;p&gt;Patch applied, along with a fix for the excludes file and some small test tweaks.&lt;/p&gt;</comment>
                            <comment id="13139696" author="gemmellr" created="Sun, 30 Oct 2011 18:38:08 +0000"  >&lt;p&gt;Reopening, investigation of an apparent memory leak has shown the previous changes result in leaking the sessions+connections in the management layer by causing duplicate registrations to occur.&lt;/p&gt;</comment>
                            <comment id="13139699" author="gemmellr" created="Sun, 30 Oct 2011 18:46:29 +0000"  >&lt;p&gt;Updated to prevent the duplicate 0-10 ServerSession creations + registrations.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12492590" name="[QPID-3428]-verifification-of-unique-client-ID-does-not-work-in-Java-Broker.patch" size="8704" author="macbean" created="Thu, 1 Sep 2011 10:20:05 +0000"/>
                            <attachment id="12494007" name="[QPID-3428]-verifification-of-unique-client-ID-does-not-work-in-Java-Broker2.patch" size="15004" author="macbean" created="Mon, 12 Sep 2011 08:45:27 +0000"/>
                            <attachment id="12494043" name="[QPID-3428]-verifification-of-unique-client-ID-does-not-work-in-Java-Broker3.patch" size="16105" author="macbean" created="Mon, 12 Sep 2011 15:08:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>60825</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 3 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0bkm7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>65452</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>