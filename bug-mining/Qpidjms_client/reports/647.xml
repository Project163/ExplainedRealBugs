<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:23:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-8185] [JMS AMQP 0-x][AMQP 0-8..0-91] Make sure that client closes TCP connection on failure with sending connection.close and avoid spurious NPEs whilst awaiting channel closure</title>
                <link>https://issues.apache.org/jira/browse/QPID-8185</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;Sending connection.close as part of &lt;tt&gt;Connection#close&lt;/tt&gt; can end-up in timeout exception. The underlying TCP connection remains open and Broker can continue sending data to the client when session close ends up in timeout as well. The incoming frames cannot be associated with the sessions, as the client removes session information on connection close. As result, a number of confusing exceptions is reported.&lt;/p&gt;

&lt;p&gt;Here are the examples of exception stack-traces reported for the issue&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;INFO  Unsuspending channel threw an exception:                                                        [Thread-227][AMQSession.java:2374]
org.apache.qpid.AMQTimeoutException: Server did not respond in a timely fashion
        at org.apache.qpid.client.util.BlockingWaiter.block(BlockingWaiter.java:170) ~[qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.protocol.BlockingMethodFrameListener.blockForFrame(BlockingMethodFrameListener.java:115) ~[qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.protocol.AMQProtocolHandler.writeCommandFrameAndWaitForReply(AMQProtocolHandler.java:715) ~[qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.protocol.AMQProtocolHandler.syncWrite(AMQProtocolHandler.java:736) ~[qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.protocol.AMQProtocolHandler.syncWrite(AMQProtocolHandler.java:730) ~[qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.AMQSession_0_8.sendSuspendChannel(AMQSession_0_8.java:728) ~[qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.AMQSession.suspendChannel(AMQSession.java:3156) [qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.AMQSession.startDispatcherIfNecessary(AMQSession.java:2370) [qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.AMQSession.syncDispatchQueue(AMQSession.java:2223) [qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.AMQSession.rollback(AMQSession.java:1881) [qpid-client-0.32.jar:0.32]

ERROR Error closing session: javax.jms.JMSException: Error closing session: org.apache.qpid.AMQTimeoutException: Server did not respond in a timely fashion [error code 408: Request Timeout][DefaultMessageListenerContainer-2][AMQConnection.java:1039]
ERROR Error closing connection                                                                        [DefaultMessageListenerContainer-2][AMQConnection.java:971]
javax.jms.JMSException: Error closing session: org.apache.qpid.AMQTimeoutException: Server did not respond in a timely fashion [error code 408: Request Timeout]
        at org.apache.qpid.client.AMQSession.close(AMQSession.java:764) ~[qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.AMQSession.close(AMQSession.java:730) ~[qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.AMQConnection.closeAllSessions(AMQConnection.java:1035) [qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.AMQConnection.doClose(AMQConnection.java:962) [qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.AMQConnection.doClose(AMQConnection.java:951) [qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.AMQConnection.doClose(AMQConnection.java:951) [qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.AMQConnection.close(AMQConnection.java:935) [qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.AMQConnection.close(AMQConnection.java:916) [qpid-client-0.32.jar:0.32]
        at org.springframework.jms.connection.ConnectionFactoryUtils.releaseConnection(ConnectionFactoryUtils.java:80) [spring-jms-4.2.3.RELEASE.jar:4.2.3.RELEASE]
        at org.springframework.jms.listener.AbstractJmsListeningContainer.refreshSharedConnection(AbstractJmsListeningContainer.java:395) [spring-jms-4.2.3.RELEASE.jar:4.2.3.RELEASE]
        at org.springframework.jms.listener.DefaultMessageListenerContainer.refreshConnectionUntilSuccessful(DefaultMessageListenerContainer.java:915) [spring-jms-4.2.3.RELEASE.jar:4.2.3.RELEASE]
        at org.springframework.jms.listener.DefaultMessageListenerContainer.recoverAfterListenerSetupFailure(DefaultMessageListenerContainer.java:890) [spring-jms-4.2.3.RELEASE.jar:4.2.3.RELEASE]
        at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:1061) [spring-jms-4.2.3.RELEASE.jar:4.2.3.RELEASE]
        at java.lang.Thread.run(Thread.java:724) [na:1.7.0_40]
Caused by: org.apache.qpid.AMQTimeoutException: Server did not respond in a timely fashion
        at org.apache.qpid.client.util.BlockingWaiter.block(BlockingWaiter.java:170) ~[qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.protocol.BlockingMethodFrameListener.blockForFrame(BlockingMethodFrameListener.java:115) ~[qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.protocol.AMQProtocolHandler.writeCommandFrameAndWaitForReply(AMQProtocolHandler.java:715) ~[qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.protocol.AMQProtocolHandler.syncWrite(AMQProtocolHandler.java:736) ~[qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.AMQSession_0_8.sendClose(AMQSession_0_8.java:255) ~[qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.AMQSession.close(AMQSession.java:758) ~[qpid-client-0.32.jar:0.32]
        ... 13 common frames omitted

ERROR Exception processing frame                                                                      [IoRcvr-/127.0.0.1:58728-localhost/127.0.0.1:5681][AMQProtocolHandler.java:512]
java.lang.NullPointerException: null
        at org.apache.qpid.client.protocol.AMQProtocolSession.confirmConsumerCancelled(AMQProtocolSession.java:412) ~[qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.handler.BasicCancelOkMethodHandler.methodReceived(BasicCancelOkMethodHandler.java:53) ~[qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.handler.ClientMethodDispatcherImpl.dispatchBasicCancelOk(ClientMethodDispatcherImpl.java:160) ~[qpid-client-0.32.jar:0.32]
        at org.apache.qpid.framing.BasicCancelOkBody.execute(BasicCancelOkBody.java:87) ~[qpid-common-0.32.jar:0.32]
        at org.apache.qpid.client.state.AMQStateManager.methodReceived(AMQStateManager.java:116) ~[qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.protocol.AMQProtocolHandler.methodBodyReceived(AMQProtocolHandler.java:539) [qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.protocol.AMQProtocolSession.methodFrameReceived(AMQProtocolSession.java:471) ~[qpid-client-0.32.jar:0.32]
        at org.apache.qpid.framing.AMQMethodBodyImpl.handle(AMQMethodBodyImpl.java:93) ~[qpid-common-0.32.jar:0.32]
        at org.apache.qpid.client.protocol.AMQProtocolHandler.received(AMQProtocolHandler.java:492) [qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.protocol.AMQProtocolHandler.received(AMQProtocolHandler.java:120) [qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.AMQConnectionDelegate_8_0$ReceiverClosedWaiter.received(AMQConnectionDelegate_8_0.java:538) [qpid-client-0.32.jar:0.32]
        at org.apache.qpid.client.AMQConnectionDelegate_8_0$ReceiverClosedWaiter.received(AMQConnectionDelegate_8_0.java:524) [qpid-client-0.32.jar:0.32]
        at org.apache.qpid.transport.network.io.IoReceiver.run(IoReceiver.java:163) [qpid-common-0.32.jar:0.32]
        at java.lang.Thread.run(Thread.java:724) [na:1.7.0_40]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13157922">QPID-8185</key>
            <summary>[JMS AMQP 0-x][AMQP 0-8..0-91] Make sure that client closes TCP connection on failure with sending connection.close and avoid spurious NPEs whilst awaiting channel closure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="orudyy">Alex Rudyy</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 May 2018 15:14:04 +0000</created>
                <updated>Sun, 20 May 2018 09:40:40 +0000</updated>
                            <resolved>Mon, 14 May 2018 09:12:51 +0000</resolved>
                                    <version>qpid-java-6.1.6</version>
                    <version>0.18</version>
                    <version>0.20</version>
                    <version>0.22</version>
                    <version>0.24</version>
                    <version>0.26</version>
                    <version>0.28</version>
                    <version>0.30</version>
                    <version>0.32</version>
                    <version>qpid-java-6.0.8</version>
                    <version>qpid-java-client-0-x-6.3.0</version>
                                    <fixVersion>qpid-java-client-0-x-6.3.1</fixVersion>
                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16470669" author="jira-bot" created="Thu, 10 May 2018 16:29:11 +0000"  >&lt;p&gt;Commit f89f6c2f45d11fc63551d0d61c17eceedd6bd247 in qpid-jms-amqp-0-x&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alex.rufous&quot; class=&quot;user-hover&quot; rel=&quot;alex.rufous&quot;&gt;alex.rufous&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms-amqp-0-x.git;h=f89f6c2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms-amqp-0-x.git;h=f89f6c2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-8185&quot; title=&quot;[JMS AMQP 0-x][AMQP 0-8..0-91] Make sure that client closes TCP connection on failure with sending connection.close and avoid spurious NPEs whilst awaiting channel closure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-8185&quot;&gt;&lt;del&gt;QPID-8185&lt;/del&gt;&lt;/a&gt;: &lt;span class=&quot;error&quot;&gt;&amp;#91;JMS AMQP 0-x&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;AMQP 0-8..0-91&amp;#93;&lt;/span&gt; Stop handling incoming frames on session after sending channel.close&lt;/p&gt;</comment>
                            <comment id="16470670" author="jira-bot" created="Thu, 10 May 2018 16:29:12 +0000"  >&lt;p&gt;Commit 983827591c27fd7d5d7289bbd9373a71728ba191 in qpid-jms-amqp-0-x&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alex.rufous&quot; class=&quot;user-hover&quot; rel=&quot;alex.rufous&quot;&gt;alex.rufous&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms-amqp-0-x.git;h=9838275&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms-amqp-0-x.git;h=9838275&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-8185&quot; title=&quot;[JMS AMQP 0-x][AMQP 0-8..0-91] Make sure that client closes TCP connection on failure with sending connection.close and avoid spurious NPEs whilst awaiting channel closure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-8185&quot;&gt;&lt;del&gt;QPID-8185&lt;/del&gt;&lt;/a&gt;: &lt;span class=&quot;error&quot;&gt;&amp;#91;JMS AMQP 0-x&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;AMQP 0-8..0-91&amp;#93;&lt;/span&gt; Make sure that client closes TCP connection on failure with sending connection.close&lt;/p&gt;</comment>
                            <comment id="16473947" author="k-wall" created="Mon, 14 May 2018 09:09:42 +0000"  >&lt;p&gt;Changes look reasonable to me.&lt;/p&gt;</comment>
                            <comment id="16473951" author="jira-bot" created="Mon, 14 May 2018 09:12:16 +0000"  >&lt;p&gt;Commit ca62a0c52b54c29681e8669a3fe8202300002d83 in qpid-jms-amqp-0-x&apos;s branch refs/heads/6.3.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alex.rufous&quot; class=&quot;user-hover&quot; rel=&quot;alex.rufous&quot;&gt;alex.rufous&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms-amqp-0-x.git;h=ca62a0c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms-amqp-0-x.git;h=ca62a0c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-8185&quot; title=&quot;[JMS AMQP 0-x][AMQP 0-8..0-91] Make sure that client closes TCP connection on failure with sending connection.close and avoid spurious NPEs whilst awaiting channel closure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-8185&quot;&gt;&lt;del&gt;QPID-8185&lt;/del&gt;&lt;/a&gt;: &lt;span class=&quot;error&quot;&gt;&amp;#91;JMS AMQP 0-x&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;AMQP 0-8..0-91&amp;#93;&lt;/span&gt; Stop handling incoming frames on session after sending channel.close&lt;/p&gt;

&lt;p&gt;Cherry-picked from f89f6c2f45d11fc63551d0d61c17eceedd6bd247&lt;/p&gt;</comment>
                            <comment id="16473952" author="jira-bot" created="Mon, 14 May 2018 09:12:17 +0000"  >&lt;p&gt;Commit 298fdbec8d72d31ed817ff74b4fd00dac11ba49a in qpid-jms-amqp-0-x&apos;s branch refs/heads/6.3.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alex.rufous&quot; class=&quot;user-hover&quot; rel=&quot;alex.rufous&quot;&gt;alex.rufous&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms-amqp-0-x.git;h=298fdbe&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms-amqp-0-x.git;h=298fdbe&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-8185&quot; title=&quot;[JMS AMQP 0-x][AMQP 0-8..0-91] Make sure that client closes TCP connection on failure with sending connection.close and avoid spurious NPEs whilst awaiting channel closure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-8185&quot;&gt;&lt;del&gt;QPID-8185&lt;/del&gt;&lt;/a&gt;: &lt;span class=&quot;error&quot;&gt;&amp;#91;JMS AMQP 0-x&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;AMQP 0-8..0-91&amp;#93;&lt;/span&gt; Make sure that client closes TCP connection on failure with sending connection.close&lt;/p&gt;

&lt;p&gt;Cherry picked from 983827591c27fd7d5d7289bbd9373a71728ba191&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12922673" name="0001-QPID-8185-JMS-AMQP-0-x-AMQP-0-8.0-91-Stop-handling-i.patch" size="6037" author="orudyy" created="Wed, 9 May 2018 17:45:12 +0000"/>
                            <attachment id="12922674" name="0002-QPID-8185-JMS-AMQP-0-x-AMQP-0-8.0-91-Make-sure-that-.patch" size="12631" author="orudyy" created="Wed, 9 May 2018 17:45:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3th3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>