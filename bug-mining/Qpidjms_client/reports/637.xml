<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:23:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-7898] [Java 0-8...0-9-1 Client] Calling getJMSReplyTo on a received message can lead to NullPointerException</title>
                <link>https://issues.apache.org/jira/browse/QPID-7898</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;A call to &lt;tt&gt;Message#getJMSReplyTo()&lt;/tt&gt; can lead to a &lt;tt&gt;NullPointerException&lt;/tt&gt;.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.NullPointerException
	at org.apache.qpid.client.message.AMQMessageDelegate_0_8.getJMSReplyTo(AMQMessageDelegate_0_8.java:301)
	at org.apache.qpid.client.message.AbstractJMSMessage.getJMSReplyTo(AbstractJMSMessage.java:104)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The circumstances are&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;a Message received over AMQP 0-8...0-9-1&lt;/li&gt;
	&lt;li&gt;the replyTo set to a non-BURL address not containing a slash (&quot;/&quot;)&lt;/li&gt;
	&lt;li&gt;the address must not exist in the org.apache.qpid.client.message.AMQMessageDelegate_0_8#_destinationCache&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The code throwing the NPE:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;AMQMessageDelegate_0_8#getJMSReplyTo (slightly edited for clarity)&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Destination getJMSReplyTo() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; JMSException
{
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; replyToEncoding = getContentHeaderProperties().getReplyToAsString();
    Destination dest;
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        BindingURL binding = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AMQBindingURL(replyToEncoding);
        &lt;span class=&quot;code-comment&quot;&gt;// something &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
&lt;/span&gt;    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (URISyntaxException e) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (replyToEncoding.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;)) {
            &lt;span class=&quot;code-comment&quot;&gt;// something
&lt;/span&gt;        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (replyToEncoding.contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;)) {
            &lt;span class=&quot;code-comment&quot;&gt;// something
&lt;/span&gt;        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (getAMQSession().isQueueBound(replyToEncoding, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)) {
            &lt;span class=&quot;code-comment&quot;&gt;// THE ABOVE CALL TO getAMQSession THROWS A NPE!!!
&lt;/span&gt;        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            &lt;span class=&quot;code-comment&quot;&gt;// something
&lt;/span&gt;        }
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; dest;
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The root cause seems to be that we are relying on the Message having knowledge of the session but we aren&apos;t setting the Session on the Message on all code paths.&lt;/p&gt;

&lt;p&gt;I encountered this testing message conversion.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13097275">QPID-7898</key>
            <summary>[Java 0-8...0-9-1 Client] Calling getJMSReplyTo on a received message can lead to NullPointerException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kwall">Keith Wall</assignee>
                                    <reporter username="lorenz.quack">Lorenz Quack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Aug 2017 09:29:16 +0000</created>
                <updated>Wed, 2 Oct 2019 19:22:21 +0000</updated>
                            <resolved>Wed, 15 Nov 2017 14:43:03 +0000</resolved>
                                                    <fixVersion>qpid-java-client-0-x-6.3.0</fixVersion>
                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16244276" author="lorenz.quack" created="Wed, 8 Nov 2017 16:38:32 +0000"  >&lt;p&gt;Fun fact: if this problem is solved the next one pops right out: All calls to the &lt;tt&gt;NonBURLReplyToDestination&lt;/tt&gt; constructor fail in &lt;tt&gt;AMQDestination:381&lt;/tt&gt; because we pass in &lt;tt&gt;null&lt;/tt&gt; as the &lt;tt&gt;exchangeClass&lt;/tt&gt; in &lt;tt&gt;AMQMessageDelegate_0_8.NonBURLReplyToDestination#NonBURLReplyToDestination&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16251757" author="jira-bot" created="Tue, 14 Nov 2017 17:11:44 +0000"  >&lt;p&gt;Commit ae6d79d38334127039e2d62826d9c441f60f1659 in qpid-jms-amqp-0-x&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwall&quot; class=&quot;user-hover&quot; rel=&quot;kwall&quot;&gt;kwall&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms-amqp-0-x.git;h=ae6d79d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms-amqp-0-x.git;h=ae6d79d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-7898&quot; title=&quot;[Java 0-8...0-9-1 Client] Calling getJMSReplyTo on a received message can lead to NullPointerException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-7898&quot;&gt;&lt;del&gt;QPID-7898&lt;/del&gt;&lt;/a&gt;: &lt;span class=&quot;error&quot;&gt;&amp;#91;Qpid JMS AMQP 0-x&amp;#93;&lt;/span&gt; Prevent possibilities of NPEs when 0-8 path parses a reply-to address that is not BURL formatted&lt;/p&gt;</comment>
                            <comment id="16253341" author="alex.rufous" created="Wed, 15 Nov 2017 12:04:44 +0000"  >&lt;p&gt;The implemented changes in &lt;tt&gt;AMQMessageDelegate_0_8#getJMSReplyTo&lt;/tt&gt; make assumption that for non-BURL destination the exchange type is &lt;tt&gt;direct&lt;/tt&gt;. That could lead to connection close when the real exchange type is not &lt;tt&gt;direct&lt;/tt&gt; and on sending a reply into the destination the client would attempt to re-declare the exchange (which is a default behavior). The broker side validation of exchange type will close the connection with error &quot;not-allowed&quot;. I am wondering whether we can mark &lt;tt&gt;NonBURLReplyToDestination&lt;/tt&gt; as not requiring exchange/queue re-declaration &lt;tt&gt;neverDeclare&lt;/tt&gt; in order to avoid running into connection close due to exchange type mismatch. We need to add a check for &lt;tt&gt;neverDeclare&lt;/tt&gt; into &lt;tt&gt;BasicMessageProducer#validateDestination&lt;/tt&gt;. Though, it might lead to reply message loss if destination does not exist. Potentially,  &lt;tt&gt;BasicMessageProducer#validateDestination&lt;/tt&gt; can check for existence for destinations with  &lt;tt&gt;neverDeclare&lt;/tt&gt;=&lt;tt&gt;true&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16253489" author="jira-bot" created="Wed, 15 Nov 2017 14:07:20 +0000"  >&lt;p&gt;Commit 9aea5431ebad90e2f64710ba704d721ca8a0a48e in qpid-jms-amqp-0-x&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwall&quot; class=&quot;user-hover&quot; rel=&quot;kwall&quot;&gt;kwall&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-jms-amqp-0-x.git;h=9aea543&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-jms-amqp-0-x.git;h=9aea543&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-7898&quot; title=&quot;[Java 0-8...0-9-1 Client] Calling getJMSReplyTo on a received message can lead to NullPointerException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-7898&quot;&gt;&lt;del&gt;QPID-7898&lt;/del&gt;&lt;/a&gt;: Address review feedback from Alex Rudyy &amp;lt;orudyy@apache.org&amp;gt;&lt;/p&gt;</comment>
                            <comment id="16253542" author="alex.rufous" created="Wed, 15 Nov 2017 14:43:03 +0000"  >&lt;p&gt;Changes look reasonable to me&lt;/p&gt;</comment>
                            <comment id="16462328" author="jira-bot" created="Thu, 3 May 2018 11:56:14 +0000"  >&lt;p&gt;Commit 78f5671f2b87a11404d0d8d8521dd6c2b02da3ff in qpid-broker-j&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwall&quot; class=&quot;user-hover&quot; rel=&quot;kwall&quot;&gt;kwall&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=qpid-broker-j.git;h=78f5671&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=qpid-broker-j.git;h=78f5671&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;NO-JIRA: Remove test exclusion related to &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-7898&quot; title=&quot;[Java 0-8...0-9-1 Client] Calling getJMSReplyTo on a received message can lead to NullPointerException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-7898&quot;&gt;&lt;del&gt;QPID-7898&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 28 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3j8fj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>