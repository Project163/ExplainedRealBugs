<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:22:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-5420] Creating consumer for Destination specifying the no-name exchange in binding url syntax fails against Java Broker.</title>
                <link>https://issues.apache.org/jira/browse/QPID-5420</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;If when using the Java Broker, I try to consume from a Destination specified by a binding url, where the exchange part is empty (signifying the no-name exchange)&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;destination.sub1 = direct:////sub1?durable=&apos;true&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;, then I see an exception:&lt;/p&gt;

&lt;p&gt;On the client I see the following as the Java Broker closes the connection:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; org.apache.qpid.AMQDisconnectedException: Server closed connection and reconnection not permitted.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On the broker, I see the following logged:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-12-13 10:05:43,602 ERROR [IoReceiver - /127.0.0.1:49532] (v0_8.AMQProtocolEngine) - Unexpected exception while processing frame.  Closing connection.
org.apache.qpid.AMQException: Exchange exchange must not be null
	at org.apache.qpid.server.protocol.v0_8.handler.ExchangeBoundHandler.methodReceived(ExchangeBoundHandler.java:89)
	at org.apache.qpid.server.protocol.v0_8.handler.ServerMethodDispatcherImpl.dispatchExchangeBound(ServerMethodDispatcherImpl.java:458)
	at org.apache.qpid.framing.amqp_0_9.ExchangeBoundBodyImpl.execute(ExchangeBoundBodyImpl.java:130)
	at org.apache.qpid.server.protocol.v0_8.state.AMQStateManager.methodReceived(AMQStateManager.java:120)
	at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine.methodFrameReceived(AMQProtocolEngine.java:578)
	at org.apache.qpid.framing.AMQMethodBodyImpl.handle(AMQMethodBodyImpl.java:97)
	at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine.frameReceived(AMQProtocolEngine.java:442)
	at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine.dataBlockReceived(AMQProtocolEngine.java:365)
	at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine.received(AMQProtocolEngine.java:286)
	at org.apache.qpid.server.protocol.v0_8.AMQProtocolEngine.received(AMQProtocolEngine.java:104)
	at org.apache.qpid.server.protocol.MultiVersionProtocolEngine.received(MultiVersionProtocolEngine.java:131)
	at org.apache.qpid.server.protocol.MultiVersionProtocolEngine.received(MultiVersionProtocolEngine.java:47)
	at org.apache.qpid.transport.network.io.IoReceiver.run(IoReceiver.java:161)
	at java.lang.Thread.run(Thread.java:744)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="12684443">QPID-5420</key>
            <summary>Creating consumer for Destination specifying the no-name exchange in binding url syntax fails against Java Broker.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="robbie">Robbie Gemmell</assignee>
                                    <reporter username="kwall">Keith Wall</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Dec 2013 10:57:21 +0000</created>
                <updated>Wed, 2 Oct 2019 19:21:29 +0000</updated>
                            <resolved>Tue, 7 Jan 2014 18:43:24 +0000</resolved>
                                    <version>0.24</version>
                    <version>0.26</version>
                                    <fixVersion>0.27</fixVersion>
                                    <component>Broker-J</component>
                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13847409" author="k-wall" created="Fri, 13 Dec 2013 11:03:19 +0000"  >&lt;p&gt;This regression was caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-4897&quot; title=&quot;[Java Broker] Allow selectors on bindings for exchanges other than topic exchanges&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-4897&quot;&gt;&lt;del&gt;QPID-4897&lt;/del&gt;&lt;/a&gt;.  The new call to #isBound is failing Broker side, as the ExchangeBoundHandler rejects the null exchange argument.&lt;/p&gt;

&lt;p&gt;The client side call is as follows:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;if(!isBound(amqd.getExchangeName(), amqd.getAMQQueueName(), amqd.getRoutingKey()))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13847456" author="k-wall" created="Fri, 13 Dec 2013 12:56:12 +0000"  >&lt;p&gt;n.b these were my initial thoughts. I took a different route after more investigation.  &lt;/p&gt;

&lt;p&gt;I think that:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Java client - AMQSession#registerConsumer should be changed so that if a BURL specifies the the no-name exchange (that is amqd.getExchangeName() yields &quot;&quot;), the code should omit the isBound/bindQueue steps.  The no-name exchange is not allowed to accept arbitrary bindings so the client should not try to add them.&lt;/li&gt;
	&lt;li&gt;Java client - AMQSession add a system property switch (much like qpid.declare_queues/qpid.declare_exchanges) that allows the bind queue behaviour to be turned off.&lt;/li&gt;
	&lt;li&gt;Java Broker - There is no guidance in the AMQP spec (0-9 or 0-9-1) as to whether the  exchange.bound (qpid specific extension) should allow queries against the no-name exchange.  In order to maximise compatibility between different Qpid Broker/Clients, I think ExchangeBoundHandler should be changed to interpret a null exchange argument as signifying the no-name exchange and return a bound-ok response accordingly.&lt;/li&gt;
&lt;/ol&gt;

</comment>
                            <comment id="13862637" author="k-wall" created="Sun, 5 Jan 2014 19:29:14 +0000"  >&lt;p&gt;I&apos;ve taken a closer look at this defect.  I can see that the behaviour when publishing/consuming using a BURL specifying the default exchange has changed a number of times over recent releases.  I&apos;ve summarised the behaviour in the table below:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;release&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;system property qpid.declare_exchanges&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;0-10&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;0-9&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;trunk&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;true&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fails *1 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fails *1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;trunk&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;false&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; functions #2 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;fails *3 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.24&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;true&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fails *1 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fails *1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.24&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;false&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; functions #2 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fails *3 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.22&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;true&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fails *2 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; functions #1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.20&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;true&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;fails *2 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; functions #1 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0.18&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;true&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; fails *2 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; functions #1 &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;*1 = Fails, Attempt to declare exchange:  which begins with reserved name or prefix.&lt;br/&gt;
*2 = Fails, Bind not allowed for default exchange&lt;br/&gt;
*3 = Fails, Error sending exchange bound, (broker fails with &quot;Exchange exchange must not be null&quot; and closes connection).&lt;/p&gt;

&lt;p&gt;#1 = Functions, but received message has JMSDestination = direct://&amp;lt;&amp;lt;default&amp;gt;&amp;gt;/myqueue/myqueue?routingkey=&apos;my queue&apos;&lt;br/&gt;
#2 = Functions, but received message has JMSDestination = :///myqueue/myqueue?routingkey=&apos;my queue&apos;&lt;/p&gt;

&lt;p&gt;In other words, for 0-9:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Publishing/consuming with BURL with default exchange worked &amp;lt;= 0.22.&lt;/li&gt;
	&lt;li&gt;At 0.24/trunk, &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-4897&quot; title=&quot;[Java Broker] Allow selectors on bindings for exchanges other than topic exchanges&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-4897&quot;&gt;&lt;del&gt;QPID-4897&lt;/del&gt;&lt;/a&gt; changed the client to send exchange.bound, but unfortunately, the Java Broker (0-8..0-9-1 path fails with a NPE (ExchangeBoundHandler.java) if exchange.bound queries the default exchange (error - *3).  Also &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-4973&quot; title=&quot;[Java Broker] Refactor DurableConfigurationStore interface to be in terms of ConfiguredObject rather than implementation classes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-4973&quot;&gt;&lt;del&gt;QPID-4973&lt;/del&gt;&lt;/a&gt;, changed the Broker (AbstractVirtualHost.java) to mean that attempts to actively declare the default exchange fail (error - *1)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;For 0-10:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Publishing/consuming with BURL with default exchange failed &amp;lt;= 0.22 (error - *2).&lt;/li&gt;
	&lt;li&gt;At 0.24/trunk changes to client ( &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-4897&quot; title=&quot;[Java Broker] Allow selectors on bindings for exchanges other than topic exchanges&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-4897&quot;&gt;&lt;del&gt;QPID-4897&lt;/del&gt;&lt;/a&gt;) means that client no longer tries to bind to the default exchange, so Publishing/consuming with BURL with default exchange works if qpid.declare_exchanges is false.  If qpid.declare_exchanges is true, like 0-9, it fails (error - *1)&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="13862665" author="k-wall" created="Sun, 5 Jan 2014 21:46:06 +0000"  >&lt;p&gt;Hi Robbie,&lt;/p&gt;

&lt;p&gt;Would you mind taking a look at the attached patch to resolve this issue?  The commit message should explain my reasoning.  Thanks. Keith&lt;/p&gt;</comment>
                            <comment id="13862977" author="gemmellr" created="Mon, 6 Jan 2014 13:19:59 +0000"  >&lt;p&gt;Looks good to me.&lt;/p&gt;</comment>
                            <comment id="13864462" author="jira-bot" created="Tue, 7 Jan 2014 17:59:20 +0000"  >&lt;p&gt;Commit 1556292 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwall&quot; class=&quot;user-hover&quot; rel=&quot;kwall&quot;&gt;kwall&lt;/a&gt; in branch &apos;qpid/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1556292&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1556292&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-5420&quot; title=&quot;Creating consumer for Destination specifying the no-name exchange in binding url syntax fails against Java Broker.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-5420&quot;&gt;&lt;del&gt;QPID-5420&lt;/del&gt;&lt;/a&gt;: Restore ability to consume using BURLs specifying default exchange.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Java Broker: Changed AbstractVirtualHost so that createExchange throws ExchangeExistException before checking for a reserved exchnage name.  The effect will be that the Java Broker will again accept active declaration of the built in exchanges (amq.&lt;b&gt;, qpid.&lt;/b&gt; and default).&lt;/li&gt;
	&lt;li&gt;Java Broker: Changed the 0-8..0-9-1 ExchangeBoundHandler so that a null exchnage name is treated to mean the default exchange.  This matches the behaviour of ServerSessionDelegate#exchangeBound() on the 0-10 path.  This allows the Java client to query bindings on the default exchange.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Client: Changed AbstractAMQMessageDelegate.java so that 0-10 knows the type of the default exchange when populating the JMSDestination on received messages.&lt;/li&gt;
	&lt;li&gt;Client: Introduced system property qpid.bind_queues system property so that the exchange/queue bind side effect can be suppressed on consumer creation.  Like qid.declare_exchanges and declare_queues, this system propery has effect when using BURLs. Might be useful if using a new client with older broker.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Added new system tests.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13864463" author="k-wall" created="Tue, 7 Jan 2014 17:59:41 +0000"  >&lt;p&gt;Patch applied.&lt;/p&gt;</comment>
                            <comment id="13864518" author="jira-bot" created="Tue, 7 Jan 2014 18:42:45 +0000"  >&lt;p&gt;Commit 1556307 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwall&quot; class=&quot;user-hover&quot; rel=&quot;kwall&quot;&gt;kwall&lt;/a&gt; in branch &apos;qpid/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1556307&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1556307&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-5420&quot; title=&quot;Creating consumer for Destination specifying the no-name exchange in binding url syntax fails against Java Broker.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-5420&quot;&gt;&lt;del&gt;QPID-5420&lt;/del&gt;&lt;/a&gt;: &lt;span class=&quot;error&quot;&gt;&amp;#91;Documentation&amp;#93;&lt;/span&gt; Add documentation to the JMS-Client-0-8 docbook for new system property qpid.bind_queues&lt;/p&gt;</comment>
                            <comment id="14016693" author="justi9" created="Tue, 3 Jun 2014 15:34:58 +0000"  >&lt;p&gt;Released in Qpid 0.28, &lt;a href=&quot;http://qpid.apache.org/releases/qpid-0.28/index.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://qpid.apache.org/releases/qpid-0.28/index.html&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12650469">QPID-4897</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12648871">QPID-4877</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12621536" name="0001-QPID-5420-Restore-ability-to-consume-using-BURLs-spe.patch" size="24242" author="kwall" created="Sun, 5 Jan 2014 21:43:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>363515</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 24 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1qnrz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>363821</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>