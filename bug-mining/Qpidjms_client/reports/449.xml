<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:21:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-3605] Durable subscriber with no-local true receives messages on re-connection</title>
                <link>https://issues.apache.org/jira/browse/QPID-3605</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;If a durable subscriber using no-local true reconnects to the Java Broker, it receives all messages that publisher on same connection previously sent.  This defect is present on all code paths (0-8..0-10)&lt;/p&gt;

&lt;p&gt;See tests:&lt;br/&gt;
(Java) org.apache.qpid.test.unit.topic.DurableSubscriptionTest#testNoLocalOnConnection&lt;br/&gt;
(Python) qpid_tests.broker_0_10.message.MessageTests.test_no_local_awkward&lt;/p&gt;

&lt;p&gt;This defect does not manifest itself on the CPP Broker, as the CPP broker drops these messages.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12530987">QPID-3605</key>
            <summary>Durable subscriber with no-local true receives messages on re-connection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="robbie">Robbie Gemmell</assignee>
                                    <reporter username="kwall">Keith Wall</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Nov 2011 11:56:04 +0000</created>
                <updated>Wed, 2 Oct 2019 19:22:02 +0000</updated>
                            <resolved>Thu, 1 Mar 2012 00:02:43 +0000</resolved>
                                    <version>0.15</version>
                                    <fixVersion>0.15</fixVersion>
                                    <component>Broker-J</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13206593" author="gemmellr" created="Mon, 13 Feb 2012 00:42:50 +0000"  >&lt;p&gt;When undertaking &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-3829&quot; title=&quot;[Java broker] no-local checking for published messages can prevent 0-8/0-9/0-9-1 connections being garbage collected after they are closed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-3829&quot;&gt;&lt;del&gt;QPID-3829&lt;/del&gt;&lt;/a&gt; the changes made also stopped an NPE on the 0-8/0-9/0-9-1 subscriptions when evaluating no-local after store recovery, allowing NoLocalAfterRecoveryTest to be enabled again (though updated to make it simpler and more reliable.) If this JIRA is undertaken, that test will need updated to ensure that messages the client &lt;b&gt;should&lt;/b&gt; have got (then excluding the ones that wouldnt have matched the no-local check when they were actually publsihed) but didnt before the broker restarted were successfully delivered afer a new no-local connection was established.&lt;/p&gt;</comment>
                            <comment id="13218681" author="rgodfrey" created="Tue, 28 Feb 2012 23:14:38 +0000"  >&lt;p&gt;I&apos;ve updated the client/broker so that the binding between the queue and the exchange contains the argument x-qpid-no-local.  The topic exchange treats this as a special type of filter, excluding messages which have arrived on the same connection that &quot;owns&quot; the queue&lt;/p&gt;</comment>
                            <comment id="13218684" author="rgodfrey" created="Tue, 28 Feb 2012 23:16:55 +0000"  >&lt;p&gt;Robbie - could you review - thx&lt;/p&gt;</comment>
                            <comment id="13219621" author="gemmellr" created="Wed, 29 Feb 2012 22:42:04 +0000"  >&lt;p&gt;TopicExchange.createSelectorFilter() now does more than creating selector filter, it should be renamed for clarity. There are a load of if statements without any braces.&lt;/p&gt;

&lt;p&gt;I think it would be good if the test published some messages on a different connection that the no-local subscriber &lt;b&gt;could&lt;/b&gt; get but deliberately doesnt retrieve before the broker restart, just to ensure they do get delivered after the restart and reconnection.&lt;/p&gt;

&lt;p&gt;As discussed in person earlier, the additional then removal of no-local (or vice versa) will interact with the selector change verification code and provoke an unsubscribe (queue-delete) at reconnect, but we think that is reaosnable enough.&lt;/p&gt;</comment>
                            <comment id="13219648" author="rgodfrey" created="Wed, 29 Feb 2012 23:25:58 +0000"  >&lt;p&gt;Agreed on the naming...&lt;/p&gt;

&lt;p&gt;On the test... I did consider doing that at the time and then got lazy &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  I shall add now ...&lt;/p&gt;

&lt;p&gt;Now there is the &quot;fun&quot; case that if you create a durable sub on connection A, send messages from connection B, close connection A, resubscribe on Connection B then consume... you won&apos;t see the messages (due to no-local at the sub) but they will be on the queue... and if you close connection B and then resubscribe on connection C, you will get them... I think the C++ broker behaviour will differ here.&lt;/p&gt;

&lt;p&gt;Essentially the Java broker is going to treat no-local as &quot;if, at the time the message was published, the publisher and subscriber were not the same, then queue the message.  Also for any messages in the queue, do not deliver to the connection if the message was published on the connection&quot;.  The C++, in contrast, appears to say at the queue &quot;if the message is the from the same connection as my current subscriber... then throw the message away&quot;.&lt;/p&gt;</comment>
                            <comment id="13219665" author="rgodfrey" created="Wed, 29 Feb 2012 23:49:46 +0000"  >&lt;p&gt;Robbie - believe your comments are addressed now...&lt;/p&gt;</comment>
                            <comment id="13219669" author="gemmellr" created="Thu, 1 Mar 2012 00:02:43 +0000"  >&lt;p&gt;Looks good, resolving. (Ok, I actually noticed a problem with a comment in the original test now being inaccurate, but it seemed quicker jsut to fix it myself &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/tongue.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;/p&gt;</comment>
                            <comment id="14235456" author="jira-bot" created="Fri, 5 Dec 2014 13:06:41 +0000"  >&lt;p&gt;Commit 1643264 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwall&quot; class=&quot;user-hover&quot; rel=&quot;kwall&quot;&gt;kwall&lt;/a&gt; in branch &apos;qpid/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1643264&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1643264&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;NO-JIRA: Remove exclusion related to &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-3605&quot; title=&quot;Durable subscriber with no-local true receives messages on re-connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-3605&quot;&gt;&lt;del&gt;QPID-3605&lt;/del&gt;&lt;/a&gt;. Looks like this was fixed long ago.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>216725</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 50 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0bh7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>64901</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>