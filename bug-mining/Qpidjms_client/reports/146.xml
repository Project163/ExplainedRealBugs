<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:20:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-895] FailoverSingleServer delays on first connection.</title>
                <link>https://issues.apache.org/jira/browse/QPID-895</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;Summary:&lt;br/&gt;
_currentRetries is -1 on first connection but at the delay point in getNextBroker it has already been incremented.&lt;/p&gt;

&lt;p&gt;I&apos;m sure the code was supposed to incorrectly say &apos;-1&apos; rather than &apos;1&apos; but both of those are wrong. We want to delay on all subsequent connection attempts which means &apos;&amp;gt; 0&apos;. &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (delayStr != null &amp;amp;&amp;amp; _currentRetries != 1)&lt;br/&gt;
+       if (delayStr != null &amp;amp;&amp;amp; _currentRetries &amp;gt; 0)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;So this should fix the issue. A work around is to use two brokers in the URL with their own connectdelay that way it will use the RoundRobin Method which doesn&apos;t have this bug.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12392916">QPID-895</key>
            <summary>FailoverSingleServer delays on first connection.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ritchiem">Martin Ritchie</assignee>
                                    <reporter username="ritchiem">Martin Ritchie</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Apr 2008 09:43:23 +0000</created>
                <updated>Tue, 14 Mar 2017 20:02:00 +0000</updated>
                            <resolved>Wed, 23 Jul 2008 14:54:37 +0000</resolved>
                                    <version>M2.1</version>
                    <version>M3</version>
                                    <fixVersion>M3</fixVersion>
                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="12592771" author="senakafdo" created="Mon, 28 Apr 2008 08:56:20 +0000"  >&lt;p&gt;Hi Martin,&lt;/p&gt;

&lt;p&gt;I&apos;m in the process of providing a patch for this issue. But, I have several other questions.&lt;/p&gt;

&lt;p&gt;1. failoverAllowed() method&lt;/p&gt;

&lt;p&gt;say, _currentRetries == -1, and _retries == 0. This would misinterpret that failover is allowed, if, getNextBrokerDetails() wasn&apos;t called once. Is this correct?&lt;/p&gt;

&lt;p&gt;2. I have second thoughts on the message logged at the InterruptedException.&lt;br/&gt;
            try&lt;/p&gt;
            {

                Thread.sleep(delay);
            }
&lt;p&gt;            catch (InterruptedException ie)&lt;/p&gt;
            {
                _logger.info(&quot;No delay between connect retries, use tcp://host:port?connectdelay=&apos;value&apos; to enable.&quot;);
                return null;
            }

&lt;p&gt;This is caused if another thread interrupts this thread. And, when we get to this point, we do have a decent value for delay. Which would suggest that perhaps someone set a connectdelay. So is this correct?&lt;/p&gt;

&lt;p&gt;I&apos;m new to the Qpid project, therefore I might have misunderstood some. And, if so my apologies.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Senaka&lt;/p&gt;</comment>
                            <comment id="12593762" author="ritchiem" created="Fri, 2 May 2008 12:11:05 +0000"  >&lt;p&gt;Sorry Senaka, I didn&apos;t see your response here. My JIRA mail is currently poorly filtered as we have historically been very bad at communicating via JIRA.&lt;br/&gt;
Good to see someone actually commenting on JIRAs.&lt;/p&gt;

&lt;p&gt;Your patch is ideal.. and I&apos;ll commit it just as soon as svn allows me to.&lt;/p&gt;

&lt;p&gt;1.&lt;br/&gt;
Both the FailoverMethods (RoundRobin and Single) are quite weak:&lt;br/&gt;
They have side effects on calling failoverAllowed(). &lt;br/&gt;
They are dependant on calling attainedConnection()&lt;/p&gt;

&lt;p&gt;The RoundRobin requires that getNextBrokerDetails() to be called before getCurrentBrokerDetails() will return a value.&lt;/p&gt;

&lt;p&gt;2. If you look at FailoverRoundRobinServer you will see how it should be.. the FSS clearly was incomplete when it was checked in. Sorry about that, I shall correct it.&lt;/p&gt;

&lt;p&gt;I&apos;m sure there has to be a better way of doing this work.&lt;/p&gt;

&lt;p&gt;Retry logic should probably be separate from Failover.&lt;br/&gt;
Especially as I don&apos;t think you can set retries to 0. It will always retry once, see &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-208&quot; title=&quot;Failover broker retry doesn&amp;#39;t work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-208&quot;&gt;&lt;del&gt;QPID-208&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12593772" author="senakafdo" created="Fri, 2 May 2008 13:13:04 +0000"  >&lt;p&gt;Hi Martin,&lt;/p&gt;

&lt;p&gt;While discussing with Rajith it seems that the first retry is not a retry but the try rather. So retries = 0 will only TRY and not RETRY.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Senaka&lt;/p&gt;</comment>
                            <comment id="12616079" author="ritchiem" created="Wed, 23 Jul 2008 14:54:37 +0000"  >&lt;p&gt;Patch applied. on Trunk&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12383114">QPID-690</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12381025" name="FailoverSingleServer.patch.txt" size="698" author="senakafdo" created="Mon, 28 Apr 2008 10:32:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>167877</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 18 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0bxw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>67603</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>