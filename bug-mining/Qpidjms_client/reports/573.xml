<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:22:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-6518] Cyclic errors on thread interruption thru resetting interrupted flag</title>
                <link>https://issues.apache.org/jira/browse/QPID-6518</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;When i attempt undeploy application caused backgroundProcess.interrupt() in OurBean.java:72, sometimes may occur InterruptedException in BasicMessageConsumer.receive(). It resets interrupted flag of thread that resulting cyclic errors because thread is not interrupted.&lt;/p&gt;</description>
                <environment>&lt;p&gt;WildFly 8.2.0.Final, RabbitMQ 3.5.1, Windows 8 amd64&lt;/p&gt;</environment>
        <key id="12825950">QPID-6518</key>
            <summary>Cyclic errors on thread interruption thru resetting interrupted flag</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="rgodfrey">Robert Godfrey</assignee>
                                    <reporter username="nikit.cpp">Nikita Konev</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Apr 2015 13:29:28 +0000</created>
                <updated>Fri, 15 May 2015 15:29:00 +0000</updated>
                            <resolved>Fri, 15 May 2015 15:29:00 +0000</resolved>
                                    <version>0.32</version>
                                                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="7200">2h</timeoriginalestimate>
                            <timeestimate seconds="7200">2h</timeestimate>
                                        <comments>
                            <comment id="14521305" author="jira-bot" created="Thu, 30 Apr 2015 10:43:24 +0000"  >&lt;p&gt;Commit 1676956 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfrer&quot; class=&quot;user-hover&quot; rel=&quot;godfrer&quot;&gt;godfrer&lt;/a&gt; in branch &apos;java/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1676956&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1676956&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-6518&quot; title=&quot;Cyclic errors on thread interruption thru resetting interrupted flag&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-6518&quot;&gt;&lt;del&gt;QPID-6518&lt;/del&gt;&lt;/a&gt; : Reduce the likelihood of spurious interrupts being propogated to threds calling receive()&lt;/p&gt;</comment>
                            <comment id="14521320" author="rgodfrey" created="Thu, 30 Apr 2015 10:57:31 +0000"  >&lt;p&gt;Looking at your code, I&apos;m not sure it is really necessary to call interrupt() in destroy() as simply calling connection.close() should ensure that the loop terminates (since calling close will cause blocking receives to immediately return).  &lt;/p&gt;

&lt;p&gt;As you observe, calling close() causes interrupts to occur (to stop the client code waiting forever for a new message to arrive), it&apos;s not clear to me that there is an easy way to ensure that a spurious interrupt caused by this logic &lt;b&gt;never&lt;/b&gt; leaks out to the calling code, however we can greatly reduce the possibility.  Rather than looping on &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (! (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().isInterrupted()))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;perhaps you could add a &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; destroyed; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;field to your bean, loop on &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;(!destroyed)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and set destroyed to true in your destroy() method?&lt;/p&gt;</comment>
                            <comment id="14521889" author="nikit.cpp" created="Thu, 30 Apr 2015 17:21:40 +0000"  >&lt;p&gt;Thank you for responce!&lt;/p&gt;

&lt;p&gt;&quot;Rather than looping on &quot;&lt;br/&gt;
Unfortunately, this is our business logic. Sad but true.&lt;/p&gt;

&lt;p&gt;I tested your revision 1676956, but it not resolves my troubles.&lt;br/&gt;
According to our business logic, should to save setted state of interrupted flag.&lt;br/&gt;
And why in filally statement?&lt;/p&gt;

&lt;p&gt;Please, see attached BasicMessageConsumer.java:458 - there I writed code that works und undeploys fine &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="14522254" author="rgodfrey" created="Thu, 30 Apr 2015 20:59:37 +0000"  >&lt;p&gt;The problem with the approach you&apos;ve taken in BasicMessageConsumer is that for other use cases (dare I say the common one), where no-one else is calling interrupt on the thread, the act of closing the connection from another thread will now cause them see the Thread as interrupted  since the interrupted flag caused by the act of closing will now not be cleared.  &lt;/p&gt;

&lt;p&gt;If you are relying on the interrupted state being set, can you not set it yourself in the case where receive() returns null (i.e. do Thread.currentThread().interrupt() there)?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12729534" name="BasicMessageConsumer.java" size="35062" author="nikit.cpp" created="Thu, 30 Apr 2015 17:11:59 +0000"/>
                            <attachment id="12729169" name="OurBean.java" size="2160" author="nikit.cpp" created="Wed, 29 Apr 2015 13:38:11 +0000"/>
                            <attachment id="12729173" name="wildfly-log.txt" size="2480" author="nikit.cpp" created="Wed, 29 Apr 2015 13:43:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 29 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2e2xb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>