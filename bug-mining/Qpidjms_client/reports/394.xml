<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:21:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[QPID-2901] A number of tests sporadically fails with 0.10 profiles on attempt to commit transaction due to exception in org.apache.qpid.transport.Session#sync</title>
                <link>https://issues.apache.org/jira/browse/QPID-2901</link>
                <project id="12310520" key="QPID">Qpid</project>
                    <description>&lt;p&gt;The following stack trace is printed for failed commit&lt;/p&gt;

&lt;p&gt;org.apache.qpid.transport.SessionException: ch=0 id=0 ExecutionException(errorCode=INTERNAL_ERROR, commandId=13, description=Exception processing command: java.lang.RuntimeException: Failed to commit transaction)&lt;br/&gt;
	at org.apache.qpid.transport.Session.sync(Session.java:807)&lt;br/&gt;
	at org.apache.qpid.transport.Session.sync(Session.java:772)&lt;br/&gt;
	at org.apache.qpid.transport.Session.invoke(Session.java:732)&lt;br/&gt;
	at org.apache.qpid.transport.Session.invoke(Session.java:561)&lt;br/&gt;
	at org.apache.qpid.transport.SessionInvoker.txCommit(SessionInvoker.java:148)&lt;br/&gt;
	at org.apache.qpid.client.AMQSession_0_10.sendCommit(AMQSession_0_10.java:423)&lt;br/&gt;
	at org.apache.qpid.client.AMQSession_0_10.commit(AMQSession_0_10.java:1008)&lt;br/&gt;
	at org.apache.qpid.systest.TestingBaseCase$1.run(TestingBaseCase.java:105)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;

&lt;p&gt;This is the list of failing tests:&lt;br/&gt;
org.apache.qpid.systest.SubscriptionTest#testTopicDurableConsumerMessageAge&lt;br/&gt;
org.apache.qpid.systest.SubscriptionTest#testTopicDurableConsumerMessageCount&lt;br/&gt;
org.apache.qpid.systest.TopicTest#org.apache.qpid.systest.TopicTest &lt;br/&gt;
org.apache.qpid.systest.TopicTest#testTopicDurableConsumerMessageAge&lt;br/&gt;
org.apache.qpid.systest.GlobalQueuesTest#testTopicDurableConsumerMessageAge&lt;br/&gt;
org.apache.qpid.systest.GlobalTopicsTest#testTopicDurableConsumerMessageSize&lt;br/&gt;
org.apache.qpid.systest.GlobalTopicsTest#testTopicDurableConsumerMessageAge&lt;/p&gt;</description>
                <environment></environment>
        <key id="12477144">QPID-2901</key>
            <summary>A number of tests sporadically fails with 0.10 profiles on attempt to commit transaction due to exception in org.apache.qpid.transport.Session#sync</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="robbie">Robbie Gemmell</assignee>
                                    <reporter username="robbie">Robbie Gemmell</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Oct 2010 14:36:07 +0000</created>
                <updated>Wed, 11 Feb 2015 20:06:27 +0000</updated>
                            <resolved>Wed, 7 Sep 2011 16:16:04 +0000</resolved>
                                    <version>0.7</version>
                    <version>0.8</version>
                    <version>0.9</version>
                    <version>0.10</version>
                    <version>0.11</version>
                    <version>0.12</version>
                                    <fixVersion>0.13</fixVersion>
                                    <component>Broker-J</component>
                    <component>JMS AMQP 0-x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12926900" author="gemmellr" created="Mon, 1 Nov 2010 10:09:50 +0000"  >&lt;p&gt;Updating &apos;Fix For&apos;  to Unknown on issues not targeted for 0.8&lt;/p&gt;</comment>
                            <comment id="13091765" author="alex.rufous" created="Fri, 26 Aug 2011 13:45:37 +0000"  >&lt;p&gt;These tests fail due to racing condition on broker side when TopicDelitePolicy closed the consumer session but broker tries to deliver next message to a subscription with this closed session.&lt;/p&gt;

&lt;p&gt;Because session is closed the exception is thrown on post commit and that exception is propagated back into producer client.&lt;/p&gt;

&lt;p&gt;The following stack trace demonstrates the problem&lt;/p&gt;

&lt;p&gt;BROKER: org.apache.qpid.transport.SessionClosedException: session closed&lt;br/&gt;
BROKER: at org.apache.qpid.transport.Session.invoke(Session.java:629)&lt;br/&gt;
BROKER: at org.apache.qpid.server.transport.ServerSession.sendMessage(ServerSession.java:203)&lt;br/&gt;
BROKER: at org.apache.qpid.server.subscription.Subscription_0_10.send(Subscription_0_10.java:602)&lt;br/&gt;
BROKER: at org.apache.qpid.server.queue.SimpleAMQQueue.deliverMessage(SimpleAMQQueue.java:747)&lt;br/&gt;
BROKER: at org.apache.qpid.server.queue.SimpleAMQQueue.deliverToSubscription(SimpleAMQQueue.java:688)&lt;br/&gt;
BROKER: at org.apache.qpid.server.queue.SimpleAMQQueue.enqueue(SimpleAMQQueue.java:588)&lt;br/&gt;
BROKER: at org.apache.qpid.server.queue.SimpleAMQQueue.enqueue(SimpleAMQQueue.java:566)&lt;br/&gt;
BROKER: at org.apache.qpid.server.transport.ServerSession$1.postCommit(ServerSession.java:179)&lt;br/&gt;
BROKER: at org.apache.qpid.server.txn.LocalTransaction.commit(LocalTransaction.java:254)&lt;br/&gt;
BROKER: at org.apache.qpid.server.transport.ServerSession.commit(ServerSession.java:449)&lt;br/&gt;
BROKER: at org.apache.qpid.server.transport.ServerSessionDelegate.txCommit(ServerSessionDelegate.java:441)&lt;br/&gt;
BROKER: at org.apache.qpid.server.transport.ServerSessionDelegate.txCommit(ServerSessionDelegate.java:98)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.TxCommit.dispatch(TxCommit.java:91)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.SessionDelegate.command(SessionDelegate.java:50)&lt;br/&gt;
BROKER: at org.apache.qpid.server.transport.ServerSessionDelegate.command(ServerSessionDelegate.java:116)&lt;br/&gt;
BROKER: at org.apache.qpid.server.transport.ServerSessionDelegate.command(ServerSessionDelegate.java:98)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.Method.delegate(Method.java:159)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.Session.received(Session.java:530)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.Connection.dispatch(Connection.java:404)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.ConnectionDelegate.handle(ConnectionDelegate.java:64)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.ConnectionDelegate.handle(ConnectionDelegate.java:40)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.MethodDelegate.txCommit(MethodDelegate.java:152)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.TxCommit.dispatch(TxCommit.java:91)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.ConnectionDelegate.command(ConnectionDelegate.java:54)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.ConnectionDelegate.command(ConnectionDelegate.java:40)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.Method.delegate(Method.java:159)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.Connection.received(Connection.java:369)&lt;br/&gt;
BROKER: at org.apache.qpid.server.transport.ServerConnection.received(ServerConnection.java:210)&lt;br/&gt;
BROKER: at org.apache.qpid.server.transport.ServerConnection.received(ServerConnection.java:56)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.network.Assembler.emit(Assembler.java:95)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.network.Assembler.assemble(Assembler.java:196)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.network.Assembler.frame(Assembler.java:129)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.network.Frame.delegate(Frame.java:133)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.network.Assembler.received(Assembler.java:100)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.network.Assembler.received(Assembler.java:42)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.network.InputHandler.next(InputHandler.java:187)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.network.InputHandler.received(InputHandler.java:103)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.network.InputHandler.received(InputHandler.java:42)&lt;br/&gt;
BROKER: at org.apache.qpid.server.protocol.MultiVersionProtocolEngine.received(MultiVersionProtocolEngine.java:101)&lt;br/&gt;
BROKER: at org.apache.qpid.server.protocol.MultiVersionProtocolEngine.received(MultiVersionProtocolEngine.java:36)&lt;br/&gt;
BROKER: at org.apache.qpid.transport.network.mina.MinaNetworkHandler.messageReceived(MinaNetworkHandler.java:78)&lt;br/&gt;
BROKER: at org.apache.mina.common.support.AbstractIoFilterChain$TailFilter.messageReceived(AbstractIoFilterChain.java:570)&lt;br/&gt;
BROKER: at org.apache.mina.common.support.AbstractIoFilterChain.callNextMessageReceived(AbstractIoFilterChain.java:299)&lt;br/&gt;
BROKER: at org.apache.mina.common.support.AbstractIoFilterChain.access$1100(AbstractIoFilterChain.java:53)&lt;br/&gt;
BROKER: at org.apache.mina.common.support.AbstractIoFilterChain$EntryImpl$1.messageReceived(AbstractIoFilterChain.java:648)&lt;br/&gt;
BROKER: at org.apache.mina.filter.executor.ExecutorFilter.processEvent(ExecutorFilter.java:220)&lt;br/&gt;
BROKER: at org.apache.mina.filter.executor.ExecutorFilter$ProcessEventsRunnable.run(ExecutorFilter.java:264)&lt;br/&gt;
BROKER: at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
BROKER: at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
BROKER: at org.apache.mina.util.NamePreservingRunnable.run(NamePreservingRunnable.java:51)&lt;br/&gt;
BROKER: at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;
</comment>
                            <comment id="13091768" author="alex.rufous" created="Fri, 26 Aug 2011 13:49:21 +0000"  >&lt;p&gt;The attached patch fixes the problem by changing the following:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;un-registering of existing subscriptions in ServerConnection#sessionClose method&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;transport session closing state is checked in  Subscription_0_10#isSuspended method&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The system test case to reproduce the racing conditions and verify fix is attached as a separate patch&lt;/p&gt;</comment>
                            <comment id="13092756" author="alex.rufous" created="Mon, 29 Aug 2011 10:50:52 +0000"  >&lt;p&gt;Robbie,&lt;br/&gt;
Could you please have a look at the attached patch with problem fix?&lt;/p&gt;</comment>
                            <comment id="13097541" author="gemmellr" created="Mon, 5 Sep 2011 21:46:12 +0000"  >&lt;p&gt;Closing issue out as part of JIRA cleanup. Issue may already be resolved, may be invalid, or may never be fixed. See &lt;a href=&quot;https://issues.apache.org/jira/browse/QPID-3469&quot; title=&quot;JIRA clean up for Java client/broker&quot; class=&quot;issue-link&quot; data-issue-key=&quot;QPID-3469&quot;&gt;&lt;del&gt;QPID-3469&lt;/del&gt;&lt;/a&gt; for further details.&lt;/p&gt;</comment>
                            <comment id="13098825" author="gemmellr" created="Wed, 7 Sep 2011 10:08:41 +0000"  >&lt;p&gt;Reopening, this didnt have any work done on it when the cleanup list was made, but it does now...&lt;/p&gt;</comment>
                            <comment id="13098857" author="gemmellr" created="Wed, 7 Sep 2011 11:29:59 +0000"  >&lt;p&gt;Hi Alex, changes look good except maybe that the subscriptions should be unregistered within the ServerSession closure rather than within the ServerConnection closure.&lt;/p&gt;</comment>
                            <comment id="13099025" author="alex.rufous" created="Wed, 7 Sep 2011 15:24:40 +0000"  >&lt;p&gt;A new patch with unregistering of subscriptions within the ServerSession closure is uploaded.&lt;/p&gt;

&lt;p&gt;Robbie, could you please review it?&lt;/p&gt;</comment>
                            <comment id="13099068" author="gemmellr" created="Wed, 7 Sep 2011 16:16:04 +0000"  >&lt;p&gt;Patch applied.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12492056" name="0001-QPID-2901-System-test-to-reproduce-racing-conditions.patch" size="13806" author="orudyy" created="Mon, 29 Aug 2011 10:41:37 +0000"/>
                            <attachment id="12493330" name="QPID-2901-Fixes-racing-conditions-on-closing-session-from-SCDP.patch" size="3306" author="orudyy" created="Wed, 7 Sep 2011 15:10:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>62032</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 11 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0bl2n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>65526</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>