<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:21:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-10238] @CompileStatic @Canonical inner class throws RTE: NoSuchMethodError: java.util.Map.withDefault</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-10238</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Another when-the-stars-align-bug:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.groovy.groovybugs.v3_0_9

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.Canonical
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.jupiter.api.Test

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Groovy_3_0_9_MapWithDefaultBug {

	@Test
	void groovy_3_0_9_MapWithDefaultBug() {
	 &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; o = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Goo()
	 println &lt;span class=&quot;code-quote&quot;&gt;&quot;o=$o&quot;&lt;/span&gt;
	}
 
	@Canonical
	@CompileStatic
	&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Goo {
		/*
		 Groovy 3.0.9:
		  * Every line below &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;java.lang.NoSuchMethodError: &lt;span class=&quot;code-quote&quot;&gt;&apos;java.util.Map java.util.Map.withDefault(groovy.lang.Closure)&apos;&lt;/span&gt;&quot;&lt;/span&gt;
		  * Error only occurs &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;:
		  ## (&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;inner&lt;/span&gt; class
		  ## @Canonical and @CompileStatic on &lt;span class=&quot;code-keyword&quot;&gt;inner&lt;/span&gt; class
		*/
		Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; m0 = [:].withDefault { &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;() }
		Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; m1 = [:].withDefault { &lt;span class=&quot;code-quote&quot;&gt;&quot;abc&quot;&lt;/span&gt; }
		Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; m2 = [:].withDefault { &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; }
		Map m3 = [:].withDefault { &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; }
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>Windows 10, Java 11.0.11, IntelliJ 2021.1.1</environment>
        <key id="13401738">GROOVY-10238</key>
            <summary>@CompileStatic @Canonical inner class throws RTE: NoSuchMethodError: java.util.Map.withDefault</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="emge">mgroovy</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Sep 2021 21:03:26 +0000</created>
                <updated>Fri, 3 Feb 2023 18:41:07 +0000</updated>
                            <resolved>Fri, 17 Sep 2021 21:21:30 +0000</resolved>
                                    <version>3.0.9</version>
                                    <fixVersion>4.0.0-beta-2</fixVersion>
                    <fixVersion>3.0.15</fixVersion>
                                    <component>Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17416836" author="emilles" created="Fri, 17 Sep 2021 18:03:37 +0000"  >&lt;p&gt;I think this is similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-10104&quot; title=&quot;SC: runtime error for default argument call expression&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-10104&quot;&gt;&lt;del&gt;GROOVY-10104&lt;/del&gt;&lt;/a&gt; where a &lt;tt&gt;MethodCallExpression&lt;/tt&gt; from a @CS method gets reused in a generated method that isn&apos;t itself statically compiled.  &lt;tt&gt;StaticCompilationVisitor&lt;/tt&gt;, et al. may call &lt;tt&gt;setMethodTarget&lt;/tt&gt;, which can result in writing direct calls like &quot;java.util.Map.withDefault(groovy.lang.Closure)&quot;.  This method should come from &lt;tt&gt;DefaultGroovyMethods&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17416847" author="emilles" created="Fri, 17 Sep 2021 18:22:12 +0000"  >&lt;p&gt;You can side step this bug by moving the field or property initializers that include a method call to a constructor.&lt;/p&gt;</comment>
                            <comment id="17416890" author="emge" created="Fri, 17 Sep 2021 19:23:29 +0000"  >&lt;p&gt;It only occurred in one place in our code and I worked around it by pulling out the inner classes, but thanks for pointing out a more lightweight workaround :~)&lt;br/&gt;
 (It was quite surprising to see a &quot;something not found&quot;-RTE in statically compiled code, btw, since one of the main intentions of @CompileStatic/@TypeChecked is to avoid these kinds of bugs ;~)&#160;)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13521668">GROOVY-10919</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 8 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0v0ps:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>