<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:13:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-3851] @Grapes does not work (at least not in Groovy Console)</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-3851</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Try this in Groovy Console:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Grapes(
  [@Grab(group=&lt;span class=&quot;code-quote&quot;&gt;&apos;org.spockframework&apos;&lt;/span&gt;, module=&lt;span class=&quot;code-quote&quot;&gt;&apos;spock-core&apos;&lt;/span&gt;, version=&lt;span class=&quot;code-quote&quot;&gt;&apos;0.2&apos;&lt;/span&gt;),
  @Grab(group=&lt;span class=&quot;code-quote&quot;&gt;&quot;junit&quot;&lt;/span&gt;, module=&lt;span class=&quot;code-quote&quot;&gt;&quot;junit&quot;&lt;/span&gt;, version=&lt;span class=&quot;code-quote&quot;&gt;&quot;4.7&quot;&lt;/span&gt;)])
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;HelloSpock &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Specification {
 def &lt;span class=&quot;code-quote&quot;&gt;&quot;can you figure out what I&apos;m up to?&quot;&lt;/span&gt;() {
   expect:
   name.size() == length

   where:
   name &amp;lt;&amp;lt; [&lt;span class=&quot;code-quote&quot;&gt;&quot;Kirk&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Spock&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Scotty&quot;&lt;/span&gt;]
   length &amp;lt;&amp;lt; [4, 5, 6]
 }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output: &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;1 compilation error:

unable to resolve class Specification 
 at line: 1, column: 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This means that Spock is not on the compile class path. When I @Grab JUnit and Spock individually by introducing a fake class, script works as expected. (Well, not quite. I need to add &lt;tt&gt;JUnitCore.run(HelloSpock)&lt;/tt&gt; because otherwise, the test class is no longer found.)&lt;/p&gt;

&lt;p&gt;By the way, if Ivy was fully compatible with Maven, the JUnit @Grab wouldn&apos;t be necessary, because JUnit is a mandatory compile-time dependency of Spock. Admittedly, Ivy&apos;s transitive dependency resolution is more correct than Maven&apos;s, but at the cost of breaking compatibility. Is there a way to tweak this?&lt;/p&gt;</description>
                <environment>Mac OS 10.6.1&lt;br/&gt;
Java 1.6.0_15</environment>
        <key id="12814939">GROOVY-3851</key>
            <summary>@Grapes does not work (at least not in Groovy Console)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roshandawrani">Roshan Dawrani</assignee>
                                    <reporter username="pniederw">Peter Niederwieser</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Oct 2009 17:26:31 +0000</created>
                <updated>Mon, 23 Nov 2009 15:10:43 +0000</updated>
                            <resolved>Fri, 30 Oct 2009 15:46:48 +0000</resolved>
                                    <version>1.6.5</version>
                                    <fixVersion>1.6.6</fixVersion>
                    <fixVersion>1.7-rc-1</fixVersion>
                                    <component>Grape</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14468138" author="roshandawrani" created="Wed, 28 Oct 2009 15:29:13 +0000"  >&lt;p&gt;I don&apos;t think that the compilation error you are getting here is due to any Grape bug. Your script should be like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; spock.lang.Specification

@Grapes(
  [@Grab(group=&lt;span class=&quot;code-quote&quot;&gt;&apos;org.spockframework&apos;&lt;/span&gt;, module=&lt;span class=&quot;code-quote&quot;&gt;&apos;spock-core&apos;&lt;/span&gt;, version=&lt;span class=&quot;code-quote&quot;&gt;&apos;0.2&apos;&lt;/span&gt;),
  @Grab(group=&lt;span class=&quot;code-quote&quot;&gt;&quot;junit&quot;&lt;/span&gt;, module=&lt;span class=&quot;code-quote&quot;&gt;&quot;junit&quot;&lt;/span&gt;, version=&lt;span class=&quot;code-quote&quot;&gt;&quot;4.7&quot;&lt;/span&gt;)])
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;HelloSpock &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Specification {
.....
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since spock.lang.* package is not a default import into groovy, you need to tell in the script which package class Specification could be found in.&lt;/p&gt;

&lt;p&gt;Also, looking at the grape executing your script, I noticed that it was retrieving junit-4.6 correctly as the dependency, so you should not need @Grab JUnit.&lt;/p&gt;

&lt;p&gt;Can you first try with the spock.lang.Specification and then without the Junit @Grab?&lt;/p&gt;</comment>
                            <comment id="14468160" author="pniederw" created="Wed, 28 Oct 2009 16:18:42 +0000"  >&lt;p&gt;I think I just lost the import at some point when investigating this issue. After fixing the import, I&apos;m back at:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception thrown: org.junit.runner.JUnitCore

java.lang.ClassNotFoundException: org.junit.runner.JUnitCore
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That&apos;s what you see after my recent commit in trunk. Otherwise you&apos;ll just get &quot;Error running JUnit 4 test.&quot; Adding the JUnit @Grab with @Grapes doesn&apos;t make a difference, but adding it on a fake class solves the ClassNotFoundException problem:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; spock.lang.*

@Grab(group=&lt;span class=&quot;code-quote&quot;&gt;&quot;junit&quot;&lt;/span&gt;, module=&lt;span class=&quot;code-quote&quot;&gt;&quot;junit&quot;&lt;/span&gt;, version=&lt;span class=&quot;code-quote&quot;&gt;&quot;4.7&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Fake {}

@Grab(group=&lt;span class=&quot;code-quote&quot;&gt;&apos;org.spockframework&apos;&lt;/span&gt;, module=&lt;span class=&quot;code-quote&quot;&gt;&apos;spock-core&apos;&lt;/span&gt;, version=&lt;span class=&quot;code-quote&quot;&gt;&apos;0.2&apos;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;HelloSpock &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Specification {
def &lt;span class=&quot;code-quote&quot;&gt;&quot;can you figure out what I&apos;m up to?&quot;&lt;/span&gt;() {
  expect:
  name.size() == length

  where:
  name &amp;lt;&amp;lt; [&lt;span class=&quot;code-quote&quot;&gt;&quot;Kirk&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Spock&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Scotty&quot;&lt;/span&gt;]
  length &amp;lt;&amp;lt; [4, 5, 6]
}
}

&lt;span class=&quot;code-comment&quot;&gt;// we have to run the spec manually because GroovyShell doesn&apos;t know what to &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; two classes are present
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; org.junit.runner.JUnitCore().run(HelloSpock).failureCount
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14468043" author="roshandawrani" created="Thu, 29 Oct 2009 03:19:55 +0000"  >&lt;p&gt;I tried a change with which the following script is working fine (but only from 2nd attempt onwards - details follow).&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; spock.lang.*

@Grab(group=&lt;span class=&quot;code-quote&quot;&gt;&apos;org.spockframework&apos;&lt;/span&gt;, module=&lt;span class=&quot;code-quote&quot;&gt;&apos;spock-core&apos;&lt;/span&gt;, version=&lt;span class=&quot;code-quote&quot;&gt;&apos;0.2&apos;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;HelloSpock &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Specification {
 def &lt;span class=&quot;code-quote&quot;&gt;&quot;can you figure out what I&apos;m up to?&quot;&lt;/span&gt;() {
   expect:
   name.size() == length

   where:
   ignored = println (&lt;span class=&quot;code-quote&quot;&gt;&quot;where: \n p0=$p0\n p1=$p1&quot;&lt;/span&gt;)
   name &amp;lt;&amp;lt; [&lt;span class=&quot;code-quote&quot;&gt;&quot;Kirk&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Spock&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Scotty&quot;&lt;/span&gt;]
   length &amp;lt;&amp;lt; [4, 5, 6]
 }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now, this code does not get executed correctly when you try for the first time. It fails with the error:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Test Failure: initializationError(HelloSpock)
org.spockframework.runtime.InvalidSpeckError: Class &apos;HelloSpock&apos; is not a Speck, or has not been compiled properly
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is happening because before grab brings in spock-jar on the classpath, the scanning for AST transformations has already happened, so the class does not get a chance to undergo spock related AST transformations and when run, it is not recognized as a speck. &lt;/p&gt;

&lt;p&gt;2nd time onwards that issue is not there as the classpath has spock-jar now and the script correctly undergoes spock&apos;s AST transformation also and it is then run correctly as JUnit4 test.&lt;/p&gt;

&lt;p&gt;Since the AST transformation issue mention above is not related to the current JIRA, I want to commit the patch that makes the above script work(2nd time onwards) and mark this issue as fixed. Let me know if someone sees any issue with that.&lt;/p&gt;

&lt;p&gt;I will be interested in knowing views about the AST transformation issue and how it might be taken forward. Should scanning for AST transformation happen once more after GrabAnnotationTransformation has fetched stuff and updated the classpath?&lt;/p&gt;</comment>
                            <comment id="14468031" author="roshandawrani" created="Fri, 30 Oct 2009 04:53:07 +0000"  >&lt;p&gt;Still waiting for comments - for the confirmation that the issue that now remains has nothing to do with this JIRA (see previous comment for details) - before I go ahead and apply the patch.&lt;/p&gt;</comment>
                            <comment id="14468061" author="blackdrag" created="Fri, 30 Oct 2009 07:37:10 +0000"  >&lt;p&gt;Roshan, I am not clear what your patch will do. As on the issue directly...  If the grab annotation would be visited first in ResolveClass, including fetching the dependencies, then it would work I guess. But to me it becomes more and more clear that we should go with the following... make an annoation resolving try in conversion. And make the second, complete scan including failures normally in ResolveVisitor.&lt;/p&gt;</comment>
                            <comment id="14468126" author="roshandawrani" created="Fri, 30 Oct 2009 07:46:26 +0000"  >&lt;p&gt;Attaching the patch here.&lt;/p&gt;

&lt;p&gt;GroovyShell checked whether a class was a JUnit4 test or a TestNG test with the correct class loader but then executed the tests using a different class loader (Class.forName()). That is why it was not seeing the JUnit4 classes that the GroovyShell loader was seeing after @grab added spock/junit4 URLs to it.&lt;/p&gt;

&lt;p&gt;The changes regarding the issue that will remain - possibly doing 2 scans to find transformations or some other approach - can be taken as an improvement/JIRA outside this one, right?&lt;/p&gt;</comment>
                            <comment id="14468105" author="roshandawrani" created="Fri, 30 Oct 2009 07:48:34 +0000"  >&lt;p&gt;Although spock here is junit4 based, even execution of TestNG tests by GroovyShell had the same issue, so I corrected that as well here itself.&lt;/p&gt;</comment>
                            <comment id="14468014" author="blackdrag" created="Fri, 30 Oct 2009 09:14:59 +0000"  >&lt;p&gt;the patch looks good to me. As for the transform recognition... yes, that should be an issue of its own&lt;/p&gt;</comment>
                            <comment id="14468032" author="roshandawrani" created="Fri, 30 Oct 2009 14:56:07 +0000"  >&lt;p&gt;Jochen, I tried adding a unit test case for the scenario reported here, but had to revert it because the @Grab download of groovy jar failed on the bamboo box for some reason. I removed the test case because it was a shaky one anyway and one that I was able to put in only for 1.6.x version and not for trunk for the following reason:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Apart from JUnit 4.7, spock-2.0 also was bringing in groovy-all-1.6.3 in the classpath. With trunk version, even locally I was getting java.lang.NoSuchMethodError: org.codehaus.groovy.ast.ModuleNode.getImport(Ljava/lang/String;)Lorg/codehaus/groovy/ast/ClassNode;, which, I guess, was because GCL was now seeing 2 different groovy versions on the classpath.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I have locally tested it and I am fairly comfortable with it having tested it locally on 1.6.x and then you have seen it too.&lt;/p&gt;

&lt;p&gt;Let me know if you see any issue in me marking it &quot;fixed&quot;. &lt;/p&gt;

&lt;p&gt;We can also wait for Peter to verify it from groovyconsole as reported in JIRA, if you want.&lt;/p&gt;</comment>
                            <comment id="14468062" author="pniederw" created="Fri, 30 Oct 2009 15:32:28 +0000"  >&lt;p&gt;I can confirm that HelloSpock now works from the second run onwards. The reason why you are getting NoSuchMethodError is that getImport() has changed incompatibly between Groovy 1.6 and 1.7. Spock 0.2 only works with Groovy 1.6.&lt;/p&gt;</comment>
                            <comment id="14467999" author="roshandawrani" created="Fri, 30 Oct 2009 15:41:44 +0000"  >&lt;p&gt;Thanks for confirming that, Peter. &lt;/p&gt;

&lt;p&gt;That incompatibility of getImport() is what I also meant to point to point out when I mentioned that after @Grab(bing) spock, groovy is seeing both 1.6 and 1.7 on its classpath and is running into that error.&lt;/p&gt;

&lt;p&gt;So, the plan is that we mark this JIRA as fixed as it has fixed the issue that was reported and then open another, linked JIRA to try to bring in some changes in AST transformation scanning so that this spock script can run from first attempt itself. Are you ok with that?&lt;/p&gt;</comment>
                            <comment id="14468080" author="pniederw" created="Fri, 30 Oct 2009 15:45:01 +0000"  >&lt;p&gt;Sure! Thanks for your work, Roshan.&lt;/p&gt;</comment>
                            <comment id="14468044" author="roshandawrani" created="Fri, 30 Oct 2009 15:46:19 +0000"  >&lt;p&gt;You&apos;re welcome, Peter.&lt;/p&gt;</comment>
                            <comment id="14468127" author="roshandawrani" created="Fri, 30 Oct 2009 15:46:48 +0000"  >&lt;p&gt;Fixed.&lt;/p&gt;</comment>
                            <comment id="14468019" author="roshandawrani" created="Thu, 12 Nov 2009 10:32:07 +0000"  >&lt;p&gt;Hi Peter, I have fixed it in 1.6.6 now. Can you please try with the latest 1.6.6 snapshot and see if this spock script execution now works from groovyconsole - from the first run itself?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="14468137" author="pniederw" created="Mon, 23 Nov 2009 15:10:43 +0000"  >&lt;p&gt;Works fine now.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310260">
                    <name>Related</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12811722">GROOVY-3861</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12722235" name="3851_v16x.txt" size="3933" author="roshandawrani" created="Fri, 30 Oct 2009 07:46:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 1 week, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cg4f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>