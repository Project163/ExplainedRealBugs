<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:03:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-8955] VerifyError when AIC with @CS can&apos;t be detected as not valid</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-8955</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;In this buggy code the return type of  &lt;tt&gt;getMappedForm&lt;/tt&gt; method in the AIC should be property. None-the-less, it shouldn&apos;t result in a &lt;tt&gt;VerifyError&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Property {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; generator
}

&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; PMapping&amp;lt;T &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Property&amp;gt; {
    T getMappedForm()
}

&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; PProperty {
    PMapping getMapping()
}

@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;GPEntity {
    def method() {
        PProperty identity = getIdentity()
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; generatorType = identity.getMapping().getMappedForm().getGenerator()
    }

    PProperty getIdentity() {
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PProperty() {
            PMapping getMapping() {
                &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PMapping() {
                   def getMappedForm() {
                       &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Property() {
                           &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getGenerator() { &lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt; }
                       }
                   }
                }
            }
        }
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GPEntity().method()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The error is:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.VerifyError: Bad return type
Exception Details:
  Location:
    GPEntity$1$2.getMappedForm()LProperty; @4: areturn
  Reason:
    Type &apos;java/lang/Object&apos; (current frame, stack[0]) is not assignable to &apos;Property&apos; (from method signature)
  Current Frame:
    bci: @4
    flags: { }
    locals: { &apos;GPEntity$1$2&apos; }
    stack: { &apos;java/lang/Object&apos; }
  Bytecode:
    0x0000000: 2ab6 0099 b0                           


	at GPEntity$1.getMapping(ConsoleScript13:25)
        ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If the &lt;tt&gt;PMapping&lt;/tt&gt; method is written without generics, e.g.:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; PMapping {
    Property getMappedForm()
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then the error becomes the expected compilation error:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;The return type of java.lang.Object getMappedForm() in GPEntity$1$2 is incompatible with Property in PMapping
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13209130">GROOVY-8955</key>
            <summary>VerifyError when AIC with @CS can&apos;t be detected as not valid</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="paulk">Paul King</reporter>
                        <labels>
                    </labels>
                <created>Sat, 12 Jan 2019 02:05:03 +0000</created>
                <updated>Sat, 5 Feb 2022 17:43:20 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="16831115" author="emilles" created="Wed, 1 May 2019 16:41:15 +0000"  >&lt;p&gt;Possibly related to &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9059&quot; title=&quot;Failed to parse/compile generic methods with &amp;quot;extends&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9059&quot;&gt;&lt;del&gt;GROOVY-9059&lt;/del&gt;&lt;/a&gt;.  Should be allowed to create AIC without specifying type parameter.  Should we also allow &quot;def&quot; instead of the argument for &quot;T&quot;?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; PMapping&amp;lt;T &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Property&amp;gt; {
    T getMappedForm()
}
@CompileStatic
void test() {
  &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; impl = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PMapping() {
    Property getMappedFrom() { ... } &lt;span class=&quot;code-comment&quot;&gt;// TODO: Support replacing &lt;span class=&quot;code-quote&quot;&gt;&quot;Property&quot;&lt;/span&gt; with &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt;&quot;&lt;/span&gt;?
&lt;/span&gt;  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16831954" author="emilles" created="Thu, 2 May 2019 20:51:26 +0000"  >&lt;p&gt;To allow &quot;def&quot; as a substitute for the &quot;T&quot; type parameter, &lt;tt&gt;Verifier&lt;/tt&gt; could have an addition like this.  &lt;del&gt;The return type &lt;tt&gt;testmr&lt;/tt&gt; could be used if the AIC specified generics.  So this is just a trial change using &lt;tt&gt;cleanType(omr)&lt;/tt&gt;.&lt;/del&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; MethodNode getCovariantImplementation(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; MethodNode oldMethod, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; MethodNode overridingMethod, Map genericsSpec, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; ignoreError) {
        ...
        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; type
&lt;/span&gt;        ClassNode mr = overridingMethod.getReturnType();
        ClassNode omr = oldMethod.getReturnType();
        &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; equalReturnType = mr.equals(omr);
        ...
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!equalReturnType) {
            &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; oldM = ClassHelper.isPrimitiveType(oldMethod.getReturnType());
            &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; newM = ClassHelper.isPrimitiveType(overridingMethod.getReturnType());
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (oldM || newM) {
                &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; message = &quot;&quot;;
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (oldM &amp;amp;&amp;amp; newM) {
                    message = &lt;span class=&quot;code-quote&quot;&gt;&quot; with old and &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; method having different primitive &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; types&quot;&lt;/span&gt;;
                } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (newM) {
                    message = &lt;span class=&quot;code-quote&quot;&gt;&quot; with &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; method having a primitive &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; type and old method not&quot;&lt;/span&gt;;
                } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-comment&quot;&gt;/* oldM */&lt;/span&gt; {
                    message = &lt;span class=&quot;code-quote&quot;&gt;&quot; with old method having a primitive &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; type and &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; method not&quot;&lt;/span&gt;;
                }
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeParserException(
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot override method &quot;&lt;/span&gt; +
                                oldMethod.getTypeDescriptor() +
                                &lt;span class=&quot;code-quote&quot;&gt;&quot; in &quot;&lt;/span&gt; + oldMethod.getDeclaringClass().getName() +
                                message,
                        overridingMethod);
            }
            &lt;span class=&quot;code-comment&quot;&gt;// GRECLIPSE add -- GROOVY-8955
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (overridingMethod.isDynamicReturnType() &amp;amp;&amp;amp; normalEqualParameters) {
                overridingMethod.setReturnType(cleanType(omr));
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
            }
            &lt;span class=&quot;code-comment&quot;&gt;// GRECLIPSE end
&lt;/span&gt;        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16856376" author="daniel_sun" created="Wed, 5 Jun 2019 05:58:35 +0000"  >&lt;p&gt;The proposed PR was merged and will be merged into 2_5_X later. Thanks!&lt;/p&gt;</comment>
                            <comment id="16875077" author="daniel_sun" created="Fri, 28 Jun 2019 17:19:47 +0000"  >&lt;p&gt;The proposed PR was reverted as a new runtime exception introduced:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/d53e4e461bc6e08a7d265258db9d00e86d873691&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/d53e4e461bc6e08a7d265258db9d00e86d873691&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16885340" author="emilles" created="Mon, 15 Jul 2019 15:45:13 +0000"  >&lt;p&gt;Is the expectation some compile-time error if the returned value type will not match the type parameter&apos;s bound(s)?  It seems reasonable to me that a cast for &lt;tt&gt;Property&lt;/tt&gt; is added in this case.&lt;/p&gt;</comment>
                            <comment id="17487530" author="emilles" created="Sat, 5 Feb 2022 17:43:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulk&quot; class=&quot;user-hover&quot; rel=&quot;paulk&quot;&gt;paulk&lt;/a&gt; Can the original change go back in for Groovy 5?  It seems reasonable to me to get a cast exception when returning a type that does not meet the bounds of the return type.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13202873">GROOVY-8912</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 40 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|u00rmo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>