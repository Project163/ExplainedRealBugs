<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:41:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-6437] Sql.withTransaction() doesn&apos;t rollback on checked exceptions</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-6437</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;If checked exception is thrown in the &lt;tt&gt;Sql#withTransaction(Closure)&lt;/tt&gt; code block, the transaction will not be rolled back. Rollback is still invoked for runtime exceptions, &lt;tt&gt;SQLException&lt;/tt&gt;, and &lt;tt&gt;Error&lt;/tt&gt; - exceptions that are explicitly handled by &lt;tt&gt;withTransaction&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The following code illustrates the behaviour:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def sql = groovy.sql.Sql.newInstance(...)
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
    sql.withTransaction {
        sql.execute &lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TABLE foo_table (col1 INTEGER)&quot;&lt;/span&gt;
        sql.execute &lt;span class=&quot;code-quote&quot;&gt;&quot;INSERT INTO foo_table (col1) VALUES (42)&quot;&lt;/span&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Exception(&lt;span class=&quot;code-quote&quot;&gt;&quot;will not cause rollback&quot;&lt;/span&gt;)
    }
} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (e) {
    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; e.message == &lt;span class=&quot;code-quote&quot;&gt;&quot;will not cause rollback&quot;&lt;/span&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; sql.firstRow(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT COUNT(*) n FROM foo_table&quot;&lt;/span&gt;).n == 1
    sql.execute &lt;span class=&quot;code-quote&quot;&gt;&quot;DROP TABLE foo_table&quot;&lt;/span&gt; &lt;span class=&quot;code-comment&quot;&gt;// clean-up by hand
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Expected (but undesirable) outcome is that transaction is not rolled back - table &lt;tt&gt;foo_table&lt;/tt&gt; still exists in the catch block with one inserted row.&lt;/p&gt;

&lt;p&gt;In Groovy 2.0.x and earlier, checked exceptions would indeed cause rollback. The above code would fail on the first assertion, attempting to read from a non-existing table.&lt;/p&gt;

&lt;p&gt;Exception handling code in &lt;tt&gt;withTransaction&lt;/tt&gt; basically hasn&apos;t changed between 2.0 and 2.1, yet the method exhibits different behaviour.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12818264">GROOVY-6437</key>
            <summary>Sql.withTransaction() doesn&apos;t rollback on checked exceptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="dsrkoc">Dinko Srkoc</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Nov 2013 03:27:22 +0000</created>
                <updated>Wed, 28 May 2014 03:03:59 +0000</updated>
                            <resolved>Mon, 26 May 2014 02:19:25 +0000</resolved>
                                    <version>2.1.9</version>
                    <version>2.2.0-rc-3</version>
                                    <fixVersion>2.3.2</fixVersion>
                                    <component>SQL processing</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14475129" author="blackdrag" created="Mon, 18 Nov 2013 07:35:21 +0000"  >&lt;p&gt;around line 3058 in Sql.java we have &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SQLException e) {
            handleError(connection, e);
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; e;
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (RuntimeException e) {
            handleError(connection, e);
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; e;
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Error e) {
            handleError(connection, e);
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; e;
        }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The exception from inside the open block is of type Exception... even though this is correct, I assume, that the exception was in the past wrapped in an InvokerInvocationException or a InvocationTargetException. What exactly fixed that, I cannot tell yet, but it behaves correctly now. This means though the code there needs adjustement. And I wonder why not simply catch Throwable? The code there looks like checked exception have been taken out on purpose, but that does not make sense to me.&lt;/p&gt;</comment>
                            <comment id="14476046" author="pschumacher" created="Sat, 24 May 2014 05:59:06 +0000"  >&lt;p&gt;@Paul: It would be nice if you could take a look at this. Looks like a serious bug to me.&lt;/p&gt;</comment>
                            <comment id="14480528" author="paulk" created="Sat, 24 May 2014 21:01:21 +0000"  >&lt;p&gt;Yes, I was looking at this again yesterday actually. I haven&apos;t been able to find a definitive reference to how different kinds of exceptions should be handled in this case. To keep the Java API unchanged we want to wrap checked exceptions within a SQLException but unchecked exceptions, errors and existing SQLExceptions do not need to be re-rewrapped.&lt;/p&gt;</comment>
                            <comment id="14475971" author="paulk" created="Sat, 24 May 2014 22:21:28 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://github.com/groovy/groovy-core/pull/426&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/groovy/groovy-core/pull/426&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14480544" author="paulk" created="Mon, 26 May 2014 02:19:26 +0000"  >&lt;p&gt;Exception is now caught too. Thanks for raising the issue.&lt;/p&gt;</comment>
                            <comment id="14475946" author="dsrkoc" created="Mon, 26 May 2014 03:03:30 +0000"  >&lt;p&gt;It was my pleasure. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Thanks for fixing it.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 26 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bvuv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>