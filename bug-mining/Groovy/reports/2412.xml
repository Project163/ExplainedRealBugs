<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:37:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-6457] File.eachFileMatch is inconsistent with File.eachFile and incurs extra stat() syscalls</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-6457</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;&lt;a href=&quot;http://groovy.codehaus.org/groovy-jdk/java/io/File.html#eachFileMatch%28groovy.io.FileType,%20java.lang.Object,%20groovy.lang.Closure%29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ResourceGroovyMethods#eachFileMatch&lt;/a&gt; iterates over each file/directory in a directory, while &lt;a href=&quot;http://groovy.codehaus.org/groovy-jdk/java/io/File.html#eachFile%28groovy.io.FileType,%20groovy.lang.Closure%29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ResourceGroovyMethods#eachFile&lt;/a&gt; instead iterates over every directory entry, including things which aren&apos;t files or directories (e.g., fifos and sockets). &lt;tt&gt;eachFileMatch&lt;/tt&gt; should behave similar to &lt;tt&gt;eachFile&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Here&apos;s a demonstration showing that the methods return different results when iterating over everything:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[ecd@qk /tmp/tmp12345]$ ls -alF
total 36
drwxr-xr-x    2 ecd   wheel    512 Nov 27 20:46 ./
drwxrwxrwt  269 root  wheel  32256 Nov 27 20:20 ../
-rw-r--r--    1 ecd   wheel      0 Nov 27 20:13 .hidden
-rw-r--r--    1 ecd   wheel      0 Nov 27 20:13 bar
prw-r--r--    1 ecd   wheel      0 Nov 27 20:16 fifo|
-rw-r--r--    1 ecd   wheel      0 Nov 27 20:13 foo1
-rw-r--r--    1 ecd   wheel      0 Nov 27 20:13 foo2
-rw-r--r--    1 ecd   wheel      0 Nov 27 20:13 foo3
-rw-r--r--    1 ecd   wheel      0 Nov 27 20:13 foo4
-rw-r--r--    1 ecd   wheel      0 Nov 27 20:13 foo5
lrwxr-xr-x    1 ecd   wheel      4 Nov 27 20:46 symlink@ -&amp;gt; foo3
[ecd@qk /tmp/tmp12345]$ groovysh
Groovy Shell (2.2.1, JVM: 1.7.0_25)
Type &lt;span class=&quot;code-quote&quot;&gt;&apos;help&apos;&lt;/span&gt; or &lt;span class=&quot;code-quote&quot;&gt;&apos;\h&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; help.
------------------------------------------------------------------------------------------------------------------------------------------------------
groovy:000&amp;gt; i = 0
===&amp;gt; 0
groovy:000&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;.&quot;&lt;/span&gt;).eachFile { ++i }
===&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
groovy:000&amp;gt; i
===&amp;gt; 9
groovy:000&amp;gt; j = 0
===&amp;gt; 0
groovy:000&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;.&quot;&lt;/span&gt;).eachFileMatch(~/.*/) { ++j }
===&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
groovy:000&amp;gt; j
===&amp;gt; 8
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Furthermore, due to the lack of a check in &lt;tt&gt;eachFileMatch&lt;/tt&gt; for the &lt;tt&gt;FileType.ANY&lt;/tt&gt; case, it causes &lt;tt&gt;File.isFile()&lt;/tt&gt; and &lt;tt&gt;File.isDirectory()&lt;/tt&gt; to be called for every directory entry. This can be a significant performance impact particularly on slow NFS mounts in directories with thousands of files.&lt;/p&gt;

&lt;p&gt;The extra &lt;tt&gt;stat&lt;/tt&gt; syscalls can be seen with another demo, using the same directory structure as above:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;FileTests {

    def basic() { &lt;span class=&quot;code-comment&quot;&gt;// 0 stats
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (File f : &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/tmp12345&quot;&lt;/span&gt;).listFiles()) { }
    }

    def groovyEachFile() {
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/tmp12345&quot;&lt;/span&gt;).eachFile { }
    }

    def groovyEachFileMatch() {
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/tmp12345&quot;&lt;/span&gt;).eachFileMatch(~/.*/) { }
    }

    def groovyEachFileRecurse() {
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/tmp12345&quot;&lt;/span&gt;).eachFileRecurse { }
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
        FileTests fileTests = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileTests();
        FileTests.getMethod(args[0]).invoke(fileTests);
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and truss/strace/dtrace will show the system calls for each:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[ecd@qk ~]$ (&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; m in basic groovyEachFile groovyEachFileMatch groovyEachFileRecurse; &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; echo $m $(truss groovy FileTests.groovy $m 2&amp;gt;&amp;amp;1 | grep tmp12345 | grep -c stat); done) | column -t
basic                  0
groovyEachFile         2
groovyEachFileMatch    20
groovyEachFileRecurse  11
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="12818275">GROOVY-6457</key>
            <summary>File.eachFileMatch is inconsistent with File.eachFile and incurs extra stat() syscalls</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="ericdahl">Eric Dahl</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Nov 2013 21:07:23 +0000</created>
                <updated>Tue, 4 Mar 2014 16:31:37 +0000</updated>
                            <resolved>Thu, 28 Nov 2013 23:31:53 +0000</resolved>
                                    <version>2.2.1</version>
                                    <fixVersion>2.2.2</fixVersion>
                                    <component>groovy-jdk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14475299" author="ericdahl" created="Wed, 27 Nov 2013 21:52:23 +0000"  >&lt;p&gt;I&apos;ve submitted a pull request for this: &lt;a href=&quot;https://github.com/groovy/groovy-core/pull/290&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/groovy/groovy-core/pull/290&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14480411" author="paulk" created="Thu, 28 Nov 2013 23:31:53 +0000"  >&lt;p&gt;Nice catch. Proposed PR merged. Thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 51 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2brz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>