<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:16:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-4252] Invalid code crashes the compiler</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-4252</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;This code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Crasher {
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void m() {
		def fields = [1,2,3]
		def expectedFieldNames = [&lt;span class=&quot;code-quote&quot;&gt;&quot;patentnumber&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;].
		&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i=0; i&amp;lt;fields.size(); i++) {
			&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; f = fields[i] 
			&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(f); 
		}
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;is not valid (I believe?).  There is an extraneous &apos;.&apos; on the end of the second &apos;def&apos; line.  Instead of a nice error message about having done something wrong, we get this stack on compilation:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;gt;&amp;gt;&amp;gt; a serious error occurred: BUG! exception in phase &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;generation&apos;&lt;/span&gt; in source unit &lt;span class=&quot;code-quote&quot;&gt;&apos;Crasher.groovy&apos;&lt;/span&gt; tried to get a variable wit
h the name i as stack variable, but a variable with &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; name was not created
&amp;gt;&amp;gt;&amp;gt; stacktrace:
BUG! exception in phase &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;generation&apos;&lt;/span&gt; in source unit &lt;span class=&quot;code-quote&quot;&gt;&apos;Crasher.groovy&apos;&lt;/span&gt; tried to get a variable with the name i as stack variable
, but a variable with &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; name was not created
        at org.codehaus.groovy.classgen.CompileStack.getVariable(CompileStack.java:263)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitClosureExpression(AsmClassGenerator.java:1759)
        at org.codehaus.groovy.ast.expr.ClosureExpression.visit(ClosureExpression.java:46)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitAndAutoboxBoolean(AsmClassGenerator.java:4071)
        at org.codehaus.groovy.classgen.AsmClassGenerator.makeCallSite(AsmClassGenerator.java:2147)
        at org.codehaus.groovy.classgen.AsmClassGenerator.makeCall(AsmClassGenerator.java:1984)
        at org.codehaus.groovy.classgen.AsmClassGenerator.makeCall(AsmClassGenerator.java:1970)
        at org.codehaus.groovy.classgen.AsmClassGenerator.makeInvokeMethodCall(AsmClassGenerator.java:1953)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitMethodCallExpression(AsmClassGenerator.java:2300)
        at org.codehaus.groovy.ast.expr.MethodCallExpression.visit(MethodCallExpression.java:72)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitAndAutoboxBoolean(AsmClassGenerator.java:4071)
        at org.codehaus.groovy.classgen.AsmClassGenerator.assignmentCastAndVisit(AsmClassGenerator.java:4012)
        at org.codehaus.groovy.classgen.AsmClassGenerator.evaluateEqual(AsmClassGenerator.java:3962)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitDeclarationExpression(AsmClassGenerator.java:1442)
        at org.codehaus.groovy.ast.expr.DeclarationExpression.visit(DeclarationExpression.java:53)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitAndAutoboxBoolean(AsmClassGenerator.java:4071)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitExpressionStatement(AsmClassGenerator.java:1430)
        at org.codehaus.groovy.ast.stmt.ExpressionStatement.visit(ExpressionStatement.java:40)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>Windows 7</environment>
        <key id="12815201">GROOVY-4252</key>
            <summary>Invalid code crashes the compiler</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roshandawrani">Roshan Dawrani</assignee>
                                    <reporter username="aclement">Andy Clement</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Jun 2010 19:01:45 +0000</created>
                <updated>Thu, 22 Jul 2010 17:32:26 +0000</updated>
                            <resolved>Mon, 21 Jun 2010 07:21:34 +0000</resolved>
                                    <version>1.7.3</version>
                                    <fixVersion>1.7.4</fixVersion>
                    <fixVersion>1.8-beta-1</fixVersion>
                                    <component>Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14469668" author="roshandawrani" created="Fri, 18 Jun 2010 02:51:32 +0000"  >&lt;p&gt;Looked a bit into it and I have a few questions.&lt;/p&gt;

&lt;p&gt;1) Should the following compile&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[].foo(1;2;3)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2) What is a ClosureListExpression? Is it of use outside for loops? In what kind of code? For def x = (1;2;3), do multiple closures get generated?&lt;/p&gt;

&lt;p&gt;The AST for the JIRA example takes the form def expectedFieldNames = [].for(ClosureListExpression) &lt;/p&gt;
{for loop body as a ClosureExpression}
&lt;p&gt;, and then ACG runs into this BUG because for variable i, no variable is declared because it is not really treated as a for loop here but separate scope ClosureListExpression and ClosureExpression.&lt;/p&gt;</comment>
                            <comment id="14469615" author="blackdrag" created="Fri, 18 Jun 2010 04:55:25 +0000"  >&lt;p&gt;first.. a BUG! message must not happen. Then about the ClosureListExpression. I added that quite some time before I added the for loop. It is not an official feature, because it was mostly rejected by the people. I use it sometimes though. (1;2;3) generates a list of closures, but behind it there is a single closure and the list contains only closures with jump points. The structure behind was thought to be used for some kind of continuations, but not really thought through.&lt;/p&gt;

&lt;p&gt;The variable is treated right in the variable scope stuff, but asm does not know about this well enough. And so it fails in a way it should not. The code whould have been rejected way before reaching that point or simply work.&lt;/p&gt;

&lt;p&gt;Now... if the example would produce a message, that list has no &quot;for&quot; method... would that be too strange?&lt;/p&gt;</comment>
                            <comment id="14469657" author="roshandawrani" created="Fri, 18 Jun 2010 05:01:44 +0000"  >&lt;p&gt;&amp;gt;&amp;gt; Now... if the example would produce a message, that list has no &quot;for&quot; method... would that be too strange?&lt;/p&gt;

&lt;p&gt;To do that, we need to get rid of the compilation error first, right? Such a message makes sense only at runtime due to possible MOP injections, right?&lt;/p&gt;

&lt;p&gt;I thought too that it was a grammar/AST issue but then ClosureListExpression processing makes it correct grammar/AST-wise, in a sense. So I wasn&apos;t sure which way to get rid of the issue.&lt;/p&gt;</comment>
                            <comment id="14469557" author="blackdrag" created="Fri, 18 Jun 2010 05:18:20 +0000"  >&lt;p&gt;In the light of &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-4252&quot; title=&quot;Invalid code crashes the compiler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-4252&quot;&gt;&lt;del&gt;GROOVY-4252&lt;/del&gt;&lt;/a&gt; I suggest to let the compiler recognize the ClosureExpression as error in APP&lt;/p&gt;</comment>
                            <comment id="14469582" author="roshandawrani" created="Fri, 18 Jun 2010 05:21:57 +0000"  >&lt;p&gt;You mean ClosureListExpression? (recognizing ClosureExpression as an error would be quite suicidal &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; )&lt;/p&gt;

&lt;p&gt;And you mean we get rid of that unofficial ClosureListExpression feature (at least block the entry to it and keep rest of the code behind for now)?&lt;/p&gt;</comment>
                            <comment id="14469644" author="blackdrag" created="Fri, 18 Jun 2010 06:00:34 +0000"  >&lt;p&gt;ahem.... ClosureListExpression of course, sorry &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
I suggest we don&apos;t change the grammar and let the compiler fail in APP if something returns a ClosureListExpression, which should not take one. The removal of the ClosureListExpression itself may cause problems, since I think the for-loop uses it internally - even if it does, in the end, not create a list of closures.&lt;/p&gt;

&lt;p&gt;This still means that for the issue at hand, the compiler would then through an error for the ClosureListExpression usage after the for and not for the wrongly used &quot;.&quot;. In fact the &quot;.&quot; is not wrong, a method called &quot;for&quot; is very well allowed in Groovy. We need a good message for this, otherwise the user will be majorly confused. &lt;/p&gt;

&lt;p&gt;What would be a good message here?&lt;/p&gt;</comment>
                            <comment id="14469530" author="roshandawrani" created="Fri, 18 Jun 2010 06:16:16 +0000"  >&lt;p&gt;Just to understand better, you are suggesting that we block the use of ClosureListExpression everywhere but in the for loop, right? That java-like for loop would remain the only legal use and other places need to reject the code?&lt;/p&gt;</comment>
                            <comment id="14469669" author="blackdrag" created="Fri, 18 Jun 2010 06:51:23 +0000"  >&lt;p&gt;yes, I don&apos;t want to remove it completely, since I think we may have it at a later point maybe. So for now let&apos;s block it&lt;/p&gt;</comment>
                            <comment id="14469659" author="blackdrag" created="Fri, 18 Jun 2010 06:52:26 +0000"  >&lt;p&gt;unles someone here says that we maybe should instead enable this fully&lt;/p&gt;</comment>
                            <comment id="14469686" author="roshandawrani" created="Sat, 19 Jun 2010 05:26:14 +0000"  >&lt;p&gt;Attaching a patch for review.&lt;/p&gt;

&lt;p&gt;A ClosureListExpression anywhere except the for loop is rejected by APP now. Below is how the output looks like in various scenarios:&lt;/p&gt;

&lt;p&gt;A)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;a)  [].bar(1;2;3)

b)  def x = (1;2;3)

c)  [].&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(1;2;3){println &lt;span class=&quot;code-quote&quot;&gt;&quot;in loop&quot;&lt;/span&gt;;&lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;produces&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Invalid use of the list of expressions here. 
It is supported only for traditional java-like for loops. 
A possible cause could be that for loop is invoked as a method by mistake. at line: 1 column: 8.
a)   [].bar(1;2;3)
            ^
  
b)   def x = (1;2;3)
              ^
c)   [].for(1;2;3){println &quot;in loop&quot;;break}
            ^
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;B)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Crasher {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void m() {
        def fields = [1,2,3]
        def expectedFieldNames = [&lt;span class=&quot;code-quote&quot;&gt;&quot;patentnumber&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;].
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i=0; i&amp;lt;fields.size(); i++) {
            &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; f = fields[i] 
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(f); 
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;produces&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Invalid use of the list of expressions here. 
It is supported only for traditional java-like for loops. 
A possible cause could be that for loop is invoked as a method by mistake. at line: 5 column: 14.
           for (int i=0; i&amp;lt;fields.size(); i++) {
                ^
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;C) The following compiles successfully as the only permitted use of ClosureListExpression (under for loop).&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 5; i++){println i}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14469631" author="roshandawrani" created="Sat, 19 Jun 2010 06:17:01 +0000"  >&lt;p&gt;An alternative message could be:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Invalid use of the expression list. Either the for loop has been invoked 
as a method by mistake, or the list of expressions is not supported in this context.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14469719" author="roshandawrani" created="Sun, 20 Jun 2010 23:12:28 +0000"  >&lt;p&gt;Hi. anyone got a chance to review the patch?&lt;/p&gt;</comment>
                            <comment id="14469633" author="guillaume" created="Mon, 21 Jun 2010 03:17:54 +0000"  >&lt;p&gt;I&apos;ve not looked at the patch itself, but the rationale and behaviour you explained look fine to me.&lt;/p&gt;</comment>
                            <comment id="14469731" author="roshandawrani" created="Mon, 21 Jun 2010 03:19:53 +0000"  >&lt;p&gt;The patch itself is quite small and simple too. It&apos;s more of taking a call on the behavior after the patch and the friendliness of the error message.&lt;/p&gt;</comment>
                            <comment id="14469705" author="guillaume" created="Mon, 21 Jun 2010 03:27:29 +0000"  >&lt;p&gt;Indeed, the patch was pretty simple, sorry for not having had a look at it before commenting.&lt;br/&gt;
The patch does look good to me too.&lt;br/&gt;
I&apos;m wondering if someday we could have some use for this syntax though, but that&apos;s another story &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; (and we can reenable things later if needed anyway)&lt;br/&gt;
Otherwise, the error message is okay to me.&lt;br/&gt;
The sole thing I&apos;m wondering about it is: &quot;list of expressions&quot;. &lt;span class=&quot;error&quot;&gt;&amp;#91;a, b, c&amp;#93;&lt;/span&gt; is also a list of expressions. So perhaps we should just say a &quot;closure list of the form (a; b; c)&quot; is not supported in this context?&lt;/p&gt;</comment>
                            <comment id="14469662" author="roshandawrani" created="Mon, 21 Jun 2010 03:33:10 +0000"  >&lt;p&gt;But on the face of it, &quot;(a;b;c)&quot; and even &quot;for(int i=0; i&amp;lt;1;i++)&quot; don&apos;t really to seem to have anything to do with the closures, I think.&lt;/p&gt;

&lt;p&gt;How about &quot;expression list of the form (a; b; c) is not supported in this context&quot;?&lt;/p&gt;</comment>
                            <comment id="14469619" author="guillaume" created="Mon, 21 Jun 2010 03:41:26 +0000"  >&lt;p&gt;&quot;expression list of the form (a; b; c) is not supported in this context&quot; sounds good to me.&lt;/p&gt;</comment>
                            <comment id="14469647" author="roshandawrani" created="Mon, 21 Jun 2010 07:21:34 +0000"  >&lt;p&gt;Done.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722565" name="4252_v17x.patch" size="2063" author="roshandawrani" created="Sat, 19 Jun 2010 05:26:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2chen:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>