<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:07:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-2966] IllegalArgumentException from @Bindable AST Transformation with Integer properties</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-2966</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;If you decorate a class ( I suppose a property would do ) with @Bindable using the new 1.6 AST Transformations, Integer property changes that happen via setter will cause an IllegalArgumentException because the firePropertyChange method will be called using the String,int,int signature. If the property or the new value is null, obviously, this is not a legal state. Of course, if the field is initialized and never set to null, this never happens.&lt;/p&gt;

&lt;p&gt;A test case for the groovy console:&lt;/p&gt;

&lt;p&gt;// start&lt;/p&gt;

&lt;p&gt;@groovy.beans.Bindable&lt;br/&gt;
class Test {&lt;br/&gt;
    String foo&lt;br/&gt;
    Integer bar&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;def t = new Test()&lt;/p&gt;

&lt;p&gt;// this is ok&lt;br/&gt;
t.foo = &apos;foo&apos;&lt;/p&gt;

&lt;p&gt;// this is not&lt;br/&gt;
t.bar = 10&lt;/p&gt;

&lt;p&gt;// end&lt;/p&gt;

&lt;p&gt;the proposed fix for groovy.beans.BindableASTTransformation.java:&lt;/p&gt;

&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Creates a statement body similar to:&lt;/li&gt;
	&lt;li&gt;&amp;lt;code&amp;gt;&lt;/li&gt;
	&lt;li&gt;Object oldValue = field&lt;/li&gt;
	&lt;li&gt;field = value&lt;/li&gt;
	&lt;li&gt;pcsField.firePropertyChange(&quot;field&quot;, (Object) oldValue, value)&lt;/li&gt;
	&lt;li&gt;&amp;lt;/code&amp;gt;&lt;br/&gt;
     *&lt;/li&gt;
	&lt;li&gt;@param propertyNode           the field node for the property&lt;/li&gt;
	&lt;li&gt;@param fieldExpression a field expression for setting the property value&lt;/li&gt;
	&lt;li&gt;@return the created statement&lt;br/&gt;
     */&lt;br/&gt;
    protected Statement createBindableStatement(PropertyNode propertyNode, Expression fieldExpression) {&lt;br/&gt;
        // create statementBody&lt;br/&gt;
        BlockStatement bs = new BlockStatement();&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;        bs.addStatement(new ExpressionStatement(&lt;br/&gt;
            new DeclarationExpression(new VariableExpression(&quot;oldValue&quot;),&lt;br/&gt;
                Token.newSymbol(Types.EQUALS, 0, 0),&lt;br/&gt;
                fieldExpression)));		&lt;br/&gt;
        bs.addStatement(new ExpressionStatement(&lt;br/&gt;
            new BinaryExpression(fieldExpression, &lt;br/&gt;
                Token.newSymbol(Types.EQUAL, 0, 0), &lt;br/&gt;
                new VariableExpression(&quot;value&quot;))));		&lt;br/&gt;
        bs.addStatement(new ExpressionStatement(new MethodCallExpression(&lt;br/&gt;
            new FieldExpression(pcsField), &quot;firePropertyChange&quot;, &lt;br/&gt;
            new ArgumentListExpression(new Expression[] &lt;/p&gt;
{
                new ConstantExpression(propertyNode.getName()),
                new CastExpression(ClassHelper.OBJECT_TYPE, new VariableExpression(&quot;oldValue&quot;), true),
                new VariableExpression(&quot;value&quot;)
            }
&lt;p&gt;))));&lt;/p&gt;

&lt;p&gt;        return bs;&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;Move to the slightly more standard/common/I-don&apos;t-really-know-if-it-matters-or-not way of firing property change events i.e. already have the property set to the new value in case the listener uses that in some way. Also, cast the &quot;old&quot; value to an Object so that it will select the proper method signature.&lt;/p&gt;

&lt;p&gt;I am by no means an expert here, so there may be other changes needed to make this compatible with java 1.4, or whatever the compatibility target is, like casting both values, or doing some manual boxing. My AST may be horribly inefficient... I have no idea.&lt;/p&gt;</description>
                <environment>OpenSUSE 11.0 java 1.6.0_06 groovy 1.6 beta1</environment>
        <key id="12818361">GROOVY-2966</key>
            <summary>IllegalArgumentException from @Bindable AST Transformation with Integer properties</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="evschris">Chris Reeves</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Jul 2008 12:38:11 +0000</created>
                <updated>Fri, 22 Aug 2008 10:25:34 +0000</updated>
                            <resolved>Fri, 22 Aug 2008 10:25:34 +0000</resolved>
                                                    <fixVersion>1.5.7</fixVersion>
                    <fixVersion>1.6-beta-2</fixVersion>
                                    <component>groovy-jdk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14478268" author="evschris" created="Mon, 28 Jul 2008 14:47:31 +0000"  >&lt;p&gt;Along the same vein, I had a need for user supplied setters to be decorated/visited, so I changed the following:&lt;/p&gt;

&lt;p&gt;    private void createListenerSetter(SourceUnit source, AnnotationNode node, ClassNode classNode, PropertyNode propertyNode) {&lt;br/&gt;
        String setterName = &quot;set&quot; + MetaClassHelper.capitalize(propertyNode.getName());&lt;/p&gt;

&lt;p&gt;        List setters = classNode.getMethods(setterName);&lt;br/&gt;
        Expression fieldExpression = new FieldExpression(propertyNode.getField());&lt;/p&gt;

&lt;p&gt;        if (setters.isEmpty()) &lt;/p&gt;
{
            Statement setterBlock = createBindableStatement(propertyNode, fieldExpression);

            // create method void &amp;lt;setter&amp;gt;(&amp;lt;type&amp;gt; fieldName)
            createSetterMethod(classNode, propertyNode, setterName, setterBlock);
        }
&lt;p&gt; else {&lt;br/&gt;
            for (Object o : setters) {&lt;br/&gt;
                MethodNode setter = (MethodNode) o;&lt;br/&gt;
                Parameter firstTarget = null;&lt;/p&gt;

&lt;p&gt;                // look through the list of setters returned&lt;br/&gt;
                // we&apos;ll decorate all of the matching ones&lt;br/&gt;
                for (Parameter param : setter.getParameters()) {&lt;br/&gt;
                    if (param.getOriginType().equals(propertyNode.getOriginType())) &lt;/p&gt;
{
                            firstTarget = param;
                            break;
                    }
&lt;p&gt;                }&lt;/p&gt;

&lt;p&gt;                // found one, so decorate it&lt;br/&gt;
                if (firstTarget != null) {&lt;br/&gt;
                    Statement code = setter.getCode();&lt;/p&gt;

&lt;p&gt;                    BlockStatement block = new BlockStatement();&lt;/p&gt;

&lt;p&gt;                    // set up a local variable to hold the current value&lt;br/&gt;
                    block.addStatement(new ExpressionStatement(&lt;br/&gt;
                        new DeclarationExpression(new VariableExpression(&quot;_&lt;em&gt;oldValue&lt;/em&gt;_&quot;),&lt;br/&gt;
                            Token.newSymbol(Types.EQUALS, 0, 0),&lt;br/&gt;
                            fieldExpression)));&lt;/p&gt;

&lt;p&gt;                    // call the existing block, which will presumably set the value properly&lt;br/&gt;
                    // if we were really thorough, we could look through the current statements&lt;br/&gt;
                    // and make sure there is an assignment somewhere in there, but we&apos;ll assume&lt;br/&gt;
                    // that if they want it to be bindable, they&apos;ll follow some semblance of convention&lt;br/&gt;
                    block.addStatement(code);&lt;/p&gt;

&lt;p&gt;                    // add the firePropertyChange method call&lt;br/&gt;
                    block.addStatement(new ExpressionStatement(new MethodCallExpression(&lt;br/&gt;
                        new FieldExpression(pcsField), &quot;firePropertyChange&quot;, &lt;br/&gt;
                        new ArgumentListExpression(new Expression[] &lt;/p&gt;
{
                            new ConstantExpression(propertyNode.getName()),
                            new CastExpression(ClassHelper.OBJECT_TYPE, new VariableExpression(&quot;__oldValue__&quot;), true),
                            new VariableExpression(firstTarget.getName())
                        }
&lt;p&gt;))));&lt;/p&gt;

&lt;p&gt;                    // replace the existing AST with our newer, stronger, faster, aloofer code                    &lt;br/&gt;
                    setter.setCode(block);&lt;/p&gt;

&lt;p&gt;                    // aloofer? is that even a word?&lt;br/&gt;
                    // we can make it one. we have the technology&lt;br/&gt;
                }&lt;br/&gt;
            }&lt;br/&gt;
        }&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;I am attaching it to this jira, because it uses the same convention change, and I don&apos;t know if the original author of this code left this functionality out for a specific reason. I suppose I could also add a search and decorate function for entirely virtual functions, should anyone need that ( probably me if groovy doesn&apos;t already create propertynodes for those ).&lt;/p&gt;

&lt;p&gt;Quick question: I&apos;m new to this sort of thing ( jiras and bug fixes and trying to contribute poorly written features ), so is this the proper place to post this?&lt;/p&gt;</comment>
                            <comment id="14465060" author="blackdrag" created="Mon, 28 Jul 2008 17:56:16 +0000"  >&lt;p&gt;the amount of code makes it a bit difficult to see what you changed and even where thi changes applies to. Could you create a patch? But all in all I can say that that if String,int,int is used atm, and it should be String,Object,Object, then two casts are missing... I guess you added this.. at last I can see new CastExpression(ClassHelper.OBJECT_TYPE, ... but why is it pcs.firePropertyChange(&quot;bar&quot;,(Object) _&lt;em&gt;oldValue&lt;/em&gt;&lt;em&gt;, &quot;setBar&quot;) ? I would have expected to see pcs.firePropertyChange(&quot;bar&quot;,(Object) __oldValue&lt;/em&gt;_, newValue)... also java.beans.PropertyChangeSupport does support already String,int,int so there should be no problem at all. MAybe it would to see what the IllegalArgument exception actually has as stack and message&lt;/p&gt;</comment>
                            <comment id="14478263" author="evschris" created="Tue, 29 Jul 2008 07:39:00 +0000"  >&lt;p&gt;If you reformat the sample code so that it will actually run in the console, then it will produce the following output:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Exception thrown: java.lang.IllegalArgumentException

java.lang.IllegalArgumentException
	at Test.setBar(Script4)
	at Test.setProperty(Script4)
	at Script4.run(Script4:13)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The reason is that the property value is currently null, but since it is an Integer, the autoboxer in java 5+ is trying to use the int signature of the method, which tries to unbox a null Integer, which is invalid... an IllegalArgument.&lt;/p&gt;

&lt;p&gt;As for the AST, it is casting only the first parameter as an Object, so the second will automatically be demoted to an Object. I just left out one code to lessen verbosity. It is already quite hard to read and follow. It is producing the following code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void getBar(Type value) {
  Type __oldValue__ = bar;
  bar = value;
  pcs.firePropertyChange(&lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;, __oldValue__, value);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I will clean up my code and see if I can&apos;t produce a reasonable patch with my changes. By the way, hopefully this post will be formatted better, as I&apos;m trying out some of the pseudo-tags.&lt;/p&gt;</comment>
                            <comment id="14465156" author="evschris" created="Tue, 29 Jul 2008 07:40:22 +0000"  >&lt;p&gt;Oops, forgot the cast in the generated code, so it is actually:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void getBar(Type value) {
  Type __oldValue__ = bar;
  bar = value;
  pcs.firePropertyChange(&lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;, (&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;) __oldValue__, value);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14465133" author="blackdrag" created="Tue, 29 Jul 2008 09:22:55 +0000"  >&lt;p&gt;ah sorry... the call fails because bar is null and a method with String,int,int is called....now I get it. but then this looks to me as a bug in the method selection. Because if no method can be selected that is valid, then a MissingMethodException should have be thrown. And a method call with the arguments String,null,Integer is incompatible to a method with the parameter types String,int,int. The following example reproduces the problem&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def foo(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; a,&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i1, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i2) {1}
def foo(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; b,&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; o1, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; o2) {2}
println foo(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,2)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; But I doubt that your citation of the generated code is correct... If I change my example and cast null to Object, then the right method is used, so I guess that would fix the broken method selection. But the goal is not to introduce work arounds, but to fix the issue if possible.&lt;/p&gt;
</comment>
                            <comment id="14465098" author="blackdrag" created="Tue, 29 Jul 2008 09:23:43 +0000"  >&lt;p&gt;I am setting this bug priority to blocker now, because the issues shows a bug in the method selection process, which is to be seen as critical in my eyes.&lt;/p&gt;</comment>
                            <comment id="14465034" author="blackdrag" created="Tue, 29 Jul 2008 09:24:28 +0000"  >&lt;p&gt;it should be confirmed if 1.5.6 has the same problem or if it is new in 1.6&lt;/p&gt;</comment>
                            <comment id="14465112" author="blackdrag" created="Tue, 29 Jul 2008 09:26:26 +0000"  >&lt;p&gt;I confirmed that this is a bug for 1.5.6 as well, so I am adding 1.5.7 as fix target&lt;/p&gt;</comment>
                            <comment id="14465199" author="blackdrag" created="Thu, 14 Aug 2008 13:53:30 +0000"  >&lt;p&gt;I just fixed the method selection bug in 1.6 and now your example works as expected.&lt;/p&gt;</comment>
                            <comment id="14465184" author="blackdrag" created="Fri, 22 Aug 2008 10:25:34 +0000"  >&lt;p&gt;I merged back the fix into 1.5.7 too now, so I will close this issue&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 14 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bxr3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>