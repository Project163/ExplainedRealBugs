<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:15:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-2717] Groovyc ignores includeAntRuntime when not forked.</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-2717</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I have an issue with the joint compiler in non-fork mode. The includeAntRuntime property is ignored and the antruntime is always included. This is different to the ant javac task. It is one if the strange things of ant that the antruntime is included by default. But not being able to turn it off is a problem.  Basically this means you have to fork groovyc when you want to have a sane build.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12814181">GROOVY-2717</key>
            <summary>Groovyc ignores includeAntRuntime when not forked.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="hans_d">Hans Dockter</reporter>
                        <labels>
                    </labels>
                <created>Sun, 30 Mar 2008 14:46:09 +0000</created>
                <updated>Tue, 7 Apr 2015 19:12:52 +0000</updated>
                            <resolved>Mon, 22 Mar 2010 23:18:38 +0000</resolved>
                                                    <fixVersion>1.7.2</fixVersion>
                    <fixVersion>1.8-beta-1</fixVersion>
                                    <component>Ant integration</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14464524" author="hans_d" created="Sun, 30 Mar 2008 15:00:58 +0000"  >&lt;p&gt;I was wrong. Groovyc is &lt;em&gt;not&lt;/em&gt; ignoring the includeAntRuntime property in non fork mode. This issue can be closed. Sorry.&lt;/p&gt;</comment>
                            <comment id="14465496" author="hans_d" created="Mon, 3 Nov 2008 02:17:38 +0000"  >&lt;p&gt;I reopen the issue. I have observed the following behavior:&lt;/p&gt;

&lt;p&gt;Ant Groovyc only takes includeAntRuntime=false into account if fork is set to true. Considering the fact, that the default for fork is false, this is a clear invitation to classloader hell. In particular, as Ant Javac considers includeAntRuntime=false in fork as well as non-fork mode and I guess this is what people would expect from groovyc as well. People using Groovy are also likely to use Groovyc via the AntBuilder from an application, which makes the issue even more critical, as the classpath then has usually more entries then just the ant libs. &lt;/p&gt;

&lt;p&gt;The nested javac task of Groovyc takes includeAntRuntime into account. At least if I run my tests from compiled classes. If I run the script with the AntBuilder code via &apos;groovy bugtest.groovy&apos; the includeAntRuntime has no effect on the nested javac task. For groovy-1.6-beta-1 I have observed, that the includeAntRuntime property can&apos;t be set any longer for the nested javac task.  &lt;/p&gt;</comment>
                            <comment id="14465488" author="shemnon" created="Mon, 3 Nov 2008 13:34:22 +0000"  >&lt;p&gt;What&apos;s really lacking here is a unit test or a self-contained example of how to trip it up so it can be created out of context of Gradle or GMaven or whatever else is tripping things up.  I have a possible fix, but I am not sure if it would work and this would create a frustrating game of check-in ping-pong without some way to verify it myself.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Index: src/main/org/codehaus/groovy/ant/Groovyc.java
===================================================================
--- src/main/org/codehaus/groovy/ant/Groovyc.java	(revision 13862)
+++ src/main/org/codehaus/groovy/ant/Groovyc.java	Mon Nov 03 12:27:18 MST 2008
@@ -837,7 +837,9 @@
 
 
     &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; GroovyClassLoader buildClassLoaderFor() {
-        &lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; parent = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getClass().getClassLoader();
+        &lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; parent = getIncludeantruntime()
+            ? &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getClass().getClassLoader()
+            : &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AntClassLoader(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyClassLoader(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;), getProject(), getClasspath());
         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (parent &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; AntClassLoader) {
             AntClassLoader antLoader = (AntClassLoader) parent;
             &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] pathElm = antLoader.getClasspath().split(File.pathSeparator);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Patch is against 1.7-SNAPSHOT (svn head) could be tweaked to go against 1.6 branch and (with a bit mroe tweaking) 1.5.&lt;/p&gt;</comment>
                            <comment id="14465526" author="hans_d" created="Mon, 3 Nov 2008 14:06:18 +0000"  >&lt;p&gt;Thanks for looking into this. I will try to attach a test case tomorrow or the day after.&lt;/p&gt;</comment>
                            <comment id="14478404" author="paulk" created="Wed, 31 Dec 2008 05:06:53 +0000"  >&lt;p&gt;Hans, any luck getting time to look at this proposed fix?&lt;/p&gt;</comment>
                            <comment id="14466053" author="hans_d" created="Mon, 5 Jan 2009 02:53:26 +0000"  >&lt;p&gt;My apologies for having forgotten about the test case. Here it is now. The zip contains a project. The project has a src dir with one groovy class. This class has a reference to a class from commons-math. The testscript uses the groovyc ant task, to compile the source class. No classpath elements have been assigned to the groovyc task.&lt;/p&gt;

&lt;p&gt;If you execute the test script with &lt;tt&gt;groovy testscript.groovy&lt;/tt&gt;, the compile fails, as it should be. There is no commons-math in the classpath.&lt;/p&gt;

&lt;p&gt;If you execute the test script with &lt;tt&gt;groovy -cp lib/commons-math-1.1.jar testscript.groovy&lt;/tt&gt;, the compile succeeds. This should not be the case, as we have set includeAntRuntime to false. If the isolation were working, you would need to assign the groovy and commons-math jar to the groovyc classpath to have a successful compile.  &lt;/p&gt;

&lt;p&gt;I had no time yet to give the above patch a try by myself.&lt;/p&gt;</comment>
                            <comment id="14469190" author="paulk" created="Mon, 22 Mar 2010 23:18:38 +0000"  >&lt;p&gt;I have applied a modified version of Danno&apos;s suggested patch. It seems to work for me for the test cases I have devised. It would be great if someone else can try this out (grab trunk or a CI server output artifact).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12721496" name="groovycbug.zip" size="154489" author="hans_d" created="Mon, 5 Jan 2009 02:48:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 36 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ca2v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>