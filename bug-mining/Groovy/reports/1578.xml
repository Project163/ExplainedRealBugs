<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:22:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-5030] Calling a method overwritten via metaClass from another method uses the original (non-overwritten) method if the overridden class extends something</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-5030</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Hi Everyone&lt;/p&gt;

&lt;p&gt;I&apos;m using Groovy 1.8.2, and there&apos;s a variant of &lt;a href=&quot;http://jira.codehaus.org/browse/GROOVY-4884&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jira.codehaus.org/browse/GROOVY-4884&lt;/a&gt;.  This code fails for me:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.Test;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;BreakingExample_NoMetaclassOverride {
   @Test
   void testNotOverriden() {
      def list = []
      ClassUnderTest cut = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ClassUnderTest()
      cut.metaClass.getRemoteObject = { -&amp;gt;
         &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; [method: {obj -&amp;gt; 
            list &amp;lt;&amp;lt; obj
         }] as RemoteObject
      }
      
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; val = &lt;span class=&quot;code-quote&quot;&gt;&quot;Value&quot;&lt;/span&gt; 
      cut.someMethod(val)
      &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; list == [val]
   }
}

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ClassUnderTest &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; RemoteObject {
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; def someMethod(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; someValue) {
      RemoteObject object = getRemoteObject()
      object.method(someValue)
   }
   &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; RemoteObject getRemoteObject() {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RemoteObject()
   }
}

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;RemoteObject {
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void method(obj) { &lt;span class=&quot;code-comment&quot;&gt;/* Something */&lt;/span&gt; }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The only difference between this and #4884 is the &quot;extends RemoteObject&quot; added to ClassUnderTest.  With it in, the test fails.  Remove it, the test passes.&lt;/p&gt;

&lt;p&gt;Please let me know if you need any more info!&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Jason Griffith&lt;/p&gt;</description>
                <environment></environment>
        <key id="12815882">GROOVY-5030</key>
            <summary>Calling a method overwritten via metaClass from another method uses the original (non-overwritten) method if the overridden class extends something</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roshandawrani">Roshan Dawrani</assignee>
                                    <reporter username="jason@bobberinteractive.com">Jason Griffith</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 Sep 2011 20:57:44 +0000</created>
                <updated>Fri, 14 Oct 2011 00:28:05 +0000</updated>
                            <resolved>Wed, 21 Sep 2011 02:35:56 +0000</resolved>
                                    <version>1.8.2</version>
                                    <fixVersion>1.8.3</fixVersion>
                    <fixVersion>1.9-beta-4</fixVersion>
                                    <component>primtive opts</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14471789" author="roshandawrani" created="Mon, 19 Sep 2011 22:40:02 +0000"  >&lt;p&gt;The issue is related to new optimization logic that determines whether to take a fast path or a slow path. I think Verifier#addFastPathHelperFieldsAndHelperMethod() and DGM#disablePrimitiveOptimization() are a little inconistently written.&lt;/p&gt;

&lt;p&gt;Say, we have class B inheriting from A.&lt;/p&gt;

&lt;p&gt;Verifier#addFastPathHelperFieldsAndHelperMethod() sees that A has the static field __$stMC (used in optimization related guards) because it also looks at super classes and then doesn&apos;t add it to B.&lt;/p&gt;

&lt;p&gt;On the other hand, DGM#disablePrimitiveOptimization() tries to set __$stMC on the current class only. But in above case, no __$stMC is added to class B, and attempt to disable the optimizations goes wasted (with NoSuchFieldException), and later on when that flag is looked at to see whether to dispatch the method call in &quot;RemoteObject object = getRemoteObject()&quot; in a fast way or slow way, it chooses the fast path because it finds the optimization still enabled by mistake.&lt;/p&gt;

&lt;p&gt;So, here is a patch that removes the above inconsistency between Verifier and DGM:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@@ -17790,15 +17790,21 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;DefaultGroovyMethods &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; DefaultGroovyMethodsSupport {
     }
 
     &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void disablePrimitiveOptimization(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; self) {
         Field sdyn;
         &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; c = self.getClass();
-        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
-            sdyn = c.getDeclaredField(Verifier.STATIC_METACLASS_BOOL);
-            sdyn.setBoolean(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
-        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) {
-            &lt;span class=&quot;code-comment&quot;&gt;//DO NOTHING
&lt;/span&gt;+        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (c != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+                sdyn = c.getDeclaredField(Verifier.STATIC_METACLASS_BOOL);
+                sdyn.setBoolean(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
+                &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
+            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (NoSuchFieldException e) {
+               c = c.getSuperclass();
+               &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
+            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) {
+                &lt;span class=&quot;code-comment&quot;&gt;//DO NOTHING
&lt;/span&gt;+            }
         }
     }
 
     /**
      * Sets/updates the metaclass &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a given &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;to a closure.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Although I personally think it&apos;s the code in Verifier that is wrong and in adding the static field __$stMC, it should not look at super classes. Depends on bytecode optimization enabling/disabled is designed keeping what kind of behavior in mind when it comes to inheritence. If from A inherit B and C and we do some metaclass stuff to B (and hence disable the optimization in B), in current implementation it may disable the optimization for C also, I think, because the guard pick-up the information from A&apos;s __$stMC static field.&lt;/p&gt;</comment>
                            <comment id="14471769" author="blackdrag" created="Tue, 20 Sep 2011 06:37:34 +0000"  >&lt;p&gt;Roshan you are completely right about the Verifier I would say. In B extends A I don&apos;t want to disable optimizations for A, just because B got changed. &lt;/p&gt;</comment>
                            <comment id="14471799" author="roshandawrani" created="Wed, 21 Sep 2011 02:35:56 +0000"  >&lt;p&gt;Fixed by changing Verifier as discussed.&lt;/p&gt;</comment>
                            <comment id="14471882" author="jason@bobberinteractive.com" created="Thu, 29 Sep 2011 23:02:13 +0000"  >&lt;p&gt;Tested the latest 1.8.3 snapshot with this bug - it&apos;s fixed on our end.&lt;/p&gt;

&lt;p&gt;It was very impressive how quickly you guys jumped on this and fixed it.  Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cfin:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>