<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:04:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-9409] org.codehaus.groovy.runtime.callsite.GroovySunClassLoader is unusable</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-9409</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The singleton class loader supposedly defined by &lt;tt&gt;org.codehaus.groovy.runtime.callsite.GroovySunClassLoader&lt;/tt&gt; cannot be used. The creation of the instance fails with a &lt;tt&gt;ClassFormatError&lt;/tt&gt;. The attached Java code demonstrates the issue:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ javac -classpath $HOME/.m2/repository/org/codehaus/groovy/groovy/3.0.0/groovy-3.0.0.jar Example.java 
$ java -classpath .:$HOME/.m2/repository/org/codehaus/groovy/groovy/3.0.0/groovy-3.0.0.jar Example
GroovySunClassLoader.sunVM = null
Creating a new GroovySunClassLoader ...
Exception in thread &quot;main&quot; java.lang.ClassFormatError: Absent Code attribute in method that is not native or abstract in class file org/codehaus/groovy/runtime/callsite/AbstractCallSite
	at java.lang.ClassLoader.defineClass1(Native Method)
	at java.lang.ClassLoader.defineClass(ClassLoader.java:763)
	at java.lang.ClassLoader.defineClass(ClassLoader.java:642)
	at org.codehaus.groovy.reflection.SunClassLoader.define(SunClassLoader.java:95)
	at org.codehaus.groovy.runtime.callsite.GroovySunClassLoader.loadAbstract(GroovySunClassLoader.java:69)
	at org.codehaus.groovy.runtime.callsite.GroovySunClassLoader.&amp;lt;init&amp;gt;(GroovySunClassLoader.java:51)
	at Example$1.&amp;lt;init&amp;gt;(Example.java:7)
	at Example.main(Example.java:7)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13286181">GROOVY-9409</key>
            <summary>org.codehaus.groovy.runtime.callsite.GroovySunClassLoader is unusable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="widemann">Baltasar Trancon Widemann</reporter>
                        <labels>
                            <label>ClassFormatError</label>
                    </labels>
                <created>Wed, 19 Feb 2020 09:18:53 +0000</created>
                <updated>Sun, 22 May 2022 16:00:42 +0000</updated>
                            <resolved>Fri, 21 Feb 2020 02:13:42 +0000</resolved>
                                    <version>3.0.0</version>
                                    <fixVersion>2.5.10</fixVersion>
                    <fixVersion>4.0.0-alpha-1</fixVersion>
                    <fixVersion>3.0.2</fixVersion>
                                    <component>bytecode</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17039827" author="widemann" created="Wed, 19 Feb 2020 09:22:14 +0000"  >&lt;p&gt;The cause of this bug appears to be in the following method:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    private void loadAbstract() throws IOException {
        try (final InputStream asStream = GroovySunClassLoader.class.getClassLoader().getResourceAsStream(resName(&quot;org.codehaus.groovy.runtime.callsite.AbstractCallSite&quot;))) {
            ClassReader reader = new ClassReader(asStream);
            final ClassWriter cw = new ClassWriter(ClassWriter.COMPUTE_MAXS);
            final ClassVisitor cv = new ClassVisitor(CompilerConfiguration.ASM_API_VERSION, cw) {
                public void visit(int version, int access, String name, String signature, String superName, String[] interfaces) {
                    super.visit(version, access, name, signature, &quot;sun/reflect/GroovyMagic&quot;, interfaces);
                }
            };
            reader.accept(cv, ClassWriter.COMPUTE_MAXS);
            define(cw.toByteArray(), &quot;org.codehaus.groovy.runtime.callsite.AbstractCallSite&quot;);
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The ASM method &lt;tt&gt;ClassReader.accept&lt;/tt&gt; does not expect the option flag &lt;tt&gt;ClassWriter.COMPUTE_MAXS&lt;/tt&gt;, but understands the numerical equivalent &lt;tt&gt;ClassReader.SKIP_CODE&lt;/tt&gt;. This results in an invalid class file byte array being passed to &lt;tt&gt;ClassLoader.define&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17040883" author="paulk" created="Thu, 20 Feb 2020 11:41:30 +0000"  >&lt;p&gt;Nice detective work. I found that &lt;tt&gt;ClassReader.SKIP_CODE&lt;/tt&gt; gave the same result for me but turns out is what we need. Using 0 or SKIP_DEBUG made your example pass.&lt;/p&gt;</comment>
                            <comment id="17041038" author="blackdrag" created="Thu, 20 Feb 2020 14:42:07 +0000"  >&lt;p&gt;FYI: The reason this code exists is to provide a classloader we can use when generating callsite helper classes at runtime, that bypass bytecode verification.   Not because the bytecode we produce may be wrong and we want to still pass it, it is to safe the time the verifier takes to speed up the one-time costs when invoking a method in the old callsite caching. I am wondering if this can still work in a java9+ scenario. As the &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=widemann&quot; class=&quot;user-hover&quot; rel=&quot;widemann&quot;&gt;widemann&lt;/a&gt; got a ClassFormatError it is not yet fully clear if this is because of verification, or if here is a general upfront check you cannot bypass. Also the environment is still Java8, for which I expect this to still work. But in the end we may have to do changes here in the near future&lt;/p&gt;</comment>
                            <comment id="17041455" author="paulk" created="Fri, 21 Feb 2020 02:13:42 +0000"  >&lt;p&gt;The behavior for our use hasn&apos;t changed since it broke JDK8 when I tried but there is now an overloaded constructor that you could use to use different parsing options for your use case.&lt;/p&gt;

&lt;p&gt;But as Jochen alluded to, this is treated as mainly an internal class which in fact won&apos;t work under JDK11 anyway. We are likely to deprecate and remove this class at some point. In our current planning it won&apos;t be needed for internal use by Groovy 4 when we are all indy code based.&lt;/p&gt;</comment>
                            <comment id="17042358" author="daniel_sun" created="Sat, 22 Feb 2020 03:58:53 +0000"  >&lt;p&gt;As a side note, there are some other similar issues in groovy core code...&lt;/p&gt;</comment>
                            <comment id="17042369" author="paulk" created="Sat, 22 Feb 2020 04:44:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daniel_sun&quot; class=&quot;user-hover&quot; rel=&quot;daniel_sun&quot;&gt;daniel_sun&lt;/a&gt; Is there a particular example you have in mind?&lt;/p&gt;</comment>
                            <comment id="17042436" author="daniel_sun" created="Sat, 22 Feb 2020 07:44:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulk&quot; class=&quot;user-hover&quot; rel=&quot;paulk&quot;&gt;paulk&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Here is the PR trying to bump bytecode version to 1.8 and fix all of this kind of issues:&#160;&lt;a href=&quot;https://github.com/apache/groovy/pull/1103&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1103&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;But it is not merged finally.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12993864" name="Example.java" size="337" author="widemann" created="Wed, 19 Feb 2020 09:15:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 38 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0bnao:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>