<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:14:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-10239] GroovyCastException when @CompileStatic and !in keyword are used together</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-10239</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Dear colleagues,&lt;/p&gt;

&lt;p&gt;I&apos;ve recently updated my projects from 3.0.8 to 3.0.9 and I started getting some GroovyCastExceptions when trying to use &lt;b&gt;!in&lt;/b&gt; keyword along with CompileStatic annotation:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
org.codehaus.groovy.runtime.typehandling.GroovyCastException: Cannot cast object &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt; with class &lt;span class=&quot;code-quote&quot;&gt;&apos;java.lang.&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;&apos;&lt;/span&gt; to class &lt;span class=&quot;code-quote&quot;&gt;&apos;Xyz&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We realised that it only works on 3.0.9 if we remove the CompileStatic annotation(3.0.8 works with and without).&lt;/p&gt;

&lt;p&gt;Here&apos;s an example of how to reproduce the exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic

/**
 *  REMOVE @CompileStatic and the main method runs fine &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; both versions 3.0.8 and 3.0.9.
 * &lt;span class=&quot;code-quote&quot;&gt;&apos;Cannot cast object \&apos;&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;\&lt;span class=&quot;code-quote&quot;&gt;&apos; with class \&apos;&lt;/span&gt;java.lang.&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;\&lt;span class=&quot;code-quote&quot;&gt;&apos; to class \&apos;&lt;/span&gt;MyEnum\&apos;&apos;
 *  @CompileStatic only works with 3.0.8
 */
@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Groovy309Error {
    static void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
        &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; myObj = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MyObj(status: MyEnum.A)
        List&amp;lt;MyObj&amp;gt; items = [myObj]
        &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; newItems = items.findAll { it.status !&lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; [MyEnum.B] }
        println newItems
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;enum&lt;/span&gt; MyEnum {
    A, B
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyObj {
    MyEnum status
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
Please, forgive me if I missed something on the bug checklist but I think this ticket belongs here.&lt;br/&gt;
Thank you in advance&#160;&lt;/p&gt;</description>
                <environment>macOs Big Sur 11.5.2&lt;br/&gt;
2,6 GHz 6-Core Intel Core i7&lt;br/&gt;
Java 11.0.11/16.0.1 (probably reproducible in other version)</environment>
        <key id="13401747">GROOVY-10239</key>
            <summary>GroovyCastException when @CompileStatic and !in keyword are used together</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="rodolfo.yanke">Rodolfo Yanke</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Sep 2021 23:56:08 +0000</created>
                <updated>Thu, 3 Feb 2022 22:32:01 +0000</updated>
                            <resolved>Fri, 17 Sep 2021 17:35:25 +0000</resolved>
                                    <version>3.0.9</version>
                                    <fixVersion>4.0.0-beta-2</fixVersion>
                    <fixVersion>3.0.10</fixVersion>
                                    <component>Static compilation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17416744" author="emilles" created="Fri, 17 Sep 2021 14:57:00 +0000"  >&lt;p&gt;The expression &quot;&lt;tt&gt;!(it.status in &lt;span class=&quot;error&quot;&gt;&amp;#91;MyEnum.B&amp;#93;&lt;/span&gt;)&lt;/tt&gt;&quot; is using the type info from &quot;isCase&quot; method from &lt;tt&gt;DefaultGroovyMethods&lt;/tt&gt; which returns boolean.  The expression &quot;&lt;tt&gt;it.status !in &lt;span class=&quot;error&quot;&gt;&amp;#91;MyEnum.B&amp;#93;&lt;/span&gt;&lt;/tt&gt;&quot; is looking for &quot;isNotCase&quot; which is not defined.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;org.codehaus.groovy.transform.stc.StaticTypeCheckingVisitor#getResultType&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Besides using !(... in ...) you could define extension method like this to solve in the short term:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isNotCase(Collection caseValue, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; switchValue) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; !DefaultGroovyMethods.isCase(caseValue, switchValue);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17416828" author="emilles" created="Fri, 17 Sep 2021 17:35:25 +0000"  >&lt;p&gt;I also have a proposal that will provide similar static compilation for &lt;tt&gt;!in&lt;/tt&gt;&#160;as you would get for &lt;tt&gt;in&lt;/tt&gt;&#160;today:&#160;&lt;a href=&quot;https://github.com/apache/groovy/pull/1621&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1621&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17416934" author="rodolfo.yanke" created="Fri, 17 Sep 2021 21:37:25 +0000"  >&lt;p&gt;That was fast! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Thank you for the extension method tip!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                            <outwardlinks description="fixes">
                                        <issuelink>
            <issuekey id="13407274">GROOVY-10318</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>groovy</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 8 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0v0rs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>