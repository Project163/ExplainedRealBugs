<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:09:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-3161] Wrong initialization order for static fields in enums</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-3161</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;In an enum declaration, i&apos;m using a static list that holds references to the enum values. The list is not initialized correctly, all values are set to null instead of the expected enum.&lt;/p&gt;</description>
                <environment>Gentoo Linux, SUN JVM 1.6.0.10</environment>
        <key id="12814436">GROOVY-3161</key>
            <summary>Wrong initialization order for static fields in enums</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roshandawrani">Roshan Dawrani</assignee>
                                    <reporter username="jot1109">Jochen Hinrichsen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Nov 2008 04:41:44 +0000</created>
                <updated>Tue, 23 Dec 2008 05:58:07 +0000</updated>
                            <resolved>Fri, 19 Dec 2008 11:15:54 +0000</resolved>
                                    <version>1.5.6</version>
                    <version>1.5.7</version>
                    <version>1.6-beta-2</version>
                                    <fixVersion>1.6-rc-1</fixVersion>
                    <fixVersion>1.5.8</fixVersion>
                    <fixVersion>1.7-beta-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14465704" author="roshandawrani" created="Sat, 29 Nov 2008 12:56:28 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
    Attaching the patch for 1.5.8 as a partial fix. In 1.6, the same fix is resulting in&lt;br/&gt;
some errors and I am looking into them. If I am able to resolve them, I&apos;ll update the patches.&lt;/p&gt;

&lt;p&gt;The issue is related to Verifier pushing the static enum fields defined by user to the&lt;br/&gt;
beginning of the static init block of the enum class (before the enum values are initialized).&lt;/p&gt;

&lt;p&gt;When EnumVisitor visits an enum class node, it creates a &amp;lt;clinit&amp;gt;(static init) block &lt;br/&gt;
in which it defines the enum values. But when Verifier visits this class node later, if &lt;br/&gt;
it sees some static fields, it adds their AST statements to the beginning of the &amp;lt;clinit&amp;gt; block.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;enum&lt;/span&gt; GroovyColors {
    &lt;span class=&quot;code-comment&quot;&gt;// AST statements &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; following values are first added to &amp;lt;clinit&amp;gt; by EnumVisitor
&lt;/span&gt;    red, blue, green

    /* Later, ExpressionStatement &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Field gets moved by Verifier
    before the red/blue/green in &amp;lt;clinit&amp;gt; */
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; def ALL_COLORS = [red, blue, green]
}

&lt;span class=&quot;code-comment&quot;&gt;// since &amp;lt;clinit&amp;gt; has declaration of ALL_COLORS before red/blue/green are being 
&lt;/span&gt;set, instead of having the correct values, it has un-initialized &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; values.
println GroovyColors.ALL_COLORS
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here is the test case with which I have verified this partial fix:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Groovy3161Bug &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; GroovyTestCase {
    def void testStaticEnumFieldWithEnumValues() {
        def allColors = GroovyColors3161.ALL_COLORS
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; allColors.size == 3
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; allColors[0] == GroovyColors3161.red
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; allColors[1] == GroovyColors3161.blue
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; allColors[2] == GroovyColors3161.green
    }
}
&lt;span class=&quot;code-keyword&quot;&gt;enum&lt;/span&gt; GroovyColors3161 {
    red, blue, green
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; def ALL_COLORS = [red, blue, green]
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14465827" author="roshandawrani" created="Sun, 30 Nov 2008 01:52:08 +0000"  >&lt;p&gt;Attaching the fix for versions 1.6-RC-1 / 1.7-beta-1 and a revised patch for 1.5.8.&lt;/p&gt;

&lt;p&gt;Briefly, the fix applied is only this: If there are any explicitly declared static fields&lt;br/&gt;
inside an enum, their initialization inside the &amp;lt;clinit&amp;gt; block should not come&lt;br/&gt;
before the initialization of the enum values. Otherwise if such a static field uses enum&lt;br/&gt;
values, it does not see the initialized enum value.&lt;/p&gt;

&lt;p&gt;The changes have been made to org.codehaus.groovy.classgen.Verifier&apos;s addInitialization() and addFieldInitialization() methods to handle initializaton of static fields inside an enum a little differently.&lt;/p&gt;

&lt;p&gt;Hope it helps.&lt;/p&gt;

&lt;p&gt;rgds,&lt;br/&gt;
Roshan&lt;/p&gt;</comment>
                            <comment id="14465963" author="roshandawrani" created="Tue, 16 Dec 2008 12:15:11 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
If the attached patches can be reviewed, we can move forward on this issue one way or other.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Roshan&lt;/p&gt;</comment>
                            <comment id="14465840" author="blackdrag" created="Tue, 16 Dec 2008 15:34:40 +0000"  >&lt;p&gt;the patch is ok for me&lt;/p&gt;</comment>
                            <comment id="14465957" author="roshandawrani" created="Fri, 19 Dec 2008 11:15:54 +0000"  >&lt;p&gt;Fixed by ensuring that enum values are initialized before any static fields explicitly declared in the enum.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12721492" name="3161_v15x.diff" size="3716" author="roshandawrani" created="Sun, 30 Nov 2008 01:52:08 +0000"/>
                            <attachment id="12721351" name="3161_v16x.diff" size="3811" author="roshandawrani" created="Sun, 30 Nov 2008 01:52:08 +0000"/>
                            <attachment id="12721981" name="3161_v17x.diff" size="3861" author="roshandawrani" created="Sun, 30 Nov 2008 01:52:08 +0000"/>
                            <attachment id="12721854" name="EnumTest.groovy" size="291" author="jot1109" created="Thu, 20 Nov 2008 04:41:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 49 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bp0f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>