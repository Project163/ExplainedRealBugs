<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:24:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-4660] NPE in groovy.servlet.AbstractHttpServlet if deploy WAR to jetty </title>
                <link>https://issues.apache.org/jira/browse/GROOVY-4660</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I have generated a (non-grails) war using gsp&apos;s mapped to groovy.servlet.TemplateServlet. If I deploy the War to Tomcat it works. If I &lt;em&gt;unpack&lt;/em&gt; the war then it works in Jetty. But it fails with an NPE if I try to deploy it as a War with Jetty:&lt;/p&gt;

&lt;p&gt;2011-02-04 11:04:06.030:INFO:data-pump-comparator-04.04.01-dev:GroovyTemplate: Servlet groovy.servlet.TemplateServlet initialized on&lt;br/&gt;
 class groovy.text.GStringTemplateEngine&lt;br/&gt;
2011-02-04 11:04:06.030:WARN::/data-pump-comparator-04.04.01-dev/&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
        at java.io.File.&amp;lt;init&amp;gt;(File.java:222)&lt;br/&gt;
        at groovy.servlet.AbstractHttpServlet.getScriptUriAsFile(AbstractHttpServlet.java:306)&lt;br/&gt;
        at groovy.servlet.TemplateServlet.service(TemplateServlet.java:388)&lt;br/&gt;
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:820)&lt;br/&gt;
        at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:533)&lt;br/&gt;
        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:475)&lt;br/&gt;
        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:119)&lt;/p&gt;

&lt;p&gt;I think this is down to a problm in groovy.servlet.AbstractHttpServlet&lt;/p&gt;

&lt;p&gt;TemplateServlet.service does this:&lt;/p&gt;

&lt;p&gt;    File file = super.getScriptUriAsFile(request);&lt;/p&gt;

&lt;p&gt;AbstractHttpServlet.getScriptUriAsFile does this:&lt;br/&gt;
    String uri = getScriptUri(request);&lt;br/&gt;
    String real = servletContext.getRealPath(uri);&lt;br/&gt;
    return new File(real).getAbsoluteFile();&lt;/p&gt;

&lt;p&gt;The Javadocs for javax.servlet.ServletContext.getRealPath say:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;This method returns null&lt;/li&gt;
	&lt;li&gt;if the servlet container cannot translate the virtual path&lt;/li&gt;
	&lt;li&gt;to a real path for any reason (such as when the content is&lt;/li&gt;
	&lt;li&gt;being made available from a .war archive).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think that is why the failure happens. AFAIK it also happens with WebLogic (&lt;a href=&quot;http://groovy.329449.n5.nabble.com/Groovlet-GSP-NPE-when-deployed-as-a-war-to-Weblogic-td3320802.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://groovy.329449.n5.nabble.com/Groovlet-GSP-NPE-when-deployed-as-a-war-to-Weblogic-td3320802.html&lt;/a&gt;)&lt;/p&gt;</description>
                <environment>Jetty: 7.2.0.v20101020</environment>
        <key id="12817269">GROOVY-4660</key>
            <summary>NPE in groovy.servlet.AbstractHttpServlet if deploy WAR to jetty </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="guillaume">Guillaume Sauthier</assignee>
                                    <reporter username="paulcager">Paul Cager</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Feb 2011 06:19:58 +0000</created>
                <updated>Sun, 12 Feb 2012 04:03:10 +0000</updated>
                            <resolved>Thu, 2 Feb 2012 10:19:54 +0000</resolved>
                                    <version>1.7.6</version>
                                    <fixVersion>1.8.6</fixVersion>
                    <fixVersion>2.0-beta-3</fixVersion>
                                    <component>Groovlet / GSP</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14470735" author="guillaume" created="Fri, 4 Feb 2011 06:22:57 +0000"  >&lt;p&gt;So how do you suggest fixing this? (Even better, a patch is warmly welcome)&lt;/p&gt;</comment>
                            <comment id="14470770" author="paulcager" created="Fri, 4 Feb 2011 06:55:09 +0000"  >&lt;p&gt;Sure - I&apos;ll see if I can work out a patch.&lt;/p&gt;

&lt;p&gt;As far as I can see getScriptUriAsFile is used instead of getScriptUri so that the file&apos;s DateLastUpdated timestamp may be used to determine if the cache is out of date. I believe we&apos;d need to preserve that behaviour, but fall back to using a URI if the file is not available.&lt;/p&gt;</comment>
                            <comment id="14470871" author="paulcager" created="Wed, 9 Feb 2011 12:34:49 +0000"  >&lt;p&gt;Patch attached for you to look at.&lt;/p&gt;

&lt;p&gt;Summary:&lt;/p&gt;

&lt;p&gt;1)  Minor change to AbstractHttpServlet.getScriptUriAsFile so that it returns null (rather than an NPE) if getRealPath returns null.&lt;/p&gt;

&lt;p&gt;2)  Change to TemplateServlet so that if getScriptUriAsFile returns null it will read the template text using &lt;tt&gt;servletContext.getResource(name)&lt;/tt&gt; instead.&lt;/p&gt;

&lt;p&gt;3)  Change to TemplateServlet&apos;s caching, to allow for the fact that we might not have a File (when it checks file.dateLastModified).&lt;/p&gt;

&lt;p&gt;4)  Minor change to AbstractHttpServlet&apos;s test class.&lt;/p&gt;</comment>
                            <comment id="14472457" author="guillaume" created="Thu, 2 Feb 2012 10:19:54 +0000"  >&lt;p&gt;The patch needed to be applied somehow manually, as it couldn&apos;t be applied automatically, making me wonder from what exact version you made the patch, but anyway, I&apos;ve tried a groovlet and template in a war on Jetty, and it worked fine with the adapted patch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722727" name="GROOVY-4660.patch" size="15942" author="paulcager" created="Wed, 9 Feb 2011 12:34:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ckav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>