<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:42:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-6924] Runtime IncompatibleClassChangeError using with() on a JavaBean if @CompileStatic is used</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-6924</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Consider the following Java class:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; i;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyJavaBean {
	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; foo;
	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; bar;
	
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getFoo() {
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; foo;
	}
	
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setFoo(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; foo) {
		&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.foo = foo;
	}
	
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getBar() {
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; bar;
	}
	
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setBar(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; bar) {
		&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.bar = bar;
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the following Groovy class:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; i

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic;

@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;I {
  void doSomething() {
	  MyJavaBean bean = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MyJavaBean()
	  bean.with {
		  foo = &lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt;
		  bar = &lt;span class=&quot;code-quote&quot;&gt;&apos;bar&apos;&lt;/span&gt;
	  }
	  println &lt;span class=&quot;code-quote&quot;&gt;&quot;$bean.foo and $bean.bar&quot;&lt;/span&gt;
  }
  
  &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
	  &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; I().doSomething()
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you run it as a Groovy script, you get:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caught: java.lang.IncompatibleClassChangeError: Class i.MyJavaBean does not implement the requested interface groovy.lang.GroovyObject
java.lang.IncompatibleClassChangeError: Class i.MyJavaBean does not implement the requested interface groovy.lang.GroovyObject
	at i.I$_doSomething_closure1.doCall(I.groovy:10)
	at i.I$_doSomething_closure1.call(I.groovy)
	at i.I.doSomething(I.groovy:9)
	at i.I.main(I.groovy:17)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you remove the &lt;tt&gt;@CompileStatic&lt;/tt&gt; annotation from &lt;tt&gt;I&lt;/tt&gt; class, all works fine.&lt;/p&gt;

&lt;p&gt;On another project (the real one were I caught this), I get the same exception but with a different stack trace/error message:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.IncompatibleClassChangeError
	at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.setGroovyObjectProperty(ScriptBytecodeAdapter.java:528)
	at com.example.MyClass$_myMethod_closure4.doCall(MyClass.groovy:194)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The location is always an assignment within a &lt;tt&gt;with()&lt;/tt&gt; closure. Again, I can workaround this by removing static compilation from that method.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12811406">GROOVY-6924</key>
            <summary>Runtime IncompatibleClassChangeError using with() on a JavaBean if @CompileStatic is used</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="melix">C&#233;dric Champeau</assignee>
                                    <reporter username="mauromol">Mauro Molinari</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Jul 2014 02:49:53 +0000</created>
                <updated>Sat, 26 Jul 2014 01:44:23 +0000</updated>
                            <resolved>Wed, 16 Jul 2014 05:42:49 +0000</resolved>
                                    <version>2.3.3</version>
                    <version>2.4.0-beta-1</version>
                                    <fixVersion>2.3.4</fixVersion>
                                    <component>Static compilation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14476193" author="mauromol" created="Fri, 11 Jul 2014 02:39:34 +0000"  >&lt;p&gt;Unfortunately, I still have problems with this. Although the provided simple test case now works, in my real-world application I still get this exception if I don&apos;t mark the &lt;tt&gt;MyDao.placeOrder()&lt;/tt&gt;:method as &lt;tt&gt;CompileStatic(TypeCheckingMode.SKIP)&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.IncompatibleClassChangeError
	at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.setGroovyObjectProperty(ScriptBytecodeAdapter.java:528)
	at it.dcssrl.shop.purchase.dao.MyDao$_placeOrder_closure4.doCall(MyDao.groovy:193)
	at it.dcssrl.shop.purchase.dao.MyDao$_placeOrder_closure4.call(MyDao.groovy)
	at org.codehaus.groovy.runtime.DefaultGroovyMethods.with(DefaultGroovyMethods.java:235)
	at it.dcssrl.shop.purchase.dao.MyDao.placeOrder(MyDao.groovy:192)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I checked twice that I&apos;m actually using Groovy 2.3.4. Any idea?&lt;/p&gt;</comment>
                            <comment id="14476141" author="melix" created="Fri, 11 Jul 2014 02:42:32 +0000"  >&lt;p&gt;Unfortunately without any self contained example, this is going to be hard to fix. Could you try to create something that reproduces this?&lt;/p&gt;</comment>
                            <comment id="14476212" author="mauromol" created="Fri, 11 Jul 2014 03:11:26 +0000"  >&lt;p&gt;If I debug my real-world application, I get to this line: &lt;tt&gt;ScriptBytecodeAdapter.setGroovyObjectProperty(Object, Class, GroovyObject, String) line: 528&lt;/tt&gt;&lt;br/&gt;
Here, the receiver is of the actual type of my Java class (for instance: MyJavaBean) which of course does not implement the &lt;tt&gt;GroovyObject&lt;/tt&gt; interface. So, I don&apos;t know how I can get to this line, since &lt;tt&gt;receiver&lt;/tt&gt; should be a &lt;tt&gt;GroovyObject&lt;/tt&gt; but it&apos;s not actually. I guess there&apos;s some Groovy magic in there. Anyway, the call to &lt;tt&gt;receiver.setProperty(String, Object)&lt;/tt&gt; fails with the &lt;tt&gt;IncompatibleClassChangeError&lt;/tt&gt; message and this is somewhat expected (there&apos;s no &lt;tt&gt;setProperty&lt;/tt&gt; method on my actual Java class)..&lt;/p&gt;

&lt;p&gt;Maybe the actual difference between my real-world project and the simple use case is that the corresponding &lt;tt&gt;MyJavaBean&lt;/tt&gt; class is &lt;em&gt;not&lt;/em&gt; joint compiled with the Groovy compiler, since it comes from a plain Java project my Groovy project depends on.&lt;/p&gt;

</comment>
                            <comment id="14476116" author="mauromol" created="Fri, 11 Jul 2014 03:21:22 +0000"  >&lt;p&gt;Nope... I tried to create two separate Eclipse projects, a plain Java project with &lt;tt&gt;MyJavaBean&lt;/tt&gt; and a Groovy project depending on the first one, containing the Groovy class. Unfortunately, running it won&apos;t produce any error. I really don&apos;t know what to try than to reproduce on a smaller test case &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14476235" author="mauromol" created="Fri, 11 Jul 2014 03:35:42 +0000"  >&lt;p&gt;&lt;del&gt;Further details on the debugging: if I debug my real-world application, the &lt;tt&gt;receiver&lt;/tt&gt; object, as I said, is of the actual &quot;undecorated&quot; type &lt;tt&gt;MyJavaBean&lt;/tt&gt; (it does not have the &lt;tt&gt;metaClass&lt;/tt&gt; internal property, which is produced by Groovy I guess). Instead, in the use case, although the Eclipse debugger says the object is of type &lt;tt&gt;MyJavaBen&lt;/tt&gt;, if I inspect it I see that the only property is {{metaClass}, which stores all the decorations provided by Groovy.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;Another difference that I can think of is that in my real-world project, the &lt;tt&gt;MyJavaBean&lt;/tt&gt; instance is actually created by Hibernate after querying a database, hence it&apos;s not created with &lt;tt&gt;new&lt;/tt&gt; by myself.&lt;/p&gt;

&lt;p&gt;Another idea: why does my failing case throw an &lt;tt&gt;IncompatibleClassChangeError&lt;/tt&gt; from &lt;tt&gt;ScriptBytecodeAdapter.setGroovyObjectProperty()&lt;/tt&gt;, while the test case, before the fix, threw it directly from the &lt;tt&gt;doCall()&lt;/tt&gt; method of the inner class produced for the closure?&lt;/p&gt;</comment>
                            <comment id="14476127" author="melix" created="Fri, 11 Jul 2014 03:36:51 +0000"  >&lt;p&gt;&quot;So, I don&apos;t know how I can get to this line, since receiver should be a GroovyObject but it&apos;s not actually.&quot;&lt;/p&gt;

&lt;p&gt;That is precisely the reason why you have an &lt;tt&gt;IncompatibleClassChangeError&lt;/tt&gt;, the &lt;b&gt;bytecode&lt;/b&gt; invokes a call on this method. So to determine what path of the compiler generates such a call, I actually need a reproducible example, which I fail to find.&lt;/p&gt;</comment>
                            <comment id="14476175" author="mauromol" created="Fri, 11 Jul 2014 03:48:32 +0000"  >&lt;p&gt;Maybe providing you with the class files produced in my real-world application for &quot;MyDao&quot; Groovy class can help you in some way?&lt;/p&gt;</comment>
                            <comment id="14476159" author="melix" created="Fri, 11 Jul 2014 08:35:44 +0000"  >&lt;p&gt;Unfortunately no, it won&apos;t help. What I need is Groovy source code that produces bad bytecode. The compiled classes won&apos;t tell me anything &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14476118" author="mauromol" created="Wed, 16 Jul 2014 05:42:49 +0000"  >&lt;p&gt;After further investigation, it seems like the problem only happens when code is compiled with Greclipse, although the only Groovy JAR I have in my project build path is groovy-2.3.4.jar.&lt;br/&gt;
I opened GRECLIPSE-1760 for this, thanks C&#195;&#169;dric for your support.&lt;/p&gt;</comment>
                            <comment id="14476265" author="mauromol" created="Wed, 16 Jul 2014 05:43:19 +0000"  >&lt;p&gt;Ouch, there must be some encoding problem here :-P&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12817652">GROOVY-6926</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 18 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cgpr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>