<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:19:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-8863] Groovy compiler doesn&apos;t generate InnerClasses attribute for nested class names mentioned in the class file</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-8863</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;It seems that the Groovy compiler does not generate correct InnerClasses attributes when Groovy code uses inner classes, even if those are Java classes compiled separately.&lt;/p&gt;

&lt;p&gt;For example, the following code:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;class Test {&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; void f(Thread.State t) {&lt;/tt&gt;}&lt;br/&gt;
&lt;tt&gt;}&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;(where java.lang.Thread.State is just an example nested class from JDK) will compile by Groovy to a class file Test.class which has no InnerClasses attribute. If compiled by Java though, it has the following:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;InnerClasses:&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; public static final #10= #9 of #18; //State=class java/lang/Thread$State of class java/lang/Thread&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;While I&#160;couldn&apos;t find a statement requiring this attribute to be present for all nested classes mentioned in the class file in the JVMS, I believe &lt;a href=&quot;https://docs.oracle.com/javase/specs/jvms/se11/html/jvms-4.html#jvms-4.7.6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&#167;4.7.6&lt;/a&gt;&#160;sort of hints at that with the following:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;If the constant pool of a class or interface&#160;C&#160;contains at least one&#160;&lt;tt&gt;CONSTANT_Class_info&lt;/tt&gt;&#160;entry (&lt;a href=&quot;https://docs.oracle.com/javase/specs/jvms/se11/html/jvms-4.html#jvms-4.4.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&#167;4.4.1&lt;/a&gt;) which represents a class or interface that is not a member of a package, then there must be exactly one&#160;&lt;tt&gt;InnerClasses&lt;/tt&gt;&#160;attribute in the&#160;&lt;tt&gt;attributes&lt;/tt&gt;&#160;table of the&#160;&lt;tt&gt;ClassFile&lt;/tt&gt;&#160;structure for&#160;C.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;In this case, there&apos;s certainly a CONSTANT_Class_info entry in the Groovy-generated class file which represents a non-top-level class, but the InnerClasses attribute is missing, so I&apos;d say this violates the spec.&lt;/p&gt;

&lt;p&gt;We&apos;ve met this issue when refactoring the internal implementation of class file reader in the Kotlin compiler, where we &lt;a href=&quot;https://github.com/JetBrains/kotlin/commit/9df02b236620e413ef70cea0d1d8ed93cd0b474e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;got rid&lt;/a&gt;&#160;of the heuristic that calculated the full class name by replacing dollar characters with dots, and started to rely only on the InnerClasses attribute to correctly map JVM names to the &quot;real&quot; names of classes. This looked correct because at least class files generated by javac always have InnerClasses for all nested classes mentioned in the class file (not only in signatures, even those used only in method bodies!). However, for Groovy this &lt;a href=&quot;https://youtrack.jetbrains.com/issue/KT-27874&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;turned out&lt;/a&gt;&#160;not to be the case. We&apos;ll probably workaround this problem somehow, for example by attempting to determine the class name twice, first by InnerClasses attribute values and second, by the aforementioned heuristic, but it&apos;ll be nice to get rid of the latter code in the future once this issue is fixed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13194938">GROOVY-8863</key>
            <summary>Groovy compiler doesn&apos;t generate InnerClasses attribute for nested class names mentioned in the class file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="udalov">Alexander Udalov</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Oct 2018 18:39:46 +0000</created>
                <updated>Sat, 23 Jul 2022 21:05:49 +0000</updated>
                            <resolved>Wed, 13 Jul 2022 19:56:35 +0000</resolved>
                                    <version>2.5.3</version>
                                    <fixVersion>4.0.4</fixVersion>
                                    <component>Compiler</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16696259" author="paulk" created="Thu, 22 Nov 2018 20:55:26 +0000"  >&lt;p&gt;I had a quick look at this. I did a quick spike to see if we could hack AsmClassGenerator. I added an additional call to cv.visitInnerClass within the places which use types: visitField, visitConstructorOrMethod for params, visitStdMethod for return type, visitCastExpression, visitClassExpression, visitAnnotationDefaultExpression for class constants. Doing it this way is a kind of a hack since we don&apos;t record such usages in earlier visitor passes. This worked in most cases but still broke a bunch of tests. I wasn&apos;t setting the access modifiers properly (limitation of spike) which explains some of the breakages but others broke due to loss of information in the classnode. Inner classes aren&apos;t identified correctly as InnerClassNodes by ClassSignatureParser. My hack used a simplistic approach of looking for $ in the class name. This would need to be made quite a bit smarter for the hack approach to work to account for inner inner classes, closures in classes, local inner classes etc. To me it indicates that we should fix the loss of information during class resolution.&lt;/p&gt;</comment>
                            <comment id="17317269" author="emilles" created="Thu, 8 Apr 2021 15:23:56 +0000"  >&lt;p&gt;When I moved the usage to a local variable, the inner class table was not written by ecj/javac.  So I think this is limited to member signatures.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Java8863 {
  void test() {
    &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State state = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also, &lt;tt&gt;AsmClassGenerator#makeInnerClassEntry&lt;/tt&gt; can be used to drive the call to &lt;tt&gt;ClassVisitor#visitInnerClass&lt;/tt&gt;.  It restricts to inner classes and looks to perform the modifier calculations.&lt;/p&gt;</comment>
                            <comment id="17566478" author="emilles" created="Wed, 13 Jul 2022 19:56:35 +0000"  >&lt;p&gt;I think I hit most cases.  Type of method call or field reference is not done;  &lt;tt&gt;for&lt;/tt&gt; loop param seemed more like local variable declaration so it was left out.  There isn&apos;t a direct way to test this &amp;#8211; unless there is something in the bytecode test fixture &amp;#8211; but I did compare against javac.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/70d9a73da1a5fc88af972b581ade3783cc34f1f6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/70d9a73da1a5fc88af972b581ade3783cc34f1f6&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13343130">GROOVY-9842</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 17 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3zrqn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>