<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:21:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-3488] Groovy ant task memory leak (re-opened GROOVY-891)</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-3488</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;There appears to be a memory leak in the groovy ant task. This becomes apparent when calling from one ant file to a number of others, each with a groovy task.&lt;/p&gt;

&lt;p&gt;I performed the following tests:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Increase the complexity and memory used of the groovy script in ant. This had no effect.&lt;/li&gt;
	&lt;li&gt;Increase the number of groovy tasks in a single ant script. This had no effect&lt;/li&gt;
	&lt;li&gt;Increase the total number of ant scripts called. This showed memory growth.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The following message is typical:&lt;/p&gt;

&lt;p&gt;BUILD FAILED&lt;br/&gt;
D:\projects\config\build\temp\build.xml:13: Following error occured while executing this line&lt;br/&gt;
D:\projects\config\build\temp\dependencies.xml:87: Following error occured while executing this line&lt;br/&gt;
java.lang.OutOfMemoryError&lt;/p&gt;

&lt;p&gt;I have attached a demonstration ant build system similar to our project build where the problem first occurred. For best results set the JVM memory via the ANT_OPTS environment variable to something like 16 Meg ie:&lt;/p&gt;

&lt;p&gt;set ANT_OPTS=-Xmx16M&lt;/p&gt;

&lt;p&gt;and then run ant.&lt;/p&gt;</description>
                <environment>Apache Ant version 1.6.1 compiled on February 12 2004&lt;br/&gt;
java version &amp;quot;1.4.2_08&amp;quot;&lt;br/&gt;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.4.2_08-b03)&lt;br/&gt;
Java HotSpot(TM) Client VM (build 1.4.2_08-b03, mixed mode)&lt;br/&gt;
&lt;br/&gt;
or Eclipse 3.1 M5a with included ant and Java 1.5_02&lt;br/&gt;
&lt;br/&gt;
Both running on Windows XP SP2</environment>
        <key id="12811791">GROOVY-3488</key>
            <summary>Groovy ant task memory leak (re-opened GROOVY-891)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="cfederighi">Craig Federighi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Apr 2009 08:49:51 +0000</created>
                <updated>Fri, 12 Apr 2013 16:55:12 +0000</updated>
                            <resolved>Thu, 28 Mar 2013 18:24:50 +0000</resolved>
                                    <version>1.0-JSR-2</version>
                                                    <component>Ant integration</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14466798" author="cfederighi" created="Thu, 23 Apr 2009 08:53:04 +0000"  >&lt;p&gt;Please see test case attached to &lt;a href=&quot;http://jira.codehaus.org/browse/GROOVY-891&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jira.codehaus.org/browse/GROOVY-891&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This issue still exists under Ant 1.7.1 + Groovy 1.6.  The memory leak is severe enough that it causes the AribaWeb (&lt;a href=&quot;http://aribaweb.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://aribaweb.org&lt;/a&gt;) build to sometimes run out of memory even with Ant configured with a very large heap.  (e.g. ANT_OPTS=-Xmx400m -XX:MaxPermSize=300m).&lt;/p&gt;</comment>
                            <comment id="14467303" author="d.lindner" created="Thu, 25 Jun 2009 12:01:41 +0000"  >&lt;p&gt;I had a similar effect when running several Canoo webtests in one Ant script (and therefor one JVM). The webtest starter ant script uses the Groovy ant task to run its scripts written in Groovy.&lt;br/&gt;
The OOME affects the heap, not the permspace. &lt;/p&gt;

&lt;p&gt;A possible fix that solved the issue for me was to release some resources of the GroovyShell that is used in the Groovy ant task.&lt;/p&gt;

&lt;p&gt;In the method execGroovy(), the last two lines construct a new GroovyShell and uses it. Afterwards, the instance is omitted as it&apos;s only locally scoped.&lt;br/&gt;
Explicitly freeing up the caches of the shell fixed the OOME for me:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; GroovyShell groovy = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyShell(classLoader, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Binding(), configuration);
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
    parseAndRunScript(groovy, txt, mavenPom, scriptName, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AntBuilder(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;));
} &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
    groovy.resetLoadedClasses();
    groovy.getClassLoader().clearCache();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I hope this helps a bit&lt;/p&gt;</comment>
                            <comment id="14467243" author="d.lindner" created="Thu, 25 Jun 2009 12:03:01 +0000"  >&lt;p&gt;Well, the line separators didn&apos;t work out:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; GroovyShell groovy = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyShell(classLoader, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Binding(), configuration);
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
    parseAndRunScript(groovy, txt, mavenPom, scriptName, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AntBuilder(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;));
} &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
    groovy.resetLoadedClasses();
    groovy.getClassLoader().clearCache();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14467226" author="d.lindner" created="Thu, 25 Jun 2009 12:03:23 +0000"  >&lt;p&gt;So be it, then. Sorry&lt;/p&gt;</comment>
                            <comment id="14467302" author="paulk" created="Thu, 25 Jun 2009 17:09:44 +0000"  >&lt;p&gt;Daniel, you should try using {code} tags. Click the little help icon while editing/entering.&lt;/p&gt;</comment>
                            <comment id="14479019" author="paulk" created="Mon, 5 Apr 2010 00:48:36 +0000"  >&lt;p&gt;Problem is reproducible with Ant 1.8 and Groovy trunk - though it does take until step 38 out of 40 before it gets the OOM error!&lt;br/&gt;
Using &lt;tt&gt;groovy.resetLoadedClasses()&lt;/tt&gt; in the finally block did not seem to fix the problem for the Ant build test case. Perhaps it is worth doing anyway if it fixes similar issues for WebTest. I can&apos;t see any downside - though if we can find a fix for both that would be better.&lt;/p&gt;</comment>
                            <comment id="14470055" author="davide" created="Sat, 11 Sep 2010 06:24:36 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I don&apos;t know if can helps you, but I register a very big memory leak in a code like your, but without use of ant, simply invoking GroovyShell a lot of times.&lt;/p&gt;

&lt;p&gt;Here: &lt;a href=&quot;http://tinyurl.com/groovy-shell-out-of-memory&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://tinyurl.com/groovy-shell-out-of-memory&lt;/a&gt; I opened a thread on mailing list, to describe problem.&lt;/p&gt;</comment>
                            <comment id="14470020" author="blackdrag" created="Sat, 11 Sep 2010 06:46:17 +0000"  >&lt;p&gt;Davide, that your example fails with a permgen problem is actaully what I expect. Each run of GroovyShell will add a new class and the class is not removed somewhere, that is by design. Instead you are supposed to use a new GroovyShell for each call or at least from time to time. Then the classes could be collected.&lt;/p&gt;

&lt;p&gt;getting the loader fom the shell and call resetLoadedClasses on it is a workaround in case you don&apos;t want to create a new instance&lt;/p&gt;</comment>
                            <comment id="14479600" author="paulk" created="Sat, 2 Jul 2011 07:03:25 +0000"  >&lt;p&gt;The &lt;tt&gt;resetLoadedClasses()&lt;/tt&gt; and &lt;tt&gt;clearCache()&lt;/tt&gt; suggestion have been added to 1_7_X, 1_8_X and trunk. I don&apos;t think they fix all cases but certainly seem to help.&lt;/p&gt;</comment>
                            <comment id="14474112" author="pschumacher" created="Sun, 10 Feb 2013 11:28:26 +0000"  >&lt;p&gt;Reading the comments I guess this issue should be closed?&lt;/p&gt;</comment>
                            <comment id="14480218" author="paulk" created="Thu, 28 Mar 2013 18:24:52 +0000"  >&lt;p&gt;Closing this as the discussion is around old versions of Groovy and dependencies. There are other issues addressing memory leakage, e.g. &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-6068&quot; title=&quot;Thread safety issue in AntBuilder leads to major memory leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-6068&quot;&gt;&lt;del&gt;GROOVY-6068&lt;/del&gt;&lt;/a&gt;, but please reopen a new issue with specific details if you are still having problems with recent versions.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310260">
                    <name>Related</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12815093">GROOVY-3656</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bqxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>