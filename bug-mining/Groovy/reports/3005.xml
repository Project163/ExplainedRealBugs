<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:48:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-7312] Compiler generates invalid inner class constructor</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-7312</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;replacement description:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Intf.groovy&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; Intf {
  def foo = { &lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt; }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Will create an inner class that lacks the static modifier for the inner class table. Compare with&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;JavaInterface.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; JavaInterface {
  &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;NestedInInterface {}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;for reference&lt;/p&gt;


&lt;p&gt;Original description:&lt;br/&gt;
The JLS specifies that an implicitly-declared constructor of a non-private inner class &quot;implicitly declares one formal parameter representing the immediately enclosing instance of the class&quot; (&lt;a href=&quot;http://docs.oracle.com/javase/specs/jls/se8/html/jls-8.html#jls-8.8.9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Section 8.8.9&lt;/a&gt;, see also &lt;a href=&quot;http://docs.oracle.com/javase/specs/jls/se8/html/jls-8.html#jls-8.8.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;8.8.1&lt;/a&gt;). &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Intf.groovy&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; Intf {
  def foo = { &lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt; }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The above code creates an inner class (Intf$1, not exactly sure what it&apos;s for) with a default constructor that has no parameters:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ javap -p -classpath classes &apos;Intf$1&apos;
Compiled from &quot;Intf.groovy&quot;
class Intf$1 implements groovy.lang.GroovyObject {
  ...
  public Intf$1();
  ...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;While not a major issue, this non-conformance can break interoperability with anything that expects to work with Java classes. This particular example came up while trying to use a similarly-declared Groovy class from a Scala class, where the Scala compiler was unable to parse the generated inner class.&lt;/p&gt;

&lt;p&gt;For reference, here is an example Java Inner class and it&apos;s compiled representation. Note the constructor parameter on the inner class.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;JavaObj.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;JavaObj {
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Inner {}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ javap -p -classpath classes &apos;JavaObj$Inner&apos;
public class JavaObj$Inner {
  final JavaObj this$0;
  public JavaObj$Inner(JavaObj);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12811543">GROOVY-7312</key>
            <summary>Compiler generates invalid inner class constructor</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shils">Shil Sinha</assignee>
                                    <reporter username="alewando">Adam Lewandowski</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Feb 2015 21:38:40 +0000</created>
                <updated>Tue, 3 Jan 2017 23:07:09 +0000</updated>
                            <resolved>Thu, 25 Feb 2016 05:51:15 +0000</resolved>
                                    <version>2.4.0</version>
                                    <fixVersion>2.4.7</fixVersion>
                                    <component>class generator</component>
                    <component>Compiler</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14477055" author="blackdrag" created="Thu, 19 Feb 2015 21:59:42 +0000"  >&lt;p&gt;I think there is a misunderstanding. The Java spec differentiates between nested classes and inner classes. A nested class basically is a static inner class. But it has the consequence, that for example this informal first parameter will not appear. Since an interface is no full class in the sense of the JLS, it cannot have inner classes, only nested classes. The open block you used in Intf usually generates an inner class, but that is optional. If the open block has no references to the surrounding class, then it can be a nested class instead. In case of Intf the nest class is the only possible case, using an open block in a static method would be another case. So if Scala had a problem with this class, then for other reasons. It is of course possible that some flags are set wrong or such. But of course you are not supposed to directly use that class either.&lt;/p&gt;</comment>
                            <comment id="14476996" author="alewando" created="Fri, 20 Feb 2015 06:58:40 +0000"  >&lt;p&gt;I see, thanks for the explanation, which makes sense. Backing up what you said, I constructed a nested class inside of a java interface:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;JavaInterface.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; JavaInterface {
  &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;NestedInInterface {}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And it also creates a similar no-arg constructor for the nested class:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ javap -p  -classpath classes &apos;JavaInterface$NestedInInterface&apos;
public class JavaInterface$NestedInInterface {
  public JavaInterface$NestedInInterface();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Scala, incidentally, wasn&apos;t trying to use the class, just parse it. I will raise this issue there. Thanks for your help.&lt;/p&gt;</comment>
                            <comment id="14477086" author="alewando" created="Fri, 20 Feb 2015 08:33:23 +0000"  >&lt;p&gt;Looking closer, I do think there is something wrong with the generated inner class, or at least inconsistent w/ the way javac handles this case. Javac marks this inner class as static in the InnerClasses attribute of it&apos;s class file, but groovy does not.&lt;/p&gt;

&lt;p&gt;Using the same example classes as above, for the JavaInterface$NestedInInterface class:&lt;/p&gt;
&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;$ javap -p -v  -classpath classes &apos;JavaInterface$NestedInInterface&apos;&lt;br/&gt;
Classfile .../JavaInterface$NestedInInterface.class&lt;br/&gt;
public class JavaInterface$NestedInInterface&lt;br/&gt;
  &lt;b&gt;InnerClasses:&lt;/b&gt;&lt;br/&gt;
       &lt;b&gt;public static&lt;/b&gt; #14= #3 of #12; //NestedInInterface=class JavaInterface$NestedInInterface of class JavaInterface&lt;br/&gt;
  minor version: 0&lt;br/&gt;
  major version: 51&lt;br/&gt;
  flags: ACC_PUBLIC, ACC_SUPER&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And for the groovy Intf$1 class:&lt;/p&gt;
&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;$ javap -p -v  -classpath classes &apos;Intf$1&apos;&lt;br/&gt;
Classfile .../Intf$1.class&lt;br/&gt;
class Intf$1 implements groovy.lang.GroovyObject&lt;br/&gt;
  &lt;b&gt;InnerClasses:&lt;/b&gt;&lt;br/&gt;
       &lt;b&gt;#107&lt;/b&gt;= #2 of #75; //1=class Intf$1 of class Intf&lt;br/&gt;
  minor version: 0&lt;br/&gt;
  major version: 49&lt;br/&gt;
  flags: ACC_SUPER, ACC_SYNTHETIC&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It is the lack of the &apos;static&apos; indicator that causes scalac problems. Without that, I don&apos;t think it can tell that this is a nested class and treats it as an inner class instead. &lt;/p&gt;</comment>
                            <comment id="14477071" author="blackdrag" created="Fri, 20 Feb 2015 09:44:58 +0000"  >&lt;p&gt;adding static should not be a problem&lt;/p&gt;</comment>
                            <comment id="15139963" author="githubbot" created="Tue, 9 Feb 2016 23:01:17 +0000"  >&lt;p&gt;GitHub user shils opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/257&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7312&quot; title=&quot;Compiler generates invalid inner class constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7312&quot;&gt;&lt;del&gt;GROOVY-7312&lt;/del&gt;&lt;/a&gt; Add ACC_STATIC flag to inner classes of interfaces&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/shils/groovy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/shils/groovy&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7312&quot; title=&quot;Compiler generates invalid inner class constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7312&quot;&gt;&lt;del&gt;GROOVY-7312&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/257.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/257.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #257&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 0012b17aa72e7f4ee6acaef93ea59d74c9559fc1&lt;br/&gt;
Author: Shil Sinha &amp;lt;shil.sinha@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-02-09T23:00:16Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7312&quot; title=&quot;Compiler generates invalid inner class constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7312&quot;&gt;&lt;del&gt;GROOVY-7312&lt;/del&gt;&lt;/a&gt; Add ACC_STATIC flag to inner classes of interfaces&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15139966" author="githubbot" created="Tue, 9 Feb 2016 23:04:23 +0000"  >&lt;p&gt;Github user shils commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/257#discussion_r52389570&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/257#discussion_r52389570&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/main/org/codehaus/groovy/classgen/asm/ClosureWriter.java &amp;#8212;&lt;br/&gt;
    @@ -80,7 +80,11 @@ public void writeClosure(ClosureExpression expression) {&lt;/p&gt;

&lt;p&gt;             // generate closure as public class to make sure it can be properly invoked by classes of the&lt;br/&gt;
             // Groovy runtime without circumventing JVM access checks (see CachedMethod for example).&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ClassNode closureClass = getOrAddClosureClass(expression, ACC_PUBLIC);&lt;br/&gt;
    +        int mods = ACC_PUBLIC;&lt;br/&gt;
    +        if (classNode.isInterface()) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Classes for closures defined in static methods could (should?) also be flagged as static, but I left that case as is since it wasn&apos;t mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7312&quot; title=&quot;Compiler generates invalid inner class constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7312&quot;&gt;&lt;del&gt;GROOVY-7312&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13031614">GROOVY-8032</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 41 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ce6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>