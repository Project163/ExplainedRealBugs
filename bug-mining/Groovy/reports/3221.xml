<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:55:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-8174] Groovy.Sql+Oracle parameter substitution problem</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-8174</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I&apos;m using the groovy.sql libraries inside of a Java program and having trouble with parameter substitution. My code looks like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                def mdds = Sql.newInstance(...)

		Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;params = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;();
		params.clear();
		params.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;source_system_id&quot;&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.valueOf(6));
		params.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;rec_loc_txt&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Test&quot;&lt;/span&gt; + randomNum.toString());
		params.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;created_dt_tm&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Timestamp(&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis()));
		
		&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; mdSqlString = &lt;span class=&quot;code-quote&quot;&gt;&quot;INSERT INTO MD_CATALOG &quot;&lt;/span&gt; +
		                  &lt;span class=&quot;code-quote&quot;&gt;&quot;      (SOURCE_SYSTEM_ID, REC_LOC_TXT, CREATED_DT_TM)&quot;&lt;/span&gt; + 
		                  &lt;span class=&quot;code-quote&quot;&gt;&quot;      VALUES&quot;&lt;/span&gt; + 
		                  &lt;span class=&quot;code-quote&quot;&gt;&quot;      (:source_system_id, :rec_loc_txt, :created_dt_tm)&quot;&lt;/span&gt;;

		&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
			List&amp;lt;List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;&amp;gt; keys = mdds.executeInsert(params, mdSqlString);
		} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SQLException e) {
			&lt;span class=&quot;code-comment&quot;&gt;// TODO Auto-generated &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; block
&lt;/span&gt;			e.printStackTrace();
		}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But, when it runs, I get an exception thrown that says:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.IllegalArgumentException: Found 4 parameter placeholders but supplied with 3 parameters
	at groovy.sql.Sql.setParameters(Sql.java:4116)
	at groovy.sql.Sql.getPreparedStatement(Sql.java:4394)
	at groovy.sql.Sql.executeInsert(Sql.java:2610)
	at groovy.sql.Sql.executeInsert(Sql.java:2674)
	at org.mitre.mac.Main.main(Main.java:70)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But, I only see 3 placeholders for my 3 parameters. &lt;/p&gt;

&lt;p&gt;Via email, John Wagenleitner replied:&lt;/p&gt;

&lt;p&gt;I did a quick test with Groovy 2.4.11 and Oracle 11.2.0.4 (ojdbc6.jar 11.2.0.4 and ojdbc7.jar 12.1.0.2.0) and get the same error.  From what I am seeing Oracle changes the sql to:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;INSERT INTO MD_CATALOG (SOURCE_SYSTEM_ID, REC_LOC_TXT, CREATED_DT_TM) VALUES (?, ?, ?) RETURNING ROWID INTO ?&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;adding the extra bind parameter for ROWID and this is reflected in the call to &lt;a href=&quot;https://github.com/apache/groovy/blob/GROOVY_2_4_11/subprojects/groovy-sql/src/main/java/groovy/sql/Sql.java#L4115&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;metaData.getParameterCount()&lt;/a&gt;&lt;/p&gt;</description>
                <environment>Java 1.8.0_131, Groovy 2.4.11, Oracle ojdbc7 12.1.0.2.0</environment>
        <key id="13068891">GROOVY-8174</key>
            <summary>Groovy.Sql+Oracle parameter substitution problem</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="pixelpshr">Thom DeCarlo</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 May 2017 19:29:19 +0000</created>
                <updated>Tue, 6 Mar 2018 23:14:46 +0000</updated>
                            <resolved>Fri, 5 May 2017 03:55:31 +0000</resolved>
                                    <version>2.4.11</version>
                                    <fixVersion>2.4.12</fixVersion>
                                    <component>SQL processing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15995509" author="pixelpshr" created="Wed, 3 May 2017 19:43:09 +0000"  >&lt;p&gt;The same error is produced when using the&lt;/p&gt;

&lt;p&gt;public List&amp;lt;GroovyRowResult&amp;gt; executeInsert(Map params,&lt;br/&gt;
                                           String sql,&lt;br/&gt;
                                           List&amp;lt;String&amp;gt; keyColumnNames)&lt;br/&gt;
                                    throws SQLException&lt;/p&gt;

&lt;p&gt;version and explicitly providing the autoincrementing key column name.&lt;/p&gt;
</comment>
                            <comment id="15995891" author="paulk" created="Wed, 3 May 2017 23:19:11 +0000"  >&lt;p&gt;Looks like we can&apos;t win using parameter count metadata. I think we&apos;ll just have to give a warning in the log if the counts don&apos;t match.&lt;/p&gt;</comment>
                            <comment id="15995988" author="githubbot" created="Thu, 4 May 2017 00:55:14 +0000"  >&lt;p&gt;GitHub user paulk-asert opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/534&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/534&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8174&quot; title=&quot;Groovy.Sql+Oracle parameter substitution problem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8174&quot;&gt;&lt;del&gt;GROOVY-8174&lt;/del&gt;&lt;/a&gt;: Groovy.Sql+Oracle parameter substitution problem&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/paulk-asert/groovy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/paulk-asert/groovy&lt;/a&gt; groovy8174&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/534.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/534.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #534&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 0efbd83cf46678cc7dacc365634af24db0affb96&lt;br/&gt;
Author: paulk &amp;lt;paulk@asert.com.au&amp;gt;&lt;br/&gt;
Date:   2017-05-04T00:53:41Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8174&quot; title=&quot;Groovy.Sql+Oracle parameter substitution problem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8174&quot;&gt;&lt;del&gt;GROOVY-8174&lt;/del&gt;&lt;/a&gt;: Groovy.Sql+Oracle parameter substitution problem&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15997764" author="githubbot" created="Fri, 5 May 2017 03:51:34 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/534&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/534&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15997767" author="paulk" created="Fri, 5 May 2017 03:55:31 +0000"  >&lt;p&gt;Proposed PR merged. Thanks for spotting the issue and thanks for checking John.&lt;/p&gt;</comment>
                            <comment id="16051211" author="paulk" created="Thu, 15 Jun 2017 23:49:00 +0000"  >&lt;p&gt;The fix was changed to remove throwing the exception in the one remaining case that we thought worked with all drivers - since some commonly used drivers are buggy for the functionality we were using. We now just give a log warning message if the number of declared and supplied parameters don&apos;t match. Since we haven&apos;t yet released 2.4.12, the fix version remains the same.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 22 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3eg2n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>