<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:32:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-6001] Method overloading behavior is non-deterministic and differs from Java behavior</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-6001</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;This example is based on a real world example. I&apos;ve included blank interface and class implementations to simulate WebSphere&apos;s class hierarchy.&lt;/p&gt;

&lt;p&gt;If you run the attached example (bug.groovy) repeatedly (CTRL+ENTER is easiest) in Groovy Console you will sometimes see this output:&lt;/p&gt;

&lt;p&gt;FooApplication.onRequestStart(HttpServletRequest, HttpServletResponse)&lt;/p&gt;

&lt;p&gt;And other times this output:&lt;/p&gt;

&lt;p&gt;BazApplication.onRequestStart(PortletRequest, PortletResponse)&lt;br/&gt;
FooApplication.onRequestStart(HttpServletRequest, HttpServletResponse)&lt;/p&gt;

&lt;p&gt;Or this:&lt;br/&gt;
BazApplication.onRequestStart(PortletRequest, PortletResponse&lt;br/&gt;
FooApplication.onRequestStart(PortletRequest, PortletResponse)&lt;/p&gt;

&lt;p&gt;Here&apos;s a subset of the code in question&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;FooApplication &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Application &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; HttpServletRequestListener, PortletRequestListener{

    void onRequestStart(HttpServletRequest request, HttpServletResponse response) {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;FooApplication.onRequestStart(HttpServletRequest, HttpServletResponse)&quot;&lt;/span&gt;);
    }

    void onRequestEnd(HttpServletRequest request, HttpServletResponse response) {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;FooApplication.onRequestEnd(HttpServletRequest, HttpServletResponse)&quot;&lt;/span&gt;);
    }

    void onRequestStart(PortletRequest request, PortletResponse response) {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;FooApplication.onRequestStart(PortletRequest, PortletResponse)&quot;&lt;/span&gt;);
    }

    void onRequestEnd(PortletRequest request, PortletResponse response) {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;FooApplication.onRequestEnd(PortletRequest, PortletResponse)&quot;&lt;/span&gt;);
    }
    
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;BazApplication &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; FooApplication {

    void onRequestStart(PortletRequest request, PortletResponse response) {
        println &lt;span class=&quot;code-quote&quot;&gt;&apos;BazApplication.onRequestStart(PortletRequest, PortletResponse&apos;&lt;/span&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.onRequestStart(request, response);
    }

}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that ResourceRequestImpl implements both HttpServletRequest and PortletRequest but PortletRequest is implemented closer in the class hierarchy. Granted this test case is a bit odd but comes from real-world example in a portlet environment running groovy with 3rd party code (IBM WebSphere) we don&apos;t control. &lt;/p&gt;

&lt;p&gt;As you can see the method being selected at runtime is non-deterministic. I&apos;m no language expert but my assumption is that given a ResourceRequestImpl instance that groovy runtime should call BazApplication.onRequestStart(PortletRequest, PortletResponse) and FooApplication.onRequestStart(PortletRequest, PortletResponse) when super is invoked. &lt;/p&gt;

&lt;p&gt;A pure Java implementation behaves according to my assumption. If BazAppication is converted to Java it works every time (see BarApplication and BarApplicationTest in bug.zip archive). The assumption being that onRequestStart(PortletRequest request, PortletResponse response) should be called as it is the most specific method.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached a gradle build script which implements both groovy (BazApplication) and java versions (BarApplication) which demonstrates that Java works according to my assumptions but the groovy one behaves non-deterministically:&lt;/p&gt;


&lt;p&gt;$ gradle clean test&lt;/p&gt;

&lt;p&gt;Gradle test &amp;gt; com.textura.BarApplicationTest.test STANDARD_OUT&lt;br/&gt;
    BarApplication.onRequestStart(PortletRequest, PortletResponse)&lt;br/&gt;
    FooApplication.onRequestStart(PortletRequest, PortletResponse)&lt;/p&gt;

&lt;p&gt;Gradle test &amp;gt; com.textura.BazApplicationTest.test STANDARD_OUT&lt;br/&gt;
    FooApplication.onRequestStart(HttpServletRequest, HttpServletResponse)&lt;/p&gt;


&lt;p&gt;Repeated runs BazApplicationTest yields different results:&lt;/p&gt;

&lt;p&gt;Gradle test &amp;gt; com.textura.BazApplicationTest.test STANDARD_OUT&lt;br/&gt;
    BazApplication.onRequestStart(PortletRequest, PortletResponse&lt;br/&gt;
    FooApplication.onRequestStart(PortletRequest, PortletResponse)&lt;/p&gt;


&lt;p&gt;Gradle test &amp;gt; com.textura.BazApplicationTest.test STANDARD_OUT&lt;/p&gt;

&lt;p&gt;    BazApplication.onRequestStart(PortletRequest, PortletResponse)&lt;br/&gt;
    FooApplication.onRequestStart(HttpServletRequest, HttpServletResponse)&lt;/p&gt;

&lt;p&gt;A co-worker of mine sent this white paper titled &quot;Reconciling Method Overloading and Dynamically Typed Scripting Languages&quot; that you might find interesting. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://docs.google.com/viewer?a=v&amp;amp;q=cache:La7ci5TSnFwJ:https://upapers.dcc.uchile.cl/index/publications/view_pdf/7979+&amp;amp;hl=en&amp;amp;gl=us&amp;amp;pid=bl&amp;amp;srcid=ADGEESiZMldG2xzVwAC7nUfDpmGkAA-brSfHaTAOQq4vfoZUoTCrUShcegjdmWJFsihVpyRT92duVIgDptelMCc--sy3RCotbH9c0OQC7PuVf2D90fYYXVoyru5KmsOxQrZXSkhX6ZUe&amp;amp;sig=AHIEtbSK5HwtBD8Z_nhYk2du3HzZBY_rFg&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.google.com/viewer?a=v&amp;amp;q=cache:La7ci5TSnFwJ:https://upapers.dcc.uchile.cl/index/publications/view_pdf/7979+&amp;amp;hl=en&amp;amp;gl=us&amp;amp;pid=bl&amp;amp;srcid=ADGEESiZMldG2xzVwAC7nUfDpmGkAA-brSfHaTAOQq4vfoZUoTCrUShcegjdmWJFsihVpyRT92duVIgDptelMCc--sy3RCotbH9c0OQC7PuVf2D90fYYXVoyru5KmsOxQrZXSkhX6ZUe&amp;amp;sig=AHIEtbSK5HwtBD8Z_nhYk2du3HzZBY_rFg&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Maybe I&apos;m mistaken but assuming what I said before about how Java resolves which method to call is accurate I don&apos;t understand why Groovy wouldn&apos;t be able to walk the tree to determine the most specific interface which should be selected in the same manner as the Java compiler. I also tried using @StaticCompile but it had no effect AFAIK.&lt;/p&gt;</description>
                <environment>Don&amp;#39;t think it matters but just in case&lt;br/&gt;
&lt;br/&gt;
java version &amp;quot;1.7.0_07&amp;quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.7.0_07-b10)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 23.3-b01, mixed mode)&lt;br/&gt;
&lt;br/&gt;
Windows 7 64-bit&lt;br/&gt;
Microsoft Windows [Version 6.1.7601]&lt;br/&gt;
</environment>
        <key id="12816806">GROOVY-6001</key>
            <summary>Method overloading behavior is non-deterministic and differs from Java behavior</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="krasmussen">Kirk Rasmussen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Feb 2013 12:28:36 +0000</created>
                <updated>Thu, 15 Oct 2015 18:19:33 +0000</updated>
                            <resolved>Mon, 18 Feb 2013 10:38:35 +0000</resolved>
                                    <version>2.1.0</version>
                                    <fixVersion>2.1.2</fixVersion>
                                    <component>class generator</component>
                    <component>groovy-jdk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14474167" author="blackdrag" created="Thu, 14 Feb 2013 16:07:37 +0000"  >&lt;p&gt;It is too late today to look into this in detail, but I can say this much up front. Groovy does not have the same method selection algorithm as Java, but it should use the same method every time of course.&lt;/p&gt;</comment>
                            <comment id="14474145" author="krasmussen" created="Fri, 15 Feb 2013 09:41:10 +0000"  >&lt;p&gt;Quick update. If I annotate with @StaticCopmile it does work but only if I modify both BazApplication and BazApplicationTest.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;BazApplicationTest {

    @Test
    @groovy.transform.CompileStatic
    void test() {
        BazApplication application = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BazApplication()
        PortletRequest request = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ResourceRequestImpl()
        application.onRequestStart(request, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
    }

}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;BazApplication &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; FooApplication {

    @CompileStatic
    void onRequestStart(PortletRequest request, PortletResponse response) {
        println &lt;span class=&quot;code-quote&quot;&gt;&apos;BazApplication.onRequestStart(PortletRequest, PortletResponse&apos;&lt;/span&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.onRequestStart(request, response);
    }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Unfortunately we are currently only on Groovy 1.8.2 so this isn&apos;t an option for us at the moment. Also this still smells wrong to me that it doesn&apos;t work under dynamic mode. The principle of least surprise should apply right, i.e. Groovy and Java behavior should be aligned.&lt;/p&gt;</comment>
                            <comment id="14474168" author="blackdrag" created="Mon, 18 Feb 2013 10:18:41 +0000"  >&lt;p&gt;btw, I think you should be able to force method selection like this:&lt;/p&gt;

&lt;p&gt;super.onRequestStart((PortletRequest)request, response);&lt;/p&gt;</comment>
                            <comment id="14474130" author="krasmussen" created="Mon, 18 Feb 2013 10:31:02 +0000"  >&lt;p&gt;That does seem to work but why would I need to do that? It&apos;s already a PortletRequest in the method signature.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    void onRequestStart(PortletRequest request, PortletResponse response) {
        println &lt;span class=&quot;code-quote&quot;&gt;&apos;BazApplication.onRequestStart(PortletRequest, PortletResponse&apos;&lt;/span&gt;
        &lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.onRequestStart(request, response);
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.onRequestStart((PortletRequest)request, response);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14474093" author="blackdrag" created="Mon, 18 Feb 2013 10:38:36 +0000"  >&lt;p&gt;So... the bug was in the method selection algorithm. It decreased the distance value we use to find the best fit. And decreasing should never happen. Especially not to 0, since 0 means a direct match, and the internal selection assumes, that there is only one possible direct match at all times. Due to the decrease there have been two 0 valued methods and then it is random which one is selected. The fix goes further by adding a 1 distance step for going to the super class, making an interface in a direct parent class a better fit than the same interfaces two parents up. This together then fixes the issue at hand and now you always get the BazApplication.onRequestStart(PortletRequest, PortletResponse) FooApplication.onRequestStart(PortletRequest, PortletResponse) response&lt;/p&gt;

&lt;p&gt;A question for the 1.8.x line.... do you really need this in 1.8, is upgrading to 2.1 impossible? We would prefer not releasing 1.8.10 unless it is really really needed. And not any time soon anyway.&lt;/p&gt;</comment>
                            <comment id="14474072" author="blackdrag" created="Mon, 18 Feb 2013 10:39:11 +0000"  >&lt;p&gt;as I said, the cast is there to force method selection&lt;/p&gt;</comment>
                            <comment id="14474179" author="krasmussen" created="Mon, 18 Feb 2013 10:47:48 +0000"  >&lt;p&gt;Ok thanks for the details. As far as upgrading goes we are stuck on JDK 1.5 for probably the next 6-8 months at least so I guess that means we need it on 1.8.x line. &lt;/p&gt;</comment>
                            <comment id="14474146" author="melix" created="Mon, 18 Feb 2013 11:00:37 +0000"  >&lt;p&gt;Hi Kirk. Groovy 2.0 still generates 1.5 bytecode, you can upgrade without problem.&lt;/p&gt;</comment>
                            <comment id="14474169" author="krasmussen" created="Tue, 19 Feb 2013 14:33:35 +0000"  >&lt;p&gt;Thanks Cedric. Did you mean Groovy 2.x or Groovy 2.0.x? For some reason I thought it required JDK 1.6+.&lt;/p&gt;</comment>
                            <comment id="14474094" author="melix" created="Tue, 19 Feb 2013 14:37:03 +0000"  >&lt;p&gt;You can choose any 2.x version (but better to upgrade directly on 2.1.1, there will not be any 2.0.x released)&lt;/p&gt;</comment>
                            <comment id="14474073" author="krasmussen" created="Tue, 19 Feb 2013 14:49:51 +0000"  >&lt;p&gt;Cool. Thanks for all your help. I&apos;m glad you were able to figure it out so quickly.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722934" name="ResourceRequestImpl.png" size="26781" author="krasmussen" created="Thu, 14 Feb 2013 12:28:36 +0000"/>
                            <attachment id="12723121" name="bug.groovy" size="2283" author="krasmussen" created="Thu, 14 Feb 2013 12:28:36 +0000"/>
                            <attachment id="12723122" name="bug.zip" size="10308" author="krasmussen" created="Thu, 14 Feb 2013 12:28:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 40 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cq13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>