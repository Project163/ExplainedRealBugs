<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:22:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-9596] Cannot access protected field of Java superclass with --illegal-access=deny</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-9596</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;When using the Java option &lt;tt&gt;--illegal-access=deny&lt;/tt&gt;, a Groovy subclass that extends a Java superclass in the Java runtime (e.g., a class in the &lt;tt&gt;java.base&lt;/tt&gt; module) cannot access a protected field in the parent class using &lt;tt&gt;this.fieldName&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;To reproduce this bug, use JDK 14 (or later) and run the following using either Groovy 2.5.12 or 3.0.4:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;$ groovyc Main.groovy MyFilterReader.groovy&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;$ _JAVA_OPTIONS=&quot;--illegal-access=deny&quot; groovy Main&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;It works correctly without &lt;tt&gt;--illegal-access=deny&lt;/tt&gt;. You can add &lt;tt&gt;-Dsun.reflect.debugModuleAccessChecks=access&lt;/tt&gt; to get more detailed information about the illegal access exceptions that are being swallowed by Groovy.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;$ _JAVA_OPTIONS=&quot;--illegal-access=deny -Dsun.reflect.debugModuleAccessChecks=access&quot; groovy Main&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;WORKAROUND: change the following line in the Groovy subclass:&lt;/p&gt;

&lt;p&gt;line = ((BufferedReader)this.in).readLine();&lt;/p&gt;

&lt;p&gt;to:&lt;/p&gt;

&lt;p&gt;line = ((BufferedReader)super.in).readLine();&lt;/p&gt;</description>
                <environment>JDK 14&lt;br/&gt;
Groovy 2.5.12 or 3.0.4</environment>
        <key id="13312006">GROOVY-9596</key>
            <summary>Cannot access protected field of Java superclass with --illegal-access=deny</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kevinrushforth">Kevin Rushforth</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Jun 2020 16:55:25 +0000</created>
                <updated>Mon, 24 Jul 2023 17:23:27 +0000</updated>
                            <resolved>Wed, 13 Jul 2022 16:24:17 +0000</resolved>
                                    <version>3.0.4</version>
                    <version>2.5.12</version>
                                    <fixVersion>5.0.0-alpha-1</fixVersion>
                                    <component>bytecode</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17138648" author="kevinrushforth" created="Wed, 17 Jun 2020 17:03:30 +0000"  >&lt;p&gt;Since &lt;tt&gt;--illegal-access=deny&lt;/tt&gt; will become the default in a future version of the JDK, it would be good to fix this issue sooner rather than later.&lt;/p&gt;</comment>
                            <comment id="17138895" author="kevinrushforth" created="Wed, 17 Jun 2020 23:16:08 +0000"  >&lt;p&gt;I get the same error trying to call a protected method of a Java superclass. What&apos;s worse is that the workaround of calling super.method() doesn&apos;t work. To reproduce this:&lt;/p&gt;

&lt;p&gt;To reproduce this bug, use JDK 14 (or later) and run the following using either Groovy 2.5.12 or 3.0.4:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;$ groovyc Main2.groovy MyAWTEvent.groovy&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;$ _JAVA_OPTIONS=&quot;--illegal-access=deny&quot; groovy Main2&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17140213" author="blackdrag" created="Fri, 19 Jun 2020 04:47:48 +0000"  >&lt;p&gt;It is not really a bug, it is a limitation of the reflective code and the bytecode generation at runtime. The only way this is going to work is with invokedynamic. Meaning you should compile with --indy to enable compilation using invokedynamic. If that is still failing, then there is indeed a bug.&lt;/p&gt;</comment>
                            <comment id="17140359" author="paulk" created="Fri, 19 Jun 2020 09:21:43 +0000"  >&lt;p&gt;There was a potential red herring producing an illegal access warning which I fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9600&quot; title=&quot;Picocli-related VersionProvider helper classes should be public to avoid access warnings&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9600&quot;&gt;&lt;del&gt;GROOVY-9600&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Interesting results when I ran with master (Groovy 4 and Indy only now) with JDK14.&lt;/p&gt;

&lt;p&gt;When using &lt;tt&gt;super.in&lt;/tt&gt;, Java, dynamic Groovy, and static Groovy all produced:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
getfield      #aa                 &lt;span class=&quot;code-comment&quot;&gt;// Field java/io/FilterReader.in:Ljava/io/Reader;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And all cases worked correctly at runtime.&lt;/p&gt;

&lt;p&gt;When using &lt;tt&gt;in&lt;/tt&gt; or &lt;tt&gt;this.in&lt;/tt&gt;, Java produced:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
getfield      #bb                 &lt;span class=&quot;code-comment&quot;&gt;// Field in:Ljava/io/Reader;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This also ran successfully.&lt;/p&gt;

&lt;p&gt;For those same cases without super, dynamic Groovy produced:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
invokedynamic #cc,  d            &lt;span class=&quot;code-comment&quot;&gt;// InvokeDynamic #12:getProperty:(LMyFilterReader;)Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Again, for those cases, static Groovy (i.e. @CompileStatic) produced:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
invokeinterface #ee,  f          &lt;span class=&quot;code-comment&quot;&gt;// InterfaceMethod groovy/lang/GroovyObject.getProperty:(Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;;)Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;With &lt;tt&gt;--illegal-access=deny&lt;/tt&gt; , there is no illegal access warning but the following runtime error occurs in both cases:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caught: groovy.lang.MissingPropertyException: No such property: in for class: MyFilterReader
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Running without &lt;tt&gt;--illegal-access=deny&lt;/tt&gt; does give the illegal access warning but then completes normally (as per Java).&lt;/p&gt;</comment>
                            <comment id="17141711" author="paulk" created="Mon, 22 Jun 2020 05:28:21 +0000"  >&lt;p&gt;Using `this.@in` or `super.@in` results (for both static and dynamic variants) in:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
getfield      #gg                &lt;span class=&quot;code-comment&quot;&gt;// Field java/io/FilterReader.in:Ljava/io/Reader;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So, that would be the correct workaround for now.&lt;/p&gt;</comment>
                            <comment id="17150577" author="emilles" created="Thu, 2 Jul 2020 20:48:43 +0000"  >&lt;p&gt;With indy compilation, &quot;this.in&quot; in MyFilterReader is resolved by: &lt;a href=&quot;https://github.com/apache/groovy/blob/GROOVY_3_0_4/src/main/java/org/codehaus/groovy/vmplugin/v8/Selector.java#L328&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/blob/GROOVY_3_0_4/src/main/java/org/codehaus/groovy/vmplugin/v8/Selector.java#L328&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It is returning a property-missing MetaProperty (the last return statement).  &lt;/p&gt;</comment>
                            <comment id="17187109" author="emilles" created="Sat, 29 Aug 2020 21:32:52 +0000"  >&lt;p&gt;I think the solution requires:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;remove &lt;tt&gt;makeAccessibleIfNecessary()&lt;/tt&gt; from &lt;tt&gt;CachedField#getCachedField&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;replace &lt;tt&gt;LOOKUP&lt;/tt&gt; with &lt;tt&gt;Java8.of(senderClass)&lt;/tt&gt; in &lt;tt&gt;org.codehaus.groovy.vmplugin.v8.Selector.PropertySelector#chooseMeta&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;rework &lt;tt&gt;Java8#of(Lookup)&lt;/tt&gt; to produce a lookup instance without calling &lt;tt&gt;setAccessible(true)&lt;/tt&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;But I can&apos;t quite get all the pieces to fit.  I could push a branch if someone wants to have a look.&lt;/p&gt;</comment>
                            <comment id="17345047" author="kevinrushforth" created="Sat, 15 May 2021 14:20:19 +0000"  >&lt;p&gt;With the recently-released gradle 7, which includes groovy 3.0.7, we can update our build to use JDK 16. I see that this bug is still present, so I ended up needing to implement the workaround I mentioned in the description (using &lt;tt&gt;super.in&lt;/tt&gt; rather than &lt;tt&gt;this.in&lt;/tt&gt;).&lt;/p&gt;

&lt;p&gt;When more developers start using JDK 16 you may expect to receive more reports of problems like this. Note also that starting with JDK 17, it will no longer be possible to globally disable strong encapsulation. This may mean that some developers who are using that global switch as a workaround in JDK 16 will be stuck. It would be good to fix this and similar bugs in Groovy before JDK 17 is released.&lt;/p&gt;</comment>
                            <comment id="17566402" author="emilles" created="Wed, 13 Jul 2022 16:24:05 +0000"  >&lt;p&gt;This script runs fine with Groovy 3.0.11/4.0.3, Java 17.0.2 and &lt;tt&gt;--illegal-access=deny&lt;/tt&gt;, printing &quot;1234567890&quot;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt;[] input = &lt;span class=&quot;code-quote&quot;&gt;&apos;1234567890\r\nabcdefghij\r\n&apos;&lt;/span&gt;.toCharArray()

&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; reader = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FilterReader(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BufferedReader(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CharArrayReader(input))) {
  @Override
  &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; read() {
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt;.read() &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt;&quot;&lt;/span&gt; is protected field of &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt; class
&lt;/span&gt;  }
}
print reader.readLine()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Groovy 2.5.17 still produces the access warnings described above.&lt;/p&gt;</comment>
                            <comment id="17746549" author="emilles" created="Mon, 24 Jul 2023 17:23:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/79dfdd03eaf6aaf30e667748dd2610e7f4b575eb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/79dfdd03eaf6aaf30e667748dd2610e7f4b575eb&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13376288">GROOVY-10070</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13235603">GROOVY-9144</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13005885" name="Main.groovy" size="305" author="kevinrushforth" created="Wed, 17 Jun 2020 16:54:13 +0000"/>
                            <attachment id="13005908" name="Main2.groovy" size="36" author="kevinrushforth" created="Wed, 17 Jun 2020 23:16:30 +0000"/>
                            <attachment id="13005909" name="MyAWTEvent.groovy" size="333" author="kevinrushforth" created="Wed, 17 Jun 2020 23:16:31 +0000"/>
                            <attachment id="13005884" name="MyFilterReader.groovy" size="1661" author="kevinrushforth" created="Wed, 17 Jun 2020 16:54:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 16 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0fy3c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>