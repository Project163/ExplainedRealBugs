<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:59:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-8722] final modifier for non-abstract methods in traits is ignored</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-8722</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;When using the &lt;tt&gt;final&lt;/tt&gt; modifier in a trait non-abstract method signature, then:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;compiler successfully compiles trait and class that implements it&lt;/li&gt;
	&lt;li&gt;final method of trait may be overridden in class that implements trait&lt;/li&gt;
	&lt;li&gt;if class implements trait and doesn&apos;t override trait final method, then this method is available as non-final method in class&lt;/li&gt;
	&lt;li&gt;documentation says absolutely nothing about this&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In other words, &lt;tt&gt;final&lt;/tt&gt; modifier is ignored in trait methods: code works the same with or without it. Even if this behavior is expected, there&apos;s nothing about it in the documentation.&lt;/p&gt;

&lt;p&gt;Here&apos;s simple example gradle groovy project to demonstrate the issue: &lt;a href=&quot;https://github.com/dburyak/groovy-bug-trait-final&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dburyak/groovy-bug-trait-final&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13175573">GROOVY-8722</key>
            <summary>final modifier for non-abstract methods in traits is ignored</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="dburyak">Dmytro Buryak</reporter>
                        <labels>
                            <label>breaking</label>
                            <label>documentation</label>
                    </labels>
                <created>Mon, 30 Jul 2018 14:29:59 +0000</created>
                <updated>Tue, 14 Aug 2018 08:05:51 +0000</updated>
                            <resolved>Mon, 6 Aug 2018 22:35:47 +0000</resolved>
                                    <version>2.4.15</version>
                    <version>2.5.1</version>
                                    <fixVersion>2.5.2</fixVersion>
                                    <component>Compiler</component>
                    <component>Documentation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16565099" author="paulk" created="Wed, 1 Aug 2018 10:19:12 +0000"  >&lt;p&gt;You are correct that currently final is ignored/not supported and it isn&apos;t mentioned in the docs. We should definitely add something in the docs and/or a compiler error message.&lt;/p&gt;

&lt;p&gt;While not an exact equivalent, it is worth reading the &quot;api evolution&quot; rationale about why Java doesn&apos;t allow methods in interfaces to be final:&lt;br/&gt;
&lt;a href=&quot;https://stackoverflow.com/a/23476994/146084&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/a/23476994/146084&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Now, traits are a slightly more powerful beast and you could make an argument about them having a different semantics here, but similar arguments still do apply. It is worth going back to the intent of traits to consider whether supporting final would make sense. Currently, a method in a trait provides a default implementation that can be overridden. So, if you provide your own implementation does that mean you are overriding the trait method or just not taking advantage of a default implementation?&lt;/p&gt;

&lt;p&gt;If you multiply inherit a method from multiple traits, the last one &quot;inherited&quot; wins. So if an earlier one is final, should I give a warning or just realise that I am not taking that implementation? And, if I am going to ignore an earlier final method in that case, does it also make sense to ignore such &quot;inherited &quot; methods if I provide my own implementation?&lt;br/&gt;
Probably the only definition that would make sense would be that if you inherit one final method you can&apos;t inherit any others (with the same signature) nor override. If we did support final, that is probably the definition that I would advocate but we need to appreciate that it would be the definition that impacted api evolution the most.&lt;/p&gt;
</comment>
                            <comment id="16565779" author="dburyak" created="Wed, 1 Aug 2018 18:29:58 +0000"  >&lt;p&gt;Paul, thanks for the great explanation!&lt;br/&gt;
 Well, at least now it&apos;s clear that this behavior is expected. Before your answer there were only guesses)&lt;br/&gt;
 I feel that the best option would be to mention about &lt;tt&gt;&lt;font color=&quot;#707070&quot;&gt;final&lt;/font&gt;&lt;/tt&gt; keyword in Traits:Limitations documentation section. Decision about how the compiler should handle such situation is also not an easy one. Basically because it&apos;s possible that final keyword is already scattered along many projects that were successfully compiled and published, and many others &quot;what if ...&quot;.&lt;/p&gt;

&lt;p&gt;Let me share some of my thoughts:&lt;br/&gt;
 In your comment I see a perspective of a language designer. But let met give some reasoning from a language user perspective, just a little bit different angle.&lt;br/&gt;
 In Brian&apos;s stackoverflow comment, that you&apos;ve mentioned, I see one problem with the hypothetical A,B,C example if final default methods were supported in Java. He says that &quot;Now C is irretrievably broken&quot;. I don&apos;t see any reason why this is bad. Instead, I feel that it would be great if compiler detected such situation. Designer of B by using final keyword literally said &quot;if you are instanceof B then your void foo() method &lt;ins&gt;must&lt;/ins&gt; do exactly this, otherwise you break B&apos;s expectations of behavior that I put in it, don&apos;t override it&quot;. So designer of C did exactly that what he was warned not to do: he inherited B but overridden foo().&lt;br/&gt;
 But this is all hypothetical: Java interfaces are all about &quot;what &lt;ins&gt;you can do&lt;/ins&gt; with object&quot; and not &quot;what &lt;ins&gt;object can do&lt;/ins&gt; and how it behaves&quot;, basically because they don&apos;t have state and don&apos;t encapsulate piece of functionality. Default methods of Java 8 made interfaces one step closer to traits, but I feel that was more dictated by Stream API appearance and the need to change existing collections API to make it happen (just as Brian Goetz mentioned). So I assume that the need for final methods in interfaces for Java developers is pretty low.&lt;/p&gt;

&lt;p&gt;Groovy traits, on the other hand, serve as a &quot;composable component of functionality&quot; (thanks to Cedric Champeau for definition) and they were such components from the very beginning. I mean this is more a value for the developer (language user) that traits provide, rather than definition. And from this perspective, having &lt;tt&gt;&lt;font color=&quot;#707070&quot;&gt;final&lt;/font&gt;&lt;/tt&gt; keyword supported in traits would be great. If developer was designing for example Mammal trait with several methods (speak(), move()) that &lt;ins&gt;may&lt;/ins&gt; be redefined by some exotic implementations, but wanted to disallow to change some functionality (like feedWithMilk(), buildPlacenta()), then final keyword would do the job. And from the developer perspective, if he marks something as &quot;final&quot; in any component of functionality, not only trait, that means intention &quot;this can&apos;t be redefined or it would break otherwise&quot;. At the moment, if I need to do this, I have no other option than just to put a comment like &quot;do not override&quot; in trait method doc and hope that trait user will read it. By the way, my example project that is linked in the issue description, shows similar real life situation: simple but useful trait &quot;Suspendable&quot;, where some methods shouldn&apos;t be overridden or it almost certainly would fail to do it&apos;s job correctly.&lt;/p&gt;

&lt;p&gt; All this said and going further, I totally agree with your definition of final methods in traits as it fully supports what I&apos;ve described above. And it sounds very natural to me. And moreover very usable.&lt;/p&gt;

&lt;p&gt;Regarding api evolution. I don&apos;t see much impact here, or I just misunderstood your point. &lt;br/&gt;
I see only one big problem because of compiler silently discards final modifier. &lt;br/&gt;
 Suppose groovy &quot;x.y&quot; doesn&apos;t support final in traits, and groovy &quot;x.z&quot; adds support for it using definition you&apos;ve proposed. All compiled with &quot;x.y&quot; and prior will work fine with &quot;x.z&quot;, as it all is final-less. If you use binary. But when you take sources that worked correctly with &quot;x.y&quot;, there&apos;s no any guarantee that there&apos;s no &quot;final&quot; keyword somewhere, and when you compile it with &quot;x.z&quot;, then compilation could fail. Resulting in no backward compatibility. And another reverse situation: if you get source written for &quot;x.z&quot; and compile it with &quot;x.y&quot;, it won&apos;t fail but discard all final keywords and it&apos;s behavior becomes different from the original design.&lt;/p&gt;</comment>
                            <comment id="16569680" author="githubbot" created="Mon, 6 Aug 2018 02:53:17 +0000"  >&lt;p&gt;GitHub user paulk-asert opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/780&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/780&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8722&quot; title=&quot;final modifier for non-abstract methods in traits is ignored&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8722&quot;&gt;&lt;del&gt;GROOVY-8722&lt;/del&gt;&lt;/a&gt;: final modifier for non-abstract methods in traits is ign&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;ored&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/paulk-asert/groovy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/paulk-asert/groovy&lt;/a&gt; groovy8722&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/780.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/780.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #780&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit c472131950252d3da0329d24fade2897e8213ad4&lt;br/&gt;
Author: Paul King &amp;lt;paulk@...&amp;gt;&lt;br/&gt;
Date:   2018-08-06T02:51:14Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8722&quot; title=&quot;final modifier for non-abstract methods in traits is ignored&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8722&quot;&gt;&lt;del&gt;GROOVY-8722&lt;/del&gt;&lt;/a&gt;: final modifier for non-abstract methods in traits is ignored&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16570846" author="githubbot" created="Mon, 6 Aug 2018 22:08:32 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/780&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/780&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16570870" author="paulk" created="Mon, 6 Aug 2018 22:35:47 +0000"  >&lt;p&gt;I have added support for final methods but in the most backward compatible way possible for now. We could make it stricter (produce compilation errors in some cases) for Groovy 3 but I am disinclined to at this point. We could write Codenarc rules to detect cases that are considered bad style.&lt;/p&gt;

&lt;p&gt;For your example, both &lt;tt&gt;ActivityOverride&lt;/tt&gt; and &lt;tt&gt;ActivityInherit&lt;/tt&gt; will have &lt;tt&gt;final&lt;/tt&gt; &lt;tt&gt;start&lt;/tt&gt; and &lt;tt&gt;stop&lt;/tt&gt; methods but they are overridden in &lt;tt&gt;ActivityOverride&lt;/tt&gt; and in fact would be non-final if the overridden methods weren&apos;t final. So basically, existing rules for method selection apply and don&apos;t look at the final modifier during method selection but after a method is selected, if it is final, that will be reflected in the resulting woven method&apos;s modifiers. You can achieve the affect you are after using a base class. The base class can multiply inherit from traits (if needed) and then your activity classes would extend from the base class instead of implement the traits. The class would look like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SuspendableBase &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; Suspendable {}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You would find that the override version wouldn&apos;t compile - you&apos;d need to not override the final methods from &lt;tt&gt;SuspendableBase&lt;/tt&gt; to make it compile. I have also updated the doco to reflect the above. It is still a breaking change but now only for a much rarer edge case and I&apos;ll document that in the release notes.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 15 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3wh6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>