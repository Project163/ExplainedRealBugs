<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:52:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-7655] Wrong method is chosen when using super with generics</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-7655</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Given code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;generics_extension_test.groovy&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; ParamInterface{}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ParamImplementation &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; ParamInterface{}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ParamExtension &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; ParamImplementation {}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;A&amp;lt;T &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; ParamInterface&amp;gt; {

    def getResult(T a) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;B&amp;lt;T &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; ParamImplementation&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; A&amp;lt;T&amp;gt; {
    def getResult(T b) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;C &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; B&amp;lt;ParamExtension&amp;gt; {
    @Override
    def getResult(ParamExtension b) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.getResult(b)
    }
}


&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; result = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; C().getResult(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ParamExtension())
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; result == &lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I get output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Assertion failed: 

&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; result == &lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;
       |      |
       A      &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;

	at generics_extension_test.run(generics_extension_test.groovy:31)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When calling super method, instead of looking for method in a class one hierarchy bellow, groovy goes through complex calculations for finding a better method. I debug&apos;ed up to a point in &lt;br/&gt;
groovy.lang.MetaClassImpl#chooseMostSpecificParams&lt;br/&gt;
where it turned out that distance for interface was 2 and distance for class that directly extends the method was much bigger, therefore the method from class A is chosen instead of method from class B. However, looking objectively, it would seem that B.getResult is a much better fit:&lt;br/&gt;
C extends B and B extends A&lt;br/&gt;
parameter hierarchy is shorter (ParamExtension -&amp;gt; ParamImplementation -&amp;gt; ParamInterface)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12909666">GROOVY-7655</key>
            <summary>Wrong method is chosen when using super with generics</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="MariusV">Marius Vaitkus</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 Nov 2015 13:29:02 +0000</created>
                <updated>Wed, 29 Mar 2017 01:13:44 +0000</updated>
                            <resolved>Fri, 19 Aug 2016 14:03:20 +0000</resolved>
                                    <version>2.4.4</version>
                                    <fixVersion>2.5.0-alpha-1</fixVersion>
                                        <due></due>
                            <votes>5</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15422831" author="doktorj" created="Tue, 16 Aug 2016 14:45:54 +0000"  >&lt;p&gt;This appears to be much more general than this, as I can replicate the issue starting with 2.4.0, without the use of generics. In my case, I used the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;A {
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; aCalled = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;

    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; Map myMethod( def item ) {
        println &lt;span class=&quot;code-quote&quot;&gt;&quot;A myMethod&quot;&lt;/span&gt;
        aCalled = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; [:]
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;B &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; A {
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; bCalled = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;

    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; Map myMethod( def item ) {
        println &lt;span class=&quot;code-quote&quot;&gt;&quot;B myMethod&quot;&lt;/span&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.myMethod( item )
        bCalled = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; [:]
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;C &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; B {
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; cCalled = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;

    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; Map cMethod( def item ) {
        println &lt;span class=&quot;code-quote&quot;&gt;&quot;C cMethod&quot;&lt;/span&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.myMethod( item )
        &lt;span class=&quot;code-comment&quot;&gt;//myMethod( item )
&lt;/span&gt;        cCalled = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; [:]
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;along with a simple JUnit test:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.Test

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;CTest {
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void test() {
        def c = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; C()
        def ret = c.cMethod( &lt;span class=&quot;code-quote&quot;&gt;&quot;stuff&quot;&lt;/span&gt; )
        
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; c.aCalled
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; c.bCalled &lt;span class=&quot;code-comment&quot;&gt;// Duh ... 2.4.x fails here.
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; c.cCalled
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It&apos;s seen that all the 2.4 versions I ran (2.4.0, 2.4.3, 2.4.7) exhibit the same behavior &amp;#8212; B.myMethod is not invoked.&lt;/p&gt;

&lt;p&gt;We encountered this while looking at doing a transition from the 2.3.x versions of groovy to 2.4.x, and one of our apps starting failing in an odd manner. It turns out that we did have a class coded invoking super on a method, while the class didn&apos;t override the method &amp;#8212; resulting in the invocation of the wrong method.&lt;/p&gt;

&lt;p&gt;In our minds at the company I&apos;m working for, this is a very serious bug that may prevent our moving to the 2.4.x groovy runtimes.&lt;/p&gt;</comment>
                            <comment id="15422961" author="blackdrag" created="Tue, 16 Aug 2016 16:14:45 +0000"  >&lt;p&gt;to be able to realize a super call in Groovy we have to go to some lengths in the form of helper methods. Only the helper method is able to make the call, because to realize a proper super invocation you will need an invokespecial, and that is not available by reflection or even by generating a helper class. A invokespecial instruction must come from the same class to realize a call to super. Till 2.4 we did blindly create helper methods for all possible cases. We then tried to slim down the class files a bit but reducing them to their minimum. But it seems this case here has been forgotten. There are solutions to this... overwrite the method in C or use @CompileStatic for example. Those are no options for you?&lt;/p&gt;</comment>
                            <comment id="15423109" author="doktorj" created="Tue, 16 Aug 2016 17:29:26 +0000"  >&lt;p&gt;Not really; our concern is about precompiled/3rd party libraries more than our own code. While we could keep in mind this situation in our own code, there are limits to that, and someone, someday, is going to miss a case.&lt;/p&gt;

&lt;p&gt;This is one of those cases where the current invocation is different than the baseline Java. I read the 2.4 release notes pretty carefully the other night, and was looking at decompiled code and saw the reduction in generated helper methods. If this particular case is one that was overlooked, perhaps a solution in the next release would be forthcoming? It surprises me that a simple case like this would have been overlooked in the unit tests (then again, it surprises me, too, that it seems so few have noticed a case like this).&lt;/p&gt;</comment>
                            <comment id="15424317" author="blackdrag" created="Wed, 17 Aug 2016 11:24:45 +0000"  >&lt;p&gt;If the library is precompiled with pre 2.4, then the code there already contains the helper method. And if it is there, it will be used. So unless you recompile, there is no problem.  Of course there is then still a problem once they recompile. But that is the case already if you use 2.3 and they use 2.4 to compile.&lt;/p&gt;

&lt;p&gt;I do agree, that this has to be fixed for the next release. The question is the &quot;how&quot; beyond a simple &quot;restore the old behaviour&quot;. I would like to keep the amount of methods at least lowered. Most probably I will make the compiler recognize the super-call and note that this will require a mop helper method later on. Then we would still get a big reduction in generated helper methods compared to 2.4 and it would solve your problem here.&lt;/p&gt;</comment>
                            <comment id="15424466" author="doktorj" created="Wed, 17 Aug 2016 13:03:56 +0000"  >&lt;p&gt;Agreed. In our case, looking at the move to using Mule 3.7.3, 2.4 is required (which, overall, is a good thing). Thank you for being so prompt with this; I certainly understand the &quot;how&quot; is the difficult part. You&apos;ve made big strides with groovy and I&apos;d love to keep using it.&lt;/p&gt;</comment>
                            <comment id="15428232" author="blackdrag" created="Fri, 19 Aug 2016 14:03:22 +0000"  >&lt;p&gt;after thinking about how to solve the issue for a bit it was actually quite easy to find a solution. The compiler will now ensure, that methods used with super will find their mop helper method. This happens regardless of the signature, so there are still useless methods generated, but still many less than in 2.3&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12770090" name="generics_extension_test.groovy" size="569" author="MariusV" created="Mon, 2 Nov 2015 13:40:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 13 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ntl3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>