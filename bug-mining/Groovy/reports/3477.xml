<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:59:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-8800] Wrong detection of Java 10 version in groovy-json</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-8800</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I cloned another issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8824&quot; title=&quot;CLONE - Wrong detection of Java 10 version in groovy-json Part 2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8824&quot;&gt;GROOVY-8824&lt;/a&gt;) to cater for refactoring/testing. The pattern change has been merged under this issue.&lt;/p&gt;

&lt;p&gt;ORIGINAL BELOW:&lt;/p&gt;

&lt;p&gt;The following code from &lt;tt&gt;groovy.json.internal.Sys&lt;/tt&gt; incorrectly parses &lt;tt&gt;java.version&lt;/tt&gt; property on newer Java-s:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; {
        BigDecimal v = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigDecimal(&lt;span class=&quot;code-quote&quot;&gt;&quot;-1&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; sversion = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;java.version&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sversion.indexOf(&lt;span class=&quot;code-quote&quot;&gt;&quot;_&quot;&lt;/span&gt;) != -1) {
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] split = sversion.split(&lt;span class=&quot;code-quote&quot;&gt;&quot;_&quot;&lt;/span&gt;);
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; ver = split[0];

                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ver.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;1.7&quot;&lt;/span&gt;)) {
                    v = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigDecimal(&lt;span class=&quot;code-quote&quot;&gt;&quot;1.7&quot;&lt;/span&gt;);
                }

                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ver.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;1.8&quot;&lt;/span&gt;)) {
                    v = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigDecimal(&lt;span class=&quot;code-quote&quot;&gt;&quot;1.8&quot;&lt;/span&gt;);
                }

                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ver.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;1.9&quot;&lt;/span&gt;)) {
                    v = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigDecimal(&lt;span class=&quot;code-quote&quot;&gt;&quot;1.9&quot;&lt;/span&gt;);
                }
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception ex) {
                ex.printStackTrace();
                &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to determine build number or version&quot;&lt;/span&gt;);
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-quote&quot;&gt;&quot;1.8.0&quot;&lt;/span&gt;.equals(sversion)) {
            v = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigDecimal(&lt;span class=&quot;code-quote&quot;&gt;&quot;1.8&quot;&lt;/span&gt;);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            Pattern p = Pattern.compile(&lt;span class=&quot;code-quote&quot;&gt;&quot;^([1-9]\\.[0-9]+)&quot;&lt;/span&gt;);
            Matcher matcher = p.matcher(sversion);
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (matcher.find()) {
                v = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigDecimal(matcher.group(0));
            }
        }

        is1_8OrLater = v.compareTo(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigDecimal(&lt;span class=&quot;code-quote&quot;&gt;&quot;1.8&quot;&lt;/span&gt;)) &amp;gt;= 0;
        is1_7 = v.compareTo(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigDecimal(&lt;span class=&quot;code-quote&quot;&gt;&quot;1.7&quot;&lt;/span&gt;)) == 0;
        is1_8 = v.compareTo(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigDecimal(&lt;span class=&quot;code-quote&quot;&gt;&quot;1.8&quot;&lt;/span&gt;)) == 0;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Under Java 10+ (&lt;tt&gt;java.version=10.0.2&lt;/tt&gt;) all &lt;tt&gt;is*&lt;/tt&gt; fields are set to &lt;tt&gt;false&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The outcome of it is e.g. &lt;tt&gt;LazyMap&lt;/tt&gt; to use &lt;tt&gt;j.u.TreeMap&lt;/tt&gt; instead of &lt;tt&gt;j.u.LinkedHashMap&lt;/tt&gt; that would give insertion order for maps returned from &lt;tt&gt;JsonSlurper&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Just extending the pattern to &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;^([1-9]+\\.[0-9]+)&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;seems to do the job.&lt;/p&gt;</description>
                <environment>Oracle Java SE 10, Linux</environment>
        <key id="13185765">GROOVY-8800</key>
            <summary>Wrong detection of Java 10 version in groovy-json</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="pwesolek">Przemek Wesolek</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Sep 2018 10:00:46 +0000</created>
                <updated>Thu, 13 Dec 2018 10:05:32 +0000</updated>
                            <resolved>Fri, 5 Oct 2018 04:32:00 +0000</resolved>
                                    <version>3.x</version>
                    <version>2.5.2</version>
                                    <fixVersion>3.0.0-alpha-4</fixVersion>
                    <fixVersion>2.5.3</fixVersion>
                                    <component>JSON</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16619044" author="pwesolek" created="Tue, 18 Sep 2018 12:25:02 +0000"  >&lt;p&gt;Maybe something simpler would be better for the whole version detection, like &lt;a href=&quot;https://github.com/apache/groovy/blob/ac0e1d232f0612518a87ce2aa5e443e0975cb3f4/subprojects/groovy-groovysh/src/test/groovy/org/codehaus/groovy/tools/shell/commands/DocCommandTest.groovy#L153&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/blob/ac0e1d232f0612518a87ce2aa5e443e0975cb3f4/subprojects/groovy-groovysh/src/test/groovy/org/codehaus/groovy/tools/shell/commands/DocCommandTest.groovy#L153&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="16619196" author="paulk" created="Tue, 18 Sep 2018 14:31:26 +0000"  >&lt;p&gt;I presume then our test suite doesn&apos;t have an example that triggers this problem. Do you have a simple example that triggers the problem?&lt;/p&gt;</comment>
                            <comment id="16620280" author="pwesolek" created="Wed, 19 Sep 2018 08:20:44 +0000"  >&lt;p&gt;No, there&apos;s no test for that.&lt;/p&gt;

&lt;p&gt;I&apos;m preparing a PR in GitHub with new test. This is my first time compiling Groovy, so will take a few moments. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16620513" author="pwesolek" created="Wed, 19 Sep 2018 12:22:52 +0000"  >&lt;p&gt;OK, the changes are here: &lt;a href=&quot;https://github.com/jest/groovy/tree/java-version-detection-fix&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jest/groovy/tree/java-version-detection-fix&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I had to change `Sys` to make it testable, but the changes are minimal (mainly static -&amp;gt; instance for fields plus a static singleton). Also, fixed the version check for Java 10 - 12ea.&lt;/p&gt;

&lt;p&gt;It would be nice to have it also in 2.5; I don&apos;t know your workflow, should I make a PR and cherry pick, or just leave it to you?&lt;/p&gt;</comment>
                            <comment id="16620547" author="paulk" created="Wed, 19 Sep 2018 13:04:51 +0000"  >&lt;p&gt;I cherry-picked the regex change already into master and GROOVY_2_5_X though I might go back and try to simplify the earlier logic later.&lt;br/&gt;
For the test, checking versions is probably a good thing but I originally was thinking more along the lines of some kind of integration test, e.g. using JsonSlurper and then collecting some info from the list of entries from the map and comparing to some expected order. We would be expecting that to always pass from 8 and above I believe. Or do you see a problem with creating such a test with reliable behavior?&lt;/p&gt;</comment>
                            <comment id="16620761" author="pwesolek" created="Wed, 19 Sep 2018 15:40:32 +0000"  >&lt;p&gt;Not at all. However, then you have platform-specific tests (Java 8+ vs older) and you can&apos;t escape from proper version checking either. So some unit testing for that is necessary, for different version fixtures (e.g. as it is now).&lt;/p&gt;

&lt;p&gt;I&apos;d leave the test as is, probably refactor version detection (as you mentioned) and added integration tests for JsonSlurper map iteration order (restricted to Java 8+, unless you want to test security-related switch to TreeMap under Java 7 too).&lt;/p&gt;

&lt;p&gt;If that&apos;s fine, I can write something for the integration testing.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="13189634">GROOVY-8824</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 8 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3y7ev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>