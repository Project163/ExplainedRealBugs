<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:36:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-6401] @CompileStatic type inference bug with overridden methods: causes GroovyCastException at runtime</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-6401</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic

@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; Greeter {
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void sayHello()
}

@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;HelloGreeter &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; Greeter {
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void sayHello() {
       println &lt;span class=&quot;code-quote&quot;&gt;&quot;Hello world!&quot;&lt;/span&gt;
   }
}

@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;A {
   Greeter createGreeter() {
       &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HelloGreeter()
   }
   
   void sayHello() {
      &lt;span class=&quot;code-comment&quot;&gt;// also fails: def greeter = createGreeter()
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// successfull: def greeter = (Greeter)createGreeter()
&lt;/span&gt;      Greeter greeter = createGreeter()
      greeter.sayHello()
   }   
}

@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;HelloThereGreeter &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; Greeter {
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void sayHello() {
       println &lt;span class=&quot;code-quote&quot;&gt;&quot;Hello there!&quot;&lt;/span&gt;
   }
}

@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;B &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; A {
   Greeter createGreeter() {
       &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HelloThereGreeter()
   }
}


&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; B().sayHello()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Throws exception&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Exception thrown
loka 24, 2013 6:53:33 AP. org.codehaus.groovy.runtime.StackTraceUtils sanitize
WARNING: Sanitizing stacktrace:
org.codehaus.groovy.runtime.typehandling.GroovyCastException: Cannot &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; object &lt;span class=&quot;code-quote&quot;&gt;&apos;HelloThereGreeter@5a0e8a14&apos;&lt;/span&gt; with class &lt;span class=&quot;code-quote&quot;&gt;&apos;HelloThereGreeter&apos;&lt;/span&gt; to class &lt;span class=&quot;code-quote&quot;&gt;&apos;HelloGreeter&apos;&lt;/span&gt;
	at org.codehaus.groovy.runtime.typehandling.DefaultTypeTransformation.castToType(DefaultTypeTransformation.java:360)
	at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.castToType(ScriptBytecodeAdapter.java:599)
	at A.sayHello(flowtyping_bug.groovy:24)
	at A$sayHello.call(Unknown Source)
	at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCall(CallSiteArray.java:45)
	at org.codehaus.groovy.runtime.callsite.AbstractCallSite.call(AbstractCallSite.java:108)
	at org.codehaus.groovy.runtime.callsite.AbstractCallSite.call(AbstractCallSite.java:112)
	at flowtyping_bug.run(flowtyping_bug.groovy:44)
	at groovy.lang.GroovyShell.runScriptOrMainOrTestOrRunnable(GroovyShell.java:257)
	at groovy.lang.GroovyShell.run(GroovyShell.java:481)
	at groovy.lang.GroovyShell.run(GroovyShell.java:163)
	at groovy.lang.GroovyShell$run$0.call(Unknown Source)
	at groovy.ui.Console$_runScriptImpl_closure17.doCall(Console.groovy:954)
	at groovy.ui.Console$_runScriptImpl_closure17.doCall(Console.groovy)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:90)
	at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:233)
	at org.codehaus.groovy.runtime.metaclass.ClosureMetaClass.invokeMethod(ClosureMetaClass.java:272)
	at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:909)
	at groovy.lang.Closure.call(Closure.java:411)
	at groovy.lang.Closure.call(Closure.java:405)
	at groovy.lang.Closure.run(Closure.java:492)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:744)

org.codehaus.groovy.runtime.typehandling.GroovyCastException: Cannot &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; object &lt;span class=&quot;code-quote&quot;&gt;&apos;HelloThereGreeter@5a0e8a14&apos;&lt;/span&gt; with class &lt;span class=&quot;code-quote&quot;&gt;&apos;HelloThereGreeter&apos;&lt;/span&gt; to class &lt;span class=&quot;code-quote&quot;&gt;&apos;HelloGreeter&apos;&lt;/span&gt;
	at A.sayHello(flowtyping_bug.groovy:24)
	at A$sayHello.call(Unknown Source)
	at flowtyping_bug.run(flowtyping_bug.groovy:44)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="12811659">GROOVY-6401</key>
            <summary>@CompileStatic type inference bug with overridden methods: causes GroovyCastException at runtime</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="melix">C&#233;dric Champeau</assignee>
                                    <reporter username="lhotari">Lari Hotari</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Oct 2013 22:58:11 +0000</created>
                <updated>Tue, 29 Oct 2013 16:35:26 +0000</updated>
                            <resolved>Thu, 24 Oct 2013 08:31:38 +0000</resolved>
                                    <version>2.1.8</version>
                                    <fixVersion>2.1.9</fixVersion>
                    <fixVersion>2.2.0-rc-2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14475051" author="lhotari" created="Wed, 23 Oct 2013 22:58:55 +0000"  >&lt;p&gt;This bug is causing &lt;a href=&quot;http://jira.grails.org/browse/GRAILS-10482&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jira.grails.org/browse/GRAILS-10482&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14475121" author="lhotari" created="Sun, 27 Oct 2013 23:37:31 +0000"  >&lt;p&gt;The fix seems to be causing some new problems with @CS. &lt;br/&gt;
Some tests in Grails-Groovy 2_1_X joint build are failing (&lt;a href=&quot;http://hudson.grails.org/job/groovy_2_1_grails_joint_build/lastCompletedBuild/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.grails.org/job/groovy_2_1_grails_joint_build/lastCompletedBuild/testReport/&lt;/a&gt;) because of this problem:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic

@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SynchronousPromise&amp;lt;T&amp;gt; {
    Closure&amp;lt;T&amp;gt; callable
    &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; value

    SynchronousPromise(Closure&amp;lt;T&amp;gt; callable) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.callable = callable
    }

    T get() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Throwable {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (value == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                value = callable.call()
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (e) {
                value = e
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (value &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Throwable) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; value
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; value
    }
}

def promise = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SynchronousPromise({ &lt;span class=&quot;code-quote&quot;&gt;&quot;Hello&quot;&lt;/span&gt; })
promise.get()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Running this example in GroovyConsole 2.1.9-SNAPSHOT throws this exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.codehaus.groovy.runtime.typehandling.GroovyCastException: Cannot &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; object &lt;span class=&quot;code-quote&quot;&gt;&apos;Hello&apos;&lt;/span&gt; with class &lt;span class=&quot;code-quote&quot;&gt;&apos;java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&apos;&lt;/span&gt; to class &lt;span class=&quot;code-quote&quot;&gt;&apos;groovy.lang.Closure&apos;&lt;/span&gt;
	at SynchronousPromise.get(ConsoleScript4:15)
	at SynchronousPromise$get.call(Unknown Source)
	at ConsoleScript4.run(ConsoleScript4:28)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14475070" author="lhotari" created="Sun, 27 Oct 2013 23:43:58 +0000"  >&lt;p&gt;This doesn&apos;t work:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic

@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SynchronousPromise&amp;lt;T&amp;gt; {
    Closure&amp;lt;T&amp;gt; callable
    &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; value

    SynchronousPromise(Closure&amp;lt;T&amp;gt; callable) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.callable = callable
    }

    T get() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Throwable {
        value=callable.call()
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; value
    }
}

def promise = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SynchronousPromise({ &lt;span class=&quot;code-quote&quot;&gt;&quot;Hello&quot;&lt;/span&gt; })
promise.get()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but it works with this change (remove &amp;lt;T&amp;gt; from callable field):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic

@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SynchronousPromise&amp;lt;T&amp;gt; {
    Closure callable
    &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; value

    SynchronousPromise(Closure&amp;lt;T&amp;gt; callable) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.callable = callable
    }

    T get() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Throwable {
        value=callable.call()
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; value
    }
}

def promise = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SynchronousPromise({ &lt;span class=&quot;code-quote&quot;&gt;&quot;Hello&quot;&lt;/span&gt; })
promise.get()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14475086" author="melix" created="Mon, 28 Oct 2013 05:47:27 +0000"  >&lt;p&gt;Last comment fixed by &lt;a href=&quot;https://github.com/groovy/groovy-core/commit/79b7a8a0b7fa8914e35c0fb6f8ee13753b87a0cb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/groovy/groovy-core/commit/79b7a8a0b7fa8914e35c0fb6f8ee13753b87a0cb&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 4 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cbgv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>