<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:10:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-3235] DGM.println(Object) and friends do a Writer.close() if the object is a writer.  Should be flush() instead.</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-3235</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The DefaultGroovyMethods:&lt;/p&gt;

&lt;p&gt;print(Object)&lt;br/&gt;
println(Object)&lt;br/&gt;
print(Object, Object)&lt;br/&gt;
println(Object, Object)&lt;/p&gt;

&lt;p&gt;all will create a PrintWriter and then do a Writer.close() if self is a Writer.  That will close the underlying writer, which is definitely the wrong thing.  &lt;/p&gt;

&lt;p&gt;The correct behavior is to do a flush().&lt;/p&gt;

&lt;p&gt;It is easy to see that flushing rather than closing is the right thing by looking at what happens if self is not a Writer.  In that case System.out.print(ln) is called and System.out is &lt;b&gt;not&lt;/b&gt; closed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12814495">GROOVY-3235</key>
            <summary>DGM.println(Object) and friends do a Writer.close() if the object is a writer.  Should be flush() instead.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jimwhite">James P. White</assignee>
                                    <reporter username="jimwhite">James P. White</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 Dec 2008 00:53:45 +0000</created>
                <updated>Thu, 22 Jan 2009 21:34:42 +0000</updated>
                            <resolved>Mon, 5 Jan 2009 21:41:50 +0000</resolved>
                                    <version>1.5.7</version>
                    <version>1.6-rc-1</version>
                                    <fixVersion>1.6-rc-2</fixVersion>
                    <fixVersion>1.5.8</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14466103" author="jimwhite" created="Thu, 25 Dec 2008 01:18:46 +0000"  >&lt;p&gt;Fix committed - &lt;a href=&quot;http://fisheye.codehaus.org/changelog/groovy/?cs=14638&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://fisheye.codehaus.org/changelog/groovy/?cs=14638&lt;/a&gt; + &lt;a href=&quot;http://fisheye.codehaus.org/changelog/groovy/?cs=14639&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://fisheye.codehaus.org/changelog/groovy/?cs=14639&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Will merge to 1.5 and 1.6 if no objection.&lt;/p&gt;</comment>
                            <comment id="14466042" author="veita" created="Thu, 25 Dec 2008 09:00:39 +0000"  >&lt;p&gt;To call flush() is the wrong thing either. It is a side effect the user does not want to have. Think e.g. of socket streams where frequent flushes may decrease network throughput. java.io.PrintWriter has auto-flush turned off by default.&lt;/p&gt;

&lt;p&gt;It seems unneccessary to construct a PrintWriter within the DGM methods. The print(ln) methods could use Writer#write(InvokerHelper.toString(value)) followed by an optional new-line Writer#write(System.getProperty(&quot;line.separator&quot;)).&lt;/p&gt;</comment>
                            <comment id="14466118" author="jimwhite" created="Thu, 25 Dec 2008 10:55:33 +0000"  >&lt;p&gt;I don&apos;t have a problem the flush&apos;s effect on the underlying writer - this is a convenience method and the user could easily change their code to improve performance.&lt;/p&gt;

&lt;p&gt;I do agree that just using write is better, but I didn&apos;t have more time to spend on this issue last night which is why I just fixed the existing approach (creating a PrintWriter).  I want to check the implementation of PrintWriter itself and find the best way to Groovy to cache the line.separator property (which it may do already).&lt;/p&gt;

&lt;p&gt;I also have an enhancement (which will be a separate issue) for the non-Writer case so that it will also look for the Script &apos;out&apos; property (which will also then work with the JSR-223 script engine writer).&lt;/p&gt;</comment>
                            <comment id="14465982" author="veita" created="Thu, 25 Dec 2008 11:55:44 +0000"  >&lt;p&gt;Note that PrintWriter#flush() does nothing but flushing the underlying stream. When it is constructed with a Writer PrintWriter it has no internal buffer. So calling flush() does not improve anything.&lt;/p&gt;

&lt;p&gt;Additionally, when calling Writer methods like Writer#write(...) the user is getting the benefit of receiving an exception if something goes wrong. The wrapping PrintWriter would swallow them what is really bad.&lt;/p&gt;</comment>
                            <comment id="14466073" author="jimwhite" created="Thu, 25 Dec 2008 12:55:45 +0000"  >&lt;p&gt;Ah, good point about PrintWriter.flush being a no-op wrt the PW when constructed over a Writer.&lt;/p&gt;

&lt;p&gt;But as for no exception on problems with the underlying stream, that is a reason to stick with PrintWriter.  The API for print/println is that they do &lt;b&gt;not&lt;/b&gt; throw checked exceptions.  Of course PrintWriter then has checkError and Writer does not.&lt;/p&gt;

&lt;p&gt;I&apos;ll remove the flush.&lt;/p&gt;</comment>
                            <comment id="14466104" author="veita" created="Thu, 25 Dec 2008 14:00:59 +0000"  >&lt;p&gt;Is it really a problem to throw checked exceptions from DGM#print(ln)? Other DGM methods (e.g. leftShift) do this as well. Groovy doesn&apos;t care if there&apos;s a throws keyword.&lt;/p&gt;

&lt;p&gt;Using PrintWriter adds a lot of unneccessary overhead (object construction, synchonization, stack frames) and the caller has no chance to get a notification if something went wrong. PrintWriter&apos;s (stateful) checkError() mechanism is not available for arbitrary Writers.&lt;/p&gt;</comment>
                            <comment id="14466022" author="jimwhite" created="Thu, 25 Dec 2008 15:06:16 +0000"  >&lt;p&gt;I think the behavior should conform to PrintWriter.print(ln) as much as possible.  This fix was prompted by these methods closing the underlying Writer, which is clearly bad (and a sign it probably is very little used - which brings up another interesting idea - automated usage profiling and feedback).&lt;/p&gt;

&lt;p&gt;As for performance, this is a convenience method and I&apos;m more interested in brevity and clarity than a constructor call or two.  Anyone who is calling this in a loop can use &apos;new PrintWriter(w).withWriter&apos; or such as they prefer.&lt;/p&gt;

</comment>
                            <comment id="14466002" author="veita" created="Thu, 25 Dec 2008 15:32:31 +0000"  >&lt;p&gt;OK.&lt;/p&gt;

&lt;p&gt;BTW the following test case should probably run through (it does not in 1.5.6) &lt;a href=&quot;http://jira.codehaus.org/browse/GROOVY-3237&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jira.codehaus.org/browse/GROOVY-3237&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14466045" author="blackdrag" created="Mon, 29 Dec 2008 12:05:39 +0000"  >&lt;p&gt;is this issue really a must for 1.6?&lt;/p&gt;</comment>
                            <comment id="14466152" author="jimwhite" created="Sat, 3 Jan 2009 05:12:04 +0000"  >&lt;p&gt;Certainly.  Those methods are seriously broken if printing to something like a file which only gets the first print.  Folks maybe haven&apos;t noticed this because of the habit of printing to a StringWriter which ignores close() calls.&lt;/p&gt;</comment>
                            <comment id="14466155" author="blackdrag" created="Mon, 5 Jan 2009 09:26:07 +0000"  >&lt;p&gt;so what about the issue? The fix is done... what is missing?&lt;/p&gt;</comment>
                            <comment id="14466070" author="jimwhite" created="Mon, 5 Jan 2009 21:39:05 +0000"  >&lt;p&gt;Committed to 1.6 (cs14853).&lt;/p&gt;</comment>
                            <comment id="14466031" author="jimwhite" created="Mon, 5 Jan 2009 21:41:42 +0000"  >&lt;p&gt;Committed to 1.5 (14854).&lt;/p&gt;</comment>
                            <comment id="14466199" author="roshandawrani" created="Tue, 13 Jan 2009 12:23:56 +0000"  >&lt;p&gt;The local build on my windows XP machine is failing because of Groovy3235Bug.testBug(). You may want to check. Below is the error details that show up in the log:&lt;/p&gt;

&lt;p&gt;	Caused an ERROR&lt;br/&gt;
Expression: (d == t). Values: d = This is one line.&lt;br/&gt;
      This is another.&lt;br/&gt;
      All these lines should be written.&lt;br/&gt;
, t = This is one line.&lt;br/&gt;
      This is another.&lt;br/&gt;
      All these lines should be written.&lt;/p&gt;

&lt;p&gt;java.lang.AssertionError: Expression: (d == t). Values: d = This is one line.&lt;br/&gt;
      This is another.&lt;br/&gt;
      All these lines should be written.&lt;br/&gt;
, t = This is one line.&lt;br/&gt;
      This is another.&lt;br/&gt;
      All these lines should be written.&lt;/p&gt;

&lt;p&gt;	at org.codehaus.groovy.runtime.InvokerHelper.assertFailed(InvokerHelper.java:373)&lt;br/&gt;
	at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.assertFailed(ScriptBytecodeAdapter.java:658)&lt;br/&gt;
	at groovy.bugs.Groovy3235Bug.testBug(Groovy3235Bug.groovy:18)&lt;/p&gt;</comment>
                            <comment id="14466280" author="roshandawrani" created="Tue, 13 Jan 2009 12:30:52 +0000"  >&lt;p&gt;I have verified both on 1.5.x and 1.6.x dev branches and both builds are failing for me.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 46 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c6jb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>