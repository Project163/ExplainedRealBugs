<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:27:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-11782] Inconsistent unboxing of null, and resulting exceptions</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-11782</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;So I ran into a weird optimization bug, where an expected exception gets thrown once for an incorrect invocation, will then produce 0 for the exact same incorrect invocations, if its followed by a &apos;correct&apos; invocation.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Attached is a super basic pure java class, with a very basic arithmetic method&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; test;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;JavaTarget {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; primitiveMethod(&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; value) {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;\tJavaTarget.primitiveMethod v=&quot;&lt;/span&gt;+value);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; value - 3.0;
    }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The innards of the class are not important, but do note that is take a primitive double param and returns a primitive double after subtracting 3 from the param&lt;/p&gt;

&lt;p&gt;Now when groovy tries to call this class, from a closure, with a Double param, we generally expect type coercion, boxing and unboxng, to kick in and everything should still work, and it does under normal circumstances.&#160;&lt;/p&gt;

&lt;p&gt;However the bug occurs when you call with a Double v= null param, in which case type coercion fails, because we cant unbox a null to a double, as expected. If you then call it with a good Double, ex Double v=2.0; all subsequent calls with Double v=null will be coerced to 0 and no more exception will be thrown.&lt;/p&gt;

&lt;p&gt;Test groovy script to illustrate; again vary basic loop 3 times, call java target with null and with a 2.0&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Closure javaTargetCaller = {&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt; v -&amp;gt;
    println &lt;span class=&quot;code-quote&quot;&gt;&quot;\tcall JavaTarget.primitiveMethod($v)&quot;&lt;/span&gt;
    JavaTarget.primitiveMethod(v)
}


&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i&amp;lt;3; i++){

    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;{
        println &lt;span class=&quot;code-quote&quot;&gt;&quot;CALL[$i] | with &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;
        &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; a = javaTargetCaller(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
        println &lt;span class=&quot;code-quote&quot;&gt;&quot;\tresult with v=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; | *NOT-OK* | expecting exception, got &quot;&lt;/span&gt;+a+&lt;span class=&quot;code-quote&quot;&gt;&quot; --&quot;&lt;/span&gt;+a.getClass()
    }&lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;(Exception x){
        println &lt;span class=&quot;code-quote&quot;&gt;&quot;\tresult with v=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;| *OK* |expecting exception, got exception --\n&quot;&lt;/span&gt;+x
    }

    println &lt;span class=&quot;code-quote&quot;&gt;&quot;CALL[$i] | with v=-2&quot;&lt;/span&gt;
    &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; b = javaTargetCaller(-2)
    println &lt;span class=&quot;code-quote&quot;&gt;&quot;\tresult with v=-2: expecting -5.0 : got &quot;&lt;/span&gt;+b
    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; b==-5
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You will note the first iteration the call will produce an exception as expected, however the next call with a param of -2, will cache something in the dynamic resolution, and all subsequent calls produce a number,&#160;&lt;/p&gt;
&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Output&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;CALL&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; | with null&lt;br/&gt;
&#160; call JavaTarget.primitiveMethod(null)&lt;br/&gt;
&#160; result with v=null| &lt;b&gt;OK&lt;/b&gt; |expecting exception, got exception &#8211;&lt;br/&gt;
&#160; groovy.lang.MissingMethodException: No signature of method: static test.JavaTarget.primitiveMethod() is applicable for argument types: (null) values: &lt;span class=&quot;error&quot;&gt;&amp;#91;null&amp;#93;&lt;/span&gt;&lt;br/&gt;
Possible solutions: primitiveMethod(double)&lt;/p&gt;

&lt;p&gt;CALL&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; | with v=-2&lt;br/&gt;
&#160; call JavaTarget.primitiveMethod(-2.0)&lt;br/&gt;
&#160; JavaTarget.primitiveMethod v=-2.0&lt;br/&gt;
&#160; result with v=-2: expecting -5.0 : got -5.0&lt;/p&gt;

&lt;p&gt;CALL&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; | with null&lt;br/&gt;
&#160; call JavaTarget.primitiveMethod(null)&lt;br/&gt;
&#160; JavaTarget.primitiveMethod v=0.0&lt;br/&gt;
&#160; result with v=null | &lt;b&gt;NOT-OK&lt;/b&gt; | expecting exception, got -3.0 --class java.lang.Double&lt;/p&gt;

&lt;p&gt;CALL&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; | with v=-2&lt;br/&gt;
&#160; call JavaTarget.primitiveMethod(-2.0)&lt;br/&gt;
&#160; JavaTarget.primitiveMethod v=-2.0&lt;br/&gt;
&#160; result with v=-2: expecting -5.0 : got -5.0&lt;/p&gt;

&lt;p&gt;CALL&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; | with null&lt;br/&gt;
&#160; call JavaTarget.primitiveMethod(null)&lt;br/&gt;
&#160; JavaTarget.primitiveMethod v=0.0&lt;br/&gt;
&#160; result with v=null | &lt;b&gt;NOT-OK&lt;/b&gt; | expecting exception, got -3.0 --class java.lang.Double&lt;/p&gt;

&lt;p&gt;CALL&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; | with v=-2&lt;br/&gt;
&#160; call JavaTarget.primitiveMethod(-2.0)&lt;br/&gt;
&#160; JavaTarget.primitiveMethod v=-2.0&lt;br/&gt;
&#160; result with v=-2: expecting -5.0 : got -5.0&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;-note that the very first call indeed failed to unbox the null and threw an exception, however immediately after the second correct call, the nulls start getting unboxed to 0 and no more exception get thrown.&lt;/p&gt;

&lt;p&gt;-it gets more inconsistent, if you change the order and call with a -2 first, then the nulls start getting unboxed to 0 immediately, and no exception is thrown ever&lt;/p&gt;

&lt;p&gt;Almost like some site call somewhere learns how to unbox a Double null, but it depends on the order in which it will be called.&lt;/p&gt;</description>
                <environment>JDK21&lt;br/&gt;
Groovy 4.0.26</environment>
        <key id="13631191">GROOVY-11782</key>
            <summary>Inconsistent unboxing of null, and resulting exceptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="val235">Val E</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Oct 2025 00:06:27 +0000</created>
                <updated>Mon, 13 Oct 2025 15:35:14 +0000</updated>
                            <resolved>Sun, 12 Oct 2025 17:26:22 +0000</resolved>
                                                    <fixVersion>3.0.26</fixVersion>
                    <fixVersion>4.0.29</fixVersion>
                    <fixVersion>5.0.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="18029326" author="emilles" created="Sun, 12 Oct 2025 17:26:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/7ca25f615fc8e32100ac5ced34e3963d0042ec60&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/7ca25f615fc8e32100ac5ced34e3963d0042ec60&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13434705">GROOVY-10535</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13483553">GROOVY-10772</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13543668">GROOVY-11126</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>groovy</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1y30o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>