<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:01:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-2307] Reading static metaClass property of a class replaces existing metaClass in registry</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-2307</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;When accessing the static metaClass method on a class, if it has a Custom MetaClass defined in the registry, it is overridden with an ExpandoMetaClass. This also affects already instantiated instances of the class.&lt;/p&gt;

&lt;p&gt;If we call &quot;println CustomMetaClassTest.metaClass&quot;, the existing CustomMetaClassTestMetaClass is replaced in the registry by an ExpandoMetaClass. Specfically, the static method GroovyDefaultMethods.getMetaClass(class c) creates an ExpandoMetaClass, and registers it, replacing whatever metaClass was already there.&lt;/p&gt;

&lt;p&gt;Example problem scenario:&lt;br/&gt;
I create a custom metaclass for a legacy Java class, to make it more &apos;Groovy&apos;-like. A user creates an instance of the Java class, and is using it. During the execution of his application, he calls &quot;println LegacyClass.metaClass&quot; so he can see which metaClass is being used. My custom metaClass is replaced by an expandoMetaclass, during runtime, and now method and property calls that my custom metaClass handled before the static call start to fail without warning.&lt;/p&gt;

&lt;p&gt;I have added a test case to the CustomMetaClassTest to demonstrate this issue&lt;br/&gt;
----------------------------------&lt;br/&gt;
Method added to test case (revision 9152)&lt;br/&gt;
The last 2 asserts currently fail&lt;br/&gt;
----------------------------------&lt;br/&gt;
  void testStaticMetaClass () &lt;/p&gt;
{
      assertTrue metaClass instanceof groovy.runtime.metaclass.groovy.bugs.CustomMetaClassTestMetaClass
      assertEquals  MetaClassImpl, metaClass.delegate.class
      def staticMetaClass = CustomMetaClassTest.metaClass
      assertTrue staticMetaClass instanceof groovy.runtime.metaclass.groovy.bugs.CustomMetaClassTestMetaClass
      assertTrue metaClass instanceof groovy.runtime.metaclass.groovy.bugs.CustomMetaClassTestMetaClass
  }</description>
                <environment>Windows XP&lt;br/&gt;
Java 1.6&lt;br/&gt;
built from subversion on 11/14</environment>
        <key id="12817317">GROOVY-2307</key>
            <summary>Reading static metaClass property of a class replaces existing metaClass in registry</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ait">Alex Tkachman</assignee>
                                    <reporter username="johannz">Adam Rinehart</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Nov 2007 01:28:08 +0000</created>
                <updated>Sat, 22 Dec 2007 21:04:57 +0000</updated>
                            <resolved>Fri, 16 Nov 2007 14:40:54 +0000</resolved>
                                    <version>1.1-rc-2</version>
                                    <fixVersion>1.1-rc-3</fixVersion>
                                    <component>groovy-jdk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14463565" author="blackdrag" created="Thu, 15 Nov 2007 09:27:52 +0000"  >&lt;p&gt;The MyClass.metaClass pattern is one for ExpandoMetaClass only atm. That means MyClass.metaClass must return an ExpandoMetaClass. To follow this pattern you have to make your class a subclass of ExpandoMetaClass instead of what you have now. A possible workaround would also be to use a category like this&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;myCategory {
  &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; getMetaClass(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; x) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; GroovySystem.metaClassRegistry.metaClass
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;when you use this category, then you get either the stored MetaClass (custom or not) or if no was stored before and ExapandoMetaclass is enabled globally, then you will get an ExpandoMetaClass instead. It is explicitly wished that ExpandoMetaClass overwrites even such a custom defined MetaClass.&lt;/p&gt;</comment>
                            <comment id="14463658" author="johannz" created="Thu, 15 Nov 2007 16:02:49 +0000"  >&lt;p&gt;In the release announcement for RC 1, &lt;a href=&quot;http://docs.codehaus.org/display/GROOVY/2007/10/12/Groovy+1.1-rc-1+released&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.codehaus.org/display/GROOVY/2007/10/12/Groovy+1.1-rc-1+released&lt;/a&gt;, it says: &quot;A new metaClass property is available on all objects, even on Java classes, so it&apos;s now easier to access the MetaClass of any instance&quot; and implies that this is a shortcut for GroovySystem.metaClassRegistry.getMetaClass(obj.class). Based on that announcement, it looks like metaClass should merely be a property accessor, not a special method that &lt;/p&gt;

&lt;p&gt;I understand the intention of the MyClass.metaClass pattern is only for ExpandoMetaClass, however the release announcement gave a different impression. Most people will not specifically look up the page, &lt;a href=&quot;http://groovy.codehaus.org/ExpandoMetaClass&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://groovy.codehaus.org/ExpandoMetaClass&lt;/a&gt;, where it is explained that the metaClass property ONLY returns an ExpandoMetaClass.&lt;/p&gt;

&lt;p&gt;Part of why I am making such an issue of this is that I am following the instructions on this page, &lt;a href=&quot;http://groovy.codehaus.org/Using+the+Delegating+Meta+Class&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://groovy.codehaus.org/Using+the+Delegating+Meta+Class&lt;/a&gt;, which specifically says &quot;Package Name Convention Solution&lt;br/&gt;
This second solution offers a more consistent augmentation of existing classes. There are no risks of unpredictable results from methods. The idea is that any package.class can have a custom meta class loaded at startup time by placing it into a well known package with a well known name.&quot;&lt;/p&gt;

&lt;p&gt;So if I am a library provider, I might package up a custom metaClass to make my existing code play nicely with groovy. The documentation specifically tells me to inherit from DelegatingMetaClass as the preferred way of doing this. Developers start using my class, and are happy that it plays well with groovy. Now, during debugging, they print MyCode.metaClass, for whatever reason. They aren&apos;t changing the metaClass, they just want to use the shortcut method to display what metaClass is being used. All of a sudden, my custom metaClass is replaced and their application fails.&lt;/p&gt;

&lt;p&gt;If this behavior is not going to change, which I will understand, I still believe a change is needed SOMEWHERE. One proposal I could make is Change DelegatingMetaclass.getProperty to catch &apos;metaClass&apos; and return GroovySystem.metaClassRegistry.getMetaClass(obj.class). This keeps the system close to the existing documentation. If the user does not need the expando functionality, they can still examine which metaclass is being used without breaking their code. If they do need the expando functionality, the library provider can delegate to an ExpandoMetaClass when subclassing. This formalizes the suggestion Jochen made about using a category and follows the principle of least surprise.&lt;/p&gt;

&lt;p&gt;If you still feel this issue is being correctly handled in EMC, please assign this to Alex Tkachman or someone that is working with the DelegatingMetaClass code to see if supporting changes, such as the one I proposed, should be considered.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12721752" name="CustomMetaClassTest.groovy" size="2735" author="johannz" created="Thu, 15 Nov 2007 01:28:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 2 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c0tj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>