<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:55:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-227] BigDecimal type does not behave as expected with operators (+, -, ...)</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-227</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Mathmatical operators such as +, -, ... do not behave as expected with java.math.BigDecimal.  They are coverted to Integer for + and -.&lt;br/&gt;
For example:&lt;br/&gt;
  bd = new java.math.BigDecimal(&quot;1.3&quot;);&lt;br/&gt;
  print 1 + bd;&lt;/p&gt;

&lt;p&gt;Shows 3, not 3.3 as expected.&lt;/p&gt;

&lt;p&gt;From post by Steve Goetze:&lt;br/&gt;
&amp;gt; The DefaultGroovyMethods: plus(Number, Number), minus(Number, &lt;br/&gt;
&amp;gt; Number), &lt;br/&gt;
&amp;gt; multiply(Number, Number), and divide(Number, Number) have coercion &lt;br/&gt;
&amp;gt; techniques that don&apos;t work very well for BigDecimal objects &lt;br/&gt;
&amp;gt; (results are &lt;br/&gt;
&amp;gt; generally coerced to Integer types except for divide which returns &lt;br/&gt;
&amp;gt; Double).  Would it be possible to change these methods to check for&lt;br/&gt;
&amp;gt; a left or right BigDecimal and preserve?  For example:&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt;     /**&lt;br/&gt;
&amp;gt;      * Add two Numbers&lt;br/&gt;
&amp;gt;      *&lt;br/&gt;
&amp;gt;      * @param left a Number&lt;br/&gt;
&amp;gt;      * @param right another Number to add&lt;br/&gt;
&amp;gt;      * @return the addition of both Numbers&lt;br/&gt;
&amp;gt;      */&lt;br/&gt;
&amp;gt;     public static Number plus(Number left, Number right) {&lt;br/&gt;
&amp;gt;         /** @todo maybe a double dispatch thing to handle new large &lt;br/&gt;
&amp;gt; numbers? */&lt;br/&gt;
&amp;gt;         if (isBigDecimal(left) || isBigDecimal(right)) &lt;/p&gt;
{
&amp;gt;             return asBigDecimal(left).add(asBigDecimal(right));
&amp;gt;         }
&lt;p&gt;&amp;gt;         else if (isBigInteger(left)  || isBigInteger(right)) &lt;/p&gt;
{
&amp;gt;             return new Double(left.doubleValue() + 
&amp;gt; right.doubleValue());
&amp;gt;         }&lt;br/&gt;
&amp;gt;         else if (isFloatingPoint(left) || isFloatingPoint(right)) {&amp;gt;             return new Double(left.doubleValue() + &amp;gt; right.doubleValue());&amp;gt;         }
&lt;p&gt;&amp;gt;         else if (isLong(left) || isLong(right)) &lt;/p&gt;
{
&amp;gt;             return new Long(left.longValue() + right.longValue());
&amp;gt;         }
&lt;p&gt;&amp;gt;         else &lt;/p&gt;
{
&amp;gt;             return new Integer(left.intValue() + right.intValue());
&amp;gt;         }
&lt;p&gt;&amp;gt;     }&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt;     where:&lt;br/&gt;
&amp;gt;    &lt;br/&gt;
&amp;gt;     public static boolean isBigDecimal(Number number) &lt;/p&gt;
{
&amp;gt;         return number instanceof BigDecimal;
&amp;gt;     }
&lt;p&gt;&amp;gt;    &lt;br/&gt;
&amp;gt;     and:&lt;br/&gt;
&amp;gt;    &lt;br/&gt;
&amp;gt;     public static BigDecimal asBigDecimal(Number n) &lt;/p&gt;
{
&amp;gt;         return (n instanceof BigDecimal ? (BigDecimal)n : new 
&amp;gt; BigDecimal(n.toString()));
&amp;gt;     }
&lt;p&gt;&amp;gt; &lt;br/&gt;
&amp;gt;    &lt;br/&gt;
&amp;gt; divide(Number, Number) could use a default rounding mode of &lt;br/&gt;
&amp;gt; BigDecimal.ROUND_UP.&lt;br/&gt;
&amp;gt;    &lt;br/&gt;
&amp;gt; Also, I don&apos;t see that literal longs and doubles can be specified ala &lt;br/&gt;
&amp;gt; java with an &quot;L&quot; or &quot;D&quot;.  If this is something you would consider &lt;br/&gt;
&amp;gt; adding, it would also be nice to be able to specify literal &lt;br/&gt;
&amp;gt; BigDecimals &lt;br/&gt;
&amp;gt; and BigIntegers, perhaps with a &quot;B&quot; suffix.&lt;/p&gt;</description>
                <environment>All</environment>
        <key id="12812390">GROOVY-227</key>
            <summary>BigDecimal type does not behave as expected with operators (+, -, ...)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="goetze">Steve Goetze</assignee>
                                    <reporter username="bl7385">Brian Larson</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Mar 2004 10:01:23 +0000</created>
                <updated>Thu, 11 Mar 2004 10:11:19 +0000</updated>
                            <resolved>Thu, 11 Mar 2004 10:11:19 +0000</resolved>
                                    <version>1.0-beta-3</version>
                    <version>1.0-beta-4</version>
                                    <fixVersion>1.0-beta-4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14459887" author="goetze" created="Fri, 5 Mar 2004 14:08:00 +0000"  >&lt;p&gt;Will fix compareTo() and add BigInteger to the dispatch process.&lt;/p&gt;</comment>
                            <comment id="14459897" author="bl7385" created="Fri, 5 Mar 2004 15:10:48 +0000"  >&lt;p&gt;I&apos;d be happy to write the test cases.&lt;/p&gt;</comment>
                            <comment id="14459800" author="jstrachan" created="Sat, 6 Mar 2004 06:21:20 +0000"  >&lt;p&gt;Great stuff - please just append any code or test cases to this issue and then we can commit them.&lt;/p&gt;</comment>
                            <comment id="14459883" author="goetze" created="Tue, 9 Mar 2004 17:26:46 +0000"  >&lt;p&gt;Brian Larson and I have been discussing this in some detail.  I think we have come up with a workable approach.  The attached patch adds support for number type promotion including BigDecimals and BigIntegers.  This patch contains a basic testcase and an updated operators.wiki document that describes the approach.  &lt;/p&gt;

&lt;p&gt;I&apos;m afraid I don&apos;t know how to propery test wiki changes, so please look these over and let me know if they are ok.&lt;/p&gt;

&lt;p&gt;Please note that I modified ClassGenerator to change the method name associated with the DIVIDE token from &apos;divide&apos; to &apos;div&apos;.  This is so the DefaultGroovyMethod will be called for division &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/check.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; operations that have two BigInteger arguments.  Note that the names abs() and multiply() also collide, but I didn&apos;t need to change these as their default behavior is OK.  However, it might be worth considering changing them just to avoid confusion.&lt;/p&gt;

&lt;p&gt;FWIW I found an interesting Python PEP that discusses many of these same issues - they have a much more difficult problem with backward compatibility because python originally started with binary floating point math as the default.  Here&apos;s the link:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.python.org/peps/pep-0327.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.python.org/peps/pep-0327.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please note that this patch does not include code to generate BigDecimals from literals by default as discussed on groovy-dev.  I&apos;d be happy to work on that if needed.&lt;/p&gt;</comment>
                            <comment id="14459963" author="goetze" created="Wed, 10 Mar 2004 09:49:40 +0000"  >&lt;p&gt;Updated the patch:&lt;/p&gt;

&lt;p&gt;1.) Removed operators.wiki update from the patch until I determine where it should go.&lt;/p&gt;

&lt;p&gt;2.) Fixed a bug I introduced in DefaultGroovyMethods.multiply for Character.&lt;/p&gt;</comment>
                            <comment id="14459984" author="jstrachan" created="Wed, 10 Mar 2004 11:49:52 +0000"  >&lt;p&gt;Patch now applied - many thanks! Is this issue now closed or is there more work to do?&lt;/p&gt;</comment>
                            <comment id="14459830" author="bl7385" created="Wed, 10 Mar 2004 11:57:27 +0000"  >&lt;p&gt;I&apos;m working on the test cases today...  Hopefully I will be able to submit a patch with the new test cases soon.&lt;/p&gt;</comment>
                            <comment id="14459921" author="bl7385" created="Wed, 10 Mar 2004 13:44:09 +0000"  >&lt;p&gt;James: Can you add a math directory under src/test/groovy for the groovy-core project.  I want to put all the math test cases there because it is a little hard to find them all right now.  Since I don&apos;t have CVS commit authority, I need to submit patches.  The patch process does not work for new directories which are not in CVS (AFAIK).&lt;/p&gt;</comment>
                            <comment id="14459901" author="bl7385" created="Wed, 10 Mar 2004 14:15:12 +0000"  >&lt;p&gt;James: Never mind.  It seems that the patch limitation for new directories is only a problem under Eclipse 2.1x.  Eclipse 3.0 m5 seems to work fine.  Sorry for the confusion.&lt;/p&gt;</comment>
                            <comment id="14459848" author="goetze" created="Wed, 10 Mar 2004 14:55:30 +0000"  >&lt;p&gt;Attached updated operators.wiki for commit&lt;/p&gt;</comment>
                            <comment id="14459872" author="bl7385" created="Wed, 10 Mar 2004 23:18:47 +0000"  >&lt;p&gt;I created the related issue for using BigDecimals by default for numeric literals with a decimal point and to support numeric literal suffixes to specify the type.  I also assigned myself the issue.  If this is not ok with everyone, let me know.  See issue 256.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12720869" name="number_math_2.patch" size="29209" author="goetze" created="Wed, 10 Mar 2004 09:49:40 +0000"/>
                            <attachment id="12720871" name="operators.wiki" size="4857" author="goetze" created="Wed, 10 Mar 2004 14:55:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            21 years, 38 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bwrr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>