<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:32:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-6101] verify error with compile static </title>
                <link>https://issues.apache.org/jira/browse/GROOVY-6101</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;This method (full sample code attached)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @CompileStatic
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; hashCode() {
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; hash = 0
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 64; i++)
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (board[i]?.ordinal())
                hash = (hash * 13) + i + board[i].ordinal()

	&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; ret = (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) hash		
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ret
    }
...
    Piece[] board = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Piece[64]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;causes a verify error: java.lang.VerifyError: (class: Board, method: hashCode signature: ()I) Expecting to find integer on stack.&lt;/p&gt;

&lt;p&gt;The problem seems to be related to the enum (&quot;Piece&quot;) that is used in &quot;board&quot;; when i change board to int[], it works fine.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12816830">GROOVY-6101</key>
            <summary>verify error with compile static </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="melix">C&#233;dric Champeau</assignee>
                                    <reporter username="peterd">Peter Doornbosch</reporter>
                        <labels>
                    </labels>
                <created>Sat, 13 Apr 2013 06:13:04 +0000</created>
                <updated>Sat, 1 Jun 2013 06:11:54 +0000</updated>
                            <resolved>Tue, 16 Apr 2013 12:18:22 +0000</resolved>
                                    <version>2.1.3</version>
                                    <fixVersion>2.1.4</fixVersion>
                                    <component>Static compilation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14474411" author="melix" created="Tue, 16 Apr 2013 09:39:05 +0000"  >&lt;p&gt;The error comes from the usage of the nullsafe operator on a method that returns a primitive type. I managed to reproduce the issue with this code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Piece {
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; x() { 333 }
}

@groovy.transform.CompileStatic
void foo() {
    Piece[] pieces = [&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Piece(), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] as Piece[]
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; sum = 0
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i=0;i&amp;lt;pieces.length;i++) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (pieces[i]?.x()) {
            sum += pieces[i].x()
        }
    }
    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; sum == 333
}
foo()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When the nullsafe operator is called, the method call may return &lt;tt&gt;null&lt;/tt&gt; but as we&apos;re statically compiling, the result is incompatible with the method signature of &lt;tt&gt;x&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14474253" author="melix" created="Tue, 16 Apr 2013 12:17:38 +0000"  >&lt;p&gt;Raising to critical because it shows another error which is critical:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic

@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
   &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; hasSideEffect = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
   &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; x() { hasSideEffect=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; 333 }
}
            
@CompileStatic
void test() {            
   Foo foo = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Foo()
   &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (foo.x()==&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      println &lt;span class=&quot;code-quote&quot;&gt;&apos;ok&apos;&lt;/span&gt;
   }
   &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; foo.hasSideEffect
}

test()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This fails because the static compiler assumes that comparing an int to null will always return null. This is true, but we should &lt;b&gt;always&lt;/b&gt; evaluate the LHS of the comparison because it can have side effects.&lt;/p&gt;</comment>
                            <comment id="14474284" author="melix" created="Tue, 16 Apr 2013 12:18:23 +0000"  >&lt;p&gt;Thanks for spotting that!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722940" name="staticcompileerror.groovy" size="1354" author="peterd" created="Sat, 13 Apr 2013 06:13:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bw0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>