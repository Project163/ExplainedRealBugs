<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:59:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-1980] GSE non-optimal behaviour</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-1980</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;From the mailing list:&lt;/p&gt;

&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;While trying to understand why GSE was so slow, I discovered a few bugs there&lt;/p&gt;

&lt;p&gt;1) GSE in some cases doesn&apos;t close the connection it opens in &lt;br/&gt;
getResourceConnection() and in updateCacheEntry(). I fixed the one in &lt;br/&gt;
updateCacheEntry but it could still be some instances where &lt;br/&gt;
getResourceConnection at groovyScriptConn.getInputStream(); where it is not &lt;br/&gt;
closed later on in the code.&lt;/p&gt;

&lt;p&gt;2) loadByScriptName(String) should not be deprecated, only &lt;br/&gt;
loadByScriptName(String, ClassLoader)&lt;/p&gt;

&lt;p&gt;3) loadByScriptName(String) should not use groovyLoader but &lt;br/&gt;
initGroovyLoader(getClass().getParentLoader())&lt;/p&gt;

&lt;p&gt;This will increase the loading significantly since it will be able to reuse &lt;br/&gt;
the cached entries.&lt;/p&gt;

&lt;p&gt;HTH&lt;/p&gt;

&lt;p&gt;Pascal&lt;/p&gt;



&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;--- ../../../../groovy-core/src/main/groovy/util/GroovyScriptEngine.java	2007-07-09 14:27:19.000000000 -0700
+++ ./GroovyScriptEngine.java	2007-07-09 15:17:04.000000000 -0700
@@ -18,6 +18,7 @@
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.lang.Binding;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.lang.GroovyClassLoader;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.lang.Script;
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovyjarjarantlr.TokenStreamIOException;
 
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.*;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.net.MalformedURLException;
@@ -94,6 +95,7 @@
      */
     &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void initGroovyLoader (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; parentClassLoader) {
         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (groovyLoader == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || groovyLoader.getParent() != parentClassLoader) {
+        
             groovyLoader = 
                 (GroovyClassLoader) AccessController.doPrivileged(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PrivilegedAction() {
                     &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; run() {
@@ -149,6 +151,8 @@
         ResourceException se = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
         &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; roots.length; i++) {
             URL scriptURL = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
+            InputStream in = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
+            
             &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                 scriptURL = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URL(roots[i], resourceName);
 
@@ -156,7 +160,7 @@
 
                 &lt;span class=&quot;code-comment&quot;&gt;// Make sure we can open it, &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we can&lt;span class=&quot;code-quote&quot;&gt;&apos;t it doesn&apos;&lt;/span&gt;t exist.
&lt;/span&gt;                 &lt;span class=&quot;code-comment&quot;&gt;// Could be very slow &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; there are any non-file:// URLs in there
&lt;/span&gt;-                groovyScriptConn.getInputStream();
+                in = groovyScriptConn.getInputStream();
 
                 &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;; &lt;span class=&quot;code-comment&quot;&gt;// Now &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is a bit unusual
&lt;/span&gt; 
@@ -174,7 +178,7 @@
                 } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                     se = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ResourceException(message, se);
                 }
-            }
+            } 
         }
 
         &lt;span class=&quot;code-comment&quot;&gt;// If we didn&apos;t find anything, report on all the exceptions that occurred.
&lt;/span&gt;@@ -264,15 +268,16 @@
 
     /**
      * Get the &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;of the scriptName in question, so that you can instantiate Groovy objects with caching and reloading.
-     * Note: This method is deprecated because we should not use a different parentClassLoader
      * @param scriptName
      * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; the loaded scriptName as a compiled class
      * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ResourceException
      * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ScriptException
-     * @deprecated
+
      */
     &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; loadScriptByName(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; scriptName) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ResourceException, ScriptException {
-        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; loadScriptByName( scriptName, getClass().getClassLoader ());
+        scriptName = scriptName.replace(&lt;span class=&quot;code-quote&quot;&gt;&apos;.&apos;&lt;/span&gt;, File.separatorChar) + &lt;span class=&quot;code-quote&quot;&gt;&quot;.groovy&quot;&lt;/span&gt;;
+        ScriptCacheEntry entry = updateCacheEntry(scriptName);
+        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; entry.scriptClass;
     }
 
 
@@ -287,10 +292,8 @@
      */
     &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; loadScriptByName(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; scriptName, &lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; parentClassLoader)
             &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ResourceException, ScriptException {
-        scriptName = scriptName.replace(&lt;span class=&quot;code-quote&quot;&gt;&apos;.&apos;&lt;/span&gt;, File.separatorChar) + &lt;span class=&quot;code-quote&quot;&gt;&quot;.groovy&quot;&lt;/span&gt;;
         initGroovyLoader (parentClassLoader);
-        ScriptCacheEntry entry = updateCacheEntry(scriptName);
-        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; entry.scriptClass;
+        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; loadScriptByName (scriptName);
     }
 
     /**
@@ -343,12 +346,21 @@
                 &lt;span class=&quot;code-comment&quot;&gt;// Make a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; entry
&lt;/span&gt;                 ScriptCacheEntry currentCacheEntry = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ScriptCacheEntry();
                 currentCacheEntryHolder.set(currentCacheEntry);
+                InputStream in = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
+                
                 &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
-                    currentCacheEntry.scriptClass = groovyLoader.parseClass(groovyScriptConn.getInputStream(), scriptName);
+                    in = groovyScriptConn.getInputStream();
+                    currentCacheEntry.scriptClass = groovyLoader.parseClass(in, scriptName);
                 } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
                     &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ScriptException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Could not parse scriptName: &quot;&lt;/span&gt; + scriptName, e);
                 } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt;{
                     currentCacheEntryHolder.set(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
+
+                    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+                        in.close();
+                    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
+                        &lt;span class=&quot;code-comment&quot;&gt;// Do nothing: Just want to make sure it is closed
&lt;/span&gt;+                    }
                 }
                 
                 currentCacheEntry.lastModified = lastModified;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="12813661">GROOVY-1980</key>
            <summary>GSE non-optimal behaviour</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="paulk">Paul King</reporter>
                        <labels>
                    </labels>
                <created>Sat, 14 Jul 2007 00:42:43 +0000</created>
                <updated>Tue, 7 Apr 2015 19:06:54 +0000</updated>
                            <resolved>Sat, 14 Jul 2007 02:08:24 +0000</resolved>
                                    <version>1.1-beta-2</version>
                                    <fixVersion>1.1-beta-3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14477387" author="paulk" created="Sat, 14 Jul 2007 02:08:24 +0000"  >&lt;p&gt;patch looked reasonable, applied to HEAD&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 20 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2csjb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>