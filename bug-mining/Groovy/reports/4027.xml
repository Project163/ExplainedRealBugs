<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:11:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-9973] @CompileStatic: Binary operation with property throws ClassCastException</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-9973</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;&lt;b&gt;Problem&lt;/b&gt;&lt;br/&gt;
 Build fails when applying a binary operation to a property inside a method, depending on whether a parameter is involved:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ClassCastException: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.codehaus.groovy.ast.Parameter cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.codehaus.groovy.ast.expr.VariableExpression
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;or not:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
BUG! exception in phase &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;generation&apos;&lt;/span&gt; in source unit
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Problem does not appear under @TypeChecked, nor when the class member is a field or the field is not accessed throug a property.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Expected&lt;/b&gt;&lt;br/&gt;
 Code should compile.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Sample Code&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test @Ignore
void &lt;span class=&quot;code-quote&quot;&gt;&apos;Groovy 3-0-7 Arithmetic operation with property &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ClassCastException&apos;&lt;/span&gt;() {
	&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; goo = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Goo()

	&lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;	&lt;span class=&quot;code-comment&quot;&gt;// ClassCastException: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.codehaus.groovy.ast.Parameter cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.codehaus.groovy.ast.expr.VariableExpression
&lt;/span&gt;	&lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;	&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; result = goo.calc(123)

	&lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;	&lt;span class=&quot;code-comment&quot;&gt;// BUG! exception in phase &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;generation&apos;&lt;/span&gt; in source unit ... On receiver: 3 with message: minus and arguments: nrNewEntries
&lt;/span&gt;	&lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt; 	&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; result = goo.calc()
	&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; result == 333
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@CompileStatic
&lt;span class=&quot;code-comment&quot;&gt;//@TypeChecked // works
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Goo {
	&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; nrNewEntries // field without property wrapper works
&lt;/span&gt;	&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; nrNewEntries() { nrNewEntriesField } // non-property method works
&lt;/span&gt;	&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; nrNewEntriesField
	&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; getNrNewEntries() { nrNewEntriesField }

	/*
			Groovyc: While compiling [tests of GroovySimple]: java.lang.ClassCastException: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.codehaus.groovy.ast.Parameter cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.codehaus.groovy.ast.expr.VariableExpression (org.codehaus.groovy.ast.Parameter and org.codehaus.groovy.ast.expr.VariableExpression are in unnamed module of loader org.jetbrains.jps.incremental.groovy.JointCompilationClassLoader @12011fbf)
			at org.codehaus.groovy.classgen.asm.sc.StaticTypesCallSiteWriter.makeSingleArgumentCall(StaticTypesCallSiteWriter.java:598)
			at org.codehaus.groovy.classgen.asm.InvocationWriter.makeSingleArgumentCall(InvocationWriter.java:616)
			at org.codehaus.groovy.classgen.asm.BinaryExpressionHelper.evaluateBinaryExpression(BinaryExpressionHelper.java:590)
			at org.codehaus.groovy.classgen.asm.BinaryExpressionMultiTypeDispatcher.evaluateBinaryExpression(BinaryExpressionMultiTypeDispatcher.java:242)
			at org.codehaus.groovy.classgen.asm.BinaryExpressionHelper.eval(BinaryExpressionHelper.java:222)
			at org.codehaus.groovy.classgen.AsmClassGenerator.visitBinaryExpression(AsmClassGenerator.java:707)
			at org.codehaus.groovy.ast.expr.BinaryExpression.visit(BinaryExpression.java:58)
			at org.codehaus.groovy.classgen.asm.StatementWriter.writeReturn(StatementWriter.java:613)
			at org.codehaus.groovy.classgen.AsmClassGenerator.visitReturnStatement(AsmClassGenerator.java:681)
			at org.codehaus.groovy.ast.stmt.ReturnStatement.visit(ReturnStatement.java:73)
			at org.codehaus.groovy.classgen.asm.StatementWriter.writeBlockStatement(StatementWriter.java:94)
			at org.codehaus.groovy.classgen.asm.sc.StaticTypesStatementWriter.writeBlockStatement(StaticTypesStatementWriter.java:78)
			at org.codehaus.groovy.classgen.AsmClassGenerator.visitBlockStatement(AsmClassGenerator.java:617)
			at org.codehaus.groovy.ast.stmt.BlockStatement.visit(BlockStatement.java:69)
			at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitClassCodeContainer(ClassCodeVisitorSupport.java:138)
			at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitConstructorOrMethod(ClassCodeVisitorSupport.java:111)
			at org.codehaus.groovy.classgen.AsmClassGenerator.visitStdMethod(AsmClassGenerator.java:461)
			at org.codehaus.groovy.classgen.AsmClassGenerator.visitConstructorOrMethod(AsmClassGenerator.java:408)
			at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitMethod(ClassCodeVisitorSupport.java:106)
			at org.codehaus.groovy.classgen.AsmClassGenerator.visitMethod(AsmClassGenerator.java:556)
			at org.codehaus.groovy.ast.ClassNode.visitMethods(ClassNode.java:1099)
			at org.codehaus.groovy.ast.ClassNode.visitContents(ClassNode.java:1092)
			at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitClass(ClassCodeVisitorSupport.java:52)
			at org.codehaus.groovy.classgen.AsmClassGenerator.visitClass(AsmClassGenerator.java:271)
			at org.codehaus.groovy.control.CompilationUnit$3.call(CompilationUnit.java:797)
			at org.codehaus.groovy.control.CompilationUnit$IPrimaryClassNodeOperation.doPhaseOperation(CompilationUnit.java:942)
			at org.codehaus.groovy.control.CompilationUnit.processPhaseOperations(CompilationUnit.java:671)
			at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:635)
	*/
&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; calc(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i) { i - nrNewEntries }

/*
		Groovyc: While compiling [tests of GroovySimple]: BUG! exception in phase &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;generation&apos;&lt;/span&gt; in source unit &lt;span class=&quot;code-quote&quot;&gt;&apos;C:\source\GroovySimple\test\simple\groovy\bugs\groovy3\gb_2021_03_08\property_arithmetic_op_throws_class_cast\Goo.groovy&apos;&lt;/span&gt; At line 49 column 19
		On receiver: 3 with message: minus and arguments: nrNewEntries
		This method should not have been called. Please &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; to create a simple example reproducing
		&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; error and file a bug report at https:&lt;span class=&quot;code-comment&quot;&gt;//issues.apache.org/jira/browse/GROOVY
&lt;/span&gt;			at org.codehaus.groovy.classgen.asm.sc.StaticTypesCallSiteWriter.makeSingleArgumentCall(StaticTypesCallSiteWriter.java:607)
			at org.codehaus.groovy.classgen.asm.InvocationWriter.makeSingleArgumentCall(InvocationWriter.java:616)
			at org.codehaus.groovy.classgen.asm.BinaryExpressionHelper.evaluateBinaryExpression(BinaryExpressionHelper.java:590)
			at org.codehaus.groovy.classgen.asm.BinaryExpressionMultiTypeDispatcher.evaluateBinaryExpression(BinaryExpressionMultiTypeDispatcher.java:242)
			at org.codehaus.groovy.classgen.asm.BinaryExpressionHelper.eval(BinaryExpressionHelper.java:222)
			at org.codehaus.groovy.classgen.AsmClassGenerator.visitBinaryExpression(AsmClassGenerator.java:707)
			at org.codehaus.groovy.ast.expr.BinaryExpression.visit(BinaryExpression.java:58)
			at org.codehaus.groovy.classgen.asm.StatementWriter.writeReturn(StatementWriter.java:613)
			at org.codehaus.groovy.classgen.AsmClassGenerator.visitReturnStatement(AsmClassGenerator.java:681)
			at org.codehaus.groovy.ast.stmt.ReturnStatement.visit(ReturnStatement.java:73)
			at org.codehaus.groovy.classgen.asm.StatementWriter.writeBlockStatement(StatementWriter.java:94)
			at org.codehaus.groovy.classgen.asm.sc.StaticTypesStatementWriter.writeBlockStatement(StaticTypesStatementWriter.java:78)
			at org.codehaus.groovy.classgen.AsmClassGenerator.visitBlockStatement(AsmClassGenerator.java:617)
			at org.codehaus.groovy.ast.stmt.BlockStatement.visit(BlockStatement.java:69)
			at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitClassCodeContainer(ClassCodeVisitorSupport.java:138)
			at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitConstructorOrMethod(ClassCodeVisitorSupport.java:111)
			at org.codehaus.groovy.classgen.AsmClassGenerator.visitStdMethod(AsmClassGenerator.java:461)
			at org.codehaus.groovy.classgen.AsmClassGenerator.visitConstructorOrMethod(AsmClassGenerator.java:408)
			at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitMethod(ClassCodeVisitorSupport.java:106)
			at org.codehaus.groovy.classgen.AsmClassGenerator.visitMethod(AsmClassGenerator.java:556)
			at org.codehaus.groovy.ast.ClassNode.visitMethods(ClassNode.java:1099)
			at org.codehaus.groovy.ast.ClassNode.visitContents(ClassNode.java:1092)
			at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitClass(ClassCodeVisitorSupport.java:52)
			at org.codehaus.groovy.classgen.AsmClassGenerator.visitClass(AsmClassGenerator.java:271)
			at org.codehaus.groovy.control.CompilationUnit$3.call(CompilationUnit.java:797)
			at org.codehaus.groovy.control.CompilationUnit$IPrimaryClassNodeOperation.doPhaseOperation(CompilationUnit.java:942)
			at org.codehaus.groovy.control.CompilationUnit.processPhaseOperations(CompilationUnit.java:671)
			at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:635)
			at org.jetbrains.groovy.compiler.rt.GroovyCompilerWrapper.compile(GroovyCompilerWrapper.java:48)
			at org.jetbrains.groovy.compiler.rt.DependentGroovycRunner.runGroovyc(DependentGroovycRunner.java:118)
			at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
			at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
			at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
			at java.base/java.lang.reflect.Method.invoke(Method.java:566)
			at org.jetbrains.groovy.compiler.rt.GroovycRunner.intMain2(GroovycRunner.java:81)
			at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
			at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
			at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
			at java.base/java.lang.reflect.Method.invoke(Method.java:566)
			at org.jetbrains.jps.incremental.groovy.InProcessGroovyc.runGroovycInThisProcess(InProcessGroovyc.java:167)
			at org.jetbrains.jps.incremental.groovy.InProcessGroovyc.lambda$runGroovyc$0(InProcessGroovyc.java:77)
			at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
			at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
			at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
			at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:834)
*/
&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; calc() { 333 - nrNewEntries }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13363085">GROOVY-9973</key>
            <summary>@CompileStatic: Binary operation with property throws ClassCastException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="emge">mgroovy</reporter>
                        <labels>
                    </labels>
                <created>Mon, 8 Mar 2021 19:58:11 +0000</created>
                <updated>Sun, 2 May 2021 09:16:36 +0000</updated>
                            <resolved>Tue, 9 Mar 2021 15:35:27 +0000</resolved>
                                    <version>3.0.7</version>
                                    <fixVersion>3.0.8</fixVersion>
                    <fixVersion>4.0.0-alpha-3</fixVersion>
                                    <component>Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 36 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ofa0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>