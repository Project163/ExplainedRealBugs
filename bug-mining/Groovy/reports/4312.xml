<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:16:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-10232] Massive increase in memory usage due to CacheableCallSite</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-10232</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;When upgrading our tests from Spock 1.3 with Groovy 2.5 to Spock 2.0 with Groovy 3.0.9, we are seeing issue with memory usage caused by CacheableCallSite. This memory seems to be retained in classes and is therefore never freed. A single Spock test class can take as much as 150mb memory. The total amount of memory sums up to several gigabytes of additional memory, causing our tests to take about 3 times as much memory as with Spock 1.3 and Groovy 2.5.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13400808">GROOVY-10232</key>
            <summary>Massive increase in memory usage due to CacheableCallSite</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daniel_sun">Daniel Sun</assignee>
                                    <reporter username="papegaaij">Emond Papegaaij</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Sep 2021 14:44:16 +0000</created>
                <updated>Thu, 21 Apr 2022 14:45:40 +0000</updated>
                            <resolved>Sat, 8 Jan 2022 13:57:05 +0000</resolved>
                                    <version>3.0.9</version>
                                    <fixVersion>3.0.10</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                    <component>groovy-runtime</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="17433459" author="daniel_sun" created="Sun, 24 Oct 2021 16:46:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/pull/1647&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1647&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17433460" author="daniel_sun" created="Sun, 24 Oct 2021 16:49:01 +0000"  >&lt;p&gt;If you could run your tests with the following snapshot of Groovy 4 and give us some feedback, that would be great.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/groovy/actions/runs/1375230234&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/actions/runs/1375230234&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17445919" author="papegaaij" created="Thu, 18 Nov 2021 13:22:00 +0000"  >&lt;p&gt;Our tests are built with Spock, which is not compatible with groovy 4. Any chance this will be backported to 3? I&apos;d be more than happy to give it a try if you can provide me with maven artifacts for a patched Groovy 3 SNAPSHOT. The link to the SNAPSHOT build on github does not seem to contain any maven artifacts.&lt;/p&gt;</comment>
                            <comment id="17446156" author="paulk" created="Thu, 18 Nov 2021 21:42:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=papegaaij&quot; class=&quot;user-hover&quot; rel=&quot;papegaaij&quot;&gt;papegaaij&lt;/a&gt; Just FYI, there is a switch for Spock for working with Groovy 4 - it is used by the Groovy build for instance.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/groovy/blob/master/buildSrc/src/main/groovy/org.apache.groovy-base.gradle#L220&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/blob/master/buildSrc/src/main/groovy/org.apache.groovy-base.gradle#L220&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17446419" author="papegaaij" created="Fri, 19 Nov 2021 10:22:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulk&quot; class=&quot;user-hover&quot; rel=&quot;paulk&quot;&gt;paulk&lt;/a&gt; It&apos;s not just Spock, but our entire infrastructure to run tests. Our tests are based on Arquillian, so for Groovy 4 to work, I will need to update our integration for Spock and Arquillian (&lt;a href=&quot;https://github.com/topicusonderwijs/arquillian-testrunner-spock/tree/spock-2.0-junit5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/topicusonderwijs/arquillian-testrunner-spock/tree/spock-2.0-junit5&lt;/a&gt;) as well. Also, because the maven coordinates have changed, this will need to be changed in our packaging as well, because Arquillian will need to know which classes to include with the tests to run. As you might understand, this will require a significant effort and the results will not be entirely reliable, because it&apos;s all based on experimental releases and things that are not built to work together.&lt;/p&gt;

&lt;p&gt;The patch applies cleanly on the GROOVY_3.0.X branch, so I did a run with that version. It looks like the problem is fixed. I&apos;ve reduced the memory settings to the values we used for Groovy 2.5 and no longer get an OutOfMemoryError.&lt;/p&gt;</comment>
                            <comment id="17470744" author="ian.springer" created="Fri, 7 Jan 2022 16:42:00 +0000"  >&lt;p&gt;My team also encountered this issue with our Groovy test suites after upgrading from Groovy 2.x to Groovy 3.0.9. We are running our tests on GraalVM 21.2.0 (JDK 11.0.12) with TestNG 6.14.3. We increased the max heap size for our integration test suite from 4 GB to 18 GB and still ran out of heap. At the point when the JVM ran out of heap there were 108K instances of CacheableCallSite consuming 18.5 GB (96%) of the heap.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We are going to try the patch from PR 1647, but would prefer not having to fork Groovy to work around this issue. We noticed PR 1647 has been closed. Does the Groovy team still plan on addressing this issue?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="17471137" author="daniel_sun" created="Sat, 8 Jan 2022 13:57:05 +0000"  >&lt;p&gt;Fixed by &lt;a href=&quot;https://github.com/apache/groovy/commit/66bb24acabe6a7a700c3d09c8fa0bc6b236d535b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/66bb24acabe6a7a700c3d09c8fa0bc6b236d535b&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17471144" author="daniel_sun" created="Sat, 8 Jan 2022 14:18:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ian.springer&quot; class=&quot;user-hover&quot; rel=&quot;ian.springer&quot;&gt;ian.springer&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=papegaaij&quot; class=&quot;user-hover&quot; rel=&quot;papegaaij&quot;&gt;papegaaij&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Please give it a try, if the issue is solved, I&apos;ll close it:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/actions/runs/1671424767&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/actions/runs/1671424767&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17471618" author="ian.springer" created="Sun, 9 Jan 2022 23:54:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daniel_sun&quot; class=&quot;user-hover&quot; rel=&quot;daniel_sun&quot;&gt;daniel_sun&lt;/a&gt;, it looks like that did the trick. Thanks!&lt;/p&gt;</comment>
                            <comment id="17471824" author="papegaaij" created="Mon, 10 Jan 2022 10:01:16 +0000"  >&lt;p&gt;I can also confirm that the memory usage has dropped back to what it was in groovy 2. Do you have any idea when we can expect a 3.0.10 release with this fix?&lt;/p&gt;</comment>
                            <comment id="17472170" author="daniel_sun" created="Mon, 10 Jan 2022 17:14:55 +0000"  >&lt;p&gt;Thanks for your feedback.&lt;/p&gt;

&lt;p&gt;As for 3.0.10 release plan, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulk&quot; class=&quot;user-hover&quot; rel=&quot;paulk&quot;&gt;paulk&lt;/a&gt; can tell us &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17472407" author="paulk" created="Tue, 11 Jan 2022 02:28:29 +0000"  >&lt;p&gt;I will do the release for 3.0.10 at the same time or shortly after 4 GA.&lt;/p&gt;</comment>
                            <comment id="17472485" author="ian.springer" created="Tue, 11 Jan 2022 06:29:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulk&quot; class=&quot;user-hover&quot; rel=&quot;paulk&quot;&gt;paulk&lt;/a&gt;, when do you think 4 will go GA? Thanks!&lt;/p&gt;</comment>
                            <comment id="17472490" author="chadwilson" created="Tue, 11 Jan 2022 06:38:56 +0000"  >&lt;p&gt;Thanks for the work here! I&apos;ve been scratching my head about which change has caused instability on builds for &lt;a href=&quot;https://github.com/gocd/gocd/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/gocd/gocd/&lt;/a&gt; for some time, but suspect this one.&lt;/p&gt;

&lt;p&gt;Does anyone know if this is likely to have affected all 3.0.x versions, or only a particular point/patch release - i.e could a downgrade to an earlier 3.0.x version help?&lt;/p&gt;</comment>
                            <comment id="17487425" author="chadwilson" created="Sat, 5 Feb 2022 06:51:19 +0000"  >&lt;p&gt;I see 4.0.0 is GA as of 11 days ago (congratulations!), and there is quite a bit work on 3.0.10 going on based on &lt;a href=&quot;https://github.com/apache/groovy/commits/GROOVY_3_0_X&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commits/GROOVY_3_0_X&lt;/a&gt; - hopefully we are close to a release here &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310361">
                    <name>Blocked</name>
                                                                <inwardlinks description="Blocked">
                                        <issuelink>
            <issuekey id="13406668">GROOVY-10307</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13423039">GROOVY-10454</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13033421" name="Screenshot_20210913_161502.png" size="214316" author="papegaaij" created="Mon, 13 Sep 2021 14:44:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 40 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0uuzc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>