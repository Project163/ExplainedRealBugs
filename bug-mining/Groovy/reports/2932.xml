<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:46:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-7518] hashCode() throws NPE when using @CompileStatic with @EqualsAndHashCode</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-7518</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Given the following class&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Person.groovy&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.EqualsAndHashCode

@EqualsAndHashCode
@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Person {
	&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; someLong
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the test&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;PersonTest.groovy&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.junit.Assert.*

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.Test

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;PersonTest {

	@Test
	void hashcodeWithoutLongValue() {
		def person = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Person()
		&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; person.hashCode()
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the gradle configuration:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;build.gradle&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;buildscript {
    repositories {
        mavenCentral()
    }
}

apply plugin: &lt;span class=&quot;code-quote&quot;&gt;&apos;groovy&apos;&lt;/span&gt;
apply plugin: &lt;span class=&quot;code-quote&quot;&gt;&apos;eclipse&apos;&lt;/span&gt;

jar {
    baseName = &lt;span class=&quot;code-quote&quot;&gt;&apos;HashCodeNPE&apos;&lt;/span&gt;
    version = &lt;span class=&quot;code-quote&quot;&gt;&apos;0.0.1-SNAPSHOT&apos;&lt;/span&gt;
}
sourceCompatibility = 1.8
targetCompatibility = 1.8

repositories {
    mavenCentral()
}


dependencies {
    compile(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.codehaus.groovy:groovy:2.4.4&quot;&lt;/span&gt;)
	testCompile(&lt;span class=&quot;code-quote&quot;&gt;&quot;junit:junit:4.12&quot;&lt;/span&gt;)
}


eclipse {
    classpath {
         containers.remove(&lt;span class=&quot;code-quote&quot;&gt;&apos;org.eclipse.jdt.launching.JRE_CONTAINER&apos;&lt;/span&gt;)
         containers &lt;span class=&quot;code-quote&quot;&gt;&apos;org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.8&apos;&lt;/span&gt;
    }
}

task wrapper(type: Wrapper) {
    gradleVersion = &lt;span class=&quot;code-quote&quot;&gt;&apos;2.4&apos;&lt;/span&gt;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;when I run &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;gradle clean build&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;then the test fails with the following message.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;PersonTest &amp;gt; hashcodeWithoutLongValue FAILED
    java.lang.NullPointerException at PersonTest.groovy:10

1 test completed, 1 failed
:test FAILED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With Groovy 2.4.3 the test passes.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12846910">GROOVY-7518</key>
            <summary>hashCode() throws NPE when using @CompileStatic with @EqualsAndHashCode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="riggs">Thomas</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Jul 2015 14:42:33 +0000</created>
                <updated>Mon, 19 Oct 2015 16:11:03 +0000</updated>
                            <resolved>Sun, 30 Aug 2015 11:13:08 +0000</resolved>
                                    <version>2.4.4</version>
                                    <fixVersion>2.4.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14638167" author="paulk" created="Thu, 23 Jul 2015 05:07:51 +0000"  >&lt;p&gt;I haven&apos;t checked 2.4.4 but in master we removed the use of the &quot;dynamic&quot; behavior of using InvokerHelper.getProperty. So the AST transform used to produce this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; hashCode() {
     java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; _result = HashCodeHelper.initHash()
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!(InvokerHelper.getProperty(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;someLong&apos;&lt;/span&gt;).is(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;))) {
        _result = HashCodeHelper.updateHash(_result, InvokerHelper.getProperty(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;someLong&apos;&lt;/span&gt;))
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; _result 
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but now produces this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; hashCode() {
    java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; _result = HashCodeHelper.initHash()
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getSomeLong() == &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; )) {
          _result = HashCodeHelper.updateHash(_result, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getSomeLong())
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; _result 
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Though it&apos;s not immediately obvious to me why that would produce the NPE.&lt;/p&gt;

&lt;p&gt;Standalone script to produce the error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.*

@EqualsAndHashCode
@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Person {
    &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; someLong
}

println &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Person().hashCode()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14638186" author="blackdrag" created="Thu, 23 Jul 2015 05:39:49 +0000"  >&lt;p&gt;to clarify, in Pauls example the NPE comes from unboxing this.getSomeLong(). SomeLong is a Long, and the HashCodeHelper method called here takes a long in that position, thus unboxing happens and is causing the NPE. The NPE would not happen with normal Groovy, because there would be no unboxing at this position, thus the Object taking variant will be called instead. Possible solution would be to move the null-check into the generated code and open the shift method, or to add the object variants of the primitives to HashCodeHelper, or one of the other 1000 possible solutions&lt;/p&gt;</comment>
                            <comment id="14638485" author="githubbot" created="Thu, 23 Jul 2015 08:42:33 +0000"  >&lt;p&gt;GitHub user paulk-asert opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-groovy/pull/70&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-groovy/pull/70&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7518&quot; title=&quot;hashCode() throws NPE when using @CompileStatic with @EqualsAndHashCode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7518&quot;&gt;&lt;del&gt;GROOVY-7518&lt;/del&gt;&lt;/a&gt;: hashCode() throws NPE when using @CompileStatic with @Eq&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;ualsAndHashCode&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/paulk-asert/incubator-groovy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/paulk-asert/incubator-groovy&lt;/a&gt; groovy7518&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-groovy/pull/70.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-groovy/pull/70.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #70&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit f4c2a91e81ea239303e1e7541d1a350b7fb80cff&lt;br/&gt;
Author: paulk &amp;lt;paulk@asert.com.au&amp;gt;&lt;br/&gt;
Date:   2015-07-23T08:41:15Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7518&quot; title=&quot;hashCode() throws NPE when using @CompileStatic with @EqualsAndHashCode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7518&quot;&gt;&lt;del&gt;GROOVY-7518&lt;/del&gt;&lt;/a&gt;: hashCode() throws NPE when using @CompileStatic with @EqualsAndHashCode&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14721478" author="githubbot" created="Sun, 30 Aug 2015 10:29:19 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-groovy/pull/70&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-groovy/pull/70&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14721484" author="paulk" created="Sun, 30 Aug 2015 11:13:08 +0000"  >&lt;p&gt;merged a tweaked version of the PR to account for nulls as per Jochen&apos;s comment&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 12 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2hk3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>