<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:08:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-2976] ClassCastException when printing a mixed type int/long range</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-2976</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;A mixed type int/long range throws a ClassCastException when printed.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;script.groovy&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def start  = &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.MAX_VALUE
def finish = &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.MAX_VALUE + 2L
def r = (start..finish)
println r.getClass()  &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;groovy.lang.ObjectRange
&lt;/span&gt;println r.getFrom().getClass()  &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;java.lang.&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;
&lt;/span&gt;println r.getTo().getClass()  &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;java.lang.&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;
&lt;/span&gt;
println r.toString()  &lt;span class=&quot;code-comment&quot;&gt;// 2147483647..2147483649
&lt;/span&gt;println r  &lt;span class=&quot;code-comment&quot;&gt;//java.lang.ClassCastException: java.lang.&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;
&lt;/span&gt;
println (&lt;span class=&quot;code-quote&quot;&gt;&apos;Range is &apos;&lt;/span&gt; + r.toString())  &lt;span class=&quot;code-comment&quot;&gt;// Range is 2147483647..2147483649
&lt;/span&gt;println (&lt;span class=&quot;code-quote&quot;&gt;&apos;Range is &apos;&lt;/span&gt; + r)  &lt;span class=&quot;code-comment&quot;&gt;//java.lang.ClassCastException: java.lang.&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;BTW, I assume that converting the range to a list for printing happens on purpose:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;script.groovy&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def start  = 0
def finish = 2
def r = (start..finish)
println r.toString()  &lt;span class=&quot;code-comment&quot;&gt;// 0..2
&lt;/span&gt;println r  &lt;span class=&quot;code-comment&quot;&gt;// [0, 1, 2]&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Seems a bit strange to me, but well...&lt;/p&gt;</description>
                <environment></environment>
        <key id="12814333">GROOVY-2976</key>
            <summary>ClassCastException when printing a mixed type int/long range</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="sirjective">Christian Semrau</reporter>
                        <labels>
                    </labels>
                <created>Sat, 26 Jul 2008 07:23:33 +0000</created>
                <updated>Thu, 13 Nov 2008 06:59:48 +0000</updated>
                            <resolved>Sat, 6 Sep 2008 08:58:53 +0000</resolved>
                                    <version>1.5.6</version>
                    <version>1.6-beta-1</version>
                                    <fixVersion>1.5.7</fixVersion>
                    <fixVersion>1.6-beta-2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14465314" author="rbrush" created="Sun, 31 Aug 2008 10:02:24 +0000"  >&lt;p&gt;Many similar errors can be exposed by adding this test case to trunk:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;public class MixedRangeTest extends NumberRangeTest {&lt;/p&gt;

&lt;p&gt;protected Range createRange(int from, int to) {&lt;br/&gt;
                // Simulate a caller providing different number types to a range.&lt;br/&gt;
return new ObjectRange(new Integer(from), new Long(to));&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;protected Comparable createValue(int value) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {return new Long(value);}
}&lt;/span&gt; &lt;/div&gt;&lt;/blockquote&gt;

&lt;p&gt;The trouble is that ObjectRange does not handle numeric conversions the same way as the rest of Groovy.&lt;/p&gt;

&lt;p&gt;How about the following fix: if an ObjectRange is dealing with two Numbers, math operations and comparisons are deferred to org.codehause.groovy.runtime.typehandling.NumberMath. This should simplify ObjectRange and ensure consistency.&lt;/p&gt;

&lt;p&gt;Is it possible to have an ObjectRange that is &lt;em&gt;not&lt;/em&gt; two java.lang.Numbers? If we could assume we&apos;re always dealing with Numbers here the class could be simplified further.&lt;/p&gt;

&lt;p&gt;I work out a patch if desired; just looking to validate the strategy since I&apos;m a bit of a newbie to Groovy internals...&lt;/p&gt;</comment>
                            <comment id="14465204" author="rbrush" created="Sun, 31 Aug 2008 10:05:36 +0000"  >&lt;p&gt;Let&apos;s try the test example again:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;public class MixedRangeTest extends NumberRangeTest {

    protected Range createRange(int from, int to) {
                // Simulate a caller providing different number types to a range.
               return new ObjectRange(new Integer(from), new Long(to));
    }

    protected Comparable createValue(int value) { 
        return new Long(value);
    }

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14478309" author="paulk" created="Sat, 6 Sep 2008 06:00:07 +0000"  >&lt;p&gt;Just answering this question: &quot;&lt;em&gt;Is it possible to have an ObjectRange that is not two java.lang.Numbers?&lt;/em&gt;&quot;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def r = &lt;span class=&quot;code-quote&quot;&gt;&apos;Car&apos;&lt;/span&gt;..&lt;span class=&quot;code-quote&quot;&gt;&apos;Cat&apos;&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; r == [&lt;span class=&quot;code-quote&quot;&gt;&quot;Car&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Cas&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Cat&quot;&lt;/span&gt;]
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; r.size() == 3
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; r.getClass() == ObjectRange
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14478279" author="paulk" created="Sat, 6 Sep 2008 08:58:53 +0000"  >&lt;p&gt;There are still some issues with mixed Integer/Long ranges but the ClassCastException should go away with the latest fix. The workaround is simply to make both from and to be Long&apos;s in such cases.&lt;/p&gt;</comment>
                            <comment id="14465563" author="kaeppler" created="Thu, 13 Nov 2008 05:05:47 +0000"  >&lt;p&gt;There is another problem with this. Consider this domain object:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;A {
    &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; x

    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; constraints = {
        x(range: 0.0..100.0)    
    }      
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Although when declaring both field and range, doubles have been used, Groovy will turn A.constraints.x.range.from and A.constraints.x.range.to into BigDecimal objects.&lt;/p&gt;

&lt;p&gt;This is problematic, because e.g. in Grails, Spring validation will fail (Exception: cannot cast BigDecimal to Double).&lt;/p&gt;

&lt;p&gt;Maybe I should raise a new JIRA for this? This is a major drawback.&lt;/p&gt;</comment>
                            <comment id="14478332" author="paulk" created="Thu, 13 Nov 2008 05:28:23 +0000"  >&lt;p&gt;Yes, I think a new Jira is the way to go. Obviously, the workaround is to use:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;range: 0.0d..100.0d
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14465557" author="kaeppler" created="Thu, 13 Nov 2008 05:31:21 +0000"  >&lt;p&gt;btw: this can of course be worked around by declaring the range as:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;range: &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;(0.0)..&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;(100.0)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14465542" author="kaeppler" created="Thu, 13 Nov 2008 05:32:05 +0000"  >&lt;p&gt;That&apos;s an even better workaround. Thanks Paul.&lt;/p&gt;</comment>
                            <comment id="14465516" author="kaeppler" created="Thu, 13 Nov 2008 06:55:30 +0000"  >&lt;p&gt;Actually, I just read the article over at &lt;a href=&quot;http://groovy.codehaus.org/Groovy+Math&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://groovy.codehaus.org/Groovy+Math&lt;/a&gt; and I am not sure anymore if this is worth raising a JIRA. It simply seems like a trade-off... the classic behavior known from Java to create doubles whenever one does not explicitly qualify a decimal literal with f (as in 1.0f) is sacrificed for a more intuitive decimal arithmetic by using BigDecimal instead.&lt;/p&gt;

&lt;p&gt;Since both things ain&apos;t possible at the same time, I guess we&apos;ll just leave it be.&lt;/p&gt;</comment>
                            <comment id="14478317" author="paulk" created="Thu, 13 Nov 2008 06:59:48 +0000"  >&lt;p&gt;Yes, I don&apos;t think there is a Jira to consider for Groovy. The question is whether Grails could add some extra smarts at the constraints level. It would be possible but perhaps hard to generalise.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 2 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bvzb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>