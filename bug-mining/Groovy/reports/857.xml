<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:10:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-3139] StubFor: No more calls to &apos;openConnection&apos; expected at this point. End of demands</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-3139</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I am having troubles with Stub for in Groovy 1.6 Betas.   I am attaching a short self contained Test that illustrates the problem.  The same script runs fine in 1.5.6&lt;/p&gt;

&lt;p&gt;No more calls to &apos;openConnection&apos; expected at this point. End of demands.&lt;/p&gt;

&lt;p&gt;at java.lang.reflect.Constructor.newInstance(Constructor.java:513)&lt;br/&gt;
at org.codehaus.groovy.reflection.CachedConstructor.invoke(CachedConstructor.java:70)&lt;br/&gt;
at org.codehaus.groovy.reflection.CachedConstructor.doConstructorInvoke(CachedConstructor.java:64)&lt;br/&gt;
at org.codehaus.groovy.runtime.callsite.ConstructorSite$ConstructorSiteNoUnwrap.callConstructor(ConstructorSite.java:69)&lt;br/&gt;
at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callConstructor(AbstractCallSite.java:200)&lt;br/&gt;
at groovy.mock.interceptor.LooseExpectation.isEligible(LooseExpectation.groovy:56)&lt;br/&gt;
at groovy.mock.interceptor.LooseExpectation$isEligible.callCurrent(Unknown Source)&lt;br/&gt;
at groovy.mock.interceptor.LooseExpectation.match(LooseExpectation.groovy:45)&lt;br/&gt;
at groovy.mock.interceptor.LooseExpectation$match.call(Unknown Source)&lt;br/&gt;
at groovy.mock.interceptor.MockInterceptor.beforeInvoke(MockInterceptor.groovy:30)&lt;br/&gt;
at groovy.mock.interceptor.MockProxyMetaClass.invokeMethod(MockProxyMetaClass.java:52)&lt;br/&gt;
at org.codehaus.groovy.runtime.callsite.PojoMetaClassSite.call(PojoMetaClassSite.java:34)&lt;br/&gt;
at org.codehaus.groovy.runtime.callsite.AbstractCallSite.call(AbstractCallSite.java:120)&lt;br/&gt;
at Get2.getText(StubTests2.groovy:39)&lt;/p&gt;</description>
                <environment>Groovy 1.6 beta1 and Beta 2</environment>
        <key id="12817951">GROOVY-3139</key>
            <summary>StubFor: No more calls to &apos;openConnection&apos; expected at this point. End of demands</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roshandawrani">Roshan Dawrani</assignee>
                                    <reporter username="jshingler">Jim Shingler</reporter>
                        <labels>
                    </labels>
                <created>Sun, 9 Nov 2008 20:22:13 +0000</created>
                <updated>Thu, 22 Jan 2009 21:34:41 +0000</updated>
                            <resolved>Thu, 1 Jan 2009 23:12:34 +0000</resolved>
                                    <version>1.6-beta-2</version>
                                    <fixVersion>1.6-rc-2</fixVersion>
                    <fixVersion>1.7-beta-1</fixVersion>
                                    <component>mocks and stubs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14466128" author="roshandawrani" created="Thu, 1 Jan 2009 12:11:26 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I was trying to look into this issue and the issue seems to be related to caching of metaClass in PojoMetaClassSite.&lt;/p&gt;

&lt;p&gt;So, when StubFor.use &lt;/p&gt;
{..}
&lt;p&gt; is called, it replaces the metaClass in the MetaClassRegistry for the scope of the use &lt;/p&gt;
{...}
&lt;p&gt; closure but because PojoMetaClassSite is caching it, it does not see the change made in the MetaClassRegistry.&lt;/p&gt;

&lt;p&gt;In the attached testcase, 2nd test is failing because even in the 2nd test it is seeing the cached version of MockProxyMetaClass, which in effect means it is making use of the MockInterceptor of the test 1 and openConnection call gets treated as the 2nd call (and not 1st call as expected) and it does not meet the expectation and fails saying &quot;No more calls to &apos;openConnection&apos; expected at this point. End of demands&quot;.&lt;/p&gt;

&lt;p&gt;The attached patch is fixing the issue.&lt;/p&gt;

&lt;p&gt;If no issue is seen with the approach taken in the patch, I can apply it.&lt;/p&gt;</comment>
                            <comment id="14466027" author="roshandawrani" created="Thu, 1 Jan 2009 23:12:34 +0000"  >&lt;p&gt;Fixed (by not using the cached metaClass in case of MockProxyMetaClass)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12721856" name="3139_v16x.diff" size="1301" author="roshandawrani" created="Thu, 1 Jan 2009 12:11:26 +0000"/>
                            <attachment id="12720977" name="StubTests2.groovy" size="775" author="jshingler" created="Sun, 9 Nov 2008 20:22:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 47 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bvd3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>