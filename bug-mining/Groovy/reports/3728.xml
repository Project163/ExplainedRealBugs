<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:05:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-9412] enum added to List fails TypeChecked</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-9412</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.TypeChecked

@TypeChecked
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyClass {

    &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; Foo {}

    &lt;span class=&quot;code-keyword&quot;&gt;enum&lt;/span&gt; Bar &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; Foo {
        AA
    }    
    
    void F() {
        List&amp;lt;Foo&amp;gt; g = []
        g.add(Bar.AA)
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MyClass()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Put this in a file &quot;script.groovy&quot; and call &quot;groovy script.groovy&quot;&lt;/p&gt;

&lt;p&gt;Expected: No output&lt;br/&gt;
 Actual:&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed:
&amp;lt;path to file&amp;gt;/Script.groovy: 14: [Static type checking] - Cannot call java.util.List &amp;lt;Foo&amp;gt;#add(MyClass$Foo) with arguments [MyClass$Bar] 
 @ line 14, column 9.
           g.add(Bar.AA)
           ^
1 error&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Does not occur in&#160;3.0.0-rc-3 or earlier.&lt;/p&gt;

&lt;p&gt;Looks similar to&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8960&quot; title=&quot;Can not call a java parameterized type method from groovy with java enum. Compile error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8960&quot;&gt;&lt;del&gt;GROOVY-8960&lt;/del&gt;&lt;/a&gt;&#160;but does not occur in 2.5.5&lt;/p&gt;

&lt;p&gt;Workaround: Add cast &quot;g.add(Bar.AA as Foo)&quot;&lt;/p&gt;</description>
                <environment>CentOS</environment>
        <key id="13286273">GROOVY-9412</key>
            <summary>enum added to List fails TypeChecked</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="tofor">Ian</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Feb 2020 16:25:44 +0000</created>
                <updated>Fri, 6 Mar 2020 23:17:52 +0000</updated>
                            <resolved>Tue, 3 Mar 2020 02:07:29 +0000</resolved>
                                    <version>3.0.0</version>
                    <version>3.0.1</version>
                                    <fixVersion>2.5.10</fixVersion>
                    <fixVersion>3.0.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="5400">1.5h</timespent>
                                <comments>
                            <comment id="17047112" author="daniel_sun" created="Fri, 28 Feb 2020 01:05:05 +0000"  >&lt;p&gt;The proposed PR has been merged. Thanks!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/8cae0302557af707633791eb33080543cf715679&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/8cae0302557af707633791eb33080543cf715679&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17048388" author="emilles" created="Sat, 29 Feb 2020 20:21:16 +0000"  >&lt;p&gt;This error is actually the correct and intended behavior.  List&amp;lt;Foo&amp;gt; is not covariant and so adding a Bar is an error.  If you had List&amp;lt;? extends Foo&amp;gt; you could safely add a Bar.&lt;/p&gt;</comment>
                            <comment id="17048457" author="daniel_sun" created="Sun, 1 Mar 2020 03:47:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt; You are right&lt;/p&gt;</comment>
                            <comment id="17049363" author="tofor" created="Mon, 2 Mar 2020 16:09:37 +0000"  >&lt;p&gt;If I&apos;m wrong about this, I apologize for taking your time. As far as I can tell, the equivalent Java code is valid, and compiles and runs without error in pure Java:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;import java.util.ArrayList;
import java.util.List;

public class InterfaceList { 

  interface Foo { }

  enum Bar implements Foo { AA }

  static void F() { 
    List&amp;lt;Foo&amp;gt; g = new ArrayList&amp;lt;&amp;gt;(); 
    g.add(Bar.AA); 
  }
  
  public static void main(String args[]) { 
    F(); 
  }

}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Is there some difference in covariance in groovy that makes it invalid there?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Also, your suggestion does not resolve the issue. This also gives an error:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;import groovy.transform.TypeChecked

@TypeChecked
class MyClass {    
    interface Foo {}    
    enum Bar implements Foo {
        AA
    }    
    void F() {
        List&amp;lt;? extends Foo&amp;gt; g = []
        g.add(Bar.AA)
    }
}
new MyClass()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed: /home/ianl/tmpEnum/script.groovy: 14: [Static type checking] - Cannot call java.util.List &amp;lt;? extends MyClass$Foo&amp;gt;#add(MyClass$Foo) with arguments [MyClass$Bar] 
 @ line 14, column 9. 
           g.add(Bar.AA) 
           ^1 error 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Also, the equivalent code with classes instead of enums does not present this error:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;import groovy.transform.TypeChecked

@TypeChecked
class MyClass {    

    interface Foo {}

    class Bar implements Foo {}

    void F() {
        List&amp;lt;Foo&amp;gt; g = []
        g.add(new Bar())
    }
}
new MyClass()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Compiles and runs fine.&lt;/p&gt;

&lt;p&gt;So in summary:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;This error does not occur in Java, only in Groovy&lt;/li&gt;
	&lt;li&gt;This error only occurs for Enums, not classes&lt;/li&gt;
	&lt;li&gt;This error occurs both with List&amp;lt;Foo&amp;gt; and List&amp;lt;? extends Foo&amp;gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17049378" author="emilles" created="Mon, 2 Mar 2020 16:23:26 +0000"  >&lt;p&gt;I can take another look.  But I don&apos;t think removing the lower bounds check is the right approach to addressing this.&lt;/p&gt;</comment>
                            <comment id="17049399" author="emilles" created="Mon, 2 Mar 2020 16:49:27 +0000"  >&lt;p&gt;In StaticTypeCheckingSupport, it tests the specified types for g and add, which are E=Foo.  It gets down to the &lt;tt&gt;compatibleConnection&lt;/tt&gt; method:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; compatibleConnection(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; GenericsType resolved, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; GenericsType connection) { &lt;span class=&quot;code-comment&quot;&gt;// resolved: Foo, connection: Bar
&lt;/span&gt;        GenericsType gt = connection;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!connection.isWildcard()) gt = buildWildcardType(connection); &lt;span class=&quot;code-comment&quot;&gt;// gt: ? &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt; Bar
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (resolved.isPlaceholder() &amp;amp;&amp;amp; resolved.getUpperBounds() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp;
                resolved.getUpperBounds().length == 1 &amp;amp;&amp;amp; !resolved.getUpperBounds()[0].isGenericsPlaceHolder() &amp;amp;&amp;amp;
                resolved.getUpperBounds()[0].getName().equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&quot;&lt;/span&gt;)) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
        }
        ClassNode compareNode;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hasNonTrivialBounds(resolved)) {
            compareNode = getCombinedBoundType(resolved);
            compareNode = compareNode.redirect().getPlainNodeReference();
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!resolved.isPlaceholder()) {
                compareNode = resolved.getType().getPlainNodeReference();
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; gt.isCompatibleWith(compareNode); &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-quote&quot;&gt;&quot;? &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt; Bar&quot;&lt;/span&gt;.isCompatibleWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;Foo&quot;&lt;/span&gt;)
&lt;/span&gt;    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m not sure why it converts &quot;Bar&quot; into &quot;? super Bar&quot; near the start.  This will never be compatible with &quot;Foo&quot;.&lt;/p&gt;

&lt;p&gt;After this check, the outer method has a fallback that is not clear:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!compatibleConnection(resolved, connection)) {
                &lt;span class=&quot;code-comment&quot;&gt;// Maybe &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; could be useful &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; GROOVY-9412 or maybe compatibleConnection needs some fixing.
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!(resolved.isPlaceholder() || resolved.isWildcard()) &amp;amp;&amp;amp;
                        !fixedGenericsPlaceHolders.contains(entry.getKey()) &amp;amp;&amp;amp;
                        compatibleConnection(connection, resolved)) {
                    &lt;span class=&quot;code-comment&quot;&gt;// we did &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; example find T=&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; and now check against
&lt;/span&gt;                    &lt;span class=&quot;code-comment&quot;&gt;// T=&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;, which fails the first compatibleConnection check
&lt;/span&gt;                    &lt;span class=&quot;code-comment&quot;&gt;// but since T=&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; works &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; both, the second one will pass
&lt;/span&gt;                    &lt;span class=&quot;code-comment&quot;&gt;// and we need to change the type &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; T to the more general one
&lt;/span&gt;                    resolvedMethodGenerics.put(entry.getKey(), connection);
                } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
                }
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17049502" author="emilles" created="Mon, 2 Mar 2020 17:57:08 +0000"  >&lt;p&gt;I think the issue comes for Enum types because isUnsingGenerics() is true for the bound because the Enum class uses generics.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; compareGenericsWithBound(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ClassNode classNode, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ClassNode bound) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (classNode == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!bound.isUsingGenerics() || (classNode.getGenericsTypes() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; classNode.redirect().getGenericsTypes() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)) {
            &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the bound is not using generics or the &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;node is a raw type, there&apos;s nothing to compare with
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If this check in GenericsType found no generics in bound (&quot;Bar&quot; in this case), it would accept the match between &quot;Foo&quot; (classNode) and &quot;Bar&quot; (bound).&lt;/p&gt;</comment>
                            <comment id="17049507" author="emilles" created="Mon, 2 Mar 2020 18:08:27 +0000"  >&lt;p&gt;Thanks for pursuing this further.  Indeed, add(E) from List/Collection should be covariant.  The Java example was helpful in cross-checking.&lt;/p&gt;</comment>
                            <comment id="17049798" author="daniel_sun" created="Tue, 3 Mar 2020 00:40:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tofor&quot; class=&quot;user-hover&quot; rel=&quot;tofor&quot;&gt;tofor&lt;/a&gt;&lt;br/&gt;
To be frank, we were confused about generics at some point  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Thanks for your contribution.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 37 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0bnv4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>