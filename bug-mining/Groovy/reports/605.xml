<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:03:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-2533] Arithmetic with negative literals doesn&apos;t work as expected</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-2533</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;CODE&lt;br/&gt;
---------&lt;br/&gt;
def result = (-3).plus(2)&lt;br/&gt;
println &apos;Expected: -1&apos;&lt;br/&gt;
println &quot;Actual:   ${result}&quot;&lt;br/&gt;
println &apos;&apos;&lt;/p&gt;

&lt;p&gt;assert ( (-3).plus(2) == -1 )&lt;br/&gt;
println &apos;Passed proper check&apos;&lt;br/&gt;
println &apos;&apos;&lt;/p&gt;

&lt;p&gt;result = -3.plus(2)&lt;br/&gt;
println &apos;Expected: -1&apos;&lt;br/&gt;
println &quot;Actual:   ${result}&quot;&lt;br/&gt;
println &apos;&apos;&lt;/p&gt;

&lt;p&gt;assert ( -3.plus(2) == -5 )&lt;br/&gt;
println &apos;Passed improper check&apos;&lt;br/&gt;
println &apos;&apos;&lt;/p&gt;

&lt;p&gt;assert ( -3.plus(2) == -1 )&lt;br/&gt;
println &apos;Passed 2nd proper check&apos;&lt;/p&gt;


&lt;p&gt;RESULTS&lt;br/&gt;
--------------&lt;br/&gt;
Expected: -1&lt;br/&gt;
Actual:   -1&lt;/p&gt;

&lt;p&gt;Passed proper check&lt;/p&gt;

&lt;p&gt;Expected: -1&lt;br/&gt;
Actual:   -5&lt;/p&gt;

&lt;p&gt;Passed improper check&lt;/p&gt;

&lt;p&gt;Caught: java.lang.AssertionError: Expression: (3.plus(2) == -1)&lt;br/&gt;
        at math.run(math.groovy:19)&lt;br/&gt;
        at math.main(math.groovy)&lt;/p&gt;

&lt;p&gt;=========================&lt;/p&gt;

&lt;p&gt;Groovy&apos;s parser detects that a number is negative, even if it is not surrounded by parentheses.  However, it does not accurate perform the mathematical calculation necessary.  Also, the AssertionError message drops the negative sign when it reports a failed assertion if the literal is not surrounded by parentheses.&lt;/p&gt;</description>
                <environment>WinXP Pro, Java 6 Update 3, Groovy 1.5.1</environment>
        <key id="12815671">GROOVY-2533</key>
            <summary>Arithmetic with negative literals doesn&apos;t work as expected</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="loizeaux">John Loizeaux</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Jan 2008 16:50:40 +0000</created>
                <updated>Fri, 25 Jan 2008 07:32:26 +0000</updated>
                            <resolved>Fri, 25 Jan 2008 07:32:26 +0000</resolved>
                                    <version>1.5.1</version>
                                    <fixVersion>1.6-beta-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14477894" author="paulk" created="Thu, 24 Jan 2008 03:25:15 +0000"  >&lt;p&gt;I can confirm that this is happening in 1.0, 1.5.1 and HEAD.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def x = -10+5
def y = -10.plus(5)    &lt;span class=&quot;code-comment&quot;&gt;// . is getting higher precendence than unaryMinus
&lt;/span&gt;println x &lt;span class=&quot;code-comment&quot;&gt;// =&amp;gt; -5
&lt;/span&gt;println y &lt;span class=&quot;code-comment&quot;&gt;// =&amp;gt; -15&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14464280" author="loizeaux" created="Thu, 24 Jan 2008 09:28:55 +0000"  >&lt;p&gt;Paul,&lt;/p&gt;

&lt;p&gt;Does the Groovy parser need to check to see if the operand being negated is a literal?&lt;/p&gt;

&lt;p&gt;As an example:&lt;br/&gt;
def a = --2&lt;br/&gt;
println &quot;a = ${a}&quot; // =&amp;gt; &quot;a = 1&quot;&lt;/p&gt;

&lt;p&gt;The prefix &amp;#8211; operator detects it has a literal before it assigns the value to a. (the prefix ++ operator does as well).&lt;/p&gt;

&lt;p&gt;If the parser does need to check, then all unary operators (with the exception of the postfix operators) should check for a literal before processing.&lt;/p&gt;</comment>
                            <comment id="14464130" author="blackdrag" created="Thu, 24 Jan 2008 12:00:54 +0000"  >&lt;p&gt;Sometimes the most easy way to show people that nothing is wrong with what we do is to show some comparable code in Java. Look at this code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; a = 1;
        &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; b = 2;
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = a.compareTo(b);
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; j = -a.compareTo(b);
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; -1==i;
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; 1==j;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As you can see Java will apply the - after compareTo is called.. anything different is not possible, because the result of -a is an int, and you can not directly call compareTo on an int.  Let us make a different version:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; a = 1;
        &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; b = 1;
        &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; c = -a;
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = a.compareTo(b);
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; j = -a.compareTo(b);
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; k = c.compareTo(b);
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; 0==i;
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; 0==j;
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; -1==k;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And you will probably say, that you of course expect this result... But think of it... c is -a. If we follow your suggestion in Groovy, then this would mean that &quot;-a.compareTo(b);&quot; should be equal to &quot;(-a)..compareTo(b);&quot; which is the same as &quot;c.compareTo(b);&quot;. But that would mean Groovy would not have the same set of asserts that Java has here.&lt;/p&gt;

&lt;p&gt;Because of this I suggest to close this issue as &quot;won&apos;t fix&quot;&lt;/p&gt;</comment>
                            <comment id="14464199" author="loizeaux" created="Thu, 24 Jan 2008 12:11:59 +0000"  >&lt;p&gt;Fair enough.  Out of curiosity, is there a reason why the operator precedence order is not in the framework reference guide?  Having that in there plus maybe a little caveat about literals could possibly be useful.&lt;/p&gt;</comment>
                            <comment id="14477843" author="paulk" created="Fri, 25 Jan 2008 04:33:16 +0000"  >&lt;p&gt;Still it is not nice that:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; -10+5 != -10.plus(5)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14464176" author="blackdrag" created="Fri, 25 Jan 2008 07:32:26 +0000"  >&lt;p&gt;still... if you imagine a plus method in Integer that returns an int in Java and then replace in my example compareTo with plus, then you will see that Java has the same &quot;problem&quot;. &lt;/p&gt;

&lt;p&gt;I think saying that &quot;.&quot; has one of the highest priority settings is something you can remember and it won&apos;t help not only in this case. Of course we could theoretically make it different, but then why should we? I think the current form is more consistent if you think of the usage of &quot;.&quot; in other cases. Changing this is doomed to be questioned again.&lt;/p&gt;

&lt;p&gt;So I close this issue now&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12721693" name="math.groovy" size="490" author="loizeaux" created="Wed, 23 Jan 2008 16:50:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 44 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c6n3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>