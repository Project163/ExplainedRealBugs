<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:20:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-10757] Regression from 2.5.16+: ClassCastException at runtime</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-10757</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I&apos;ve found a very nasty bug in Groovy 2.5.16+.&lt;/p&gt;

&lt;p&gt;It&apos;s really hard to extract a simple test case, so I&apos;ll try to explain what is going on as much as possible.&lt;/p&gt;

&lt;p&gt;I have a &lt;tt&gt;@CompileStatic&lt;/tt&gt; Groovy class hierarchy. Compilation succeeds, but a &lt;tt&gt;ClassCastException&lt;/tt&gt; happens at runtime. The hierarchy is like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
@Named
@CompileStatic
@Scope(&lt;span class=&quot;code-quote&quot;&gt;&apos;session&apos;&lt;/span&gt;)
abstract &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;GenericServicePurchaseBean&amp;lt;T &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; GenericServicePurchaseDao&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; Serializable {
    T dao

&#160; &#160; void setDao(final T dao) {
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.dao = dao
&#160; &#160; }

    protected abstract List&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; ProductIdto&amp;gt; retrieveAvailableProducts()

	@CompileDynamic &lt;span class=&quot;code-comment&quot;&gt;// see note below
&lt;/span&gt;	void resetState() {
		&lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;                retrieveAvailableProducts()
                &lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;        }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
@Named
@CompileStatic
@Scope(&lt;span class=&quot;code-quote&quot;&gt;&apos;session&apos;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;FooPurchaseBean &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; GenericServicePurchaseBean&amp;lt;FooPurchaseDao&amp;gt; {
	@Inject
	@Named(&lt;span class=&quot;code-quote&quot;&gt;&apos;fooPurchaseDao&apos;&lt;/span&gt;)
	@Override
	void setDao(final FooPurchaseDao dao) {
		&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.setDao(dao)
	}

	@Override
	protected List&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; ProductIdto&amp;gt; retrieveAvailableProducts() {
		dao.loadAllAvailableProductsForNewPurchase(customer)
	}

	@Override
	void resetState() {
		&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.resetState();
                &lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;        }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The error I get at runtime is this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caused by: java.lang.ClassCastException: class it.dcssrl.shop.web.purchase.view.dao.FooPurchaseDao$$EnhancerBySpringCGLIB$$271ceca2 cannot be cast to class it.dcssrl.shop.web.purchase.view.dao.BarPurchaseDao (it.dcssrl.shop.web.purchase.view.dao.FooPurchaseDao$$EnhancerBySpringCGLIB$$271ceca2 and it.dcssrl.shop.web.purchase.view.dao.BarPurchaseDao are in unnamed module of loader org.apache.catalina.loader.ParallelWebappClassLoader @5a075a)
        at it.dcssrl.shop.web.purchase.view.FooPurchaseBean.retrieveAvailableProducts(FooPurchaseBean.groovy:217)
        at org.codehaus.groovy.vmplugin.v7.IndyInterface.selectMethod(IndyInterface.java:234)
        at it.dcssrl.shop.web.purchase.view.GenericServicePurchaseBean.resetState(GenericServicePurchaseBean.groovy:682)
        at it.dcssrl.shop.web.purchase.view.FooPurchaseBean.resetState(FooPurchaseBean.groovy:148)
 [...]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If I remove the Groovy compiler optimization to enable Indy compilation, the error happens all the same, but the stack trace does not have the line about &lt;tt&gt;org.codehaus.groovy.vmplugin.v7.IndyInterface.selectMethod(IndyInterface.java:234)&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Please note that:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;this problem does not happen with Groovy 2.5.15&lt;/li&gt;
	&lt;li&gt;it happens with Groovy 2.5.16, 2.5.17 and 2.5.18&lt;/li&gt;
	&lt;li&gt;it DOES NOT happen if compiling/running the application within Eclipse/WTP and Groovy Eclipse plugin&lt;/li&gt;
	&lt;li&gt;the &lt;tt&gt;resetState()&lt;/tt&gt; method above in the base class is marked with &lt;tt&gt;@CompileDynamic&lt;/tt&gt; because of another nasty problem I was not able to isolate, which otherwise produces another &lt;tt&gt;ClassCastException&lt;/tt&gt; at runtime, although completely different from this one; this has been happening from 2.5.13 at least (it was not occurring with 2.5.9)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Any idea of what is going on? And of a possible not-too-dirty workaround (apart from downgrading to Groovy 2.5.15)?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13481495">GROOVY-10757</key>
            <summary>Regression from 2.5.16+: ClassCastException at runtime</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="mauromol">Mauro Molinari</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Sep 2022 12:44:30 +0000</created>
                <updated>Fri, 10 Feb 2023 21:40:07 +0000</updated>
                            <resolved>Mon, 26 Sep 2022 13:19:49 +0000</resolved>
                                    <version>2.5.16</version>
                    <version>2.5.17</version>
                    <version>2.5.18</version>
                                    <fixVersion>2.5.19</fixVersion>
                    <fixVersion>4.0.6</fixVersion>
                    <fixVersion>3.0.14</fixVersion>
                                    <component>Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17604997" author="emilles" created="Wed, 14 Sep 2022 22:17:44 +0000"  >&lt;p&gt;Can you say where &lt;tt&gt;BarPurchaseDao&lt;/tt&gt; fits into the picture?&lt;/p&gt;

&lt;p&gt;You could try making the call to &lt;tt&gt;retrieveAvailableProducts&lt;/tt&gt; from a static-compile method, like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
@CompileStatic
abstract &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;GenericServicePurchaseBean ... {
  protected abstract List&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; ProductIdto&amp;gt; retrieveAvailableProducts()
  private List&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; ProductIdto&amp;gt; retrieveProducts() {
    retrieveAvailableProducts()
  }
  @CompileDynamic
  void resetState() {
    &lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; products = retrieveProducts()
    &lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Not ideal, but changes the call semantics for that one call.  I&apos;ve done this before when a method makes multiple super.something() references so there is only one &lt;em&gt;super$n$something&lt;/em&gt; MOP method.&lt;/p&gt;

&lt;p&gt;Update: Another thing to try is casting &quot;dao&quot; in FooPurchaseBean:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
  ((FooPurchaseDao)dao).loadAllAvailableProductsForNewPurchase(customer)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Not sure if Spring is getting tripped up by the covariant setDao methods or what.  When you start up, what bean(s) get sent into the dao setter(s)?&lt;/p&gt;</comment>
                            <comment id="17604998" author="emilles" created="Wed, 14 Sep 2022 22:21:01 +0000"  >&lt;p&gt;There is a 2.5.19 snapshot available with many fixes.  Can you give it a quick try and say if this issue is still present?  If I can get a recreation scenario, I might be able to get a fix into 2.5.19 which is coming very soon.&lt;/p&gt;</comment>
                            <comment id="17605199" author="mauromol" created="Thu, 15 Sep 2022 08:30:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;Can you say where BarPurchaseDao fits into the picture?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That&apos;s exactly the point and the reason for which I can&apos;t figure out how to workaround this. &lt;tt&gt;BarPurchaseDao&lt;/tt&gt; does not fit at all in this picture. It&apos;s just another extension of &lt;tt&gt;GenericServicePurchaseDao&lt;/tt&gt; bound to another &lt;tt&gt;BarPurchaseBean&lt;/tt&gt;, which extends &lt;tt&gt;GenericServicePurchaseBean&amp;lt;BarPurchaseDao&amp;gt;&lt;/tt&gt; and hence receives a &lt;tt&gt;BarPurchaseDao&lt;/tt&gt; dao. But is has nothing to do with &lt;tt&gt;FooPurchaseBean&lt;/tt&gt;/&lt;tt&gt;FooPurchaseDao&lt;/tt&gt;, it&apos;s in another branch of the hierarchies of &lt;tt&gt;GenericServicePurchaseBean&lt;/tt&gt; and &lt;tt&gt;GenericServicePurchaseDao&lt;/tt&gt;.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Not sure if Spring is getting tripped up by the covariant setDao methods or what.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If this were the case, the code wouldn&apos;t work in Groovy 2.5.15 either and it wouldn&apos;t work when using Eclipse JDT/Greclipse. Spring in this case uses the name to identify the right dao to inject into the setter, as you can see in &lt;tt&gt;@Named(&apos;fooPurchaseDao&apos;)&lt;/tt&gt; annotation, not its type.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;There is a 2.5.19 snapshot available with many fixes. Can you give it a quick try and say if this issue is still present?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Is there any snapshot Maven repository where I can download this from? I&apos;m going to search for this.&lt;/p&gt;

&lt;p&gt;Could the byte code of this class (&lt;tt&gt;FooPurchaseBean&lt;/tt&gt;) produced by Eclipse vs the one produced by groovyc (invoked by Gradle) be of any interest for you to try to understand what could be the culprit? As I said, the first one works fine, the second one fails at runtime.&lt;/p&gt;

&lt;p&gt;Or else, the bytecode of this class produced by groovyc 2.5.15 vs 2.5.16 or above...&lt;/p&gt;

&lt;p&gt;I&apos;m going to try your suggested workarounds, let me see if they change anything.&lt;/p&gt;</comment>
                            <comment id="17605203" author="mauromol" created="Thu, 15 Sep 2022 08:48:27 +0000"  >&lt;p&gt;First attempt: I found the Groovy snapshot Maven repository and tried 2.5.19-SNAPSHOT. Unfortunately, the problem persists.&lt;/p&gt;

&lt;p&gt;By the way, it doesn&apos;t fix the other problem I have to workaround with &lt;tt&gt;@CompileDynamic&lt;/tt&gt; on &lt;tt&gt;GenericServicePurchaseBean.resetState&lt;/tt&gt; either, but that&apos;s another story, let&apos;s forget it for now.&lt;/p&gt;</comment>
                            <comment id="17605228" author="mauromol" created="Thu, 15 Sep 2022 09:26:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;You could try making the call to retrieveAvailableProducts from a static-compile method, like this:&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This fails as well (tried with 2.5.18):&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;java.lang.ClassCastException: class it.dcssrl.shop.web.purchase.view.dao.FooPurchaseDao$$EnhancerBySpringCGLIB$$9ba61bcb cannot be cast to class it.dcssrl.shop.web.purchase.view.dao.BarPurchaseDao (it.dcssrl.shop.web.purchase.view.dao.FooPurchaseDao$$EnhancerBySpringCGLIB$$9ba61bcb and it.dcssrl.shop.web.purchase.view.dao.BarPurchaseDao are in unnamed module of loader org.apache.catalina.loader.ParallelWebappClassLoader @60c08d48)&lt;br/&gt;
	it.dcssrl.shop.web.purchase.view.FooPurchaseBean.retrieveAvailableProducts(FooPurchaseBean.groovy:217)&lt;br/&gt;
	it.dcssrl.shop.web.purchase.view.GenericServicePurchaseBean.retrieveProducts(GenericServicePurchaseBean.groovy:623)&lt;br/&gt;
	org.codehaus.groovy.vmplugin.v7.IndyInterface.selectMethod(IndyInterface.java:234)&lt;br/&gt;
	it.dcssrl.shop.web.purchase.view.GenericServicePurchaseBean.resetState(GenericServicePurchaseBean.groovy:686)&lt;br/&gt;
	it.dcssrl.shop.web.purchase.view.FooPurchaseBean.resetState(FooPurchaseBean.groovy:148)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;By the way:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Not sure if Spring is getting tripped up by the covariant setDao methods or what. When you start up, what bean(s) get sent into the dao setter(s)?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Just debugged and saw that Spring correctly injects a proxy around &lt;tt&gt;FooPurchaseDao&lt;/tt&gt;. I also inspected it in its fields and they are those of &lt;tt&gt;FooPurchaseDao&lt;/tt&gt;. Indeed the exception seems to suggest that the problem is trying to make that &lt;tt&gt;FooPurchaseDao&lt;/tt&gt; fit into a place where a &lt;tt&gt;BarPurchaseDao&lt;/tt&gt; is needed, although I don&apos;t know why.&lt;br/&gt;
By the way, we have many other dao implementations (along with &lt;tt&gt;FooPurchaseDao&lt;/tt&gt; and &lt;tt&gt;BarPurchaseDao&lt;/tt&gt;). Another good question is: why that &lt;tt&gt;ClassCastException&lt;/tt&gt; is trying to get a &lt;tt&gt;BarPurchaseDao&lt;/tt&gt; there and not, say, a &lt;tt&gt;WhatElsePurchaseDao&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="17605250" author="mauromol" created="Thu, 15 Sep 2022 10:29:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;Update: Another thing to try is casting &quot;dao&quot; in FooPurchaseBean:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This does the trick indeed! Adding this cast causes things to work as expected and the &lt;tt&gt;ClassCastException&lt;/tt&gt; not to be thrown.&lt;br/&gt;
However, it&apos;s a workaround that is not too much viable. It fixes the problem in the exact point I&apos;m currently seeing it, but I have many references to those &lt;tt&gt;dao&lt;/tt&gt; fields in all my *&lt;tt&gt;PurchaseBean&lt;/tt&gt; s, I would need to intercept them all and clutter the code with (in theory) useless casts...&lt;/p&gt;</comment>
                            <comment id="17605336" author="emilles" created="Thu, 15 Sep 2022 13:13:11 +0000"  >&lt;p&gt;I&apos;m guessing you have something like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
abstract &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;GenericServicePurchaseBean&amp;lt;T &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; GenericServicePurchaseDao&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; Serializable {
  T dao
  &lt;span class=&quot;code-comment&quot;&gt;//...
&lt;/span&gt;}
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;FooPurchaseBean &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; GenericServicePurchaseBean&amp;lt;FooPurchaseDao&amp;gt; {
  &lt;span class=&quot;code-comment&quot;&gt;//...
&lt;/span&gt;}
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;BarPurchaseBean &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; GenericServicePurchaseBean&amp;lt;BarPurchaseDao&amp;gt; {
  &lt;span class=&quot;code-comment&quot;&gt;//...
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Seems like a shared reference for &quot;T&quot; is being updated with &quot;FooPurchaseDao&quot; and then later &quot;BarPurchaseDao&quot;.  Then the compiler inserts a cast when you don&apos;t have an explicit one or &quot;FooPurchaseDao fpd = dao; fpd.load()&quot;.&lt;/p&gt;</comment>
                            <comment id="17605400" author="mauromol" created="Thu, 15 Sep 2022 14:58:33 +0000"  >&lt;p&gt;Yes, this is what I have.&lt;/p&gt;

&lt;p&gt;As said, this starts to happen with 2.5.16, so maybe we can find a way to bisect the changes introduced in that version?&lt;/p&gt;</comment>
                            <comment id="17605480" author="emilles" created="Thu, 15 Sep 2022 18:38:42 +0000"  >&lt;p&gt;Can you try compiling with system property &quot;groovy.enable.parameterized.type.cache&quot; set to false?&lt;/p&gt;

&lt;p&gt;Also, does it make a difference if you use &quot;this.dao.load...&quot;?  The explicit-this might help narrow it down.&lt;/p&gt;</comment>
                            <comment id="17605514" author="emilles" created="Thu, 15 Sep 2022 20:22:15 +0000"  >&lt;p&gt;Here are the sources if you want to have a look:&lt;br/&gt;
&lt;a href=&quot;https://groovy.jfrog.io/ui/repos/tree/General/libs-release-local/org/codehaus/groovy/groovy/2.5.15/groovy-2.5.15-sources.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://groovy.jfrog.io/ui/repos/tree/General/libs-release-local/org/codehaus/groovy/groovy/2.5.15/groovy-2.5.15-sources.jar&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://groovy.jfrog.io/ui/repos/tree/General/libs-release-local/org/codehaus/groovy/groovy/2.5.16/groovy-2.5.16-sources.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://groovy.jfrog.io/ui/repos/tree/General/libs-release-local/org/codehaus/groovy/groovy/2.5.16/groovy-2.5.16-sources.jar&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Groovy 2.5.16 starts at Sep 6th, 2021: &lt;a href=&quot;https://github.com/apache/groovy/commits/GROOVY_2_5_X&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commits/GROOVY_2_5_X&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17605528" author="emilles" created="Thu, 15 Sep 2022 21:00:56 +0000"  >&lt;p&gt;Here is one patch that Groovy-Eclipse makes in the parser plugin:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            /* GRECLIPSE edit
            objectExpression = VariableExpression.THIS_EXPRESSION;
            */
            objectExpression = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; VariableExpression(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;&quot;&lt;/span&gt;);
            objectExpression.setLineNumber(node.getLine());
            objectExpression.setColumnNumber(node.getColumn());
            &lt;span class=&quot;code-comment&quot;&gt;// GRECLIPSE end&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I can try putting this into Groovy 2.5.19 and you can check out a snapshot release shortly.&lt;/p&gt;</comment>
                            <comment id="17605534" author="emilles" created="Thu, 15 Sep 2022 21:37:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/f79c47befb284395da87b23183f3bc7870b67226&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/f79c47befb284395da87b23183f3bc7870b67226&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17606654" author="mauromol" created="Mon, 19 Sep 2022 15:53:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;Can you try compiling with system property &quot;groovy.enable.parameterized.type.cache&quot; set to false?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hoping Gradle has done its job (I set fork=false on Groovy compiler option, than ran gradlew with -Dgroovy.enable.parameterized.type.cache=false), this seems not to change the situation: I still get the &lt;tt&gt;ClassCastException&lt;/tt&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also, does it make a difference if you use &quot;this.dao.load...&quot;? The explicit-this might help narrow it down.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;With this change, it indeed works, just like the explicit cast!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I can try putting this into Groovy 2.5.19 and you can check out a snapshot release shortly.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Do you mean that if I use 2.5.19-SNAPSHOT now it should contain your fix attempt?&lt;/p&gt;</comment>
                            <comment id="17606659" author="mauromol" created="Mon, 19 Sep 2022 16:03:24 +0000"  >&lt;p&gt;Anyway, I removed back &quot;this.&quot; and tried the latest 2.5.19-SNAPSHOT version, but the problem is still there &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17606670" author="emilles" created="Mon, 19 Sep 2022 16:35:13 +0000"  >&lt;p&gt;The &lt;a href=&quot;https://groovy.jfrog.io/ui/native/libs-snapshot-local/org/codehaus/groovy/groovy/2.5.19-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;snapshot distribution&lt;/a&gt; has not been updated since Aug 23.  I&apos;m not sure if this has to do with the failing JDK7 build (due to Spock 2.2) or something else.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Update:&lt;/b&gt; the build issue has been resolved and there is a new snapshot available.&lt;/p&gt;

&lt;p&gt;By using explicit-&lt;tt&gt;this&lt;/tt&gt; method call, you are no longer making use of shared &lt;tt&gt;THIS_EXPRESSION&lt;/tt&gt;.  I think that shared expression is getting metadata set on it, which is why you are seeing &lt;tt&gt;BarPurchaseDao&lt;/tt&gt; inexplicably.&lt;/p&gt;</comment>
                            <comment id="17608607" author="mauromol" created="Fri, 23 Sep 2022 07:42:58 +0000"  >&lt;p&gt;Hi Eric, I just tried with the latest 2.19 SNAPSHOT, however unfortunately it still does not work, exact same problem...&lt;/p&gt;</comment>
                            <comment id="17609017" author="emilles" created="Sat, 24 Sep 2022 16:05:36 +0000"  >&lt;p&gt;Any chance of extracting a recreation scenario from your project?  There is some detail missing where &#8220;this&#8221; or &#8220;dao&#8221; gets some stray metadata. &lt;/p&gt;</comment>
                            <comment id="17609051" author="emilles" created="Sat, 24 Sep 2022 20:57:00 +0000"  >&lt;p&gt;Can you try replacing property &quot;T dao&quot; in {{GenericServicePurchaseBean]} with this (below)?  I may have found the issue.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
private T dao
T getDao() { dao }
void setDao(T dao) { &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.dao = dao }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17609138" author="emilles" created="Sun, 25 Sep 2022 11:37:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/d84c59e543f319cb739b438925024ea6859c4796&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/d84c59e543f319cb739b438925024ea6859c4796&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17609416" author="mauromol" created="Mon, 26 Sep 2022 10:04:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;Can you try replacing property &quot;T dao&quot; in &lt;tt&gt;GenericServicePurchaseBean&lt;/tt&gt; with this (below)? I may have found the issue.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Hi Eric,&lt;br/&gt;
indeed, the code was already like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
T dao
T getDao() { dao }
void setDao(T dao) { &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.dao = dao }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I didn&apos;t mention the getter earlier because I didn&apos;t think it was relevant.&lt;br/&gt;
Anyway, adding the &lt;tt&gt;private&lt;/tt&gt; keyword seems to do the trick! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
So, if I use:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
private T dao
T getDao() { dao }
void setDao(T dao) { &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.dao = dao }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;no more &lt;tt&gt;ClassCastException&lt;/tt&gt; with Groovy 2.5.18!!&lt;/p&gt;</comment>
                            <comment id="17609461" author="emilles" created="Mon, 26 Sep 2022 12:11:00 +0000"  >&lt;p&gt;Can you retest with original code and latest snapshot?&lt;/p&gt;</comment>
                            <comment id="17609491" author="mauromol" created="Mon, 26 Sep 2022 13:05:51 +0000"  >&lt;p&gt;Yes Eric, with the original code and the latest snapshot it seems to work, fine! Great! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 7 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z18jw8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>