<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:43:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-7098] looping of java.lang.Iterable or java.lang.Iterator objects in CompileStatic mode</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-7098</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;There are problems in looping of Iterable or Iterator objects in CompileStatic mode. The behaviour is different from dynamic mode.&lt;/p&gt;

&lt;p&gt;better example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@groovy.transform.CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Iterables {
    Iterable&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; toIterable(List list) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Iterable&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;() {
            Iterator iterator() {
                list.iterator()
            }
        }
    } 
    
    void loopIterable(List list) {
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; o : toIterable(list)) {
            println o
        }
    }
    
    void loopIterator(List list) {
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; o : toIterable(list).iterator()) {
            println o
        }
    }
    
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Iterables().loopIterable([1, 2, 3])
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Iterables().loopIterator([4, 5, 6])
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;prints&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Iterables$1@6f4d33
java.util.ArrayList$Itr@90ff2a1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;prints in dynamic mode&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&amp;#8212;&lt;/p&gt;

&lt;p&gt;EDITED: original example: &lt;/p&gt;

&lt;p&gt;I was able to reproduce the problem with this code example (runnable in GroovyConsole):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Grab(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.yaml:snakeyaml:1.14&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.yaml.snakeyaml.Yaml

@groovy.transform.CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;YmlLoader {
    Map map

    @groovy.transform.CompileDynamic
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void loadYmlDynamic(InputStream input) {
        Yaml yaml = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Yaml()
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; yamlObject : yaml.loadAll(input)) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(yamlObject &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Map) {
                map = (Map)yamlObject
            }
        }
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void loadYmlStatic(InputStream input) {
        Yaml yaml = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Yaml()
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; yamlObject : yaml.loadAll(input)) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(yamlObject &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Map) { &lt;span class=&quot;code-comment&quot;&gt;// problem here with CompileStatic
&lt;/span&gt;                map = (Map)yamlObject
            }
        }
    }
}

YmlLoader a = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; YmlLoader()
a.loadYmlDynamic &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayInputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;a: 1&quot;&lt;/span&gt;.getBytes())
a.map

YmlLoader b = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; YmlLoader()
b.loadYmlDynamic &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayInputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;a: 1&quot;&lt;/span&gt;.getBytes())
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; a.map == b.map

YmlLoader c = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; YmlLoader()
c.loadYmlStatic &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayInputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;a: 1&quot;&lt;/span&gt;.getBytes())
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; a.map == c.map
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12817825">GROOVY-7098</key>
            <summary>looping of java.lang.Iterable or java.lang.Iterator objects in CompileStatic mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="melix">C&#233;dric Champeau</assignee>
                                    <reporter username="lhotari">Lari Hotari</reporter>
                        <labels>
                    </labels>
                <created>Sat, 4 Oct 2014 04:13:00 +0000</created>
                <updated>Wed, 17 Dec 2014 13:25:55 +0000</updated>
                            <resolved>Wed, 8 Oct 2014 05:04:55 +0000</resolved>
                                                    <fixVersion>2.3.8</fixVersion>
                                    <component>Static compilation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14476453" author="lhotari" created="Wed, 8 Oct 2014 02:28:37 +0000"  >&lt;p&gt;This might not have anything to do with instanceof.&lt;/p&gt;

&lt;p&gt;Decompiled code for static method:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void loadYmlStatic(InputStream input) {
    Yaml yaml = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Yaml();
    &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; yamlObject = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Iterator localIterator = DefaultGroovyMethods.iterator(yaml.loadAll(input)); localIterator.hasNext(); ) { yamlObject = localIterator.next();
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((yamlObject &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Map)) {
        localMap = (Map)ScriptBytecodeAdapter.castToType(yamlObject, Map.class); &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.map = localMap;
      }
    }
    Map localMap;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There isn&apos;t a method DGM.iterator(Iterable) which seems to be causing the problem.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Iterator iterator(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; o) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; DefaultTypeTransformation.asCollection(o).iterator();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;this method gets selected, and it&apos;s obviously the wrong choice.&lt;/p&gt;
</comment>
                            <comment id="14476551" author="lhotari" created="Wed, 8 Oct 2014 03:07:17 +0000"  >&lt;p&gt;better example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@groovy.transform.CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Iterables {
    Iterable&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; toIterable(List list) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Iterable&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;() {
            Iterator iterator() {
                list.iterator()
            }
        }
    } 
    
    void loopIterable(List list) {
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; o : toIterable(list)) {
            println o
        }
    }
    
    void loopIterator(List list) {
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; o : toIterable(list).iterator()) {
            println o
        }
    }
    
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Iterables().loopIterable([1, 2, 3])
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Iterables().loopIterator([4, 5, 6])
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;prints&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Iterables$1@6f4d33
java.util.ArrayList$Itr@90ff2a1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;prints in dynamic mode&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;1
2
3
4
5
6
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14476579" author="melix" created="Wed, 8 Oct 2014 05:04:56 +0000"  >&lt;p&gt;I fixed the iterable version, which was indeed a bug, but for the iterator version, @CompileStatic groovy follows the semantics of Java there, which is that you cannot use an Iterator as the collection type. It will therefore call DGM#asIterable on an Iterator, which will return a single element list containing the iterator.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 6 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ccuv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>