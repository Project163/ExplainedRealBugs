<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:23:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-11265] Runtime rehydrate error for closure in interface default method</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-11265</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;When using an interface default method (implemented in Groovy 4 as a trait) that returns an instance of a functional interface defined by a lambda, compilation succeeds but runtime invocation produces&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
groovy.lang.MissingMethodException: No signature of method: com.example.MyInterface$Trait$Helper$$Lambda$2132/0x0000000800e24c40.rehydrate() is applicable &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; argument types: (com.example.MyImplementation...) values: [com.example.MyImplementation@2a7087a8, ...]
        at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.unwrap(ScriptBytecodeAdapter.java:72)
        at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.invokeMethodN(ScriptBytecodeAdapter.java:184)
        at com.example.MyInterface$Trait$Helper.curry(MyInterface.groovy:19)
        at com.example.MyImplementation.curry(MyImplementation.groovy)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Update: This appears to be a problem introduced between 4.0.12 and 4.0.13 and shows up only when &lt;em&gt;the interface&lt;/em&gt; is defined as &lt;tt&gt;@CompileStatic&lt;/tt&gt;. While I understand that the party line is that traits and ASTTs aren&apos;t guaranteed to be compatible, (1) this was working perfectly previously and (2) the compiler&apos;s implementation of interface default methods as traits is an implementation detail and should have as limited a blast radius as practical.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13563491">GROOVY-11265</key>
            <summary>Runtime rehydrate error for closure in interface default method</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="chrylis">Christopher Smith</reporter>
                        <labels>
                            <label>traits</label>
                    </labels>
                <created>Wed, 3 Jan 2024 18:07:44 +0000</created>
                <updated>Tue, 5 Mar 2024 01:53:27 +0000</updated>
                            <resolved>Fri, 5 Jan 2024 19:27:03 +0000</resolved>
                                    <version>4.0.13</version>
                    <version>4.0.17</version>
                                    <fixVersion>4.0.18</fixVersion>
                    <fixVersion>5.0.0-alpha-5</fixVersion>
                                    <component>Compiler</component>
                    <component>Static compilation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17803243" author="chrylis" created="Thu, 4 Jan 2024 16:38:24 +0000"  >&lt;p&gt;Now that I have a workaround for this (removing &lt;tt&gt;@CompileStatic&lt;/tt&gt;), my test suite is launching (previously the rehydrate caused a constructor to throw), but I&apos;m getting what looks to be a common-cause &lt;tt&gt;MissingMethodException&lt;/tt&gt; in more mundane code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
groovy.lang.MissingMethodException: No signature of method: com.example.AdminOauthClientDto$_profileToDto_closure1$_closure2$_closure3.doCall() is applicable &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; argument types: (com.example.Identity...) values: [Identity(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, Envy TMS, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, [], [], Identity/10000000-0002-0000-0000-000000000004), ...]
Possible solutions: doCall(com.example.Identity, java.util.Set), findAll(), findAll()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;where the closure in question is&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
clientProfile.roleIdentities.forEach { id, orgs -&amp;gt;
  clientDto.doSomethingWithOrgs(orgs)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The correct signature for the closure is &lt;tt&gt;(Identity, Set&amp;lt;Organization&amp;gt;)&lt;/tt&gt;, and the bytecode does in fact show that as the signature for &lt;tt&gt;doCall&lt;/tt&gt;, but apparently somehow the compiler is trying to invoke it with varargs of the first parameter?&lt;/p&gt;</comment>
                            <comment id="17803266" author="chrylis" created="Thu, 4 Jan 2024 18:10:20 +0000"  >&lt;p&gt;Query: Is the closure generated by {{javaUtilMap.forEach &lt;/p&gt;
{ k, v -&amp;gt; /* code*/ }
&lt;p&gt;}} supposed to actually &lt;tt&gt;implements BiConsumer&lt;/tt&gt;, or is this wrapped by the &lt;tt&gt;cast&lt;/tt&gt; call?&lt;/p&gt;</comment>
                            <comment id="17803593" author="emilles" created="Fri, 5 Jan 2024 16:02:25 +0000"  >&lt;p&gt;In Groovy 3 (and I suspect Groovy 4.0.12 and lower) the trait helper method created for &lt;tt&gt;multiplyBy&lt;/tt&gt; does not have functional interface metadata on the lambda expression.  Classgen creates a typical closure class in this case, which has a &lt;tt&gt;rehydrate(delegate,owner,thisObject)&lt;/tt&gt; method.  And the cast adapts the closure instance into a &lt;tt&gt;Function&lt;/tt&gt;.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; MyInterface {
  &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyInterfaceHelper {
    Function&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; multiplyBy(MyInterface $self, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; multiplicand) {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-comment&quot;&gt;/*lambda*/&lt;/span&gt;.rehydrate($self,$self,$self)
    }
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17803595" author="emilles" created="Fri, 5 Jan 2024 16:07:07 +0000"  >&lt;p&gt;Regarding &lt;tt&gt;clientProfile.roleIdentities.forEach { id, orgs -&amp;gt; clientDto.doSomethingWithOrgs(orgs) };&lt;/tt&gt; you should get a closure for dynamic compilation that is proxy-adapted to &lt;tt&gt;BiConsumer&lt;/tt&gt;. For static compilation, you should get a lambda-factory implementation of &lt;tt&gt;BiConsumer&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17803608" author="chrylis" created="Fri, 5 Jan 2024 16:18:00 +0000"  >&lt;p&gt;For static compilation, I still get an adapted Closure.&lt;/p&gt;

</comment>
                            <comment id="17803615" author="emilles" created="Fri, 5 Jan 2024 16:39:40 +0000"  >&lt;p&gt;Sorry, if you use lambda syntax it goes to the lambda factory.  So, in your original example, you should be able to keep static compilation and use a closure for the return as a workaround.&lt;/p&gt;</comment>
                            <comment id="17803627" author="chrylis" created="Fri, 5 Jan 2024 16:57:00 +0000"  >&lt;p&gt;Are curly braces and parentheses-with-arrow treated identically, or are&lt;br/&gt;
they different in the AST?&lt;/p&gt;

</comment>
                            <comment id="17803666" author="emilles" created="Fri, 5 Jan 2024 18:40:30 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; closure = { -&amp;gt; ... }
&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; lambda = () -&amp;gt; { ... }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;They are close but not the same. The first creates a &lt;tt&gt;ClosureExpression&lt;/tt&gt; and the second a &lt;tt&gt;LambdaExpression&lt;/tt&gt;. LE extends CE so they share a lot of behavior and only really differ under static compilation in the presence of a &lt;tt&gt;@FunctionalInterface&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17803667" author="chrylis" created="Fri, 5 Jan 2024 18:44:10 +0000"  >&lt;p&gt;Hmm. Does the interface actually have to be annotated &lt;tt&gt;@FunctionalInterface&lt;/tt&gt;, or does any SAM interface match? I find the distinction surprising (maybe I shouldn&apos;t).&lt;/p&gt;</comment>
                            <comment id="17803684" author="emilles" created="Fri, 5 Jan 2024 19:08:33 +0000"  >&lt;p&gt;Annotation is not required.&lt;/p&gt;</comment>
                            <comment id="17803687" author="emilles" created="Fri, 5 Jan 2024 19:27:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/448479d369befe3f9407245cffc2e8a0aaee8252&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/448479d369befe3f9407245cffc2e8a0aaee8252&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17803694" author="chrylis" created="Fri, 5 Jan 2024 20:17:31 +0000"  >&lt;p&gt;Would it be worthwhile to also add a test case where &lt;tt&gt;times&lt;/tt&gt; returns a Function using the closure syntax?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13450814">GROOVY-10660</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://github.com/chrylis/GROOVY-11265]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>groovy</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 44 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1mjm8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>