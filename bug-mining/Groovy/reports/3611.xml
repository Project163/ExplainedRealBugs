<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:03:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-9074] CompileStatic does not throw expected exception</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-9074</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;While reading about Java Generics and wildcards (see &lt;a href=&quot;https://docs.oracle.com/javase/tutorial/extra/generics/wildcards.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/tutorial/extra/generics/wildcards.html&lt;/a&gt;), I came across the following code in the referenced oracle document&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Collection&amp;lt;?&amp;gt; c = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;();
 c.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;()); &lt;span class=&quot;code-comment&quot;&gt;// Compile time error&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now, I decided to wrap this in a class and try it out in Java and then in Groovy.&lt;/p&gt;

&lt;p&gt;Here is the Java code&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.*;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestCollection {
 &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Collection&amp;lt;?&amp;gt; c = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;();
 &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
   c.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;()); &lt;span class=&quot;code-comment&quot;&gt;// Compile time error
&lt;/span&gt; }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&#160;&lt;/p&gt;

&lt;p&gt;and here is the groovy code&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.*;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic;

@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestCollection {
 &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Collection&amp;lt;?&amp;gt; c = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;();
 &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
   c.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;()); &lt;span class=&quot;code-comment&quot;&gt;// Compile time error
&lt;/span&gt;   println c.first();
 }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;When I attempt to compile the Java code I get the following expected error&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ javac TestCollection.java
 TestCollection.java:7: error: incompatible types: &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; cannot be converted to CAP#1
 c.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;()); &lt;span class=&quot;code-comment&quot;&gt;// Compile time error
&lt;/span&gt; ^
 where CAP#1 is a fresh type-variable:
 CAP#1 &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; from capture of ?&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But, when I run the code through Groovy, I do not get a compile-time error.&#160; Instead, I get the following output&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;@41a0aa7d&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13227263">GROOVY-9074</key>
            <summary>CompileStatic does not throw expected exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="restagner">Robert Stagner</reporter>
                        <labels>
                            <label>breaking</label>
                    </labels>
                <created>Wed, 10 Apr 2019 17:29:38 +0000</created>
                <updated>Sat, 31 May 2025 14:25:07 +0000</updated>
                            <resolved>Wed, 13 Nov 2024 13:36:23 +0000</resolved>
                                    <version>2.5.5</version>
                                    <fixVersion>5.0.0-alpha-12</fixVersion>
                                    <component>Static Type Checker</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="16825401" author="emilles" created="Wed, 24 Apr 2019 18:03:26 +0000"  >&lt;p&gt;Similarly, this does not raise a type check error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
abstract &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Shape {
  abstract void draw(Canvas c)
}
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Circle &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Shape {
    private &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; x, y, radius
    @Override void draw(Canvas c) {}
}
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Rectangle &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Shape {
    private &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; x, y, width, height
    @Override void draw(Canvas c) {}
}

@groovy.transform.TypeChecked
void addRectangle(List&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Shape&amp;gt; shapes) {
    shapes.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Rectangle()) &lt;span class=&quot;code-comment&quot;&gt;// TODO: compile-time error!
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16825515" author="emilles" created="Wed, 24 Apr 2019 21:19:37 +0000"  >&lt;p&gt;Looks like this method does the filtering: &lt;tt&gt;StaticTypeCheckingSupport.chooseBestMethod&lt;/tt&gt;.  If I pass an obviously invalid argument type, this method filters a list of add methods to an empty list.  &lt;tt&gt;chooseBestMethod&lt;/tt&gt; calls &lt;tt&gt;makeRawTypes&lt;/tt&gt; on the parameters, which removes the ability to handle the wildcard extends or super cases.&lt;/p&gt;

&lt;p&gt;Or you could perform a check after &lt;tt&gt;chooseBestMethod&lt;/tt&gt;.  If it returns empty, the error message is not too informative: &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;Static type checking&amp;#93;&lt;/span&gt; - Cannot find matching method java.util.List#add(Rectangle). Please check if the declared type is correct and if the method exists.&quot;&lt;/p&gt;</comment>
                            <comment id="16825545" author="emilles" created="Wed, 24 Apr 2019 22:25:44 +0000"  >&lt;p&gt;Here is one change that will assist 2 possible approaches.&#160; As-is, the wildcard type &quot;? extends Shape&quot; will be returned for the parameter type, which will match Rectangle.&#160; Thus, &lt;tt&gt;chooseBestMethod&lt;/tt&gt; can return &lt;tt&gt;add(E)&lt;/tt&gt; as a match and a check can be made later for the capture-of type.  &lt;b&gt;Or&lt;/b&gt;, the wildcard check below can be uncommented and a capture-of type will be returned that will not match Rectangle.  Thus, an error &quot;Cannot find matching method java.util.List#add(Rectangle)...&quot; will be produced.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Parameter[] makeRawTypes(Parameter[] params, Map&amp;lt;GenericsType, GenericsType&amp;gt; genericsPlaceholderAndTypeMap) {
        Parameter[] newParam = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Parameter[params.length];
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; params.length; i++) {
            Parameter oldP = params[i];

            /* GRECLIPSE edit -- GROOVY-9074
            ClassNode actualType = GenericsUtils.findActualTypeByGenericsPlaceholderName(oldP.getType().getUnresolvedName(), genericsPlaceholderAndTypeMap);
            Parameter newP = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Parameter(makeRawType(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; == actualType ? oldP.getType() : actualType), oldP.getName());
            newParam[i] = newP;
            */
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name = oldP.getType().getUnresolvedName();
            Optional&amp;lt;GenericsType&amp;gt; value = genericsPlaceholderAndTypeMap.entrySet().stream().filter(e -&amp;gt; e.getKey().getName().equals(name)).findFirst().map(e -&amp;gt; e.getValue());
            ClassNode type = value.map(gt -&amp;gt; &lt;span class=&quot;code-comment&quot;&gt;/*gt.isWildcard() ? ClassHelper.makeWithoutCaching(&lt;span class=&quot;code-quote&quot;&gt;&quot;capture-of ?&quot;&lt;/span&gt;) :*/&lt;/span&gt; gt.getType()).orElseGet(() -&amp;gt; makeRawType(oldP.getType()));
            newParam[i] = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Parameter(type, oldP.getName());
            &lt;span class=&quot;code-comment&quot;&gt;// GRECLIPSE end
&lt;/span&gt;        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; newParam;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16846669" author="paulk" created="Thu, 23 May 2019 12:05:41 +0000"  >&lt;p&gt;Three tests in groovy.bugs.Groovy8609Bug break after the proposed change.&lt;/p&gt;</comment>
                            <comment id="16852008" author="emilles" created="Thu, 30 May 2019 15:43:36 +0000"  >&lt;p&gt;The 3 tests mentioned went from error &quot;Cannot call A &amp;lt;ArrayList, HashMap&amp;gt;#getFirstRecord(T) with arguments &lt;span class=&quot;error&quot;&gt;&amp;#91;java.util.ArrayList &amp;lt;HashMap&amp;gt;&amp;#93;&lt;/span&gt;&apos;)&quot; to error &quot;Cannot find matching method A#getFirstRecord(java.util.ArrayList &amp;lt;TreeMap&amp;gt;)&quot;.&#160; So each is still producing an error related to the argument/parameter mismatch.&lt;/p&gt;

&lt;p&gt;I have seen the latter error becoming more frequent in Groovy 2.5.&#160; I&apos;m not sure why that is and personally prefer the first error which describes an existing method.&lt;/p&gt;</comment>
                            <comment id="17345033" author="restagner" created="Sat, 15 May 2021 13:35:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulk&quot; class=&quot;user-hover&quot; rel=&quot;paulk&quot;&gt;paulk&lt;/a&gt;&#160;/ &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt;, any further developments regarding this bug?&lt;/p&gt;</comment>
                            <comment id="17897283" author="emilles" created="Mon, 11 Nov 2024 22:07:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/pull/2121&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/2121&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17897920" author="emilles" created="Wed, 13 Nov 2024 13:36:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/71490fbbc2dc63cdaa70b2f61b77f7f5f94b82af&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/71490fbbc2dc63cdaa70b2f61b77f7f5f94b82af&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/groovy/commit/9435d9613e912d018efe567fd4f9e600f55b69a0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/9435d9613e912d018efe567fd4f9e600f55b69a0&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13619684">GROOVY-11685</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12817573">GROOVY-6835</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13041337">GROOVY-8084</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13440689">GROOVY-10588</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13412064">GROOVY-10371</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>groovy</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            51 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z01ni0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>