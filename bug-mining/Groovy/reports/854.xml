<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:10:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-3238] String.valueOf(BigInteger) doesn&apos;t call String.valueOf(Object)</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-3238</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Somehow Groovy is calling some formatting method rather than String.valueOf(Object) for:&lt;/p&gt;

&lt;p&gt;String.valueOf(new BigInteger(&apos;1000&apos;))&lt;/p&gt;

&lt;p&gt;You can see the difference with:&lt;/p&gt;

&lt;p&gt;assert (String.valueOf(new BigInteger(&apos;1000&apos;))) == (new BigInteger(&apos;1000&apos;).toString())&lt;/p&gt;

&lt;p&gt;which is a good test because String.valueOf(Object) is defined to be the same as String.toString() if the object is not null.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12811714">GROOVY-3238</key>
            <summary>String.valueOf(BigInteger) doesn&apos;t call String.valueOf(Object)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roshandawrani">Roshan Dawrani</assignee>
                                    <reporter username="jimwhite">James P. White</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Dec 2008 01:00:08 +0000</created>
                <updated>Thu, 22 Jan 2009 21:34:42 +0000</updated>
                            <resolved>Wed, 31 Dec 2008 15:12:48 +0000</resolved>
                                    <version>1.5.7</version>
                    <version>1.6-rc-1</version>
                                    <fixVersion>1.6-rc-2</fixVersion>
                    <fixVersion>1.5.8</fixVersion>
                    <fixVersion>1.7-beta-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14466121" author="jimwhite" created="Fri, 26 Dec 2008 09:54:14 +0000"  >&lt;p&gt;I think this is another static method resolution bug.&lt;/p&gt;

&lt;p&gt;Groovy is preferring String.valueOf(double) over String.valueOf(Object) and doing a conversion when the parameter is a BigInteger.  That doesn&apos;t appear to be happening for BigDecimal from what I&apos;ve tried so far, so this isn&apos;t some logic just about Number.&lt;/p&gt;</comment>
                            <comment id="14466003" author="roshandawrani" created="Fri, 26 Dec 2008 11:23:31 +0000"  >&lt;p&gt;When, as per casting rules, multiple methods match a particular invocation, groovy uses relative parameter distances to see which method is the best match.&lt;/p&gt;

&lt;p&gt;When the invocation &quot;String.valueOf(new BigDecimal(&apos;1000&apos;))&quot; is made, 2 method matches are found:&lt;br/&gt;
1)  String.valueOf(double) -&amp;gt; double to BigDecimal distance = 3&lt;br/&gt;
2)  String.valueOf(Object) -&amp;gt; Object to BigDecimal distance = 2&lt;br/&gt;
In this case, shortest distance match is String.valueOf(Object).&lt;br/&gt;
[/&lt;b&gt;distances for BigDecimal&lt;/b&gt;/&lt;/p&gt;
{14, 15, 12, 13, 10, 11, 8, 9, 7, 5, 6, 3(double), 4, 0, 1, 2(Object),}
&lt;p&gt;]&lt;/p&gt;

&lt;p&gt;But when the invocation &quot;String.valueOf(new BigInteger(&apos;1000&apos;))&quot; is made, 3 method matches are found:&lt;br/&gt;
1)  String.valueOf(double)      -&amp;gt; double to BigInteger distance = 3&lt;br/&gt;
2)  String.valueOf(int)         -&amp;gt; int to BigInteger distance = 10&lt;br/&gt;
3)  String.valueOf(Object)      -&amp;gt; Object to BigInteger distance = 7&lt;br/&gt;
In this case, shortest distance match is String.valueOf(double).&lt;br/&gt;
[/&lt;b&gt;distances for BigInteger&lt;/b&gt;/&lt;/p&gt;
{14, 15, 12, 13, 10(int), 11, 8, 9, 0, 1, 2, 3(double), 4, 5, 6, 7(Object),}
&lt;p&gt;]&lt;/p&gt;

&lt;p&gt;So, as per the parameter distances decided, for BigInteger, matches are preferred in the order 1) double, 2) Object, 3) int, so it picks up valueOf(double), which makes it wrong!&lt;/p&gt;

&lt;p&gt;There seems to be inconsistency between distances set for BigInteger and BigDecimal.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;For BigDecimal, best matches go in the order BigDecimal, Number, Object, double, Double....&lt;/li&gt;
	&lt;li&gt;Whereas for BigInteger, best matches go in the order BigInteger, float, Float, double, Double...Number, Object...Shouldn&apos;t even BigInteger be closer to Number/Object compared to primitive types?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14466044" author="jimwhite" created="Fri, 26 Dec 2008 13:36:55 +0000"  >&lt;p&gt;I think Groovy&apos;s resolution and conversion logic should produce the same results as Java&apos;s.  I realize that may be hard to do given the current implementation, but certainly we should be able to fix up whatever is going wrong here.&lt;/p&gt;

&lt;p&gt;Java&apos;s rules are here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://java.sun.com/docs/books/jls/third_edition/html/expressions.html#20448&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://java.sun.com/docs/books/jls/third_edition/html/expressions.html#20448&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://java.sun.com/docs/books/jls/third_edition/html/conversions.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://java.sun.com/docs/books/jls/third_edition/html/conversions.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Do we have specifications and/or issues documenting what is expected (aside from the code)?&lt;/p&gt;</comment>
                            <comment id="14466015" author="blackdrag" created="Mon, 29 Dec 2008 12:20:19 +0000"  >&lt;p&gt;a distance of 7 from BigInteger to Object sounds wrong... at last it should be the same as from BigDecimal to Object. The order should be something like BigInteger, Number, Object, long, Long, int, Integer, short, Short, byte, Byte, double, Double, float, Float...&lt;/p&gt;

&lt;p&gt;So this needs tweaking...&lt;/p&gt;

&lt;p&gt;As for the Java rules... Groovy is a language where a number 1 is at the same time the int 1 and the Integer 1. So if you have an overloaded method foo taking one time a long and one time an Integer it would be very strange to prefer foo(long) over foo(Integer). But that is exactly what Java would do. Java tries to have a strict separation between primitive types and Objects, so it makes sense there. But in Groovy this is different, if not the opposite. We try to hide primitives as best as we can. For example is 1 instanceof Integer true and that is not an implementation detail, it is an elementary thought here.&lt;/p&gt;</comment>
                            <comment id="14466106" author="jimwhite" created="Mon, 29 Dec 2008 14:24:59 +0000"  >&lt;p&gt;I&apos;m not going to delve into Groovy&apos;s model here, but I think you&apos;ll agree that we need for Groovy to resolve this type of overloading in the same way as Java 5&apos;s autoboxing does.  &lt;/p&gt;

&lt;p&gt;I point out the Java spec because it would be a good idea for someone to review Groovy&apos;s internals and analyze them with respect to the Java spec in order to determine if there are any other problems such as this one.  Also we don&apos;t want to fix this issue and cause another.&lt;/p&gt;

</comment>
                            <comment id="14466076" author="blackdrag" created="Mon, 29 Dec 2008 17:26:04 +0000"  >&lt;p&gt;Jim, that my wonder you, but I don&apos;t agree that we should do that the same as java5 autoboxing. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def foo(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;) {1}
def foo(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;) {2}
def foo(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; o) {3}
&lt;span class=&quot;code-comment&quot;&gt;// groovy
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; foo(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;(1)) == 1
&lt;span class=&quot;code-comment&quot;&gt;// java
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; foo(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;(1)) == 3&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also we have primtive BigDecimals and BigIntegers, unlike Java. So we extended the widening and narrowing rules to them too&lt;/p&gt;</comment>
                            <comment id="14466046" author="jimwhite" created="Mon, 29 Dec 2008 20:24:25 +0000"  >&lt;p&gt;Well, that is exactly the issue we&apos;re facing here.&lt;/p&gt;

&lt;p&gt;Because Groovy doesn&apos;t behave the same as Java wrt to overloading there is no way to use a properly designed Java class (like PrintWriter and unlike your foo example).&lt;/p&gt;

&lt;p&gt;How do you propose we solve this problem?  I regard it as a blocker for 1.6.  Notice the test case in &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-3237&quot; title=&quot;println is inconsistent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-3237&quot;&gt;&lt;del&gt;GROOVY-3237&lt;/del&gt;&lt;/a&gt; that led to discovering this bug.&lt;/p&gt;
</comment>
                            <comment id="14466123" author="roshandawrani" created="Tue, 30 Dec 2008 01:11:31 +0000"  >&lt;p&gt;So, shall I try the modified distances for BigInteger as suggested above (BigInteger, Number, Object, long, Long, int, Integer, short, Short, byte, Byte, double, Double, float, Float) and see if it breaks anything. Or, the modification to distances needs to be discussed / thought about more.&lt;/p&gt;</comment>
                            <comment id="14466108" author="blackdrag" created="Tue, 30 Dec 2008 09:35:52 +0000"  >&lt;p&gt;Jim, I don&apos;t think that a bug, that exists since Groovy 1.0 does qualify as blocker. Also the distance table is obviously wrong, so correcting it will also lead to the same result as for Java in this case. Of course you can easily consruct a case where JAva will behave different from Groovy, but you have the same with dynamic typing too.&lt;/p&gt;

&lt;p&gt;Roshan, I think modifying the table as I sad and test if it breaks something is ok.. an additional testcase is also needed to ensure we won&apos;t change it back&lt;/p&gt;</comment>
                            <comment id="14466077" author="roshandawrani" created="Tue, 30 Dec 2008 21:00:11 +0000"  >&lt;p&gt;Hi Jochen,&lt;br/&gt;
    I tried the change in distances and it did not break anything and fixed the issue of this JIRA.&lt;/p&gt;

&lt;p&gt;Shall I commit the change? It needs to be fixed on all 1.5.8, 1.6-rc-2 and trunk, right?&lt;/p&gt;

&lt;p&gt;One little thing is that in the new distances you had given, BigDecimal was absent. I have positioned that as in &lt;span class=&quot;error&quot;&gt;&amp;#91;BigInteger, Number, Object, long, Long, int, Integer, short, Short, byte, Byte, BigDecimal, double, Double, float, Float&amp;#93;&lt;/span&gt;. Let me know if that does not look alright for some reason.&lt;/p&gt;

&lt;p&gt;rgds,&lt;br/&gt;
Roshan&lt;/p&gt;</comment>
                            <comment id="14466062" author="blackdrag" created="Tue, 30 Dec 2008 21:53:03 +0000"  >&lt;p&gt;no.that does look to me, so apply the patch to all versions.&lt;/p&gt;</comment>
                            <comment id="14466126" author="roshandawrani" created="Wed, 31 Dec 2008 15:12:48 +0000"  >&lt;p&gt;Fixed by correcting the primitive distances for BigInteger type as discussed with Jochen.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12817972">GROOVY-3237</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12722147" name="Groovy3238Bug.groovy" size="253" author="jimwhite" created="Fri, 26 Dec 2008 01:01:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 47 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cmhz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>