<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:08:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-3001] BUG! exception in phase &apos;semantic analysis&apos; in source unit &apos;sample/SimpleBean.groovy&apos; null using Groovy-1.5.{5,6} with GlassFish V3&apos;s JSF+Groovy Support</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-3001</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I&apos;ve begun testing the Groovy support in GlassFish V3 to ensure it still works (it works fine in V2).&lt;/p&gt;

&lt;p&gt;I&apos;ve copied the groovy-all jar to V3 modules directory which exposes Groovy as an OSGi bundle to the runtime.&lt;/p&gt;

&lt;p&gt;When accessing a page that references a simple Groovy-based managed bean I get the following:&lt;/p&gt;

&lt;p&gt;BUG! exception in phase &apos;semantic analysis&apos; in source unit &apos;sample/SimpleBean.groovy&apos; null&lt;br/&gt;
	at org.codehaus.groovy.control.CompilationUnit.applyToSourceUnits(CompilationUnit.java:776)&lt;br/&gt;
	at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:438)&lt;br/&gt;
	at groovy.lang.GroovyClassLoader.parseClass(GroovyClassLoader.java:277)&lt;br/&gt;
	at groovy.lang.GroovyClassLoader.parseClass(GroovyClassLoader.java:248)&lt;br/&gt;
	at groovy.lang.GroovyClassLoader.parseClass(GroovyClassLoader.java:243)&lt;br/&gt;
	at groovy.util.GroovyScriptEngine.updateCacheEntry(GroovyScriptEngine.java:316)&lt;br/&gt;
	at groovy.util.GroovyScriptEngine.loadScriptByName(GroovyScriptEngine.java:265)&lt;br/&gt;
	at com.sun.faces.scripting.GroovyHelperImpl$MojarraGroovyClassLoader.loadClass(GroovyHelperImpl.java:139)&lt;br/&gt;
	at com.sun.faces.util.Util.loadClass(Util.java:223)&lt;/p&gt;

&lt;p&gt;ROOT CAUSE:&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at groovy.util.GroovyScriptEngine$ScriptCacheEntry.access$300(GroovyScriptEngine.java:75)&lt;br/&gt;
	at groovy.util.GroovyScriptEngine$1$1.findClass(GroovyScriptEngine.java:101)&lt;br/&gt;
	at java.lang.ClassLoader.loadClass(ClassLoader.java:306)&lt;br/&gt;
	at groovy.lang.GroovyClassLoader.loadClass(GroovyClassLoader.java:633)&lt;br/&gt;
	at groovy.lang.GroovyClassLoader.loadClass(GroovyClassLoader.java:491)&lt;br/&gt;
	at org.codehaus.groovy.control.ResolveVisitor.resolveToClass(ResolveVisitor.java:605)&lt;br/&gt;
	at org.codehaus.groovy.control.ResolveVisitor.resolve(ResolveVisitor.java:251)&lt;br/&gt;
	at org.codehaus.groovy.control.ResolveVisitor.resolveFromModule(ResolveVisitor.java:549)&lt;br/&gt;
	at org.codehaus.groovy.control.ResolveVisitor.resolve(ResolveVisitor.java:251)&lt;br/&gt;
	at org.codehaus.groovy.control.ResolveVisitor.resolve(ResolveVisitor.java:219)&lt;br/&gt;
	at org.codehaus.groovy.control.ResolveVisitor.resolveOrFail(ResolveVisitor.java:203)&lt;br/&gt;
	at org.codehaus.groovy.control.ResolveVisitor.resolveOrFail(ResolveVisitor.java:215)&lt;br/&gt;
	at org.codehaus.groovy.control.ResolveVisitor.visitField(ResolveVisitor.java:174)&lt;br/&gt;
	at org.codehaus.groovy.ast.ClassNode.visitContents(ClassNode.java:812)&lt;br/&gt;
	at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitClass(ClassCodeVisitorSupport.java:48)&lt;br/&gt;
	at org.codehaus.groovy.control.ResolveVisitor.visitClass(ResolveVisitor.java:1000)&lt;br/&gt;
	at org.codehaus.groovy.control.ResolveVisitor.startResolving(ResolveVisitor.java:141)&lt;br/&gt;
	at org.codehaus.groovy.control.CompilationUnit$5.call(CompilationUnit.java:527)&lt;br/&gt;
	at org.codehaus.groovy.control.CompilationUnit.applyToSourceUnits(CompilationUnit.java:772)&lt;/p&gt;


&lt;p&gt;Our usage of Groovy is pretty straight forward.  We have a simple ClassLoader that wraps the GroovyScriptEngine &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;The Groovy-based bean is simple:&lt;br/&gt;
--------------------------------------------------&lt;br/&gt;
package sample;&lt;/p&gt;

&lt;p&gt;public class SimpleBean {&lt;/p&gt;

&lt;p&gt;    private String message = &quot;Hello World!&quot;;&lt;/p&gt;

&lt;p&gt;    public String getMessage() &lt;/p&gt;
{
        return message;
    }
&lt;p&gt;}&lt;br/&gt;
--------------------------------------------------&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://fisheye5.cenqua.com/browse/javaserverfaces-sources/jsf-ri/src/com/sun/faces/scripting/GroovyHelperImpl.java?r=1.1.2.4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://fisheye5.cenqua.com/browse/javaserverfaces-sources/jsf-ri/src/com/sun/faces/scripting/GroovyHelperImpl.java?r=1.1.2.4&lt;/a&gt;&lt;/p&gt;
</description>
                <environment>Sun JDK 1.5.0_15&lt;br/&gt;
Unbuntu 8.0.4&lt;br/&gt;
Local build of GlassFish V3&lt;br/&gt;
Mojarra JSF 1.2_09</environment>
        <key id="12817857">GROOVY-3001</key>
            <summary>BUG! exception in phase &apos;semantic analysis&apos; in source unit &apos;sample/SimpleBean.groovy&apos; null using Groovy-1.5.{5,6} with GlassFish V3&apos;s JSF+Groovy Support</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="rlubke">Ryan Lubke</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Aug 2008 16:54:13 +0000</created>
                <updated>Mon, 8 Sep 2008 18:49:08 +0000</updated>
                            <resolved>Mon, 8 Sep 2008 18:49:08 +0000</resolved>
                                    <version>1.5.5</version>
                    <version>1.5.6</version>
                    <version>1.6-beta-1</version>
                                    <fixVersion>1.5.7</fixVersion>
                    <fixVersion>1.6-beta-2</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14465081" author="rlubke" created="Wed, 13 Aug 2008 17:12:24 +0000"  >&lt;p&gt;Fired up a debugger and it seems to be having issues when resolving a class called sample.String.&lt;br/&gt;
Looking up the call stack when we&apos;re resolving the type for the field &apos;message&apos;, line 548 of &lt;br/&gt;
org.codehaus.groovy.control.ResolveVisitor resolves the class name to sample.String.  &lt;/p&gt;</comment>
                            <comment id="14465198" author="rlubke" created="Wed, 13 Aug 2008 17:35:01 +0000"  >&lt;p&gt;Ok, ignore the last comment.&lt;/p&gt;

&lt;p&gt;Lines 100 and 101 of GroovyScriptEngine (1.5.5)&lt;/p&gt;

&lt;p&gt;    ScriptCacheEntry currentCacheEntry = (ScriptCacheEntry) currentCacheEntryHolder.get();&lt;br/&gt;
     currentCacheEntry.dependencies.put(&lt;br/&gt;
                                                dependentScriptConn.getURL(),&lt;br/&gt;
                                                new Long(dependentScriptConn.getLastModified()));&lt;/p&gt;

&lt;p&gt;currentCacheEntry is null for whatever reason.&lt;/p&gt;</comment>
                            <comment id="14465152" author="rlubke" created="Wed, 13 Aug 2008 18:01:07 +0000"  >&lt;p&gt;Ok, narrowed down further.&lt;/p&gt;

&lt;p&gt;GroovyScriptEngine.loadScriptByName() is called for sample.SimpleBean.&lt;/p&gt;

&lt;p&gt;The GroovyLexer is initialized and calls ClassLoader.loadClass(&quot;groovyjarjarantlr.CommonToken&quot;).&lt;/p&gt;

&lt;p&gt;The context classloader still refers to our GroovyHelper&apos;s ClassLoader wrapper &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;We first attempt to load the proper class by calling our parent, which in this case would be the WebappClassLoader.&lt;br/&gt;
This class lookup fails, and so we try to load it as a GrooyvScript.  This load attempt causes the finally block in &lt;br/&gt;
GroovyScriptEngine.updateCacheEntry() to fire clearing out the thread local value.  Thus when we return to processing &lt;br/&gt;
later, the cache entry as described above is null.&lt;/p&gt;

&lt;p&gt;GFv3 is using Felix for its OSGi runtime (if this helps).&lt;br/&gt;
Since the load of groovyjarjarantlr.CommonToken failed (and it&apos;s in the JAR), I decided to look at the manifest&lt;br/&gt;
and see that the groovyjarjarantlr package isn&apos;t exported.   &lt;/p&gt;




&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://fisheye5.cenqua.com/browse/javaserverfaces-sources/jsf-ri/src/com/sun/faces/scripting/GroovyHelperImpl.java?r=1.1.2.4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://fisheye5.cenqua.com/browse/javaserverfaces-sources/jsf-ri/src/com/sun/faces/scripting/GroovyHelperImpl.java?r=1.1.2.4&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14465090" author="rlubke" created="Thu, 14 Aug 2008 11:20:33 +0000"  >&lt;p&gt;I got my test case working after I added the following packages to the Export-Packages:&lt;/p&gt;

&lt;p&gt;groovyjarjarantlr,&lt;br/&gt;
groovyjarjarantlr.actions,&lt;br/&gt;
groovyjarjarantlr.actions.java,&lt;br/&gt;
groovyjarjarantlr.collections,&lt;br/&gt;
groovyjarjarantlr.collections.impl,&lt;br/&gt;
groovyjarjarantlr.preprocessor&lt;/p&gt;

&lt;p&gt;If these changes make it in, I&apos;d be willing to test a nightly in our environment to verify.&lt;/p&gt;</comment>
                            <comment id="14465166" author="blackdrag" created="Thu, 14 Aug 2008 17:17:35 +0000"  >&lt;p&gt;So the problem is that... the wrong classloader is used to access that package? I mean GroovyLexer is in the same jar as groovyjarjarantlr.CommonToken, so I guess if the class loader fro GroovyLexer would be used the issue would be solved too, yes?&lt;/p&gt;</comment>
                            <comment id="14465153" author="rlubke" created="Thu, 14 Aug 2008 17:39:06 +0000"  >&lt;p&gt;It sounds like that would do it.&lt;/p&gt;
</comment>
                            <comment id="14465186" author="blackdrag" created="Thu, 14 Aug 2008 17:39:57 +0000"  >&lt;p&gt;just double checked... the class is loaded through antlr code, which tries first he context loader and then Class.forName(String)... but we can overwrite the method and plugin our own class laoding code... we only need to know what that code must look like&lt;/p&gt;</comment>
                            <comment id="14465170" author="blackdrag" created="Fri, 22 Aug 2008 08:20:12 +0000"  >&lt;p&gt;if a 1.6 version is ok for you, then could you got o &lt;a href=&quot;http://build.canoo.com/groovy/artifacts/20080822141039/dist&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://build.canoo.com/groovy/artifacts/20080822141039/dist&lt;/a&gt; grab one of the -all jar files and test if the class loading part is fixed? if you need 1.5, then you have to build it yourself... which isn&apos;t much of a problem if you have a subversion client and ant installed. &lt;/p&gt;</comment>
                            <comment id="14465209" author="rlubke" created="Mon, 8 Sep 2008 14:12:34 +0000"  >&lt;p&gt;Sorry for the delayed response.  The link is invalid at this point.  Would a nightly build of 1.6 include this change?&lt;/p&gt;</comment>
                            <comment id="14465267" author="blackdrag" created="Mon, 8 Sep 2008 18:13:14 +0000"  >&lt;p&gt;the change is in trunk, so it is in the nightly builds too... if the link is invalid now go to &lt;a href=&quot;http://build.canoo.com/groovy/artifacts/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://build.canoo.com/groovy/artifacts/&lt;/a&gt; and grab the latest build version. You will find the jars in the dist subdirectory&lt;/p&gt;</comment>
                            <comment id="14465256" author="rlubke" created="Mon, 8 Sep 2008 18:36:24 +0000"  >&lt;p&gt;Ok, I gave it a go and it seems to work now.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="14465278" author="blackdrag" created="Mon, 8 Sep 2008 18:49:08 +0000"  >&lt;p&gt;fixed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 12 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cg4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>