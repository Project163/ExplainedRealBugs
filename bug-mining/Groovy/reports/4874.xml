<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:25:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-11258] AssertJ collection mapping is badly supported</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-11258</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The following code will fail with the message &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[Static type checking] - No such property: x for class: java.lang.Object
 @ line 8, column 13.
         .map{ it.x }
               ^
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
@groovy.transform.CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;AssertJCollectionMappingTest {

  @org.junit.jupiter.api.Test
  void mapping() {
    &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; texts = somePojos()
    org.assertj.core.api.Assertions.assertThat(texts)
      .map{ it.x }
      .containsExactlyInAnyOrderElementsOf([&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;])
  }

  private static Collection&amp;lt;Pojo&amp;gt; somePojos() {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; [&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Pojo(x: &lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Pojo(x: &lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;)]
  }

  static &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Pojo {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; x
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Changing the line  to  &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;.map({ it.x } as Function&amp;lt;Pojo, String&amp;gt;) 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;makes it compile but it is clumsy for more complicated types.&lt;/p&gt;

&lt;p&gt;It would be nice if Groovy was able to resolve the types without hints.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13562998">GROOVY-11258</key>
            <summary>AssertJ collection mapping is badly supported</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="jhunovis">Jan Hackel</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Dec 2023 08:41:01 +0000</created>
                <updated>Tue, 12 Nov 2024 11:39:00 +0000</updated>
                            <resolved>Thu, 26 Sep 2024 21:09:19 +0000</resolved>
                                    <version>4.0.17</version>
                                    <fixVersion>5.0.0-alpha-11</fixVersion>
                                    <component>Static Type Checker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17800736" author="paulk" created="Wed, 27 Dec 2023 10:11:11 +0000"  >&lt;p&gt;Just to show the native way you&apos;d do that assertion (without assertj):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
void mapping() {
  &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; somePojos()*.x.toSet() == [&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;] as Set
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Or, using assertj, if you drop the &lt;tt&gt;@CompileStatic&lt;/tt&gt;, you can slightly simplify the mapping line you noted to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
.map({ it.x } as Function )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17800869" author="emilles" created="Wed, 27 Dec 2023 20:07:52 +0000"  >&lt;p&gt;The choices for &lt;tt&gt;map&lt;/tt&gt; are:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;a href=&quot;https://www.javadoc.io/static/org.assertj/assertj-core/3.24.2/org/assertj/core/api/AbstractIterableAssert.html#map(java.util.function.Function)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;map(Function)&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://www.javadoc.io/static/org.assertj/assertj-core/3.24.2/org/assertj/core/api/AbstractIterableAssert.html#map(java.util.function.Function...)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;map(Function...)&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://www.javadoc.io/static/org.assertj/assertj-core/3.24.2/org/assertj/core/api/AbstractIterableAssert.html#map(org.assertj.core.api.iterable.ThrowingExtractor)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;map(ThrowingExtractor)&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&lt;tt&gt;ThrowingExtractor&lt;/tt&gt; extends &lt;tt&gt;Function&lt;/tt&gt;, so there is no help from &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9881&quot; title=&quot;STC can&amp;#39;t distinguish SAMs based on arity&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9881&quot;&gt;&lt;del&gt;GROOVY-9881&lt;/del&gt;&lt;/a&gt; param count disambiguation.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@FunctionalInterface
&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; ThrowingExtractor&amp;lt;I, O, T &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Exception&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Function&amp;lt;I, O&amp;gt; {
  &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; O apply(I input) { &lt;span class=&quot;code-comment&quot;&gt;/**/&lt;/span&gt; }
  O extractThrows(I input) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; T
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17800886" author="emilles" created="Wed, 27 Dec 2023 21:39:56 +0000"  >&lt;p&gt;Is there a good reference to the java spec for how they choose in this situation?&lt;/p&gt;</comment>
                            <comment id="17800920" author="emilles" created="Thu, 28 Dec 2023 06:23:50 +0000"  >&lt;p&gt;I believe the rule that covers this is in section &lt;a href=&quot;https://docs.oracle.com/javase/specs/jls/se8/html/jls-15.html#jls-15.12.2.5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;15.12.2.5&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;A type S is more specific than a type T for any expression if S &amp;lt;: T (&#167;4.10).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That says to me that &lt;tt&gt;ThrowingExtractor&lt;/tt&gt; is more specific since it extends &lt;tt&gt;Function&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;This appears to be checked in the eclipse compiler for java (ecj) by this: &lt;a href=&quot;https://github.com/eclipse-jdt/eclipse.jdt.core/blob/7d2442b37130c73f1ffe174d2bb1ead95159c69b/org.eclipse.jdt.core.compiler.batch/src/org/eclipse/jdt/internal/compiler/lookup/InferenceContext18.java#L871&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/eclipse-jdt/eclipse.jdt.core/blob/7d2442b37130c73f1ffe174d2bb1ead95159c69b/org.eclipse.jdt.core.compiler.batch/src/org/eclipse/jdt/internal/compiler/lookup/InferenceContext18.java#L871&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17801208" author="emilles" created="Fri, 29 Dec 2023 16:11:33 +0000"  >&lt;p&gt;There are two other workarounds available besides cast/coerce:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Add an extension method that accepts a closure so it will take precedence:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// must be registered as extension method class
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;AssertJGroovyMethods {
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;E,V&amp;gt; AbstractListAssert&amp;lt;?,List&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; V&amp;gt;,V,ObjectAssert&amp;lt;V&amp;gt;&amp;gt;
    map(
      AbstractIterableAssert&amp;lt;?,?,E,?&amp;gt; strategy, &lt;span class=&quot;code-comment&quot;&gt;// type args may need some work
&lt;/span&gt;      @ClosureParams(value=FromString.&lt;span class=&quot;code-keyword&quot;&gt;class,&lt;/span&gt;options=&lt;span class=&quot;code-quote&quot;&gt;&quot;E&quot;&lt;/span&gt;)
      Closure&amp;lt;V&amp;gt; mapper) {
    &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; extractor = DefaultGroovyMethods.asType(mapper, ThrowingExtractor.class);
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; strategy.map(extractor);
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;You can use a type-checking extension to resolve which method to use for &lt;tt&gt;map&lt;/tt&gt;. This can be applied at the call site or more widely using some ideas below.
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
@Grab(&lt;span class=&quot;code-quote&quot;&gt;&apos;org.assertj:assertj-core:3.24.2&apos;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; static org.assertj.core.api.Assertions.assertThat

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Pojo { &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; x }
Collection&amp;lt;Pojo&amp;gt; getPojos() {
  [&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Pojo(x: &lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Pojo(x: &lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;)]
}
@groovy.transform.CompileStatic(extensions=&lt;span class=&quot;code-quote&quot;&gt;&apos;Groovy11258.groovy&apos;&lt;/span&gt;)
void test() {
  assertThat(pojos).map { it.x }
    .containsExactlyInAnyOrderElementsOf([&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;])
}

test()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// Groovy11258.groovy
&lt;/span&gt;ambiguousMethods { methods, call -&amp;gt;
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (call &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; MethodCallExpression
      &amp;amp;&amp;amp; call.methodAsString == &lt;span class=&quot;code-quote&quot;&gt;&apos;map&apos;&lt;/span&gt;) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; methods.find { method -&amp;gt;
      &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; firstParam = method.parameters[0]
      firstParam.type.nameWithoutPackage == &lt;span class=&quot;code-quote&quot;&gt;&apos;ThrowingExtractor&apos;&lt;/span&gt;
    }
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And you could make it easy to apply using &lt;tt&gt;AnnotationCollector&lt;/tt&gt;.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
@org.junit.jupiter.api.Test
@groovy.transform.CompileStatic(extensions=&lt;span class=&quot;code-quote&quot;&gt;&apos;Groovy11258.groovy&apos;&lt;/span&gt;)
@groovy.transform.AnnotationCollector(mode=groovy.transform.AnnotationCollectorMode.PREFER_COLLECTOR_MERGED)
@&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; MyTest {
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then you could designate a test method like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;AssertJCollectionMappingTest {
  @MyTest &lt;span class=&quot;code-comment&quot;&gt;// JUnit 5 test and CompileStatic w/ extension
&lt;/span&gt;  void mapping() {
    &lt;span class=&quot;code-comment&quot;&gt;//...
&lt;/span&gt;  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Including the &lt;tt&gt;@Test&lt;/tt&gt; annotation is just an idea to demonstrate the concept. You could do this at the test class level or by AST transform or by compiler configuration.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="17806580" author="emilles" created="Mon, 15 Jan 2024 01:07:39 +0000"  >&lt;p&gt;Item 1 from above looks like this. It takes some one-time setup, but doesn&apos;t require any change in how you write tests.&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13065677/13065677_screenshot-1.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17885162" author="emilles" created="Thu, 26 Sep 2024 21:09:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/7576b86fd5a0ecdb5c64f521d6a1b3de00ca3935&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/7576b86fd5a0ecdb5c64f521d6a1b3de00ca3935&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13386314">GROOVY-10153</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13448428">GROOVY-10651</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13469023">GROOVY-10671</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13480711">GROOVY-10756</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13555278">GROOVY-11204</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13065677" name="screenshot-1.png" size="34753" author="emilles" created="Fri, 29 Dec 2023 16:43:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>groovy</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 6 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1mgkw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>