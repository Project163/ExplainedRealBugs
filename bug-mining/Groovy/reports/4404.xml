<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:18:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-10579] Type &apos;[I&apos; is not assignable to reference type when using Groovy 3.0.10</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-10579</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;We are having a strange problem when using static compile transformation.&lt;/p&gt;

&lt;p&gt;Most likely what we are doing is not the best approach. However, this was working in 3.0.9 and stopped working with 3.0.10.&lt;/p&gt;

&lt;p&gt;If we take this main class:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.example;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.Collections;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.HashMap;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.Map;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.script.Bindings;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.script.ScriptEngine;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.script.ScriptException;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.script.SimpleBindings;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.codehaus.groovy.ast.ClassHelper;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.codehaus.groovy.ast.ClassNode;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.codehaus.groovy.control.CompilerConfiguration;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.codehaus.groovy.control.customizers.ASTTransformationCustomizer;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.codehaus.groovy.jsr223.GroovyScriptEngineImpl;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.lang.GroovyClassLoader;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;GroovyProblemExample {

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; VAR_TYPES = &lt;span class=&quot;code-quote&quot;&gt;&quot;variable.types&quot;&lt;/span&gt;;

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ThreadLocal&amp;lt;Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;&amp;gt; COMPILE_OPTIONS = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ThreadLocal&amp;lt;&amp;gt;();

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ScriptException {
        ScriptEngine scriptEngine = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyScriptEngineImpl(createClassLoader());
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; script = &quot;&quot;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; sum = 0\n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ( i in inputArray ) {\n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;    sum += i\n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;}\n&quot;&lt;/span&gt;
                + &lt;span class=&quot;code-quote&quot;&gt;&quot;execution.setVariable(\&quot;&lt;/span&gt;sum\&lt;span class=&quot;code-quote&quot;&gt;&quot;, sum)&quot;&lt;/span&gt;;
        Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; input = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;();
        TestExecution execution = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TestExecution();

        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[] inputArray = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[] { 1, 2, 3, 4, 5 };
        input.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;inputArray&quot;&lt;/span&gt;, inputArray);
        input.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;execution&quot;&lt;/span&gt;, execution);
        Bindings bindings = createBindings(input);

        COMPILE_OPTIONS.remove();
        Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, ClassNode&amp;gt; variableTypes = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;();
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Map.Entry&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; entry : bindings.entrySet()) {
            variableTypes.put(entry.getKey(),
                    ClassHelper.make(entry.getValue().getClass()));
        }

        variableTypes.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;execution&quot;&lt;/span&gt;, ClassHelper.make(TestExecution.class));
        Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; options = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;();
        options.put(VAR_TYPES, variableTypes);
        COMPILE_OPTIONS.set(options);

        scriptEngine.eval(script, bindings);

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(execution.getVariable(&lt;span class=&quot;code-quote&quot;&gt;&quot;sum&quot;&lt;/span&gt;));
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Bindings createBindings(Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; parameters) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimpleBindings(parameters);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; GroovyClassLoader createClassLoader() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyClassLoader(GroovyProblemExample.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getClassLoader(), createStaticConfiguration(), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; CompilerConfiguration createStaticConfiguration() {
        CompilerConfiguration compilerConfiguration = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CompilerConfiguration();
        ASTTransformationCustomizer astTransformationCustomizer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ASTTransformationCustomizer(
                Collections.singletonMap(&lt;span class=&quot;code-quote&quot;&gt;&quot;extensions&quot;&lt;/span&gt;, Collections.singletonList(&lt;span class=&quot;code-quote&quot;&gt;&quot;ExampleExtension.groovy&quot;&lt;/span&gt;)),
                CompileStatic.class, &lt;span class=&quot;code-quote&quot;&gt;&quot;org.codehaus.groovy.transform.sc.StaticCompileTransformation&quot;&lt;/span&gt;);
        compilerConfiguration.addCompilationCustomizers(astTransformationCustomizer);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; compilerConfiguration;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestExecution {

        &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; data = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;();

        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setVariable(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; value) {
            data.put(name, value);
        }

        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; getVariable(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; data.get(name);
        }
    }

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and this extension:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.example.GroovyProblemExample.COMPILE_OPTIONS
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.example.GroovyProblemExample.VAR_TYPES

def typesOfVariables = COMPILE_OPTIONS.get()[VAR_TYPES]

unresolvedVariable { &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; -&amp;gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (typesOfVariables[&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;.name]) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; makeDynamic(&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;, typesOfVariables[&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;.name])
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Running the main class with Groovy 3.0.9 we have 15 printed out in the console. However, running it with 3.0.10 we get the following error:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.VerifyError: Bad type on operand stack in aaload
Exception Details:
  Location:
    Script1.run()Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;; @54: aaload
  Reason:
    Type &lt;span class=&quot;code-quote&quot;&gt;&apos;[I&apos;&lt;/span&gt; (current frame, stack[0]) is not assignable to reference type
  Current Frame:
    bci: @54
    flags: { }
    locals: { &lt;span class=&quot;code-quote&quot;&gt;&apos;Script1&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;[Lorg/codehaus/groovy/runtime/callsite/CallSite;&apos;&lt;/span&gt;, integer, top, &lt;span class=&quot;code-quote&quot;&gt;&apos;[I&apos;&lt;/span&gt;, integer, integer }
    stack: { &lt;span class=&quot;code-quote&quot;&gt;&apos;[I&apos;&lt;/span&gt;, integer }
  Bytecode:
    0000000: 00b8 0024 4c03 3d1c 5701 4e2b 1225 322a
    0000010: b900 2b02 0059 122d b800 33c0 002d 3a04
    0000020: c600 2719 04be 3605 0336 0615 0615 05a2
    0000030: 0018 1904 1506 324e 8406 011c 2db8 0039
    0000040: 6059 3d57 a7ff e72b 123a 322a b900 2b02
    0000050: 00c0 003c 123e 1cb8 0044 b600 4801 b0  
  Stackmap Table:
    full_frame(@43,{&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[#2],&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[#77],&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;,Top,&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[#45],&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;},{})
    chop_frame(@71,2)

	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.getDeclaredConstructors0(Native Method)
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.privateGetDeclaredConstructors(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:3373)
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.getConstructor0(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:3578)
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.getConstructor(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:2271)
	at org.codehaus.groovy.runtime.InvokerHelper.newScript(InvokerHelper.java:502)
	at org.codehaus.groovy.runtime.InvokerHelper.createScript(InvokerHelper.java:461)
	at org.codehaus.groovy.jsr223.GroovyScriptEngineImpl.eval(GroovyScriptEngineImpl.java:266)
	at org.codehaus.groovy.jsr223.GroovyScriptEngineImpl.eval(GroovyScriptEngineImpl.java:155)
	at java.scripting/javax.script.AbstractScriptEngine.eval(AbstractScriptEngine.java:231)
	at org.example.GroovyProblemExample.main(GroovyProblemExample.java:55)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This happens with Java 17 and Java 11. &lt;/p&gt;

&lt;p&gt;This is a simplified example that is taken from something that we have in the Flowable Engine (&lt;a href=&quot;https://github.com/flowable/flowable-engine/tree/main/modules/flowable-groovy-script-static-engine&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/flowable/flowable-engine/tree/main/modules/flowable-groovy-script-static-engine&lt;/a&gt;).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13439161">GROOVY-10579</key>
            <summary>Type &apos;[I&apos; is not assignable to reference type when using Groovy 3.0.10</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="filiphr">Filip Hrisafov</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Apr 2022 11:06:24 +0000</created>
                <updated>Sat, 23 Jul 2022 16:27:41 +0000</updated>
                            <resolved>Wed, 13 Apr 2022 17:32:36 +0000</resolved>
                                    <version>3.0.10</version>
                                    <fixVersion>2.5.17</fixVersion>
                    <fixVersion>3.0.11</fixVersion>
                    <fixVersion>4.0.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17521754" author="emilles" created="Wed, 13 Apr 2022 15:15:10 +0000"  >&lt;p&gt;It is the handling of &quot;for ( i in inputArray )&quot; that produces the error.  &quot;for ( int i in inputArray )&quot; runs fine.&lt;/p&gt;</comment>
                            <comment id="17521845" author="emilles" created="Wed, 13 Apr 2022 17:32:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/5da51e1fbe82237361ecf24eb8b085e5c82e2cdd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/5da51e1fbe82237361ecf24eb8b085e5c82e2cdd&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17522074" author="filiphr" created="Thu, 14 Apr 2022 06:07:06 +0000"  >&lt;p&gt;That was really fast. Thanks a lot for the fix and for porting it to the 3.0.x branch as well.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 30 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z11dw8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>