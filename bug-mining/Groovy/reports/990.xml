<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:12:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-3576] Verifier#getMetaClassField(ClassNode) can throw a NPE</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-3576</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;As per &lt;a href=&quot;http://markmail.org/thread/6vumwnjvs6l4jwtp&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/thread/6vumwnjvs6l4jwtp&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12816621">GROOVY-3576</key>
            <summary>Verifier#getMetaClassField(ClassNode) can throw a NPE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="paulk">Paul King</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Jun 2009 18:48:44 +0000</created>
                <updated>Tue, 7 Apr 2015 19:12:47 +0000</updated>
                            <resolved>Wed, 10 Jun 2009 18:55:07 +0000</resolved>
                                    <version>1.6.3</version>
                                    <fixVersion>1.6.4</fixVersion>
                    <fixVersion>1.7-beta-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14467059" author="andy.clement" created="Thu, 11 Jun 2009 11:51:52 +0000"  >&lt;p&gt;I hit this whilst working on integrating Eclipse JDT and the groovy compiler.  It makes a difference whether the supertype is from a .class file (like java.util.List in this case) or a user defined interface.  In this case we get the right error:&lt;/p&gt;

&lt;p&gt;&amp;#8212; A.groovy &amp;#8212;&lt;br/&gt;
class A extends I {}&lt;br/&gt;
interface I {}&lt;br/&gt;
&amp;#8212;&lt;/p&gt;

&lt;p&gt;groovyc A.groovy&lt;br/&gt;
org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed, A.groovy: 1: You are not allowed to extend the inter&lt;br/&gt;
face &apos;I&apos;, use implements instead.&lt;br/&gt;
 @ line 1, column 1.&lt;br/&gt;
   class A extends I {}&lt;br/&gt;
   ^&lt;br/&gt;
1 error&lt;/p&gt;

&lt;p&gt;But as reported by the raiser, if the interface is accessed through a .class file, there is no error, just the NPE.&lt;/p&gt;

&lt;p&gt;The reason is that the ClassNode hierarchies are set up differently in the two cases.  In the case of a user defined interface (like my I), the ClassNode for I is built specifying that the superclass of the interface I is Object through this ClassNode constructor (that doesn&apos;t feel quite right, object isnt the superclass of an interface)&lt;/p&gt;

&lt;p&gt;public ClassNode(String name, int modifiers, ClassNode superClass) &lt;/p&gt;
{
        this(name, modifiers, superClass, EMPTY_ARRAY, MixinNode.EMPTY_ARRAY);
 }

&lt;p&gt;In the case of a node created for a .class file (like java.util.List) the class is half created then subject to lazy initialization.  The lazy init code in Java5.configureClassNode():&lt;/p&gt;

&lt;p&gt;        Class sc = clazz.getSuperclass();&lt;br/&gt;
        if (sc != null) classNode.setUnresolvedSuperClass(makeClassNode(compileUnit,clazz.getGenericSuperclass(),sc));&lt;/p&gt;

&lt;p&gt;doesn&apos;t give the ClassNode for List a superclass (because clazz.getSuperclass() for an interface returns null).&lt;/p&gt;

&lt;p&gt;The ClassNode built for List can then not be handled by the code in Verifier.getMetaClassField()&lt;/p&gt;

&lt;p&gt;         ClassNode current = node;&lt;br/&gt;
       	 while (current!=null &amp;amp;&amp;amp; current!=ClassHelper.OBJECT_TYPE) &lt;/p&gt;
{
            current = current.getSuperClass();
            ret = current.getDeclaredField(&quot;metaClass&quot;);
            if (ret==null) continue;
            if (Modifier.isPrivate(ret.getModifiers())) continue;
            return ret;
        }

&lt;p&gt;because on some time through the loop, current will be List - its superclass will be grabbed - it will be null and then getDeclaredField will break with an NPE.&lt;/p&gt;

&lt;p&gt;I haven&apos;t submitted a patch to fix it because I&apos;m not sure how you&apos;d want to address it.  I think the ClassNode hierarchies ought to be the same regardless of the route taken to build them (interfaces not having a superclass).&lt;/p&gt;

&lt;p&gt;I&apos;d probably rewrite that superclass navigating method &apos;getMetaClassField&apos; so it can never dereference a null.  This variant works and produces the correct error message (no NPE):&lt;/p&gt;

&lt;p&gt; private FieldNode getMetaClassField(ClassNode node) {&lt;br/&gt;
        FieldNode ret = node.getDeclaredField(&quot;metaClass&quot;);&lt;br/&gt;
        if (ret!=null) return ret;&lt;br/&gt;
        ClassNode current = node.getSuperClass();&lt;br/&gt;
       	while (current!=null &amp;amp;&amp;amp; current!=ClassHelper.OBJECT_TYPE) &lt;/p&gt;
{
            ret = current.getDeclaredField(&quot;metaClass&quot;);
            if (ret!=null &amp;amp;&amp;amp; !Modifier.isPrivate(ret.getModifiers())) return ret;
            current = current.getSuperClass();
        }
&lt;p&gt;        return null;&lt;br/&gt;
    }&lt;/p&gt;
</comment>
                            <comment id="14467092" author="paulk" created="Thu, 11 Jun 2009 20:03:01 +0000"  >&lt;p&gt;The fix in trunk and 1_6_X branch just makes the NPE go away and gives you the same error in both cases. I didn&apos;t do any refactoring as per Andy&apos;s comments. Jochen, if you see merit in Andy&apos;s suggestion perhaps we need a different issue raised so this doesn&apos;t get lost.&lt;/p&gt;</comment>
                            <comment id="14467142" author="blackdrag" created="Fri, 12 Jun 2009 07:28:23 +0000"  >&lt;p&gt;till now, the compiler was implemented to see any class as kind of sub class of Object. If we are going to change that, then a lot of places will have to change. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 24 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cnu7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>