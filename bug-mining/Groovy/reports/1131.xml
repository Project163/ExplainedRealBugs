<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:14:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-3904] groovyc hangs if a type is declared to extend itself</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-3904</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;This code will hang groovyc 1.7beta2:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;XXX &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; XXX {
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With stack:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; at org.codehaus.groovy.ast.ClassNode.getUnresolvedSuperClass(ClassNode.java:919)
 at org.codehaus.groovy.ast.ClassNode.getSuperClass(ClassNode.java:913)
 at org.codehaus.groovy.classgen.InnerClassVisitor.getObjectDistance(InnerClassVisitor.java:517)
 at org.codehaus.groovy.classgen.InnerClassVisitor.addDispatcherMethods(InnerClassVisitor.java:378)
 at org.codehaus.groovy.classgen.InnerClassVisitor.visitClass(InnerClassVisitor.java:67)
 at org.codehaus.groovy.control.CompilationUnit$3.call(CompilationUnit.java:173)
 at org.codehaus.groovy.control.CompilationUnit.applyToPrimaryClassNodes(CompilationUnit.java:936)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;basically this method loops indefinetly InnerClassVisitor.getObjectDistance():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; getObjectDistance(ClassNode node) {
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; count = 1;
        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (node!=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; node!=ClassHelper.OBJECT_TYPE) {
            count++;
            node = node.getSuperClass();
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; count;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;whereas 1.6.5 prints:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed, cyclic inheritance involving XXX in &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;XXX
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This variant will hang 1.6.5 and 1.7b2:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;XXX &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; XXX {
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; []argv) {
    print &lt;span class=&quot;code-quote&quot;&gt;&apos;hey&apos;&lt;/span&gt;
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;it instead loops indefinetly &apos;around&apos; this location:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;at java.util.AbstractList.iterator(AbstractList.java:273)
at java.util.AbstractCollection.toArray(AbstractCollection.java:120)
at java.util.ArrayList.addAll(ArrayList.java:472)
at org.codehaus.groovy.ast.ClassNode.getMethods(ClassNode.java:807)
at org.codehaus.groovy.ast.ClassNode.hasPossibleStaticMethod(ClassNode.java:1169)
at org.codehaus.groovy.control.StaticImportVisitor.transformMethodCallExpression(StaticImportVisitor.java:189)
at org.codehaus.groovy.control.StaticImportVisitor.transform(StaticImportVisitor.java:77)
at org.codehaus.groovy.ast.ClassCodeExpressionTransformer.visitExpressionStatement(ClassCodeExpressionTransformer.java:139)
at org.codehaus.groovy.ast.stmt.ExpressionStatement.visit(ExpressionStatement.java:40)
at org.codehaus.groovy.ast.CodeVisitorSupport.visitBlockStatement(CodeVisitorSupport.java:35)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12811731">GROOVY-3904</key>
            <summary>groovyc hangs if a type is declared to extend itself</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roshandawrani">Roshan Dawrani</assignee>
                                    <reporter username="aclement">Andy Clement</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Nov 2009 13:13:55 +0000</created>
                <updated>Wed, 9 Dec 2009 18:16:40 +0000</updated>
                            <resolved>Fri, 27 Nov 2009 09:02:46 +0000</resolved>
                                    <version>1.6.5</version>
                    <version>1.7-beta-2</version>
                                    <fixVersion>1.6.6</fixVersion>
                    <fixVersion>1.7-rc-1</fixVersion>
                                    <component>Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14468309" author="roshandawrani" created="Wed, 25 Nov 2009 21:04:29 +0000"  >&lt;p&gt;Attaching 2 versions of the fix for review.&lt;/p&gt;

&lt;p&gt;Prior to inner class changes, (upto 1.6.6), although it fails with &quot;cyclic inheritence&quot; error, it goes all the way through to the class generation. I think it has enough information to fail as early as ResolveVisitor#visitClass() &lt;br/&gt;
to reject the class if both class and superclass are the same ClassNode.&lt;/p&gt;

&lt;p&gt;So,&lt;/p&gt;

&lt;p&gt;v1 of patch) Simply implements the above and fails in ResolveVisitor#visitClass() when there are cyclic inheritence&lt;/p&gt;

&lt;p&gt;v2 of patch) Removes the earlier cyclic check from CompilationUnit that used to happen after classgen phase. After it starts catching the error in &quot;resolve&quot; phase itself, this code doesn&apos;t seem needed to me.&lt;/p&gt;

&lt;p&gt;I think it&apos;s safe to go ahead with v2 but wanted to double check.&lt;/p&gt;

&lt;p&gt;All existing tests are, of-course, going through with both the patches.&lt;/p&gt;</comment>
                            <comment id="14468195" author="blackdrag" created="Thu, 26 Nov 2009 09:29:44 +0000"  >&lt;p&gt;what about class A extends B{}, class B extends A{}. I think that was the original case to check for the code in Compilation Unit. And I think the check should maybe moved to Verifier if we keep it.&lt;/p&gt;</comment>
                            <comment id="14468323" author="roshandawrani" created="Thu, 26 Nov 2009 09:33:50 +0000"  >&lt;p&gt;Is there no test for class A extends B{}, class B extends A{}, if that was the case to check for CompilationUnit code? Because nothing broke in tests when I removed it.&lt;/p&gt;

&lt;p&gt;Even if we decide to keep it in Verifier, the check in ResolveVisitor that I am introducing in the patch will still be required because the compiler going into infinite loops in the cases reported here - in one case, it is in InnerClassVisitor and in other case in StaticImportVisitor, so only having that check moved to Verifier will not help as it will be later in the compiler phases.&lt;/p&gt;</comment>
                            <comment id="14468254" author="blackdrag" created="Thu, 26 Nov 2009 09:40:55 +0000"  >&lt;p&gt;well, ok, then in ResolveVisitor... still it should check more than the direct parent&lt;/p&gt;</comment>
                            <comment id="14468098" author="roshandawrani" created="Thu, 26 Nov 2009 09:46:16 +0000"  >&lt;p&gt;Can you help provide a test that should pass for what you are suggesting? The test that CompilationUnit code was supposed to serve?&lt;/p&gt;</comment>
                            <comment id="14468310" author="roshandawrani" created="Thu, 26 Nov 2009 10:01:10 +0000"  >&lt;p&gt;Or if you know for sure that CompilationUnit code is serving some scenarios by being there, then we can let it be there and just add the change in ResolveVisitor that is getting rid of both the issues reported here. That will be the smallest change that will rid us of both the issues of this JIRA.&lt;/p&gt;

&lt;p&gt;May be later you can add a test to the codebase for that CompilationUnit code?&lt;/p&gt;</comment>
                            <comment id="14468290" author="blackdrag" created="Thu, 26 Nov 2009 11:28:40 +0000"  >&lt;p&gt;looks like my commit for rev 3691 is missing the test, even though the commit tells different.&lt;/p&gt;

&lt;p&gt;The test would be that&lt;/p&gt;

&lt;p&gt;class A extends B{}&lt;br/&gt;
class B extends A{} &lt;/p&gt;

&lt;p&gt;should not compile. And I think the check in CompilationUnit would catch that, if it had a chance.&lt;/p&gt;</comment>
                            <comment id="14468342" author="roshandawrani" created="Thu, 26 Nov 2009 11:39:58 +0000"  >&lt;p&gt;No, CompilationUnit is not getting a chance to catch that now as much before classgen, it is going into infinite loop in InnerClassVisitor (semantic analysis) itself (same as 1st case above)&lt;/p&gt;

&lt;p&gt;Which means that this case has stopped working since InnerClassVisitor was introduced.&lt;/p&gt;

&lt;p&gt;It also means that that code in CompilationUnit has lost its usefulness now - and it must be moved to some place before it reaches InnerClassVisitor/StaticImportVisitor logic where it is going into infinite loops making compiler hang.&lt;/p&gt;</comment>
                            <comment id="14468227" author="blackdrag" created="Thu, 26 Nov 2009 11:45:54 +0000"  >&lt;p&gt;&quot;if it had a chance&quot;, bad thing it is not having one. Now I know I introduced that because of the sorting that happens there and because that was causing an infinite loop without the test too. So I guess moving the check to ResolveVisitor might be a good idea.. just your initial check seems not to be enough to me.&lt;/p&gt;</comment>
                            <comment id="14468196" author="roshandawrani" created="Thu, 26 Nov 2009 11:50:33 +0000"  >&lt;p&gt;The logic I currently have in the patch is just in line with the issues reported in this JIRA. If this other A-&amp;gt;B, B-&amp;gt;A test had existed, then the current changes to ResolveVisitor would not have sufficed and I would have looked for other ways (probably bringing the CompilationUnit logic into ResolveVisitor)&lt;/p&gt;

&lt;p&gt;Anyway, I will give that a try and consult you if I have any questions on that. Thanks.&lt;/p&gt;</comment>
                            <comment id="14468344" author="roshandawrani" created="Fri, 27 Nov 2009 09:02:46 +0000"  >&lt;p&gt;Fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722130" name="3904_v17x_v1.txt" size="2298" author="roshandawrani" created="Wed, 25 Nov 2009 21:04:29 +0000"/>
                            <attachment id="12722483" name="3904_v17x_v2.txt" size="3806" author="roshandawrani" created="Wed, 25 Nov 2009 21:04:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bo1j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>