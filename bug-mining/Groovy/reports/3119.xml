<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:53:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-7926] Method that returns void in a Trait with generics produces questionable byte code</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-7926</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Given the following trait:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;trait MyTrait&amp;lt;D&amp;gt; {
    void delete() {
        &lt;span class=&quot;code-comment&quot;&gt;// no-op
&lt;/span&gt;    }
}
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyImpl &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; MyTrait&amp;lt;MyImpl&amp;gt; {
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The delete method produces byte code that when decompiled looks like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void delete() {
        CallSite[] var1 = $getCallSiteArray();
        void var10000 = (void)var1[1].call(Helper.class, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see &quot;void&quot; is used as a type of a variable. This results in the following exception on the IBM JVM (it works fine in Oracle and OpenJDK):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Caused by: java.lang.NoClassDefFoundError: void
	at it.dedagroup.Test.delete(Test.groovy)
	at org.grails.datastore.gorm.GormEntity$delete$0.call(Unknown Source)
	at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCall(CallSiteArray.java:48)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since the issue occurs only in IBM JVM it could be argued that this is a problem with that JVM, however the byte code produced does seem suspicious to me as &quot;void&quot; cannot be used as a type of a local variable. Thoughts?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13002329">GROOVY-7926</key>
            <summary>Method that returns void in a Trait with generics produces questionable byte code</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="graemerocher1">Graeme Rocher</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Sep 2016 11:32:59 +0000</created>
                <updated>Wed, 1 Feb 2017 23:19:01 +0000</updated>
                            <resolved>Sun, 11 Sep 2016 22:35:32 +0000</resolved>
                                    <version>2.4.7</version>
                                    <fixVersion>2.4.8</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15473446" author="githubbot" created="Thu, 8 Sep 2016 10:03:25 +0000"  >&lt;p&gt;GitHub user graemerocher opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/416&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7926&quot; title=&quot;Method that returns void in a Trait with generics produces questionable byte code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7926&quot;&gt;&lt;del&gt;GROOVY-7926&lt;/del&gt;&lt;/a&gt; - Don&apos;t use a CastExpression if the return type is void.&lt;/p&gt;

&lt;p&gt;    As per &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7926&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/GROOVY-7926&lt;/a&gt; traits currently try to cast the void type which leads to mysterious exceptions on some JVMs (notably JRocket and the IBM JVM)&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/graemerocher/incubator-groovy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/graemerocher/incubator-groovy&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7926&quot; title=&quot;Method that returns void in a Trait with generics produces questionable byte code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7926&quot;&gt;&lt;del&gt;GROOVY-7926&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/416.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/416.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #416&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 42f014e4ffadf3aea39e07031f7cf8a7f9babe73&lt;br/&gt;
Author: Graeme Rocher &amp;lt;graeme.rocher@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-09-08T10:00:08Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7926&quot; title=&quot;Method that returns void in a Trait with generics produces questionable byte code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7926&quot;&gt;&lt;del&gt;GROOVY-7926&lt;/del&gt;&lt;/a&gt; - Don&apos;t use a CastExpression if the return type is void.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15473449" author="graemerocher1" created="Thu, 8 Sep 2016 10:03:48 +0000"  >&lt;p&gt;I have submitted a pull request for this issue &lt;a href=&quot;https://github.com/apache/groovy/pull/416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/416&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15477391" author="githubbot" created="Fri, 9 Sep 2016 15:52:36 +0000"  >&lt;p&gt;Github user jwagenleitner commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/416#discussion_r78203740&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/416#discussion_r78203740&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/test/org/codehaus/groovy/transform/traitx/Groovy7926Bug.groovy &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,50 @@&lt;br/&gt;
    +package org.codehaus.groovy.transform.traitx&lt;br/&gt;
    +&lt;br/&gt;
    +import org.codehaus.groovy.classgen.asm.AbstractBytecodeTestCase&lt;br/&gt;
    +import org.codehaus.groovy.classgen.asm.InstructionSequence&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Created by graemerocher on 08/09/2016.&lt;br/&gt;
    + */&lt;br/&gt;
    +class Groovy7926Bug extends AbstractBytecodeTestCase {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Would probably be good to remove the class doc and add the license header.&lt;/p&gt;</comment>
                            <comment id="15477398" author="githubbot" created="Fri, 9 Sep 2016 15:54:48 +0000"  >&lt;p&gt;Github user jwagenleitner commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/416#discussion_r78204083&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/416#discussion_r78204083&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/main/org/codehaus/groovy/transform/trait/TraitComposer.java &amp;#8212;&lt;br/&gt;
    @@ -293,7 +293,8 @@ private static void createForwarderMethod(&lt;/p&gt;

&lt;p&gt;             ClassNode[] exceptionNodes = correctToGenericsSpecRecurse(genericsSpec, copyExceptions(helperMethod.getExceptions()));&lt;br/&gt;
             ClassNode fixedReturnType = correctToGenericsSpecRecurse(genericsSpec, helperMethod.getReturnType());&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Expression forwardExpression = genericsSpec.isEmpty()?mce:new CastExpression(fixedReturnType,mce);&lt;br/&gt;
    +        boolean noCastRequired = genericsSpec.isEmpty() || fixedReturnType.getName().equals(ClassHelper.VOID_TYPE.getName());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Just curious if you saw problems using just `fixedReturnType.equals(ClassHelper.VOID_TYPE)` that neccessitated comparing by name?  Most places that I see that compare types don&apos;t see to use the getName so am just curious.&lt;/p&gt;</comment>
                            <comment id="15477650" author="githubbot" created="Fri, 9 Sep 2016 17:24:58 +0000"  >&lt;p&gt;Github user graemerocher commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/416#discussion_r78217077&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/416#discussion_r78217077&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/main/org/codehaus/groovy/transform/trait/TraitComposer.java &amp;#8212;&lt;br/&gt;
    @@ -293,7 +293,8 @@ private static void createForwarderMethod(&lt;/p&gt;

&lt;p&gt;             ClassNode[] exceptionNodes = correctToGenericsSpecRecurse(genericsSpec, copyExceptions(helperMethod.getExceptions()));&lt;br/&gt;
             ClassNode fixedReturnType = correctToGenericsSpecRecurse(genericsSpec, helperMethod.getReturnType());&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Expression forwardExpression = genericsSpec.isEmpty()?mce:new CastExpression(fixedReturnType,mce);&lt;br/&gt;
    +        boolean noCastRequired = genericsSpec.isEmpty() || fixedReturnType.getName().equals(ClassHelper.VOID_TYPE.getName());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Just seemed more efficient. ClassNode.equals does this:&lt;/p&gt;

&lt;p&gt;    ```groovy&lt;br/&gt;
        public boolean equals(Object o) &lt;/p&gt;
{
            if (redirect!=null) return redirect().equals(o);
            if (!(o instanceof ClassNode)) return false;
            ClassNode cn = (ClassNode) o;
            return (cn.getText().equals(getText()));
        }
&lt;p&gt;    ```&lt;/p&gt;

&lt;p&gt;    The `getText()` method calls `getName()` anyway&lt;/p&gt;</comment>
                            <comment id="15477920" author="githubbot" created="Fri, 9 Sep 2016 18:37:40 +0000"  >&lt;p&gt;Github user jwagenleitner commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/416#discussion_r78228482&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/416#discussion_r78228482&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/main/org/codehaus/groovy/transform/trait/TraitComposer.java &amp;#8212;&lt;br/&gt;
    @@ -293,7 +293,8 @@ private static void createForwarderMethod(&lt;/p&gt;

&lt;p&gt;             ClassNode[] exceptionNodes = correctToGenericsSpecRecurse(genericsSpec, copyExceptions(helperMethod.getExceptions()));&lt;br/&gt;
             ClassNode fixedReturnType = correctToGenericsSpecRecurse(genericsSpec, helperMethod.getReturnType());&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Expression forwardExpression = genericsSpec.isEmpty()?mce:new CastExpression(fixedReturnType,mce);&lt;br/&gt;
    +        boolean noCastRequired = genericsSpec.isEmpty() || fixedReturnType.getName().equals(ClassHelper.VOID_TYPE.getName());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Thanks for the explanation.&lt;/p&gt;</comment>
                            <comment id="15482502" author="githubbot" created="Sun, 11 Sep 2016 22:21:46 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/416&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15482520" author="paulk" created="Sun, 11 Sep 2016 22:35:33 +0000"  >&lt;p&gt;PR merged. Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i336jj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>