<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:56:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-8377] hashCode() generated by @EqualsAndHashCode is inefficient for instances with null fields or properties</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-8377</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;In a project I work on there is a relatively large hash map for which the key type has a &lt;tt&gt;@EqualsAndHashCode&lt;/tt&gt; generated &lt;tt&gt;hashCode()&lt;/tt&gt;. After introducing an additional property to the key type, for which the value is &lt;tt&gt;null&lt;/tt&gt; on most instances, I noticed a massive degradation in efficiency of adds to the aforementioned map.&lt;/p&gt;

&lt;p&gt;After some digging around it turns out that the AST generated by that transform performs an identity check using &lt;tt&gt;is()&lt;/tt&gt; between the property/field value and &lt;tt&gt;this&lt;/tt&gt;. In cases where the property/field value is &lt;tt&gt;null&lt;/tt&gt; this leads to a &lt;tt&gt;NullObject.is()&lt;/tt&gt; call, for which, as far as I understand, no call site caching occurs.&lt;/p&gt;

&lt;p&gt;A PR with a jmh benchmark and a very simple fix to follow.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13117779">GROOVY-8377</key>
            <summary>hashCode() generated by @EqualsAndHashCode is inefficient for instances with null fields or properties</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="erdi">Marcin Erdmann</reporter>
                        <labels>
                            <label>performance</label>
                    </labels>
                <created>Sun, 12 Nov 2017 10:44:39 +0000</created>
                <updated>Sat, 25 Nov 2017 13:31:18 +0000</updated>
                            <resolved>Sat, 25 Nov 2017 12:45:04 +0000</resolved>
                                    <version>2.4.12</version>
                    <version>2.5.0-beta-2</version>
                    <version>2.6.0-alpha-2</version>
                                    <fixVersion>3.0.0-alpha-1</fixVersion>
                    <fixVersion>2.6.0-alpha-3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16248826" author="githubbot" created="Sun, 12 Nov 2017 10:56:01 +0000"  >&lt;p&gt;GitHub user erdi opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/633&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/633&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8377&quot; title=&quot;hashCode() generated by @EqualsAndHashCode is inefficient for instances with null fields or properties&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8377&quot;&gt;&lt;del&gt;GROOVY-8377&lt;/del&gt;&lt;/a&gt; Equals and hash code ast performance&lt;/p&gt;

&lt;p&gt;    See &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8377&quot; title=&quot;hashCode() generated by @EqualsAndHashCode is inefficient for instances with null fields or properties&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8377&quot;&gt;&lt;del&gt;GROOVY-8377&lt;/del&gt;&lt;/a&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8377&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/GROOVY-8377&lt;/a&gt;) for the rationale behind this PR.&lt;/p&gt;

&lt;p&gt;    Given how simple the fix is and its impact (from 3k ops/ms to 30k ops/ms on my machine) I&apos;d suggest considering backporting of it to 2.4.x, 2.5.x and 2.6.x lines.&lt;/p&gt;

&lt;p&gt;    &amp;lt;rant&amp;gt;&lt;br/&gt;
    Working on this was harder then it should be down to:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the build takes a minute&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/warning.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; to configure, I believe it is down to &lt;span class=&quot;error&quot;&gt;&amp;#91;this code&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/groovy/blob/1c42f421edd91f31aa35a3e7b7113910718b35d5/build.gradle#L93&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/blob/1c42f421edd91f31aa35a3e7b7113910718b35d5/build.gradle#L93&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;the jmh benchmarks for Groovy code are broken and &lt;span class=&quot;error&quot;&gt;&amp;#91;needed fixing as part of my PR&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/erdi/groovy/commit/fc1d085a120bd7a542edeb7c1ff4b06816b776b2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/erdi/groovy/commit/fc1d085a120bd7a542edeb7c1ff4b06816b776b2&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I understand that I worked against master, but the experience was highly unwelcoming.&lt;br/&gt;
    &amp;lt;/rant&amp;gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/erdi/groovy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/erdi/groovy&lt;/a&gt; equals-and-hash-code-ast-performance&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/633.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/633.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #633&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit fc1d085a120bd7a542edeb7c1ff4b06816b776b2&lt;br/&gt;
Author: Marcin Erdmann &amp;lt;erdi84@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-11-12T10:23:26Z&lt;/p&gt;

&lt;p&gt;    Fix Groovy dependency in performance tests to be the same as the one used by Gradle so that jmh benchmarks using Groovy don&apos;t fail&lt;/p&gt;

&lt;p&gt;commit 3c6d1d462569259aad6ef95b73af4c17837595b0&lt;br/&gt;
Author: Marcin Erdmann &amp;lt;erdi84@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-11-12T10:25:03Z&lt;/p&gt;

&lt;p&gt;    Add a benchmark for hashCode() generated using @EqualsAndHashCode when instance on which hashCode() is called has null fields and properties&lt;/p&gt;

&lt;p&gt;commit 2ce280083e30d912829d010592384c72b5b406cf&lt;br/&gt;
Author: Marcin Erdmann &amp;lt;erdi84@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-11-12T10:26:39Z&lt;/p&gt;

&lt;p&gt;    Add a test to verify that changes to generating hashCode() for instances with null fields and properties and EqualsAndHashCodeASTTransformation have no impact on the value returned&lt;/p&gt;

&lt;p&gt;commit bd2b79c2cf67b99020265dca2465e18b2a40b2c8&lt;br/&gt;
Author: Marcin Erdmann &amp;lt;erdi84@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-11-12T10:29:41Z&lt;/p&gt;

&lt;p&gt;    Improve performance of generated hashCode() methods for instances with null fields and properties by avoiding calling NullObject.is() method for which no call site caching occurs.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16248827" author="erdi" created="Sun, 12 Nov 2017 10:57:19 +0000"  >&lt;p&gt;PR: &lt;a href=&quot;https://github.com/apache/groovy/pull/633&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/633&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16256828" author="githubbot" created="Fri, 17 Nov 2017 10:50:45 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/633&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/633&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16256939" author="paulk" created="Fri, 17 Nov 2017 13:06:07 +0000"  >&lt;p&gt;See my comment on the PR. I won&apos;t close just yet to give us time to ponder whether further backporting is needed.&lt;/p&gt;</comment>
                            <comment id="16265702" author="daniel_sun" created="Sat, 25 Nov 2017 12:45:05 +0000"  >&lt;p&gt;It is fixed in 3.0.0, so I will close it to release 3.0.0-alpha-1. Feel free to reopen when further backporting is needed.&lt;/p&gt;</comment>
                            <comment id="16265705" author="melix" created="Sat, 25 Nov 2017 12:47:33 +0000"  >&lt;p&gt;Can we backport to 2.5? It&apos;s kind of weird to have it in 3.0, when 2.5 is not even out.&lt;/p&gt;</comment>
                            <comment id="16265715" author="paulk" created="Sat, 25 Nov 2017 13:31:18 +0000"  >&lt;p&gt;It gets hard keeping track if we re-open issues, so I cloned the issue instead.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="13120724">GROOVY-8391</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 51 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mohj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>