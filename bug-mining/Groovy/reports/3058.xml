<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:51:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-7150] Redirection of output in javax.script.ScriptEngine.invokeFunction() doesn&apos;t work</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-7150</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The Java code below should return a string &quot;Hello World!&quot;. Instead of that it returns an empty string and prints &quot;Hello World!&quot; in the console the application runs. The problem exists only inside functions; texts printed outside functions are redirected properly:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;javax.script.ScriptEngineManager manager = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ScriptEngineManager();
javax.script.ScriptEngine engine = manager.getEngineByName(&lt;span class=&quot;code-quote&quot;&gt;&quot;groovy&quot;&lt;/span&gt;);
StringWriter stdOut = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringWriter();
engine.getContext().setWriter(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PrintWriter(stdOut));
engine.eval(&lt;span class=&quot;code-quote&quot;&gt;&quot;def myFunction() { print(&quot;&lt;/span&gt;Hello World!&lt;span class=&quot;code-quote&quot;&gt;&quot;); }&quot;&lt;/span&gt;);
Invocable invoker = (Invocable) engine;
invoker.invokeFunction(&lt;span class=&quot;code-quote&quot;&gt;&quot;myFunction&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[0]);
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; stdOut.getBuffer().toString();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>Java, Windows, Linux</environment>
        <key id="12817847">GROOVY-7150</key>
            <summary>Redirection of output in javax.script.ScriptEngine.invokeFunction() doesn&apos;t work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jwagenleitner">John Wagenleitner</assignee>
                                    <reporter username="shaule">Shaul Eliyahu</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Nov 2014 10:53:39 +0000</created>
                <updated>Wed, 1 Feb 2017 23:19:05 +0000</updated>
                            <resolved>Wed, 29 Jun 2016 00:11:14 +0000</resolved>
                                    <version>2.3.6</version>
                                    <fixVersion>2.4.8</fixVersion>
                                    <component>groovy-jdk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15076192" author="jwagenleitner" created="Fri, 1 Jan 2016 00:02:17 +0000"  >&lt;p&gt;added code tags&lt;/p&gt;</comment>
                            <comment id="15076376" author="githubbot" created="Fri, 1 Jan 2016 21:31:07 +0000"  >&lt;p&gt;GitHub user jwagenleitner opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/230&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/230&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7150&quot; title=&quot;Redirection of output in javax.script.ScriptEngine.invokeFunction() doesn&amp;#39;t work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7150&quot;&gt;&lt;del&gt;GROOVY-7150&lt;/del&gt;&lt;/a&gt; - Redirection of output in javax.script.ScriptEngine.invokeFunction() doesn&apos;t work&lt;/p&gt;

&lt;p&gt;    Instead of adding `context` and `out` to the engine context this change provides access to those in the `groovy.lang.Binding` to the script class.  This should allow a user to provide their own variables if they wish to override the behavior.  The problem was caused because the `out` variable was being removed from the context (for cleanup reasons), so the cached `MethodClosure` no longer had access to it since it was executed in another method after the `eval` call.&lt;/p&gt;

&lt;p&gt;    I also added another commit to ensure the factory returned by the engine is the same factory that created it.  I couldn&apos;t see a reason why each engine instance should return a new factory.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jwagenleitner/groovy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jwagenleitner/groovy&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7150&quot; title=&quot;Redirection of output in javax.script.ScriptEngine.invokeFunction() doesn&amp;#39;t work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7150&quot;&gt;&lt;del&gt;GROOVY-7150&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/230.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/230.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #230&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit b40cdf3f86b23b6ce4765676f41e73f01d79a78b&lt;br/&gt;
Author: John Wagenleitner &amp;lt;jwagenleitner@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-01-01T20:25:37Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7150&quot; title=&quot;Redirection of output in javax.script.ScriptEngine.invokeFunction() doesn&amp;#39;t work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7150&quot;&gt;&lt;del&gt;GROOVY-7150&lt;/del&gt;&lt;/a&gt; - Redirection of output in javax.script.ScriptEngine.invokeFunction() doesn&apos;t work&lt;/p&gt;

&lt;p&gt;commit 3515a0f5384a4abfce6811911ca0aff01bfa80e3&lt;br/&gt;
Author: John Wagenleitner &amp;lt;jwagenleitner@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-01-01T21:15:03Z&lt;/p&gt;

&lt;p&gt;    ScriptEngineFactory returned from ScriptEngine should be same factory that created engine&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15076379" author="githubbot" created="Fri, 1 Jan 2016 22:13:00 +0000"  >&lt;p&gt;Github user jwagenleitner commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/230#discussion_r48680741&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/230#discussion_r48680741&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: subprojects/groovy-jsr223/src/main/java/org/codehaus/groovy/jsr223/GroovyScriptEngineImpl.java &amp;#8212;&lt;br/&gt;
    @@ -275,6 +238,19 @@ public Object getVariable(String name) {&lt;br/&gt;
                         if (scope != -1) &lt;/p&gt;
{
                             return ctx.getAttribute(name, scope);
                         }
&lt;p&gt;    +                    // Redirect script output to context writer, if out var is not already provided&lt;br/&gt;
    +                    if (&quot;out&quot;.equals(name)) {&lt;br/&gt;
    +                        Writer writer = ctx.getWriter();&lt;br/&gt;
    +                        if (writer != null) {&lt;br/&gt;
    +                            return (writer instanceof PrintWriter) ?&lt;br/&gt;
    +                                    (PrintWriter) writer :&lt;br/&gt;
    +                                    new PrintWriter(writer, true);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This could potentially create lots of temporary `PrintWriter` objects if `ctx.getWriter()` returns a different type.  But the alternative of caching the writer may mean keeping a reference to it longer than necessary.&lt;/p&gt;</comment>
                            <comment id="15353960" author="githubbot" created="Wed, 29 Jun 2016 00:07:12 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/230&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/230&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15353964" author="jwagenleitner" created="Wed, 29 Jun 2016 00:11:14 +0000"  >&lt;p&gt;Thanks for reporting the issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 21 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cpwn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>