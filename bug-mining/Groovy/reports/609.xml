<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:03:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-2462] GroovyClassLoader does not parse files saved in utf-8</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-2462</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The following code &lt;/p&gt;

&lt;p&gt;CompilerConfiguration config = new CompilerConfiguration();&lt;br/&gt;
        config.setSourceEncoding(&quot;UTF-8&quot;);&lt;br/&gt;
        gcl = new GroovyClassLoader(Thread.currentThread().getContextClassLoader(), config);&lt;br/&gt;
        gcl.parseClass(afile);&lt;/p&gt;

&lt;p&gt;causes the following error:&lt;br/&gt;
 1: Invalid variable name. Must start with a letter but was: ?survivantManager.&lt;br/&gt;
Node: org.codehaus.groovy.ast.expr.VariableExpression. At &lt;span class=&quot;error&quot;&gt;&amp;#91;1:1&amp;#93;&lt;/span&gt;  @ line 1, column 1.&lt;br/&gt;
   ?survivantManager...&lt;/p&gt;

&lt;p&gt;The file has been saved as utf-8 and tested with various programs to confirm that it is presented correctly, and that there  is no hidden character (the  one appearing as a ?) in the beginning of the file.&lt;/p&gt;

&lt;p&gt;Any suggestions? Or is  it indeed a bug?&lt;/p&gt;

&lt;p&gt;Thanks for the help in advance!&lt;/p&gt;</description>
                <environment>Vista, maven project built with &amp;lt;encoding&amp;gt;utf-8&amp;lt;/encoding&amp;gt;</environment>
        <key id="12813979">GROOVY-2462</key>
            <summary>GroovyClassLoader does not parse files saved in utf-8</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="tec-goblin">Nicolas KP</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Jan 2008 07:53:27 +0000</created>
                <updated>Mon, 10 Mar 2008 10:02:59 +0000</updated>
                            <resolved>Mon, 10 Mar 2008 09:47:55 +0000</resolved>
                                    <version>1.1-rc-1</version>
                                    <fixVersion>1.5.5</fixVersion>
                                    <component>class generator</component>
                    <component>parser</component>
                    <component>XML Processing</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14464042" author="guillaume" created="Wed, 2 Jan 2008 08:13:53 +0000"  >&lt;p&gt;With what editor / IDE have you edited your file?&lt;br/&gt;
Does your file have a BOM (Byte Order Mark) at the beginning of the file? (check with an hex viewer of some sort)&lt;/p&gt;</comment>
                            <comment id="14464088" author="tec-goblin" created="Wed, 2 Jan 2008 09:24:45 +0000"  >&lt;p&gt;Notepad, and notepad++. Unfortunately there was indeed a BOM (we saw it with HHD Free Hex Editor).&lt;br/&gt;
It was this problem indeed.&lt;br/&gt;
Wouldn&apos;t it be  nice if Groovy knew when to ignore BOM?&lt;br/&gt;
Do you suggest us a particular editor to avoid this problem?&lt;/p&gt;</comment>
                            <comment id="14464091" author="guillaume" created="Wed, 2 Jan 2008 10:15:34 +0000"  >&lt;p&gt;There&apos;s a couple dedicated classes in Groovy which could/should be used to do this.&lt;br/&gt;
In the past, they were used, but it seems it&apos;s not the case anymore.&lt;br/&gt;
Regarding your last question, if you use an IDE like IntelliJ IDEA or Eclipse (and their respective Groovy plugins), you should be safe.&lt;br/&gt;
I think it&apos;s only Windows basic text editors which do add the BOM automatically.&lt;br/&gt;
Anyway, we&apos;ll have to investigate this issue, as I think we could leverage the CharsetToolkit class present in Groovy to properly skip those BOM bytes.&lt;/p&gt;</comment>
                            <comment id="14464070" author="tec-goblin" created="Wed, 2 Jan 2008 12:25:45 +0000"  >&lt;p&gt;The problem has a workaround (using an IDE or tool that does not add BOM characters), but it could also be properly resolved.&lt;/p&gt;</comment>
                            <comment id="14464140" author="tec-goblin" created="Fri, 18 Jan 2008 10:23:42 +0000"  >&lt;p&gt;While we managed to avoide BOF problems, we still have problems with unicode characters. &lt;br/&gt;
When doing the following (this is slightly simplified):&lt;/p&gt;

&lt;p&gt;public void init() &lt;/p&gt;
{
        CompilerConfiguration config = new CompilerConfiguration();
        config.setSourceEncoding(&quot;UTF-8&quot;);
        gcl = new GroovyClassLoader(Thread.currentThread().getContextClassLoader(), config);
    }

&lt;p&gt;    public Class parse(final String codeScript) {&lt;br/&gt;
        Class clazz = gcl.parseClass(codeScript);&lt;br/&gt;
         return clazz;    &lt;br/&gt;
}&lt;br/&gt;
greek and chinese characters in codeScript appear properly in the debugger, but the messages (included in the groovy scripts) on the page show &apos;?&apos;s. Everything else presented on the page is properly presented (including utf-8 coming from the database, in the page, or coming from files), so it&apos;s not a problem in the presentation layer, but a problem specifically involving Groovy parsing.&lt;/p&gt;
</comment>
                            <comment id="14464173" author="tec-goblin" created="Mon, 21 Jan 2008 10:57:31 +0000"  >&lt;p&gt;We tested it under 1.5.1 too and the problem persists. This is seriously blocking, as we try to build a multilanguage version of the application...&lt;/p&gt;

&lt;p&gt;I have the impression that the sourceEncoding parameter of the config is not taken into account by GroovyClassLoader, but I might be mistaken (the source code of GroovyClassLoader doesn&apos;t explicitely take into account the parameter, but some called object might).&lt;/p&gt;</comment>
                            <comment id="14464190" author="blackdrag" created="Thu, 31 Jan 2008 13:19:58 +0000"  >&lt;p&gt;I added code that will respect the BOM and I changed the classloader to respect the encoding given in the config for strings.&lt;/p&gt;</comment>
                            <comment id="14464290" author="tec-goblin" created="Wed, 20 Feb 2008 04:59:11 +0000"  >&lt;p&gt;Thank you for correcting the BOM issue.&lt;br/&gt;
Unfortunately, the classloader unicode issue is not fixed. &lt;br/&gt;
We had a termporary solution in place (converting utf-8 string to iso before passing them to groovy) but it wasn&apos;t working in all environnements and for all characters, so I switched to groovy 1.5.4 to use the corrected loader. Unfortunately, the problem persists (with a twist):&lt;br/&gt;
if I set  config.setSourceEncoding(&quot;UTF-16&quot;); the script (correctly) does not compile, so it is clear that now the source encoding is indeed taken into account&lt;br/&gt;
Unfortunately, the problems with non-ascii characters persists (you can test the following: &#233;&amp;#20013;&amp;#949; - copy paste from wikipedia)&lt;/p&gt;

&lt;p&gt;I tried to see if it&apos;s a problem in string creation by groovy (instead of compilation), but the following correctly shows the chinese &amp;#20013; character&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] e  =  [-26,-106,-121]
tata = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;  &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;(e, &lt;span class=&quot;code-quote&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; messageFactory.createInformationMessage(tata);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So it&apos;s still a parsing problem.&lt;/p&gt;

&lt;p&gt;Thanks for the effort - it is extremely important for us.&lt;/p&gt;

&lt;p&gt;PS: I did extremely detailed tests to verify that the correct bytecodes are passed to groovy and that there is no problem elsewhere.&lt;/p&gt;</comment>
                            <comment id="14464278" author="tec-goblin" created="Thu, 21 Feb 2008 09:47:29 +0000"  >&lt;p&gt;I don&apos;t understand at all. We tried again and now it works. If it stays  like this for this week, I&apos;ll close the issue. &lt;/p&gt;</comment>
                            <comment id="14464333" author="blackdrag" created="Mon, 10 Mar 2008 09:43:56 +0000"  >&lt;p&gt;I updated the release version to 1.5.5... can we close this bug? &lt;/p&gt;</comment>
                            <comment id="14464345" author="tec-goblin" created="Mon, 10 Mar 2008 09:47:55 +0000"  >&lt;p&gt;Yes it&apos;s resolved indeed. No problems have been encountered.&lt;br/&gt;
Sorry for the delay, but I changed company so I am not any more in the project and thus I forgot the issue!&lt;/p&gt;</comment>
                            <comment id="14464357" author="blackdrag" created="Mon, 10 Mar 2008 10:02:59 +0000"  >&lt;p&gt;no problem...&lt;/p&gt;

&lt;p&gt;I am closing this bug now&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 38 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cmkv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>