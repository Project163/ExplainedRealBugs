<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:16:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-10391] Default interface methods causing problems with java 17 and groovy 3.0.9</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-10391</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I&apos;m trying to migrate a project to build on JDK17 and in that project we use groovy and spock for testing. It seems that groovy 3.* has a problem with reflection access to JDK especially visible when using closures&lt;br/&gt;
A simple test class:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
    def predicate = {&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;} as java.util.function.Predicate
    predicate.negate()
    println &lt;span class=&quot;code-quote&quot;&gt;&quot;i don&apos;t work!! :(&quot;&lt;/span&gt;
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Produces&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.IllegalAccessException: module jdk.proxy1 does not open jdk.proxy1 to unnamed module @43517800&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In line&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
predicate.negate() &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;.negate() being a default method in a Predicate interface which a part of the jdk&lt;/p&gt;

&lt;p&gt;The following however works:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
    def predicate = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Predicate() {
        @Override
        &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; test(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; o) {
            &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
        }
    }
    predicate.negate()
    println &lt;span class=&quot;code-quote&quot;&gt;&quot;i work!! :)&quot;&lt;/span&gt;
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&apos;m using JDK 17.0.1 Corretto for my tests and the example minimal project can be found here:&lt;br/&gt;
&lt;a href=&quot;https://github.com/lukaszpierog/jdk17-groovy3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/lukaszpierog/jdk17-groovy3&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The above code works with groovy 4.0.0-beta-2. Spock does not support groovy 4 at this moment, so upgrading groovy to 4 isn&apos;t an option for me and it seems to only be a beta release at the moment.&lt;/p&gt;

&lt;p&gt;I&apos;ve tried adding jvm args&#160;&lt;/p&gt;

&lt;p&gt;--add-opens=java.base/java.lang.invoke=ALL-UNNAMED&lt;br/&gt;
however that does not seem to affect the output&lt;/p&gt;

&lt;p&gt;Please advise&lt;/p&gt;</description>
                <environment></environment>
        <key id="13413855">GROOVY-10391</key>
            <summary>Default interface methods causing problems with java 17 and groovy 3.0.9</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="lukaszpierog">&#321;ukasz Pier&#243;g</reporter>
                        <labels>
                            <label>jdk16</label>
                    </labels>
                <created>Thu, 25 Nov 2021 12:52:45 +0000</created>
                <updated>Sat, 22 Jul 2023 13:34:48 +0000</updated>
                            <resolved>Thu, 16 Dec 2021 14:16:40 +0000</resolved>
                                    <version>3.0.9</version>
                                    <fixVersion>4.0.0-beta-1</fixVersion>
                    <fixVersion>3.0.16</fixVersion>
                                    <component>groovy-runtime</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17453424" author="emilles" created="Sat, 4 Dec 2021 15:17:30 +0000"  >&lt;p&gt;To handle the &quot;negate()&quot; call, Groovy runtime is running through this in &lt;tt&gt;org.codehaus.groovy.vmplugin.v9.Java9&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; getInvokeSpecialHandle(Method method, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; receiver) {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; receiverType = receiver.getClass();
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; of(receiverType).unreflectSpecial(method, receiverType).bindTo(receiver);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (ReflectiveOperationException e) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.getInvokeSpecialHandle(method, receiver);
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;tt&gt;receiver&lt;/tt&gt; is an instance of &quot;script$_run_closure1@3d5c822d&quot; which is the result of your closure coercion.  &lt;tt&gt;receiverType&lt;/tt&gt; is &lt;tt&gt;jdk.proxy1.$Proxy5&lt;/tt&gt; and this is where the access check is reporting that &quot;jdk.proxy1&quot; is not available to the unnamed module.&lt;/p&gt;

&lt;p&gt;In this case of calling an interface default method, it may be possible to choose a different receiver class using the method&apos;s declaring class.  I also have to see how Groovy 4 is handling the situation.&lt;/p&gt;</comment>
                            <comment id="17453426" author="emilles" created="Sat, 4 Dec 2021 15:25:23 +0000"  >&lt;p&gt;This is what Groovy 4 did in its Java16 vmplugin:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
    public &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; getInvokeSpecialHandle(final Method method, final &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; receiver) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            final &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; receiverType = receiver.getClass();
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (method.isDefault() &amp;amp;&amp;amp; Proxy.isProxyClass(receiverType)) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ProxyDefaultMethodHandle((Proxy) receiver, method);
            }

            MethodHandles.Lookup lookup = getLookup(receiver);
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (0 != (MethodHandles.Lookup.PRIVATE &amp;amp; lookup.lookupModes())) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; lookup.unreflectSpecial(method, receiverType).bindTo(receiver);
            }
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; lookup.unreflect(method).bindTo(receiver);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (ReflectiveOperationException e) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyRuntimeException(e);
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17453437" author="emilles" created="Sat, 4 Dec 2021 15:56:44 +0000"  >&lt;p&gt;See also &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7104&quot; title=&quot;Default methods on closures coerced to interfaces don&amp;#39;t work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7104&quot;&gt;&lt;del&gt;GROOVY-7104&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17459701" author="JIRAUSER280791" created="Wed, 15 Dec 2021 07:19:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt;&#160;&lt;br/&gt;
Is there a way to use groovy 3 with Java16 (or 17?) vmplugin when running on JDK17?&lt;br/&gt;
Is there any workaround to get groovy 3 to work with java 17? This seems like a pretty common use case&lt;/p&gt;</comment>
                            <comment id="17459966" author="emilles" created="Wed, 15 Dec 2021 14:07:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lukaszpierog&quot; class=&quot;user-hover&quot; rel=&quot;lukaszpierog&quot;&gt;lukaszpierog&lt;/a&gt; Groovy 3 will run under Java 16 or 17.  There are some specific scenarios such as interface default methods or dynamic proxies that may not work.  Groovy 4 addresses many of these issues.  We are very actively trying to get Groovy 4 released yet this year.  After that, we may be able to backport some of the Java 16+ fixes to Groovy 3.  However some of the issues required significant compiler changes that are not likely to be backported.&lt;/p&gt;</comment>
                            <comment id="17459968" author="emilles" created="Wed, 15 Dec 2021 14:10:27 +0000"  >&lt;p&gt;Until this specific issue is fixed, you can add an open for jdk.proxy1 so the VM will allow the call.&lt;/p&gt;</comment>
                            <comment id="17460037" author="JIRAUSER280791" created="Wed, 15 Dec 2021 15:24:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt; any suggestion on how can I achieve that? afaik dynamically generated module that the generated proxies belong to i.e., `jdk.proxy1`, cannot be open to all-unnamed-modules like other modules&lt;/p&gt;</comment>
                            <comment id="17460764" author="emilles" created="Thu, 16 Dec 2021 14:16:40 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-10137&quot; title=&quot;[JDK16] Illegal access to dynamic proxy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-10137&quot;&gt;&lt;del&gt;GROOVY-10137&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17460789" author="JIRAUSER280791" created="Thu, 16 Dec 2021 14:44:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt; There are no comments, no code, nothing, is there something im missing?&lt;/p&gt;</comment>
                            <comment id="17460883" author="emilles" created="Thu, 16 Dec 2021 16:58:46 +0000"  >&lt;p&gt;This issue is tracked by &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-10137&quot; title=&quot;[JDK16] Illegal access to dynamic proxy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-10137&quot;&gt;&lt;del&gt;GROOVY-10137&lt;/del&gt;&lt;/a&gt;.  You can add an open using &quot;--add-opens jdk.proxy1/jdk.proxy1=ALL-UNNAMED&quot;&lt;/p&gt;</comment>
                            <comment id="17461243" author="JIRAUSER281815" created="Fri, 17 Dec 2021 07:27:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt;&#160; The modules are generated dynamically though...this means that you cannot predit their names ahead of their creation, which in turn means, that you can&apos;t add the relevant --add-opens.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Not a huge issue for me, to live with this restriction. Just wanted to give a hint to other people having this issue.&lt;/p&gt;</comment>
                            <comment id="17461245" author="JIRAUSER280791" created="Fri, 17 Dec 2021 07:30:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt;&#160;&lt;br/&gt;
this results in&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
WARNING: Unknown module: jdk.proxy1 specified to --add-opens&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Perhaps I&apos;m wrong because I didn&apos;t work with java 17 much, but I think jdk.proxy1 is not a real named module therefore cannot be statically opened by add-opens flag&lt;/p&gt;</comment>
                            <comment id="17461475" author="emilles" created="Fri, 17 Dec 2021 14:25:27 +0000"  >&lt;p&gt;I agree, this is a problem.  I tried the add opens at one point, not sure what result I obtained anymore.  We may be able to get this into 3.0.10, but in the mean time you can use a class instead of a closure to sidestep proxy-to-default-method.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13524362">GROOVY-10931</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>groovy</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 47 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0x3ao:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>