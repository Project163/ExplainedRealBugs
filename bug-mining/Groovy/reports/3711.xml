<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:04:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-8707] += in CompileStatic dynamically sets property instead of using setter</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-8707</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic

@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;A {
&#160; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; num

&#160; static main(args) {
&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; a = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; A()
&#160;&#160; &#160;a.num = 5
&#160;&#160; &#160;a.num += 10
&#160; }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Main method compiles to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
A a = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; A();
&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; var2 = 5;
a.setNum(var2);
&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; var10001 = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
ScriptBytecodeAdapter.setProperty(a.getNum() + 10, (&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;)&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, a, (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)&lt;span class=&quot;code-quote&quot;&gt;&quot;num&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13173459">GROOVY-8707</key>
            <summary>+= in CompileStatic dynamically sets property instead of using setter</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="deathlord">death lord</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Jul 2018 13:10:10 +0000</created>
                <updated>Thu, 24 Feb 2022 19:38:25 +0000</updated>
                            <resolved>Fri, 14 Feb 2020 05:52:31 +0000</resolved>
                                    <version>2.5.1</version>
                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                    <fixVersion>3.0.1</fixVersion>
                    <fixVersion>2.5.16</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="16963457" author="emilles" created="Wed, 30 Oct 2019 21:47:04 +0000"  >&lt;p&gt;Groovy 2.5 is currently writing this bytecode for the main method (with invoke-dynamic enabled):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;... args);
     0  ldc &amp;lt;&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; Groovy8707&amp;gt; [2]
     2  invokestatic org.codehaus.groovy.runtime.DefaultGroovyMethods.newInstance(java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;) : java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; [37]
     5  invokedynamic 0 &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;) : Groovy8707 [51]
    10  astore_1 [obj]
    11  aload_1 [obj]
    12  pop
    13  iconst_5
    14  dup
    15  istore_2
    16  aload_1 [obj]
    17  iload_2
    18  invokevirtual Groovy8707.setNum(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) : void [55]
    21  aconst_null
    22  pop
    23  pop
    24  aload_1 [obj]
    25  invokevirtual Groovy8707.getNum() : &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; [59]
    28  bipush 10
    30  iadd
    31  dup
    32  invokestatic java.lang.&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.valueOf(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) : java.lang.&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; [65]
    35  ldc &amp;lt;&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; Groovy8707&amp;gt; [2]
    37  aload_1 [obj]
    38  ldc &amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;num&quot;&lt;/span&gt;&amp;gt; [66]
    40  checkcast java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; [68]
    43  invokestatic org.codehaus.groovy.runtime.ScriptBytecodeAdapter.setGroovyObjectProperty(java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;, java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;, groovy.lang.GroovyObject, java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;) : void [74]
    46  pop
    47  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17035786" author="emilles" created="Wed, 12 Feb 2020 23:25:48 +0000"  >&lt;p&gt;Not sure why &quot;a.num += 10&quot; is written as &lt;tt&gt;ScriptBytecodeAdapter.setProperty(a.getNum() + 10, (Class)null, a, (String)&quot;num&quot;)&lt;/tt&gt; instead of using &lt;tt&gt;Groovy8707.setNum(int)&lt;/tt&gt; like &quot;a.num = 5&quot; does.  The two lines take different paths through AsmClassGenerator, so I need to do some back-tracking to see if there is an AST transform applied to &quot;a.num = 5&quot;.&lt;/p&gt;

&lt;p&gt;I also have an experiment that would turn all accesses to &quot;num&quot; in the example to field reads/writes.  Accessing &quot;num&quot; from within the declaring class should be able to be a simple field access.&lt;/p&gt;</comment>
                            <comment id="17036341" author="emilles" created="Thu, 13 Feb 2020 16:37:59 +0000"  >&lt;p&gt;The simple assignment &quot;a.num = 5&quot; takes a shot-circuit path for static compile:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    StaticTypesBinaryExpressionMultiTypeDispatcher:
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void evaluateEqual(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; BinaryExpression expression, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; defineVariable) {
        Expression leftExpression = expression.getLeftExpression();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!defineVariable) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (leftExpression &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; PropertyExpression) {
                PropertyExpression pexp = (PropertyExpression) leftExpression;
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (makeSetProperty(
                        pexp.getObjectExpression(),
                        pexp.getProperty(),
                        expression.getRightExpression(),
                        pexp.isSafe(),
                        pexp.isSpreadSafe(),
                        pexp.isImplicitThis(),
                        pexp &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; AttributeExpression)) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The compound assignment &quot;a.num += 10&quot; goes a separate path that performs a standard visit for the LHS, which results in a setProperty (via &lt;tt&gt;visitAttributeOrProperty&lt;/tt&gt; -&amp;gt; &lt;tt&gt;controller.getCallSiteWriter().fallbackAttributeOrPropertySite(...)&lt;/tt&gt;).&lt;/p&gt;</comment>
                            <comment id="17036705" author="paulk" created="Fri, 14 Feb 2020 05:52:31 +0000"  >&lt;p&gt;Proposed PR merged. Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 39 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3w44v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>