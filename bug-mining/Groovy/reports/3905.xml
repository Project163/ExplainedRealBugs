<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:09:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-8103] STC: matching return type of one static method to parameter type of another</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-8103</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;We are using a fluent API based testing library (FEST assert).  I tried to boil this problem down; I hope this example is not too abstract.  Basically, there is a main fluent method that starts every test assertion and this is a static method with many overloads.  The library offers an extension mechanism where you put in your own type and this is where the checker is failing.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@groovy.transform.TypeChecked
def method() {
    fluent(&lt;span class=&quot;code-quote&quot;&gt;&apos;string&apos;&lt;/span&gt;).isEqualTo(&lt;span class=&quot;code-quote&quot;&gt;&apos;x&apos;&lt;/span&gt;) &lt;span class=&quot;code-comment&quot;&gt;// fine
&lt;/span&gt;    fluent(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Util.Ours()).isSimilarTo(&apos;&apos;) &lt;span class=&quot;code-comment&quot;&gt;// fine
&lt;/span&gt;    fluent(Util.Ours.factory(&lt;span class=&quot;code-quote&quot;&gt;&apos;{}&apos;&lt;/span&gt;)).isSimilarTo(&lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;key&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;val&quot;&lt;/span&gt;}&apos;&lt;/span&gt;) &lt;span class=&quot;code-comment&quot;&gt;// STC error
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Supporting code (library provided):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Fluent
{
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; FluentAPI fluent(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s) { &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FluentAPI() }
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;T &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; FluentExtension&amp;gt; T fluent(T t) { &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; t }
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;FluentAPI
{
    FluentAPI isEqualTo(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s) { &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; }
}

&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; FluentExtension
{
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Our extension:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Util {
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Ours &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; FluentExtension {
        Ours isSimilarTo(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; json) { &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; }
    }

    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Ours factory(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; json) { &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Ours() }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13047380">GROOVY-8103</key>
            <summary>STC: matching return type of one static method to parameter type of another</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="emilles">Eric Milles</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Mar 2017 17:04:50 +0000</created>
                <updated>Wed, 11 Nov 2020 02:01:39 +0000</updated>
                            <resolved>Thu, 17 Sep 2020 22:38:38 +0000</resolved>
                                                                    <component>Static Type Checker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="15999412" author="emilles" created="Sat, 6 May 2017 12:12:33 +0000"  >&lt;p&gt;I have another example of this which is specific to CompileStatic.  &lt;tt&gt;assertThat&lt;/tt&gt; at the end of the block infers to the &lt;tt&gt;assertThat(Object): ObjectAssert&lt;/tt&gt; overload.  This is correct.  Then &lt;tt&gt;isNotNull(Object)&lt;/tt&gt; is defined in the superclass, which should now have generic parameters &lt;tt&gt;GenericAssert&amp;lt;ObjectAssert, Object&amp;gt;&lt;/tt&gt;.  And so &lt;tt&gt;isNotNull&lt;/tt&gt; has a return type of the second first generic param &lt;tt&gt;ObjectAssert&lt;/tt&gt;.  But I am getting &lt;tt&gt;ThrowableAssert&lt;/tt&gt; as the inferred return type.&lt;/p&gt;

&lt;p&gt;When I switch from CompileStatic to TypeChecked, the correct return type is inferenced.  So there must be something in the extra transformations of static compilation that cause this.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Grab(&lt;span class=&quot;code-quote&quot;&gt;&apos;org.easytesting:fest-&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt;:1.4&apos;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.fest.assertions.Assertions.assertThat
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.mockito.Matchers.*
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.mockito.Mockito.*

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.Test
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.runner.RunWith
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.mockito.Mock
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.mockito.runners.MockitoJUnitRunner

@CompileStatic @RunWith(MockitoJUnitRunner)
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MockTest {

  @Mock
  Sample sample

  @Test
  void testMocks() {
    when(sample.method(any(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;))).thenReturn(~/abc/)

    def pat = sample.pattern

    assertThat(pat).isNotNull()
    verify(sample).getPattern()
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17198013" author="emilles" created="Thu, 17 Sep 2020 22:38:38 +0000"  >&lt;p&gt;Fixed circa 2.5.10.  I wasn&apos;t able to create a good enough test case to find out exactly when.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3asvr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>