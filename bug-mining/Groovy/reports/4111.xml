<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:12:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-9064] STC: explicit declared variable type ignored in favor of assigned value type(s)</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-9064</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Follow up to &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9058&quot; title=&quot;each parameter type not correctly inferenced&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9058&quot;&gt;&lt;del&gt;GROOVY-9058&lt;/del&gt;&lt;/a&gt;.&#160; Consider the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
List getSomeRows() { ... }
@groovy.transform.CompileStatic
void meth() {
  List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[]&amp;gt; rows = getSomeRows()
  rows.each { row -&amp;gt;
    &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; col = row[0]
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The inferred type of &lt;tt&gt;rows&lt;/tt&gt; is &lt;tt&gt;List&lt;/tt&gt; and not &lt;tt&gt;List&amp;lt;Object[]&amp;gt;&lt;/tt&gt; even though the assignment cleared type checking.  This causes the inferred type of &lt;tt&gt;row&lt;/tt&gt; to be &lt;tt&gt;Object&lt;/tt&gt; instead of &lt;tt&gt;Object[]&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Similarly, &lt;tt&gt;List&amp;lt;String&amp;gt; list = []&lt;/tt&gt; infers as &lt;tt&gt;ArrayList&amp;lt;String&amp;gt;&lt;/tt&gt; instead of the explicit declared type, and &lt;tt&gt;Map&amp;lt;String, ?&amp;gt; map = &lt;span class=&quot;error&quot;&gt;&amp;#91;:&amp;#93;&lt;/span&gt;&lt;/tt&gt; infers to &lt;tt&gt;LinkedHasMap&amp;lt;...&amp;gt;&lt;/tt&gt; instead of the declared type.  In general, I think as long as the assignment is compatible, the variable should retain its explicitly declared type regardless of assignments.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13225838">GROOVY-9064</key>
            <summary>STC: explicit declared variable type ignored in favor of assigned value type(s)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="emilles">Eric Milles</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Apr 2019 15:39:38 +0000</created>
                <updated>Tue, 24 Jan 2023 16:31:34 +0000</updated>
                            <resolved>Tue, 4 May 2021 21:53:01 +0000</resolved>
                                                    <fixVersion>4.0.0-alpha-3</fixVersion>
                    <fixVersion>3.0.9</fixVersion>
                                    <component>Static Type Checker</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16808861" author="emilles" created="Wed, 3 Apr 2019 15:47:53 +0000"  >&lt;p&gt;To maintain the declared type, I propose the following change in &lt;tt&gt;StaticTypeCheckingVisitor.visitBinaryExpression&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!isEmptyDeclaration &amp;amp;&amp;amp; isAssignment(op)) {
                ...
                &lt;span class=&quot;code-comment&quot;&gt;// GRECLIPSE add
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!(leftExpression &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; VariableExpression) || ((VariableExpression) leftExpression).isDynamicTyped())
                &lt;span class=&quot;code-comment&quot;&gt;// GRECLIPSE end
&lt;/span&gt;                storeType(leftExpression, resultType);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It is possible another condition should be added for assignment to property expressions as well, like &lt;tt&gt;foo.bar = value&lt;/tt&gt;.  In any case, this is a significant enough STC change that I believe it should not be made in Groovy 2.5, but can be made in Groovy 3+.&lt;/p&gt;</comment>
                            <comment id="16810046" author="emilles" created="Thu, 4 Apr 2019 16:37:16 +0000"  >&lt;p&gt;In order to maintain the declared type in the face of conditional assignments, like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
@groovy.transform.CompileStatic
void meth() {
  Map map = getMapFromSomewhere()
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!map) {
    map = [a:1, b:&lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;]
  }
  &lt;span class=&quot;code-comment&quot;&gt;// map infers to LinkedHashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Serializable&amp;lt;?&amp;gt;&amp;gt; without extra guard condition
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A guard condition also needs to be added to &lt;tt&gt;StaticTypeCheckingVisitor.popAssignmentTracking&lt;/tt&gt;.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; Map&amp;lt;VariableExpression, ClassNode&amp;gt; popAssignmentTracking(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Map&amp;lt;VariableExpression, List&amp;lt;ClassNode&amp;gt;&amp;gt; oldTracker) {
        Map&amp;lt;VariableExpression, ClassNode&amp;gt; assignments = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;VariableExpression, ClassNode&amp;gt;();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!typeCheckingContext.ifElseForWhileAssignmentTracker.isEmpty()) {
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Map.Entry&amp;lt;VariableExpression, List&amp;lt;ClassNode&amp;gt;&amp;gt; entry : typeCheckingContext.ifElseForWhileAssignmentTracker.entrySet()) {
                VariableExpression key = entry.getKey();
                &lt;span class=&quot;code-comment&quot;&gt;// GRECLIPSE add
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!key.isDynamicTyped()) &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
                &lt;span class=&quot;code-comment&quot;&gt;// GRECLIPSE end
&lt;/span&gt;                List&amp;lt;ClassNode&amp;gt; allValues = entry.getValue();
                &lt;span class=&quot;code-comment&quot;&gt;// GROOVY-6099: First element of the list may be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; no assignment was made before the branch
&lt;/span&gt;                List&amp;lt;ClassNode&amp;gt; nonNullValues = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;ClassNode&amp;gt;(allValues.size());
                &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (ClassNode value : allValues) {
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (value != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) nonNullValues.add(value);
                }
                ClassNode cn = lowestUpperBound(nonNullValues);
                storeType(key, cn);
                assignments.put(key, cn);
            }
        }
        typeCheckingContext.ifElseForWhileAssignmentTracker = oldTracker;
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; assignments;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16810057" author="emilles" created="Thu, 4 Apr 2019 16:41:50 +0000"  >&lt;p&gt;I&apos;m also suspicious of this line within storeType:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (exp &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; VariableExpression) {
            VariableExpression &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; = (VariableExpression) exp;
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Variable accessedVariable = &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;.getAccessedVariable();
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (accessedVariable != exp &amp;amp;&amp;amp; accessedVariable &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; VariableExpression) {
                storeType((VariableExpression) accessedVariable, cn); &lt;span class=&quot;code-comment&quot;&gt;// should &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; be guarded as well?&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16811785" author="paulk" created="Sun, 7 Apr 2019 07:58:10 +0000"  >&lt;p&gt;I think there is more going on here.&lt;/p&gt;

&lt;p&gt;In general, you wouldn&apos;t want the declaration type to be used when normal flow typing comes into play:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@groovy.transform.CompileStatic
void meth() {
  CharSequence cs = &lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; cs.endsWith(&lt;span class=&quot;code-quote&quot;&gt;&apos;oo&apos;&lt;/span&gt;) &lt;span class=&quot;code-comment&quot;&gt;// (1)
&lt;/span&gt;  cs = &lt;span class=&quot;code-quote&quot;&gt;&quot;bar$cs&quot;&lt;/span&gt;
  cs.with{ &lt;span class=&quot;code-comment&quot;&gt;// (2)
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; values[0] == &lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; strings[0] == &lt;span class=&quot;code-quote&quot;&gt;&apos;bar&apos;&lt;/span&gt;
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here, we want &lt;tt&gt;String&lt;/tt&gt; and &lt;tt&gt;GString&lt;/tt&gt; to be the inferred types at (1) and (2) not &lt;tt&gt;CharSequence&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16811884" author="mauromol" created="Sun, 7 Apr 2019 13:21:53 +0000"  >&lt;p&gt;Hi Paul,&lt;/p&gt;

&lt;p&gt;are you sure? I mean, in a static context I expect &lt;tt&gt;cs&lt;/tt&gt; to be inferred as &lt;tt&gt;CharSequence&lt;/tt&gt; at both (1) and (2), requiring a cast otherwise. After all, Java behaves in this way. If we are talking about a dynamic context, the story may be different, of course...&lt;/p&gt;

&lt;p&gt;We might say that Groovy is &quot;smart enough&quot; to automatically convert &lt;tt&gt;CharSequence&lt;/tt&gt; to &lt;tt&gt;String&lt;/tt&gt; at (1) and to &lt;tt&gt;GString&lt;/tt&gt; at (2), without requiring a cast, but this sounds to me something more like a &quot;auto(un)boxing&quot; feature, not an actual type change for &lt;tt&gt;cs&lt;/tt&gt;...&lt;/p&gt;

&lt;p&gt;Just IMHO of course.&lt;/p&gt;</comment>
                            <comment id="16811888" author="paulk" created="Sun, 7 Apr 2019 13:45:48 +0000"  >&lt;p&gt;This is flow typing:&lt;br/&gt;
&lt;a href=&quot;http://groovy-lang.org/semantics.html#section-flow-typing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://groovy-lang.org/semantics.html#section-flow-typing&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16811893" author="mauromol" created="Sun, 7 Apr 2019 14:04:08 +0000"  >&lt;p&gt;Thanks for the pointer Paul, I now understand this better. Personally, from a fan of statically typed languages, I find it a bit confusing and risky, but I understand the point when the documentation says that flow typing was introduced to reduce the difference in semantics between classic and static Groovy.&lt;/p&gt;

&lt;p&gt;So, from this point of view, the behaviour of groovyc with the example provided in the steps to repro is perfectly correct.&lt;/p&gt;

&lt;p&gt;However, given the fact that &lt;tt&gt;List&lt;/tt&gt; is often a shortcut for &quot;list of I don&apos;t care of&quot;, rather than &quot;list of Objects&quot; (so, something more like &lt;tt&gt;List&amp;lt;?&amp;gt;&lt;/tt&gt; rather than &lt;tt&gt;List&amp;lt;Object&amp;gt;&lt;/tt&gt;), I think that in this specific case (which is something like the opposite of the example provided by the documentation, &lt;tt&gt;List list = &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;a&amp;#39;,&amp;#39;b&amp;#39;,&amp;#39;c&amp;#39;&amp;#93;&lt;/span&gt;&lt;/tt&gt;, where the declared type is less specific than the inferred type), where the generic type is made more specific and explicit by the declared type of &lt;tt&gt;rows&lt;/tt&gt; variable, having such a behaviour is not only counter-intuitive, but even questionable...&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="16811975" author="paulk" created="Sun, 7 Apr 2019 21:59:44 +0000"  >&lt;p&gt;I am not sure I fully understand when you say counter intuitive. I would expect this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[]&amp;gt; rows = getSomeRows()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to fail compilation since the return type for &lt;tt&gt;getSomeRows&lt;/tt&gt; is less specific and there is no cast.&lt;/p&gt;

&lt;p&gt;The inferred type looks suspicious to me:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.util.List &amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[]&amp;gt; -&amp;gt; java.util.List &amp;lt;E &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I haven&apos;t work whether we are making incorrect assumptions about the redirect or whether there is some strange attempt at vararg handling.&lt;/p&gt;</comment>
                            <comment id="16812172" author="mauromol" created="Mon, 8 Apr 2019 07:14:44 +0000"  >&lt;p&gt;Making the compilation fail at:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[]&amp;gt; rows = getSomeRows()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;would make more sense IMHO. But if we assume that this doesn&apos;t fail because Groovy is smart enough to trust you that the returned&#160;&lt;tt&gt;List&lt;/tt&gt; is actually a&#160;&lt;tt&gt;List&amp;lt;Object[]&amp;gt;&lt;/tt&gt; and save you from typing:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@SuppressWarnings(&lt;span class=&quot;code-quote&quot;&gt;&apos;unchecked&apos;&lt;/span&gt;)
List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[]&amp;gt; rows = (List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[]) getSomeRows()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;then the requirement to add the cast anyway, not to make the compiler happy at the assignment place, but rather to make the compiler happy within the &lt;tt&gt;each&lt;/tt&gt; closure body (to convince it that &lt;tt&gt;rows&lt;/tt&gt; contains &lt;tt&gt;Object[]&lt;/tt&gt; instances), just because the &lt;tt&gt;rows&lt;/tt&gt; declaration type is indeed completely ignored, well this sounds counter intuitive to me.&lt;/p&gt;</comment>
                            <comment id="16812178" author="mauromol" created="Mon, 8 Apr 2019 07:21:22 +0000"  >&lt;p&gt;It&apos;s also quite confusing that this variation does not generate the compiler error instead:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[]&amp;gt; rows = getSomeRows()
rows.each { &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] row -&amp;gt;
    &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; col = row[0]
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;that is: if I declare &lt;tt&gt;row&lt;/tt&gt; as &lt;tt&gt;Object[]&lt;/tt&gt; inside the closure, then the assignment to &lt;tt&gt;col&lt;/tt&gt; passes. So, &lt;tt&gt;rows&lt;/tt&gt; declaration type is ignored, but the &lt;tt&gt;row&lt;/tt&gt; one is not...&lt;/p&gt;</comment>
                            <comment id="16812361" author="paulk" created="Mon, 8 Apr 2019 11:40:37 +0000"  >&lt;p&gt;The line not failing:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[]&amp;gt; rows = getSomeRows()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;is where the bug is. That needs a cast. It is on the LHS where the static compiler is selecting Object and then correctly matching Object with Object from the RHS.&lt;br/&gt;
The subsequent error would go away if we fixed the inferring on this line.&lt;/p&gt;</comment>
                            <comment id="16812470" author="emilles" created="Mon, 8 Apr 2019 14:29:34 +0000"  >&lt;p&gt;I perfectly understand flow typing applying to dynamic variables (&lt;tt&gt;CharSequence&lt;/tt&gt; replaced with &lt;tt&gt;def&lt;/tt&gt; below):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
@groovy.transform.CompileStatic
void meth() {
  &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; cs = &lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; cs.endsWith(&lt;span class=&quot;code-quote&quot;&gt;&apos;oo&apos;&lt;/span&gt;) &lt;span class=&quot;code-comment&quot;&gt;// (1)
&lt;/span&gt;  cs = &lt;span class=&quot;code-quote&quot;&gt;&quot;bar$cs&quot;&lt;/span&gt;
  cs.with{ &lt;span class=&quot;code-comment&quot;&gt;// (2)
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; values[0] == &lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; strings[0] == &lt;span class=&quot;code-quote&quot;&gt;&apos;bar&apos;&lt;/span&gt;
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, we have been fighting with &lt;tt&gt;@CompileStatic&lt;/tt&gt; errors for a couple years now when we declare &lt;tt&gt;Map&amp;lt;String,Object&amp;gt; map = &lt;span class=&quot;error&quot;&gt;&amp;#91;a:1,b:&amp;#39;2&amp;#39;&amp;#93;&lt;/span&gt;&lt;/tt&gt; and flow typing infers &lt;tt&gt;map&lt;/tt&gt; as &lt;tt&gt;LinkedHashMap&amp;lt;String,Serializable&amp;gt;&lt;/tt&gt;.  I&apos;ve explicitly declared the variable&apos;s type and it is completely ignored from the very first assignment.&lt;/p&gt;

&lt;p&gt;I also understand altering the type when it has been tested by an &lt;tt&gt;instanceof&lt;/tt&gt;, however this inferenced type should be a scoped to the statement or block that is guarded by the &lt;tt&gt;instanceof&lt;/tt&gt; condition.&lt;/p&gt;</comment>
                            <comment id="16812477" author="emilles" created="Mon, 8 Apr 2019 14:40:30 +0000"  >&lt;p&gt;Flow typing combined with generics has been a major source of confusion and compiler errors for our teams.  &lt;tt&gt;List&lt;/tt&gt; vs &lt;tt&gt;LinkedList&lt;/tt&gt; is not a problem; &lt;tt&gt;List&amp;lt;Object&amp;gt;&lt;/tt&gt; vs. &lt;tt&gt;List&amp;lt;Serializable&amp;lt;?&amp;gt;&amp;gt;&lt;/tt&gt; or some other weird LUB or union type is problematic.&lt;/p&gt;</comment>
                            <comment id="16812683" author="blackdrag" created="Mon, 8 Apr 2019 18:16:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt; I agree in that the situation is quite less than ideal for generics. I think we probably have to rethink the concept here a bit... the basic concept is the following:&lt;/p&gt;

&lt;p&gt;X y = z&lt;/p&gt;

&lt;p&gt;where X is the declaration type of y and Z is the inferred typed if z. In Flowtyping we say if Z is a more specific type and X, Z is to be used. Def is just an alias for Object in this system.&lt;/p&gt;

&lt;p&gt;And it works well for if X is List and Z is LinkedList. But if X is List&amp;lt;Object&amp;gt; and Z is List&amp;lt;Object  &amp;amp; Serializable&amp;gt;, then Z is no longer a more specific type than X in the normal sense, it is now an incompatible type. If this is not supposed to lead to an compilation error, we should not go by the inferred type, but for the declared type for the generics part.&lt;/p&gt;</comment>
                            <comment id="16983633" author="emilles" created="Wed, 27 Nov 2019 15:36:53 +0000"  >&lt;p&gt;See also &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7763&quot; title=&quot;Various problems with type inference in Groovy 2.4.6&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7763&quot;&gt;&lt;del&gt;GROOVY-7763&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17339315" author="emilles" created="Tue, 4 May 2021 21:53:01 +0000"  >&lt;p&gt;This particular test case was resolved&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13521127">GROOVY-10914</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 28 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z01f1s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>