<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:10:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-9916] IllegalArgumentException when set null to a boolean field into a closure</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-9916</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The following exception has been thrown by an application in production:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.IllegalArgumentException: Can not set &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; field c.c.a.a.b.t.b.save.RestoreDataMssqlTask.schemaExistInBackup to &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; value
	at sun.reflect.UnsafeFieldAccessorImpl.throwSetIllegalArgumentException(UnsafeFieldAccessorImpl.java:167)
	at sun.reflect.UnsafeFieldAccessorImpl.throwSetIllegalArgumentException(UnsafeFieldAccessorImpl.java:171)
	at sun.reflect.UnsafeBooleanFieldAccessorImpl.set(UnsafeBooleanFieldAccessorImpl.java:80)
	at java.lang.reflect.Field.set(Field.java:764)
	at org.codehaus.groovy.reflection.CachedField.setProperty(CachedField.java:76)
	at groovy.lang.MetaClassImpl.setProperty(MetaClassImpl.java:2718)
	at groovy.lang.MetaClassImpl.setProperty(MetaClassImpl.java:3809)
	at c.c.a.a.b.t.b.save.AbstractRestoreTask.setProperty(AbstractRestoreTask.groovy)
	at org.codehaus.groovy.runtime.InvokerHelper.setProperty(InvokerHelper.java:213)
	at groovy.lang.Closure.setPropertyTryThese(Closure.java:370)
	at groovy.lang.Closure.setPropertyOwnerFirst(Closure.java:364)
	at groovy.lang.Closure.setProperty(Closure.java:353)
	at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.setGroovyObjectProperty(ScriptBytecodeAdapter.java:544)
	at c.c.a.a.b.t.b.save.RestoreDataMssqlTask$_execImportDatasource_closure1.doCall(RestoreDataMssqlTask.groovy:86)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think the following test class reproduces the problem :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Test {

	private &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; b
	
	static final void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;... args) {
		&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Test().f()
	}
	
	&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; f() {
		println(&lt;span class=&quot;code-quote&quot;&gt;&apos;set &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; to &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&apos;&lt;/span&gt;)
		b = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
		&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; closure = { 
			println(&lt;span class=&quot;code-quote&quot;&gt;&apos;set &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; to &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; inside a closure&apos;&lt;/span&gt;)
			b = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
		}
		closure()
	}	
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The conditions are 1) affect null to a primitive boolean variable, 2) the variable must be an instance field, 3) the affectation must be executed in a closure&lt;/p&gt;

&lt;p&gt;With Groovy 2.5.5 no exception.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ groovy -version
Groovy Version: 2.5.5 JVM: 1.8.0_265 Vendor: AdoptOpenJDK OS: Windows 10

$ groovy Test
set &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; to &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
set &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; to &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; inside a closure
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But with groovy 2.5.13 or the last stable version 3.0.7 the second affectation failed :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ groovy -version
Groovy Version: 3.0.7 JVM: 1.8.0_265 Vendor: AdoptOpenJDK OS: Windows 10

$ groovy Test
set &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; to &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
set &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; to &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; inside a closure
Caught: java.lang.IllegalArgumentException: Can not set &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; field Test.b to &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; value
java.lang.IllegalArgumentException: Can not set &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; field Test.b to &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; value
        at Test$_f_closure1.doCall(Test.groovy:14)
        at Test$_f_closure1.doCall(Test.groovy)
        at Test.f(Test.groovy:16)
        at Test$f.call(Unknown Source)
        at Test.main(Test.groovy:6)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In &lt;tt&gt;org.codehaus.groovy.runtime.typehandling.DefaultTypeTransformation&lt;/tt&gt; the method &lt;a href=&quot;https://github.com/apache/groovy/blob/ac852d6a53bcb583849cb8db8a1cbede5b097502/src/main/java/org/codehaus/groovy/runtime/typehandling/DefaultTypeTransformation.java#L185&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;castToBoolean()&lt;/a&gt; takes care of the &lt;tt&gt;null&lt;/tt&gt; value in accordance with the Groovy truth:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; castToBoolean(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; object) {
        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; is always &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (object == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but the method &lt;tt&gt;castToBoolean()&lt;/tt&gt; is obviously  never called by &lt;a href=&quot;https://github.com/apache/groovy/blob/ac852d6a53bcb583849cb8db8a1cbede5b097502/src/main/java/org/codehaus/groovy/runtime/typehandling/DefaultTypeTransformation.java#L218&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;castToType()&lt;/a&gt; when the value is null because the first line of castToType is :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (object == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;How can I deal with this behaviour? I guess I must stuck ith the old 2.5.5 ?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13354989">GROOVY-9916</key>
            <summary>IllegalArgumentException when set null to a boolean field into a closure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="zerikv">Eric Vernier</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Jan 2021 17:56:23 +0000</created>
                <updated>Wed, 26 Jun 2024 15:58:50 +0000</updated>
                            <resolved>Tue, 2 Mar 2021 15:06:13 +0000</resolved>
                                    <version>2.5.13</version>
                    <version>3.0.7</version>
                                    <fixVersion>3.0.8</fixVersion>
                    <fixVersion>4.0.0-alpha-3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="17273505" author="zerikv" created="Thu, 28 Jan 2021 11:16:10 +0000"  >&lt;p&gt;The changement of the behaviour came with the version 2.5.13. With groovy 2.5.12 no exception.&lt;/p&gt;

&lt;p&gt;By comparing the java bytecode compiled by groovyc then decompiled we can see a difference in the code generated to affect a value to the boolean field ;&#160;&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&#160;with Groovy 2.5.12 :
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
    &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; object = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    ScriptBytecodeAdapter.setGroovyObjectProperty(&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;.valueOf(DefaultTypeTransformation.booleanUnbox(object)), _f_closure1.class, (GroovyObject)&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;&#160;with Groovy 2.5.13 :
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
    &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; object = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    ScriptBytecodeAdapter.setGroovyObjectProperty(object, _f_closure1.class, (GroovyObject)&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17273795" author="emilles" created="Thu, 28 Jan 2021 15:12:56 +0000"  >&lt;p&gt;This was the direct result of changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7701&quot; title=&quot;org.codehaus.groovy.runtime.typehandling.GroovyCastException in Groovy &amp;quot;.with { ... }&amp;quot; - Block&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7701&quot;&gt;&lt;del&gt;GROOVY-7701&lt;/del&gt;&lt;/a&gt;: &lt;a href=&quot;https://github.com/apache/groovy/commit/3bf8f9fe71aaa471a72029d410cedbffa83d52fb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/3bf8f9fe71aaa471a72029d410cedbffa83d52fb&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Prior to visiting the variable &quot;b&quot; in &quot;b = null&quot;, there was a type lookup and groovy cast.  &quot;b&quot; must be visited first to know its type confidently.  Within a closure, &quot;b&quot; could resolve to anything.&lt;/p&gt;

&lt;p&gt;Now that the call &lt;tt&gt;ScriptBytecodeAdapter.setGroovyObjectProperty(null, _f_closure1.class, (GroovyObject)this, &quot;b&quot;)&lt;/tt&gt; is written for the closure, DefaultTypeTransformation.booleanUnbox may need to be added within setGroovyObjectProperty.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13578749">GROOVY-11371</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 41 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0n208:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>