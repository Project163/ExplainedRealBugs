<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:05:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-9459] Line number information for automatically inserted return statements quirky</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-9459</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;While trying to work-around &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9440&quot; title=&quot;Missing line number information in stack trace&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9440&quot;&gt;&lt;del&gt;GROOVY-9440&lt;/del&gt;&lt;/a&gt;, I found another quirk regarding line numbers.&lt;br/&gt;
I&apos;m sorry if this is intended and not a bug, but it looks strange to me.&lt;/p&gt;

&lt;p&gt;Here what I found out so far:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The Spock AST transformation previously had (semantically equivalent) &lt;tt&gt;new ReturnStatement(new ExpressionStatement(theVariableExpression)))&lt;/tt&gt; where the two statements have no line information, the expression does have it.&lt;br/&gt;
This caused the line information to be missing from the &lt;tt&gt;MissingPropertyException&lt;/tt&gt;.&lt;br/&gt;
If I look at the AST Browser at end of semantic analysis, this results in &lt;tt&gt;ReturnStatement -&amp;gt; Variable&lt;/tt&gt; where the return statement has no line information, the variable does have it, in both 2.5.8 and 3.0.0.&lt;br/&gt;
&#160;&lt;br/&gt;
I thought as work-around I remove the explicit return statement and let Groovy handle it, as it knows better what to do, so currently I have &lt;tt&gt;new ExpressionStatement(theVariableExpression))&lt;/tt&gt; where the statement still has no line information, but the expression does have it.&lt;br/&gt;
This now causes the line information to be missing from the &lt;tt&gt;MissingPropertyException&lt;/tt&gt; still, if Groovy 3.0.0 is used.&lt;br/&gt;
If I look at the AST Browser at end of semantic analysis, this results in &lt;tt&gt;ExpressionStatement -&amp;gt; Variable&lt;/tt&gt; where the statement has no line information, the variable does have it, in both 2.5.8 and 3.0.0.&lt;br/&gt;
If I now look at the end of class generation, this results in &lt;tt&gt;ReturnStatement -&amp;gt; Variable&lt;/tt&gt; in both 2.5.8 and 3.0.0, but only 2.5.8 has line information for the return statement, in 3.0.0 it is &lt;tt&gt;-1&lt;/tt&gt;.&lt;br/&gt;
&#160;&lt;br/&gt;
I now tried &lt;tt&gt;ExpressionStatement exprStat = new ExpressionStatement(theVariableExpression)); exprStat.setLineNumber(666);&lt;/tt&gt; and now it gets even fancier.&lt;br/&gt;
In 2.5.8 the return statement takes the line information from the variable expression, ignoring the expression statement,&lt;br/&gt;
in 3.0.0 the return statement takes the line information from the expression statement.&lt;br/&gt;
&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13291038">GROOVY-9459</key>
            <summary>Line number information for automatically inserted return statements quirky</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="vampire">Bj&#246;rn Kautler</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Mar 2020 10:00:06 +0000</created>
                <updated>Wed, 11 Nov 2020 02:01:02 +0000</updated>
                            <resolved>Thu, 26 Mar 2020 15:42:42 +0000</resolved>
                                    <version>3.0.0</version>
                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                    <fixVersion>3.0.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17056914" author="vampire" created="Wed, 11 Mar 2020 11:43:12 +0000"  >&lt;p&gt;After talking a bit with Paul about it, it seems to make sense to take the information from the &lt;tt&gt;ExpressionStatement&lt;/tt&gt; which was the change in 3.0.0.&lt;br/&gt;
But as the &lt;tt&gt;ExpressionStatement&lt;/tt&gt; gets replaced by the&#160;&lt;tt&gt;ReturnStatement&lt;/tt&gt;, would it maybe make sense to have some logic like &quot;take the info from &lt;tt&gt;ExpressionStatement&lt;/tt&gt; if present and if not, take it from the wrapped &lt;tt&gt;Expression&lt;/tt&gt; instead&quot;?&lt;/p&gt;</comment>
                            <comment id="17056915" author="paulk" created="Wed, 11 Mar 2020 11:44:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt; In this change here:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/groovy/commit/a54966c7bc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/a54966c7bc&lt;/a&gt;&lt;br/&gt;
Line 128 &amp;lt;=&amp;gt; 135&lt;br/&gt;
Is that a useful change from the Eclipse side of things? Or an unintended change? If useful, would it make sense to revert back to setting from the expression if the expression statement has no positioning info?&lt;/p&gt;</comment>
                            <comment id="17057065" author="emilles" created="Wed, 11 Mar 2020 14:47:46 +0000"  >&lt;p&gt;The idea in ReturnAdder is to pass on metadata from the statement that is being replaced.  When the ExpressionStatement is inserted, could it have source position set at that time?  If ReturnAdder is changed, what about the case where the ExpressionStatement has source position but the expression within it (for whatever reason) does not?&lt;/p&gt;</comment>
                            <comment id="17057120" author="paulk" created="Wed, 11 Mar 2020 15:34:07 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt;, we&apos;d need to check whether the missing info for the ExpressionStatement is from the Spock or Groovy side. If on the Groovy side, it is easy for us to fix on our end. If it&apos;s on the Spock side, we can push back on them to fix it but chances are our change in behavior might cause headaches for other downstream projects and we&apos;d need to assist them too at some point.&lt;br/&gt;
The appeal of Bj&#246;rn&apos;s suggestion (grabbing from ExpressionStatement as per current 3/master code but if the ExpressionStatement has no line number info, grab instead from the inner expression to preserve 2.5 behavior in that case) is that the likelihood of downstream headaches is small. Does the suggestion seem reasonable to you?&lt;/p&gt;</comment>
                            <comment id="17059799" author="emilles" created="Sun, 15 Mar 2020 20:16:51 +0000"  >&lt;p&gt;So is the concern that Groovy 2.5 and 3.0 do different things?  Or something else?  We could patch Groovy 2.5&apos;s ReturnAdder to also take source position from the ExpressionStatement that is replaced by a ReturnStatement.  Then 2.5 and 3.0 would again be consistent.&lt;/p&gt;

&lt;p&gt;This is indeed a difference between Groovy 2.5 and 3.0, but is not the cause of &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9440&quot; title=&quot;Missing line number information in stack trace&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9440&quot;&gt;&lt;del&gt;GROOVY-9440&lt;/del&gt;&lt;/a&gt;, which also exists under Groovy 2.5.10.&lt;/p&gt;</comment>
                            <comment id="17067787" author="paulk" created="Thu, 26 Mar 2020 15:42:42 +0000"  >&lt;p&gt;The Return adder is now smarter about populating the source position information. If the approach used in 3.0 would yield no line number info, the approach used by 2.5 becomes the fallback.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 33 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0cexs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>