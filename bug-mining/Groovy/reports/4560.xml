<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:20:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-10813] Cannot create method reference for print or println</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-10813</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Consider the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
@groovy.transform.CompileStatic
void p() {
  java.util.function.Consumer c = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;::print
  c.accept(&lt;span class=&quot;code-quote&quot;&gt;&apos;hello world!&apos;&lt;/span&gt;)
}
p()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Throws error &quot;LambdaConversionException: Type mismatch in captured lambda parameter 0: expecting class &lt;em&gt;script&lt;/em&gt;, found class java.lang.Object&quot;&lt;/p&gt;

&lt;p&gt;I was trying to print a stream element via &quot;this::println&quot;.  This fails also with &quot;System.out::println&quot; as well.  I had to use closure syntax which works just fine.  Lambda throws NPE: &quot;Consumer c = obj -&amp;gt; print(obj)&quot;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13495932">GROOVY-10813</key>
            <summary>Cannot create method reference for print or println</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="emilles">Eric Milles</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Nov 2022 20:40:06 +0000</created>
                <updated>Fri, 10 Feb 2023 21:40:00 +0000</updated>
                            <resolved>Mon, 28 Nov 2022 16:35:15 +0000</resolved>
                                    <version>3.0.13</version>
                    <version>4.0.6</version>
                                    <fixVersion>3.0.14</fixVersion>
                    <fixVersion>4.0.7</fixVersion>
                                    <component>Static compilation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17629496" author="JIRAUSER295331" created="Sun, 6 Nov 2022 15:26:33 +0000"  >&lt;p&gt;I would like to work on this issue. &lt;br/&gt;
If I understand correctly, method references can&apos;t be cast to the Functional Interface, &lt;br/&gt;
same for lambdas, but when using a Closure it works?&lt;/p&gt;</comment>
                            <comment id="17629498" author="JIRAUSER295331" created="Sun, 6 Nov 2022 15:41:56 +0000"  >&lt;p&gt;So for the lambda and the NPE:&lt;br/&gt;
The NPE happens, because the lambda you specified has no typeinformation for it&apos;s argument. &lt;br/&gt;
Following example works for me:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
@groovy.transform.CompileStatic
void testClosure(){
    java.util.function.Consumer c = (&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; x) -&amp;gt; print(x)
    c.accept(&lt;span class=&quot;code-quote&quot;&gt;&apos;hello world!&apos;&lt;/span&gt;)
}
testClosure()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17629501" author="emilles" created="Sun, 6 Nov 2022 15:54:10 +0000"  >&lt;p&gt;Probably best to take on the NPE for lambda case before the method reference case.  I don&apos;t quite know where the lambda failure comes from but it is likely in the bootstrapping somewhere.&lt;/p&gt;

&lt;p&gt;For method references, there is separate logic in &lt;tt&gt;StaticTypeCheckingVisitor&lt;/tt&gt; and &lt;tt&gt;StaticTypesMethodReferenceExpressionWriter&lt;/tt&gt;.  It is probably the latter where the problem lies.  There is method select logic in there and you can look at the history of the file to see how extension methods and variadic methods have been handled recently.&lt;/p&gt;</comment>
                            <comment id="17629530" author="JIRAUSER295331" created="Sun, 6 Nov 2022 18:35:45 +0000"  >&lt;p&gt;I&apos;ve located, where the NPE is happening. Inside here: &lt;a href=&quot;https://github.com/apache/groovy/blob/873e1952cf93373ad1eb348ef944fd628a3e9610/src/main/java/groovy/lang/MetaClassImpl.java#L3495&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/blob/873e1952cf93373ad1eb348ef944fd628a3e9610/src/main/java/groovy/lang/MetaClassImpl.java#L3495&lt;/a&gt;&lt;br/&gt;
Where for some reason, the method doCall of the lambda hasGenericInformation() == true, but then it returns a null array when calling getGenericInfo().getParameterTypes().&lt;/p&gt;

&lt;p&gt;See following code from java.lang.reflect.Executable&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Type[] getGenericParameterTypes() {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hasGenericInformation())
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getGenericInfo().getParameterTypes();
        &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getParameterTypes();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;While debugging I tried to call getParameterTypes() and the correct ParameterTypes are returned. &lt;span class=&quot;error&quot;&gt;&amp;#91;Object&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;So for my understanding the lambda actually has no generic information but hasGenericInformation() returns falsely true.&lt;br/&gt;
This method returns true, because the property &lt;tt&gt;signature&lt;/tt&gt; of the doCall method is equal to &lt;tt&gt;&quot;(TT;)V&quot;&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="17629531" author="JIRAUSER295331" created="Sun, 6 Nov 2022 19:01:46 +0000"  >&lt;p&gt;When using the GroovyConsole and looking at the AST Browser following code is generated after class generation:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @groovy.transform.CompileStatic
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testClosure() {
        java.util.function.Consumer c = (java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;lt;T&amp;gt; x) -&amp;gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.print(x)}
        c.accept(&lt;span class=&quot;code-quote&quot;&gt;&apos;hello world!&apos;&lt;/span&gt;)
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Which is clearly not correct and probably the reason why hasGenericInformation() == true&lt;/p&gt;</comment>
                            <comment id="17629549" author="emilles" created="Sun, 6 Nov 2022 21:23:44 +0000"  >&lt;p&gt;Object&amp;lt;T&amp;gt; is probably the representation of the type parameter of Consumer. You can look in STCV and see if lambda param type is set there. You can also vary Consumer to Consumer&amp;lt;?&amp;gt; and Consumer&amp;lt;Object&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17629908" author="JIRAUSER295331" created="Mon, 7 Nov 2022 16:42:39 +0000"  >&lt;p&gt;Both Consumer&amp;lt;?&amp;gt; and Consumer&amp;lt;Object&amp;gt; don&apos;t throw an exception. It only happens if the Consumers type parameter isn&apos;t set and the lambdas parameter type isn&apos;t specified. With STCV you mean StaticTypeCheckingVisitor? I&apos;ll take a look at it.&lt;/p&gt;</comment>
                            <comment id="17629983" author="JIRAUSER295331" created="Mon, 7 Nov 2022 19:29:41 +0000"  >&lt;p&gt;Interestingly, when I add a generic type to the method it works:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@groovy.transform.CompileStatic
&amp;lt;T&amp;gt; void testClosure(){
    java.util.function.Consumer c = x -&amp;gt; print(x)
    c.accept(&lt;span class=&quot;code-quote&quot;&gt;&apos;hello world!&apos;&lt;/span&gt;)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think STC infers following &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.util.function.Consumer&amp;lt;T&amp;gt; c = (T x) -&amp;gt; print(x)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but at runtime, the generic type T isn&apos;t found. (It&apos;s the same if we use another name like &amp;lt;TT&amp;gt; or &amp;lt;ABC&amp;gt;)&lt;br/&gt;
I will try my best with further debugging, but if you have any idea that could help me, I would highly appreciate it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17631028" author="JIRAUSER295331" created="Wed, 9 Nov 2022 12:04:24 +0000"  >&lt;p&gt;I made some progress: &lt;br/&gt;
It looks like the problem is in here, since when I comment it out it works:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/groovy/blob/cb8f8f87966835b57f3acbc877a2252907aed0f4/src/main/java/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java#L1005-L1006&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/blob/cb8f8f87966835b57f3acbc877a2252907aed0f4/src/main/java/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java#L1005-L1006&lt;/a&gt;&lt;br/&gt;
In the debugger, following values for closureParameters &amp;amp; samParameterTypes are displayed:&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13051997/13051997_screenshot-1.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;</comment>
                            <comment id="17631045" author="JIRAUSER295331" created="Wed, 9 Nov 2022 12:35:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt; I&apos;m still unsure if T -&amp;gt; java.lang.Object is the right type for java.util.function.Consumer without setting the typeparameter.&lt;br/&gt;
It feels like this generic &quot;T&quot; is coming from thin air and is then used as the type of the parameter of the lambda.&lt;br/&gt;
Do you think the issue is within here? The NPE only occurs when calling the Consumer&apos;s accept method, so &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.util.function.Consumer c = x -&amp;gt; print(x)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;throws nothing.&lt;/p&gt;</comment>
                            <comment id="17631074" author="emilles" created="Wed, 9 Nov 2022 13:33:57 +0000"  >&lt;p&gt;So if &lt;tt&gt;GenericsUtils#parameterizeSAM(ClassNode)&lt;/tt&gt; returns the erasures for a raw type where applicable, this should be resolved.  Did you want to look into that?&lt;/p&gt;</comment>
                            <comment id="17631083" author="JIRAUSER295331" created="Wed, 9 Nov 2022 13:47:38 +0000"  >&lt;p&gt;Thank you! I will look into it.&lt;/p&gt;</comment>
                            <comment id="17631925" author="githubbot" created="Thu, 10 Nov 2022 21:21:44 +0000"  >&lt;p&gt;Shadow-Devil opened a new pull request, #1824:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/groovy/pull/1824&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1824&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   I&apos;ve added a test case and a fix for the bug reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-10813&quot; title=&quot;Cannot create method reference for print or println&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-10813&quot;&gt;&lt;del&gt;GROOVY-10813&lt;/del&gt;&lt;/a&gt;. &lt;br/&gt;
   I&apos;m not sure if there are any other edge cases that will now break because of this change, but one &lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/groovy/blob/9210cfab6aac681a865c57dd97e96aac73f38fd4/src/test/groovy/transform/stc/GenericsSTCTest.groovy#L740&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/blob/9210cfab6aac681a865c57dd97e96aac73f38fd4/src/test/groovy/transform/stc/GenericsSTCTest.groovy#L740&lt;/a&gt;), that failed with another solution that I tried, passes with this solution.&lt;/p&gt;

</comment>
                            <comment id="17631975" author="githubbot" created="Fri, 11 Nov 2022 00:06:57 +0000"  >&lt;p&gt;eric-milles commented on code in PR #1824:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/groovy/pull/1824#discussion_r1019717220&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1824#discussion_r1019717220&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
src/main/java/org/codehaus/groovy/ast/tools/GenericsUtils.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -950,7 +956,7 @@ public static boolean hasUnresolvedGenerics(final ClassNode type) {&lt;br/&gt;
     public static Tuple2&amp;lt;ClassNode[], ClassNode&amp;gt; parameterizeSAM(final ClassNode samType) {&lt;br/&gt;
         MethodNode abstractMethod = ClassHelper.findSAM(samType);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Map&amp;lt;GenericsType, GenericsType&amp;gt; generics = makeDeclaringAndActualGenericsTypeMapOfExactType(abstractMethod.getDeclaringClass(), samType);&lt;br/&gt;
+        Map&amp;lt;GenericsType, GenericsType&amp;gt; generics = makeDeclaringAndActualGenericsTypeMap(abstractMethod.getDeclaringClass(), samType);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   We have been moving away from `makeDeclaringAndActualGenericsTypeMap` towards `makeDeclaringAndActualGenericsTypeMapOfExactType`.  Can you explain this change?&lt;/p&gt;



&lt;p&gt;##########&lt;br/&gt;
src/main/java/org/codehaus/groovy/ast/tools/GenericsUtils.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -950,7 +956,7 @@ public static boolean hasUnresolvedGenerics(final ClassNode type) {&lt;br/&gt;
     public static Tuple2&amp;lt;ClassNode[], ClassNode&amp;gt; parameterizeSAM(final ClassNode samType) {&lt;br/&gt;
         MethodNode abstractMethod = ClassHelper.findSAM(samType);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Map&amp;lt;GenericsType, GenericsType&amp;gt; generics = makeDeclaringAndActualGenericsTypeMapOfExactType(abstractMethod.getDeclaringClass(), samType);&lt;br/&gt;
+        Map&amp;lt;GenericsType, GenericsType&amp;gt; generics = makeDeclaringAndActualGenericsTypeMap(abstractMethod.getDeclaringClass(), samType);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   Is this the stuff that sits under parametwrizeSAM?  That was the key method for fixing lambda param types.&lt;/p&gt;



&lt;p&gt;##########&lt;br/&gt;
src/main/java/org/codehaus/groovy/ast/tools/GenericsUtils.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -855,10 +855,16 @@ private static Map&amp;lt;GenericsType, GenericsType&amp;gt; doMakeDeclaringAndActualGenericsT&lt;br/&gt;
             GenericsType[] targetGenericsTypes = parameterizedType.redirect().getGenericsTypes();&lt;br/&gt;
             if (targetGenericsTypes != null) {&lt;br/&gt;
                 GenericsType[] sourceGenericsTypes = parameterizedType.getGenericsTypes();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (sourceGenericsTypes == null) sourceGenericsTypes = EMPTY_GENERICS_ARRAY;&lt;br/&gt;
                 map = new LinkedHashMap&amp;lt;&amp;gt;();&lt;/li&gt;
	&lt;li&gt;for (int i = 0, m = sourceGenericsTypes.length, n = targetGenericsTypes.length; i &amp;lt; n; i += 1) {&lt;/li&gt;
	&lt;li&gt;map.put(targetGenericsTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;, i &amp;lt; m ? sourceGenericsTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; : targetGenericsTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;);&lt;br/&gt;
+                if (sourceGenericsTypes == null) {&lt;br/&gt;
+                    //We have no sourceGenerics, so we need to return the erasures for the raw types (Groovy-10813)&lt;br/&gt;
+                    for (GenericsType targetGenericsType : targetGenericsTypes) {&lt;br/&gt;
+                        map.put(targetGenericsType, ClassHelper.OBJECT_TYPE.asGenericsType());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   The erasure type is not always Object.  Can you create an example where it is another type?&lt;/p&gt;


</comment>
                            <comment id="17632210" author="githubbot" created="Fri, 11 Nov 2022 09:36:38 +0000"  >&lt;p&gt;FelixSchnabel commented on code in PR #1824:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/groovy/pull/1824#discussion_r1020045088&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1824#discussion_r1020045088&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
src/main/java/org/codehaus/groovy/ast/tools/GenericsUtils.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -950,7 +956,7 @@ public static boolean hasUnresolvedGenerics(final ClassNode type) {&lt;br/&gt;
     public static Tuple2&amp;lt;ClassNode[], ClassNode&amp;gt; parameterizeSAM(final ClassNode samType) {&lt;br/&gt;
         MethodNode abstractMethod = ClassHelper.findSAM(samType);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Map&amp;lt;GenericsType, GenericsType&amp;gt; generics = makeDeclaringAndActualGenericsTypeMapOfExactType(abstractMethod.getDeclaringClass(), samType);&lt;br/&gt;
+        Map&amp;lt;GenericsType, GenericsType&amp;gt; generics = makeDeclaringAndActualGenericsTypeMap(abstractMethod.getDeclaringClass(), samType);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   I&apos;m sorry, this was a mistake. &lt;br/&gt;
   I will revert this change.&lt;/p&gt;


</comment>
                            <comment id="17632212" author="githubbot" created="Fri, 11 Nov 2022 09:38:43 +0000"  >&lt;p&gt;Shadow-Devil commented on code in PR #1824:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/groovy/pull/1824#discussion_r1020046859&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1824#discussion_r1020046859&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
src/main/java/org/codehaus/groovy/ast/tools/GenericsUtils.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -950,7 +956,7 @@ public static boolean hasUnresolvedGenerics(final ClassNode type) {&lt;br/&gt;
     public static Tuple2&amp;lt;ClassNode[], ClassNode&amp;gt; parameterizeSAM(final ClassNode samType) {&lt;br/&gt;
         MethodNode abstractMethod = ClassHelper.findSAM(samType);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Map&amp;lt;GenericsType, GenericsType&amp;gt; generics = makeDeclaringAndActualGenericsTypeMapOfExactType(abstractMethod.getDeclaringClass(), samType);&lt;br/&gt;
+        Map&amp;lt;GenericsType, GenericsType&amp;gt; generics = makeDeclaringAndActualGenericsTypeMap(abstractMethod.getDeclaringClass(), samType);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   I&apos;m sorry, this change was not intended to be commited, it was just for testing. &lt;br/&gt;
   I will revert it.&lt;/p&gt;


</comment>
                            <comment id="17632381" author="githubbot" created="Fri, 11 Nov 2022 14:27:11 +0000"  >&lt;p&gt;Shadow-Devil commented on code in PR #1824:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/groovy/pull/1824#discussion_r1020265603&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1824#discussion_r1020265603&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
src/main/java/org/codehaus/groovy/ast/tools/GenericsUtils.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -950,7 +956,7 @@ public static boolean hasUnresolvedGenerics(final ClassNode type) {&lt;br/&gt;
     public static Tuple2&amp;lt;ClassNode[], ClassNode&amp;gt; parameterizeSAM(final ClassNode samType) {&lt;br/&gt;
         MethodNode abstractMethod = ClassHelper.findSAM(samType);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Map&amp;lt;GenericsType, GenericsType&amp;gt; generics = makeDeclaringAndActualGenericsTypeMapOfExactType(abstractMethod.getDeclaringClass(), samType);&lt;br/&gt;
+        Map&amp;lt;GenericsType, GenericsType&amp;gt; generics = makeDeclaringAndActualGenericsTypeMap(abstractMethod.getDeclaringClass(), samType);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   &amp;gt; Is this the stuff that sits under parametwrizeSAM? That was the key method for fixing lambda param types.&lt;/p&gt;

&lt;p&gt;   parameterizeSAM uses this makeDeclaringAndActualGenericsTypeMapOfExactType method to map declaring generics to actual generics. I thought that I needed to adjust this mapping so for unresolved generics it will output Object, but I&apos;m still unsure if that&apos;s the right solution (as you mentioned in the other comment). &lt;/p&gt;


</comment>
                            <comment id="17632382" author="githubbot" created="Fri, 11 Nov 2022 14:27:41 +0000"  >&lt;p&gt;Shadow-Devil commented on code in PR #1824:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/groovy/pull/1824#discussion_r1020266114&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1824#discussion_r1020266114&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
src/main/java/org/codehaus/groovy/ast/tools/GenericsUtils.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -855,10 +855,16 @@ private static Map&amp;lt;GenericsType, GenericsType&amp;gt; doMakeDeclaringAndActualGenericsT&lt;br/&gt;
             GenericsType[] targetGenericsTypes = parameterizedType.redirect().getGenericsTypes();&lt;br/&gt;
             if (targetGenericsTypes != null) {&lt;br/&gt;
                 GenericsType[] sourceGenericsTypes = parameterizedType.getGenericsTypes();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (sourceGenericsTypes == null) sourceGenericsTypes = EMPTY_GENERICS_ARRAY;&lt;br/&gt;
                 map = new LinkedHashMap&amp;lt;&amp;gt;();&lt;/li&gt;
	&lt;li&gt;for (int i = 0, m = sourceGenericsTypes.length, n = targetGenericsTypes.length; i &amp;lt; n; i += 1) {&lt;/li&gt;
	&lt;li&gt;map.put(targetGenericsTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;, i &amp;lt; m ? sourceGenericsTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; : targetGenericsTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;);&lt;br/&gt;
+                if (sourceGenericsTypes == null) {&lt;br/&gt;
+                    //We have no sourceGenerics, so we need to return the erasures for the raw types (Groovy-10813)&lt;br/&gt;
+                    for (GenericsType targetGenericsType : targetGenericsTypes) {&lt;br/&gt;
+                        map.put(targetGenericsType, ClassHelper.OBJECT_TYPE.asGenericsType());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   I will try to find an example.&lt;/p&gt;


</comment>
                            <comment id="17632478" author="githubbot" created="Fri, 11 Nov 2022 17:20:07 +0000"  >&lt;p&gt;Shadow-Devil commented on code in PR #1824:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/groovy/pull/1824#discussion_r1020417769&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1824#discussion_r1020417769&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
src/main/java/org/codehaus/groovy/ast/tools/GenericsUtils.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -855,10 +855,16 @@ private static Map&amp;lt;GenericsType, GenericsType&amp;gt; doMakeDeclaringAndActualGenericsT&lt;br/&gt;
             GenericsType[] targetGenericsTypes = parameterizedType.redirect().getGenericsTypes();&lt;br/&gt;
             if (targetGenericsTypes != null) {&lt;br/&gt;
                 GenericsType[] sourceGenericsTypes = parameterizedType.getGenericsTypes();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (sourceGenericsTypes == null) sourceGenericsTypes = EMPTY_GENERICS_ARRAY;&lt;br/&gt;
                 map = new LinkedHashMap&amp;lt;&amp;gt;();&lt;/li&gt;
	&lt;li&gt;for (int i = 0, m = sourceGenericsTypes.length, n = targetGenericsTypes.length; i &amp;lt; n; i += 1) {&lt;/li&gt;
	&lt;li&gt;map.put(targetGenericsTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;, i &amp;lt; m ? sourceGenericsTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; : targetGenericsTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;);&lt;br/&gt;
+                if (sourceGenericsTypes == null) {&lt;br/&gt;
+                    //We have no sourceGenerics, so we need to return the erasures for the raw types (Groovy-10813)&lt;br/&gt;
+                    for (GenericsType targetGenericsType : targetGenericsTypes) {&lt;br/&gt;
+                        map.put(targetGenericsType, ClassHelper.OBJECT_TYPE.asGenericsType());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   I&apos;ve played around with generics in java, but couldn&apos;t find an example where the erasure isn&apos;t of type Object.&lt;br/&gt;
   I&apos;ve also tried something like this:&lt;br/&gt;
   ```java&lt;br/&gt;
   import java.util.function.*&lt;br/&gt;
   interface T&amp;lt;E&amp;gt; extends Function&amp;lt;String, E&amp;gt;{}&lt;br/&gt;
   class TT implements T{&lt;br/&gt;
     @Override&lt;br/&gt;
     Object apply(Object o) &lt;/p&gt;
{
       return null
     }
&lt;p&gt;   }&lt;br/&gt;
   ```&lt;br/&gt;
   and it still loses all type information. Maybe I&apos;m just not advanced enough into generics and how they work. Could you perhaps help me here or give me a resource where to learn more about this? I&apos;ve found some information about the topic &lt;span class=&quot;error&quot;&gt;&amp;#91;here&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://docs.oracle.com/javase/tutorial/java/generics/rawTypes.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/tutorial/java/generics/rawTypes.html&lt;/a&gt;) and &lt;span class=&quot;error&quot;&gt;&amp;#91;here&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://docs.oracle.com/javase/tutorial/java/generics/erasure.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/tutorial/java/generics/erasure.html&lt;/a&gt;)&lt;/p&gt;


</comment>
                            <comment id="17632504" author="githubbot" created="Fri, 11 Nov 2022 18:30:40 +0000"  >&lt;p&gt;Shadow-Devil commented on code in PR #1824:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/groovy/pull/1824#discussion_r1020468865&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1824#discussion_r1020468865&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
src/main/java/org/codehaus/groovy/ast/tools/GenericsUtils.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -855,10 +855,16 @@ private static Map&amp;lt;GenericsType, GenericsType&amp;gt; doMakeDeclaringAndActualGenericsT&lt;br/&gt;
             GenericsType[] targetGenericsTypes = parameterizedType.redirect().getGenericsTypes();&lt;br/&gt;
             if (targetGenericsTypes != null) {&lt;br/&gt;
                 GenericsType[] sourceGenericsTypes = parameterizedType.getGenericsTypes();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (sourceGenericsTypes == null) sourceGenericsTypes = EMPTY_GENERICS_ARRAY;&lt;br/&gt;
                 map = new LinkedHashMap&amp;lt;&amp;gt;();&lt;/li&gt;
	&lt;li&gt;for (int i = 0, m = sourceGenericsTypes.length, n = targetGenericsTypes.length; i &amp;lt; n; i += 1) {&lt;/li&gt;
	&lt;li&gt;map.put(targetGenericsTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;, i &amp;lt; m ? sourceGenericsTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; : targetGenericsTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;);&lt;br/&gt;
+                if (sourceGenericsTypes == null) {&lt;br/&gt;
+                    //We have no sourceGenerics, so we need to return the erasures for the raw types (Groovy-10813)&lt;br/&gt;
+                    for (GenericsType targetGenericsType : targetGenericsTypes) {&lt;br/&gt;
+                        map.put(targetGenericsType, ClassHelper.OBJECT_TYPE.asGenericsType());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   Another example where the type parameter has an upper bound: &lt;br/&gt;
   &#180;&#180;&#180;java&lt;br/&gt;
   interface A&amp;lt;T extends String&amp;gt; extends Function&amp;lt;T, T&amp;gt; {}&lt;br/&gt;
   class B implements A{&lt;br/&gt;
       @Override&lt;br/&gt;
       Object apply(Object input) &lt;/p&gt;
{
           return null
       }
&lt;p&gt;   }&lt;br/&gt;
   &#180;&#180;&#180;&lt;/p&gt;


</comment>
                            <comment id="17632505" author="githubbot" created="Fri, 11 Nov 2022 18:31:00 +0000"  >&lt;p&gt;Shadow-Devil commented on code in PR #1824:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/groovy/pull/1824#discussion_r1020468865&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1824#discussion_r1020468865&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
src/main/java/org/codehaus/groovy/ast/tools/GenericsUtils.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -855,10 +855,16 @@ private static Map&amp;lt;GenericsType, GenericsType&amp;gt; doMakeDeclaringAndActualGenericsT&lt;br/&gt;
             GenericsType[] targetGenericsTypes = parameterizedType.redirect().getGenericsTypes();&lt;br/&gt;
             if (targetGenericsTypes != null) {&lt;br/&gt;
                 GenericsType[] sourceGenericsTypes = parameterizedType.getGenericsTypes();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (sourceGenericsTypes == null) sourceGenericsTypes = EMPTY_GENERICS_ARRAY;&lt;br/&gt;
                 map = new LinkedHashMap&amp;lt;&amp;gt;();&lt;/li&gt;
	&lt;li&gt;for (int i = 0, m = sourceGenericsTypes.length, n = targetGenericsTypes.length; i &amp;lt; n; i += 1) {&lt;/li&gt;
	&lt;li&gt;map.put(targetGenericsTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;, i &amp;lt; m ? sourceGenericsTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; : targetGenericsTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;);&lt;br/&gt;
+                if (sourceGenericsTypes == null) {&lt;br/&gt;
+                    //We have no sourceGenerics, so we need to return the erasures for the raw types (Groovy-10813)&lt;br/&gt;
+                    for (GenericsType targetGenericsType : targetGenericsTypes) {&lt;br/&gt;
+                        map.put(targetGenericsType, ClassHelper.OBJECT_TYPE.asGenericsType());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   Another example where the type parameter has an upper bound: &lt;br/&gt;
   ```java&lt;br/&gt;
   interface A&amp;lt;T extends String&amp;gt; extends Function&amp;lt;T, T&amp;gt; {}&lt;br/&gt;
   class B implements A{&lt;br/&gt;
       @Override&lt;br/&gt;
       Object apply(Object input) &lt;/p&gt;
{
           return null
       }
&lt;p&gt;   }&lt;br/&gt;
   ```&lt;/p&gt;


</comment>
                            <comment id="17632506" author="githubbot" created="Fri, 11 Nov 2022 18:32:35 +0000"  >&lt;p&gt;Shadow-Devil commented on code in PR #1824:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/groovy/pull/1824#discussion_r1020470376&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1824#discussion_r1020470376&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
src/main/java/org/codehaus/groovy/ast/tools/GenericsUtils.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -855,10 +855,16 @@ private static Map&amp;lt;GenericsType, GenericsType&amp;gt; doMakeDeclaringAndActualGenericsT&lt;br/&gt;
             GenericsType[] targetGenericsTypes = parameterizedType.redirect().getGenericsTypes();&lt;br/&gt;
             if (targetGenericsTypes != null) {&lt;br/&gt;
                 GenericsType[] sourceGenericsTypes = parameterizedType.getGenericsTypes();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (sourceGenericsTypes == null) sourceGenericsTypes = EMPTY_GENERICS_ARRAY;&lt;br/&gt;
                 map = new LinkedHashMap&amp;lt;&amp;gt;();&lt;/li&gt;
	&lt;li&gt;for (int i = 0, m = sourceGenericsTypes.length, n = targetGenericsTypes.length; i &amp;lt; n; i += 1) {&lt;/li&gt;
	&lt;li&gt;map.put(targetGenericsTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;, i &amp;lt; m ? sourceGenericsTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; : targetGenericsTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;);&lt;br/&gt;
+                if (sourceGenericsTypes == null) {&lt;br/&gt;
+                    //We have no sourceGenerics, so we need to return the erasures for the raw types (Groovy-10813)&lt;br/&gt;
+                    for (GenericsType targetGenericsType : targetGenericsTypes) {&lt;br/&gt;
+                        map.put(targetGenericsType, ClassHelper.OBJECT_TYPE.asGenericsType());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   Uh, now I got an example, that has not Object as its type:&lt;br/&gt;
   ```java&lt;br/&gt;
   interface A&amp;lt;T extends String&amp;gt; &lt;/p&gt;
{
       T apply(T input);
   }
&lt;p&gt;   class B implements A{&lt;br/&gt;
       @Override&lt;br/&gt;
       String apply(String input) &lt;/p&gt;
{
           return null
       }
&lt;p&gt;   }&lt;br/&gt;
   ```&lt;/p&gt;


</comment>
                            <comment id="17633280" author="githubbot" created="Sun, 13 Nov 2022 12:00:24 +0000"  >&lt;p&gt;Shadow-Devil commented on code in PR #1824:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/groovy/pull/1824#discussion_r1020890479&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1824#discussion_r1020890479&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
src/main/java/org/codehaus/groovy/ast/tools/GenericsUtils.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -855,10 +855,16 @@ private static Map&amp;lt;GenericsType, GenericsType&amp;gt; doMakeDeclaringAndActualGenericsT&lt;br/&gt;
             GenericsType[] targetGenericsTypes = parameterizedType.redirect().getGenericsTypes();&lt;br/&gt;
             if (targetGenericsTypes != null) {&lt;br/&gt;
                 GenericsType[] sourceGenericsTypes = parameterizedType.getGenericsTypes();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (sourceGenericsTypes == null) sourceGenericsTypes = EMPTY_GENERICS_ARRAY;&lt;br/&gt;
                 map = new LinkedHashMap&amp;lt;&amp;gt;();&lt;/li&gt;
	&lt;li&gt;for (int i = 0, m = sourceGenericsTypes.length, n = targetGenericsTypes.length; i &amp;lt; n; i += 1) {&lt;/li&gt;
	&lt;li&gt;map.put(targetGenericsTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;, i &amp;lt; m ? sourceGenericsTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; : targetGenericsTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;);&lt;br/&gt;
+                if (sourceGenericsTypes == null) {&lt;br/&gt;
+                    //We have no sourceGenerics, so we need to return the erasures for the raw types (Groovy-10813)&lt;br/&gt;
+                    for (GenericsType targetGenericsType : targetGenericsTypes) {&lt;br/&gt;
+                        map.put(targetGenericsType, ClassHelper.OBJECT_TYPE.asGenericsType());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   I&apos;ve added some tests that have an upper bound. I was a bit suprised that `T extends String &amp;amp; Object` just selects the first one when you use raw types, so the result is different from `T extends Object &amp;amp; String`&lt;/p&gt;


</comment>
                            <comment id="17635924" author="githubbot" created="Fri, 18 Nov 2022 15:48:02 +0000"  >&lt;p&gt;eric-milles commented on PR #1824:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/groovy/pull/1824#issuecomment-1320201876&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1824#issuecomment-1320201876&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   I relocated the lambda tests and reworked the generics tests to ensure the placeholders are not returned.&lt;/p&gt;

&lt;p&gt;   &lt;a href=&quot;https://github.com/apache/groovy/commit/ef9b58463e83f842b56f24dff0ac4df0e02f112f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/ef9b58463e83f842b56f24dff0ac4df0e02f112f&lt;/a&gt;&lt;/p&gt;

</comment>
                            <comment id="17635925" author="githubbot" created="Fri, 18 Nov 2022 15:48:03 +0000"  >&lt;p&gt;eric-milles closed pull request #1824: &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-10813&quot; title=&quot;Cannot create method reference for print or println&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-10813&quot;&gt;&lt;del&gt;GROOVY-10813&lt;/del&gt;&lt;/a&gt;: Fix NullPointerException for lambdas with raw types&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/groovy/pull/1824&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1824&lt;/a&gt;&lt;/p&gt;

</comment>
                            <comment id="17637260" author="JIRAUSER295331" created="Tue, 22 Nov 2022 13:27:52 +0000"  >&lt;p&gt;About the second part of this issue (method reference) I found something interesting while debugging the example:&lt;br/&gt;
Following methods are found to be used for this::print&lt;br/&gt;
1. Object.print() (extension method)&lt;br/&gt;
2. Script.print() (not an extension method)&lt;/p&gt;

&lt;p&gt;To decide which method is chosen, there is a &quot;score&quot; calculated in &lt;a href=&quot;#L411]&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;here&lt;/a&gt;&#160;&lt;b&gt;which adds a score of 100 to extension methods&lt;/b&gt;.&lt;br/&gt;
The final score of the two methods are:&lt;br/&gt;
1. Object.print() 190&lt;br/&gt;
2. Script.print() 79&lt;br/&gt;
So the first one is selected, but it would be correct to select Script.print. At least for me, it would make more sense that Script.print() is selected.&lt;/p&gt;</comment>
                            <comment id="17637284" author="JIRAUSER295331" created="Tue, 22 Nov 2022 14:19:01 +0000"  >&lt;p&gt;I also tried it with the following code&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@groovy.transform.CompileStatic
void p() {
  java.util.function.Consumer c = &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;::print
  c.accept(&lt;span class=&quot;code-quote&quot;&gt;&apos;hello world!&apos;&lt;/span&gt;)
}
p() &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but this does not compile since Object.print is not found. I thought that Extension methods would be static but apparently they aren&apos;t.&lt;/p&gt;

&lt;p&gt;One example that works:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@groovy.transform.CompileStatic
void p() {
  &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; x = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
  java.util.function.Consumer c = x::print
  c.accept(&lt;span class=&quot;code-quote&quot;&gt;&apos;hello world!&apos;&lt;/span&gt;)
}
p()&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;since the not static Extension method is correctly selected.&lt;/p&gt;</comment>
                            <comment id="17637315" author="emilles" created="Tue, 22 Nov 2022 15:16:38 +0000"  >&lt;p&gt;&amp;gt; Object#print vs. Script#print&lt;/p&gt;

&lt;p&gt;If you write the test case as a class does &quot;Consumer c = this::print; c.accept(&apos;hello world!&apos;)&quot; work?&lt;/p&gt;

&lt;p&gt;&amp;gt; Object::print&lt;/p&gt;

&lt;p&gt;It is supposed to be possible to reference extension methods this way.  There are a number of tests and I worked on some of the fixes for some of the edge cases.  &quot;print&quot; and &quot;println&quot; are so overloaded, it is not surprising that it does not work.  If you try out another extension method of Object and it fails as well, a new issue ticket should be created.&lt;/p&gt;</comment>
                            <comment id="17637322" author="JIRAUSER295331" created="Tue, 22 Nov 2022 15:29:49 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;A{
    @groovy.transform.CompileStatic
    void p() {
        java.util.function.Consumer c = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;::print
        c.accept(&lt;span class=&quot;code-quote&quot;&gt;&apos;hello world!&apos;&lt;/span&gt;)
    }
}
A a = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; A()
a.p()&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;produces: Type mismatch in captured lambda parameter 0: expecting class A, found class java.lang.Object&lt;/p&gt;

&lt;p&gt;So it still doesn&apos;t work.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;ll look for other extension methods and share my results in the next days.&lt;/p&gt;</comment>
                            <comment id="17637325" author="emilles" created="Tue, 22 Nov 2022 15:34:23 +0000"  >&lt;p&gt;Class &lt;tt&gt;A&lt;/tt&gt; still sits inside a script in your example.  This is just a class:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;A {
    static main(args) {
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; A().p()
    }
    @groovy.transform.CompileStatic
    void p() {
        java.util.function.Consumer c = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;::print
        c.accept(&lt;span class=&quot;code-quote&quot;&gt;&apos;hello world!&apos;&lt;/span&gt;)
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17637329" author="JIRAUSER295331" created="Tue, 22 Nov 2022 15:40:52 +0000"  >&lt;p&gt;But is it okay to run it inside a test via assertScript?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
assertScript &apos;&apos;&apos;
    &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;A {
        &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; main(args) {
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; A().p()
        }
        @groovy.transform.CompileStatic
        void p() {
            java.util.function.Consumer c = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;::print
            c.accept(&lt;span class=&quot;code-quote&quot;&gt;&apos;hello world!&apos;&lt;/span&gt;)
        }
    }
&apos;&apos;&apos; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If yes, there is still the same problem.&lt;/p&gt;

&lt;p&gt;I also tried it in a Groovy Console, but I only have version 4.0.2 installed and there another exception is thrown.&lt;/p&gt;</comment>
                            <comment id="17637353" author="JIRAUSER295331" created="Tue, 22 Nov 2022 16:20:20 +0000"  >&lt;p&gt;I didn&apos;t even have to try many extension methods to find some that don&apos;t work:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@groovy.transform.CompileStatic
void p() {
    java.util.function.Supplier&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; c = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;::toString
    c.get()
}
p()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@groovy.transform.CompileStatic
void p() {
    java.util.function.Function&amp;lt;Closure&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; c = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;::with
    c.apply({print(&lt;span class=&quot;code-quote&quot;&gt;&quot;works&quot;&lt;/span&gt;)})
}
p()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&apos;ve found none that work with &lt;tt&gt;this&lt;/tt&gt; as the receiver. &lt;br/&gt;
They all throw this &lt;tt&gt;Type mismatch in captured lambda parameter 0: expecting class Script, found class java.lang.Object&lt;/tt&gt; exception.&lt;/p&gt;

&lt;p&gt;Also the following throws another exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@groovy.transform.CompileStatic
void p() {
    java.util.function.Supplier&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; c = &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;::toString
    c.get()
}
p()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;throws this exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed:
TestScripttestGroovy10813_50.groovy: 5: Failed to find the expected method[toString()] in the type[java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;] @ line 5, column 57.
&#160; &#160;function.Supplier&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; c = &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;::to
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;^1 error&#160; &#160; 
    at app&lt;span class=&quot;code-comment&quot;&gt;//org.codehaus.groovy.control.ErrorCollector.failIfErrors(ErrorCollector.java:292)
&lt;/span&gt;&#160; &#160; at app&lt;span class=&quot;code-comment&quot;&gt;//org.codehaus.groovy.control.CompilationUnit$IPrimaryClassNodeOperation.doPhaseOperation(CompilationUnit.java:979)
&lt;/span&gt;&#160; &#160; at app&lt;span class=&quot;code-comment&quot;&gt;//org.codehaus.groovy.control.CompilationUnit.processPhaseOperations(CompilationUnit.java:692)
&lt;/span&gt;&#160; &#160; at app&lt;span class=&quot;code-comment&quot;&gt;//org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:666)
&lt;/span&gt;&#160; &#160; at app&lt;span class=&quot;code-comment&quot;&gt;//groovy.lang.GroovyClassLoader.doParseClass(GroovyClassLoader.java:373)
&lt;/span&gt;&#160; &#160; at app&lt;span class=&quot;code-comment&quot;&gt;//groovy.lang.GroovyClassLoader.lambda$parseClass$2(GroovyClassLoader.java:316)
&lt;/span&gt;&#160; &#160; at app&lt;span class=&quot;code-comment&quot;&gt;//org.codehaus.groovy.runtime.memoize.StampedCommonCache.compute(StampedCommonCache.java:163)
&lt;/span&gt;&#160; &#160; at app&lt;span class=&quot;code-comment&quot;&gt;//org.codehaus.groovy.runtime.memoize.StampedCommonCache.getAndPut(StampedCommonCache.java:154)
&lt;/span&gt;&#160; &#160; at app&lt;span class=&quot;code-comment&quot;&gt;//groovy.lang.GroovyClassLoader.parseClass(GroovyClassLoader.java:314)
&lt;/span&gt;&#160; &#160; at app&lt;span class=&quot;code-comment&quot;&gt;//groovy.lang.GroovyShell.parseClass(GroovyShell.java:572)
&lt;/span&gt;&#160; &#160; at app&lt;span class=&quot;code-comment&quot;&gt;//groovy.lang.GroovyShell.parse(GroovyShell.java:585)
&lt;/span&gt;&#160; &#160; at app&lt;span class=&quot;code-comment&quot;&gt;//groovy.lang.GroovyShell.parse(GroovyShell.java:597)
&lt;/span&gt;&#160; &#160; at app&lt;span class=&quot;code-comment&quot;&gt;//groovy.lang.GroovyShell.evaluate(GroovyShell.java:459)
&lt;/span&gt;&#160; &#160; at app&lt;span class=&quot;code-comment&quot;&gt;//groovy.lang.GroovyShell.evaluate(GroovyShell.java:495)
&lt;/span&gt;&#160; &#160; at app&lt;span class=&quot;code-comment&quot;&gt;//groovy.lang.GroovyShell.evaluate(GroovyShell.java:479)
&lt;/span&gt;&#160; &#160; at app&lt;span class=&quot;code-comment&quot;&gt;//groovy.transform.stc.StaticTypeCheckingTestCase.assertScript(StaticTypeCheckingTestCase.groovy:74) &lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So this means, you should probably create a new ticket for this? I&apos;m not sure how I can create one by myself.&lt;/p&gt;</comment>
                            <comment id="17637391" author="emilles" created="Tue, 22 Nov 2022 18:00:21 +0000"  >&lt;p&gt;There are no test cases for &quot;this::dgm&quot; or &quot;this::dgsm&quot; but there is one for &quot;Object::toString&quot;.&lt;/p&gt;

&lt;p&gt;&amp;gt; Supplier&amp;lt;String&amp;gt; s = Object::toString()&lt;/p&gt;

&lt;p&gt;This should fail STC because the functional (SAM) type should have 1 parameter, but Supplier has 0.  Not sure if the DGM gets in the way.&lt;/p&gt;</comment>
                            <comment id="17637407" author="JIRAUSER295331" created="Tue, 22 Nov 2022 18:26:21 +0000"  >&lt;p&gt;You are correct, following works:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@groovy.transform.CompileStatic
void p() {
    java.util.function.Function c = &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;::toString
    c.apply(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;)
}
p() &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17637410" author="JIRAUSER295331" created="Tue, 22 Nov 2022 18:30:56 +0000"  >&lt;p&gt;But this should probably not work right?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@groovy.transform.CompileStatic
void p() {
    java.util.function.Function&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; c = &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;::toString
    c.apply(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;)
}
p() &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The STC should know the return type of Object::toString to be String.&#160;&lt;/p&gt;</comment>
                            <comment id="17637428" author="emilles" created="Tue, 22 Nov 2022 19:15:14 +0000"  >&lt;p&gt;These should be STC errors:&lt;br/&gt;
&amp;gt; Supplier&amp;lt;String&amp;gt; s = Object::toString&lt;br/&gt;
&amp;gt; Function&amp;lt;Object, Integer&amp;gt; c = Object::toString&lt;/p&gt;

&lt;p&gt;We&apos;d have to see why they are not.&lt;/p&gt;</comment>
                            <comment id="17640128" author="emilles" created="Mon, 28 Nov 2022 16:35:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/657c8e5395d1343775669a425167c78dcd9ac220&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/657c8e5395d1343775669a425167c78dcd9ac220&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13507862">GROOVY-10858</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13051997" name="screenshot-1.png" size="14481" author="felix_schnabel" created="Wed, 9 Nov 2022 12:04:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 50 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1b0ko:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>