<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:12:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-10033] Compiler crash when encountering function reference on nested class</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-10033</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The following program&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; Foo(Closure&amp;lt;Foo, Bar&amp;gt; x) {}
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Bar {
    Bar(Foo x) {}
}

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;X &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Foo {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; X() {
        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;(Y::&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Y &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Bar {
        Y(Foo x) {
            &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;(x);
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;crashes the compiler with a NullPointerException&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed:
General error during instruction selection: NullPointerException &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; processing test.groovy. test.groovygroovy.lang.GroovyRuntimeException: NullPointerException &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; processing test.groovy. test.groovy
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitClass(AsmClassGenerator.java:348)
        at org.codehaus.groovy.control.CompilationUnit$3.call(CompilationUnit.java:783)
        at org.codehaus.groovy.control.CompilationUnit$IPrimaryClassNodeOperation.doPhaseOperation(CompilationUnit.java:928)
        at org.codehaus.groovy.control.CompilationUnit.processPhaseOperations(CompilationUnit.java:657)
        at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:634)
        at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:609)
        at org.codehaus.groovy.tools.FileSystemCompiler.compile(FileSystemCompiler.java:311)
        at org.codehaus.groovy.tools.FileSystemCompiler.doCompilation(FileSystemCompiler.java:240)
        at org.codehaus.groovy.tools.FileSystemCompiler.commandLineCompile(FileSystemCompiler.java:165)
        at org.codehaus.groovy.tools.FileSystemCompiler.commandLineCompileWithErrorHandling(FileSystemCompiler.java:205)
        at org.codehaus.groovy.tools.FileSystemCompiler.main(FileSystemCompiler.java:189)
Caused by: java.lang.NullPointerException
        at org.codehaus.groovy.classgen.asm.sc.StaticTypesMethodReferenceExpressionWriter.createParametersWithExactType(StaticTypesMethodReferenceExpressionWriter.java:255)
        at org.codehaus.groovy.classgen.asm.sc.StaticTypesMethodReferenceExpressionWriter.writeMethodReferenceExpression(StaticTypesMethodReferenceExpressionWriter.java:97)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitMethodReferenceExpression(AsmClassGenerator.java:844)
        at org.codehaus.groovy.ast.expr.MethodReferenceExpression.visit(MethodReferenceExpression.java:34)
        at org.codehaus.groovy.classgen.asm.sc.StaticInvocationWriter.visitArgument(StaticInvocationWriter.java:517)
        at org.codehaus.groovy.classgen.asm.sc.StaticInvocationWriter.loadArguments(StaticInvocationWriter.java:464)
        at org.codehaus.groovy.classgen.asm.sc.StaticInvocationWriter.writeSpecialConstructorCall(StaticInvocationWriter.java:212)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitConstructorCallExpression(AsmClassGenerator.java:917)
        at org.codehaus.groovy.ast.expr.ConstructorCallExpression.visit(ConstructorCallExpression.java:45)
        at org.codehaus.groovy.classgen.asm.StatementWriter.writeExpressionStatement(StatementWriter.java:602)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitExpressionStatement(AsmClassGenerator.java:744)
        at org.codehaus.groovy.ast.stmt.ExpressionStatement.visit(ExpressionStatement.java:41)
        at org.codehaus.groovy.classgen.asm.StatementWriter.writeBlockStatement(StatementWriter.java:92)
        at org.codehaus.groovy.classgen.asm.sc.StaticTypesStatementWriter.writeBlockStatement(StaticTypesStatementWriter.java:78)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitBlockStatement(AsmClassGenerator.java:675)
        at org.codehaus.groovy.ast.stmt.BlockStatement.visit(BlockStatement.java:70)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitStdMethod(AsmClassGenerator.java:516)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitConstructorOrMethod(AsmClassGenerator.java:461)
        at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitConstructor(ClassCodeVisitorSupport.java:101)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitConstructor(AsmClassGenerator.java:608)
        at org.codehaus.groovy.ast.ClassNode.visitContents(ClassNode.java:1097)
        at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitClass(ClassCodeVisitorSupport.java:52)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitClass(AsmClassGenerator.java:325)
        ... 10 more1 error

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Tested against &lt;a href=&quot;https://github.com/apache/groovy/commit/e64215983ea4b7c277eb01a1ed3fcac43976be9c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/e64215983ea4b7c277eb01a1ed3fcac43976be9c&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13371776">GROOVY-10033</key>
            <summary>Compiler crash when encountering function reference on nested class</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="theosot">Thodoris Sotiropoulos</reporter>
                        <labels>
                    </labels>
                <created>Mon, 12 Apr 2021 11:56:12 +0000</created>
                <updated>Thu, 3 Feb 2022 22:34:45 +0000</updated>
                            <resolved>Mon, 26 Apr 2021 12:44:30 +0000</resolved>
                                                    <fixVersion>4.0.0-beta-1</fixVersion>
                    <fixVersion>3.0.9</fixVersion>
                                    <component>Static compilation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17323991" author="emilles" created="Fri, 16 Apr 2021 17:38:54 +0000"  >&lt;p&gt;I am unable to recreate.  Do you have more details or a more complete example project?&lt;/p&gt;</comment>
                            <comment id="17325745" author="theosot" created="Tue, 20 Apr 2021 12:20:55 +0000"  >&lt;p&gt;Yes, you are right. I have updated the bug-revealing program, and now `groovyc` crashes&lt;/p&gt;</comment>
                            <comment id="17325946" author="emilles" created="Tue, 20 Apr 2021 16:34:50 +0000"  >&lt;p&gt;Can you try again with master?  There should now be a compiler error for mismatched generics on the constructor parameter.&lt;/p&gt;</comment>
                            <comment id="17326444" author="theosot" created="Wed, 21 Apr 2021 11:38:57 +0000"  >&lt;p&gt;Yes, now groovyc catches the error.&lt;/p&gt;

&lt;p&gt;But please note that when replacing `Closure&amp;lt;Foo, Bar&amp;gt;` with `Function&amp;lt;Foo, Bar&amp;gt;` from `java.util.function.Function`, groovyc crashes again.&lt;/p&gt;</comment>
                            <comment id="17326595" author="emilles" created="Wed, 21 Apr 2021 14:45:50 +0000"  >&lt;p&gt;The &lt;tt&gt;java.util.function.Function&lt;/tt&gt; case fails for a different reason.  I&apos;m looking into the mapping of method reference to method to see if there is a missing bit of validation.&lt;/p&gt;</comment>
                            <comment id="17326724" author="emilles" created="Wed, 21 Apr 2021 16:59:35 +0000"  >&lt;p&gt;The conversion from method closure to true method reference was missing for constructor and static method calls.  Can you retest against master?&lt;/p&gt;</comment>
                            <comment id="17326850" author="theosot" created="Wed, 21 Apr 2021 19:21:39 +0000"  >&lt;p&gt;Now, I get a different internal compiler error. See below&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
General error during instruction selection: Internal compiler error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; compiling test.groovy
Method: org.codehaus.groovy.ast.MethodNode@6bd51ed8[X#X$Y ctorRef$0(Foo)]
Line -1, expecting casting to X$Y but operand stack is emptyjava.lang.ArrayIndexOutOfBoundsException: Internal compiler error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; compiling test.groovy
Method: org.codehaus.groovy.ast.MethodNode@6bd51ed8[X#X$Y ctorRef$0(Foo)]
Line -1, expecting casting to X$Y but operand stack is empty
        at org.codehaus.groovy.classgen.asm.OperandStack.throwExceptionForNoStackElement(OperandStack.java:326)
        at org.codehaus.groovy.classgen.asm.OperandStack.doConvertAndCast(OperandStack.java:331)
        at org.codehaus.groovy.classgen.asm.OperandStack.doGroovyCast(OperandStack.java:296)
        at org.codehaus.groovy.classgen.asm.StatementWriter.writeReturn(StatementWriter.java:582)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitReturnStatement(AsmClassGenerator.java:739)
        at org.codehaus.groovy.ast.stmt.ReturnStatement.visit(ReturnStatement.java:73)
        at org.codehaus.groovy.classgen.asm.StatementWriter.writeBlockStatement(StatementWriter.java:92)
        at org.codehaus.groovy.classgen.asm.sc.StaticTypesStatementWriter.writeBlockStatement(StaticTypesStatementWriter.java:78)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitBlockStatement(AsmClassGenerator.java:675)
        at org.codehaus.groovy.ast.stmt.BlockStatement.visit(BlockStatement.java:70)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitStdMethod(AsmClassGenerator.java:516)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitConstructorOrMethod(AsmClassGenerator.java:461)
        at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitMethod(ClassCodeVisitorSupport.java:106)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitMethod(AsmClassGenerator.java:614)
        at org.codehaus.groovy.ast.ClassNode.visitMethods(ClassNode.java:1106)
        at org.codehaus.groovy.ast.ClassNode.visitContents(ClassNode.java:1099)
        at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitClass(ClassCodeVisitorSupport.java:52)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitClass(AsmClassGenerator.java:325)
        at org.codehaus.groovy.control.CompilationUnit$3.call(CompilationUnit.java:783)
        at org.codehaus.groovy.control.CompilationUnit$IPrimaryClassNodeOperation.doPhaseOperation(CompilationUnit.java:928)
        at org.codehaus.groovy.control.CompilationUnit.processPhaseOperations(CompilationUnit.java:657)
        at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:634)
        at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:609)
        at org.codehaus.groovy.tools.FileSystemCompiler.compile(FileSystemCompiler.java:311)
        at org.codehaus.groovy.tools.FileSystemCompiler.doCompilation(FileSystemCompiler.java:240)
        at org.codehaus.groovy.tools.FileSystemCompiler.commandLineCompile(FileSystemCompiler.java:165)
        at org.codehaus.groovy.tools.FileSystemCompiler.commandLineCompileWithErrorHandling(FileSystemCompiler.java:205)
        at org.codehaus.groovy.tools.FileSystemCompiler.main(FileSystemCompiler.java:189)1 error

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17326854" author="emilles" created="Wed, 21 Apr 2021 19:28:11 +0000"  >&lt;p&gt;Can you change your inner class Y to static?  You have an inferred parameter for the outer class reference, so the constructor reference does not line up.&lt;/p&gt;</comment>
                            <comment id="17326871" author="theosot" created="Wed, 21 Apr 2021 19:43:36 +0000"  >&lt;p&gt;I performed the following change and the compiler still crashes with the same error.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
17c17
&amp;lt;     &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Y &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Bar {
---
&amp;gt;     &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Y &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Bar {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17329210" author="emilles" created="Thu, 22 Apr 2021 15:40:09 +0000"  >&lt;p&gt;I fixed the issue where the containing class of a constructor reference is statically compiled.&#160; There still is no warning if the functional interface does not match to a constructor of the target type (as far as I can tell), but that would be a separate issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 29 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0pw28:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>