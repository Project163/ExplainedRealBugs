<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:11:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-3405] static methods added through metaClass can&apos;t have default values for parameters</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-3405</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I&apos;m running into an issue with Groovy 1.6 trying to add a static method to the metaClass where the closure for the method has some parameters with default values.&lt;/p&gt;

&lt;p&gt;When trying to call the method and not supplying some default values, it doesn&apos;t find the newly added method and instead throws a MissingMethodException.&lt;/p&gt;

&lt;p&gt;Default parameters work fine with a class where the static method is defined directly on the class, both through using a closure as well as a normal method definition:&lt;/p&gt;

&lt;p&gt;    class MyClass {&lt;br/&gt;
        def testInstance(first = &quot;foo&quot;) &lt;/p&gt;
{
            return &quot;$first&quot;
        }&lt;br/&gt;
    &lt;br/&gt;
        static testStatic(first = &quot;foo&quot;) {            return &quot;$first&quot;        }

&lt;p&gt;        static testStaticClosure = &lt;/p&gt;
{ first = &quot;foo&quot; -&amp;gt;
            return &quot;$first&quot;
        }
&lt;p&gt;    &lt;/p&gt;

&lt;p&gt;        static testStaticTwoParms(first = &quot;foo&quot;, second = &quot;bar&quot;) &lt;/p&gt;
{
            return &quot;$first - $second&quot;
        }

&lt;p&gt;        static testStaticTwoParmsClosure = &lt;/p&gt;
{ first = &quot;foo&quot;, second = &quot;bar&quot; -&amp;gt;
            return &quot;$first - $second&quot;
        }
&lt;p&gt;    &lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;    assert &quot;foo&quot; == new MyClass().testInstance()&lt;br/&gt;
    assert &quot;foo&quot; ==  MyClass.testStatic()&lt;br/&gt;
    assert &quot;foo&quot; ==  MyClass.testStaticClosure()&lt;br/&gt;
    assert &quot;foo - bar&quot; == MyClass.testStaticTwoParms()&lt;br/&gt;
    assert &quot;foo - bar&quot; == MyClass.testStaticTwoParmsClosure()&lt;/p&gt;


&lt;p&gt;Using the metaClass, it works fine to add instance methods with single or multiple defaulted values:&lt;/p&gt;

&lt;p&gt;    String.metaClass.testInstance = &lt;/p&gt;
{ first = &quot;foo&quot; -&amp;gt;
        return &quot;$first&quot;
    }&lt;br/&gt;
        &lt;br/&gt;
    assert &quot;foo&quot; ==  &quot;&quot;.testInstance()  // works as expected&lt;br/&gt;
    &lt;br/&gt;
    String.metaClass.testInstanceTwoParams = { first = &quot;foo&quot;, second = &quot;bar&quot; -&amp;gt;
        return &quot;$first - $second&quot;
    }&lt;br/&gt;
    &lt;br/&gt;
    assert &quot;foo - bar&quot; == &quot;&quot;.testInstanceTwoParams()  // also works as expected&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
But when a static method is added to a class via the metaClass, a single default parameter doesn&apos;t use the default value for the paramter, it has a null value:&lt;br/&gt;
    &lt;br/&gt;
    String.metaClass.&apos;static&apos;.testStatic = { first = &quot;foo&quot; -&amp;gt;        return &quot;$first&quot;    }

&lt;p&gt;    assert &quot;qux&quot; ==  &quot;&quot;.testStatic(&quot;qux&quot;) // works if you specify a parameter&lt;br/&gt;
    assert &quot;foo&quot; == &quot;&quot;.testStatic() // Fails!  &quot;foo&quot; isn&apos;t returned, instead it returns a null value&lt;/p&gt;

&lt;p&gt;It gets weirder if you try to specify two defaulted parameters on the static closure.  Instead of just not assigning values to the parameters, it doesn&apos;t even find the method and throws a MissingMethodException:&lt;/p&gt;

&lt;p&gt;    String.metaClass.&apos;static&apos;.testStaticTwoParams = &lt;/p&gt;
{ first = &quot;foo&quot;, second = &quot;bar&quot; -&amp;gt;
        return &quot;$first - $second&quot;
    }

&lt;p&gt;    assert &quot;baz - qux&quot; == &quot;&quot;.testStaticTwoParams(&quot;baz&quot;, &quot;qux&quot;)  // works if you specify parameters&lt;br/&gt;
    assert &quot;baz - bar&quot; == &quot;&quot;.testStaticTwoParams(&quot;baz&quot;) // Fails with MissingMethodException!&lt;br/&gt;
    assert &quot;foo - bar&quot; ==  &quot;&quot;.testStaticTwoParams()  // Fails with MissingMethodException!  Not finding method with defaulted pararameters&lt;/p&gt;


&lt;p&gt;This is seen in groovy 1.6.0:&lt;/p&gt;

&lt;p&gt;% groovy -version&lt;br/&gt;
Groovy Version: 1.6.0 JVM: 1.6.0_07&lt;/p&gt;

&lt;p&gt;I also tested this code against 1.5.7 and it exhibits the same behavior, but is also broken for metaClass added instance methods with defaulted values, which work in 1.6.   Hopefully whatever was changed in 1.6 to fix that can also be applied to class level static methods.&lt;/p&gt;</description>
                <environment>This is seen in groovy 1.6.0 on Leopard:&lt;br/&gt;
&lt;br/&gt;
% groovy -version&lt;br/&gt;
Groovy Version: 1.6.0 JVM: 1.6.0_07</environment>
        <key id="12814636">GROOVY-3405</key>
            <summary>static methods added through metaClass can&apos;t have default values for parameters</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roshandawrani">Roshan Dawrani</assignee>
                                    <reporter username="tednaleid">Ted Naleid</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 Mar 2009 18:54:02 +0000</created>
                <updated>Tue, 7 Apr 2009 23:33:17 +0000</updated>
                            <resolved>Sat, 14 Mar 2009 08:31:56 +0000</resolved>
                                    <version>1.6</version>
                                    <fixVersion>1.6.1</fixVersion>
                    <fixVersion>1.7-beta-1</fixVersion>
                                    <component>class generator</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14466666" author="roshandawrani" created="Fri, 13 Mar 2009 15:02:03 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
    Attaching a patch to solve the reported issue.&lt;/p&gt;

&lt;p&gt;There was a problem with registering closure with default parameters as static methods with EMC.&lt;/p&gt;

&lt;p&gt;So, say, if a closure has one parameter, which has default value, it had 2 doCall() methods - doCall() and doCall(Object).&lt;/p&gt;

&lt;p&gt;If this closure is registered as an instance method &quot;x&quot; with EMC, then metaClass gets x() as well as x(Object) pointing to doCall()/doCall(Object) internally.&lt;/p&gt;

&lt;p&gt;Now, if this closure gets registered as a static method &quot;y&quot;, then metaClass was by mistake registering only y(Object) and not y(). This was because it was using the same closure parameter types when trying to register both y() and y(Object) and it was successfully adding y(Object) but registering of y() was failing because even for it, it was seeing the same parameter types.&lt;/p&gt;

&lt;p&gt;The fix makes ClosureStaticMetaMethod instances with correct parameterTypes and all combinations of parameter-types get added appropriately. So, for a closure with 2 parameter values with default values that maps to static property z added through metaClass, all z() / z(Object) / z(Object/Object) get registered now.&lt;/p&gt;

&lt;p&gt;Example 1:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def cl = { first = &lt;span class=&quot;code-quote&quot;&gt;&quot;first&quot;&lt;/span&gt; -&amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;$first&quot;&lt;/span&gt;}
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.metaClass.&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt;&apos;&lt;/span&gt;.cl1 = cl

&lt;span class=&quot;code-comment&quot;&gt;// only cl1(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;) is successully registered but because of 1 parameter special handling, call goes through with &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; value
&lt;/span&gt;println &quot;&quot;.cl1()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Example 2:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def cl = { first = &lt;span class=&quot;code-quote&quot;&gt;&quot;first&quot;&lt;/span&gt;, second = &lt;span class=&quot;code-quote&quot;&gt;&quot;second&quot;&lt;/span&gt; -&amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;$first - $second&quot;&lt;/span&gt;}
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.metaClass.&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt;&apos;&lt;/span&gt;.cl1 = cl

&lt;span class=&quot;code-comment&quot;&gt;// only cl1(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;) is successully registered, so failes with no method found excaption
&lt;/span&gt;println &quot;&quot;.cl1()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Please let me know if the fix looks ok. If yes, I will add a test case and check-in.&lt;/p&gt;

&lt;p&gt;rgds,&lt;br/&gt;
Roshan&lt;/p&gt;</comment>
                            <comment id="14466686" author="roshandawrani" created="Fri, 13 Mar 2009 15:05:00 +0000"  >&lt;p&gt;The examples in the previous code are to highlight the issue with some explanation but before the fix &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. After the fix, they behave correctly.&lt;/p&gt;</comment>
                            <comment id="14466700" author="roshandawrani" created="Sat, 14 Mar 2009 04:43:40 +0000"  >&lt;p&gt;Hi Jochen, please let me know if you got the chance to look at the fix patch. Actually it is a straightforward one.&lt;/p&gt;</comment>
                            <comment id="14466616" author="blackdrag" created="Sat, 14 Mar 2009 06:47:04 +0000"  >&lt;p&gt;looks ok to me&lt;/p&gt;</comment>
                            <comment id="14466714" author="roshandawrani" created="Sat, 14 Mar 2009 08:31:56 +0000"  >&lt;p&gt;Fixed on 1.6.1 and trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12721503" name="3405_v16x.txt" size="3591" author="roshandawrani" created="Fri, 13 Mar 2009 15:02:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 37 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c75b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>