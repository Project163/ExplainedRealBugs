<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:30:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-5191] Running script with &apos;--enoding&apos; param and some script parameters</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-5191</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Create simple script &apos;main.groovy&apos;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;args.each {println it}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and try to run it by the following command:&lt;br/&gt;
&lt;tt&gt;groovy --encoding=UTF-8 main.groovy -script -param&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;The output is:&lt;br/&gt;
&lt;tt&gt;script&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;-p&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;-a&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;ram&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;while the expected output is:&lt;br/&gt;
&lt;tt&gt;-script&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;-param&lt;/tt&gt;&lt;/p&gt;</description>
                <environment>win 7 x64, jdk 1.6.0.27, groovy 1.9-beta-3</environment>
        <key id="12815984">GROOVY-5191</key>
            <summary>Running script with &apos;--enoding&apos; param and some script parameters</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="mxm-groovy">Maxim Medvedev</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Dec 2011 03:30:48 +0000</created>
                <updated>Wed, 17 Jun 2015 20:09:54 +0000</updated>
                            <resolved>Sun, 16 Dec 2012 16:58:04 +0000</resolved>
                                    <version>2.0-beta-2</version>
                    <version>1.8.6</version>
                                    <fixVersion>2.0.6</fixVersion>
                    <fixVersion>2.1.0-beta-1</fixVersion>
                                    <component>command line processing</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14472205" author="blackdrag" created="Wed, 14 Dec 2011 03:55:40 +0000"  >&lt;p&gt;that sounds very much like a commons cli problem to me.&lt;/p&gt;</comment>
                            <comment id="14472156" author="mxm-groovy" created="Wed, 14 Dec 2011 04:36:23 +0000"  >&lt;p&gt;The same result is in IntelliJ IDEA if file have encoding which differs from system default one.&lt;/p&gt;

&lt;p&gt;BTW the command without --encoding param produces the correct output (from cmd and IntelliJ iDEA)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;groovy main.groovy -script -param
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


</comment>
                            <comment id="14472512" author="weitzj" created="Sun, 19 Feb 2012 10:05:01 +0000"  >&lt;p&gt;Issue is universal. e.g. MacOSX, 2.0.0-beta-3&lt;br/&gt;
Fix: Pull Request - &lt;a href=&quot;https://github.com/groovy/groovy-core/pull/28&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/groovy/groovy-core/pull/28&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;it&apos;s not a commons cli problem. The problems is inside the logic how GroovyMain parses it&apos;s args and determines whether it will need the params to itself or pass them to your scriptFile.&lt;/p&gt;

&lt;p&gt;Since &apos;-p&apos; and &apos;-a&apos; are Options in GroovyMain and you specified &apos;-param&apos;, GroovyMain will extract &apos;-p&apos;, and &apos;-a&apos; and give you the rest, which it did not recognize =&amp;gt; &apos;ram&apos;&lt;/p&gt;

&lt;p&gt;Therefore the --encoding param is just one example on how this fails.&lt;br/&gt;
You can take any params abbreviation, which is used by GroovyMain. &lt;/p&gt;

&lt;p&gt;The current logic determines the name of the scriptfile you want to run, too late, which explains, why &lt;/p&gt;

&lt;p&gt;groovy --encoding=UTF-8 main.groovy -script -param&lt;/p&gt;

&lt;p&gt;fails, while&lt;/p&gt;

&lt;p&gt;groovy main.groovy -script -param &lt;/p&gt;

&lt;p&gt;does not fail.&lt;/p&gt;

&lt;p&gt;So, I think we should force the convention that you first enter all params for the GrooyMain part, then an optional scriptFile and optional scriptArgs.&lt;/p&gt;

&lt;p&gt;groovy &lt;span class=&quot;error&quot;&gt;&amp;#91;options&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;scriptName scriptArgs&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="14472527" author="weitzj" created="Sun, 19 Feb 2012 14:20:30 +0000"  >&lt;p&gt;Related tickets:&lt;br/&gt;
&lt;a href=&quot;https://jira.codehaus.org/browse/GROOVY-5020&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jira.codehaus.org/browse/GROOVY-5020&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://jira.codehaus.org/browse/GROOVY-5282&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jira.codehaus.org/browse/GROOVY-5282&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14472575" author="paulk" created="Mon, 20 Feb 2012 05:43:09 +0000"  >&lt;p&gt;link related issues&lt;/p&gt;</comment>
                            <comment id="14479839" author="paulk" created="Mon, 20 Feb 2012 05:46:30 +0000"  >&lt;p&gt;The following currently works:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;groovy -e &lt;span class=&quot;code-quote&quot;&gt;&quot;println args[0]&quot;&lt;/span&gt; hi
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but produces &quot;&lt;tt&gt;java.lang.ArrayIndexOutOfBoundsException: 0&lt;/tt&gt;&quot; after the patch.&lt;/p&gt;

&lt;p&gt;As a minimum this would need to be flagged as a breaking change but I am wondering how many people rely on the above behavior and changing it would not be good for them.&lt;/p&gt;</comment>
                            <comment id="14472528" author="weitzj" created="Mon, 20 Feb 2012 07:24:25 +0000"  >&lt;p&gt;Hi Paul, &lt;br/&gt;
thanks. This was a small error. I did not catch the -e option. You can apply the uploaded patch, which fixes this or get everything from the pull request on Github.&lt;br/&gt;
&lt;a href=&quot;https://github.com/weitzj/groovy-core/commit/bfd6870f8513c5443b7822ef74dbee449ecf3d1e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/weitzj/groovy-core/commit/bfd6870f8513c5443b7822ef74dbee449ecf3d1e&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;or change line 386 in groovy.ui.GroovyMain.java to read the following:&lt;/p&gt;

&lt;p&gt;if(main.processFiles) --&amp;gt; if(!main.isScriptFile || main.processFiles)&lt;/p&gt;


&lt;p&gt;The logic is now:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;if the user uses the -n, -p or -e option, everything should stay the same as it has before.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Otherwise we know we have a groovy script, which should get executed, and change the args array.&lt;/p&gt;


&lt;p&gt;Greetings,&lt;/p&gt;

&lt;p&gt;Jan&lt;/p&gt;</comment>
                            <comment id="14472581" author="weitzj" created="Thu, 23 Feb 2012 17:37:03 +0000"  >&lt;p&gt;Do you need any more input on this? Is this all crap? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Greets,&lt;/p&gt;

&lt;p&gt;Jan&lt;/p&gt;</comment>
                            <comment id="14479847" author="paulk" created="Thu, 23 Feb 2012 19:05:02 +0000"  >&lt;p&gt;Your suggestions are probably all spot on - speaking for myself, I just need more time to test and have been pretty busy lately. Parameter passing has traditionally been a very fragile area - mostly not to do with changes we make in Java code; usually related to surrounding windows batch scripts or bugs in commons CLI (mostly earlier versions). And on top of that we have low (automated) test coverage of this area. In any case, I am always loathe to make any changes in this space without sufficient additional manual testing. So, hopefully with a bit more time we can progress this issue to everyone&apos;s satisfaction.&lt;/p&gt;</comment>
                            <comment id="14480059" author="paulk" created="Sun, 16 Dec 2012 05:37:09 +0000"  >&lt;p&gt;OK, finally got some more time to test things out. Jan&apos;s proposed patch definitely works around the problem but it seems to me that this is really a workaround that we shouldn&apos;t have to do and in fact there is indeed a bug in Commons-CLI. If I swap out the PosixParser that we currently use and replace it with the GnuParser (or the DefaultParser in Commons-CLI 1.3-SNAPSHOT) then the problem goes away. And looking at the source code for PosixParser, it never seems to clear out the &quot;currentOption&quot; field in between iterations - which it should do to work properly when &quot;stopAtNonOption&quot; is set to true as per how we use that parser.&lt;/p&gt;</comment>
                            <comment id="14480064" author="paulk" created="Sun, 16 Dec 2012 16:58:04 +0000"  >&lt;p&gt;There is now a custom GroovyPosixParser which I hope fixes (some of) the bugs in PosixParser. This should just be an interim measure until Commons-CLI 1.3 is released at which point we should be able to delete that class and switch over to DefaultParser from commons-cli itself.&lt;/p&gt;

&lt;p&gt;Note: in 2.1, the &quot;posix&quot; flag for CliBuilder is deprecated and GroovyPosixParser becomes the default parser in use if no explicit class is specified via the parser parameter.&lt;/p&gt;</comment>
                            <comment id="14473665" author="blackdrag" created="Fri, 4 Jan 2013 02:55:32 +0000"  >&lt;p&gt;Paul, can&apos;t we then close this issue and the pull request? I think the issue does not need to stay open until CLI 1.3 eventually comes into existence &lt;/p&gt;</comment>
                            <comment id="14480093" author="paulk" created="Fri, 4 Jan 2013 22:32:16 +0000"  >&lt;p&gt;Yes, closing is fine.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310260">
                    <name>Related</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12818525">GROOVY-5020</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12816108">GROOVY-5282</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12722598" name="patch.diff" size="956" author="weitzj" created="Mon, 20 Feb 2012 07:24:25 +0000"/>
                            <attachment id="12722359" name="proof.png" size="47458" author="mxm" created="Wed, 14 Dec 2011 03:30:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 46 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c1z3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>