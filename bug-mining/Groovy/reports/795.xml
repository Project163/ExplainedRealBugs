<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:08:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-3089] compile error with covariant bridge method added for already existing method</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-3089</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Open groovyConsole, enter:&lt;/p&gt;

&lt;p&gt;class Foo {&lt;br/&gt;
  @Delegate Date d = new Date();&lt;br/&gt;
} &lt;/p&gt;

&lt;p&gt;Press Ctrl+Enter.   Error displayed:&lt;/p&gt;

&lt;p&gt;org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed, Script14: -1: Repetitive method name/signature for method &apos;int compareTo(java.lang.Object)&apos; in class &apos;Foo&apos;.&lt;br/&gt;
 @ line -1, column -1.Script14: -1: Repetitive method name/signature for method &apos;int compareTo(java.lang.Object)&apos; in class &apos;Foo&apos;.&lt;br/&gt;
 @ line -1, column -1.&lt;br/&gt;
2 errors &lt;/p&gt;

&lt;p&gt;Note: changing Date to other classes such as Map works fine, seems to be something specific about Date.&lt;/p&gt;</description>
                <environment>Win XP SP2,  JRE 1.6.0 </environment>
        <key id="12814380">GROOVY-3089</key>
            <summary>compile error with covariant bridge method added for already existing method</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="simonz">Simon Zhao</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Oct 2008 17:32:04 +0000</created>
                <updated>Thu, 27 Nov 2008 09:18:33 +0000</updated>
                            <resolved>Thu, 27 Nov 2008 09:06:30 +0000</resolved>
                                    <version>1.6-beta-2</version>
                                    <fixVersion>1.6-rc-1</fixVersion>
                    <fixVersion>1.5.8</fixVersion>
                    <fixVersion>1.7-beta-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14465688" author="roshandawrani" created="Sat, 22 Nov 2008 06:53:12 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
    Please find attached the fix patches for the issue for versions 1.6-RC-1 and 1.7-beta-1.&lt;/p&gt;

&lt;p&gt;The error was found in co-variant algorithm in Verifier.&lt;/p&gt;

&lt;p&gt;The compilation error reported in the bug was originating from ClassCompletionVerifier-&amp;gt;checkRepetitiveMethod() because it was seeing duplicate methods nodes for &quot;int compareTo(Object)&quot; added on ClassNode &lt;span class=&quot;error&quot;&gt;&amp;#91;Foo&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;    1)  First method node is added by DelegateASTTransformation.addDelegateMethod() because java.util.Date class has &quot;int compareTo(Object) &lt;span class=&quot;error&quot;&gt;&amp;#91;synthetic = true&amp;#93;&lt;/span&gt;&quot;&lt;/p&gt;

&lt;p&gt;    2)  Second method node is added by Verifier.addCovariantMethods().&lt;/p&gt;

&lt;p&gt;In case of &quot;java.util.Date implements java.lang.Comparable&amp;lt;Date&amp;gt;&quot;, what happens is that bridge method that groovy Verifier tries to add is already added by Java and java.util.Date class has following 2 methods:&lt;/p&gt;

&lt;p&gt;    1)  public int compareTo(Date) &lt;span class=&quot;error&quot;&gt;&amp;#91;synthetic = false&amp;#93;&lt;/span&gt;&lt;br/&gt;
    2)  public int compareTo(Object) &lt;span class=&quot;error&quot;&gt;&amp;#91;synthetic = true&amp;#93;&lt;/span&gt; (Since this bridge method is already provided by Java, it does not need to be provided by Groovy and that is the fix done on co-variant algorithm.)&lt;/p&gt;

&lt;p&gt;Co-variant algorithm implemented in org.codehaus.groovy.classgen.Verifier had the following issue:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;For class Foo 
{@Delegate Date ....}
&lt;p&gt;, it comes across interface method &quot;int compareTo(Object)&quot; and method &quot;int compareTo(Date)&quot; on ClassNode&lt;span class=&quot;error&quot;&gt;&amp;#91;Foo&amp;#93;&lt;/span&gt; (added earlier by DelegateASTTransformation.addDelegateMethod()) and it incorrectly concludes that it needs to provide a bridge method &quot;int compareTo(Object)&quot; ignoring the possibility that it may already be present on ClassNode (as in case of java.util.Date).&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;To fix this, I have added an additional check in Verifier.storeMissingCovariantMethods() before adding the bridge method to ClassNode. The check is done only after co-variant case is identified by Groovy and a bridgeMethod is prepared by it so that performance hit incurred by this additional check is not added to non-co-variant cases.&lt;/p&gt;

&lt;p&gt;With the patch, the following goes through:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
    @Delegate Date d = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Date();
}

def foo = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Foo()
def d1 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Date(); d1++
println foo.compareTo(d1)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Hope it helps.&lt;br/&gt;
Roshan&lt;/p&gt;</comment>
                            <comment id="14465722" author="roshandawrani" created="Sat, 22 Nov 2008 23:23:15 +0000"  >&lt;p&gt;Actually, since the root cause is found in co-variance algorithm and not really in @Delegate feature, the issue is also present in version 1.5.8.&lt;/p&gt;

&lt;p&gt;Below is the test case to effect the same &quot;Repetitive method name/signature for method&quot; error in 1.5.8 (since it does not have @Delegate feature). I am attaching a patch that has the fix for 1.5.8 and also the additional test case to highlight the co-variance error.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Groovy2089CovarianceTest &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; GroovyTestCase {
    def void testCovarianceMethodAddWithGenericsInterfaces() {
    	&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyShell().parse(
        	&quot;&quot;&quot;
				&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; IBar&amp;lt;T&amp;gt;{
				    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; testMethod(T obj)
				}
				
				&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Bar &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; IBar&amp;lt;Date&amp;gt;{
				    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; testMethod(Date dt){}
				    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; testMethod(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; obj){}
				}
                1
        	&quot;&quot;&quot;
    		)
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;rgds,&lt;br/&gt;
Roshan&lt;/p&gt;</comment>
                            <comment id="14465797" author="blackdrag" created="Thu, 27 Nov 2008 09:07:18 +0000"  >&lt;p&gt;I did not fix exactly like you suggested, instead I did remove the surplus methods before adding them to the ClassNode.&lt;/p&gt;</comment>
                            <comment id="14465644" author="roshandawrani" created="Thu, 27 Nov 2008 09:18:33 +0000"  >&lt;p&gt;Much better fix in terms of implementation. Thanks.&lt;/p&gt;

&lt;p&gt;rgds,&lt;br/&gt;
Roshan&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12721348" name="3089Patch.zip" size="1596" author="roshandawrani" created="Sat, 22 Nov 2008 06:53:12 +0000"/>
                            <attachment id="12721490" name="3089_v15xPatch_Testcase.zip" size="1135" author="roshandawrani" created="Sat, 22 Nov 2008 23:23:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ctwv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>