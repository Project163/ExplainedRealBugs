<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:13:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-10106] STC error for call to static trait method from closure</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-10106</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The following code fails to compile:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; bar
}
@groovy.transformn.CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;trait&lt;/span&gt; A {
    final Foo foo = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Foo().with {
        config(it)
        it
    }
    static void config(foo) {
        foo.bar = &lt;span class=&quot;code-quote&quot;&gt;&apos;bar&apos;&lt;/span&gt;
    }
}
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;C &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; A {
}
print &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; C().foo.bar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The error is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
src/test/groovy/bar/Foo.groovy: 14: [Static type checking] - Cannot find matching method bar.A#config(bar.Foo). Please check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the declared type is correct and &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the method exists.
 @ line 14, column 9.
           config(it)
           ^
1 error
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
If I change &lt;tt&gt;trait&lt;/tt&gt; to &lt;tt&gt;class&lt;/tt&gt;, it compiles successfully.&lt;/p&gt;

&lt;p&gt;I think this has to do with the fact that trait cannot have constructors, and hence the context in which the code executes does not have the right imports?&lt;/p&gt;

&lt;p&gt;Anyway, this was working fine before we upgraded to the latest Groovy 2.5.x version from 2.4.x.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13380065">GROOVY-10106</key>
            <summary>STC error for call to static trait method from closure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="renatoathaydes">Renato Athaydes</reporter>
                        <labels>
                            <label>traits</label>
                    </labels>
                <created>Mon, 24 May 2021 10:09:46 +0000</created>
                <updated>Thu, 22 Sep 2022 16:32:58 +0000</updated>
                            <resolved>Tue, 25 May 2021 17:42:39 +0000</resolved>
                                    <version>2.5.14</version>
                                    <fixVersion>4.0.0-beta-1</fixVersion>
                    <fixVersion>3.0.9</fixVersion>
                    <fixVersion>2.5.16</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17350442" author="emilles" created="Mon, 24 May 2021 14:01:23 +0000"  >&lt;p&gt;Does this work if you remove &lt;tt&gt;CompileDynamic&lt;/tt&gt; from &quot;config&quot;?  Have you tried using 4.0a3 to see if the issue still exists there?  Besides static to dynamic, you also have a field initializer with a closure that calls out to a static trait method.&lt;/p&gt;</comment>
                            <comment id="17350891" author="renatoathaydes" created="Tue, 25 May 2021 08:06:04 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt; . I managed to modify my code to work around this problem, so don&apos;t worry &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Answering your questions:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;CompileDynamic does not have any effect, actually. After removing it, the result is the same.&lt;/li&gt;
	&lt;li&gt;We have several thousands of Groovy tests... this kind of thing might look weird, but in a large code base you&apos;ll always find lots of weird things. If it&apos;s valid Groovy, it should work regardless of how pretty the code is, right?&lt;/li&gt;
	&lt;li&gt;We cannot upgrade to Groovy 3, let alone 4, until we sort out Groovy 2.5.x. and are confident our tests can run on Java 11. We also use Spock and many other libraries that might need some time to work reliably on Groovy 3 and 4.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;That said, I tried this code on Groovy 3.0.8, and the problem remains. Even removing CompileDynamic and adding a type annotation on the config parameter, it fails to compile!&lt;/p&gt;

&lt;p&gt;Tried to use Groovy 4 but it seems to not work at all with Gradle?&lt;/p&gt;

&lt;p&gt;My dependencies look like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
dependencies {
    implementation &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.groovy:groovy:4.0.0-alpha-3&apos;&lt;/span&gt;
    testImplementation &lt;span class=&quot;code-quote&quot;&gt;&apos;org.spockframework:spock-core:2.0-groovy-3.0&apos;&lt;/span&gt;, {
        transitive = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
    }
    testImplementation &lt;span class=&quot;code-quote&quot;&gt;&apos;org.junit.jupiter:junit-jupiter-api:5.6.0&apos;&lt;/span&gt;
    testRuntimeOnly &lt;span class=&quot;code-quote&quot;&gt;&apos;org.junit.jupiter:junit-jupiter-engine:5.6.0&apos;&lt;/span&gt;
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This fails with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
* What went wrong:
Could not resolve all files &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; configuration &lt;span class=&quot;code-quote&quot;&gt;&apos;:traits:detachedConfiguration1&apos;&lt;/span&gt;.
&amp;gt; Could not find org.codehaus.groovy:groovy:4.0.0-alpha-3.
  Searched in the following locations:
    - https:&lt;span class=&quot;code-comment&quot;&gt;//repo.maven.apache.org/maven2/org/codehaus/groovy/groovy/4.0.0-alpha-3/groovy-4.0.0-alpha-3.pom
&lt;/span&gt;    - https:&lt;span class=&quot;code-comment&quot;&gt;//repo.maven.apache.org/maven2/org/codehaus/groovy/groovy/4.0.0-alpha-3/groovy-4.0.0-alpha-3.jar
&lt;/span&gt;  Required by:
      project :traits
&amp;gt; Could not find org.codehaus.groovy:groovy-ant:4.0.0-alpha-3.
  Searched in the following locations:
    - https:&lt;span class=&quot;code-comment&quot;&gt;//repo.maven.apache.org/maven2/org/codehaus/groovy/groovy-ant/4.0.0-alpha-3/groovy-ant-4.0.0-alpha-3.pom
&lt;/span&gt;    - https:&lt;span class=&quot;code-comment&quot;&gt;//repo.maven.apache.org/maven2/org/codehaus/groovy/groovy-ant/4.0.0-alpha-3/groovy-ant-4.0.0-alpha-3.jar
&lt;/span&gt;  Required by:
      project :traits

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;No idea why it&apos;s trying to get the wrong groovy group (the old one, org.codehaus.groovy) because my dependencies look correct?!&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;gradle dependencies --configuration=testRuntimeClasspath prints this:&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
testRuntimeClasspath - &lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt; classpath of source set &lt;span class=&quot;code-quote&quot;&gt;&apos;test&apos;&lt;/span&gt;.
+--- org.apache.groovy:groovy:4.0.0-alpha-3
+--- org.spockframework:spock-core:2.0-groovy-3.0
+--- org.junit.jupiter:junit-jupiter-api:5.6.0
|    +--- org.apiguardian:apiguardian-api:1.1.0
|    +--- org.opentest4j:opentest4j:1.2.0
|    \--- org.junit.platform:junit-platform-commons:1.6.0
|         \--- org.apiguardian:apiguardian-api:1.1.0
\--- org.junit.jupiter:junit-jupiter-engine:5.6.0
     +--- org.apiguardian:apiguardian-api:1.1.0
     +--- org.junit.platform:junit-platform-engine:1.6.0
     |    +--- org.apiguardian:apiguardian-api:1.1.0
     |    +--- org.opentest4j:opentest4j:1.2.0
     |    \--- org.junit.platform:junit-platform-commons:1.6.0 (*)
     \--- org.junit.jupiter:junit-jupiter-api:5.6.0 (*)(*) - dependencies omitted (listed previously)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17351068" author="emilles" created="Tue, 25 May 2021 13:33:20 +0000"  >&lt;p&gt;Thanks for the extra information.  I wasn&apos;t suggesting that you update to Groovy 3 or 4.  But if your test case works there, then my effort would be to identify the commit that fixed it and backport it to the 2.5 branch.  And I&apos;m not suggesting this is weird, just that compile dynamic may not be the source of the problem.&lt;/p&gt;

&lt;p&gt;In the static type checker, it is missing the resolution of &quot;config(Object)&quot; because at the time it runs, the trait has had its non-interface methods removed and the trait helper class has an extra parameter for static methods: &quot;config(Class&amp;lt;A&amp;gt; $static$self, Object foo)&quot;.  I can get it so the type checker finds the helper method and checks the method call properly.  At a later compilation phase, the method target is then causing problems because the real target for the closure&apos;s method call &quot;config(it)&quot; will be a method in the trait implementing class.&lt;/p&gt;</comment>
                            <comment id="17353521" author="renatoathaydes" created="Fri, 28 May 2021 19:02:15 +0000"  >&lt;p&gt;Thanks for fixing the issue.&lt;/p&gt;

&lt;p&gt;I see that the Fix Version was marked as 4.x.... will this fix be ported to the 2.5 and 3.0 branches?&lt;/p&gt;</comment>
                            <comment id="17353526" author="emilles" created="Fri, 28 May 2021 19:10:03 +0000"  >&lt;p&gt;Once 4.0b1 is released, I will look to backport/cherrypick the fix to 3.0.9.  If you have any other fixes you&apos;d like to see in Groovy 3 or 2.5, it would be good to list them out for me.  I have been going through JIRA to see what can be reasonably be backported.  3.0.9 will be getting some more.  2.5.15 is pretty full and so I would likely target 2.5.16.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 24 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0rb5k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>