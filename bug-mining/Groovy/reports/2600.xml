<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:41:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-6126] CompileStatic: dispatch doesn&apos;t choose correct method when parameterized generic types are used</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-6126</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Example in grails-data-mapping:&lt;br/&gt;
&lt;a href=&quot;https://github.com/lhotari/grails-data-mapping/commit/73e977fd4c29b592276baab3e74fba310edd0086#L0R146&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/lhotari/grails-data-mapping/commit/73e977fd4c29b592276baab3e74fba310edd0086#L0R146&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In this case persistentClass is defined as parameterized:&lt;br/&gt;
protected Class&amp;lt;D&amp;gt; persistentClass&lt;/p&gt;


&lt;p&gt;HibernateTemplate has several load methods:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &amp;lt;T&amp;gt; T load(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;T&amp;gt; entityClass, Serializable id) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; DataAccessException;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void load(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; entity, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Serializable id) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; DataAccessException;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;persistentClass has to be explicitly casted as Class to call the correct method. It will call the 2nd load method with the Object parameter without casting.&lt;/p&gt;

&lt;p&gt;This is the code in my example (this version calls correct methods):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    D load(Serializable id) {
        id = convertIdentifier(id)
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (id != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; hibernateTemplate.load((&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;)persistentClass, id)
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This calls the wrong method:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    D load(Serializable id) {
        id = convertIdentifier(id)
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (id != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; hibernateTemplate.load(persistentClass, id)
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Parametrized generic types don&apos;t seem to be properly handled in method dispatch.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12818251">GROOVY-6126</key>
            <summary>CompileStatic: dispatch doesn&apos;t choose correct method when parameterized generic types are used</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="melix">C&#233;dric Champeau</assignee>
                                    <reporter username="lhotari">Lari Hotari</reporter>
                        <labels>
                    </labels>
                <created>Sun, 28 Apr 2013 14:58:29 +0000</created>
                <updated>Tue, 20 May 2014 05:31:12 +0000</updated>
                            <resolved>Fri, 16 May 2014 11:54:19 +0000</resolved>
                                    <version>2.1.3</version>
                                    <fixVersion>2.3.1</fixVersion>
                                    <component>Static compilation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14474451" author="lhotari" created="Sun, 28 Apr 2013 15:08:01 +0000"  >&lt;p&gt;I get a compilation error for methods that only have a method accepting a &quot;Class&quot; argument, for example &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    D get(Serializable id) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (id || (id &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt;)) {
            id = convertIdentifier(id)
            D result = (D)hibernateTemplate.get((&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;)persistentClass, id)
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; GrailsHibernateUtil.unwrapIfProxy(result)
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This fails without the explicit cast.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;HibernateGormStaticApi.groovy: 101: [Static type checking] - Cannot find matching method 
org.codehaus.groovy.grails.orm.hibernate.GrailsHibernateTemplate#get(java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; &amp;lt;D&amp;gt;, java.io.Serializable). 
Please check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the declared type is right and &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the method exists.
 @ line 101, column 27.
               D result = (D)hibernateTemplate.get(persistentClass, id)
                             ^

1 error
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14474897" author="blackdrag" created="Mon, 19 Aug 2013 06:42:08 +0000"  >&lt;p&gt;using this code: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Loader {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &amp;lt;T&amp;gt; T load(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;T&amp;gt; entityClass, Serializable id) {entityClass.newInstance()}
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void load(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; entity, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Serializable id) {}
}

@groovy.transform.CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyClass&amp;lt;D&amp;gt; {
    &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;D&amp;gt; persistentClass
    Loader hibernateTemplate = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Loader()
    MyClass(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;D&amp;gt; c) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.persistentClass = c
    }
     
    D load(Serializable id) {
        id = convertIdentifier(id)
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (id != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; hibernateTemplate.load(persistentClass, id)
        }
    }
    
    Serializable convertIdentifier(Serializable s) {&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;}
}
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo{}
MyClass&amp;lt;Foo&amp;gt; mc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MyClass(Foo)
println mc.load(&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I found that for the load call we compare Class&amp;lt;T&amp;gt; with Class&amp;lt;D&amp;gt; path:&lt;br/&gt;
GenericsType$GenericsTypeMatcher.checkGenerics(ClassNode) line: 275	&lt;br/&gt;
GenericsType$GenericsTypeMatcher.matches(ClassNode) line: 246	&lt;br/&gt;
GenericsType.isCompatibleWith(ClassNode) line: 173	&lt;br/&gt;
StaticTypeCheckingSupport.isAssignableTo(ClassNode, ClassNode) line: 361	&lt;br/&gt;
StaticTypeCheckingSupport.allParametersAndArgumentsMatch(Parameter[], ClassNode[]) line: 222	&lt;/p&gt;

&lt;p&gt;It fails because the name T is not D. That is of course wrong. The result is that the method is excluded from the selection process and then of course the wrong method is taken in the end.&lt;/p&gt;</comment>
                            <comment id="14475930" author="pschumacher" created="Fri, 16 May 2014 11:54:20 +0000"  >&lt;p&gt;Thanks for reporting this. Blackdrags example now works, so I&apos;m resolving this.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 27 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c52f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>