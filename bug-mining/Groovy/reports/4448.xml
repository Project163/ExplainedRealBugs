<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:19:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-8045] Implicit closure coercion doesn&apos;t work for elements of array of functional objects</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-8045</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Implicit closure coercion is described &lt;a href=&quot;http://groovy-lang.org/releasenotes/groovy-2.2.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; - it assumes that the closures don&apos;t need to be casted to functional types and the generic types will be inferred by the compiler.&lt;/p&gt;

&lt;p&gt;Here is one contrived case that works from Java (this is not production code and is writen explicitly for illustration purposes):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;GroovyAccDemo {
    @SafeVarargs
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;T, R&amp;gt; Function&amp;lt;T, R&amp;gt; ensemble(Function&amp;lt;T, R&amp;gt;... hypotheses) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; t -&amp;gt; Arrays.stream(hypotheses)
                          .map(v -&amp;gt; v.apply(t))
                          .collect(Collectors.groupingBy(e -&amp;gt; e, Collectors.counting()))
                          .entrySet()
                          .stream()
                          .max(Comparator.comparingLong(Map.Entry::getValue))
                          .map(Map.Entry::getKey).orElseGet(() -&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
        Function&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; foo = ensemble(
                i -&amp;gt; i*i,
                i -&amp;gt; i+i,
                i -&amp;gt; i*i - (i+i)
        );
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here the &lt;tt&gt;ensemble()&lt;/tt&gt; method accepts a number of compatible functions and returns a single function that calls all hypotheses and returns the most popular result.&lt;/p&gt;

&lt;p&gt;The main method illustrates that we can use the &lt;tt&gt;ensemble()&lt;/tt&gt; function with Java Lambdas without any explicit casts.&lt;/p&gt;

&lt;p&gt;If we try to do the same in Groovy, we&apos;ll get runtime error (or compile error if static compilation is enabled):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            foo = GroovyAccDemo.&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; ensemble(
                    { i -&amp;gt; i * i },
                    { i -&amp;gt; i + i },
                    { i -&amp;gt; i * i - (i + i) }
            );
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can make it work by explicitly coercing the closures like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            foo = GroovyAccDemo.ensemble(
                    { i -&amp;gt; i*i } as Function,
                    { i -&amp;gt; i+i } as Function,
                    { i -&amp;gt; i*i - (i+i ) } as Function
            );
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This may seem as contrived use case, but it makes the use of certain API&apos;s more tedious from Groovy than from Java, which just feels wrong &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</description>
                <environment></environment>
        <key id="13034599">GROOVY-8045</key>
            <summary>Implicit closure coercion doesn&apos;t work for elements of array of functional objects</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="ddimitrov">Dimitar Dimitrov</reporter>
                        <labels>
                            <label>varargs</label>
                    </labels>
                <created>Fri, 13 Jan 2017 11:06:39 +0000</created>
                <updated>Sat, 23 Jul 2022 21:05:48 +0000</updated>
                            <resolved>Wed, 1 Jun 2022 11:58:07 +0000</resolved>
                                    <version>2.4.7</version>
                                    <fixVersion>4.0.4</fixVersion>
                                    <component>Compiler</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16962299" author="rkrisztian" created="Tue, 29 Oct 2019 18:14:36 +0000"  >&lt;p&gt;I have the same problem in a JUnit 5 test:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
assertAll([
		{ &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; 1 == 1 },
		{ &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; 2 == 2 }
].collect { it &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; Executable })
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Right now this is a bit cumbersome.&lt;/p&gt;

&lt;p&gt;Yes, I have considered:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Upgrading to Groovy 2.6, but Gradle has not yet.&lt;/li&gt;
	&lt;li&gt;Switching to Spock, which is a valid point, although requires rewriting my tests, and Spock still uses JUnit 4.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17542214" author="emilles" created="Wed, 25 May 2022 19:25:17 +0000"  >&lt;p&gt;SC: &lt;a href=&quot;https://github.com/apache/groovy/commit/496748a118a51b2dad33f9fd03a8039a1cf0127d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/496748a118a51b2dad33f9fd03a8039a1cf0127d&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17542234" author="githubbot" created="Wed, 25 May 2022 20:48:25 +0000"  >&lt;p&gt;eric-milles opened a new pull request, #1722:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/groovy/pull/1722&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1722&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8045&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/GROOVY-8045&lt;/a&gt;&lt;/p&gt;

</comment>
                            <comment id="17542251" author="githubbot" created="Wed, 25 May 2022 21:50:51 +0000"  >&lt;p&gt;sonatype-lift&lt;span class=&quot;error&quot;&gt;&amp;#91;bot&amp;#93;&lt;/span&gt; commented on code in PR #1722:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/groovy/pull/1722#discussion_r882143891&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1722#discussion_r882143891&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
src/main/java/org/codehaus/groovy/reflection/ParameterTypes.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -292,77 +290,72 @@ public boolean isValidExactMethod(Class[] args) &lt;/p&gt;
{
         return true;
     }&lt;br/&gt;
 &lt;br/&gt;
-    private static boolean testComponentAssignable(Class toTestAgainst, Class toTest) {
-        Class component = toTest.getComponentType();
-        if (component == null) return false;
-        return MetaClassHelper.isAssignableFrom(toTestAgainst, component);
-    }&lt;br/&gt;
-&lt;br/&gt;
-    private static boolean isValidVarargsMethod(Class[] arguments, int size, CachedClass[] pt, int paramMinus1) {&lt;br/&gt;
-        // first check normal number of parameters&lt;br/&gt;
-        for (int i = 0; i &amp;lt; paramMinus1; i++) {&lt;br/&gt;
-            if (pt&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.isAssignableFrom(arguments&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;)) continue;&lt;br/&gt;
-            return false;&lt;br/&gt;
+    private static boolean isValidVargsMethod(Class[] argumentTypes, CachedClass[] parameterTypes, int nthParameter) {&lt;br/&gt;
+        for (int i = 0; i &amp;lt; nthParameter; i += 1) {&lt;br/&gt;
+            if (!parameterTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.isAssignableFrom(argumentTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;)) {
+                return false;
+            }&lt;br/&gt;
         }&lt;br/&gt;
 &lt;br/&gt;
+        CachedClass arrayType = parameterTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;nthParameter&amp;#93;&lt;/span&gt;;&lt;br/&gt;
+        CachedClass componentType = ReflectionCache.getCachedClass(arrayType.getTheClass().getComponentType());&lt;br/&gt;
+&lt;br/&gt;
         // check direct match&lt;br/&gt;
-        CachedClass varg = pt&lt;span class=&quot;error&quot;&gt;&amp;#91;paramMinus1&amp;#93;&lt;/span&gt;;&lt;br/&gt;
-        Class clazz = varg.getTheClass().getComponentType();&lt;br/&gt;
-        if (size == pt.length &amp;amp;&amp;amp;&lt;br/&gt;
-                (varg.isAssignableFrom(arguments&lt;span class=&quot;error&quot;&gt;&amp;#91;paramMinus1&amp;#93;&lt;/span&gt;) ||&lt;br/&gt;
-                        testComponentAssignable(clazz, arguments&lt;span class=&quot;error&quot;&gt;&amp;#91;paramMinus1&amp;#93;&lt;/span&gt;))) {&lt;br/&gt;
-            return true;&lt;br/&gt;
+        if (argumentTypes.length == parameterTypes.length) {&lt;br/&gt;
+            Class argumentType = argumentTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;nthParameter&amp;#93;&lt;/span&gt;;&lt;br/&gt;
+            if (arrayType.isAssignableFrom(argumentType) || (argumentType.isArray()&lt;br/&gt;
+                    &amp;amp;&amp;amp; componentType.isAssignableFrom(argumentType.getComponentType()))) {&lt;br/&gt;
&lt;br/&gt;
Review Comment:&lt;br/&gt;
   &lt;b&gt;NULL_DEREFERENCE:&lt;/b&gt;  object `componentType` last assigned on line 301 could be null and is dereferenced at line 307.&lt;br/&gt;
   &lt;br/&gt;
   (at-me &lt;span class=&quot;error&quot;&gt;&amp;#91;in a reply&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://help.sonatype.com/lift/talking-to-lift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://help.sonatype.com/lift/talking-to-lift&lt;/a&gt;) with `help` or `ignore`)&lt;br/&gt;
   &lt;br/&gt;
   &amp;#8212;&lt;br/&gt;
   &lt;br/&gt;
   Was this a good recommendation?&lt;br/&gt;
   [ &lt;span class=&quot;error&quot;&gt;&amp;#91;&#128577; Not relevant&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.sonatype.com/lift-comment-rating?comment=243425071&amp;amp;lift_comment_rating=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.sonatype.com/lift-comment-rating?comment=243425071&amp;amp;lift_comment_rating=1&lt;/a&gt;) ] - [ &lt;span class=&quot;error&quot;&gt;&amp;#91;&#128533; Won&amp;#39;t fix&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.sonatype.com/lift-comment-rating?comment=243425071&amp;amp;lift_comment_rating=2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.sonatype.com/lift-comment-rating?comment=243425071&amp;amp;lift_comment_rating=2&lt;/a&gt;) ] - [ &lt;span class=&quot;error&quot;&gt;&amp;#91;&#128529; Not critical, will fix&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.sonatype.com/lift-comment-rating?comment=243425071&amp;amp;lift_comment_rating=3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.sonatype.com/lift-comment-rating?comment=243425071&amp;amp;lift_comment_rating=3&lt;/a&gt;) ] - [ &lt;span class=&quot;error&quot;&gt;&amp;#91;&#128578; Critical, will fix&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.sonatype.com/lift-comment-rating?comment=243425071&amp;amp;lift_comment_rating=4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.sonatype.com/lift-comment-rating?comment=243425071&amp;amp;lift_comment_rating=4&lt;/a&gt;) ] - [ &lt;span class=&quot;error&quot;&gt;&amp;#91;&#128522; Critical, fixing now&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.sonatype.com/lift-comment-rating?comment=243425071&amp;amp;lift_comment_rating=5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.sonatype.com/lift-comment-rating?comment=243425071&amp;amp;lift_comment_rating=5&lt;/a&gt;) ]&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
##########&lt;br/&gt;
src/main/java/org/codehaus/groovy/reflection/ParameterTypes.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -292,77 +290,72 @@ public boolean isValidExactMethod(Class[] args) {         return true;     }

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private static boolean testComponentAssignable(Class toTestAgainst, Class toTest) 
{
-        Class component = toTest.getComponentType();
-        if (component == null) return false;
-        return MetaClassHelper.isAssignableFrom(toTestAgainst, component);
-    }&lt;br/&gt;
-&lt;br/&gt;
-    private static boolean isValidVarargsMethod(Class[] arguments, int size, CachedClass[] pt, int paramMinus1) {&lt;br/&gt;
-        // first check normal number of parameters&lt;br/&gt;
-        for (int i = 0; i &amp;lt; paramMinus1; i++) {&lt;br/&gt;
-            if (pt&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.isAssignableFrom(arguments&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;)) continue;&lt;br/&gt;
-            return false;&lt;br/&gt;
+    private static boolean isValidVargsMethod(Class[] argumentTypes, CachedClass[] parameterTypes, int nthParameter) {&lt;br/&gt;
+        for (int i = 0; i &amp;lt; nthParameter; i += 1) {&lt;br/&gt;
+            if (!parameterTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.isAssignableFrom(argumentTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;)) {
+                return false;
+            }&lt;br/&gt;
         }&lt;br/&gt;
 &lt;br/&gt;
+        CachedClass arrayType = parameterTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;nthParameter&amp;#93;&lt;/span&gt;;&lt;br/&gt;
+        CachedClass componentType = ReflectionCache.getCachedClass(arrayType.getTheClass().getComponentType());&lt;br/&gt;
+&lt;br/&gt;
         // check direct match&lt;br/&gt;
-        CachedClass varg = pt&lt;span class=&quot;error&quot;&gt;&amp;#91;paramMinus1&amp;#93;&lt;/span&gt;;&lt;br/&gt;
-        Class clazz = varg.getTheClass().getComponentType();&lt;br/&gt;
-        if (size == pt.length &amp;amp;&amp;amp;&lt;br/&gt;
-                (varg.isAssignableFrom(arguments&lt;span class=&quot;error&quot;&gt;&amp;#91;paramMinus1&amp;#93;&lt;/span&gt;) ||&lt;br/&gt;
-                        testComponentAssignable(clazz, arguments&lt;span class=&quot;error&quot;&gt;&amp;#91;paramMinus1&amp;#93;&lt;/span&gt;))) {&lt;br/&gt;
-            return true;&lt;br/&gt;
+        if (argumentTypes.length == parameterTypes.length) {&lt;br/&gt;
+            Class argumentType = argumentTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;nthParameter&amp;#93;&lt;/span&gt;;&lt;br/&gt;
+            if (arrayType.isAssignableFrom(argumentType) || (argumentType.isArray()&lt;br/&gt;
+                    &amp;amp;&amp;amp; componentType.isAssignableFrom(argumentType.getComponentType()))) {
+                return true;
+            }&lt;br/&gt;
         }&lt;br/&gt;
 &lt;br/&gt;
-        // check varged&lt;br/&gt;
-        for (int i = paramMinus1; i &amp;lt; size; i++) {&lt;br/&gt;
-            if (MetaClassHelper.isAssignableFrom(clazz, arguments&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;)) continue;&lt;br/&gt;
-            return false;&lt;br/&gt;
+        // check vararg match&lt;br/&gt;
+        for (int i = nthParameter; i &amp;lt; argumentTypes.length; i += 1) {&lt;br/&gt;
+            if (!componentType.isAssignableFrom(argumentTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;)) {&lt;br/&gt;
&lt;br/&gt;
Review Comment:&lt;br/&gt;
   &lt;b&gt;NULL_DEREFERENCE:&lt;/b&gt;  object `componentType` last assigned on line 301 could be null and is dereferenced at line 314.&lt;br/&gt;
   &lt;br/&gt;
   (at-me &lt;span class=&quot;error&quot;&gt;&amp;#91;in a reply&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://help.sonatype.com/lift/talking-to-lift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://help.sonatype.com/lift/talking-to-lift&lt;/a&gt;) with `help` or `ignore`)&lt;br/&gt;
   &lt;br/&gt;
   &amp;#8212;&lt;br/&gt;
   &lt;br/&gt;
   Was this a good recommendation?&lt;br/&gt;
   [ &lt;span class=&quot;error&quot;&gt;&amp;#91;&#128577; Not relevant&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.sonatype.com/lift-comment-rating?comment=243425264&amp;amp;lift_comment_rating=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.sonatype.com/lift-comment-rating?comment=243425264&amp;amp;lift_comment_rating=1&lt;/a&gt;) ] - [ &lt;span class=&quot;error&quot;&gt;&amp;#91;&#128533; Won&amp;#39;t fix&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.sonatype.com/lift-comment-rating?comment=243425264&amp;amp;lift_comment_rating=2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.sonatype.com/lift-comment-rating?comment=243425264&amp;amp;lift_comment_rating=2&lt;/a&gt;) ] - [ &lt;span class=&quot;error&quot;&gt;&amp;#91;&#128529; Not critical, will fix&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.sonatype.com/lift-comment-rating?comment=243425264&amp;amp;lift_comment_rating=3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.sonatype.com/lift-comment-rating?comment=243425264&amp;amp;lift_comment_rating=3&lt;/a&gt;) ] - [ &lt;span class=&quot;error&quot;&gt;&amp;#91;&#128578; Critical, will fix&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.sonatype.com/lift-comment-rating?comment=243425264&amp;amp;lift_comment_rating=4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.sonatype.com/lift-comment-rating?comment=243425264&amp;amp;lift_comment_rating=4&lt;/a&gt;) ] - [ &lt;span class=&quot;error&quot;&gt;&amp;#91;&#128522; Critical, fixing now&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.sonatype.com/lift-comment-rating?comment=243425264&amp;amp;lift_comment_rating=5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.sonatype.com/lift-comment-rating?comment=243425264&amp;amp;lift_comment_rating=5&lt;/a&gt;) ]&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
##########&lt;br/&gt;
src/main/java/org/codehaus/groovy/reflection/ParameterTypes.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -292,77 +290,72 @@ public boolean isValidExactMethod(Class[] args) {
         return true;
     }&lt;br/&gt;
 &lt;br/&gt;
-    private static boolean testComponentAssignable(Class toTestAgainst, Class toTest) {-        Class component = toTest.getComponentType();-        if (component == null) return false;-        return MetaClassHelper.isAssignableFrom(toTestAgainst, component);-    }
&lt;p&gt;-&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;private static boolean isValidVarargsMethod(Class[] arguments, int size, CachedClass[] pt, int paramMinus1) {&lt;/li&gt;
	&lt;li&gt;// first check normal number of parameters&lt;/li&gt;
	&lt;li&gt;for (int i = 0; i &amp;lt; paramMinus1; i++) {&lt;/li&gt;
	&lt;li&gt;if (pt&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.isAssignableFrom(arguments&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;)) continue;&lt;/li&gt;
	&lt;li&gt;return false;&lt;br/&gt;
+    private static boolean isValidVargsMethod(Class[] argumentTypes, CachedClass[] parameterTypes, int nthParameter) {&lt;br/&gt;
+        for (int i = 0; i &amp;lt; nthParameter; i += 1) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+            if (!parameterTypes[i].isAssignableFrom(argumentTypes[i])) {
+                return false;
+            }&lt;br/&gt;
         }&lt;br/&gt;
 &lt;br/&gt;
+        CachedClass arrayType = parameterTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;nthParameter&amp;#93;&lt;/span&gt;;&lt;br/&gt;
+        CachedClass componentType = ReflectionCache.getCachedClass(arrayType.getTheClass().getComponentType());&lt;br/&gt;
+&lt;br/&gt;
         // check direct match&lt;br/&gt;
-        CachedClass varg = pt&lt;span class=&quot;error&quot;&gt;&amp;#91;paramMinus1&amp;#93;&lt;/span&gt;;&lt;br/&gt;
-        Class clazz = varg.getTheClass().getComponentType();&lt;br/&gt;
-        if (size == pt.length &amp;amp;&amp;amp;&lt;br/&gt;
-                (varg.isAssignableFrom(arguments&lt;span class=&quot;error&quot;&gt;&amp;#91;paramMinus1&amp;#93;&lt;/span&gt;) ||&lt;br/&gt;
-                        testComponentAssignable(clazz, arguments&lt;span class=&quot;error&quot;&gt;&amp;#91;paramMinus1&amp;#93;&lt;/span&gt;))) {&lt;br/&gt;
-            return true;&lt;br/&gt;
+        if (argumentTypes.length == parameterTypes.length) {&lt;br/&gt;
+            Class argumentType = argumentTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;nthParameter&amp;#93;&lt;/span&gt;;&lt;br/&gt;
+            if (arrayType.isAssignableFrom(argumentType) || (argumentType.isArray()&lt;br/&gt;
+                    &amp;amp;&amp;amp; componentType.isAssignableFrom(argumentType.getComponentType()))) {
+                return true;
+            }&lt;br/&gt;
         }&lt;br/&gt;
 &lt;br/&gt;
-        // check varged&lt;br/&gt;
-        for (int i = paramMinus1; i &amp;lt; size; i++) {&lt;br/&gt;
-            if (MetaClassHelper.isAssignableFrom(clazz, arguments&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;)) continue;&lt;br/&gt;
-            return false;&lt;br/&gt;
+        // check vararg match&lt;br/&gt;
+        for (int i = nthParameter; i &amp;lt; argumentTypes.length; i += 1) {&lt;br/&gt;
+            if (!componentType.isAssignableFrom(argumentTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;)) {+                return false;+            }         }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;+&lt;br/&gt;
         return true;&lt;br/&gt;
     }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     public boolean isValidMethod(Object[] arguments) {&lt;br/&gt;
         if (arguments == null) return true;&lt;br/&gt;
-&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final int size = arguments.length;&lt;/li&gt;
	&lt;li&gt;CachedClass[] paramTypes = getParameterTypes();&lt;/li&gt;
	&lt;li&gt;final int paramMinus1 = paramTypes.length - 1;&lt;br/&gt;
-&lt;/li&gt;
	&lt;li&gt;if (size &amp;gt;= paramMinus1 &amp;amp;&amp;amp; paramTypes.length &amp;gt; 0 &amp;amp;&amp;amp;&lt;/li&gt;
	&lt;li&gt;paramTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;(paramMinus1)&amp;#93;&lt;/span&gt;.isArray) {&lt;/li&gt;
	&lt;li&gt;// first check normal number of parameters&lt;/li&gt;
	&lt;li&gt;for (int i = 0; i &amp;lt; paramMinus1; i++) {&lt;/li&gt;
	&lt;li&gt;if (paramTypes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.isAssignableFrom(getArgClass(arguments&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;))) continue;&lt;/li&gt;
	&lt;li&gt;return false;&lt;br/&gt;
+        final CachedClass[] parameterTypes = getParameterTypes();&lt;br/&gt;
+        final int nArguments = arguments.length, nParameters = parameterTypes.length, nthParameter = nParameters - 1;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   &lt;b&gt;NULL_DEREFERENCE:&lt;/b&gt;  object `parameterTypes` last assigned on line 324 could be null and is dereferenced at line 325.&lt;/p&gt;

&lt;p&gt;   (at-me &lt;span class=&quot;error&quot;&gt;&amp;#91;in a reply&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://help.sonatype.com/lift/talking-to-lift&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://help.sonatype.com/lift/talking-to-lift&lt;/a&gt;) with `help` or `ignore`)&lt;/p&gt;

&lt;p&gt;   &amp;#8212;&lt;/p&gt;

&lt;p&gt;   Was this a good recommendation?&lt;br/&gt;
   [ &lt;span class=&quot;error&quot;&gt;&amp;#91;&#128577; Not relevant&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.sonatype.com/lift-comment-rating?comment=243425289&amp;amp;lift_comment_rating=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.sonatype.com/lift-comment-rating?comment=243425289&amp;amp;lift_comment_rating=1&lt;/a&gt;) ] - [ &lt;span class=&quot;error&quot;&gt;&amp;#91;&#128533; Won&amp;#39;t fix&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.sonatype.com/lift-comment-rating?comment=243425289&amp;amp;lift_comment_rating=2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.sonatype.com/lift-comment-rating?comment=243425289&amp;amp;lift_comment_rating=2&lt;/a&gt;) ] - [ &lt;span class=&quot;error&quot;&gt;&amp;#91;&#128529; Not critical, will fix&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.sonatype.com/lift-comment-rating?comment=243425289&amp;amp;lift_comment_rating=3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.sonatype.com/lift-comment-rating?comment=243425289&amp;amp;lift_comment_rating=3&lt;/a&gt;) ] - [ &lt;span class=&quot;error&quot;&gt;&amp;#91;&#128578; Critical, will fix&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.sonatype.com/lift-comment-rating?comment=243425289&amp;amp;lift_comment_rating=4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.sonatype.com/lift-comment-rating?comment=243425289&amp;amp;lift_comment_rating=4&lt;/a&gt;) ] - [ &lt;span class=&quot;error&quot;&gt;&amp;#91;&#128522; Critical, fixing now&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://www.sonatype.com/lift-comment-rating?comment=243425289&amp;amp;lift_comment_rating=5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.sonatype.com/lift-comment-rating?comment=243425289&amp;amp;lift_comment_rating=5&lt;/a&gt;) ]&lt;/p&gt;


</comment>
                            <comment id="17544635" author="daniel_sun" created="Tue, 31 May 2022 22:48:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rkrisztian&quot; class=&quot;user-hover&quot; rel=&quot;rkrisztian&quot;&gt;rkrisztian&lt;/a&gt; Groovy 2.6 is out of maintainence for a long time, so it&apos;s strongly recommended to upgrading to the latest version of Groovy 4 directly.&lt;/p&gt;</comment>
                            <comment id="17544858" author="githubbot" created="Wed, 1 Jun 2022 11:56:43 +0000"  >&lt;p&gt;eric-milles merged PR #1722:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/groovy/pull/1722&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1722&lt;/a&gt;&lt;/p&gt;

</comment>
                            <comment id="17545013" author="rkrisztian" created="Wed, 1 Jun 2022 16:31:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daniel_sun&quot; class=&quot;user-hover&quot; rel=&quot;daniel_sun&quot;&gt;daniel_sun&lt;/a&gt;, thanks, I will upgrade. I am aware now that it is indeed possible to compile with any Groovy version in Gradle.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13433899">GROOVY-10529</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13446867">GROOVY-10636</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 23 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i38nnb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>