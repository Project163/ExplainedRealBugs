<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:00:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-3278] Using referenced String constant as value of Annotation causes compile error</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-3278</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;When using a String constant as the value for an annotation groovyc errors out with the following message:&lt;/p&gt;

&lt;p&gt;&amp;#65279;Attribute &apos;value&apos; should have type java.lang.String but found type java.lang.Object in @SpringBean&lt;/p&gt;

&lt;p&gt;I&apos;ve attached sample code to reproduce.  The annotation and PersonDao are regular Java classes, just as was my case when finding the bug.   The PersonAction is a Groovy class.&lt;/p&gt;</description>
                <environment>OSX 10.5.6&lt;br/&gt;
JDK 1.6</environment>
        <key id="12814240">GROOVY-3278</key>
            <summary>Using referenced String constant as value of Annotation causes compile error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="gdboling">Gregg Bolinger</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Jan 2009 09:25:13 +0000</created>
                <updated>Mon, 2 Nov 2020 18:38:05 +0000</updated>
                            <resolved>Mon, 5 Nov 2018 23:43:00 +0000</resolved>
                                    <version>1.6-rc-1</version>
                                    <fixVersion>3.0.0-alpha-4</fixVersion>
                    <fixVersion>2.5.4</fixVersion>
                                    <component>Compiler</component>
                        <due></due>
                            <votes>15</votes>
                                    <watches>20</watches>
                                                                                                                <comments>
                            <comment id="14466173" author="roshandawrani" created="Thu, 15 Jan 2009 11:41:03 +0000"  >&lt;p&gt;As per &lt;a href=&quot;http://www.nabble.com/Annotation-values-in-Groovy.-td20824889.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.nabble.com/Annotation-values-in-Groovy.-td20824889.html&lt;/a&gt; and looking at the code, it looks like annotation values in groovy can only be constant values (like Strings, classes, numbers, other annotations and enums, etc).&lt;/p&gt;

&lt;p&gt;In this case, annotation value itself is a property expression PersonDao.DAO_ID, which is pointing to a static final String but in terms of groovy internals, it is not a constant expression but a property expression.&lt;/p&gt;

&lt;p&gt;So, should this case be seen as a defect or as designed?&lt;/p&gt;</comment>
                            <comment id="14478423" author="paulk" created="Thu, 15 Jan 2009 16:38:31 +0000"  >&lt;p&gt;Not sure it matters whether we call it a bug or enhancement request. It isn&apos;t supported now and seems a very worthwhile (necessary?) enhancement.&lt;/p&gt;</comment>
                            <comment id="14466220" author="gdboling" created="Thu, 15 Jan 2009 16:54:25 +0000"  >&lt;p&gt;I was thinking the same thing as Paul, FWIW&lt;/p&gt;</comment>
                            <comment id="14466190" author="roshandawrani" created="Thu, 15 Jan 2009 22:58:52 +0000"  >&lt;p&gt;You are right. It does look a worthwhile feature but if it more like an enhancement, then it may not be scheduled for 1.6, right? &lt;br/&gt;
Or, enhancements are still being taken up for 1.6?&lt;/p&gt;</comment>
                            <comment id="14466191" author="blackdrag" created="Fri, 16 Jan 2009 05:35:29 +0000"  >&lt;p&gt;It can be seen as improvement or as bug. But knowing that the groovy compiler does no form of inlining atm and this issue means we have to add that I would say it should not go into 1.6.0, but 1.6.1 might be ok&lt;/p&gt;</comment>
                            <comment id="14466222" author="guillaume" created="Fri, 16 Jan 2009 08:02:37 +0000"  >&lt;p&gt;It is a bug, not an improvement &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
I haven&apos;t double checked how it&apos;s working in Java, but since the PersonDao.DAO_ID field is a String constant, it should be allowed in Java.&lt;br/&gt;
And hence in Groovy.&lt;br/&gt;
I wish it could be fixed in 1.6.0, but if it&apos;s not, it should really be fixed in 1.6.1.&lt;/p&gt;</comment>
                            <comment id="14466259" author="roshandawrani" created="Fri, 16 Jan 2009 09:36:05 +0000"  >&lt;p&gt;It works in Java. I had double checked that earlier but then I saw that mailing list thread reply and thought that groovy annotations had some known constraints and were not as flexible as Java.&lt;/p&gt;</comment>
                            <comment id="14466285" author="guillaume" created="Fri, 16 Jan 2009 09:43:19 +0000"  >&lt;p&gt;Groovy&apos;s annotations should work as much as possible as in Java.&lt;br/&gt;
But it doesn&apos;t prevent us from providing additional capabilities &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
But at least, here, I think it should behave just as in Java.&lt;/p&gt;</comment>
                            <comment id="14478536" author="paulk" created="Mon, 15 Jun 2009 05:21:10 +0000"  >&lt;p&gt;I think I agree with Guillaume&apos;s last comment. But just so that we all understand the implications. Consider this code example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.lang.annotation.*

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
@&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; MyAnnotation {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] groups() &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; []
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Base {
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; CONST = &lt;span class=&quot;code-quote&quot;&gt;&apos;bing&apos;&lt;/span&gt;
    def run() { getClass().annotations[0].groups() }
}

@MyAnnotation(groups = &lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Child1 &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Base {}

@MyAnnotation(groups = [&lt;span class=&quot;code-quote&quot;&gt;&apos;bar&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;baz&apos;&lt;/span&gt;, Base.CONST]) &lt;span class=&quot;code-comment&quot;&gt;//  *1
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Child2 &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Base {}

&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Child1().run() == [&lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt;]
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Child2().run() == [&lt;span class=&quot;code-quote&quot;&gt;&apos;bar&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;baz&apos;&lt;/span&gt;]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Currently &amp;#42;1 breaks because we are expecting a static String but get a PropertyExpression that would evaluate at runtime to a constant.&lt;br/&gt;
The implication if we somehow evaluate this is that we are bypassing any runtime behavior, i.e.&lt;br/&gt;
if Base had any MOP in place which changed the value of CONST at runtime, that would be ignored here.&lt;br/&gt;
I believe that is the right thing. Just confirming everyone&apos;s opinions.&lt;/p&gt;</comment>
                            <comment id="14467173" author="paulk" created="Mon, 15 Jun 2009 05:22:52 +0000"  >&lt;p&gt;Probably a duplicate&lt;/p&gt;</comment>
                            <comment id="14467122" author="blackdrag" created="Mon, 15 Jun 2009 08:25:31 +0000"  >&lt;p&gt;isn&apos;t that equal to a problem you showed me in Paris? Where we found that we cannot access the constant value through reflection without initializing the class? And where we said that we maybe have to say, that we don&apos;t support that particular part? So from the language side it would be good to have that, but from the technical side I don&apos;t know how to implement that. As of runtime vs. compile time... I agree with Paul here&lt;/p&gt;</comment>
                            <comment id="14478553" author="paulk" created="Tue, 16 Jun 2009 07:47:09 +0000"  >&lt;p&gt;I think the attached patch will cover most cases but there is quite likely a better way to do it. As per the issue Jochen and I discussed in Paris, you can&apos;t wait until (say the ExtendedVerifier) and do checking in one spot because by then &apos;constants&apos; are actually pulled out of &apos;fields&apos; and placed into a static initializer. This meant that I had to try &apos;statically resolving&apos; the constants earlier. I did it in ResolveVisitor and StaticImportVisitor. Happy for other suggestions. If I don&apos;t get feedback in the next couple of days, I will apply as is and we can tweak later if need be.&lt;/p&gt;</comment>
                            <comment id="14478542" author="paulk" created="Tue, 16 Jun 2009 07:50:29 +0000"  >&lt;p&gt;If anyone is interested, here is the test case I was using:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.lang.annotation.*
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Constants.BAR

@Retention(RetentionPolicy.RUNTIME)
@Target([ElementType.METHOD, ElementType.FIELD])
@&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; Anno {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value() &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; &quot;&quot;
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] array() &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; []
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Constants {
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; FOO = &lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; BAR = &lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ClassWithAnnotationUsingConstant {
    @Anno(array = [Constants.FOO, BAR, org.objectweb.asm.Opcodes.INVOKEDYNAMIC_OWNER])
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; annotatedField
}

&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; ClassWithAnnotationUsingConstant.getDeclaredField(&lt;span class=&quot;code-quote&quot;&gt;&apos;annotatedField&apos;&lt;/span&gt;).annotations[0].value() == [&lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;bar&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;java/lang/dyn/Dynamic&quot;&lt;/span&gt;]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Making use of InvokeDynamic parts of ASM 3.2 (locally on my machine) already! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14478572" author="paulk" created="Wed, 17 Jun 2009 06:42:18 +0000"  >&lt;p&gt;fix and test applied to trunk (pending merge with 1_6_X branch but I will wait a day to let dust settle and make sure no catastrophes)&lt;/p&gt;</comment>
                            <comment id="14467155" author="blackdrag" created="Wed, 17 Jun 2009 10:08:54 +0000"  >&lt;p&gt;But Paul... am I right assuming that &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.lang.annotation.*
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Constants.BAR

@Retention(RetentionPolicy.RUNTIME)
@Target([ElementType.METHOD, ElementType.FIELD])
@&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; Anno {
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; value() &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; -1
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ClassWithAnnotationUsingConstant {
    @Anno(value = &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.MAX_VALUE)
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; annotatedField
}

&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; ClassWithAnnotationUsingConstant.getDeclaredField(&lt;span class=&quot;code-quote&quot;&gt;&apos;annotatedField&apos;&lt;/span&gt;).annotations[0].value() == &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.MAX_VALUE
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;will not work? IMHO the solution you provided looks for a ConstantExpression and if that is there the value can be used. If not, then it is a problem. Assume that in your example Constants is precompiled and you get exactly the same problem, even if it is a groovy class. The solution you gave works only with not precompiled classes or will have unwanted side effects. using Annotation constants is a different thing, because here the constant can be read without executing the static initializer. Because of that for example @Target(&lt;span class=&quot;error&quot;&gt;&amp;#91;ElementType.METHOD, ElementType.FIELD&amp;#93;&lt;/span&gt;) works in Groovy. &lt;/p&gt;

&lt;p&gt;But I am against a solution that works sometimes under some special occurrences only. So I am also against this fix. &lt;/p&gt;</comment>
                            <comment id="14478560" author="paulk" created="Wed, 17 Jun 2009 19:45:31 +0000"  >&lt;p&gt;The example you give (at least after removing the import to Constants which isn&apos;t around in your example) will work fine and having it work for Java constants was my main motivation but I understand your reservations.&lt;/p&gt;

&lt;p&gt;We can&apos;t at the moment make it work for constants in pre-compiled Groovy classes but it will for constants in pre-compiled Groovy interfaces. So, sniffing around looking for the constant expressions is a bit of a compromise trying to cater for some of the more common cases.&lt;/p&gt;

&lt;p&gt;Can you think of a better approach? I don&apos;t think not supporting Java cases is a nice option as existing Java libraries already have such usage patterns when used from Java.&lt;/p&gt;</comment>
                            <comment id="14467157" author="blackdrag" created="Thu, 18 Jun 2009 08:58:59 +0000"  >&lt;p&gt;if that example is working then I missed out part of your change. Before your patch, if you asked the ClassNode of Integer for the FieldNode MAX_VALUE, you got no initialExpression, so you could not get an constant expression and no value to use... right, I missed out this part: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (type.isResolved()) {
                        Field field = type.getTypeClass().getField(pe.getPropertyAsString());
                        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (field != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConstantExpression(field.get(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;));
                        }
                    }
                } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;(Exception e) {&lt;span class=&quot;code-comment&quot;&gt;/*ignore*/&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; If the class has an static initializer, then this code here will cause the static initializer to be executed, else it is impossible to get the value. And I thought we don&apos;t want this to happen. Btw, this part of the code forgets to check that the field is static, but you swallow the exception anyway... which is another part I don&apos;t like. If we execute the static initializer, then why making things even worse by swallowing any exception that initializer may throw? Then I don&apos;t understand your text about interfaces. Normal interfaces are not that much different from normal classes. They have an static initializer too, and that one will get executed as well. Only in case of an annotation it is possible to read the value directly without first executing the static initializer.&lt;/p&gt;

&lt;p&gt;Also it is a bit unclear to me why most of your code is in StaticImportVisitor. If I got it right, then you transform ClassNode.Field variant used by a PropertyExpression, even if that is outside of an annotation. If we are going to add such dangerous code, that executes static initializers, then we should not make matters worse and execute it for parts we don&apos;t even need... that is unless I misread the code and it is really limited to annotations... If it is limited to annotations, then it should be in an annotations handling visitor or a new visitor. It is no good to just enlarge the existing visitors, especially not the big ones. Your argument that you cannot do it in ExtendedVerifier is one I cannot follow. Sure, there the values are pulled out, but what is so bad for this? Why not change AnnotationVisitor to do exactly that? It is not like the constant will have any value for us in other parts at the moment.&lt;/p&gt;

&lt;p&gt;As for precompiled Groovy classes. I don&apos;t folow that argument. The code you added will execute the static initializer, thus it will not make any difference between precompiled Groovy code or Java code, regardless of being a class or interface.  The only case we can safely support is groovy code we currently compile, which is too limited. &lt;/p&gt;

&lt;p&gt;Can I think of a better approach that works in all cases? No. We could try reading the class in bytecode and extract this information from there, but that is lot more complicated and will not work if we don&apos;t have the bytecode.. which at runtime is a common case.  &lt;/p&gt;</comment>
                            <comment id="14478573" author="paulk" created="Thu, 18 Jun 2009 18:07:16 +0000"  >&lt;p&gt;The ClassNode.Field variant is only looked at when inside annotations unless I made a mistake in the code that checks that. So, yes we are executing the static initializer but for what should be only a very small handful of classes. I&apos;ll have a think about how to move the code. The reason I put it where I did was because I couldn&apos;t get it to work in ExtendedVerifier. I might ask for your assistance later. Do you know what the javac compiler does here? Do you know if it has equivalent code that would cause static initializers to be executed?&lt;/p&gt;</comment>
                            <comment id="14467193" author="blackdrag" created="Thu, 18 Jun 2009 20:45:24 +0000"  >&lt;p&gt;javac is a different problem domain, since javac has &lt;b&gt;always&lt;/b&gt; the byte or the source code. javac must inline the constant because no other option is allowed. that means javac will read the bytecode, extract the value and then... just found an interesting corner case for javac:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Constants {
  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; FOO;
  &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; {
    FOO = &lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;;
  }
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ClassWithAnnotationUsingConstant {
    @Anno(value=Constants.FOO)
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; annotatedField;
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This code does not compile.  And indeed the inline version is represented different in bytecode. Now that opens a new issue for Groovy. To allow this usage pattern Groovy has to do it the same way, meaning inline. If not then it will make problems even from Java. Sadly reflection does not provide any way to go around this issue. There is only one way, and that will get the static initializer being executed.&lt;/p&gt;</comment>
                            <comment id="14467621" author="pniederw" created="Sat, 29 Aug 2009 14:57:46 +0000"  >&lt;p&gt;Have you come to a conclusion on how to solve this issue? We frequently use String constants in annotations, and it&apos;s very awkward that Groovy forces us to inline them.&lt;/p&gt;</comment>
                            <comment id="14472842" author="nowaker" created="Mon, 7 May 2012 06:21:10 +0000"  >&lt;p&gt;I test EL evaluator on my bean in Spock. Because of this bug I am not able to compile the code.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;class VisibleAndEditableEntity {

    public static final String PASSING_CONDITION = &quot;#{e.age &amp;gt; 20}&quot;;
    public static final String FAILING_CONDITION = &quot;#{e.age &amp;lt; 20}&quot;;

    int age = 25;

    @Visible(PASSING_CONDITION)
    Object visiblePassed;

    @Visible(FAILING_CONDITION)
    Object visibleFailed;

    @Hidden(PASSING_CONDITION)
    Object hiddenPassed;

    @Hidden(FAILING_CONDITION)
    Object hiddenFailed;

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;AnnotationReaderFieldVisibilityGroovyTest.groovy: 87: expected &apos;PASSING_CONDITION&apos; to be an inline constant of type java.lang.String not a field expression in @za.co.fnb.csip.jastin.annotation.Visible
@ line 87, column 14.
@Visible(PASSING_CONDITION)

(and so on)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That&apos;s unacceptable. When I explicitly say &lt;tt&gt;public static final String&lt;/tt&gt;, &lt;tt&gt;@Visible(PASSING_CONDITION)&lt;/tt&gt; should be allowed!&lt;/p&gt;</comment>
                            <comment id="14474990" author="pschumacher" created="Fri, 11 Oct 2013 14:45:52 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.lang.annotation.*

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
@&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; MyAnnotation {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] groups() &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; []
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Base {
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; CONST = &lt;span class=&quot;code-quote&quot;&gt;&apos;bing&apos;&lt;/span&gt;
    def run() { getClass().annotations[0].groups() }
}

@MyAnnotation(groups = &lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Child1 &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Base {}

@MyAnnotation(groups = [&lt;span class=&quot;code-quote&quot;&gt;&apos;bar&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;baz&apos;&lt;/span&gt;, Base.CONST]) 
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Child2 &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Base {}

&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Child1().run() == [&lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt;]
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Child2().run() == [&lt;span class=&quot;code-quote&quot;&gt;&apos;bar&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;baz&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;bing&apos;&lt;/span&gt;]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;does work with Groovy 2.1.7, so I guess this was fixed?&lt;/p&gt;</comment>
                            <comment id="14480370" author="paulk" created="Sun, 13 Oct 2013 17:51:54 +0000"  >&lt;p&gt;Pascal, it works if you are in the same source unit. I think you&apos;ll find that if you place a constant in a separate file, e.g.:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Constants {
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; OTHER = &lt;span class=&quot;code-quote&quot;&gt;&apos;fizz&apos;&lt;/span&gt;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and reference that in your script above we still have a problem. I think though, we might have re-jigged how such constants are represented in our files and perhaps some rework might now be possible.&lt;/p&gt;</comment>
                            <comment id="14475481" author="emp" created="Wed, 12 Mar 2014 13:44:57 +0000"  >&lt;p&gt;I&apos;ve found in Grails that if I specify &quot;public&quot;, this works. e.g.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; ADMIN = &lt;span class=&quot;code-quote&quot;&gt;&quot;ROLE_ADMIN&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;compared to&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; ADMIN = &lt;span class=&quot;code-quote&quot;&gt;&quot;ROLE_ADMIN&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14476041" author="chrylis" created="Tue, 17 Jun 2014 03:11:02 +0000"  >&lt;p&gt;Is there any progress on this issue? I can confirm that the generated class file for the Groovy class with the constant properly presents the string as a &lt;tt&gt;java.lang.String&lt;/tt&gt; constant, but the compiler still generates a bogus error trying to use it in an annotation parameter from outside the class.&lt;/p&gt;</comment>
                            <comment id="14476154" author="krsmes" created="Fri, 11 Jul 2014 10:13:04 +0000"  >&lt;p&gt;Ugh. Just hit this myself in grails (2.3.7) trying to pass a static final Class array to a @Mock() annotation.  5+ years and no resolution?  Kinda silly to have to inline things.&lt;/p&gt;

&lt;p&gt;(Threw me for a loop because IntelliJ doesn&apos;t complain, nor does IntelliJ &quot;make&quot; complain, but a &quot;rebuild&quot; does give the error: &quot;@Mock annotation expects a class or a list of classes to mock&quot;)&lt;/p&gt;

&lt;p&gt;Going to try the &apos;public&apos; based on Edward&apos;s comment.   &apos;public&apos; forces it to be a field instead of a property, correct?&lt;/p&gt;

&lt;p&gt;UPDATE: adding &apos;public&apos; to my &apos;static final Class[]&apos; made no difference.  Same error.&lt;/p&gt;</comment>
                            <comment id="14477082" author="karthi.s" created="Fri, 6 Mar 2015 00:39:40 +0000"  >&lt;p&gt;Hi all,&lt;br/&gt;
i am tried a similar one and facing issues. I tried to set the queue name dynamically based on the environment as below.&lt;/p&gt;

&lt;p&gt;@Queue(name = Constants.REQUEST_QUEUE,container = &quot;cont1&quot;)&lt;br/&gt;
def onMessage(msg){&lt;br/&gt;
......code...&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;and in constants file &lt;br/&gt;
public static final String REQUEST_QUEUE = Holders.config.requestQueueName&lt;/p&gt;

&lt;p&gt;but it throws the below compilation error&lt;br/&gt;
Groovy:Expected &apos;...MessageConsumerService.REQUEST_QUEUE&apos; to be an inline constant of type java.lang.String not a property expression in @grails.plugin.jms.Queue&lt;br/&gt;
i am using jms 1.3 plugin in grails project (grails version 2.4.2). Please advice.&lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                            <comment id="15033758" author="mauromol" created="Tue, 1 Dec 2015 14:31:45 +0000"  >&lt;p&gt;The workaround to have a an interface/class defining the constant value within the same compilation unit still doesn&apos;t work if the constant value is declared as an expression of static constant values, like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyClass {
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; Constants {
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; CONST = &lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt; + &lt;span class=&quot;code-quote&quot;&gt;&apos;bar&apos;&lt;/span&gt;;
  }

  @Pattern(regexp=Constants.CONST)
  &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; myString
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The actual workaround I found is to declare the constant in an external Java class/interface.&lt;/p&gt;</comment>
                            <comment id="16658782" author="githubbot" created="Mon, 22 Oct 2018 09:42:23 +0000"  >&lt;p&gt;GitHub user paulk-asert opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/814&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/814&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-3278&quot; title=&quot;Using referenced String constant as value of Annotation causes compile error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-3278&quot;&gt;&lt;del&gt;GROOVY-3278&lt;/del&gt;&lt;/a&gt;: Using referenced String constant as value of Annotation &#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;causes compile error&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/paulk-asert/groovy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/paulk-asert/groovy&lt;/a&gt; groovy3278&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/814.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/814.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #814&lt;/p&gt;

&lt;hr /&gt;

&lt;hr /&gt;</comment>
                            <comment id="16660030" author="githubbot" created="Tue, 23 Oct 2018 03:37:37 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/814&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/814&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16660084" author="paulk" created="Tue, 23 Oct 2018 04:47:23 +0000"  >&lt;p&gt;I am going to mark this as resolved. The proposed PR modifies the AsmDecompiler to collect the required information. That is the default but the fix won&apos;t work if you disable &quot;asmResolving&quot;.&lt;/p&gt;</comment>
                            <comment id="16660531" author="paulk" created="Tue, 23 Oct 2018 12:10:35 +0000"  >&lt;p&gt;Resolved prematurely - not all cases are covered. I&apos;ll do a bit more work.&lt;/p&gt;</comment>
                            <comment id="16660780" author="emilles" created="Tue, 23 Oct 2018 15:00:50 +0000"  >&lt;p&gt;Paul, I posted a possible patch for this issue in &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7975&quot; title=&quot;Use of static final field in an annotation element causes compile errors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7975&quot;&gt;&lt;del&gt;GROOVY-7975&lt;/del&gt;&lt;/a&gt;.  I have been using the patch in Greclipse for some time now.  Also, John W. mentions that &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7854&quot; title=&quot;Annotation value cannot be concatenated constant&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7854&quot;&gt;&lt;del&gt;GROOVY-7854&lt;/del&gt;&lt;/a&gt; may be related.&lt;/p&gt;</comment>
                            <comment id="16675890" author="paulk" created="Mon, 5 Nov 2018 23:43:00 +0000"  >&lt;p&gt;Additional cases added.&lt;/p&gt;</comment>
                            <comment id="17224879" author="chcooper" created="Mon, 2 Nov 2020 18:38:05 +0000"  >&lt;p&gt;I can still reproduce this issue with the following code in groovy 2.5.8:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Keys {

    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; MY_CONSTANT = &lt;span class=&quot;code-quote&quot;&gt;&quot;MY_CONSTANT&quot;&lt;/span&gt;

    &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; object = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;() {
        @SuppressWarnings(MY_CONSTANT)
        void hello() {
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;tt&gt;Attribute &apos;value&apos; should have type &apos;java.lang.String&apos;; but found type &apos;java.lang.Object&apos; in @java.lang.SuppressWarnings&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Is this a missing case? This isn&apos;t exactly what my code is doing but I was able to reproduce it with this contrived example.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12817803">GROOVY-2827</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12722041" name="groovy2827_qualified_annotation_constants.patch" size="10855" author="paulk_asert" created="Tue, 16 Jun 2009 07:47:08 +0000"/>
                            <attachment id="12722151" name="src.zip" size="908" author="gdboling" created="Tue, 13 Jan 2009 09:25:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 2 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c02n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>