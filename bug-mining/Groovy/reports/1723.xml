<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:24:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-5202] inherited non public listener structure causing NPE</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-5202</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;the following script works with groovy 1.8.2 but not with 1.8.4 oci connection has an error (oci_error.txt) &amp;#8211; thin connection works&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.sql.Sql
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.SQLException
def dbc = Sql.newInstance(&lt;span class=&quot;code-quote&quot;&gt;&apos;jdbc:oracle:oci:@b003&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;system&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;system&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;oracle.jdbc.driver.OracleDriver&quot;&lt;/span&gt;)
&lt;span class=&quot;code-comment&quot;&gt;//def dbc = Sql.newInstance(&lt;span class=&quot;code-quote&quot;&gt;&apos;jdbc:oracle:thin:@//server:1521/b003&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;system&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;system&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;oracle.jdbc.driver.OracleDriver&quot;&lt;/span&gt;)
&lt;/span&gt;println dbc.properties
def row = dbc.firstRow(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT count(*) FROM all_users WHERE username = &lt;span class=&quot;code-quote&quot;&gt;&apos;SYSTEM&apos;&lt;/span&gt;&quot;&lt;/span&gt;)
println row
dbc.connection.autoCommit = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>Windows XP, Oracle 11.2.0.2</environment>
        <key id="12815987">GROOVY-5202</key>
            <summary>inherited non public listener structure causing NPE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="lwolter">Ludger Wolter</reporter>
                        <labels>
                    </labels>
                <created>Sun, 18 Dec 2011 07:35:29 +0000</created>
                <updated>Sun, 19 Feb 2012 08:39:56 +0000</updated>
                            <resolved>Wed, 1 Feb 2012 09:27:31 +0000</resolved>
                                    <version>1.8.4</version>
                                    <fixVersion>1.8.6</fixVersion>
                    <fixVersion>2.0-beta-3</fixVersion>
                    <fixVersion>1.7.11</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14472291" author="jwagenleitner" created="Tue, 24 Jan 2012 19:39:19 +0000"  >&lt;p&gt;The problem appears to be with processing EventSetDescriptors.  The OCI driver uses the &lt;tt&gt;T2CConnection&lt;/tt&gt; whose super class &lt;tt&gt;PhysicalConnection&lt;/tt&gt; contains add/remove event listener methods. The base class is package private and abstract.  The thin driver uses &lt;tt&gt;T4CConnection&lt;/tt&gt; and that class overrides the &lt;tt&gt;addXSEventListener&lt;/tt&gt; methods, so that is likely why the thin driver does not exhibit the problem.&lt;/p&gt;

&lt;p&gt;I was able to create some sample classes that reproduce the problem (Groovy 1.8.3+ and JDK 6 and 7):&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;unzip GroovyBugEventListeners.zip&lt;/li&gt;
	&lt;li&gt;cd GroovyBugEventListeners/&lt;/li&gt;
	&lt;li&gt;javac example/*&lt;/li&gt;
	&lt;li&gt;groovy AbstractBaseWithEventListeners.groovy&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Note that if you either make &lt;tt&gt;FooBaseConnection&lt;/tt&gt; public or change the event listeners from the &lt;tt&gt;FooEventListener&lt;/tt&gt; interface to the &lt;tt&gt;java.util.EventListener&lt;/tt&gt; you no longer get the NPE.&lt;/p&gt;</comment>
                            <comment id="14472204" author="blackdrag" created="Wed, 25 Jan 2012 02:41:55 +0000"  >&lt;p&gt;the error seems to appear in code from this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        EventSetDescriptor[] eventDescriptors = info.getEventSetDescriptors();
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (EventSetDescriptor descriptor : eventDescriptors) {
            Method[] listenerMethods = descriptor.getListenerMethods();
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Method listenerMethod : listenerMethods) {
                &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; MetaMethod metaMethod = CachedMethod.find(descriptor.getAddListenerMethod());
                addToAllMethodsIfPublic(metaMethod);
                &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name = listenerMethod.getName();
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (listeners.containsKey(name)) {
                    listeners.put(name, AMBIGUOUS_LISTENER_METHOD);
                } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                    listeners.put(name, metaMethod);
                }
            }
        }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;because in addToAllMethodsIfPublic we do&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void addToAllMethodsIfPublic(MetaMethod metaMethod) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (Modifier.isPublic(metaMethod.getModifiers()))
            allMethods.add(metaMethod);
    }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And I think it is the metaMethod.getModifiers(), that is causing the NPE. A quick fix certainly would be to say we just skip the iteration step if we don&apos;t find the method and then not enter addToAllMethodsIfPublic at all. I guess for a non public listener it might be possible that you don&apos;t find such a method, especially in a subclass.&lt;/p&gt;</comment>
                            <comment id="14472363" author="jwagenleitner" created="Wed, 25 Jan 2012 14:17:16 +0000"  >&lt;p&gt;You are right, &lt;tt&gt;metaMethod&lt;/tt&gt; is null so it is the &lt;tt&gt;getModifiers()&lt;/tt&gt; generating the NPE.  The &lt;tt&gt;descriptor.getAddListenerMethod()&lt;/tt&gt; returns &lt;tt&gt;public void groovy.bugs.example.FooConnection.addFooEventListener(groovy.bugs.example.FooEventListener)&lt;/tt&gt;, but the &lt;tt&gt;CacheMethod#find(Method)&lt;/tt&gt; lookup only includes methods from the declaring class in this case.  By the time it reaches here, the method &lt;tt&gt;public void groovy.bugs.example.FooBaseConnection.addFooEventListener(groovy.bugs.example.FooEventListener)&lt;/tt&gt; from the superclass has already been added to the all methods.  So with a null check in place it just does not add the method name to the listeners map.&lt;/p&gt;</comment>
                            <comment id="14472333" author="jwagenleitner" created="Wed, 25 Jan 2012 21:27:10 +0000"  >&lt;p&gt;I checked out the GROOVY_1_8_2 tag and found that it works because &lt;tt&gt;methods&lt;/tt&gt; in the code below includes the public methods from the abstract super class.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;groovy.lang.MetaClassImpl&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; CachedMethod find(Method method) {
   CachedMethod[] methods = ReflectionCache.getCachedClass(method.getDeclaringClass()).getMethods();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So 1.8.2 &lt;tt&gt;methods&lt;/tt&gt; is&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;public void groovy.bugs.example.FooConnection.addFooEventListener(groovy.bugs.example.FooEventListener)&lt;/li&gt;
	&lt;li&gt;public void groovy.bugs.example.FooConnection.removeFooEventListener(groovy.bugs.example.FooEventListener)&lt;/li&gt;
	&lt;li&gt;public java.lang.String groovy.bugs.example.FooConnection.someMethod()&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;And in master it is&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;public java.lang.String groovy.bugs.example.FooConnection.someMethod()&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="14472336" author="blackdrag" created="Wed, 1 Feb 2012 04:49:15 +0000"  >&lt;p&gt;I updated the title to reflect the issue at hand better, since it is not really SQL specific&lt;/p&gt;</comment>
                            <comment id="14472347" author="blackdrag" created="Wed, 1 Feb 2012 09:27:31 +0000"  >&lt;p&gt;should be fixed now&lt;/p&gt;</comment>
                            <comment id="14472349" author="jwagenleitner" created="Wed, 1 Feb 2012 22:23:29 +0000"  >&lt;p&gt;I admit I don&apos;t know much about event listener handling and this is probably such an edge case it does not matter much, the null check is probably just fine.  However, I was just curious about the problem so ran a &lt;tt&gt;git bisect&lt;/tt&gt; to track the commit that caused this to no longer work (broke sometime after 1.8.2).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/groovy/groovy-core/commit/3c47089c9573df7d01227f07d3a6fac5886a61eb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Commit 3c47089c9573df7d01227f07d3a6fac5886a61eb&lt;/a&gt; introduced this problem by no longer adding these types of methods to the cached class.  To get a good view of the change you can run:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;git show -w 3c47089c9573df7d01227f07d3a6fac5886a61eb&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;commit 3c47089c9573df7d01227f07d3a6fac5886a61eb
Author: Guillaume Laforge &amp;lt;glaforge@gmail.com&amp;gt;
Date:   Thu Sep 22 21:51:48 2011 +0200

    GROOVY-5003: Fix the problem in handling bridge methods

diff --git a/src/main/org/codehaus/groovy/reflection/CachedClass.java b/src/main/org/codehaus/groovy/reflection/CachedCl
index 139babb..ec6d4da 100644
--- a/src/main/org/codehaus/groovy/reflection/CachedClass.java
+++ b/src/main/org/codehaus/groovy/reflection/CachedClass.java
@@ -96,7 +96,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;CachedClass {
                 &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; CachedMethod cachedMethod = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CachedMethod(CachedClass.&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, declaredMethods[i]);
                 &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name = cachedMethod.getName();
 
-                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (name.indexOf(&lt;span class=&quot;code-quote&quot;&gt;&apos;+&apos;&lt;/span&gt;) &amp;gt;= 0) {
+                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (declaredMethods[i].isBridge() || name.indexOf(&lt;span class=&quot;code-quote&quot;&gt;&apos;+&apos;&lt;/span&gt;) &amp;gt;= 0) {
                     &lt;span class=&quot;code-comment&quot;&gt;// Skip Synthetic methods inserted by JDK 1.5 compilers and later
&lt;/span&gt;                     &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
                 } /*&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (Modifier.isAbstract(reflectionMethod.getModifiers())) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The current fix that is probably fine, but I found it interesting since the inherited methods are public as part of the subclass and it seems as if they should be part of the cached class.  But again, this is territory I&apos;m not very familiar with so just wanted make note of what caused it break between versions 1.8.2 and 1.8.3.&lt;/p&gt;</comment>
                            <comment id="14472456" author="jwagenleitner" created="Wed, 1 Feb 2012 22:33:22 +0000"  >&lt;p&gt;Just read up on bridge methods and guess it does make sense to skip them. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thanks for the fix.&lt;/p&gt;</comment>
                            <comment id="14472493" author="lwolter" created="Sun, 19 Feb 2012 08:39:56 +0000"  >&lt;p&gt;I have test it with version 1.8.6 successfully. Thank you very much. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722158" name="GroovyBugEventListeners.zip" size="1747" author="jwagenleitner" created="Tue, 24 Jan 2012 19:39:19 +0000"/>
                            <attachment id="12722595" name="oci_error.txt" size="3319" author="lwolter" created="Sun, 18 Dec 2011 07:35:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 40 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c0pz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>