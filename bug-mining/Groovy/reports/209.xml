<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:56:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-1000] reset call in getAt for Matcher</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-1000</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I was hacking away on some regular expression code to use the find method on a Matcher.  It wasn&apos;t working the way I expect, so I wrote out what I thought to be the equivalent Java code, both shown here:&lt;/p&gt;


&lt;p&gt;//---- Java code ------------&lt;br/&gt;
Pattern pattern = Pattern.compile(&quot;(?:ab(&lt;span class=&quot;error&quot;&gt;&amp;#91;c|d&amp;#93;&lt;/span&gt;))&quot;);&lt;br/&gt;
Matcher matcher = pattern.matcher(&quot;abcabd&quot;);&lt;br/&gt;
while (matcher.find()) {&lt;br/&gt;
    System.out.println(matcher&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;);&lt;br/&gt;
}&lt;br/&gt;
//---------------------------&lt;/p&gt;

&lt;p&gt;//---- Groovy code ----------&lt;br/&gt;
pattern = /(?:ab(&lt;span class=&quot;error&quot;&gt;&amp;#91;c|d&amp;#93;&lt;/span&gt;))/&lt;br/&gt;
matcher = &quot;abcabd&quot; =~ pattern;&lt;/p&gt;

&lt;p&gt;while (matcher.find()) {&lt;br/&gt;
	println(matcher&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;);&lt;br/&gt;
}&lt;br/&gt;
//---------------------------&lt;/p&gt;

&lt;p&gt;The Java code does what I want (print out &quot;c&quot; then &quot;d&quot; and exit), whereas the groovy code loops infinitely printing &quot;c&quot;.  (The find method when called repeatedly should start where it left off the last time according to &lt;a href=&quot;http://java.sun.com/j2se/1.5.0/docs/api/java/util/regex/Matcher.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://java.sun.com/j2se/1.5.0/docs/api/java/util/regex/Matcher.html&lt;/a&gt;)  It was then that I noticed that the getAt implementation for Matcher objects calls reset as its first order of business (code below for reference).  Calling reset causes find() to start from the beginning the next time.&lt;/p&gt;

&lt;p&gt;I think the simplest solution is to move the matcher.reset() call into the else clause at the bottom of the function, where it&apos;s trying do do the find without using groups.  I have attached a patch to that effect.  For reference the method is copied below.&lt;/p&gt;


&lt;p&gt;// from DefaultGroovyMethods.java&lt;br/&gt;
    public static String getAt(Matcher matcher, int idx) {&lt;br/&gt;
        matcher.reset();&lt;br/&gt;
        idx = normaliseIndex(idx, matcher.groupCount());&lt;/p&gt;

&lt;p&gt;        // are we using groups?&lt;br/&gt;
        if (matcher.groupCount() &amp;gt; 0) &lt;/p&gt;
{
            // yes, so return the specified group
            matcher.find();
            return matcher.group(idx);
        }
&lt;p&gt; else {&lt;br/&gt;
            // not using groups, so return the nth&lt;br/&gt;
            // occurrence of the pattern&lt;br/&gt;
            for (int i = 0; i &amp;lt;= idx; i++) &lt;/p&gt;
{
                matcher.find();
            }
&lt;p&gt;            return matcher.group();&lt;br/&gt;
        }&lt;br/&gt;
    }&lt;/p&gt;</description>
                <environment>groovy-1.0-jsr-02 on jdk1.5.0_03 on Windows</environment>
        <key id="12816362">GROOVY-1000</key>
            <summary>reset call in getAt for Matcher</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="phkim">Kim, Pilho</assignee>
                                    <reporter username="gmiller">Graham Miller</reporter>
                        <labels>
                    </labels>
                <created>Mon, 8 Aug 2005 08:29:27 +0000</created>
                <updated>Tue, 16 Aug 2005 03:09:20 +0000</updated>
                            <resolved>Tue, 16 Aug 2005 03:09:20 +0000</resolved>
                                    <version>1.0-JSR-2</version>
                                    <fixVersion>1.0-JSR-3</fixVersion>
                                    <component>groovy-jdk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14461419" author="phkim" created="Sun, 14 Aug 2005 23:54:29 +0000"  >&lt;p&gt;Thank a lot for patch.&lt;br/&gt;
This issue has been fixed. For details, check&lt;br/&gt;
&lt;a href=&quot;http://cvs.groovy.codehaus.org/changelog/groovy/groovy/groovy-core?cs=MAIN:phk:20050815045023&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cvs.groovy.codehaus.org/changelog/groovy/groovy/groovy-core?cs=MAIN:phk:20050815045023&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14461300" author="phkim" created="Mon, 15 Aug 2005 14:23:39 +0000"  >&lt;p&gt;X---------------------------------&lt;br/&gt;
pattern = /(?:ab(&lt;span class=&quot;error&quot;&gt;&amp;#91;c|d|e|f&amp;#93;&lt;/span&gt;))/ &lt;br/&gt;
matcher = &quot;abcabdabeabf&quot; =~ pattern; &lt;/p&gt;

&lt;p&gt;while (matcher.find()) { &lt;br/&gt;
    println(matcher&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;); &lt;br/&gt;
} &lt;br/&gt;
-------------------------------X&lt;/p&gt;

&lt;p&gt;This code does not work with the above patch.&lt;br/&gt;
So this issue is reopened.&lt;/p&gt;</comment>
                            <comment id="14461287" author="phkim" created="Tue, 16 Aug 2005 03:09:20 +0000"  >&lt;p&gt;This issue has been fixed again.&lt;br/&gt;
For more details and examples, see&lt;br/&gt;
&lt;a href=&quot;http://cvs.groovy.codehaus.org/changelog/groovy/groovy/groovy-core?cs=MAIN:phk:20050816075541&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cvs.groovy.codehaus.org/changelog/groovy/groovy/groovy-core?cs=MAIN:phk:20050816075541&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Now matcher&lt;span class=&quot;error&quot;&gt;&amp;#91;index&amp;#93;&lt;/span&gt; is either a matched String or a List of matched group Strings&lt;br/&gt;
at the position of the given index.&lt;br/&gt;
For an example,&lt;/p&gt;

&lt;p&gt;    def matcher = &quot;\$abc.&quot; =~ /\$(.*)\./&lt;br/&gt;
    assert &quot;\\\$(.&lt;b&gt;)&lt;br class=&quot;atl-forced-newline&quot; /&gt;.&quot; == /\$(.&lt;/b&gt;)\./&lt;br/&gt;
    // assert matcher&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; == &quot;abc&quot;            // This has worked before jsr-03-release&lt;br/&gt;
    assert matcher&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; == &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;\$abc.&amp;quot;, &amp;quot;abc&amp;quot;&amp;#93;&lt;/span&gt;   // But this should work since jsr-03-release&lt;br/&gt;
    assert matcher&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; == &quot;abc&quot;            // This should work since jsr-03-release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12721410" name="DefaultGroovyMethods.java.patch" size="1109" author="gmiller" created="Mon, 8 Aug 2005 08:29:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            20 years, 16 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cfvr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>