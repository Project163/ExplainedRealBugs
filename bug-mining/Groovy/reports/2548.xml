<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:40:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-6706] Custom base script abstract method throws NPE with the @BaseScript annotation on imports</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-6706</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I was trying the custom abstract method for base scripts and encountered an NPE while using this variant with the base script class on imports:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@BaseScript(CustomBase)
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.BaseScript

println &lt;span class=&quot;code-quote&quot;&gt;&apos;Hello&apos;&lt;/span&gt;

&lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;CustomBase &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Script {
    def run() {
        before()
        internalRun()
        after()
    }
    
    &lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; internalRun()
    
    def before() { println &lt;span class=&quot;code-quote&quot;&gt;&apos;before&apos;&lt;/span&gt; }
    def after()  { println &lt;span class=&quot;code-quote&quot;&gt;&apos;after&apos;&lt;/span&gt;  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, the version with the base script annotated local variable works:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.BaseScript

@BaseScript CustomBase script

println &lt;span class=&quot;code-quote&quot;&gt;&apos;Hello&apos;&lt;/span&gt;

&lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;CustomBase &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Script {
    def run() {
        before()
        internalRun()
        after()
    }
    
    &lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; internalRun()
    
    def before() { println &lt;span class=&quot;code-quote&quot;&gt;&apos;before&apos;&lt;/span&gt; }
    def after()  { println &lt;span class=&quot;code-quote&quot;&gt;&apos;after&apos;&lt;/span&gt;  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The NPE I&apos;m getting from within the Groovy Console is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;BUG! exception in phase &lt;span class=&quot;code-quote&quot;&gt;&apos;semantic analysis&apos;&lt;/span&gt; in source unit &lt;span class=&quot;code-quote&quot;&gt;&apos;basescript_custom_abstract_metod.groovy&apos;&lt;/span&gt; unexpected NullpointerException
	at org.codehaus.groovy.control.CompilationUnit.applyToPrimaryClassNodes(CompilationUnit.java:1052)
	at org.codehaus.groovy.control.CompilationUnit.doPhaseOperation(CompilationUnit.java:583)
	at org.codehaus.groovy.control.CompilationUnit.processPhaseOperations(CompilationUnit.java:561)
	at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:538)
	at groovy.lang.GroovyClassLoader.doParseClass(GroovyClassLoader.java:286)
	at groovy.lang.GroovyClassLoader.parseClass(GroovyClassLoader.java:259)
	at groovy.lang.GroovyShell.parseClass(GroovyShell.java:674)
	at groovy.lang.GroovyShell.run(GroovyShell.java:501)
	at groovy.lang.GroovyShell.run(GroovyShell.java:481)
	at groovy.lang.GroovyShell.run(GroovyShell.java:164)
	at groovy.lang.GroovyShell$run$1.call(Unknown Source)
	at groovy.ui.Console$_runScriptImpl_closure17.doCall(Console.groovy:977)
	at groovy.ui.Console$_runScriptImpl_closure17.doCall(Console.groovy)
	at sun.reflect.GeneratedMethodAccessor240.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:90)
	at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:233)
	at org.codehaus.groovy.runtime.metaclass.ClosureMetaClass.invokeMethod(ClosureMetaClass.java:272)
	at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:909)
	at groovy.lang.Closure.call(Closure.java:423)
	at groovy.lang.Closure.call(Closure.java:417)
	at groovy.lang.Closure.run(Closure.java:504)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:744)
Caused by: java.lang.NullPointerException
	at org.codehaus.groovy.ast.ClassNode.removeMethod(ClassNode.java:596)
	at org.codehaus.groovy.transform.BaseScriptASTTransformation.changeBaseScriptType(BaseScriptASTTransformation.java:134)
	at org.codehaus.groovy.transform.BaseScriptASTTransformation.changeBaseScriptTypeFromPackageOrImport(BaseScriptASTTransformation.java:78)
	at org.codehaus.groovy.transform.BaseScriptASTTransformation.visit(BaseScriptASTTransformation.java:63)
	at org.codehaus.groovy.transform.ASTTransformationVisitor.visitClass(ASTTransformationVisitor.java:132)
	at org.codehaus.groovy.transform.ASTTransformationVisitor$2.call(ASTTransformationVisitor.java:176)
	at org.codehaus.groovy.control.CompilationUnit.applyToPrimaryClassNodes(CompilationUnit.java:1047)
	... 23 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12817502">GROOVY-6706</key>
            <summary>Custom base script abstract method throws NPE with the @BaseScript annotation on imports</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="guillaume">Guillaume Sauthier</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Apr 2014 17:14:05 +0000</created>
                <updated>Mon, 2 Jun 2014 15:27:59 +0000</updated>
                            <resolved>Fri, 25 Apr 2014 02:58:47 +0000</resolved>
                                    <version>2.3.0-beta-2</version>
                                    <fixVersion>2.3.0-rc-2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14475736" author="jimwhite" created="Mon, 14 Apr 2014 17:57:17 +0000"  >&lt;p&gt;I&apos;ve seen an NPE like this also when using both a --basescript option on the command line along with a @BaseScript annotation in the script.&lt;/p&gt;

&lt;p&gt;Also note that I did not implement the annotation on imports feature, although I will take a look at what the problem is.&lt;/p&gt;</comment>
                            <comment id="14475741" author="jimwhite" created="Wed, 16 Apr 2014 14:15:23 +0000"  >&lt;p&gt;Problem is that the AST transform is getting called more than once in certain situations.  Not only when using @BaseScript on imports but also things like configuring the base script from the command line or CompilerConfig.  This raises questions about which base class to use.  At the moment the solution is just to ignore the method change if it has already happened and there isn&apos;t a default run method in the AST for any reason.  &lt;/p&gt;

&lt;p&gt;Fix is in PR #371.&lt;/p&gt;</comment>
                            <comment id="14475681" author="jimwhite" created="Thu, 24 Apr 2014 14:09:21 +0000"  >&lt;p&gt;This bug fix should not be deferred from 2.3.0.  If you are refusing &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-6675&quot; title=&quot;Implement JCommander base script to support purely declarative script options&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-6675&quot;&gt;GROOVY-6675&lt;/a&gt; then you should cherry pick the fix for this bug from PR #371.  It is the only one that touches BaseScriptTransformTest.groovy and BaseScriptASTTransformation.java.&lt;/p&gt;</comment>
                            <comment id="14480466" author="paulk" created="Thu, 24 Apr 2014 20:26:24 +0000"  >&lt;p&gt;I believe I have cherry picked this onto master and the rc branch but the next fix version hasn&apos;t been created yet (rc-2 I presume). I&apos;ll leave this open until that is created.&lt;/p&gt;</comment>
                            <comment id="14475751" author="paulk" created="Fri, 25 Apr 2014 02:58:48 +0000"  >&lt;p&gt;Applied Jim&apos;s patch.&lt;/p&gt;</comment>
                            <comment id="14476038" author="jimwhite" created="Mon, 2 Jun 2014 15:27:59 +0000"  >&lt;p&gt;The fix for this is in PR #371.  For some reason it still shows up as a difference against what I assume is the branch point in master.  I&apos;ve run merge of my &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-6675&quot; title=&quot;Implement JCommander base script to support purely declarative script options&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-6675&quot;&gt;GROOVY-6675&lt;/a&gt; against the current master (which is what the TeamCity CI build is doing also) and all remains well.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 25 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2by2v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>