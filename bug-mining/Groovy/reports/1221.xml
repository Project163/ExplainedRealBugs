<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:15:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-4099] @Immutable annotation does not allow untyped static fields</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-4099</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I cannot compile a class with @Immutable if it has a static field declared with def. I don&apos;t think the transform should touch static fields.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;~$ cat ImmutableTest.groovy
@Immutable                                 
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ImmutableTest {                      
  &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; foo = {}                          
}                                          
marcus@better:~$ groovyc ImmutableTest.groovy 
org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed:
General error during canonicalization: @Immutable processor doesn&lt;span class=&quot;code-quote&quot;&gt;&apos;t know how to handle field &apos;&lt;/span&gt;foo&lt;span class=&quot;code-quote&quot;&gt;&apos; of type &apos;&lt;/span&gt;java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; or def&apos; &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; compiling &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ImmutableTest.                                                                         
@Immutable classes currently only support properties with known immutable types or types where special handling achieves immutable behavior, including:                                                                                           
- Strings, primitive types, wrapper types, BigInteger and BigDecimal                                                     
- enums, other @Immutable classes and known immutables (java.awt.Color)                                                  
- &lt;span class=&quot;code-object&quot;&gt;Cloneable&lt;/span&gt; classes, collections, maps and arrays, and other classes with special handling (java.util.Date)              
Other restrictions apply, please see the groovydoc &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; @Immutable &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; further details                                    

java.lang.RuntimeException: @Immutable processor doesn&lt;span class=&quot;code-quote&quot;&gt;&apos;t know how to handle field &apos;&lt;/span&gt;foo&lt;span class=&quot;code-quote&quot;&gt;&apos; of type &apos;&lt;/span&gt;java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; or def&apos; &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; compiling &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ImmutableTest.                                                                                    
@Immutable classes currently only support properties with known immutable types or types where special handling achieves immutable behavior, including:                                                                                           
- Strings, primitive types, wrapper types, BigInteger and BigDecimal
- enums, other @Immutable classes and known immutables (java.awt.Color)
- &lt;span class=&quot;code-object&quot;&gt;Cloneable&lt;/span&gt; classes, collections, maps and arrays, and other classes with special handling (java.util.Date)
Other restrictions apply, please see the groovydoc &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; @Immutable &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; further details
        at org.codehaus.groovy.transform.ImmutableASTTransformation.createConstructorStatement(ImmutableASTTransformation.java:373)
        at org.codehaus.groovy.transform.ImmutableASTTransformation.createConstructorMap(ImmutableASTTransformation.java:324)
        at org.codehaus.groovy.transform.ImmutableASTTransformation.createConstructor(ImmutableASTTransformation.java:310)
        at org.codehaus.groovy.transform.ImmutableASTTransformation.visit(ImmutableASTTransformation.java:113)
        at org.codehaus.groovy.transform.ASTTransformationVisitor.visitClass(ASTTransformationVisitor.java:129)
        at org.codehaus.groovy.transform.ASTTransformationVisitor$2.call(ASTTransformationVisitor.java:173)
        at org.codehaus.groovy.control.CompilationUnit.applyToPrimaryClassNodes(CompilationUnit.java:957)
        at org.codehaus.groovy.control.CompilationUnit.doPhaseOperation(CompilationUnit.java:517)
        at org.codehaus.groovy.control.CompilationUnit.processPhaseOperations(CompilationUnit.java:495)
        at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:472)
        at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:456)
        at org.codehaus.groovy.tools.FileSystemCompiler.compile(FileSystemCompiler.java:57)
        at org.codehaus.groovy.tools.FileSystemCompiler.doCompilation(FileSystemCompiler.java:170)
        at org.codehaus.groovy.tools.FileSystemCompiler.commandLineCompile(FileSystemCompiler.java:138)
        at org.codehaus.groovy.tools.FileSystemCompiler.main(FileSystemCompiler.java:152)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:616)
        at org.codehaus.groovy.tools.GroovyStarter.rootLoader(GroovyStarter.java:108)
        at org.codehaus.groovy.tools.GroovyStarter.main(GroovyStarter.java:130)

1 error
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12815141">GROOVY-4099</key>
            <summary>@Immutable annotation does not allow untyped static fields</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="marcusb">Marcus Better</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Mar 2010 10:42:33 +0000</created>
                <updated>Wed, 7 Apr 2010 23:45:11 +0000</updated>
                            <resolved>Thu, 11 Mar 2010 23:29:09 +0000</resolved>
                                    <version>1.7.0</version>
                                    <fixVersion>1.7.2</fixVersion>
                    <fixVersion>1.8-beta-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14469100" author="roshandawrani" created="Thu, 11 Mar 2010 20:52:33 +0000"  >&lt;p&gt;It&apos;s not really related to field being static. Even untyped instance level fields are rejected:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Immutable                                 
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ImmutableTest {                      
  def x = &quot;&quot;                          
} 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;@Immutable&apos;s documentation says &quot;Fields that are enums or other @Immutable classes are allowed but for an otherwise possible mutable property type, an error is thrown.&quot;. So the behavior, to me, seems in line with the documentation.&lt;/p&gt;</comment>
                            <comment id="14478992" author="paulk" created="Thu, 11 Mar 2010 23:06:57 +0000"  >&lt;p&gt;Statics are usually a bad idea for Immutable objects, e.g. consider this example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Immutable &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Person {
   &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; first, last
   &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; species = &lt;span class=&quot;code-quote&quot;&gt;&apos;Human&apos;&lt;/span&gt;
   &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getFullname() {
     &lt;span class=&quot;code-quote&quot;&gt;&quot;$first $last&quot;&lt;/span&gt;
   }
   &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getDescription() {
     &lt;span class=&quot;code-quote&quot;&gt;&quot;$fullname is a $species&quot;&lt;/span&gt;
   }
}

def spock = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Person(&lt;span class=&quot;code-quote&quot;&gt;&apos;Leonard&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Nimoy&apos;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; spock.species == &lt;span class=&quot;code-quote&quot;&gt;&apos;Human&apos;&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; spock.fullname == &lt;span class=&quot;code-quote&quot;&gt;&apos;Leonard Nimoy&apos;&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; spock.description == &lt;span class=&quot;code-quote&quot;&gt;&apos;Leonard Nimoy is a Human&apos;&lt;/span&gt;

spock.species = &lt;span class=&quot;code-quote&quot;&gt;&apos;Romulan&apos;&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; spock.species == &lt;span class=&quot;code-quote&quot;&gt;&apos;Romulan&apos;&lt;/span&gt;

Person.species = &lt;span class=&quot;code-quote&quot;&gt;&apos;Vulcan&apos;&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; spock.species == &lt;span class=&quot;code-quote&quot;&gt;&apos;Vulcan&apos;&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; spock.fullname == &lt;span class=&quot;code-quote&quot;&gt;&apos;Leonard Nimoy&apos;&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; spock.description == &lt;span class=&quot;code-quote&quot;&gt;&apos;Leonard Nimoy is a Vulcan&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Normally for an immutable object you typically expect method calls to be idempotent. In this context, by that I mean that I can call any of the methods of a Person instance multiple times and I should get the same result. E.g. no matter how many times I call &lt;tt&gt;getFullname()&lt;/tt&gt; it always yields the same value. Code which is dealing with such objects can get away with caching results (if it wanted to) assuming this characteristic. As can be seen above, calls to &lt;tt&gt;getDescription()&lt;/tt&gt; yields changing results because of the static property. Code assuming idempotency could yield subtle bugs.&lt;/p&gt;

&lt;p&gt;Having said that, in the spirit of the design of &lt;tt&gt;@Immutable&lt;/tt&gt;, it isn&apos;t fully locking the objects down to be immutable, just providing a framework to make it easy for you to do the right thing. So, it makes sense for the annotation to allow but not touch (as you point out) static properties.&lt;/p&gt;

&lt;p&gt;Just for the record, I do deem the above to be bad design. Decide whether &apos;species&apos; is part of your domain object or not. If it is, add it in as a normal property. If not, remove it. Place it in some kind of system Species class.&lt;/p&gt;</comment>
                            <comment id="14478939" author="paulk" created="Thu, 11 Mar 2010 23:19:10 +0000"  >&lt;p&gt;The alternative would be to ban statics altogether (perhaps allowing just final initialized values) which is somewhat attractive but I suspect too restrictive. We could provide an optional flag to turn on a strict mode in the future which might turn this on.&lt;/p&gt;</comment>
                            <comment id="14478954" author="paulk" created="Thu, 11 Mar 2010 23:29:09 +0000"  >&lt;p&gt;Added. Design and javadoc changed to not consider static properties.&lt;/p&gt;</comment>
                            <comment id="14469086" author="marcusb" created="Fri, 12 Mar 2010 02:54:55 +0000"  >&lt;p&gt;FYI my use-case was a domain class in Grails, which has static fields like &quot;constraints&quot;.&lt;/p&gt;</comment>
                            <comment id="14478946" author="paulk" created="Fri, 12 Mar 2010 06:09:43 +0000"  >&lt;p&gt;Hi Marcus, that will probably be fine. I added the example in the issue not specifically in response to your example but for future searches. People will see the feature has been added but might not realize the downsides.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722264" name="ImmutableTest.groovy" size="53" author="marcusb" created="Thu, 11 Mar 2010 10:42:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 37 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c4s7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>