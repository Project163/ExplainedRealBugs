<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:08:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-7232] Delegation inconsistent between methods and properties in nested closures</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-7232</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;When a closure&apos;s resolveStrategy is set to DELEGATE_ONLY or DELEGATE_FIRST, resolution is different in nested closures between methods and properties of the delegate. For example, in the following, &lt;tt&gt;x&lt;/tt&gt; resolves to &lt;tt&gt;f&lt;/tt&gt;&apos;s delegate (what I expect), but &lt;tt&gt;keySet()&lt;/tt&gt; resolves to &lt;tt&gt;g&lt;/tt&gt;&apos;s delegate.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
def g = {-&amp;gt;
    def f = {
        {-&amp;gt; [x, keySet()]}()
    }

    f.resolveStrategy = Closure.DELEGATE_ONLY
    f.delegate = [x: 1, f: 0]

    f()
}      

g.delegate = [x: 0, g: 0]
g()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Result: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[1, [&lt;span class=&quot;code-quote&quot;&gt;&apos;x&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;g&apos;&lt;/span&gt;]]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Whereas without the nested closure&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
def g = {-&amp;gt;
    def f = {
        [x, keySet()]
    }

    f.resolveStrategy = Closure.DELEGATE_ONLY
    f.delegate = [x: 1, f: 0]

    f()
}      

g.delegate = [x: 0, g: 0]
g()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Result: &lt;tt&gt;[1, &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;x&amp;#39;, &amp;#39;f&amp;#39;&amp;#93;&lt;/span&gt;]&lt;/tt&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12811490">GROOVY-7232</key>
            <summary>Delegation inconsistent between methods and properties in nested closures</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="farrellm">Matthew Farrell</reporter>
                        <labels>
                            <label>breaking</label>
                    </labels>
                <created>Tue, 30 Dec 2014 12:53:34 +0000</created>
                <updated>Wed, 1 Nov 2023 16:14:03 +0000</updated>
                            <resolved>Sat, 1 Aug 2020 11:35:20 +0000</resolved>
                                    <version>2.3.2</version>
                    <version>2.3.7</version>
                    <version>2.4.0-rc-1</version>
                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                                    <component>groovy-runtime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="17152981" author="emilles" created="Tue, 7 Jul 2020 18:52:33 +0000"  >&lt;p&gt;This is found in &lt;tt&gt;ClosureMetaClass#invokeMethod&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;: &lt;span class=&quot;code-comment&quot;&gt;// owner first
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// owner first means we start with the &lt;span class=&quot;code-keyword&quot;&gt;outer&lt;/span&gt; most owner that is not a generated closure
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; owner is equal to the &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; object, so we check that one first.
&lt;/span&gt;                method = getDelegateMethod(closure, thisObject, methodName, argClasses);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think it is supposed to use the variable &quot;owner&quot; and not &quot;thisObject&quot;.  It will take some testing to figure out the impact.&lt;/p&gt;

&lt;p&gt;For reference, &lt;tt&gt;Closure&lt;/tt&gt; implements &lt;tt&gt;getProperty&lt;/tt&gt; like this: &lt;a href=&quot;https://github.com/apache/groovy/blob/master/src/main/java/groovy/lang/Closure.java#L294&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/blob/master/src/main/java/groovy/lang/Closure.java#L294&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17153110" author="emilles" created="Tue, 7 Jul 2020 21:33:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulk&quot; class=&quot;user-hover&quot; rel=&quot;paulk&quot;&gt;paulk&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blackdrag&quot; class=&quot;user-hover&quot; rel=&quot;blackdrag&quot;&gt;blackdrag&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Could you clarify how the resolve strategies &lt;tt&gt;DELEGATE_FIRST&lt;/tt&gt; and &lt;tt&gt;OWNER_FIRST&lt;/tt&gt; are expected to work in terms of &lt;tt&gt;methodMissing&lt;/tt&gt;?  If the strategy is &lt;tt&gt;OWNER_FIRST&lt;/tt&gt; (default) I would expect the entire owner tree (including delegates for enclosing closures) to be explored out to the enclosing class before the delegate is consulted.&lt;/p&gt;

&lt;p&gt;The test &lt;tt&gt;gls.closures.ResolveStrategyTest#testDynamicSettingOfResolveStrategy&lt;/tt&gt; seems to suggest that &lt;tt&gt;methodMissing&lt;/tt&gt; is not to be invoked on owner&apos;s hierarchy if delegate has the property.  And &lt;tt&gt;ClosureMetaClass&lt;/tt&gt; seems to be implemented in terms of looking for existing methods on owners and delegates before getting into &lt;tt&gt;methodMissing&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;There is no clarity on checking for existing methods vs. calling &lt;tt&gt;methodMissing&lt;/tt&gt; in: &lt;a href=&quot;https://docs.groovy-lang.org/latest/html/documentation/#_delegation_strategy_2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.groovy-lang.org/latest/html/documentation/#_delegation_strategy_2&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;I have a simple solution for this ticket using the power of &lt;tt&gt;InvokerHelper#invokeMethod&lt;/tt&gt; to explore owner first and then try delegate.  There is only one test that has an issue with the change.&lt;/p&gt;</comment>
                            <comment id="17171867" author="paulk" created="Thu, 6 Aug 2020 02:21:45 +0000"  >&lt;p&gt;I think the behavior for &lt;tt&gt;getProperty&lt;/tt&gt; looks correct. I don&apos;t think the behavior for methods looks correct.&lt;/p&gt;</comment>
                            <comment id="17172381" author="emilles" created="Thu, 6 Aug 2020 13:51:00 +0000"  >&lt;p&gt;This should align method resolution with property resolution: &lt;a href=&quot;https://github.com/apache/groovy/pull/1328&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1328&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13556307">GROOVY-11211</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12723163" name="DelegateTest.groovy" size="626" author="farrellm" created="Tue, 30 Dec 2014 12:53:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 14 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cbov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>