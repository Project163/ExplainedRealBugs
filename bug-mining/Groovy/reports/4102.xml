<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:12:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-5893] Return type of &quot;inject&quot; is not inferred properly</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-5893</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The return type of &lt;tt&gt;inject&lt;/tt&gt; is not inferred properly. Currently, there&apos;s no rule allowing the type checker to infer the type. The signature of the method is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;T, U &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; T, V &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; T&amp;gt; T inject(Collection self, U initialValue, Closure&amp;lt;V&amp;gt; closure)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So both &lt;tt&gt;U&lt;/tt&gt; and &lt;tt&gt;V&lt;/tt&gt; must be took into account to be able to infer the return type &lt;tt&gt;T&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12816646">GROOVY-5893</key>
            <summary>Return type of &quot;inject&quot; is not inferred properly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="melix">C&#233;dric Champeau</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Jan 2013 07:59:43 +0000</created>
                <updated>Fri, 22 Dec 2023 11:38:18 +0000</updated>
                            <resolved>Tue, 7 Nov 2023 20:44:07 +0000</resolved>
                                    <version>2.0.6</version>
                    <version>2.3.9</version>
                                    <fixVersion>5.0.0-alpha-3</fixVersion>
                                    <component>Static compilation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14476921" author="pschumacher" created="Thu, 1 Jan 2015 10:26:03 +0000"  >&lt;p&gt;Should work since the introduction of @ClosureParams in 2.3.0.&lt;/p&gt;</comment>
                            <comment id="14476890" author="ngalarneau" created="Fri, 2 Jan 2015 12:06:39 +0000"  >&lt;p&gt;I don&apos;t think this is fixed.&lt;/p&gt;

&lt;p&gt;In 2.3.9, this code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; x = [1,2,3,4].inject(0) { acc, val -&amp;gt; acc + val }
    println x
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;gives this error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    Groovyc: [Static type checking] - Cannot assign value of type java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; to variable of type &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14476802" author="ngalarneau" created="Fri, 2 Jan 2015 12:08:25 +0000"  >&lt;p&gt;The error is given when @CompileStatic is used, of course.&lt;/p&gt;</comment>
                            <comment id="14476827" author="ngalarneau" created="Fri, 2 Jan 2015 13:19:22 +0000"  >&lt;p&gt;Should the Component be the Static Compiler? And the Affected Version be 2.3.9? It doesn&apos;t look like I can update these fields.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="14476907" author="pschumacher" created="Sat, 3 Jan 2015 03:20:13 +0000"  >&lt;p&gt;Thanks for reporting this. I reopened the issue and added the fields.&lt;/p&gt;</comment>
                            <comment id="14476787" author="melix" created="Wed, 14 Jan 2015 04:37:00 +0000"  >&lt;p&gt;I think you cannot infer both the return type and the closure parameter types at the same time: to be able to infer the closure parameter types, you must be able to infer the return type. And to be able to infer the return type, you need to know the parameter types.&lt;/p&gt;</comment>
                            <comment id="14476855" author="ngalarneau" created="Wed, 14 Jan 2015 10:24:41 +0000"  >&lt;p&gt;1) Even if I supply the types of the closure parameters (both accumulator and value), the Static Compiler still gives the same error.&lt;/p&gt;

&lt;p&gt;2) The type of the value is the same as the type of the Collection element. I agree that there is a circular definition problem with the type of the accumulator and the return type.&lt;/p&gt;

&lt;p&gt;Can #1 be fixed?&lt;/p&gt;</comment>
                            <comment id="17331706" author="emilles" created="Mon, 26 Apr 2021 03:14:19 +0000"  >&lt;p&gt;Given the current declaration of &lt;tt&gt;inject&lt;/tt&gt;, &lt;tt&gt;T&lt;/tt&gt; is only determined by the target of the return type.  The declaration states that &lt;tt&gt;T&lt;/tt&gt; must be equal to or a shared parent of &lt;tt&gt;U&lt;/tt&gt; and &lt;tt&gt;V&lt;/tt&gt;.  If you were to use integers, you could assign the return to Integer, Number, Object, Comparable, Serializeable and so on.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;E, T, U &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; T, V &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; T&amp;gt; T inject(Collection&amp;lt;E&amp;gt; self, U initialValue, @ClosureParams(value=FromString.&lt;span class=&quot;code-keyword&quot;&gt;class,&lt;/span&gt;options=&lt;span class=&quot;code-quote&quot;&gt;&quot;U,E&quot;&lt;/span&gt;) Closure&amp;lt;V&amp;gt; closure)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, this should produce an error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt; result = [1,2,3].inject(0) { &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; total, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i -&amp;gt; total += i }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But this does not provide for inference of &lt;tt&gt;int&lt;/tt&gt; or &lt;tt&gt;Integer&lt;/tt&gt; for &quot;result&quot;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; result = [1,2,3].inject(0) { &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; total, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i -&amp;gt; total += i }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think it is strange that no relation between the initial value type &lt;tt&gt;U&lt;/tt&gt; and the step result type &lt;tt&gt;V&lt;/tt&gt; exists, except through &lt;tt&gt;T&lt;/tt&gt;.  The step function could return something that is not compatible with &lt;tt&gt;U&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17783786" author="emilles" created="Tue, 7 Nov 2023 20:44:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/2e084efe49c0ef21a866232d6ab8a55182efba62&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/2e084efe49c0ef21a866232d6ab8a55182efba62&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13004262">GROOVY-7934</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310260">
                    <name>Related</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12818203">GROOVY-5874</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 1 week ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2celz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>