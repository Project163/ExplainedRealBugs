<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:15:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-4161] Source locations for added default constructors are incorrect</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-4161</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Groovy Eclipse has just upgraded to Groovy 1.7.2 from 1.7.0 and there is a change to Verifier.addDefaultConstructors() that is breaking us.&lt;/p&gt;

&lt;p&gt;The code is now:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;BlockStatement empty = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BlockStatement();
empty.setSourcePosition(node); 
ConstructorNode constructor = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConstructorNode(ACC_PUBLIC, empty);
constructor.setSourcePosition(node);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is there a reason why the source location for the empty blockstatement and its containing constructor is set to be the source location of the entire class?&lt;/p&gt;

&lt;p&gt;This is breaking content assist in Groovy-Eclipse.  We would prefer to have these kinds of synthetic methods not have any source location at all.&lt;/p&gt;

&lt;p&gt;I propose to change it to this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;BlockStatement empty = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BlockStatement();
ConstructorNode constructor = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConstructorNode(ACC_PUBLIC, empty);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(As above, but just remove the calls to &quot;setSourcePosition&quot;.)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12815138">GROOVY-4161</key>
            <summary>Source locations for added default constructors are incorrect</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roshandawrani">Roshan Dawrani</assignee>
                                    <reporter username="werdna">Andrew Eisenberg</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Apr 2010 16:43:03 +0000</created>
                <updated>Wed, 23 Jun 2010 15:45:01 +0000</updated>
                            <resolved>Tue, 13 Apr 2010 13:11:28 +0000</resolved>
                                    <version>1.7.2</version>
                                    <fixVersion>1.7.3</fixVersion>
                    <fixVersion>1.8-beta-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14469271" author="blackdrag" created="Fri, 9 Apr 2010 18:48:37 +0000"  >&lt;p&gt;The change was done to align it with Java. Even though the constructor is synthetic, you can still have exceptions in it caused for example bye variable initialization. Java does use here the source position of the class definition, so it sounded like a good idea to have that for Groovy too. &lt;/p&gt;</comment>
                            <comment id="14469289" author="roshandawrani" created="Fri, 9 Apr 2010 21:07:59 +0000"  >&lt;p&gt;The constructor added in Verifier.addDefaultConstructors() is public and not synthetic.&lt;/p&gt;

&lt;p&gt;Cobertura used to crib about such constructors because they didn&apos;t have any source location information.&lt;/p&gt;</comment>
                            <comment id="14469208" author="werdna" created="Sat, 10 Apr 2010 16:39:21 +0000"  >&lt;p&gt;This constructor is not synthetic in the Java sense (ie- it does not have the synthetic flag on it and it &lt;b&gt;can&lt;/b&gt; be called by user code), but it is synthetic in a different sense in that it was generated by the verifier.&lt;/p&gt;

&lt;p&gt;Currently, as far as I can tell, there is no way to distinguish such a constructor from actual, user constructors.  Since it seems like the source locations are required here, would it be possible to add some sort of flag to this kind of constructor?  Something like isDefaultConstructor(), which returns true iff it was generated by the verifier.&lt;/p&gt;</comment>
                            <comment id="14469305" author="roshandawrani" created="Sat, 10 Apr 2010 20:47:25 +0000"  >&lt;p&gt;Yes, a flag can be added, but could you tell what is so particular about the constructors? &lt;/p&gt;

&lt;p&gt;Groovy compiler also adds getters/setters for properties - and for them also, I don&apos;t think, there is any way to distinguish whether they were user provided or groovy generated.&lt;/p&gt;</comment>
                            <comment id="14469250" author="roshandawrani" created="Sat, 10 Apr 2010 23:28:14 +0000"  >&lt;p&gt;Or, instead of introducing a new flag, isSynthetic() can also be utilized for this purpose.&lt;/p&gt;

&lt;p&gt;Anyway, there is no inter-relation between synthetic flag and its modifiers for any node. So, &apos;synthetic&apos; flag can be set by groovy and utilized by greclipse without affecting modifiers of the constructor in any way.&lt;/p&gt;

&lt;p&gt;Jochen, a new flag or existing synthetic flag?&lt;/p&gt;</comment>
                            <comment id="14464411" author="werdna" created="Sat, 10 Apr 2010 23:41:27 +0000"  >&lt;p&gt;I&apos;d be concerned about changing the meaning of isSynthetic to something other than pertaining to the synthetic modifier.  That goes against my intuition of what the method should mean.&lt;/p&gt;

&lt;p&gt;And your first point, I agree, it would be nice to know if a getter/setter was generated rather than from code.  Or any other field/method/property for that matter (as a side note...aren&apos;t all properties genterated?).&lt;/p&gt;</comment>
                            <comment id="14469293" author="roshandawrani" created="Sun, 11 Apr 2010 00:01:14 +0000"  >&lt;p&gt;You can write&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Test {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; foo
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;or you can write&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Test {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; foo
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getFoo() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; foo + foo
    }    
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In first case, getter is generated by groovy, in next case, it is user provided.&lt;/p&gt;

&lt;p&gt;If you need to know about every method/field, it will be a much wider change as things get added for many reasons at many places - like core groovy adding property accessors, doing enum processing or usage of some AST transform like @Immutable/@Delegate, etc, etc.&lt;/p&gt;

&lt;p&gt;So, if your request right now is limited to the default constructor having a flag that distinguishes it (to tackle any immediate problem), I can do it. For a general/common change, I need to leave it open for discussion here.&lt;/p&gt;</comment>
                            <comment id="14469259" author="werdna" created="Sun, 11 Apr 2010 18:25:49 +0000"  >&lt;p&gt;My request right now is limited to just the default constructor, but I can see a general benefit of having this spread to all such generated fields and methods.&lt;/p&gt;

&lt;p&gt;It seems to me that any field, method, or class created in AntlrParserPlugin would have the isGenerated() flag (or whatever it winds up being called) set to false, everywhere else, it would be set to true.&lt;/p&gt;

&lt;p&gt;So, perhaps the best way to design this would be to have the flag originally set to true, and then there could be some logic withing AntlrParserPlugin that sets it to false for all methods, fields, and classes created directly from the source.  It does not seem to me to be a big change, but I may be wrong.&lt;/p&gt;

&lt;p&gt;But as I said for now, the only real problem that I am having is with these default constructors.&lt;/p&gt;</comment>
                            <comment id="14469328" author="roshandawrani" created="Sun, 11 Apr 2010 22:13:48 +0000"  >&lt;p&gt;Handling the flag in AntlrParserPlugin (APP) will cover it partially, because not all user written code goes into MethodNode/ClassNode, etc in APP.&lt;/p&gt;

&lt;p&gt;1) If you write the script below, the code doesn&apos;t go into &quot;run&quot; MethodNode and &quot;script&quot; ClassNode in APP, but in ModuleNode.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def foo = &lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;
def bar = &lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2) If you write the code with closure expression as below, the closure code does not go into &quot;doCall&quot; MethodNode and &quot;closure&quot; ClassNode in APP, but in AsmClassGenerator.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def cl = {-&amp;gt; println &lt;span class=&quot;code-quote&quot;&gt;&quot;x&quot;&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3) Another thing that can come in the way is that there are various transforms that take place after APP, which transform an existing node to another node - (say, in case of enum constants, etc). The &quot;isGenerated&quot; state may have to be transferred from old nodes to new nodes where such transformations are taking place.&lt;/p&gt;

&lt;p&gt;There may be other such cases as well. So, you see, there is no one central place where &quot;isGenerated&quot; marking can be done.&lt;/p&gt;

&lt;p&gt;So, I suggest splitting the requirements here - I will make the change for the default constructor as part of this JIRA and open an &quot;improvement&quot; JIRA for the generic change (so that it can follow its analysis/discussion cycle).&lt;/p&gt;

&lt;p&gt;Can you please tell me why this information is of use to GRECLIPSE whether the method/constructor/field was user provided or groovy generated? I thought what would matter is whether the stuff is synthetic or not. &lt;/p&gt;

&lt;p&gt;Of what use is this further differentiation - why is a hand written default constructor different from a groovy-added (but non-synthetic) default constructor?&lt;/p&gt;</comment>
                            <comment id="14469274" author="werdna" created="Mon, 12 Apr 2010 12:06:32 +0000"  >&lt;p&gt;Inside of Groovy-Eclipse, we make heavy use of AST Visitors to translate the source location of the carat into an AST node.  Often, we try to shortcut the visitor and not walk down branches of the AST that we know the carat cannot be in.  So, if the current selection is outside the source location of an AST node, then we know that we do not need to visit it.&lt;/p&gt;

&lt;p&gt;However, there are two complications here:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Generated AST nodes (eg- default constructors that contain the object initializer blocks) must be visited regardless of what their source location is.  This is because even if a generated node has a source location outside of the current selection, its contained nodes might actually be relevant.&lt;/li&gt;
	&lt;li&gt;Generated AST nodes (again, such as the default constructors) sometimes have source locations that overlap with other source locations.  Groovy-Eclipse needs to be able to distinguish these synthetic source locations from the real source location.  For example, when a default constructor has an overlapping source location with its declaring class, it needs to be able to know that the source location for the constructor is not relevant for invoking content assist (or navigation or search, etc).&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14469338" author="roshandawrani" created="Mon, 12 Apr 2010 20:57:05 +0000"  >&lt;p&gt;Thanks for explaining that, Andrew.&lt;/p&gt;

&lt;p&gt;So, for now, I will just set a &quot;isGenerated&quot; flag on the ConstructorNode that will tell whether the default constructor is added by groovy or not.&lt;/p&gt;

&lt;p&gt;Anyone has any concern with that or wants to do it in an alternative way, please raise it now. Thanks.&lt;/p&gt;</comment>
                            <comment id="14469236" author="blackdrag" created="Tue, 13 Apr 2010 06:35:38 +0000"  >&lt;p&gt;how about: &quot;hasNoRealSourcePosition&quot;? &lt;/p&gt;</comment>
                            <comment id="14469331" author="roshandawrani" created="Tue, 13 Apr 2010 06:39:40 +0000"  >&lt;p&gt;Will be added on the base AnnotatedNode but set only on the default ConstructorNode added by Verifier, for now?&lt;/p&gt;</comment>
                            <comment id="14469263" author="blackdrag" created="Tue, 13 Apr 2010 11:59:57 +0000"  >&lt;p&gt;ok&lt;/p&gt;</comment>
                            <comment id="14469332" author="roshandawrani" created="Tue, 13 Apr 2010 13:11:28 +0000"  >&lt;p&gt;Made the change.&lt;/p&gt;

&lt;p&gt;ConstructorNode#hasNoRealSourcePosition() == true indicates that it is a default constructor added by groovy.&lt;/p&gt;

&lt;p&gt;For other nodes, this flag is not set and has no meaning yet.&lt;/p&gt;</comment>
                            <comment id="14464415" author="werdna" created="Tue, 13 Apr 2010 15:47:10 +0000"  >&lt;p&gt;Thanks, Roshan, for getting this done.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 33 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c03j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>