<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:06:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-7549] java.lang.IllegalAccessError occurs when attempting to run code built with CompileStatic</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-7549</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Given a small code setup such as the following, where there exists a&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;A publicly declared interface&lt;/li&gt;
	&lt;li&gt;A package private implementation of the interface&lt;/li&gt;
	&lt;li&gt;A static factory class that returns an instance of the implementation &lt;b&gt;as the implementation class&lt;/b&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;packa.TheInterface.groovy&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; packa
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; TheInterface {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void doStuff()
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;packb.TheImplementation.groovy&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; packb
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; packa.TheInterface
@groovy.transform.CompileStatic
@groovy.transform.PackageScope
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TheImplementation &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; TheInterface {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void doStuff() {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Do some stuff&quot;&lt;/span&gt;)
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;packb.TheFactory.groovy&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; packb
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TheFactory {
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; TheImplementation getAnInstance() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TheImplementation()
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With CompileStatic, calling the factory method successfully works, but calling any method on the returned object fails with &lt;tt&gt;java.lang.IllegalAccessError&lt;/tt&gt;.&lt;br/&gt;
When CompileStatic is removed, the code runs without issue.&lt;br/&gt;
Such as the following.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;packa.TheMain.groovy&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; packa
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; packb.TheFactory
@groovy.transform.CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TheMain {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
        TheInterface if1 = TheFactory.anInstance
        /* the following only fails when CompileStatic is enabled with the following error:
         * Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.IllegalAccessError: tried to access &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;packb.TheImplementation from &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;packa.TheMain */
        if1.doStuff()
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There seem to be some interesting factors here, as changing the &lt;tt&gt;TheFactory&lt;/tt&gt; to return &lt;tt&gt;TheInterface&lt;/tt&gt; instead of &lt;tt&gt;TheImplemenation&lt;/tt&gt; also seems to resolve the issue.&lt;/p&gt;

&lt;p&gt;However, changing the return of the &lt;tt&gt;TheFactory&lt;/tt&gt; is not desirable, as in the actual production the above sample was formulated from, there are other classes in the &lt;tt&gt;packb&lt;/tt&gt; package that utilize &lt;tt&gt;TheFactory&lt;/tt&gt; and should not require class casts from &lt;tt&gt;TheInterface&lt;/tt&gt; to &lt;tt&gt;TheImplementation&lt;/tt&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12856719">GROOVY-7549</key>
            <summary>java.lang.IllegalAccessError occurs when attempting to run code built with CompileStatic</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="steven.walters@icidigital.com">Steven Walters</reporter>
                        <labels>
                    </labels>
                <created>Mon, 17 Aug 2015 20:11:16 +0000</created>
                <updated>Mon, 7 Dec 2020 13:46:03 +0000</updated>
                            <resolved>Sat, 13 Jun 2020 13:31:34 +0000</resolved>
                                    <version>2.4.4</version>
                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                    <fixVersion>2.4.20</fixVersion>
                    <fixVersion>3.0.5</fixVersion>
                    <fixVersion>2.5.13</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="14744778" author="shils" created="Tue, 15 Sep 2015 03:47:39 +0000"  >&lt;p&gt;The underlying issue, I think, is that `if1.doStuff()` results in an invokeVirtual instruction when compiled with @CompileStatic, rather than an invokeInterface instruction (which is what the equivalent java code would yield). This appears to be the result of the way direct method call targets are chosen; the inferred type of a receiver is &apos;preferred&apos; to the declared type of the accessed variable, causing TheImplementation.doStuff() to be chosen over TheInterface.doStuff().&lt;/p&gt;

&lt;p&gt;Edit:&lt;br/&gt;
Looking back at this now, the invokevirtual vs. invokeinterface difference isn&apos;t really the issue; the error in general is with inaccessible direct method call targets, so this bug also occurs when TheInterface is a class which TheImplementation extends.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2j0tz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>