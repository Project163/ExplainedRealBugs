<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:13:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-3044] preserve classLoader in Script.evaluate() method</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-3044</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I&apos;m using the ant task to run a groovy script. It first does some preparation stuff so users of the system can rely on it in their scripts. The way it reads is something like:&lt;/p&gt;

&lt;p&gt;do_some_stuff_and_set_some_vars;&lt;br/&gt;
evaluate(myScript);&lt;/p&gt;

&lt;p&gt;When I set additional classpath through the ant task and have &quot;import package.from.the.additional.classpath.class&quot;, it is available in the step &quot;do_some_stuff_and_set_some_vars&quot;, but it is not available in the evaluate step. Fails with &quot;unable to resolve class package.from.the.additional.classpath.class&quot;.&lt;/p&gt;

&lt;p&gt;To workaround I do&lt;br/&gt;
gsh = new GroovyShell(this.class.classLoader, getBinding());&lt;br/&gt;
gsh.evaluate(myScript);&lt;/p&gt;

&lt;p&gt;And now works. So I believe this is a bug because one would expect to have the same parent ClassLoader besides Binding when using the Script.evaluate() method.&lt;/p&gt;

&lt;p&gt;When using the command line groovy this is not really an issue because classpath is set globally through the -cp argument. But when running groovy scripts programatically like with ant, then it turns out to be an issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12814376">GROOVY-3044</key>
            <summary>preserve classLoader in Script.evaluate() method</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="avalon">A</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Sep 2008 09:39:13 +0000</created>
                <updated>Fri, 2 Oct 2009 05:44:21 +0000</updated>
                            <resolved>Wed, 30 Sep 2009 17:46:26 +0000</resolved>
                                    <version>1.5.4</version>
                                    <fixVersion>1.6.5</fixVersion>
                    <fixVersion>1.7-beta-2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14465327" author="blackdrag" created="Thu, 18 Sep 2008 11:54:04 +0000"  >&lt;p&gt;just to be clear... you have a script like this &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; bar
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; foo.Bar
&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Bar()
evaluate &quot;&quot;&quot;
  &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Bar() &lt;span class=&quot;code-comment&quot;&gt;// Bar exists only in &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; foo
&lt;/span&gt;&quot;&quot;&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and you expect this not to fail. If yes, then sorry, that is no  error. If you have a script  &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; bar
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; foo.Bar
&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Bar()
evaluate &quot;&quot;&quot;
  &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; foo.Bar
  &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Bar() &lt;span class=&quot;code-comment&quot;&gt;// Bar exists only in &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; foo
&lt;/span&gt;&quot;&quot;&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and the first import and &quot;new Bar()&quot; works, but the second in evaluate does not, then it is a bug, yes. Script#evaluate does look like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        GroovyShell shell = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyShell(binding);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; shell.evaluate(expression);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; so the parent class loader will be set in the wrong way, yes.&lt;/p&gt;

&lt;p&gt;So I guess it is a bug &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14465347" author="avalon" created="Fri, 19 Sep 2008 00:44:53 +0000"  >&lt;p&gt;Yes, in your second example it would fail &lt;b&gt;on&lt;/b&gt; &quot;import foo.Bar&quot; in the evaluated script.&lt;/p&gt;

&lt;p&gt;As you show the code of Script#evaluate, one obvious solution is to change it so it passes its ClassLoader when constructing the GroovyShell. But I wonder why GroovyShell doesn&apos;t pick up by default its classloader?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; GroovyShell(Binding binding) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, binding);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Could be:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; GroovyShell(Binding binding) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;classLoader, binding);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14467854" author="blackdrag" created="Wed, 30 Sep 2009 12:20:44 +0000"  >&lt;p&gt;this(this.class.classLoader, binding);&lt;/p&gt;

&lt;p&gt;will not work, in Java this would not be legal, in Groovy this.class.classLoader would return the application loader maybe, but in the end it would be much different from the version with null&lt;/p&gt;</comment>
                            <comment id="14467764" author="blackdrag" created="Wed, 30 Sep 2009 17:46:26 +0000"  >&lt;p&gt;fixed&lt;/p&gt;</comment>
                            <comment id="14467916" author="avalon" created="Fri, 2 Oct 2009 05:44:20 +0000"  >&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 8 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bw2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>