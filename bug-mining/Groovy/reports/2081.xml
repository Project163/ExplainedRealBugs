<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:31:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-5901] @AutoClone excludes param works correctly only for COPY_CONSTRUCTOR AutoCloneStyle</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-5901</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;It seems the clone() method added by AST transformation due to @AutoClone annotation doesn&apos;t correctly use info inserted in &apos;excludes&apos; annotation param with CLONE and SERIALIZATION AutoCloneStyle (&lt;a href=&quot;http://groovy.codehaus.org/gapi/groovy/transform/AutoClone.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://groovy.codehaus.org/gapi/groovy/transform/AutoClone.html&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;It correctly works only for COPY_CONSTRUCTOR AutoCloneStyle&lt;/p&gt;

&lt;p&gt;@AutoClone(style=COPY_CONSTRUCTOR, excludes = &apos;last&apos;)&lt;br/&gt;
class Person_C {&lt;br/&gt;
  String first, last&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;Please refer to my testcase published at &lt;a href=&quot;http://groovyconsole.appspot.com/script/830001&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://groovyconsole.appspot.com/script/830001&lt;/a&gt;&lt;/p&gt;


</description>
                <environment></environment>
        <key id="12816719">GROOVY-5901</key>
            <summary>@AutoClone excludes param works correctly only for COPY_CONSTRUCTOR AutoCloneStyle</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="joshua68it">Giovanni Siano</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Jan 2013 13:11:14 +0000</created>
                <updated>Fri, 18 Jan 2013 16:06:54 +0000</updated>
                            <resolved>Tue, 15 Jan 2013 06:20:50 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>1.8.8</version>
                                    <fixVersion>2.1.0-rc-2</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                    <fixVersion>1.8.9</fixVersion>
                    <fixVersion>2.0.7</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14480128" author="paulk" created="Sun, 13 Jan 2013 00:08:23 +0000"  >&lt;p&gt;This is &quot;by design&quot; in some sense.&lt;/p&gt;

&lt;p&gt;When using the &lt;tt&gt;CLONE&lt;/tt&gt; style, &lt;tt&gt;super.clone()&lt;/tt&gt; is called which does a bit-wise clone if you don&apos;t have your own base class overriding the behavior in &lt;tt&gt;Object&lt;/tt&gt;. Here the &lt;tt&gt;includeFields&lt;/tt&gt; and &lt;tt&gt;excludes&lt;/tt&gt; parameters are used to control whether additional calls to the &lt;tt&gt;clone()&lt;/tt&gt; method for each property/field will occur; for &lt;tt&gt;String&lt;/tt&gt; fields like in your example this is effectively just an efficiency thing - String isn&apos;t &lt;tt&gt;Cloneable&lt;/tt&gt; so &lt;tt&gt;clone()&lt;/tt&gt; wouldn&apos;t be called in any case but it would avoid the conditional logic which did the check for &lt;tt&gt;Cloneable&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;When using the &lt;tt&gt;SERIALIZATION&lt;/tt&gt; style, the &lt;tt&gt;includeFields&lt;/tt&gt; and &lt;tt&gt;excludes&lt;/tt&gt; parameters are ignored and instead you should adjust your serialization implementation to reflect what properties/fields should be cloned.&lt;/p&gt;

&lt;p&gt;I intend to adjust the documentation to better describe these &quot;features&quot; of &lt;tt&gt;@AutoClone&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14480135" author="paulk" created="Sun, 13 Jan 2013 00:28:41 +0000"  >&lt;p&gt;Proposed change is in master; let me know if this makes things clearer.&lt;/p&gt;

&lt;p&gt;In terms of the actual implementation details, we are constrained somewhat by the current Java library design. The only thing I can think of doing in addition to the current implementation would be to explicitly go and set references to null (and potentially primitive types to default values) for &quot;excluded&quot; properties (and/or fields) but I suspect that we would only be setting ourselves up to allow the creation of poorly behaving clone implementations whereas the intention behind @AutoClone is to try to make it easier to implement one of the deemed &quot;best practice&quot; implementations of cloning given the known weaknesses and pitfalls of cloning in the Java world.&lt;/p&gt;</comment>
                            <comment id="14473793" author="joshua68it" created="Mon, 14 Jan 2013 02:50:39 +0000"  >&lt;p&gt;Thank you Paul.&lt;/p&gt;

&lt;p&gt;I discovered this &quot;feature&quot; using @AutoClone on a Grails domain class which, unexpectedly for me, clones  &apos;id&apos; and &apos;version&apos; field.&lt;/p&gt;

&lt;p&gt;I&apos;d appreciate the new implementation you suggest. &lt;/p&gt;

&lt;p&gt;Do you think would it be possible to use default class constructor before &quot;copy&quot; the not excluded fields into the new instance?&lt;/p&gt;
</comment>
                            <comment id="14480141" author="paulk" created="Mon, 14 Jan 2013 05:44:43 +0000"  >&lt;p&gt;One thing we could do is to introduce another style, e.g. SIMPLE - though I am a little worried that adding another style is just making things more complex. Having said that, I haven&apos;t thought much about use of @AutoClone in a Grails context so perhaps something is required. Anyway, I think there would be several possible ways to implement such a style.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Same as CLONE but don&apos;t call super.clone() just copy the included properties/fields and also give a compile time error if the class has a super class (as we would have no way to &quot;clone&quot; the fields of the parent class)&lt;/li&gt;
	&lt;li&gt;Same as above but instead of giving an error, call super.clone() iff there is a super class&lt;/li&gt;
	&lt;li&gt;Make a protected cloneAttributes() method and have the public clone() method call that method - also calling super.cloneAttributes() if there is a super class (checking the method exists by either reflection or looking for the AutoClone annotation on the parent)&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="14473794" author="joshua68it" created="Mon, 14 Jan 2013 10:41:59 +0000"  >&lt;p&gt;IMHO, I think the third implementation way would it be the best choice for flexibility.&lt;/p&gt;</comment>
                            <comment id="14473964" author="paulk" created="Mon, 14 Jan 2013 23:34:21 +0000"  >&lt;p&gt;Proposed change:&lt;br/&gt;
&lt;a href=&quot;https://github.com/paulk-asert/groovy-core/commit/9afe4d53&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/paulk-asert/groovy-core/commit/9afe4d53&lt;/a&gt;&lt;br/&gt;
(this assumes that if a child class implements the &lt;tt&gt;SIMPLE&lt;/tt&gt; style that its parent will also implement that style or has a manually added &lt;tt&gt;cloneOrCopyMembers&lt;/tt&gt; method, otherwise a &lt;tt&gt;MissingMethodException&lt;/tt&gt; will be thrown at runtime)&lt;/p&gt;</comment>
                            <comment id="14480130" author="paulk" created="Tue, 15 Jan 2013 06:20:50 +0000"  >&lt;p&gt;SIMPLE style added as per earlier comments&lt;/p&gt;

&lt;p&gt;NOTE: the fix version applies to the javadoc improvements. SIMPLE is only in 2.1.0-rc-2 and above.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 45 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ccxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>