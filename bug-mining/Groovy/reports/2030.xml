<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:30:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-5289] Using GroovyServlet deployed to Tomcat with a multi-level context causes 404 errors</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-5289</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;When deploying an application which use the GroovyServlet to Tomcat with a simple context, there are no problems.  However, when deploying the same application to the same Tomcat instance using a multi-level context a 404 error is returned.&lt;/p&gt;

&lt;p&gt;Attaching a sample application which demonstrates this behavior.  Simply run &quot;mvn package&quot; to create a WAR from the project.  Take the &quot;groovyweb.war&quot; file from the &quot;target&quot; directory and deploy it to a Tomcat server.  This will work just fine.  Now take the same WAR file, rename it to &quot;apps#groovyweb.war&quot; and deploy it to Tomcat.  Now a 404 is presented and in the log, a message indicates that the groovy script cannot be found.&lt;/p&gt;

&lt;p&gt;----------------&lt;/p&gt;

&lt;p&gt;Looking into this, it appears that the &quot;#&quot; in the name is causing the problem.  In the &quot;loadScriptName&quot; method of GroovyScriptEngine, it is calling &quot;conn.getURL().getPath()&quot; on the URLConnection to the resource.  Because there is a &quot;#&quot; character in the URL, this only returns the part of the URL up to the &quot;#&quot; character.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;GroovyScriptEngine.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; loadScriptByName(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; scriptName) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ResourceException, ScriptException {
    URLConnection conn = rc.getResourceConnection(scriptName);
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; path = conn.getURL().getPath();
    ScriptCacheEntry entry = scriptCache.get(path);
    &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; clazz = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (entry != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) clazz = entry.scriptClass;
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isSourceNewer(entry)) {
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; encoding = conn.getContentEncoding() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? conn.getContentEncoding() : &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;;
                clazz = groovyLoader.parseClass(DefaultGroovyMethods.getText(conn.getInputStream(), encoding), path);
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ResourceException(e);
            }
        }
    } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
        forceClose(conn);
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; clazz;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>Ubuntu Linux, Tomcat 7</environment>
        <key id="12816089">GROOVY-5289</key>
            <summary>Using GroovyServlet deployed to Tomcat with a multi-level context causes 404 errors</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="dmikusa">Daniel Mikusa</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Feb 2012 14:18:06 +0000</created>
                <updated>Sat, 22 Dec 2012 01:10:52 +0000</updated>
                            <resolved>Wed, 5 Dec 2012 02:52:12 +0000</resolved>
                                    <version>1.8.3</version>
                    <version>1.8.5</version>
                                    <fixVersion>2.0.6</fixVersion>
                    <fixVersion>1.8.9</fixVersion>
                                    <component>Groovlet / GSP</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14472324" author="blackdrag" created="Mon, 13 Feb 2012 08:51:28 +0000"  >&lt;p&gt;I have the tendency to close this issue as &quot;Won&apos;t fix&quot;, since I think we cannot really do anything about the limitation of URL#getPath. But before doing that... what is does &quot;multi-level context&quot; mean here?&lt;/p&gt;</comment>
                            <comment id="14472411" author="blackdrag" created="Mon, 13 Feb 2012 08:57:42 +0000"  >&lt;p&gt;CARGO-734 seems to be a related issue from a different project&lt;/p&gt;</comment>
                            <comment id="14472431" author="jcwuerfl" created="Mon, 13 Feb 2012 09:00:08 +0000"  >&lt;p&gt;Example:&lt;/p&gt;

&lt;p&gt;/groovyweb        &amp;lt;- single level&lt;br/&gt;
/apps/groovyweb   &amp;lt;- multi-level&lt;/p&gt;


&lt;p&gt;Where the groovy application is a sub-url &lt;/p&gt;

&lt;p&gt;This used to work in 1.6.5 version of Groovy until changes were made in 1.7 it looks like.   Under Tomcat autodeploy naming rules / contexts both are allowed see:&lt;/p&gt;


&lt;p&gt;&lt;a href=&quot;http://tomcat.apache.org/tomcat-7.0-doc/config/context.html#Naming&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://tomcat.apache.org/tomcat-7.0-doc/config/context.html#Naming&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;To me this is actually a huge issue that I would like to get resolved with GroovyScript.   Otherwise I have to define many different applications in our proxy for each application vs. just specifying a multi-level application aka : under /apps/myappname&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;


</comment>
                            <comment id="14472361" author="blackdrag" created="Mon, 13 Feb 2012 11:02:37 +0000"  >&lt;p&gt;Since 1.7 there is a new GroovyScriptEngine that uses the GroovyClassLoader and URLs instead of only path names, yes. But reenabling that is very difficult, the current design does not really allow for that and you would need a almost completely new GSE. You see the &quot;bug&quot; is actually the url logic in which # is used for other purposes. For the usage in an URL, you would normally have to &quot;encode&quot; it. My time with tomcat is quite a while back already, but wasn&apos;t there a way to rewrite the paths before the servlet gets those? If that exists, wouldn&apos;t that be an option for you?&lt;/p&gt;</comment>
                            <comment id="14472477" author="jcwuerfl" created="Mon, 13 Feb 2012 11:13:21 +0000"  >&lt;p&gt;I&apos;m dealing with this from an Operations/Infrastructure perspective and there is not an easy way to rewrite the paths before the servlet gets it that I&apos;m aware of.   &lt;/p&gt;

&lt;p&gt;However, wouldn&apos;t GSE need to conform to the TC Naming Context Rules ?   In other words I don&apos;t think this is a Tomcat issue ?  Why was it changed to include both URLs and path names in 1.7 vs. just the path names ?&lt;/p&gt;





</comment>
                            <comment id="14472397" author="dmikusa" created="Mon, 13 Feb 2012 11:26:52 +0000"  >&lt;p&gt;I took a further look into this today and I think that my initial assessment was off a bit.  After further review, I believe that the GroovyScriptEngine#loadScriptByName method is not causing this problem, but it is the AbstractHttpServlet#getResourceConnection method which could be improved.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; URLConnection getResourceConnection(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ResourceException {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; basePath = servletContext.getRealPath(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (name.startsWith(basePath)) name = name.substring(basePath.length());

        name = name.replaceAll(&lt;span class=&quot;code-quote&quot;&gt;&quot;\\\\&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;);

        &lt;span class=&quot;code-comment&quot;&gt;//remove the leading / as we are trying with a leading / now
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (name.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;)) name = name.substring(1);

        /*
        * Try to locate the resource and &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; an opened connection to it.
        */
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tryScriptName = &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; + name;
            URL url = servletContext.getResource(tryScriptName);
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (url == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                tryScriptName = &lt;span class=&quot;code-quote&quot;&gt;&quot;/WEB-INF/groovy/&quot;&lt;/span&gt; + name;
                url = servletContext.getResource(&lt;span class=&quot;code-quote&quot;&gt;&quot;/WEB-INF/groovy/&quot;&lt;/span&gt; + name);
            }
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (url == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ResourceException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Resource \&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot; + name + &quot;&lt;/span&gt;\&lt;span class=&quot;code-quote&quot;&gt;&quot; not found!&quot;&lt;/span&gt;);
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                url = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URL(&lt;span class=&quot;code-quote&quot;&gt;&quot;file&quot;&lt;/span&gt;, &quot;&quot;, servletContext.getRealPath(tryScriptName));
            }
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; url.openConnection();
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ResourceException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Problems getting resource named \&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot; + name + &quot;&lt;/span&gt;\&lt;span class=&quot;code-quote&quot;&gt;&quot;!&quot;&lt;/span&gt;, e);
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Would it be possible to change this implementation to use a URI, which handles escaping invalid characters?  &lt;/p&gt;

&lt;p&gt;I successfully tested this in the sample application by subclassing GroovyServlet and overriding getResourceConnection with the following code.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; URLConnection getResourceConnection(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ResourceException {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; basePath = servletContext.getRealPath(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;);
        
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            URI nameUri = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URI(name);
            name = nameUri.getPath();
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (URISyntaxException ex) {
            &lt;span class=&quot;code-comment&quot;&gt;// ignore and use existing name
&lt;/span&gt;        }
        
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (name.startsWith(basePath)) name = name.substring(basePath.length());

        name = name.replaceAll(&lt;span class=&quot;code-quote&quot;&gt;&quot;\\\\&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;);

        &lt;span class=&quot;code-comment&quot;&gt;//remove the leading / as we are trying with a leading / now
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (name.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;)) name = name.substring(1);

        /*
        * Try to locate the resource and &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; an opened connection to it.
        */
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tryScriptName = &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; + name;
            URL url = servletContext.getResource(tryScriptName);
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (url == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                tryScriptName = &lt;span class=&quot;code-quote&quot;&gt;&quot;/WEB-INF/groovy/&quot;&lt;/span&gt; + name;
                url = servletContext.getResource(&lt;span class=&quot;code-quote&quot;&gt;&quot;/WEB-INF/groovy/&quot;&lt;/span&gt; + name);
            }
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (url == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ResourceException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Resource \&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot; + name + &quot;&lt;/span&gt;\&lt;span class=&quot;code-quote&quot;&gt;&quot; not found!&quot;&lt;/span&gt;);
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            	URI realPath = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URI(&lt;span class=&quot;code-quote&quot;&gt;&quot;file&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;, servletContext.getRealPath(tryScriptName), &quot;&lt;/span&gt;&quot;);
                url = realPath.toURL();
            }
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; url.openConnection();
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ResourceException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Problems getting resource named \&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot; + name + &quot;&lt;/span&gt;\&lt;span class=&quot;code-quote&quot;&gt;&quot;!&quot;&lt;/span&gt;, e);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (URISyntaxException e) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ResourceException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Problems getting resource named \&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot; + name + &quot;&lt;/span&gt;\&lt;span class=&quot;code-quote&quot;&gt;&quot;!&quot;&lt;/span&gt;, e);
	}
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14472377" author="blackdrag" created="Mon, 13 Feb 2012 11:55:03 +0000"  >&lt;p&gt;ah, Daniel, I think this is a nice catch. Yes, this looks like it is possible. All you added is &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            URI nameUri = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URI(name);
            name = nameUri.getPath();
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (URISyntaxException ex) {
            &lt;span class=&quot;code-comment&quot;&gt;// ignore and use existing name
&lt;/span&gt;        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;right?&lt;/p&gt;</comment>
                            <comment id="14472416" author="dmikusa" created="Mon, 13 Feb 2012 12:38:02 +0000"  >&lt;p&gt;Two changes...&lt;/p&gt;

&lt;p&gt;1.) At the top&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            URI nameUri = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URI(name);
            name = nameUri.getPath();
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (URISyntaxException ex) {
            &lt;span class=&quot;code-comment&quot;&gt;// ignore and use existing name
&lt;/span&gt;        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2.) Prior to the return&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;     URI realPath = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URI(&lt;span class=&quot;code-quote&quot;&gt;&quot;file&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;, servletContext.getRealPath(tryScriptName), &quot;&lt;/span&gt;&quot;);
     url = realPath.toURL();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Sorry, I should have submitted a patch.&lt;/p&gt;</comment>
                            <comment id="14472483" author="guillaume" created="Mon, 13 Feb 2012 13:43:16 +0000"  >&lt;p&gt;A patch attached to the JIRA issue, or a GitHub pull request would be awesome &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
We always love contributions!&lt;/p&gt;</comment>
                            <comment id="14472521" author="jcwuerfl" created="Wed, 15 Feb 2012 10:35:23 +0000"  >&lt;p&gt;Daniel, where you able to submit the patch then? or Guillaume were you going to do that then?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="14472508" author="dmikusa" created="Wed, 15 Feb 2012 10:56:33 +0000"  >&lt;p&gt;Working on it.  Should have it posted shortly.&lt;/p&gt;</comment>
                            <comment id="14472417" author="dmikusa" created="Wed, 15 Feb 2012 12:49:53 +0000"  >&lt;p&gt;Attaching two patches against Groovy 1.8.6.&lt;/p&gt;

&lt;p&gt;The first is a patch with the change that I proposed to the AbstractHttpServlet#getResourceConnection method.&lt;/p&gt;

&lt;p&gt;The second is a patch to the test cases for AbstractHttpServlet.  With the change applied to AbstractHttpServlet, there are a few tests which will fail.  These seem to fail because the mock implementation of &quot;getRealPath&quot; is returning a relative path.  I&apos;ve simply changed the mock implementation to return a full path (i.e. one that starts with &quot;/&quot;).&lt;/p&gt;</comment>
                            <comment id="14473569" author="blackdrag" created="Mon, 3 Dec 2012 10:18:09 +0000"  >&lt;p&gt;Daniel, first sorry for not coming back to this much earlier. It is nice to have a patch, but without the changes to the tests, the tests fail. This means it is not compatible with older versions, a breaking change. Such a change has no big chance to get into 1.8.x or 2.0.x. &lt;/p&gt;</comment>
                            <comment id="14473504" author="jcwuerfl" created="Mon, 3 Dec 2012 12:16:53 +0000"  >&lt;p&gt;So who normally creates the &quot;changes to the tests&quot; so that they do not fail? We need to get this done to make sure it will work with future versions.  Sorry, I&apos;m an end user not a developer but following this but because deploying applications with autodeploy using the standard tomcat naming was breaking my applications.&lt;/p&gt;

&lt;p&gt;Thank you to whomever can add the new test cases to get this resolved for future versions.&lt;/p&gt;</comment>
                            <comment id="14473439" author="blackdrag" created="Mon, 3 Dec 2012 14:56:10 +0000"  >&lt;p&gt;I can change them, that in itself is not the problem. Changes to existing tests have to be justified. There are there to avoid regression and to avoid a breaking change is done accidentally. &lt;/p&gt;

&lt;p&gt;In an ideal world the patch would not require those test to be changed.&lt;/p&gt;

&lt;p&gt;In the meantime I made several changes to AbstractHttpServlet, see &lt;a href=&quot;https://github.com/groovy/groovy-core/blob/master/subprojects/groovy-servlet/src/main/java/groovy/servlet/AbstractHttpServlet.java#L170&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/groovy/groovy-core/blob/master/subprojects/groovy-servlet/src/main/java/groovy/servlet/AbstractHttpServlet.java#L170&lt;/a&gt; We are now using URI in the beginning, so I see a chance your changes may not be required anymore. Though your patch goes further then just using the servlet base path, and I assume that is what is required for you as well. I wonder if we can go with a &quot;new File(servletContext.getRealPath(tryScriptName)).toURI().toURL().toExternalForm()&quot; and not break the tests&lt;/p&gt;</comment>
                            <comment id="14473570" author="blackdrag" created="Wed, 5 Dec 2012 02:52:12 +0000"  >&lt;p&gt;James, I did a commit that for me works. I was able to use the multilevel context as well as not getting a 404 on the second try. I am marking the issue as resolved for now. I would like you to try out the change and confirm it is working for you as well. If it does not, we will have to open the issue again&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722913" name="AbstractHttpServlet.java.patch" size="1647" author="dmikusa" created="Wed, 15 Feb 2012 12:49:53 +0000"/>
                            <attachment id="12722988" name="AbstractHttpServletTest.groovy.patch" size="2967" author="dmikusa" created="Wed, 15 Feb 2012 12:49:53 +0000"/>
                            <attachment id="12722159" name="groovyweb.tar.gz" size="2297" author="dmikusa" created="Wed, 8 Feb 2012 14:18:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 50 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bpev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>