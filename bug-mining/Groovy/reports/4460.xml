<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:19:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-10659] Parrot Parser: named arguments does not support all key expressions</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-10659</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;This is IMO a regression (wrt. e.g. Groovy 2.4.11), the following does not compile in Groovy 3.0.10.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
def fun = { arg -&amp;gt;
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; arg
}

fun (
&#160; &#160; x: 1,
&#160; &#160; [a: 1]: &lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;
)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is the combination of the following:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;map literal is used as an argument of a function, without enclosing brackets (I hope this&#160; is legal)&lt;/li&gt;
	&lt;li&gt;another map literal is used as a key of the outer map (I hope this is legal too)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If both these preconditions are met, the compiler complains with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed:
index.groovy: 5: Unexpected input: &lt;span class=&quot;code-quote&quot;&gt;&apos;(&apos;&lt;/span&gt; @ line 5, column 5.
&#160; &#160;fun (
&#160; &#160; &#160; &#160;^
1 error &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This does compile:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
def fun = { arg -&amp;gt;
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; arg
}

fun (
&#160; &#160; x: 1,
&#160; &#160; a: &lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;
)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So does this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
def fun = { arg -&amp;gt;
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; arg
}

fun ([
&#160; &#160; x: 1,
&#160; &#160; [a: 1]: &lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;
]) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Is this a bug?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13450587">GROOVY-10659</key>
            <summary>Parrot Parser: named arguments does not support all key expressions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daniel_sun">Daniel Sun</assignee>
                                    <reporter username="michal.sevcenko">Michal &#352;ev&#269;enko</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Jun 2022 10:08:26 +0000</created>
                <updated>Sat, 23 Jul 2022 21:05:47 +0000</updated>
                            <resolved>Sat, 2 Jul 2022 04:35:52 +0000</resolved>
                                                    <fixVersion>3.0.12</fixVersion>
                    <fixVersion>4.0.4</fixVersion>
                                    <component>parser-antlr4</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17555661" author="emilles" created="Fri, 17 Jun 2022 15:26:54 +0000"  >&lt;p&gt;For a non-string, non-integer key, you need to surround the key expression in parentheses. &lt;/p&gt;</comment>
                            <comment id="17556111" author="JIRAUSER291133" created="Sun, 19 Jun 2022 18:35:34 +0000"  >&lt;p&gt;Do I? Ok that may help, as a workaround.&lt;/p&gt;

&lt;p&gt;So I take it that the examples above, not needing the expression surrounded, do work by accident?&lt;/p&gt;

&lt;p&gt;The documentation &lt;a href=&quot;https://docs.groovy-lang.org/next/html/documentation/working-with-collections.html#_map_literals&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.groovy-lang.org/next/html/documentation/working-with-collections.html#_map_literals&lt;/a&gt; is not very specific about what is legal in map literal syntax, is there some more thorough documentation?&lt;/p&gt;

&lt;p&gt;Problem is, that we relied on the syntax that worked before - it is just a rather powerful DSL construct, and the notation with parentheses is just a bit uglier. Not to mention that all those DSL files are now broken and need to be updated to compile in new Groovy.&lt;/p&gt;

&lt;p&gt;So it seems that its yet another instance of Hyrum&apos;s Law in action.&lt;/p&gt;

&lt;p&gt;I was just curious that this change in Groovy parser might be accidental and is repairable. Thanks for reply anyway.&lt;/p&gt;</comment>
                            <comment id="17556128" author="emilles" created="Sun, 19 Jun 2022 21:15:11 +0000"  >&lt;p&gt;Well, I guess the new grammar does seem to support maps (and other expression kinds) as map literal keys.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
map
    :   LBRACK
        (   mapEntryList COMMA?
        |   COLON
        )
        RBRACK
    ;

mapEntryList
    :   mapEntry (COMMA mapEntry)*
    ;

mapEntry
    :   mapEntryLabel COLON nls expression
    |   MUL COLON nls expression
    ;

mapEntryLabel
    :   keywords
    |   primary
    ;

primary
    :
        identifier typeArguments?                                                           #identifierPrmrAlt
    |   literal                                                                             #literalPrmrAlt
    |   gstring                                                                             #gstringPrmrAlt
    |   NEW nls creator[0]                                                                  #newPrmrAlt
    |   THIS                                                                                #thisPrmrAlt
    |   SUPER                                                                               #superPrmrAlt
    |   parExpression                                                                       #parenPrmrAlt
    |   closureOrLambdaExpression                                                           #closureOrLambdaExpressionPrmrAlt
    |   list                                                                                #listPrmrAlt
    |   map                                                                                 #mapPrmrAlt
    |   builtInType                                                                         #builtInTypePrmrAlt
    ;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/blob/master/src/antlr/GroovyParser.g4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/blob/master/src/antlr/GroovyParser.g4&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17556224" author="JIRAUSER291133" created="Mon, 20 Jun 2022 07:05:17 +0000"  >&lt;p&gt;Well, it surely does. As I demonstrated in my examples.&lt;/p&gt;

&lt;p&gt;The problem is combination of using expression as map key, &lt;em&gt;and at the same time&lt;/em&gt;, using the internal list of the map literal, as an argument to a function, with the outer bracket omitted. Which is perhaps another undocumented feature.&lt;/p&gt;

&lt;p&gt;But many thanks for the grammar, maybe I can look for the regression there.&lt;/p&gt;</comment>
                            <comment id="17556248" author="JIRAUSER291133" created="Mon, 20 Jun 2022 07:55:29 +0000"  >&lt;p&gt;The latter syntax is indeed documented, in the section&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://docs.groovy-lang.org/docs/next/html/documentation/#_named_parameters_2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.groovy-lang.org/docs/next/html/documentation/#_named_parameters_2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It allows to call method with named parameters, which internally creates a map. Such as in &lt;tt&gt;fun (x: 1, a: &apos;2&apos;)&lt;/tt&gt;. But we use this feature not to bind keys in the map to formal parameters of the method, but to bind the whole map to one formal parameter of the method.&lt;/p&gt;

&lt;p&gt;And this syntax - inline map literal defining method argument(s), ceased to support arbitrary expressions as keys.&#160;&lt;/p&gt;</comment>
                            <comment id="17557691" author="emilles" created="Wed, 22 Jun 2022 20:43:13 +0000"  >&lt;p&gt;In Groovy 3, you can set system property &lt;tt&gt;groovy.antlr4=false&lt;/tt&gt; to revert to the antlr2 parser.  This can help confirm that the issue is in the new parser and not elsewhere.&lt;/p&gt;</comment>
                            <comment id="17560205" author="JIRAUSER291133" created="Wed, 29 Jun 2022 11:31:38 +0000"  >&lt;p&gt;Looks like that the workaround works.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;In Groovy 3, you can set system property&#160;&lt;tt&gt;groovy.antlr4=false&lt;/tt&gt;&#160;to revert to the antlr2 parser. This can help confirm that the issue is in the new parser and not elsewhere.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="17560324" author="daniel_sun" created="Wed, 29 Jun 2022 15:36:27 +0000"  >&lt;p&gt;I will set aside some spare time to look into the issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 19 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z13boo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>