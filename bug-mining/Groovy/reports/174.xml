<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:56:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-815] Include of groovlets does not work</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-815</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;from Java:&lt;/p&gt;

&lt;p&gt;sc.getRequestDispatcher(&quot;someGroovlet.groovy&quot;).include(request,response);&lt;/p&gt;

&lt;p&gt;or from jsp:&lt;/p&gt;

&lt;p&gt;&amp;lt;jsp:include page=&quot;someGroovlet.groovy&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;For a request with different URI then someGroovlet.xxx will throw exception :&lt;/p&gt;

&lt;p&gt;java.lang.StringIndexOutOfBoundsException: String index out of range: -1&lt;br/&gt;
	java.lang.String.substring(String.java:1444)&lt;br/&gt;
	groovy.servlet.GroovyServlet.getGroovyScriptPath(GroovyServlet.java:267)&lt;br/&gt;
	groovy.servlet.GroovyServlet.service(GroovyServlet.java:192)&lt;br/&gt;
	org.apache.jasper.runtime.JspRuntimeLibrary.include(JspRuntimeLibrary.java:966)&lt;br/&gt;
	org.apache.jsp.index_jsp._jspService(index_jsp.java:53)&lt;br/&gt;
	org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:94)&lt;br/&gt;
	javax.servlet.http.HttpServlet.service(HttpServlet.java:802)&lt;br/&gt;
	org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:324)&lt;br/&gt;
	org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:292)&lt;br/&gt;
	org.apache.jasper.servlet.JspServlet.service(JspServlet.java:236)&lt;br/&gt;
	javax.servlet.http.HttpServlet.service(HttpServlet.java:802)&lt;/p&gt;

&lt;p&gt;(Try for / content including groovlet in index.jsp )&lt;/p&gt;

&lt;p&gt;One proposal to resolve this according to Servlet 2.2 spec would be following patch in org.groovy.GroovyServlet.getGroovyScriptPath(HttpServletRequest) :&lt;/p&gt;

&lt;p&gt;    	String strURI = null;&lt;br/&gt;
    	String includeURI = (String)request.getAttribute(&quot;javax.servlet.include.request_uri&quot;);&lt;br/&gt;
    	if (includeURI != null) &lt;/p&gt;
{
    		strURI = includeURI;
    	}
&lt;p&gt; else &lt;/p&gt;
{
    		strURI = request.getRequestURI();
    	}

&lt;p&gt;    	// Get the name of the Groovy script&lt;/p&gt;

&lt;p&gt;    	int contextLength = request.getContextPath().length();&lt;br/&gt;
        String scriptFilename = strURI&lt;br/&gt;
            .substring(contextLength).substring(1);&lt;/p&gt;

&lt;p&gt;instead of :&lt;/p&gt;

&lt;p&gt;        // Get the name of the Groovy script&lt;br/&gt;
        int contextLength = request.getContextPath().length();&lt;br/&gt;
        String scriptFilename = request.getRequestURI()&lt;br/&gt;
            .substring(contextLength).substring(1);&lt;/p&gt;</description>
                <environment>Win XP , JDK 1.4.2</environment>
        <key id="12816143">GROOVY-815</key>
            <summary>Include of groovlets does not work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sormuras">sormuras</assignee>
                                    <reporter username="boris">Boris Schrijver</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Apr 2005 12:18:38 +0000</created>
                <updated>Wed, 11 May 2005 17:04:44 +0000</updated>
                            <resolved>Mon, 9 May 2005 10:35:45 +0000</resolved>
                                                    <fixVersion>1.0-JSR-2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="14460960" author="sormuras" created="Wed, 4 May 2005 00:12:57 +0000"  >&lt;p&gt;Had the same problem in TemplateServlet: &lt;a href=&quot;http://jira.codehaus.org/browse/GROOVY-357&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jira.codehaus.org/browse/GROOVY-357&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;TemplateServlet is now overhauled &lt;a href=&quot;http://jira.codehaus.org/browse/GROOVY-814&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jira.codehaus.org/browse/GROOVY-814&lt;/a&gt;, I&apos;ll fix the include thing in GroovyServlet accordingly.&lt;/p&gt;</comment>
                            <comment id="14460929" author="sormuras" created="Wed, 4 May 2005 02:49:48 +0000"  >&lt;p&gt;Took Boris proposal and patched it in.&lt;/p&gt;

&lt;p&gt;Better let GroovyServlet and TemplateServlet share common knownledge about the Servlet API in an abstract super class?&lt;/p&gt;</comment>
                            <comment id="14460975" author="sormuras" created="Thu, 5 May 2005 03:36:54 +0000"  >&lt;p&gt;Excerpt from groovy.servlet.AbstractHttpServlet. Boris, is this fine with you?&lt;/p&gt;

&lt;p&gt;And can anybody tell me why Jasper doesn&apos;t use the &quot;request.getRequestURI()&quot;?&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
Christian&lt;/p&gt;

&lt;p&gt;  protected String getScriptUri(HttpServletRequest request) {&lt;br/&gt;
    //&lt;br/&gt;
    // NOTE: This piece of code is heavily inspired by Apaches Jasper2!&lt;br/&gt;
    // &lt;br/&gt;
    // &lt;a href=&quot;http://cvs.apache.org/viewcvs.cgi/jakarta-tomcat-jasper/jasper2/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cvs.apache.org/viewcvs.cgi/jakarta-tomcat-jasper/jasper2/&lt;/a&gt; \&lt;br/&gt;
    //        src/share/org/apache/jasper/servlet/JspServlet.java?view=markup&lt;br/&gt;
    //&lt;br/&gt;
    // Why doesn&apos;t it use request.getRequestURI() or INC_REQUEST_URI?&lt;br/&gt;
    //&lt;/p&gt;

&lt;p&gt;    String uri = null;&lt;br/&gt;
    String info = null;&lt;/p&gt;

&lt;p&gt;    //&lt;br/&gt;
    // Check to see if the requested script/template source file has been the&lt;br/&gt;
    // target of a RequestDispatcher.include().&lt;br/&gt;
    //&lt;br/&gt;
    uri = (String) request.getAttribute(INC_SERVLET_PATH);&lt;br/&gt;
    if (uri != null) {&lt;br/&gt;
      //&lt;br/&gt;
      // Requested script/template file has been target of &lt;br/&gt;
      // RequestDispatcher.include(). Its path is assembled from the relevant&lt;br/&gt;
      // javax.servlet.include.* request attributes and returned!&lt;br/&gt;
      //&lt;br/&gt;
      info = (String) request.getAttribute(INC_PATH_INFO);&lt;br/&gt;
      if (info != null) &lt;/p&gt;
{
        uri += info;
      }
&lt;p&gt;      return uri;&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;    //&lt;br/&gt;
    // Requested script/template file has not been the target of a &lt;br/&gt;
    // RequestDispatcher.include(). Reconstruct its path from the request&apos;s&lt;br/&gt;
    // getServletPath() and getPathInfo() results.&lt;br/&gt;
    //&lt;br/&gt;
    uri = request.getServletPath();&lt;br/&gt;
    info = request.getPathInfo();&lt;br/&gt;
    if (info != null) &lt;/p&gt;
{
      uri += info;
    }

&lt;p&gt;    return uri;&lt;br/&gt;
  }&lt;/p&gt;</comment>
                            <comment id="14460904" author="sormuras" created="Thu, 5 May 2005 03:55:17 +0000"  >&lt;p&gt;Found at least an usage of&lt;/p&gt;

&lt;p&gt;            String includeRequestUri = (String)&lt;br/&gt;
                request.getAttribute(&quot;javax.servlet.include.request_uri&quot;);&lt;/p&gt;

&lt;p&gt;in Jaspers JspServletWrapper. Hmmm, didn&apos;t find an explicite call of request.getRequestURI() though. Anyway, Jasper &quot;handles&quot; the &quot;javax.servlet.include.request_uri&quot; only to raise an exception or to send an error. Why? Is the usage of that attribute deprecated?!&lt;/p&gt;


&lt;p&gt;See in the frist catch(UnavailableException)-block of the service(...)-method in&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cvs.apache.org/viewcvs.cgi/jakarta-tomcat-jasper/jasper2/src/share/org/apache/jasper/servlet/JspServletWrapper.java?&amp;amp;view=markup&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cvs.apache.org/viewcvs.cgi/jakarta-tomcat-jasper/jasper2/src/share/org/apache/jasper/servlet/JspServletWrapper.java?&amp;amp;view=markup&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14460977" author="boris" created="Mon, 9 May 2005 06:43:26 +0000"  >&lt;p&gt;To propose patch I was leaded by text published on Javaworld:&lt;br/&gt;
&lt;a href=&quot;http://www.javaworld.com/javaworld/jw-03-2003/jw-0328-servlet.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.javaworld.com/javaworld/jw-03-2003/jw-0328-servlet.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I patched my solution subclassing GroovyServlet with my class and overiding problematic method and that worked fine with me.&lt;/p&gt;

&lt;p&gt;Sorry for late response, been very busy last week&lt;/p&gt;</comment>
                            <comment id="14460931" author="sormuras" created="Mon, 9 May 2005 06:58:28 +0000"  >&lt;p&gt;Thanks for the response and the link, Boris. Would you mind testing the new and Jasper-like request-uri extract-magic I proposed above in your subclass? If it works for you, I&apos;ll close this issue.&lt;/p&gt;

&lt;p&gt;...and open a new one against the AbstractHttpServlet implementation, which I think does still not work as defined by the Servlet 2.4 API regarding forward calls.  &lt;/p&gt;

&lt;p&gt;&quot; RequestDispatcher changes&lt;br/&gt;
  Servlet 2.4 adds five new request attributes to provide extra&lt;br/&gt;
  information during a RequestDispatcher forward() call. In case&lt;br/&gt;
  you&apos;ve forgotten, when you forward() to a servlet &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt; &quot;&lt;br/&gt;
&lt;a href=&quot;http://www.javaworld.com/javaworld/jw-03-2003/jw-0328-servlet.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.javaworld.com/javaworld/jw-03-2003/jw-0328-servlet.html&lt;/a&gt; | Page 2 |&lt;/p&gt;</comment>
                            <comment id="14460854" author="boris" created="Mon, 9 May 2005 10:25:42 +0000"  >&lt;p&gt;Hi Christian,&lt;/p&gt;

&lt;p&gt;I tested above proposed solution (getScriptUri) and it works in my subclasses of current GroovyServlet. I guess we can close this isssue now, thank you for effort.&lt;/p&gt;</comment>
                            <comment id="14460995" author="sormuras" created="Mon, 9 May 2005 10:35:45 +0000"  >&lt;p&gt;815 wants to be closed - AbstractHttpServlet.getScriptUri() needs more work and review (Servlet 2.4 API &quot;forward&quot;)&lt;/p&gt;</comment>
                            <comment id="14460997" author="guillaume" created="Wed, 11 May 2005 17:04:44 +0000"  >&lt;p&gt;If it&apos;s really resolved, let&apos;s close it!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12812698">GROOVY-814</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            20 years, 29 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c1br:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>