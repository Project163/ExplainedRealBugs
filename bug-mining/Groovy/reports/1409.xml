<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:18:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-4534] Thread.join appears to not work correctly in at least one special case</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-4534</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;While writing test code for a networking component I ran into the following issue. I created a thread to read from a socket, started it and then wrote to a client socket. After writing called thread.join() and expected it to finish executing my server socket thread before continuing. Instead what I get is non-deterministic behavior. Sometimes the thread finishes sometimes not. Since the thread isn&apos;t doing much if I add a sleep the code works (my work around in my test code). To be clear I&apos;m not expecting that the print statements execute in any particular order - I&apos;m concerned that the lines won&apos;t get added to the list and thus the current thread hasn&apos;t actually waited for the spawned thread to exit.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached a sample groovy class that exhibits the problem and the equivalent Java code that does not have the issue.&lt;/p&gt;</description>
                <environment>32 bit Windows XP, Groovy 1.7.5. Also using Eclipse 3.6 + groovy plugin</environment>
        <key id="12815418">GROOVY-4534</key>
            <summary>Thread.join appears to not work correctly in at least one special case</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roshandawrani">Roshan Dawrani</assignee>
                                    <reporter username="rnimz">Reid Nimz</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Nov 2010 14:35:10 +0000</created>
                <updated>Wed, 15 Dec 2010 16:57:06 +0000</updated>
                            <resolved>Thu, 25 Nov 2010 08:00:17 +0000</resolved>
                                    <version>1.7.5</version>
                                    <fixVersion>1.7.6</fixVersion>
                    <fixVersion>1.8-beta-3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14470509" author="roshandawrani" created="Thu, 25 Nov 2010 03:35:42 +0000"  >&lt;p&gt;Attaching a patch for review.&lt;/p&gt;

&lt;p&gt;What is causing the non-deterministic behavior in the groovy code is that there are 2 new threads involved (with incorrect one being joined) unlike the Java code, where only 1 gets created.&lt;/p&gt;

&lt;p&gt;The closure being passed to socket.accept(&lt;/p&gt;
{...}
&lt;p&gt;) is invoked by groovy in a new thread - see &lt;a href=&quot;http://groovy.codehaus.org/groovy-jdk/java/net/ServerSocket.html#accept(groovy.lang.Closure&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://groovy.codehaus.org/groovy-jdk/java/net/ServerSocket.html#accept(groovy.lang.Closure&lt;/a&gt;). That&apos;s why doing join() on the thread created by Thread.start &lt;/p&gt;
{..} does not give the deterministic behavior - because internally a new thread gets created by server.socket({..}
&lt;p&gt;) that runs independently of the main thread.&lt;/p&gt;

&lt;p&gt;Above mentioned behavior has been there since groovy 1.0, so it can&apos;t be changed as it will break existing code.&lt;/p&gt;

&lt;p&gt;I am attaching a patch that introduces a new accept() that accepts a boolean flag that tells it whether the closure should be run in a new thread or the calling thread, and it can be used as below for same results as the Java example&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; thread = &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.start {
&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; = don&apos;t run in a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; thread
&lt;/span&gt;            socket.accept(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, { socket -&amp;gt;
.....
.....
                println &lt;span class=&quot;code-quote&quot;&gt;&quot;all done&quot;&lt;/span&gt;
            })
        }
.....
.....
        thread.join()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, the existing socket.accept(&lt;/p&gt;
{..}) continues to run closure in a new thread but this new socket.accept(&lt;span class=&quot;error&quot;&gt;&amp;#91;true|false&amp;#93;&lt;/span&gt;, {..}
&lt;p&gt;) gives the users a choice.&lt;/p&gt;</comment>
                            <comment id="14479367" author="paulk" created="Thu, 25 Nov 2010 04:01:35 +0000"  >&lt;p&gt;So, to finish the discussion, the existing method is designed for the case where the server socket would be in its own process. In which case you could use:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; thread = socket.accept { socket -&amp;gt; ... }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But of course in that case it would typically be running as the main thread and hence join wouldn&apos;t be needed.&lt;/p&gt;

&lt;p&gt;The proposed patch allows for additional use cases, so +1 from me.&lt;/p&gt;</comment>
                            <comment id="14470488" author="blackdrag" created="Thu, 25 Nov 2010 04:42:36 +0000"  >&lt;p&gt;looks good, yes... &lt;/p&gt;</comment>
                            <comment id="14470503" author="roshandawrani" created="Thu, 25 Nov 2010 08:00:17 +0000"  >&lt;p&gt;Done&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722706" name="4534_v17x.diff" size="2564" author="roshandawrani" created="Thu, 25 Nov 2010 03:35:42 +0000"/>
                            <attachment id="12722463" name="JoinProblemG.groovy" size="1343" author="rnimz" created="Wed, 24 Nov 2010 14:35:12 +0000"/>
                            <attachment id="12722462" name="JoinProblemJ.java" size="2116" author="rnimz" created="Wed, 24 Nov 2010 14:35:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ct1j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>