<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:16:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-5736] Log4j, Commons, Slf4j ast transforms are broken in Groovy-Eclipse</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-5736</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Since Groovy-Eclipse moved to using the 2.0.4 compiler, the @Log4j and other log ast transformations are crashing the compiler.  This is because in &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5574&quot; title=&quot;Log4j annotation causes class generation BUG!&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5574&quot;&gt;&lt;del&gt;GROOVY-5574&lt;/del&gt;&lt;/a&gt;, there was a move to call &lt;tt&gt;Class.forName()&lt;/tt&gt; in the Log AST transformation.  In Groovy-Eclipse, you cannot use Class.forName since the classpath of the project is not on the classpath of the compiler.&lt;/p&gt;

&lt;p&gt;The workaround is to change &lt;tt&gt;org.codehaus.groovy.transform.LogASTTransformation.AbstractLoggingStrategy.classNode(String)&lt;/tt&gt;.  Instead of throwing a &lt;tt&gt;GroovyRuntimeException&lt;/tt&gt;, you could simply call and return &lt;tt&gt;ClassHelper.make(name);&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;I know this adds code that was removed to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5574&quot; title=&quot;Log4j annotation causes class generation BUG!&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5574&quot;&gt;&lt;del&gt;GROOVY-5574&lt;/del&gt;&lt;/a&gt;, but for Groovy-Eclipse this is safe since &lt;tt&gt;ClassHelper.make(name);&lt;/tt&gt; will correctly use the project&apos;s class path to generate the ClassNode and classloader issues will not happen.&lt;/p&gt;

&lt;p&gt;If you think that this solution is not a good one because of problems that could occur outside of eclipse, then we could talk about a different solution.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12811923">GROOVY-5736</key>
            <summary>Log4j, Commons, Slf4j ast transforms are broken in Groovy-Eclipse</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="werdna">Andrew Eisenberg</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Oct 2012 15:04:57 +0000</created>
                <updated>Thu, 3 Feb 2022 22:29:58 +0000</updated>
                            <resolved>Sun, 19 Dec 2021 20:50:31 +0000</resolved>
                                    <version>2.0.4</version>
                                    <fixVersion>2.5.16</fixVersion>
                    <fixVersion>3.0.10</fixVersion>
                    <fixVersion>4.0.0-rc-2</fixVersion>
                                    <component>Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14473310" author="melix" created="Tue, 2 Oct 2012 03:37:21 +0000"  >&lt;p&gt;There is a problem with this approach: currently, the compiler throws an error because it you do not do so, you have a dummy class node created, which doesn&apos;t have all the expected methods. It results in errors which are difficult to understand for the end user. Throwing an exception, we tell the user that the Log4J/whatever framework is not on classpath, so the annotation cannot be run.&lt;/p&gt;

&lt;p&gt;There are several issues like this that are specific to Groovy Eclipse that we might solve using some kind of indirection: class node comparisons, class node providers or fallbacks. For example, instead of throwing an exception, we could add one level of indirection:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ClassNodeToolingFactory.getInstance().generateFallbackClassNode(name)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;which would for regular Groovy throw an error, but in Eclipse, it could return a ClassNode.&lt;/p&gt;

&lt;p&gt;The same for class node comparators:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ClassNode comparator = ClassNodeToolingFactory().getInstance().getClassNodeComparator();
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (comparator.areEqual(cn1, cn2)) { ... } &lt;span class=&quot;code-comment&quot;&gt;// instead of cn1.equals(cn2)
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (comparator.areSame(cn1, cn2)) { ... } &lt;span class=&quot;code-comment&quot;&gt;// instead of cn1==cn2&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Just a thought... The problem with this strategy is of course that I can&apos;t see any other use case than Eclipse for that.&lt;/p&gt;</comment>
                            <comment id="14473347" author="blackdrag" created="Tue, 2 Oct 2012 04:41:26 +0000"  >&lt;p&gt;to my better understanding... there is the transform loader, which should know the slf4j stuff to create the right nodes and there is the classpath for program dependencies. From the text above I read, that the transform loader is equal to the other loader and that slf4 is supposed to be provided through different means. Is that right? If yes, then the situation is quite a mess imho&lt;/p&gt;

&lt;p&gt;Anyway... I added this ClassNodeResolver facility. Can&apos;t we use that here instead? Imho it is a bit wrong, since the ClassNodeResolver is for resolving dependencies, that have nothing to do with the transform, but it allows our eclipse guys to do whatever they want to do and we just get back a ClassNode.&lt;/p&gt;</comment>
                            <comment id="14473283" author="melix" created="Tue, 2 Oct 2012 05:08:02 +0000"  >&lt;p&gt;I don&apos;t know if I understand you properly, but the problem is not really the transform loader. The transform loader will know about &lt;tt&gt;@Log4j&lt;/tt&gt; or &lt;tt&gt;@Slf4j&lt;/tt&gt;, but when the transform is run, we must have the Log4J or SLF4J classes on classpath to be able to build a valid class node. Here, the transform uses the classloader of the source unit.&lt;/p&gt;</comment>
                            <comment id="14473370" author="blackdrag" created="Tue, 2 Oct 2012 07:41:31 +0000"  >&lt;p&gt;I guess I am a bit confused... The problem occured because there was a move to Class#forName says Andrew. But it is not the String version, it is the version, that takes a class loader. So if the class is not found, it first means the wrong loader is used.&lt;/p&gt;

&lt;p&gt;What was used before was the transform loader, because of Class#forName in the static constructor. What is used now is the compilation loader, the one from the SourceUnit. The earlier fallback was to use a dummy node, but that does not work because of &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5574&quot; title=&quot;Log4j annotation causes class generation BUG!&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5574&quot;&gt;&lt;del&gt;GROOVY-5574&lt;/del&gt;&lt;/a&gt;. If a ClassNode is added to the AST and the ClassNode is already resolved, then the compiler does not care about where the class comes from and does not try to resolve it at all.&lt;/p&gt;

&lt;p&gt;That&apos;s why I see two paths here:&lt;br/&gt;
(1) use the transform loader, not the compilation loader, to produce a resolved ClassNode. That way it works as long as the transform loader knows those classes. Going this path may cause similar errors like in &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5574&quot; title=&quot;Log4j annotation causes class generation BUG!&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5574&quot;&gt;&lt;del&gt;GROOVY-5574&lt;/del&gt;&lt;/a&gt;, because it is unclear to me why it even happened. There the transform loader should have been used and it obviously didn&apos;t know the Logger class. This would need further investigation.&lt;br/&gt;
(2) use a dummy always and have the logger implementation classes resolved through the resolving step. &lt;/p&gt;

&lt;p&gt;And if I look at the implementation before it was a mix of both. The problem for me in &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5574&quot; title=&quot;Log4j annotation causes class generation BUG!&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5574&quot;&gt;&lt;del&gt;GROOVY-5574&lt;/del&gt;&lt;/a&gt; therefore should have been, that neither the compilation, nor the transform loader did know the Logging class, otherwise one or the other would have catched it. Only that it makes no sense like that, unless the logger actually runs after the resolving, in which case using a dummy is always wrong. but that is not the case. So if both don&apos;t know the class, then it is 100% clear, why using @Grab with systemClassLoader=true resolved the issue in &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5574&quot; title=&quot;Log4j annotation causes class generation BUG!&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5574&quot;&gt;&lt;del&gt;GROOVY-5574&lt;/del&gt;&lt;/a&gt;. Through this a parent loader gained knowledge of that class, thus now both loaders are able to use it. &lt;/p&gt;
</comment>
                            <comment id="14474493" author="pschumacher" created="Sun, 5 May 2013 06:50:04 +0000"  >&lt;p&gt;@Andrew: Any input on this or can this issue be closed?&lt;/p&gt;</comment>
                            <comment id="14474376" author="werdna" created="Mon, 6 May 2013 00:15:31 +0000"  >&lt;p&gt;In Groovy-Eclipse, we have patched around this issue and everything works for us. It would be nice if groovy core could take the patch, but Jochen still ahs reservations as described above.  Here is the &lt;tt&gt;LogASTTransformation.AbstractLoggingStrategy.classNode(String)&lt;/tt&gt; method in groovy-Eclipse:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; ClassNode classNode(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name) {
            &lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; cl = loader==&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;?&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getClass().getClassLoader():loader;
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ClassHelper.make(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(name, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, cl));
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (ClassNotFoundException e) {
                &lt;span class=&quot;code-comment&quot;&gt;// GRECLIPSE: old
&lt;/span&gt;                /*
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyRuntimeException(e);
                &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;*/
                &lt;span class=&quot;code-comment&quot;&gt;// See https://jira.codehaus.org/browse/GROOVY-5736
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// don&apos;t &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; an exception, rather just make the &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;from text
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ClassHelper.make(name);
                &lt;span class=&quot;code-comment&quot;&gt;//end
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;//GRECLIPSE
&lt;/span&gt;            }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, essentially, if the loggers are not able to be created, we avoid throwing an exception and just create a dummy class.  At compile time, I believe this would work fine, but for compiling a script dynamically, this would cause problems. &lt;/p&gt;

&lt;p&gt;The problem might lie in the fact that in greclipse vs groovy the class loaders are constructed differently and so it might be that the logger classes are coming from a different loader in greclipse compared to in groovy.&lt;/p&gt;</comment>
                            <comment id="16983684" author="emilles" created="Wed, 27 Nov 2019 16:19:28 +0000"  >&lt;p&gt;Patch still exists in groovy-eclipse: &lt;a href=&quot;https://github.com/groovy/groovy-eclipse/blob/aa050514e34591f950f1ac177bff87db15354ee0/base/org.codehaus.groovy30/src/org/codehaus/groovy/transform/LogASTTransformation.java#L347&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/groovy/groovy-eclipse/blob/aa050514e34591f950f1ac177bff87db15354ee0/base/org.codehaus.groovy30/src/org/codehaus/groovy/transform/LogASTTransformation.java#L347&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17462299" author="emilles" created="Sun, 19 Dec 2021 20:50:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/aadf2cc3bcee94fa342f957c6afc85060ab55094&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/aadf2cc3bcee94fa342f957c6afc85060ab55094&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 47 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cenz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>