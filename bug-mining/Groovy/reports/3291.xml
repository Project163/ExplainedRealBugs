<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:56:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-8325] @CompileStatic calls wrong newInstance method.</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-8325</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Foo newInstance(&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; v) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Foo()
    }
}

@CompileStatic   &lt;span class=&quot;code-comment&quot;&gt;//crash only caused by &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; CompileStatic
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestGroovy {
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; ... args) {
        def a = Foo.newInstance(123)  &lt;span class=&quot;code-comment&quot;&gt;//when @CompileStatic, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; calls DefaultGroovyMethods.newInstance
&lt;/span&gt;        println a
    }
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13103564">GROOVY-8325</key>
            <summary>@CompileStatic calls wrong newInstance method.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="chice">Xiaoguang WANG</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Sep 2017 10:33:35 +0000</created>
                <updated>Tue, 28 Nov 2023 19:14:11 +0000</updated>
                            <resolved>Mon, 16 Oct 2017 05:44:27 +0000</resolved>
                                    <version>2.4.10</version>
                                    <fixVersion>2.4.13</fixVersion>
                                    <component>Compiler</component>
                    <component>Static compilation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16173224" author="paulk" created="Wed, 20 Sep 2017 14:10:06 +0000"  >&lt;p&gt;Error message is:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;groovy.lang.GroovyRuntimeException: Could not find matching constructor for: Foo(Integer)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Using &lt;tt&gt;Foo.newInstance(123L)&lt;/tt&gt; works fine.&lt;/p&gt;</comment>
                            <comment id="16173752" author="blackdrag" created="Wed, 20 Sep 2017 20:02:36 +0000"  >&lt;p&gt;but shouldn&#180;t the call with newInstance(int) call newInstance(Long) instead of newInstance(Object[])? In non-static groovy this should be the case. In Java I think not.&lt;/p&gt;</comment>
                            <comment id="16174032" author="paulk" created="Thu, 21 Sep 2017 00:07:00 +0000"  >&lt;p&gt;I haven&apos;t checked yet what the correct behavior should be, I was just clarifying the error case and messages.&lt;/p&gt;</comment>
                            <comment id="16205350" author="paulk" created="Mon, 16 Oct 2017 00:09:48 +0000"  >&lt;p&gt;I noticed that &lt;tt&gt;StaticTypeCheckingSupport#isAssignableTo&lt;/tt&gt; has some clauses like &lt;tt&gt;Long_TYPE==toBeAssignedTo&lt;/tt&gt;. I think they would need to be using &lt;tt&gt;.equals()&lt;/tt&gt; or the &lt;tt&gt;.redirect()&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16205370" author="paulk" created="Mon, 16 Oct 2017 02:01:51 +0000"  >&lt;p&gt;Something else looks a little strange. If I just fix up the invalid &lt;tt&gt;==&lt;/tt&gt; mentioned in the previous comment, then the example in the issue description works, but the results seem strange to me for this example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.*

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;CustomNumber &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; {
    @Delegate &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; delegate = 42L
}

@CompileStatic
def method() {
    Groovy8325.newInstance2(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CustomNumber())
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Groovy8325 {
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Groovy8325 newInstance2(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; v) {
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Groovy8325()
    }
}

println method()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;With @CS, this passes and the method target is &lt;tt&gt;newInstance2(Integer)&lt;/tt&gt; and via &lt;tt&gt;DTT#continueCastOnNumber&lt;/tt&gt;, &lt;tt&gt;intValue()&lt;/tt&gt; is called on the &lt;tt&gt;Number&lt;/tt&gt;. This involves possible loss of precision but more importantly, I wouldn&apos;t expect us to support this from the type hierarchy point of view.&lt;/p&gt;

&lt;p&gt;Without @CS, it gives:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;groovy.lang.MissingMethodException: No signature of method: static Groovy8325.newInstance2() is applicable for argument types: (CustomNumber) values: [CustomNumber@114064d7]
Possible solutions: newInstance2(java.lang.Integer)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Note: I am using &lt;tt&gt;newInstance2&lt;/tt&gt; just to remove the &lt;tt&gt;DGM#newInstance&lt;/tt&gt; case from the equation - it would involve an extra consideration which isn&apos;t important for the case I believe is wrong.&lt;/p&gt;</comment>
                            <comment id="16205454" author="paulk" created="Mon, 16 Oct 2017 05:44:27 +0000"  >&lt;p&gt;Okay, I fixed the original problem and also made the code a little stricter so that the case above which fails dynamic Groovy with MME now also fails static type checking. Thanks for reporting the issue.&lt;/p&gt;</comment>
                            <comment id="16251506" author="patric42" created="Tue, 14 Nov 2017 15:05:50 +0000"  >&lt;p&gt;Please have a look at &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8380&quot; title=&quot;Regression in 2.4.13-SNAPSHOT: x &amp;amp; y, x | y, x ^ y lose typing information&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8380&quot;&gt;&lt;del&gt;GROOVY-8380&lt;/del&gt;&lt;/a&gt;, as this fix causes a regression for&lt;/p&gt;

&lt;p&gt;@groovy.transform.CompileStatic&lt;br/&gt;
def bla() &lt;/p&gt;
{
   new Long( 5 / 2 )
}

&lt;p&gt;That used to work and seems on par with the Java behaviour on that matter.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13142169">GROOVY-8488</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13207846">GROOVY-8948</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 1 week ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3kahr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>