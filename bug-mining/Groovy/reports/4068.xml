<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:11:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-7978] Code containing post-decrement in an assert can cause a VerifyError on instantiation</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-7978</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The program below attempts to show a minimal example. It fails with a VerifyError when an instance of class Bad is constructed. Removing the post-increment or the assert, or making it @CompileStatic makes the error go away.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// VerifyErrorExample.groovy
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic


&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Bad {
	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; counter = 0;
	
	void bar() {
		&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.counter++) &lt;span class=&quot;code-comment&quot;&gt;// Something about the post-decrement in an &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; causes a VerifyError
&lt;/span&gt;	}
};

@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Good {
	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; counter = 0;
	
	void bar() {
		&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.counter++) &lt;span class=&quot;code-comment&quot;&gt;// This is fine
&lt;/span&gt;	}
};

println &lt;span class=&quot;code-quote&quot;&gt;&quot;Java: ${&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&apos;java.version&apos;&lt;/span&gt;)}, Groovy: ${GroovySystem.version}&quot;&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Good();
println &lt;span class=&quot;code-quote&quot;&gt;&quot;made a good&quot;&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Bad();
println &lt;span class=&quot;code-quote&quot;&gt;&quot;made a bad&quot;&lt;/span&gt;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The error looks like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; $ groovy VerifyErrorExample.groovy
Java: 1.8.0_91, Groovy: 2.4.7
made a good
Caught: java.lang.VerifyError: (class: Bad, method: bar signature: ()V) Expecting to find integer on stack
java.lang.VerifyError: (class: Bad, method: bar signature: ()V) Expecting to find integer on stack
	at VerifyErrorExample.run(VerifyErrorExample.groovy:24)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ve seen other errors of a similar sort, which I&apos;ve not been able to boil down to a short example like this, but one I can remember seemed to be the result of code which use a void method in an if-condition (which the compiler didn&apos;t warn about), something like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void voidMethod() {}
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void bad() {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (voidMethod()) {
        prinln &lt;span class=&quot;code-quote&quot;&gt;&quot;hello&quot;&lt;/span&gt;
      }
    }
  }

  &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Foo(); &lt;span class=&quot;code-comment&quot;&gt;// triggers the error&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>Ubuntu 14.04.5 LTS (Trusty)&lt;br/&gt;
Java: 1.8.0_91&lt;br/&gt;
x86_64 arch (both OS and Java)</environment>
        <key id="13016153">GROOVY-7978</key>
            <summary>Code containing post-decrement in an assert can cause a VerifyError on instantiation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="wu-lee">Nick Stokoe</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Oct 2016 13:19:20 +0000</created>
                <updated>Tue, 8 Mar 2022 12:16:21 +0000</updated>
                            <resolved>Tue, 30 Mar 2021 15:10:36 +0000</resolved>
                                    <version>2.4.5</version>
                    <version>2.4.7</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15621114" author="paulk" created="Mon, 31 Oct 2016 03:40:54 +0000"  >&lt;p&gt;This appears to be a bug in the power assert code. A workaround is to provide your own assertion message, e.g.:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.counter++, &lt;span class=&quot;code-quote&quot;&gt;&apos;should work&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;For your second example, if you&apos;d like that fixed, I&apos;d suggest trying a bit more to create a reproducible example and post a separate issue. If you are just leaving it here as a possible hint for this issue, then that is fine as is.&lt;/p&gt;</comment>
                            <comment id="15621745" author="wu-lee" created="Mon, 31 Oct 2016 09:45:43 +0000"  >&lt;p&gt;Thanks for the workaround.  I included the second example mainly as a hint for this issue, but leaving open the question as to whether it was related or not, since although it has a similar error, I cannot tell.&lt;/p&gt;

&lt;p&gt;I you have any pointers on why these exceptions occur, that would help me to narrow down and isolate examples such as this. I managed to do it this time by binary searching the code, deleting parts whilst keeping it compiling with the same error, but sometimes the two seem to be mutually incompatible!&lt;/p&gt;</comment>
                            <comment id="15621976" author="paulk" created="Mon, 31 Oct 2016 12:06:56 +0000"  >&lt;p&gt;VerifyErrors should never occur. They mean that the compiler is producing incorrect bytecode. Perhaps it is not cleaning up the stack in some edge case. It&apos;s a bit hard to provide a general rule that makes that obvious from the source code. Given that it is typically an edge case - errors in commonly run code would typically get fixed pretty quick - so you can often get around the problem by writing your code slightly differently. I can only guess what is going on with the power assert code. It specifically tries to record (make copies) of the variable values in your assertion and these values are supposed to be constant - perhaps the ++ means that there is both a before and after value associated with some data structure and that isn&apos;t being handled properly. If I get time, I&apos;ll take a look. Not likely straight away.&lt;/p&gt;</comment>
                            <comment id="15621986" author="paulk" created="Mon, 31 Oct 2016 12:11:59 +0000"  >&lt;p&gt;Actually, the primitive type seems important. Perhaps some boxing is missing. That&apos;s another workaround, use Integer instead of int.&lt;/p&gt;</comment>
                            <comment id="17311851" author="paulk" created="Tue, 30 Mar 2021 23:08:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt; Do we know fix version?&lt;/p&gt;</comment>
                            <comment id="17312382" author="emilles" created="Wed, 31 Mar 2021 13:38:13 +0000"  >&lt;p&gt;I do not.  I think the fix that popped the extra operand (&lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9892&quot; title=&quot;STC: VerifyError when embedding unary pre/postfix inc/decrement operation of outer field in GString&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9892&quot;&gt;&lt;del&gt;GROOVY-9892&lt;/del&gt;&lt;/a&gt;) was the one that did it.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 32 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35jmv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>