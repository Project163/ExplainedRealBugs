<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:10:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-9892] STC: VerifyError when embedding unary pre/postfix inc/decrement operation of outer field in GString</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-9892</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;h1&gt;&lt;a name=&quot;Issue&quot;&gt;&lt;/a&gt;Issue&lt;/h1&gt;

&lt;p&gt;With Groovy 3.0.6 (&amp;amp; 3.0.7), when embedding an outer field unary pre/postfix operation within a GString, combined with static compilation (&lt;tt&gt;&amp;#64;CompileStatic&lt;/tt&gt;), the generated bytecode fails at class loading time (VerifyError)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.example

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.objectweb.asm.ClassReader
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.objectweb.asm.util.CheckClassAdapter

@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;OuterClass {
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; counter = 0

    &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; call() {
        { -&amp;gt;
            &lt;span class=&quot;code-quote&quot;&gt;&quot;Hello${++counter}Bar&quot;&lt;/span&gt;
        }.call()
    }

    static void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
        CheckClassAdapter.verify(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ClassReader(&lt;span class=&quot;code-quote&quot;&gt;&apos;org/example/OuterClass$_call_closure1&apos;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PrintWriter(&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err))
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OuterClass().call() == &lt;span class=&quot;code-quote&quot;&gt;&apos;Hello1Bar&apos;&lt;/span&gt;
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;HotSpot VM error&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.VerifyError: Bad type on operand stack
Exception Details:
  Location:
    org/example/OuterClass$_call_closure1.doCall()Ljava/lang/Object; @46: aastore
  Reason:
    Type integer (current frame, stack[4]) is not assignable to reference type
  Current Frame:
    bci: @46
    flags: { }
    locals: { &apos;org/example/OuterClass$_call_closure1&apos;, integer }
    stack: { uninitialized 0, uninitialized 0, &apos;[Ljava/lang/Object;&apos;, &apos;[Ljava/lang/Object;&apos;, integer, integer, &apos;java/lang/Integer&apos; }
  Bytecode:
    0x0000000: bb00 1c59 04bd 001e 5903 2ac0 0002 b600
    0x0000010: 2112 09b8 0027 c000 09b6 002b 0460 593c
    0x0000020: 2ab6 002c c000 091b b800 30b8 0036 5305
    0x0000030: bd00 3859 0312 3a53 5904 123c 53b7 003f
    0x0000040: b000 bf                                
  Stackmap Table:
    full_frame(@65,{},{Object[#65]})

	at org.example.OuterClass.call(OuterClass.groovy:12)
	at org.example.OuterClass.main(OuterClass.groovy:19)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;OpenJ9 VM error&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.VerifyError: JVMVRFY012 stack shape inconsistent; class=org/example/OuterClass$_call_closure1, method=doCall()Ljava/lang/Object;, pc=46
Exception Details:
  Location:
    org/example/OuterClass$_call_closure1.doCall()Ljava/lang/Object; @46: JBaastore
  Reason:
    Type &apos;java/lang/Integer&apos; (current frame, stack[6]) is not assignable to &apos;java/lang/Object&apos;
  Current Frame:
    bci: @46
    flags: { }
    locals: { &apos;org/example/OuterClass$_call_closure1&apos;, integer }
    stack: { &apos;uninitialized&apos;, &apos;uninitialized&apos;, &apos;[Ljava/lang/Object;&apos;, &apos;[Ljava/lang/Object;&apos;, integer, integer, &apos;java/lang/Integer&apos; }
  Stackmap Table:
    full_frame(@65,{},{Object[#19]})
	at org.example.OuterClass.call(OuterClass.groovy:12)
	at org.example.OuterClass.main(OuterClass.groovy:19)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This did not happen with Groovy 3.0.5.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-color: red;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-color: red;&quot;&gt;&lt;b&gt;ASM CheckClassAdapter output / Groovy 3.0.6 bytecode KO&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.objectweb.asm.tree.analysis.AnalyzerException: Error at instruction 34: Method owner: expected Lorg/codehaus/groovy/runtime/GStringImpl;, but found [Ljava/lang/Object;
	at org.objectweb.asm.tree.analysis.Analyzer.analyze(Analyzer.java:291)
	at org.objectweb.asm.util.CheckClassAdapter.verify(CheckClassAdapter.java:1063)
	at org.objectweb.asm.util.CheckClassAdapter.verify(CheckClassAdapter.java:1021)
	at org.example.OuterClass.main(OuterClass.groovy:18)
Caused by: org.objectweb.asm.tree.analysis.AnalyzerException: Method owner: expected Lorg/codehaus/groovy/runtime/GStringImpl;, but found [Ljava/lang/Object;
	at org.objectweb.asm.tree.analysis.BasicVerifier.naryOperation(BasicVerifier.java:390)
	at org.objectweb.asm.tree.analysis.BasicVerifier.naryOperation(BasicVerifier.java:43)
	at org.objectweb.asm.tree.analysis.Frame.executeInvokeInsn(Frame.java:646)
	at org.objectweb.asm.tree.analysis.Frame.execute(Frame.java:573)
	at org.objectweb.asm.tree.analysis.Analyzer.analyze(Analyzer.java:187)
	... 3 more
doCall()Ljava/lang/Object;
00000 OuterClass$_call_closure1 .  :  :     NEW org/codehaus/groovy/runtime/GStringImpl
00001 OuterClass$_call_closure1 .  : GStringImpl  :     DUP
00002 OuterClass$_call_closure1 .  : GStringImpl GStringImpl  :     ICONST_1
00003 OuterClass$_call_closure1 .  : GStringImpl GStringImpl I  :     ANEWARRAY java/lang/Object
00004 OuterClass$_call_closure1 .  : GStringImpl GStringImpl Object  :     DUP
00005 OuterClass$_call_closure1 .  : GStringImpl GStringImpl Object Object  :     ICONST_0
00006 OuterClass$_call_closure1 .  : GStringImpl GStringImpl Object Object I  :     ALOAD 0
00007 OuterClass$_call_closure1 .  : GStringImpl GStringImpl Object Object I OuterClass$_call_closure1  :     CHECKCAST org/example/OuterClass$_call_closure1
00008 OuterClass$_call_closure1 .  : GStringImpl GStringImpl Object Object I OuterClass$_call_closure1  :     INVOKEVIRTUAL org/example/OuterClass$_call_closure1.getThisObject ()Ljava/lang/Object;
00009 OuterClass$_call_closure1 .  : GStringImpl GStringImpl Object Object I Object  :     LDC Lorg/example/OuterClass;.class
00010 OuterClass$_call_closure1 .  : GStringImpl GStringImpl Object Object I Object Class  :     INVOKESTATIC org/codehaus/groovy/runtime/ScriptBytecodeAdapter.castToType (Ljava/lang/Object;Ljava/lang/Class;)Ljava/lang/Object;
00011 OuterClass$_call_closure1 .  : GStringImpl GStringImpl Object Object I Object  :     CHECKCAST org/example/OuterClass
00012 OuterClass$_call_closure1 .  : GStringImpl GStringImpl Object Object I OuterClass  :     INVOKEVIRTUAL org/example/OuterClass.getCounter ()I
Caused by: org.objectweb.asm.tree.analysis.AnalyzerException: Method owner: expected Lorg/codehaus/groovy/runtime/GStringImpl;, but found [Ljava/lang/Object;

00013 OuterClass$_call_closure1 .  : GStringImpl GStringImpl Object Object I I  :     ICONST_1
00014 OuterClass$_call_closure1 .  : GStringImpl GStringImpl Object Object I I I  :     IADD
00015 OuterClass$_call_closure1 .  : GStringImpl GStringImpl Object Object I I  :     DUP
00016 OuterClass$_call_closure1 .  : GStringImpl GStringImpl Object Object I I I  :     ISTORE 1
00017 OuterClass$_call_closure1 I  : GStringImpl GStringImpl Object Object I I  :     ALOAD 0
00018 OuterClass$_call_closure1 I  : GStringImpl GStringImpl Object Object I I OuterClass$_call_closure1  :     INVOKEVIRTUAL groovy/lang/Closure.getThisObject ()Ljava/lang/Object;
00019 OuterClass$_call_closure1 I  : GStringImpl GStringImpl Object Object I I Object  :     CHECKCAST org/example/OuterClass
00020 OuterClass$_call_closure1 I  : GStringImpl GStringImpl Object Object I I OuterClass  :     ILOAD 1
00021 OuterClass$_call_closure1 I  : GStringImpl GStringImpl Object Object I I OuterClass I  :     INVOKESTATIC org/example/OuterClass.pfaccess$00 (Lorg/example/OuterClass;I)I
00022 OuterClass$_call_closure1 I  : GStringImpl GStringImpl Object Object I I I  :     INVOKESTATIC java/lang/Integer.valueOf (I)Ljava/lang/Integer;
00023 OuterClass$_call_closure1 I  : GStringImpl GStringImpl Object Object I I Integer  :     AASTORE
00024 OuterClass$_call_closure1 I  : GStringImpl GStringImpl Object Object  :     ICONST_2
00025 OuterClass$_call_closure1 I  : GStringImpl GStringImpl Object Object I  :     ANEWARRAY java/lang/String
00026 OuterClass$_call_closure1 I  : GStringImpl GStringImpl Object Object String  :     DUP
00027 OuterClass$_call_closure1 I  : GStringImpl GStringImpl Object Object String String  :     ICONST_0
00028 OuterClass$_call_closure1 I  : GStringImpl GStringImpl Object Object String String I  :     LDC &quot;Hello&quot;
00029 OuterClass$_call_closure1 I  : GStringImpl GStringImpl Object Object String String I String  :     AASTORE
00030 OuterClass$_call_closure1 I  : GStringImpl GStringImpl Object Object String  :     DUP
00031 OuterClass$_call_closure1 I  : GStringImpl GStringImpl Object Object String String  :     ICONST_1
00032 OuterClass$_call_closure1 I  : GStringImpl GStringImpl Object Object String String I  :     LDC &quot;Bar&quot;
00033 OuterClass$_call_closure1 I  : GStringImpl GStringImpl Object Object String String I String  :     AASTORE
00034 OuterClass$_call_closure1 I  : GStringImpl GStringImpl Object Object String  :     INVOKESPECIAL org/codehaus/groovy/runtime/GStringImpl.&amp;lt;init&amp;gt; ([Ljava/lang/Object;[Ljava/lang/String;)V
00035 ?           :     ARETURN
00036 ?           :    L0
00037 ?           :    FRAME FULL [] [java/lang/Throwable]
00038 ?           :     NOP
00039 ?           :     ATHROW
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-color: green;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-color: green;&quot;&gt;&lt;b&gt;ASM CheckClassAdapter output / Groovy 3.0.5 OK&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;doCall()Ljava/lang/Object;
00000 OuterClass$_call_closure1  :  :     NEW org/codehaus/groovy/runtime/GStringImpl
00001 OuterClass$_call_closure1  : GStringImpl  :     DUP
00002 OuterClass$_call_closure1  : GStringImpl GStringImpl  :     ICONST_1
00003 OuterClass$_call_closure1  : GStringImpl GStringImpl I  :     ANEWARRAY java/lang/Object
00004 OuterClass$_call_closure1  : GStringImpl GStringImpl Object  :     DUP
00005 OuterClass$_call_closure1  : GStringImpl GStringImpl Object Object  :     ICONST_0
00006 OuterClass$_call_closure1  : GStringImpl GStringImpl Object Object I  :     ALOAD 0
00007 OuterClass$_call_closure1  : GStringImpl GStringImpl Object Object I OuterClass$_call_closure1  :     CHECKCAST org/example/OuterClass$_call_closure1
00008 OuterClass$_call_closure1  : GStringImpl GStringImpl Object Object I OuterClass$_call_closure1  :     INVOKEVIRTUAL org/example/OuterClass$_call_closure1.getThisObject ()Ljava/lang/Object;
00009 OuterClass$_call_closure1  : GStringImpl GStringImpl Object Object I Object  :     LDC Lorg/example/OuterClass;.class
00010 OuterClass$_call_closure1  : GStringImpl GStringImpl Object Object I Object Class  :     INVOKESTATIC org/codehaus/groovy/runtime/ScriptBytecodeAdapter.castToType (Ljava/lang/Object;Ljava/lang/Class;)Ljava/lang/Object;
00011 OuterClass$_call_closure1  : GStringImpl GStringImpl Object Object I Object  :     CHECKCAST org/example/OuterClass
00012 OuterClass$_call_closure1  : GStringImpl GStringImpl Object Object I OuterClass  :     INVOKEVIRTUAL org/example/OuterClass.getCounter ()I
00013 OuterClass$_call_closure1  : GStringImpl GStringImpl Object Object I I  :     ICONST_1
00014 OuterClass$_call_closure1  : GStringImpl GStringImpl Object Object I I I  :     IADD
00015 OuterClass$_call_closure1  : GStringImpl GStringImpl Object Object I I  :     DUP
00016 OuterClass$_call_closure1  : GStringImpl GStringImpl Object Object I I I  :     INVOKESTATIC java/lang/Integer.valueOf (I)Ljava/lang/Integer;
00017 OuterClass$_call_closure1  : GStringImpl GStringImpl Object Object I I Integer  :     LDC Lorg/example/OuterClass$_call_closure1;.class
00018 OuterClass$_call_closure1  : GStringImpl GStringImpl Object Object I I Integer Class  :     ALOAD 0
00019 OuterClass$_call_closure1  : GStringImpl GStringImpl Object Object I I Integer Class OuterClass$_call_closure1  :     LDC &quot;counter&quot;
00020 OuterClass$_call_closure1  : GStringImpl GStringImpl Object Object I I Integer Class OuterClass$_call_closure1 String  :     CHECKCAST java/lang/String
00021 OuterClass$_call_closure1  : GStringImpl GStringImpl Object Object I I Integer Class OuterClass$_call_closure1 String  :     INVOKESTATIC org/codehaus/groovy/runtime/ScriptBytecodeAdapter.setGroovyObjectProperty (Ljava/lang/Object;Ljava/lang/Class;Lgroovy/lang/GroovyObject;Ljava/lang/String;)V
00022 OuterClass$_call_closure1  : GStringImpl GStringImpl Object Object I I  :     INVOKESTATIC java/lang/Integer.valueOf (I)Ljava/lang/Integer;
00023 OuterClass$_call_closure1  : GStringImpl GStringImpl Object Object I Integer  :     AASTORE
00024 OuterClass$_call_closure1  : GStringImpl GStringImpl Object  :     ICONST_2
00025 OuterClass$_call_closure1  : GStringImpl GStringImpl Object I  :     ANEWARRAY java/lang/String
00026 OuterClass$_call_closure1  : GStringImpl GStringImpl Object String  :     DUP
00027 OuterClass$_call_closure1  : GStringImpl GStringImpl Object String String  :     ICONST_0
00028 OuterClass$_call_closure1  : GStringImpl GStringImpl Object String String I  :     LDC &quot;Hello&quot;
00029 OuterClass$_call_closure1  : GStringImpl GStringImpl Object String String I String  :     AASTORE
00030 OuterClass$_call_closure1  : GStringImpl GStringImpl Object String  :     DUP
00031 OuterClass$_call_closure1  : GStringImpl GStringImpl Object String String  :     ICONST_1
00032 OuterClass$_call_closure1  : GStringImpl GStringImpl Object String String I  :     LDC &quot;Bar&quot;
00033 OuterClass$_call_closure1  : GStringImpl GStringImpl Object String String I String  :     AASTORE
00034 OuterClass$_call_closure1  : GStringImpl GStringImpl Object String  :     INVOKESPECIAL org/codehaus/groovy/runtime/GStringImpl.&amp;lt;init&amp;gt; ([Ljava/lang/Object;[Ljava/lang/String;)V
00035 OuterClass$_call_closure1  : GStringImpl  :     ARETURN
00036 ?            :    L0
00037 ?            :    FRAME FULL [] [java/lang/Throwable]
00038 ?            :     NOP
00039 ?            :     ATHROW
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;h1&gt;&lt;a name=&quot;Workaround&quot;&gt;&lt;/a&gt;Workaround&lt;/h1&gt;

&lt;p&gt;A workaround is to lift the unary operation out of the GString (i.e. use a temporary variable).&lt;/p&gt;</description>
                <environment>OpenJDK 64-Bit Server VM (AdoptOpenJDK)(build 25.265-b01, mixed mode)&lt;br/&gt;
Eclipse OpenJ9 VM (build openj9-0.21.0, JRE 1.8.0 Windows 10 amd64-64-Bit Compressed References 20200728_776 (JIT enabled, AOT enabled)&lt;br/&gt;
&lt;br/&gt;
ASM 9.0</environment>
        <key id="13351406">GROOVY-9892</key>
            <summary>STC: VerifyError when embedding unary pre/postfix inc/decrement operation of outer field in GString</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daniel_sun">Daniel Sun</assignee>
                                    <reporter username="chuong_f">Fr&#233;d&#233;ric Chuong</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Jan 2021 09:14:15 +0000</created>
                <updated>Sun, 2 May 2021 09:16:56 +0000</updated>
                            <resolved>Fri, 15 Jan 2021 13:58:02 +0000</resolved>
                                    <version>3.0.6</version>
                    <version>3.0.7</version>
                                    <fixVersion>3.0.8</fixVersion>
                    <fixVersion>4.0.0-alpha-3</fixVersion>
                                    <component>Static compilation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="6000">1h 40m</timespent>
                                <comments>
                            <comment id="17262506" author="chuong_f" created="Mon, 11 Jan 2021 09:19:17 +0000"  >&lt;p&gt;There was an older bug where such unary pre/postfix operation were discussed &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9385&quot; title=&quot;Access to outer class private field from closure leads to ClassCastException (@CompileStatic)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9385&quot;&gt;&lt;del&gt;GROOVY-9385&lt;/del&gt;&lt;/a&gt;, not sure whether it&apos;s relevant to the current issue.&lt;/p&gt;</comment>
                            <comment id="17263282" author="chuong_f" created="Tue, 12 Jan 2021 12:02:16 +0000"  >&lt;p&gt;Bisecting with the following test case:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;src/test/groovy/transform/stc/Groovy9892Bug.groovy&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; groovy.transform.stc

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Groovy9892Bug &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; StaticTypeCheckingTestCase {
    void test() {
        assertScript &apos;&apos;&apos;
@groovy.transform.CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;OuterClass {
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; counter = 0

    &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; call() {
        { -&amp;gt;
            &lt;span class=&quot;code-quote&quot;&gt;&quot;Hello${++counter}Bar&quot;&lt;/span&gt;
        }.call()
    }
}
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OuterClass().call() == &lt;span class=&quot;code-quote&quot;&gt;&apos;Hello1Bar&apos;&lt;/span&gt;
&apos;&apos;&apos;
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;git bisect start GROOVY_3_0_6 GROOVY_3_0_5 &amp;amp;&amp;amp; git bisect run ./gradlew --console=plain :test --tests groovy.transform.stc.Groovy9892Bug
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;git bisect log&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;# bad: [6eb8bbbf62120a29cae04d3cdddf0e4e28954760] Release 3.0.6: update versions
# good: [0be35bb155d6188a6ccc727dea41646cefa706ac] Release 3.0.5: update versions
git bisect start &apos;GROOVY_3_0_6&apos; &apos;GROOVY_3_0_5&apos;
# good: [095c9bdd1abab714903ffa79d14bfc201f408a61] fix unintentional glitch on JDK14
git bisect good 095c9bdd1abab714903ffa79d14bfc201f408a61
# bad: [c94e24727172e9c895b657a2cbcb2286cd7cf78a] GROOVY-9711: @Sortable annotation always sorts by the parent properties (closes 1360)
git bisect bad c94e24727172e9c895b657a2cbcb2286cd7cf78a
# bad: [f8b7f33c489ba0e1e876eaf3633ce3de3471bbe5] GROOVY-9670: Bump TestNG to 7.3.0
git bisect bad f8b7f33c489ba0e1e876eaf3633ce3de3471bbe5
# bad: [640e9304fe8950400d94adaad474c0c341209df0] minor fix-ups
git bisect bad 640e9304fe8950400d94adaad474c0c341209df0
# good: [8bf2dc0a240e49f2430f375dc709faf559806924] GROOVY-9648: Bad error message when attempting to call a missing constructor with named args
git bisect good 8bf2dc0a240e49f2430f375dc709faf559806924
# good: [7c46b70ae33501a7b66beef807622ba6f1eb07a7] Minor tweak for &quot;GROOVY-9657: JmxMetaMapBuilder.buildOperationMapFrom throw StringIndexOutOfBoundsException&quot; (closes #1323)
git bisect good 7c46b70ae33501a7b66beef807622ba6f1eb07a7
# good: [4d04c10b5d81b7b70352cf9407ba7d664de77fb4] GROOVY-7232: check resolve strategy of each closure during method search
git bisect good 4d04c10b5d81b7b70352cf9407ba7d664de77fb4
# bad: [40ee3fd0c19530b4308c7c1b3e30abd4d45ed54a] GROOVY-7304: handle private field access from closure for ++x and x++
git bisect bad 40ee3fd0c19530b4308c7c1b3e30abd4d45ed54a
# first bad commit: [40ee3fd0c19530b4308c7c1b3e30abd4d45ed54a] GROOVY-7304: handle private field access from closure for ++x and x++
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;... reveals commit &lt;a href=&quot;https://github.com/apache/groovy/commit/40ee3fd0c19530b4308c7c1b3e30abd4d45ed54a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;40ee3fd0c19530b4308c7c1b3e30abd4d45ed54a&lt;/tt&gt;&lt;/a&gt; (fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7304&quot; title=&quot;Cannot mutate private field from within an AIC or a closure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7304&quot;&gt;&lt;del&gt;GROOVY-7304&lt;/del&gt;&lt;/a&gt;) as the regression.&lt;/p&gt;</comment>
                            <comment id="17264338" author="chuong_f" created="Wed, 13 Jan 2021 18:32:54 +0000"  >&lt;p&gt;Adding a &lt;a href=&quot;https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5.pop&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;POP&lt;/tt&gt;&lt;/a&gt; instruction seems to do the trick (at least for &lt;tt&gt;int&lt;/tt&gt; values):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git a/src/main/java/org/codehaus/groovy/classgen/asm/sc/StaticTypesCallSiteWriter.java b/src/main/java/org/codehaus/groovy/classgen/asm/sc/StaticTypesCallSiteWriter.java
index 4f5c4e071ad94d65a70ec1fa2b5493701d99f7dc..06d5e9d9b8a0cb29486397cf3a024179b817388d 100644
--- a/src/main/java/org/codehaus/groovy/classgen/asm/sc/StaticTypesCallSiteWriter.java
+++ b/src/main/java/org/codehaus/groovy/classgen/asm/sc/StaticTypesCallSiteWriter.java
@@ -814,6 +814,10 @@ public class StaticTypesCallSiteWriter extends CallSiteWriter implements Opcodes
                             call.setMethodTarget(methodNode);
                             call.visit(controller.getAcg());

+                            // GROOVY-9892: assuming that the mutator method has a return value, make sure the operand
+                            //  stack is not polluted with the result of the method call
+                            controller.getOperandStack().pop();
+
                             controller.getCompileStack().removeVar(i);
                             return;
                         }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    ICONST_1
    IADD
    DUP
    ISTORE 1
    ALOAD 0
    INVOKEVIRTUAL groovy/lang/Closure.getThisObject ()Ljava/lang/Object;
    CHECKCAST OuterClass
    ILOAD 1
    INVOKESTATIC OuterClass.pfaccess$00 (LOuterClass;I)I
    POP   &amp;lt;&amp;lt;&amp;lt;&amp;lt; discard the result of the pfaccess mutator method
    INVOKESTATIC java/lang/Integer.valueOf (I)Ljava/lang/Integer;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Beginner&apos;s question: if this is correct, as the &lt;a href=&quot;https://github.com/apache/groovy/blob/GROOVY_3_0_7/src/main/java/org/codehaus/groovy/transform/sc/StaticCompilationVisitor.java#L286&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;generated mutator&lt;/a&gt; returns the value being set, could this be optimized by getting rid of the &lt;tt&gt;DUP&lt;/tt&gt; instruction (&lt;a href=&quot;https://github.com/apache/groovy/blob/GROOVY_3_0_7/src/main/java/org/codehaus/groovy/classgen/asm/BinaryExpressionHelper.java#L778&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/blob/GROOVY_3_0_7/src/main/java/org/codehaus/groovy/classgen/asm/BinaryExpressionHelper.java#L778&lt;/a&gt;) to avoid such &lt;tt&gt;POP&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="17266056" author="daniel_sun" created="Fri, 15 Jan 2021 13:58:02 +0000"  >&lt;p&gt;The proposed PR has been merged. Thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12811527">GROOVY-7304</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 43 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0mfwo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>