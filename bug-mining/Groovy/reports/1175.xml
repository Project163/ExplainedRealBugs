<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:14:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-4012] java.lang.ArrayStoreException thrown on trying to execute a list</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-4012</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The script:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;directory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File ( &lt;span class=&quot;code-quote&quot;&gt;&apos;tmp&apos;&lt;/span&gt; )
println ( directory.path )
[ &lt;span class=&quot;code-quote&quot;&gt;&apos;sh&apos;&lt;/span&gt; , &lt;span class=&quot;code-quote&quot;&gt;&apos;-c&apos;&lt;/span&gt; , &lt;span class=&quot;code-quote&quot;&gt;&quot;${directory.path} &amp;amp;&amp;amp; ls&quot;&lt;/span&gt; ].execute ( ).waitFor ( )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;casues the output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;tmp
Exception thrown
26-Jan-2010 15:23:41 org.codehaus.groovy.runtime.StackTraceUtils sanitize
WARNING: Sanitizing stacktrace:
java.lang.ArrayStoreException
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.arraycopy(Native Method)
	at java.util.ArrayList.toArray(ArrayList.java:328)
	at org.codehaus.groovy.runtime.DefaultGroovyMethods.execute(DefaultGroovyMethods.java:7511)
	at org.codehaus.groovy.runtime.dgm$163.invoke(Unknown Source)
	at org.codehaus.groovy.runtime.callsite.PojoMetaMethodSite$PojoMetaMethodSiteNoUnwrapNoCoerce.invoke(PojoMetaMethodSite.java:270)
	at org.codehaus.groovy.runtime.callsite.PojoMetaMethodSite.call(PojoMetaMethodSite.java:52)
	at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCall(CallSiteArray.java:40)
	at org.codehaus.groovy.runtime.callsite.AbstractCallSite.call(AbstractCallSite.java:117)
	at org.codehaus.groovy.runtime.callsite.AbstractCallSite.call(AbstractCallSite.java:121)
	at ConsoleScript1.run(ConsoleScript1:3)
	at groovy.lang.GroovyShell.runScriptOrMainOrTestOrRunnable(GroovyShell.java:264)
	at groovy.lang.GroovyShell.run(GroovyShell.java:513)
	at groovy.lang.GroovyShell.run(GroovyShell.java:170)
	at groovy.lang.GroovyShell$run.call(Unknown Source)
	at groovy.ui.Console$_runScriptImpl_closure16.doCall(Console.groovy:857)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:616)
	at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:88)
	at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:233)
	at org.codehaus.groovy.runtime.metaclass.ClosureMetaClass.invokeMethod(ClosureMetaClass.java:272)
	at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:886)
	at org.codehaus.groovy.runtime.callsite.PogoMetaClassSite.callCurrent(PogoMetaClassSite.java:66)
	at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callCurrent(AbstractCallSite.java:151)
	at groovy.ui.Console$_runScriptImpl_closure16.doCall(Console.groovy)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:616)
	at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:88)
	at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:233)
	at org.codehaus.groovy.runtime.metaclass.ClosureMetaClass.invokeMethod(ClosureMetaClass.java:272)
	at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:886)
	at groovy.lang.Closure.call(Closure.java:276)
	at groovy.lang.Closure.call(Closure.java:271)
	at groovy.lang.Closure.run(Closure.java:354)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:636)

java.lang.ArrayStoreException
	at ConsoleScript1.run(ConsoleScript1:3)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which seems a bit mean.&lt;/p&gt;</description>
                <environment>Groovy Trunk as at 2010-01-25</environment>
        <key id="12815071">GROOVY-4012</key>
            <summary>java.lang.ArrayStoreException thrown on trying to execute a list</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="russel">Dr. Russel Winder</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Jan 2010 09:26:52 +0000</created>
                <updated>Tue, 7 Apr 2015 19:12:52 +0000</updated>
                            <resolved>Mon, 1 Feb 2010 20:09:17 +0000</resolved>
                                                    <fixVersion>1.7.1</fixVersion>
                    <fixVersion>1.8-beta-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14468800" author="roshandawrani" created="Tue, 26 Jan 2010 10:56:28 +0000"  >&lt;p&gt;Should be solved, I guess. In the meanwhile, will the following workaround be acceptable?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;directory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File ( &lt;span class=&quot;code-quote&quot;&gt;&apos;tmp&apos;&lt;/span&gt; )
println ( directory.path )
[ &lt;span class=&quot;code-quote&quot;&gt;&apos;sh&apos;&lt;/span&gt; , &lt;span class=&quot;code-quote&quot;&gt;&apos;-c&apos;&lt;/span&gt; , &lt;span class=&quot;code-quote&quot;&gt;&quot;${directory.path} &amp;amp;&amp;amp; ls&quot;&lt;/span&gt; as &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;].execute ( ).waitFor ( )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14468832" author="roshandawrani" created="Tue, 26 Jan 2010 11:03:17 +0000"  >&lt;p&gt;Looking a bit more into it, the javadoc of the execute() method says&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; * Executes the command specified by the &amp;lt;code&amp;gt;String&amp;lt;/code&amp;gt; list that is the parameter.
 * The first item in the list is the command the others are the parameters. All entries
 * must be Strings.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That way the method call being made is invalid as one list member is a GString.&lt;/p&gt;

&lt;p&gt;Do we want to give special handling to GString and allow String/GStrings in the list that process accepts?&lt;/p&gt;</comment>
                            <comment id="14468786" author="russel" created="Tue, 26 Jan 2010 11:47:29 +0000"  >&lt;p&gt;Roshan,  Thanks for sussing what the actual source of the problem is.  A few disconnected but related thoughts:&lt;/p&gt;

&lt;p&gt;The workaround works for me in the short term but I think should be treated as unacceptable in the medium to long term.&lt;/p&gt;

&lt;p&gt;Another workaround is to do:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[ &lt;span class=&quot;code-quote&quot;&gt;&apos;sh&apos;&lt;/span&gt; , &lt;span class=&quot;code-quote&quot;&gt;&apos;-c&apos;&lt;/span&gt; , directory.path + &lt;span class=&quot;code-quote&quot;&gt;&apos; &amp;amp;&amp;amp; ls&apos;&lt;/span&gt; ].execute ( ).waitFor ( )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Users are generally a bit blas&#233; about String and GString so if a function/method is going to be particular then there needs to be good feedback to the user so they don&apos;t get confused.&lt;/p&gt;

&lt;p&gt;The error message here is, as far as the user is concerned, totally disconnected from anything to do with their code &amp;#8211; even though their code is the progenitor of the problem.  This failure really does need fixing sooner rather than later.&lt;/p&gt;

&lt;p&gt;If execute requires Strings, should it force interpretation of GStrings?&lt;/p&gt;

&lt;p&gt;When does the GString need to be interpreted?  Is it actually necessary for the execute method to enforce the parameters being Strings?&lt;/p&gt;

&lt;p&gt;Overall I have no problem with a function/method insiusting on String and disallowing GStrings, but in such a situation, the function/method really must implement type checking and feedback to the user regarding API usage failures.&lt;/p&gt;</comment>
                            <comment id="14468760" author="roshandawrani" created="Tue, 26 Jan 2010 11:55:55 +0000"  >&lt;p&gt;Let&apos;s wait for others views - on whether it is better to allow GStrings in addition to Strings in execute parameters or to reject the parameters with a more informative message. The fix itself should be the easier part.&lt;/p&gt;

&lt;p&gt;I personally favor - GStrings/Strings to be allowed and also add some type checking of parameters to throw out a more informative error message when any other type is encountered.&lt;/p&gt;</comment>
                            <comment id="14468745" author="roshandawrani" created="Thu, 28 Jan 2010 06:38:03 +0000"  >&lt;p&gt;Jochen, any comments on this one?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="14468820" author="blackdrag" created="Thu, 28 Jan 2010 07:19:15 +0000"  >&lt;p&gt;If I am right, then the method used was until recently this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt; execute(List commandList) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] commandArray = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[commandList.size()];
        Iterator it = commandList.iterator();
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; it.hasNext(); ++i) {
            commandArray[i] = it.next().toString();
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; execute(commandArray);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now I am seeing this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt; execute(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; commands) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; execute((&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[]) commands.toArray(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[commands.size()]));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This change is not equal, because the old code made a String conversion, the new code expects Strings. &lt;/p&gt;

&lt;p&gt;To be exact it is even wrong calling this method using a List&amp;lt;Object&amp;gt;. Normally Java would prevent that, but Groovy does not.&lt;/p&gt;</comment>
                            <comment id="14468856" author="roshandawrani" created="Thu, 28 Jan 2010 07:35:03 +0000"  >&lt;p&gt;Yes, seems like a recently introduced change.&lt;/p&gt;

&lt;p&gt;And all overloads of DGM#execute(List, ....) are affected by it.&lt;/p&gt;

&lt;p&gt;Although earlier javadoc and implementation were not equivalent. Javadoc said all list items must be strings and then it forced the string conversion. Had it been in sync with the documentation, the problem would have surfaced earlier.&lt;/p&gt;

&lt;p&gt;Do we wait for Paul&apos;s feedback? Or, can we make it same as before by forcing a toString() conversion?&lt;/p&gt;</comment>
                            <comment id="14468871" author="blackdrag" created="Thu, 28 Jan 2010 07:50:36 +0000"  >&lt;p&gt;The change was 19006. According to the docu this change was not wrong, because the docu said it needs a String. I suggest to undo the change, to change the documentation and to leave a comment in the code as of why this is done - to avoid regression&lt;/p&gt;</comment>
                            <comment id="14468784" author="roshandawrani" created="Thu, 28 Jan 2010 07:58:00 +0000"  >&lt;p&gt;It was wrong (not in sync with the doco) in the sense that it said it needed list of string, but even if list was made up of other types, it happily converted them. It wasn&apos;t enforced that all list members were strings - say be rejecting calls that passed list having members of other types.&lt;/p&gt;

&lt;p&gt;If the calls were made ideally with lists of strings, we will not have any issue even now.&lt;/p&gt;

&lt;p&gt;I think it may be better to hear back Paul&apos;s views on this to avoid to-and-fro changes on this piece of code.&lt;/p&gt;</comment>
                            <comment id="14478869" author="paulk" created="Sat, 30 Jan 2010 20:38:47 +0000"  >&lt;p&gt;Hi guys, been on holidays - sorry for delay in replying.&lt;/p&gt;

&lt;p&gt;We can go back to Object but that feels less intuitive and then what about String[] and String variations?&lt;/p&gt;

&lt;p&gt;A middle ground would be to go with CharSequence which would happily cater for GString. We would still need to (hopefully in one spot) apply the toString() before calling exec(). Relevant signatures would be:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;execute(CharSequence command)
execute(CharSequence command, CharSequence[] envp, File dir)
execute(CharSequence command, List&amp;lt;CharSequence&amp;gt; envp, File dir)

execute(CharSequence[] commands)
execute(CharSequence[] commands, CharSequence[] envp, File dir)
execute(CharSequence[] commands, List&amp;lt;CharSequence&amp;gt; envp, File dir)

execute(List&amp;lt;CharSequence&amp;gt; commands)
execute(List&amp;lt;CharSequence&amp;gt; commands, CharSequence[] envp, File dir)
execute(List&amp;lt;CharSequence&amp;gt; commands, List&amp;lt;CharSequence&amp;gt; envp, File dir)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think this is a nicer API. Removes inconsistency between &lt;tt&gt;String[]&lt;/tt&gt; vs &lt;tt&gt;List&amp;lt;Object&amp;gt;&lt;/tt&gt; but still covers the GString case.&lt;br/&gt;
To combat calls from Groovy using the old style we would need some pre-checking of the params with a nice error message.&lt;/p&gt;

&lt;p&gt;It would still be a regression though if anyone is currently relying on the toString() from Object behavior. Ugly if they are but not impossible. &lt;/p&gt;
</comment>
                            <comment id="14478847" author="paulk" created="Mon, 1 Feb 2010 18:59:12 +0000"  >&lt;p&gt;potential patch - causing build problems on my machine though - not sure if it is something local or not - would welcome any feedback&lt;/p&gt;</comment>
                            <comment id="14478858" author="paulk" created="Mon, 1 Feb 2010 20:06:46 +0000"  >&lt;p&gt;problem with last patch was due to primitiveTypes needing CharSequence[] during dgminfo loading but now considering reverting to previous solution as CharSequence doesn&apos;t really give us anything over String with normal Groovy coercion.&lt;/p&gt;</comment>
                            <comment id="14478852" author="paulk" created="Mon, 1 Feb 2010 20:09:17 +0000"  >&lt;p&gt;Reverted to previous approach of having List instead of List&amp;lt;String&amp;gt; and using toString() to convert. Also, did some minor tidying up and doco fixes.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310260">
                    <name>Related</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12814491">GROOVY-3273</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12722498" name="GROOVY-4012__java_lang_ArrayStoreException_thrown_on_trying_to_execute_a_list.patch" size="15854" author="paulk_asert" created="Mon, 1 Feb 2010 18:59:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 43 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c827:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>