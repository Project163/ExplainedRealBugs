<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:19:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-10714] STC: Callable, Runnable, Serializable overload preference for functional argument (closure, lambda, etc.)</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-10714</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;This appears to be similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9881&quot; title=&quot;STC can&amp;#39;t distinguish SAMs based on arity&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9881&quot;&gt;&lt;del&gt;GROOVY-9881&lt;/del&gt;&lt;/a&gt;, but it&apos;s specifically in the method-overload procedure. Given a functional value type with two method overloads:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; Try&amp;lt;T&amp;gt; {
  Try&amp;lt;T&amp;gt; andThenTry(Consumer&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt; T&amp;gt;)
  Try&amp;lt;T&amp;gt; andThenTry(&lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt;)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When this code is invoked from static code, the STC errors out on an ambiguous method reference even if the method type isn&apos;t:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// AWS SDK 2 DynamoDbTable
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;DynamoDbTable {
  void putItem(PutItemRequest&amp;lt;T&amp;gt;)
  void putItem(Consumer&amp;lt;PutItemRequest.Builder&amp;lt;T&amp;gt;)
  void putItem(T)
}


@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyServiceClass {
  void doThing() {
    Try.success(putItemRequest())
      .andThenTry(table::putItem) &lt;span class=&quot;code-comment&quot;&gt;// T &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Try&amp;lt;T&amp;gt; is PutItemRequest&amp;lt;I&amp;gt;
&lt;/span&gt;  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;produces&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[Static type checking] - Reference to method is ambiguous. Cannot choose between [Try&amp;lt;T&amp;gt; Try#andThenTry(Consumer&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt; T&amp;gt;), Try&amp;lt;T&amp;gt; Try#andThenTry(&lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt;)]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think this may have something to do with the relaxed SAM matching that is used to bridge ambiguous closure syntax, but when a plain method reference is used, there&apos;s no ambiguity available.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13474553">GROOVY-10714</key>
            <summary>STC: Callable, Runnable, Serializable overload preference for functional argument (closure, lambda, etc.)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="chrylis">Christopher Smith</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Aug 2022 16:05:11 +0000</created>
                <updated>Thu, 29 May 2025 13:31:23 +0000</updated>
                                            <version>4.0.4</version>
                                                    <component>Static compilation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17574283" author="emilles" created="Tue, 2 Aug 2022 15:30:11 +0000"  >&lt;p&gt;There are a couple of things at play here. When looking at a method call, the type checker first visits the arguments to determine the types to use for method selection. For the method reference &quot;table::putItem&quot; this means checking for the methods &quot;putItem&quot; from your table type. At this point, &lt;tt&gt;Closure&amp;lt;CommonReturnType&amp;gt;&lt;/tt&gt; is used as the type. Under STC not SC, a method reference produces a &lt;tt&gt;MethodClosure&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Next, the method &quot;andThenTry&quot; is looked up using the argument types. In this case, &quot;andThenTry(Consumer)&quot; and &quot;andThenTry(Runnable)&quot;. To select from multiple options, a distance calculation is made. Since &lt;tt&gt;Closure&lt;/tt&gt; actually implements &lt;tt&gt;Runnable&lt;/tt&gt;, it is deemed much closer than &lt;tt&gt;Consumer&lt;/tt&gt;. I&apos;m not sure why you are seeing ambiguous method error when I am getting method selected unambiguously but then reference fails type-checking.&lt;/p&gt;

&lt;p&gt;It is not until after selecting the target method that parameter types can be used to clarify argument types.&lt;/p&gt;</comment>
                            <comment id="17574305" author="emilles" created="Tue, 2 Aug 2022 15:52:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9881&quot; title=&quot;STC can&amp;#39;t distinguish SAMs based on arity&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9881&quot;&gt;&lt;del&gt;GROOVY-9881&lt;/del&gt;&lt;/a&gt; added a tie-breaker for closures/lambdas where the number of parameters provided could help determine the overload to use.  &lt;a href=&quot;https://github.com/apache/groovy/blob/68f4712b3de7525feb2b6dd9d4f93e5cc634e5cf/src/main/java/org/codehaus/groovy/transform/stc/StaticTypeCheckingSupport.java#L951&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/blob/68f4712b3de7525feb2b6dd9d4f93e5cc634e5cf/src/main/java/org/codehaus/groovy/transform/stc/StaticTypeCheckingSupport.java#L951&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This could be done for method references as well for the situation where all &quot;putItem&quot; methods (from your example) have the same number of parameters.&lt;/p&gt;

&lt;p&gt;But that will not help &lt;tt&gt;Consumer&lt;/tt&gt; vs &lt;tt&gt;Runnable&lt;/tt&gt;.  Do you happen to have a small project that recreates the error you are seeing?&lt;/p&gt;</comment>
                            <comment id="17644373" author="emilles" created="Wed, 7 Dec 2022 14:40:13 +0000"  >&lt;p&gt;From our correspondence:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
@Grab(&lt;span class=&quot;code-quote&quot;&gt;&apos;io.vavr:vavr:0.10.4&apos;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; io.vavr.control.Try

@groovy.transform.ToString
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Id {
}
Id resolveId() {
  &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Id()
}
@groovy.transform.CompileStatic
Try&amp;lt;?&amp;gt; test() {
  Try.of(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.&amp;amp;resolveId).andThenTry{ Id id -&amp;gt; id.toString() }
}

print test() &lt;span class=&quot;code-comment&quot;&gt;// prints &lt;span class=&quot;code-quote&quot;&gt;&quot;Success(Id())&quot;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Replacing &quot;andThenTry&quot; with &quot;andThen&quot; demonstrates the selection of &lt;tt&gt;andThen(Runnable)&lt;/tt&gt; over &lt;tt&gt;andThen(Consumer)&lt;/tt&gt;.  &quot;andThenTry&quot; uses &lt;tt&gt;CheckedConsumer&lt;/tt&gt; and &lt;tt&gt;CheckedRunnable&lt;/tt&gt; so there is no preference given to &lt;tt&gt;Closure&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.javadoc.io/static/io.vavr/vavr/0.10.4/io/vavr/control/Try.html#andThen-java.util.function.Consumer-&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.javadoc.io/static/io.vavr/vavr/0.10.4/io/vavr/control/Try.html#andThen-java.util.function.Consumer-&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17780030" author="emilles" created="Thu, 26 Oct 2023 17:37:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-6189&quot; title=&quot;basic SAM conversion&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-6189&quot;&gt;&lt;del&gt;GROOVY-6189&lt;/del&gt;&lt;/a&gt; links to GEP-12, which specifically mentions that types implemented by &lt;tt&gt;Closure&lt;/tt&gt; represent a coercion-free match and so are preferred over SAM-type overloads.&lt;/p&gt;

&lt;p&gt;For reference, the distance computed between &lt;tt&gt;Closure&lt;/tt&gt; and several interesting types are currently as follows:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Type&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Argument-Parameter Distance&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Closure&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Cloneable&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Serializable&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;GroovyCallable&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Callable&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Runnable&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;GroovyObject&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;GroovyObjectSupport&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Object&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;14&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;SAM-type&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;13&lt;br/&gt;
or 12 (if param count helps; &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9881&quot; title=&quot;STC can&amp;#39;t distinguish SAMs based on arity&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9881&quot;&gt;&lt;del&gt;GROOVY-9881&lt;/del&gt;&lt;/a&gt;)&lt;br/&gt;
or 15 (if param count hurts; &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-11121&quot; title=&quot;unexpected error when having overloaded methods, one of which receiving an Iterable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-11121&quot;&gt;&lt;del&gt;GROOVY-11121&lt;/del&gt;&lt;/a&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="17780034" author="emilles" created="Thu, 26 Oct 2023 17:47:24 +0000"  >&lt;p&gt;I have experimented with computing SAM-type distance first for &lt;tt&gt;Callable&lt;/tt&gt;, &lt;tt&gt;GroovyCallable&lt;/tt&gt; and &lt;tt&gt;Runnable&lt;/tt&gt;.&#160; Thus their distance would increase to 12 or 13.&#160;&#160;Doing so in the presence of &lt;tt&gt;Cloneable&lt;/tt&gt;, &lt;tt&gt;Serializable&lt;/tt&gt;, &lt;tt&gt;GroovyObject&lt;/tt&gt; or &lt;tt&gt;GroovyObjectSupport&lt;/tt&gt; overloads would be a change in selection.  And the current preference of &lt;tt&gt;Runnable&lt;/tt&gt; over &lt;tt&gt;Callable&lt;/tt&gt; would break without some further adjustment.&lt;/p&gt;

&lt;p&gt;This applies equally to closures, lambdas, method pointers and method references.  STC treats them all as &lt;tt&gt;Closure&lt;/tt&gt; in terms of argument type during method selection.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13544127">GROOVY-11129</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13532528">GROOVY-11010</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13619426">GROOVY-11681</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13527311">GROOVY-10963</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12816989">GROOVY-6189</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13344634">GROOVY-9852</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13350590">GROOVY-9881</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>groovy</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 2 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z17dds:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>