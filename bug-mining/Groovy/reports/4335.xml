<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:16:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-10434] ClassNode isRecord and isSealed not useful before AST transformation</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-10434</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The new to Groovy 4 methods &lt;tt&gt;ClassNode#isRecord&lt;/tt&gt; and &lt;tt&gt;ClassNode#isSealed&lt;/tt&gt; do not work for a node that has not yet been processed by the record/sealed transform or in some cases &lt;tt&gt;ResolveVisitor&lt;/tt&gt;.  And they do not work for a node that is a reference to a record or sealed type.&lt;/p&gt;

&lt;p&gt;For these reasons, I request that the methods be moved to &lt;tt&gt;ClassNodeUtils&lt;/tt&gt; with some extra notes or made private within classgen somewhere.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13419779">GROOVY-10434</key>
            <summary>ClassNode isRecord and isSealed not useful before AST transformation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="emilles">Eric Milles</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Dec 2021 22:06:18 +0000</created>
                <updated>Thu, 3 Feb 2022 22:35:37 +0000</updated>
                            <resolved>Tue, 25 Jan 2022 10:29:38 +0000</resolved>
                                    <version>4.0.0-rc-2</version>
                                    <fixVersion>4.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17466442" author="paulk" created="Wed, 29 Dec 2021 12:35:47 +0000"  >&lt;p&gt;Definitely the documentation should be expanded.&lt;/p&gt;

&lt;p&gt;We do have other methods which are impacted by AST transforms, e.g. &lt;tt&gt;MethodNode#isPublic&lt;/tt&gt; might change (and hence doesn&apos;t work &lt;em&gt;correctly&lt;/em&gt; in earlier phases) when processing &lt;tt&gt;@PackageScope&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Having said that, there are counter examples where we&apos;ve moved such methods to other classes like &lt;tt&gt;Traits#isTrait&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;In this case however, you&apos;d typically call &lt;tt&gt;isRecord&lt;/tt&gt; just before calling &lt;tt&gt;getRecordComponents&lt;/tt&gt; and &lt;tt&gt;isSealed&lt;/tt&gt; just before calling &lt;tt&gt;getPermittedSubclasses&lt;/tt&gt;, it seems a little weird that you&apos;d want that functionality split across &lt;tt&gt;ClassNode&lt;/tt&gt; and &lt;tt&gt;ClassNodeUtils&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17466575" author="emilles" created="Wed, 29 Dec 2021 19:17:14 +0000"  >&lt;p&gt;Since &lt;tt&gt;getRecordComponents()&lt;/tt&gt; and &lt;tt&gt;getPermittedSubclasses()&lt;/tt&gt; safely return non-null results, is there any reason to check &lt;tt&gt;isRecord()&lt;/tt&gt; or &lt;tt&gt;isSealed()&lt;/tt&gt; first?  The accessors can function on their own.&lt;/p&gt;

&lt;p&gt;True, &lt;tt&gt;MethodNode#isPublic&lt;/tt&gt; can be affected by &lt;tt&gt;groovy.transform.PackageScope&lt;/tt&gt;.  But the accessor reports on the modifier.  For the most part, modifiers are available from a quite early compiler phase.  And for a decompiled class, it works just fine.&lt;/p&gt;

&lt;p&gt;My preference is not to split functionality between ClassNode and ClassNodeUtils, but instead to remove isRecord and isSealed from the public API until their need is clear and their lifecycle concerns are more fully understood.&lt;/p&gt;</comment>
                            <comment id="17467234" author="paulk" created="Fri, 31 Dec 2021 12:11:26 +0000"  >&lt;p&gt;I am not sure it is as simple as removing the methods. The methods make logical sense even if the current implementation has some limitations - we can improve over time.&lt;/p&gt;

&lt;p&gt;According to the JLS, records can have no components:&lt;br/&gt;
&lt;a href=&quot;https://docs.oracle.com/javase/specs/jls/se17/html/jls-8.html#jls-8.10.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/specs/jls/se17/html/jls-8.html#jls-8.10.1&lt;/a&gt;&lt;br/&gt;
So just using &lt;tt&gt;getRecordComponents()&lt;/tt&gt; is insufficient.&lt;/p&gt;

&lt;p&gt;I don&apos;t believe a sealed class can have no permitted subclasses, so it isn&apos;t the same story for sealed classes, but currently &lt;tt&gt;getPermittedSubclasses()&lt;/tt&gt; returns the permitted subclasses for both sealed and &quot;sealed-like&quot; classes, e.g. on earlier JDKs.&lt;br/&gt;
Currently, &lt;tt&gt;isSealed()&lt;/tt&gt; is also returning true for sealed-like classes, but there is an argument that it should be like&lt;br/&gt;
&lt;tt&gt;isRecord()&lt;/tt&gt; and only return true for native sealed classes. In which case, our current implementation would need to distinguish between &lt;tt&gt;getPermittedSubclasses()&lt;/tt&gt; and &lt;tt&gt;isSealed()&lt;/tt&gt;. We could also change our current implementation but it isn&apos;t clear what the benefit would be.&lt;/p&gt;

&lt;p&gt;Given that &quot;sealed&quot; is an incubating feature, we have some wiggle room to adjust the behavior down the track - not ideal but we have received very little feedback from users of the feature to date.&lt;/p&gt;

&lt;p&gt;Perhaps also adding &lt;tt&gt;@Incubating&lt;/tt&gt; to the &lt;tt&gt;isSealed()&lt;/tt&gt; and &lt;tt&gt;isRecord()&lt;/tt&gt; methods is the right approach here?&lt;/p&gt;</comment>
                            <comment id="17478641" author="paulk" created="Wed, 19 Jan 2022 12:31:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt; Does this look like an improvement for the sealed part of this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/groovy/commit/78247f940a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/78247f940a&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17481721" author="paulk" created="Tue, 25 Jan 2022 10:29:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt; I propose we close this given the related commits. There is now some clarification in the documentation which we can improve over time. Also, the methods seem to be functionality that makes sense even if not perfectly implemented at this point. Everything is marked as @Incubating, so we can open specific issues later if needed and adjust appropriately as we get further feedback.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 42 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0y3bc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>