<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:57:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-435] Can&apos;t have private constructors</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-435</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;To implement the singleton pattern, I like to make the constructor private so that the only way to access the singleton object is through a getInstance() method. Trying to do this in groovy fails.&lt;/p&gt;

&lt;p&gt;Here is the simple code:&lt;/p&gt;

&lt;p&gt;class SingletonBug {&lt;br/&gt;
    private static SingletonBug instance = null&lt;/p&gt;

&lt;p&gt;    private SingletonBug() {&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;    static SingletonBug getInstance() &lt;/p&gt;
{
        if(instance == null)
            instance = new SingletonBug()
        return instance
    }

&lt;p&gt;    static void main(args) {&lt;br/&gt;
        i = SingletonBug.getInstance()&lt;br/&gt;
        println &quot;got it: {$i}&quot;&lt;br/&gt;
    }&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;Running this through groovy fails with this stack trace:&lt;/p&gt;

&lt;p&gt;Caught: groovy.lang.GroovyRuntimeException: could not access constructor: private SingletonBug() with arguments: [] reason: java.lang.IllegalAccessException: Class groovy.lang.MetaClass can not access a member of class SingletonBug with modifiers &quot;private&quot;&lt;br/&gt;
groovy.lang.GroovyRuntimeException: could not access constructor: private SingletonBug() with arguments: [] reason: java.lang.IllegalAccessException: Class groovy.lang.MetaClass can not access a member of class SingletonBug with modifiers &quot;private&quot;&lt;br/&gt;
        at groovy.lang.MetaClass.doConstructorInvoke(MetaClass.java:1119)&lt;br/&gt;
        at groovy.lang.MetaClass.invokeConstructor(MetaClass.java:407)&lt;br/&gt;
        at org.codehaus.groovy.runtime.Invoker.invokeConstructorOf(Invoker.java:159)&lt;br/&gt;
        at org.codehaus.groovy.runtime.InvokerHelper.invokeNoArgumentsConstructorOf(InvokerHelper.java:137)&lt;br/&gt;
        at SingletonBug.getInstance(SingletonBug.groovy:9)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:324)&lt;br/&gt;
        at org.codehaus.groovy.runtime.ReflectionMetaMethod.invoke(ReflectionMetaMethod.java:63)&lt;br/&gt;
        at groovy.lang.MetaClass.doMethodInvoke(MetaClass.java:996)&lt;br/&gt;
        at groovy.lang.MetaClass.invokeStaticMethod(MetaClass.java:365)&lt;br/&gt;
        at org.codehaus.groovy.runtime.Invoker.invokeMethod(Invoker.java:124)&lt;br/&gt;
        at org.codehaus.groovy.runtime.InvokerHelper.invokeNoArgumentsMethod(InvokerHelper.java:102)&lt;br/&gt;
        at SingletonBug.main(SingletonBug.groovy:14)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:324)&lt;br/&gt;
        at org.codehaus.groovy.runtime.ReflectionMetaMethod.invoke(ReflectionMetaMethod.java:63)&lt;br/&gt;
        at groovy.lang.MetaClass.doMethodInvoke(MetaClass.java:996)&lt;br/&gt;
        at groovy.lang.MetaClass.invokeStaticMethod(MetaClass.java:365)&lt;br/&gt;
        at org.codehaus.groovy.runtime.Invoker.invokeMethod(Invoker.java:124)&lt;br/&gt;
        at org.codehaus.groovy.runtime.InvokerHelper.invokeMethod(InvokerHelper.java:106)&lt;br/&gt;
        at groovy.lang.GroovyShell.run(GroovyShell.java:222)&lt;br/&gt;
        at groovy.lang.GroovyShell.main(GroovyShell.java:92)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:324)&lt;br/&gt;
        at org.codehaus.classworlds.Launcher.launchStandard(Launcher.java:410)&lt;br/&gt;
        at org.codehaus.classworlds.Launcher.launch(Launcher.java:344)&lt;br/&gt;
        at org.codehaus.classworlds.Launcher.main(Launcher.java:474)&lt;br/&gt;
Caused by: java.lang.IllegalAccessException: Class groovy.lang.MetaClass can not access a member of class SingletonBug with modifiers &quot;private&quot;&lt;br/&gt;
        at sun.reflect.Reflection.ensureMemberAccess(Reflection.java:57)&lt;br/&gt;
        at java.lang.reflect.Constructor.newInstance(Constructor.java:268)&lt;br/&gt;
        at groovy.lang.MetaClass.doConstructorInvoke(MetaClass.java:1086)&lt;br/&gt;
        ... 32 more&lt;/p&gt;</description>
                <environment>Mac OSX 10.3.2, java 1.4.2</environment>
        <key id="12815986">GROOVY-435</key>
            <summary>Can&apos;t have private constructors</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="phkim">Kim, Pilho</assignee>
                                    <reporter username="johnstump">John Stump</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Apr 2004 13:07:42 +0000</created>
                <updated>Sat, 24 Sep 2005 09:37:16 +0000</updated>
                            <resolved>Sat, 24 Sep 2005 09:30:11 +0000</resolved>
                                    <version>1.0-beta-5</version>
                                    <fixVersion>1.0-JSR-4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14460461" author="ko-hey" created="Mon, 19 Jul 2004 00:05:57 +0000"  >&lt;p&gt;How about this patch?:&lt;/p&gt;

&lt;p&gt;Index: src/main/groovy/lang/MetaClass.java&lt;br/&gt;
===================================================================&lt;br/&gt;
RCS file: /scm/groovy/groovy/groovy-core/src/main/groovy/lang/MetaClass.java,v&lt;br/&gt;
retrieving revision 1.80&lt;br/&gt;
diff -u -r1.80 MetaClass.java&lt;br/&gt;
&amp;#8212; src/main/groovy/lang/MetaClass.java	18 Jul 2004 16:25:03 -0000	1.80&lt;br/&gt;
+++ src/main/groovy/lang/MetaClass.java	19 Jul 2004 04:04:12 -0000&lt;br/&gt;
@@ -1586,6 +1586,13 @@&lt;br/&gt;
         //System.out.println(this.theClass);&lt;/p&gt;

&lt;p&gt;         try {&lt;br/&gt;
+            final Constructor ctor = constructor;&lt;br/&gt;
+            AccessController.doPrivileged(new PrivilegedAction() {&lt;br/&gt;
+                public Object run() &lt;/p&gt;
{
+                    ctor.setAccessible(true);
+                    return null;
+                }
&lt;p&gt;+            });&lt;br/&gt;
             return constructor.newInstance(argumentArray);&lt;br/&gt;
         }&lt;br/&gt;
         catch (InvocationTargetException e) {&lt;/p&gt;</comment>
                            <comment id="14460534" author="johnstump" created="Mon, 19 Jul 2004 17:30:01 +0000"  >&lt;p&gt;Unfortunately, this patch allows anyone to access the private constructor, which is not good either.&lt;/p&gt;</comment>
                            <comment id="14460497" author="johnstump" created="Mon, 19 Jul 2004 17:50:50 +0000"  >&lt;p&gt;After further investigation, the reason for this bug is that calls to new XX() are delegated through the Invoker, which delegates to the metaclass, which does the ctor invoke. The metaclass.doConstructorInvoke() method will never be a part of the class we&apos;re trying to new, so this will always fail.&lt;/p&gt;

&lt;p&gt;Here&apos;s a test case for testing this:&lt;/p&gt;

&lt;p&gt;/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;@author John Stump&lt;/li&gt;
	&lt;li&gt;@version $Revision$&lt;br/&gt;
 */&lt;br/&gt;
class PrivateConstructorBug extends GroovyTestCase {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    void testBug() {&lt;br/&gt;
        shouldFail &lt;/p&gt;
{ new SingletonClass() }
&lt;p&gt;        assert SingletonClass.getInstance() != null&lt;br/&gt;
    }&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;class SingletonClass {&lt;br/&gt;
    private static instance = null&lt;/p&gt;

&lt;p&gt;    private SingletonClass() {}&lt;/p&gt;

&lt;p&gt;    static getInstance() &lt;/p&gt;
{
        if(instance == null)
            instance = new SingletonClass()
        return instance
    }
&lt;p&gt;}&lt;/p&gt;</comment>
                            <comment id="14461553" author="phkim" created="Sat, 24 Sep 2005 09:30:11 +0000"  >&lt;p&gt;&lt;a href=&quot;http://cvs.groovy.codehaus.org/changelog/groovy/groovy/groovy-core?cs=MAIN:phk:20050924140625&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cvs.groovy.codehaus.org/changelog/groovy/groovy/groovy-core?cs=MAIN:phk:20050924140625&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;SingletonBugTest.groovy has been added to the test suits.&lt;/p&gt;
</comment>
                            <comment id="14461475" author="phkim" created="Sat, 24 Sep 2005 09:37:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-434&quot; title=&quot;parser will hang on the attached code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-434&quot;&gt;&lt;del&gt;GROOVY-434&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-499&quot; title=&quot;constructor can&amp;#39;t invoke overloaded constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-499&quot;&gt;&lt;del&gt;GROOVY-499&lt;/del&gt;&lt;/a&gt; are similar&lt;br/&gt;
Every class should be accessible its private (or proteced or package) creator.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310260">
                    <name>Related</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12815934">GROOVY-499</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            20 years, 10 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bo4n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>