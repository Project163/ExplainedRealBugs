<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:56:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-8324] Enabling groovy.indy.logging can lead to stack overflows</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-8324</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Still digging through this a bit more, but while trying to diagnose performance issues I enabled indy logging which led to:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;! Caused by: java.lang.StackOverflowError: null
! at java.lang.Class.getEnclosingMethodInfo(Class.java:1072)
! at java.lang.Class.getEnclosingClass(Class.java:1272)
! at java.lang.Class.getSimpleBinaryName(Class.java:1443)
! at java.lang.Class.getSimpleName(Class.java:1309)
! at java.lang.invoke.MethodType.toString(MethodType.java:797)
! at java.lang.String.valueOf(String.java:2982)                        &amp;lt;--- Loops back to here
! at java.lang.StringBuilder.append(StringBuilder.java:131)
! at org.codehaus.groovy.vmplugin.v7.Selector$MethodSelector.&amp;lt;init&amp;gt;(Selector.java:488)
! at org.codehaus.groovy.vmplugin.v7.Selector.getSelector(Selector.java:98)
! at org.codehaus.groovy.vmplugin.v7.IndyInterface.selectMethod(IndyInterface.java:227)
! at MyDomainClass.toString(MyDomainClass.groovy)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The domain class itself stringifies without issue, changing the class to use &lt;tt&gt;@CompileStatic&lt;/tt&gt; seems to have resolved this issue. It might be nice if that specific log message could be toggled independently of the others to try to avoid the possibility of blowing up while attempting to troubleshooting. &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java version &quot;1.8.0_45&quot;
Java(TM) SE Runtime Environment (build 1.8.0_45-b14)
Java HotSpot(TM) 64-Bit Server VM (build 25.45-b02, mixed mode)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13103352">GROOVY-8324</key>
            <summary>Enabling groovy.indy.logging can lead to stack overflows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jwagenleitner">John Wagenleitner</assignee>
                                    <reporter username="mwhipple">Matt Whipple</reporter>
                        <labels>
                            <label>invokedynamic</label>
                    </labels>
                <created>Tue, 19 Sep 2017 20:29:30 +0000</created>
                <updated>Tue, 6 Mar 2018 23:25:43 +0000</updated>
                            <resolved>Sun, 15 Oct 2017 04:11:27 +0000</resolved>
                                    <version>2.4.12</version>
                                    <fixVersion>2.4.13</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16172423" author="blackdrag" created="Tue, 19 Sep 2017 22:07:10 +0000"  >&lt;p&gt;Wait.. do I get this right? You are running a program and you have indy logging enabled and this logging then leads to a stack overflow when trying to build a String containing a MethodType and the error goes away if you use @CompileStatic in your program and am I right in that the loop is completely java.lang space? That looks strange. Would it be possible for you to provide an example? Because like this I can only suspect that maybe this is due to a wrongly set inner class information or something alike, but that is just guessing.&lt;/p&gt;</comment>
                            <comment id="16172478" author="mwhipple" created="Tue, 19 Sep 2017 22:53:30 +0000"  >&lt;p&gt;I&apos;ll work on providing better info in the next day now that I&apos;m not occupied with the main issue. I meant to give an explanation for the abbreviated trace,  but it repeats from the tagged line down, so mostly the vmplugin stuff and the attempted stringifying of MyDomainClass. MyDomainClass in the above is a placeholder for a (non-nested) Bean style class which is @Immutable and it was that class to which adding @CompileStatic resolved the immediate issue. I&apos;ll work on getting a real code example together. &lt;/p&gt;

&lt;p&gt;After that issue was passed another came up with a NoClassDef error for a nested class elsewhere which seemed unrelated but that sounds like it may align with your suggestion.&lt;/p&gt;</comment>
                            <comment id="16172479" author="mwhipple" created="Tue, 19 Sep 2017 22:55:12 +0000"  >&lt;p&gt;And the answer to all the questions before the final java.lang trace one is yes&lt;/p&gt;</comment>
                            <comment id="16173398" author="mwhipple" created="Wed, 20 Sep 2017 15:58:49 +0000"  >&lt;p&gt;Other domain classes are also resulting in similar issues, all of which are relying on the &lt;tt&gt;@ToString&lt;/tt&gt; AST Transformation.  Here&apos;s another trace for another class which seems to be getting stuck while stringifying the enumerated arguments during the same logging block:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;! java.lang.StackOverflowError: null
! at org.codehaus.groovy.vmplugin.v7.IndyInterface$CALL_TYPES.values(IndyInterface.java:55)
! at org.codehaus.groovy.vmplugin.v7.Selector.getSelector(Selector.java:95)
! at org.codehaus.groovy.vmplugin.v7.IndyInterface.selectMethod(IndyInterface.java:227)
! at foo.PendingChange.toString(PendingChangeDAO.groovy)
! at java.lang.String.valueOf(String.java:2982)
! at java.lang.StringBuilder.append(StringBuilder.java:131)
! at org.codehaus.groovy.vmplugin.v7.Selector$MethodSelector.&amp;lt;init&amp;gt;(Selector.java:499)
! at org.codehaus.groovy.vmplugin.v7.Selector.getSelector(Selector.java:98)
! at org.codehaus.groovy.vmplugin.v7.IndyInterface.selectMethod(IndyInterface.java:227)
! at foo.PendingChange.toString(PendingChangeDAO.groovy)
! at java.lang.String.valueOf(String.java:2982)
! at java.lang.StringBuilder.append(StringBuilder.java:131)
! at org.codehaus.groovy.vmplugin.v7.Selector$MethodSelector.&amp;lt;init&amp;gt;(Selector.java:499)
! at org.codehaus.groovy.vmplugin.v7.Selector.getSelector(Selector.java:98)
! at org.codehaus.groovy.vmplugin.v7.IndyInterface.selectMethod(IndyInterface.java:227)
! at foo.PendingChange.toString(PendingChangeDAO.groovy)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m not done looking at the primary issue yet after all but I&apos;ll likely try to circle back to this shortly and see if I can debug it a bit.&lt;/p&gt;</comment>
                            <comment id="16173788" author="blackdrag" created="Wed, 20 Sep 2017 20:39:23 +0000"  >&lt;p&gt;first time you mention @ToString. This is a strong indicator for the printing of the arguments in the logging. &quot;this&quot; is the first argument, thus if this.toString is done by invokedynamic, it will lead to an stack overflow. Which org.codehaus.groovy.vmplugin.v7.IndyInterface.selectMethod(IndyInterface.java:227) needs a fix for the arguments. If you want to really get to the bottom if this I suggest you remove parts from the logging message in this line and see which is causing it. My bet is now on the arguments&lt;/p&gt;</comment>
                            <comment id="16176467" author="mwhipple" created="Fri, 22 Sep 2017 14:03:38 +0000"  >&lt;p&gt;project to reproduce the issue in relative isolation: &lt;a href=&quot;https://github.com/mwhipple/groovy-8324&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mwhipple/groovy-8324&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Will poke around at it today.&lt;/p&gt;</comment>
                            <comment id="16176907" author="githubbot" created="Fri, 22 Sep 2017 18:36:45 +0000"  >&lt;p&gt;GitHub user mwhipple opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/604&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/604&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8324&quot; title=&quot;Enabling groovy.indy.logging can lead to stack overflows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8324&quot;&gt;&lt;del&gt;GROOVY-8324&lt;/del&gt;&lt;/a&gt;: Skip logging &apos;this&apos; argument in IndyInterface&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/mwhipple/groovy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mwhipple/groovy&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8324&quot; title=&quot;Enabling groovy.indy.logging can lead to stack overflows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8324&quot;&gt;&lt;del&gt;GROOVY-8324&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/604.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/604.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #604&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit c153a7220c76e814dd562faeb4d41f3975879dec&lt;br/&gt;
Author: Matt Whipple &amp;lt;mwhipple@brightcove.com&amp;gt;&lt;br/&gt;
Date:   2017-09-22T18:34:10Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8324&quot; title=&quot;Enabling groovy.indy.logging can lead to stack overflows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8324&quot;&gt;&lt;del&gt;GROOVY-8324&lt;/del&gt;&lt;/a&gt;: Skip logging &apos;this&apos; argument in IndyInterface&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16176930" author="mwhipple" created="Fri, 22 Sep 2017 18:55:44 +0000"  >&lt;p&gt;Your bet was correct...the logging was cycling on a getter trying to stringify the &lt;tt&gt;this&lt;/tt&gt; argument where the toString() invoked that getter. I opened a PR for what seems like a reasonable way to avoid this by not logging the &lt;tt&gt;this&lt;/tt&gt; argument:&lt;/p&gt;

&lt;p&gt;Sample output from the git project linked in previous comment:&lt;/p&gt;

&lt;p&gt;instance method:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    INFO: ----------------------------------------------------
                invocation of method &apos;getName&apos;
                invocation type: METHOD
                sender: class gt.MyOtherObject
                targetType: (MyOtherObject)Object
                safe navigation: false
                thisCall: true
                spreadCall: false
                with 1 arguments (including &apos;this&apos;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;non-instance method (unchanged):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    INFO: ----------------------------------------------------
                invocation of method &apos;append&apos;
                invocation type: METHOD
                sender: class gt.MyOtherObject
                targetType: (Object,Object)Object
                safe navigation: false
                thisCall: false
                spreadCall: false
                with 2 arguments
                        argument[0] = gt.MyOtherObject(
                        argument[1] = test0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16177266" author="blackdrag" created="Fri, 22 Sep 2017 22:27:32 +0000"  >&lt;p&gt;Hmm... but it does still mean, that if the second argument in that array is a class compiled with Groovy invokedynamic, it will cause further logging in the logging and in the worst case an overflow again. What do you think about printing the argument classes instead of the actual arguments? Maybe with identity hashcode?&lt;/p&gt;</comment>
                            <comment id="16177322" author="mwhipple" created="Fri, 22 Sep 2017 23:29:23 +0000"  >&lt;p&gt;Sounds good to me, I&apos;ll swap the PR around later tonight or tomorrow. I don&apos;t &lt;em&gt;think&lt;/em&gt; the current approach would cause a stack overflow (though I could certainly be missing something), but it is definitely very noisy.&lt;/p&gt;</comment>
                            <comment id="16177928" author="mwhipple" created="Sat, 23 Sep 2017 18:08:43 +0000"  >&lt;p&gt;Updated sample output:&lt;br/&gt;
Method call including &lt;tt&gt;@ToString&lt;/tt&gt;&apos;ed class (no longer descends):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    INFO: ----------------------------------------------------
                invocation of method &apos;checkPropNames&apos;
                invocation type: METHOD
                sender: class gt.MyValueObject
                targetType: (Class,MyValueObject,HashMap)Object
                safe navigation: false
                thisCall: false
                spreadCall: false
                with 3 arguments
                        argument[0] = java.lang.Class@702fcf34
                        argument[1] = gt.MyValueObject@248274ae
                        argument[2] = java.util.LinkedHashMap@4ab86851
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Call with null arg:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    INFO: ----------------------------------------------------
                invocation of method &apos;&apos;
                invocation type: CAST
                sender: class org.codehaus.groovy.vmplugin.v7.Selector
                targetType: (Object)String
                safe navigation: false
                thisCall: false
                spreadCall: false
                with 1 arguments
                        argument[0] = null
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16205012" author="githubbot" created="Sun, 15 Oct 2017 03:59:45 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/604&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/604&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16205017" author="jwagenleitner" created="Sun, 15 Oct 2017 04:11:27 +0000"  >&lt;p&gt;Thanks for reporting the issue and for the fix.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 5 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3k96v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>