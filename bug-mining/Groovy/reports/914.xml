<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:11:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-3367] property expressions using &quot;this&quot; as object part won&apos;t work in combination with @Category</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-3367</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Category(Distance)
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;DistanceCategory {
    Distance plus(Distance increment) {
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Distance(number: &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.number + increment.number)
    }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;here this.number is a PropertyExpression and the this needs to be transformed, but is not. The transform uses ClassCodeExpressionTransformer which does not transform the object part in Propoertyxpressions. ResolveVisitor makes use of that class too, so a fix has to take special attention to that&lt;/p&gt;</description>
                <environment></environment>
        <key id="12814530">GROOVY-3367</key>
            <summary>property expressions using &quot;this&quot; as object part won&apos;t work in combination with @Category</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roshandawrani">Roshan Dawrani</assignee>
                                    <reporter username="blackdrag">Jochen Theodorou</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Feb 2009 17:01:09 +0000</created>
                <updated>Tue, 7 Apr 2009 23:33:15 +0000</updated>
                            <resolved>Sat, 21 Feb 2009 10:27:10 +0000</resolved>
                                    <version>1.6</version>
                                    <fixVersion>1.6.1</fixVersion>
                    <fixVersion>1.7-beta-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14466556" author="roshandawrani" created="Fri, 20 Feb 2009 11:00:22 +0000"  >&lt;p&gt;A basic question. In an example like yours, where the category DistanceCategory has non-static methods, the non-static methods get mapped to static methods with $this as the first parameter, right?&lt;/p&gt;

&lt;p&gt;So, the transformation that should happen for a property-expression like &quot;this.number&quot; should transform object expression &quot;this&quot; to the first parameter &quot;$this&quot; that groovy compiler(CategoryASTTransformation) adds to the method when transform the non-static method &quot;plus&quot; to make it a static one? Is that understanding correct?&lt;/p&gt;

&lt;p&gt;rgds,&lt;br/&gt;
Roshan&lt;/p&gt;</comment>
                            <comment id="14466583" author="blackdrag" created="Fri, 20 Feb 2009 11:11:59 +0000"  >&lt;p&gt;$this as first paramter, yes. And this.number should become $this.number, yes. &lt;/p&gt;</comment>
                            <comment id="14466513" author="roshandawrani" created="Fri, 20 Feb 2009 12:46:54 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
   I am attaching a patch for this issue. i have verified it with 1.6.1 tests and it didn&apos;t break anything else.&lt;/p&gt;

&lt;p&gt;The change is made to the transformation that happens in inner class defined in CategoryASTTransformation.visit(..) method. And since the change is made to this extension of ClassCodeExpressionTransformer and not to ClassCodeExpressionTransformer itself, the ResolveVisitor was not impacted in any way.&lt;/p&gt;

&lt;p&gt;I have verified the fix with the code below. Does it cover the requirement?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Category(Distance)
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;DistanceCategory {
    Distance plus(Distance increment) {
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Distance(number: &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.number + increment.number)
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Distance {
    def number
}

use(DistanceCategory.class) {
    def d1 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Distance(number: 5)
    def d2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Distance(number: 10)
    def d3 = d1 + d2
    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; d3.number == 15
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the fix and its verification look ok, I can apply it.&lt;/p&gt;</comment>
                            <comment id="14466494" author="blackdrag" created="Fri, 20 Feb 2009 13:51:19 +0000"  >&lt;p&gt;I thought of changing ClassCodeExpressionTransformer because if it is used as base for more such things, then it would be good if it has no missing spots. If it seems unreasonable to change ClassCodeExpressionTransformer, then we need to add comments in the class advising the user how to use the class correctly&lt;/p&gt;</comment>
                            <comment id="14466527" author="roshandawrani" created="Fri, 20 Feb 2009 13:59:01 +0000"  >&lt;p&gt;Oh, I just did it more cautiously by changing the subclass of ClassCodeExpressionTransformer in CategoryASTTransformation because I thought higher a change is done in the hierarchy, more the chances of having an impact at other places.&lt;/p&gt;

&lt;p&gt;I guess increased reuse and risking the impact around go hand in hand as we move up in hierarchy.&lt;/p&gt;

&lt;p&gt;So, which way do you want me to do it? Try to move the change up in ClassCodeExpressionTransformer and see if anything is broken or put the comments? If comments, I am a bit unclear about what point you have in mind to be conveyed in comments?&lt;/p&gt;</comment>
                            <comment id="14466537" author="roshandawrani" created="Sat, 21 Feb 2009 02:16:29 +0000"  >&lt;p&gt;So, what is the call? &lt;/p&gt;

&lt;p&gt;Is it ok to have the fix in ClassCodeExpressionTransformer&apos;s subclass? &lt;/p&gt;

&lt;p&gt;Or, there is usefulness of such transformation from &quot;this&quot; to &quot;$this&quot; even at other places (currently ClassCodeExpressionTransformer also gets subclassed by OptimizerVisitor, ResolveVisitor, StaticImportVisitor and NewifyASTTransformation). Does this transformation make sense possibly for these other places too?&lt;/p&gt;</comment>
                            <comment id="14466550" author="blackdrag" created="Sat, 21 Feb 2009 07:03:08 +0000"  >&lt;p&gt;after looking into this one more time I think you simply do your patch. And that&apos;s because I think most of the time a PropertyExpression is transformed in context, meaning a simple replacement like &quot;this&quot;-&amp;gt;&quot;$this&quot; is maybe not the usual thing. Still I think the javadoc to the class should mention that!&lt;/p&gt;</comment>
                            <comment id="14466528" author="roshandawrani" created="Sat, 21 Feb 2009 07:05:01 +0000"  >&lt;p&gt;Sure. I will put in the javadoc comments why this -&amp;gt; $this is being done. Thanks.&lt;/p&gt;</comment>
                            <comment id="14466581" author="blackdrag" created="Sat, 21 Feb 2009 07:22:35 +0000"  >&lt;p&gt;I didn&apos;t mean the javadoc of Category.. ok, that could be improved as well.. no I did mean the javadoc of ClassCodeExpressionTransformer &lt;/p&gt;</comment>
                            <comment id="14466496" author="roshandawrani" created="Sat, 21 Feb 2009 10:27:10 +0000"  >&lt;p&gt;Fixed on 1.6.1 and 1.7-beta-1 branches. Updated some relevant bits of javadoc with changes related to this JIRA.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12721924" name="3367_v16x_patch.txt" size="1070" author="roshandawrani" created="Fri, 20 Feb 2009 12:46:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 40 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bnzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>