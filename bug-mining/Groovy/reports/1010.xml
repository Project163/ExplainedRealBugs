<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:12:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-3316] Find a solution to the collection coping problem involving findAll, grep etc. that causes Hibernate lazy loading to break</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-3316</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;See &lt;a href=&quot;http://www.nabble.com/findAll-and-Lazy-loaded-Hibernate-JPA-collections-broken-in-Groovy--1.6-td21682669.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.nabble.com/findAll-and-Lazy-loaded-Hibernate-JPA-collections-broken-in-Groovy--1.6-td21682669.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This issue is critical, we either need to revert to the original behavior or find a solution that supports the new behavior whilst not breaking specialized collection types like those used in Hibernate&lt;/p&gt;</description>
                <environment></environment>
        <key id="12814520">GROOVY-3316</key>
            <summary>Find a solution to the collection coping problem involving findAll, grep etc. that causes Hibernate lazy loading to break</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="graemerocher">Graeme Rocher</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Jan 2009 18:20:07 +0000</created>
                <updated>Thu, 12 Feb 2009 03:35:33 +0000</updated>
                            <resolved>Mon, 9 Feb 2009 07:23:59 +0000</resolved>
                                    <version>1.6-rc-2</version>
                                    <fixVersion>1.6-rc-3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14466466" author="jimwhite" created="Wed, 28 Jan 2009 20:44:24 +0000"  >&lt;p&gt;I propose to change &lt;tt&gt;DefaultGroovyMethodsSupport.createCollectionFromClass&lt;/tt&gt; and &lt;tt&gt;createMapFromClass&lt;/tt&gt; to be more selective about the classes that they try the &quot;instance&apos;s class constructor&quot; scheme on.  For starters they will be limited to &lt;tt&gt;java.util.AbstractCollection&lt;/tt&gt; and &lt;tt&gt;java.util.AbstractMap&lt;/tt&gt; respectively.&lt;/p&gt;

&lt;p&gt;Java 1.5 classes that implement &lt;tt&gt;java.util.Collection&lt;/tt&gt; but do not extend &lt;tt&gt;java.util.AbstractCollection&lt;/tt&gt;:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;java.beans.beancontext.BeanContextSupport&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;java.util.concurrent.CopyOnWriteArrayList&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Java 1.5 classes that implement &lt;tt&gt;java.util.Map&lt;/tt&gt; but do not extend &lt;tt&gt;java.util.AbstractMap&lt;/tt&gt;:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;java.util.jar.Attributes&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;java.util.Hashtable&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;java.awt.RenderingHints&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;javax.management.openmbean.TabularDataSupport&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It may make sense to extend the methods to some (all?) of these.&lt;/p&gt;
</comment>
                            <comment id="14466272" author="jimwhite" created="Wed, 28 Jan 2009 21:11:17 +0000"  >&lt;p&gt;I&apos;ve committed this proposed fix to the trunk (cs15169).&lt;/p&gt;

&lt;p&gt;I went ahead and added the &lt;tt&gt;Hashtable&lt;/tt&gt; check along with &lt;tt&gt;AbstractMap&lt;/tt&gt; because it was already being handled by &lt;tt&gt;createSimilarMap&lt;/tt&gt; (whose &lt;tt&gt;instanceof&lt;/tt&gt; checks are probably superfluous now).&lt;/p&gt;

&lt;p&gt;In addition I made the same change to the &lt;tt&gt;cloneXXXFromClass&lt;/tt&gt; methods since they do the same thing as the &lt;tt&gt;createXXXFromClass&lt;/tt&gt; methods.  It is quite strange that there is all that code doing cloning but no use of &lt;tt&gt;Object.clone&lt;/tt&gt; which is specifically for performing this kind of shallow copy.&lt;/p&gt;
</comment>
                            <comment id="14466387" author="jimwhite" created="Wed, 28 Jan 2009 21:29:40 +0000"  >&lt;p&gt;Here&apos;s the proposed fix as a patch for the 1.6 branch.&lt;/p&gt;</comment>
                            <comment id="14478452" author="paulk" created="Wed, 28 Jan 2009 22:55:44 +0000"  >&lt;p&gt;I haven&apos;t had time to digest all this - being on hols this week. I agree something needs to be looked at and I appreciate Jim&apos;s suggestions but I am not sure (given my really quick glance) that I think this does what we want. It means that findAll etc. doesn&apos;t work for my own collection like classes if I implement Map or List but don&apos;t extend from the Abstract collections? Not sure this is what we want but need to look further.&lt;/p&gt;</comment>
                            <comment id="14466355" author="jimwhite" created="Wed, 28 Jan 2009 23:49:05 +0000"  >&lt;p&gt;I agree this is only a part of an answer.  Not only does this treat &lt;tt&gt;AbstractCollection&lt;/tt&gt; and &lt;tt&gt;AbstractMap&lt;/tt&gt; in a special way, it still isn&apos;t really any assurance or control on whether the particular class is willing to have its default constructor used.&lt;/p&gt;

&lt;p&gt;The benefit of doing this is it is simple and safe, at least in terms of not causing new problems than the current 1.6 approach.&lt;/p&gt;

&lt;p&gt;As I discuss in the groovy-dev thread, I think a proper solution would involve something MOPish using DGM along with categories and/or a marker interface.&lt;/p&gt;

&lt;p&gt;Of course something that addresses the Hibernate &lt;tt&gt;PersistentCollection&lt;/tt&gt; problem in a simple and general (enough) way would be dandy.  This was just the first thing that occurred to me that seemed plausible.&lt;/p&gt;</comment>
                            <comment id="14466468" author="jimwhite" created="Sun, 1 Feb 2009 14:01:57 +0000"  >&lt;p&gt;So what&apos;s the verdict?  Do I commit this to 1.6 (in expectation of getting into 1.6.0) or what?&lt;/p&gt;</comment>
                            <comment id="14478450" author="paulk" created="Sun, 1 Feb 2009 16:21:55 +0000"  >&lt;p&gt;I am just trying to replicate the issue now (as in next day or two) to see if I can think of an alternate solution. I think the current proposed solution is (partially) broken but agree that the original is (partially) broken too.&lt;/p&gt;</comment>
                            <comment id="14478454" author="paulk" created="Tue, 3 Feb 2009 05:58:55 +0000"  >&lt;p&gt;Here are two scripts that work fine with RC1 and RC2 but fail with the current quick fix in TRUNK:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.google.common.collect.HashBiMap
@Grab(group=&lt;span class=&quot;code-quote&quot;&gt;&apos;com.google.code.google-collections&apos;&lt;/span&gt;, module=&lt;span class=&quot;code-quote&quot;&gt;&apos;google-collect&apos;&lt;/span&gt;, version=&lt;span class=&quot;code-quote&quot;&gt;&apos;snapshot-20080530&apos;&lt;/span&gt;)
def getFruit() { [grape:&lt;span class=&quot;code-quote&quot;&gt;&apos;purple&apos;&lt;/span&gt;, lemon:&lt;span class=&quot;code-quote&quot;&gt;&apos;yellow&apos;&lt;/span&gt;, orange:&lt;span class=&quot;code-quote&quot;&gt;&apos;orange&apos;&lt;/span&gt;] as HashBiMap }
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; fruit.lemon == &lt;span class=&quot;code-quote&quot;&gt;&apos;yellow&apos;&lt;/span&gt;
def citrus = fruit.findAll{ k, v -&amp;gt; k != &lt;span class=&quot;code-quote&quot;&gt;&apos;grape&apos;&lt;/span&gt; }
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; citrus.size() == 2
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; citrus.inverse().yellow == &lt;span class=&quot;code-quote&quot;&gt;&apos;lemon&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Person { def first, last }
def bp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Person(first:&lt;span class=&quot;code-quote&quot;&gt;&apos;Brad&apos;&lt;/span&gt;, last:&lt;span class=&quot;code-quote&quot;&gt;&apos;Pitt&apos;&lt;/span&gt;)
def tc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Person(first:&lt;span class=&quot;code-quote&quot;&gt;&apos;Tom&apos;&lt;/span&gt;, last:&lt;span class=&quot;code-quote&quot;&gt;&apos;Cruise&apos;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;People {
    @Delegate &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; List delegate = []
    def getNames() { iterator().collect{&lt;span class=&quot;code-quote&quot;&gt;&quot;$it.first $it.last&quot;&lt;/span&gt;}.join(&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;) }
}
def actors = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; People()
[bp, tc].each{ actors.add(it) }
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; actors.names == &lt;span class=&quot;code-quote&quot;&gt;&apos;Brad Pitt, Tom Cruise&apos;&lt;/span&gt;
def selected = actors.findAll{ it.first.size() == it.last.size() }
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; selected.names == &lt;span class=&quot;code-quote&quot;&gt;&apos;Brad Pitt&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14478444" author="paulk" created="Wed, 4 Feb 2009 07:26:16 +0000"  >&lt;p&gt;Patch to dumb down clone/creation of collections attached. Should fix Hibernate. Someone will need to test.&lt;/p&gt;

&lt;p&gt;Bad that above examples won&apos;t work for now as well as others, e.g. this is now broken:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def q = [1, 2, 3] as LinkedBlockingQueue
q += 4
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; q.class == LinkedBlockingQueue
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14466484" author="guillaume" created="Fri, 6 Feb 2009 09:05:51 +0000"  >&lt;p&gt;The grails app attached to this issue should exhibit the Hibernate problem: GRAILS-3831&lt;/p&gt;</comment>
                            <comment id="14466519" author="guillaume" created="Fri, 6 Feb 2009 11:45:24 +0000"  >&lt;p&gt;With the latest changes in GROOVY_1_6_0 branch, the sample Grails application from GRAILS-3831 now pass the tests successfully.&lt;/p&gt;</comment>
                            <comment id="14466407" author="jimwhite" created="Fri, 6 Feb 2009 14:45:46 +0000"  >&lt;p&gt;How is it that the change is made on the 1.6.0 branch first (and so far only)?  It should go to trunk first, or at least GROOVY_1_6_X.&lt;/p&gt;</comment>
                            <comment id="14466472" author="blackdrag" created="Fri, 6 Feb 2009 15:04:56 +0000"  >&lt;p&gt;because it seems as a reasonable short term fix. But for the other branches we can look into this issue a bit more. Paul wanted to think about this a bit more for example. The applied patch is more or less a roll back. As we discussed on the list I considered a roll back if no solution was found till today.  Maybe cloning this issue would be good... with fix targets for 1.6.1 and 1.7&lt;/p&gt;</comment>
                            <comment id="14478465" author="paulk" created="Sun, 8 Feb 2009 01:12:53 +0000"  >&lt;p&gt;I am thinking though that we should align all of the codebases to be what we have in 1.6.0 and then explore modifications from there. Otherwise I know I will find discussions confusing.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722029" name="conservativeCloneAndCreate.patch" size="6439" author="paulk_asert" created="Wed, 4 Feb 2009 07:26:16 +0000"/>
                            <attachment id="12721920" name="proposed-patch.txt" size="4907" author="jimwhite" created="Wed, 28 Jan 2009 21:29:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 42 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cpsf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>