<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:53:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-7921] using &quot;this&quot; as the target of an assignment not working with Category annotation</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-7921</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;when I executed this code in GroovyConsole&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Category(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;IntegerEx {
  def reset(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; value) {
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; = value
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;
  }
}
use(IntegerEx){
  println (1 + 2).reset(1)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then, I get this exception log&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Exception thrown

BUG! exception in phase &lt;span class=&quot;code-quote&quot;&gt;&apos;semantic analysis&apos;&lt;/span&gt; in source unit &lt;span class=&quot;code-quote&quot;&gt;&apos;ConsoleScript17&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.codehaus.groovy.control.CompilationUnit.applyToSourceUnits(CompilationUnit.java:935)
	at org.codehaus.groovy.control.CompilationUnit.doPhaseOperation(CompilationUnit.java:593)
	at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:542)
	at groovy.lang.GroovyClassLoader.doParseClass(GroovyClassLoader.java:298)
	at groovy.lang.GroovyClassLoader.parseClass(GroovyClassLoader.java:268)
	at groovy.lang.GroovyShell.parseClass(GroovyShell.java:688)
	at groovy.lang.GroovyShell.run(GroovyShell.java:517)
	at groovy.lang.GroovyShell.run(GroovyShell.java:497)
	at groovy.lang.GroovyShell.run(GroovyShell.java:170)
	at groovy.lang.GroovyShell$run$1.call(Unknown Source)
	at groovy.ui.Console$_runScriptImpl_closure16.doCall(Console.groovy:1005)
	at groovy.ui.Console$_runScriptImpl_closure16.doCall(Console.groovy)
	at sun.reflect.GeneratedMethodAccessor218.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:497)
	at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:93)
	at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:325)
	at org.codehaus.groovy.runtime.metaclass.ClosureMetaClass.invokeMethod(ClosureMetaClass.java:294)
	at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1024)
	at groovy.lang.Closure.call(Closure.java:414)
	at groovy.lang.Closure.call(Closure.java:408)
	at groovy.lang.Closure.run(Closure.java:495)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: java.lang.NullPointerException
	at org.codehaus.groovy.classgen.VariableScopeVisitor.checkForFinal(VariableScopeVisitor.java:388)
	at org.codehaus.groovy.classgen.VariableScopeVisitor.checkFinalFieldAccess(VariableScopeVisitor.java:381)
	at org.codehaus.groovy.classgen.VariableScopeVisitor.visitBinaryExpression(VariableScopeVisitor.java:365)
	at org.codehaus.groovy.ast.expr.BinaryExpression.visit(BinaryExpression.java:51)
	at org.codehaus.groovy.ast.CodeVisitorSupport.visitExpressionStatement(CodeVisitorSupport.java:71)
	at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitExpressionStatement(ClassCodeVisitorSupport.java:196)
	at org.codehaus.groovy.ast.stmt.ExpressionStatement.visit(ExpressionStatement.java:42)
	at org.codehaus.groovy.ast.CodeVisitorSupport.visitBlockStatement(CodeVisitorSupport.java:37)
	at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitBlockStatement(ClassCodeVisitorSupport.java:166)
	at org.codehaus.groovy.classgen.VariableScopeVisitor.visitBlockStatement(VariableScopeVisitor.java:308)
	at org.codehaus.groovy.ast.stmt.BlockStatement.visit(BlockStatement.java:71)
	at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitClassCodeContainer(ClassCodeVisitorSupport.java:104)
	at org.codehaus.groovy.classgen.VariableScopeVisitor.visitConstructorOrMethod(VariableScopeVisitor.java:505)
	at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitMethod(ClassCodeVisitorSupport.java:126)
	at org.codehaus.groovy.ast.ClassNode.visitContents(ClassNode.java:1078)
	at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitClass(ClassCodeVisitorSupport.java:53)
	at org.codehaus.groovy.classgen.VariableScopeVisitor.visitClass(VariableScopeVisitor.java:473)
	at org.codehaus.groovy.control.CompilationUnit$11.call(CompilationUnit.java:648)
	at org.codehaus.groovy.control.CompilationUnit.applyToSourceUnits(CompilationUnit.java:931)
	... 22 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is this behavior groovy-language specification ?&lt;/p&gt;</description>
                <environment>mac os x 10.10.5&lt;br/&gt;
jdk 1.8.0_51</environment>
        <key id="13000691">GROOVY-7921</key>
            <summary>using &quot;this&quot; as the target of an assignment not working with Category annotation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="kyon.mm@gmail.com">kyon_mm</reporter>
                        <labels>
                    </labels>
                <created>Sat, 27 Aug 2016 15:42:22 +0000</created>
                <updated>Wed, 1 Feb 2017 23:18:45 +0000</updated>
                            <resolved>Wed, 31 Aug 2016 02:45:37 +0000</resolved>
                                    <version>2.4.7</version>
                                    <fixVersion>2.4.8</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15441869" author="blackdrag" created="Sat, 27 Aug 2016 16:36:32 +0000"  >&lt;p&gt;You are not supposed to ever see the &quot;BUG! exception&quot; message. So no, this is not right. &quot;this = value&quot; is not supposed to compile&lt;/p&gt;</comment>
                            <comment id="15441926" author="kyon.mm@gmail.com" created="Sat, 27 Aug 2016 17:13:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blackdrag&quot; class=&quot;user-hover&quot; rel=&quot;blackdrag&quot;&gt;blackdrag&lt;/a&gt; thank you comment.&lt;/p&gt;

&lt;p&gt;In my case, I will change this code as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Category(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;IntegerEx {
  def &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; reset(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; self, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; value) { &lt;span class=&quot;code-comment&quot;&gt;// change
&lt;/span&gt;    self = value &lt;span class=&quot;code-comment&quot;&gt;// change
&lt;/span&gt;    self
  }
}
use(IntegerEx){
  println ((1 + 2).reset(1))
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15441940" author="blackdrag" created="Sat, 27 Aug 2016 17:25:58 +0000"  >&lt;p&gt;Your category will return a new Integer, not mutate the old one. In that case &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  def &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; reset(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; self, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; value) {
    self
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;would be already good enough. In Groovy you can in theory mutate the Integer, but you really should not. The lower few Integer objects are cached (see Integer.valueOf), so mutating one Integer here would have undesired side effects elsewhere.&lt;/p&gt;</comment>
                            <comment id="15441957" author="kyon.mm@gmail.com" created="Sat, 27 Aug 2016 17:38:57 +0000"  >&lt;p&gt;Oh, certainly it&apos;s right.&lt;/p&gt;

&lt;p&gt;I will carefully design. thx.&lt;/p&gt;</comment>
                            <comment id="15443122" author="paulk" created="Sun, 28 Aug 2016 09:18:18 +0000"  >&lt;p&gt;&lt;tt&gt;this&lt;/tt&gt; will be changed to &lt;tt&gt;$this&lt;/tt&gt; by the Category transform (basically &lt;tt&gt;self&lt;/tt&gt; as per examples above). So your code isn&apos;t incorrect but a little strange. In any case final variable analysis is being run prior to the Category transform which is how the error occurs - since it doesn&apos;t make sense to check &lt;tt&gt;this&lt;/tt&gt; in the same way as other variables. In any case, just returning the &lt;tt&gt;value&lt;/tt&gt; parameter will accomplish the same thing, so I&apos;d avoid using the strange style. But perhaps you have shortened a more complex example and there might be some scenario where it could make sense to use &lt;tt&gt;this&lt;/tt&gt;. Just remember that it will be transformed to &lt;tt&gt;$this&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15443129" author="githubbot" created="Sun, 28 Aug 2016 09:23:23 +0000"  >&lt;p&gt;GitHub user paulk-asert opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/400&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/400&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7921&quot; title=&quot;using &amp;quot;this&amp;quot; as the target of an assignment not working with Category annotation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7921&quot;&gt;&lt;del&gt;GROOVY-7921&lt;/del&gt;&lt;/a&gt;: using &quot;this&quot; as the target of an assignment not working &#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;with Category annotation&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/paulk-asert/groovy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/paulk-asert/groovy&lt;/a&gt; groovy7921&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/400.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/400.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #400&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit db2bbcce46528bb87afd68855caa1118da5b0164&lt;br/&gt;
Author: paulk &amp;lt;paulk@asert.com.au&amp;gt;&lt;br/&gt;
Date:   2016-08-28T09:21:37Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7921&quot; title=&quot;using &amp;quot;this&amp;quot; as the target of an assignment not working with Category annotation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7921&quot;&gt;&lt;del&gt;GROOVY-7921&lt;/del&gt;&lt;/a&gt;: using &quot;this&quot; as the target of an assignment not working with Category annotation&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15448321" author="kyon.mm@gmail.com" created="Tue, 30 Aug 2016 07:27:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulk&quot; class=&quot;user-hover&quot; rel=&quot;paulk&quot;&gt;paulk&lt;/a&gt; thank you for your comments.&lt;br/&gt;
I can not explain my code simply, so I have shortened my code. I&apos;m sorry for that strange example.&lt;br/&gt;
these comments are helpful for me.&lt;/p&gt;</comment>
                            <comment id="15450856" author="githubbot" created="Wed, 31 Aug 2016 02:42:46 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/400&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/400&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15450861" author="paulk" created="Wed, 31 Aug 2016 02:45:37 +0000"  >&lt;p&gt;Proposed PR merged. You can now use &apos;this&apos; as the target of an assignment for the purposes of @Category or your own DSL. It makes no sense to use &apos;this&apos; for normal purposes.&lt;/p&gt;</comment>
                            <comment id="15452659" author="blackdrag" created="Wed, 31 Aug 2016 16:14:21 +0000"  >&lt;p&gt;in a normal Groovy program &quot;this=1&quot; should not compile. A DSL must transform it to something useful. I get the impression, that after PR 400 we are now simply ignoring a &quot;this=1&quot;. And I think that is not right either.  If we want to error this, but still want to allow it for DSLs, we need a check for it in the verfier for example. Or fail in VariableScopeVisitor, but then it is useless for most DSLs&lt;/p&gt;</comment>
                            <comment id="15453610" author="paulk" created="Wed, 31 Aug 2016 22:41:57 +0000"  >&lt;p&gt;Totally agree. I was keeping this issue to just removing the &quot;BUG! exception&quot;. We need to raise another issue for catching and reporting left over &quot;this&quot; assignments. Implemented in somewhere like the Verifier sounds right to me.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12811417">GROOVY-6947</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 11 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32wgn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>