<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:08:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-3187] ServletBinding lies about what variables it can handle</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-3187</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;If you look at the current implementation of ServletBinding in trunk, method getVariables() is not an accurate depiction of what variables getVariable will to respond to. &lt;/p&gt;

&lt;p&gt;public Map getVariables() {&lt;br/&gt;
   return binding.getVariables();&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;This returns the list of variables that were specifically created through setVariable. But if you look at the implementation of getVariable it inspects the name of the property that is being requested and will handle an additional three variables out, sout and html. Giving the fact that getVariables is the only way to inspect if a binding is aware of a specific variable without dealing with exception handling (getVariable throws an exeception if it cant find said variable) this seems like a bug.&lt;/p&gt;

&lt;p&gt;The two possible solutions being:&lt;br/&gt;
1.) Provide a method to determine the existence of a variable without having to catch exceptions&lt;br/&gt;
or&lt;br/&gt;
2.) Register out, sout and html via setVariable and not property name inspection in getVariable &lt;/p&gt;</description>
                <environment></environment>
        <key id="12817963">GROOVY-3187</key>
            <summary>ServletBinding lies about what variables it can handle</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="trashhalo">Stephen Solka</reporter>
                        <labels>
                    </labels>
                <created>Sat, 6 Dec 2008 16:47:06 +0000</created>
                <updated>Tue, 7 Apr 2015 19:13:14 +0000</updated>
                            <resolved>Fri, 6 Feb 2009 09:54:03 +0000</resolved>
                                    <version>1.6-beta-2</version>
                                    <fixVersion>1.6-rc-3</fixVersion>
                    <fixVersion>1.5.8</fixVersion>
                    <fixVersion>1.7-beta-1</fixVersion>
                                    <component>Groovlet / GSP</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14465909" author="guillaume" created="Sun, 7 Dec 2008 03:05:21 +0000"  >&lt;p&gt;Out of curiosity, why do you really need these variables to be listed in the binding?&lt;br/&gt;
They are really special, and are not variables put by the user, so people only interested with the user variables will have to filter these ones out.&lt;/p&gt;</comment>
                            <comment id="14465864" author="trashhalo" created="Sun, 7 Dec 2008 17:49:33 +0000"  >&lt;p&gt;I am not sure I understand the point. Of the seven variables actually put into the binding (request, response, context, application, session, params, headers) none of these were put there by users but programatically injected by the binding itself. So these people who only want user variables would already be filtering these out.&lt;/p&gt;

&lt;p&gt;The actual code that lead me to this discovery was I implemented a binding delegate class. The class take two bindings one acting as a base binding and one acting as an extension to that base. When a script calls getVariable the delegate first checks if the extension can handle the variable if not it falls back to the base binding. Any calls to set variable are passed to the extension binding. This allows me to expose a set of variables to groovlets as top level variables like request response etc but not have this binding modified between groovlet calls. An example usage of this if I want to expose a special binding that maps my spring bean mappings as a variable called &quot;beans&quot; to all my groovlets.&lt;/p&gt;

&lt;p&gt;I also would like to note that its a bit frustrating that GroovyServlet does not methodize the creation of the binding that is used within groovlets. It just spawns off new ServletBinding in the middle of a large block of code. Ive found ways to get around that without having to rewirte the entire GroovyServlet but I had to go around my elbow to get to my face as the saying goes.&lt;/p&gt;

&lt;p&gt;I went ahead and just rewrote getVariable on my delegate to just catch the exception and call the bases get variable in the catch block. But I maintain that even if the out, sout and html have special meaning in a groovy script they are still located via the bindings getVariable and should be treated no differently than request, and response. None of the variables injected into the variables hashmap during construction of the ServletBinding are user created variables anyways. &lt;/p&gt;</comment>
                            <comment id="14465805" author="guillaume" created="Sun, 7 Dec 2008 17:55:07 +0000"  >&lt;p&gt;Alright, makes sense as I had forgotten the other variables like request and so on were also returned&lt;/p&gt;</comment>
                            <comment id="14465849" author="guillaume" created="Sun, 7 Dec 2008 17:55:26 +0000"  >&lt;p&gt;A patch and test case will be most welcome &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14465824" author="trashhalo" created="Sun, 7 Dec 2008 18:26:21 +0000"  >&lt;p&gt;Alright! Patch and test case incoming later this week &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14465881" author="trashhalo" created="Mon, 8 Dec 2008 13:54:25 +0000"  >&lt;p&gt;Accidently set patch root to selection instead of project. &lt;/p&gt;</comment>
                            <comment id="14465873" author="trashhalo" created="Mon, 8 Dec 2008 14:14:16 +0000"  >&lt;p&gt;Since this was my first patch I was not sure what you guys were looking for. ServletBinding.java.patch is a targeted patch that just fixes exactly what was described in this bug. But there are some left over internal variables that are no longer needed.&lt;/p&gt;

&lt;p&gt;Clean_ServletBinding.java.patch is the cleaned up version of this patch. So its up to you guys if you wanted one that changes just what we talked about or one that changes what we talked about and removes some dead code. If you could provide guidance on this so I may know how to handle this in the future that would be helpful.&lt;/p&gt;</comment>
                            <comment id="14478355" author="paulk" created="Sun, 14 Dec 2008 04:57:58 +0000"  >&lt;p&gt;Hi Stephen. Thanks for the patch. Your submission was fine. It was good to have both versions to look at. Often we will have to make changes anyway, so I guess there is no absolute guideline on the correct kind of patch to submit.&lt;/p&gt;

&lt;p&gt;The main thing I changed was to keep the lazy semantics of setting the &lt;tt&gt;out&lt;/tt&gt;, &lt;tt&gt;sout&lt;/tt&gt; and &lt;tt&gt;html&lt;/tt&gt; variables as that behavior may be important for certain (perhaps legacy) web containers. I.e. the setting of those variables is deferred until the first attempted usage of the binding. Otherwise, there might be problems with certain web containers or with existing code that isn&apos;t expecting the constructor call to break. I think the solution we now have is a reasonable compromise.&lt;/p&gt;</comment>
                            <comment id="14478449" author="paulk" created="Wed, 28 Jan 2009 22:50:51 +0000"  >&lt;p&gt;implementation needs a tweak as per recent email discussion&lt;/p&gt;</comment>
                            <comment id="14466462" author="paulk" created="Wed, 28 Jan 2009 22:52:05 +0000"  >&lt;p&gt;potential fix - has its own issues&lt;/p&gt;</comment>
                            <comment id="14466273" author="trashhalo" created="Thu, 29 Jan 2009 09:50:40 +0000"  >&lt;p&gt;You originally stated &quot;The main thing I changed was to keep the lazy semantics of setting the out, sout and html variables as that behavior may be important for certain (perhaps legacy) web containers&quot; for the retention of the lazy initialization. Is this actually an issue? Or may be an issue? Is this new patch related to the lazy initialization?&lt;/p&gt;</comment>
                            <comment id="14466385" author="trashhalo" created="Thu, 29 Jan 2009 10:04:36 +0000"  >&lt;p&gt;I tracked down the email thread. I now understand the issue much better. My previous question makes no sense now and I retract it.&lt;/p&gt;</comment>
                            <comment id="14466400" author="trashhalo" created="Thu, 29 Jan 2009 10:11:23 +0000"  >&lt;p&gt;This almost seems like a flaw in Binding interface. I originally filed this bug because I was writing a BindingDelegate that needed to inspect a binding to see if it knew how to handle a request for a variable name, if it did not would ask the alternative binding. Unfortunately, the only method available for such a request is getVariables() which return a hashmap. This means at the time of request all keys AND values must be known. If there was an alternative method getVariableNames it would alow both the lazy initialization this fix requires and the binding inspection that came from the initial request.&lt;/p&gt;

&lt;p&gt;Though changing an interface like Binding is probably more pain than its worth.&lt;/p&gt;</comment>
                            <comment id="14466506" author="blackdrag" created="Thu, 5 Feb 2009 18:54:12 +0000"  >&lt;p&gt;Groovy3187Wrapper.patch tries to solve the issue by wrapping the output stream and the writer into a wrapper that allows out, sout and html to be get at the same time, with actually performing HttpResponse.getWriter() or HttpResponse.getOutputStream until the point the writer/stream is actually needed. If one of these methods is called calling the other one will cause a IllegalStateException. The exception happens only if a write, close, flash, format or checkError method is called. Simply getting sout and out itself will not cause any exception&lt;/p&gt;</comment>
                            <comment id="14466422" author="guillaume" created="Fri, 6 Feb 2009 03:26:22 +0000"  >&lt;p&gt;Looking at the patch, why are there imports changes in MarkupBuilder?&lt;br/&gt;
Also the error message &quot;The variables &apos;out&apos; or &apos;html&apos; has been used already. Use either out/html or sout, not both.&quot;: either remove the s at variables or change has to have.&lt;br/&gt;
Otherwise the wrapping approach looks okay to me, although I haven&apos;t tested the patch with a Groovlet yet.&lt;/p&gt;</comment>
                            <comment id="14478447" author="paulk" created="Fri, 6 Feb 2009 07:28:34 +0000"  >&lt;p&gt;Looks good, though I haven&apos;t tested it yet. One other typo: &apos;invlid&apos; -&amp;gt; &apos;invalid&apos; in InvalidOutputStream.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12721354" name="Clean_ServletBinding.java.patch" size="4723" author="trashhalo" created="Mon, 8 Dec 2008 14:14:16 +0000"/>
                            <attachment id="12721923" name="Groovy3187Wrapper.patch" size="6466" author="blackdrag" created="Thu, 5 Feb 2009 18:54:12 +0000"/>
                            <attachment id="12721909" name="ServletBinding.java.patch" size="2235" author="trashhalo" created="Mon, 8 Dec 2008 13:54:25 +0000"/>
                            <attachment id="12721717" name="ServletBindingTest.groovy.patch" size="1084" author="trashhalo" created="Mon, 8 Dec 2008 13:54:25 +0000"/>
                            <attachment id="12721358" name="servlet3187_fix.patch" size="2560" author="paulk_asert" created="Wed, 28 Jan 2009 22:52:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 42 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c7mv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>