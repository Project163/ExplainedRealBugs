<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:56:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-8380] Regression in 2.4.13-SNAPSHOT: x &amp; y, x | y, x ^ y lose typing information</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-8380</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;This used to work up to 2.4.12:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@groovy.transform.CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;bla {
   &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
      println &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;( 5 / 3 )
   }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;starting with 2.4.13, it gives this error message:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;bla.groovy: 4: [Static type checking] - Cannot find matching method java.lang.Long#&amp;lt;init&amp;gt;(java.math.BigDecimal). Please check if the declared type is right and if the method exists.
 @ line 4, column 15.
         println new Long( 5 / 3 )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment>any</environment>
        <key id="13118261">GROOVY-8380</key>
            <summary>Regression in 2.4.13-SNAPSHOT: x &amp; y, x | y, x ^ y lose typing information</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="patric42">Patric Bechtel</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Nov 2017 14:31:34 +0000</created>
                <updated>Fri, 3 Nov 2023 16:16:06 +0000</updated>
                            <resolved>Fri, 17 Nov 2017 13:08:48 +0000</resolved>
                                    <version>2.4.13</version>
                                    <fixVersion>2.4.13</fixVersion>
                                    <component>Static compilation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16251490" author="patric42" created="Tue, 14 Nov 2017 14:56:12 +0000"  >&lt;p&gt;The reason seems to be the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8325&quot; title=&quot;@CompileStatic calls wrong newInstance method.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8325&quot;&gt;&lt;del&gt;GROOVY-8325&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16252522" author="paulk" created="Tue, 14 Nov 2017 22:02:21 +0000"  >&lt;p&gt;It&apos;s not clear to me if this is a bug though perhaps the fix in &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8325&quot; title=&quot;@CompileStatic calls wrong newInstance method.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8325&quot;&gt;&lt;del&gt;GROOVY-8325&lt;/del&gt;&lt;/a&gt; could have been done in 2.5+. From looking at the changed code, it was always the intention to fail the match due to loss of precision but a missing &lt;tt&gt;redirect()&lt;/tt&gt; meant that it was incorrectly passed for quite some time.&lt;/p&gt;

&lt;p&gt;Dynamic Groovy does not match that constructor in 2.4.12 due to possible loss of precision (and I tried numerous versions back to 1.8.9 with the same result):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;groovy.lang.GroovyRuntimeException:
Could not find matching constructor for: java.lang.Long(java.math.BigDecimal)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Perhaps we need an error message indicating possible loss of precision as the cause.&lt;/p&gt;

&lt;p&gt;Static Groovy also rejects: &lt;tt&gt;Long foo = 5 / 3&lt;/tt&gt; but dynamic Groovy accepts this.&lt;/p&gt;

&lt;p&gt;Anyway, let&apos;s see what others think.&lt;/p&gt;</comment>
                            <comment id="16252621" author="patric42" created="Tue, 14 Nov 2017 22:46:42 +0000"  >&lt;p&gt;How about &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;( 3 &amp;amp; (-1 ^ 3) )&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;?&lt;/p&gt;
</comment>
                            <comment id="16252686" author="paulk" created="Tue, 14 Nov 2017 23:32:28 +0000"  >&lt;p&gt;That does look wrong but unrelated. It matches what this gives:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; x = -1 &amp;amp; 3
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but these are okay:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; x = 1 &amp;amp; 3
&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;(6 &amp;amp; 3)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and this is okay:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; a = -1
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; b = 3
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; c = a &amp;amp; b
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It seems that we match on &lt;tt&gt;NumberMathModificationInfo#or&lt;/tt&gt; for primitives but fall back to the &lt;tt&gt;Number&lt;/tt&gt; variant for wrapper types. And for whatever reason, constant 3 is given type &lt;tt&gt;int&lt;/tt&gt; but constant -1 is given type &lt;tt&gt;Integer&lt;/tt&gt;. We don&apos;t do that for other operators like + and *, so there is room for improvement there.&lt;/p&gt;</comment>
                            <comment id="16252863" author="blackdrag" created="Wed, 15 Nov 2017 02:47:04 +0000"  >&lt;p&gt;Please bear in mind, that an assignment in dynamic Groovy is no substitute for a method parameter. In Groovy the assignment involves an implicit cast, that is not the case for a method call. So it is always legal to assign a number typed value to a variable with another number type, even if that means a loss of precision. As for what types are compatible with a Long/long typed parameter you should take a look at LongCachedClass#isAssignableFrom.You will see there, that Double, Float and BigDecimal are no candidates. And if you then look at DoubleCachedClass and FloatCachedClass, you will that loss of precision is really no factor here. In fact if you look at IntegerCachedClass you will see that it is perfectly legal to pass an BigInteger or Long for an int parameter.&lt;/p&gt;

&lt;p&gt;What we did not do in dynamic Groovy is allow floating points typed arguments for integer types parameters. Why that is... frankly I have no idea.That goes back to March 2008 at least. But I don&#180;t think that was a change, since even groovy-beta-9 fails to call a method with a long parameter using a BigDecimal argument.&lt;/p&gt;

&lt;p&gt;Static Groovy has the &quot;no loss of precision&quot; rule, thus here it should be even more clear what is required.&lt;/p&gt;</comment>
                            <comment id="16253005" author="paulk" created="Wed, 15 Nov 2017 06:13:51 +0000"  >&lt;p&gt;Right, that&apos;s correct. Please ignore the assignment example difference between static/dynamic above as dynamic Groovy has extra coercion going on of course. So, to summarise, here is what used to happen:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; wl = 1L
&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; pl = 1L
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;(wl &amp;amp; wl) &amp;gt; 0  &lt;span class=&quot;code-comment&quot;&gt;// GRE when dynamic, STC incorrectly passes
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;(wl &amp;amp; wl) &amp;gt; 0     &lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;(pl &amp;amp; pl) &amp;gt; 0  &lt;span class=&quot;code-comment&quot;&gt;// GRE when dynamic, STC detects
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;(pl &amp;amp; pl) &amp;gt; 0     &lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;(6 &amp;amp; 3) == 2L     &lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;(-2 &amp;amp; 3) == 2L    &lt;span class=&quot;code-comment&quot;&gt;//&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here is what happens now:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; wl = 1L
&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; pl = 1L
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;(wl &amp;amp; wl) &amp;gt; 0  &lt;span class=&quot;code-comment&quot;&gt;// GRE, STC detects
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;(wl &amp;amp; wl) &amp;gt; 0     &lt;span class=&quot;code-comment&quot;&gt;// STC incorrectly fails
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;(pl &amp;amp; pl) &amp;gt; 0  &lt;span class=&quot;code-comment&quot;&gt;// GRE, STC detects
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;(pl &amp;amp; pl) &amp;gt; 0     &lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;(6 &amp;amp; 3) == 2L     &lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;(-2 &amp;amp; 3) == 2L    &lt;span class=&quot;code-comment&quot;&gt;// STC incorrectly fails&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Fixing the &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8325&quot; title=&quot;@CompileStatic calls wrong newInstance method.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8325&quot;&gt;&lt;del&gt;GROOVY-8325&lt;/del&gt;&lt;/a&gt; bug has revealed another.&lt;/p&gt;

&lt;p&gt;The type for x &amp;amp; y is being correctly determined for primitives (&lt;tt&gt;WideningCategories.isIntCategory&lt;/tt&gt;) but fails for wrappers. 6 is given type int, -2 is given type Integer, so it also fails.&lt;/p&gt;</comment>
                            <comment id="16253522" author="blackdrag" created="Wed, 15 Nov 2017 14:30:11 +0000"  >&lt;p&gt;The GRE for new Integer(wl &amp;amp; wl) is a bit strange to be frank. Looking at &lt;a href=&quot;https://github.com/codehaus/groovy-git/blob/master/src/main/org/codehaus/groovy/reflection/stdclasses/IntegerCachedClass.java#L51&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/codehaus/groovy-git/blob/master/src/main/org/codehaus/groovy/reflection/stdclasses/IntegerCachedClass.java#L51&lt;/a&gt; I see BigInteger but not Long and long.... so while this explains the GRE I feel like something is wrong here. How can a BigInteger be ok, but a Long not? This means I can do &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#8203;def foo(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i) {1}
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; foo(&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;.MAX_VALUE as BigInteger)&#8203; == 1&#8203;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; But I cannot do &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#8203;def foo(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i) {1}
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; foo(1L)&#8203; == 1&#8203;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Anyway... this is probably another issue and not subject of this here. Here it is all about the remaining STC failure &lt;/p&gt;</comment>
                            <comment id="16256932" author="paulk" created="Fri, 17 Nov 2017 12:53:48 +0000"  >&lt;p&gt;Yes, that was unclear for me too. My guess is that the BigInteger in IntegerCachedClass is a mistake since it isn&apos;t included in LongCachedClass.&lt;/p&gt;</comment>
                            <comment id="16256944" author="paulk" created="Fri, 17 Nov 2017 13:08:48 +0000"  >&lt;p&gt;I have fixed the issue with &amp;amp;, | and ^ and I&apos;ll close this issue as fixing those. If you wish to comment further about &lt;tt&gt;new Long(5 / 3)&lt;/tt&gt;, then please create another issue but that isn&apos;t meant to be supported.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13142169">GROOVY-8488</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mrgf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>