<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:47:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-7656] Spread safe method calls on list literals result in the list expression being evaluated twice (SC)</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-7656</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;When a list literal is the receiver for a statically compiled spread safe method call expression, the instructions to create the list are included twice. Example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@groovy.transform.CompileStatic
void test() {
    [&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;]*.size()
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The bytecode for the method above is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; L0
    LINENUMBER 3 L0
    NEW java/util/ArrayList
    DUP
    INVOKESPECIAL java/util/ArrayList.&amp;lt;init&amp;gt; ()V
    ASTORE 1
   L1
    ALOAD 1
    POP
    ICONST_1
    ANEWARRAY java/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;
    DUP
    ICONST_0
    LDC &lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;
    AASTORE
    INVOKESTATIC org/codehaus/groovy/runtime/ScriptBytecodeAdapter.createList ([Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;;)Ljava/util/List;
    IFNULL L2
    ACONST_NULL
    ASTORE 2
   L3
    ICONST_1
    ANEWARRAY java/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;
    DUP
    ICONST_0
    LDC &lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;
    AASTORE
    INVOKESTATIC org/codehaus/groovy/runtime/ScriptBytecodeAdapter.createList ([Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;;)Ljava/util/List;
    INVOKEINTERFACE java/util/List.iterator ()Ljava/util/Iterator;
    ASTORE 3
   L4
    ALOAD 3
    INVOKEINTERFACE java/util/Iterator.hasNext ()Z
    IFEQ L2
    ALOAD 3
    INVOKEINTERFACE java/util/Iterator.next ()Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;;
    ASTORE 2
    ALOAD 1
    ALOAD 2
    DUP
    ASTORE 4
    IFNULL L5
    ALOAD 4
    INVOKESTATIC org/codehaus/groovy/runtime/typehandling/ShortTypeHandling.castToString (Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;;)Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;;
    CHECKCAST java/lang/&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;
    INVOKESTATIC org/codehaus/groovy/runtime/StringGroovyMethods.size (Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;;)I
    INVOKESTATIC java/lang/&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.valueOf (I)Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;;
    GOTO L6
   L5
    ACONST_NULL
   L6
    INVOKEVIRTUAL java/util/ArrayList.add (Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;;)Z
    POP
    GOTO L4
   L2
    ALOAD 1
    POP
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the list expression contains method calls that have side effects, this can cause serious problems. The example below is trivial, but shows the general case:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@groovy.transform.CompileStatic
void test() {
    def list = [&lt;span class=&quot;code-quote&quot;&gt;&apos;abc&apos;&lt;/span&gt;]
    def lengths = [list.removeAt(0)]*.length() &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IndexOutOfBoundsException
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12909701">GROOVY-7656</key>
            <summary>Spread safe method calls on list literals result in the list expression being evaluated twice (SC)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shils">Shil Sinha</assignee>
                                    <reporter username="shils">Shil Sinha</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 Nov 2015 15:48:32 +0000</created>
                <updated>Mon, 22 Feb 2016 20:48:30 +0000</updated>
                            <resolved>Sun, 15 Nov 2015 08:18:07 +0000</resolved>
                                    <version>2.4.5</version>
                                    <fixVersion>2.4.6</fixVersion>
                                    <component>Static compilation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14985636" author="shils" created="Mon, 2 Nov 2015 17:56:31 +0000"  >&lt;p&gt;This appears to happen because the list expression is visited twice by the ACG - once as a receiver of the spread safe method call, and once as a receiver of the iterator of the resulting for loop.&lt;/p&gt;

&lt;p&gt;A potential fix: &lt;a href=&quot;https://github.com/apache/incubator-groovy/compare/master...shils:GROOVY-7656&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-groovy/compare/master...shils:GROOVY-7656&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14985999" author="blackdrag" created="Mon, 2 Nov 2015 20:47:51 +0000"  >&lt;p&gt;your solution idea has two potential problems: &lt;br/&gt;
(1) you declare a variable, which might be already declared. There is no check for this at this point, but imagine what happens should this be used inside the expression you are spreading&lt;br/&gt;
(2) your temporary variable will show up as declared variable during debugging, potentially confusing people&lt;/p&gt;

&lt;p&gt;Looking at the code you basically do what Cedric did, only that Cedric did that part wrong already. Maybe he had a good reason for using this, don&apos;t know. Normally I use defineTemporaryVariable from the compile stack for this (controller.getCompileStack()). But since you need it as node, and not just as a slot number later on I suggest you use then my ExpressionAsVariableSlot or Cedrics TemporaryVariableExpression (which he added after he wrote this part of the code, which is why it is not used there). Beware, you will need to &quot;remove&quot; the temporary variable after use. Either by using the compile stack, or if you use TemporaryVariableExpression, the remove method on the expression.&lt;/p&gt;</comment>
                            <comment id="14986420" author="shils" created="Tue, 3 Nov 2015 01:05:33 +0000"  >&lt;p&gt;Thanks for taking a look. I was aware of (1), but didn&apos;t know the right way to handle it so I indeed did follow Cedric&apos;s approach with &quot;spreadresult&quot;. I&apos;ll address those issues and create a pr when I think it&apos;s ok (unless someone&apos;s already taken care of it).&lt;/p&gt;</comment>
                            <comment id="14989863" author="githubbot" created="Wed, 4 Nov 2015 16:40:29 +0000"  >&lt;p&gt;GitHub user shils opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-groovy/pull/179&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-groovy/pull/179&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7656&quot; title=&quot;Spread safe method calls on list literals result in the list expression being evaluated twice (SC)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7656&quot;&gt;&lt;del&gt;GROOVY-7656&lt;/del&gt;&lt;/a&gt; Statically compiled spread safe method calls on list lite&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;rals result in the list expression being evaluated twice&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/shils/incubator-groovy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/shils/incubator-groovy&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7656&quot; title=&quot;Spread safe method calls on list literals result in the list expression being evaluated twice (SC)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7656&quot;&gt;&lt;del&gt;GROOVY-7656&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-groovy/pull/179.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-groovy/pull/179.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #179&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 3cc4785c80f462b5d9d712bc67cbea0800d6f04d&lt;br/&gt;
Author: Shil Sinha &amp;lt;shil.sinha@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-11-02T18:54:25Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7656&quot; title=&quot;Spread safe method calls on list literals result in the list expression being evaluated twice (SC)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7656&quot;&gt;&lt;del&gt;GROOVY-7656&lt;/del&gt;&lt;/a&gt; Statically compiled spread safe method calls on list literals result in the list expression being evaluated twice&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15005740" author="shils" created="Sun, 15 Nov 2015 05:29:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blackdrag&quot; class=&quot;user-hover&quot; rel=&quot;blackdrag&quot;&gt;blackdrag&lt;/a&gt; Does the updated fix look ok to you?&lt;/p&gt;</comment>
                            <comment id="15005779" author="blackdrag" created="Sun, 15 Nov 2015 07:35:08 +0000"  >&lt;p&gt;yes&lt;/p&gt;</comment>
                            <comment id="15005795" author="githubbot" created="Sun, 15 Nov 2015 08:15:52 +0000"  >&lt;p&gt;Github user shils closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/incubator-groovy/pull/179&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-groovy/pull/179&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15005798" author="shils" created="Sun, 15 Nov 2015 08:18:07 +0000"  >&lt;p&gt;Merged&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 1 week, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ntsv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>