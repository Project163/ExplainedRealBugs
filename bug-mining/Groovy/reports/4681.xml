<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:22:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-11076] @ClosureParams for StringGroovyMethods.replaceFirst and StringGroovyMethods.replaceAll wrong</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-11076</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The &lt;tt&gt;@ClosureParams&lt;/tt&gt; for &lt;tt&gt;StringGroovyMethods.replaceFirst&lt;/tt&gt; and &lt;tt&gt;StringGroovyMethods.replaceAll&lt;/tt&gt; seems to be wrong. It says &lt;tt&gt;&#8203;&amp;#123;&quot;List&amp;lt;String&amp;gt;&quot;, &quot;String[]&quot;&amp;#125;&#8203;&lt;/tt&gt;, so without static compilation IntelliJ shows a warning and with static compilation an error for the &lt;tt&gt;String it&lt;/tt&gt; parts of&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; pascalCasedWorkflowName = workflowName
    .replaceAll(/-\w/) { &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; it -&amp;gt; it[1].toUpperCase() }
    .replaceFirst(/^\w/) { &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; it -&amp;gt; it[0].toUpperCase() }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;while it compiles and works perfectly fine. I&apos;d guess it should be &lt;tt&gt;&#8203;&amp;#123;&quot;String&quot;, &quot;List&amp;lt;String&amp;gt;&quot;, &quot;String[]&quot;&amp;#125;&#8203;&lt;/tt&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13538550">GROOVY-11076</key>
            <summary>@ClosureParams for StringGroovyMethods.replaceFirst and StringGroovyMethods.replaceAll wrong</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="vampire">Bj&#246;rn Kautler</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Jun 2023 09:07:26 +0000</created>
                <updated>Wed, 23 Aug 2023 09:05:49 +0000</updated>
                            <resolved>Fri, 9 Jun 2023 18:12:28 +0000</resolved>
                                    <version>3.0.17</version>
                                    <fixVersion>3.0.18</fixVersion>
                    <fixVersion>4.0.13</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17728670" author="emilles" created="Fri, 2 Jun 2023 10:12:38 +0000"  >&lt;p&gt;When a closure is called with an array or iterable, the elements can be spread over the params. I think that is what&#8217;s happening in your case. &lt;/p&gt;</comment>
                            <comment id="17728728" author="vampire" created="Fri, 2 Jun 2023 12:42:26 +0000"  >&lt;p&gt;Ah, right, so it is an IntelliJ bug instead, that it does not recognize the spreading, right? Sorry.&lt;/p&gt;</comment>
                            <comment id="17728732" author="vampire" created="Fri, 2 Jun 2023 12:48:18 +0000"  >&lt;p&gt;Reported as &lt;a href=&quot;https://youtrack.jetbrains.com/issue/IDEA-321626&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://youtrack.jetbrains.com/issue/IDEA-321626&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17728825" author="emilles" created="Fri, 2 Jun 2023 16:46:28 +0000"  >&lt;p&gt;&lt;tt&gt;replaceAll&lt;/tt&gt; and &lt;tt&gt;replaceFirst&lt;/tt&gt; delegate to this method: &lt;a href=&quot;https://github.com/apache/groovy/blob/1d9f35a448a2a731499534841ffe64150e80744c/src/main/java/org/codehaus/groovy/runtime/StringGroovyMethods.java#L1521&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/blob/1d9f35a448a2a731499534841ffe64150e80744c/src/main/java/org/codehaus/groovy/runtime/StringGroovyMethods.java#L1521&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It calls the supplied closure with a String (if no capturing group) or a list of String or an Object[] (if your closure signature matches).  So, as you assert, the &lt;tt&gt;ClosureParams&lt;/tt&gt; metadata could be improved.  I don&apos;t know the history of when the metadata was added &amp;#8211; it may not be easy to sort out which of 3 options applies.&lt;/p&gt;

&lt;p&gt;You can give it a try by creating a simple test wrapper.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; replaceAll(CharSequence sequence, Pattern pattern, @ClosureParams(value=FromString.class, options={&lt;span class=&quot;code-quote&quot;&gt;&quot;List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[]&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&quot;&lt;/span&gt;}) Closure closure) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; StringGroovyMethods.replaceAll(sequence, pattern, closure);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You have to call it like &quot;replaceAll(&apos;...&apos;, ~/.../, { -&amp;gt; ... })&quot; not like an extension.&lt;/p&gt;</comment>
                            <comment id="17728886" author="vampire" created="Fri, 2 Jun 2023 23:38:41 +0000"  >&lt;p&gt;I&apos;m sure I just do something wrongly, but it seems to ignore the annotation and just accept all.&lt;br/&gt;
But anyway even if the one-String variant is explicitly used, the spreading would still be done wouldn&apos;t it?&lt;br/&gt;
So it is either way an IntelliJ bug and would cover both cases if fixed.&lt;/p&gt;</comment>
                            <comment id="17728890" author="emilles" created="Sat, 3 Jun 2023 00:18:56 +0000"  >&lt;p&gt;The behavior of the implementation depends on the inputs, so it is not possible to type-check all possibilities. If your pattern lacks a capture group, then one String is how the closure is called. The String[] option may cover this in how the runtime executes the closure, or it may not. I&#8217;ll need to try a couple things to be sure. &lt;/p&gt;</comment>
                            <comment id="17728956" author="paulk" created="Sat, 3 Jun 2023 11:02:36 +0000"  >&lt;p&gt;&quot;String[]&quot; should act like varargs, at least it used to, so &quot;String&quot; should be covered.&lt;br/&gt;
The &quot;Object[]&quot; is mainly to handle the dynamic default multiple args case with something like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
replaceAll(/-(\w)/) { all, w -&amp;gt; w.toUpperCase() }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We should probably just check for String[] as well as Object[] in getReplacement.&lt;/p&gt;</comment>
                            <comment id="17731053" author="emilles" created="Fri, 9 Jun 2023 18:11:45 +0000"  >&lt;p&gt;I managed to find how the runtime does this.  In &lt;tt&gt;ClosureMetaClass#invokeMethod&lt;/tt&gt; there is a fallback if the arguments cannot be matched to a &lt;tt&gt;doCall&lt;/tt&gt; signature.  If there is one list argument, the runtime gets the length and tries that.  I am fixing STC to account for this and to stop thinking that arrays have this behavior.  See &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-11089&quot; title=&quot;STC: closure param type inference for array and list&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-11089&quot;&gt;&lt;del&gt;GROOVY-11089&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So the examples will type-check and execute:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
workflowName.replaceAll(/-\w/) { &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s -&amp;gt; s[1].toUpperCase() }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/68e16ff561a75ac84c465c127221a46108a84419&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/68e16ff561a75ac84c465c127221a46108a84419&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13539336">GROOVY-11089</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 22 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ialk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>