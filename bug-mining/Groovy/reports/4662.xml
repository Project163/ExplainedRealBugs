<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:22:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-11056] modified behavior of variable resolution within Closure </title>
                <link>https://issues.apache.org/jira/browse/GROOVY-11056</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Groovy stopped seeing statically imported instances when called within Closure within Closure. And instead it thinks it is some method call.&lt;/p&gt;

&lt;p&gt;Below is the example to repro. At the moment it affects all our users written test scripts and we rolled back to 3.0.15 where behavior is still as expected.&lt;/p&gt;

&lt;p&gt;Tried various closure resolution strategies to no result&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.testingisdocumenting.webtau.persona.ReproPersonaList.Admin

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ClosureResolveRepro {
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
        def LocalAdmin = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ReproPersona(&lt;span class=&quot;code-quote&quot;&gt;&quot;local-admin&quot;&lt;/span&gt;)

        wrapper {
            LocalAdmin { &lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;-- no issue here as it can correctly see LocalAdmin
&lt;/span&gt;            }
        }

        wrapper {
            Admin { &lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;--- issue is here, &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; some reason it doesn&apos;t see statically imported instance. It works as expected in 3.0.15
&lt;/span&gt;            }
        }
    }

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void wrapper(Closure code) { &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; wrapper is required to reproduce 
&lt;/span&gt;        code.run()
    }
}
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
person: local-adminException in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; groovy.lang.MissingMethodException: No signature of method: org.testingisdocumenting.webtau.persona.ClosureResolveRepro$_main_closure2.Admin() is applicable &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; argument types: (org.testingisdocumenting.webtau.persona.ClosureResolveRepro$_main_closure2$_closure4) values: [org.testingisdocumenting.webtau.persona.ClosureResolveRepro$_main_closure2$_closure4@40f08448]Possible solutions: find(), dump(), find(), dump(), any(), any() at org.codehaus.groovy.runtime.metaclass.ClosureMetaClass.invokeMethod(ClosureMetaClass.java:380) at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1035) at org.codehaus.groovy.runtime.callsite.PogoMetaClassSite.callCurrent(PogoMetaClassSite.java:73) at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCallCurrent(CallSiteArray.java:51) at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callCurrent(AbstractCallSite.java:171) at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callCurrent(AbstractCallSite.java:185) at org.testingisdocumenting.webtau.persona.ClosureResolveRepro$_main_closure2.doCall(ClosureResolveRepro.groovy:31) at org.testingisdocumenting.webtau.persona.ClosureResolveRepro$_main_closure2.doCall(ClosureResolveRepro.groovy) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:107) at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:323) at org.codehaus.groovy.runtime.metaclass.ClosureMetaClass.invokeMethod(ClosureMetaClass.java:274) at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1035) at groovy.lang.Closure.call(Closure.java:412) at groovy.lang.Closure.call(Closure.java:406) at groovy.lang.Closure.run(Closure.java:493) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:107) at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:323) at org.codehaus.groovy.runtime.metaclass.ClosureMetaClass.invokeMethod(ClosureMetaClass.java:274) at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1035) at org.codehaus.groovy.runtime.callsite.PogoMetaClassSite.call(PogoMetaClassSite.java:38) at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCall(CallSiteArray.java:47) at org.codehaus.groovy.runtime.callsite.PogoMetaClassSite.call(PogoMetaClassSite.java:53) at org.codehaus.groovy.runtime.callsite.AbstractCallSite.call(AbstractCallSite.java:130) at org.testingisdocumenting.webtau.persona.ClosureResolveRepro.wrapper(ClosureResolveRepro.groovy:37) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:107) at org.codehaus.groovy.runtime.callsite.StaticMetaMethodSite$StaticMetaMethodSiteNoUnwrapNoCoerce.invoke(StaticMetaMethodSite.java:149) at org.codehaus.groovy.runtime.callsite.StaticMetaMethodSite.callStatic(StaticMetaMethodSite.java:100) at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCallStatic(CallSiteArray.java:55) at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callStatic(AbstractCallSite.java:217) at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callStatic(AbstractCallSite.java:231) at org.testingisdocumenting.webtau.persona.ClosureResolveRepro.main(ClosureResolveRepro.groovy:30)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ReproPersona {
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; id

    ReproPersona(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; id) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.id = id
    }

    void call(Closure code) {
        println &lt;span class=&quot;code-quote&quot;&gt;&quot;person: $id&quot;&lt;/span&gt;
    }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ReproPersonaList {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; def Admin = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ReproPersona(&lt;span class=&quot;code-quote&quot;&gt;&quot;admin&quot;&lt;/span&gt;)
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13536153">GROOVY-11056</key>
            <summary>modified behavior of variable resolution within Closure </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="ninside">Mykola Golubyev</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 May 2023 02:55:42 +0000</created>
                <updated>Wed, 23 Aug 2023 09:05:49 +0000</updated>
                            <resolved>Tue, 16 May 2023 15:43:24 +0000</resolved>
                                    <version>4.0.0</version>
                    <version>2.5.22</version>
                    <version>3.0.16</version>
                                    <fixVersion>2.5.23</fixVersion>
                    <fixVersion>3.0.18</fixVersion>
                    <fixVersion>4.0.13</fixVersion>
                                    <component>groovy-runtime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17722900" author="emilles" created="Mon, 15 May 2023 18:44:21 +0000"  >&lt;p&gt;Thanks for the issue.  It works when &quot;Admin&quot; is declared as a method that accepts closure.  We must have missed something for the static field case.&lt;/p&gt;</comment>
                            <comment id="17722905" author="emilles" created="Mon, 15 May 2023 18:56:55 +0000"  >&lt;p&gt;Here is where &lt;tt&gt;StaticImportVisitor&lt;/tt&gt; finds the static field import, but chooses to skip:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name = method.getText();
        Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, ImportNode&amp;gt; staticImports = currentClass.getModule().getStaticImports();
        &lt;span class=&quot;code-comment&quot;&gt;// look &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; one of these:
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//   &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; MyClass.field [as alias]
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//   &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; MyClass.method [as alias]
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//   &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; MyClass.property [as alias]
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// when resolving implicit-&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; call name(args)
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (staticImports.containsKey(name)) {
            ImportNode importNode = staticImports.get(name);
            expression = findStaticMethod(importNode.getType(), importNode.getFieldName(), args);
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (expression != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; expression;
            }
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!inClosure &amp;amp;&amp;amp; !inLeftExpression) { &lt;span class=&quot;code-comment&quot;&gt;// *** inClosure is &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;Admin&quot;&lt;/span&gt; ***
&lt;/span&gt;                expression = findStaticPropertyOrField(importNode.getType(), importNode.getFieldName());
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (expression != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) { &lt;span class=&quot;code-comment&quot;&gt;// assume name refers to a callable &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; field/property
&lt;/span&gt;                    MethodCallExpression call = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MethodCallExpression(expression, &lt;span class=&quot;code-quote&quot;&gt;&quot;call&quot;&lt;/span&gt;, args);
                    call.setImplicitThis(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
                    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; call;
                }
            }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/blame/c793a80e9160ca31a225948f256b3de953e6e1da/src/main/java/org/codehaus/groovy/control/StaticImportVisitor.java#L450&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/blame/c793a80e9160ca31a225948f256b3de953e6e1da/src/main/java/org/codehaus/groovy/control/StaticImportVisitor.java#L450&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17722936" author="emilles" created="Mon, 15 May 2023 21:53:11 +0000"  >&lt;p&gt;If you need this to work with Groovy 3.0.16, you can replace &quot;Admin&quot; with &quot;Admin.call&quot; or you could declare &quot;def GlobalAdmin = Admin, LocalAdmin = new ReproPersona(&apos;local-admin&apos;)&quot;.&lt;/p&gt;</comment>
                            <comment id="17722946" author="ninside" created="Mon, 15 May 2023 23:42:42 +0000"  >&lt;p&gt;It is a good suggestion. Unfortunately it is users scripts that are failing and I don&#8217;t have access to. So I temporarily rolled back version bump. My end goal is to move to groovy 4.&#160;&lt;/p&gt;</comment>
                            <comment id="17723134" author="emilles" created="Tue, 16 May 2023 13:23:17 +0000"  >&lt;p&gt;I ran some tests yesterday and the &quot;!inClosure&quot; checks are not tied to any test cases.  I think the intent was to let a closure&apos;s resolve strategy handle name resolution.  For example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; static p.T.name
one {
  two {
    name()
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Depending on the resolution strategies of the &quot;one&quot; and &quot;two&quot; methods, &quot;name&quot; might be coming from a delegate object.  &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8389&quot; title=&quot;Static import of a property messes with instance method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8389&quot;&gt;&lt;del&gt;GROOVY-8389&lt;/del&gt;&lt;/a&gt; is where the check first came up.  That issue does not specifically indicate &quot;within closure&quot; so I think it was just a precaution on the part of the implementer.&lt;/p&gt;

&lt;p&gt;I have one more bug ticket to track down (and link) that discusses the precedence between static field and closure delegate.&lt;/p&gt;</comment>
                            <comment id="17723142" author="emilles" created="Tue, 16 May 2023 14:00:38 +0000"  >&lt;p&gt;The prevailing wind seems to be let closures take first crack at name resolution.  However, in this case, if &quot;name()&quot; (from my example) or &quot;Admin {&quot; (from yours) is not transformed into &quot;.call(..)&quot; form by &lt;tt&gt;StaticImportVisitor&lt;/tt&gt;, there is no path to resolving at runtime to the imported member.  I think SC/STC depends on the transformation as well.&lt;/p&gt;</comment>
                            <comment id="17723172" author="emilles" created="Tue, 16 May 2023 15:43:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/7a118010591ca469f0394d8d6946b44201d04ebd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/7a118010591ca469f0394d8d6946b44201d04ebd&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13408309">GROOVY-10329</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12814934">GROOVY-3945</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12842470">GROOVY-7490</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12917914">GROOVY-7701</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13120673">GROOVY-8389</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13319118">GROOVY-9655</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13321961">GROOVY-9683</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13330469">GROOVY-9768</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1hvv4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>