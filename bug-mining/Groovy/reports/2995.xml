<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:48:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-7705] CompileStatic closure accessing &quot;thisObject&quot; private field: setProperty instead of synthetic method</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-7705</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;When a closure sets the private field of a class, it does it via a ScriptBytecodeAdapter.setGroovyObjectProperty on the closure object itself, whereas when getting a private field of the class it uses a synthetic &quot;pfaccess$0&quot; method.&lt;/p&gt;

&lt;p&gt;Source:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Source&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SetFromClosure {
	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; x

	void doIt() {
		def closure = {
			x = 5
			println x
		}
		closure()
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Decompiled result of closure class (via Fernflower in IntelliJ):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SetFromClosure$_doIt_closure1 &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Closure &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; GeneratedClosure {
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; SetFromClosure$_doIt_closure1(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; _outerInstance, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; _thisObject) {
    &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;(_outerInstance, _thisObject);
  }

  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; doCall(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; it) {
    &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; var2 = 5;
    ScriptBytecodeAdapter.setGroovyObjectProperty(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.valueOf(var2), SetFromClosure$_doIt_closure1.class, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)&lt;span class=&quot;code-quote&quot;&gt;&quot;x&quot;&lt;/span&gt;);
    DefaultGroovyMethods.println((SetFromClosure)&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getThisObject(), &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.valueOf(SetFromClosure.pfaccess$0((SetFromClosure)&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getThisObject())));
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
  }

  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; call(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; args) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.doCall(args);
  }

  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; call() {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.doCall((&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
  }

  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; doCall() {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.doCall((&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Workaround is to remove &quot;private&quot; keyword on the variable declaration, which causes Groovy to generate public getter and setter. In that mode, the static compiler does generate direct calls to both the getter and the setter. In one example within my project the performance speedup was 10x with this workaround. The only thing I notice in the workaround that is odd is that instead of normal Java casts used, ScriptBytecodeAdapter.castToType is used on &quot;getThisObject&quot; before calling the getters or setters.&lt;/p&gt;

&lt;p&gt;This issue could possibly related to &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-6825&quot; title=&quot;Static compiler does not always make direct setter call inside inner class&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-6825&quot;&gt;&lt;del&gt;GROOVY-6825&lt;/del&gt;&lt;/a&gt;, but in that case it&apos;s an inner class, and the issue description (currently) is not clear enough to see if it&apos;s also generating a setProperty call.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12920090">GROOVY-7705</key>
            <summary>CompileStatic closure accessing &quot;thisObject&quot; private field: setProperty instead of synthetic method</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shils">Shil Sinha</assignee>
                                    <reporter username="gillius">Jason Winnebeck</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Dec 2015 14:11:53 +0000</created>
                <updated>Mon, 22 Feb 2016 20:48:41 +0000</updated>
                            <resolved>Thu, 14 Jan 2016 01:29:50 +0000</resolved>
                                    <version>2.4.5</version>
                                    <fixVersion>2.4.6</fixVersion>
                                    <component>Static compilation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15047085" author="shils" created="Tue, 8 Dec 2015 17:14:06 +0000"  >&lt;p&gt;The static compiler doesn&apos;t currently generate bridge methods for setting private fields, resulting in the behavior you described. The difference between this issue and &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-6825&quot; title=&quot;Static compiler does not always make direct setter call inside inner class&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-6825&quot;&gt;&lt;del&gt;GROOVY-6825&lt;/del&gt;&lt;/a&gt; is that the latter deals with the mutation of an outer class variable which is a property (with public getter/setter as you mentioned in your workaround), so bridge methods aren&apos;t necessary.&lt;/p&gt;</comment>
                            <comment id="15060975" author="shils" created="Wed, 16 Dec 2015 22:01:48 +0000"  >&lt;p&gt;Rough implementation - &lt;a href=&quot;https://github.com/apache/groovy/compare/master...shils:GROOVY-7705&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/compare/master...shils:GROOVY-7705&lt;/a&gt;. The solution assumes that private fields which are set from an inner class will also have been stored among the &apos;PV_FIELDS_ACCESS&apos; fields in the outer class&apos; node metadata. This is generally the case because currently StaticTypeCheckingVisitor#getType and StaticTypeCheckingVisitor#storeField are used to mark private access, and neither differentiates between the get/set cases.&lt;/p&gt;</comment>
                            <comment id="15064834" author="gillius" created="Fri, 18 Dec 2015 21:55:12 +0000"  >&lt;p&gt;Awesome work on this, I did look at the code although I can&apos;t comment much about it since I don&apos;t know anything about Groovy internals, but I will say that&apos;s a really cool test framework on the Groovy side that allows you to check for a specific bytecode instruction.&lt;/p&gt;</comment>
                            <comment id="15074304" author="githubbot" created="Tue, 29 Dec 2015 21:15:40 +0000"  >&lt;p&gt;GitHub user shils opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/229&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/229&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7705&quot; title=&quot;CompileStatic closure accessing &amp;quot;thisObject&amp;quot; private field: setProperty instead of synthetic method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7705&quot;&gt;&lt;del&gt;GROOVY-7705&lt;/del&gt;&lt;/a&gt;: Add bridge methods for setting private fields of outer c&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;lass from inner class or closure&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/shils/groovy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/shils/groovy&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7705&quot; title=&quot;CompileStatic closure accessing &amp;quot;thisObject&amp;quot; private field: setProperty instead of synthetic method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7705&quot;&gt;&lt;del&gt;GROOVY-7705&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/229.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/229.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #229&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit dc7ca7d2a35e5018b73f422dce1c3da29365d84e&lt;br/&gt;
Author: Shil Sinha &amp;lt;shil.sinha@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-12-10T00:23:24Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7705&quot; title=&quot;CompileStatic closure accessing &amp;quot;thisObject&amp;quot; private field: setProperty instead of synthetic method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7705&quot;&gt;&lt;del&gt;GROOVY-7705&lt;/del&gt;&lt;/a&gt;: Add bridge methods for setting private fields of outer class from inner class or closure&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15097412" author="githubbot" created="Thu, 14 Jan 2016 01:28:25 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/229&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/229&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15102356" author="gillius" created="Fri, 15 Jan 2016 19:35:33 +0000"  >&lt;p&gt;Is it possible for this fix to also go into 2.4.6?&lt;/p&gt;</comment>
                            <comment id="15135017" author="shils" created="Fri, 5 Feb 2016 21:17:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gillius&quot; class=&quot;user-hover&quot; rel=&quot;gillius&quot;&gt;gillius&lt;/a&gt; This fix will be in 2.4.6.&lt;/p&gt;</comment>
                            <comment id="15136568" author="gillius" created="Mon, 8 Feb 2016 03:10:42 +0000"  >&lt;p&gt;That&apos;s really good news, I&apos;ll try a 2.4.6 snapshot soon and see if it works for me.&lt;/p&gt;</comment>
                            <comment id="15141785" author="gillius" created="Wed, 10 Feb 2016 22:06:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shils&quot; class=&quot;user-hover&quot; rel=&quot;shils&quot;&gt;shils&lt;/a&gt;, awesome work on this, I have used 2.4.6-SNAPSHOT today from JFrog repo and confirmed via bytecode analysis through Fernflower that the fix does work to create direct accessors. For my code there is a substantial performance improvement: a performance test suite goes from 44s to 40s. Within that test suite the average page load time for the most directly affected page drops from 419ms avg to 321ms avg. Note this is with the &quot;make all fields public&quot; workaround applied for the most used classes in our framework. If I make the fields private again, the time goes from 2 seconds+ average page load times (total test suite on order of minutes) down to the 321ms, so for those who haven&apos;t applied this workaround and are impacted this could be a major win. Even for us who have applied the workaround, the patch catches the less used classes for a 10% overall, or 25% improvement for the page load times.&lt;/p&gt;

&lt;p&gt;One thing I had issue with in 2.4.6 is that static compiler gave a handful of errors I had to fix, I filed &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7753&quot; title=&quot;regression of return type from ternary operator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7753&quot;&gt;&lt;del&gt;GROOVY-7753&lt;/del&gt;&lt;/a&gt;. In other cases the static compiler assumes more specific types than it used to (for example method where I returned Map&amp;lt;String, Object&amp;gt; complains because Groovy now thinks it returns Map&amp;lt;String, Comparable&amp;gt;).&lt;/p&gt;</comment>
                            <comment id="15141814" author="shils" created="Wed, 10 Feb 2016 22:19:15 +0000"  >&lt;p&gt;Thanks! That&apos;s great to hear. I have a feeling that &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7753&quot; title=&quot;regression of return type from ternary operator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7753&quot;&gt;&lt;del&gt;GROOVY-7753&lt;/del&gt;&lt;/a&gt; is a result of the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7598&quot; title=&quot;type checking with generics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7598&quot;&gt;&lt;del&gt;GROOVY-7598&lt;/del&gt;&lt;/a&gt;.. I&apos;ll take a look. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 40 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2plp3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>