<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:25:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-4922] StackOverflowError when calling super and overriding a package protected java method</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-4922</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;For reference : &lt;a href=&quot;http://groovy.329449.n5.nabble.com/StackOverflowError-when-dispatching-to-super-td4572268.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://groovy.329449.n5.nabble.com/StackOverflowError-when-dispatching-to-super-td4572268.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If a package protected method written in a Java class is overriden in a Groovy class and that method calls super.method(), Groovy throws a stack overflow :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Parent.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Parent {
   void someMethod(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; param) { ... }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Child.groovy&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Child {
   void someMethod(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; param) { &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.someMethod(param) }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.StackOverflowError
	at java.lang.Exception.&amp;lt;init&amp;gt;(Exception.java:77)
	at java.lang.reflect.InvocationTargetException.&amp;lt;init&amp;gt;(InvocationTargetException.java:54)
	at sun.reflect.GeneratedMethodAccessor1.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:90)
	at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:233)
	at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1054)
	at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.invokeMethodOnSuperN(ScriptBytecodeAdapter.java:128)
	at groovy.bugs.GroovyStackOverflowBug$Child.someMethod(GroovyStackOverflowBug.groovy:39)
	at sun.reflect.GeneratedMethodAccessor1.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:90)
	at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:233)
	at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1054)
	at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.invokeMethodOnSuperN(ScriptBytecodeAdapter.java:128)
	at groovy.bugs.GroovyStackOverflowBug$Child.someMethod(GroovyStackOverflowBug.groovy:39)
	at sun.reflect.GeneratedMethodAccessor1.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:90)
	at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:233)
	at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1054)
	at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.invokeMethodOnSuperN(ScriptBytecodeAdapter.java:128)
	at groovy.bugs.GroovyStackOverflowBug$Child.someMethod(GroovyStackOverflowBug.groovy:39)
	at sun.reflect.GeneratedMethodAccessor1.invoke(Unknown Source)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Adding a public or protected modifier to the super class solves the problem.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12815873">GROOVY-4922</key>
            <summary>StackOverflowError when calling super and overriding a package protected java method</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="melix">C&#233;dric Champeau</assignee>
                                    <reporter username="melix">C&#233;dric Champeau</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Jul 2011 14:55:01 +0000</created>
                <updated>Sun, 13 May 2012 03:30:03 +0000</updated>
                            <resolved>Tue, 14 Feb 2012 12:28:04 +0000</resolved>
                                    <version>1.8.0</version>
                                    <fixVersion>2.0-beta-3</fixVersion>
                    <fixVersion>1.7.11</fixVersion>
                    <fixVersion>1.8.7</fixVersion>
                                        <due></due>
                            <votes>10</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14471490" author="melix" created="Wed, 13 Jul 2011 15:57:41 +0000"  >&lt;p&gt;Here is what I found. In MetaClassImpl.MethodIndexAction#methodNameAction(), &lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;If you use a protected modifier in the super class method, the &lt;em&gt;mopMethods&lt;/em&gt; list contains the &lt;em&gt;$super&lt;/em&gt; method. If the modifier is removed, the method disappears from &lt;em&gt;mopMethods&lt;/em&gt;.&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;plus, the following test fails because of the modifier test (line 460) : 
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;(useThis ^ (method.getModifiers() &amp;amp; (Modifier.PUBLIC | Modifier.PROTECTED)) == 0)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;So it seems there are two problems to solve : the fact that the super method is missing from the MOP methods and the test which forgets about package protected methods. I&apos;m not sure this can be fixed without side effects.&lt;/p&gt;</comment>
                            <comment id="14471473" author="hamletdrc" created="Mon, 18 Jul 2011 06:28:22 +0000"  >&lt;p&gt;I recommend changing the Priority to Blocker. &lt;/p&gt;</comment>
                            <comment id="14471442" author="melix" created="Mon, 18 Jul 2011 06:56:06 +0000"  >&lt;p&gt;Hamlet,&lt;/p&gt;

&lt;p&gt;Here is my test case for this bug. In the thread, you say that you have the error even with a non package protected method. Could you update the test class with an example of such a behaviour ? Thank you !&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;StackOverflowBugSupport.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; groovy.bugs;

/**
 * Support &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; GROOVY-4922 bug. Must be written in Java.
 */
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;StackOverflowBugSupport {
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; support;

    void someMethod(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value) {
        support = value;
    }
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;GroovyStackOverflowBug&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; groovy.bugs


&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;GroovyStackOverflowBug &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; GroovyTestCase {
    void testShouldNotThrowStackOverflow() {
        def child = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Child()
        child.someMethod(&lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;)
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; child.support == &lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;
    }


    &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Child &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; StackOverflowBugSupport {
        &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void someMethod(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; parameter) {
            &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.someMethod(parameter)
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ll update this ticket if I find anything relevant meanwhile.&lt;/p&gt;</comment>
                            <comment id="14471541" author="blackdrag" created="Mon, 18 Jul 2011 08:50:26 +0000"  >&lt;p&gt;Cedric be careful and keep inner classes out of this, they may have differing semantics here and there. not that its necessarily intentional, but that would be a different bug then&lt;/p&gt;</comment>
                            <comment id="14471518" author="melix" created="Mon, 18 Jul 2011 08:55:24 +0000"  >&lt;p&gt;Ok, I&apos;ll be testing both. I have a patch which solves the problem by adding package protected methods to the list of generated &lt;em&gt;super$&lt;/em&gt; methods. Doing so (and updating the modifiers test too), I can work around the stack overflow, but right now it seems to break the build (3 tests fail). I don&apos;t know if it&apos;s related to my changes or not, since I didn&apos;t do a clean build before patching, but this bug is the kind of ones which could have serious side effects.&lt;/p&gt;

&lt;p&gt;I&apos;ll tell you as I advance, I&apos;ll have 2 hours of train where I&apos;ll be able to play around &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14471527" author="blackdrag" created="Mon, 18 Jul 2011 09:01:46 +0000"  >&lt;p&gt;most probably this is the right way to solve the issue. it would be good to (a) attach the not yet complete patch here and (b) to show what 3 tests fail. Normally I wouldn&apos;t be pressing, but we intend to release tomorrow and I would like this issue here to be solved till then &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14471429" author="melix" created="Mon, 18 Jul 2011 09:07:08 +0000"  >&lt;p&gt;Here is the patch and the test case results. I won&apos;t be able to deliver a full fix until tomorrow because I won&apos;t be home, so feel free to complete.&lt;/p&gt;

&lt;p&gt;Sorry I can&apos;t give you more information, I have to take my train now &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14471474" author="melix" created="Mon, 18 Jul 2011 11:56:42 +0000"  >&lt;p&gt;The following patch (new) passes all tests on trunk. Basically, I moved my &quot;Child&quot; test class to its own file and made &quot;shouldNotCompile&quot; in GenericsTestBase protected. However, at first glance, it should have worked even without the latter modification. I would be great if Hamlet could test it.&lt;/p&gt;</comment>
                            <comment id="14471444" author="blackdrag" created="Mon, 18 Jul 2011 17:43:59 +0000"  >&lt;p&gt;I modified your test Cedric to test for private directly instead of excluding others. That did let the tests pass. So I am closing the issue for now&lt;/p&gt;</comment>
                            <comment id="14471542" author="hamletdrc" created="Tue, 19 Jul 2011 01:42:01 +0000"  >&lt;p&gt;I still have this error when using 1.8.x branch and the trunk. &lt;/p&gt;</comment>
                            <comment id="14471430" author="melix" created="Tue, 19 Jul 2011 04:32:09 +0000"  >&lt;p&gt;The fix requires that you recompile the child class. Did you do so ? If yes then it is probably a separate bug and it would help if you could update the unit test to highlight your use case.&lt;/p&gt;</comment>
                            <comment id="14471528" author="hamletdrc" created="Tue, 19 Jul 2011 05:02:28 +0000"  >&lt;p&gt;here is a patch showing that this still fails. You probably fixed it for protected methods but not for package-private methods. &lt;/p&gt;</comment>
                            <comment id="14471461" author="blackdrag" created="Tue, 19 Jul 2011 05:18:25 +0000"  >&lt;p&gt;I think I am missing information here. The test I added uses a package private method in the java super class. In the test the child class uses a protected method to overwrite this. In the patch from Hamlet it is a public method. Oh I see the test case is not ending with Test, so maybe it is not picked up.&lt;/p&gt;</comment>
                            <comment id="14471543" author="guillaume" created="Tue, 19 Jul 2011 06:42:18 +0000"  >&lt;p&gt;oops (closed wrong issue), so reopen&lt;/p&gt;</comment>
                            <comment id="14471443" author="blackdrag" created="Tue, 19 Jul 2011 07:35:51 +0000"  >&lt;p&gt;ok, seems not to be the issue.&lt;/p&gt;</comment>
                            <comment id="14471463" author="blackdrag" created="Tue, 19 Jul 2011 09:01:03 +0000"  >&lt;p&gt;the example from the list is causing an illegal access error in 1.7.11, since the class is package private. Same for trunk&lt;/p&gt;</comment>
                            <comment id="14471431" author="blackdrag" created="Tue, 19 Jul 2011 09:04:14 +0000"  >&lt;p&gt;and any version since 1.5.1 I tested has the same problem&lt;/p&gt;</comment>
                            <comment id="14471495" author="melix" created="Tue, 19 Jul 2011 09:05:15 +0000"  >&lt;p&gt;Yes there are two separate problems in the latest patch from Hamlet :&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;the field &quot;value&quot; in the parent class is package protected and not recognized in the subclass&lt;/li&gt;
	&lt;li&gt;it throws a StackOverflowError while my example does not&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;While I&apos;m still scratching my head wondering why his example throws the error and not mine, I think the 1st one should be considered as a separate bug.&lt;/p&gt;</comment>
                            <comment id="14471476" author="blackdrag" created="Tue, 19 Jul 2011 09:13:36 +0000"  >&lt;p&gt;I just tried it with the precompilation as suggested and this does indeed reproduce the issue... only 1.7.0 has exactly the same problem. And even 1.5.1 has this problem. So we are far away from a regression&lt;/p&gt;</comment>
                            <comment id="14471506" author="hamletdrc" created="Tue, 19 Jul 2011 09:30:15 +0000"  >&lt;p&gt;When CodeNarc users run CodeNarc with 1.7, they never receive a stack overflow exception. When they run it with CodeNarc 1.8 they do. While this specific scenario in the use case may not be a regression, there is something in Groovy 1.8 that causes this. For instance, if Groovy provides a Java class called &quot;ClassCodeVisitorSupport&quot; and the visibility modifier of a method was changed from protected to package-visibile (which should be a non-breaking change), then there is a chance that this is introduced, correct? There is definitely a regression somewhere. If we don&apos;t fix this ticket, then I will start looking for changed visibility modifiers that need to be reverted... because from a user perspective there are stackoverflow errors in 1.8 that are not in 1.7. &lt;/p&gt;</comment>
                            <comment id="14471520" author="blackdrag" created="Tue, 19 Jul 2011 11:04:19 +0000"  >&lt;p&gt;changing from protected to package-private is a breaking change in Java. A subclass in a different package can see protected methods, but not package-private methods. The problem is that I don&apos;t have a test case. The one from here is not exhibiting the special problem, the zip from the list also not. Without test case I cannot reproduce the issue. Since it seems that you can reproduce the issue, I guess bisecting is the one way to identify the commit that introduced that. You can of course also look for changed modifiers. In any case we will then have to discuss why this is a problem.&lt;/p&gt;


&lt;p&gt;It is too bad that the stackoverflow example you gave is not so easy to debug here&lt;/p&gt;
</comment>
                            <comment id="14471462" author="hamletdrc" created="Tue, 19 Jul 2011 12:06:59 +0000"  >&lt;p&gt;what is wrong with the failing test case I attached? that reproduces the error every time for me?&lt;/p&gt;</comment>
                            <comment id="14471432" author="melix" created="Tue, 19 Jul 2011 15:14:45 +0000"  >&lt;p&gt;Hamlet,&lt;/p&gt;

&lt;p&gt;Yes, I can reproduce the error with your test case. I think what Jochen says is that this test does not correspond to the error you initially reported which is related to the ClassCodeVisitorSupport. There are two things mixed up here (well, I could identify more) : the regression which was introduced somewhere in ClassCodeVisitorSupport or any other class, and the bug which reproduces the StackOverflowError here, but which is not a regression as it could be identified in every version of Groovy tested so far.&lt;/p&gt;

&lt;p&gt;Here&apos;s the result of my late investigations :&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;the initial patch works if the superclass is public and a method is package private and the child class is defined in its own file (bug #1, fixed)&lt;/li&gt;
	&lt;li&gt;if you remove the &quot;public&quot; modifier from the superclass definition, it fails with &quot;class groovy.bugs.Groovy4922BugChild cannot access its superclass groovy.bugs.Groovy4922BugSupport&quot; (bug #2, not fixed)&lt;/li&gt;
	&lt;li&gt;if you remove the &quot;protected&quot; modifier on the &quot;value&quot; property of the superclass, it fails with &quot;groovy.lang.MissingPropertyException: No such property: support for class: groovy.bugs.Groovy4922BugChild&quot; (bug #3, not fixed but less critical)&lt;/li&gt;
	&lt;li&gt;if you define the child class directly in the test case, like you did Hamlet, instead of in the &quot;assertScript&quot; section, it fails with a StackOverflowError (bug #4)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So, I would say your initial error is bug #5, which &lt;b&gt;could&lt;/b&gt; be a modifier changed somewhere in the ClassCodeVisitorSupport class or its hierarchy between 1.7 and 1.8.&lt;/p&gt;

&lt;p&gt;There&apos;s still some work to fully understand what&apos;s going on there &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/tongue.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14471497" author="hamletdrc" created="Tue, 19 Jul 2011 16:03:15 +0000"  >&lt;p&gt;Bug #4 - This is the most direct representation of the CodeNarc code that is seeing the regression. i suggest focusing on this use case. &lt;/p&gt;

&lt;p&gt;Bug #5 - &quot;CodeNarc use case&quot; - CodeNarc subclasses ClassCodeVisitorSupport, and the overflow comes out of the overridden &quot;void visitDeclarationExpression(DeclarationExpression expression)&quot;. This method is overridden in CCVS in 1.7 but not in 1.8. The method isn&apos;t on the class in 1.7, it is higher up in the hierarchy, but it is on the class in 1.8. Perhaps this is causing the issue, in which case the method should be added back on. &lt;/p&gt;

&lt;p&gt;Regarding whether this is a regression or not... No CodeNarc users see a StackOverflowError using 1.7 and almost all users see it with 1.8. If we&apos;re finding defects that are present in 1.7 and earlier then those are nice to fix, but not the root cause of the CodeNarc exceptions. &lt;/p&gt;</comment>
                            <comment id="14471433" author="blackdrag" created="Tue, 19 Jul 2011 17:07:14 +0000"  >&lt;p&gt;to clarify things... the method is not overriden in ClassCodeVisitorSupport in 1.7, but is in 1.8 and 1.9. The method is also overridden in CodeVisitorSupport, the first place in 1.7 and the second case in 1.8/1.9, the class is higher up in the hierarchy.&lt;/p&gt;

&lt;p&gt;The CodeNarc problem is then fully unrelated to modifiers, since the method is public only. &lt;/p&gt;

&lt;p&gt;The next step would be to reproduce the issue using overridden public methods only. And that is a setup that does not exist as of yet.&lt;/p&gt;</comment>
                            <comment id="14471447" author="blackdrag" created="Wed, 20 Jul 2011 17:53:54 +0000"  >&lt;p&gt;since the CodeNarc problem seems to be a different one than the one here I created &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-4936&quot; title=&quot;package protected method in Parent class cannot be called&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-4936&quot;&gt;&lt;del&gt;GROOVY-4936&lt;/del&gt;&lt;/a&gt;. If &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-4936&quot; title=&quot;package protected method in Parent class cannot be called&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-4936&quot;&gt;&lt;del&gt;GROOVY-4936&lt;/del&gt;&lt;/a&gt; is fixed we can test if this issue is resolved as well - by chance.&lt;/p&gt;</comment>
                            <comment id="14471567" author="blackdrag" created="Thu, 21 Jul 2011 05:02:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-4936&quot; title=&quot;package protected method in Parent class cannot be called&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-4936&quot;&gt;&lt;del&gt;GROOVY-4936&lt;/del&gt;&lt;/a&gt; is now fixed, it would be good to know if that fixed the original issue here as well. &lt;/p&gt;</comment>
                            <comment id="14471435" author="hamletdrc" created="Thu, 21 Jul 2011 05:41:08 +0000"  >&lt;p&gt;I retested the scenario in the .zip file that I uploaded, and that is fixed. &lt;br/&gt;
However, I retested against CodeNarc and that is not fixed. &lt;br/&gt;
I will try to make a new small, self-executing example that shows the problem. &lt;/p&gt;</comment>
                            <comment id="14471508" author="blackdrag" created="Thu, 21 Jul 2011 06:06:43 +0000"  >&lt;p&gt;I was afraid that may be the case, that&apos;s why I made the other issue&lt;/p&gt;</comment>
                            <comment id="14471464" author="hamletdrc" created="Thu, 21 Jul 2011 06:06:45 +0000"  >&lt;p&gt;I attached a new self executing stack overflow example. &lt;br/&gt;
This shows it broken when using the ast visitors. &lt;/p&gt;</comment>
                            <comment id="14471547" author="blackdrag" created="Thu, 21 Jul 2011 06:12:04 +0000"  >&lt;p&gt;Isn&apos;t example the same as before?&lt;/p&gt;</comment>
                            <comment id="14471568" author="hamletdrc" created="Thu, 21 Jul 2011 06:24:52 +0000"  >&lt;p&gt;It is slightly different and the example extends ClassCodeVisitorSupport the way our production code does. &lt;/p&gt;</comment>
                            <comment id="14471531" author="blackdrag" created="Thu, 21 Jul 2011 07:18:41 +0000"  >&lt;p&gt;still, when I execute your &quot;run.sh&quot; it works here with trunk and 1.8&lt;/p&gt;</comment>
                            <comment id="14471589" author="hamletdrc" created="Thu, 21 Jul 2011 08:39:46 +0000"  >&lt;p&gt;Does your command line environment call the Groovy 1.7 groovyc? &lt;br/&gt;
If you have Groovy 1.8 in your path then the sample runs fine. &lt;br/&gt;
You need to make sure that groovyc dispatches to the 1.7 version. &lt;/p&gt;</comment>
                            <comment id="14471449" author="blackdrag" created="Thu, 21 Jul 2011 10:00:03 +0000"  >&lt;p&gt;compiled with 1.7.11 and run with 1.8.1 works fine&lt;/p&gt;</comment>
                            <comment id="14471509" author="blackdrag" created="Thu, 21 Jul 2011 10:06:17 +0000"  >&lt;p&gt;compiled with 1.7.8 and run with 1.8.1 does not work, but run with 1.7.8 does also not&lt;/p&gt;</comment>
                            <comment id="14471603" author="blackdrag" created="Thu, 21 Jul 2011 10:16:53 +0000"  >&lt;p&gt;comparing the bytecode generated by 1.8.1 and 1.7.8 I can see that it simply cannot work. there is a method&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;$2$someMethod(Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;;)V
    ALOAD 0
    ALOAD 1
    INVOKESPECIAL Parent.someMethod (Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;;)V
    RETURN
    MAXSTACK = 2
    MAXLOCALS = 2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;needed to call the super method, which in 1.7.8 does simply not exist. That is also the reason why compiled with 1.7.8 and run with 1.7.8 cannot work as well. 1.7.11 fixes the problem as does 1.8.1. But there is no chance that code compiled with 1.7.8 will ever run correctly like this. And there is nothing we can fix, since the support method needed for this is missing.&lt;/p&gt;</comment>
                            <comment id="14471465" author="blackdrag" created="Thu, 21 Jul 2011 10:19:14 +0000"  >&lt;p&gt;for CodeNarc you could look at the bytecode of the class containing the super method call. Does it have a method like above? &lt;/p&gt;</comment>
                            <comment id="14471558" author="hamletdrc" created="Thu, 21 Jul 2011 10:21:50 +0000"  >&lt;p&gt;Here is the &quot;new&quot; stack overflow example. You and I are clearly working from different examples. &lt;/p&gt;</comment>
                            <comment id="14471480" author="hamletdrc" created="Thu, 21 Jul 2011 10:30:19 +0000"  >&lt;p&gt;Jochen, concerning the super method in CodeNarc. &lt;/p&gt;

&lt;p&gt;In CodeNarc, the stack overflow comes from: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void visitDeclarationExpression(DeclarationExpression expression)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The super implementation is in CodeVisitorSupport. This method was present in 1.7 and 1.8. &lt;/p&gt;
</comment>
                            <comment id="14471548" author="blackdrag" created="Thu, 21 Jul 2011 10:50:43 +0000"  >&lt;p&gt;ok, the important difference between 1.7 and 1.8/1.9 is in 1.7 we have &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;$2$visitDeclarationExpression(Lorg/codehaus/groovy/ast/expr/DeclarationExpression;)V
    ALOAD 0
    ALOAD 1
    INVOKESPECIAL org/codehaus/groovy/ast/CodeVisitorSupport.visitDeclarationExpression (Lorg/codehaus/groovy/ast/expr/DeclarationExpression;)V
    RETURN
    MAXSTACK = 2
    MAXLOCALS = 2&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; and in 1.8 we have&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;$3$visitDeclarationExpression(Lorg/codehaus/groovy/ast/expr/DeclarationExpression;)V
    ALOAD 0
    ALOAD 1
    INVOKESPECIAL org/codehaus/groovy/ast/ClassCodeVisitorSupport.visitDeclarationExpression (Lorg/codehaus/groovy/ast/expr/DeclarationExpression;)V
    RETURN
    MAXSTACK = 2
    MAXLOCALS = 2&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As can be clearly see there is a difference in what class is called as well as what number is used&lt;/p&gt;</comment>
                            <comment id="14471569" author="blackdrag" created="Thu, 21 Jul 2011 10:56:08 +0000"  >&lt;p&gt;From the trace I can tell the 1.7 method is not called. I assume the runtime looks only for the exact match, which for 1.8 is super$3 and not super$2, thus not finding the method and then placing the normal method for the call to super, when it should have caused an exception instead&lt;/p&gt;</comment>
                            <comment id="14472395" author="blackdrag" created="Mon, 13 Feb 2012 06:20:21 +0000"  >&lt;p&gt;If my assumption with the fall back is right, then &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5285&quot; title=&quot;super.setMetaClass() generates StackOverflowError when there is no base class&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5285&quot;&gt;&lt;del&gt;GROOVY-5285&lt;/del&gt;&lt;/a&gt; is caused by the exact same logic&lt;/p&gt;</comment>
                            <comment id="14472507" author="melix" created="Tue, 14 Feb 2012 08:29:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5285&quot; title=&quot;super.setMetaClass() generates StackOverflowError when there is no base class&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5285&quot;&gt;&lt;del&gt;GROOVY-5285&lt;/del&gt;&lt;/a&gt; is unrelated. Another stack overflow &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14472467" author="melix" created="Tue, 14 Feb 2012 12:28:05 +0000"  >&lt;p&gt;Fixed by testing if other MOP methods exist with the same name but with a lower index.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722861" name="4922failure.patch" size="1761" author="hamletdrc" created="Tue, 19 Jul 2011 05:02:28 +0000"/>
                            <attachment id="12722862" name="GROOVY-4922-new.patch" size="7095" author="melix" created="Mon, 18 Jul 2011 11:56:42 +0000"/>
                            <attachment id="12722864" name="GROOVY-4922.patch" size="5458" author="melix" created="Mon, 18 Jul 2011 09:07:08 +0000"/>
                            <attachment id="12722956" name="new_stackoverflow_example.zip" size="35713" author="hamletdrc" created="Thu, 21 Jul 2011 10:21:50 +0000"/>
                            <attachment id="12722896" name="stackoverflow-example.zip" size="10402" author="hamletdrc" created="Thu, 21 Jul 2011 06:06:45 +0000"/>
                            <attachment id="12722952" name="test-reports.tar.gz" size="336506" author="melix" created="Mon, 18 Jul 2011 09:07:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 41 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c2nj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>