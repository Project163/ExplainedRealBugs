<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:25:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-11591] safe call evaluates arguments </title>
                <link>https://issues.apache.org/jira/browse/GROOVY-11591</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;A safe method call first evaluates method&apos;s arguments, and only then trashes the call. It would seem to me much better if the arguments were not evaluated in this case (precisely same way as if we used the java-like &#160;&#8220;if (obj) obj.whatever...&#8221; approach instead of the safe call).&lt;/p&gt;

&lt;p&gt;Based on Jochen insight, what probably happens is&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;push arguments on stack&lt;/li&gt;
	&lt;li&gt;push receiver on stack&lt;/li&gt;
	&lt;li&gt;write jmp if null&lt;/li&gt;
	&lt;li&gt;write method call&lt;/li&gt;
	&lt;li&gt;jmp to after call&lt;/li&gt;
	&lt;li&gt;marker for null case&lt;/li&gt;
	&lt;li&gt;remove elements from stack&lt;/li&gt;
	&lt;li&gt;push null&lt;/li&gt;
	&lt;li&gt;marker for after call&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Testable e.g., by&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
1040 ocs /tmp&amp;gt; &amp;lt;q.groovy 
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;qq {
&#160;def foo(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s) {
&#160;&#160;&#160;println &lt;span class=&quot;code-quote&quot;&gt;&quot;foo called!&quot;&lt;/span&gt;
&#160;&#160;&#160;s
&#160;}
&#160;def bar(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s) {
&#160;&#160;&#160;println &lt;span class=&quot;code-quote&quot;&gt;&quot;bar: $s&quot;&lt;/span&gt;
&#160;}
}

&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;?.bar(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; qq().foo(&lt;span class=&quot;code-quote&quot;&gt;&apos;Oops!&apos;&lt;/span&gt;))
1041 ocs /tmp&amp;gt; /usr/local/groovy-4.0.25/bin/groovy q
foo called!
1042 ocs /tmp&amp;gt;  &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13613549">GROOVY-11591</key>
            <summary>safe call evaluates arguments </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="oc">OC</reporter>
                        <labels>
                    </labels>
                <created>Sat, 29 Mar 2025 17:00:43 +0000</created>
                <updated>Wed, 4 Jun 2025 14:45:20 +0000</updated>
                            <resolved>Sat, 29 Mar 2025 21:47:28 +0000</resolved>
                                                    <fixVersion>5.0.0-beta-1</fixVersion>
                                    <component>class generator</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17939432" author="emilles" created="Sat, 29 Mar 2025 17:09:43 +0000"  >&lt;p&gt;Is the order of operations defined somewhere?  Any concern for argument expressions with side-effects?&lt;/p&gt;</comment>
                            <comment id="17939433" author="emilles" created="Sat, 29 Mar 2025 17:15:46 +0000"  >&lt;p&gt;In dynamic mode, I think arguments are evaluated and bound into an array that is fed to call site logic where null-safety is implemented. Static compilation writes the bytecode for your list. Would you want different behavior for static and dynamic?&lt;/p&gt;</comment>
                            <comment id="17939434" author="oc" created="Sat, 29 Mar 2025 17:25:49 +0000"  >&lt;p&gt;Myself, I haven&apos;t found any relevant documentation (perhaps there is some and I&apos;ve missed it).&lt;/p&gt;

&lt;p&gt;The potential side-effects are my primary concern (efficiency with more complex arguments secondary).&lt;/p&gt;

&lt;p&gt;In my personal opinion, regardless the compilation mode, whenever &lt;em&gt;null&lt;/em&gt; is the receiver, the arguments should &lt;em&gt;never&lt;/em&gt; be evaluated &#8212; neither before a safe call &#8222;empty operation&#8220;, nor before NPE if safe call is not used. In my personal opinion, &lt;em&gt;foo?.bar(...)&lt;/em&gt; should be functionally equivalent&lt;span class=&quot;error&quot;&gt;&amp;#91;*&amp;#93;&lt;/span&gt; to &lt;em&gt;foo==null?null:foo.bar(...)&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;(It is still well possible I overlook some reasons why this might be either wrong, or at least technically unfeasible.)&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;*&amp;#93;&lt;/span&gt; But for only single evaluation of &lt;em&gt;foo&lt;/em&gt; of course.&lt;/p&gt;</comment>
                            <comment id="17939443" author="emilles" created="Sat, 29 Mar 2025 19:15:18 +0000"  >&lt;p&gt;I&apos;m able to look over the code and docs now.  I also can&apos;t find any specific reference to safe call arguments.  It does make sense that &quot;x?.y(z)&quot; and &quot;x != null ? x.y(z) : null&quot; are more-or-less the same (assuming &lt;tt&gt;x&lt;/tt&gt; evaluated twice produces the same value).&lt;/p&gt;</comment>
                            <comment id="17939444" author="emilles" created="Sat, 29 Mar 2025 20:08:51 +0000"  >&lt;p&gt;Just a note: static compilation does this already.&lt;/p&gt;</comment>
                            <comment id="17939446" author="emilles" created="Sat, 29 Mar 2025 21:47:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/d50a84f3df92559850834abac9504c8265eaa1d4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/d50a84f3df92559850834abac9504c8265eaa1d4&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17939477" author="blackdrag" created="Sun, 30 Mar 2025 11:54:45 +0000"  >&lt;p&gt;I think the correct way would be a single evaluation of the receiver. This means that we would have to implement for x?.y(z):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
  tmp = x
  tmp? tmp.y(z) : &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;That would mean for dynamic Groovy to have the callsite code changed and do safe navigation before the call and the safe call is removed as case for invokedynamic. And it would mean the static variant should change as well, since it exhibits the same &quot;problem&quot;. And since it is only arguably a bug, I think this should be 5.0 only.&lt;/p&gt;

</comment>
                            <comment id="17939493" author="emilles" created="Sun, 30 Mar 2025 14:34:46 +0000"  >&lt;p&gt;The implementation only evaluates the receiver one time.  It dups the stack value to check it for null.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>groovy</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            32 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1v2io:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>