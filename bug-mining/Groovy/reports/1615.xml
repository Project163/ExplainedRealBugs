<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:22:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-5122] static fields on interface not getting initialized, when being initialized to an anonymous class instance</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-5122</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The following code shows a &lt;em&gt;static&lt;/em&gt; field on an &lt;em&gt;interface&lt;/em&gt; not initialized at the point when the constructor of an &lt;em&gt;instance&lt;/em&gt; of an implementing class is being run.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; ignored.alex.failingcallsite

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.lang.reflect.Field;

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;FailingCallSiteLocalClass {
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
		&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; B()		
	}
}

&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; A {
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; X x = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; X() {
		&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void foo() {}
	}
}

&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; X {
	void foo()
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;B &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; A {
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; B() {
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Field f in getClass().getFields()) {
			println f
			println f.get(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;)
		}
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Throws &lt;tt&gt;java.lang.IllegalAccessError&lt;/tt&gt; when &lt;tt&gt;x&lt;/tt&gt; is accessed via &lt;tt&gt;f.get(this)&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I would expect &lt;tt&gt;x&lt;/tt&gt; to have been initialized by this point. Is there something subtle in when interfaces are initialized?&lt;/p&gt;

&lt;p&gt;There is no problem if &lt;tt&gt;A&lt;/tt&gt; is a &lt;em&gt;class&lt;/em&gt; extended by &lt;tt&gt;B&lt;/tt&gt;, and more curiously, no problem if &lt;tt&gt;x&lt;/tt&gt; is set equal to a named outer class (e.g. a class &lt;tt&gt;X2 implements X&lt;/tt&gt;).&lt;/p&gt;</description>
                <environment>OS X (suspected all)</environment>
        <key id="12818371">GROOVY-5122</key>
            <summary>static fields on interface not getting initialized, when being initialized to an anonymous class instance</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="melix">C&#233;dric Champeau</assignee>
                                    <reporter username="alex.heneveld">Alex Heneveld</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Nov 2011 07:28:37 +0000</created>
                <updated>Wed, 29 Mar 2017 09:48:17 +0000</updated>
                            <resolved>Thu, 17 Nov 2011 16:00:26 +0000</resolved>
                                    <version>1.8.4</version>
                                    <fixVersion>1.8.5</fixVersion>
                    <fixVersion>2.0-beta-2</fixVersion>
                    <fixVersion>1.7.11</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14479725" author="alex.heneveld" created="Mon, 14 Nov 2011 07:34:49 +0000"  >&lt;p&gt;I have seen various stack traces as I&apos;ve tested it in various places.&lt;/p&gt;

&lt;p&gt;Firstly, in some instances it complains that the constructor &lt;tt&gt;A$1(java.lang.Class)&lt;/tt&gt; cannot be accessed, which makes me suspect inner class issues (e.g. &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5109&quot; title=&quot;inner class inheritance with outer class inheritance can&amp;#39;t find constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5109&quot;&gt;&lt;del&gt;GROOVY-5109&lt;/del&gt;&lt;/a&gt;) may be related.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;transient&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; ignored.alex.failingcallsite.B.__$stMC
&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ignored.alex.failingcallsite.X ignored.alex.failingcallsite.A.x
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.ExceptionInInitializerError
	at sun.misc.Unsafe.ensureClassInitialized(Native Method)
	at sun.reflect.UnsafeFieldAccessorFactory.newFieldAccessor(UnsafeFieldAccessorFactory.java:25)
	at sun.reflect.ReflectionFactory.newFieldAccessor(ReflectionFactory.java:122)
	at java.lang.reflect.Field.acquireFieldAccessor(Field.java:918)
	at java.lang.reflect.Field.getFieldAccessor(Field.java:899)
	at java.lang.reflect.Field.get(Field.java:358)
	at java_lang_reflect_Field$get.call(Unknown Source)
	at ignored.alex.failingcallsite.B.&amp;lt;init&amp;gt;(FailingCallSiteLocalClass.groovy:25)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:513)
	at org.codehaus.groovy.reflection.CachedConstructor.invoke(CachedConstructor.java:77)
	at org.codehaus.groovy.runtime.callsite.ConstructorSite$ConstructorSiteNoUnwrapNoCoerce.callConstructor(ConstructorSite.java:102)
	at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCallConstructor(CallSiteArray.java:54)
	at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callConstructor(AbstractCallSite.java:182)
	at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callConstructor(AbstractCallSite.java:186)
	at ignored.alex.failingcallsite.FailingCallSiteLocalClass.main(FailingCallSiteLocalClass.groovy:7)
Caused by: groovy.lang.GroovyRuntimeException: Could not find matching constructor &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;: ignored.alex.failingcallsite.A$1(java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;)
	at groovy.lang.MetaClassImpl.invokeConstructor(MetaClassImpl.java:1473)
	at groovy.lang.MetaClassImpl.invokeConstructor(MetaClassImpl.java:1389)
	at org.codehaus.groovy.runtime.callsite.MetaClassConstructorSite.callConstructor(MetaClassConstructorSite.java:46)
	at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCallConstructor(CallSiteArray.java:54)
	at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callConstructor(AbstractCallSite.java:182)
	at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callConstructor(AbstractCallSite.java:190)
	at ignored.alex.failingcallsite.A.&amp;lt;clinit&amp;gt;(FailingCallSiteLocalClass.groovy:12)
	... 18 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Running from the command-line shows the smaller trace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;bugs% ../groovy-2.0.0-beta-1/bin/groovy -e &lt;span class=&quot;code-quote&quot;&gt;&apos;ignored.alex.failingcallsite.FailingCallSiteLocalClass.main()&apos;&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;transient&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; ignored.alex.failingcallsite.B.__$stMC
&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; ignored.alex.failingcallsite.B.__timeStamp
1321276852344
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; ignored.alex.failingcallsite.B.__timeStamp__239_neverHappen1321276852344
0
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ignored.alex.failingcallsite.X ignored.alex.failingcallsite.A.x
Caught: java.lang.IllegalAccessError: tried to access field ignored.alex.failingcallsite.A$1.$&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;ignored$alex$failingcallsite$A from &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ignored.alex.failingcallsite.A
java.lang.IllegalAccessError: tried to access field ignored.alex.failingcallsite.A$1.$&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;ignored$alex$failingcallsite$A from &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ignored.alex.failingcallsite.A
	at ignored.alex.failingcallsite.A.&amp;lt;clinit&amp;gt;(FailingCallSiteLocalClass.groovy:12)
	at java_lang_reflect_Field$get.call(Unknown Source)
	at ignored.alex.failingcallsite.B.&amp;lt;init&amp;gt;(FailingCallSiteLocalClass.groovy:25)
	at ignored.alex.failingcallsite.FailingCallSiteLocalClass.main(FailingCallSiteLocalClass.groovy:7)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Finally, it might be useful to note that although this test case fails on all versions tested (1.7.2 through 1.8.4, and 2.0.0-beta1), it was extracted from a more complicated scenario which only started failing in 1.8.2 &amp;#8211; was working for many months against 1.8.0-03.&lt;/p&gt;</comment>
                            <comment id="14472033" author="melix" created="Tue, 15 Nov 2011 04:36:09 +0000"  >&lt;p&gt;Without package definition, I obtain another error:&lt;br/&gt;
{{java.lang.LinkageError: loader (instance of  groovy/lang/GroovyClassLoader$InnerLoader): attempted  duplicate class definition for name: &quot;A$1&quot;&lt;br/&gt;
	at java.lang.ClassLoader.defineClass1(Native Method)&lt;br/&gt;
	at java.lang.ClassLoader.defineClassCond(ClassLoader.java:631)&lt;br/&gt;
	at java.lang.ClassLoader.defineClass(ClassLoader.java:615)&lt;br/&gt;
	at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:141)&lt;br/&gt;
	at groovy.lang.GroovyClassLoader.access$300(GroovyClassLoader.java:55)&lt;br/&gt;
	at groovy.lang.GroovyClassLoader$ClassCollector.createClass(GroovyClassLoader.java:519)&lt;br/&gt;
	at groovy.lang.GroovyClassLoader$ClassCollector.onClassNode(GroovyClassLoader.java:536)}}&lt;br/&gt;
which is due to a mismatch in inner class id generation (GeneratorContext). After fixing this bug, cannot reproduce your issue on master, still investigating.&lt;/p&gt;</comment>
                            <comment id="14479726" author="alex.heneveld" created="Tue, 15 Nov 2011 04:59:50 +0000"  >&lt;p&gt;If it&apos;s working now in master then I&apos;d guess it&apos;s fixed ... either the default/root package bug or maybe &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5109&quot; title=&quot;inner class inheritance with outer class inheritance can&amp;#39;t find constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5109&quot;&gt;&lt;del&gt;GROOVY-5109&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14471991" author="melix" created="Tue, 15 Nov 2011 05:02:16 +0000"  >&lt;p&gt;What is curious is that I cannot reproduce your problem. I have the same duplicate class definition error if I use Groovy 1.8.2.&lt;/p&gt;</comment>
                            <comment id="14479739" author="alex.heneveld" created="Tue, 15 Nov 2011 05:20:47 +0000"  >&lt;p&gt;I observed the duplicate class error only when running it in default/root package. Didn&apos;t know what I was colliding with but figured it was irrelevant. Are you getting dup-class-def with package ignored.alex.failingcallsite set?&lt;/p&gt;

&lt;p&gt;I&apos;m on OS X 10.5 JDK 1.6.0_20 fwiw...&lt;/p&gt;</comment>
                            <comment id="14472065" author="melix" created="Tue, 15 Nov 2011 06:56:12 +0000"  >&lt;p&gt;I pushed the fix to branches 1.7.x, 1.8.x and master. I would be great to tell me if you still experience the problem.&lt;/p&gt;</comment>
                            <comment id="14479728" author="alex.heneveld" created="Tue, 15 Nov 2011 21:30:46 +0000"  >&lt;p&gt;Alas, nope. It is still failing on master for me with the same error.&lt;/p&gt;

&lt;p&gt;It also fails when the &lt;tt&gt;package&lt;/tt&gt; line is removed, although the duplicated class error message is gone, I now get the analogous &lt;tt&gt;IllegalAccessException: tried to access field A$1.$class$A from class A&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Here is how I am pull, build and running it, with the class above (including package) in &lt;tt&gt;bugs/FailingCallSiteLocalClass.groovy&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;~/dev/explore/groovy/git/groovy-core% git pull ; ant install -DskipTests=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
...

~/dev/explore/groovy/git/groovy-core% cd ../../bugs/

~/dev/explore/groovy/bugs% rm -rf ignored/

~/dev/explore/groovy/bugs% ../git/groovy-core/target/install/bin/groovyc FailingCallSiteLocalClass.groovy 

~/dev/explore/groovy/bugs% ../git/groovy-core/target/install/bin/groovy -e &lt;span class=&quot;code-quote&quot;&gt;&apos;ignored.alex.failingcallsite.FailingCallSiteLocalClass.main()&apos;&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;transient&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; ignored.alex.failingcallsite.B.__$stMC
&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; ignored.alex.failingcallsite.B.__timeStamp
1321413751418
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; ignored.alex.failingcallsite.B.__timeStamp__239_neverHappen1321413751418
0
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ignored.alex.failingcallsite.X ignored.alex.failingcallsite.A.x
Caught: java.lang.IllegalAccessError: tried to access field ignored.alex.failingcallsite.A$1.$&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;ignored$alex$failingcallsite$A from &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ignored.alex.failingcallsite.A
java.lang.IllegalAccessError: tried to access field ignored.alex.failingcallsite.A$1.$&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;ignored$alex$failingcallsite$A from &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ignored.alex.failingcallsite.A
	at ignored.alex.failingcallsite.A.&amp;lt;clinit&amp;gt;(FailingCallSiteLocalClass.groovy:12)
	at java_lang_reflect_Field$get.call(Unknown Source)
	at ignored.alex.failingcallsite.B.&amp;lt;init&amp;gt;(FailingCallSiteLocalClass.groovy:25)
	at ignored.alex.failingcallsite.FailingCallSiteLocalClass.main(FailingCallSiteLocalClass.groovy:7)
	at script_from_command_line.run(script_from_command_line:1)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14472116" author="blackdrag" created="Wed, 16 Nov 2011 06:40:33 +0000"  >&lt;p&gt;I start suspecting this happens because the field is final and I think Sun/Oracle VM doesn&apos;t check that, while the OSX VM does.&lt;/p&gt;</comment>
                            <comment id="14472080" author="melix" created="Wed, 16 Nov 2011 10:17:21 +0000"  >&lt;p&gt;I don&apos;t have an OSX machine to test that. It may be some problem with the order fields are initialized, we&apos;ve seen that in the past, but it doesn&apos;t happen here on my JVM. What happens if you write the same code in Java ?&lt;/p&gt;</comment>
                            <comment id="14479732" author="alex.heneveld" created="Wed, 16 Nov 2011 11:03:34 +0000"  >&lt;p&gt;Analogous code in Java is fine, happily prints:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ignored.alex.failingcallsite.poj.X ignored.alex.failingcallsite.poj.A.x
ignored.alex.failingcallsite.poj.A$1@593d93f4
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So suspect you&apos;re right, something different in how the OSX JVM does things. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14472001" author="melix" created="Thu, 17 Nov 2011 02:30:03 +0000"  >&lt;p&gt;For reference, I just tested with Oracle JRockit on Linux 64 bit, it doesn&apos;t throw any IAE. I&apos;m trying to download IBM JVM... but I&apos;m stuck at download. Now trying various OpenJDK VM options.&lt;/p&gt;</comment>
                            <comment id="14479734" author="alex.heneveld" created="Thu, 17 Nov 2011 08:06:00 +0000"  >&lt;p&gt;No, don&apos;t think it&apos;s OSX. I have a simpler test case which fails on OSX JVM and on Linux Sun JVM. (Not totally sure it is the same issue but seems like a better starting point.)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;% cat Groovy5122.groovy 
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; bug5122.small1

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Groovy5122 {
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
		println &lt;span class=&quot;code-quote&quot;&gt;&quot;x is: &quot;&lt;/span&gt;+InterfaceWithStaticAnonymous.x;
	}
}

&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; InterfaceWithStaticAnonymous {
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; x = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;() {};
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Gives the following error (in all cases):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;% java -cp groovy-all.jar:. bug5122.small1.Groovy5122
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.IllegalAccessError: tried to access field bug5122.small1.InterfaceWithStaticAnonymous$1.$&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;bug5122$small1$InterfaceWithStaticAnonymous from &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;bug5122.small1.InterfaceWithStaticAnonymous
	at bug5122.small1.InterfaceWithStaticAnonymous.&amp;lt;clinit&amp;gt;(Groovy5122.groovy:10)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName0(Native Method)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:169)
	at bug5122.small1.Groovy5122.class$(Groovy5122.groovy)
	at bug5122.small1.Groovy5122.$get$$&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;bug5122$small1$InterfaceWithStaticAnonymous(Groovy5122.groovy)
	at bug5122.small1.Groovy5122.main(Groovy5122.groovy:5)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I observe this against v1.8.4 and against git master (with 5109 fix, and tried both with and without an additional patch from C&#233;dric). Problem goes away if we &lt;tt&gt;s/interface/class/&lt;/tt&gt; and/or if we &lt;tt&gt;s/{}//&lt;/tt&gt;. Error is the same if we put it in the default package.&lt;/p&gt;

&lt;p&gt;Suggest we rename issue to &lt;b&gt;IllegalAccessError for static field in interface being assigned to anonymous class instance&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;OSX JVM is 1.6.0_20. Linux JVM is Sun/Oracle 1.6.0_22.&lt;/p&gt;</comment>
                            <comment id="14472034" author="melix" created="Thu, 17 Nov 2011 09:40:58 +0000"  >&lt;p&gt;I am under Linux, and I don&apos;t face the problem. What bugs me is the way you start the main program. You are using:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java -cp groovy-all.jar:. bug5122.small1.Groovy5122&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which tells you have compiled the script previously. How did you compile the script ? I am using this :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java -cp ~/GG/target/dist/groovy-all.jar:. groovy.ui.GroovyMain bug5122/small1/Groovy5122.groovy 
x is: bug5122.small1.InterfaceWithStaticAnonymous$1@561777b1&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And the output is correct. Are you sure you are compiling the script with the right version of Groovy ?&lt;/p&gt;</comment>
                            <comment id="14479740" author="alex.heneveld" created="Thu, 17 Nov 2011 10:03:59 +0000"  >&lt;p&gt;Yes, I always recompile with the same version.  Seemed safest.&lt;/p&gt;

&lt;p&gt;Different ways of starting it cause different problems but all cause problems.&lt;/p&gt;

&lt;p&gt;When I run with your syntax I get:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;alex@dynlin334:~/groovy/bugs$ java -cp ../current/embeddable/groovy-all-2.0.0-beta-2-SNAPSHOT.jar:. groovy.ui.GroovyMain Groovy5122.groovy 
Caught: java.lang.LinkageError: loader (instance of  groovy/lang/GroovyClassLoader$InnerLoader): attempted  duplicate &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;definition &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; name: &lt;span class=&quot;code-quote&quot;&gt;&quot;bug5122/small1/InterfaceWithStaticAnonymous$1&quot;&lt;/span&gt;
java.lang.LinkageError: loader (instance of  groovy/lang/GroovyClassLoader$InnerLoader): attempted  duplicate &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;definition &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; name: &lt;span class=&quot;code-quote&quot;&gt;&quot;bug5122/small1/InterfaceWithStaticAnonymous$1&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Same if I run with &lt;tt&gt;bin/groovy bug5122/small1/Groovy5122.groovy&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14472117" author="melix" created="Thu, 17 Nov 2011 10:14:31 +0000"  >&lt;p&gt;That puzzles me. I don&apos;t understand. The last error you show is the one fixed in the lastest master commit... I tried many JDKs, even managed to test on a JDK 1.5 Apple JDK, but none showed that IAE error &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/tongue.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14479716" author="alex.heneveld" created="Thu, 17 Nov 2011 10:50:53 +0000"  >&lt;p&gt;Ah, all good.&lt;/p&gt;

&lt;p&gt;Latest commit 2151e717653113c24f4c1f3e48c4960ee67d01c5 fixes it, it just wasn&apos;t in github when I pulled. Maybe some delay before things are shown in the mirror?  Sorry for the noise. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;FWIW the patch you sent me for AsmClassGenerator (replacing ACC_SUPER with ACC_PUBLIC|ACC_STATIC) makes no apparent difference.&lt;/p&gt;</comment>
                            <comment id="14471992" author="melix" created="Thu, 17 Nov 2011 10:53:15 +0000"  >&lt;p&gt;Ok, so you are telling me that you don&apos;t have any IAE anymore ?&lt;/p&gt;</comment>
                            <comment id="14479729" author="alex.heneveld" created="Thu, 17 Nov 2011 11:04:33 +0000"  >&lt;p&gt;Yep. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  All errors are gone &amp;#8211; IAE for $..class, IAE for call site, duplicate class, missing constructor. Have tried several of the failure cases I had, and all are now happy. Strange that it would manifest itself in so many different ways, but all good now.&lt;/p&gt;</comment>
                            <comment id="14472089" author="melix" created="Thu, 17 Nov 2011 12:28:36 +0000"  >&lt;p&gt;Ok, last check. When you say you don&apos;t have any errors, is it with or without the patch (which is not committed) on AsmClassGenerator ? &lt;/p&gt;</comment>
                            <comment id="14479731" author="alex.heneveld" created="Thu, 17 Nov 2011 12:34:26 +0000"  >&lt;p&gt;The patch makes no apparent difference.  I get no errors without it, and I get no errors with it.&lt;/p&gt;</comment>
                            <comment id="14472035" author="melix" created="Thu, 17 Nov 2011 12:35:52 +0000"  >&lt;p&gt;Great, thanks!&lt;/p&gt;</comment>
                            <comment id="15944907" author="githubbot" created="Tue, 28 Mar 2017 10:09:49 +0000"  >&lt;p&gt;Github user tbouron commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/brooklyn-server/pull/611#discussion_r108372912&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/brooklyn-server/pull/611#discussion_r108372912&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: core/src/main/java/org/apache/brooklyn/core/effector/ExplicitEffector.java &amp;#8212;&lt;br/&gt;
    @@ -46,12 +58,20 @@ public T call(Entity entity, Map parameters) {&lt;/p&gt;

&lt;p&gt;         /** convenience to create an effector supplying a closure; annotations are preferred,&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;and subclass here would be failback, but this is offered as&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* workaround for bug &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5122&quot; title=&quot;static fields on interface not getting initialized, when being initialized to an anonymous class instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5122&quot;&gt;&lt;del&gt;GROOVY-5122&lt;/del&gt;&lt;/a&gt;, as discussed in test class CanSayHi&lt;br/&gt;
    +     * workaround for bug &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5122&quot; title=&quot;static fields on interface not getting initialized, when being initialized to an anonymous class instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5122&quot;&gt;&lt;del&gt;GROOVY-5122&lt;/del&gt;&lt;/a&gt;, as discussed in test class CanSayHi.&lt;br/&gt;
    +     * &lt;br/&gt;
    +     * @deprecated since 0.11.0; explicit groovy utilities/support will be deleted.&lt;br/&gt;
          */&lt;br/&gt;
    +    @Deprecated&lt;br/&gt;
         public static &amp;lt;I,T&amp;gt; ExplicitEffector&amp;lt;I,T&amp;gt; create(String name, Class&amp;lt;T&amp;gt; type, List&amp;lt;ParameterType&amp;lt;?&amp;gt;&amp;gt; parameters, String description, Closure body) {&lt;br/&gt;
    +        LOG.warn(&quot;Use of groovy.lang.Closure is deprecated, in ExplicitEffector.create()&quot;);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Shouldn&apos;t we suggest another class/method to use in the warning message?&lt;/p&gt;</comment>
                            <comment id="15946779" author="githubbot" created="Wed, 29 Mar 2017 09:11:50 +0000"  >&lt;p&gt;Github user aledsage commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/brooklyn-server/pull/611#discussion_r108627021&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/brooklyn-server/pull/611#discussion_r108627021&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: core/src/main/java/org/apache/brooklyn/core/effector/ExplicitEffector.java &amp;#8212;&lt;br/&gt;
    @@ -46,12 +58,20 @@ public T call(Entity entity, Map parameters) {&lt;/p&gt;

&lt;p&gt;         /** convenience to create an effector supplying a closure; annotations are preferred,&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;and subclass here would be failback, but this is offered as&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* workaround for bug &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5122&quot; title=&quot;static fields on interface not getting initialized, when being initialized to an anonymous class instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5122&quot;&gt;&lt;del&gt;GROOVY-5122&lt;/del&gt;&lt;/a&gt;, as discussed in test class CanSayHi&lt;br/&gt;
    +     * workaround for bug &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5122&quot; title=&quot;static fields on interface not getting initialized, when being initialized to an anonymous class instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5122&quot;&gt;&lt;del&gt;GROOVY-5122&lt;/del&gt;&lt;/a&gt;, as discussed in test class CanSayHi.&lt;br/&gt;
    +     * &lt;br/&gt;
    +     * @deprecated since 0.11.0; explicit groovy utilities/support will be deleted.&lt;br/&gt;
          */&lt;br/&gt;
    +    @Deprecated&lt;br/&gt;
         public static &amp;lt;I,T&amp;gt; ExplicitEffector&amp;lt;I,T&amp;gt; create(String name, Class&amp;lt;T&amp;gt; type, List&amp;lt;ParameterType&amp;lt;?&amp;gt;&amp;gt; parameters, String description, Closure body) {&lt;br/&gt;
    +        LOG.warn(&quot;Use of groovy.lang.Closure is deprecated, in ExplicitEffector.create()&quot;);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I&apos;ve added this to javadoc on the class - I think that&apos;s good enough, as there&apos;s not a direct replacement (i.e. one would extend `AbstractEffector` yourself instead, as we don&apos;t need to workaround for &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5122&quot; title=&quot;static fields on interface not getting initialized, when being initialized to an anonymous class instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5122&quot;&gt;&lt;del&gt;GROOVY-5122&lt;/del&gt;&lt;/a&gt; if you&apos;re not using groovy - I&apos;m not sure why anyone would want to do that).&lt;/p&gt;

&lt;p&gt;    I agree in general that if deprecating a method/class, one should point at the alternative - but if deprecating a class, I don&apos;t think we need it on every method.&lt;/p&gt;</comment>
                            <comment id="15946840" author="githubbot" created="Wed, 29 Mar 2017 09:48:17 +0000"  >&lt;p&gt;Github user tbouron commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/brooklyn-server/pull/611#discussion_r108634563&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/brooklyn-server/pull/611#discussion_r108634563&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: core/src/main/java/org/apache/brooklyn/core/effector/ExplicitEffector.java &amp;#8212;&lt;br/&gt;
    @@ -46,12 +58,20 @@ public T call(Entity entity, Map parameters) {&lt;/p&gt;

&lt;p&gt;         /** convenience to create an effector supplying a closure; annotations are preferred,&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;and subclass here would be failback, but this is offered as&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* workaround for bug &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5122&quot; title=&quot;static fields on interface not getting initialized, when being initialized to an anonymous class instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5122&quot;&gt;&lt;del&gt;GROOVY-5122&lt;/del&gt;&lt;/a&gt;, as discussed in test class CanSayHi&lt;br/&gt;
    +     * workaround for bug &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5122&quot; title=&quot;static fields on interface not getting initialized, when being initialized to an anonymous class instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5122&quot;&gt;&lt;del&gt;GROOVY-5122&lt;/del&gt;&lt;/a&gt;, as discussed in test class CanSayHi.&lt;br/&gt;
    +     * &lt;br/&gt;
    +     * @deprecated since 0.11.0; explicit groovy utilities/support will be deleted.&lt;br/&gt;
          */&lt;br/&gt;
    +    @Deprecated&lt;br/&gt;
         public static &amp;lt;I,T&amp;gt; ExplicitEffector&amp;lt;I,T&amp;gt; create(String name, Class&amp;lt;T&amp;gt; type, List&amp;lt;ParameterType&amp;lt;?&amp;gt;&amp;gt; parameters, String description, Closure body) {&lt;br/&gt;
    +        LOG.warn(&quot;Use of groovy.lang.Closure is deprecated, in ExplicitEffector.create()&quot;);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Fair enough&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 33 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cqqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>