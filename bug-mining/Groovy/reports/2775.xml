<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:43:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-7181] Using a memoized closure with inject corrupts the memoization cache</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-7181</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;A memoized closure cannot be used in an inject call without causing problems with the memoization cache. &lt;/p&gt;

&lt;p&gt;Here is a contrived example that demonstrates the problem:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; maxExecutionCount = 0
Closure max = { &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; a, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; b -&amp;gt;
   maxExecutionCount++
   &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.max(a,b)
}.memoize()

&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; minExecutionCount = 0
Closure min = { &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; a, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; b -&amp;gt;
   minExecutionCount++
   &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.min(a,b)
}.memoize()

100.times {
   max.call(max.call(1,2), 3)
}   

100.times {
    [1,2,3].inject(min)
}

&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; maxExecutionCount == 2   
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; minExecutionCount == 2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The second assert fails with an actual minExecutionCount of 101.&lt;/p&gt;

&lt;p&gt;I believe what&apos;s happening is that inject uses a single argument array and modifies the elements of the array as it iterates over the list.  The argument array used to call a method becomes the key in the memoization cache, so modifying it after the call causes the key to change after it has been put into the cache.  Nothing can ever find this key, since its equals() is no longer consistent with the hashCode() that was used to put the key in the cache.&lt;br/&gt;
In case of an org.codehaus.groovy.runtime.memoize.UnlimitedConcurrentCache the cache will grow forever.  In the case of ...LRUCache the cache will be thrashed with any new inject calls.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12811462">GROOVY-7181</key>
            <summary>Using a memoized closure with inject corrupts the memoization cache</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="amordleq">Russell Parry</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Nov 2014 06:54:47 +0000</created>
                <updated>Tue, 23 Dec 2014 19:45:17 +0000</updated>
                            <resolved>Mon, 1 Dec 2014 09:13:34 +0000</resolved>
                                    <version>2.3.7</version>
                                    <fixVersion>2.3.9</fixVersion>
                    <fixVersion>2.4.0-rc-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14476829" author="armsargis" created="Thu, 27 Nov 2014 15:35:09 +0000"  >&lt;p&gt;Hi, inject current impl. is&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;E,T, U &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; T, V &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; T&amp;gt; T inject(Iterator&amp;lt;E&amp;gt; self, U initialValue, @ClosureParams(value=FromString.&lt;span class=&quot;code-keyword&quot;&gt;class,&lt;/span&gt;options=&lt;span class=&quot;code-quote&quot;&gt;&quot;U,E&quot;&lt;/span&gt;) Closure&amp;lt;V&amp;gt; closure) {
        T value = initialValue;
        &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] params = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[2];
        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (self.hasNext()) {
            &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; item = self.next();
            params[0] = value;
            params[1] = item;
            value = closure.call(params);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; value;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;p&gt;for memoized used following method to generate key:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; generateKey(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] args) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (args == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Collections.emptyList();
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; asList(args);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;is its returning as key ArrayList for which we have&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Compares the specified object with this list for equality. Returns true if and only if the specified object is also a list, both lists have the same size, and all corresponding pairs of elements in the two lists are equal. (Two elements e1 and e2 are equal if (e1==null ? e2==null : e1.equals(e2)).) In other words, two lists are defined to be equal if they contain the same elements in the same order.

This implementation first checks if the specified object is this list. If so, it returns true; if not, it checks if the specified object is a list. If not, it returns false; if so, it iterates over both lists, comparing corresponding pairs of elements. If any comparison returns false, this method returns false. If either iterator runs out of elements before the other it returns false (as the lists are of unequal length); otherwise it returns true when the iterations complete.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but actual problem in inject impl. itself for each iteration its modifying &apos;params&apos;, it means its modifying cache key itself for for Arrays.asList() we have:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;return a list view of the specified array
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14476814" author="armsargis" created="Thu, 27 Nov 2014 15:35:26 +0000"  >&lt;p&gt;I sent 2 pull requests with different fix:  &lt;a href=&quot;https://github.com/groovy/groovy-core/pull/542&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/groovy/groovy-core/pull/542&lt;/a&gt; or &lt;a href=&quot;https://github.com/groovy/groovy-core/pull/541&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/groovy/groovy-core/pull/541&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14476815" author="blackdrag" created="Mon, 1 Dec 2014 09:13:34 +0000"  >&lt;p&gt;pull request applied&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 51 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cfk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>