<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:22:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-5029] XmlSlurper does not close InputStream, leaks file handles/resources</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-5029</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; GPathResult parse(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File file) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException, SAXException {
  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; InputSource input = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InputSource(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(file));
    
    input.setSystemId(&lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;//&quot;&lt;/span&gt; + file.getAbsolutePath());
&lt;/span&gt;    
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; parse(input);
    
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I stepped through the SAX code but couldn&apos;t see the &lt;tt&gt;InputSource&lt;/tt&gt; being closed so &lt;tt&gt;XmlSlurper&lt;/tt&gt; is leaking file descriptors.&lt;/p&gt;

&lt;p&gt;I think the &lt;tt&gt;Reader&lt;/tt&gt; and &lt;tt&gt;InputStream&lt;/tt&gt; methods&apos; JavaDoc should also mention that the streams aren&apos;t closed.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;GPathResult parse(final String uri)&lt;/tt&gt; also seems to leak though that could also be a Xerces issue because I don&apos;t see it closing its input streams, either.&lt;/p&gt;

&lt;p&gt;Shameless plug: Use &lt;a href=&quot;http://johannburkard.de/blog/programming/java/centralizing-resource-closing.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Resource.close&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I tried to get the VM to crash. After checking &lt;tt&gt;ulimit -a&lt;/tt&gt;, I ran&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;5000.times { &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; XmlSlurper().parse(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&apos;web.xml&apos;&lt;/span&gt;)) }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This caused a lot of FileInputStreams to be created but I couldn&apos;t reach my limit of 1024 due to the finalizer in &lt;tt&gt;FileInputStream&lt;/tt&gt;. Still, in the screenshot below you can see how the &lt;tt&gt;FileInputStream&lt;/tt&gt; instances are accumulating on the heap.&lt;/p&gt;

&lt;p&gt;Fixing this is of course easy:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; GPathResult parse(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File file) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException, SAXException {
   FileInputStream in = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
   &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
     in = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(file);
     &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; InputSource input = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InputSource(in);
     input.setSystemId(&lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;//&quot;&lt;/span&gt; + file.getAbsolutePath());   
&lt;/span&gt;     &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; parse(input);
   }
   &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
     close(in); &lt;span class=&quot;code-comment&quot;&gt;// or &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (in != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; { in.close() } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException ex) {}
&lt;/span&gt;   }   
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12816242">GROOVY-5029</key>
            <summary>XmlSlurper does not close InputStream, leaks file handles/resources</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="johann">Johann</reporter>
                        <labels>
                            <label>inputstream</label>
                            <label>leak</label>
                            <label>resource</label>
                            <label>xml</label>
                            <label>xmlslurper</label>
                    </labels>
                <created>Fri, 16 Sep 2011 16:30:43 +0000</created>
                <updated>Sun, 5 Apr 2015 14:44:10 +0000</updated>
                            <resolved>Fri, 16 Sep 2011 20:14:38 +0000</resolved>
                                    <version>1.8.0</version>
                    <version>1.9-beta-3</version>
                                    <fixVersion>1.8.3</fixVersion>
                    <fixVersion>1.9-beta-4</fixVersion>
                    <fixVersion>1.7.11</fixVersion>
                                    <component>groovy-jdk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14479696" author="paulk" created="Fri, 16 Sep 2011 20:14:38 +0000"  >&lt;p&gt;Fixed. FileInputStream now closed. Javadocs added. Uri version I don&apos;t think is in our control, so it was left alone.&lt;/p&gt;</comment>
                            <comment id="14471708" author="johann" created="Sat, 17 Sep 2011 03:26:30 +0000"  >&lt;p&gt;Thanks Paul!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722901" name="resource-leak.png" size="22259" author="johann" created="Fri, 16 Sep 2011 16:30:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 10 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cb9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>