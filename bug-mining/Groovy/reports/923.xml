<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:11:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-3410] VerifyError appears with boolean method and long or larger primitive type in conditional operand of ternary statement</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-3410</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
&lt;span class=&quot;code-comment&quot;&gt;// generates error
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; id &lt;span class=&quot;code-comment&quot;&gt;// or &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; or &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;
&lt;/span&gt;    
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; bar() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (id ? &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
    }
}
Foo foo = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Foo()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;Running the above will result in the following exception:&lt;br/&gt;
java.lang.VerifyError: (class: Foo, method: bar signature: ()Z) Expecting to find integer on stack&lt;/p&gt;

&lt;p&gt;Declaring id as a float or double will also generate this error; however, if Foo.id is any other type (primitive or otherwise) then the script runs properly.  Similarly, explicitly casting Foo.id inside Foo.bar() does not generate this error:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
&lt;span class=&quot;code-comment&quot;&gt;// no VerifyError
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; id
    
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; bar() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;)id ? &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
    }
}

&lt;span class=&quot;code-comment&quot;&gt;// no VerifyError
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; id &lt;span class=&quot;code-comment&quot;&gt;// or &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; or &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt; or &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, etc.
&lt;/span&gt;    
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; bar() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; id ? &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; : &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 
</description>
                <environment>jdk1.6_12, Vista&lt;br/&gt;
&lt;br/&gt;
Groovy 1.6 console and Grails 1.1</environment>
        <key id="12814632">GROOVY-3410</key>
            <summary>VerifyError appears with boolean method and long or larger primitive type in conditional operand of ternary statement</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roshandawrani">Roshan Dawrani</assignee>
                                    <reporter username="hippyod">Evan Slatis</reporter>
                        <labels>
                    </labels>
                <created>Sun, 15 Mar 2009 17:34:23 +0000</created>
                <updated>Tue, 7 Apr 2009 23:33:18 +0000</updated>
                            <resolved>Wed, 18 Mar 2009 13:38:55 +0000</resolved>
                                    <version>1.6</version>
                                    <fixVersion>1.6.1</fixVersion>
                    <fixVersion>1.7-beta-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14466618" author="roshandawrani" created="Mon, 16 Mar 2009 13:32:49 +0000"  >&lt;p&gt;A very small addition. The method does not have to be boolean returning. Even the following fails with the same error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; id
    def bar() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (id ? &lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;)
    }
}   
println Foo.class
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14466715" author="roshandawrani" created="Mon, 16 Mar 2009 14:44:26 +0000"  >&lt;p&gt;All the following cases fail too:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; id = 0
    def bar() {
    	&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; id, &lt;span class=&quot;code-quote&quot;&gt;&quot;Done&quot;&lt;/span&gt;
    }
}   
println &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Foo().bar()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; id = 0
    def bar() {
        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;(id){
            print &lt;span class=&quot;code-quote&quot;&gt;&quot;here&quot;&lt;/span&gt;
            &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;
        }
    }
}   
println &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Foo().bar()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; id = 0
    def bar() {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(id) {
        	&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        	&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
        }
    }
}   
println &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Foo().bar()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, basically most of the places where boolean expressions are being evaluated. I am not 100% sure yet, but I think it is happening because jump instruction in all such cases is written as &quot;mv.visitJumpInsn(IFEQ, l0);&quot;, meaning read the value of the boolean expression off the stack as an int. If the value that is put on the stack is bigger than int, then all these cases run into issues.&lt;/p&gt;

&lt;p&gt;I am not much familiar with ASM and right now, I don&apos;t know if instead of IFEQ, we can use some other OpCode for larger-than-int types. If I come to know anything on that, I will write again. (I may be wrong on the above analysis - not much familiar with ASM !)&lt;/p&gt;</comment>
                            <comment id="14466728" author="roshandawrani" created="Wed, 18 Mar 2009 13:38:55 +0000"  >&lt;p&gt;Fixed.&lt;/p&gt;

&lt;p&gt;The bytecode instructions to do box/booleanUnbox were not getting written in the class in the scenarios identified in this JIRA.&lt;/p&gt;

&lt;p&gt;Before the change, for the boolean expression condition check, the bytecode instructions looked like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;4:   aload_0
5:   getfield    #50; &lt;span class=&quot;code-comment&quot;&gt;//Field id:J
&lt;/span&gt;8:   ifeq    17
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the above case, the class verification is failing because what is being stored on the stack is of type long but then it is read as in int in ifeq operation.&lt;/p&gt;

&lt;p&gt;After the fix, the bytecode instructions look like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;4:   aload_0
5:   getfield    #50; &lt;span class=&quot;code-comment&quot;&gt;//Field id:J
&lt;/span&gt;8:   invokestatic    #56; &lt;span class=&quot;code-comment&quot;&gt;//Method org/codehaus/groovy/runtime/typehandling/DefaultTypeTransformation.box:(J)Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;;
&lt;/span&gt;11:  invokestatic    #60; &lt;span class=&quot;code-comment&quot;&gt;//Method org/codehaus/groovy/runtime/typehandling/DefaultTypeTransformation.booleanUnbox:(Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;;)Z
&lt;/span&gt;14:  ifeq    23
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With the box/booleanUnbox, what ifeq sees is unboxed boolean value and it works fine.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 36 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2chdz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>