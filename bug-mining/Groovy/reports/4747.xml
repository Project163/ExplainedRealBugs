<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:23:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-7934] Type inference breaks for Collection.inject</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-7934</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The code below should not compile as the first parameter to the inject method must be a string, but the integer 0 is handed in:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
@CompileStatic
public static void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
    &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; inList = [&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;]
    &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; outList = inList.inject(0, { a, b -&amp;gt; a + &lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt; + b })
    println(outList)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I opened this issue as adviced in the reply to the same issue I asked on stackoverflow: &lt;a href=&quot;http://stackoverflow.com/questions/39444838/chance-for-this-hole-in-groovy-staic-typing-to-be-fixed/39446458#39446458&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/39444838/chance-for-this-hole-in-groovy-staic-typing-to-be-fixed/39446458#39446458&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Java streams example (from link):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; list = java.util.Arrays.asList(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; out = list.stream().reduce(0, (x,y) -&amp;gt; x + y);
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(out);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;NOTE: You can use java streams apis in groovy:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
@groovy.transform.CompileStatic
void test() {
  &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; list = [&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&apos;c&apos;&lt;/span&gt;]
  &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; str = list.stream().reduce(&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;, (x,y) -&amp;gt; x + y) &lt;span class=&quot;code-comment&quot;&gt;// STC error &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &quot;&lt;/span&gt;&quot; is 0
&lt;/span&gt;  println str
}
test()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13004262">GROOVY-7934</key>
            <summary>Type inference breaks for Collection.inject</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="OlliP">Oliver Holp</reporter>
                        <labels>
                            <label>CompileStatic</label>
                    </labels>
                <created>Mon, 12 Sep 2016 09:33:15 +0000</created>
                <updated>Wed, 20 Dec 2023 14:03:24 +0000</updated>
                                            <version>2.4.6</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17782901" author="emilles" created="Sat, 4 Nov 2023 16:19:34 +0000"  >&lt;p&gt;This is not so much a problem with the type checker as it is with the definition of inject. The method is declared &#8220;&amp;lt;E, T, U extends T, V extends T&amp;gt; T inject(Collection&amp;lt;E&amp;gt; c, U initialValue, Closure&amp;lt;V&amp;gt; xform)&#8221;. So there is no relationship between the collection elements and the initial value or combiner function. &lt;/p&gt;</comment>
                            <comment id="17782934" author="emilles" created="Sat, 4 Nov 2023 22:48:46 +0000"  >&lt;p&gt;I missed the ClosureParams metadata because it is not showing in the javadoc. (I&#8217;ll look into that.) It says the closure takes U and E as params. I think U should be V or T. &lt;/p&gt;

&lt;p&gt;This does not account for the cast exception. I&#8217;m checking on that still. &lt;/p&gt;</comment>
                            <comment id="17783275" author="emilles" created="Mon, 6 Nov 2023 16:30:19 +0000"  >&lt;p&gt;The approach taken by Java (aka &lt;tt&gt;Stream#reduce&lt;/tt&gt;) is to limit what the function can produce.&lt;/p&gt;

&lt;p&gt;The variant that does not take an initial value is constrained to the type of the array elements: &lt;tt&gt;Optional&amp;lt;T&amp;gt; reduce(BinaryOperator&amp;lt;T&amp;gt; accumulator)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;The next variant takes an initial value but it also is constrained to the type of the array elements: &lt;tt&gt;T reduce(T identity, BinaryOperator&amp;lt;T&amp;gt; accumulator)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;The last variant takes an initial value and opens up the result type: &lt;tt&gt;&amp;lt;U&amp;gt; U reduce(U identity, BiFunction&amp;lt;U, ? super T, U&amp;gt; accumulator, BinaryOperator&amp;lt;U&amp;gt; combiner)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Each of these relies on Java&apos;s strong typing so that invalid combinations of inputs and function(s) produce a compiler error.  Groovy being dynamic by default cannot make these guarantees, which is why (I think) &lt;tt&gt;inject&lt;/tt&gt; was declared as it is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;T, V &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; T&amp;gt; T inject(Collection&amp;lt;T&amp;gt; self, @ClosureParams(value=FromString.&lt;span class=&quot;code-keyword&quot;&gt;class,&lt;/span&gt;options=&lt;span class=&quot;code-quote&quot;&gt;&quot;V,T&quot;&lt;/span&gt;) Closure&amp;lt;V&amp;gt; closure)
&amp;lt;E, T, U &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; T, V &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; T&amp;gt; T inject(Collection&amp;lt;E&amp;gt; self, U initialValue, @ClosureParams(value=FromString.&lt;span class=&quot;code-keyword&quot;&gt;class,&lt;/span&gt;options=&lt;span class=&quot;code-quote&quot;&gt;&quot;U,E&quot;&lt;/span&gt;) Closure&amp;lt;V&amp;gt; closure)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ignoring the &lt;tt&gt;ClosureParams&lt;/tt&gt; metadata for a moment &amp;#8211; they were added for &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5924&quot; title=&quot;Provide a mechanism to allow the type checker to know what are the expected argument types of a closure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5924&quot;&gt;&lt;del&gt;GROOVY-5924&lt;/del&gt;&lt;/a&gt; &amp;#8211; the jist is that for the first variant the first element of the collection is the initial value, so closure is called with &quot;T,T&quot;.  After the first iteration the return value is fed back in, so the closure is called with &quot;V,T&quot;.  It is safe for the first closure parameter to have a type that is T or a super of T.  So the &quot;V&quot; in &lt;tt&gt;@ClosureParams(value=FromString.class,options=&quot;V,T&quot;)&lt;/tt&gt; is not correct IMO.  In addition, there is nothing in dynamic groovy constraining what is returned from the closure, so &quot;V extends T&quot; is wishful thinking.  I&apos;m not sure it is enforceable.&lt;/p&gt;

&lt;p&gt;The initial-value variant gets more complex since we introduce another type that is supposed to derive from &lt;tt&gt;T&lt;/tt&gt;, however we cannot guarantee what will come in there.  So again, &quot;U extends T&quot; is wishful thinking.&lt;/p&gt;</comment>
                            <comment id="17783280" author="emilles" created="Mon, 6 Nov 2023 16:49:04 +0000"  >&lt;p&gt;At best, we can say that &quot;T&quot; in variant one and &quot;E&quot; in variant two is the second parameter&apos;s type.  And we should be able to say that &quot;V&quot; &amp;#8211; the closure&apos;s return value &amp;#8211; is the first parameter type if we dropped the initial value business or made sure it was of type &quot;V&quot;.&lt;/p&gt;

&lt;p&gt;One breaking-change option is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;T, V&amp;gt; V inject(Collection&amp;lt;T&amp;gt; self,
  @ClosureParams(value=FromString,options=&lt;span class=&quot;code-quote&quot;&gt;&quot;? &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt; V,T&quot;&lt;/span&gt;) Closure&amp;lt;V&amp;gt; closure) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; inject(self, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, closure); &lt;span class=&quot;code-comment&quot;&gt;// Java&apos;s reduce does &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;
&lt;/span&gt;}
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;T, U &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; V, V&amp;gt; V inject(Collection&amp;lt;T&amp;gt; self, U initialValue,
  @ClosureParams(value=FromString,options=&lt;span class=&quot;code-quote&quot;&gt;&quot;? &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt; V,T&quot;&lt;/span&gt;) Closure&amp;lt;V&amp;gt; closure) {
    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; closure.getParameterTypes().length == 2;
    &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] params = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[2];
    V value = initialValue;
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (T thing : self) {
        params[0] = value; &lt;span class=&quot;code-comment&quot;&gt;// apply closure.getParameterTypes()[0].&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;()
&lt;/span&gt;        params[1] = thing; &lt;span class=&quot;code-comment&quot;&gt;// apply closure.getParameterTypes()[1].&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;()
&lt;/span&gt;        value = closure.call(params);
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; value;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &quot;? super T&quot; may be wishful thinking &amp;#8211; STC may not be able to handle this just yet.  This proposal is semantically different from the specification of the no-initial-value variant.  So it likely needs to have a new name, like &lt;tt&gt;foldLeft&lt;/tt&gt; or &lt;tt&gt;reduce&lt;/tt&gt; or whatever.  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulk&quot; class=&quot;user-hover&quot; rel=&quot;paulk&quot;&gt;paulk&lt;/a&gt; Thoughts?&lt;/p&gt;</comment>
                            <comment id="17783285" author="emilles" created="Mon, 6 Nov 2023 16:55:20 +0000"  >&lt;p&gt;Another way to go, if creating replacements for &lt;tt&gt;inject&lt;/tt&gt; would be to use functional interfaces instead of closures for the accumulator functions.&lt;/p&gt;</comment>
                            <comment id="17783598" author="paulk" created="Tue, 7 Nov 2023 12:20:35 +0000"  >&lt;p&gt;Yes, we need to fix the cast exception but I think it would be automatic if we fix &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5893&quot; title=&quot;Return type of &amp;quot;inject&amp;quot; is not inferred properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5893&quot;&gt;&lt;del&gt;GROOVY-5893&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The current ClosureParams seem okay to me give or take the missing functionality in &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5893&quot; title=&quot;Return type of &amp;quot;inject&amp;quot; is not inferred properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5893&quot;&gt;&lt;del&gt;GROOVY-5893&lt;/del&gt;&lt;/a&gt;. The tricky part is that when an initial value is supplied and the collection is empty, the initial value is returned. When no initial value is supplied and the collection has size 1, the first element is returned as is without calling the closure at all. So if &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5893&quot; title=&quot;Return type of &amp;quot;inject&amp;quot; is not inferred properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5893&quot;&gt;&lt;del&gt;GROOVY-5893&lt;/del&gt;&lt;/a&gt; was in place, we&apos;d calculate LUB of &quot;U,E&quot; for the Closure param and I&apos;d expect Serializable here.&lt;/p&gt;

&lt;p&gt;The inject function doesn&apos;t limit itself to homogenous types which is both its power (duck typing in dynamic mode) and its limitation in terms of static typing. This example (with the 0) is weirder than normal because of a legacy StringGroovyMethods#plus(Number, String) method we have from Groovy 1.0, which I still wonder whether was the right way to go.&lt;/p&gt;

&lt;p&gt;If we want to have a homogenous type variant, yes I would give a different name and use functional interfaces.&lt;/p&gt;</comment>
                            <comment id="17783694" author="emilles" created="Tue, 7 Nov 2023 16:41:12 +0000"  >&lt;p&gt;As noted in 5893, the closure param inference comes before the return type inference.  So it does not know &quot;String&quot; for &quot;V&quot; in these calls.  The reality is that integer comes in for the first iteration and string for all subsequent calls.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
    void testPlusInClosure2() {
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (type &lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; [&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt;&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;var&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Serializable&apos;&lt;/span&gt;]) {
            assertScript &quot;&quot;&quot;
                &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] array = [&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;3&apos;&lt;/span&gt;]
                $type  joinViaInject = array.inject(0, { x,y -&amp;gt; (x + &lt;span class=&quot;code-quote&quot;&gt;&apos;,&apos;&lt;/span&gt; + y) })
                &lt;span class=&quot;code-comment&quot;&gt;//                     integer or string ^ ^ string
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; joinViaInject == &lt;span class=&quot;code-quote&quot;&gt;&apos;0,1,2,3&apos;&lt;/span&gt;
            &quot;&quot;&quot;
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The inference in &lt;tt&gt;StaticTypeCheckingVisitor&lt;/tt&gt; knows &quot;E=String, U=Integer&quot; and then a call to &lt;tt&gt;extractGenericsConnectionsForBoundTypes&lt;/tt&gt; adds &quot;T=Integer&quot; because it does not have a &quot;V&quot; to blend with the &quot;U&quot;.  So the cast exception comes when the string comes back in for a parameter that was forced to have integer type.&lt;/p&gt;

&lt;p&gt;Under &lt;tt&gt;@TypeChecked&lt;/tt&gt; I have the return value worked out to &lt;tt&gt;Serializable&lt;/tt&gt; because it knows the closure return type at that time.&lt;/p&gt;</comment>
                            <comment id="17783716" author="emilles" created="Tue, 7 Nov 2023 17:34:04 +0000"  >&lt;p&gt;I took a shot at changing the array-based inject methods and I think I understand why the ClosureParams were set as they are. As shown in the example above, integer or string can come in for the first closure parameter, which is &quot;U&quot; or &quot;V&quot;. So I put &quot;T&quot; instead of &quot;U&quot;. However as discussed above and elsewhere the type of &quot;V&quot; cannot be worked out for the purposes of closure param types, but can for return value inference. But &quot;U&quot; can be worked out quite easily.&lt;/p&gt;

&lt;p&gt;So as long as the user picks &quot;U&quot; and &quot;V&quot; that are very close, no STC worries. It is only scenarios like the one for this ticket (&quot;U=Integer, V=String, T=Serializable&quot;) that inference fails us. Switching &quot;U&quot; to &quot;T&quot; is more accurate, but cannot be inferenced presently.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;E, T, U &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; T, V &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; T&amp;gt; T inject(E[] self, U initialValue,
      @ClosureParams(value=FromString.&lt;span class=&quot;code-keyword&quot;&gt;class,&lt;/span&gt;options=&lt;span class=&quot;code-quote&quot;&gt;&quot;T,E&quot;&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;/*was U,E*/&lt;/span&gt;) Closure&amp;lt;V&amp;gt; closure) {
        T value = initialValue;
        &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] params = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[2];
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; self.length; i += 1) {
            params[0] = value;
            params[1] = self[i];
            value = closure.call(params);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; value;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17788826" author="emilles" created="Wed, 22 Nov 2023 16:23:30 +0000"  >&lt;p&gt;Changing the closure param type from U to T, there is still a cast exception for SC.  STC works out that &quot;U=Integer&quot; but has no info for &quot;V&quot; since param inference comes before return type inference.  When &lt;tt&gt;extractGenericsConnectionsForBoundTypes&lt;/tt&gt; tries to work out &quot;T&quot; from &quot;U extends T&quot; and &quot;V extends T&quot;, it only knows about U and sets T to &lt;tt&gt;Integer&lt;/tt&gt;.  So the cast exception remains.  I tried clearing T when multiple type vars tell you about T but not all are resolved.  This brought back errors described in &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5893&quot; title=&quot;Return type of &amp;quot;inject&amp;quot; is not inferred properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5893&quot;&gt;&lt;del&gt;GROOVY-5893&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-6504&quot; title=&quot;Type checker select the wrong inject method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-6504&quot;&gt;&lt;del&gt;GROOVY-6504&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17789210" author="emilles" created="Thu, 23 Nov 2023 16:25:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/7e0471f7ff2e1cfbf77f67997e605990d6ed19f3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/7e0471f7ff2e1cfbf77f67997e605990d6ed19f3&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17799023" author="emilles" created="Wed, 20 Dec 2023 14:03:24 +0000"  >&lt;p&gt;The initial comment that the code should not compile is not recommended. The &lt;tt&gt;inject&lt;/tt&gt; method allows the initial value and the total value (&lt;tt&gt;U&lt;/tt&gt; and &lt;tt&gt;V&lt;/tt&gt; respectively) to differ. And the relation between them is captured by the type variable &lt;tt&gt;T&lt;/tt&gt;.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;E, T, U &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; T, V &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; T&amp;gt; T inject(Iterable&amp;lt;E&amp;gt; self, U initialValue,
    @ClosureParams(value=FromString.&lt;span class=&quot;code-keyword&quot;&gt;class,&lt;/span&gt;options=&lt;span class=&quot;code-quote&quot;&gt;&quot;T,E&quot;&lt;/span&gt;) Closure&amp;lt;V&amp;gt; closure)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So in the original example, &lt;tt&gt;U&lt;/tt&gt; is given as &lt;tt&gt;Integer&lt;/tt&gt; and &lt;tt&gt;V&lt;/tt&gt; is given as &lt;tt&gt;String&lt;/tt&gt;. So &lt;tt&gt;T&lt;/tt&gt; (the type of &quot;outList&quot;) is &lt;tt&gt;LUB(Integer,String)&lt;/tt&gt; which is &lt;tt&gt;java.io.Serializable&lt;/tt&gt;.  (Ignore the type argument in the screenshot for the moment.)&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13065470/13065470_screenshot-1.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12816646">GROOVY-5893</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12817278">GROOVY-6504</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12816640">GROOVY-5924</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13065470" name="screenshot-1.png" size="17159" author="emilles" created="Wed, 20 Dec 2023 13:59:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 46 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33ign:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>