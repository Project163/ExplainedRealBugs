<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:15:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-7473] inefficient code generation</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-7473</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Groovy 2.4.3 generates not the most efficient byte code of a simple statement like &quot;in&quot;.&lt;/p&gt;

&lt;p&gt;e.g. The following statement:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; object.stringProperty &lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; [&lt;span class=&quot;code-quote&quot;&gt;&quot;State1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;State2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;State3&quot;&lt;/span&gt;]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;gets complied in:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (DefaultTypeTransformation.booleanUnbox((ScriptBytecodeAdapter.createList(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] { &lt;span class=&quot;code-quote&quot;&gt;&quot;State1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;State2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;State3&quot;&lt;/span&gt; }) == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? 1 : 0) != 0 ? &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;.valueOf(object.getStringProperty() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) : &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;.valueOf(DefaultGroovyMethods.isCase(ScriptBytecodeAdapter.createList(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] { &lt;span class=&quot;code-quote&quot;&gt;&quot;State1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;State2 &quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;State3&quot;&lt;/span&gt; }), object. getStringProperty ()))))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;instead of this a more efficient construct would be the usage of an static list&lt;br/&gt;
e.g.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; l1;
&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; {
        l1 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LinkedList&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;();
        l1.add(&lt;span class=&quot;code-quote&quot;&gt;&quot;State1&quot;&lt;/span&gt;);
        l1.add(&lt;span class=&quot;code-quote&quot;&gt;&quot;State2&quot;&lt;/span&gt;);
        l1.add(&lt;span class=&quot;code-quote&quot;&gt;&quot;State3&quot;&lt;/span&gt;);
}

&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (DefaultTypeTransformation.booleanUnbox((l1 == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? 1 : 0) != 0 ? &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;.valueOf(object.getStringProperty() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) : &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;.valueOf(DefaultGroovyMethods.isCase(l1, object. getStringProperty ()))))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12839479">GROOVY-7473</key>
            <summary>inefficient code generation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="l.tontsch">Laurenz Tontsch</reporter>
                        <labels>
                            <label>bytecode</label>
                    </labels>
                <created>Mon, 22 Jun 2015 08:18:11 +0000</created>
                <updated>Tue, 24 Jan 2023 18:32:45 +0000</updated>
                            <resolved>Fri, 19 Nov 2021 22:30:39 +0000</resolved>
                                    <version>2.4.3</version>
                                    <fixVersion>4.0.0-rc-1</fixVersion>
                                    <component>bytecode</component>
                    <component>Compiler</component>
                    <component>Static compilation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14595544" author="blackdrag" created="Mon, 22 Jun 2015 09:06:24 +0000"  >&lt;p&gt;I was about to rant about the disassembler you used and that it does translate to very strange Java, but then I had the idea, that your code is maybe meant to be static compiled. And there it shows indeed the double creation of the list. Normal Groovy creates the list only once. &lt;/p&gt;

&lt;p&gt;As for putting the list in a static field... I could ask why for example Java doesn&apos;t do that for arrays. I am not sure it is always legal to do so.&lt;/p&gt;</comment>
                            <comment id="14629713" author="han.hu" created="Thu, 16 Jul 2015 13:27:42 +0000"  >&lt;p&gt;Hi Jochen,&lt;/p&gt;

&lt;p&gt;thanks for your reply.&lt;/p&gt;

&lt;p&gt;Yes, indeed. The code above is generated from static compilation.&lt;/p&gt;

&lt;p&gt;Can you please elaborate a bit more on &quot;I could ask why for example Java doesn&apos;t do that for arrays.&quot;&lt;/p&gt;

&lt;p&gt;Thanks and regards&lt;/p&gt;</comment>
                            <comment id="14629748" author="blackdrag" created="Thu, 16 Jul 2015 13:45:21 +0000"  >&lt;p&gt;Because an array is a mutable structure, even if it is handled slightly different than other mutable structures. That means I cannot see an array as constant and give it for example as argument to some method and expect I can reuse it later, because the method may change array elements. Lists are no better and we don&apos;t have the semantics that support the usage of constant lists in this case. So how can we be sure the method backing &quot;in&quot; will not mutate the list?&lt;/p&gt;</comment>
                            <comment id="14649188" author="han.hu" created="Fri, 31 Jul 2015 12:54:37 +0000"  >&lt;p&gt;In general we agree with your statement that the list could be mutated by a method and thus we cannot expect to just reuse it later. However in this case, Groovy is creating a list just temporarily for its own purposes and has full control over what its methods (e.g. DefaultGroovyMethods.isCase() or DefaultTypeTransformation.booleanUnbox()) are doing with the list.&lt;/p&gt;

&lt;p&gt;How about Collections. unmodifiableList(), would that help?&lt;/p&gt;

&lt;p&gt;Another possible option may be to use switch-case as optimized implementation for the case when all values inside the list of the &quot;in&quot;-construct are of primitive types or type String (probably quite often)? &lt;/p&gt;</comment>
                            <comment id="14650165" author="blackdrag" created="Sat, 1 Aug 2015 05:56:12 +0000"  >&lt;p&gt;Ok, I kind of forgot we are talking about static compilation and not standard Groovy. Because in standard Groovy you can do something like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def bool1 = &lt;span class=&quot;code-quote&quot;&gt;&quot;s&quot;&lt;/span&gt; in [&lt;span class=&quot;code-quote&quot;&gt;&quot;State1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;State2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;State3&quot;&lt;/span&gt;]
ArrayList.metaClass.isCase = {&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; o -&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}
def bool2 = &lt;span class=&quot;code-quote&quot;&gt;&quot;s&quot;&lt;/span&gt; in [&lt;span class=&quot;code-quote&quot;&gt;&quot;State1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;State2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;State3&quot;&lt;/span&gt;]
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; bool1 != bool2&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In such a case we would not be able to ensure the list is not modified. Now in static compilation runtime meta programming is of course not a deciding factor, but you can still have a different isCase method being applied, if you provide an extension method with fitting signature at compile time.&lt;/p&gt;

&lt;p&gt;How is the compiler supposed to know it can make the list literal into something like a constant? So far your suggestion would mean a special case for list and isCase&lt;/p&gt;</comment>
                            <comment id="17446604" author="emilles" created="Fri, 19 Nov 2021 17:47:31 +0000"  >&lt;p&gt;&lt;tt&gt;BinaryExpressionTransformer#convertInOperatorToTernary&lt;/tt&gt; changes &quot;o.p in &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;x&amp;#39;,&amp;#39;y&amp;#39;,&amp;#39;z&amp;#39;&amp;#93;&lt;/span&gt;&quot; to &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;x&amp;#39;,&amp;#39;y&amp;#39;,&amp;#39;z&amp;#39;&amp;#93;&lt;/span&gt; == null ? o.p == null : &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;x&amp;#39;,&amp;#39;y&amp;#39;,&amp;#39;z&amp;#39;&amp;#93;&lt;/span&gt;.isCase(o.p)&quot;. This could be made simpler for the times where right expression cannot be null.&#160; And if &lt;tt&gt;isCase&lt;/tt&gt; is overridden for &lt;tt&gt;NullObject&lt;/tt&gt;, it could be &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;x&amp;#39;,&amp;#39;y&amp;#39;,&amp;#39;z&amp;#39;&amp;#93;&lt;/span&gt;?.isCase(o.p)&quot; instead of a ternary.&lt;/p&gt;</comment>
                            <comment id="17446683" author="emilles" created="Fri, 19 Nov 2021 22:30:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/51749380ff43d1cdfb3164c3a9e858c9d5573b9d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/51749380ff43d1cdfb3164c3a9e858c9d5573b9d&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13520825">GROOVY-10909</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12816946">GROOVY-6137</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 51 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2gbpj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>