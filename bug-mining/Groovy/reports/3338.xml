<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:57:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-8467] IOGroovyMethods class readLine method works unexpected in  </title>
                <link>https://issues.apache.org/jira/browse/GROOVY-8467</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;i have a android aapt dump file&lt;/p&gt;

&lt;p&gt;i try to read the file use the code below:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
InputStreamReader inputReader = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InputStreamReader(dumpFile)
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; line = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; ((line = inputReader.readLine()) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;){
    println(line)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;the dumpfile uses \r\n to start a new line, while the&#160;IOGroovyMethods&lt;/p&gt;

&lt;p&gt;readLineFromReaderWithoutMark method which called by readLine &#160;method&#160; is :&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; readLineFromReaderWithoutMark(Reader input) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; c = input.read();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(c == -1) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        StringBuilder line;
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(line = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringBuilder(expectedLineLength); c != EOF &amp;amp;&amp;amp; c != 10 &amp;amp;&amp;amp; c != 13; c = input.read()) {
            &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt; ch = (&lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt;)c;
            line.append(ch);
        }

        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; line.toString();
    }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;this casues an extra empty line read.&lt;/p&gt;</description>
                <environment>windows 7</environment>
        <key id="13135674">GROOVY-8467</key>
            <summary>IOGroovyMethods class readLine method works unexpected in  </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="zhuxiaobing">zhuxiaobing</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Feb 2018 03:45:35 +0000</created>
                <updated>Mon, 12 Feb 2018 02:04:13 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16350213" author="blackdrag" created="Fri, 2 Feb 2018 12:02:22 +0000"  >&lt;p&gt;I think this behaves then similar to the readLine from Java, which also covers with &lt;a href=&quot;https://en.wikipedia.org/wiki/Newline&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://en.wikipedia.org/wiki/Newline&lt;/a&gt;&#160;If the apt-guys decided to start a line with a linebreak, then this is actually the correct behaviour of readLine. So maybe it is behaving wrong for apt, but it is behaving correct for every windows text file.&lt;/p&gt;</comment>
                            <comment id="16352054" author="zhuxiaobing" created="Mon, 5 Feb 2018 05:35:02 +0000"  >&lt;p&gt;in the link&#160;&lt;a href=&quot;https://en.wikipedia.org/wiki/Newline&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://en.wikipedia.org/wiki/Newline&lt;/a&gt;&#160; &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12909182/12909182_Screenshot+from+2018-02-05+13-30-03.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;br/&gt;
 you can see&#160;windows uses CR+LF to create a new line, so , aapt is not behaving wrong.&lt;/p&gt;</comment>
                            <comment id="16352086" author="zhuxiaobing" created="Mon, 5 Feb 2018 07:10:49 +0000"  >&lt;p&gt;this is demo run in windows and linux&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12909184/12909184_groovy_test_linux.zip&quot; title=&quot;groovy_test_linux.zip attached to GROOVY-8467&quot;&gt;groovy_test_linux.zip&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12909185/12909185_groovy_test_win.zip&quot; title=&quot;groovy_test_win.zip attached to GROOVY-8467&quot;&gt;groovy_test_win.zip&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&#160;result is different&lt;/p&gt;</comment>
                            <comment id="16353786" author="blackdrag" created="Tue, 6 Feb 2018 12:12:34 +0000"  >&lt;p&gt;I think I see the problem now. If we read A\r\nB\r\n, then readLine will make first a line for A and then the expectation is to have the next line for B. The loop up there will only consume the \r, not the \n. And this leads to an empty line. So reading all lines will produce A, empty, B empty. Is that correct?&lt;/p&gt;</comment>
                            <comment id="16353849" author="paulk" created="Tue, 6 Feb 2018 13:00:16 +0000"  >&lt;p&gt;Workaround: use readLines() or eachLine&#160;{ ... } (but they won&apos;t give you the same level of streaming capability) or a reader with mark supported. The comment on that method indicates that this is a known design limitation:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    /*
    * This method reads without a buffer.
    * It returns too many empty lines &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; \r\n combinations
    * are used. Nothing can be done because we can&apos;t push
    * back the character we have just read.
    */
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; readLineFromReaderWithoutMark(Reader input)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I guess it should read &quot;... nothing simple can be done ...&quot;.&lt;/p&gt;</comment>
                            <comment id="16355095" author="zhuxiaobing" created="Wed, 7 Feb 2018 07:53:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blackdrag&quot; class=&quot;user-hover&quot; rel=&quot;blackdrag&quot;&gt;blackdrag&lt;/a&gt; yes, you are correct, this is what i want to say.&#160;&lt;/p&gt;</comment>
                            <comment id="16355118" author="zhuxiaobing" created="Wed, 7 Feb 2018 08:22:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulk&quot; class=&quot;user-hover&quot; rel=&quot;paulk&quot;&gt;paulk&lt;/a&gt;&#160;i read the code again , i see &apos;&apos;.. nothing can be done ..&apos;&lt;/p&gt;</comment>
                            <comment id="16355120" author="zhuxiaobing" created="Wed, 7 Feb 2018 08:23:43 +0000"  >&lt;p&gt;maybe this function should be removed&lt;/p&gt;</comment>
                            <comment id="16355331" author="paulk" created="Wed, 7 Feb 2018 11:30:42 +0000"  >&lt;p&gt;It&apos;s arguably not wrong - just that we don&apos;t have control over the Reader. Perhaps we could provide something like the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;PlatformReader &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Reader {
  PlatformReader(Reader delegate) {
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.delegate = delegate
  }
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Reader delegate
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; buf
  &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; read() {
    def result = buf
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (buf != -1) {
      buf = &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.read()
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (result == 13 &amp;amp;&amp;amp; buf == 10) {
        result = buf
        buf = &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.read()
      }
    }
    result
  }
  &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; read(&lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt;[] buf, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; offset, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; count) {
    delegate.read(buf, offset, count)
  }
  void close() {
    delegate.close()
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then change the groovydoc for &lt;tt&gt;readLine()&lt;/tt&gt; to suggest wrapping your reader if you are on a platform that uses &quot;\r\n&quot; combinations.&lt;/p&gt;</comment>
                            <comment id="16356042" author="blackdrag" created="Wed, 7 Feb 2018 20:41:05 +0000"  >&lt;p&gt;I might be wrong, but Java readLine swallows any line ending on any platform. I do not have to be on windows to be able to read a text file with windows line endings correctly. I guess the problem is that not knowing if the line ending is \r (Mac) or \r\n (Windows) is a problem, since it requires reading the character after \r and if the stream does not support marking, you cannot go back again.&lt;/p&gt;</comment>
                            <comment id="16356412" author="paulk" created="Thu, 8 Feb 2018 02:45:00 +0000"  >&lt;p&gt;That&apos;s why Java&apos;s readLine() is only available on BufferedReader which will also work fine with Groovy. I believe the thinking at the time was to still provide a streaming option for a vanilla Reader but it was very much a user be aware of what you are doing scenario. The groovydoc doesn&apos;t really reflect that - so as a minimum it should be updated.&lt;/p&gt;</comment>
                            <comment id="16356918" author="paulk" created="Thu, 8 Feb 2018 13:07:20 +0000"  >&lt;p&gt;I have changed the javadoc to better reflect the behavior of this method.&lt;/p&gt;</comment>
                            <comment id="16357823" author="zhuxiaobing" created="Fri, 9 Feb 2018 01:48:54 +0000"  >&lt;p&gt;six six six&lt;/p&gt;</comment>
                            <comment id="16357825" author="zhuxiaobing" created="Fri, 9 Feb 2018 01:52:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulk&quot; class=&quot;user-hover&quot; rel=&quot;paulk&quot;&gt;paulk&lt;/a&gt;&#160;why keep this design limination instead of remove it?&lt;/p&gt;</comment>
                            <comment id="16357840" author="daniel_sun" created="Fri, 9 Feb 2018 02:17:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhuxiaobing&quot; class=&quot;user-hover&quot; rel=&quot;zhuxiaobing&quot;&gt;zhuxiaobing&lt;/a&gt; 666? haha&lt;/p&gt;</comment>
                            <comment id="16357875" author="zhuxiaobing" created="Fri, 9 Feb 2018 03:38:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daniel_sun&quot; class=&quot;user-hover&quot; rel=&quot;daniel_sun&quot;&gt;daniel_sun&lt;/a&gt; haha&lt;/p&gt;</comment>
                            <comment id="16357877" author="paulk" created="Fri, 9 Feb 2018 03:43:25 +0000"  >&lt;p&gt;There isn&apos;t really a way to fix it, so it would just be a matter of deprecating it or throwing an exception if it was ever used with a Reader not supporting &lt;tt&gt;mark()&lt;/tt&gt;. But if someone does have such a reader and know what they are doing, it is still useful functionality.&lt;/p&gt;</comment>
                            <comment id="16357973" author="zhuxiaobing" created="Fri, 9 Feb 2018 06:19:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulk&quot; class=&quot;user-hover&quot; rel=&quot;paulk&quot;&gt;paulk&lt;/a&gt; throw an exception is a good idea&lt;/p&gt;</comment>
                            <comment id="16360214" author="paulk" created="Mon, 12 Feb 2018 02:04:13 +0000"  >&lt;p&gt;Possibly. It just penalises someone say on a Linux system that knows they are processing files generated on that system and wants to use a vanilla Reader.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12909182" name="Screenshot from 2018-02-05 13-30-03.png" size="18029" author="zhuxiaobing" created="Mon, 5 Feb 2018 05:32:50 +0000"/>
                            <attachment id="12909184" name="groovy_test_linux.zip" size="569" author="zhuxiaobing" created="Mon, 5 Feb 2018 07:10:25 +0000"/>
                            <attachment id="12909185" name="groovy_test_win.zip" size="726" author="zhuxiaobing" created="Mon, 5 Feb 2018 07:10:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 40 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3pp3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>