<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:56:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-861] Expclit Groovy Types or embedding in Tomcat</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-861</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>
&lt;ul&gt;
	&lt;li&gt;Alan &amp;lt;alan-groovy-user@engrm.com&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;2005-06-03 14:57&amp;#93;&lt;/span&gt;:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&amp;gt;&amp;gt; * Alan &amp;lt;alan-groovy-user@engrm.com&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;2005-05-21 12:31&amp;#93;&lt;/span&gt;:&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt; * Christof Vollrath &amp;lt;christof@taobits.net&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;2005-05-20 15:13&amp;#93;&lt;/span&gt;:&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt; &amp;gt; &amp;gt; I had the same problem while developping GvTags (www.gvtags.org).&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt; &amp;gt; &amp;gt; I solved it by writing a proxy object for HttpServletRequest in Java,&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt; &amp;gt; &amp;gt; which accesses HttpServletRequest and is included in my application,&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt; &amp;gt; &amp;gt; so that it can be accessed by Groovy.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; &amp;gt; &amp;gt; This is much better then turning bytecode compilation off.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt; &amp;gt; &amp;gt; But I would be happy if you find a solution without the need for&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt;&amp;gt; &amp;gt; &amp;gt; a proxy object.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;&amp;gt; &amp;gt; The following is a bunch of guessing. Not wild guesses, I don&apos;t  &lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     think, reasonable guesses, but I&apos;ve not read through the source&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     code for Groovy nor Tomcat. I claim no experience, nor&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     authority.&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt; &lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt; The Groovy ClassLoader (this is a guess) gets a copy of the class&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     file as a stream, using the ClassLoader().getResource() method.&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     It then runs it through ASM to generate bytecode for a proxy&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     object that supports the GroovyObject interface. &lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt; &lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     Tomcat has a special class loader (guessing) to support the&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     class loading requirements of web applications, each web&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     application can have it&apos;s own class path. The servlet class&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     loader and the Tomcat application class loader share an instance&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     of the interface HttpServletRequest (and friends), but the&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     implementation is not available as a class file to the servlet&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     class loader. Only the class in memory.&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt; &lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     The easy solution was to put a set of proxy classes in place,&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     since their bytecode will be avaialable to the servlet class&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     loader. This makes the problem go away. It is very easy to do. I&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     knocked out all the proxy objects using Eclipse&apos;s refactoring&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     tricks. It would be a nice to have for the Groovy servlet. We&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     could add a switch to use reflection or use proxies. It is&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     better than turning bytecode compilation off.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;&amp;gt; &amp;gt; Then to go without the proxy object requires looking at the class&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     loader implementation in Tomcat. The class file is probably&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     available through the parent class loader. However the parent&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     class loader is probably protected by Java security. For all I&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     know, Groovy might already make the attempt to search the parent&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     class loader, but backs off quietly on a security exception.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;&amp;gt; &amp;gt;     Including the Tomcat jars in a web application archive is a&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     non-starter. A very broken solution.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;&amp;gt; &amp;gt;     Another solution might be to create a GroovyObject around the&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     interface, so that the Groovy code:&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;&amp;gt; &amp;gt;     HttpSession session = request.getSession()&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     Would create a GroovyObject that wraps the HttpSession&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     interface, rather than the actual implementation. This is what I&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; &amp;gt;     expected to happen when I added the explicit casts.&lt;/p&gt;


&lt;p&gt;&amp;gt;&amp;gt;     This last part here, am I on the right track?&lt;/p&gt;


&lt;p&gt;    I&apos;m thinking that you&apos;d want to have the nice features of&lt;br/&gt;
    Groovy&apos;s full reflection when you can have them.&lt;/p&gt;

&lt;p&gt;    ---- In Java    ----&lt;/p&gt;

&lt;p&gt;    import com.fubar.Foo;&lt;br/&gt;
    import com.fubar.Bar;&lt;br/&gt;
    import com.fubar.Fubar;&lt;/p&gt;

&lt;p&gt;    Foo foo = new Fubar();&lt;br/&gt;
    Bar bar = (Bar) foo;&lt;/p&gt;

&lt;p&gt;    bar.bar();&lt;/p&gt;

&lt;p&gt;    ---- In Groovy  ----&lt;/p&gt;

&lt;p&gt;    import com.fubar.Foo;&lt;br/&gt;
    import com.fubar.Fubar;&lt;/p&gt;

&lt;p&gt;    Foo foo = new Fubar()&lt;br/&gt;
    foo.bar()&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;    Thus, the current design, where the GroovyObject is devined from&lt;br/&gt;
    the bytecode of the class file is probably correct.&lt;/p&gt;

&lt;p&gt;    The ideas I had before about casts being explicit, probably not&lt;br/&gt;
    so hot, unless there is a way in groovy of specifying &lt;b&gt;any&lt;/b&gt;.&lt;/p&gt;


&lt;p&gt;    def doFoo(foo)&lt;/p&gt;
    {
        foo.bar() 
    }

&lt;p&gt;    def doFoo(Foo foo)&lt;/p&gt;
    {
        foo.bar()       // Exception raised.
    }

&lt;p&gt;    Otherwise, I&apos;d imagine that it is done in the class loader,&lt;br/&gt;
    which could fall back to reflection if the bytecode for the&lt;br/&gt;
    underlying object could not be found. And by falling back to&lt;br/&gt;
    refelction, I&apos;d imagine that it would only use reflection to&lt;br/&gt;
    enumerate the interfaces and base classes, and create a&lt;br/&gt;
    GroovyObject that implements as many as are available.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12812862">GROOVY-861</key>
            <summary>Expclit Groovy Types or embedding in Tomcat</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="sormuras">sormuras</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Jun 2005 17:47:31 +0000</created>
                <updated>Fri, 1 Jul 2005 03:44:29 +0000</updated>
                            <resolved>Thu, 30 Jun 2005 12:45:22 +0000</resolved>
                                    <version>1.0-JSR-1</version>
                                    <fixVersion>1.0-JSR-3</fixVersion>
                                    <component>bytecode</component>
                    <component>class generator</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14460911" author="sormuras" created="Fri, 3 Jun 2005 17:51:58 +0000"  >&lt;p&gt;Created the issue for not losing the information gathered and solutions proposed. Alan and me need some feedback from old Groovy hands and heads first. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14461078" author="sormuras" created="Sat, 4 Jun 2005 23:44:32 +0000"  >&lt;p&gt;Still collection information, Oyvind wrote:&lt;/p&gt;

&lt;p&gt;Yes, here is the stacktrace. What I observe is that Tomcat set up different &lt;br/&gt;
classloaders for web-apps than for the container and that is the way it.&lt;br/&gt;
should be. Webapps should not need to know about the internal Tomcat &lt;br/&gt;
classes like e.g. ResponseFacade, but it should be enough to know the&lt;br/&gt;
interface HttpServletResponse. &lt;/p&gt;

&lt;p&gt;What Groovy seem to do is to generate a reflector using the ResponseFacade &lt;br/&gt;
(gjdk.org.apache.catalina.connector.HttpResponseFacade_GroovyReflector), &lt;br/&gt;
instead of the HttpServletResponse interface.  &lt;/p&gt;

&lt;p&gt;I put everything in a jar file, and subfolders inside the jar&lt;br/&gt;
corresponding to the package hierarchy.&lt;/p&gt;

&lt;p&gt;Regards&lt;br/&gt;
&#216;yvind&lt;br/&gt;
---------&lt;br/&gt;
java.lang.NoClassDefFoundError: org/apache/catalina/connector/ResponseFacade&lt;br/&gt;
        at &lt;br/&gt;
gjdk.org.apache.catalina.connector.HttpResponseFacade_GroovyReflector.invoke(Unknown &lt;br/&gt;
Source)&lt;br/&gt;
 at groovy.lang.MetaMethod.invoke(MetaMethod.java:110)&lt;br/&gt;
 at groovy.lang.MetaClass.doMethodInvoke(MetaClass.java:1386)&lt;br/&gt;
 at groovy.lang.MetaClass.invokeMethod(MetaClass.java:309)&lt;br/&gt;
 at org.codehaus.groovy.runtime.Invoker.invokeMethod(Invoker.java:145)&lt;br/&gt;
 at org.codehaus.groovy.runtime.InvokerHelper.invokeMethod(InvokerHelper.java:104)&lt;br/&gt;
 at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.invokeMethod(ScriptBytecodeAdapter.java:85)&lt;br/&gt;
 at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.invokeNoArgumentsMethod(ScriptBytecodeAdapter.java:154)&lt;br/&gt;
        at wcomp.gfunc.Test.execute(Unknown Source)&lt;br/&gt;
        at wcomp.core.SumFunc.execute(SumFunc.java:55)&lt;br/&gt;
        at wcomp.ScriptServlet.doContent(ScriptServlet.java:137)&lt;br/&gt;
        at wcomp.ScriptServlet.doGet(ScriptServlet.java:59)&lt;br/&gt;
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:748)&lt;br/&gt;
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:853)&lt;br/&gt;
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:200)&lt;/p&gt;</comment>
                            <comment id="14461056" author="sormuras" created="Sat, 4 Jun 2005 23:47:35 +0000"  >&lt;p&gt;And another one from Oyvind:&lt;/p&gt;

&lt;p&gt;Now, I fully understand what happens. The Invoker.InvokeMethod in the&lt;br/&gt;
Groovy runtime uses object.getClass() to get the class of the object &lt;br/&gt;
which is used to generate a reflector. Of course, getClass() returns &lt;br/&gt;
the implementing class, not the declared type, and in my case the &lt;br/&gt;
implementing class wasn&apos;t directly available. &lt;/p&gt;

&lt;p&gt;My workaround is simply to write a wrapper method in Java: &lt;/p&gt;

&lt;p&gt;  public static PrintWriter getWriter(HttpServletResponse res)&lt;br/&gt;
        throws IOException&lt;/p&gt;
  {
      return res.getWriter(); 
  }

&lt;p&gt;In the Groovy program i replace&lt;br/&gt;
       out = res.getWriter(); &lt;br/&gt;
with&lt;br/&gt;
       out = getWriter(res); &lt;/p&gt;

&lt;p&gt;And it works. &lt;/p&gt;

&lt;p&gt;Regards&lt;br/&gt;
&#216;yvind&lt;/p&gt;

&lt;p&gt;The snippet looks like:&lt;/p&gt;

&lt;p&gt;public class Test...&lt;br/&gt;
{ &lt;br/&gt;
   ...&lt;br/&gt;
    public void execute (HttpServletRequest req, HttpServletResponse res)&lt;br/&gt;
    {&lt;br/&gt;
	try &lt;/p&gt;
	{
             out = getWriter(res);    
             out.println(&quot;Hello, this is the groovy test function&quot;);
	}
&lt;p&gt;	catch (Throwable e)&lt;/p&gt;
	   { ... } 
&lt;p&gt;    }&lt;br/&gt;
}&lt;/p&gt;</comment>
                            <comment id="14461025" author="sormuras" created="Sat, 4 Jun 2005 23:51:18 +0000"  >&lt;p&gt;And a last one from Alan:&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt; I tested by calling it from my Groovy function, before I use the&lt;br/&gt;
&amp;gt;&amp;gt; the response object. My Groovy code is called from a Java servlet. &lt;br/&gt;
&amp;gt;&amp;gt; The call can be done from the Java code as well like done in the&lt;br/&gt;
&amp;gt;&amp;gt; GroovyServlet class.&lt;br/&gt;
&amp;gt;&amp;gt; &lt;br/&gt;
&amp;gt;&amp;gt; Yes, my problem disappears. &lt;br/&gt;
&amp;gt;&amp;gt; &lt;br/&gt;
&amp;gt;&amp;gt;     public void execute (HttpServletRequest req, HttpServletResponse res)&lt;br/&gt;
&amp;gt;&amp;gt;     {&lt;br/&gt;
&amp;gt;&amp;gt; 	 try &lt;br/&gt;
&amp;gt;&amp;gt; 	 &lt;/p&gt;
{
&amp;gt;&amp;gt;               MetaClass.setUseReflection(true);
&amp;gt;&amp;gt;               out = res.getWriter(); 
&amp;gt;&amp;gt;               out.println(&quot;hello, world&quot;);
&amp;gt;&amp;gt; 	 }
&lt;p&gt;&amp;gt;&amp;gt; 	 catch (Throwable e)&lt;br/&gt;
&amp;gt;&amp;gt; 	    &lt;/p&gt;
{ ... }
&lt;p&gt; &lt;br/&gt;
&amp;gt;&amp;gt;     }&lt;/p&gt;


&lt;p&gt;    This is an issue I was barking about last month. I&apos;m trying to&lt;br/&gt;
    float the issue again. &lt;/p&gt;

&lt;p&gt;    I solved it by creating proxy classes for the&lt;br/&gt;
    HttpServletRequest and HttpServletResponse interfaces, including&lt;br/&gt;
    all the interfaces in javax.servlet that are visible through&lt;br/&gt;
    those interfaces.&lt;/p&gt;

&lt;p&gt;    Basically, the Tomcat implementation is not avaiable to Groovy,&lt;br/&gt;
    and Groovy wants to manipulate the bytecode of that&lt;br/&gt;
    implementation.&lt;/p&gt;</comment>
                            <comment id="14461043" author="sormuras" created="Sun, 5 Jun 2005 00:57:23 +0000"  >&lt;p&gt;Jetty 5.1.3 says when logging the first request object...&lt;/p&gt;

&lt;p&gt;  c = request.getClass() : &quot;class org.mortbay.jetty.servlet.ServletHttpRequest&quot;&lt;br/&gt;
  l = c.getClassLoader() : &quot;sun.misc.Launcher$AppClassLoader@53ba3d&quot;&lt;br/&gt;
  l.getClass()           : &quot;class sun.misc.Launcher$AppClassLoader&quot;&lt;/p&gt;

&lt;p&gt;Tomcat 5.5.9 uses its own implementations and says...&lt;/p&gt;

&lt;p&gt;  c = request.getClass() : &quot;class org.apache.catalina.connector.RequestFacade&quot;&lt;br/&gt;
  l = c.getClassLoader() : &quot;org.apache.catalina.loader.StandardClassLoader@1ef8cf3&quot;&lt;br/&gt;
  l.getClass()           : &quot;class org.apache.catalina.loader.StandardClassLoader&quot;&lt;/p&gt;</comment>
                            <comment id="14461231" author="blackdrag" created="Thu, 30 Jun 2005 12:45:22 +0000"  >&lt;p&gt;this issue should be fixed now, see &lt;a href=&quot;http://cvs.codehaus.org/changelog/groovy?cs=MAIN:blackdrag:20050630161205&amp;amp;csize=2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cvs.codehaus.org/changelog/groovy?cs=MAIN:blackdrag:20050630161205&amp;amp;csize=2&lt;/a&gt; for details&lt;/p&gt;</comment>
                            <comment id="14461166" author="sormuras" created="Fri, 1 Jul 2005 03:38:51 +0000"  >&lt;p&gt;blackdrag fixed it.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            20 years, 22 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c95z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>