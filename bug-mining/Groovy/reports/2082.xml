<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:31:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-5858] &quot;string&quot;.count(&apos;&apos;) fails</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-5858</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;String.count() fails when passed an empty string. &lt;/p&gt;

&lt;p&gt;Using 2.0.2 at the moment so haven&apos;t tried with other versions.&lt;/p&gt;</description>
                <environment>Linux x64</environment>
        <key id="12816682">GROOVY-5858</key>
            <summary>&quot;string&quot;.count(&apos;&apos;) fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="james.frost">James Frost</reporter>
                        <labels>
                            <label>string</label>
                    </labels>
                <created>Wed, 19 Dec 2012 08:14:20 +0000</created>
                <updated>Fri, 18 Jan 2013 16:06:53 +0000</updated>
                            <resolved>Tue, 15 Jan 2013 07:23:04 +0000</resolved>
                                    <version>2.0.2</version>
                                    <fixVersion>2.1.0-rc-1</fixVersion>
                    <fixVersion>1.8.9</fixVersion>
                    <fixVersion>2.0.7</fixVersion>
                                    <component>groovy-jdk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14473643" author="michal.mally" created="Fri, 21 Dec 2012 12:40:31 +0000"  >&lt;p&gt;With Groovy in version 2.0.5 and 2.1.0-beta-1 the execution of &quot;string&quot;.count(&apos;&apos;) hangs forever - it gets into endless loop.&lt;/p&gt;

&lt;p&gt;The root cause is the bug in String.indexOf() method. I do not know if all the Java JDKs are impacted but Oracle JDK 7u10 for sure. I&apos;ve even submitted a bug report to Oracle and waiting if it is going to be accepted.&lt;/p&gt;

&lt;p&gt;Basically the bug causes String.indexOf(String str, int fromIndex) to return non-negative index which is less than fromIndex passed to it. It is against the contract that is described by String.indexOf() method javadoc. To reproduce the bug empty string has to be passed to method and fromIndex which is greater than length of the string in which we are looking for occurrences in. E.g. &quot;bug&quot;.indexOf(&quot;&quot;, 4) // 3 is returned.&lt;/p&gt;

&lt;p&gt;And this is exactly what happens in StringGroovyMethods().count() method:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; count(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; self, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; text) {
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; answer = 0;
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; idx = 0; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; idx++) {
            idx = self.indexOf(text, idx);
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (idx &amp;gt;= 0) {
                ++answer;
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; answer;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since Groovy has to run on wide variety of JDKs it shall not be relayed on the fact that String.indexOf() is going to be fixed. It shall run both upon &quot;broken&quot; and &quot;fixed&quot; version of String.indexOf(). So the fix shall be rather applied to Groovy codebase.&lt;/p&gt;

&lt;p&gt;Let me know if you agree that the solution shall be applied in Groovy. If so I can invest some of my time to look into it deeper.&lt;/p&gt;</comment>
                            <comment id="14480060" author="paulk" created="Sun, 23 Dec 2012 04:10:42 +0000"  >&lt;p&gt;I think adding:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (idx == self.size()) &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;after the increment of &lt;tt&gt;answer&lt;/tt&gt; would fix the problem.&lt;br/&gt;
It yields the result 7 for &quot;string.count(&apos;&apos;)&quot; which I think is what we want.&lt;/p&gt;</comment>
                            <comment id="14473659" author="michal.mally" created="Sun, 23 Dec 2012 07:03:40 +0000"  >&lt;p&gt;I think your solution might work however it is another conditional to check within each iteration. What I was thinking about is rather replacing the &apos;if (idx &amp;gt;= 0)&apos; with &apos;if (idx &amp;gt;= answer)&apos;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; count(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; self, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; text) {
  &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; answer = 0;
  &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; idx = 0; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; idx++) {
    idx = self.indexOf(text, idx);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (idx &amp;gt;= answer) {
      ++answer;
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
    }
  }
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; answer;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The bottom line is that at any time we can&apos;t have already found more occurrences than the actual idx value is. So as long idx is greater or equal to answer we are OK with that. If it turns -1 we break as with (idx &amp;gt;= 0). If answer becomes greater than idx it means we are struck with the String.indexOf() bug and we break out as well.&lt;/p&gt;

&lt;p&gt;I have not tested it throughly but for following cases it seems to work as expected:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt;.count(&quot;&quot;) == 7
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;.count(&quot;&lt;/span&gt;&quot;) == 1
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;aaa&quot;&lt;/span&gt;.count(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;) == 3
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;abab&quot;&lt;/span&gt;.count(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;) == 2
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;abbabab&quot;&lt;/span&gt;.count(&lt;span class=&quot;code-quote&quot;&gt;&quot;ab&quot;&lt;/span&gt;) == 3
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;.count(&quot;&lt;/span&gt;aaa&quot;) == 0
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;aabaababaabaa&quot;&lt;/span&gt;.count(&lt;span class=&quot;code-quote&quot;&gt;&quot;aa&quot;&lt;/span&gt;) == 4
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;aaa&quot;&lt;/span&gt;.count(&lt;span class=&quot;code-quote&quot;&gt;&quot;aa&quot;&lt;/span&gt;) == 2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;BTW. Are there any tests for String.count() method? The only test I could find is GroovyMethodsTest.testCountForString().&lt;/p&gt;</comment>
                            <comment id="14480083" author="paulk" created="Mon, 24 Dec 2012 03:46:35 +0000"  >&lt;p&gt;Avoiding the extra conditional check is nice but perhaps harder to understand. I&apos;ll see if I can think of a way to tweak your solution to make it clearer to understand - it would be nice to have the best of both worlds if we can. Yes, coverage isn&apos;t great as far as tests go. There is only the &lt;tt&gt;GroovyMethodsTest.testCountForString()&lt;/tt&gt; which you spotted and now &lt;tt&gt;testCountForStringEdgeCase_GROOVY5858()&lt;/tt&gt; which I added.&lt;/p&gt;</comment>
                            <comment id="14473872" author="pschumacher" created="Thu, 10 Jan 2013 11:16:53 +0000"  >&lt;p&gt;should have fix version 2.1.0-rc-1&lt;/p&gt;</comment>
                            <comment id="14480129" author="paulk" created="Sun, 13 Jan 2013 03:57:04 +0000"  >&lt;p&gt;fix in place for 2.1.0-rc-1; potential further optimization pending&lt;/p&gt;</comment>
                            <comment id="14480109" author="paulk" created="Tue, 15 Jan 2013 07:23:04 +0000"  >&lt;p&gt;Fix version applies to initial fix. A slight performance improvement is added for 2.1.0-rc-2 and above.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 45 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cnn3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>