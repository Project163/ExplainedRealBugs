<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:21:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-4097] MOP implementation does not handle method calls in relation with class objects properly!</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-4097</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;In a few places, the Meta Object Protocoll implementation uses parameter objects classes to look up the matching meta methods. But if one of these arguments already is of type Class, instead of using Class&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt;, the original class parameter is used. This leads to a couple of bugs.&lt;/p&gt;

&lt;p&gt;My attached TestCase includes two methods, each demonstrating on of these bugs.&lt;/p&gt;

&lt;h4&gt;&lt;a name=&quot;Firstexample%3A&quot;&gt;&lt;/a&gt;First example:&lt;/h4&gt;

&lt;p&gt;The first method, testClassArguments(), presents a major issue.&lt;br/&gt;
The TestClass has two methods: getSomething(String) and getSomething(Class).&lt;/p&gt;

&lt;p&gt;Using the MetaObjectProtocol, i first retrieve the MetaMethod of getSomething (line 23) for an argument set &lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt; (line 22). MetaClassImpl looks up this method by taking the classes of &lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt; (namely  &lt;span class=&quot;error&quot;&gt;&amp;#91;Class&amp;lt;String&amp;gt;&amp;#93;&lt;/span&gt;), and looking for a method with a signature, that matches &lt;span class=&quot;error&quot;&gt;&amp;#91;Class&amp;lt;String&amp;gt;&amp;#93;&lt;/span&gt;. This works fine, the result printed (line 24) is the correct method, and the assertion (line 25) passes.&lt;/p&gt;

&lt;p&gt;Now i do the same thing again, but this time using an argument set &lt;span class=&quot;error&quot;&gt;&amp;#91;Class&amp;lt;String&amp;gt;&amp;#93;&lt;/span&gt; (line 27). getMetaMethod returns a method (line 28). But, as one can see in the output (line 29), the method is once again getSomething(String): Since MetaClassImpl internally looks up the method, by taking the parameters classes, but in the process &lt;em&gt;skipping&lt;/em&gt; class transformation for class arguments, it once again looks for a method with signature &lt;span class=&quot;error&quot;&gt;&amp;#91;Class&amp;lt;String&amp;gt;&amp;#93;&lt;/span&gt; instead of &lt;span class=&quot;error&quot;&gt;&amp;#91;Class&amp;lt;Class&amp;lt;String&amp;gt;&amp;gt;&amp;#93;&lt;/span&gt;. Now, invoking getSomething(String) with Class&amp;lt;String&amp;gt; as parameter of course leads to an IllegalArgumentException, thereby failing the test.&lt;/p&gt;

&lt;h4&gt;&lt;a name=&quot;Secondexample&quot;&gt;&lt;/a&gt;Second example&lt;/h4&gt;

&lt;p&gt;This second example, method testInvokeStaticMethod(), demonstrates, how a call to getSuperclass, a normal public instance method for Class&amp;lt;T&amp;gt;, is wrongly executed as a static method call on T.&lt;/p&gt;

&lt;p&gt;This bug does not occur, when using a default MetaClass: since all default MetaClasses are subclasses of MetaClassImpl, and the class org.codehaus.groovy.runtime.callsite.CallSiteArray has an instanceof test at the third line of it&apos;s method createCallStaticSite(CallSite,Class,Object[]), this does not happen for any of MetaClassImpl subclasses.&lt;/p&gt;

&lt;p&gt;So the first thing this test does is, to replace its MetaClass with a DelegatingMetaClass, which does nothing except forward all calls to the original MetaClassImpl, but it is not a subclass of MetaClassImpl, so the mentioned instanceof test does not work.&lt;/p&gt;

&lt;p&gt;Firstly, the test now retrieves it&apos;s own Class object (line 38), which works as expected.&lt;/p&gt;

&lt;p&gt;Now, the tests asserts, that its own superclass is GroovyTestCase (line 39), but this assertion fails. The actually returned value of the clazz.getSuperclass() call is &quot;This was the wrong method!&quot;, which is returned by the test cases static getSuperclass() method (lines 42 to 44).&lt;/p&gt;

&lt;p&gt;So what happened here? That is pretty simple:&lt;/p&gt;

&lt;p&gt;A normal static call to the getSuperclass() method at lines 42 to 44 would be translated to invokeStaticMethod(GroovyTestCase.class, &quot;getSuperclass&quot;, []) on the MetaClass of GroovyTestCase.&lt;/p&gt;

&lt;p&gt;The superclass call at line 39 &lt;b&gt;should&lt;/b&gt; have been translated to invokeMethod(clazz, &quot;getSuperclass&quot;, []) on the MetaClass of Class&amp;lt;T&amp;gt;.&lt;/p&gt;

&lt;p&gt;But what happened instead is, since clazz == GroovyTestCase.clazz, the call site was simply &quot;mistaken&quot; for a static call site, and delegated to the wrong MetaClass.&lt;/p&gt;

&lt;h5&gt;&lt;a name=&quot;somefinalwords&quot;&gt;&lt;/a&gt;some final words&lt;/h5&gt;

&lt;p&gt;though the displayed test cases may seem a little artificially constructed, i actually stumbled over both of these bugs in my project, after renaming a few java files to groovy. So please note that these are real issues, the examples only may seem that surreal because i reduced them to a minimum. This stuff does  regularly break code when doing some heavy MOP related work.&lt;/p&gt;</description>
                <environment>Tested on an AMD Turion64 under WinXP with Eclipse Galileo, Java 6u17, will occur on any platform though since this are groovy source code bugs.</environment>
        <key id="12815078">GROOVY-4097</key>
            <summary>MOP implementation does not handle method calls in relation with class objects properly!</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="misterd">Joscha Drechsler</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Mar 2010 09:37:00 +0000</created>
                <updated>Fri, 22 Dec 2023 11:38:17 +0000</updated>
                            <resolved>Sat, 15 Apr 2023 15:45:46 +0000</resolved>
                                    <version>1.7.0</version>
                                                    <component>groovy-runtime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17712670" author="emilles" created="Sat, 15 Apr 2023 15:45:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/cbcf64e9a233cb7ad4c64e132acf83c781561f57&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/cbcf64e9a233cb7ad4c64e132acf83c781561f57&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;NOTE: &lt;tt&gt;getMetaMethod&lt;/tt&gt; and others like it specify Object[] for argument types, but do indeed expect types.  Not sure if this is legacy, but it can&apos;t be changed to Class[].  The expectation is you call &quot;getMetaMethod(&apos;getSomething&apos;,Class)&quot; if looking for method that accepts class.&lt;/p&gt;

&lt;p&gt;I cleaned up a couple places where indeed call arguments are passed and types are expected, so they will now check &lt;tt&gt;Class&amp;lt;Class&amp;gt;&lt;/tt&gt; instead of whatever kind of class is given in arguments array.&lt;/p&gt;

&lt;p&gt;As for the second issue, I can&apos;t quite find the right issue to link.  &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-10820&quot; title=&quot;SC: static choice of Class vs Object extension for Type dot name&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-10820&quot;&gt;&lt;del&gt;GROOVY-10820&lt;/del&gt;&lt;/a&gt; speaks to the static compilation handling of similar situations.  I would be very careful adding static methods like &quot;getSuperclass()&quot; or &quot;getCanonicalName()&quot;.  If you need, you can switch to static compilation to ensure the intended method is called.  Groovy prefers to call static method declared on given class over instance method of Class when receiver is a class instance.&lt;/p&gt;

&lt;p&gt;Maybe it would be useful to generate a warning for any static method that is an instance method of Class.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13500913">GROOVY-10820</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12722552" name="GroovyTestClass.groovy" size="1310" author="misterd" created="Wed, 10 Mar 2010 09:37:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 30 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bwnj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>