<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:06:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-7701] org.codehaus.groovy.runtime.typehandling.GroovyCastException in Groovy &quot;.with { ... }&quot; - Block</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-7701</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;h1&gt;&lt;a name=&quot;Problem&quot;&gt;&lt;/a&gt;Problem&lt;/h1&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;subClass.with {
  type = [&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&apos;&lt;/span&gt;]
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Should change &lt;em&gt;SubClass.type&lt;/em&gt; and not &lt;em&gt;TopClass.type&lt;/em&gt;.&lt;br/&gt;
The script works fine with &lt;em&gt;type2&lt;/em&gt; instead of &lt;em&gt;type&lt;/em&gt;. Is &lt;em&gt;type&lt;/em&gt; a reserved word? I can&apos;t find any documentation about this.&lt;/p&gt;

&lt;h2&gt;&lt;a name=&quot;UnitTest%2FGroovyConsoleTest&quot;&gt;&lt;/a&gt;Unit-Test / Groovy Console-Test&lt;/h2&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SubClass{
    List type
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TopClass{

    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; type = 10

    @Lazy
    List something = {
        List tmp = []
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 5; i++){
            def subClass = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SubClass()
            subClass.with {
                type = [&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&apos;&lt;/span&gt;] &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; org.codehaus.groovy.runtime.typehandling.GroovyCastException
&lt;/span&gt;            }
            tmp.add(subClass)
        }
        tmp
    }()
}

def topClass = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TopClass()
println GroovySystem.version
println(topClass.type)
println(topClass.something)
println(topClass.type)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;h2&gt;&lt;a name=&quot;Exception&quot;&gt;&lt;/a&gt;Exception&lt;/h2&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.codehaus.groovy.runtime.typehandling.GroovyCastException: Cannot &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; object &lt;span class=&quot;code-quote&quot;&gt;&apos;[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;]&apos;&lt;/span&gt; with class &lt;span class=&quot;code-quote&quot;&gt;&apos;java.util.ArrayList&apos;&lt;/span&gt; to class &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&apos;&lt;/span&gt;
	at TopClass$_getSomething_closure1$_closure2.doCall(ConsoleScript3:15)
	at TopClass$_getSomething_closure1.doCall(ConsoleScript3:14)
	at TopClass$_getSomething_closure1.doCall(ConsoleScript3)
	at TopClass.getSomething(ConsoleScript3:11)
	at ConsoleScript3.run(ConsoleScript3:26)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>all?&lt;br/&gt;
Tested with Ubuntu 14.04.3 LTS (64 Bit) | MacOS 10.11 and Groovy 2.4.5, 2.3.4</environment>
        <key id="12917914">GROOVY-7701</key>
            <summary>org.codehaus.groovy.runtime.typehandling.GroovyCastException in Groovy &quot;.with { ... }&quot; - Block</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="MaikIgloffstein">Maik Igloffstein</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Dec 2015 08:15:04 +0000</created>
                <updated>Tue, 16 May 2023 13:34:23 +0000</updated>
                            <resolved>Sat, 13 Jun 2020 13:34:43 +0000</resolved>
                                    <version>2.4.3</version>
                    <version>2.4.4</version>
                    <version>2.4.5</version>
                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                    <fixVersion>3.0.5</fixVersion>
                    <fixVersion>2.5.13</fixVersion>
                                    <component>groovy-jdk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="15045504" author="shils" created="Mon, 7 Dec 2015 19:03:08 +0000"  >&lt;p&gt;This occurs for me with any choice of name in place of &apos;type&apos; (provided the same name is used in both TopClass and SubClass.) Also, &apos;type&apos; is not a reserved word.&lt;/p&gt;</comment>
                            <comment id="15054496" author="jwagenleitner" created="Sat, 12 Dec 2015 18:01:10 +0000"  >&lt;p&gt;A workaround would be to use&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;subClass.with {
    delegate.type = [&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&apos;&lt;/span&gt;]
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It only seems to be a problem if the name is the same but the types are incompatible.  If TopClass.type type is String it works correctly (only the SubClass.type is set).&lt;/p&gt;</comment>
                            <comment id="15058640" author="shils" created="Tue, 15 Dec 2015 19:41:21 +0000"  >&lt;p&gt;A simplified version of the example from the description:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SubClass {
    List type
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TopClass {
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; type
    
    void test() {
        def subClass = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SubClass()
        subClass.with {
            type = [&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&apos;&lt;/span&gt;]           
        }
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TopClass().test()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It&apos;s worth noting that if TopClass is statically compiled, a NumberFormatException is thrown due to an attempt to convert &apos;String&apos; to an int. &lt;/p&gt;

</comment>
                            <comment id="15059556" author="maikigloffstein" created="Wed, 16 Dec 2015 06:12:44 +0000"  >&lt;p&gt;Are there any performance issue using &lt;tt&gt;delegate.&amp;lt;var&amp;gt;&lt;/tt&gt; in the &lt;em&gt;with closure&lt;/em&gt; by default?&lt;/p&gt;</comment>
                            <comment id="15062507" author="jwagenleitner" created="Thu, 17 Dec 2015 18:35:37 +0000"  >&lt;p&gt;Not sure, I would suspect not but it wouldn&apos;t hurt to test.  You can also compare against dropping the delegate and calling the setter &lt;tt&gt;setType(...)&lt;/tt&gt; and that should also work as a workaround.&lt;/p&gt;</comment>
                            <comment id="15082652" author="maikigloffstein" created="Tue, 5 Jan 2016 08:45:00 +0000"  >&lt;p&gt;Will this bug be fixed in the next release?&lt;/p&gt;</comment>
                            <comment id="15083017" author="blackdrag" created="Tue, 5 Jan 2016 13:01:24 +0000"  >&lt;p&gt;as long as the bug is open, you cannot expect it been fixed in the next version&lt;/p&gt;</comment>
                            <comment id="17126131" author="emilles" created="Thu, 4 Jun 2020 18:26:32 +0000"  >&lt;p&gt;BinaryExpressionHelper#evaluateEqual is adding a cast in between visiting the RHS of the assignment and the LHS.  Since the LHS has not been visited yet, it cannot be determined if the variable &quot;type&quot; references the field in SubClass or TopClass yet.  &lt;a href=&quot;https://github.com/apache/groovy/blob/49ee146850d866513aa84bc49bf22e06687484d5/src/main/java/org/codehaus/groovy/classgen/asm/BinaryExpressionHelper.java#L475&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/blob/49ee146850d866513aa84bc49bf22e06687484d5/src/main/java/org/codehaus/groovy/classgen/asm/BinaryExpressionHelper.java#L475&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17164232" author="monti" created="Fri, 24 Jul 2020 07:46:02 +0000"  >&lt;p&gt;Since this was the only issue relating to &lt;tt&gt;with&lt;/tt&gt;  in Groovy 3.0.5, I think this fix might have broken behaviour in Spock (using 2.0-M3):&lt;/p&gt;

&lt;p&gt;This works in 3.0.4:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; BOOKING = 123
    def &lt;span class=&quot;code-quote&quot;&gt;&apos;get stuff&apos;&lt;/span&gt;() {
      given:
        def stuff = [ booking: 123 ]

      expect:
        with(stuff) {
            booking == BOOKING
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But fails in 3.0.5 with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Condition not satisfied:

booking == BOOKING
|       |  |
123     |  &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13536153">GROOVY-11056</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="13319118">GROOVY-9655</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2p8a7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>