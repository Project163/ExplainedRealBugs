<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:15:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-4121] Compiler fails to do assignment-to-final-fields checks on fields made final by @Immutable (was: @Immutable does not make fields immutable)</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-4121</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;@Immutable annotation does not prevent changing fields:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Immutable
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Account {
    BigDecimal balance
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; customer
    
    Account deposit(amount) {
        balance = balance + amount
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;
    }
    
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; toString() {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;Account[balance: $balance, customer: $customer]&quot;&lt;/span&gt;   
    }
}

def acc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Account(0.0, &lt;span class=&quot;code-quote&quot;&gt;&quot;Test&quot;&lt;/span&gt;)
acc.deposit(3.1) &lt;span class=&quot;code-comment&quot;&gt;//should raise exception, shouldn&apos;t it?
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; 3.1 == acc.balance 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Maybe I got the description in &lt;a href=&quot;http://groovy.codehaus.org/api/groovy/lang/Immutable.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://groovy.codehaus.org/api/groovy/lang/Immutable.html&lt;/a&gt; wrong:&lt;br/&gt;
&quot;Properties automatically have private, final backing fields with getters. Attempts to update the property will result in a ReadOnlyPropertyException.&quot; ?&lt;/p&gt;</description>
                <environment>osx, groovyConsole</environment>
        <key id="12815055">GROOVY-4121</key>
            <summary>Compiler fails to do assignment-to-final-fields checks on fields made final by @Immutable (was: @Immutable does not make fields immutable)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roshandawrani">Roshan Dawrani</assignee>
                                    <reporter username="johanneslink">Johannes Link</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 Mar 2010 05:55:34 +0000</created>
                <updated>Wed, 7 Apr 2010 23:45:16 +0000</updated>
                            <resolved>Tue, 23 Mar 2010 03:49:15 +0000</resolved>
                                    <version>1.7.1</version>
                                    <fixVersion>1.7.2</fixVersion>
                    <fixVersion>1.8-beta-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14469171" author="johanneslink" created="Mon, 22 Mar 2010 05:58:39 +0000"  >&lt;p&gt;A newline got lost in the deposit-method of my test case (sorry). Should read:&lt;br/&gt;
Account deposit(amount) { &lt;br/&gt;
  balance = balance + amount; &lt;br/&gt;
  this &lt;br/&gt;
}&lt;/p&gt;</comment>
                            <comment id="14469058" author="roshandawrani" created="Mon, 22 Mar 2010 10:02:02 +0000"  >&lt;p&gt;Applied code tags.&lt;/p&gt;</comment>
                            <comment id="14469136" author="roshandawrani" created="Mon, 22 Mar 2010 10:09:15 +0000"  >&lt;p&gt;The documentation may need a little update but I think the idea is that you want to write an immutable class to save it from changes from outside (acc.balance = 1.0 does throw ReadOnlyPropertyException). If the class itself decides to break its own immutability, then @Immutable does not prevent it from doing so.&lt;/p&gt;

&lt;p&gt;Another way of a class breaking its own immutability is providing an explicit setter for the property, as mentioned in the @Immutable documentation:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;You don&apos;t have to follow Groovy&apos;s normal property conventions, e.g. you can 
create an explicit private field and then you can write explicit get and set methods. 
Such an approach, isn&apos;t currently prohibited (to give you some wiggle room to get 
around these conventions) but any fields created in this way are deemed not 
to be part of the significant state of the object and aren&apos;t factored 
into the equals  or hashCode methods. Use at your own risk! 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;@Immutable needs the support of good intentions of the class author &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14469159" author="johanneslink" created="Mon, 22 Mar 2010 10:40:34 +0000"  >&lt;p&gt;Does that mean that fields don&apos;t get the &quot;final&quot; modifier automatically added during AST transformation? But without the final modifier you won&apos;t get the guarantees from the Java memory model as for thread-safe publication of immutable objects. In other words: Many @Immutable examples presented on the web and on conferences would be wrong then. &lt;/p&gt;

&lt;p&gt;Moreover &lt;a href=&quot;http://groovy.codehaus.org/Immutable+AST+Macro&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://groovy.codehaus.org/Immutable+AST+Macro&lt;/a&gt; would also be wrong&lt;/p&gt;</comment>
                            <comment id="14469150" author="roshandawrani" created="Mon, 22 Mar 2010 10:59:41 +0000"  >&lt;p&gt;The @Immutable does make the field final and the compiler should reject the code &quot;balance = balance + amount&quot;&lt;/p&gt;

&lt;p&gt;There is some ordering issue within the compiler. @Immutable AST transformation happens after the compiler has made its usual checks to see if final fields are being assigned to and that&apos;s why the compiler fails to reject the assignment &quot;balance = balance + amount&quot;.&lt;/p&gt;</comment>
                            <comment id="14469195" author="roshandawrani" created="Mon, 22 Mar 2010 11:02:37 +0000"  >&lt;p&gt;Jochen, u there?&lt;/p&gt;

&lt;p&gt;Do you think the check VariableScopeVisitor#checkFinalFieldAccess() can be moved to a later point in compilation - to the Verifier, may be?&lt;/p&gt;</comment>
                            <comment id="14469059" author="roshandawrani" created="Mon, 22 Mar 2010 12:24:57 +0000"  >&lt;p&gt;Attaching the patch for review. &lt;/p&gt;

&lt;p&gt;It pushes the checkFinalFieldAccess from VariableScopeVisitor (resolve) to ClassCompletionVerifier (classgen) so that it now also covers the fields made final by ImmutableASTTransformation.&lt;/p&gt;</comment>
                            <comment id="14469137" author="roshandawrani" created="Mon, 22 Mar 2010 12:28:13 +0000"  >&lt;p&gt;After the patch, the example provided above fails with the compilation error &quot;cannot modify final field &apos;balance&apos; outside of constructor&quot;&lt;/p&gt;</comment>
                            <comment id="14469215" author="paulk" created="Tue, 23 Mar 2010 01:39:05 +0000"  >&lt;p&gt;+1 from me - perhaps title of issue is no longer accurate?&lt;/p&gt;</comment>
                            <comment id="14469151" author="roshandawrani" created="Tue, 23 Mar 2010 03:49:15 +0000"  >&lt;p&gt;Fixed.&lt;/p&gt;

&lt;p&gt;Johannes, sorry about the partially incorrect comment early on.&lt;/p&gt;

&lt;p&gt;Thanks for the patch feedback, Paul.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722313" name="4121_v18x_Patch.txt" size="9732" author="roshandawrani" created="Mon, 22 Mar 2010 12:24:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 36 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cf9z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>