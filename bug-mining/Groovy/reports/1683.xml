<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:23:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-5197] Source location incorrect for statement after a label</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-5197</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Take this code and put it into the groovy console:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def meth() {
  label:
    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; i == 9
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now inspect the AST and navigate to the assert statement.  You will see that the assert statement has a lineNumber and lastLineNumber are 2, but it should be 3.  This is incorrect.  It doesn&apos;t seem like this affects Groovy itself too much, but this is causing an exception in Groovy-Eclipse.  See GRECLIPSE-1270.&lt;/p&gt;

&lt;p&gt;The fix is simple enough.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12815872">GROOVY-5197</key>
            <summary>Source location incorrect for statement after a label</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="werdna">Andrew Eisenberg</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Dec 2011 17:23:45 +0000</created>
                <updated>Sun, 12 Feb 2012 04:03:11 +0000</updated>
                            <resolved>Wed, 28 Dec 2011 21:02:57 +0000</resolved>
                                    <version>1.8.4</version>
                                    <fixVersion>1.8.6</fixVersion>
                    <fixVersion>2.0-beta-3</fixVersion>
                                    <component>parser-antlr2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14472208" author="werdna" created="Thu, 15 Dec 2011 17:28:27 +0000"  >&lt;p&gt;Fix:  in &lt;tt&gt;org.codehaus.groovy.antlr.AntlrParserPlugin.statement(AST)&lt;/tt&gt; at the end of the method, change:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (statement != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    configureAST(statement, node);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (statement != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; type != LABELED_STAT) {
    configureAST(statement, node);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This problem is coming about because the source location of &lt;tt&gt;statement&lt;/tt&gt; is being set twice: once from within the call to &lt;tt&gt;labeledStatment&lt;/tt&gt; using the correct source location and once again using the source location for just the label in the call to &lt;tt&gt;statement&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;This leads me to question if explicitly calling &lt;tt&gt;configureAST&lt;/tt&gt; is necessary at all in the &lt;tt&gt;statement&lt;/tt&gt; method since all calls to create the different kinds of statements already call &lt;tt&gt;configureAST&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14479768" author="paulk" created="Tue, 27 Dec 2011 04:15:22 +0000"  >&lt;p&gt;Proposed patch - a slight variation of what Andrew proposed. The code for the statement method is a little strange in that despite each branch of the switch deriving the respective source positioning depending on the particular branch chosen, it then overrides that information with the information for the entire node. The more refined info is useful in other contexts.&lt;/p&gt;</comment>
                            <comment id="14472230" author="blackdrag" created="Tue, 27 Dec 2011 07:05:42 +0000"  >&lt;p&gt;I guess the patch is ok then&lt;/p&gt;</comment>
                            <comment id="14479747" author="paulk" created="Tue, 27 Dec 2011 21:34:43 +0000"  >&lt;p&gt;Well, it is more of a philosophical decision I think. At the statement level, we tend to keep track of the whitespace around the statement. Here we would not be doing this. There are no LineColumn checks that test this area. There is only a very minimal SourcePrinter test. I will do another sanity check with some more elaborate SourcePrinter tests before applying the patch. The alternative is that we need to document that any statement may contain a label and it would be up to other tools, e.g. CodeNarc etc. to step around the label. We could provide a utility to make it easier I guess.&lt;/p&gt;</comment>
                            <comment id="14472160" author="werdna" created="Wed, 28 Dec 2011 00:18:29 +0000"  >&lt;p&gt;From the tooling perspective, including whitespace in AST nodes is problematic (specifically in expression nodes and too a lesser extent in statement nodes).  There are many situations where trailing whitespace must be worked around.&lt;/p&gt;

&lt;p&gt;When there is an easy fix, I patch the groovy compiler and try to send you guys a patch, but often I need some hairy workaround code in Groovy-Eclipse.&lt;/p&gt;

&lt;p&gt;Is there a reason why many AST nodes keep trailing whitespace?  Or is this largely legacy?  (From my investigations, it seems to be built into the parser.)&lt;/p&gt;</comment>
                            <comment id="14472192" author="blackdrag" created="Wed, 28 Dec 2011 16:36:55 +0000"  >&lt;p&gt;I think it is mainly because it is not easy to tell the grammar to not to include the whitespace and since we didn&apos;t really need that information to a level where trailing whitespace matters, we simply didn&apos;t put in the energy to prevent that from happening.&lt;/p&gt;</comment>
                            <comment id="14479757" author="paulk" created="Wed, 28 Dec 2011 21:02:57 +0000"  >&lt;p&gt;Patch applied - I tried playing around with different source texts to confuse the SourcePrinterTests but could&apos;t spot any obvious breakages.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722645" name="groovy5197.patch" size="129635" author="paulk" created="Tue, 27 Dec 2011 04:15:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 47 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c2ev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>