<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:18:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-10565] JDK 17: Sealed classes inside a package cause Exception in thread &quot;main&quot; java.lang.ClassFormatError: Illegal class name</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-10565</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I have found an issue with using sealed types that are inside a package. I took the example from the Groovy 4 release notes and I run it successfully - all classes in this example use the default package. However, when I took the same code and I put it in any package (e.g. `example` package), the execution started failing with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
Exception &lt;span class=&quot;code-object&quot;&gt;in&lt;/span&gt; thread &lt;span class=&quot;code-quote-red&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.ClassFormatError: Illegal class name &lt;span class=&quot;code-quote-red&quot;&gt;&quot;example.Empty&quot;&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;in&lt;/span&gt; class file example/Tree
        at java.base/java.lang.ClassLoader.defineClass1(Native Method)
        at java.base/java.lang.ClassLoader.defineClass(ClassLoader.java:1012)
        at java.base/java.security.SecureClassLoader.defineClass(SecureClassLoader.java:150)
        at java.base/jdk.internal.loader.BuiltinClassLoader.defineClass(BuiltinClassLoader.java:862)
        at java.base/jdk.internal.loader.BuiltinClassLoader.findClassOnClassPathOrNull(BuiltinClassLoader.java:760)
        at java.base/jdk.internal.loader.BuiltinClassLoader.loadClassOrNull(BuiltinClassLoader.java:681)
        at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:639)
        at java.base/jdk.internal.loader.ClassLoaders&lt;span class=&quot;code-object&quot;&gt;$AppClassLoader&lt;/span&gt;.loadClass(ClassLoaders.java:188)
        at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:520)
        at java.base/java.lang.ClassLoader.defineClass1(Native Method)
        at java.base/java.lang.ClassLoader.defineClass(ClassLoader.java:1012)
        at java.base/java.security.SecureClassLoader.defineClass(SecureClassLoader.java:150)
        at java.base/jdk.internal.loader.BuiltinClassLoader.defineClass(BuiltinClassLoader.java:862)
        at java.base/jdk.internal.loader.BuiltinClassLoader.findClassOnClassPathOrNull(BuiltinClassLoader.java:760)
        at java.base/jdk.internal.loader.BuiltinClassLoader.loadClassOrNull(BuiltinClassLoader.java:681)
        at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:639)
        at java.base/jdk.internal.loader.ClassLoaders&lt;span class=&quot;code-object&quot;&gt;$AppClassLoader&lt;/span&gt;.loadClass(ClassLoaders.java:188)
        at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:520)
        at example.notworking.run(notworking.groovy:20)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.base/java.lang.reflect.Method.invoke(Method.java:568)
        at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:343)
        at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:328)
        at groovy.lang.MetaClassImpl.doInvokeMethod(MetaClassImpl.java:1369)
        at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1103)
        at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1009)
        at org.codehaus.groovy.runtime.InvokerHelper.invokePogoMethod(InvokerHelper.java:610)
        at org.codehaus.groovy.runtime.InvokerHelper.invokeMethod(InvokerHelper.java:593)
        at org.codehaus.groovy.runtime.InvokerHelper.runScript(InvokerHelper.java:413)
        at org.codehaus.groovy.runtime.InvokerHelper&lt;span class=&quot;code-object&quot;&gt;$runScript&lt;/span&gt;.callStatic(Unknown Source)
        at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCallStatic(CallSiteArray.java:54)
        at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callStatic(AbstractCallSite.java:217)
        at org.codehaus.groovy.runtime.callsite.AbstractCallSite.callStatic(AbstractCallSite.java:240)
        at example.notworking.main(notworking.groovy)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here is the code that produces this error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; example

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.Canonical

sealed &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; Tree&amp;lt;T&amp;gt; {}

@Singleton final &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Empty &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; Tree {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; toString() { &lt;span class=&quot;code-quote&quot;&gt;&apos;Empty&apos;&lt;/span&gt; }
}

@Canonical final &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Node&amp;lt;T&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; Tree&amp;lt;T&amp;gt; {
    T value
    Tree&amp;lt;T&amp;gt; left, right

    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; toString() {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;Node($value, $left, $right)&quot;&lt;/span&gt;
    }
}

Tree&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; tree = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Node&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;(42, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Node&amp;lt;&amp;gt;(0, Empty.instance, Empty.instance), Empty.instance)
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; tree.toString() == &lt;span class=&quot;code-quote&quot;&gt;&apos;Node(42, Node(0, Empty, Empty), Empty)&apos;&lt;/span&gt;

println &lt;span class=&quot;code-quote&quot;&gt;&quot;IT WORKS!&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;One important note: this error shows up when I use Java 17. If I run the same code with Java 8 or Java 11, all works fine.&lt;/p&gt;

&lt;p&gt;Also one thing: this problem does not occur in plain Java (I attached such an example in the repository below).&lt;/p&gt;

&lt;p&gt;I created an exemplary Gradle project that reproduces this issue - &lt;a href=&quot;https://github.com/wololock/groovy-4-sealed-issue&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/wololock/groovy-4-sealed-issue&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13437606">GROOVY-10565</key>
            <summary>JDK 17: Sealed classes inside a package cause Exception in thread &quot;main&quot; java.lang.ClassFormatError: Illegal class name</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="wololock">Szymon St&#281;pniak</reporter>
                        <labels>
                            <label>ClassFormatError</label>
                    </labels>
                <created>Mon, 4 Apr 2022 11:26:59 +0000</created>
                <updated>Sat, 23 Jul 2022 16:26:59 +0000</updated>
                            <resolved>Tue, 5 Apr 2022 15:42:21 +0000</resolved>
                                    <version>4.0.0</version>
                    <version>4.0.1</version>
                                    <fixVersion>4.0.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="17517378" author="paulk" created="Tue, 5 Apr 2022 11:03:19 +0000"  >&lt;p&gt;Thanks for the excellent detective work. We have a bug in the format we are writing for permitted subclass names. It doesn&apos;t occur when compiling the whole script, e.g. in the groovyConsole, but once written to bytecode, packages will cause problems. Earlier Groovy versions emulating sealed classes also have no problems.&lt;/p&gt;</comment>
                            <comment id="17517389" author="paulk" created="Tue, 5 Apr 2022 11:34:29 +0000"  >&lt;p&gt;Proposed PR:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/groovy/pull/1709&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1709&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17517424" author="wololock" created="Tue, 5 Apr 2022 12:58:31 +0000"  >&lt;p&gt;Thanks for an impressive fix, Paul! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17517519" author="daniel_sun" created="Tue, 5 Apr 2022 15:42:21 +0000"  >&lt;p&gt;The proposed PR has been merged. Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>groovy</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z114ew:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>