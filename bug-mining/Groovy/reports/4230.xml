<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:15:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-10303] Compiler NPE within CompileStack#clear</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-10303</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Unable to compile a new grails app with groovy 3.x . Running into a weird compiler error with an odd stack trace on a large abstract class that is hard to trace&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
General error during instruction selection: NullPointerException &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; processing AbstractBoxProvisionService.groovy. /Users/davydotcom/projects/bertram/morpheus/morpheus-ui/grails-app/services/com/morpheus/provision/AbstractBoxProvisionService.groovy

groovy.lang.GroovyRuntimeException: NullPointerException &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; processing AbstractBoxProvisionService.groovy. /Users/davydotcom/projects/bertram/morpheus/morpheus-ui/grails-app/services/com/morpheus/provision/AbstractBoxProvisionService.groovy
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitClass(AsmClassGenerator.java:295)
        at org.codehaus.groovy.control.CompilationUnit$3.call(CompilationUnit.java:797)
        at org.codehaus.groovy.control.CompilationUnit$IPrimaryClassNodeOperation.doPhaseOperation(CompilationUnit.java:942)
        at org.codehaus.groovy.control.CompilationUnit.processPhaseOperations(CompilationUnit.java:671)
        at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:635)
        at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:610)
        at org.gradle.api.internal.tasks.compile.ApiGroovyCompiler.execute(ApiGroovyCompiler.java:277)
        at org.gradle.api.internal.tasks.compile.ApiGroovyCompiler.execute(ApiGroovyCompiler.java:67)
        at org.gradle.api.internal.tasks.compile.GroovyCompilerFactory$DaemonSideCompiler.execute(GroovyCompilerFactory.java:98)
        at org.gradle.api.internal.tasks.compile.GroovyCompilerFactory$DaemonSideCompiler.execute(GroovyCompilerFactory.java:77)
        at org.gradle.api.internal.tasks.compile.daemon.AbstractDaemonCompiler$CompilerWorkAction.execute(AbstractDaemonCompiler.java:135)
        at org.gradle.workers.internal.DefaultWorkerServer.execute(DefaultWorkerServer.java:63)
        at org.gradle.workers.internal.AbstractClassLoaderWorker$1.create(AbstractClassLoaderWorker.java:49)
        at org.gradle.workers.internal.AbstractClassLoaderWorker$1.create(AbstractClassLoaderWorker.java:43)
        at org.gradle.internal.classloader.ClassLoaderUtils.executeInClassloader(ClassLoaderUtils.java:97)
        at org.gradle.workers.internal.AbstractClassLoaderWorker.executeInClassLoader(AbstractClassLoaderWorker.java:43)
        at org.gradle.workers.internal.IsolatedClassloaderWorker.run(IsolatedClassloaderWorker.java:49)
        at org.gradle.workers.internal.IsolatedClassloaderWorker.run(IsolatedClassloaderWorker.java:30)
        at org.gradle.workers.internal.WorkerDaemonServer.run(WorkerDaemonServer.java:85)
        at org.gradle.workers.internal.WorkerDaemonServer.run(WorkerDaemonServer.java:55)
        at org.gradle.process.internal.worker.request.WorkerAction$1.call(WorkerAction.java:138)
        at org.gradle.process.internal.worker.child.WorkerLogEventListener.withWorkerLoggingProtocol(WorkerLogEventListener.java:41)
        at org.gradle.process.internal.worker.request.WorkerAction.run(WorkerAction.java:135)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:36)
        at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
        at org.gradle.internal.remote.internal.hub.MessageHubBackedObjectConnection$DispatchWrapper.dispatch(MessageHubBackedObjectConnection.java:182)
        at org.gradle.internal.remote.internal.hub.MessageHubBackedObjectConnection$DispatchWrapper.dispatch(MessageHubBackedObjectConnection.java:164)
        at org.gradle.internal.remote.internal.hub.MessageHub$Handler.run(MessageHub.java:414)
        at org.gradle.internal.concurrent.ExecutorPolicy$CatchAndRecordFailures.onExecute(ExecutorPolicy.java:64)
        at org.gradle.internal.concurrent.ManagedExecutorImpl$1.run(ManagedExecutorImpl.java:48)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
        at org.gradle.internal.concurrent.ThreadFactoryImpl$ManagedThreadRunnable.run(ThreadFactoryImpl.java:56)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
Caused by: java.lang.NullPointerException
        at groovyjarjarasm.asm.MethodWriter.visitLocalVariable(MethodWriter.java:1479)
        at org.codehaus.groovy.classgen.asm.CompileStack.clear(CompileStack.java:366)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitStdMethod(AsmClassGenerator.java:464)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitConstructorOrMethod(AsmClassGenerator.java:409)
        at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitMethod(ClassCodeVisitorSupport.java:106)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitMethod(AsmClassGenerator.java:557)
        at org.codehaus.groovy.ast.ClassNode.visitMethods(ClassNode.java:1099)
        at org.codehaus.groovy.ast.ClassNode.visitContents(ClassNode.java:1092)
        at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitClass(ClassCodeVisitorSupport.java:52)
        at org.codehaus.groovy.classgen.AsmClassGenerator.visitClass(AsmClassGenerator.java:272)
        ... 37 more&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>OS X</environment>
        <key id="13406377">GROOVY-10303</key>
            <summary>Compiler NPE within CompileStack#clear</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="davydotcom">David Estes</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Oct 2021 15:43:21 +0000</created>
                <updated>Thu, 3 Feb 2022 22:32:03 +0000</updated>
                            <resolved>Fri, 15 Oct 2021 20:41:30 +0000</resolved>
                                    <version>3.0.7</version>
                    <version>3.0.8</version>
                    <version>3.0.9</version>
                                    <fixVersion>4.0.0-beta-2</fixVersion>
                    <fixVersion>3.0.10</fixVersion>
                                    <component>Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17428349" author="emilles" created="Wed, 13 Oct 2021 17:04:37 +0000"  >&lt;p&gt;When processing this line within &lt;tt&gt;CompileStack#clear&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
mv.visitLocalVariable(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;&quot;&lt;/span&gt;, className, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, thisStartLabel, thisEndLabel, 0);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17428373" author="emilles" created="Wed, 13 Oct 2021 17:29:54 +0000"  >&lt;p&gt;You can debug your gradle build by adding this to your build.gradle:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
tasks.withType(GroovyCompile) {
  groovyOptions.fork = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then run gradle with additional command line arguments:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-Dorg.gradle.debug=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; --no-daemon
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can attach a remote debugger on port 5005.  You want to set a breakpoint within &lt;tt&gt;CompileStack#clear&lt;/tt&gt; at the line mentioned above.  Best to make it a conditional breakpoint looking for &lt;tt&gt;className&lt;/tt&gt;, &lt;tt&gt;thisStartLabel&lt;/tt&gt; or &lt;tt&gt;thisEndLabel&lt;/tt&gt; null.&lt;/p&gt;</comment>
                            <comment id="17428825" author="davydotcom" created="Thu, 14 Oct 2021 14:02:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt;&#160;working through this now. the breakpoint you mentioned was the wrong one. Its in the ByteCodeVariable iterator in #clear... Takes 27 minutes to get there so waiting on it again for round 2.&lt;/p&gt;</comment>
                            <comment id="17428840" author="davydotcom" created="Thu, 14 Oct 2021 14:35:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The end label is null&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://bertram.d.pr/QPp5fm&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bertram.d.pr/QPp5fm&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is the segment of code with the only reference to nameserverResults variable that appears unused anyway&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://bertram.d.pr/jJ3Qwm&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bertram.d.pr/jJ3Qwm&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17428854" author="davydotcom" created="Thu, 14 Oct 2021 15:02:34 +0000"  >&lt;p&gt;Removing the nameserverResults which was unused resolved the compile error. Im not sure if this is because of an if() block with no {} and a variable declaration. I tried this in a standalone class and ran into no compile errors so it is still odd to me&lt;/p&gt;</comment>
                            <comment id="17428876" author="emilles" created="Thu, 14 Oct 2021 15:32:18 +0000"  >&lt;p&gt;If you put that method in a class all by itself does it produce the error?  All the state for compile stack is restricted to the single method body.&lt;/p&gt;</comment>
                            <comment id="17428886" author="davydotcom" created="Thu, 14 Oct 2021 15:42:23 +0000"  >&lt;p&gt;There are too many dependent methods in that abstract class ill have to try something else&lt;/p&gt;</comment>
                            <comment id="17428892" author="davydotcom" created="Thu, 14 Oct 2021 15:50:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt;&#160;I was able to create a class that reproduces it with some testing&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Test {
	
	def myMethod(a,b) {
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(a == 1 &amp;amp;&amp;amp; b == 2) &lt;span class=&quot;code-comment&quot;&gt;//has to have &amp;amp;&amp;amp; or || , cannot be a single truth check
&lt;/span&gt;			def c = add(a,b)
		def d = 3 &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; has to be here after the &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; or any command before end block
&lt;/span&gt;	}

	&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; add(a,b) {
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; a+b
	}
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17429459" author="emilles" created="Fri, 15 Oct 2021 18:54:12 +0000"  >&lt;p&gt;Thanks for the extra work to get a small recreation case.  I can see that this affects Groovy 3 as you noted, but not Groovy 4.  So I will have a look at the possible change that altered this scenario.&lt;/p&gt;</comment>
                            <comment id="17429466" author="emilles" created="Fri, 15 Oct 2021 19:25:17 +0000"  >&lt;p&gt;So because &quot;def c = ...&quot; is not within braces, there is no block under the if to accept the variable declaration.  It ends up being defined in the enclosing block&apos;s scope.  Groovy 3 uses dual-path compilation (as opposed to invoke dynamic mode that is default for Groovy 4) &amp;#8211; see OptimizingStatementWriter#writeIfElse.  The declaration is written again and so a second &quot;c&quot; is added to the enclosing scope.&lt;/p&gt;

&lt;p&gt;When a scope pops from the stack, it uses a map the set end labels.  When a method is finished, clear() uses a deque of variables to write out the table.  The map only has one &quot;c&quot; and so it misses setting the other&apos;s end label.&lt;/p&gt;</comment>
                            <comment id="17429468" author="emilles" created="Fri, 15 Oct 2021 19:28:26 +0000"  >&lt;p&gt;Java does not recognize this style: &quot;if(true) int i = 0;&quot;&lt;/p&gt;

&lt;p&gt;Groovy could block this sort of thing via the parser or it could create an implicit block to wrap the declaration.&lt;/p&gt;</comment>
                            <comment id="17429479" author="emilles" created="Fri, 15 Oct 2021 20:41:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/e7f316af9055e5138f36874b47d22b0923efc34e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/e7f316af9055e5138f36874b47d22b0923efc34e&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17432449" author="davydotcom" created="Thu, 21 Oct 2021 13:14:10 +0000"  >&lt;p&gt;Can this be resolved in 3 as this breaks some grails apps and should probably be fixed in groovy 3 as well&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 3 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0vtbc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>