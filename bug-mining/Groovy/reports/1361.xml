<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:17:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-4392] asymmetry of closure parameter type among String#replaceAll/String#eachMatch/Pattern#each</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-4392</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The closure which passed to String#replaceAll() takes arguments in two patterns:&lt;/p&gt;

&lt;p&gt;1) Object[]&lt;br/&gt;
2) Arguments correspond to matcher&apos;s group(0), group(1), group(2) ...&lt;/p&gt;

&lt;p&gt;but the closure for Pattern#match(Closure) and String#eachMatch(Closure) takes:&lt;/p&gt;

&lt;p&gt;1) List&lt;br/&gt;
2) Arguments correspond to matcher&apos;s group(0), group(1), group(2) ...&lt;/p&gt;

&lt;p&gt;So there is an asymmetry about 1).&lt;/p&gt;

&lt;p&gt;If this issue should be fixed, IMHO, to change replaceAll() to take a list like&lt;br/&gt;
match/eachMatch is better. Because you can write simply:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;ABDE&quot;&lt;/span&gt; == &lt;span class=&quot;code-quote&quot;&gt;&quot;abcdef&quot;&lt;/span&gt;.replaceAll(/(..)(.)/) { it[1].toUpperCase() } &lt;span class=&quot;code-comment&quot;&gt;// (A)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;rather than:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;ABDE&quot;&lt;/span&gt; == &lt;span class=&quot;code-quote&quot;&gt;&quot;abcdef&quot;&lt;/span&gt;.replaceAll(/(..)(.)/) { &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] it -&amp;gt; it[1].toUpperCase() } &lt;span class=&quot;code-comment&quot;&gt;//(B)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(A) is same as: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;ABDE&quot;&lt;/span&gt; == &lt;span class=&quot;code-quote&quot;&gt;&quot;abcdef&quot;&lt;/span&gt;.replaceAll(/(..)(.)/) { List it -&amp;gt; it[1].toUpperCase() } &lt;span class=&quot;code-comment&quot;&gt;// (C)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I attach small patch for 1.8-trunk and some test cases for this.&lt;br/&gt;
This patch leads small backward-incompatibility so that (B) would fail because&lt;br/&gt;
of the difference of parameter type of the closure. But current test cases&lt;br/&gt;
don&apos;t include this.&lt;/p&gt;</description>
                <environment>MacOS X</environment>
        <key id="12815287">GROOVY-4392</key>
            <summary>asymmetry of closure parameter type among String#replaceAll/String#eachMatch/Pattern#each</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="guillaume">Guillaume Sauthier</assignee>
                                    <reporter username="uehaj">UEHARA Junji</reporter>
                        <labels>
                    </labels>
                <created>Sun, 5 Sep 2010 09:25:22 +0000</created>
                <updated>Wed, 15 Dec 2010 16:56:52 +0000</updated>
                            <resolved>Tue, 21 Sep 2010 10:52:49 +0000</resolved>
                                                    <fixVersion>1.7.6</fixVersion>
                    <fixVersion>1.8-beta-3</fixVersion>
                                    <component>groovy-jdk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14469972" author="uehaj" created="Sun, 5 Sep 2010 23:26:26 +0000"  >&lt;p&gt;&amp;gt; This patch leads small backward-incompatibility&lt;/p&gt;

&lt;p&gt;by checking the parameter type of the the replacement closure,&lt;br/&gt;
we can avoid this backward-incompatibility.&lt;/p&gt;

&lt;p&gt;pseudo code is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (the closure&apos;s parameter is &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[]) {
    replacement = InvokerHelper.toString(closure.call(groups.toArray()));
}
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
    replacement = InvokerHelper.toString(closure.call(groups));
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14470023" author="guillaume" created="Wed, 15 Sep 2010 09:56:29 +0000"  >&lt;p&gt;Do you have an updated patch including your comment on backward-incompatibility?&lt;/p&gt;</comment>
                            <comment id="14470105" author="uehaj" created="Sat, 18 Sep 2010 10:31:50 +0000"  >&lt;p&gt;Yes I have.&lt;br/&gt;
I added testcases for Object[] pattern for backward compatibility check.&lt;/p&gt;
</comment>
                            <comment id="14470060" author="uehaj" created="Sat, 18 Sep 2010 10:34:07 +0000"  >&lt;p&gt;patch which accepts the closure whose parameter is Object[] for backward compatibility.&lt;br/&gt;
I appreciate your consideration.&lt;/p&gt;</comment>
                            <comment id="14470137" author="guillaume" created="Sat, 18 Sep 2010 14:51:13 +0000"  >&lt;p&gt;Thank you, I&apos;ll integrate your patch soon!&lt;/p&gt;</comment>
                            <comment id="14470204" author="guillaume" created="Mon, 20 Sep 2010 10:31:15 +0000"  >&lt;p&gt;Did you make some other changes?&lt;br/&gt;
Running the Groovy build with those changes, and I get 2 failing tests:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Testcase: testReplaceAllClosure took 0,007 sec
	Caused an ERROR
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;1 a 2 b 3 c 4&quot;&lt;/span&gt;.replaceAll(&lt;span class=&quot;code-quote&quot;&gt;&quot;\\p{Digit}&quot;&lt;/span&gt;) {it * 2} == &lt;span class=&quot;code-quote&quot;&gt;&quot;11 a 22 b 33 c 44&quot;&lt;/span&gt;
                       |                                 |
                       [1, 1] a [2, 2] b [3, 3] c [4, 4] &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
Assertion failed: 

&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;1 a 2 b 3 c 4&quot;&lt;/span&gt;.replaceAll(&lt;span class=&quot;code-quote&quot;&gt;&quot;\\p{Digit}&quot;&lt;/span&gt;) {it * 2} == &lt;span class=&quot;code-quote&quot;&gt;&quot;11 a 22 b 33 c 44&quot;&lt;/span&gt;
                       |                                 |
                       [1, 1] a [2, 2] b [3, 3] c [4, 4] &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;

	at org.codehaus.groovy.runtime.InvokerHelper.assertFailed(InvokerHelper.java:386)
	at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.assertFailed(ScriptBytecodeAdapter.java:662)
	at groovy.GroovyMethodsTest.testReplaceAllClosure(GroovyMethodsTest.groovy:513)

Testcase: testReplaceAllClosurePattern took 0,002 sec
	Caused an ERROR
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;1 a 2 b 3 c 4&quot;&lt;/span&gt;.replaceAll(~&lt;span class=&quot;code-quote&quot;&gt;&quot;\\p{Digit}&quot;&lt;/span&gt;) {it * 2} == &lt;span class=&quot;code-quote&quot;&gt;&quot;11 a 22 b 33 c 44&quot;&lt;/span&gt;
                       |          |                       |
                       |          \p{Digit}               &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
                       [1, 1] a [2, 2] b [3, 3] c [4, 4]
Assertion failed: 

&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;1 a 2 b 3 c 4&quot;&lt;/span&gt;.replaceAll(~&lt;span class=&quot;code-quote&quot;&gt;&quot;\\p{Digit}&quot;&lt;/span&gt;) {it * 2} == &lt;span class=&quot;code-quote&quot;&gt;&quot;11 a 22 b 33 c 44&quot;&lt;/span&gt;
                       |          |                       |
                       |          \p{Digit}               &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
                       [1, 1] a [2, 2] b [3, 3] c [4, 4]

	at org.codehaus.groovy.runtime.InvokerHelper.assertFailed(InvokerHelper.java:386)
	at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.assertFailed(ScriptBytecodeAdapter.java:662)
	at groovy.GroovyMethodsTest.testReplaceAllClosurePattern(GroovyMethodsTest.groovy:517)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14470077" author="uehaj" created="Mon, 20 Sep 2010 23:03:10 +0000"  >&lt;p&gt;Thanks for checking.&lt;br/&gt;
Sorry for the tests failure.&lt;br/&gt;
those are come from my patch. &lt;/p&gt;

&lt;p&gt;I&apos;d like to create new one as soon as possible.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;analysis&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;each&amp;amp;eachMatch are using Matcher#iterator() to&lt;br/&gt;
get each matched groups. And the next()&lt;br/&gt;
method of the Iterator which returned from Matcher#iterator()&lt;br/&gt;
doing following process:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (the regular expression has capturing group) {
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; of matching groups;
}
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; whole of match;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;so, to emulate above behavior in replaceAll,&lt;br/&gt;
it should change the parameter to the closure&lt;br/&gt;
according to the value of matcher.hasGroup().&lt;/p&gt;</comment>
                            <comment id="14470159" author="guillaume" created="Tue, 21 Sep 2010 08:14:37 +0000"  >&lt;p&gt;So a new patch coming? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14470193" author="guillaume" created="Tue, 21 Sep 2010 08:15:31 +0000"  >&lt;p&gt;Make sure to run at least the two tests:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;groovy.RegularExpressionsTest&lt;/li&gt;
	&lt;li&gt;groovy.GroovyMethodsTest&lt;br/&gt;
when you submit your udpated patch.&lt;br/&gt;
Looking forward to it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14470139" author="uehaj" created="Tue, 21 Sep 2010 09:50:08 +0000"  >&lt;p&gt;This is new patch. I hope this is final &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I extracted a method named &apos;getReplacement()&apos; from replaceAll().&lt;br/&gt;
I&apos;m not native English speaker so please check or rewrite the javadoc comments.&lt;/p&gt;

&lt;p&gt;I tested the following cases:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; ant -DtestCase=groovy.RegularExpressionsTest test
 ant -DtestCase=groovy.GroovyMethodsTest test
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14470078" author="guillaume" created="Tue, 21 Sep 2010 10:52:39 +0000"  >&lt;p&gt;This time was the good one &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Thanks for the patch!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722450" name="patch" size="2224" author="uehaj" created="Sun, 5 Sep 2010 09:25:23 +0000"/>
                            <attachment id="12722454" name="patch2" size="2501" author="uehaj" created="Sat, 18 Sep 2010 10:34:07 +0000"/>
                            <attachment id="12722694" name="patch3" size="4499" author="uehaj" created="Tue, 21 Sep 2010 09:50:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2caqv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>