<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:14:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-10178] @CompileStatic and @NullCheck make compiler fail</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-10178</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The following code makes compiler fail with an error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@groovy.transform.CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;A {
  @groovy.transform.NullCheck
  void method(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; arg) {
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;Compiler shows the following error and exists:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed:
General error during instruction selection: Index -1 out of bounds &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; length 0

java.lang.IndexOutOfBoundsException: Index -1 out of bounds &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; length 0
	at java.base/jdk.internal.util.Preconditions.outOfBounds(Preconditions.java:64)
	at java.base/jdk.internal.util.Preconditions.outOfBoundsCheckIndex(Preconditions.java:70)
	at java.base/jdk.internal.util.Preconditions.checkIndex(Preconditions.java:248)
	at java.base/java.util.Objects.checkIndex(Objects.java:372)
	at java.base/java.util.ArrayList.remove(ArrayList.java:535)
	at org.codehaus.groovy.classgen.asm.OperandStack.popWithMessage(OperandStack.java:110)
	at org.codehaus.groovy.classgen.asm.OperandStack.remove(OperandStack.java:218)
	at org.codehaus.groovy.classgen.asm.StatementWriter.writeThrow(StatementWriter.java:592)
	at org.codehaus.groovy.classgen.AsmClassGenerator.visitThrowStatement(AsmClassGenerator.java:676)
	at org.codehaus.groovy.ast.stmt.ThrowStatement.visit(ThrowStatement.java:41)
	at org.codehaus.groovy.classgen.asm.StatementWriter.writeIfElse(StatementWriter.java:323)
	at org.codehaus.groovy.classgen.AsmClassGenerator.visitIfElse(AsmClassGenerator.java:637)
	at org.codehaus.groovy.ast.stmt.IfStatement.visit(IfStatement.java:41)
	at org.codehaus.groovy.classgen.asm.StatementWriter.writeBlockStatement(StatementWriter.java:94)
	at org.codehaus.groovy.classgen.asm.sc.StaticTypesStatementWriter.writeBlockStatement(StaticTypesStatementWriter.java:78)
	at org.codehaus.groovy.classgen.AsmClassGenerator.visitBlockStatement(AsmClassGenerator.java:617)
	at org.codehaus.groovy.ast.stmt.BlockStatement.visit(BlockStatement.java:69)
	at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitClassCodeContainer(ClassCodeVisitorSupport.java:138)
	at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitConstructorOrMethod(ClassCodeVisitorSupport.java:111)
	at org.codehaus.groovy.classgen.AsmClassGenerator.visitStdMethod(AsmClassGenerator.java:461)
	at org.codehaus.groovy.classgen.AsmClassGenerator.visitConstructorOrMethod(AsmClassGenerator.java:408)
	at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitMethod(ClassCodeVisitorSupport.java:106)
	at org.codehaus.groovy.classgen.AsmClassGenerator.visitMethod(AsmClassGenerator.java:556)
	at org.codehaus.groovy.ast.ClassNode.visitMethods(ClassNode.java:1099)
	at org.codehaus.groovy.ast.ClassNode.visitContents(ClassNode.java:1092)
	at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitClass(ClassCodeVisitorSupport.java:52)
	at org.codehaus.groovy.classgen.AsmClassGenerator.visitClass(AsmClassGenerator.java:271)
	at org.codehaus.groovy.control.CompilationUnit$3.call(CompilationUnit.java:797)
	at org.codehaus.groovy.control.CompilationUnit$IPrimaryClassNodeOperation.doPhaseOperation(CompilationUnit.java:942)
	at org.codehaus.groovy.control.CompilationUnit.processPhaseOperations(CompilationUnit.java:671)
	at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:635)
	at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:610)
	at org.codehaus.groovy.tools.FileSystemCompiler.compile(FileSystemCompiler.java:311)
	at org.codehaus.groovy.tools.FileSystemCompiler.doCompilation(FileSystemCompiler.java:240)
	at org.codehaus.groovy.tools.FileSystemCompiler.commandLineCompile(FileSystemCompiler.java:165)
	at org.codehaus.groovy.tools.FileSystemCompiler.commandLineCompileWithErrorHandling(FileSystemCompiler.java:205)
	at org.codehaus.groovy.tools.FileSystemCompiler.main(FileSystemCompiler.java:189)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.codehaus.groovy.tools.GroovyStarter.rootLoader(GroovyStarter.java:111)
	at org.codehaus.groovy.tools.GroovyStarter.main(GroovyStarter.java:129)

1 error


&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;Tested against JDK 11 and JDK8. Both fail with same error.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13391213">GROOVY-10178</key>
            <summary>@CompileStatic and @NullCheck make compiler fail</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="maurociancio">Mauro Ciancio</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Jul 2021 22:37:47 +0000</created>
                <updated>Thu, 3 Feb 2022 22:32:01 +0000</updated>
                            <resolved>Tue, 28 Sep 2021 16:12:27 +0000</resolved>
                                    <version>3.0.8</version>
                                    <fixVersion>4.0.0-beta-2</fixVersion>
                    <fixVersion>3.0.10</fixVersion>
                                    <component>Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17385142" author="maurociancio" created="Wed, 21 Jul 2021 22:39:34 +0000"  >&lt;p&gt;I might provide a patch if someone gives me a hint where to look!&lt;/p&gt;</comment>
                            <comment id="17389234" author="maurociancio" created="Thu, 29 Jul 2021 03:35:18 +0000"  >&lt;p&gt;I have a patch that&apos;s a failing test.&lt;/p&gt;

&lt;p&gt;HTH&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13031177/13031177_0001-failing-test.patch&quot; title=&quot;0001-failing-test.patch attached to GROOVY-10178&quot;&gt;0001-failing-test.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17411995" author="maurociancio" created="Wed, 8 Sep 2021 15:08:27 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt;. I can help you testing the solution, so please let me know!&lt;/p&gt;

&lt;p&gt;I tried debugging the problem but it was too much for me.&lt;/p&gt;

&lt;p&gt;I can try to fix it if you give me some hints!&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="17412024" author="emilles" created="Wed, 8 Sep 2021 15:45:25 +0000"  >&lt;p&gt;Are you able to use debugger against compiler process?  I would start investigation by putting breakpoint on StatementWriter.java:592 to see what the operand stack looks like when the OOB exception is thrown.  That should give you a good idea which method is being written so you could look at its AST.&lt;/p&gt;</comment>
                            <comment id="17412102" author="emilles" created="Wed, 8 Sep 2021 17:42:29 +0000"  >&lt;p&gt;You can also test through the gradle build using your test case patch and a command line like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
gradlew --no-build-cache --no-scan :test --tests org.codehaus.groovy.transform.NullCheckTransformTest --debug-jvm
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;JUnit will wait for your remote debug attach on part 5005.&lt;/p&gt;</comment>
                            <comment id="17421575" author="maurociancio" created="Tue, 28 Sep 2021 17:49:32 +0000"  >&lt;p&gt;hey thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13031177" name="0001-failing-test.patch" size="1409" author="maurociancio" created="Thu, 29 Jul 2021 03:35:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 7 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0t7s8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>