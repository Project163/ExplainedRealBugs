<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:14:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-3980] GroovyScriptingEngine doesn&apos;t recognize changes in the source of checked class only when dependencies got changed</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-3980</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Expected behaviour from my point of view it that GroovyScriptEngine should refresh class everytime its source code or source code of any of classes this class references changes. Such behaviour was implemented in 1.6.5. When upgrading to 1.7.0 our test began to fail - class is refreshed only in case of referenced classes source code gets changed, but when I directly change the source of the class I am directly loading, I receive old version -  no refresh occurs.&lt;/p&gt;

&lt;p&gt;I can prove this by the set of tests that pass on 1.6.5 but fails on 1.7.0. Precisely the proving test is: &lt;br/&gt;
com.fg.scripting.groovy.GroovyScriptingEngineReloadSupportTest#testReloadGroovyClass&lt;/p&gt;

&lt;p&gt;Before running tests, please inspect com.fg.scripting.groovy.AbstractGroovyTest#setUp and modify the path.&lt;/p&gt;</description>
                <environment>Groovy 1.7.0-all, JDK 1.5, Win</environment>
        <key id="12811995">GROOVY-3980</key>
            <summary>GroovyScriptingEngine doesn&apos;t recognize changes in the source of checked class only when dependencies got changed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roshandawrani">Roshan Dawrani</assignee>
                                    <reporter username="novoj">Jan Novotn&#253;</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Jan 2010 14:25:31 +0000</created>
                <updated>Sun, 5 Apr 2015 14:43:55 +0000</updated>
                            <resolved>Fri, 8 Jan 2010 13:18:25 +0000</resolved>
                                    <version>1.7.0</version>
                                    <fixVersion>1.7.1</fixVersion>
                    <fixVersion>1.8-beta-1</fixVersion>
                                    <component>class generator</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="3600">1h</timeoriginalestimate>
                            <timeestimate seconds="3600">1h</timeestimate>
                                        <comments>
                            <comment id="14468672" author="roshandawrani" created="Fri, 8 Jan 2010 04:18:38 +0000"  >&lt;p&gt;I wanted to run the given tests to see what was happening in the reloading, but am unable to do it as it fails with &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[INFO] Failed to resolve artifact.

GroupId: com.fg
ArtifactId: fg-default-jdk15-library
Version: 1.12

Reason: Unable to download the artifact from any repository

  com.fg:fg-default-jdk15-library:pom:1.12
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What do I need to do to run the tests?&lt;/p&gt;</comment>
                            <comment id="14468584" author="novoj" created="Fri, 8 Jan 2010 04:27:19 +0000"  >&lt;p&gt;Sorry, I forget to remove our company parent pom. I will replace Zip with correct version. Give me some time please.&lt;/p&gt;</comment>
                            <comment id="14468624" author="novoj" created="Fri, 8 Jan 2010 04:36:27 +0000"  >&lt;p&gt;Can you please try this one?&lt;/p&gt;</comment>
                            <comment id="14468691" author="roshandawrani" created="Fri, 8 Jan 2010 05:16:43 +0000"  >&lt;p&gt;Still no luck - first compilation of java files was failing with the message that &quot;annotation/generics not supported. Try -source 1.5&quot;. I configured the maven-compiler-plugin to use 1.5 source version.&lt;/p&gt;

&lt;p&gt;After that downloads of javax/mail, javax/jms artifacts is not going through for me. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14468643" author="novoj" created="Fri, 8 Jan 2010 05:37:50 +0000"  >&lt;p&gt;Javax libraries are not on public repositories due to licensing issues. They are not necessary for the test, but are probably in Log4J transitive dependencies. I will try to configure it better.&lt;/p&gt;</comment>
                            <comment id="14468644" author="novoj" created="Fri, 8 Jan 2010 05:43:24 +0000"  >&lt;p&gt;I excluded problematic libraries and configured compiler plugin. Try it please and sorry not making it on the first strike. Nice example of environment differences.&lt;/p&gt;</comment>
                            <comment id="14468694" author="roshandawrani" created="Fri, 8 Jan 2010 05:54:55 +0000"  >&lt;p&gt;I am now able to run the tests. Following are found to be failing - &lt;/p&gt;

&lt;p&gt;testReloadGroovyClass(com.fg.scripting.groovy.GroovyScriptingEngineReloadSupportTest)&lt;br/&gt;
testReloadLoadGroovyClass(com.fg.scripting.groovy.SpringGroovyReloadSupportTest)&lt;/p&gt;

&lt;p&gt;Thanks for quickly assisting me in trying to reproduce the issue locally.&lt;/p&gt;</comment>
                            <comment id="14468573" author="novoj" created="Fri, 8 Jan 2010 06:01:40 +0000"  >&lt;p&gt;It&apos;s for my own good &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
For this issue only test: testReloadGroovyClass(com.fg.scripting.groovy.GroovyScriptingEngineReloadSupportTest) is interesting. The second test is reported in another issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-3981&quot; title=&quot;Spring 2.5.X refresh interval incompatibility&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-3981&quot;&gt;&lt;del&gt;GROOVY-3981&lt;/del&gt;&lt;/a&gt;), documenting incompatibility with Spring Framework.&lt;/p&gt;</comment>
                            <comment id="14468717" author="roshandawrani" created="Fri, 8 Jan 2010 06:41:50 +0000"  >&lt;p&gt;One confusion. You pom shows that you are using spring 2.5.6 and spring/2.5.6/spring-2.5.6.pom shows that it depends on groovy 1.5.6.&lt;/p&gt;

&lt;p&gt;I think, after 1.5.6 (especially in 1.7.0), GroovyScriptEngine has undergone a lot of changes in the (reloading) logic it uses to determine if sources/their dependencies have changed.&lt;/p&gt;

&lt;p&gt;Will it be possible for you to try it with a version of spring that uses a newer groovy version and see if you still face this issue?&lt;/p&gt;

&lt;p&gt;Changes to groovy 1.5.x line are not happening now anyway.&lt;/p&gt;</comment>
                            <comment id="14468627" author="roshandawrani" created="Fri, 8 Jan 2010 06:49:33 +0000"  >&lt;p&gt;Or will the groovy version be taken from pom of your test code, which is 1.7.0?&lt;/p&gt;

&lt;p&gt;Sorry I don&apos;t know maven much - just wanted to make sure that it is 1.7.0 that is getting used by test, as there is not much point in debugging it if it is using 1.5.6.&lt;/p&gt;

&lt;p&gt;Can I make maven output the runtime classpath it is using?&lt;/p&gt;</comment>
                            <comment id="14468660" author="roshandawrani" created="Fri, 8 Jan 2010 06:53:10 +0000"  >&lt;p&gt;Please ignore my last couple of comments. I forgot about your patch - you must have tested it on 1.7.0, so it must be 1.7.0 on the mvn classpath. Sorry.&lt;/p&gt;</comment>
                            <comment id="14468674" author="novoj" created="Fri, 8 Jan 2010 06:59:55 +0000"  >&lt;p&gt;Yes, I am sure 1.7.0 is used - it&apos;s the explicit dependency set in pom.xml - try this:&lt;/p&gt;

&lt;p&gt;mvn dependency:tree&lt;/p&gt;

&lt;p&gt;This should print the dependent JARS.&lt;/p&gt;

&lt;p&gt;Moreover, I&apos;ve tested my patch on latest sources checked out from Subversion and test passes. Spring shouldn&apos;t be involved in this test as I use directly GroovyScriptEngine.&lt;/p&gt;</comment>
                            <comment id="14468705" author="roshandawrani" created="Fri, 8 Jan 2010 08:07:48 +0000"  >&lt;p&gt;I have looked into the issue a bit and also the patch, and I think the patch is wrong. It is wrong because it is comparing a ScriptCacheEntry&apos;s modified time with current system time, which will always be true and hence the script will always get re-compiled, even when there are no changes to the script.&lt;/p&gt;

&lt;p&gt;So, say, a script was first loaded by GSE at time T1 and next calls are made at T1 + t1(System.currentTimeMillis), T1 + t2, T1 + t3, and there is no change in the script file at all, but because T1 &amp;lt; T1 + t1(or t2 or t3) will always give true, it will keep getting re-compiled.&lt;/p&gt;

&lt;p&gt;The idea is correct though - that in addition to looking at an entries dependencies, it should also look at the entry itself.&lt;/p&gt;

&lt;p&gt;I will get back after looking a bit more.&lt;/p&gt;</comment>
                            <comment id="14468692" author="roshandawrani" created="Fri, 8 Jan 2010 09:13:32 +0000"  >&lt;p&gt;Attaching the patch I propose.&lt;/p&gt;

&lt;p&gt;It&apos;s getting rid of the failure &quot;testReloadGroovyClass(com.fg.scripting.groovy.GroovyScriptingEngineReloadSupportTest)&quot;&lt;/p&gt;</comment>
                            <comment id="14468625" author="blackdrag" created="Fri, 8 Jan 2010 09:56:42 +0000"  >&lt;p&gt;I thought the problem is that something is not recompiled... When it is always recompiled, then this makes no sense at all for me.&lt;/p&gt;

&lt;p&gt;Checking the entry itself was not needed before, becaue the script has itself as dependency - at least I thought so. I guess that this might not always be the case&lt;/p&gt;</comment>
                            <comment id="14468609" author="roshandawrani" created="Fri, 8 Jan 2010 10:02:43 +0000"  >&lt;p&gt;No, the script did not have itself as a dependency.&lt;/p&gt;

&lt;p&gt;It&apos;s not that something is always getting recompiled - then the issue would not have been there, as you say. &lt;/p&gt;

&lt;p&gt;The main script was always getting recompiled if I tried the patch originally provided. On original 1.7.0, you are right that main entry was not getting recompiled and that was the problem in the issue reported here.&lt;/p&gt;</comment>
                            <comment id="14468645" author="novoj" created="Fri, 8 Jan 2010 11:18:00 +0000"  >&lt;p&gt;Thank you for solving the issue Roshan - I clearly missed the point. It was a way harder that I initially thought.&lt;/p&gt;</comment>
                            <comment id="14468574" author="roshandawrani" created="Fri, 8 Jan 2010 11:29:30 +0000"  >&lt;p&gt;Jochen, here is another patch that adds the script itself also to its dependencies.&lt;/p&gt;

&lt;p&gt;The counts in the DepenendencyTest had to be incremented by 1 due to this extra dependency that is now there.&lt;/p&gt;</comment>
                            <comment id="14468706" author="blackdrag" created="Fri, 8 Jan 2010 12:10:34 +0000"  >&lt;p&gt;seems I had the right intention and then forgot about it later in the implementation. Thanks Roshan, that patch looks good to me&lt;/p&gt;</comment>
                            <comment id="14468661" author="roshandawrani" created="Fri, 8 Jan 2010 12:12:02 +0000"  >&lt;p&gt;Patch v2, right? I will go ahead and apply then?&lt;/p&gt;</comment>
                            <comment id="14468719" author="roshandawrani" created="Fri, 8 Jan 2010 13:18:25 +0000"  >&lt;p&gt;Fixed.&lt;/p&gt;

&lt;p&gt;You are welcome, Jan.&lt;/p&gt;</comment>
                            <comment id="14468702" author="paulk" created="Fri, 8 Jan 2010 22:54:00 +0000"  >&lt;p&gt;Nice work!&lt;/p&gt;</comment>
                            <comment id="14468675" author="roshandawrani" created="Fri, 8 Jan 2010 23:00:12 +0000"  >&lt;p&gt;Thanks, Paul &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722427" name="3980_v17x_Patch.txt" size="2742" author="roshandawrani" created="Fri, 8 Jan 2010 09:13:32 +0000"/>
                            <attachment id="12722492" name="lib_groovy-1.7.0.zip" size="49536" author="novoj" created="Fri, 8 Jan 2010 05:43:24 +0000"/>
                            <attachment id="12722304" name="patch-GroovyScriptEngine.patch" size="637" author="novoj" created="Thu, 7 Jan 2010 14:25:31 +0000"/>
                            <attachment id="12722307" name="v2_3980_v17x_Patch.txt" size="2437" author="roshandawrani" created="Fri, 8 Jan 2010 11:29:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 46 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cji7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>