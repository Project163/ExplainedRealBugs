<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:03:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-8815] Inconsistent class file - undefined type parameter for trait implementer</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-8815</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;When compiling the following classes, the Service class ends up with an incomplete type parameter in it. This causes errors for the IDE: &quot;Inconsistent classfile encountered: The undefined type parameter T is referenced from within Service&quot;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.function.Consumer
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Event&amp;lt;T&amp;gt; {
  Event(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; id, T payload) {
  }
  Event&amp;lt;T&amp;gt; setReplyTo(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; replyTo) {
  }
}

@CompileStatic
trait Events {
  def &amp;lt;E &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Event&amp;lt;?&amp;gt;&amp;gt; Registration&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;, Consumer&amp;lt;E&amp;gt;&amp;gt; on(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; key, Closure consumer) {
  }
}

&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; Registration&amp;lt;K, V&amp;gt; {
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Service &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; Events {
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;javap output for Events shows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; &amp;lt;E &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Event&amp;lt;?&amp;gt;&amp;gt; Registration&amp;lt;java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;,java.util.function.Consumer&amp;lt;E&amp;gt;&amp;gt; on(java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;, groovy.lang.Closure);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;javap output for Service shows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &amp;lt;E &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Event&amp;lt;T&amp;gt;&amp;gt; Registration&amp;lt;java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;, java.util.function.Consumer&amp;lt;E&amp;gt;&amp;gt; on(java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;, groovy.lang.Closure);
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &amp;lt;E &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Event&amp;lt;?&amp;gt;&amp;gt; Registration&amp;lt;java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;, java.util.function.Consumer&amp;lt;E&amp;gt;&amp;gt; Eventstrait$&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;$on(java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;, groovy.lang.Closure);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It is this &quot;T&quot; in the trait method that is not defined. I think it should be &quot;?&quot; instead when looking at the original method&apos;s and the trait bridge method&apos;s type parameters.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13187985">GROOVY-8815</key>
            <summary>Inconsistent class file - undefined type parameter for trait implementer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="emilles">Eric Milles</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Sep 2018 17:20:27 +0000</created>
                <updated>Tue, 7 Mar 2023 20:56:31 +0000</updated>
                            <resolved>Tue, 3 Sep 2019 09:00:34 +0000</resolved>
                                    <version>2.4.15</version>
                    <version>2.5.2</version>
                                    <fixVersion>3.0.0-rc-1</fixVersion>
                    <fixVersion>2.5.22</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="16630793" author="emilles" created="Thu, 27 Sep 2018 17:43:41 +0000"  >&lt;p&gt;In &lt;tt&gt;TraitComposer.createForwarderMethod&lt;/tt&gt;, the original method node is modified.  Line 367 takes in &quot;E extends Event&amp;lt;?&amp;gt;&quot; and returns &quot;E extends Event&amp;lt;T&amp;gt;&quot;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;367: GenericsType[] newGt = GenericsUtils.applyGenericsContextToPlaceHolders(genericsSpec, originalMethod.getGenericsTypes());&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="16631142" author="emilles" created="Thu, 27 Sep 2018 22:46:49 +0000"  >&lt;p&gt;When applying generics to placeholders, the wildcard is dropped.  By the end of the snippet below, &lt;tt&gt;upper&lt;/tt&gt; is &quot;Event&amp;lt;T&amp;gt;&quot;.  &lt;tt&gt;fromSpec&lt;/tt&gt; has two levels of redirect and I think &lt;tt&gt;upper&lt;/tt&gt; should be set to the first, not the last.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; GenericsType[] applyGenericsContextToPlaceHolders(Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, ClassNode&amp;gt; genericsSpec, GenericsType[] oldPlaceHolders) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (oldPlaceHolders==&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || oldPlaceHolders.length==0) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; oldPlaceHolders;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (genericsSpec.isEmpty()) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; oldPlaceHolders;
        GenericsType[] newTypes = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericsType[oldPlaceHolders.length];
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i=0; i&amp;lt;oldPlaceHolders.length; i++) {
            GenericsType old = oldPlaceHolders[i];
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!old.isPlaceholder()) &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyBugError(&lt;span class=&quot;code-quote&quot;&gt;&quot;Given generics type &quot;&lt;/span&gt;+old+&lt;span class=&quot;code-quote&quot;&gt;&quot; must be a placeholder!&quot;&lt;/span&gt;);
            ClassNode fromSpec = genericsSpec.get(old.getName());
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (fromSpec!=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (fromSpec.isGenericsPlaceHolder()) {
                    ClassNode[] upper = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ClassNode[]{fromSpec.redirect()}; &lt;span class=&quot;code-comment&quot;&gt;// fromSpec is &lt;span class=&quot;code-quote&quot;&gt;&quot;E -&amp;gt; Event&amp;lt;?&amp;gt; -&amp;gt; Event&amp;lt;T&amp;gt;&quot;&lt;/span&gt;
&lt;/span&gt;                    newTypes[i] = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericsType(fromSpec, upper, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I have no straightforward means of trying this out.  So I quickly replaced &quot;fromSpec.redirect()&quot; with &quot;java.lang.reflect.Field redirect = fromSpec.getClass().getDeclaredField(&quot;redirect&quot;); redirect.setAccessible(true); (ClassNode) redirect.get(fromSpec)&quot;.  If getting at this first level of redirect is indeed correct, then ClassNode probably needs some helper method to make this available to GenericsUtils.&lt;/p&gt;</comment>
                            <comment id="16631208" author="emilles" created="Fri, 28 Sep 2018 00:22:37 +0000"  >&lt;p&gt;&lt;b&gt;Can someone from the core team confirm that these changes are okay?&lt;/b&gt;  I have tried a number of tests but not the groovy-core ones.&lt;/p&gt;

&lt;p&gt;I added this to &lt;tt&gt;ClassNode&lt;/tt&gt;&#160;just above &lt;tt&gt;getGenericsType&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; GenericsType asGenericsType() {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!isGenericsPlaceHolder()) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericsType(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            ClassNode upper = (redirect != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? redirect : &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericsType(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ClassNode[]{upper}, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then I edited &lt;tt&gt;GenericsUtils&lt;/tt&gt; as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; GenericsType[] applyGenericsContextToPlaceHolders(Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, ClassNode&amp;gt; genericsSpec, GenericsType[] oldPlaceHolders) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (oldPlaceHolders==&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || oldPlaceHolders.length==0) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; oldPlaceHolders;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (genericsSpec.isEmpty()) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; oldPlaceHolders;
        GenericsType[] newTypes = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericsType[oldPlaceHolders.length];
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i=0; i&amp;lt;oldPlaceHolders.length; i++) {
            GenericsType old = oldPlaceHolders[i];
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!old.isPlaceholder()) &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyBugError(&lt;span class=&quot;code-quote&quot;&gt;&quot;Given generics type &quot;&lt;/span&gt;+old+&lt;span class=&quot;code-quote&quot;&gt;&quot; must be a placeholder!&quot;&lt;/span&gt;);
            ClassNode fromSpec = genericsSpec.get(old.getName());
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (fromSpec!=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                /* GRECLIPSE edit
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (fromSpec.isGenericsPlaceHolder()) {
                    ClassNode[] upper = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ClassNode[]{fromSpec.redirect()};
                    newTypes[i] = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericsType(fromSpec, upper, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
                } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                    newTypes[i] = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericsType(fromSpec);
                }
                */
                newTypes[i] = fromSpec.asGenericsType();
                &lt;span class=&quot;code-comment&quot;&gt;// GRECLIPSE end
&lt;/span&gt;            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And I edited &lt;tt&gt;ClassNode.toString(boolean)&lt;/tt&gt; to show the redirects (for easier debugging):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; toString(&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; showRedirect) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isArray()) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; componentType.toString(showRedirect)+&lt;span class=&quot;code-quote&quot;&gt;&quot;[]&quot;&lt;/span&gt;;
        }
        StringBuilder ret = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringBuilder(getName());
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (placeholder) ret = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringBuilder(getUnresolvedName());
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!placeholder &amp;amp;&amp;amp; genericsTypes != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            ret.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;&quot;&lt;/span&gt;);
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0, n = genericsTypes.length; i &amp;lt; n; i += 1) {
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (i != 0) ret.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;);
                GenericsType genericsType = genericsTypes[i];
                ret.append(genericTypeAsString(genericsType));
            }
            ret.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;gt;&quot;&lt;/span&gt;);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (redirect != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; showRedirect) {
            ret.append(&lt;span class=&quot;code-quote&quot;&gt;&quot; -&amp;gt; &quot;&lt;/span&gt;).append(redirect.toString());
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ret.toString();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16631910" author="paulk" created="Fri, 28 Sep 2018 14:15:15 +0000"  >&lt;p&gt;Removing the space in the toString breaks many tests which rely on formatting of error messages. I&apos;d like to get rid of it but perhaps that will be 3 only. Just checking without that change now but hotel wifi is dropping in and out today.&lt;/p&gt;</comment>
                            <comment id="16631949" author="emilles" created="Fri, 28 Sep 2018 14:47:08 +0000"  >&lt;p&gt;Thanks for checking.&#160; The &lt;tt&gt;toString&lt;/tt&gt; change is not needed, so no worries if it is left out completely.&lt;/p&gt;</comment>
                            <comment id="16642424" author="emilles" created="Mon, 8 Oct 2018 20:32:09 +0000"  >&lt;p&gt;Pending changes for 2.5.3 have moved this problem a bit.  &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, ClassNode&amp;gt; addMethodGenerics(MethodNode current, Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, ClassNode&amp;gt; oldSpec) {
        Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, ClassNode&amp;gt; ret = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, ClassNode&amp;gt;(oldSpec);
        &lt;span class=&quot;code-comment&quot;&gt;// ret starts with the original type specs, now add gts &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the current method &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; any
&lt;/span&gt;        GenericsType[] sgts = current.getGenericsTypes();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sgts != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (GenericsType sgt : sgts) {
                &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name = sgt.getName();
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sgt.isPlaceholder()) {
                    ClassNode redirect;
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sgt.getUpperBounds() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                        redirect = sgt.getUpperBounds()[0];
                    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sgt.getLowerBound() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                        redirect = sgt.getLowerBound();
                    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                        redirect = ClassHelper.OBJECT_TYPE;
                    }
                    &lt;span class=&quot;code-comment&quot;&gt;// At &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; point, name is &lt;span class=&quot;code-quote&quot;&gt;&quot;E&quot;&lt;/span&gt; and redirect is &lt;span class=&quot;code-quote&quot;&gt;&quot;Event &amp;lt;java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; -&amp;gt; Event &amp;lt;T &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;&quot;&lt;/span&gt;
&lt;/span&gt;                    ClassNode type = ClassHelper.makeWithoutCaching(name);
                    type.setGenericsPlaceHolder(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
                    type.setRedirect(redirect); &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; call takes &lt;span class=&quot;code-quote&quot;&gt;&quot;Event &amp;lt;T &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;&quot;&lt;/span&gt; only and the inconsistent &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;file issue returns
&lt;/span&gt;                    ret.put(name, type);
                } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                    ret.put(name, sgt.getType());
                }
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ret;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16646673" author="emilles" created="Thu, 11 Oct 2018 15:59:20 +0000"  >&lt;p&gt;Paul,&lt;br/&gt;
I have a suspicion that my proposed changes also fix &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8757&quot; title=&quot;Incorrect bytecode produced after compiling class implementing trait with generic method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8757&quot;&gt;&lt;del&gt;GROOVY-8757&lt;/del&gt;&lt;/a&gt;.  I don&apos;t have a quick way to check that myself; Eclipse has a slightly different path within &lt;tt&gt;ResolveVisitor&lt;/tt&gt;.  Would you be able to roll back the 8757 change in &lt;tt&gt;addMethodGenerics&lt;/tt&gt; and see if the &lt;tt&gt;asGenericsType&lt;/tt&gt;/&lt;tt&gt;applyGenericsContextToPlaceHolders&lt;/tt&gt; solution works for that as well?&lt;/p&gt;</comment>
                            <comment id="16647012" author="paulk" created="Thu, 11 Oct 2018 20:47:15 +0000"  >&lt;p&gt;I&apos;ll take a look.&lt;/p&gt;</comment>
                            <comment id="16675185" author="paulk" created="Mon, 5 Nov 2018 14:00:00 +0000"  >&lt;p&gt;Unwinding the &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8757&quot; title=&quot;Incorrect bytecode produced after compiling class implementing trait with generic method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8757&quot;&gt;&lt;del&gt;GROOVY-8757&lt;/del&gt;&lt;/a&gt; change and instead applying the &lt;tt&gt;asGenericsType/applyGenericsContextToPlaceHolders&lt;/tt&gt; solution breaks the following test:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;groovy.bugs.groovy8757.UsageTest &amp;gt; testAccessingPrecompiledTraitWithMethodGenerics FAILED
java.lang.VerifyError: Bad return type
Exception Details:
  Location:
    C0.foo(Ljava/lang/Class;)Ljava/lang/Number; @5: areturn
  Reason:
    Type &apos;java/lang/Object&apos; (current frame, stack[0]) is not assignable to &apos;java/lang/Number&apos; (from method signature)
  Current Frame:
    bci: @5
    flags: { }
    locals: { &apos;C0&apos;, &apos;java/lang/Class&apos; }
    stack: { &apos;java/lang/Object&apos; }
  Bytecode:
    0x0000000: 2a2b b600 89b0                         

	at java.lang.Class.getDeclaredConstructors0(Native Method)
	at java.lang.Class.privateGetDeclaredConstructors(Class.java:2671)
	at java.lang.Class.getDeclaredConstructors(Class.java:2020)
	at org.codehaus.groovy.reflection.CachedClass$2$1.run(CachedClass.java:88)
        ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16675379" author="emilles" created="Mon, 5 Nov 2018 16:13:15 +0000"  >&lt;p&gt;Hmmm...I tried that test case with my solution and found no issue (within the IDE).&lt;/p&gt;</comment>
                            <comment id="16921265" author="daniel_sun" created="Tue, 3 Sep 2019 09:00:34 +0000"  >&lt;p&gt;The proposed PR was merged. Thanks!&lt;/p&gt;</comment>
                            <comment id="16921805" author="daniel_sun" created="Wed, 4 Sep 2019 01:29:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt;&#160;I added committer role to your account, so you should be able to assign issues to yourself &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://github.com/groovy/groovy-eclipse/issues/733]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 10 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3yl2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>