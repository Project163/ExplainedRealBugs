<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:40:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-6755] Bad type resolution causing bad classes and TypeNotPresentExceptions with joint compilation, deep generics and star imports</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-6755</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;ResolveVisitor improperly marks generics types as being resolved when sub-generics types haven&apos;t been resolved, leading to classes being generated that lack fully qualified generics typing and then subsequent errors while compiling against those generated class files. Here&apos;s an example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;a/Item.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; a;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; Item {}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;b/ItemListList.groovy&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; b
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; a.*

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ItemListList {
  &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; List&amp;lt;List&amp;lt;Item&amp;gt;&amp;gt; ITEMS
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If you compile this with the &lt;b&gt;joint compiler&lt;/b&gt; and inspect ItemListList with javap, the type signature will be:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; java.util.List&amp;lt;java.util.List&amp;lt;Item&amp;gt;&amp;gt; ITEMS
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Note that Item type is not fully qualified (it should refer to &lt;tt&gt;a.Item&lt;/tt&gt;), and if that class file is accessed during a later compilation (e.g., for an incremental compilation or a groovy server page), an exception with a stack trace similar to the following will be thrown:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    java.lang.TypeNotPresentException: Type Item not present
    	at sun.reflect.generics.factory.CoreReflectionFactory.makeNamedType(CoreReflectionFactory.java:117)
    	at sun.reflect.generics.visitor.Reifier.visitClassTypeSignature(Reifier.java:125)
    	at sun.reflect.generics.tree.ClassTypeSignature.accept(ClassTypeSignature.java:49)
    	at sun.reflect.generics.visitor.Reifier.reifyTypeArguments(Reifier.java:68)
    	at sun.reflect.generics.visitor.Reifier.visitClassTypeSignature(Reifier.java:138)
    	at sun.reflect.generics.tree.ClassTypeSignature.accept(ClassTypeSignature.java:49)
    	at sun.reflect.generics.visitor.Reifier.reifyTypeArguments(Reifier.java:68)
    	at sun.reflect.generics.visitor.Reifier.visitClassTypeSignature(Reifier.java:138)
    	at sun.reflect.generics.tree.ClassTypeSignature.accept(ClassTypeSignature.java:49)
    	at sun.reflect.generics.repository.FieldRepository.getGenericType(FieldRepository.java:85)
    	at java.lang.reflect.Field.getGenericType(Field.java:237)
    	at org.codehaus.groovy.vmplugin.v5.Java5.configureClassNode(Java5.java:357)
    	at org.codehaus.groovy.ast.ClassNode.lazyClassInit(ClassNode.java:261)
     ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The problem is that &lt;tt&gt;ResolveVisitor&lt;/tt&gt; marks a &lt;tt&gt;GenericsType&lt;/tt&gt; as resolved iff the type (i.e., &lt;tt&gt;ClassNode&lt;/tt&gt;) has been resolved, but ignores any failure to resolve any generic types associated with the generic type itself. To use the example above, when resolving &lt;tt&gt;List&amp;lt;List&amp;lt;Item&amp;gt;&amp;gt;&lt;/tt&gt; it first attempts to resolve the generic type &lt;tt&gt;List&amp;lt;Item&amp;gt;&lt;/tt&gt;. It successfully resolves &lt;tt&gt;List&lt;/tt&gt; to &lt;tt&gt;java.util.List&lt;/tt&gt;, but isn&apos;t yet able to resolve &lt;tt&gt;Item&lt;/tt&gt; to &lt;tt&gt;a.Item&lt;/tt&gt;, as a star import is used and the java-compiler stage of joint compilation has yet to run, so &lt;tt&gt;a.Item&lt;/tt&gt; is unavailable for classloader-based resolution in &lt;tt&gt;resolveToOuter&lt;/tt&gt; to occur. Nonetheless, it incorrectly marks &lt;tt&gt;List&amp;lt;Item&amp;gt;&lt;/tt&gt; as resolved, as it only checks that the primary type was resolved. A later attempt at resolution occurs after the java compilation, at which time an attempt to resolve &lt;tt&gt;Item&lt;/tt&gt; would work since a/Item.class now exists, but no re-attempt is made at this time to resolve the GenericType as it had already been marked as being resolved. The solution is simple: only mark a &lt;tt&gt;GenericType&lt;/tt&gt; as resolved if both its type &lt;em&gt;and&lt;/em&gt; any genericsTypes it has are resolved.&lt;/p&gt;

&lt;p&gt;Pull request is at &lt;a href=&quot;https://github.com/groovy/groovy-core/pull/408&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/groovy/groovy-core/pull/408&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It&apos;s possible that this bug was responsible for &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-3157&quot; title=&quot;Compiler fails with java.lang.TypeNotPresentException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-3157&quot;&gt;&lt;del&gt;GROOVY-3157&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12816632">GROOVY-6755</key>
            <summary>Bad type resolution causing bad classes and TypeNotPresentExceptions with joint compilation, deep generics and star imports</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="lujke">Luke Kirby</reporter>
                        <labels>
                    </labels>
                <created>Sun, 4 May 2014 22:28:11 +0000</created>
                <updated>Sun, 5 Apr 2015 14:44:22 +0000</updated>
                            <resolved>Wed, 7 May 2014 09:50:36 +0000</resolved>
                                                    <fixVersion>2.3.1</fixVersion>
                    <fixVersion>2.4.0-beta-1</fixVersion>
                                    <component>Compiler</component>
                    <component>Stub generator / Joint compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14475823" author="lujke" created="Sun, 4 May 2014 23:06:24 +0000"  >&lt;p&gt;Issued pull request: &lt;a href=&quot;https://github.com/groovy/groovy-core/pull/408&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/groovy/groovy-core/pull/408&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14475886" author="blackdrag" created="Wed, 7 May 2014 09:50:36 +0000"  >&lt;p&gt;I applied a modified version of the patch, see pull request for more details. Thanks for finding this one!&lt;/p&gt;</comment>
                            <comment id="14475863" author="lujke" created="Wed, 7 May 2014 10:40:07 +0000"  >&lt;p&gt;Wow, yeah, that part really didn&apos;t show up well in the diff! It was just to avoid re-resolving &lt;tt&gt;type&lt;/tt&gt; if it was already resolved by enclosing that code in an &lt;tt&gt;if (&amp;#33;type.isResolved())&lt;/tt&gt; block, so it was just an optimisation. I imagine no harm comes from resolving it a second time. Thank you!&lt;/p&gt;</comment>
                            <comment id="14475903" author="blackdrag" created="Wed, 7 May 2014 11:31:17 +0000"  >&lt;p&gt;imho the condition is always true, since there is an if (type.isResolved()) return true; before&lt;/p&gt;</comment>
                            <comment id="14475843" author="lujke" created="Wed, 7 May 2014 16:28:37 +0000"  >&lt;p&gt;Ah, that first line is actually:&lt;br/&gt;
  &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (genericsType.isResolved()) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;,&lt;br/&gt;
whereas the test I added was, for, if we inline &lt;tt&gt;type&lt;/tt&gt;, &lt;tt&gt;genericsType.getType().isResolved()&lt;/tt&gt;. So if a generics type representing &lt;tt&gt;List&amp;lt;Item&amp;gt;&lt;/tt&gt; was passed in as &lt;tt&gt;genericsType&lt;/tt&gt;, as in the example above, &lt;tt&gt;genericsType.isResolved()&lt;/tt&gt; is checking that the entirety of &lt;tt&gt;List&amp;lt;Item&amp;gt;&lt;/tt&gt; is resolved while &lt;tt&gt;type.isResolved()&lt;/tt&gt; it seeing just whether &lt;tt&gt;List&lt;/tt&gt;, without its generics, had already been resolved, as is the case during the post-javac attempt to resolve &lt;tt&gt;List&amp;lt;Item&amp;gt;&lt;/tt&gt;.&lt;/p&gt;
</comment>
                            <comment id="14475826" author="blackdrag" created="Thu, 8 May 2014 03:10:29 +0000"  >&lt;p&gt;ah right... well... I think it is no problem. ResolveVisitor has a lot of places that try avoiding visits to already resolved values&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 28 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cti7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>