<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:18:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-4378] Incorrect handling of unicode escape sequences when calculating source locations</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-4378</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;When compiling this code with Groovy 1.7.3:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;One {
	 &lt;span class=&quot;code-comment&quot;&gt;/*\u00E9*/&lt;/span&gt; Stack&amp;lt;F&amp;gt; plates;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I get the following error message:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ groovy One.groovy
org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed:
/&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt;/tmp/One.groovy: 2: unable to resolve &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;F 
 @ line 2, column 15.
   	 &lt;span class=&quot;code-comment&quot;&gt;/*\u00E9*/&lt;/span&gt; Stack&amp;lt;F&amp;gt; plates;
                 ^

1 error
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I would expect the ^ to be under the &apos;F&apos;.  It appears that the unicode sequence is being considered a single character, rather than 6 characters.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12815315">GROOVY-4378</key>
            <summary>Incorrect handling of unicode escape sequences when calculating source locations</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="werdna">Andrew Eisenberg</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 Aug 2010 15:59:32 +0000</created>
                <updated>Sat, 3 Jun 2017 15:43:33 +0000</updated>
                            <resolved>Wed, 9 Mar 2011 08:15:42 +0000</resolved>
                                                    <fixVersion>1.8-rc-2</fixVersion>
                    <fixVersion>1.7.9</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <workratio workratioPercent="0"/>
                                                                    <timeoriginalestimate seconds="0">0h</timeoriginalestimate>
                            <timeestimate seconds="0">0h</timeestimate>
                                        <comments>
                            <comment id="14469986" author="werdna" created="Mon, 23 Aug 2010 16:03:13 +0000"  >&lt;p&gt;I believe that at least part of the problem comes from org.codehaus.groovy.antlr.UnicodeEscapingReader, where an escape sequence is translated into a single character.  But, I think there is also a problem with the GroovyRecognizer in that it creates source locations based on the translated escape sequences, rather than the raw text.&lt;/p&gt;

&lt;p&gt;Please note that this problem is much bigger for Groovy-Eclipse since it is reliant on precise source locations in order to get editor operations (like content assist and underlining) working.&lt;/p&gt;</comment>
                            <comment id="14469994" author="blackdrag" created="Tue, 24 Aug 2010 05:32:20 +0000"  >&lt;p&gt;If UnicodeEscapingReader would not replace the sequence with the unicode &quot;character&quot; alone, but instead fills up using spaces, then the source position would be right again. And then no change to GroovyRecognizer would be needed, especially no manual sourceposition translation. Andrew, do you think that could work?&lt;/p&gt;</comment>
                            <comment id="14469968" author="werdna" created="Tue, 24 Aug 2010 10:16:28 +0000"  >&lt;p&gt;No, this probably won&apos;t work.  An escape sequence in the middle of an identifier would cause problems.  Eg:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;foo\u8706foo
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Would be sent to the recognizer as:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;foo&amp;amp;#8706;     foo
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(oops---when I first entered it, &amp;amp;#8706 was an actual unicode character)&lt;/p&gt;

&lt;p&gt;Now, what was once 1 identifier would become two.&lt;/p&gt;</comment>
                            <comment id="14470065" author="blackdrag" created="Wed, 25 Aug 2010 15:46:22 +0000"  >&lt;p&gt;the problem is how to resolve the issue then... allowing unicode escape sequences in identifiers?&lt;/p&gt;</comment>
                            <comment id="14470002" author="werdna" created="Wed, 25 Aug 2010 16:18:32 +0000"  >&lt;p&gt;Another possibility (and I admit that I haven&apos;t completely thought this through) would be to add a new method to UnicodeEscapingReader that returns the number of chars read on the last call to read (eg- getBytesRead() ).  Then GroovyLexer would presumably update its source locations appropriately after it calls getBytesRead().&lt;/p&gt;</comment>
                            <comment id="14470048" author="werdna" created="Wed, 25 Aug 2010 16:20:25 +0000"  >&lt;p&gt;Since GroovyLexer is a subclass of an antlr class and it looks like the call to read() happens in library code, the suggestion above may not work.&lt;/p&gt;

&lt;p&gt;So, another possibility that I can see would be for GroovyLexer to perform the unescaping of unicode chars itself.  This would of course require a change to the grammar.&lt;/p&gt;</comment>
                            <comment id="14470426" author="werdna" created="Thu, 18 Nov 2010 16:37:14 +0000"  >&lt;p&gt;Any chance that we can have this fixed?  Users are hitting the occasionally (but regularly) and it is always confusing and disruptive for them.&lt;/p&gt;</comment>
                            <comment id="14470393" author="blackdrag" created="Fri, 19 Nov 2010 02:45:17 +0000"  >&lt;p&gt;the current state seems to be that we need to change the grammar and convert unicode by ourselfes&lt;/p&gt;</comment>
                            <comment id="14470346" author="blackdrag" created="Fri, 19 Nov 2010 04:21:41 +0000"  >&lt;p&gt;another example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;\u00E9 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; I_AM_WRONG()&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14470441" author="blackdrag" created="Fri, 19 Nov 2010 06:19:48 +0000"  >&lt;p&gt;I tried modifying the LETTER Lexer rule, but then this swallowed all \, so that alone does not do it.&lt;/p&gt;</comment>
                            <comment id="14470893" author="werdna" created="Thu, 10 Feb 2011 10:25:32 +0000"  >&lt;p&gt;Here is a potential solution for this problem:&lt;/p&gt;

&lt;p&gt;When I say the actual text, I mean the text in the source file.  When I say the parser text, I mean the text that the parser sees and that has the text collapsed around unicode escapes.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;It is easy enough to have the lexer keep track of where unicode characters are in the parser text.&lt;/li&gt;
	&lt;li&gt;This would be some sort of datastructure that can translate from pasrer text locations to actual text locations and is built up during lexing.&lt;/li&gt;
	&lt;li&gt;Then, in GroovyRecognizer.create(), if the passed in AST is of type GroovySourceAST, we use the datastructure created above to translate the source locations from parser text to source text.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I&apos;m not really a big fan of this solution, but it is minimally invasive and would probably work.  The hardest part would be to get the datastructure right so that it is efficient in time and in space (although even that shouldn&apos;t be too hard).&lt;/p&gt;</comment>
                            <comment id="14470964" author="werdna" created="Thu, 3 Mar 2011 18:51:55 +0000"  >&lt;p&gt;I committed a fix for this to Groovy-Eclipse.  I am attaching the patch that I used.  See GRECLIPSE-805 for a description of what the changes are.  The changes are minimally invasive, and negligible in overhead.  The patch will not apply directly to groovy core since Groovy-Eclipse uses a patched 1.7.8 version.  However, you should be able to look at it and determine what should be done.&lt;/p&gt;</comment>
                            <comment id="14470812" author="werdna" created="Thu, 3 Mar 2011 21:56:17 +0000"  >&lt;p&gt;Forgot to attach the patch.&lt;/p&gt;</comment>
                            <comment id="14470885" author="blackdrag" created="Fri, 4 Mar 2011 03:10:51 +0000"  >&lt;p&gt;I attached the pach I am going to apply. It is a bit different from yours, as several parts in your patch don&apos;t seem to apply to normal Groovy. That is mainly the SourceBuffer part. We don&apos;t have a getLocationSupport method and no lineendings list for example. And we also have no error recovery ast class.&lt;br/&gt;
Another change to your code is that our unicdoe reader seems to allow multiple u in a escape sequence. So I added a counter for them instead of having the hard coded 5 offset alone.&lt;/p&gt;</comment>
                            <comment id="14470870" author="werdna" created="Fri, 4 Mar 2011 10:59:00 +0000"  >&lt;p&gt;Thanks for this.  As I mentioned, I had to create the patch off of Groovy-Eclipse, where we have already made quite a few changes in this area.&lt;/p&gt;

&lt;p&gt;Do you think that accepting escape sequences like &lt;tt&gt;\uuuuuAE09&lt;/tt&gt; is a bug?  I can&apos;t see any reason why this would be acceptable. &lt;/p&gt;

&lt;p&gt;Until I hear back from you one way or the other, I will amend the fix for GroovyEclipse so that it can accept multiple &apos;u&apos; chars.&lt;/p&gt;</comment>
                            <comment id="14470919" author="blackdrag" created="Fri, 4 Mar 2011 14:08:19 +0000"  >&lt;p&gt;well, be it bug or not, it was accepted before, so I think it is not good to have that changed now for 1.7. I ahd to change the patch a bit more, because of some tests that use the Reader without a lexer. I added a dummy lexer that is used if no lexer is set that gives some fake line and column numbers, just to satisfy the tests. I committed this changed version to 1.7, 1.8 and 1.9 already&lt;/p&gt;</comment>
                            <comment id="16035704" author="daniel_sun" created="Sat, 3 Jun 2017 00:40:35 +0000"  >&lt;p&gt;Jochen, Unicode escape sequences are allowed to define identifiers currently, can we stop supporting such a strange feature in Parrot(Groovy 3)? And can  \uuuuu9fa5 be deprecated too(i.e. just. to support the standard Unicode escape sequences)?&lt;/p&gt;</comment>
                            <comment id="16035998" author="blackdrag" created="Sat, 3 Jun 2017 15:43:33 +0000"  >&lt;p&gt;I think unicode escape sequences in identifiers must be supported. But it might be ok to not to support something like \uuuuu9fa5&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722826" name="GROOVY-4378.patch" size="14358" author="werdna" created="Thu, 3 Mar 2011 21:56:17 +0000"/>
                            <attachment id="12722736" name="unicode.patch" size="3479" author="blackdrag" created="Fri, 4 Mar 2011 03:10:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 24 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cbrr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>