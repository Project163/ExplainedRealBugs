<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:28:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-5613] @CompileStatic - Caught: java.lang.VerifyError - Inconsistent stack height 1 != 2</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-5613</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;I am trying to build an application and I am getting some &#226;&#128;&#156;Inconsistent stack height&#226;&#128;&#157; errors, I don&#226;&#128;&#153;t really know if it&#226;&#128;&#153;s an error in the libraries I am using or a Groovy bug.&lt;br/&gt;
I have managed the reproduce the error with the minimum code and I have also attached all the needed files to reproduce the error.&lt;/p&gt;


&lt;p&gt;Note:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;We don&#226;&#128;&#153;t get the Verify Error if we use &#226;&#128;&#156;import static&#226;&#128;&#157; and change &#226;&#128;&#156;msg?.&#226;&#128;&#157; with &#226;&#128;&#156;msg.&#226;&#128;&#157;&lt;/li&gt;
	&lt;li&gt;We don&#226;&#128;&#153;t get the Verify Error if we use &#226;&#128;&#156;import&#226;&#128;&#157; and with &#226;&#128;&#156;msg?.&#226;&#128;&#157;&lt;/li&gt;
	&lt;li&gt;We don&#226;&#128;&#153;t get the Verify Error if we run the code with @TypeChecked&lt;/li&gt;
&lt;/ul&gt;



&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.TypeChecked

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.hp.openview.ib.api.jopc.JOpcServerMessage
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.hp.openview.ib.api.jopc.JOpcMessage
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; com.hp.openview.ib.api.jopc.JOpcHelper.*  &lt;span class=&quot;code-comment&quot;&gt;// Uncomment &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; example VerifyError and Works
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.hp.openview.ib.api.jopc.JOpcHelper  // Uncomment &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; example Works2
&lt;/span&gt;

&lt;span class=&quot;code-comment&quot;&gt;//@TypeChecked // All the examples work is we use TypeChecked instead of CompileStatic
&lt;/span&gt;@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ErrorReproduction {
  JOpcServerMessage msg

  ErrorReproduction() {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; VerifyError = long2EventType(msg?.getEventFlag())
    &lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; Works = long2EventType(msg.getEventFlag())  // This work &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we remove the &lt;span class=&quot;code-quote&quot;&gt;&quot;?&quot;&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; Works2 = JOpcHelper.long2EventType(msg?.getEventFlag()) // This work &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we dont use the &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt;&quot;&lt;/span&gt;
&lt;/span&gt;  }

  &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
    ErrorReproduction m = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ErrorReproduction()
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Caught: java.lang.VerifyError: (class: ErrorReproduction, method: &amp;lt;init&amp;gt; signature: ()V) Inconsistent stack height 1 != 2
java.lang.VerifyError: (class: ErrorReproduction, method: &amp;lt;init&amp;gt; signature: ()V) Inconsistent stack height 1 != 2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>Groovy Version: 2.0.0 JVM: 1.7.0_05 Vendor: Oracle Corporation OS: Linux&lt;br/&gt;
CentOS release 6.3 (Final) x86_64&lt;br/&gt;
CentOS release 5.8 (Final) x86_64</environment>
        <key id="12816400">GROOVY-5613</key>
            <summary>@CompileStatic - Caught: java.lang.VerifyError - Inconsistent stack height 1 != 2</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="melix">C&#233;dric Champeau</assignee>
                                    <reporter username="syepes">Sebastian YEPES FERNANDEZ</reporter>
                        <labels>
                            <label>CompileStatic</label>
                            <label>VerifyError</label>
                            <label>compiler</label>
                    </labels>
                <created>Thu, 19 Jul 2012 04:27:48 +0000</created>
                <updated>Thu, 26 Jul 2012 16:49:37 +0000</updated>
                            <resolved>Thu, 19 Jul 2012 07:07:10 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.1</fixVersion>
                                    <component>Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14473083" author="melix" created="Thu, 19 Jul 2012 07:07:10 +0000"  >&lt;p&gt;The problem was that the null safe operator pushed the constant &lt;tt&gt;null&lt;/tt&gt; on stack even if the return type was of primitive type.&lt;/p&gt;

&lt;p&gt;Thanks for reporting this!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/groovy/groovy-core/commit/97b905654df7dbb0d46c2c71e72b4c933185b997&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/groovy/groovy-core/commit/97b905654df7dbb0d46c2c71e72b4c933185b997&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14473015" author="syepes" created="Thu, 19 Jul 2012 08:13:43 +0000"  >&lt;p&gt;Thanks Cedric for the fix. Now i just have to wait for 2.0.1 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722924" name="GroovyErrorReproduction.zip" size="37633" author="syepes" created="Thu, 19 Jul 2012 04:27:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 18 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cedb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>