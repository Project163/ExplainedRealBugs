<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:59:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-8342] Static compilation error with a method returning an array in a type parameter</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-8342</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;A compilation error occurs when using static compilation and attempting to assign the result of a method that returns a parameterized argument that contains an array in the type parameter.  The equivalent Java code has no issues.&lt;/p&gt;

&lt;p&gt;Here is a specific example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ArrayGenericsIssue {
  &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
    Optional&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;[]&amp;gt; value = testArrayMethod(1) &lt;span class=&quot;code-comment&quot;&gt;//This fails to compile
&lt;/span&gt;  }

  &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;E&amp;gt; Optional&amp;lt;E[]&amp;gt; testArrayMethod(E ignored) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Optional.empty()
  }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The error returned is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Error:(11, 33) Groovyc: [Static type checking] - Incompatible &lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt; argument types. Cannot assign java.util.Optional &amp;lt;E[]&amp;gt; to: java.util.Optional &amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;[]&amp;gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The expected behavior is that this code would compile and run successfully with @CompileStatic enabled.&lt;/p&gt;

&lt;p&gt;Note that equivalent code with a non-array generic parameter works just fine:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
    Optional&amp;lt;List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;&amp;gt; value = testListMethod(1)
  }

  &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;E&amp;gt; Optional&amp;lt;List&amp;lt;E&amp;gt;&amp;gt; testListMethod(E ignored) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Optional.empty()
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Additionally, there is no compilation issue if the value is cast:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Optional&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;[]&amp;gt; value = (Optional&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;[]&amp;gt;) testArrayMethod(1)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For some context, I&apos;m running into this issue when working with &lt;a href=&quot;https://www.jooq.org/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jOOQ&lt;/a&gt;, as some of its API involves working with array type parameters. &lt;/p&gt;</description>
                <environment></environment>
        <key id="13107257">GROOVY-8342</key>
            <summary>Static compilation error with a method returning an array in a type parameter</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="mjjustin">M. Justin</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 Oct 2017 15:09:28 +0000</created>
                <updated>Thu, 13 Dec 2018 10:05:36 +0000</updated>
                            <resolved>Thu, 11 Oct 2018 02:17:08 +0000</resolved>
                                                    <fixVersion>3.0.0-alpha-4</fixVersion>
                    <fixVersion>2.5.3</fixVersion>
                                    <component>Static compilation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16645251" author="emilles" created="Wed, 10 Oct 2018 16:53:20 +0000"  >&lt;p&gt;&lt;tt&gt;StaticTypeCheckingVisitor&lt;/tt&gt; seems to have a handle on the generics.  When visiting method &lt;tt&gt;testListMethod&lt;/tt&gt;, it does manage to understand the link between &lt;tt&gt;E&lt;/tt&gt; and &lt;tt&gt;Integer&lt;/tt&gt;.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; ClassNode inferReturnTypeGenerics(
            ClassNode receiver,
            MethodNode method,
            Expression arguments,
            GenericsType[] explicitTypeHints) {
        ...
        &lt;span class=&quot;code-comment&quot;&gt;// resolvedPlaceholders: {E=java.lang.&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;}
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// returnType: java.util.Optional &amp;lt;[LE;&amp;gt; -&amp;gt; java.util.Optional &amp;lt;T &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; applyGenericsContext(resolvedPlaceholders, returnType);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16645278" author="emilles" created="Wed, 10 Oct 2018 17:10:11 +0000"  >&lt;p&gt;Down from the above method, in &lt;tt&gt;StaticTypeCheckingSupport&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; GenericsType applyGenericsContext(Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, GenericsType&amp;gt; spec, GenericsType gt) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (gt.isPlaceholder()) { &lt;span class=&quot;code-comment&quot;&gt;// returns &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;LE;&quot;&lt;/span&gt; -- gt.getType() returns &lt;span class=&quot;code-quote&quot;&gt;&quot;E -&amp;gt; java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[]&quot;&lt;/span&gt;; placeholder is set on the component type&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16645315" author="emilles" created="Wed, 10 Oct 2018 17:34:28 +0000"  >&lt;p&gt;This may fix the issue (edit indicated in the 2nd half):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; GenericsType applyGenericsContext(Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, GenericsType&amp;gt; spec, GenericsType gt) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (gt.isPlaceholder()) {
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name = gt.getName();
            GenericsType specType = spec.get(name);
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (specType!=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; specType;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hasNonTrivialBounds(gt)) {
                GenericsType newGT = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericsType(gt.getType(), applyGenericsContext(spec, gt.getUpperBounds()), applyGenericsContext(spec, gt.getLowerBound()));
                newGT.setPlaceholder(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; newGT;
            }
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; gt;
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (gt.isWildcard()) {
            GenericsType newGT = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericsType(gt.getType(), applyGenericsContext(spec, gt.getUpperBounds()), applyGenericsContext(spec, gt.getLowerBound()));
            newGT.setWildcard(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; newGT;
        }
        ClassNode type = gt.getType();
        /* GRECLIPSE edit
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (type.getGenericsTypes()==&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; gt;
        ClassNode newType = type.getPlainNodeReference();
        newType.setGenericsPlaceHolder(type.isGenericsPlaceHolder());
        newType.setGenericsTypes(applyGenericsContext(spec, type.getGenericsTypes()));
        */
        ClassNode newType;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (type.isArray()) {
            newType = applyGenericsContext(spec, type.getComponentType()).makeArray();
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (type.getGenericsTypes()==&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; gt;
            newType = type.getPlainNodeReference();
            newType.setGenericsPlaceHolder(type.isGenericsPlaceHolder());
            newType.setGenericsTypes(applyGenericsContext(spec, type.getGenericsTypes()));
        }
        GenericsType newGT = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GenericsType(newType);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; newGT;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16645818" author="paulk" created="Thu, 11 Oct 2018 01:31:32 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt;. I haven&apos;t thought through whether there is a better way to refactor/fix this but your change certainly fixes this case, so I&apos;ll merge and we can think about improvements down the track.&lt;/p&gt;</comment>
                            <comment id="16645860" author="paulk" created="Thu, 11 Oct 2018 02:17:08 +0000"  >&lt;p&gt;Incorporated Eric&apos;s suggested change.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 5 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3kx5j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>