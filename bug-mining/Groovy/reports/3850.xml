<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:07:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-9601] Parsing text into a class became much slower under Groovy 3.x</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-9601</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Our Java application needs to execute dynamically generated Groovy code and we use the GroovyClassLoader to create a class from that generated code.&lt;/p&gt;

&lt;p&gt;When we tried to upgrade to Groovy 3.x we noticed a huge bump in the time it takes to create those dynamic classes (it became 10 times slower for some of them).&lt;/p&gt;

&lt;p&gt;Here is a very simple example of how we use the class loader:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; lab;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.lang.GroovyClassLoader;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;GroovySpeedLab {

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
        StringBuilder buf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringBuilder();
        buf.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; lab\r\n&quot;&lt;/span&gt;);
        buf.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;\r\n&quot;&lt;/span&gt;);
        buf.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic\r\n&quot;&lt;/span&gt;);
        buf.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;\r\n&quot;&lt;/span&gt;);
        buf.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;@CompileStatic\r\n&quot;&lt;/span&gt;);
        buf.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyClass {\r\n&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 1000; i++) {
            buf.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;\r\n&quot;&lt;/span&gt;);
            buf.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void myMethod&quot;&lt;/span&gt;).append(i).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;() {\r\n&quot;&lt;/span&gt;);
            buf.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;        println(&lt;span class=&quot;code-quote&quot;&gt;&apos;method &quot;&lt;/span&gt;).append(i).append(&lt;span class=&quot;code-quote&quot;&gt;&quot; invoked...&apos;&lt;/span&gt;)\r\n&quot;&lt;/span&gt;);
            buf.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;    }\r\n&quot;&lt;/span&gt;);
        }
        buf.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;}\r\n&quot;&lt;/span&gt;);

        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; start = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyClassLoader().parseClass(buf.toString());
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Done parsing in &quot;&lt;/span&gt; + (&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis() - start) + &lt;span class=&quot;code-quote&quot;&gt;&quot;ms&quot;&lt;/span&gt;);
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;While this runs very quickly (because the methods are trivial), it it still consistently 50% slower with 3.x (but I am including this example mainly to show our use-case, not to focus on its speed difference).&lt;/p&gt;

&lt;p&gt;Our real application has much more complex classes (and many of them) and its initialization went from a couple of minutes to 10+ minutes.&lt;/p&gt;

&lt;p&gt;Is there another way to parse a given Groovy class without taking such a big performance hit with the new version of Groovy?&lt;/p&gt;

&lt;p&gt;Note that we also use many small Script objects created by calling GroovyShell.parse() and we noticed the same performance hit for those (I assume it uses the same mechanism under the hood).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>Openjdk 11</environment>
        <key id="13312472">GROOVY-9601</key>
            <summary>Parsing text into a class became much slower under Groovy 3.x</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="fabian_depry@yahoo.com">Fabian Depry</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Jun 2020 13:38:14 +0000</created>
                <updated>Thu, 23 Jul 2020 14:16:23 +0000</updated>
                            <resolved>Thu, 9 Jul 2020 02:21:49 +0000</resolved>
                                    <version>3.0.4</version>
                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                    <fixVersion>3.0.5</fixVersion>
                                    <component>Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4800">1h 20m</timespent>
                                <comments>
                            <comment id="17142229" author="emilles" created="Mon, 22 Jun 2020 16:03:21 +0000"  >&lt;p&gt;You can switch back to the Antlr2 parser for now.&#160; In Groovy 4, this will not be an option.&#160; To do this, you can set system property &quot;groovy.antlr4&quot; to false or you can pass a CompilerConfiguration &#8211; that sets pluginFactory to ParserPluginFactory.antlr2() &amp;#8211; to your GroovyClassLoader.&lt;/p&gt;

&lt;p&gt;There are also some caches that can be disabled with some system properties.  You&apos;ll probably need to do some digging to figure out if your slowness is from parsing only or from other enhancements in Groovy 3.&lt;/p&gt;</comment>
                            <comment id="17142231" author="emilles" created="Mon, 22 Jun 2020 16:04:08 +0000"  >&lt;p&gt;See also &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9588&quot; title=&quot;groovyCompile 6x slower in 3.0.4 than 2.5.6&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9588&quot;&gt;&lt;del&gt;GROOVY-9588&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17144413" author="fabian_depry@yahoo.com" created="Wed, 24 Jun 2020 21:25:19 +0000"  >&lt;p&gt;Thank you for your reply!&lt;/p&gt;

&lt;p&gt;I was reluctant to try disabling the old parser because it&apos;s obviously not a long term solution.&lt;/p&gt;

&lt;p&gt;Our short therm solution was to rollback the upgrade to 3.x; which obviously is not a good long term solution either.&lt;/p&gt;

&lt;p&gt;I will still try to use 3.x and disable the parser to see if that fixes the issue.&lt;/p&gt;</comment>
                            <comment id="17144623" author="daniel_sun" created="Thu, 25 Jun 2020 03:37:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fabian_depry%40yahoo.com&quot; class=&quot;user-hover&quot; rel=&quot;fabian_depry@yahoo.com&quot;&gt;fabian_depry@yahoo.com&lt;/a&gt;&#160;See&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9588?focusedCommentId=17144619&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-17144619&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/GROOVY-9588?focusedCommentId=17144619&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-17144619&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17144758" author="daniel_sun" created="Thu, 25 Jun 2020 08:40:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt;&#160;FYI. no antlr2 parser in the Groovy 4.&lt;/p&gt;</comment>
                            <comment id="17144772" author="daniel_sun" created="Thu, 25 Jun 2020 09:07:19 +0000"  >&lt;p&gt;Fixed by&#160;&lt;a href=&quot;https://github.com/apache/groovy/commit/9b46553475829800fb88d12088e53491c8d9b184&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/9b46553475829800fb88d12088e53491c8d9b184&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17144779" author="daniel_sun" created="Thu, 25 Jun 2020 09:12:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fabian_depry%40yahoo.com&quot; class=&quot;user-hover&quot; rel=&quot;fabian_depry@yahoo.com&quot;&gt;fabian_depry@yahoo.com&lt;/a&gt;&#160;See also&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9588?focusedCommentId=17144778&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-17144778&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/GROOVY-9588?focusedCommentId=17144778&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-17144778&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17144791" author="daniel_sun" created="Thu, 25 Jun 2020 09:30:24 +0000"  >&lt;p&gt;I ran your code via the groovyConsole twice:&lt;br/&gt;
 1) no additional system properties set, costs 303ms on my machine&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13006413/13006413_no_tuning.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;2) set &lt;tt&gt;-Dgroovy.antlr4.cache.threshold=50000&lt;/tt&gt;&#160; &#160; &#160;,costs 256ms on my machine&lt;/p&gt;

&lt;p&gt;Note:&#160; 50000 &amp;gt; 1000, which means the DFA cache will be cleared during parsing&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13006414/13006414_50000.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
C:\Users\Daniel.LAPTOP-H7RKNSIS&amp;gt;groovy -v
Groovy Version: 4.0.0-SNAPSHOT JVM: 11.0.6 Vendor: Amazon.com Inc. OS: Windows 10

C:\Users\Daniel.LAPTOP-H7RKNSIS&amp;gt;groovyConsole

C:\Users\Daniel.LAPTOP-H7RKNSIS&amp;gt;set JAVA_OPTS=-Dgroovy.antlr4.cache.threshold=50000

C:\Users\Daniel.LAPTOP-H7RKNSIS&amp;gt;groovy -v
Groovy Version: 4.0.0-SNAPSHOT JVM: 11.0.6 Vendor: Amazon.com Inc. OS: Windows 10

C:\Users\Daniel.LAPTOP-H7RKNSIS&amp;gt;groovyConsole
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17144795" author="daniel_sun" created="Thu, 25 Jun 2020 09:33:46 +0000"  >&lt;p&gt;Here is the snapshot distribution:&#160; &lt;a href=&quot;https://github.com/apache/groovy/actions/runs/147568708&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/actions/runs/147568708&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If you do not want to wait for 3.0.5, you could give it a try.&lt;/p&gt;</comment>
                            <comment id="17144798" author="daniel_sun" created="Thu, 25 Jun 2020 09:43:09 +0000"  >&lt;p&gt;Groovy 2.5.12 costs 238ms on my machine:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13006415/13006415_image-2020-06-25-17-42-31-315.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17144875" author="blackdrag" created="Thu, 25 Jun 2020 12:02:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daniel_sun&quot; class=&quot;user-hover&quot; rel=&quot;daniel_sun&quot;&gt;daniel_sun&lt;/a&gt; I think you should not test this with GCL#parseClass if you want to know if antlr4 or antlr2 are to blame. Instead I would suggest to use the parser directly to create the initial AST, to avoid class transforms and especially class resolution to influence the parsing result.&lt;/p&gt;

&lt;p&gt;If I use&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.codehaus.groovy.control.CompilationUnit
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.codehaus.groovy.control.Phases

def code = &quot;&quot;&quot;
        &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; lab

        &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic

        @CompileStatic
        &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyClass {
            ${x-&amp;gt;
                1000.times{i -&amp;gt; x &amp;lt;&amp;lt; &quot;&quot;&quot;
                    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void myMethod${i}() {
                        println(&lt;span class=&quot;code-quote&quot;&gt;&apos;method ${i} invoked...&apos;&lt;/span&gt;)
                    }
                &quot;&quot;&quot;}
            }
            }
        &quot;&quot;&quot;

    def cu = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CompilationUnit()
    cu.addSource &lt;span class=&quot;code-quote&quot;&gt;&apos;hello.groovy&apos;&lt;/span&gt;, code
    def time0 = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.nanoTime()
    cu.compile Phases.CONVERSION
    def time1 = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.nanoTime()
    println &lt;span class=&quot;code-quote&quot;&gt;&quot;time = ${(time1 - time0) / 1000000}ms&quot;&lt;/span&gt;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;With this my test program I get  157-200ms for 2.5.12. and 170-224ms for 3.0.4. The  tendency is to be 10% slower&lt;/p&gt;

&lt;p&gt;If I change the phase to class generation I see for 2.5.12 573-656ms and for 3.0.4 721-816ms. Now I see a tendency of being 50% slower.&lt;/p&gt;

&lt;p&gt;This tells me three things:&lt;br/&gt;
a) parsing takes only a fraction of the time of total compilation&lt;br/&gt;
b) parsing seems not to cause the 50% slow down&lt;br/&gt;
c) doing this from the console makes a big difference compared to when running from the command line.&lt;/p&gt;

&lt;p&gt;If I remove @CompileStatic in the code to be compiled, because it is code that causes the compiler to be a lot slower I get of course lower times:&lt;br/&gt;
3.0.4: 476-580ms&lt;br/&gt;
2.5.12: 419-467ms&lt;/p&gt;

&lt;p&gt;And even though I see here a slow down of 10-20%, it is still very far away from the 50% before.&lt;/p&gt;

&lt;p&gt;Ah yes... I did not use the cache threshold property in any of this. I tried it out and I did not really see a difference. But as you can see I have a range of 190ms in my times. That is because I executed the code like 20 times or so, to see how stable the results are. On my machine they are not very stable, so this is more than just a one-time event up or down, that caused this. Anyway... I tend to believe that the difference you did observe is because of the instability of the result, rather than that there is a real difference for this test here.&lt;/p&gt;


&lt;p&gt;All in all my culprit is not ANTLR4, but @CompileStatic.&lt;/p&gt;</comment>
                            <comment id="17145008" author="daniel_sun" created="Thu, 25 Jun 2020 15:15:08 +0000"  >&lt;p&gt;&#160;According to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blackdrag&quot; class=&quot;user-hover&quot; rel=&quot;blackdrag&quot;&gt;blackdrag&lt;/a&gt;&apos;s suggestion, I ran Jochen&apos;s script with 2.5.12 and the 4.0.0-SNAPSHOT( &lt;a href=&quot;https://github.com/apache/groovy/actions/runs/147560316&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/actions/runs/147560316&lt;/a&gt; ).&lt;br/&gt;
 &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13006438/13006438_Groovy9601.groovy&quot; title=&quot;Groovy9601.groovy attached to GROOVY-9601&quot;&gt;Groovy9601.groovy&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;Here is the result(antlr4 parser runs almost as fast as antlr2 parser now):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
D:\_TEMP\wwww&amp;gt;groovy -v
Groovy Version: 4.0.0-SNAPSHOT JVM: 11.0.6 Vendor: Amazon.com Inc. OS: Windows 10

D:\_TEMP\wwww&amp;gt;groovy Groovy9601.groovy
time = 362.188ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601.groovy
time = 340.7452ms

D:\_TEMP\wwww&amp;gt;set JAVA_OPTS=-Dgroovy.antlr4.cache.threshold=50000

D:\_TEMP\wwww&amp;gt;groovy Groovy9601.groovy
time = 378.2312ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601.groovy
time = 343.5271ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601.groovy
time = 348.2159ms

D:\_TEMP\wwww&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
D:\_TEMP\wwww&amp;gt;groovy -v
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.codehaus.groovy.reflection.CachedClass (file:/D:/_DEV/Groovy/groovy-2.5.12/lib/groovy-2.5.12.jar) to method java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.finalize()
WARNING: Please consider reporting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to the maintainers of org.codehaus.groovy.reflection.CachedClass
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release
Groovy Version: 2.5.12 JVM: 11.0.6 Vendor: Amazon.com Inc. OS: Windows 10

D:\_TEMP\wwww&amp;gt;groovy Groovy9601.groovy
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.codehaus.groovy.reflection.CachedClass (file:/D:/_DEV/Groovy/groovy-2.5.12/lib/groovy-2.5.12.jar) to method java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.finalize()
WARNING: Please consider reporting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to the maintainers of org.codehaus.groovy.reflection.CachedClass
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release
time = 364.9886ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601.groovy
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.codehaus.groovy.reflection.CachedClass (file:/D:/_DEV/Groovy/groovy-2.5.12/lib/groovy-2.5.12.jar) to method java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.finalize()
WARNING: Please consider reporting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to the maintainers of org.codehaus.groovy.reflection.CachedClass
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release
time = 347.306ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601.groovy
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.codehaus.groovy.reflection.CachedClass (file:/D:/_DEV/Groovy/groovy-2.5.12/lib/groovy-2.5.12.jar) to method java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.finalize()
WARNING: Please consider reporting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to the maintainers of org.codehaus.groovy.reflection.CachedClass
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release
time = 359.1594ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601.groovy
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.codehaus.groovy.reflection.CachedClass (file:/D:/_DEV/Groovy/groovy-2.5.12/lib/groovy-2.5.12.jar) to method java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.finalize()
WARNING: Please consider reporting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to the maintainers of org.codehaus.groovy.reflection.CachedClass
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release
time = 348.4105ms

D:\_TEMP\wwww&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17145020" author="daniel_sun" created="Thu, 25 Jun 2020 15:29:01 +0000"  >&lt;p&gt;CLASS_GENERATION with &lt;tt&gt;@CompileStatic&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt; &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13006536/13006536_Groovy9601_CLASSGEN.groovy&quot; title=&quot;Groovy9601_CLASSGEN.groovy attached to GROOVY-9601&quot;&gt;Groovy9601_CLASSGEN.groovy&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;Here is the result(Groovy 4.0.0-SNPASHOT runs 10% slower than 2.5.12):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
D:\_TEMP\wwww&amp;gt;groovy -v
Groovy Version: 4.0.0-SNAPSHOT JVM: 11.0.6 Vendor: Amazon.com Inc. OS: Windows 10

D:\_TEMP\wwww&amp;gt;groovy Groovy9601_CLASSGEN.groovy
time = 1289.261ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601_CLASSGEN.groovy
time = 1214.0389ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601_CLASSGEN.groovy
time = 1294.993ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601_CLASSGEN.groovy
time = 1253.8559ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601_CLASSGEN.groovy
time = 1314.5847ms

D:\_TEMP\wwww&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
D:\_TEMP\wwww&amp;gt;groovy -v
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.codehaus.groovy.reflection.CachedClass (file:/D:/_DEV/Groovy/groovy-2.5.12/lib/groovy-2.5.12.jar) to method java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.finalize()
WARNING: Please consider reporting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to the maintainers of org.codehaus.groovy.reflection.CachedClass
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release
Groovy Version: 2.5.12 JVM: 11.0.6 Vendor: Amazon.com Inc. OS: Windows 10

D:\_TEMP\wwww&amp;gt;groovy Groovy9601_CLASSGEN.groovy
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.codehaus.groovy.reflection.CachedClass (file:/D:/_DEV/Groovy/groovy-2.5.12/lib/groovy-2.5.12.jar) to method java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.finalize()
WARNING: Please consider reporting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to the maintainers of org.codehaus.groovy.reflection.CachedClass
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release
time = 1077.2247ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601_CLASSGEN.groovy
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.codehaus.groovy.reflection.CachedClass (file:/D:/_DEV/Groovy/groovy-2.5.12/lib/groovy-2.5.12.jar) to method java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.finalize()
WARNING: Please consider reporting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to the maintainers of org.codehaus.groovy.reflection.CachedClass
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release
time = 1123.6375ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601_CLASSGEN.groovy
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.codehaus.groovy.reflection.CachedClass (file:/D:/_DEV/Groovy/groovy-2.5.12/lib/groovy-2.5.12.jar) to method java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.finalize()
WARNING: Please consider reporting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to the maintainers of org.codehaus.groovy.reflection.CachedClass
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release
time = 1080.7926ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601_CLASSGEN.groovy
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.codehaus.groovy.reflection.CachedClass (file:/D:/_DEV/Groovy/groovy-2.5.12/lib/groovy-2.5.12.jar) to method java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.finalize()
WARNING: Please consider reporting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to the maintainers of org.codehaus.groovy.reflection.CachedClass
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release
time = 1176.4935ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601_CLASSGEN.groovy
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.codehaus.groovy.reflection.CachedClass (file:/D:/_DEV/Groovy/groovy-2.5.12/lib/groovy-2.5.12.jar) to method java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.finalize()
WARNING: Please consider reporting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to the maintainers of org.codehaus.groovy.reflection.CachedClass
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release
time = 1422.3847ms

D:\_TEMP\wwww&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="17145031" author="daniel_sun" created="Thu, 25 Jun 2020 15:36:40 +0000"  >&lt;p&gt;CLASS_GENERATION without @CompileStatic&lt;br/&gt;
 &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13006442/13006442_Groovy9601_CLASSGEN_NO_STC.groovy&quot; title=&quot;Groovy9601_CLASSGEN_NO_STC.groovy attached to GROOVY-9601&quot;&gt;Groovy9601_CLASSGEN_NO_STC.groovy&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;Here is the result(Groovy 4.0.0-SNPASHOT runs 6% slower than 2.5.12):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
D:\_TEMP\wwww&amp;gt;groovy -v
Groovy Version: 4.0.0-SNAPSHOT JVM: 11.0.6 Vendor: Amazon.com Inc. OS: Windows 10

D:\_TEMP\wwww&amp;gt;groovy Groovy9601_CLASSGEN_NO_STC.groovy
time = 781.0877ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601_CLASSGEN_NO_STC.groovy
time = 781.4882ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601_CLASSGEN_NO_STC.groovy
time = 787.9702ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601_CLASSGEN_NO_STC.groovy
time = 809.9945ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601_CLASSGEN_NO_STC.groovy
time = 758.8373ms

D:\_TEMP\wwww&amp;gt;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
D:\_TEMP\wwww&amp;gt;groovy -v
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.codehaus.groovy.reflection.CachedClass (file:/D:/_DEV/Groovy/groovy-2.5.12/lib/groovy-2.5.12.jar) to method java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.finalize()
WARNING: Please consider reporting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to the maintainers of org.codehaus.groovy.reflection.CachedClass
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release
Groovy Version: 2.5.12 JVM: 11.0.6 Vendor: Amazon.com Inc. OS: Windows 10

D:\_TEMP\wwww&amp;gt;groovy Groovy9601_CLASSGEN_NO_STC.groovy
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.codehaus.groovy.reflection.CachedClass (file:/D:/_DEV/Groovy/groovy-2.5.12/lib/groovy-2.5.12.jar) to method java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.finalize()
WARNING: Please consider reporting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to the maintainers of org.codehaus.groovy.reflection.CachedClass
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release
time = 706.5156ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601_CLASSGEN_NO_STC.groovy
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.codehaus.groovy.reflection.CachedClass (file:/D:/_DEV/Groovy/groovy-2.5.12/lib/groovy-2.5.12.jar) to method java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.finalize()
WARNING: Please consider reporting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to the maintainers of org.codehaus.groovy.reflection.CachedClass
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release
time = 698.2602ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601_CLASSGEN_NO_STC.groovy
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.codehaus.groovy.reflection.CachedClass (file:/D:/_DEV/Groovy/groovy-2.5.12/lib/groovy-2.5.12.jar) to method java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.finalize()
WARNING: Please consider reporting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to the maintainers of org.codehaus.groovy.reflection.CachedClass
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release
time = 786.7204ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601_CLASSGEN_NO_STC.groovy
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.codehaus.groovy.reflection.CachedClass (file:/D:/_DEV/Groovy/groovy-2.5.12/lib/groovy-2.5.12.jar) to method java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.finalize()
WARNING: Please consider reporting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to the maintainers of org.codehaus.groovy.reflection.CachedClass
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release
time = 730.0864ms

D:\_TEMP\wwww&amp;gt;groovy Groovy9601_CLASSGEN_NO_STC.groovy
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.codehaus.groovy.reflection.CachedClass (file:/D:/_DEV/Groovy/groovy-2.5.12/lib/groovy-2.5.12.jar) to method java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.finalize()
WARNING: Please consider reporting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to the maintainers of org.codehaus.groovy.reflection.CachedClass
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release
time = 803.9677ms

D:\_TEMP\wwww&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17145038" author="daniel_sun" created="Thu, 25 Jun 2020 15:42:10 +0000"  >&lt;p&gt;As &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blackdrag&quot; class=&quot;user-hover&quot; rel=&quot;blackdrag&quot;&gt;blackdrag&lt;/a&gt; found, there are some performance issues in the backend of Groovy 3+, e.g. &lt;tt&gt;@CompileStatic&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulk&quot; class=&quot;user-hover&quot; rel=&quot;paulk&quot;&gt;paulk&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt; Thoughts?&lt;/p&gt;</comment>
                            <comment id="17146319" author="emilles" created="Fri, 26 Jun 2020 14:02:58 +0000"  >&lt;p&gt;The original post mentions that the sample is not a direct example of the performance difference, but a way to show what they are doing in their larger system.  I think it is important to try to understand these issues beyond micro benchmarks.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daniel_sun&quot; class=&quot;user-hover&quot; rel=&quot;daniel_sun&quot;&gt;daniel_sun&lt;/a&gt; What issue are you raising about static compilation?  I can&apos;t get a good grasp from the posts.  Is there a direct comparison between Groovy 2.5 and Groovy 3 or standard vs static compilation?&lt;/p&gt;

&lt;p&gt;It would be nice to have some profiler results so we can target a specific part of the compiler.  The parser is one thing you can switch back to the old parser, to get an idea about the cost of that one subsystem with all other parts held constant.&lt;/p&gt;</comment>
                            <comment id="17146469" author="daniel_sun" created="Fri, 26 Jun 2020 16:31:45 +0000"  >&lt;p&gt;Here is the flame graph for the class generation +&#160;&lt;tt&gt;@CompileStatic&lt;/tt&gt; of the latest commit &lt;a href=&quot;https://github.com/apache/groovy/commit/af7f9a3c6d1fd321b82a164d79a255fce2a9c964&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/af7f9a3c6d1fd321b82a164d79a255fce2a9c964&lt;/a&gt;&lt;/p&gt;

&lt;p&gt; &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13006535/13006535_groovy9601.svg&quot; title=&quot;groovy9601.svg attached to GROOVY-9601&quot;&gt;groovy9601.svg&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;And here is the related script:&lt;br/&gt;
 &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13006536/13006536_Groovy9601_CLASSGEN.groovy&quot; title=&quot;Groovy9601_CLASSGEN.groovy attached to GROOVY-9601&quot;&gt;Groovy9601_CLASSGEN.groovy&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; &lt;/p&gt;</comment>
                            <comment id="17146471" author="daniel_sun" created="Fri, 26 Jun 2020 16:35:53 +0000"  >&lt;p&gt;As we can see, &lt;tt&gt;VaraibleScopeVisitor&lt;/tt&gt; costs a lot of time&lt;/p&gt;</comment>
                            <comment id="17146618" author="emilles" created="Fri, 26 Jun 2020 20:31:49 +0000"  >&lt;p&gt;I&apos;m not exactly sure how to read that graph.  Is it wideness at the bottom that indicates use of time?&lt;/p&gt;

&lt;p&gt;VariableScopeVisitor runs regardless of static compilation or static type checking.  It sets up the state of the variable scopes and sets the accessed variables on the variable expressions.  It has been updated to account for additional nesting for inner classes, closures, etc.  It also needed some changes to handle references within special constructor calls.  There may be some perf that can be squeezed out, but I&apos;d be wary of changes there that make it harder to understand what it is doing.&lt;/p&gt;</comment>
                            <comment id="17147472" author="daniel_sun" created="Sun, 28 Jun 2020 23:49:56 +0000"  >&lt;p&gt;The longer the bar is, the more time the related method call costs.&lt;/p&gt;

&lt;p&gt;And the method call relationship is bottom to top, usually we need focus on the top bars with long length.&lt;/p&gt;

&lt;p&gt;&#160;&lt;tt&gt;VariableScopeVisitor&lt;/tt&gt; is a common class, not just related to STC.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17154036" author="emilles" created="Wed, 8 Jul 2020 21:55:21 +0000"  >&lt;p&gt;If I read the graph correctly, you are showing &lt;tt&gt;VariableScopeVisitor&lt;/tt&gt; consuming roughly 8% of the total time.  It looks like quite a lot of that is spent spinning through the methods and calling &lt;tt&gt;MethodNodeUtils#getPropertyName&lt;/tt&gt; on them.  I always wondered why methods were checked before properties.  That is one change that could be tried.&lt;/p&gt;

&lt;p&gt;I think optimization of &lt;tt&gt;VariableScopeVisitor&lt;/tt&gt; should be a separate ticket, because this ticket refers to moving from antlr2 to antlr4.  Improvements outside the parser will not help close the gap between the two.&lt;/p&gt;</comment>
                            <comment id="17154109" author="daniel_sun" created="Thu, 9 Jul 2020 01:11:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think optimization of VariableScopeVisitor should be a separate ticket, because this ticket refers to moving from antlr2 to antlr4. Improvements outside the parser will not help close the gap between the two.&#160;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Agreed.&lt;/p&gt;

&lt;p&gt;FYI. The gap between new and old parsers has been almostly closed by&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9588&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/GROOVY-9588&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17163537" author="fabian_depry@yahoo.com" created="Thu, 23 Jul 2020 12:57:57 +0000"  >&lt;p&gt;Sorry I wasn&apos;t more involved in this discussion, the notifications went to an old email address I don&apos;t use anymore.&#160;&lt;/p&gt;

&lt;p&gt;This is terrific work!&lt;/p&gt;

&lt;p&gt;Since version 3.0.5 was released yesterday, I gave it a try in our more complex environment and I can confirm that the gap between 2.x and 3.x is now much smaller. That should allow us to switch to 3.x in the near future.&lt;/p&gt;

&lt;p&gt;Thanks a lot for looking into this!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13006414" name="50000.png" size="53634" author="daniel_sun" created="Thu, 25 Jun 2020 09:28:10 +0000"/>
                            <attachment id="13006438" name="Groovy9601.groovy" size="763" author="daniel_sun" created="Thu, 25 Jun 2020 15:14:31 +0000"/>
                            <attachment id="13006536" name="Groovy9601_CLASSGEN.groovy" size="770" author="daniel_sun" created="Fri, 26 Jun 2020 16:31:35 +0000"/>
                            <attachment id="13006439" name="Groovy9601_CLASSGEN.groovy" size="769" author="daniel_sun" created="Thu, 25 Jun 2020 15:25:42 +0000"/>
                            <attachment id="13006442" name="Groovy9601_CLASSGEN_NO_STC.groovy" size="772" author="daniel_sun" created="Thu, 25 Jun 2020 15:31:56 +0000"/>
                            <attachment id="13006535" name="groovy9601.svg" size="1750130" author="daniel_sun" created="Fri, 26 Jun 2020 16:30:54 +0000"/>
                            <attachment id="13006415" name="image-2020-06-25-17-42-31-315.png" size="99246" author="daniel_sun" created="Thu, 25 Jun 2020 09:42:33 +0000"/>
                            <attachment id="13006413" name="no_tuning.png" size="58606" author="daniel_sun" created="Thu, 25 Jun 2020 09:27:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 16 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0g0z4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>