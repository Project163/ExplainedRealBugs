<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:03:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-9244] Anonymous subclasses should cast their super-parameters</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-9244</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Given this code:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    import java.util.regex.Pattern

    abstract class Groovy3 {
        Groovy3(String s) { println &quot;String&quot; }
        Groovy3(Pattern p) { println &quot;Pattern&quot; }
    }

    class Groovy4 extends Groovy3 {
        Groovy4(String s) { super(s) }
        Groovy4(Pattern p) { super(p) }
    }

    class Groovy5 extends Groovy3 {
        Groovy5(String s) { super(s as String) }
        Groovy5(Pattern p) { super(p as Pattern) }
    }

    class Groovy6 {
        Groovy6(String s) { println &quot;String&quot; }
        Groovy6(Pattern p) { println &quot;Pattern&quot; }
    }

    new Groovy3(null as String) { }
    new Groovy4(null as String)
    new Groovy5(null as String)
    new Groovy6(null as String)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Groovy3ish and Groovy4 instantiation fail&lt;br/&gt;
Groovy5 and Groovy6 instantiation succeed and print &lt;tt&gt;String&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I did not find a way to make the Groovy3ish one work, except for doing it the Groovy4 way, but no chance with an anonymous subclass.&lt;/p&gt;

&lt;p&gt;From what I observed, I guess the anonymous subclass does it like Groovy4 but should do it like Groovy5 to properly select the super constructor.&lt;/p&gt;</description>
                <environment>I tried in GroovyConsole 2.4.7 and Groovy web console 2.5.7</environment>
        <key id="13254092">GROOVY-9244</key>
            <summary>Anonymous subclasses should cast their super-parameters</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="vampire">Bj&#246;rn Kautler</reporter>
                        <labels>
                    </labels>
                <created>Sun, 1 Sep 2019 00:07:45 +0000</created>
                <updated>Sat, 16 Dec 2023 16:28:41 +0000</updated>
                            <resolved>Fri, 11 Oct 2019 13:55:55 +0000</resolved>
                                    <version>2.4.7</version>
                    <version>2.5.7</version>
                                    <fixVersion>2.5.9</fixVersion>
                    <fixVersion>3.0.0-rc-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="6000">1h 40m</timespent>
                                <comments>
                            <comment id="16927894" author="emilles" created="Wed, 11 Sep 2019 18:39:40 +0000"  >&lt;p&gt;Since dynamic (default) Groovy supports multi-methods, it cannot tell which superclass constructor to call with the argument &quot;null&quot;.  If you add &lt;tt&gt;@CompileStatic&lt;/tt&gt; to Groovy4, the choice will be made at compile time.  The same can be done to the enclosing method or class of the anon. inner class construction.&lt;/p&gt;</comment>
                            <comment id="16928632" author="vampire" created="Thu, 12 Sep 2019 15:14:54 +0000"  >&lt;p&gt;Ah, that&apos;s right of course. So there is no way to do an anonymous class where the argument could be &lt;tt&gt;null&lt;/tt&gt; and the constructor is ambiguous in that case in dynamic Groovy?  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16928710" author="emilles" created="Thu, 12 Sep 2019 16:30:43 +0000"  >&lt;p&gt;I&apos;m not sure if the cast or coerce leaves anything around for the runtime system.  I tried assigning null to a variable of type String and it didn&apos;t make any difference.  Certainly this and 9245 are problems, since intuition would tell you that the choice of constructors is not ambiguous.  Next step would be to step into the MOP code to see what is known at the time of constructor selection.  It may be possible to infer the &quot;type&quot; of null in these cases.&lt;/p&gt;</comment>
                            <comment id="16943758" author="emilles" created="Thu, 3 Oct 2019 17:06:09 +0000"  >&lt;p&gt;I gave this another look and was able to see that the runtime system has enough to select the proper method when typecasts are added (as you requested in your issue title).  I can experiment with adding them into &quot;this&quot; and &quot;super&quot; constructor call expressions to handle null arguments better.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.regex.Pattern

abstract &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Groovy3 {
    Groovy3(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s) { println &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&quot;&lt;/span&gt; }
    Groovy3(Pattern p) { println &lt;span class=&quot;code-quote&quot;&gt;&quot;Pattern&quot;&lt;/span&gt; }
}
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Groovy4 &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Groovy3 {
    Groovy4(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s) { &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;((&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)s) }
    Groovy4(Pattern p) { &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;((Pattern)p) }
}

&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Groovy4((&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The anon. inner class version cannot be fixed with typecasts.  The constructor calls into org.codehaus.groovy.runtime.ScriptBytecodeAdapter.selectConstructorAndTransformArguments and there is no type information left for the null argument.&lt;/p&gt;</comment>
                            <comment id="16943771" author="emilles" created="Thu, 3 Oct 2019 17:23:59 +0000"  >&lt;p&gt;Here is the bytecode for the anon. inner constructor in case that helps anyone understand what might be changed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-comment&quot;&gt;// Method descriptor #13 (LScript;Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;;)V
&lt;/span&gt;  &lt;span class=&quot;code-comment&quot;&gt;// Stack: 5, Locals: 4
&lt;/span&gt;  synthetic Script$1(Script p0, java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; p10);
      0  aload_1 [p0]
      1  astore_3
      2  aload_3
      3  aload_0 [&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;]
      4  swap
      5  putfield Script$1.&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;$0 : Script [17]
      8  aload_3
      9  pop
     10  iconst_1
     11  anewarray java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; [19]
     14  dup
     15  iconst_0
     16  aload_2 [p10]
     17  aastore
     18  dup
     19  bipush -1
     21  ldc &amp;lt;&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; Groovy3&amp;gt; [4]
     23  invokestatic org.codehaus.groovy.runtime.ScriptBytecodeAdapter.selectConstructorAndTransformArguments(java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[], &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;) : &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; [25]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16944630" author="emilles" created="Fri, 4 Oct 2019 16:10:34 +0000"  >&lt;p&gt;I&apos;m working on a pull request that would allow this case to work as expected:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.regex.Pattern

&lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Groovy3 {
    Groovy3(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s) { println &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&quot;&lt;/span&gt; }
    Groovy3(Pattern p) { println &lt;span class=&quot;code-quote&quot;&gt;&quot;Pattern&quot;&lt;/span&gt; }
}
@groovy.transform.InheritConstructors
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Groovy4 &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Groovy3 {
}

&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Groovy4((&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With this, you can work around the dynamic Groovy problem using one of the following on Groovy4:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;@CompileStatic&lt;/li&gt;
	&lt;li&gt;@InheritConstructors&lt;/li&gt;
	&lt;li&gt;cast/coerce arguments in super ctor calls&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="16949469" author="daniel_sun" created="Fri, 11 Oct 2019 13:55:55 +0000"  >&lt;p&gt;The proposed PR was merged. Thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12816911">GROOVY-6285</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 5 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0681k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>