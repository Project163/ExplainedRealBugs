<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:10:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-9373] ASM: rework line numbers for blocks with fast-path, try/catch or return statement insertion</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-9373</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-4063&quot; title=&quot;Debugger Step Into doesn&amp;#39;t work in Groovy-compiled classes when stepping filters are applied&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-4063&quot;&gt;&lt;del&gt;GROOVY-4063&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-4505&quot; title=&quot;Rogue line number for method declarations confuses IDE debuggers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-4505&quot;&gt;&lt;del&gt;GROOVY-4505&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7647&quot; title=&quot;Incorrect line information for debug&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7647&quot;&gt;&lt;del&gt;GROOVY-7647&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8742&quot; title=&quot;Line number information for method is confusing debugger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8742&quot;&gt;&lt;del&gt;GROOVY-8742&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9076&quot; title=&quot;Debugger Step Into doesn&amp;#39;t work in Groovy-compiled classes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9076&quot;&gt;&lt;del&gt;GROOVY-9076&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9126&quot; title=&quot;Unreachable line numbers after ARETURN in bytecode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9126&quot;&gt;&lt;del&gt;GROOVY-9126&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9199&quot; title=&quot;Code in finally block is ignored in IntelliJ IDEA debugger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9199&quot;&gt;&lt;del&gt;GROOVY-9199&lt;/del&gt;&lt;/a&gt; present (possibly) conflicting concerns.  Code coverage metrics are thrown off when line number information exists outside of the reachable paths in the bytecode.  Debug break and step exhibit strange behaviors when the bytecode contains insufficient or duplicated line number information.&lt;/p&gt;

&lt;p&gt;Can the ASM changes in StatementWriter be reworked to address these concerns?&lt;/p&gt;

&lt;p&gt;See also &lt;a href=&quot;https://github.com/jacoco/jacoco/issues/884&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jacoco/jacoco/issues/884&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13281046">GROOVY-9373</key>
            <summary>ASM: rework line numbers for blocks with fast-path, try/catch or return statement insertion</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="emilles">Eric Milles</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Jan 2020 19:50:32 +0000</created>
                <updated>Sun, 2 May 2021 09:18:32 +0000</updated>
                            <resolved>Tue, 2 Mar 2021 15:18:44 +0000</resolved>
                                    <version>2.4.18</version>
                    <version>2.5.9</version>
                    <version>3.0.0-rc-3</version>
                                    <fixVersion>4.0.0-alpha-3</fixVersion>
                                        <due></due>
                            <votes>3</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="17021493" author="blackdrag" created="Wed, 22 Jan 2020 20:52:15 +0000"  >&lt;p&gt;I think you are aware of it, but there is one factor playing especially bad into this and that is the logic for primitive optimizations. Code like this &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
def fib(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; n) {
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (n&amp;lt;1) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 1  &lt;span class=&quot;code-comment&quot;&gt;// line 2  
&lt;/span&gt;  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; fib(n-1) + fib(n-2) &lt;span class=&quot;code-comment&quot;&gt;// line 3
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Is compiled roughly like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
def fib(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; n){
   &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (primtiveOptsDisabled) {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (PrimtiveTypeConversions.lessThan(n,1)) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 1 &lt;span class=&quot;code-comment&quot;&gt;// line 2
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getCallSite(0).call(getCallSite(1).call(getCallSite(2).call(n,1)), getCallSite(3).call(getCallSite(4).call(n,1))) &lt;span class=&quot;code-comment&quot;&gt;// line 3
&lt;/span&gt;    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (n&amp;lt;1) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 1  &lt;span class=&quot;code-comment&quot;&gt;//line 2
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; fib(n-1) + fib(n-2) &lt;span class=&quot;code-comment&quot;&gt;// line 3
&lt;/span&gt;    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which then results in the duplicated path problem you mentioned. This is also a possible problem for code coverage tools. If the code is compile static, with indy or with primitive opts turned off, this would not happen. Given the improvements in the callsite caching for indy my suggestion would be to remove primitive opts and the old callsite caching code and do everything static or with indy for Groovy 4.&lt;/p&gt;

&lt;p&gt;Another problem is that the logic of the debugger in java has to be basically reverse engineered. At least no JVM engineer has been brave enough to explain me the workings of the tool so far.&lt;/p&gt;</comment>
                            <comment id="17022469" author="emilles" created="Thu, 23 Jan 2020 20:33:42 +0000"  >&lt;p&gt;Here is my idea at the moment:  If the return instructions that are usually added by ReturnAdder have line number information set on them, the groovy class should gain a line number entry: &lt;span class=&quot;error&quot;&gt;&amp;#91;pc: 35, line: 6&amp;#93;&lt;/span&gt;.  This should give similar debug and coverage behavior to the Java code.&lt;/p&gt;

&lt;p&gt;I am looking at a method that returns something as well.  This design seems like it will also work in that case.&lt;/p&gt;

&lt;p&gt;Main.java&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Main {
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; flag = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (flag) {
      &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.print(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;);
    }
  } &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; instruction
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     0  iconst_1
     1  istore_1 [flag]
     2  iload_1 [flag]
     3  ifeq 14
     6  getstatic java.lang.&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err : java.io.PrintStream [16]
     9  ldc &amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt; [22]
    11  invokevirtual java.io.PrintStream.print(java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;) : void [24]
    14  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;
      Line numbers:
        [pc: 0, line: 3]
        [pc: 2, line: 4]
        [pc: 6, line: 5]
        [pc: 14, line: 7]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Main.groovy&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Main {
  static main(args) {
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; flag = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (flag) {
      &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.print(&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt;)
    }
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     0  invokestatic Main2.$getCallSiteArray() : org.codehaus.groovy.runtime.callsite.CallSite[] [20]
     3  astore_1
     4  iconst_1
     5  istore_2 [flag]
     6  iload_2 [flag]
     7  pop
     8  iload_2 [flag]
     9  ifeq 35
    12  aload_1
    13  ldc &amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; 0&amp;gt; [34]
    15  aaload
    16  aload_1
    17  ldc &amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; 1&amp;gt; [35]
    19  aaload
    20  ldc &amp;lt;&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; java.lang.&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;&amp;gt; [37]
    22  invokeinterface org.codehaus.groovy.runtime.callsite.CallSite.callGetProperty(java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;) : java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; [43] [nargs: 2]
    27  ldc &amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt; [45]
    29  invokeinterface org.codehaus.groovy.runtime.callsite.CallSite.call(java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;, java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;) : java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; [49] [nargs: 3]
    34  pop
    35  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;
      Line numbers:
        [pc: 4, line: 3]
        [pc: 8, line: 4]
        [pc: 12, line: 5]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17022759" author="blackdrag" created="Fri, 24 Jan 2020 08:24:21 +0000"  >&lt;p&gt;interesting find... +1&lt;/p&gt;</comment>
                            <comment id="17215399" author="primo.modica" created="Fri, 16 Oct 2020 13:48:57 +0000"  >&lt;p&gt;Hello there, i was wondering if there is any progress on this? &lt;br/&gt;
Thank you!&lt;/p&gt;</comment>
                            <comment id="17215448" author="emilles" created="Fri, 16 Oct 2020 15:16:53 +0000"  >&lt;p&gt;The last time I had a look at this, there was not enough ASM API to determine if a label is reachable or a branch is terminal.  Without that, we would need to walk the bytecode to make these determinations.  I have a stash if you&apos;d like to see it pushed to a branch for inspection.&lt;/p&gt;</comment>
                            <comment id="17249073" author="emilles" created="Mon, 14 Dec 2020 16:00:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/pull/1443&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Part one&lt;/a&gt; has been submitted for review.  It writes line number information for the first line of method block to cover generated bytecode instructions, for example implicit call to super class constructor.  And writes line number information for the last line of method block to cover generated bytecode for call return.  Also it consolidates and reworks the fixes for &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7647&quot; title=&quot;Incorrect line information for debug&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7647&quot;&gt;&lt;del&gt;GROOVY-7647&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8742&quot; title=&quot;Line number information for method is confusing debugger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8742&quot;&gt;&lt;del&gt;GROOVY-8742&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9199&quot; title=&quot;Code in finally block is ignored in IntelliJ IDEA debugger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9199&quot;&gt;&lt;del&gt;GROOVY-9199&lt;/del&gt;&lt;/a&gt; &amp;#8211; extra line numbers are not written for &quot;do {&quot;, &quot;try {&quot; and &quot;} finally {&quot;.&lt;/p&gt;

&lt;p&gt;Part two should focus on &lt;tt&gt;AsmClassGenerator#visitStdMethod&lt;/tt&gt;, which adds return instructions (described in &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9126&quot; title=&quot;Unreachable line numbers after ARETURN in bytecode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9126&quot;&gt;&lt;del&gt;GROOVY-9126&lt;/del&gt;&lt;/a&gt;).  These failsafe instructions are not needed in many cases and represent unreachable bytecode that affects coverage reports (and bloats the bytecode).  It will be necessary to determine if any path in the method&apos;s bytecode can reach the point where returns are written.  Void methods, bytecode sequences and other cases are examples where the returns are still leveraged.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 48 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0arw0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>