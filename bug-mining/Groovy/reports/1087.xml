<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:13:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-2790] Groovy Console load is broken.</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-2790</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Loading of certain groovy files results in a scrambled version of the file, i.e. there&apos;s additional code added to the end of the file.&lt;br/&gt;
I included a file that shows the error in my app.&lt;/p&gt;

&lt;p&gt;I hope this isn&apos;t a duplicate. I couldn&apos;t find a matching bug report.&lt;/p&gt;</description>
                <environment>Windows XP, java 1.5</environment>
        <key id="12814232">GROOVY-2790</key>
            <summary>Groovy Console load is broken.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="guillaume">Guillaume Sauthier</assignee>
                                    <reporter username="huxi">Joern Huxhorn</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Apr 2008 12:08:20 +0000</created>
                <updated>Wed, 7 Apr 2010 08:42:09 +0000</updated>
                            <resolved>Wed, 7 Apr 2010 08:42:08 +0000</resolved>
                                    <version>1.5.5</version>
                                    <fixVersion>1.7.2</fixVersion>
                    <fixVersion>1.6.9</fixVersion>
                                    <component>Groovy Console</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14478199" author="huxi" created="Thu, 19 Jun 2008 04:29:34 +0000"  >&lt;p&gt;Any news on this problem?&lt;/p&gt;

&lt;p&gt;I think it&apos;s quite sad that this otherwise great feature of groovy is currently crippled.&lt;/p&gt;</comment>
                            <comment id="14465024" author="shemnon" created="Thu, 19 Jun 2008 11:30:36 +0000"  >&lt;p&gt;No progress.  It&apos;s a combination of not understanding why it&apos;s breaking (since this was donated code) combined with a lack of free time to devote to it.  The solution may be to punt and switch to &lt;a href=&quot;http://saveabend.blogspot.com/2008/06/jsyntaxpane-is-born.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JSyntaxPane&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14467528" author="tim_yates" created="Thu, 20 Aug 2009 08:06:59 +0000"  >&lt;p&gt;It&apos;s a problem with the DocumentFilter of some sort...&lt;/p&gt;

&lt;p&gt;If inside groovy.ui.Console, you change loadScriptFile to:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    void loadScriptFile(File file) {
        swing.edt {
            inputArea.editable = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
        }
        swing.doOutside {
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                consoleText = file.readLines().join(&lt;span class=&quot;code-quote&quot;&gt;&apos;\n&apos;&lt;/span&gt;)
                scriptFile = file
                swing.edt {
                    updateTitle()

                    &lt;span class=&quot;code-comment&quot;&gt;// Turn off DocumentFilter
&lt;/span&gt;                    def doc = inputArea.document
                    def filter = doc.documentFilter
                    doc.documentFilter = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
                    &lt;span class=&quot;code-comment&quot;&gt;// END
&lt;/span&gt;
                    inputArea.setText( consoleText )

                    &lt;span class=&quot;code-comment&quot;&gt;// Then turn it back on again
&lt;/span&gt;                    doc.documentFilter = filter
                    &lt;span class=&quot;code-comment&quot;&gt;// END
&lt;/span&gt;
                    setDirty(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
                    inputArea.caretPosition = 0
                }
            } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
                swing.edt { inputArea.editable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; }
            }
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It loads the document properly, but doesn&apos;t style it again until you type in some more text (and this is just trying to cure the symptoms, rather treating the underlying illness)&lt;/p&gt;

&lt;p&gt;I&apos;ll have a look into StructuredSyntaxDocumentFilter and see if I can see anything...but it all gets a bit frantic &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14467515" author="tim_yates" created="Thu, 20 Aug 2009 09:25:14 +0000"  >&lt;p&gt;I &lt;b&gt;think&lt;/b&gt; I found it...&lt;/p&gt;

&lt;p&gt;When groovy.ui.Console:loadScriptFile called  &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;inputArea.text = consoleText&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; the text was being passed to the groovy.ui.text.StructuredSyntaxDocumentFilter in 4096 char &quot;chunks&quot; rather than all at once&lt;/p&gt;

&lt;p&gt;This meant that the code around the boundaries was garbled, and so the RegExp wonder that is LexerNode was having a bit of choking fit whilst trying to style up the document (hence chunks of code were getting left behind, and put out of order)&lt;/p&gt;

&lt;p&gt;The stuff at the bottom of the file (I think) was the tails of the chunks that it couldn&apos;t handle&lt;/p&gt;

&lt;p&gt;I have submitted a patch to this issue which passes the text straight to the Document rather than via the JTextArea.text method, and this seems to get round the problem&lt;/p&gt;

&lt;p&gt;Again, hope it&apos;s ok &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Tim&lt;/p&gt;</comment>
                            <comment id="14467917" author="guillaume" created="Tue, 6 Oct 2009 16:57:09 +0000"  >&lt;p&gt;Thank you! Sorry it took so long to fix it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14478721" author="huxi" created="Tue, 6 Oct 2009 17:01:18 +0000"  >&lt;p&gt;Yay! anyway &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14478773" author="huxi" created="Mon, 14 Dec 2009 09:56:36 +0000"  >&lt;p&gt;I just checked this and it&apos;s still broken in 1.7-rc-2. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I use:&lt;br/&gt;
console.setScriptFile(messageViewGroovyFile);&lt;br/&gt;
JTextPane inputArea = console.getInputArea();&lt;br/&gt;
inputArea.setText(text);&lt;/p&gt;

&lt;p&gt;I read text manually already.&lt;/p&gt;

&lt;p&gt;Am I using Console wrongly?&lt;/p&gt;</comment>
                            <comment id="14478862" author="paulk" created="Thu, 11 Feb 2010 09:09:29 +0000"  >&lt;p&gt;adjusting fix versions given that it was reopened&lt;/p&gt;</comment>
                            <comment id="14468769" author="tim_yates" created="Thu, 11 Feb 2010 09:12:29 +0000"  >&lt;p&gt;Is this bug now with embedding the console in your own application?&lt;/p&gt;

&lt;p&gt;Not just using the command line to fire up the console?&lt;/p&gt;</comment>
                            <comment id="14478885" author="huxi" created="Thu, 11 Feb 2010 09:39:28 +0000"  >&lt;p&gt;It&apos;s embedded in an application.&lt;/p&gt;

&lt;p&gt;You can take a look at the actual code at&lt;br/&gt;
&lt;a href=&quot;http://github.com/huxi/lilith/blob/master/lilith/src/main/java/de/huxhorn/lilith/swing/preferences/PreferencesDialog.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://github.com/huxi/lilith/blob/master/lilith/src/main/java/de/huxhorn/lilith/swing/preferences/PreferencesDialog.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The relevant part is contained in the method editDetailsFormatter().&lt;/p&gt;</comment>
                            <comment id="14468865" author="tim_yates" created="Thu, 11 Feb 2010 09:51:19 +0000"  >&lt;p&gt;What happens if instead of:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;inputArea.setText(text);
console.setDirty(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You do&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;inputArea.getDocument().remove( 0, inputArea.document.length )
inputArea.getDocument().insertString( 0, text, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The same as I do in the patch I supplied here:&lt;br/&gt;
&lt;a href=&quot;http://jira.codehaus.org/browse/GROOVY-2790?focusedCommentId=187785&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_187785&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jira.codehaus.org/browse/GROOVY-2790?focusedCommentId=187785&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_187785&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(see Console.patch at the top of this issue)&lt;/p&gt;

&lt;p&gt;Does that fix it?&lt;/p&gt;</comment>
                            <comment id="14478884" author="huxi" created="Fri, 12 Feb 2010 05:21:45 +0000"  >&lt;p&gt;Yes, the following code works:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;JTextPane inputArea = console.getInputArea();
//inputArea.setText(text);
Document doc = inputArea.getDocument();
try
{
	doc.remove( 0, doc.getLength() );
	doc.insertString( 0, text, null );
}
catch(BadLocationException e)
{
	if(logger.isWarnEnabled()) logger.warn(&quot;Exception while setting source!&quot;, e);
}
console.setDirty(false);
inputArea.setCaretPosition(0);
inputArea.requestFocusInWindow();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thanks for the tip!&lt;/p&gt;

&lt;p&gt;The question is: is this bug fixed?&lt;br/&gt;
There should probably be at least some method that does the above. I also don&apos;t really understand what&apos;s happening here, i.e. exactly why setText is failing like this.&lt;/p&gt;</comment>
                            <comment id="14468896" author="tim_yates" created="Fri, 12 Feb 2010 05:47:29 +0000"  >&lt;p&gt;The syntax highlighter is kicked off by Document events&lt;/p&gt;

&lt;p&gt;When you call setText, Swing seems to buffer the text you&apos;re adding, and it goes into the Document in chunks&lt;/p&gt;

&lt;p&gt;The problem is that the syntax highlighter (which is a huge Rube Goldberg regexp parser of genius) startes parsing the text before all of the chunks have been added&lt;/p&gt;

&lt;p&gt;If one of these chunks splits in the middle of a loop or a string, then the highlighter chokes and you end up with the remaining code left in the highlighter&apos;s buffer&lt;/p&gt;

&lt;p&gt;All of this remainging code is then spat out into the end of the document&lt;/p&gt;

&lt;p&gt;So by skipping setText, and going straight for the document.insertString method, we make sure that the all the Groovy code is there at the same time when the event to highlight it fires&lt;/p&gt;

&lt;p&gt;This is the cleanest solution I could find when I looked through the code back in the summer&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722222" name="Console.patch" size="641" author="tim_yates" created="Thu, 20 Aug 2009 09:25:14 +0000"/>
                            <attachment id="12721839" name="detailsView.groovy" size="14615" author="" created="Tue, 29 Apr 2008 12:08:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 41 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cgon:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>