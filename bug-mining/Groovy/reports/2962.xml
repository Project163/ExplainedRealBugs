<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:47:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-7587] Groovy 2.2 and 2.4 all fail to execute almost any script with Java 9 JIGSAW preview builds</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-7587</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The Lucene project successfully made their code running with the recently announced preview builds of Java 9. Unfortunately some parts of Lucene&apos;s build script and also the build of the Policeman&apos;s ForbiddenAPI checker (&lt;a href=&quot;https://github.com/policeman-tools/forbidden-apis/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/policeman-tools/forbidden-apis/&lt;/a&gt;) use groovy to execute some stuff that does not work with plain Ant. Similar issues are seen by Elasticsearch&apos;s scripting support plugin.&lt;/p&gt;

&lt;p&gt;Unfortunately even simple scripts fail quite often. The issue always looks like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def temp = &lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.getSystemClassLoader()
temp.toString()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.reflect.InaccessibleObjectException: Unable to make member of class jdk.internal.misc.ClassLoaders$AppClassLoader accessible:  module java.base does not export jdk.internal.misc to &amp;lt;unnamed module @1a6f5124&amp;gt;
        at sun.reflect.Reflection.throwInaccessibleObjectException(java.base@9.0/Reflection.java:462)
        at java.lang.reflect.AccessibleObject.checkCanSetAccessible(java.base@9.0/AccessibleObject.java:194)
        at java.lang.reflect.AccessibleObject.setAccessible(java.base@9.0/AccessibleObject.java:157)
        at org.codehaus.groovy.reflection.CachedConstructor$1.run(CachedConstructor.java:44)
        at java.security.AccessController.doPrivileged(java.base@9.0/Native Method)
        at org.codehaus.groovy.reflection.CachedConstructor.&amp;lt;init&amp;gt;(CachedConstructor.java:42)
        at org.codehaus.groovy.reflection.CachedClass$2.initValue(CachedClass.java:79)
        at org.codehaus.groovy.reflection.CachedClass$2.initValue(CachedClass.java:69)
        at org.codehaus.groovy.util.LazyReference.getLocked(LazyReference.java:49)
        at org.codehaus.groovy.util.LazyReference.get(LazyReference.java:36)
        at org.codehaus.groovy.reflection.CachedClass.getConstructors(CachedClass.java:268)
        at groovy.lang.MetaClassImpl.&amp;lt;init&amp;gt;(MetaClassImpl.java:218)
        at groovy.lang.MetaClassImpl.&amp;lt;init&amp;gt;(MetaClassImpl.java:228)
        at groovy.lang.MetaClassRegistry$MetaClassCreationHandle.createNormalMetaClass(MetaClassRegistry.java:171)
        at groovy.lang.MetaClassRegistry$MetaClassCreationHandle.createWithCustomLookup(MetaClassRegistry.java:161)
        at groovy.lang.MetaClassRegistry$MetaClassCreationHandle.create(MetaClassRegistry.java:144)
        at org.codehaus.groovy.reflection.ClassInfo.getMetaClassUnderLock(ClassInfo.java:253)
        at org.codehaus.groovy.reflection.ClassInfo.getMetaClass(ClassInfo.java:285)
        at org.codehaus.groovy.reflection.ClassInfo.getMetaClass(ClassInfo.java:295)
        at org.codehaus.groovy.runtime.metaclass.MetaClassRegistryImpl.getMetaClass(MetaClassRegistryImpl.java:261)
        at org.codehaus.groovy.runtime.InvokerHelper.getMetaClass(InvokerHelper.java:871)
        at org.codehaus.groovy.runtime.callsite.CallSiteArray.createPojoSite(CallSiteArray.java:125)
        at org.codehaus.groovy.runtime.callsite.CallSiteArray.createCallSite(CallSiteArray.java:166)
        at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCall(CallSiteArray.java:48)
        at org.codehaus.groovy.runtime.callsite.AbstractCallSite.call(AbstractCallSite.java:113)
        at org.codehaus.groovy.runtime.callsite.AbstractCallSite.call(AbstractCallSite.java:117)
        at generate-deprecated.run(generate-deprecated.groovy:20)
        at org.codehaus.groovy.ant.Groovy.parseAndRunScript(Groovy.java:501)
        at org.codehaus.groovy.ant.Groovy.execGroovy(Groovy.java:448)
        at org.codehaus.groovy.ant.Groovy.execute(Groovy.java:313)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This always happens under the following circumstances. You have a public Object accessible from everywhere in the JDK. This object is working like a factory and creates an implementation of an abstract class. In the above example this is a classloader (abstract class). This returned instance is of course some JDK-internal class and the user code is intended to only call the visible methods on it.&lt;/p&gt;

&lt;p&gt;Unfortunately groovy tries in the second line to create a metaclass to get &quot;full insight&quot; of this internal class. For that it tries to make everything accessible. And with Java 9 including JIGSAW this is no longer possible. You can use the APIs provided by the internal implementation, but you are not allowed to do any non-public stuff. This is disallowed by the Java module system and there is no way around (unless you disable the module system completely, which will not work in all cases in Java 9 once it is released).&lt;/p&gt;</description>
                <environment>java version &amp;quot;1.9.0-ea&amp;quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.9.0-ea-jigsaw-nightly-h3337-20150908-b80)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 1.9.0-ea-jigsaw-nightly-h3337-20150908-b80, mixed mode)</environment>
        <key id="12863103">GROOVY-7587</key>
            <summary>Groovy 2.2 and 2.4 all fail to execute almost any script with Java 9 JIGSAW preview builds</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="uschindler">Uwe Schindler</reporter>
                        <labels>
                            <label>Java9</label>
                    </labels>
                <created>Thu, 10 Sep 2015 16:16:05 +0000</created>
                <updated>Mon, 22 Feb 2016 20:48:34 +0000</updated>
                            <resolved>Mon, 2 Nov 2015 12:44:12 +0000</resolved>
                                    <version>2.2.2</version>
                    <version>2.4.4</version>
                                    <fixVersion>2.4.6</fixVersion>
                                    <component>groovy-runtime</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14739083" author="thetaphi" created="Thu, 10 Sep 2015 16:43:32 +0000"  >&lt;p&gt;Other simple examples:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.nio.file.*;

def test = Paths.get(&lt;span class=&quot;code-quote&quot;&gt;&apos;test.txt&apos;&lt;/span&gt;)
print test.toString()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Fails because the return value of Paths.get() is some internal class which cannot be reflected on:&lt;br/&gt;
java.lang.reflect.InaccessibleObjectException: Unable to make member of class sun.nio.fs.WindowsPath accessible:  module java.base does not export sun.nio.fs to &amp;lt;unnamed module @1a6f5124&amp;gt;&lt;/p&gt;

&lt;p&gt;Same happens on Charset.defaultCharset(), Locale.getDefault(),... But also for non-static stuff, it just needs to be some factory-like method that returns an internal implementation of a public interface/class/....&lt;/p&gt;</comment>
                            <comment id="14985164" author="blackdrag" created="Mon, 2 Nov 2015 12:44:12 +0000"  >&lt;p&gt;I added a work around that catches RuntimeException and then checks for the class jigsaw uses. This allows the provided scripts to run, though no test was added. &lt;/p&gt;</comment>
                            <comment id="14985171" author="thetaphi" created="Mon, 2 Nov 2015 12:49:49 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
many thanks. Looks like the ideal workaround to fix this for now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 3 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2k07b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>