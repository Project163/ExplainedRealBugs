<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:13:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-3136] Groovy SQL eachRow and Resultset in parameters</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-3136</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Using eachRow and passing parameters containing resultsets will fail.&lt;br/&gt;
The eachRow method will instantiate a PreparedStatement and use setParameters and then setObject, &lt;br/&gt;
which will result in a ClassCastException (catched in line 1416), because it tries to cast to a CallableStatement.&lt;br/&gt;
But there is no eachRow-Method with a CallableStatement...&lt;/p&gt;

&lt;p&gt;Workaround:&lt;br/&gt;
use Sql.call and make sure your resultsets get closed explicitly, after executing your statement (you just got a feature request &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; )&lt;/p&gt;

&lt;p&gt;A possible solution would be to detect OutParameters and then use a CallableStatement.&lt;br/&gt;
If ResultSetOutParameters are used, a modified Sql.call function that cleans up resultsets as well could be used.&lt;br/&gt;
You could also close the ResultSets in the eachRow method after calling the &quot;current&quot; call-Method.... adeveloper would still have to clean up ResultSets using the call-method though.&lt;/p&gt;</description>
                <environment>Windows XP SP3</environment>
        <key id="12814431">GROOVY-3136</key>
            <summary>Groovy SQL eachRow and Resultset in parameters</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="ukistler">Ueli Kistler</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Nov 2008 02:46:01 +0000</created>
                <updated>Tue, 7 Apr 2015 19:12:56 +0000</updated>
                            <resolved>Sat, 5 May 2012 00:04:55 +0000</resolved>
                                    <version>1.5.7</version>
                                    <fixVersion>1.6.5</fixVersion>
                                    <component>SQL processing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14465527" author="blackdrag" created="Fri, 7 Nov 2008 10:09:28 +0000"  >&lt;p&gt;could you give an example of what fails?&lt;/p&gt;</comment>
                            <comment id="14478645" author="paulk" created="Sun, 9 Aug 2009 21:52:43 +0000"  >&lt;p&gt;There is a partial fix to this in trunk but I only have limited ability to test it. Can someone try testing for me please?&lt;/p&gt;

&lt;p&gt;The patch uses a regex to look for sql queries starting with &apos;call&apos;, &apos;{ call&apos; or &apos;{ ? = call&apos; and uses a CallableStatement rather than a PreparedStatement in those cases. I haven&apos;t decided whether this is the best approach or not.&lt;/p&gt;

&lt;p&gt;There is still more work to be done as this doesn&apos;t look at the issue of ResultSet parameter cleanup which is now potentially spreading to a lot more places nor does it try to wrap ResultSet params as GroovyResultSet proxies - apart from where already done in &lt;tt&gt;call&lt;/tt&gt; which is left unchanged (but changing as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-3137&quot; title=&quot;Groovy SQL call, eachRow and Resultset in parameters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-3137&quot;&gt;&lt;del&gt;GROOVY-3137&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;I tested on MySQL with this stored function:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;sql.execute &quot;&quot;&quot;
    create function FullName(_firstname VARCHAR(40)) returns VARCHAR(80)
    begin
        declare ans VARCHAR(80);
        SELECT CONCAT(firstname, &lt;span class=&quot;code-quote&quot;&gt;&apos; &apos;&lt;/span&gt;, lastname) INTO ans FROM PERSON WHERE firstname = _firstname;
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ans;
    end
&quot;&quot;&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and called like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; sql.firstRow(&lt;span class=&quot;code-quote&quot;&gt;&quot;{? = call FullName(?)}&quot;&lt;/span&gt;, [Sql.VARCHAR, &lt;span class=&quot;code-quote&quot;&gt;&apos;Sam&apos;&lt;/span&gt;])[0] == &lt;span class=&quot;code-quote&quot;&gt;&apos;Sam Pullara&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Also appeared to work for &lt;tt&gt;rows&lt;/tt&gt; and &lt;tt&gt;eachRow&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14478618" author="paulk" created="Mon, 10 Aug 2009 05:26:52 +0000"  >&lt;p&gt;This seems to be a little database specific unfortunately. For example, using SQL Server, and this stored procedure:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;sql.execute &quot;&quot;&quot;
    create function FullName
    (@firstname VARCHAR(40))
    returns VARCHAR(80)
    begin
        declare @ans VARCHAR(80)
        SET @ans = (SELECT firstname + &lt;span class=&quot;code-quote&quot;&gt;&apos; &apos;&lt;/span&gt; + lastname FROM PERSON WHERE firstname = @firstname)
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; @ans
    end
&quot;&quot;&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I had to invoke using &lt;tt&gt;call&lt;/tt&gt; as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;sql.call(&lt;span class=&quot;code-quote&quot;&gt;&quot;{? = call FullName(?)}&quot;&lt;/span&gt;, [Sql.VARCHAR, &lt;span class=&quot;code-quote&quot;&gt;&apos;Sam&apos;&lt;/span&gt;]) {
    name -&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; name == &lt;span class=&quot;code-quote&quot;&gt;&apos;Sam Pullara&apos;&lt;/span&gt;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I couldn&apos;t use &lt;tt&gt;eachRow&lt;/tt&gt;, &lt;tt&gt;rows&lt;/tt&gt; or &lt;tt&gt;firstRow&lt;/tt&gt; etc. because they all expect a ResultSet to be returned.&lt;br/&gt;
MySQL nicely converted the scalar into a ResultSet using the function name as the &quot;fieldname&quot;.&lt;/p&gt;

&lt;p&gt;Anyway, that still leaves Stored Functions which return ResultSets which should now work across all methods - pending further testing.&lt;/p&gt;</comment>
                            <comment id="14478676" author="paulk" created="Wed, 16 Sep 2009 09:37:48 +0000"  >&lt;p&gt;Now merged onto 1.6 branch. I am wondering whether the &quot;partial fix&quot; is sufficient to close this issue or you have a use case not covered by the partial fix?&lt;/p&gt;</comment>
                            <comment id="14479930" author="paulk" created="Sat, 5 May 2012 00:04:55 +0000"  >&lt;p&gt;No further feedback, assuming current fix is sufficient&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310260">
                    <name>Related</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12817950">GROOVY-3137</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 29 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bt9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>