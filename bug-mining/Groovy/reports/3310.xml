<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:57:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-8295] Groovyc ant task can overflow Windows command line if classpath is large</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-8295</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The groovyc ant adapter tries to account for the 32K command line length limit on windows in its addSourceFiles method.  However, if the command line gets long for other reasons &amp;#8211; we include a number of libraries in our compiled projects &amp;#8211; the command line can still be overflown.&lt;/p&gt;

&lt;p&gt;This results in:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CompileAntScript.xml:129: Error running forked groovyc.
	at org.codehaus.groovy.ant.Groovyc.runForked(Groovyc.java:1121)
	at org.codehaus.groovy.ant.Groovyc.compile(Groovyc.java:1214)
	at org.codehaus.groovy.ant.Groovyc.execute(Groovyc.java:831)

Caused by: java.io.IOException: Cannot run program &lt;span class=&quot;code-quote&quot;&gt;&quot;C:\Program Files\Java\jdk1.8.0_60\jre\bin\java&quot;&lt;/span&gt;: CreateProcess error=206, The filename or extension is too &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;
	at java.lang.ProcessBuilder.start(ProcessBuilder.java:1048)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt;.exec(&lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt;.java:620)
	at org.apache.tools.ant.taskdefs.Execute$Java13CommandLauncher.exec(Execute.java:862)
	at org.apache.tools.ant.taskdefs.Execute.launch(Execute.java:481)
	at org.apache.tools.ant.taskdefs.Execute.execute(Execute.java:495)
	at org.codehaus.groovy.ant.Groovyc.runForked(Groovyc.java:1119)
	... 31 more
Caused by: java.io.IOException: CreateProcess error=206, The filename or extension is too &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;
	at java.lang.ProcessImpl.create(Native Method)
	at java.lang.ProcessImpl.&amp;lt;init&amp;gt;(ProcessImpl.java:386)
	at java.lang.ProcessImpl.start(ProcessImpl.java:137)
	at java.lang.ProcessBuilder.start(ProcessBuilder.java:1029)
	... 36 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Would it be possible to add command line length checking to &lt;tt&gt;runForked&lt;/tt&gt; instead of &lt;tt&gt;addSourceFiles&lt;/tt&gt; and use a command file for groovyc to prevent command line overflow?  Without this, we are having to use a lot of verbose workarounds in Ant.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/blob/master/subprojects/groovy-ant/src/main/java/org/codehaus/groovy/ant/Groovyc.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/blob/master/subprojects/groovy-ant/src/main/java/org/codehaus/groovy/ant/Groovyc.java&lt;/a&gt;&lt;/p&gt;</description>
                <environment>Windows</environment>
        <key id="13097341">GROOVY-8295</key>
            <summary>Groovyc ant task can overflow Windows command line if classpath is large</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="emilles">Eric Milles</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Aug 2017 15:36:52 +0000</created>
                <updated>Tue, 6 Mar 2018 23:14:47 +0000</updated>
                            <resolved>Sat, 24 Feb 2018 01:52:04 +0000</resolved>
                                                    <fixVersion>2.4.14</fixVersion>
                                    <component>Ant integration</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16146275" author="emilles" created="Tue, 29 Aug 2017 22:41:38 +0000"  >&lt;p&gt;I did a little digging on this one.  It appears that the &lt;tt&gt;@file.txt&lt;/tt&gt; command line option of Groovyc (aka &lt;tt&gt;org.codehaus.groovy.tools.FileSystemCompiler&lt;/tt&gt;) is for the list of source files only.  So I took another approach to the problem.  Since the classpath is the bit that is so very long (and is listed 2 times when running in forked mode), I tried replacing the absolute path of the executable&apos;s working directory.  &lt;/p&gt;

&lt;p&gt;The change is actually quite small.  Replace the 2 occurrences of &lt;tt&gt;commandLineList.add(classpath.toString());&lt;/tt&gt; with &lt;tt&gt;commandLineList.add(classpath.toString().replace(getProject().getBaseDir().getAbsolutePath(), &quot;.&quot;));&lt;/tt&gt;.&lt;/p&gt;


&lt;p&gt;This can reduce a classpath like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;C:\Users\user.home\project.directory\build\JavaClasses;C:\Users\user.home\project.directory\build\IvyLibraries\master\commons-codec-1.10.jar;C:\Users\user.home\project.directory\build\IvyLibraries\master\commons-collections4-4.1.jar;C:\Users\user.home\project.directory\build\IvyLibraries\master\commons-lang3-3.6.jar;C:\Users\user.home\project.directory\build\IvyLibraries\master\db-5.1.19.jar;C:\Users\user.home\project.directory\build\IvyLibraries\master\groovy-all-2.4.12.jar;C:\Users\user.home\project.directory\build\IvyLibraries\master\guava-22.0.jar;C:\Users\user.home\project.directory\build\IvyLibraries\master\infra-berkeleyloader-28.5.0.jar;C:\Users\user.home\project.directory\build\IvyLibraries\master\infra-logging-31.1.0.jar;C:\Users\user.home\project.directory\build\IvyLibraries\master\joda-time-2.9.9.jar;C:\Users\user.home\project.directory\build\IvyLibraries\master\json-20080701.jar;C:\Users\user.home\project.directory\build\IvyLibraries\master\log4j-1.2.17.jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;.\build\JavaClasses;;.\build\IvyLibraries\master\commons-codec-1.10.jar;.\build\IvyLibraries\master\commons-collections4-4.1.jar;.\build\IvyLibraries\master\commons-lang3-3.6.jar;.\build\IvyLibraries\master\db-5.1.19.jar;.\build\IvyLibraries\master\groovy-all-2.4.12.jar;.\build\IvyLibraries\master\guava-22.0.jar;.\build\IvyLibraries\master\infra-berkeleyloader-28.5.0.jar;.\build\IvyLibraries\master\infra-logging-31.1.0.jar;.\build\IvyLibraries\master\joda-time-2.9.9.jar;.\build\IvyLibraries\master\json-20080701.jar;.\build\IvyLibraries\master\log4j-1.2.17.jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The effect is quite significant for a project with dozens of dependencies that is built in a deeply nested directory on the file system.&lt;/p&gt;</comment>
                            <comment id="16146302" author="emilles" created="Tue, 29 Aug 2017 23:01:53 +0000"  >&lt;p&gt;Here is a patch file (based on Groovyc.java in 2.4.12) for the proposed solution I commented on.&lt;/p&gt;</comment>
                            <comment id="16241369" author="githubbot" created="Tue, 7 Nov 2017 02:31:41 +0000"  >&lt;p&gt;GitHub user paulk-asert opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/629&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/629&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8295&quot; title=&quot;Groovyc ant task can overflow Windows command line if classpath is large&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8295&quot;&gt;&lt;del&gt;GROOVY-8295&lt;/del&gt;&lt;/a&gt;: Groovyc ant task can overflow Windows command line if cl&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;asspath is large. PR based on Eric&apos;s patch in the related issue.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/paulk-asert/groovy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/paulk-asert/groovy&lt;/a&gt; groovy8295&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/629.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/629.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #629&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit b34e1b00101470659fbadf0f23952207d4bfb63b&lt;br/&gt;
Author: paulk &amp;lt;paulk@asert.com.au&amp;gt;&lt;br/&gt;
Date:   2017-11-07T02:30:10Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-8295&quot; title=&quot;Groovyc ant task can overflow Windows command line if classpath is large&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-8295&quot;&gt;&lt;del&gt;GROOVY-8295&lt;/del&gt;&lt;/a&gt;: Groovyc ant task can overflow Windows command line if classpath is large&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16249003" author="githubbot" created="Sun, 12 Nov 2017 22:30:16 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/629&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/629&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16249062" author="paulk" created="Mon, 13 Nov 2017 02:55:29 +0000"  >&lt;p&gt;Proposed PR merged.&lt;/p&gt;</comment>
                            <comment id="16277263" author="emilles" created="Mon, 4 Dec 2017 18:59:30 +0000"  >&lt;p&gt;Paul,&lt;br/&gt;
The merge request that went in for this only replaces the first occurrence of the project basedir.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getClasspathRelative(Path classpath) {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; raw = classpath.toString();
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; baseDir = getProject().getBaseDir().getAbsolutePath();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!raw.startsWith(baseDir)) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; raw;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;.&quot;&lt;/span&gt; + raw.substring(baseDir.length());
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;My original change was &lt;tt&gt;classpath.toString().replace(getProject().getBaseDir().getAbsolutePath(), &quot;.&quot;)&lt;/tt&gt;, which replaces every occurrence of the baseDir with &quot;.&quot;.&lt;/p&gt;</comment>
                            <comment id="16277351" author="emilles" created="Mon, 4 Dec 2017 19:38:27 +0000"  >&lt;p&gt;Here is a possible new version of &lt;tt&gt;getClasspathRelative&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getClasspathRelative(Path classpath) {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; baseDir = getProject().getBaseDir().getAbsolutePath();
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; pattern = &lt;span class=&quot;code-quote&quot;&gt;&quot;(\\A|&quot;&lt;/span&gt; + File.pathSeparator + &lt;span class=&quot;code-quote&quot;&gt;&quot;)&quot;&lt;/span&gt; + Pattern.quote(baseDir) + &lt;span class=&quot;code-quote&quot;&gt;&quot;\\b&quot;&lt;/span&gt;;
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; classpath.toString().replaceAll(pattern, &lt;span class=&quot;code-quote&quot;&gt;&quot;$1.&quot;&lt;/span&gt;);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16281198" author="paulk" created="Thu, 7 Dec 2017 00:58:12 +0000"  >&lt;p&gt;My bad. I had played around with using split on pathSeparator but obviously didn&apos;t put that in my PR. Must have been too many things in parallel at the time! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16285063" author="paulk" created="Sun, 10 Dec 2017 03:30:37 +0000"  >&lt;p&gt;I ended up not mucking around with split/regexs and instead asking a path for its list of components which seems fairly clean. Output from my test project on Windows:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  [groovyc] C:\Projects\groovy\target\install\embeddable\groovy-all-3.0.0-SNAPSHOT.jar;.\lang\commons-lang-2.6.jar;.\guava\guava-20.0.jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It would be great if you can try out a snapshot release.&lt;/p&gt;</comment>
                            <comment id="16287938" author="emilles" created="Tue, 12 Dec 2017 17:16:09 +0000"  >&lt;p&gt;Paul, thanks for the extra effort.  I&apos;m going to take a look at the current fix.  Also, we are running into a build issue with the fix as deployed in 2.4.13.  We have a chained build and I think the project basedir and the working dir of the compiler are different.  I&apos;ll let you know when I have a bit more info.&lt;/p&gt;</comment>
                            <comment id="16288014" author="emilles" created="Tue, 12 Dec 2017 18:24:02 +0000"  >&lt;p&gt;So here&apos;s what I am running into.  We use the &lt;tt&gt;&amp;lt;ant antfile=&quot;ant/CompileAntScript.xml&quot; ...&lt;/tt&gt; from one build script to drive another. This results in a process working directory of &lt;tt&gt;ant/&lt;/tt&gt;.  This can be confirmed by executing &lt;tt&gt;java.nio.file.Paths.get(&quot;&quot;).toAbsolutePath()&lt;/tt&gt; within Groovyc.  When Groovyc is run in-process (no forking), it inherits this working directory.  However, when Groovyc is forked, &lt;tt&gt;executor.setWorkingDirectory(getProject().getBaseDir());&lt;/tt&gt; is called, which changes the working directory.&lt;/p&gt;

&lt;p&gt;If I replace &lt;tt&gt;executor.setWorkingDirectory(getProject().getBaseDir());&lt;/tt&gt; with &lt;tt&gt;executor.setWorkingDirectory(Paths.get(&quot;&quot;).toAbsolutePath().toFile());&lt;/tt&gt; in &lt;tt&gt;runForked&lt;/tt&gt; and I replace &lt;tt&gt;String baseDir = getProject().getBaseDir().getAbsolutePath();&lt;/tt&gt; with &lt;tt&gt;String baseDir = Paths.get(&quot;&quot;).toAbsolutePath().toString());&lt;/tt&gt; in &lt;tt&gt;getClasspathRelative&lt;/tt&gt; I get the same behavior for forked and in-process compilation (WRT working directory and relative paths).&lt;/p&gt;</comment>
                            <comment id="16288152" author="emilles" created="Tue, 12 Dec 2017 19:37:33 +0000"  >&lt;p&gt;Quick summary: current fix for this issue in Groovy 2.4 branch works perfectly in forked compilation mode.  In-process compilation is failing due to difference between project basedir and working directory (as mentioned in previous comment).&lt;/p&gt;

&lt;p&gt;Changing &lt;tt&gt;getClasspathRelative&lt;/tt&gt; as described above works in forked compilation mode.  Although it alters the working directory from what existing builds have been using.  This same change is not helping in-process compilation.  Ant appears to be validating the classpath resources against the project basedir and the FileSystemCompiler loads relative to the working directory.&lt;/p&gt;

&lt;p&gt;If &lt;tt&gt;getClasspathRelative&lt;/tt&gt; did not alter the classpath for in-process compilation, there would be no other conflict with the fix.  That is, check &lt;tt&gt;fork&lt;/tt&gt; flag.&lt;/p&gt;</comment>
                            <comment id="16288165" author="emilles" created="Tue, 12 Dec 2017 19:48:03 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getClasspathRelative(Path classpath) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!fork) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; classpath.toString();

        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; baseDir = getProject().getBaseDir().getAbsolutePath();
        StringBuilder sb = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringBuilder();
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; next : classpath.list()) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sb.length() &amp;gt; 0) {
                sb.append(File.pathSeparatorChar);
            }
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (next.startsWith(baseDir)) {
                sb.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;.&quot;&lt;/span&gt;).append(next.substring(baseDir.length()));
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                sb.append(next);
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; sb.toString();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;  or&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void doForkCommandLineList(List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; commandLineList, Path classpath, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; separator) {
        ...
        commandLineList.add(&lt;span class=&quot;code-quote&quot;&gt;&quot;-classpath&quot;&lt;/span&gt;);
        commandLineList.add(getClasspathRelative(classpath));
        ...
}
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void doNormalCommandLineList(List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; commandLineList, List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; jointOptions, Path classpath) {
        commandLineList.add(&lt;span class=&quot;code-quote&quot;&gt;&quot;--classpath&quot;&lt;/span&gt;);
        commandLineList.add(!fork ? classpath.toString() : getClasspathRelative(classpath));
        ...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;



&lt;p&gt;Follow up: Any reason the classpath is passed using both &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-classpath&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; and &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;--classpath&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; options to the compiler?  This duplication is a lot of the reason for command-line overflow.&lt;/p&gt;</comment>
                            <comment id="16291060" author="emilles" created="Thu, 14 Dec 2017 16:00:28 +0000"  >&lt;p&gt;Paul, one extra check is required (see my last comment) to handle in-process compilation.  Forked compilation is working properly.&lt;/p&gt;</comment>
                            <comment id="16368118" author="paulk" created="Sat, 17 Feb 2018 06:24:00 +0000"  >&lt;p&gt;I had previously changed &lt;tt&gt;doNormalCommandLineList&lt;/tt&gt; to have:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!fork) {
    commandLineList.add(&lt;span class=&quot;code-quote&quot;&gt;&quot;--classpath&quot;&lt;/span&gt;);
    commandLineList.add(classpath.toString());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Is that what you were testing against? It was meant to get rid of the duplication also.&lt;/p&gt;</comment>
                            <comment id="16372947" author="emilles" created="Thu, 22 Feb 2018 15:28:41 +0000"  >&lt;p&gt;Looking at the current 2.4 branch, I see doNormalCommandLineList still using getClasspathRelative unconditionally.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/blob/GROOVY_2_4_X/subprojects/groovy-ant/src/main/java/org/codehaus/groovy/ant/Groovyc.java#L1063&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/blob/GROOVY_2_4_X/subprojects/groovy-ant/src/main/java/org/codehaus/groovy/ant/Groovyc.java#L1063&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I am seeing this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void doNormalCommandLineList(List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; commandLineList, List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; jointOptions, Path classpath) {
        commandLineList.add(&lt;span class=&quot;code-quote&quot;&gt;&quot;--classpath&quot;&lt;/span&gt;);
        commandLineList.add(getClasspathRelative(classpath));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;and I&apos;m lobbying for this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void doNormalCommandLineList(List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; commandLineList, List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; jointOptions, Path classpath) {
        commandLineList.add(&lt;span class=&quot;code-quote&quot;&gt;&quot;--classpath&quot;&lt;/span&gt;);
        commandLineList.add(!fork ? classpath.toString() : getClasspathRelative(classpath));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I have not tested with the exclusion of these two lines in the case of in-process compilation.  I had not seen that change anywhere previously.&lt;/p&gt;</comment>
                            <comment id="16373927" author="paulk" created="Fri, 23 Feb 2018 04:46:52 +0000"  >&lt;p&gt;Looks like I only did that change in master. It&apos;s now propagated to the other branches. Let me know if that works, otherwise we can look at your suggestion.&lt;/p&gt;</comment>
                            <comment id="16374532" author="emilles" created="Fri, 23 Feb 2018 15:52:15 +0000"  >&lt;p&gt;Paul, the change looks good for both forked and in-process compilation.  Thanks again for the extra effort on this issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12884364" name="Groovyc.patch" size="2985" author="emilles" created="Tue, 29 Aug 2017 23:01:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 38 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3j8tz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>