<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:04:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-9385] Access to outer class private field from closure leads to ClassCastException (@CompileStatic)</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-9385</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Given the following code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.example

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.objectweb.asm.ClassReader
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.objectweb.asm.util.TraceClassVisitor

@CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;OuterClass {
    private &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; counter

    void call() {
        { -&amp;gt;
            &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; closureClassName = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Throwable().stackTrace[0].className
            counter++

            printClass(closureClassName)
        }.call()
    }

    static void printClass(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; className) {
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ClassReader(className).accept(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TraceClassVisitor(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PrintWriter(&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err)), ClassReader.EXPAND_FRAMES)
    }

    static void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OuterClass().call()
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (ClassCastException e) {
            printClass(e.stackTrace[0].className)
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; e
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&quot;panel&quot; style=&quot;border-color: red;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-color: red;&quot;&gt;&lt;b&gt;Groovy 3.0.0-rc-3&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/check.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Compilation OK&lt;br/&gt;
&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Runtime &lt;tt&gt;ClassCastException&lt;/tt&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception in thread &quot;main&quot; java.lang.ClassCastException: class org.example.OuterClass$_call_closure1 cannot be cast to class org.example.OuterClass (org.example.OuterClass$_call_closure1 and org.example.OuterClass are in unnamed module of loader &apos;app&apos;)
	at org.example.OuterClass$_call_closure1.doCall(OuterClass.groovy:14)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:107)
	at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:323)
	at org.codehaus.groovy.runtime.metaclass.ClosureMetaClass.invokeMethod(ClosureMetaClass.java:263)
	at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1027)
	at groovy.lang.Closure.call(Closure.java:412)
	at groovy.lang.Closure.call(Closure.java:406)
	at org.example.OuterClass.call(OuterClass.groovy:12)
	at org.example.OuterClass.main(OuterClass.groovy:26)

Execution failed for task &apos;:OuterClass.main()&apos;.
&amp;gt; Process &apos;command &apos;C:/Program Files/Java/zulu11.35.15-ca-jdk11.0.5-win_x64/bin/java.exe&apos;&apos; finished with non-zero exit value 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Disassembled view from ASM (preceding the exception):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;// class version 55.0 (55)
// access flags 0x31
public final class org/example/OuterClass$_call_closure1 extends groovy/lang/Closure implements org/codehaus/groovy/runtime/GeneratedClosure {

  // compiled from: OuterClass.groovy
  OUTERCLASS org/example/OuterClass call ()V
  // access flags 0x11
  public final INNERCLASS org/example/OuterClass$_call_closure1 null _call_closure1

  // access flags 0x100A
  private static synthetic Lorg/codehaus/groovy/reflection/ClassInfo; $staticClassInfo

  // access flags 0x1089
  public static transient synthetic Z __$stMC

  // access flags 0x1
  public &amp;lt;init&amp;gt;(Ljava/lang/Object;Ljava/lang/Object;)V
   L0
    ALOAD 0
    ALOAD 1
    ALOAD 2
    INVOKESPECIAL groovy/lang/Closure.&amp;lt;init&amp;gt; (Ljava/lang/Object;Ljava/lang/Object;)V
   L1
    RETURN
    LOCALVARIABLE this Lorg/example/OuterClass$_call_closure1; L0 L1 0
    LOCALVARIABLE _outerInstance Ljava/lang/Object; L0 L1 1
    LOCALVARIABLE _thisObject Ljava/lang/Object; L0 L1 2
    MAXSTACK = 3
    MAXLOCALS = 3

  // access flags 0x1
  public doCall()Ljava/lang/Object;
   L0
    LINENUMBER 13 L0
    NEW java/lang/Throwable
    DUP
    INVOKESPECIAL java/lang/Throwable.&amp;lt;init&amp;gt; ()V
    INVOKEVIRTUAL java/lang/Throwable.getStackTrace ()[Ljava/lang/StackTraceElement;
    ICONST_0
    INVOKESTATIC org/codehaus/groovy/runtime/BytecodeInterface8.objectArrayGet ([Ljava/lang/Object;I)Ljava/lang/Object;
    CHECKCAST java/lang/StackTraceElement
    INVOKEVIRTUAL java/lang/StackTraceElement.getClassName ()Ljava/lang/String;
    ASTORE 1
   L1
    ALOAD 1
    POP
   L2
    LINENUMBER 14 L2
    ALOAD 0
    CHECKCAST org/example/OuterClass
    LDC &quot;counter&quot;
    INVOKEINTERFACE groovy/lang/GroovyObject.getProperty (Ljava/lang/String;)Ljava/lang/Object; (itf)
    DUP
    ASTORE 2
    INVOKESTATIC org/codehaus/groovy/runtime/typehandling/DefaultTypeTransformation.intUnbox (Ljava/lang/Object;)I
    ICONST_1
    IADD
    DUP
    INVOKESTATIC java/lang/Integer.valueOf (I)Ljava/lang/Integer;
    LDC Lorg/example/OuterClass$_call_closure1;.class
    ALOAD 0
    LDC &quot;counter&quot;
    CHECKCAST java/lang/String
    INVOKESTATIC org/codehaus/groovy/runtime/ScriptBytecodeAdapter.setGroovyObjectProperty (Ljava/lang/Object;Ljava/lang/Class;Lgroovy/lang/GroovyObject;Ljava/lang/String;)V
    POP
    ALOAD 2
    POP
   L3
    LINENUMBER 16 L3
    ALOAD 1
    INVOKESTATIC org/example/OuterClass.printClass (Ljava/lang/String;)V
    ACONST_NULL
    ARETURN
   L4
   FRAME FULL [] [java/lang/Throwable]
    NOP
    ATHROW
    LOCALVARIABLE this Lorg/example/OuterClass$_call_closure1; L0 L4 0
    LOCALVARIABLE closureClassName Ljava/lang/String; L1 L4 1
    MAXSTACK = 5
    MAXLOCALS = 3

  // access flags 0x1004
  protected synthetic $getStaticMetaClass()Lgroovy/lang/MetaClass;
    ALOAD 0
    INVOKEVIRTUAL java/lang/Object.getClass ()Ljava/lang/Class;
    LDC Lorg/example/OuterClass$_call_closure1;.class
    IF_ACMPEQ L0
    ALOAD 0
    INVOKESTATIC org/codehaus/groovy/runtime/ScriptBytecodeAdapter.initMetaClass (Ljava/lang/Object;)Lgroovy/lang/MetaClass;
    ARETURN
   L0
   FRAME FULL [org/example/OuterClass$_call_closure1] []
    GETSTATIC org/example/OuterClass$_call_closure1.$staticClassInfo : Lorg/codehaus/groovy/reflection/ClassInfo;
    ASTORE 1
    ALOAD 1
    IFNONNULL L1
    ALOAD 0
    INVOKEVIRTUAL java/lang/Object.getClass ()Ljava/lang/Class;
    INVOKESTATIC org/codehaus/groovy/reflection/ClassInfo.getClassInfo (Ljava/lang/Class;)Lorg/codehaus/groovy/reflection/ClassInfo;
    DUP
    ASTORE 1
    PUTSTATIC org/example/OuterClass$_call_closure1.$staticClassInfo : Lorg/codehaus/groovy/reflection/ClassInfo;
   L1
   FRAME FULL [org/example/OuterClass$_call_closure1 org/codehaus/groovy/reflection/ClassInfo] []
    ALOAD 1
    INVOKEVIRTUAL org/codehaus/groovy/reflection/ClassInfo.getMetaClass ()Lgroovy/lang/MetaClass;
    ARETURN
    MAXSTACK = 2
    MAXLOCALS = 2
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;panel&quot; style=&quot;border-color: green;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-color: green;&quot;&gt;&lt;b&gt;Groovy 2.5.9&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/check.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Compilation OK&lt;br/&gt;
&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/check.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; No runtime exception&lt;/p&gt;

&lt;p&gt;Disassembled view of the closure&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;// class version 55.0 (55)
// access flags 0x31
public final class org/example/OuterClass$_call_closure1 extends groovy/lang/Closure implements org/codehaus/groovy/runtime/GeneratedClosure {

  // compiled from: OuterClass.groovy
  OUTERCLASS org/example/OuterClass call ()V
  // access flags 0x11
  public final INNERCLASS org/example/OuterClass$_call_closure1 null _call_closure1

  // access flags 0x100A
  private static synthetic Lorg/codehaus/groovy/reflection/ClassInfo; $staticClassInfo

  // access flags 0x1089
  public static transient synthetic Z __$stMC

  // access flags 0x1
  public &amp;lt;init&amp;gt;(Ljava/lang/Object;Ljava/lang/Object;)V
   L0
    ALOAD 0
    ALOAD 1
    ALOAD 2
    INVOKESPECIAL groovy/lang/Closure.&amp;lt;init&amp;gt; (Ljava/lang/Object;Ljava/lang/Object;)V
   L1
    RETURN
    LOCALVARIABLE this Lorg/example/OuterClass$_call_closure1; L0 L1 0
    LOCALVARIABLE _outerInstance Ljava/lang/Object; L0 L1 1
    LOCALVARIABLE _thisObject Ljava/lang/Object; L0 L1 2
    MAXSTACK = 3
    MAXLOCALS = 3

  // access flags 0x1
  public doCall()Ljava/lang/Object;
   L0
    LINENUMBER 13 L0
    NEW java/lang/Throwable
    DUP
    INVOKESPECIAL java/lang/Throwable.&amp;lt;init&amp;gt; ()V
    INVOKEVIRTUAL java/lang/Throwable.getStackTrace ()[Ljava/lang/StackTraceElement;
    ICONST_0
    INVOKESTATIC org/codehaus/groovy/runtime/BytecodeInterface8.objectArrayGet ([Ljava/lang/Object;I)Ljava/lang/Object;
    CHECKCAST java/lang/StackTraceElement
    INVOKEVIRTUAL java/lang/StackTraceElement.getClassName ()Ljava/lang/String;
    ASTORE 1
   L1
    ALOAD 1
    POP
   L2
    LINENUMBER 14 L2
    ALOAD 0
    INVOKEVIRTUAL groovy/lang/Closure.getThisObject ()Ljava/lang/Object;
    CHECKCAST org/example/OuterClass
    INVOKESTATIC org/example/OuterClass.pfaccess$0 (Lorg/example/OuterClass;)I
    DUP
    ISTORE 2
    ICONST_1
    IADD
    DUP
    INVOKESTATIC java/lang/Integer.valueOf (I)Ljava/lang/Integer;
    LDC Lorg/example/OuterClass$_call_closure1;.class
    ALOAD 0
    LDC &quot;counter&quot;
    CHECKCAST java/lang/String
    INVOKESTATIC org/codehaus/groovy/runtime/ScriptBytecodeAdapter.setGroovyObjectProperty (Ljava/lang/Object;Ljava/lang/Class;Lgroovy/lang/GroovyObject;Ljava/lang/String;)V
    POP
    ILOAD 2
    POP
   L3
    LINENUMBER 16 L3
    ALOAD 1
    INVOKESTATIC org/example/OuterClass.printClass (Ljava/lang/String;)V
    ACONST_NULL
    ARETURN
   L4
   FRAME FULL [] [java/lang/Throwable]
    NOP
    ATHROW
    LOCALVARIABLE this Lorg/example/OuterClass$_call_closure1; L0 L4 0
    LOCALVARIABLE closureClassName Ljava/lang/String; L1 L4 1
    MAXSTACK = 5
    MAXLOCALS = 3

  // access flags 0x1004
  protected synthetic $getStaticMetaClass()Lgroovy/lang/MetaClass;
    ALOAD 0
    INVOKEVIRTUAL java/lang/Object.getClass ()Ljava/lang/Class;
    LDC Lorg/example/OuterClass$_call_closure1;.class
    IF_ACMPEQ L0
    ALOAD 0
    INVOKESTATIC org/codehaus/groovy/runtime/ScriptBytecodeAdapter.initMetaClass (Ljava/lang/Object;)Lgroovy/lang/MetaClass;
    ARETURN
   L0
   FRAME FULL [org/example/OuterClass$_call_closure1] []
    GETSTATIC org/example/OuterClass$_call_closure1.$staticClassInfo : Lorg/codehaus/groovy/reflection/ClassInfo;
    ASTORE 1
    ALOAD 1
    IFNONNULL L1
    ALOAD 0
    INVOKEVIRTUAL java/lang/Object.getClass ()Ljava/lang/Class;
    INVOKESTATIC org/codehaus/groovy/reflection/ClassInfo.getClassInfo (Ljava/lang/Class;)Lorg/codehaus/groovy/reflection/ClassInfo;
    DUP
    ASTORE 1
    PUTSTATIC org/example/OuterClass$_call_closure1.$staticClassInfo : Lorg/codehaus/groovy/reflection/ClassInfo;
   L1
   FRAME FULL [org/example/OuterClass$_call_closure1 org/codehaus/groovy/reflection/ClassInfo] []
    ALOAD 1
    INVOKEVIRTUAL org/codehaus/groovy/reflection/ClassInfo.getMetaClass ()Lgroovy/lang/MetaClass;
    ARETURN
    MAXSTACK = 2
    MAXLOCALS = 2
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;It seems the call to &lt;tt&gt;getThisObject&lt;/tt&gt; is missing (not sure whether Groovy 3 expects that part to change):&lt;/p&gt;

&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Groovy 3.0.0-rc-3&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    LINENUMBER 14 L2
    ALOAD 0
    CHECKCAST org/example/OuterClass
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Groovy 2.5.9&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    LINENUMBER 14 L2
    ALOAD 0
    INVOKEVIRTUAL groovy/lang/Closure.getThisObject ()Ljava/lang/Object;
    CHECKCAST org/example/OuterClass
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>openjdk version &amp;quot;11.0.5&amp;quot; 2019-10-15 LTS&lt;br/&gt;
OpenJDK Runtime Environment Zulu11.35+15-CA (build 11.0.5+10-LTS)&lt;br/&gt;
OpenJDK 64-Bit Server VM Zulu11.35+15-CA (build 11.0.5+10-LTS, mixed mode)&lt;br/&gt;
Gradle 6.1.1&lt;br/&gt;
Windows 10&lt;br/&gt;
JAVA_TOOL_OPTIONS: &amp;quot;-XX:+UsePerfData&amp;quot; &amp;quot;-Duser.language=en&amp;quot; &amp;quot;-Duser.country=US&amp;quot; &amp;quot;-Duser.timezone=UTC&amp;quot; &amp;quot;-Dfile.encoding=UTF-8&amp;quot;&lt;br/&gt;
ASM 7.3.1</environment>
        <key id="13283486">GROOVY-9385</key>
            <summary>Access to outer class private field from closure leads to ClassCastException (@CompileStatic)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="chuong_f">Fr&#233;d&#233;ric Chuong</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Feb 2020 13:53:24 +0000</created>
                <updated>Thu, 24 Feb 2022 19:37:55 +0000</updated>
                            <resolved>Wed, 12 Feb 2020 17:19:11 +0000</resolved>
                                    <version>3.0.0-rc-3</version>
                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                    <fixVersion>3.0.1</fixVersion>
                    <fixVersion>2.5.16</fixVersion>
                                    <component>Static compilation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="17030781" author="emilles" created="Wed, 5 Feb 2020 16:28:22 +0000"  >&lt;p&gt;Groovy 3 sees &lt;tt&gt;counter++&lt;/tt&gt; as a private field mutation due to changes in &lt;tt&gt;StaticTypeCheckingVisitor#visitPrefixOrPostifExpression&lt;/tt&gt;.  If &lt;tt&gt;counter&amp;#43;&amp;#43;&lt;/tt&gt; is changed to &lt;tt&gt;counter += 1&lt;/tt&gt; in the sample code, the ClassCastException is thrown at runtime for Groovy 2.5.9 as well.&lt;/p&gt;

&lt;p&gt;I will try to understand why access and mutation get different behavior as &lt;tt&gt;counter &amp;#43;= 1&lt;/tt&gt; and &lt;tt&gt;counter&amp;#43;&amp;#43;&lt;/tt&gt; should both work as expected.&lt;/p&gt;</comment>
                            <comment id="17030866" author="emilles" created="Wed, 5 Feb 2020 17:48:49 +0000"  >&lt;p&gt;If you need to continue testing/using Groovy 3, you can rewrite &quot;counter+&amp;#43;&quot; as &quot;counter = counter + 1&quot; until this bug is fixed.&lt;/p&gt;</comment>
                            <comment id="17030923" author="emilles" created="Wed, 5 Feb 2020 19:04:54 +0000"  >&lt;p&gt;I can see a few possible approaches to fixing this issue.  &quot;counter+&amp;#43;&quot; and &quot;counter += 1&quot; are two examples of an expression where there is both read and write on the same target.  &lt;tt&gt;StaticTypeCheckingVisitor#checkOrMarkPrivateAccess&lt;/tt&gt; chooses either read or write based on the context.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;We could also add read metadata when a write is detected.  This would cover compound assignment.&lt;/li&gt;
	&lt;li&gt;We could visit the target expression &quot;counter&quot; as both an access and a mutation.  This is a bit higher level but has the effect of adding both sets of metadata.&lt;/li&gt;
	&lt;li&gt;We could check for field mutation metadata in makeGetPrivateFieldWithBridgeMethod if no access metadata is found.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The decomposed expression &quot;counter = counter + 1&quot; has separate visits for read and write, since there are two expressions in the AST.&lt;/p&gt;

&lt;p&gt;Update: The third approach will not work because the method saved in metadata is for writing, not reading the field.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 40 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0b6nk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>