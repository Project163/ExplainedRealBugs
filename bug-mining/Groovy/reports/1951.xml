<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:29:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-5706] JSR 223 invokeFunction broken in 2.0.2 - regression</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-5706</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The below script works in Groovy 2.0.1 and earlier but stopped working in Groovy 2.0.2.  I invoke a global glosure named &quot;helloWorld&quot;.  I use two different strings named &quot;helloWorld&quot;.  Sometimes this works, sometimes this fails.&lt;/p&gt;

&lt;p&gt;I suspect the problem is in GroovyScriptEngineImpl.  The globalClosures map was changed in 2.0.2.  It is no longer a java.util.Map but is some other map (ManagedConcurrentMap).  I suspect it may be a problem with the map using System.identityHashCode() is its mechanism for looking up Closures.  Obviously, any string named &quot;helloWorld&quot; should work here.&lt;/p&gt;

&lt;p&gt;SEVERITY:&lt;br/&gt;
This problem causes breakage in real applications that use JSR 223 API for Groovy and other script engines.  A user would need to roll back to 2.0.1.&lt;/p&gt;


&lt;p&gt;EXAMPLE:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.script.Compilable;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.script.CompiledScript;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.script.Invocable;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.script.ScriptEngine;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.script.ScriptEngineManager;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;HelloWorld {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; script = &lt;span class=&quot;code-quote&quot;&gt;&quot;void helloWorld() { println \&quot;&lt;/span&gt;Hello World\&lt;span class=&quot;code-quote&quot;&gt;&quot; }&quot;&lt;/span&gt;;
        ScriptEngineManager factory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ScriptEngineManager();
        ScriptEngine engine = factory.getEngineByName(&lt;span class=&quot;code-quote&quot;&gt;&quot;groovy&quot;&lt;/span&gt;);
        CompiledScript compiled = ((Compilable) engine).compile(script);
        compiled.eval();
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name = &lt;span class=&quot;code-quote&quot;&gt;&quot;helloWorld&quot;&lt;/span&gt;;
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;(name.toCharArray());
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!name.equals(name2)) {
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;should be equal!&quot;&lt;/span&gt;);
        }
        ((Invocable) engine).invokeFunction(name);   &lt;span class=&quot;code-comment&quot;&gt;// works
&lt;/span&gt;        ((Invocable) engine).invokeFunction(name);   &lt;span class=&quot;code-comment&quot;&gt;// still works
&lt;/span&gt;        ((Invocable) engine).invokeFunction(name2);  &lt;span class=&quot;code-comment&quot;&gt;// fails since Groovy 2.0.2
&lt;/span&gt;    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>Reproduced with Java 6 and Java 7.</environment>
        <key id="12818189">GROOVY-5706</key>
            <summary>JSR 223 invokeFunction broken in 2.0.2 - regression</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="benken_parasoft">Joseph Benken</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Sep 2012 19:01:13 +0000</created>
                <updated>Tue, 27 Nov 2012 03:54:36 +0000</updated>
                            <resolved>Mon, 17 Sep 2012 09:43:35 +0000</resolved>
                                    <version>2.0.2</version>
                                    <fixVersion>2.0.4</fixVersion>
                    <fixVersion>1.8.9</fixVersion>
                                    <component>GroovyScriptEngine</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14473343" author="blackdrag" created="Mon, 17 Sep 2012 09:43:35 +0000"  >&lt;p&gt;This has now been fixed. Thanks for the early catch and the very good analysis of the issue.&lt;/p&gt;</comment>
                            <comment id="14473535" author="dnie" created="Fri, 23 Nov 2012 00:35:07 +0000"  >&lt;p&gt;This Bug has &lt;b&gt;not&lt;/b&gt; been fixed in groovy-&lt;b&gt;all&lt;/b&gt; 2.0.5&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;dependency&amp;gt;
	&amp;lt;groupId&amp;gt;org.codehaus.groovy&amp;lt;/groupId&amp;gt;
	&amp;lt;artifactId&amp;gt;groovy-all&amp;lt;/artifactId&amp;gt;
	&amp;lt;version&amp;gt;2.0.5&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(groovy-jsr223 2.0.5 itself works fine)&lt;/p&gt;</comment>
                            <comment id="14473433" author="blackdrag" created="Fri, 23 Nov 2012 07:39:33 +0000"  >&lt;p&gt;Dirk, you mean the example above does not work in 2.0.5 for you if you use groovy-all, and it does work if you use the 2.0.5 version of groovy-jsr223?&lt;/p&gt;</comment>
                            <comment id="14473524" author="dnie" created="Tue, 27 Nov 2012 01:44:43 +0000"  >&lt;p&gt;Thanks for responding so fast&lt;/p&gt;

&lt;p&gt;We have automated Integration Tests for our Product, which always succeeded with groovy-all 2.0.0. After updating to 2.0.5, our Integration-Tests  showing a similar bug described in this issue. &lt;br/&gt;
The Stacktrace is&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Stacktrace&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.NoSuchMethodException: No signature of method: org.codehaus.groovy.jsr223.GroovyScriptEngineImpl.loadData() is applicable &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; argument types: (com.dvelop.forms.script.facade.FSInputFacade) values: [com.dvelop.forms.script.facade.FSInputFacade@12c08c7]
	at org.codehaus.groovy.jsr223.GroovyScriptEngineImpl.invokeImpl(GroovyScriptEngineImpl.java:383)
	at org.codehaus.groovy.jsr223.GroovyScriptEngineImpl.invokeFunction(GroovyScriptEngineImpl.java:179)
	at com.dvelop.forms.script.facade.FormsScriptFacade.invokeFunction(FormsScriptFacade.java:276)
	at com.dvelop.forms.model.server.datasource.script.FormsScriptInvoker.invokeMethod(FormsScriptInvoker.java:140)
	at com.dvelop.forms.model.server.datasource.script.ScriptDS.invokeScript(ScriptDS.java:246)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This happens not immediately. Out Integrations Tests consists of many invocation of many different Scripts in almost sequencial order. After some time, all Script invocations fail.&lt;br/&gt;
Our Scripts looks like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Script&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def loadData(def form){
   &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; something    	
&lt;/span&gt;   &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We are caching all instances of the ScriptEngine (GroovyScriptEngineImpl) and do many more than one invocations of the &quot;loadData&quot;-Method on the same instance of a ScriptEngine&lt;/p&gt;

&lt;p&gt;After some tests I have to revert that groovy-all-2.0.5 has still this issue compared to the groovy-jsr223-2.0.5&lt;br/&gt;
Unfortunately our roundtrip for Integration testing is very long. So testing takes some time. Until now, I made the following Tests:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;groovy-all&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Joseph&apos;s example&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;our Integration-Test&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.0.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;OK&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;OK&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.0.1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;OK&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;OK&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.0.2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Failed&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;not tested yet&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.0.3&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;OK&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Failed&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.0.4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;OK&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;not tested yet&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.0.5&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;OK&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Failed&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Right now I am not able to debug this error, since I am not able to reproduce it outside of our automated Integration Tests on our Buildserver. All local Unit-Tests of the related package in our Product allways succeeded. But they do allways single invocations which I will fix today.&lt;br/&gt;
Do you need more information? Should I open an new Issue instead of using this one?&lt;/p&gt;</comment>
                            <comment id="14473476" author="blackdrag" created="Tue, 27 Nov 2012 03:54:36 +0000"  >&lt;p&gt;I think your issue is a different one, so a new issue would be good. But I am wondering if your problem is related to &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5786&quot; title=&quot;methods defined by one eval are &amp;#39;lost&amp;#39; over time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5786&quot;&gt;&lt;del&gt;GROOVY-5786&lt;/del&gt;&lt;/a&gt; which is caused by the fix of &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5187&quot; title=&quot;Groovy Script Engine creates new classes for each script and doesn&amp;#39;t get garbage collected&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5187&quot;&gt;&lt;del&gt;GROOVY-5187&lt;/del&gt;&lt;/a&gt;. The problem in &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5786&quot; title=&quot;methods defined by one eval are &amp;#39;lost&amp;#39; over time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5786&quot;&gt;&lt;del&gt;GROOVY-5786&lt;/del&gt;&lt;/a&gt; basically is, that added functions are lost over time due to garbage collection. The MissingMethodException above sounds like the added function is lost, so it might be the same issue. My problem is that without this I will get the problem in &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5187&quot; title=&quot;Groovy Script Engine creates new classes for each script and doesn&amp;#39;t get garbage collected&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5187&quot;&gt;&lt;del&gt;GROOVY-5187&lt;/del&gt;&lt;/a&gt;, meaning the engine will never remove any scripts and pollute memory. I asked in &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5786&quot; title=&quot;methods defined by one eval are &amp;#39;lost&amp;#39; over time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5786&quot;&gt;&lt;del&gt;GROOVY-5786&lt;/del&gt;&lt;/a&gt; how to decide between those, but I got no answer so far. Normally I would add an option or method or something alike to the engine and let the user control this. But unfortunately I don&apos;t see how JSR 223 allows for such interaction. Do you have any idea?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2br2n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>