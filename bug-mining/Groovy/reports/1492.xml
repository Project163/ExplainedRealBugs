<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:19:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-4831] New line character is not escaped in attribute when using MarkupBuilder</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-4831</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;For example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.xml.*
def xml = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MarkupBuilder()
xml.test(a:&lt;span class=&quot;code-quote&quot;&gt;&quot;hello\nworld&quot;&lt;/span&gt;){}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;produces output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&amp;lt;test a=&apos;hello
world&apos; /&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But xml specification says that when parsing, new lines in attribute value should be converted to single space. So they are not preserved.&lt;/p&gt;

&lt;p&gt;I suggest this new method implementation (sorry that I don&apos;t provide real .patch):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; checkForReplacement(&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isAttrValue, &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt; ch) {
        &lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt; (ch) {
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;&amp;amp;&apos;&lt;/span&gt;:
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;amp;amp;&quot;&lt;/span&gt;;
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;&amp;lt;&apos;&lt;/span&gt;:
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;amp;lt;&quot;&lt;/span&gt;;
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;&amp;gt;&apos;&lt;/span&gt;:
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;amp;gt;&quot;&lt;/span&gt;;
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&apos;&lt;/span&gt;:
                &lt;span class=&quot;code-comment&quot;&gt;// The &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; quote is only escaped &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the value is &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// an attribute and the builder is configured to output
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// attribute values inside &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; quotes.
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isAttrValue &amp;amp;&amp;amp; useDoubleQuotes) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;amp;quot;&quot;&lt;/span&gt;;
                &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;\&apos;&lt;/span&gt;&apos;:
                &lt;span class=&quot;code-comment&quot;&gt;// The apostrophe is only escaped &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the value is &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; an
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// attribute, as opposed to element content, and &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// builder is configured to surround attribute values with
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// single quotes.
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isAttrValue &amp;amp;&amp;amp; !useDoubleQuotes) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;amp;apos;&quot;&lt;/span&gt;;
                &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;\n&apos;&lt;/span&gt;:
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(isAttrValue) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;amp;#10;&quot;&lt;/span&gt;;
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;\r&apos;&lt;/span&gt;:
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(isAttrValue) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;amp;#13;&quot;&lt;/span&gt;;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12815677">GROOVY-4831</key>
            <summary>New line character is not escaped in attribute when using MarkupBuilder</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="jakub.neubauer">Jakub Neubauer</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 May 2011 06:33:49 +0000</created>
                <updated>Thu, 21 Jul 2011 19:06:32 +0000</updated>
                            <resolved>Mon, 23 May 2011 17:12:32 +0000</resolved>
                                    <version>1.8.0</version>
                                    <fixVersion>1.8.1</fixVersion>
                                    <component>XML Processing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14471250" author="jakub.neubauer" created="Wed, 18 May 2011 06:39:41 +0000"  >&lt;p&gt;My previous comment was mangled, so I rather try to attach a patch.&lt;/p&gt;</comment>
                            <comment id="14471240" author="blackdrag" created="Wed, 18 May 2011 07:41:57 +0000"  >&lt;p&gt;But if you say the spec says &quot;new lines in attribute value should be converted to single space&quot; and then produce &amp;#10;, isn&apos;t that wrong? would you want to use &quot; &quot;?&lt;/p&gt;</comment>
                            <comment id="14471302" author="paulk" created="Thu, 19 May 2011 00:15:23 +0000"  >&lt;p&gt;Do you have a link to the relevant part of the spec?&lt;/p&gt;</comment>
                            <comment id="14471260" author="jakub.neubauer" created="Thu, 19 May 2011 01:20:47 +0000"  >&lt;p&gt;The link to spec is: &lt;a href=&quot;http://www.w3.org/TR/xml/#AVNormalize&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.w3.org/TR/xml/#AVNormalize&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It says when parsing, white space characters #x20, #xD, #xA, #x9 should be converted to #x20 (space). Then, all leading and trailing spaces are removed and all sequences of spaces are merged to one space.&lt;/p&gt;

&lt;p&gt;So, now I see that my patch is not enough. The generator should also convert spaces and tabs to their escape sequences, assuming that attribute value should be preserved exactly as is after parsing it back.&lt;/p&gt;

&lt;p&gt;To Jochen: we probably didn&apos;t understand each other. The normalizing attribute value occurs in XML parser. I expect that generating xml and parsing it back should provide the same values. But if you generate XML with attribute value containing new line, parse it back, you get a space.&lt;/p&gt;</comment>
                            <comment id="14479537" author="paulk" created="Thu, 19 May 2011 06:23:40 +0000"  >&lt;p&gt;Should be fixed in trunk. I ended up using a slightly tweaked version of your patch. If you can try both &lt;tt&gt;MarkupBuilder&lt;/tt&gt; and &lt;tt&gt;StreamingMarkupBuilder&lt;/tt&gt; using one of the CI server produced snapshots, that would be great. Thanks for spotting the problem.&lt;/p&gt;</comment>
                            <comment id="14471306" author="jakub.neubauer" created="Fri, 20 May 2011 02:51:26 +0000"  >&lt;p&gt;Sorry, but in later comment I stated that TAB and SPACE characters should be escaped too (&apos;\t&apos; -&amp;gt; &quot;&amp;amp;&amp;#35;9;&quot; and &apos; &apos; -&amp;gt; &quot;&amp;amp;&amp;#35;32&quot;). For the same reasons as \n and \r.&lt;/p&gt;</comment>
                            <comment id="14471286" author="paulk" created="Fri, 20 May 2011 05:53:24 +0000"  >&lt;p&gt;I am wondering whether I am totally following what you would like. Are you wanting the first or second line:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;\t -&amp;gt; &amp;amp;#9;
\t -&amp;gt; &amp;amp;amp;#9;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;because I am wondering whether even the earlier changes are want you wanted?&lt;/p&gt;</comment>
                            <comment id="14471168" author="jakub.neubauer" created="Fri, 20 May 2011 06:12:35 +0000"  >&lt;p&gt;The first line is what I meant, and similarly for SPACE. To be sure, I attach a code snippet from MarkupBuilder.java, it is most precise after all &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14471231" author="paulk" created="Fri, 20 May 2011 07:19:04 +0000"  >&lt;p&gt;That is what you said before - I would be worried about us producing &quot;non-standard&quot; looking XML. Can you elaborate a bit more on what kind of round-tripping you are trying to enable?&lt;/p&gt;</comment>
                            <comment id="14471251" author="jakub.neubauer" created="Mon, 23 May 2011 02:17:11 +0000"  >&lt;p&gt;Hello, I went through the spec again (few times) and tried another libraries(Java DOM, Transformer, SAX Parser). I realized that I made mistake concerning a SPACE character. It can be produced as is. I was mistaken by this part of spec:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If the attribute type is not CDATA, then the XML processor MUST further process the normalized attribute value by discarding any leading and trailing space (#x20) characters, and by replacing sequences of space (#x20) characters by a single space (#x20) character.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But, 2 paragraphs later:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;All attributes for which no declaration has been read SHOULD be treated by a non-validating processor as if declared CDATA.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So, SPACES don&apos;t need to be produced as escape sequences. I tried groovy.xml.XMLParser and it keeps them as they are.&lt;/p&gt;

&lt;p&gt;So, only TAB character should be escaped. This is test, which should pass:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.xml.*

doTest(&lt;span class=&quot;code-quote&quot;&gt;&quot;  hello  world  &quot;&lt;/span&gt;) &lt;span class=&quot;code-comment&quot;&gt;//  (1)
&lt;/span&gt;doTest(&lt;span class=&quot;code-quote&quot;&gt;&quot;hello\nworld&quot;&lt;/span&gt;)     &lt;span class=&quot;code-comment&quot;&gt;//  (2)
&lt;/span&gt;doTest(&lt;span class=&quot;code-quote&quot;&gt;&quot;hello\rworld&quot;&lt;/span&gt;)     &lt;span class=&quot;code-comment&quot;&gt;//  (3)
&lt;/span&gt;doTest(&lt;span class=&quot;code-quote&quot;&gt;&quot;hello\tworld&quot;&lt;/span&gt;)     &lt;span class=&quot;code-comment&quot;&gt;//  (4)
&lt;/span&gt;
def doTest(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value) {
  StringWriter w = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringWriter()
  &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MarkupBuilder(w).root(a:value)
  xml2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; XmlParser().parseText(w.toString())
  &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; value == xml2.@a
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Original version fails in parts (2), (3) and (4), after your changes it still fails in part (4). The part (1) passes, which is confirmation of what I said in this comment.&lt;/p&gt;</comment>
                            <comment id="14479539" author="paulk" created="Mon, 23 May 2011 17:12:32 +0000"  >&lt;p&gt;Tab is now escaped too. Thanks for all the feedback and information.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722807" name="MarkupBuilder.java.patch" size="500" author="jakub.neubauer" created="Wed, 18 May 2011 06:39:41 +0000"/>
                            <attachment id="12722808" name="repair.txt" size="1354" author="jakub.neubauer" created="Fri, 20 May 2011 06:12:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c3hj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>