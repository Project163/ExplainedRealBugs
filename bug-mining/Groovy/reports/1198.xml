<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:15:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-4010] XmlParser wraps nested elements in extra ArrayList</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-4010</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;When using XmlParser we are experienceing different behaviour within Grails 1.2 than directly using Groovy 1.6.7. The issue manifests itself when accessing nested elements in a document.&lt;/p&gt;

&lt;p&gt;example, this works fine from within GroovyConsole 1.6.7:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def XML = &apos;&apos;&apos;&amp;lt;channel&amp;gt;
  &amp;lt;item id=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;/&amp;gt;
  &amp;lt;item id=&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;/&amp;gt;
  &amp;lt;item id=&lt;span class=&quot;code-quote&quot;&gt;&quot;3&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;/channel&amp;gt;&apos;&apos;&apos;
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; 3 == &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; XmlParser().parseText(XML).item.size()
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; 3 == &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; XmlParser().parseText(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;rss&amp;gt;$XML&amp;lt;/rss&amp;gt;&quot;&lt;/span&gt;).channel.item.size()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here is a test case that passed under Grails 1.1.1 but fails under 1.2:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;XMLUnitTests &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; GroovyTestCase {
    def XML = &apos;&apos;&apos;
        &amp;lt;channel&amp;gt;
          &amp;lt;item id=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;/&amp;gt;
          &amp;lt;item id=&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;/&amp;gt;
          &amp;lt;item id=&lt;span class=&quot;code-quote&quot;&gt;&quot;3&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;/channel&amp;gt;
    &apos;&apos;&apos;

    void testOneLevel() {
        def records = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; XmlParser().parseText(XML)
        assertEquals 3, records.item.size()
    }

    void testTwoLevels() {
        def records = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; XmlParser().parseText(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;rss&amp;gt;$XML&amp;lt;/rss&amp;gt;&quot;&lt;/span&gt;)
        assertEquals 3, records.channel.item.size()
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment>Grails 1.2, Groovy 1.6.7</environment>
        <key id="12815014">GROOVY-4010</key>
            <summary>XmlParser wraps nested elements in extra ArrayList</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="james.cookie">James Cook</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Jan 2010 04:34:49 +0000</created>
                <updated>Fri, 19 Feb 2010 07:12:05 +0000</updated>
                            <resolved>Fri, 19 Feb 2010 07:12:05 +0000</resolved>
                                    <version>1.6.7</version>
                                    <fixVersion>1.6.8</fixVersion>
                    <fixVersion>1.7.1</fixVersion>
                                        <due></due>
                            <votes>6</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14468553" author="james.cookie" created="Tue, 5 Jan 2010 04:38:14 +0000"  >&lt;p&gt;Note:&lt;br/&gt;
The test case above works in Intellij, it only fails when using &apos;grails test-app&apos;&lt;/p&gt;

&lt;p&gt;Workaround:&lt;br/&gt;
Flatten the list to make the test pass i.e.: assertEquals 3, records.channel.item.flatten().size()&lt;/p&gt;


</comment>
                            <comment id="14468601" author="kaaloo" created="Tue, 5 Jan 2010 06:06:22 +0000"  >&lt;p&gt;Oh I&apos;m glad you posted this, I ran into this one last night.&lt;/p&gt;</comment>
                            <comment id="14468542" author="ttop" created="Wed, 6 Jan 2010 19:01:29 +0000"  >&lt;p&gt;I&apos;m also seeing some XmlParser weirdness, see GRAILS-5670.&lt;/p&gt;</comment>
                            <comment id="14468818" author="graemerocher" created="Mon, 25 Jan 2010 08:03:35 +0000"  >&lt;p&gt;I have stepped debugged into Grails code and Grails is doing nothing special with Groovy&apos;s XmlParser. It seems to me to be a callsite caching bug, which would explain why the examples pass for trivial cases but not for Grails (because callsite caching hasn&apos;t kicked in yet for the trivial case, but has when running inside of Grails).&lt;/p&gt;

&lt;p&gt;In the meantime, simply replacing &quot;new XmlParser()&quot; with &quot;new XmlSlurper()&quot; makes the example test case pass and I recommend folks use XmlSlurper until this bug is fixed in Groovy&lt;/p&gt;</comment>
                            <comment id="14468842" author="msmolyak" created="Mon, 25 Jan 2010 09:56:22 +0000"  >&lt;p&gt;Graeme,&lt;/p&gt;

&lt;p&gt;We cannot use XmlSlurper, since we are taking an existing DOM, parsing it and modifying it at the same time. As far as I know, XmlSlurper is read-only.&lt;/p&gt;

&lt;p&gt;Could you provide a reference explaining what callsite caching is?&lt;/p&gt;

&lt;p&gt;Thank you,&lt;/p&gt;

&lt;p&gt;Michael &lt;/p&gt;</comment>
                            <comment id="14468855" author="graemerocher" created="Mon, 25 Jan 2010 10:22:13 +0000"  >&lt;p&gt;XmlSlurper allows modifications. Grails&apos; doWithWebDescriptor plugin hook uses XmlSlurper to allow users to modify web.xml&lt;/p&gt;

&lt;p&gt;Callsite caching is a Groovy language feature that increases performance by caching &quot;call sites&quot;, which are basically dynamic paths to a method call. This allows these call sites to be inlined by the JIT. Unfortunately from my investigations there appears to be a bug somewhere at the language level.&lt;/p&gt;</comment>
                            <comment id="14468819" author="guillaume" created="Wed, 27 Jan 2010 08:11:21 +0000"  >&lt;p&gt;Attaching a simple sample Grails app exhibiting the issue with Grails 1.2.0.&lt;br/&gt;
Running grails test-app will launch the failing test case.&lt;br/&gt;
Although that test case works in GroovyConsole as is.&lt;/p&gt;</comment>
                            <comment id="14468857" author="blackdrag" created="Wed, 27 Jan 2010 10:51:01 +0000"  >&lt;p&gt;testTwoLevels fails even without testOneLevel being available. This is for me a sign, that it is probably no call site caching bug.&lt;/p&gt;</comment>
                            <comment id="14468843" author="blackdrag" created="Wed, 27 Jan 2010 11:38:37 +0000"  >&lt;p&gt;NodeList sets its own MetaClass, which defines a getAttribute(Object, String) method, wich returns an ArrayList. It defines also an getProperty(Object, String) method. NodeList itself defines also a getAt(String).&lt;/p&gt;

&lt;p&gt;Now this getAt method is the only one, that returns the desired NodeList. If the ExpandoMetaClass is active, this is no longer the case&lt;/p&gt;</comment>
                            <comment id="14468682" author="blackdrag" created="Wed, 27 Jan 2010 11:39:31 +0000"  >&lt;p&gt;Meaning that in pure Groovy the test fails too if ExpandoMetaClass.enableGlobally() is executed first&lt;/p&gt;</comment>
                            <comment id="14468775" author="blackdrag" created="Wed, 27 Jan 2010 12:03:47 +0000"  >&lt;p&gt;From what I can see he problem originates from ClassInfo#getMetaClassUnderLock. This is supposed to return a MetaClass, if ExpandoMetaClass is enabled globally, then this checks if the returned metaclass is a ExpandoMetaClass and if that is the case, it returns this meta class. If that is not the case, then this method will return a new meta class. This is obivously wrong here, since we need that NodeList meta class or else it won&apos;t work.&lt;/p&gt;</comment>
                            <comment id="14468785" author="blackdrag" created="Wed, 27 Jan 2010 15:30:21 +0000"  >&lt;p&gt;Looks like I have a fix for the part related to EMC, but in a testcase this still fails. And there it fails with and without EMC even&lt;/p&gt;</comment>
                            <comment id="14468801" author="blackdrag" created="Thu, 28 Jan 2010 09:19:16 +0000"  >&lt;p&gt;I committed a patch to the 1_6_X branch. It would be good if someone could verify that this patch does not do anyting bad and if it fixes the problem at hand. &lt;/p&gt;</comment>
                            <comment id="14468790" author="graemerocher" created="Mon, 1 Feb 2010 02:36:55 +0000"  >&lt;p&gt;thanks Jochen I will verify that it works against Grails 1.2.x branch.&lt;/p&gt;</comment>
                            <comment id="14468918" author="blackdrag" created="Fri, 19 Feb 2010 07:12:05 +0000"  >&lt;p&gt;until further notice I will close this issue as fixed. The patch has been applied to 1.7 and 1.8 as well.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722550" name="xmlparserissue-bug-report-27012010.zip" size="18947" author="guillaume" created="Wed, 27 Jan 2010 08:11:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 40 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ci07:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>