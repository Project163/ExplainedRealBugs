<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:18:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-10598] BUG! exception in phase &apos;instruction selection&apos; unexpected NullPointerException</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-10598</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I am getting this in my gradle build after upgrading Gradle to 6.9.2 and Grails to&#160;&lt;/p&gt;

&lt;p&gt;classpath &quot;org.grails:grails-gradle-plugin:5.1.4&quot;&lt;/p&gt;

&lt;p&gt;implementation &apos;org.grails:grails-dependencies:5.1.7&apos;&lt;br/&gt;
implementation &apos;org.grails:grails-web-boot:5.1.7&apos;&lt;/p&gt;

&lt;p&gt;implementation &apos;org.grails:grails-gradle-plugin:5.1.4&apos;&lt;br/&gt;
implementation &apos;org.grails:grails-core:5.1.7&apos;&lt;/p&gt;

&lt;p&gt;runtimeOnly &apos;org.grails.plugins:hibernate:4.3.10.7&apos;&lt;br/&gt;
implementation &apos;org.grails.plugins:spring-security-core:5.0.0&apos;&lt;br/&gt;
implementation group: &apos;org.grails.plugins&apos;, name: &apos;cache&apos;, version: &apos;5.0.1&apos;&lt;/p&gt;

&lt;p&gt;testImplementation &apos;org.grails:grails-plugin-testing:3.3.0.M2&apos;&lt;br/&gt;
testImplementation &apos;org.grails:grails-test-mixins:3.3.0&apos;&lt;br/&gt;
testImplementation group: &apos;org.grails.plugins&apos;, name: &apos;geb&apos;, version: &apos;2.0.0&apos;&lt;/p&gt;

&lt;p&gt;compileOnly &apos;org.grails:grails-console:5.1.7&apos;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;FAILURE: Build failed with an exception.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;What went wrong:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Execution failed for task &apos;:compileTestGroovy&apos;.&lt;/p&gt;

&lt;p&gt;&amp;gt; BUG! exception in phase &apos;instruction selection&apos; in source unit &apos;C:\SVNWorkspace\wholesaler-card-utility\src\test\groovy\com\moo\wholesaler\admin\AuditLoggingControllerSpec.groovy&apos; unexpected NullPointerException&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;When I try to use IntelliJ to debug the code so I can step in and find where it is giving this, it gives me the same failure without hitting a break point.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Any advice will be helpful.&lt;/p&gt;</description>
                <environment>Windows 10, Powershell, IntelliJ 2020.3</environment>
        <key id="13441879">GROOVY-10598</key>
            <summary>BUG! exception in phase &apos;instruction selection&apos; unexpected NullPointerException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="dgeiselman">Daniel Geiselman</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Apr 2022 17:55:52 +0000</created>
                <updated>Sun, 24 Jul 2022 12:16:53 +0000</updated>
                            <resolved>Sat, 30 Apr 2022 20:08:43 +0000</resolved>
                                    <version>5.x</version>
                                    <fixVersion>2.5.17</fixVersion>
                    <fixVersion>3.0.11</fixVersion>
                    <fixVersion>4.0.3</fixVersion>
                                    <component>groovy-jdk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17528433" author="emilles" created="Tue, 26 Apr 2022 22:14:31 +0000"  >&lt;p&gt;You can add this to your build.gradle:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
tasks.withType(GroovyCompile) {
  groovyOptions.fork = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then add &quot;-Dorg.gradle.debug=true&quot; to your gradle command line to have it wait for remote debugger on port 5005.  Then you can open a remote debug session from IntelliJ.  Easiest way to get a consistent break on NPE is to add an exception watchpoint.  Otherwise you need to be sure you have the source that matches your java executable so that the line number are aligned.&lt;/p&gt;</comment>
                            <comment id="17529406" author="JIRAUSER288682" created="Thu, 28 Apr 2022 12:27:09 +0000"  >&lt;p&gt;I am trying to debug this with IntelliJ with a breakpoint at the start of the unit test that is giving the instruction selection error.&#160; This error is happening on the build itself with groovy tests.&#160; &#160;Here is the error I got after the build.gradle update when I tried to debug the unit test in IntelliJ with breakpoints at all points of&#160; the test.&#160; It doesn&apos;t hit the breakpoints.&lt;/p&gt;

&lt;p&gt;Groovyc: While compiling &lt;span class=&quot;error&quot;&gt;&amp;#91;tests of wcu.test&amp;#93;&lt;/span&gt;: BUG! exception in phase &apos;instruction selection&apos; in source unit &apos;C:\SVNWorkspace\wholesaler-card-utility\src\test\groovy\com\moo\wholesaler\admin\AuditLoggingControllerSpec.groovy&apos; unexpected NullPointerException&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.control.CompilationUnit$IPrimaryClassNodeOperation.doPhaseOperation(CompilationUnit.java:947)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.control.CompilationUnit.processPhaseOperations(CompilationUnit.java:671)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:635)&lt;br/&gt;
&#160; &#160; at org.jetbrains.groovy.compiler.rt.GroovyCompilerWrapper.compile(GroovyCompilerWrapper.java:48)&lt;br/&gt;
&#160; &#160; at org.jetbrains.groovy.compiler.rt.DependentGroovycRunner.runGroovyc(DependentGroovycRunner.java:118)&lt;br/&gt;
&#160; &#160; at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
&#160; &#160; at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)&lt;br/&gt;
&#160; &#160; at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
&#160; &#160; at java.lang.reflect.Method.invoke(Method.java:498)&lt;br/&gt;
&#160; &#160; at org.jetbrains.groovy.compiler.rt.GroovycRunner.intMain2(GroovycRunner.java:81)&lt;br/&gt;
&#160; &#160; at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
&#160; &#160; at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)&lt;br/&gt;
&#160; &#160; at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
&#160; &#160; at java.lang.reflect.Method.invoke(Method.java:498)&lt;br/&gt;
&#160; &#160; at org.jetbrains.jps.incremental.groovy.InProcessGroovyc.runGroovycInThisProcess(InProcessGroovyc.java:167)&lt;br/&gt;
&#160; &#160; at org.jetbrains.jps.incremental.groovy.InProcessGroovyc.lambda$runGroovyc$0(InProcessGroovyc.java:77)&lt;br/&gt;
&#160; &#160; at java.util.concurrent.FutureTask.run(FutureTask.java:266)&lt;br/&gt;
&#160; &#160; at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)&lt;br/&gt;
&#160; &#160; at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)&lt;br/&gt;
&#160; &#160; at java.lang.Thread.run(Thread.java:748)&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.transform.trait.Traits.decomposeSuperCallName(Traits.java:271)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.transform.stc.TraitTypeCheckingExtension.handleMissingMethod(TraitTypeCheckingExtension.java:64)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.transform.stc.DefaultTypeCheckingExtension.handleMissingMethod(DefaultTypeCheckingExtension.java:114)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.transform.stc.StaticTypeCheckingVisitor.findMethodOrFail(StaticTypeCheckingVisitor.java:4507)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.transform.sc.StaticCompilationVisitor.findMethodOrFail(StaticCompilationVisitor.java:473)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.transform.stc.StaticTypeCheckingVisitor.getResultType(StaticTypeCheckingVisitor.java:4366)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.transform.stc.StaticTypeCheckingVisitor.visitBinaryExpression(StaticTypeCheckingVisitor.java:769)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.ast.CodeVisitorSupport.visitDeclarationExpression(CodeVisitorSupport.java:335)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitDeclarationExpression(ClassCodeVisitorSupport.java:150)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.ast.expr.DeclarationExpression.visit(DeclarationExpression.java:89)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.ast.CodeVisitorSupport.visitExpressionStatement(CodeVisitorSupport.java:117)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitExpressionStatement(ClassCodeVisitorSupport.java:200)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.transform.stc.StaticTypeCheckingVisitor.visitExpressionStatement(StaticTypeCheckingVisitor.java:2104)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.ast.stmt.ExpressionStatement.visit(ExpressionStatement.java:40)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.ast.CodeVisitorSupport.visitBlockStatement(CodeVisitorSupport.java:86)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitBlockStatement(ClassCodeVisitorSupport.java:164)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.transform.stc.StaticTypeCheckingVisitor.visitBlockStatement(StaticTypeCheckingVisitor.java:3909)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.ast.stmt.BlockStatement.visit(BlockStatement.java:69)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitClassCodeContainer(ClassCodeVisitorSupport.java:138)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitConstructorOrMethod(ClassCodeVisitorSupport.java:111)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.transform.stc.StaticTypeCheckingVisitor.visitConstructorOrMethod(StaticTypeCheckingVisitor.java:2093)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.ast.ClassCodeVisitorSupport.visitMethod(ClassCodeVisitorSupport.java:106)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.transform.stc.StaticTypeCheckingVisitor.startMethodInference(StaticTypeCheckingVisitor.java:2522)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.transform.stc.StaticTypeCheckingVisitor.visitMethod(StaticTypeCheckingVisitor.java:2480)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.transform.sc.StaticCompilationVisitor.visitMethod(StaticCompilationVisitor.java:236)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.transform.sc.StaticCompileTransformation.visit(StaticCompileTransformation.java:78)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.transform.ASTTransformationVisitor.visitClass(ASTTransformationVisitor.java:143)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.transform.ASTTransformationVisitor.lambda$addPhaseOperations$2(ASTTransformationVisitor.java:220)&lt;br/&gt;
&#160; &#160; at org.codehaus.groovy.control.CompilationUnit$IPrimaryClassNodeOperation.doPhaseOperation(CompilationUnit.java:942)&lt;br/&gt;
&#160; &#160; ... 19 more&lt;/p&gt;</comment>
                            <comment id="17530401" author="emilles" created="Sat, 30 Apr 2022 15:15:44 +0000"  >&lt;p&gt;I think what you have is a binary expression within a class that implements a trait and is either type-checked or statically compiled.  The operator is not one of these and so null is the method name returned:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; EQUAL:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; NOT_EQUAL:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; ELVIS_EQUAL:

            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; LOGICAL_AND:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; LOGICAL_OR:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; COMPARE_IDENTICAL:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; COMPARE_NOT_IDENTICAL:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; KEYWORD_INSTANCEOF:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; COMPARE_NOT_INSTANCEOF:

            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; COMPARE_EQUAL:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; COMPARE_NOT_EQUAL:

            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; COMPARE_TO:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; COMPARE_GREATER_THAN:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; COMPARE_GREATER_THAN_EQUAL:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; COMPARE_LESS_THAN:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; COMPARE_LESS_THAN_EQUAL:

            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; BITWISE_AND:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; BITWISE_AND_EQUAL:

            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; BITWISE_OR:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; BITWISE_OR_EQUAL:

            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; BITWISE_XOR:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; BITWISE_XOR_EQUAL:

            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; PLUS:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; PLUS_EQUAL:

            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; MINUS:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; MINUS_EQUAL:

            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; MULTIPLY:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; MULTIPLY_EQUAL:

            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; DIVIDE:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; DIVIDE_EQUAL:

            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; INTDIV:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; INTDIV_EQUAL:

            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; MOD:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; MOD_EQUAL:

            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; POWER:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; POWER_EQUAL:

            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; LEFT_SHIFT:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; LEFT_SHIFT_EQUAL:

            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; RIGHT_SHIFT:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; RIGHT_SHIFT_EQUAL:

            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; RIGHT_SHIFT_UNSIGNED:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; RIGHT_SHIFT_UNSIGNED_EQUAL:

            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; LEFT_SQUARE_BRACKET:

            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; FIND_REGEX:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; MATCH_REGEX:

            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; KEYWORD_IN:
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; COMPARE_NOT_IN:
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17530404" author="JIRAUSER288682" created="Sat, 30 Apr 2022 15:18:24 +0000"  >&lt;p&gt;No case statements and the values being looked for on the ifs are assigned in the Unit test.&#160; That was one of my first thoughts, so I went to debug in IntelliJ, but I can&apos;t hit the breakpoint at the beginning of the unit test.&lt;/p&gt;</comment>
                            <comment id="17530411" author="emilles" created="Sat, 30 Apr 2022 16:01:12 +0000"  >&lt;p&gt;The exception occurs during class generation, so you won&apos;t be able to run your unit test.  You would need to debug your compiler process.  Or you could provide the source for AuditLoggingControllerSpec so we could see what is in there.&lt;/p&gt;</comment>
                            <comment id="17530414" author="emilles" created="Sat, 30 Apr 2022 16:04:20 +0000"  >&lt;p&gt;The only gap I can see in the type-checked binary operators and the full set is logical-and-equals and logical-or-equals.  Not sure if you use one of those in your code or if maybe Spock creates one of those for a specific kind of assertion.&lt;/p&gt;</comment>
                            <comment id="17530418" author="emilles" created="Sat, 30 Apr 2022 16:17:14 +0000"  >&lt;p&gt;It is a declaration expression, if that helps.&lt;/p&gt;</comment>
                            <comment id="17530440" author="emilles" created="Sat, 30 Apr 2022 19:45:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/71f24d07b50bd26a420667542a6f84c521f70fd5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/71f24d07b50bd26a420667542a6f84c521f70fd5&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17530444" author="JIRAUSER288682" created="Sat, 30 Apr 2022 19:57:30 +0000"  >&lt;p&gt;The groovy file for the code&lt;/p&gt;

&lt;p&gt;package com.moo.wholesaler.admin&lt;br/&gt;
import com.moo.wholesaler.AuditSearchForm&lt;br/&gt;
import com.moo.wholesaler.util.AuditLog&lt;br/&gt;
import grails.gorm.DetachedCriteria&lt;br/&gt;
import org.springframework.security.access.annotation.Secured&lt;/p&gt;

&lt;p&gt;@Secured(&apos;ROLE_ADMIN&apos;)&lt;br/&gt;
class AuditLoggingController {&lt;/p&gt;

&lt;p&gt;static defaultAction = &quot;list&quot;&lt;/p&gt;

&lt;p&gt;def list(AuditSearchForm auditSearchForm) {&lt;br/&gt;
params.max = Math.min(params.long(&apos;max&apos;) ?: 50, 100)&lt;br/&gt;
params.order = params.order ?: &apos;desc&apos;&lt;br/&gt;
params.sort = params.sort ?: &apos;dateCreated&apos;&lt;/p&gt;

&lt;p&gt;DetachedCriteria searchCriteria = new DetachedCriteria(AuditLog).build {&lt;br/&gt;
and {&lt;br/&gt;
if (auditSearchForm.className) &lt;/p&gt;
{
eq &apos;className&apos;, auditSearchForm.className
}

&lt;p&gt;if (auditSearchForm.id) &lt;/p&gt;
{
eq &apos;persistedObjectId&apos;, auditSearchForm.id
}

&lt;p&gt;if (auditSearchForm.user) &lt;/p&gt;
{
eq &apos;actor&apos;, auditSearchForm.user
}

&lt;p&gt;if (auditSearchForm.date) &lt;/p&gt;
{
ge &apos;dateCreated&apos;, auditSearchForm.date
}
&lt;p&gt;}&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;List&amp;lt;AuditLog&amp;gt; audits = searchCriteria.list(params)&lt;/p&gt;

&lt;p&gt;render view: &apos;list&apos;, model: [&lt;br/&gt;
auditSearchForm: auditSearchForm,&lt;br/&gt;
reportData: audits,&lt;br/&gt;
reportDataTotal: searchCriteria.count()&lt;br/&gt;
]&lt;br/&gt;
}&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;The spec code&lt;/p&gt;

&lt;p&gt;package com.moo.wholesaler.admin&lt;/p&gt;

&lt;p&gt;import com.moo.wholesaler.AuditSearchForm&lt;br/&gt;
import com.moo.wholesaler.util.AuditLog&lt;br/&gt;
import grails.test.mixin.Mock&lt;br/&gt;
import grails.test.mixin.TestFor&lt;br/&gt;
import spock.lang.Specification&lt;/p&gt;

&lt;p&gt;/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Created by req86346 on 02/12/2016.&lt;br/&gt;
*/&lt;br/&gt;
@TestFor(AuditLoggingController)&lt;br/&gt;
@Mock(AuditLog)&lt;br/&gt;
class AuditLoggingControllerSpec extends Specification {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;void &quot;Do a Search&quot;() &lt;/p&gt;
{
given:
AuditSearchForm auditSearchForm =Mock(AuditSearchForm)

when:
controller.list(auditSearchForm)

then:
2* auditSearchForm.getClassName() &amp;gt;&amp;gt; &quot;TestClass&quot;
2* auditSearchForm.getUser()&amp;gt;&amp;gt; &apos;user&apos;
2* auditSearchForm.getId() &amp;gt;&amp;gt; 1
2* auditSearchForm.getDate() &amp;gt;&amp;gt; new Date()

model.auditSearchForm==auditSearchForm
}
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I am learning a little bit on Grails through this process of gradle and grails upgrades so if you see something odd, let me know.&lt;/p&gt;</comment>
                            <comment id="17530458" author="emilles" created="Sat, 30 Apr 2022 21:33:19 +0000"  >&lt;p&gt;I don&apos;t know what Grails&apos; TestFor does, but that might be part of the problem.  I did fix the NPE and add a check upstream.  So if you can test with snapshot builds, you could see if the issue is resolved for your project.&lt;/p&gt;</comment>
                            <comment id="17530473" author="emilles" created="Sat, 30 Apr 2022 23:33:13 +0000"  >&lt;p&gt;Here is where the errant operator comes from:&lt;br/&gt;
&lt;a href=&quot;https://github.com/grails/grails-core/blob/5.2.x/grails-core/src/main/groovy/org/grails/compiler/injection/GrailsASTUtils.java#L72&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/grails/grails-core/blob/5.2.x/grails-core/src/main/groovy/org/grails/compiler/injection/GrailsASTUtils.java#L72&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/grails/grails-core/blob/5.2.x/grails-core/src/main/groovy/org/grails/compiler/injection/GrailsASTUtils.java#L315&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/grails/grails-core/blob/5.2.x/grails-core/src/main/groovy/org/grails/compiler/injection/GrailsASTUtils.java#L315&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Grails should be creating an &lt;tt&gt;ASSIGN&lt;/tt&gt; token or using &lt;tt&gt;Token.newSymbol(&quot;=&quot;,-1,-1)&lt;/tt&gt; or &lt;tt&gt;GeneralUtils#assignX&lt;/tt&gt; or &lt;tt&gt;GeneralUtils#declX&lt;/tt&gt; or &lt;tt&gt;GeneralUtils#declS&lt;/tt&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 28 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z11u7s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>