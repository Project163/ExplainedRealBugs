<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:24:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-11371] unsafe conversion of array of reference type to an array of primitive type</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-11371</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I have the following program&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Test {
&#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
&#160; &#160; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] z = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;[]{&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;};
&#160; }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;h3&gt;&lt;a name=&quot;Actualbehavior&quot;&gt;&lt;/a&gt;Actual behavior&lt;/h3&gt;

&lt;p&gt;The compiler accepts the program. However, I get the following exception at runtime.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.IllegalArgumentException
&#160; &#160; &#160; &#160; at java.base/java.lang.reflect.Array.set(Native Method)
&#160; &#160; &#160; &#160; at org.codehaus.groovy.runtime.typehandling.DefaultTypeTransformation.asArray(DefaultTypeTransformation.java:459)
&#160; &#160; &#160; &#160; at org.codehaus.groovy.runtime.typehandling.DefaultTypeTransformation.castToType(DefaultTypeTransformation.java:228)
&#160; &#160; &#160; &#160; at org.codehaus.groovy.vmplugin.v8.IndyInterface.fromCache(IndyInterface.java:336)
&#160; &#160; &#160; &#160; at Test.main(test.groovy:3)
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;h3&gt;&lt;a name=&quot;Expectedbehavior&quot;&gt;&lt;/a&gt;Expected behavior&lt;/h3&gt;

&lt;p&gt;The compiler should reject the program: Double[] is not convertible to double[].&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;Notes&quot;&gt;&lt;/a&gt;Notes&lt;/h3&gt;

&lt;p&gt;Tested against master (commit: 8ba8e8264fc3edeb9c70b52937edb97b0246a5d5)&lt;/p&gt;

&lt;p&gt;Groovy 4.0.10 rejects the program as expected.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13578749">GROOVY-11371</key>
            <summary>unsafe conversion of array of reference type to an array of primitive type</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="theosot">Thodoris Sotiropoulos</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 May 2024 12:19:35 +0000</created>
                <updated>Tue, 12 Nov 2024 11:40:07 +0000</updated>
                            <resolved>Tue, 2 Jul 2024 20:11:04 +0000</resolved>
                                                    <fixVersion>5.0.0-alpha-10</fixVersion>
                                    <component>Static Type Checker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17847511" author="emilles" created="Sat, 18 May 2024 12:20:33 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
@groovy.transform.TypeChecked test() {
  &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] z = [&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;[]
}
test()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Groovy 2.5 says: Cannot assign value of type java.lang.Double[] to variable of type double[]&lt;/p&gt;

&lt;p&gt;Groovy 3+ compiles and the &lt;tt&gt;IllegalArgumentException&lt;/tt&gt; occurs at runtime.&lt;/p&gt;</comment>
                            <comment id="17860196" author="emilles" created="Wed, 26 Jun 2024 16:05:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/blob/7aff28a27b406a2ed80167f12f943aa64d12a784/src/main/java/org/codehaus/groovy/runtime/typehandling/DefaultTypeTransformation.java#L219&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;DefaultTypeTransformation#castToType&lt;/a&gt; implements conversion from object (incl. &lt;tt&gt;null&lt;/tt&gt;) to some type (incl. primitives).  The only primitive conversion today is &lt;tt&gt;null&lt;/tt&gt; --&amp;gt; &lt;tt&gt;false&lt;/tt&gt; for &lt;tt&gt;boolean&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I think it is safe to add a conversion from &lt;tt&gt;null&lt;/tt&gt; to &lt;tt&gt;NaN&lt;/tt&gt; for &lt;tt&gt;double&lt;/tt&gt; and &lt;tt&gt;float&lt;/tt&gt;.  That would stop the &lt;tt&gt;IllegalArgumentException&lt;/tt&gt; at the point of array store.&lt;/p&gt;

&lt;p&gt;As for what to do about the other primitive types, I think the &quot;null&quot; character is probably okay.  But zero for the integral types I&apos;m not sure about.  Any thoughts? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=paulk&quot; class=&quot;user-hover&quot; rel=&quot;paulk&quot;&gt;paulk&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=blackdrag&quot; class=&quot;user-hover&quot; rel=&quot;blackdrag&quot;&gt;blackdrag&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17860211" author="blackdrag" created="Wed, 26 Jun 2024 17:31:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt; why is a compiletime error not better?&lt;/p&gt;</comment>
                            <comment id="17860214" author="emilles" created="Wed, 26 Jun 2024 18:10:48 +0000"  >&lt;p&gt;Conversion from &lt;tt&gt;Double[]&lt;/tt&gt; to &lt;tt&gt;double[]&lt;/tt&gt; is supported.&#160; All values besides null are boxed.&#160; In fact, any type that is convertible to &lt;tt&gt;Number&lt;/tt&gt; works as well.  Adding a type-check error is a possibility, but will not help the &lt;tt&gt;IllegalArgumentException&lt;/tt&gt; outside STC.&lt;/p&gt;</comment>
                            <comment id="17860218" author="emilles" created="Wed, 26 Jun 2024 18:41:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/4bb0e11612fb0dbf3caeccd0ac0e7e62c040d35f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/4bb0e11612fb0dbf3caeccd0ac0e7e62c040d35f&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17862575" author="emilles" created="Tue, 2 Jul 2024 20:11:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/08e1e8d5903db572283abd0f514f05ec60757f58&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/08e1e8d5903db572283abd0f514f05ec60757f58&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If conversion is still desired, explicit coerce can be used:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
@TypeChecked test(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;[] integers) {
  &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[] ints = (integers &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[])
}
test(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;[]{1,2,3})
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13354989">GROOVY-9916</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13379122">GROOVY-10095</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13411069">GROOVY-10359</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13555225">GROOVY-11203</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>groovy</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 19 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1p4s8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>