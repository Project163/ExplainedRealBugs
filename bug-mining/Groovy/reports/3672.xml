<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:04:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-9329] OOME raised while `parseClass(scriptText)`</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-9329</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Many groovy users have encountered the OOME while&#160;&lt;tt&gt;parseClass(scriptText)&lt;/tt&gt; even if the &lt;tt&gt;scriptText&lt;/tt&gt; has not been changed.&lt;/p&gt;

&lt;p&gt;The cause of the issue is the script file name is generated via &lt;tt&gt;System.currentTimeMillis()&lt;/tt&gt;, so the script file name will change even if the script text is not changed. As a result, many class instances are created and cached in&#160;&lt;tt&gt;groovy.lang.GroovyClassLoader#classCache&lt;/tt&gt;, the classes can not be GCed, which causes OOME.&lt;/p&gt;

&lt;p&gt;The solution is very simple, the script file name could be generated via md5, which will not change if the script text is not changed.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
def gcl = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyClassLoader()

&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) {
    gcl.parseClass(&lt;span class=&quot;code-quote&quot;&gt;&apos;def x = 1&apos;&lt;/span&gt;)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Error message:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.OutOfMemoryError: Compressed &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;space

	at ConsoleScript6.run(ConsoleScript6:4)

	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)

	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13272646">GROOVY-9329</key>
            <summary>OOME raised while `parseClass(scriptText)`</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daniel_sun">Daniel Sun</assignee>
                                    <reporter username="daniel_sun">Daniel Sun</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Dec 2019 04:08:51 +0000</created>
                <updated>Fri, 7 Jan 2022 02:18:36 +0000</updated>
                            <resolved>Thu, 12 Dec 2019 23:36:10 +0000</resolved>
                                                    <fixVersion>3.0.0-rc-3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4800">1h 20m</timespent>
                                <comments>
                            <comment id="16989377" author="daniel_sun" created="Fri, 6 Dec 2019 04:18:28 +0000"  >&lt;p&gt;Here is the PR: &lt;a href=&quot;https://github.com/apache/groovy/pull/1117&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1117&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17469145" author="JIRAUSER283079" created="Wed, 5 Jan 2022 09:18:56 +0000"  >&lt;p&gt;Hi, I found the patch Not Really Cached the compiled class.&lt;/p&gt;

&lt;p&gt;If we run the next groovy script:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
def gcl = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyClassLoader()
def scriptText = &lt;span class=&quot;code-quote&quot;&gt;&apos;def x = 1&apos;&lt;/span&gt;
gcl.parseClass(scriptText)
def begin = gcl.@classCache.size()
def clazz = gcl.@classCache.values().iterator().next()
println clazz.toString() + &lt;span class=&quot;code-quote&quot;&gt;&quot;, hashCode=&quot;&lt;/span&gt; + clazz.hashCode()

3.times { gcl.parseClass(scriptText) }
def end = gcl.@classCache.size()
def clazz_2 = gcl.@classCache.values().iterator().next()
println clazz_2.toString() + &lt;span class=&quot;code-quote&quot;&gt;&quot;, hashCode=&quot;&lt;/span&gt; + clazz_2.hashCode()

println(end == begin)
println(clazz == clazz_2)
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The result is:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Script_281961721d66605f3d1f24d294f28232, hashCode=1976401987
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Script_281961721d66605f3d1f24d294f28232, hashCode=1201004240
&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;clazz != clazz_2, so it means that every time of calling &quot;parseClass(scriptText) &quot;, script will be compiled again, then the new class put to classCache to replacing the old one.&lt;/p&gt;

&lt;p&gt;The fix is: Remove the &quot;gcs.setCachable(false);&quot; line of parseClass(text, fileName) in&#160;GroovyClassLoader.java&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; parseClass(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; text, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fileName) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; CompilationFailedException {
    GroovyCodeSource gcs = AccessController.doPrivileged((PrivilegedAction&amp;lt;GroovyCodeSource&amp;gt;) () -&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyCodeSource(text, fileName, &lt;span class=&quot;code-quote&quot;&gt;&quot;/groovy/script&quot;&lt;/span&gt;));
    gcs.setCachable(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);  &amp;lt;----- Remove the line
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; parseClass(gcs);
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17470294" author="JIRAUSER283079" created="Fri, 7 Jan 2022 02:10:33 +0000"  >&lt;p&gt;Please see &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-10440&quot; title=&quot;GROOVY-9329 Not Really Cached the compiled class.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-10440&quot;&gt;GROOVY-10440&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 44 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z09cs0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>