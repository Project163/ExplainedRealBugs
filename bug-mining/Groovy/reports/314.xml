<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 23:58:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-1602] Using the groovy task in ant, my tasks run twice</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-1602</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;If I run the &apos;ant test&apos; command with the following ant build.xml,&lt;/p&gt;

&lt;p&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;br/&gt;
&amp;lt;project basedir=&quot;.&quot; name=&quot;test&quot;&amp;gt;&lt;br/&gt;
	&amp;lt;path id=&quot;groovy.classpath&quot;&amp;gt;&lt;br/&gt;
		&amp;lt;fileset dir=&quot;groovy&quot; includes=&quot;*.jar&quot;/&amp;gt;&lt;br/&gt;
	&amp;lt;/path&amp;gt;&lt;br/&gt;
	&amp;lt;taskdef name=&quot;groovy&quot; classname=&quot;org.codehaus.groovy.ant.Groovy&quot; classpathref=&quot;groovy.classpath&quot;/&amp;gt;&lt;br/&gt;
	&amp;lt;target name=&quot;test&quot;&amp;gt;&lt;br/&gt;
		&amp;lt;groovy&amp;gt;&lt;br/&gt;
			ant.echo &quot;Test&quot;&lt;br/&gt;
		&amp;lt;/groovy&amp;gt;&lt;br/&gt;
	&amp;lt;/target&amp;gt;&lt;br/&gt;
&amp;lt;/project&amp;gt;&lt;/p&gt;

&lt;p&gt;I get the following output:&lt;/p&gt;

&lt;p&gt;C:&amp;#64;WORK2\test&amp;gt;ant test&lt;br/&gt;
Buildfile: build.xml&lt;/p&gt;

&lt;p&gt;test:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Test&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Test&lt;/p&gt;

&lt;p&gt;BUILD SUCCESSFUL&lt;br/&gt;
Total time: 2 seconds&lt;br/&gt;
C:&amp;#64;WORK2\test&amp;gt;&lt;/p&gt;

&lt;p&gt;I have also tested this with long running tasks like jarring and unjarring, and the tasks are actually executed twice, not only printed twice.&lt;/p&gt;

&lt;p&gt;I found a workaround like this:&lt;/p&gt;

&lt;p&gt;	&amp;lt;target name=&quot;test&quot;&amp;gt;&lt;br/&gt;
		&amp;lt;groovy&amp;gt;&lt;br/&gt;
			ant = new AntBuilder( project )&lt;br/&gt;
			ant.echo &quot;Test&quot;&lt;br/&gt;
		&amp;lt;/groovy&amp;gt;&lt;br/&gt;
	&amp;lt;/target&amp;gt;&lt;/p&gt;

&lt;p&gt;But I&apos;m not sure about the consequences of this.&lt;/p&gt;</description>
                <environment>Windows XP</environment>
        <key id="12813448">GROOVY-1602</key>
            <summary>Using the groovy task in ant, my tasks run twice</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mguillem">mguillem</assignee>
                                    <reporter username="rene.de.bloois">Ren&#233; de Bloois</reporter>
                        <labels>
                    </labels>
                <created>Sun, 17 Dec 2006 14:51:48 +0000</created>
                <updated>Fri, 31 Aug 2007 05:02:32 +0000</updated>
                            <resolved>Mon, 30 Apr 2007 12:40:34 +0000</resolved>
                                    <version>1.0-RC-1</version>
                                    <fixVersion>1.1-beta-1</fixVersion>
                                    <component>Ant integration</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14462603" author="jimwhite" created="Wed, 7 Feb 2007 00:48:48 +0000"  >&lt;p&gt;This has me confused too, but it is not a bug (AFAICT).&lt;/p&gt;

&lt;p&gt;The code is not executing twice, you&apos;re just seeing the output twice.&lt;/p&gt;

&lt;p&gt;The &amp;lt;groovy&amp;gt; task is capturing System.out (which is also System.err) while the groovy code executes, then echos it when the task finishes.&lt;/p&gt;

&lt;p&gt;So when the &amp;lt;echo&amp;gt; tasks are executed, their text is echoed &lt;b&gt;and&lt;/b&gt; it is being captured via System.out, which the &amp;lt;groovy&amp;gt; task echoes again.&lt;/p&gt;

&lt;p&gt;It might be a good idea to document this better.  Also a property to turn off this echoing behavior is probably a good idea.&lt;/p&gt;</comment>
                            <comment id="14462592" author="ace" created="Sun, 25 Feb 2007 19:36:35 +0000"  >&lt;p&gt;This is definitely a bug in some cases, especially if file operations are involved. Try to explain the following behavior: &lt;br/&gt;
======================================================&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=%2Ftmp&quot; class=&quot;user-hover&quot; rel=&quot;/tmp&quot;&gt;/tmp&lt;/a&gt;$ cat build.xml &lt;br/&gt;
&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;project name=&quot;common&quot; default=&quot;test&quot; &amp;gt;&lt;/p&gt;

&lt;p&gt;    &amp;lt;taskdef name=&quot;groovy&quot; classname=&quot;org.codehaus.groovy.ant.Groovy&quot; classpath=&quot;groovy-all-1.0.jar&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;    &amp;lt;target name=&quot;test&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;echo message=&quot;Expected content of the zipped  file\n&quot; file=&quot;test&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;groovy&amp;gt;&lt;br/&gt;
            ant.zip(destfile:&quot;test.zip&quot;) &lt;/p&gt;
{
                ant.fileset(file:&quot;test&quot;)
            }
&lt;p&gt;            ant.echo(message:&quot;This should never make it into the zip file\n&quot;, file:&quot;test&quot;)&lt;br/&gt;
        &amp;lt;/groovy&amp;gt;&lt;br/&gt;
    &amp;lt;/target&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;/project&amp;gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=%2Ftmp&quot; class=&quot;user-hover&quot; rel=&quot;/tmp&quot;&gt;/tmp&lt;/a&gt;$ ant test&lt;br/&gt;
Buildfile: build.xml&lt;/p&gt;

&lt;p&gt;test:&lt;br/&gt;
      &lt;span class=&quot;error&quot;&gt;&amp;#91;zip&amp;#93;&lt;/span&gt; Building zip: /Users/ace/tmp/test.zip&lt;br/&gt;
      &lt;span class=&quot;error&quot;&gt;&amp;#91;zip&amp;#93;&lt;/span&gt; Building zip: /Users/ace/tmp/test.zip&lt;/p&gt;

&lt;p&gt;BUILD SUCCESSFUL&lt;br/&gt;
Total time: 3 seconds&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=%2Ftmp&quot; class=&quot;user-hover&quot; rel=&quot;/tmp&quot;&gt;/tmp&lt;/a&gt;$ cat test&lt;br/&gt;
This should never make it into the zip file&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=%2Ftmp&quot; class=&quot;user-hover&quot; rel=&quot;/tmp&quot;&gt;/tmp&lt;/a&gt;$ rm test&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=%2Ftmp&quot; class=&quot;user-hover&quot; rel=&quot;/tmp&quot;&gt;/tmp&lt;/a&gt;$ unzip test.zip &lt;br/&gt;
Archive:  test.zip&lt;br/&gt;
  inflating: test                    &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=%2Ftmp&quot; class=&quot;user-hover&quot; rel=&quot;/tmp&quot;&gt;/tmp&lt;/a&gt;$ cat test&lt;br/&gt;
This should never make it into the zip file&lt;br/&gt;
=====================================================&lt;br/&gt;
I think the file &quot;test&quot; is generated first with the correct content, then gets zipped, then modified and then gets zipped again (last zip step is the bug). &lt;br/&gt;
I&apos;ve seen other cases: creating a manifest file with groovy, create a jar with this manifest file from groovy, then delete the manifest file again from groovy and the task will fail. In this case the second jar task executed after the groovy task misses the manifest file. &lt;br/&gt;
Or try to copy a file from inside groovy using ant.copy, then manipulate the file. When the groovy tasks finishes, the files are copied again, removing all modifications done after the first groovy ant.copy() call.&lt;/p&gt;

&lt;p&gt;I would suggest to raise the Priority of this task. This problem hits me all the time when writing ant groovy tasks.&lt;/p&gt;</comment>
                            <comment id="14462545" author="jskeet" created="Mon, 26 Feb 2007 03:16:57 +0000"  >&lt;p&gt;I have further evidence that this is definitely a bug. Here&apos;s a tiny C# program which just shows the current date/time in ticks:&lt;/p&gt;

&lt;p&gt;using System;&lt;/p&gt;

&lt;p&gt;class Test&lt;br/&gt;
{&lt;br/&gt;
    static void Main()&lt;/p&gt;
    {
        Console.WriteLine (DateTime.Now.Ticks);
    }
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;Now here&apos;s a build file:&lt;br/&gt;
&amp;lt;project name=&quot;Test&quot; default=&quot;test&quot;&amp;gt;&lt;br/&gt;
&amp;lt;taskdef name=&quot;groovy&quot;&lt;br/&gt;
classname=&quot;org.codehaus.groovy.ant.Groovy&quot;&lt;br/&gt;
classpath=&quot;groovy-all-1.0.jar&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;target name=&quot;test&quot;&amp;gt;&lt;br/&gt;
&amp;lt;groovy&amp;gt;&lt;br/&gt;
ant.exec(executable:&apos;showdate.exe&apos;)&lt;br/&gt;
Thread.sleep(500)&lt;br/&gt;
&amp;lt;/groovy&amp;gt;&lt;br/&gt;
&amp;lt;echo&amp;gt;After Groovy task&amp;lt;/echo&amp;gt;&lt;br/&gt;
&amp;lt;/target&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;/project&amp;gt; &lt;/p&gt;

&lt;p&gt;Here&apos;s the output:&lt;br/&gt;
test:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; 633080781496458405&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; After Groovy task&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;exec&amp;#93;&lt;/span&gt; 633080781502600590&lt;/p&gt;

&lt;p&gt;What I believe is happening is that the tasks are only being &lt;b&gt;built&lt;/b&gt; once, but then &lt;b&gt;executed&lt;/b&gt; twice. That would explain the behaviour&lt;br/&gt;
Jim White saw and demonstrated in bug 1674.&lt;/p&gt;

&lt;p&gt;Definitely a bug, and I believe quite a significant one.&lt;/p&gt;</comment>
                            <comment id="14462563" author="ace" created="Wed, 28 Feb 2007 19:38:18 +0000"  >&lt;p&gt;Ok, this is a bit embarrassing. By providing a patch for the issue &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-1506&quot; title=&quot;groovy task in ant throws NPE when calling target from inside groovy with antcall&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-1506&quot;&gt;&lt;del&gt;GROOVY-1506&lt;/del&gt;&lt;/a&gt; I, myself, introduced this bug into Groovy &lt;b&gt;blush&lt;/b&gt;. This new patch will solve both issues now.&lt;br/&gt;
Please test it, it works fine with my pretty complicated build scripts, in which I use antcall calls from inside groovy tasks. All tasks are executed only once of course.&lt;/p&gt;</comment>
                            <comment id="14462481" author="rene.de.bloois" created="Tue, 6 Mar 2007 06:30:54 +0000"  >&lt;p&gt;I tested the patch and it works.&lt;/p&gt;

&lt;p&gt;Thanx for the fix.&lt;/p&gt;</comment>
                            <comment id="14462645" author="guillaume" created="Tue, 6 Mar 2007 14:33:54 +0000"  >&lt;p&gt;Jochen, could you also try to look at this patch and apply it, please?&lt;/p&gt;</comment>
                            <comment id="14477299" author="mguillemot@yahoo.fr" created="Wed, 28 Mar 2007 07:17:04 +0000"  >&lt;p&gt;Probably should the created target have a special name and not empty string as empty string seems to have a special signification (see org.apache.tools.ant.Ant line 321 in Ant 1.6.5). &lt;br/&gt;
I&apos;ve written probably because I couldn&apos;t try to reproduce my actual problem using the patched version the AntBuilder.&lt;/p&gt;</comment>
                            <comment id="14477300" author="mguillemot@yahoo.fr" created="Tue, 3 Apr 2007 09:26:31 +0000"  >&lt;p&gt;when a task without parent is &quot;parsed&quot; by the AntBuilder, it gets added to the current target which is the target in which the &amp;lt;groovy&amp;gt; task is located. The target appends this newly created task to its children (to which the &amp;lt;groovy&amp;gt; task already belong to) and therefore it gets executed as &quot;normal child&quot; of the target too.&lt;/p&gt;</comment>
                            <comment id="14477302" author="mguillemot@yahoo.fr" created="Mon, 30 Apr 2007 12:40:34 +0000"  >&lt;p&gt;Fixed in build 306.&lt;/p&gt;

&lt;p&gt;The chosen solution was to &quot;parse&quot; the tasks built with the AntBuilder as if they were children of the &amp;lt;groovy&amp;gt; task (what they are in some extend). This way they aren&apos;t orphan and are not added to the owning target.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12816835">GROOVY-1674</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12721034" name="double-exec.patch" size="999" author="ace" created="Wed, 28 Feb 2007 19:38:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 31 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cnq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>