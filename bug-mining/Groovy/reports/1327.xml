<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:16:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-2811] GroovyClassLoader.isSourceNewer() fails when url has spaces</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-2811</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The GroovyClassLoader fails to recompile scripts when the script path contains spaces, as the file latest modified always return 0 (file not found).&lt;br/&gt;
I think this is related to Groovy-1787 issue. &lt;/p&gt;

&lt;p&gt;As a consequence scripts cashed by a GroovyClassLoader will not be updated even if the source is replaced.&lt;/p&gt;

&lt;p&gt;I&apos;ve extended the &lt;tt&gt;GroovyClassLoaderTest.java&lt;/tt&gt;  with a new test method that demonstrate the issue. My guess is that this is not the proper location so someone with a better understanding that me of the project structure should properly move/refactor it.&lt;/p&gt;

&lt;p&gt;Also as far as I can see a fix is almost trivial? within the isSorceNewer() method the filepath:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;String path = source.getPath().replace(&apos;/&apos;, File.separatorChar).replace(&apos;|&apos;, &apos;:&apos;);&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt; should be parsed through the internal decodeFileName prior to creating the file object.&lt;/p&gt;

&lt;p&gt;But I&apos;m not convinced that this is the proper fix?&lt;/p&gt;

</description>
                <environment>Java Runtime Environment version: 1.6.0_04&lt;br/&gt;
Java Runtime Environment vendor: Sun Microsystems Inc.&lt;br/&gt;
Ant version: Apache Ant version 1.7.0 compiled on December 13 2006&lt;br/&gt;
Operating system name: Windows XP&lt;br/&gt;
Operating system architecture: x86&lt;br/&gt;
[echo] Operating system version: 5.1&lt;br/&gt;
[echo] Base directory: C:\arbejde\workspace2\groovy</environment>
        <key id="12817793">GROOVY-2811</key>
            <summary>GroovyClassLoader.isSourceNewer() fails when url has spaces</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="guillaume">Guillaume Sauthier</assignee>
                                    <reporter username="halu">Hans Lund</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 May 2008 16:22:40 +0000</created>
                <updated>Thu, 22 Jul 2010 17:32:26 +0000</updated>
                            <resolved>Wed, 21 Jul 2010 18:23:57 +0000</resolved>
                                    <version>1.6-beta-1</version>
                                    <fixVersion>1.7.4</fixVersion>
                    <fixVersion>1.8-beta-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14464695" author="blackdrag" created="Thu, 8 May 2008 13:14:35 +0000"  >&lt;p&gt;a space is encoded as %20, thus when in isSourceNewer a file object is created it looks for &quot;%20&quot; instead of &quot; &quot;. The result is that it won&apos;t work. URLDecode.decode(url.getPath(),&quot;UTF8&quot;) should be used instead. It should also be tested if source.getPath().replace(&apos;/&apos;, File.separatorChar).replace(&apos;|&apos;, &apos;:&apos;); is still needed after a call to decode.&lt;/p&gt;</comment>
                            <comment id="14464729" author="halu" created="Fri, 9 May 2008 03:18:48 +0000"  >&lt;p&gt;Having had a closer look, there seams to be a general approach regarding URL -&amp;gt; File conversion.&lt;/p&gt;


&lt;p&gt;method(URL url)&lt;/p&gt;
{
String path = url.getPath();

// some code to compensate for the errors now introduced
path = ........

File f = new File(path);
.....}
&lt;p&gt;  &lt;/p&gt;

&lt;p&gt;where I think in most cases URL and URI classes handles this well (makes system depended, conversions)&lt;br/&gt;
can be replaced with:&lt;br/&gt;
method(URL url)&lt;br/&gt;
if (isFile...)&lt;/p&gt;
{
File file = new File(url.toURI());
.....}

&lt;p&gt;at least I think this should hold for isSourceNewer()&lt;br/&gt;
can be refactored and fixed with-&amp;gt;&lt;/p&gt;

&lt;p&gt;protected boolean isSourceNewer(URL source, Class cls) throws IOException {&lt;br/&gt;
        long lastMod;&lt;/p&gt;

&lt;p&gt;        // Special handling for &lt;a href=&quot;file://&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file://&lt;/a&gt; protocol, as getLastModified() often reports&lt;br/&gt;
        // incorrect results (-1)&lt;br/&gt;
        if (source.getProtocol().equals(&quot;file&quot;)) &lt;/p&gt;
{
            File file = new File(source.toURI());
            lastMod = file.lastModified();
        }
&lt;p&gt; else &lt;/p&gt;
{
            URLConnection conn = source.openConnection();
            lastMod = conn.getLastModified();
            conn.getInputStream().close();
        }
&lt;p&gt;        long classTime = getTimeStamp(cls);&lt;br/&gt;
        return classTime + config.getMinimumRecompilationInterval() &amp;lt; lastMod;&lt;br/&gt;
    }&lt;/p&gt;





</comment>
                            <comment id="14464780" author="halu" created="Mon, 19 May 2008 09:44:57 +0000"  >&lt;p&gt;I&apos;ve made a patch to the issue, using the url-&amp;gt;uri-&amp;gt;file strategy instead of decoding strings directly. &lt;/p&gt;

&lt;p&gt;Therefore, the string replacement chain is also gone, but I haven&apos;t tested if that is OK, as I can&apos;t figure out why it was there in the first instance, but after the patch all tests parse, and I think the replacements was an attempt to  decode the url.toString string  in order create a file from the string?&lt;/p&gt;

&lt;p&gt;I&apos;ve also added a patch for the unit test testing the GroovyClassLoader.&lt;/p&gt;

&lt;p&gt;Note: I&apos;ve only tested on windows , so tests on other supported platforms is needed.&lt;/p&gt;
</comment>
                            <comment id="14469362" author="jcox" created="Tue, 27 Apr 2010 16:22:54 +0000"  >&lt;p&gt;I hit this bug on linux as well with Groovy 1.7.0&lt;br/&gt;
The problem seems to be that   isSourceNewer(URL source, Class cls)&lt;br/&gt;
fails to decode the URL within if (isFile(source))...&lt;/p&gt;

&lt;p&gt;Here&apos;s what worked on Linux (I haven&apos;t bothered testing on windows):&lt;/p&gt;

 &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;GroovyClassLoader.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  
 &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isSourceNewer(URL source, &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; cls) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException 
 {
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; lastMod;
     
        &lt;span class=&quot;code-comment&quot;&gt;// Special handling &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; file:// protocol, as getLastModified() often reports
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// incorrect results (-1)
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isFile(source)) {
            &lt;span class=&quot;code-comment&quot;&gt;// Coerce the file URL to a File
&lt;/span&gt;            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; path = source.getPath();
            path = path.replace(&lt;span class=&quot;code-quote&quot;&gt;&apos;|&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;:&apos;&lt;/span&gt;);

            &lt;span class=&quot;code-comment&quot;&gt;//-----------------------------
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// Here&apos;s the bugfix
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;//-----------------------------
&lt;/span&gt;            path = decodeFileName(path);  

            File file = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(path);
            lastMod = file.lastModified();
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            URLConnection conn = source.openConnection();
            lastMod = conn.getLastModified();
            conn.getInputStream().close();
        }
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; classTime = getTimeStamp(cls);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; classTime + config.getMinimumRecompilationInterval() &amp;lt; lastMod;
 }

 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="14469869" author="guillaume" created="Wed, 21 Jul 2010 18:23:57 +0000"  >&lt;p&gt;The GroovyScriptEngine has been rewritten in Groovy 1.7, but there were still some issues with the reloading under certain circumstances. Hopefully those issues should be fixed now too.&lt;br/&gt;
Please reopen the issue in case the problem still persists for you.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12721341" name="GroovyClassLoaderTest.java" size="6137" author="halu" created="Tue, 6 May 2008 16:22:40 +0000"/>
                            <attachment id="12721474" name="isSourceNewer.patch" size="2539" author="halu" created="Mon, 19 May 2008 09:44:57 +0000"/>
                            <attachment id="12721447" name="reloading.patch" size="4072" author="halu" created="Mon, 19 May 2008 09:44:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 18 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bmev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>