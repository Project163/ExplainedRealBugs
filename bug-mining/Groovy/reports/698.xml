<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:05:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-2829] Groovy&apos;s class verification doesn&apos;t allow for covariant return types</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-2829</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Given these Java interfaces:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.List;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; Base {
    List foo();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.ArrayList;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; Child &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Base {
    ArrayList foo();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Java allows the return type for methods to be the most specified or a derived type:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.ArrayList;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;JavaChildImpl &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; Child {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; ArrayList foo() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But compiling this Groovy script:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;GroovyChildImpl &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; Child {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; ArrayList foo() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;yields:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed, GroovyChildImpl.groovy: 2: the return type is incompatible with java.util.List foo() in Base.
Node: org.codehaus.groovy.ast.MethodNode. At [2:5]  @ line 2, column 5.
       public ArrayList foo() {
       ^

1 error
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Attached patch fixes this problem.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12817800">GROOVY-2829</key>
            <summary>Groovy&apos;s class verification doesn&apos;t allow for covariant return types</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="paulk">Paul King</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 May 2008 04:52:55 +0000</created>
                <updated>Tue, 7 Apr 2015 19:07:20 +0000</updated>
                            <resolved>Thu, 29 May 2008 00:20:44 +0000</resolved>
                                    <version>1.6-beta-1</version>
                                    <fixVersion>1.5.7</fixVersion>
                    <fixVersion>1.6-beta-2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14464826" author="blackdrag" created="Fri, 16 May 2008 06:05:13 +0000"  >&lt;p&gt;I guess the check (if it is allowed and if a bridge method has to be added) respects super classes, but not interfaces being implemented by the current class.&lt;/p&gt;</comment>
                            <comment id="14478154" author="paulk" created="Fri, 16 May 2008 06:30:40 +0000"  >&lt;p&gt;I had a patch but it doesn&apos;t handle a particular case that I just noticed. I&apos;ll have a bit more of a look and then get you to comment on the patch once amended and attached. When you say &quot;&lt;em&gt;respects super classes, but not interfaces being implemented by the current class&lt;/em&gt;&quot; I think I understand but do you want to explain further what you mean.&lt;/p&gt;

&lt;p&gt;Currently the patch modifies two classes. When &lt;tt&gt;ClassCompletionVerifier&lt;/tt&gt; is checking for abstract methods it skips reporting an error if a derived method exists. Then in &lt;tt&gt;getCovariantImplementation&lt;/tt&gt; in &lt;tt&gt;Verifier&lt;/tt&gt;, instead of checking for equality between the &lt;tt&gt;overridingMethod&lt;/tt&gt; and &lt;tt&gt;oldMethod&lt;/tt&gt; class nodes it checks whether the type classes are assignable. Problem is that the return type for the overriding method may not be resolved yet, so there is more work to do.&lt;/p&gt;</comment>
                            <comment id="14464793" author="blackdrag" created="Fri, 16 May 2008 06:52:46 +0000"  >&lt;p&gt;you can not check for equality, because:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;X{def foo(){}}
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Y{&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; foo(){}}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; In this case we want covariation to kick in and let &lt;tt&gt;String  foo()&lt;/tt&gt; overwrite &lt;tt&gt;Object foo()&lt;/tt&gt; by adding a bridge method for &lt;tt&gt;Object foo()&lt;/tt&gt; that calls &lt;tt&gt;String foo()&lt;/tt&gt;. Since the overwritten method can not return anything that its return type does not allow, I use assignable to check that. At the phase where this is called, the return type is usually resolved already, since it happens after ResolveVisitor is called.&lt;/p&gt;</comment>
                            <comment id="14464827" author="blackdrag" created="Fri, 16 May 2008 07:11:20 +0000"  >&lt;p&gt;I read &quot;Attached patch fixes this problem.&quot;... is there a patch?&lt;/p&gt;</comment>
                            <comment id="14464859" author="blackdrag" created="Fri, 16 May 2008 07:14:21 +0000"  >&lt;p&gt;anyway, I will commit a fix for this in a few minutes. The problem was that in the code checking for covariance isDerivedFrom was used. but isDerivedFrom checks only super classes, no interfaces.... Maybe that should be considered as bug too.. We have also declaresInterface, so I guess it does not have to be seen as bug. Anyway, since only isDerivedFrom was used, only super classes where checked, and not interfaces. My patch will fix that and the test case will pass then.&lt;/p&gt;</comment>
                            <comment id="14464785" author="paulk" created="Fri, 16 May 2008 07:33:08 +0000"  >&lt;p&gt;OK, I will await your patch and then compare.&lt;/p&gt;</comment>
                            <comment id="14464842" author="paulk" created="Sat, 17 May 2008 09:14:00 +0000"  >&lt;p&gt;I think there are further cases.&lt;/p&gt;</comment>
                            <comment id="14478148" author="paulk" created="Sat, 17 May 2008 09:14:58 +0000"  >&lt;p&gt;Altered the test cases and supplied a potential patch to make them pass.&lt;/p&gt;</comment>
                            <comment id="14478169" author="paulk" created="Sat, 17 May 2008 09:44:22 +0000"  >&lt;p&gt;I should have mentioned. I am not sure whether the change I had to make to &lt;tt&gt;GroovyInterceptableTest&lt;/tt&gt; is desirable. I expect not. Perhaps an improved fix is required. Perhaps we need both a &lt;tt&gt;implementsInterface&lt;/tt&gt; and &lt;tt&gt;implementsInterfaceDirectOrIndirect&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14464860" author="blackdrag" created="Sat, 17 May 2008 10:39:40 +0000"  >&lt;p&gt;first.. if you find another bug in this, please open a new issue, since this one has been resolved. But I agree, that the isAssignable test might not cover all of it.... for example did we test&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; I1{}
&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; I2 &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; I2{}
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;X &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; I2{}
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
  I1 foo(){}
}
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Bar &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Foo {
  X foo(){}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In that example X does not directly implement I1, but the method in Foo should still be overwritten by the one in Bar. Also I am very for a isAssignable method on ClassNode working with a ClassNode, not more String based patchwork here.. in fact that stupid string method (declaresInterface was it I think) should vanish. If you want to do that, feel free to do so... just the change to GroovyInterceptableTest should be undone.&lt;/p&gt;</comment>
                            <comment id="14478168" author="paulk" created="Sat, 17 May 2008 17:05:52 +0000"  >&lt;p&gt;I only reopened because I realised that my original testcase wasn&apos;t complete enough. I will add in my patch as it covers the case you mention above.&lt;/p&gt;</comment>
                            <comment id="14478157" author="paulk" created="Thu, 29 May 2008 00:20:44 +0000"  >&lt;p&gt;was fixed about a week ago I believe&lt;/p&gt;</comment>
                            <comment id="14479888" author="rherzog" created="Mon, 23 Apr 2012 10:22:43 +0000"  >&lt;p&gt;Looks like the problem has returned in 1.8.6. I&apos;m running into this, exactly as described in the original posting.&lt;/p&gt;</comment>
                            <comment id="14472642" author="blackdrag" created="Mon, 23 Apr 2012 10:38:44 +0000"  >&lt;p&gt;Raffael, can you please fill a new issue and explain there what exactly your issue is? Do you mean the example in this issue no longer works?&lt;/p&gt;</comment>
                            <comment id="14479910" author="rherzog" created="Wed, 25 Apr 2012 10:01:22 +0000"  >&lt;p&gt;Done: &lt;a href=&quot;https://jira.codehaus.org/browse/GROOVY-5418&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jira.codehaus.org/browse/GROOVY-5418&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;And no, the issue is very similar, but the example in this issue should still work, AFAICS.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12721653" name="groovy2829_additional.patch" size="4172" author="paulk" created="Sat, 17 May 2008 09:14:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 30 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cdcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>