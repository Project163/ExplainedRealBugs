<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:16:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-7682] JsonBuilder or JsonOutput incompatible with JodaTime</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-7682</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Using groovy&apos;s built-in methods to serialize Joda DateTime to JSON always conclude in a &lt;tt&gt;StackOverflowError&lt;/tt&gt;.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;ExampleMethod&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; com.mgd

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.json.JsonOutput

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.joda.time.DateTime
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.joda.time.format.DateTimeFormat
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.joda.time.format.DateTimeFormatter

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;JodaBugJson {

	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
		DateTimeFormatter formatter = DateTimeFormat.forPattern(&lt;span class=&quot;code-quote&quot;&gt;&quot;yyyy-MM-dd HH:mm:ss.SSS z&quot;&lt;/span&gt;)

		DateTime dt = formatter.parseDateTime(&lt;span class=&quot;code-quote&quot;&gt;&quot;2015-11-20 13:37:21.123 EST&quot;&lt;/span&gt;)

		&lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; json = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JsonBuilder(dt).toString()	//same outcome
&lt;/span&gt;		&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; json = JsonOutput.toJson(dt)
		println json
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Running the above will result in : &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Error&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.StackOverflowError
	at org.codehaus.groovy.reflection.ClassInfo.getClassInfo(ClassInfo.java:119)
	at org.codehaus.groovy.runtime.metaclass.MetaClassRegistryImpl.getMetaClass(MetaClassRegistryImpl.java:261)
	at org.codehaus.groovy.runtime.InvokerHelper.getMetaClass(InvokerHelper.java:871)
	at org.codehaus.groovy.runtime.DefaultGroovyMethods.getMetaPropertyValues(DefaultGroovyMethods.java:364)
	at org.codehaus.groovy.runtime.DefaultGroovyMethods.getProperties(DefaultGroovyMethods.java:383)
	at groovy.json.JsonOutput.writeObject(JsonOutput.java:290)
	at groovy.json.JsonOutput.writeMap(JsonOutput.java:424)
	at groovy.json.JsonOutput.writeObject(JsonOutput.java:294)
	at groovy.json.JsonOutput.writeMap(JsonOutput.java:424)
	at groovy.json.JsonOutput.writeObject(JsonOutput.java:294)
	at groovy.json.JsonOutput.writeMap(JsonOutput.java:424)
        ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Whether this be only the date, or an object including a Joda DateTime the outcome is the same.&lt;/p&gt;</description>
                <environment>JVM: 1.8.0_65 (Oracle)&lt;br/&gt;
Mac OS X 10.11.1 (El Capitan)</environment>
        <key id="12914943">GROOVY-7682</key>
            <summary>JsonBuilder or JsonOutput incompatible with JodaTime</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="jppellerin">Jean-Philippe Pellerin</reporter>
                        <labels>
                            <label>DateTime,</label>
                            <label>Json</label>
                            <label>StackOverflowError</label>
                    </labels>
                <created>Fri, 20 Nov 2015 18:50:58 +0000</created>
                <updated>Thu, 3 Feb 2022 22:35:37 +0000</updated>
                            <resolved>Fri, 14 Jan 2022 10:59:04 +0000</resolved>
                                    <version>2.4.5</version>
                                    <fixVersion>4.0.0</fixVersion>
                                    <component>JSON</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15030795" author="jwagenleitner" created="Sun, 29 Nov 2015 04:39:53 +0000"  >&lt;p&gt;Looks like this is caused by &lt;a href=&quot;http://joda-time.sourceforge.net/apidocs/org/joda/time/base/AbstractInstant.html#getZone()&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;DateTime#getZone&lt;/tt&gt;&lt;/a&gt; that returns a &lt;tt&gt;DateTimeZone&lt;/tt&gt;.  This creates a cycle when it tries to serialize the &lt;a href=&quot;http://joda-time.sourceforge.net/apidocs/org/joda/time/DateTimeZone.html#getDefault()&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;DateTimeZone#getDefault&lt;/tt&gt;&lt;/a&gt; property which returns the same type.&lt;/p&gt;

&lt;p&gt;The following will reproduce the stackoverflow:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.json.JsonOutput

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; DEFAULT = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Foo(&lt;span class=&quot;code-quote&quot;&gt;&apos;The Foo&apos;&lt;/span&gt;)
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name
    Foo(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name) { &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.name = name }
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getName() { &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; name }
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Foo getDefault() { &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; DEFAULT }
}

JsonOutput.toJson( &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Foo(&lt;span class=&quot;code-quote&quot;&gt;&apos;test foo&apos;&lt;/span&gt;) )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15199751" author="bestan" created="Thu, 17 Mar 2016 15:47:24 +0000"  >&lt;p&gt;Same exception is raised when serializing &lt;a href=&quot;https://docs.oracle.com/javase/8/docs/api/java/time/LocalDateTime.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;LocalDateTime&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15275358" author="andre.steingress" created="Sat, 7 May 2016 19:39:16 +0000"  >&lt;p&gt;When having a look at Jackson, I saw they solve the issue of self referencing objects with either annotations (in Jackson 2) or a specific &quot;module configuration&quot; in case of Joda Time (= specific support for it).&lt;/p&gt;

&lt;p&gt;So I came about this approach for &lt;tt&gt;JsonOutput&lt;/tt&gt;:&lt;/p&gt;

&lt;p&gt;We introduce new &lt;tt&gt;toJson(..., Map)&lt;/tt&gt; methods that will allow to specify a map as 2nd parameter. The map is treated as configuration map (similar to the map used in the ToString AST xform) and allows to exclude properties of specified classes. &lt;/p&gt;

&lt;p&gt;An example can be found here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/andresteingress/groovy/blob/e1141a2f6d0e324b6a416b0a38df586da17c1406/subprojects/groovy-json/src/test/groovy/groovy/json/JsonOutputTest.groovy#L430&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/andresteingress/groovy/blob/e1141a2f6d0e324b6a416b0a38df586da17c1406/subprojects/groovy-json/src/test/groovy/groovy/json/JsonOutputTest.groovy#L430&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The implementation has support for specifying a list of properties or only a single property &lt;tt&gt;String&lt;/tt&gt;, thus giving some flexibility in configuration style and footprint.&lt;/p&gt;

&lt;p&gt;I like this approach as it could give more flexibility for additional configuration entries for the future. However, the disadvantage of this approach is that it does not directly solve the &lt;tt&gt;StackOverflowException&lt;/tt&gt;, instead the caller needs to know which properties cause the exception to exlcude them in the configuration (which is tricky and maybe can not be demanded).&lt;/p&gt;

&lt;p&gt;For introducing the configuration map, I am not totally sure right now which toJson methods should actually get that new parameter (besides &lt;tt&gt;toJson(Object)&lt;/tt&gt;), but maybe that&apos;s already details. &lt;/p&gt;

&lt;p&gt;I also should note here: from my pov it does not make sense to demand the same or equal functionality from &lt;tt&gt;JsonOutput&lt;/tt&gt; as dedicated JSON libraries like Jackson provide, but a little bit more flexibility in terms of configuring JsonOutput would make it maybe more applicable in certain cases.&lt;/p&gt;

&lt;p&gt;What do you guys think about that - or any other approaches how to solve this issue?&lt;/p&gt;</comment>
                            <comment id="15275386" author="jwagenleitner" created="Sat, 7 May 2016 21:08:26 +0000"  >&lt;p&gt;I think that approach would be good, while it may not directly solve the StackOverflow it&apos;s probably a feature that would helpful (similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-6699&quot; title=&quot;JSON slurper ability to ignore propertie/field names&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-6699&quot;&gt;GROOVY-6699&lt;/a&gt;) to have and at least indirectly could help as a workaround for the StackOverflow.&lt;/p&gt;

&lt;p&gt;I started on an approach using an IdentityHashMap to track which objects had already been serialized and just write some kind of reference id instead, but never quite finished.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/jwagenleitner/groovy/commit/673873d7b1828f849c8a4212cbaceaa9bd8175d2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jwagenleitner/groovy/commit/673873d7b1828f849c8a4212cbaceaa9bd8175d2&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15275507" author="andre.steingress" created="Sun, 8 May 2016 07:39:03 +0000"  >&lt;p&gt;Thanks for the fast feedback, John.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I started on an approach using an IdentityHashMap to track which objects had already been serialized and just write some kind of reference id instead, but never quite finished.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I also thought about that, however, it seemed to introduce vast complexity and, to be honest, I wasn&apos;t even sure this can cover all the cases that can come up (e.g. an object is part of a list and later on the same object is part of a property - there would be the need to determine the rendering order or some way to reference the list object in JSON?), so property exclusions sounded much easier (when the disadvantages can be accepted) and provided some additional benefits.&lt;/p&gt;

&lt;p&gt;Anyone else has some feedback or should I keep going into the proposed direction?&lt;/p&gt;</comment>
                            <comment id="15275727" author="andre.steingress" created="Sun, 8 May 2016 20:39:36 +0000"  >&lt;p&gt;Squashed my latest commits on my branch (though still not done, I need to add more doc and additional argument validation to JsonOutput and I want to extend the JsonOutput testing a bit on that issue):&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/andresteingress/groovy/commit/3873a4929ed4772b9a641764300383517ce3eacb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/andresteingress/groovy/commit/3873a4929ed4772b9a641764300383517ce3eacb&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15283455" author="andre.steingress" created="Sat, 14 May 2016 06:54:11 +0000"  >&lt;p&gt;Latest (squashed) commit can be found here. I have to fix/tweak documentation for JsonOutput a bit, but overall the functionality should be ready:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/andresteingress/groovy/commit/3b72fe3584dafb764ba0ffeb67d8442b8a591767&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/andresteingress/groovy/commit/3b72fe3584dafb764ba0ffeb67d8442b8a591767&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15283566" author="jerrywiltse@gmail.com" created="Sat, 14 May 2016 14:04:08 +0000"  >&lt;p&gt;Does this happen to cover both Joda and Java8 time/date objects, or just Joda?&lt;/p&gt;</comment>
                            <comment id="15605894" author="jwagenleitner" created="Tue, 25 Oct 2016 17:15:25 +0000"  >&lt;p&gt;A workaround for this in 2.5 would be the use of the new &lt;tt&gt;JsonGenerator&lt;/tt&gt;.  A custom converter could be registered to handle correctly outputting the JodaTime or JSR310 dates.  &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.json.*

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.time.LocalDateTime
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; java.time.format.DateTimeFormatter.ISO_LOCAL_DATE_TIME

def generator = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JsonGenerator.Options()
                    .addConverter(LocalDateTime) {
                        &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;&lt;/span&gt; + it.format(ISO_LOCAL_DATE_TIME) + &lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&lt;/span&gt;&apos;&lt;/span&gt;
                    }
                    .build()

&lt;span class=&quot;code-comment&quot;&gt;// Following will produce StackOverflowError
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//JsonOutput.toJson(LocalDateTime.now())
&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;// Following will print (&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; example): &lt;span class=&quot;code-quote&quot;&gt;&quot;2016-10-25T10:08:42.539&quot;&lt;/span&gt;
&lt;/span&gt;println generator.toJson(LocalDateTime.now())
println &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JsonBuilder(LocalDateTime.now(), generator)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15606256" author="jerrywiltse@gmail.com" created="Tue, 25 Oct 2016 19:37:40 +0000"  >&lt;p&gt;In case you are not aware, there&apos;s also a ticket for Java8 time, same bug.&lt;/p&gt;

&lt;p&gt;Sent from my iPhone&lt;/p&gt;
</comment>
                            <comment id="15606426" author="jwagenleitner" created="Tue, 25 Oct 2016 20:41:32 +0000"  >&lt;p&gt;Thanks.  I tried searching but couldn&apos;t find any tickets for java.time and JSON.  If I come across it I&apos;ll be sure to update it with a comment.&lt;/p&gt;</comment>
                            <comment id="15606519" author="jerrywiltse@gmail.com" created="Tue, 25 Oct 2016 21:22:27 +0000"  >&lt;p&gt;Nvm, I commented in this ticket in May, but did not open another ticket. &lt;/p&gt;</comment>
                            <comment id="17468845" author="emilles" created="Tue, 4 Jan 2022 20:58:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/pull/1670/commits/924efcd480532480556413d8c12103c2ac890a15&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1670/commits/924efcd480532480556413d8c12103c2ac890a15&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13115372">GROOVY-8371</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13420631">GROOVY-10438</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 45 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2opyn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>