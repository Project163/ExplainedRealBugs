<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:32:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-6120] Verify error in class annotated with @Category if instance field is used</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-6120</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The following code fails with Verify error&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Mixin(Foo)
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Bar {}

@Category(Bar)
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; x = 5

    def foo() {
        print x &lt;span class=&quot;code-comment&quot;&gt;//verify error because of the field reference
&lt;/span&gt;    }
}

&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Bar().foo()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But if we use field &apos;x&apos; outside of &apos;Foo&apos; no errors happen&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Mixin(Foo)
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Bar {}

@Category(Bar)
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; x = 5

    def foo() {
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Bar().x = 4
print &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Bar().x &lt;span class=&quot;code-comment&quot;&gt;//prints 5&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So imho the first code snippet should not throw the error.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12816892">GROOVY-6120</key>
            <summary>Verify error in class annotated with @Category if instance field is used</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="melix">C&#233;dric Champeau</assignee>
                                    <reporter username="mxm-groovy">Maxim Medvedev</reporter>
                        <labels>
                            <label>breaking</label>
                    </labels>
                <created>Wed, 24 Apr 2013 06:18:21 +0000</created>
                <updated>Wed, 17 Jun 2015 20:09:42 +0000</updated>
                            <resolved>Tue, 9 Jul 2013 03:15:05 +0000</resolved>
                                                    <fixVersion>2.2.0-beta-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14480264" author="paulk" created="Wed, 24 Apr 2013 18:41:54 +0000"  >&lt;p&gt;A workaround is to replace &quot;&lt;tt&gt;print x&lt;/tt&gt;&quot; with &quot;&lt;tt&gt;print this.x&lt;/tt&gt;&quot;.&lt;/p&gt;</comment>
                            <comment id="14474433" author="melix" created="Thu, 25 Apr 2013 10:01:36 +0000"  >&lt;p&gt;It&apos;s a bit strange to see both &lt;tt&gt;@Category&lt;/tt&gt; and &lt;tt&gt;@Mixin&lt;/tt&gt; here. The &lt;tt&gt;@Category&lt;/tt&gt; AST transformation will turn:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Category(Bar)
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
    def foo() {
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;into:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; def foo(Bar self) {
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you put a field in the category class, like here, then it&apos;s at best unsafe. Currently the transform doesn&apos;t touch fields. So you end up with:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; x = 5
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; def foo(Bar self) {
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When you use a category:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;use(Foo) {
   bar.foo()
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There&apos;s no instance of &lt;tt&gt;Foo&lt;/tt&gt; which is created, so using a field is not appropriate. We could transform fields into static fields, but it would be IMHO unsafe (shared mutable static state).&lt;/p&gt;

&lt;p&gt;My preference goes to forbid usage of fields into classes annotated with &lt;tt&gt;@Category&lt;/tt&gt;, which is a clear rule (no state allowed in categories, be it static or not).&lt;/p&gt;

&lt;p&gt;Another option would be to only allow static final fields of immutable types. In any case, you should not use fields in categories.&lt;/p&gt;</comment>
                            <comment id="14474400" author="mxm-groovy" created="Thu, 25 Apr 2013 12:28:33 +0000"  >&lt;p&gt;Ok. I didn&apos;t understand clear how @Category managed fields. My example showed that fields were possibly injected into &apos;Bar&apos; somehow.  &lt;/p&gt;

&lt;p&gt;So I agree that the best decision is to forbid instance fields in @Category classes.&lt;/p&gt;</comment>
                            <comment id="14480251" author="paulk" created="Fri, 26 Apr 2013 01:07:50 +0000"  >&lt;p&gt;The other alternative is to translate references that look like &lt;tt&gt;this.x&lt;/tt&gt; to &lt;tt&gt;self.x&lt;/tt&gt;. It would then make sense to &lt;em&gt;mixin&lt;/em&gt; such classes (and would avoid resorting to unsafe/static alternatives) but possibly is difficult to explain in terms of normal &lt;tt&gt;@Category&lt;/tt&gt; usage.&lt;/p&gt;</comment>
                            <comment id="14474372" author="melix" created="Fri, 26 Apr 2013 02:50:40 +0000"  >&lt;p&gt;Here&apos;s the pull request: &lt;a href=&quot;https://github.com/groovy/groovy-core/pull/173&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/groovy/groovy-core/pull/173&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We&apos;re still unsure in what version of Groovy we should integrate the fix, since it&apos;s a potential (but low risk) breaking change.&lt;/p&gt;</comment>
                            <comment id="14474693" author="melix" created="Tue, 9 Jul 2013 03:15:05 +0000"  >&lt;p&gt;Merged PR&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 20 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cn3z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>