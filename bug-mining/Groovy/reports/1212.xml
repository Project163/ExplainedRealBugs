<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:15:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-4075] shouldFailWithCause no longer works for unchecked exceptions</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-4075</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;So we upgraded from 1.6.3 to Groovy 1.7.0 and realized that one of our tests started failing... it seems that in 1.7.0 unchecked exceptions are simply rethrown (groovy.lang.Closure#throwRuntimeException(Throwable) called from #call(Object[])). Which in groovy.util.GroovyTestCase#shouldFailWithCause(Class,Closure), the exception falls to the catch Throwable branch and the cause is not attempted to be determined beyond that, which causes the test to fail.&lt;/p&gt;

&lt;p&gt;Example test showing a successful checked and unsuccessful unchecked exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; dummy;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.util.GroovyTestCase;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.Test;

/**
 * Demonstrates cases of should fail with cause.
 * @author Charlie Huggard-Lee 
 */
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;DummyTest &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; GroovyTestCase {
    
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void failChecked() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Exception(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException());
    }
    
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void failUnchecked() {
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException());
    }
    
    
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testcheckedFailure() {
        &lt;span class=&quot;code-comment&quot;&gt;//Hurray!
&lt;/span&gt;        shouldFailWithCause(IOException.class, {DummyTest.failChecked()})    
    }
    
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testuncheckedFailure() {
        &lt;span class=&quot;code-comment&quot;&gt;//BOO!!!
&lt;/span&gt;        shouldFailWithCause(IOException.class, {DummyTest.failUnchecked()})    
    }
    
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12815477">GROOVY-4075</key>
            <summary>shouldFailWithCause no longer works for unchecked exceptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roshandawrani">Roshan Dawrani</assignee>
                                    <reporter username="achuggardlee">Charlie Huggard-Lee</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Feb 2010 11:29:59 +0000</created>
                <updated>Wed, 7 Apr 2010 23:45:21 +0000</updated>
                            <resolved>Mon, 8 Mar 2010 00:21:12 +0000</resolved>
                                    <version>1.7.0</version>
                                    <fixVersion>1.7.2</fixVersion>
                    <fixVersion>1.8-beta-1</fixVersion>
                                        <due></due>
                            <votes>2</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14468905" author="roshandawrani" created="Tue, 23 Feb 2010 12:27:36 +0000"  >&lt;p&gt;I don&apos;t think it is related to groovy.lang.Closure#throwRuntimeException(Throwable) simply rethrowing unchecked exceptions. Even in 1.6.3, it does the same thing - &lt;a href=&quot;https://svn.codehaus.org/groovy/tags/GROOVY_1_6_3/src/main/groovy/lang/Closure.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.codehaus.org/groovy/tags/GROOVY_1_6_3/src/main/groovy/lang/Closure.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I think it is possibly related to - &lt;a href=&quot;http://fisheye.codehaus.org/browse/groovy/trunk/groovy/groovy-core/src/main/org/codehaus/groovy/reflection/CachedMethod.java?r1=12759&amp;amp;r2=17769&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://fisheye.codehaus.org/browse/groovy/trunk/groovy/groovy-core/src/main/org/codehaus/groovy/reflection/CachedMethod.java?r1=12759&amp;amp;r2=17769&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14469001" author="roshandawrani" created="Tue, 23 Feb 2010 12:46:17 +0000"  >&lt;p&gt;I am pretty sure that above mentioned change in CachedMethod exception handling is causing it.&lt;/p&gt;

&lt;p&gt;The above change was done on 1.7-beta-2. Upto 1.7-beta-1, the reported issue is not there. It&apos;s also not there on current 1.6.9 because this change was not done on 1.6.x line.&lt;/p&gt;</comment>
                            <comment id="14468926" author="roshandawrani" created="Sat, 6 Mar 2010 04:05:29 +0000"  >&lt;p&gt;Should we try to revert a part of changes from the above revision to fix the regression? &lt;/p&gt;

&lt;p&gt;The changes were done under &quot;faster exception handling&quot; thread - &lt;a href=&quot;http://marc.info/?l=groovy-dev&amp;amp;m=125412236814260&amp;amp;w=2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://marc.info/?l=groovy-dev&amp;amp;m=125412236814260&amp;amp;w=2&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14478924" author="paulk" created="Sat, 6 Mar 2010 09:59:43 +0000"  >&lt;p&gt;I suspect so.&lt;/p&gt;</comment>
                            <comment id="14469096" author="achuggardlee" created="Sat, 6 Mar 2010 11:25:49 +0000"  >&lt;p&gt;I&apos;ll readily admit I personally am relatively new to Groovy and this could indeed be a semantic issue requiring the partial reversion of the changes you cite. &lt;/p&gt;

&lt;p&gt;But the simplest solution to me seems to be to update shouldFailWithCause to reflect this change by making it closer to the shouldFail code and just evaluate cases based upon the cause instead of the throwable itself) somewhat like the following:  &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; shouldFailWithCause(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; clazz, Closure code) {
        Throwable th = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            code.call();
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (GroovyRuntimeException gre) {
            th = ScriptBytecodeAdapter.unwrap(gre);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) {
            th = e;
        }
        
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (th==&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;Closure &quot;&lt;/span&gt; + code + &lt;span class=&quot;code-quote&quot;&gt;&quot; should have failed&quot;&lt;/span&gt;);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            th = th.getCause();
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (th==&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;Closure &quot;&lt;/span&gt; + code + &lt;span class=&quot;code-quote&quot;&gt;&quot; should have failed with an exception cause of type &quot;&lt;/span&gt; + clazz.getName());
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (! clazz.isInstance(th)) {
                fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;Closure &quot;&lt;/span&gt; + code + &lt;span class=&quot;code-quote&quot;&gt;&quot; should have failed with an exception cause of type &quot;&lt;/span&gt; + clazz.getName() + &lt;span class=&quot;code-quote&quot;&gt;&quot;, instead got Exception &quot;&lt;/span&gt; + th);
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; th.getMessage();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14469082" author="roshandawrani" created="Sat, 6 Mar 2010 18:31:42 +0000"  >&lt;p&gt;I looked into the patch and it fails to handle MissingProperyException / MissingMethodException, as shown in the code below&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;PatchTest &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; GroovyTestCase {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testMissingProperty() {
        def foo = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Foo()
        shouldFailWithCause(MissingPropertyException) {
            foo.bar
        }
    }
    
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testMissingMethod() {
        def foo = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Foo()
        shouldFailWithCause(MissingMethodException) {
            foo.roshan()
        }
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14469104" author="achuggardlee" created="Sat, 6 Mar 2010 22:23:35 +0000"  >&lt;p&gt;Re: the Missing*Exceptions... &lt;/p&gt;

&lt;p&gt;I thought those cases are supposed covered under shouldFail(Class,Closure) instead of shouldFailWithCause(Class,Closure) since those are the exceptions that are directly thrown:&lt;/p&gt;

&lt;p&gt;E.g. new Foo().roshan() throws an exception without a cause:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testMissingMethodException() {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Foo().roshan()
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Error(&lt;span class=&quot;code-quote&quot;&gt;&quot;no failure&quot;&lt;/span&gt;)
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;(MissingMethodException e) {
            assertNull(e.getCause())
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14469066" author="roshandawrani" created="Sat, 6 Mar 2010 22:28:45 +0000"  >&lt;p&gt;There are unit test cases in groovy code base that explicitly test MissingPropertyException with shouldFailWithCause. I think the current implementation of shouldFailWithCause() has no problem if getCause() is null.&lt;/p&gt;</comment>
                            <comment id="14468988" author="roshandawrani" created="Sat, 6 Mar 2010 22:31:35 +0000"  >&lt;p&gt;And since it has not been having any problem handling exception cases with cause = null, making it so will cause another regression.&lt;/p&gt;</comment>
                            <comment id="14469090" author="achuggardlee" created="Sun, 7 Mar 2010 08:10:47 +0000"  >&lt;p&gt;I guess the root of this issue then is what is &apos;shouldFailWithCause&apos; supposed to assert about the passed Class and Closure and how is it different from shouldFail(Class,Closure)?&lt;/p&gt;

&lt;p&gt;Unfortunately we&apos;re running into having no javadoc on the method, the only other bug am currently finding that mentions shouldFailWithCause is &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-1247&quot; title=&quot;GroovyTestCase.shouldFail{} should return the message of the enclosed Exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-1247&quot;&gt;&lt;del&gt;GROOVY-1247&lt;/del&gt;&lt;/a&gt; (which seems to be related to return values), and fisheye unfortunately isn&apos;t helping find when it was added given that &lt;a href=&quot;http://fisheye.codehaus.org/browse/groovy/trunk/groovy/groovy-core/src/main/groovy/util/GroovyTestCase.java?r=HEAD&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;HEAD of GroovyTestCase currently indexed as r6778&lt;/a&gt; where the method does not exist yet...&lt;/p&gt;

&lt;p&gt;Based upon the naming convention, I interpreted shouldFailWithCause(Class,Closure) to mean that I expect a particular closure to throw any Throwable that has a cause of the specified class, thus distinguishing it from shouldFail(Class,Closure) which seems to asserts that the closure throws a Throwable of the specified class.&lt;/p&gt;

&lt;p&gt;The issue I have with shouldFailWithCause also handling the case where getCause() == null is that then we have a state where this one method sometimes makes an assertion about the thrown Throwable, and sometimes makes an assertion about the thrown Throwable&apos;s cause, making our tests unclear as to which is the case.&lt;/p&gt;

&lt;p&gt;If my interpretation of purpose behind shouldFailWithCause is true, then the tests were written incorrectly in the first place, and we should deliberately break them. If I&apos;m wrong, then we need to make sure to change shouldFailWithCause so that it only asserts one state since philosophically having a method that asserts multiple different states makes any test utilizing it ambiguous to begin with. (Since no matter what we&apos;ll wind up breaking someone with any change, we probably should slate it for groovy 1.8).&lt;/p&gt;

&lt;p&gt;And of course this is a separate discussion from whether or not the change to let RuntimeExceptions fall through as is was indeed correct. &lt;/p&gt;</comment>
                            <comment id="14469034" author="achuggardlee" created="Sun, 7 Mar 2010 09:00:32 +0000"  >&lt;p&gt;My Last argument in code... currently these two tests both succeed, and I assert that only one of them should since they are different states:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;HomerSimpson { 
    }
    
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testMissingMethodManual() {
        Closure code = {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MissingMethodException(&lt;span class=&quot;code-quote&quot;&gt;&quot;eatDonut&quot;&lt;/span&gt;, HomerSimpson, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[0] )
        }
        shouldFailWithCause(MissingMethodException.class, code)
    }
    
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testMissingMethodSecond() {
        Closure code = {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Exception(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MissingMethodException(&lt;span class=&quot;code-quote&quot;&gt;&quot;preventMeltdown&quot;&lt;/span&gt;, HomerSimpson, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[0] ))
        }
        shouldFailWithCause(MissingMethodException.class, code)
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14469097" author="achuggardlee" created="Sun, 7 Mar 2010 10:07:58 +0000"  >&lt;p&gt;Wait... I&apos;m an idiot... shouldFailWithCause tests that the last cause is of the specified type... (is this correct?)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testIOExceptionFirst() {
        Closure code = { &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException() }
        shouldFailWithCause(IOException.class, code)
    }
    
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testIOExceptionSecond() {
        Closure code = {&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Exception(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException()) }
        shouldFailWithCause(IOException.class, code)
    }
    
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testIOExceptionThird() {
        Closure code = { &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Exception(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Exception(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException())) }
        shouldFailWithCause(IOException.class, code)
    }
    
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testIOExceptionFourth() {
        Closure code = { &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Exception(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Exception(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Exception(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException()))) }
        shouldFailWithCause(IOException.class, code)
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14469020" author="achuggardlee" created="Sun, 7 Mar 2010 10:18:53 +0000"  >&lt;p&gt;Considering &lt;a href=&quot;#action_212964&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;my last comment&lt;/a&gt; how about this then:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; shouldFailWithCause(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; clazz, Closure code) {
        Throwable th = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            code.call();
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) {
            th = e;
            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;(th.getCause()!=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                th = th.getCause();
            }
        }
        
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (th==&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;Closure &quot;&lt;/span&gt; + code + &lt;span class=&quot;code-quote&quot;&gt;&quot; should have failed with an exception caused by type &quot;&lt;/span&gt; + clazz.getName());
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (! clazz.isInstance(th)) {
            fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;Closure &quot;&lt;/span&gt; + code + &lt;span class=&quot;code-quote&quot;&gt;&quot; should have failed with an exception caused by type &quot;&lt;/span&gt; + clazz.getName() + &lt;span class=&quot;code-quote&quot;&gt;&quot;, instead got Exception &quot;&lt;/span&gt; + th);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; th.getMessage();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14469044" author="roshandawrani" created="Mon, 8 Mar 2010 00:21:12 +0000"  >&lt;p&gt;The last patch looked ok to me and I have applied it. Thanks.&lt;/p&gt;</comment>
                            <comment id="14478943" author="paulk" created="Tue, 9 Mar 2010 02:31:49 +0000"  >&lt;p&gt;I am not sure the logic is correct here as patched. Pondering ...&lt;/p&gt;</comment>
                            <comment id="14478934" author="paulk" created="Tue, 9 Mar 2010 03:32:06 +0000"  >&lt;p&gt;The following test used to work but now fails with the latest patch:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyTest &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; GroovyTestCase {
  def throwWrappedException() {
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyRuntimeException(
      &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NullPointerException()
      )
    )
  }
  void testBefore() {
    shouldFailWithCause(IllegalArgumentException) {
      throwWrappedException()
    }
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think the original intention of this method was to strip away any layers of Groovy wrapping and proceed from there but changes in the way we do things make shouldFail have that characteristic now. I think the best semantics would now be to detect the cause anywhere in the hierarchy.&lt;/p&gt;</comment>
                            <comment id="14478950" author="paulk" created="Tue, 9 Mar 2010 05:17:32 +0000"  >&lt;p&gt;My suggested additional fix is attached (though needs javadoc!). All tests pass. But I think PropertyTest should just be shouldFail anyway (which also passes). I suspect PropertyTest was only the other way because of legacy problems with shouldFail which no longer exist.&lt;/p&gt;</comment>
                            <comment id="14478937" author="paulk" created="Tue, 9 Mar 2010 05:22:38 +0000"  >&lt;p&gt;One aspect that I wasn&apos;t sure which way to go was whether to check the top-level exception against the cause we are looking for. I ended up going that way because the first exception we see might be further wrapped as the cause for some GroovyRuntimeException and hence might be the cause without us knowing it.&lt;/p&gt;</comment>
                            <comment id="14469121" author="roshandawrani" created="Tue, 9 Mar 2010 05:45:01 +0000"  >&lt;p&gt;Another option would be to revert back all changes to shouldFailWithCause() that we have made here and solve it by reverting part of the &quot;faster exception handling&quot; change, as earlier discussed here.&lt;/p&gt;

&lt;p&gt;Or, we can stick to the new patch and define the behavior at this point with a proper javadoc so that the intended behavior does not need to be guessed in future and stick with it.&lt;/p&gt;</comment>
                            <comment id="14478971" author="paulk" created="Tue, 9 Mar 2010 05:52:49 +0000"  >&lt;p&gt;I am +1 for the second of these:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;We can stick to the new patch and define the behavior at this point with a proper javadoc so that the intended behavior does not need to be guessed in future and stick with it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t think the original version was offering any significant value given the other changes that have taken place.&lt;/p&gt;</comment>
                            <comment id="14469088" author="roshandawrani" created="Tue, 9 Mar 2010 06:16:13 +0000"  >&lt;p&gt;Ok, let&apos;s do it - with a few lines of javadoc this time &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14469081" author="paulk" created="Tue, 9 Mar 2010 21:16:49 +0000"  >&lt;p&gt;Wasn&apos;t sure whether you wanted me to do it or not - so I went ahead and did it.&lt;/p&gt;</comment>
                            <comment id="14469046" author="roshandawrani" created="Tue, 9 Mar 2010 21:31:27 +0000"  >&lt;p&gt;I was looking for some help there due to the javadoc involved. I thought you were in a better position to explain it there due to the last issue you found there and the changes that you made.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="14478952" author="paulk" created="Wed, 10 Mar 2010 00:31:13 +0000"  >&lt;p&gt;No worries at all. Now just to work out why tests pass locally and on Bamboo JDK1.6 but fail on Bamboo JDK1.5?&lt;/p&gt;</comment>
                            <comment id="14469087" author="roshandawrani" created="Wed, 10 Mar 2010 02:02:30 +0000"  >&lt;p&gt;Paul, the JDK 1.5 builds are failing because in the tests you have used the following 2 constructors of IOException and the JDK 1.5 version of IOException does not have both of these.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;IOException(Throwable)

IOException(String, Throwable)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The tests need to use some other exception that has such suitable constructors in both JDK 1.5 and 1.6.&lt;/p&gt;</comment>
                            <comment id="14469124" author="roshandawrani" created="Wed, 10 Mar 2010 02:39:10 +0000"  >&lt;p&gt;Here is a suggestion for IOException replacement in tests : java.util.concurrent.ExecutionException - has both the needed constructors.&lt;/p&gt;</comment>
                            <comment id="14469095" author="paulk" created="Wed, 10 Mar 2010 02:42:08 +0000"  >&lt;p&gt;Yes, I ran the tests locally on 1.5 and spotted that too. Just fixing now ...&lt;/p&gt;</comment>
                            <comment id="14478959" author="paulk" created="Wed, 10 Mar 2010 06:01:56 +0000"  >&lt;p&gt;I ended up going with IllegalArgumentException. The other lesson learned from the CI logs was that we weren&apos;t seeing the full error message. It made sense to unwrap GroovyRuntimeExceptions and print out all of the exception messages in the error message. It also no longer made sense to compare against the top level exception as that is now the same as shouldFail. So I updated the logic and the javadoc.&lt;/p&gt;</comment>
                            <comment id="14478960" author="paulk" created="Thu, 11 Mar 2010 06:56:03 +0000"  >&lt;p&gt;Just chatting with Jochen. Apparently there is a use case that we have encountered in the past where an exception has itself as its own cause. Sounds bad style but we should handle this case gracefully in any case. I&apos;ll add in a check for this case too to avoid the possibility of an infinite loop.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12722505" name="GroovyTestCase_groovy4075.patch" size="1985" author="paulk_asert" created="Tue, 9 Mar 2010 05:17:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 37 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cnzz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>