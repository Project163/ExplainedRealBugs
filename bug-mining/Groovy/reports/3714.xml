<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:04:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-9185] groovyc doesn&apos;t keep RetentionPolicy in generated bytecode</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-9185</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ groovyc -v
Groovy compiler version 2.5.7
Copyright 2003-2019 The Apache Software Foundation. http:&lt;span class=&quot;code-comment&quot;&gt;//groovy-lang.org/
&lt;/span&gt;-------------------------------------------------------------------
$ cat MyAnnotation.groovy
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.lang.annotation.Retention
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.lang.annotation.RetentionPolicy

@Retention(RetentionPolicy.SOURCE)
@&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; MyAnnotation {}
-------------------------------------------------------------------
$ groovyc MyAnnotation.groovy &amp;amp;&amp;amp; javap -&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; -v MyAnnotation
Classfile /Users/zhb/Projects/tmp/groovy-anno/MyAnnotation.class
Last modified 3 Jul 2019; size 146 bytes
MD5 checksum 485f011b0c78ff7b08bd0e03b1b429cd
Compiled from &lt;span class=&quot;code-quote&quot;&gt;&quot;MyAnnotation.groovy&quot;&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; MyAnnotation &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; java.lang.annotation.Annotation
minor version: 0
major version: 51
flags: (0x2601) ACC_PUBLIC, ACC_INTERFACE, ACC_ABSTRACT, ACC_ANNOTATION
this_class: #2 &lt;span class=&quot;code-comment&quot;&gt;// MyAnnotation
&lt;/span&gt;super_class: #4 &lt;span class=&quot;code-comment&quot;&gt;// java/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;
&lt;/span&gt;interfaces: 1, fields: 0, methods: 0, attributes: 1
Constant pool:
#1 = Utf8 MyAnnotation
#2 = &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; #1 &lt;span class=&quot;code-comment&quot;&gt;// MyAnnotation
&lt;/span&gt;#3 = Utf8 java/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;
#4 = &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; #3 &lt;span class=&quot;code-comment&quot;&gt;// java/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;
&lt;/span&gt;#5 = Utf8 java/lang/annotation/Annotation
#6 = &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; #5 &lt;span class=&quot;code-comment&quot;&gt;// java/lang/annotation/Annotation
&lt;/span&gt;#7 = Utf8 MyAnnotation.groovy
#8 = Utf8 SourceFile
{
}
SourceFile: &lt;span class=&quot;code-quote&quot;&gt;&quot;MyAnnotation.groovy&quot;&lt;/span&gt;

-------------------------------------------------------------------
$ cat MyJavaAnnotation.java
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.lang.annotation.Retention;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.lang.annotation.RetentionPolicy;

@Retention(RetentionPolicy.SOURCE)
@&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; MyJavaAnnotation {}
-------------------------------------------------------------------
$ javac MyJavaAnnotation.java &amp;amp;&amp;amp; javap -&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; -v MyJavaAnnotation
Classfile /Users/zhb/Projects/tmp/groovy-anno/MyJavaAnnotation.class
Last modified 3 Jul 2019; size 292 bytes
MD5 checksum c8ea8afe8f9fe148925db48177207f01
Compiled from &lt;span class=&quot;code-quote&quot;&gt;&quot;MyJavaAnnotation.java&quot;&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; MyJavaAnnotation &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; java.lang.annotation.Annotation
minor version: 0
major version: 55
flags: (0x2600) ACC_INTERFACE, ACC_ABSTRACT, ACC_ANNOTATION
this_class: #1 &lt;span class=&quot;code-comment&quot;&gt;// MyJavaAnnotation
&lt;/span&gt;super_class: #2 &lt;span class=&quot;code-comment&quot;&gt;// java/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;
&lt;/span&gt;interfaces: 1, fields: 0, methods: 0, attributes: 2
Constant pool:
#1 = &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; #11 &lt;span class=&quot;code-comment&quot;&gt;// MyJavaAnnotation
&lt;/span&gt;#2 = &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; #12 &lt;span class=&quot;code-comment&quot;&gt;// java/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;
&lt;/span&gt;#3 = &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; #13 &lt;span class=&quot;code-comment&quot;&gt;// java/lang/annotation/Annotation
&lt;/span&gt;#4 = Utf8 SourceFile
#5 = Utf8 MyJavaAnnotation.java
#6 = Utf8 RuntimeVisibleAnnotations
#7 = Utf8 Ljava/lang/annotation/Retention;
#8 = Utf8 value
#9 = Utf8 Ljava/lang/annotation/RetentionPolicy;
#10 = Utf8 SOURCE
#11 = Utf8 MyJavaAnnotation
#12 = Utf8 java/lang/&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;
#13 = Utf8 java/lang/annotation/Annotation
{
}
SourceFile: &lt;span class=&quot;code-quote&quot;&gt;&quot;MyJavaAnnotation.java&quot;&lt;/span&gt;
RuntimeVisibleAnnotations:
0: #7(#8=e#9.#10)
java.lang.annotation.Retention(
value=Ljava/lang/annotation/RetentionPolicy;.SOURCE
)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13242948">GROOVY-9185</key>
            <summary>groovyc doesn&apos;t keep RetentionPolicy in generated bytecode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="blindpirate">zhb</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Jul 2019 09:16:35 +0000</created>
                <updated>Fri, 6 Mar 2020 23:17:55 +0000</updated>
                            <resolved>Wed, 19 Feb 2020 05:16:35 +0000</resolved>
                                    <version>2.5.7</version>
                                    <fixVersion>2.4.19</fixVersion>
                    <fixVersion>2.5.10</fixVersion>
                    <fixVersion>4.0.0-alpha-1</fixVersion>
                    <fixVersion>3.0.2</fixVersion>
                                    <component>Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16919750" author="emilles" created="Fri, 30 Aug 2019 17:27:33 +0000"  >&lt;p&gt;&lt;tt&gt;RetentionPolicy.SOURCE&lt;/tt&gt; is the JVM default.  Is the retention policy also dropped for &lt;tt&gt;CLASS&lt;/tt&gt; or &lt;tt&gt;RUNTIME&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="16983820" author="emilles" created="Wed, 27 Nov 2019 18:49:00 +0000"  >&lt;p&gt;RetentionPolicy.SOURCE is the JVM&apos;s default.  RetentionPolicy.CLASS and RetentionPolicy.RUNTIME are written to the annotation class file.&lt;/p&gt;</comment>
                            <comment id="16986853" author="paulk" created="Tue, 3 Dec 2019 12:29:16 +0000"  >&lt;p&gt;Hmm. Just checked the current JLS. It says:&lt;br/&gt;
If&#160;&lt;em&gt;T&lt;/em&gt;&#160;does not have a (meta-)annotation&#160;&lt;em&gt;m&lt;/em&gt;&#160;that corresponds to&#160;&lt;tt&gt;annotation.Retention&lt;/tt&gt;, then a Java compiler must treat&#160;&lt;em&gt;T&lt;/em&gt;&#160;as if it does have such a meta-annotation&#160;&lt;em&gt;m&lt;/em&gt;&#160;with an element whose value is&#160;&lt;tt&gt;annotation.RetentionPolicy.CLASS&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17038028" author="paulk" created="Mon, 17 Feb 2020 01:24:15 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (retention in [&lt;span class=&quot;code-quote&quot;&gt;&apos;&apos;, &apos;&lt;/span&gt;@Retention(SOURCE)&lt;span class=&quot;code-quote&quot;&gt;&apos;, &apos;&lt;/span&gt;@Retention(CLASS)&lt;span class=&quot;code-quote&quot;&gt;&apos;, &apos;&lt;/span&gt;@Retention(RUNTIME)&apos;]) {
    def src = &quot;&quot;&quot;
        &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.lang.annotation.Retention;
        &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; java.lang.annotation.RetentionPolicy.*;
        $retention
        @&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; MyAnnotation {}
    &quot;&quot;&quot;
    def mag = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyClassLoader().parseClass src
    def maj = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; org.apache.groovy.util.JavaShell().compile &lt;span class=&quot;code-quote&quot;&gt;&apos;MyAnnotation&apos;&lt;/span&gt;, src
    println &lt;span class=&quot;code-quote&quot;&gt;&quot;G:$mag.annotations J:$maj.annotations&quot;&lt;/span&gt;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;results in:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;G:[] J:[]
G:[] J:[@java.lang.annotation.Retention(value=SOURCE)]
G:[@java.lang.annotation.Retention(value=CLASS)] J:[@java.lang.annotation.Retention(value=CLASS)]
G:[@java.lang.annotation.Retention(value=RUNTIME)] J:[@java.lang.annotation.Retention(value=RUNTIME)]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So it seems like we should follow Java behavior here.&lt;/p&gt;</comment>
                            <comment id="17038035" author="paulk" created="Mon, 17 Feb 2020 01:49:53 +0000"  >&lt;p&gt;And using a Groovy annotation with source retention annotation seems to default to CLASS as per the JLS, so it seems like it is needed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@JavaSourceRetentionAnno
@GroovySourceRetentionAnno
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;UseAnno { }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;results in javap output like:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SourceFile: &quot;UseAnno.groovy&quot;
RuntimeInvisibleAnnotations:
  0: #8()
    GroovySourceRetentionAnno
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We could arguably leave it out for the CLASS case but I am inclined to follow &lt;tt&gt;javac&lt;/tt&gt; also in that case.&lt;/p&gt;</comment>
                            <comment id="17039707" author="paulk" created="Wed, 19 Feb 2020 05:17:12 +0000"  >&lt;p&gt;Behavior should be the same as in Java now. Thanks for spotting the issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 38 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z04c1k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>