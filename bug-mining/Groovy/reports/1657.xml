<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:23:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-4457] generic type declarations leaking across all files in a build</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-4457</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Simple file, A.groovy:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;A&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; {
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;B {
  void foo(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s) {}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;groovyc A.groovy&lt;br/&gt;
javap -private B | grep foo&lt;/p&gt;

&lt;p&gt;produces:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void foo(java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &apos;String&apos; is treated as a type parameter name.  The reference &apos;String&apos; in the foo method is mapped to this type parameter (clearly it shouldn&apos;t be) and when producing the code, String is erased to its upper bound of Object, hence foo(Object) in the bytecode.&lt;/p&gt;

&lt;p&gt;Change it to this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;A&amp;lt;T&amp;gt; {
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;B {
  void foo(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s) {}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and it produces what you expect:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void foo(java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem is the genericParameterNames collection in the ResolveVisitor is never cleared, only augmented with new entries.&lt;/p&gt;

&lt;p&gt;My solution that seems to work in groovy eclipse is to clear the parameter names at the end of visiting a classnode in ResolveVisitor. So at the end of&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void visitClass(ClassNode node) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;add&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;genericParameterNames.clear();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12812178">GROOVY-4457</key>
            <summary>generic type declarations leaking across all files in a build</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="melix">C&#233;dric Champeau</assignee>
                                    <reporter username="aclement">Andy Clement</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 Oct 2010 17:21:33 +0000</created>
                <updated>Sat, 24 Dec 2011 03:08:01 +0000</updated>
                            <resolved>Fri, 9 Dec 2011 03:03:28 +0000</resolved>
                                    <version>1.7.5</version>
                                    <fixVersion>1.8.5</fixVersion>
                    <fixVersion>2.0-beta-2</fixVersion>
                    <fixVersion>1.7.11</fixVersion>
                                    <component>Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14470145" author="roshandawrani" created="Mon, 4 Oct 2010 22:44:22 +0000"  >&lt;p&gt;I can later look into it a bit more to confirm but on a quick glance, I think that the solution suggested may not work when there are (anonymous)inner classes involved where outer class&apos; generic parameter names remain valid inside the inner classes too.&lt;/p&gt;

&lt;p&gt;We don&apos;t want to end visitClass() for an inner class and clear the genericParameterNames for the outer class as well.&lt;/p&gt;</comment>
                            <comment id="14470165" author="aclement" created="Tue, 5 Oct 2010 03:15:58 +0000"  >&lt;p&gt;Yep, after sleeping on it, you need to allow for inner classes to, I&apos;d probably just use a similar mechanic in visitClassNode that you already have in the visitConstructorOrMethod code.&lt;/p&gt;</comment>
                            <comment id="14470224" author="blackdrag" created="Tue, 5 Oct 2010 04:09:31 +0000"  >&lt;p&gt;a proposed Testcase:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;assertScript &quot;&quot;&quot;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;A&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; {}
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;B {
  void foo(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s) {}
}
&lt;span class=&quot;code-comment&quot;&gt;// use the name to check the class, since the error was that &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; was seen as 
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// a symbol resolved to &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;, not as the &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, thus a ...==&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; would
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// not have failed
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; B.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;methods.find{it.name==&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;}.parameterTypes[0].name.contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&quot;&lt;/span&gt;)
&quot;&quot;&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="14470269" author="roshandawrani" created="Tue, 5 Oct 2010 10:58:19 +0000"  >&lt;p&gt;As suspected, the fix seems to have impact on the generics handling for inner classes.&lt;/p&gt;

&lt;p&gt;The following code does not work now (doesn&apos;t even compile actually)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;A&amp;lt;T&amp;gt; {
    &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;B {
      void foo(T s) {}
    }
}
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; A.B.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;methods.find{it.name==&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;}.parameterTypes[0].name.contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It fails with&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;D:\Roshan\GroovyDevSetup\Workspace17x\TryGroovy\src\TryGroovy.groovy: 3: unable to resolve class T 
 @ line 3, column 16.
         void foo(T s) {}
                  ^

1 error
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14470166" author="aclement" created="Tue, 5 Oct 2010 12:50:32 +0000"  >&lt;p&gt;Indeed, I see that the visit to the inner class does not happen during the visit to the outerclass, it happens after the outer class has been finished with.  So the code from visitMethodOrConstructor cannot be used as when visiting the inner node the type variables of the outer have been forgotten.&lt;/p&gt;</comment>
                            <comment id="14470201" author="blackdrag" created="Tue, 5 Oct 2010 12:52:18 +0000"  >&lt;p&gt;There are possibly 3 solutions to the inner class problem. &lt;br/&gt;
(1) add a map to the inner class and set it from the resolve visitor and reuse it when parsing the inner class&lt;br/&gt;
(2) have some kind of memory persistent map ClassNode-&amp;gt;SymbolMap.... I absolutely don&apos;t like this one&lt;br/&gt;
(3) start the resolving of inner classes after the outer class is done, without using the normal iteration used by CompilationUnit.&lt;/p&gt;

&lt;p&gt;I prefer number 3 since it does not require keeping additional information in the AST. &lt;/p&gt;</comment>
                            <comment id="14470369" author="graemerocher" created="Fri, 29 Oct 2010 04:17:12 +0000"  >&lt;p&gt;Any progress on this?&lt;/p&gt;</comment>
                            <comment id="14470287" author="blackdrag" created="Fri, 29 Oct 2010 05:05:12 +0000"  >&lt;p&gt;since Roshan seems not to have capacity to fix this (which is not his fault), there is no progress atm&lt;/p&gt;</comment>
                            <comment id="14470298" author="blackdrag" created="Fri, 29 Oct 2010 05:06:09 +0000"  >&lt;p&gt;I guess someone else will have to take this over, unless Roshan says he still wants to fix this one&lt;/p&gt;</comment>
                            <comment id="14470265" author="aclement" created="Fri, 29 Oct 2010 09:45:41 +0000"  >&lt;p&gt;If I can find time, I&apos;ll take a proper look at the right fix.&lt;/p&gt;</comment>
                            <comment id="14472092" author="melix" created="Tue, 6 Dec 2011 05:07:05 +0000"  >&lt;p&gt;Master includes the fix which breaks the non static inner class case. I will try to commit a fix.&lt;/p&gt;</comment>
                            <comment id="14472153" author="melix" created="Tue, 6 Dec 2011 05:52:40 +0000"  >&lt;p&gt;Here is the patch against master. Added a unit test for the non static inner class case. If you are ok, I will commit it.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12721719" name="GROOVY-4457.patch" size="68548" author="melix" created="Tue, 6 Dec 2011 05:52:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 51 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c0lr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>