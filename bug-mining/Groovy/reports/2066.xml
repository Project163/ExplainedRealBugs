<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:30:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-5775] XmlTemplateEngine does not escape expression values (part 1)</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-5775</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I would expect the following script to run without problems, but it does not:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.text.*

def xmlEngine = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; XmlTemplateEngine()
def xml = &apos;&apos;&apos;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt;?&amp;gt;
&amp;lt;users xmlns:gsp=&lt;span class=&quot;code-quote&quot;&gt;&apos;http:&lt;span class=&quot;code-comment&quot;&gt;//groovy.codehaus.org/2005/gsp&apos;&lt;/span&gt;&amp;gt;
&lt;/span&gt;    &amp;lt;gsp:scriptlet&amp;gt;users.each {&amp;lt;/gsp:scriptlet&amp;gt;
        &amp;lt;user id=&lt;span class=&quot;code-quote&quot;&gt;&quot;${it.id}&quot;&lt;/span&gt;&amp;gt;&amp;lt;gsp:expression&amp;gt;it.name&amp;lt;/gsp:expression&amp;gt;&amp;lt;/user&amp;gt;
        &amp;lt;foo1&amp;gt;&apos;&amp;lt;/foo1&amp;gt;
        &amp;lt;foo2&amp;gt;&quot;&amp;lt;/foo2&amp;gt;
    &amp;lt;gsp:scriptlet&amp;gt;}&amp;lt;/gsp:scriptlet&amp;gt;
&amp;lt;/users&amp;gt;&apos;&apos;&apos;
def xmlBinding = [users: [
    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Expando(id: 1, name: &lt;span class=&quot;code-quote&quot;&gt;&apos;mr &amp;amp; &quot; haki&apos;&lt;/span&gt;),
    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Expando(id: 2, name: &lt;span class=&quot;code-quote&quot;&gt;&quot;Hub &amp;lt; &amp;gt; &apos; ert&quot;&lt;/span&gt;)]
]
def xmlOutput = xmlEngine.createTemplate(xml).make(xmlBinding).toString()
println xmlOutput
def root = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; XmlParser().parseText(xmlOutput)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Error:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[Fatal Error] :3:9: The entity name must immediately follow the &apos;&amp;amp;&apos; in the entity reference.

Reason: the strings from the expandos are not escaped by the XmlTemplateEngine
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>Windows 7 32 bit</environment>
        <key id="12818195">GROOVY-5775</key>
            <summary>XmlTemplateEngine does not escape expression values (part 1)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="xn137">Christopher</reporter>
                        <labels>
                            <label>xmltemplateengine</label>
                    </labels>
                <created>Wed, 31 Oct 2012 05:12:10 +0000</created>
                <updated>Sun, 13 Jan 2013 04:02:59 +0000</updated>
                            <resolved>Sun, 13 Jan 2013 04:02:53 +0000</resolved>
                                    <version>2.0.4</version>
                                    <fixVersion>2.1.0-rc-1</fixVersion>
                                    <component>XML Processing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14473338" author="xn137" created="Wed, 31 Oct 2012 05:16:12 +0000"  >&lt;p&gt;I am sorry for not using the wiki markup for the script, now I am unable to edit the description.&lt;/p&gt;</comment>
                            <comment id="14473315" author="melix" created="Wed, 31 Oct 2012 05:20:12 +0000"  >&lt;p&gt;Formatting tags&lt;/p&gt;</comment>
                            <comment id="14473445" author="xn137" created="Wed, 31 Oct 2012 05:51:50 +0000"  >&lt;p&gt;Thinking about it, maybe it works as intended (when I want to template on XML level i.e. if i want to use entities then i have to escape them first).&lt;br/&gt;
But there should be an easy way to enable escaping (since i dont want to escape every string property of the objects in the binding myself).&lt;br/&gt;
This could be done by setting up the XmlTemplateEngine differently or by an additional attribute on the gsp:expression tag.&lt;/p&gt;</comment>
                            <comment id="14473317" author="xn137" created="Tue, 6 Nov 2012 02:03:25 +0000"  >&lt;p&gt;If I get a hint about the direction it should go, I will try to provide the patch myself.&lt;/p&gt;</comment>
                            <comment id="14473613" author="pschumacher" created="Fri, 4 Jan 2013 05:33:05 +0000"  >&lt;p&gt;@Paul King:&lt;br/&gt;
Any hints for Chris?&lt;/p&gt;</comment>
                            <comment id="14480084" author="paulk" created="Sun, 6 Jan 2013 05:23:22 +0000"  >&lt;p&gt;My suspicions are that XML escaping to cover all scenarios (Japanese characters, entities in external DTDs, surrogate pairs, control characters etc.) is probably best left to a specialist XML library. But the vast majority of times just simple escaping is probably all that is required. So I provided a couple of utility methods in XmlUtil (escapeXml and escapeControlCharacters) but didn&apos;t hard-bake these into the template engine. So for your example you would need to have (assuming static imports):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Expando(id: 1, name: escapeXml(&lt;span class=&quot;code-quote&quot;&gt;&apos;mr &amp;amp; &quot; haki&apos;&lt;/span&gt;)),
&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Expando(id: 2, name: escapeXml(&lt;span class=&quot;code-quote&quot;&gt;&quot;Hub &amp;lt; &amp;gt; &apos; ert&quot;&lt;/span&gt;))]
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Let me know if this seems OK. My feeling is that this should resolve the issue. For people with more elaborate requirements, they would be free to use Apache Commons Lang or the Google Guava XML escaping mechanisms or roll their own - e.g. escapeXml uses StringGroovyMethods#collectReplacements(String orig, Closure transform) under the covers and a custom transform Closure could be supplied if needed.&lt;/p&gt;</comment>
                            <comment id="14473841" author="pschumacher" created="Thu, 10 Jan 2013 11:13:35 +0000"  >&lt;p&gt;should probably have fix version 2.1.0-rc-1&lt;/p&gt;</comment>
                            <comment id="14473789" author="xn137" created="Fri, 11 Jan 2013 04:09:00 +0000"  >&lt;p&gt;Thanks for your replies.&lt;br/&gt;
Of course I know that in order to &quot;resolve the issue&quot; I can somehow escape the strings in the objects myself before using them with the XmlTemplateEngine.&lt;/p&gt;

&lt;p&gt;The question of this bug report is more why XML processing with XmlTemplateEngine requires the user to care for string escaping himself and wether it would be an improvement to be able to setup the engine to take care of simple escaping scenarios.&lt;/p&gt;

&lt;p&gt;For me it was unexpected that I have to escape every string that is part of the binding object tree myself in order to use the XmlTemplateEngine.&lt;br/&gt;
In the example, if i have a bunch of user objects and I want to output their information/adresses etc. into a XML structure i dont want to escape the string properties in the objects before using the engine and i dont want to explicitly put escaping-function calls into every gsp:expression in the template.&lt;/p&gt;

&lt;p&gt;How about&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def xmlEngine = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; XmlTemplateEngine()
xml.enableEscaping = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and then something like&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;gsp:expression&amp;gt;&lt;/span&gt;it.name&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/gsp:expression&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;gsp:expression escape=&lt;span class=&quot;code-quote&quot;&gt;&quot;on&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;it.adress&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/gsp:expression&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;gsp:expression escape=&lt;span class=&quot;code-quote&quot;&gt;&quot;off&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;it.rawxml&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/gsp:expression&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14480099" author="paulk" created="Sun, 13 Jan 2013 03:58:36 +0000"  >&lt;p&gt;rename in preparation of cloning another issue to handle any further work&lt;/p&gt;</comment>
                            <comment id="14480108" author="paulk" created="Sun, 13 Jan 2013 04:02:53 +0000"  >&lt;p&gt;Utility method is now available to make basic escaping easier&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310260">
                    <name>Related</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12818217">GROOVY-5903</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 45 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cqcf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>