<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:04:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-9368] Breaking change regarding jointCompilationOptions</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-9368</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Actually this could just be a question, then sorry.&lt;br/&gt;
 But I have the strong feeling that this change was unintended.&lt;/p&gt;

&lt;p&gt;The Spock AST transformations complain if a specification has a constructor, as this is not what a user should do.&lt;/p&gt;

&lt;p&gt;In case of joint compilation though Groovy adds a no-arg constructor.&lt;br/&gt;
 Before Groovy 1.7 this was marked as synthetic and could thus be excluded from the check.&lt;/p&gt;

&lt;p&gt;After 1.7 this was changed to additionally allow a public no-arg constructor if joint compilation is used to heuristically find this situation.&lt;/p&gt;

&lt;p&gt;To detect joint compilation it is checked whether&#160;&lt;tt&gt;org.codehaus.groovy.control.CompilerConfiguration-getJointCompilationOptions&lt;/tt&gt; returns&#160;&lt;tt&gt;null&lt;/tt&gt; or not.&lt;/p&gt;

&lt;p&gt;In Groovy 2 this method only return non-&lt;tt&gt;null&lt;/tt&gt; if joint compilation is used.&lt;br/&gt;
 In Groovy 3 this changed.&lt;br/&gt;
 The field still has a JavaDoc comment saying &lt;tt&gt;options for joint compilation (null by default == no joint compilation)&lt;/tt&gt;, but the method never had such a guarantee in its JavaDoc and now the field is always set in the constructor, but only filled if joint comiplation is used which breaks the recognition code of course.&lt;/p&gt;

&lt;p&gt;So is the correct way to now check for &lt;tt&gt;null&lt;/tt&gt; or empty, or is this actually a regression and the method should still return &lt;tt&gt;null&lt;/tt&gt; for plain compilation? Maybe it would also make sense to document either way at the method or to provide a dedicated method that returns whether joint compilation is used.&lt;/p&gt;

&lt;p&gt;(Actually even better would be a way to safely recognize constructors added by the compiler.)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13280075">GROOVY-9368</key>
            <summary>Breaking change regarding jointCompilationOptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="vampire">Bj&#246;rn Kautler</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Jan 2020 08:41:42 +0000</created>
                <updated>Fri, 21 Feb 2020 03:48:38 +0000</updated>
                            <resolved>Wed, 22 Jan 2020 17:04:56 +0000</resolved>
                                    <version>3.0.0-rc-3</version>
                                    <fixVersion>3.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="17018240" author="daniel_sun" created="Fri, 17 Jan 2020 18:38:59 +0000"  >&lt;p&gt;Please try to check  with the following code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
jointCompilationOptions.isEmpty()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17018414" author="vampire" created="Fri, 17 Jan 2020 23:51:12 +0000"  >&lt;p&gt;Actually from what I see from the code, I&apos;d say the joint compilation options are:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;joint compilation and system property&#160;&lt;tt&gt;groovy.generate.stub.in.memory&lt;/tt&gt; set =&amp;gt;&#160;&lt;tt&gt;flags&lt;/tt&gt; and&#160;&lt;tt&gt;namedValues&lt;/tt&gt; set&lt;/li&gt;
	&lt;li&gt;joint compilation and system property&#160;&lt;tt&gt;groovy.generate.stub.in.memory&lt;/tt&gt; not set =&amp;gt;&#160;&lt;tt&gt;flags&lt;/tt&gt; and&#160;&lt;tt&gt;namedValues&lt;/tt&gt; set&lt;/li&gt;
	&lt;li&gt;non-joint compilation and system property&#160;&lt;tt&gt;groovy.generate.stub.in.memory&lt;/tt&gt; set =&amp;gt;&#160;&lt;tt&gt;memStub&lt;/tt&gt; set&lt;/li&gt;
	&lt;li&gt;non-joint compilation and system property&#160;&lt;tt&gt;groovy.generate.stub.in.memory&lt;/tt&gt; not set =&amp;gt; &lt;tt&gt;&amp;lt;empty&amp;gt;&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Besides that I&apos;m not sure whether the memStub property should really be ignored if joint compilation is used and only be set if non-joint compilation is used, especially as it is in a field that is called &lt;tt&gt;jointCompilationOptions&lt;/tt&gt;, testing for emptiness of the field is currently not a sign for joint compilation, but for joint compilation or that system property being set.&lt;/p&gt;</comment>
                            <comment id="17018603" author="daniel_sun" created="Sat, 18 Jan 2020 14:20:30 +0000"  >&lt;p&gt;memory stub is disabled by default for backward-compatibility, and can be enabled by &lt;tt&gt;jointCompilationOptions.memStub=true&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/blob/GROOVY_3_0_0_RC_3/src/main/java/org/codehaus/groovy/control/CompilerConfiguration.java#L445&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/blob/GROOVY_3_0_0_RC_3/src/main/java/org/codehaus/groovy/control/CompilerConfiguration.java#L445&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/blob/GROOVY_3_0_0_RC_3/src/main/java/org/codehaus/groovy/control/CompilerConfiguration.java#L459-L468&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/blob/GROOVY_3_0_0_RC_3/src/main/java/org/codehaus/groovy/control/CompilerConfiguration.java#L459-L468&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17018667" author="vampire" created="Sat, 18 Jan 2020 18:24:37 +0000"  >&lt;p&gt;Yes, that&apos;s what I said, isn&apos;t it &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daniel_sun&quot; class=&quot;user-hover&quot; rel=&quot;daniel_sun&quot;&gt;daniel_sun&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;If the system property &lt;tt&gt;groovy.generate.stub.in.memory&lt;/tt&gt; is set, the &lt;tt&gt;memStub&lt;/tt&gt; option will be set in &lt;tt&gt;jointCompilationOptions&lt;/tt&gt;, no matter whether joint compilation is used or not.&lt;/p&gt;</comment>
                            <comment id="17018669" author="vampire" created="Sat, 18 Jan 2020 18:26:45 +0000"  >&lt;p&gt;And if I didn&apos;t misread, it will never be used if joint compilation is used, because you set the option in the constructor and in &lt;tt&gt;FileSystemCompiler.CompilationOptions#toCompilerConfiguration&lt;/tt&gt; you overwrite the joint compilation options with &lt;tt&gt;flags&lt;/tt&gt; and &lt;tt&gt;namedValues&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17019014" author="emilles" created="Sun, 19 Jan 2020 18:59:23 +0000"  >&lt;p&gt;Joint compilation within &lt;tt&gt;groovyc&lt;/tt&gt; may be detectable, but I am unaware of any API to get such an answer.  &lt;tt&gt;groovy-eclipse-batch&lt;/tt&gt; performs joint compilation and probably does not give the same signal as &lt;tt&gt;groovyc&lt;/tt&gt; since it performs compilation of Java using &lt;tt&gt;ecj&lt;/tt&gt;, not &lt;tt&gt;javac&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I don&apos;t think it is a good idea to rely on null return of &lt;tt&gt;CompilerConfiguration#getJointCompilationOptions&lt;/tt&gt;.  But yes, I can see some spots in the code that did/do just that.&lt;/p&gt;</comment>
                            <comment id="17019055" author="emilles" created="Sun, 19 Jan 2020 23:07:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/4ed12ade3866662ea3cf5c9dc88f7277234c2415&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/4ed12ade3866662ea3cf5c9dc88f7277234c2415&lt;/a&gt;&#160;and&#160;&lt;a href=&quot;https://github.com/apache/groovy/commit/3405219599df308d49abd816ca348ca00e022b4a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/3405219599df308d49abd816ca348ca00e022b4a&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17019531" author="vampire" created="Mon, 20 Jan 2020 14:44:18 +0000"  >&lt;p&gt;&amp;gt; &lt;a href=&quot;https://github.com/apache/groovy/commit/4ed12ade3866662ea3cf5c9dc88f7277234c2415&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/4ed12ade3866662ea3cf5c9dc88f7277234c2415&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/groovy/commit/3405219599df308d49abd816ca348ca00e022b4a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/3405219599df308d49abd816ca348ca00e022b4a&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Isn&apos;t this still wrong?&lt;br/&gt;
As far as I read it, it is now like&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;joint compilation and system property&#160;&lt;tt&gt;groovy.generate.stub.in.memory&lt;/tt&gt; set =&amp;gt;&#160;&lt;tt&gt;flags&lt;/tt&gt; and&#160;&lt;tt&gt;namedValues&lt;/tt&gt; set&lt;/li&gt;
	&lt;li&gt;joint compilation and system property&#160;&lt;tt&gt;groovy.generate.stub.in.memory&lt;/tt&gt; not set =&amp;gt;&#160;&lt;tt&gt;flags&lt;/tt&gt; and&#160;&lt;tt&gt;namedValues&lt;/tt&gt; set&lt;/li&gt;
	&lt;li&gt;non-joint compilation and system property&#160;&lt;tt&gt;groovy.generate.stub.in.memory&lt;/tt&gt; set =&amp;gt;&#160;&lt;tt&gt;memStub&lt;/tt&gt; set&lt;/li&gt;
	&lt;li&gt;non-joint compilation and system property&#160;&lt;tt&gt;groovy.generate.stub.in.memory&lt;/tt&gt; not set =&amp;gt; &lt;tt&gt;null&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Which means only the last case changed.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;having a non-&lt;tt&gt;null&lt;/tt&gt; return value still means either joint compilation is used, or the system property is set&lt;/li&gt;
	&lt;li&gt;the system property is still not set if joint compilation is used, as the &lt;tt&gt;FileSystemCompiler&lt;/tt&gt; is still overwriting the constructor set &lt;tt&gt;jointCompilationOptions&lt;/tt&gt; with only &lt;tt&gt;flags&lt;/tt&gt; and &lt;tt&gt;namedValues&lt;/tt&gt; set and the setter just replaces the &lt;tt&gt;jointCompilationOptions&lt;/tt&gt; field.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&amp;gt; Joint compilation within groovyc may be detectable, but I am unaware of any API to get such an answer. groovy-eclipse-batch performs joint compilation and probably does not give the same signal as groovyc since it performs compilation of Java using ecj, not javac.&lt;/p&gt;

&lt;p&gt;Well, I guess for the Spock use-case this would still be sufficient isn&apos;t it?&lt;br/&gt;
Or can you recommend a better tactic.&lt;/p&gt;

&lt;p&gt;Let me shortly explain again.&lt;br/&gt;
Spock disallows user-written constructors in its AST transformation.&lt;br/&gt;
But in case of joint compilation (and I guess the ECJ case is different here), &lt;tt&gt;groovyc&lt;/tt&gt; adds an empty public no-arg constructor automatically.&lt;br/&gt;
It would be wrong to complain about this one as the user can only implicitly influence this.&lt;br/&gt;
Before Groovy 1.7 this generated constructor was marked &lt;tt&gt;synthetic&lt;/tt&gt; and could thus be recognized.&lt;br/&gt;
After that the joint compilation recognition was used to not complain about automatically generated empty public no-arg constructors.&lt;/p&gt;

&lt;p&gt;Actually even better would be a way to safely recognize constructors added by the compiler, then Spock wouldn&apos;t care whether joint compilation is used or not.&lt;/p&gt;</comment>
                            <comment id="17020185" author="vampire" created="Tue, 21 Jan 2020 12:23:40 +0000"  >&lt;p&gt;Ok, I answered my own question by reading the code.&lt;br/&gt;
When this check was introduced there was no other way to recognize the generated constructor.&lt;br/&gt;
But since 1.8 beta 1 there is &lt;tt&gt;hasNoRealSourcePosition&lt;/tt&gt; and since 3.0.0 beta 1 there is also the &lt;tt&gt;@Generated&lt;/tt&gt; annotation attached to the constructor to recognize it.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 43 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0alwg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>