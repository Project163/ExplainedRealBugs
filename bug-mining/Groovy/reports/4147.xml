<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:13:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-10102] Type checking fails when calling trait method using indirect SelfType relation</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-10102</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I am having trouble migrating a very large project from Groovy 2.4.x to 2.5.14.&lt;/p&gt;

&lt;p&gt;I was able to reproduce the problem with this small example:&lt;br/&gt;
 &#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.CompileStatic
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.SelfType
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.function.Supplier
@CompileStatic
 @SelfType([C])
 trait D {
 &#160; def go() {
 &#160;&#160;&#160; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s = foo
 &#160;&#160;&#160; withObject(s) {
 &#160;&#160;&#160;&#160;&#160; s.toUpperCase()
 &#160;&#160;&#160; }
&#160; }
 }

@SelfType(B)
@CompileStatic
trait C {}

@SelfType([A])
@CompileStatic
trait B {}

@CompileStatic
trait A {
 &#160; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; foo = &lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt;
&#160; def withObject(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s, Supplier&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; g) {
 &#160;&#160;&#160; s + g.get()
 &#160; }

}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Impl &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; A, B, C, D {
 &#160; def go() {

&#160;&#160;&#160; println withObject(foo) { &lt;span class=&quot;code-quote&quot;&gt;&apos; bar&apos;&lt;/span&gt; }

&#160; }
 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
 Compiling this code results in this error:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;src/main/groovy/bar/Foo.groovy: 13: [Static type checking] - Cannot find matching method &amp;lt;UnionType:bar.C+bar.D&amp;gt;#withObject(java.lang.String, groovy.lang.Closure). Please check if the declared type is correct and if the method exists.
 @ line 13, column 9.
 withObject(s) {
 ^

1 error

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It&apos;s easy to work around once you know how: just make the trait that calls `withObject` list the trait that provides that method in its `SelfType` directly, i.e. in this case:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@SelfType([A, C])
trait D { ... } 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Interestingly, changing D&apos;s self-type to `B` also works! It looks like the 2nd indirection is needed to reproduce the issue.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;However, figuring it out can take a long time! Would be nice to make this work automatically, maybe by just making `@SelfType(C)` equivalent to `@SelfType(C, B, A)` (i.e. merge the types by recursively applying other&apos;s self-types).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13379734">GROOVY-10102</key>
            <summary>Type checking fails when calling trait method using indirect SelfType relation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="renatoathaydes">Renato Athaydes</reporter>
                        <labels>
                            <label>traits</label>
                    </labels>
                <created>Fri, 21 May 2021 10:19:37 +0000</created>
                <updated>Thu, 22 Sep 2022 16:33:09 +0000</updated>
                            <resolved>Wed, 26 May 2021 15:06:38 +0000</resolved>
                                    <version>2.5.14</version>
                                    <fixVersion>4.0.0-beta-1</fixVersion>
                    <fixVersion>3.0.9</fixVersion>
                                    <component>Compiler</component>
                    <component>Static Type Checker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17351352" author="emilles" created="Tue, 25 May 2021 21:00:56 +0000"  >&lt;p&gt;I think the intent of &lt;tt&gt;groovy.transform.SelfType&lt;/tt&gt; is to indicate which non-trait classes your trait implementer is expected to descend from.  Like &lt;tt&gt;@SelfType(Number)&lt;/tt&gt; would indicate that a trait will be applied to number types.  Therefore you gain access to the methods from Number in your trait under STC.  &quot;... but that the trait cannot extend that type itself&quot; is the key phrase from the javadoc.&lt;/p&gt;

&lt;p&gt;Instead of &quot;@SelfType(A) trait B&quot;, you can combine using &quot;trait B extends A&quot; or &quot;trait B implements A&quot;.&lt;/p&gt;</comment>
                            <comment id="17351357" author="renatoathaydes" created="Tue, 25 May 2021 21:28:22 +0000"  >&lt;p&gt;I am aware that I could use &quot;extends&quot; but that doesn&apos;t really work well when there&apos;s a lot of traits that get combined in different ways.&lt;/p&gt;

&lt;p&gt;For example, take this example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
trait A {
    def foo() {}
}

trait B  &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; A {
    def bar() {}
}

trait C &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; A {}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Impl &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; B, C {

}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Even this extremely simple example causes a warning:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Traits B, C contain clashing methods with signature foo() 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We have much more intricate relationshipts between traits , so we decided to use SelfType in order to &quot;force&quot; implementing classes to explicitly determine the order in which traits should be applied, avoiding the accidental ordering caused by multiple traits extending the same basic traits and then being applied together on the same class.&lt;/p&gt;</comment>
                            <comment id="17351831" author="emilles" created="Wed, 26 May 2021 14:45:33 +0000"  >&lt;p&gt;Looks like &lt;tt&gt;Traits#collectSelfTypes&lt;/tt&gt;&#160;is the relevant code.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 24 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0r948:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>