<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:07:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-9603] Assignment of Map literal to Map element fails to compile (static)</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-9603</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Declare a Map&amp;lt;String,Object&amp;gt;. When trying to put a map literal into that map, assignments in property style (map.key = ...) and subscript style (map&lt;span class=&quot;error&quot;&gt;&amp;#91;key&amp;#93;&lt;/span&gt; = ...) fail with&lt;/p&gt;

&lt;p&gt;&lt;b&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Static type checking&amp;#93;&lt;/span&gt; - No such property: ... for class: java.lang.Object&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;First assigning to a local variable gives no such problems. If the Map were to contain objects of a specific type, coercion from map to that particular type would make sense. This coercion from Map to Object makes to sense. A Map is an Object and should simply become the new value for that particular key, which is just what is happening with regular compilation.&lt;/p&gt;

&lt;p&gt;Same for Map&amp;lt;String,?&amp;gt; and Map&amp;lt;String,? extends Object&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
@groovy.transform.CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; updateMap(Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; map) {
    &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; innerMap = [ foo: &lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;, bar: &lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt; ]
    &lt;span class=&quot;code-comment&quot;&gt;// No problem on &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; assignment
&lt;/span&gt;    map.someProp = innerMap
    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; map.someProp[&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;] == &lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;
    &lt;span class=&quot;code-comment&quot;&gt;// The next three lines should all be equivalent
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// but the 2nd and 3rd don&apos;t CompileStatic
&lt;/span&gt;    map.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;someProp&quot;&lt;/span&gt;, [ abc: &lt;span class=&quot;code-quote&quot;&gt;&quot;efg&quot;&lt;/span&gt; ])
    map[&lt;span class=&quot;code-quote&quot;&gt;&quot;someProp&quot;&lt;/span&gt;] = [ abc: &lt;span class=&quot;code-quote&quot;&gt;&quot;hij&quot;&lt;/span&gt; ]
    map.someProp = [ abc: &lt;span class=&quot;code-quote&quot;&gt;&quot;klm&quot;&lt;/span&gt; ]
    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; map.someProp[&lt;span class=&quot;code-quote&quot;&gt;&quot;abc&quot;&lt;/span&gt;] == &lt;span class=&quot;code-quote&quot;&gt;&quot;klm&quot;&lt;/span&gt;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13312608">GROOVY-9603</key>
            <summary>Assignment of Map literal to Map element fails to compile (static)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="eddelplus">Jochen Eddelbuettel</reporter>
                        <labels>
                    </labels>
                <created>Sat, 20 Jun 2020 11:40:15 +0000</created>
                <updated>Thu, 23 Jul 2020 14:16:25 +0000</updated>
                            <resolved>Tue, 23 Jun 2020 04:27:01 +0000</resolved>
                                    <version>3.0.3</version>
                    <version>3.0.4</version>
                    <version>2.5.12</version>
                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                    <fixVersion>3.0.5</fixVersion>
                    <fixVersion>2.5.13</fixVersion>
                                    <component>Static compilation</component>
                    <component>Static Type Checker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="17142105" author="emilles" created="Mon, 22 Jun 2020 14:38:15 +0000"  >&lt;p&gt;It looks like the compiler is interpreting &quot;map&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;key&amp;#39;&amp;#93;&lt;/span&gt; = &lt;span class=&quot;error&quot;&gt;&amp;#91;abc:&amp;#39;def&amp;#39;&amp;#93;&lt;/span&gt;&quot; as a situation where map literal is a shorthand for a constructor call followed by property sets.  I&apos;ll have a quick look to see why it does this for putAt and not put.&lt;/p&gt;

&lt;p&gt;You can add a typecast in front of the map literal to prevent this.&lt;/p&gt;</comment>
                            <comment id="17142121" author="emilles" created="Mon, 22 Jun 2020 14:47:29 +0000"  >&lt;p&gt;This is from StaticTypeCheckingVisitor:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void addMapAssignmentConstructorErrors(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ClassNode leftRedirect, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Expression leftExpression, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Expression rightExpression) {
        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; left type is not a list but right type is a map, then we&apos;re in the &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; of a groovy
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// constructor type : A a = [x:2, y:3]
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// In &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;, more checks can be performed
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!implementsInterfaceOrIsSubclassOf(leftRedirect, MAP_TYPE) &amp;amp;&amp;amp; rightExpression &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; MapExpression) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!(leftExpression &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; VariableExpression) || !((VariableExpression) leftExpression).isDynamicTyped()) {
                ArgumentListExpression argList = args(rightExpression);
                ClassNode[] argTypes = getArgumentTypes(argList);
                checkGroovyStyleConstructor(leftRedirect, argTypes, rightExpression);
                &lt;span class=&quot;code-comment&quot;&gt;// perform additional type checking on arguments
&lt;/span&gt;                MapExpression mapExpression = (MapExpression) rightExpression;
                checkGroovyConstructorMap(leftExpression, leftRedirect, mapExpression);
            }
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17142126" author="emilles" created="Mon, 22 Jun 2020 14:49:58 +0000"  >&lt;p&gt;Adding &quot;!leftRedirect.equals(OBJECT_TYPE) &amp;amp;&amp;amp; &quot; to the first check seems to shut down the errors.&#160; I can&apos;t think of a situation where you would want to create java.lang.Object from a map literal.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 21 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0g1tc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>