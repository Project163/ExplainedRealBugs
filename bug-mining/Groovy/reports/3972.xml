<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:10:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-9852] Result is already complete (IllegalStateException)</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-9852</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Steps:&lt;/p&gt;

&lt;p&gt;1 - Consider this reproducer &lt;a href=&quot;https://github.com/ptomaszek/vertx-groovy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ptomaszek/vertx-groovy&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;2 - Edit build.gradle and change vertxVersion to&#160;&apos;4.0.0.Beta1&apos; (uses Groovy 3.0.3)&lt;/p&gt;

&lt;p&gt;3 - Edit&#160;org.example.MainGroovy and replace the code of main method with the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Promise p = Promise.promise()
p.&lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;().onSuccess { println it }
p.complete(&lt;span class=&quot;code-quote&quot;&gt;&quot;Done with Groovy!!!&quot;&lt;/span&gt;)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The code runs fine.&lt;/p&gt;

&lt;p&gt;But, if in Step 2 the vertxVersion in build.gradle is changed to&#160;&apos;4.0.0.Beta2&apos; (uses Groovy 3.0.5), the code from Step 3 will fail with an IllegalStateException.&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.IllegalStateException: Result is already complete
 at io.vertx.core.Promise.complete(Promise.java:67)
 at io.vertx.core.Promise$complete$1.call(Unknown Source)
 at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCall(CallSiteArray.java:47)
 at org.codehaus.groovy.runtime.callsite.AbstractCallSite.call(AbstractCallSite.java:125)
 at org.codehaus.groovy.runtime.callsite.AbstractCallSite.call(AbstractCallSite.java:139)
 at org.example.MainGroovy.main(MainGroovy.groovy:17)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If you use @CompileStatic on main method with Step 3, with Beta2, it works fine. The @CompileStatic is not necessary to run well with Vert.x &apos;4.0.0.Beta1&apos;. A Java class with similar code will work using any version of Vert.x (Beta1, Beta2, Beta3, CR1....), so doesn&apos;t looks like a Java or Vertx issue.&lt;/p&gt;</description>
                <environment>Windows 10&lt;br/&gt;
OpenJDK Runtime Environment (AdoptOpenJDK)(build 1.8.0_272-b10)</environment>
        <key id="13344634">GROOVY-9852</key>
            <summary>Result is already complete (IllegalStateException)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="aaloise">Andr&#233; Filipe Aloise</reporter>
                        <labels>
                            <label>breaking</label>
                            <label>breaking_change</label>
                    </labels>
                <created>Mon, 7 Dec 2020 17:58:29 +0000</created>
                <updated>Mon, 27 Jan 2025 15:11:18 +0000</updated>
                            <resolved>Sun, 13 Dec 2020 06:06:48 +0000</resolved>
                                    <version>3.0.5</version>
                                    <fixVersion>4.0.0-alpha-3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="17245513" author="emilles" created="Mon, 7 Dec 2020 20:32:51 +0000"  >&lt;p&gt;Could you try this with Groovy 3.0.7?  There was a fix for the interface method selection of Promise vs Future.&lt;/p&gt;</comment>
                            <comment id="17245568" author="aaloise" created="Mon, 7 Dec 2020 22:56:53 +0000"  >&lt;p&gt;Vert.x 4.0 GA uses Groovy 3.0.7 as well as Vert.x 4.0.0-SNAPSHOT. Unfortunately the bug related here is present.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Vert.x 3.9.5-SNAPSHOT also uses Groovy 3.0.7, and it works fine.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This seems to be a different bug from &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9815&quot; title=&quot;Object not bound with Groovy (but works fine in Java)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9815&quot;&gt;&lt;del&gt;GROOVY-9815&lt;/del&gt;&lt;/a&gt;, as it started to happen with Vert.x 4.0.0.Beta2 which has Groovy 3.0.5.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In Vert.x 4.0 branch, there was a design change regarding Promise and Future. This is why&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9815&quot; title=&quot;Object not bound with Groovy (but works fine in Java)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9815&quot;&gt;&lt;del&gt;GROOVY-9815&lt;/del&gt;&lt;/a&gt; was affecting only Vert.x 3.9 branch.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;So to sum up. Vert.x 3.9 had an issue with interface method selection, that didn&apos;t happen to Vert.x 4.0 due to a code chance. &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9815&quot; title=&quot;Object not bound with Groovy (but works fine in Java)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9815&quot;&gt;&lt;del&gt;GROOVY-9815&lt;/del&gt;&lt;/a&gt; fixed the problem with Vert.x 3.9. But now, we are facing a behaviou that doesn&apos;t manifest in 3.9 but only in 4.0, starting with Beta2 which uses Groovy 3.0.5, and even using Groovy 3.0.7 the error persists.&lt;/p&gt;</comment>
                            <comment id="17246556" author="aaloise" created="Wed, 9 Dec 2020 14:11:29 +0000"  >&lt;p&gt;To simplify, run the following script using Groovy 3.0.7&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Grab(&lt;span class=&quot;code-quote&quot;&gt;&apos;io.vertx:vertx-core:4.0.0&apos;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; io.vertx.core.Promise

Promise p = Promise.promise()
p.&lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;().onSuccess { println it }
p.complete(&lt;span class=&quot;code-quote&quot;&gt;&quot;Done with Groovy!!!&quot;&lt;/span&gt;)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;The IllegalStateException is thrown&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.IllegalStateException: Result is already complete

	at io.vertx.core.Promise.complete(Promise.java:67)

	at io.vertx.core.Promise$complete$1.call(Unknown Source)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17246606" author="emilles" created="Wed, 9 Dec 2020 15:30:53 +0000"  >&lt;p&gt;So there are two &lt;tt&gt;onSuccess&lt;/tt&gt; methods to choose from.  One is &lt;tt&gt;onSuccess(Handler&amp;lt;E&amp;gt;)&lt;/tt&gt; declared by &lt;tt&gt;io.vertx.core.Future&lt;/tt&gt; and implemented by &lt;tt&gt;io.vertx.core.impl.future.FutureImpl&lt;/tt&gt;.  The other is &lt;tt&gt;onSuccess(Object)&lt;/tt&gt; declared by &lt;tt&gt;io.vertx.core.impl.future.Listener&lt;/tt&gt; and implemented by &lt;tt&gt;io.vertx.core.impl.future.PromiseImpl&lt;/tt&gt;.  Groovy is selecting the Object method when I sense your intent is the Handler method.&lt;/p&gt;

&lt;p&gt;I can look into argument vs parameter matching.  I think the SAM-type matching of closures comes after or at the very least has lower precedence to direct matching.  You can overcome this by casting or coercing your closure inline or assigning it to local variable of type Handler.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
@Grab(&lt;span class=&quot;code-quote&quot;&gt;&apos;io.vertx:vertx-core:4.0.0&apos;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; io.vertx.core.Promise

Promise p = Promise.promise()
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; !p.future().isComplete()
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; p.future() === p.future()
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; p.future() === p.future().onSuccess({ println it } &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; io.vertx.core.Handler)
p.complete(&lt;span class=&quot;code-quote&quot;&gt;&apos;Done with Groovy!!!&apos;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17246673" author="aaloise" created="Wed, 9 Dec 2020 16:54:14 +0000"  >&lt;p&gt;I confirm that &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; p.&lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;() === p.&lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;().onSuccess({ println it } as io.vertx.core.Handler)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; is a valid workaround for Vert.x 4.0.0 GA with Groovy 3.0.7.&lt;/p&gt;

&lt;p&gt;If parentheses are removed from onSuccess method, then IllegalStateException also gets thrown&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; p.&lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;() === p.&lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;().onSuccess{ println it } as io.vertx.core.Handler&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The workaround provided wasn&apos;t necessary, and IllegalStateException didn&apos;t happen, until version 4.0.0.Beta1 of Vert.x, which was using Groovy 3.0.3. I noticed that version 4.0.0.Beta2 of Vert.x, that uses Groovy 3.0.5, started to manifest this symptoms.&lt;/p&gt;

&lt;p&gt;Besides that, if you use any version of Vert.x 3.9.x, like 3.9.5-SNAPSHOT for instance, which uses Groovy 3.0.7, the IllegalStateException doesn&apos;t get thrown. The workaround isn&apos;t needed too.&lt;/p&gt;

&lt;p&gt;Has anything changed since version 3.0.4 or 3.0.5 that may have caused this?&lt;/p&gt;</comment>
                            <comment id="17246681" author="emilles" created="Wed, 9 Dec 2020 17:08:21 +0000"  >&lt;p&gt;You could use the git-based binary search to find the commit where this behavior changed.&#160; I don&apos;t have the necessary configuration on my Windows PC to do so.&lt;/p&gt;</comment>
                            <comment id="17246768" author="aaloise" created="Wed, 9 Dec 2020 19:31:47 +0000"  >&lt;p&gt;I&apos;ll try. Meanwhile, I noticed that using Java lambda is also throwing IllegalStateException&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Promise p = Promise.promise();&#160;
p.&lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;().onSuccess( result -&amp;gt; { 
   &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(result);
});
p.complete(&lt;span class=&quot;code-quote&quot;&gt;&quot;Done!!!&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17246775" author="emilles" created="Wed, 9 Dec 2020 19:43:22 +0000"  >&lt;p&gt;Unless you use &lt;tt&gt;@CompileStatic&lt;/tt&gt;,&#160;a lambda expression is implemented as a closure.  So you should get the same behavior there.  Static compilation aside, it is the multi-methods selection that is causing the problem for dynamic code.&lt;/p&gt;</comment>
                            <comment id="17246782" author="emilles" created="Wed, 9 Dec 2020 20:00:41 +0000"  >&lt;p&gt;The code to have a look at is under &lt;tt&gt;org.codehaus.groovy.runtime.MetaClassHelper#calculateParameterDistance&lt;/tt&gt;.  This method returns a value of 251658240 for Closure:Object and 276824064 for Closure:Handler.  Lower value means closer match.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Update:&lt;/b&gt; If I am reading it right, this method has not changed in many years.  And it will always see Object as a closer match than &lt;b&gt;any&lt;/b&gt; interface for a closure argument.  An interface always has one extra step before Object in its super chain.  &lt;a href=&quot;https://github.com/apache/groovy/blame/master/src/main/java/org/codehaus/groovy/runtime/MetaClassHelper.java#L293&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/blame/master/src/main/java/org/codehaus/groovy/runtime/MetaClassHelper.java#L293&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17246802" author="emilles" created="Wed, 9 Dec 2020 20:24:39 +0000"  >&lt;p&gt;This issue seems like a replay of &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5114&quot; title=&quot;String[] to Set coercion seems broken in some cases&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5114&quot;&gt;&lt;del&gt;GROOVY-5114&lt;/del&gt;&lt;/a&gt; in this method.  And &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-6188&quot; title=&quot;java8 lambda style coercion for Closure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-6188&quot;&gt;&lt;del&gt;GROOVY-6188&lt;/del&gt;&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-6189&quot; title=&quot;basic SAM conversion&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-6189&quot;&gt;&lt;del&gt;GROOVY-6189&lt;/del&gt;&lt;/a&gt; seem relevant but I can&apos;t look at the codehaus document.&lt;/p&gt;</comment>
                            <comment id="17246828" author="emilles" created="Wed, 9 Dec 2020 21:13:22 +0000"  >&lt;p&gt;This test case suggests it was designed to work this way:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
  &lt;span class=&quot;code-comment&quot;&gt;// GROOVY-6189
&lt;/span&gt;  void testSAMs() {
      &lt;span class=&quot;code-comment&quot;&gt;// simple direct &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;
&lt;/span&gt;      assertScript &apos;&apos;&apos;
          &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; MySAM {
              &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; someMethod()
          }
          &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; foo(MySAM sam) {sam.someMethod()}
          &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; foo {1} == 1
      &apos;&apos;&apos;

      &lt;span class=&quot;code-comment&quot;&gt;// overloads with classes implemented by Closure
&lt;/span&gt;      [&lt;span class=&quot;code-quote&quot;&gt;&apos;java.util.concurrent.Callable&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Closure&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;GroovyObjectSupport&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-object&quot;&gt;Cloneable&lt;/span&gt;&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt;&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;GroovyCallable&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Serializable&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;GroovyObject&apos;&lt;/span&gt;].each { type -&amp;gt;
          assertScript &quot;&quot;&quot;
              &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; MySAM {
                  &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; someMethod()
              }
              &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; foo(MySAM sam) {sam.someMethod()}
              &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; foo($type ref) {2}
              &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; foo {1} == 2
          &quot;&quot;&quot;
      }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17247044" author="blackdrag" created="Thu, 10 Dec 2020 06:51:44 +0000"  >&lt;p&gt;Eric the missing document you are looking for is here: &lt;a href=&quot;https://groovy.apache.org/wiki/GEP-12.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://groovy.apache.org/wiki/GEP-12.html&lt;/a&gt;&lt;br/&gt;
But while it does mention some  interfaces used by Closure, it does not directly mention the class cases Object , GroovyObjectSupport and GroovyObject.&lt;/p&gt;</comment>
                            <comment id="17247298" author="emilles" created="Thu, 10 Dec 2020 15:09:14 +0000"  >&lt;p&gt;Thanks Jochen.&#160; I have been experimenting with altering the parameter distance in &lt;tt&gt;MetaClassHelper&lt;/tt&gt; to make a SAM-type preferred over Object.&#160; Here is the tightrope I am currently walking.&#160; There are extension methods &lt;tt&gt;leftShift(OutputStream,Object)&lt;/tt&gt; and &lt;tt&gt;leftShift(OutputStream,InputStream)&lt;/tt&gt;. Turns out &lt;tt&gt;java.io.InputStream&lt;/tt&gt; is a SAM-type and serialization of closure properties is broken.  So if any change is made, I think it must be limited to functional interfaces only.&lt;/p&gt;

&lt;p&gt;Also, I could group GroovyObjectSupport with Object or limit the change to Object only.  What types out of java.lang.Object, java.lang.Cloneable, java.io.Serializable, groovy.lang.GroovyObject and groovy.lang.GroovyObjectSupport should be demoted when a functional interface option exists?&lt;/p&gt;</comment>
                            <comment id="17247380" author="emilles" created="Thu, 10 Dec 2020 17:24:18 +0000"  >&lt;p&gt;I submitted a pull request for review that affects the choice between a functional interface and &lt;tt&gt;java.lang.Object&lt;/tt&gt;.  One open question is what to do when there are multiple functional interface overloads.  In the PR code, each will score the same.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/b6bfd49f841c6ed4f2f6f9a56247b7241673f108&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/b6bfd49f841c6ed4f2f6f9a56247b7241673f108&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17247438" author="blackdrag" created="Thu, 10 Dec 2020 19:12:08 +0000"  >&lt;p&gt;I think I have the same pain points with this as you have. Not sure there is a better solution than this, so I support this. But this limitation to interfaces only is really a bit....&lt;/p&gt;

&lt;p&gt;The original intend really did go into having SAM conversion as fallback.. so basically if no normal match, then try SAM. Object (and GroovyObjectSupport to a lesser extend) was an oversight in this. In Object being kind of the method of last resort I like the change. &lt;/p&gt;

&lt;p&gt;I wonder if we solve the case of leftShift by adding a Closure taking variant how many more cases would surface&lt;/p&gt;</comment>
                            <comment id="17248987" author="aaloise" created="Mon, 14 Dec 2020 13:14:48 +0000"  >&lt;p&gt;Will the fix be backported to Groovy 3.x?&lt;/p&gt;</comment>
                            <comment id="17249097" author="emilles" created="Mon, 14 Dec 2020 16:45:13 +0000"  >&lt;p&gt;This change represents a difference in both compile-time and run-time method selection.  I think the safest path forward is to keep it in Groovy 4+.  There have been some breaking changes made in Groovy 2.5 and Groovy 3 point fixes and I think we want to minimize that sort of thing.&lt;/p&gt;</comment>
                            <comment id="17255444" author="paulk" created="Mon, 28 Dec 2020 07:30:39 +0000"  >&lt;p&gt;The fix also broke an existing test (confirmed with &lt;tt&gt;git bisect&lt;/tt&gt;), but the test was accidentally disabled due to a build misconfiguration:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/groovy/blob/master/subprojects/groovy-xml/src/test/groovy/groovy/xml/XmlSlurperTest.groovy#L93-L94&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/blob/master/subprojects/groovy-xml/src/test/groovy/groovy/xml/XmlSlurperTest.groovy#L93-L94&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The build configuration has been fixed but I had to comment out the test temporarily. The test represents functionality that has worked for a long time across XmlSlurper, XmlParser and DOMCategory. It currently is broken just for XmlSlurper after this change. I&apos;ll dive in and look at possibilities when I get a chance but might not be for a couple of days or more.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17258185" author="paulk" created="Mon, 4 Jan 2021 12:45:21 +0000"  >&lt;p&gt;I fixed the existing test:&lt;br/&gt;
 &lt;a href=&quot;https://github.com/apache/groovy/commit/72c322503&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/72c322503&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Though, we&apos;ll need to keep an eye on this. Numerous other libraries/frameworks/user code might break in the same way.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13605732">GROOVY-11558</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13532528">GROOVY-11010</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13474553">GROOVY-10714</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13527311">GROOVY-10963</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13542918">GROOVY-11121</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12816989">GROOVY-6189</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12815939">GROOVY-5114</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 45 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0l9yw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>