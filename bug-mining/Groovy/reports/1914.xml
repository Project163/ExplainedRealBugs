<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:28:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-4975] GroovyScripeEngine fails to properly reload when dependent class is updated</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-4975</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Let&apos;s say you have 2 scripts : script1 and script2 and they both use class BeanX and they are all loaded via the same GroovyScriptEngine instance.  If I modify BeanX, the script that is the first to get loaded and references BeanX will reflect changes made to BeanX, while the other or second script to reference BeanX will fail to reflect changes made to BeanX.&lt;/p&gt;

&lt;p&gt;I&apos;m assuming this is not the proper behavior, although I don&apos;t see any test to test for this scenario.  If one is using groovy via Groovlets or something like Gaelyk where the assumption is that I can write &lt;br/&gt;
scripts and hot have to constantly restart to have my changes reflected then I would assume the GSE should reload classes and dependent classes regardless of the order in which they are referenced.&lt;/p&gt;

&lt;p&gt;Test attached.&lt;/p&gt;</description>
                <environment>Win 7 64bit, OSX Lion</environment>
        <key id="12815810">GROOVY-4975</key>
            <summary>GroovyScripeEngine fails to properly reload when dependent class is updated</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="dsmith">Derek Smith</reporter>
                        <labels>
                            <label>reload</label>
                    </labels>
                <created>Sun, 14 Aug 2011 11:57:47 +0000</created>
                <updated>Thu, 4 Oct 2012 17:02:56 +0000</updated>
                            <resolved>Mon, 1 Oct 2012 02:33:24 +0000</resolved>
                                    <version>1.8.1</version>
                                    <fixVersion>2.0.5</fixVersion>
                    <fixVersion>1.8.9</fixVersion>
                                    <component>GroovyScriptEngine</component>
                        <due></due>
                            <votes>4</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14472170" author="fransvanbuul" created="Sun, 4 Dec 2011 11:42:48 +0000"  >&lt;p&gt;I&apos;ve ran into a similar issue. For me, the problem presented itself as a class cast exception after a runtime update of some scripts.&lt;/p&gt;

&lt;p&gt;The attached patches are:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a patch to the GroovyScriptEngineReloadTest, for testing for this (non-deterministic) phenomenon. Both the case reported by David and &apos;my&apos; problem are included as test cases.&lt;/li&gt;
	&lt;li&gt;a patch to the GroovyScriptEngine that solves this problem. The solution works, but is pretty crude.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Both patches are relative to the 1.8.4 sources.&lt;/p&gt;

&lt;p&gt;I hope this can be included in the next release. We&apos;re using the script engine inside a process engine we&apos;ve written to replace BPEL in our organisation, using Groovy as a process definition language. Works great, but because of this issue we have to restart the entire engine every time we change a process.&lt;/p&gt;
</comment>
                            <comment id="14472151" author="blackdrag" created="Sun, 4 Dec 2011 16:16:49 +0000"  >&lt;p&gt;in the CompilerConfiguration is a reloading interval as option you can influence... could that be used here?&lt;/p&gt;</comment>
                            <comment id="14472072" author="fransvanbuul" created="Mon, 5 Dec 2011 01:01:11 +0000"  >&lt;p&gt;Hi Jochen,&lt;/p&gt;

&lt;p&gt;I&apos;ve looked into that, but that doesn&apos;t solve the problem. The unit tests I provided set the config.minimumRecompilationInterval value to 0 ms, and sleep for 20ms between modifying the scripts and using them through the scripting engine. This should be non-problematic, but it is.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Frans&lt;/p&gt;

</comment>
                            <comment id="14472125" author="blackdrag" created="Mon, 5 Dec 2011 06:41:06 +0000"  >&lt;p&gt;only the thing is, your patch more or less sets the time code for every entry to about 1s in the past. Unless minimumRecompilationInterval is set higher it will not have any effect anymore. minimumRecompilationInterval has a certain impact on performance of the engine, that is why it was introduced. Also there is the problem with getting an exact time on windows. currentTimeMillis has a resolution of about 1ms on Linux systems, but on for example XP it 15ms or more. I remember on older windows versions it was even higher. That&apos;s also why we set the minimumRecompilationInterval to 100 by default, to avoid such strange timing problems. If you wait only 20ms (or even less), then it can happen that current time will still be the same as before, thus no recompilation will happen. &lt;/p&gt;

&lt;p&gt;Looking at isSourceNewer&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isSourceNewer(ScriptCacheEntry entry) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ResourceException {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (entry == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; now = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();

        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; scriptName : entry.dependencies) {
            ScriptCacheEntry depEntry = scriptCache.get(scriptName);
            &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; nextPossibleRecompilationTime = depEntry.lastModified + config.getMinimumRecompilationInterval();
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (nextPossibleRecompilationTime &amp;gt; now) &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;

            URLConnection conn = rc.getResourceConnection(scriptName);
            &lt;span class=&quot;code-comment&quot;&gt;// getLastModified() truncates up to 999 ms from the &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; modification time, let&apos;s fix that
&lt;/span&gt;            &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; lastMod = ((conn.getLastModified() / 1000) + 1) * 1000 - 1;
            &lt;span class=&quot;code-comment&quot;&gt;// getResourceConnection() opening the inputstream, let&apos;s ensure all streams are closed
&lt;/span&gt;            forceClose(conn);

            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (depEntry.lastModified &amp;lt; lastMod) {
                ScriptCacheEntry newEntry = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ScriptCacheEntry(depEntry.scriptClass, lastMod, depEntry.dependencies);
                scriptCache.put(scriptName, newEntry);
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
            }
        }

        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; &lt;br/&gt;
especially the &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; URLConnection conn = rc.getResourceConnection(scriptName);
 &lt;span class=&quot;code-comment&quot;&gt;// getLastModified() truncates up to 999 ms from the &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; modification time, let&apos;s fix that &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; lastMod = ((conn.getLastModified() / 1000) + 1) * 1000 - 1; &lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 
&lt;p&gt;makes me wonder if the problem is not here to be found. With reloading intervals below 1s this code may set times in the future, since we use lastMod to create a new ScriptCacheEntry. The code was added as a reaction to &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-4492&quot; title=&quot;Bug in groovy.util.GroovyScriptEngine isSourceNewer() results in gratuitous recompilations and lost of static state in groovlets&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-4492&quot;&gt;&lt;del&gt;GROOVY-4492&lt;/del&gt;&lt;/a&gt;, the lastMod as time for the new entry is used due to &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-2811&quot; title=&quot;GroovyClassLoader.isSourceNewer() fails when url has spaces&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-2811&quot;&gt;&lt;del&gt;GROOVY-2811&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-4286&quot; title=&quot;GroovyScriptEngine doesn&amp;#39;t recompile updateted script&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-4286&quot;&gt;&lt;del&gt;GROOVY-4286&lt;/del&gt;&lt;/a&gt;, but I cannot see why. But I feel the fix should be in this part instead actually&lt;/p&gt;
</comment>
                            <comment id="14472201" author="dsmith" created="Mon, 5 Dec 2011 08:30:14 +0000"  >&lt;p&gt;There is definitely a problem.  The problem is with ScriptCacheEntry.dependencies, not the timing.&lt;br/&gt;
The dependency graph is not correct for a second script that loads dependencies that have already been loaded.&lt;/p&gt;

&lt;p&gt;It&apos;s demonstrated in both test.  isSourceNewer is failing because ScriptCacheEntry.dependencies does not contain all of the correct entries for the second script.&lt;/p&gt;

&lt;p&gt;It&apos;s easily evident if the tests are run in a debug session w/breakpoints set in isSourceNewer inspecting entry.dependencies.&lt;/p&gt;



</comment>
                            <comment id="14472139" author="fransvanbuul" created="Mon, 5 Dec 2011 10:02:34 +0000"  >&lt;p&gt;David is correct. My original solution only hides the problem. I&apos;ve run a new test similar to my original ones (attached) with a minimum recompilation interval of 2000 ms and sleeps of 5000 ms between modifying the source and using it. This is slow enough to eliminate all timing issues. In this case, the problem shows up deterministically, 100% of the time.&lt;/p&gt;

&lt;p&gt;Any ideas on how this should be properly solved? I do have some time available to work on this, but some pointers would be useful.&lt;/p&gt;

</comment>
                            <comment id="14472091" author="fransvanbuul" created="Mon, 5 Dec 2011 11:07:43 +0000"  >&lt;p&gt;I&apos;ve inserted some logging into the scripting engine and my test case, results are shown below. The entire dependency between Extractor and MyBean is not managed, and looking at the code, I see nothing that should manage it. Disabling the timestamp check in &apos;isSourceNewer&apos; solves the problem at the expense of disabling the entire mechanism.&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Writing source code at Mon Dec 05 17:59:42 CET 2011&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Sleeping for 10 seconds&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Using source code&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Instantiating bean&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Putting into scriptcache (in parseClass): /MyBean.groovy&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     lastmod:  Mon Dec 05 17:59:52 CET 2011&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     dependencies:  &lt;span class=&quot;error&quot;&gt;&amp;#91;/MyBean.groovy&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Instantiating extractor&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Putting into scriptcache (in parseClass): /Extractor.groovy&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     lastmod:  Mon Dec 05 17:59:52 CET 2011&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     dependencies:  &lt;span class=&quot;error&quot;&gt;&amp;#91;/Extractor.groovy&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Sleeping for 10 seconds&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Modifying MyBean source code at Mon Dec 05 18:00:02 CET 2011&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Sleeping for 10 seconds&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Using modified source code&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Instantiating bean&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Calling isSourceNewer for entry MyBean&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Checking dependency /MyBean.groovy&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Putting into scriptcache (in isSourceNewer): /MyBean.groovy&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     lastmod:  Mon Dec 05 18:00:02 CET 2011&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     dependencies:  &lt;span class=&quot;error&quot;&gt;&amp;#91;/MyBean.groovy&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Putting into scriptcache (in parseClass): /MyBean.groovy&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     lastmod:  Mon Dec 05 18:00:12 CET 2011&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     dependencies:  &lt;span class=&quot;error&quot;&gt;&amp;#91;/MyBean.groovy&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Instantiating extractor&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Calling isSourceNewer for entry Extractor&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Checking dependency /Extractor.groovy&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Not putting into scriptcache (in isSourceNewer): /Extractor.groovy&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     lastmod: Mon Dec 05 17:59:42 CET 2011&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     depEntry.lastModified: Mon Dec 05 17:59:52 CET 2011&lt;/p&gt;</comment>
                            <comment id="14472222" author="blackdrag" created="Mon, 5 Dec 2011 12:49:27 +0000"  >&lt;p&gt;Frans, having a test that fails deterministically each time is worth a lot!  Since we now know that the dependencies are set wrong, we can concentrate on that part better and stop thinking about timing problems (the code in isSourceNewer still looks wrong to me, but we can maybe fix that one later on)&lt;/p&gt;

&lt;p&gt;That means there might be a bug in org.codehaus.groovy.tools.gse.DependencyTracker then - or its usage... so I guess a first step would be to check if the tracker gets the dependency between MyBean and Extractor right and if they both appear then correctly in the transitive hull.&lt;/p&gt;

&lt;p&gt;Should that work, then the next step would be to check the way the dependencies are stored, and if that is right. This part is also not so easy code and may have the bug we search for.&lt;/p&gt;</comment>
                            <comment id="14472173" author="fransvanbuul" created="Tue, 6 Dec 2011 10:30:06 +0000"  >&lt;p&gt;Jochen, I put logging into the DependencyTracker and that seems to be working correctly. I also checked how they are stored in the scriptcache, and how the transitive hull is calculated. Seems to be working correctly as well. I think the problem is that this information is not being used.&lt;/p&gt;

&lt;p&gt;I changed GroovyScriptEngine#isSourceNewer in such a way that when an entry is updated, existing entries that depend on the updated entry are removed from the cache. This forces recompilation when they are accessed. The relevant fragment is shown below. With this modification, the unit test passes. Is this an acceptable solution?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (depEntry.lastModified &amp;lt; lastMod) {
     ScriptCacheEntry newEntry = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ScriptCacheEntry(depEntry.scriptClass, lastMod, depEntry.dependencies);
     scriptCache.put(scriptName, newEntry);
     &lt;span class=&quot;code-comment&quot;&gt;/* Removing entries from cache that depended on the entry we just updated; these should be recompiled. */&lt;/span&gt; 
     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(Map.Entry&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, ScriptCacheEntry&amp;gt; currentEntry : scriptCache.entrySet()) {
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(!currentEntry.getKey().equals(scriptName) &amp;amp;&amp;amp;
              currentEntry.getValue().dependencies.contains(scriptName)) {
              scriptCache.remove(currentEntry.getKey());
          }
     }
     &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; </comment>
                            <comment id="14472128" author="fransvanbuul" created="Wed, 7 Dec 2011 06:09:53 +0000"  >&lt;p&gt;Some more results: the change I proposed in my previous comment certainly fixes one problem, but not all. In the more complex case, the registration/calculation of the dependencies seems broken as well. I&apos;ll look into that next.&lt;/p&gt;</comment>
                            <comment id="14472155" author="fransvanbuul" created="Sat, 10 Dec 2011 06:53:13 +0000"  >&lt;p&gt;I&apos;ve created a new patch to fix this issue. It contains a new unit test, a small change to DependencyTracker, and several changes to GroovyScriptEngine.&lt;/p&gt;

&lt;p&gt;To summarise, I found and (I think) corrected the following issues:&lt;/p&gt;

&lt;p&gt;1. After a class is updated because a newer version of the script is found, all classes that directly or indirectly depend on it are no longer valid. This means they must be removed from the scriptcache (as per my previous comment), but also from the classloader cache (new in this patch).&lt;/p&gt;

&lt;p&gt;2. If we have dependencies (A-&amp;gt;C) and (B-&amp;gt;C), and we first compile A (compilation unit (A,C)), compiling B later on would fail to detect the dependency on C. The reason was that in this case, class C is not identified as a primary node in the semantic analysis and is thus ignored in the dependency tracker. I&apos;ve modified the tracker and the scripting engine to ignore the &apos;primary node&apos; status in case we&apos;re dealing with a previously seen scripted class.&lt;/p&gt;</comment>
                            <comment id="14472162" author="dsmith" created="Wed, 4 Jan 2012 21:37:41 +0000"  >&lt;p&gt;Finally got around to trying this patch.&lt;br/&gt;
It works beautifully thus far. Thanks Frans.&lt;/p&gt;

&lt;p&gt;Hopefully the groovy team will include this is a release soon.&lt;/p&gt;</comment>
                            <comment id="14472194" author="fransvanbuul" created="Thu, 5 Jan 2012 00:10:15 +0000"  >&lt;p&gt;Hi David,&lt;/p&gt;

&lt;p&gt;Thanks for trying it out. I&apos;ve discussed this patch on the Groovy dev list. Jochen Theodorou had some very valid criticisms on this patch, it runs fine in the unit tests but it&apos;s not completely reliable in all circumstances. &lt;/p&gt;

&lt;p&gt;Once I find some time (hopefully next week) I&apos;ll try to create a new patch that addresses these problems.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Frans&lt;/p&gt;</comment>
                            <comment id="14472312" author="sdmurphy" created="Wed, 25 Jan 2012 12:25:50 +0000"  >&lt;p&gt;Any update on this? We believe this bug may be causing a nasty side effect of recompiling scripts on each use resulting &lt;br/&gt;
in frequent PermGen errors for server side applications.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://groups.google.com/group/gaelyk/browse_thread/thread/58ff42f7d679b23b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://groups.google.com/group/gaelyk/browse_thread/thread/58ff42f7d679b23b&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14472437" author="guillaume" created="Wed, 1 Feb 2012 07:50:14 +0000"  >&lt;p&gt;Frans, did you have time to integrate Jochen&apos;s suggestions in a new patch?&lt;/p&gt;</comment>
                            <comment id="14472391" author="blackdrag" created="Mon, 6 Feb 2012 03:39:30 +0000"  >&lt;p&gt;Frans seems not to have time right now&lt;/p&gt;</comment>
                            <comment id="14472707" author="sslavic" created="Tue, 10 Apr 2012 01:31:52 +0000"  >&lt;p&gt;Shouldn&apos;t &lt;a href=&quot;http://groovy.codehaus.org/gapi/org/codehaus/groovy/tools/gse/DependencyTracker.html#visitCastExpression%28org.codehaus.groovy.ast.expr.CastExpression%29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;DependencyTracker#visitCastExpression(org.codehaus.groovy.ast.expr.CastExpression)&lt;/tt&gt;&lt;/a&gt; be called for that cast to &lt;tt&gt;MyBean&lt;/tt&gt; in &lt;tt&gt;Extractor.groovy&lt;/tt&gt; (see &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12723013/12723013_GroovyScriptEngineReloadingSlowTest.groovy&quot; title=&quot;GroovyScriptEngineReloadingSlowTest.groovy attached to GROOVY-4975&quot;&gt;GroovyScriptEngineReloadingSlowTest.groovy&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;), so that &lt;tt&gt;MyBean.groovy&lt;/tt&gt;, along with &lt;tt&gt;Extractor.groovy&lt;/tt&gt;, gets registered as dependency of &lt;tt&gt;Extractor&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;When I debuged, &lt;tt&gt;visitCastExpression&lt;/tt&gt; didn&apos;t get called, and &lt;tt&gt;Extractor&lt;/tt&gt;, like in &lt;a href=&quot;http://jira.codehaus.org/browse/GROOVY-4975?focusedCommentId=284932&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-284932&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Frans&apos; log output&lt;/a&gt;, had only &lt;tt&gt;Extractor.groovy&lt;/tt&gt; as dependency.&lt;/p&gt;</comment>
                            <comment id="14473145" author="blackdrag" created="Fri, 17 Aug 2012 09:02:34 +0000"  >&lt;p&gt;I am looking now into this again freshly... RealodTest#testReloadWith2ScriptsDependentOnSameBean looks good and produces the problem, so I will use that... In a first call we request script1, that will create a dependency for script1 on itself and Bean, as it should. In the next run we request script2, that also depends on Bean, but as found out earlier in here, it is not added as dependency, because it is no primary node.&lt;/p&gt;

&lt;p&gt;Frans patch tried to change that here and ignore the primary node state. Doing so will correctly ensure the dependency, but it will not recompile Bean the first time. That means if we would make a test in which first script2 is loaded and we then change Bean to then load script1, we would still not get a recompiled Bean. Testing this with a modified version of ReloadTest I can confirm this.&lt;/p&gt;

&lt;p&gt;Solving this problem would most probably also solve the other problems&lt;/p&gt;</comment>
                            <comment id="14473184" author="blackdrag" created="Fri, 17 Aug 2012 09:45:27 +0000"  >&lt;p&gt;After further thinking I tend to say that ResolveVisitor is here not doing the right thing for us. ResolveVisitor resolves Bean to a precompiled class, as it already exists. It is done with that and now happily assumes all is fine. But in our case we want Bean maybe to be enlisted in the compilation queue, with our own check for if the source is newer or not. ResolveVisitor is clearly lacking some abstraction in that section, making a nice solution difficult.&lt;/p&gt;</comment>
                            <comment id="14473175" author="blackdrag" created="Wed, 22 Aug 2012 08:34:43 +0000"  >&lt;p&gt;The issue should be fixed now. It required me to hook into ResolveVisitor in a way, that was not planned before, but well, there is a clean way now and the reload test from before works now. It would be nice to here of you people here if this new versions resolves the issues you had&lt;/p&gt;</comment>
                            <comment id="14473116" author="dsmith" created="Thu, 23 Aug 2012 21:14:42 +0000"  >&lt;p&gt;I&apos;m testing w/1.8.8-SNAPSHOT and I&apos;m getting the same result.  The test is also still failing for me.  &lt;/p&gt;</comment>
                            <comment id="14473149" author="blackdrag" created="Fri, 24 Aug 2012 05:33:26 +0000"  >&lt;p&gt;if you say you test with 1.8.8 SNAPSHOT, you mean you compiled it from our repository? And you say the here attached ReloadTest.groovy does not work for you?&lt;/p&gt;</comment>
                            <comment id="14473201" author="blackdrag" created="Fri, 24 Aug 2012 08:57:38 +0000"  >&lt;p&gt;I just tested to be sure. I got the SNAPSHOT from &lt;a href=&quot;http://snapshots.repository.codehaus.org/org/codehaus/groovy/groovy-all/1.8.8-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://snapshots.repository.codehaus.org/org/codehaus/groovy/groovy-all/1.8.8-SNAPSHOT/&lt;/a&gt; and executed ReloadTest.groovy. Actually ReloadTest.groovy has a bug, the line:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;path = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(dir + &lt;span class=&quot;code-quote&quot;&gt;&quot;ReloadTest&quot;&lt;/span&gt;);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;should be (on my system at least)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;path = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(dir,&lt;span class=&quot;code-quote&quot;&gt;&quot;ReloadTest&quot;&lt;/span&gt;);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;. After changing the two times this appaears the test executes and works for me&lt;/p&gt;</comment>
                            <comment id="14473212" author="dsmith" created="Sat, 25 Aug 2012 23:24:38 +0000"  >&lt;p&gt;Tried again, the tests did pass for me.&lt;/p&gt;</comment>
                            <comment id="14473244" author="blackdrag" created="Mon, 27 Aug 2012 10:13:34 +0000"  >&lt;p&gt;So you tried ReloadTest and the test just failed by saying the bean had the wrong value? Or was there any exception? Any idea what could be wrong?&lt;/p&gt;</comment>
                            <comment id="14473226" author="dsmith" created="Mon, 27 Aug 2012 10:21:12 +0000"  >&lt;p&gt;Everything is good.  All tests in ReloadTest passed for me.  No exceptions.  &lt;/p&gt;</comment>
                            <comment id="14473070" author="blackdrag" created="Mon, 27 Aug 2012 10:31:46 +0000"  >&lt;p&gt;Ah sorry David... don&apos;t know what I was smoking &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; You actually confirmed it being fixed. Thanks for the help&lt;/p&gt;</comment>
                            <comment id="14473209" author="alessiostalla" created="Fri, 14 Sep 2012 07:47:54 +0000"  >&lt;p&gt;Groovy 1.8.8 does not solve the problem for me. The tests (both the Groovy one and Java one) still fail randomly, both when launched from IntelliJ IDEA and when run manually from the command line. The Java test fails much more often, though - you may have to run the Groovy test several times in a row before getting a failure.&lt;/p&gt;

&lt;p&gt;I observed a couple of facts, that I report here in hope that they will help someone who knows the GSE internals better than me to find a solution.&lt;/p&gt;

&lt;p&gt;1. When the test fails, the 2nd dependent script has its dependencies incorrectly computed: it only depends on itself, not on the shared Bean.&lt;/p&gt;

&lt;p&gt;2. I modified the generated scripts to print their classloader, as well as the one that loaded the Bean class. When the test passes, each script gets its own classloader, which is &lt;b&gt;always&lt;/b&gt; also the classloader of the Bean class. In other words, each script class gets its own version of the Bean class. When the test fails, the 2nd script has a different classloader than the first, but it sees the Bean class as loaded from the 1st classloader (which I suppose should be the expected behaviour). Somehow that causes the script not be reloaded. To make it clearer, this is a printout of two sample runs:&lt;/p&gt;

&lt;p&gt;test PASS&lt;/p&gt;

&lt;p&gt;class script2&lt;br/&gt;
script classloader: groovy.lang.GroovyClassLoader$InnerLoader@186fa9fc&lt;br/&gt;
Instantiating bean class: groovy.lang.GroovyClassLoader$InnerLoader@186fa9fc&lt;br/&gt;
bean classloader: groovy.lang.GroovyClassLoader$InnerLoader@186fa9fc&lt;br/&gt;
class script1&lt;br/&gt;
script classloader: groovy.lang.GroovyClassLoader$InnerLoader@2918958e&lt;br/&gt;
Instantiating bean class: groovy.lang.GroovyClassLoader$InnerLoader@2918958e&lt;br/&gt;
bean classloader: groovy.lang.GroovyClassLoader$InnerLoader@2918958e&lt;br/&gt;
class script1&lt;br/&gt;
script classloader: groovy.lang.GroovyClassLoader$InnerLoader@87e9ce2&lt;br/&gt;
Instantiating bean class: groovy.lang.GroovyClassLoader$InnerLoader@87e9ce2&lt;br/&gt;
bean classloader: groovy.lang.GroovyClassLoader$InnerLoader@87e9ce2&lt;br/&gt;
class script2&lt;br/&gt;
script classloader: groovy.lang.GroovyClassLoader$InnerLoader@5567d7fb&lt;br/&gt;
Instantiating bean class: groovy.lang.GroovyClassLoader$InnerLoader@5567d7fb&lt;br/&gt;
bean classloader: groovy.lang.GroovyClassLoader$InnerLoader@5567d7fb&lt;/p&gt;


&lt;p&gt;test FAIL&lt;/p&gt;

&lt;p&gt;class script2&lt;br/&gt;
script classloader: groovy.lang.GroovyClassLoader$InnerLoader@36b60b93&lt;br/&gt;
Instantiating bean class: groovy.lang.GroovyClassLoader$InnerLoader@36b60b93&lt;br/&gt;
bean classloader: groovy.lang.GroovyClassLoader$InnerLoader@36b60b93&lt;br/&gt;
class script1&lt;br/&gt;
script classloader: groovy.lang.GroovyClassLoader$InnerLoader@741827d1&lt;br/&gt;
bean classloader: groovy.lang.GroovyClassLoader$InnerLoader@36b60b93&lt;br/&gt;
class script1&lt;br/&gt;
script classloader: groovy.lang.GroovyClassLoader$InnerLoader@741827d1&lt;br/&gt;
bean classloader: groovy.lang.GroovyClassLoader$InnerLoader@36b60b93&lt;br/&gt;
//FAIL&lt;/p&gt;

&lt;p&gt;Note: this is from the test method testReloadWith2ScriptsDependentOnSameBeanOrderSwitched(), but similar stuff happen with testReloadWith2ScriptsDependentOnSameBean(). &quot;Instantiating bean class&quot; is printed from a static initializer in Bean. &lt;/p&gt;</comment>
                            <comment id="14473252" author="blackdrag" created="Fri, 14 Sep 2012 08:02:59 +0000"  >&lt;p&gt;Alessio, what OS are you using? Because the only part that I can imagine still failing here is that an update of the file is not seen, because of timing issues of the OS. That would also explain why it fails only sometimes. Before it should have failed always.&lt;/p&gt;</comment>
                            <comment id="14473320" author="alessiostalla" created="Fri, 14 Sep 2012 08:53:40 +0000"  >&lt;p&gt;I&apos;m using OSX, but I also tested it on Linux, with the same outcome. I don&apos;t think it&apos;s related to timing and the OS, because I can arbitrarily increase the wait time between writing the bean and reloading the dependent scripts, and I still get failures. The test above was using a 500ms wait, but I went up to 4500ms to no avail. Also, the two different classloader behaviours are already apparent before any reload happens: the shared Bean is modified just before the line &quot;class script1&quot; is printed for the second time in my example.&lt;/p&gt;</comment>
                            <comment id="14473288" author="blackdrag" created="Mon, 17 Sep 2012 10:01:42 +0000"  >&lt;p&gt;I made the following... I downloaded Groovy 2.0.2 and let it execute raw.github.com/groovy/groovy-core/master/src/test/groovy/util/GroovyScriptEngineReloadingTest.groovy 10 times in a row. And indeed the test is failing about once in ten times.... maybe every 6th time.&lt;/p&gt;

&lt;p&gt;But I don&apos;t understand why. If it is no timing issue, then I would have put my finger on a concurrency issue, but with 4500ms wait time, that is unlikely as well. The symptoms are clear of course. I mean the classloader being the same and all. The question is more what the cause is. &lt;/p&gt;

&lt;p&gt;Why does it work one time and another time it does not?&lt;/p&gt;</comment>
                            <comment id="14473354" author="alessiostalla" created="Mon, 17 Sep 2012 10:46:53 +0000"  >&lt;p&gt;One thing that I thought that could cause nondeterminism is the garbage collector. I saw that a few caches are held in thread-local weak references; maybe if they&apos;re garbage collected too early some important information could be lost. I passed the -verbose:gc flag to the JVM, but it only prints something at the beginning; OTOH, I don&apos;t know whether it only prints full GC or it is more detailed.&lt;/p&gt;

&lt;p&gt;As for concurrency, I&apos;m convinced that there&apos;s only one thread; I put print statements in a few places to be sure.&lt;/p&gt;</comment>
                            <comment id="14473355" author="bwalding" created="Wed, 19 Sep 2012 01:08:51 +0000"  >&lt;p&gt;Closing now that spam removed.&lt;/p&gt;</comment>
                            <comment id="14473238" author="alessiostalla" created="Wed, 19 Sep 2012 10:33:09 +0000"  >&lt;p&gt;I took my analysis further and I can now say that timing is, indeed, part of the issue - but only because it&apos;s exposing a deeper problem.&lt;/p&gt;

&lt;p&gt;There are two timestamps being compared to decide whether to recompile a file: one is the file modification time, rounded up to the next second; the other is the script compilation time, not rounded. The first is computed at line 595 in GroovyScriptEngine - &lt;tt&gt;long lastMod = ((conn.getLastModified() / 1000) + 1) * 1000 - 1;&lt;/tt&gt;. The second is at line 240, &lt;tt&gt;long now = System.currentTimeMillis();&lt;/tt&gt;. When a file is compiled (the shared Bean in our case), the rounded up time may end up being earlier or later than the compilation time, in a nondetermistic way, because of the rounding. This alone should not be a big problem - at worst, it would sometimes cause unnecessary recompilations. But...&lt;/p&gt;

&lt;p&gt;...the logic that records dependencies between files is flawed; a dependency between file A and file B is only recorded when B is compiled in the same compilation unit as A. If B is not recompiled, the dependency is not recorded. This is caused by the fact that the DependencyTracker is invoked by a PrimaryClassNodeOperation (GSE, lines 165 - 175). I don&apos;t know the specifications of the various compiler phases, but certainly I can see that, by manually altering the source file last modification date, I can cause the dependency to be deterministically recorded or not, i.e. &lt;tt&gt;dt.visitClass(classNode);&lt;/tt&gt; (line 173) being executed or not, depending on whether the modification date is forcibly set in the future or in the past. You can obtain the same effect also by causing a big enough sleep (say, 2000ms) between writing Bean.groovy and writing the scripts.&lt;/p&gt;

&lt;p&gt;So, those unnecessary recompilations caused by the timing problem are actually necessary for the dependency to be recorded. That&apos;s why in our app it consistently fails - the shared classes are compiled much later than their last modification.&lt;/p&gt;

&lt;p&gt;Does it make sense to you?&lt;/p&gt;</comment>
                            <comment id="14473255" author="blackdrag" created="Wed, 19 Sep 2012 13:37:52 +0000"  >&lt;p&gt;I am currently preparing a fix for the first issue you mention. It seems this new version is excluding the timing issue finally. I am going to push that soon and it would be good of you if you could test it as well. I will comment here as soon as it is available, since it is getting late here.&lt;/p&gt;

&lt;p&gt;The second part of your comment is something that should not be true anymore. Since the latest version there is a new element called ClassNodeResolver involved. This is used to resolve class names and eventually enqueue new sources. For every script cache entry of GSE that has been requested, a new source unit will be added, if the source is newer. If not, then no recompilation will happen. It is true that the dependencies are not fully right then, yes... but actually I think the dependency tracking is now surplus, since the ClassNodeResolver will do that job implicitly and much better. Actually I am wondering if I should not remove the tracker even. &lt;/p&gt;</comment>
                            <comment id="14473265" author="blackdrag" created="Thu, 20 Sep 2012 01:56:44 +0000"  >&lt;p&gt;I filled &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-5713&quot; title=&quot;timing problem with GroovyScriptEngine recompilation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-5713&quot;&gt;&lt;del&gt;GROOVY-5713&lt;/del&gt;&lt;/a&gt; as follow-up issue&lt;/p&gt;</comment>
                            <comment id="14473356" author="alessiostalla" created="Thu, 20 Sep 2012 04:26:05 +0000"  >&lt;p&gt;Thanks for addressing the timing issue!&lt;/p&gt;

&lt;p&gt;As for the other point, I hadn&apos;t realized that the ClassNodeResolver was meant to replace the PrimaryClassNodeOperation. Unfortunately, I don&apos;t think that you can do without dependency tracking. The ClassNodeResolver is only invoked when a file is compiled; what if a file is not modified (compared to the cached version), but one of its dependencies was modified? Without dependency tracking, the dependency won&apos;t be recompiled. In other words, the ClassNodeResolver works top-down, while the decision to recompile or not should be a bottom-up process.&lt;/p&gt;</comment>
                            <comment id="14473222" author="blackdrag" created="Thu, 20 Sep 2012 08:23:38 +0000"  >&lt;p&gt;You are right... as often, almost right after writing that we may not need the tracker it dawned on me, that I said something stupid &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Of course some of the logic would have to be moved to the ClassNodeResolver and there we don&apos;t know the &quot;cause&quot; of the request, this it is impossible to make the connection, thus we need the tracker in the end still.&lt;/p&gt;

&lt;p&gt;I just did the commit for GROOVY_1_8_X with my new version. Is it possible for you to check if that helps you?&lt;/p&gt;</comment>
                            <comment id="14473256" author="alessiostalla" created="Thu, 20 Sep 2012 09:11:41 +0000"  >&lt;p&gt;Nope, I ran the test again with 1.8.9-SNAPSHOT from Git and it still fails nondeterministically.&lt;/p&gt;</comment>
                            <comment id="14473308" author="blackdrag" created="Thu, 20 Sep 2012 10:19:46 +0000"  >&lt;p&gt;full determinism is impossible to achieve. UrlConnection.getLastModified may not know milliseconds, that is why there is this truncation. truncating the modification time means that if your  change has been done too fast, it cannot be picked up, since it has the same time as before. So you need 1000 ms minimum delay to ensure the time in last modified is updated properly. But it is actually more, since the OS has a timer with differing resolution. A delay of 1100ms should catch most cases, but that does not guarantee the change will be picked up right away. actually the next possible point of a recompilation is time of last compilation plus 1100 plus minimum recompilation interval.  &lt;/p&gt;</comment>
                            <comment id="14473357" author="alessiostalla" created="Fri, 21 Sep 2012 06:57:20 +0000"  >&lt;p&gt;Ok, let&apos;s step back a bit: I don&apos;t have a problem with nondeterminism per se - the problem is that GSE doesn&apos;t properly reload dependencies, &lt;b&gt;ever&lt;/b&gt;, &lt;b&gt;unless&lt;/b&gt; a dependency is found to be modified later than it was compiled (due to nondeterminism). That is, nondeterminism is what makes the test &lt;b&gt;pass&lt;/b&gt; sometimes, not fail. If you eliminate nondeterminism (for example, by ensuring that there is a long enough sleep between writing Bean.groovy and loading the scripts for the first time), the test &lt;b&gt;always&lt;/b&gt; fails.&lt;/p&gt;</comment>
                            <comment id="14473309" author="blackdrag" created="Tue, 25 Sep 2012 08:18:49 +0000"  >&lt;p&gt;Alessio, after totally rewriting the tests to not to use the file system anymore, but something custom I found that you are right in more than one way. It was indeed the case that a precompiled dependency is not picked up. This is now basically fixed. I still have a problem to solve though...&lt;/p&gt;

&lt;p&gt;In he current setup if I have script1 depending on Bean and script2 depending on it as well, if I recompiled script1 and Bean, because Bean changed, then script2 will not be recompiled, because the entries are all up to date&lt;/p&gt;</comment>
                            <comment id="14473300" author="blackdrag" created="Mon, 1 Oct 2012 02:33:24 +0000"  >&lt;p&gt;the issue was marked as fixed for 2.0.2 and 1.8.8, but it seems due to the tests not always showing the real problem it was only partially fixed. This new version in 2.0.5 and 1.8.9 should finally fix the issue of not picking up dependencies. It is still no 100% satisfying solution to me, but at least it works&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12723013" name="GroovyScriptEngineReloadingSlowTest.groovy" size="1149" author="fransvanbuul" created="Mon, 5 Dec 2011 10:02:34 +0000"/>
                            <attachment id="12722872" name="ReloadTest.groovy" size="4186" author="dsmith" created="Sun, 14 Aug 2011 11:57:48 +0000"/>
                            <attachment id="12722963" name="ReloadTestJava.java" size="6479" author="dsmith" created="Sun, 14 Aug 2011 11:57:48 +0000"/>
                            <attachment id="12722905" name="patch4975_main.txt" size="786" author="fransvanbuul" created="Sun, 4 Dec 2011 11:42:48 +0000"/>
                            <attachment id="12722531" name="patch4975_test.txt" size="4706" author="fransvanbuul" created="Sun, 4 Dec 2011 11:42:48 +0000"/>
                            <attachment id="12722906" name="patch4975_v2.txt" size="12889" author="fransvanbuul" created="Sat, 10 Dec 2011 06:53:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 8 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c9k7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>