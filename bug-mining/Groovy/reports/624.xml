<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:04:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-2643] Delegate property is ignored by closure</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-2643</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I have attached the following test case. It is interesting to see that the testDelegateFileMethodAccess fails, whereas the other test where delegate methods are accessed succeed. All tests with property access fail. This is a serious bug which for example prevents me to offer important DSL functionality for my build tool. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.tools.ant.Project

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ClosureBug &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; GroovyTestCase {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; expectedFileResult

    void setUp() {
        expectedFileResult = &lt;span class=&quot;code-quote&quot;&gt;&apos;path&apos;&lt;/span&gt;
    }

    void testDelegateAntPropertyAccess() {
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; script(antScriptText(&lt;span class=&quot;code-quote&quot;&gt;&apos;antProject&apos;&lt;/span&gt;)).run() &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Project
    }

    void testDelegateAntMethodAccess() {
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; script(antScriptText(&lt;span class=&quot;code-quote&quot;&gt;&apos;getAntProject()&apos;&lt;/span&gt;)).run() &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Project
    }

    void testDelegateFilePropertyAccess() {
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; script(fileScriptText(&lt;span class=&quot;code-quote&quot;&gt;&apos;path&apos;&lt;/span&gt;)).run() == expectedFileResult
    }

    void testDelegateFileMethodAccess() {
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; script(fileScriptText(&lt;span class=&quot;code-quote&quot;&gt;&apos;getPath()&apos;&lt;/span&gt;)).run() == expectedFileResult
    }

    void testDelegateCircleAccessGetterWithoutField() {
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; script(circleScriptText(&lt;span class=&quot;code-quote&quot;&gt;&apos;getProp3()&apos;&lt;/span&gt;)).run() == &lt;span class=&quot;code-quote&quot;&gt;&apos;value3&apos;&lt;/span&gt;
    }

    void testDelegateCircleAccessGetterWithField() {
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; script(circleScriptText(&lt;span class=&quot;code-quote&quot;&gt;&apos;getProp2()&apos;&lt;/span&gt;)).run() == &lt;span class=&quot;code-quote&quot;&gt;&apos;value2&apos;&lt;/span&gt;
    }

    void testDelegateCircleAccessDynamicGetter() {
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; script(circleScriptText(&lt;span class=&quot;code-quote&quot;&gt;&apos;getProp1()&apos;&lt;/span&gt;)).run() == &lt;span class=&quot;code-quote&quot;&gt;&apos;value1&apos;&lt;/span&gt;
    }

    void testDelegateCircleAccessPropertyWithoutGetter() {
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; script(circleScriptText(&lt;span class=&quot;code-quote&quot;&gt;&apos;prop1&apos;&lt;/span&gt;)).run() == &lt;span class=&quot;code-quote&quot;&gt;&apos;value1&apos;&lt;/span&gt;
    }

    void testDelegateCircleAccessPropertyWithGetter() {
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; script(circleScriptText(&lt;span class=&quot;code-quote&quot;&gt;&apos;prop2&apos;&lt;/span&gt;)).run() == &lt;span class=&quot;code-quote&quot;&gt;&apos;value2&apos;&lt;/span&gt;
    }

    void testDelegateCircleAccessPropertyWithoutField() {
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; script(circleScriptText(&lt;span class=&quot;code-quote&quot;&gt;&apos;prop3&apos;&lt;/span&gt;)).run() == &lt;span class=&quot;code-quote&quot;&gt;&apos;value3&apos;&lt;/span&gt;
    }


    def replaceMetaclass(Script script) {
        ExpandoMetaClass emc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ExpandoMetaClass(script.class, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
        emc.methodMissing = {&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name, args -&amp;gt;
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MissingMethodException(name, Script, args)
        }
        emc.propertyMissing = {&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name -&amp;gt;
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MissingPropertyException(name, Script)
        }
        emc.initialize()
        script.metaClass = emc
    }

    Script script(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; text) {
        GroovyShell groovyShell = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyShell()
        Script script = groovyShell.parse(text)
        replaceMetaclass(script)
        script
    }

    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; antScriptText(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; accessDirective) {
        &quot;&quot;&quot;          
AntBuilder ant = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AntBuilder()
Closure cl = {
     $accessDirective
}
cl.delegate = ant
cl.call()&quot;&quot;&quot;
    }

    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fileScriptText(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; accessDirective) {
        &quot;&quot;&quot;
File file = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&apos;$expectedFileResult&apos;&lt;/span&gt;)
Closure cl = {
     $accessDirective
}
cl.delegate = file
cl.call()&quot;&quot;&quot;
    }

    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; circleScriptText(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; accessDirective) {
        &quot;&quot;&quot;
Circle circle = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Circle()
Closure cl = {
     $accessDirective
}
cl.delegate = circle
cl.call()&quot;&quot;&quot;
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Circle {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; prop1 = &lt;span class=&quot;code-quote&quot;&gt;&apos;value1&apos;&lt;/span&gt;
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; prop2 = &lt;span class=&quot;code-quote&quot;&gt;&apos;value2&apos;&lt;/span&gt;

    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getProp2() {
        prop2
    }

    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getProp3() {
        &lt;span class=&quot;code-quote&quot;&gt;&apos;value3&apos;&lt;/span&gt;
    }

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12814116">GROOVY-2643</key>
            <summary>Delegate property is ignored by closure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="hans_d">Hans Dockter</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 Feb 2008 08:02:14 +0000</created>
                <updated>Thu, 27 Mar 2008 05:03:46 +0000</updated>
                            <resolved>Thu, 27 Mar 2008 05:03:46 +0000</resolved>
                                    <version>1.5.4</version>
                    <version>1.6-beta-1</version>
                                    <fixVersion>1.5.5</fixVersion>
                    <fixVersion>1.6-beta-1</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14464354" author="hans_d" created="Thu, 28 Feb 2008 08:24:21 +0000"  >&lt;p&gt;I forgot to mention that if I don&apos;t touch the metaclass of the Script class, everything works fine. &lt;/p&gt;</comment>
                            <comment id="14464314" author="hans_d" created="Thu, 28 Feb 2008 08:30:47 +0000"  >&lt;p&gt;There is a small bug in the unit test. Unfortunately I can&apos;t edit the issue.&lt;/p&gt;

&lt;p&gt;The line: File file = new File($expectedFileResult)&lt;br/&gt;
should be: File file = new File(&apos;$expectedFileResult&apos;)&lt;/p&gt;

&lt;p&gt;Now the testDelegateFileMethodAccess succeeds and we have a simple rule. Method access works, property access not.&lt;/p&gt;
</comment>
                            <comment id="14464376" author="hans_d" created="Fri, 29 Feb 2008 09:40:57 +0000"  >&lt;p&gt;For me this is a very serious bug. Actually I wanted to release my build tool this week, but I have to wait until this is fixed. To use ant from my build scripts I have to specify the delegate to make things work:&lt;/p&gt;

&lt;p&gt;ant.copy(toDir: distSamplesDir) &lt;/p&gt;
{delegate.fileset(dir: new File(srcRoot, &apos;samples&apos;))}

&lt;p&gt;Constructs like this don&apos;t work at all:&lt;/p&gt;

&lt;p&gt;ant.copy(toDir: distSrcDir) {&lt;br/&gt;
        &lt;span class=&quot;error&quot;&gt;&amp;#91;srcDirs + resourceDirs + groovySrcDirs&amp;#93;&lt;/span&gt;.each &lt;/p&gt;
{dir -&amp;gt; delegate.fileset(dir: dir)}
&lt;p&gt;}&lt;/p&gt;
</comment>
                            <comment id="14459569" author="hans_d" created="Mon, 3 Mar 2008 12:25:21 +0000"  >&lt;p&gt;Any idea when someone has time to look into this?&lt;/p&gt;</comment>
                            <comment id="14464329" author="jimwhite" created="Thu, 6 Mar 2008 02:22:15 +0000"  >&lt;p&gt;I cut down the number of errors from 9 of 10 tests to 2 of 10 tests by:&lt;/p&gt;

&lt;p&gt;1) Not using .metaClass and .class (using the setter/getter instead) on classes where I&apos;m not totally sure your might not be dealing with a map.&lt;/p&gt;

&lt;p&gt;2) Compiling the script so that the Circle class can be found by Class.forName (putting Circle.groovy in a separate file also works).  There is already a JIRA for this problem, but I forget the number.  But currently a script cannot find classes that are defined in it by Class.forName.&lt;/p&gt;

&lt;p&gt;The remaining 2 failing tests try to access a &apos;path&apos; property on g.l.Script which doesn&apos;t exist. (in 1.5.5 anyhow)&lt;/p&gt;</comment>
                            <comment id="14464344" author="hans_d" created="Thu, 6 Mar 2008 02:38:01 +0000"  >&lt;p&gt;There was also a discussion on the mailing list about this.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.nabble.com/Delegate-property-is-ignored-by-closure-to15733032.html#a15733032&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.nabble.com/Delegate-property-is-ignored-by-closure-to15733032.html#a15733032&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Would the script mentioned there run for you (Here I have replaced .metaclass with the setter):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def scriptText = &apos;&apos;&apos;
AntBuilder ant = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AntBuilder()
Closure cl = {
    &lt;span class=&quot;code-comment&quot;&gt;// access property of AntBuilder from closure
&lt;/span&gt;    antProject
}
cl.delegate = ant
cl.call()
&apos;&apos;&apos;

GroovyShell groovyShell = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyShell()
Script script = groovyShell.parse(scriptText)
replaceMetaclass(script)
script.run()


def replaceMetaclass(Script script) {
    ExpandoMetaClass emc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ExpandoMetaClass(script.class, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
    emc.methodMissing = {&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name, args -&amp;gt;
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MissingMethodException(name, Script, args)
    }
    emc.propertyMissing = {&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name -&amp;gt;
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MissingPropertyException(name, Script)
    }
    emc.initialize()
    script.setMetaClass(emc)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14464452" author="hans_d" created="Thu, 6 Mar 2008 06:26:51 +0000"  >&lt;p&gt;Hi Jim,&lt;/p&gt;

&lt;p&gt;with all the changes you have mentioned I still have 5 failing tests (with the latest build from trunk).&lt;/p&gt;

&lt;p&gt;I&apos;m wondering why this is the case.&lt;/p&gt;

&lt;p&gt;Could you attach your more successful testcase to this issue?&lt;/p&gt;
</comment>
                            <comment id="14478012" author="paulk" created="Sat, 8 Mar 2008 04:21:08 +0000"  >&lt;p&gt;made the edit to the script&lt;/p&gt;</comment>
                            <comment id="14477996" author="paulk" created="Sat, 8 Mar 2008 04:37:08 +0000"  >&lt;p&gt;I attached the script I used for testing.&lt;br/&gt;
It doesn&apos;t have the issue with using groovyc.&lt;br/&gt;
It shows 5 errors for 1.5.5-SNAPSHOT and HEAD for me.&lt;/p&gt;</comment>
                            <comment id="14478004" author="paulk" created="Sat, 8 Mar 2008 04:56:37 +0000"  >&lt;p&gt;If I comment out the three lines overriding propertyMissing (file attached), then it works fine on 1.5.5-SNAPSHOT and HEAD. That would seem to indicate that propertyMissing is being triggered prior to looking for get/set methods.&lt;/p&gt;</comment>
                            <comment id="14464380" author="blackdrag" created="Sat, 8 Mar 2008 17:12:56 +0000"  >&lt;p&gt;is there a way to reduce this test case to something that does not use AntBuilder? That would give us a more solid base to find the problem&lt;/p&gt;</comment>
                            <comment id="14464455" author="hans_d" created="Sun, 9 Mar 2008 01:53:31 +0000"  >&lt;p&gt;I have attached a shortened version of the testcases which includes only the test methods that do not use AntBuilder.&lt;/p&gt;</comment>
                            <comment id="14464439" author="blackdrag" created="Sun, 9 Mar 2008 09:48:05 +0000"  >&lt;p&gt;looks like in Closure:202 a MissingPropertyException should have been thrown, but the Exception really is an InvocationTargetException with the correct MissingPropertyException nested. I think this problem is related to &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-2666&quot; title=&quot;Different exception behavior in groovy 1.6 (original exception is wrapped)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-2666&quot;&gt;&lt;del&gt;GROOVY-2666&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14464332" author="hans_d" created="Sun, 9 Mar 2008 10:18:52 +0000"  >&lt;p&gt;But &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-2643&quot; title=&quot;Delegate property is ignored by closure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-2643&quot;&gt;&lt;del&gt;GROOVY-2643&lt;/del&gt;&lt;/a&gt; happens also for 1.5.4. &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-2666&quot; title=&quot;Different exception behavior in groovy 1.6 (original exception is wrapped)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-2666&quot;&gt;&lt;del&gt;GROOVY-2666&lt;/del&gt;&lt;/a&gt; is only for &amp;gt; 1.5.4&lt;/p&gt;</comment>
                            <comment id="14464392" author="blackdrag" created="Mon, 10 Mar 2008 09:41:24 +0000"  >&lt;p&gt;I see... but still, the exception I debugged was incorrect, so it is related to 2666 in 1.6 and fixing that bug is needed to make fixing this bug possible in 1.6&lt;/p&gt;</comment>
                            <comment id="14464457" author="blackdrag" created="Tue, 11 Mar 2008 09:04:57 +0000"  >&lt;p&gt;I used your short test with the small change where GroovyShell is used &quot;GroovyShell groovyShell = new GroovyShell(this.class.classLoader)&quot;. After this change 3 of the 6 tests do fail and that is the same for 1.5.4 and 1.6 in all these cases Groovy claims that propX does not exist for the script. I very much think this happens, because the real MissingPropertyException is wrapped in a InvokerInvocatationException. But this is nothing new, Groovy 1.0 behaved that way already. So I do guess that construction above never worked before.&lt;/p&gt;</comment>
                            <comment id="14464393" author="hans_d" created="Tue, 11 Mar 2008 09:09:40 +0000"  >&lt;p&gt;But it should, shouldn&apos;t it?&lt;/p&gt;</comment>
                            <comment id="14464347" author="hans_d" created="Tue, 11 Mar 2008 09:14:52 +0000"  >&lt;p&gt;Before EMC was introduces this problem was probably more hidden. What I do is nothing exotic. Things you need to do for many DSL scenarios.&lt;/p&gt;</comment>
                            <comment id="14464358" author="blackdrag" created="Tue, 11 Mar 2008 09:30:41 +0000"  >&lt;p&gt;without EMC this problem does  happen, because it is special to closures... even if missing method is used from the current class this will not happen. But a fix is to be expected in a matter of hours.&lt;/p&gt;</comment>
                            <comment id="14464388" author="blackdrag" created="Tue, 11 Mar 2008 09:53:36 +0000"  >&lt;p&gt;ok, both 1.5.x and 1.6 now have fixes for this issue. It would be nice of you to test this to be sure it fixes your original issue&lt;/p&gt;</comment>
                            <comment id="14464429" author="hans_d" created="Wed, 12 Mar 2008 05:19:21 +0000"  >&lt;p&gt;The tests run now, but in my real code I still have a problem. I&apos;ve used the GROOVY_1_5_X branch from this morning. I could not build HEAD, as I got test failures.&lt;/p&gt;

&lt;p&gt;Here is a script to reproduce my problem. It gives the following error:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[echo] closureCall
testprop
testMeth
     [echo] directCall
Caught: groovy.lang.MissingMethodException: No signature of method: Parent.echo() is applicable for argument types: (java.util.LinkedHashMap) values: {[&quot;message&quot;:&quot;closureCall&quot;]}
groovy.lang.MissingMethodException: No signature of method: Parent.echo() is applicable for argument types: (java.util.LinkedHashMap) values: {[&quot;message&quot;:&quot;closureCall&quot;]}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What is also confusing! When I uncomment: cl.resolveStrategy(Closure.DELEGATE_ONLY), I get the exception:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caught: groovy.lang.MissingMethodException: No signature of method: MyScript.resolveStrategy() is applicable for argument types: (java.lang.Integer) values: {3}
groovy.lang.MissingMethodException: No signature of method: MyScript.resolveStrategy() is applicable for argument types: (java.lang.Integer) values: {3}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;BuildScriptProcessor {
    void evaluate(def parent, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; text) {
        GroovyShell groovyShell = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyShell()
        Script script = groovyShell.parse(text)
        replaceMetaclass(script, parent)
        script.run()
    }

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void replaceMetaclass(Script script, def parent) {
        ExpandoMetaClass projectScriptExpandoMetaclass = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ExpandoMetaClass(script.class, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
        projectScriptExpandoMetaclass.methodMissing = {&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name, args -&amp;gt;
            parent.invokeMethod(name, args)
        }
        projectScriptExpandoMetaclass.propertyMissing = {&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name -&amp;gt;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (name == &lt;span class=&quot;code-quote&quot;&gt;&apos;out&apos;&lt;/span&gt;) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out
            }
            parent.&lt;span class=&quot;code-quote&quot;&gt;&quot;$name&quot;&lt;/span&gt;
        }
        projectScriptExpandoMetaclass.initialize()
        script.metaClass = projectScriptExpandoMetaclass
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Parent {
    AntBuilder ant = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AntBuilder()
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; testProp = &lt;span class=&quot;code-quote&quot;&gt;&apos;testprop&apos;&lt;/span&gt;

    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; testMeth() {
        &lt;span class=&quot;code-quote&quot;&gt;&apos;testMeth&apos;&lt;/span&gt;
    }

    void ant(Closure cl) {
&lt;span class=&quot;code-comment&quot;&gt;//        cl.resolveStrategy(Closure.DELEGATE_ONLY)
&lt;/span&gt;        cl.delegate = ant
        cl.call()
    }
}

Parent parent = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Parent()

parent.ant {
   echo(message: &lt;span class=&quot;code-quote&quot;&gt;&apos;closureCall&apos;&lt;/span&gt;)  
}

&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; script = &quot;&quot;&quot;
println testProp
println testMeth()
ant.echo(message: &lt;span class=&quot;code-quote&quot;&gt;&apos;directCall&apos;&lt;/span&gt;)
ant {
    echo(message: &lt;span class=&quot;code-quote&quot;&gt;&apos;closureCall&apos;&lt;/span&gt;) 
}
&quot;&quot;&quot;

&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BuildScriptProcessor().evaluate(parent, script)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14464566" author="blackdrag" created="Thu, 27 Mar 2008 05:03:46 +0000"  >&lt;p&gt;the issue was resolved the day after, but I let it open to see if there are more problems. I merged the change now into 1.6 and since it looks like there are no problems left I close it&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310260">
                    <name>Related</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12814142">GROOVY-2666</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12721467" name="Groovy2643ShortTest.groovy" size="1802" author="hans_d" created="Sun, 9 Mar 2008 01:54:31 +0000"/>
                            <attachment id="12721689" name="groovy2643-passing.groovy" size="2914" author="paulk" created="Sat, 8 Mar 2008 04:56:37 +0000"/>
                            <attachment id="12721335" name="groovy2643.groovy" size="2913" author="paulk" created="Sat, 8 Mar 2008 04:37:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 35 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c2af:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>