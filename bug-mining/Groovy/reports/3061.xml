<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:51:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-7558] Error when referencing private member variables from within a closure</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-7558</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Originally posted on SO here: &lt;a href=&quot;http://stackoverflow.com/questions/32212260/in-groovy-is-it-legal-to-reference-private-member-variables-from-within-a-closur&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/32212260/in-groovy-is-it-legal-to-reference-private-member-variables-from-within-a-closur&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The code below fails with &lt;tt&gt;java.lang.ClassCastException: Test$_doStuff_closure1 cannot be cast to Test&lt;/tt&gt;.  Interestingly, if I remove the &lt;tt&gt;@CompileStatic&lt;/tt&gt; annotation or make the member variable non-private it works as expected.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Test {
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; str = &lt;span class=&quot;code-quote&quot;&gt;&quot;hi&quot;&lt;/span&gt;
    @groovy.transform.CompileStatic
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void doStuff() {
        Closure c = {
            println str
        }
        c()        
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Test().doStuff()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It also works when &lt;tt&gt;@CompileStatic&lt;/tt&gt; is moved up to the class level&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@groovy.transform.CompileStatic
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Test {
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; str = &lt;span class=&quot;code-quote&quot;&gt;&quot;hi&quot;&lt;/span&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void doStuff() {
        Closure c = {
            println str
        }
        c()        
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Test().doStuff()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>Linux x86-64 / java 1.8.0_60</environment>
        <key id="12858737">GROOVY-7558</key>
            <summary>Error when referencing private member variables from within a closure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shils">Shil Sinha</assignee>
                                    <reporter username="jkeys089">Jon Keys</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Aug 2015 20:00:17 +0000</created>
                <updated>Wed, 1 Feb 2017 23:18:43 +0000</updated>
                            <resolved>Sat, 2 Jul 2016 17:01:52 +0000</resolved>
                                    <version>2.4.4</version>
                                    <fixVersion>2.4.8</fixVersion>
                                    <component>Static compilation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14711883" author="keegan" created="Tue, 25 Aug 2015 20:09:44 +0000"  >&lt;p&gt;I simplified the example a bit and added some formatting.  Hope you don&apos;t mind &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14944110" author="shils" created="Mon, 5 Oct 2015 21:49:45 +0000"  >&lt;p&gt;This seems to happen because private field accessors aren&apos;t generated for classes that aren&apos;t statically compiled, even if they have statically compiled methods. I also don&apos;t think this should be considered a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7597&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;GROOVY-7597&lt;/a&gt;. In this case the class being checked for (Test) is correct (in the sense that it would be used to access the property) and the reference on the stack (the closure) is incorrect. In 7597, the class being checked for (Calculation) is incorrect and the reference (the closure&apos;s delegate) is correct.  The underlying causes of both issues at the AST level are also different.&lt;/p&gt;</comment>
                            <comment id="14951980" author="pascalschumacher" created="Sat, 10 Oct 2015 18:33:59 +0000"  >&lt;p&gt;As Shil Sinha said it is not a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7597&quot; title=&quot;Static Compiler tries to cast delegate to target type of property accessor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7597&quot;&gt;&lt;del&gt;GROOVY-7597&lt;/del&gt;&lt;/a&gt;. It still fails even after &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7597&quot; title=&quot;Static Compiler tries to cast delegate to target type of property accessor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7597&quot;&gt;&lt;del&gt;GROOVY-7597&lt;/del&gt;&lt;/a&gt; was fixed.&lt;/p&gt;</comment>
                            <comment id="14952461" author="shils" created="Sun, 11 Oct 2015 22:11:00 +0000"  >&lt;p&gt;A simple but sub-optimal fix is here: &lt;a href=&quot;https://github.com/apache/incubator-groovy/compare/master...shils:GROOVY-7558&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-groovy/compare/master...shils:GROOVY-7558&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15103414" author="githubbot" created="Sat, 16 Jan 2016 19:37:26 +0000"  >&lt;p&gt;GitHub user shils opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/242&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/242&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7558&quot; title=&quot;Error when referencing private member variables from within a closure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7558&quot;&gt;&lt;del&gt;GROOVY-7558&lt;/del&gt;&lt;/a&gt; Add private field accessors and bridge methods to dynamic&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230; classes with statically compiled inner classes&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/shils/groovy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/shils/groovy&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7558&quot; title=&quot;Error when referencing private member variables from within a closure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7558&quot;&gt;&lt;del&gt;GROOVY-7558&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/242.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/242.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #242&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 5cb6368ed7c5755c62a76431e96b944e3dee796e&lt;br/&gt;
Author: Shil S &amp;lt;shil.sinha@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-10-11T19:58:52Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7558&quot; title=&quot;Error when referencing private member variables from within a closure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7558&quot;&gt;&lt;del&gt;GROOVY-7558&lt;/del&gt;&lt;/a&gt; Add private field accessors and bridge methods to dynamic classes with statically compiled inner classes&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15107605" author="githubbot" created="Tue, 19 Jan 2016 22:41:55 +0000"  >&lt;p&gt;Github user shils commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/242#discussion_r50188030&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/242#discussion_r50188030&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: src/main/org/codehaus/groovy/transform/sc/StaticCompilationVisitor.java &amp;#8212;&lt;br/&gt;
    @@ -123,9 +123,20 @@ public void visitClass(final ClassNode node) {&lt;br/&gt;
             }&lt;br/&gt;
             super.visitClass(node);&lt;br/&gt;
             addPrivateFieldAndMethodAccessors(node);&lt;br/&gt;
    +        if (isStaticallyCompiled(node)) {&lt;br/&gt;
    +            ClassNode outer = node.getOuterClass();&lt;br/&gt;
    +            if (outer != null &amp;amp;&amp;amp; !isStaticallyCompiled(outer)) &lt;/p&gt;
{
    +                outer.putNodeMetaData(StaticCompilationMetadataKeys.DYNAMIC_OUTER_NODE, true);
    +            }
&lt;p&gt;    +        }&lt;br/&gt;
             classNode = oldCN;&lt;br/&gt;
         }&lt;/p&gt;

&lt;p&gt;    +    public void visitDynamicOuterClass(ClassNode node) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    adding a public method here is not ideal, though it seems like the alternative would be to create a separate class responsible for adding bridge methods, which would be used by StaticCompilationVisitor as well as the phase operation added for dynamic outer classes.&lt;/p&gt;</comment>
                            <comment id="15360254" author="githubbot" created="Sat, 2 Jul 2016 16:56:51 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/groovy/pull/242&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/242&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 20 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2jczb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>