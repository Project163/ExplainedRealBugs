<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:07:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-9599] CliBuilder: Option with &quot;type: String, defaultValue &apos;&apos;&quot; (empty String) results in NullObject if default value is applied</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-9599</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;This is a follow-up ticket for &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9519&quot; title=&quot;CLIBuilder: Option with &amp;quot;type: Integer, defaultValue &amp;#39;0&amp;#39;&amp;quot; results in Boolean if default value is applied&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9519&quot;&gt;&lt;del&gt;GROOVY-9519&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;After checking with Groovy 3.0.4, it seems that only the &quot;Integer with defaultValue &apos;0&apos;&quot; case was fixed, but not &quot;String with defaultValue &apos;&apos;&quot;. The latter became even worse. It still ignores the defaultValue, but instead of creating a Boolean, it now creates a NullObject. Try this code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Grab(&lt;span class=&quot;code-quote&quot;&gt;&apos;info.picocli:picocli-groovy:4.3.2&apos;&lt;/span&gt;)
@GrabConfig(systemClassLoader=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.cli.picocli.CliBuilder

def cli = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CliBuilder(name: &lt;span class=&quot;code-quote&quot;&gt;&apos;cliTest.groovy&apos;&lt;/span&gt;, stopAtNonOption: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
cli.h(type: &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;, longOpt: &lt;span class=&quot;code-quote&quot;&gt;&apos;help&apos;&lt;/span&gt;, usageHelp: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, required: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;Show usage information&apos;&lt;/span&gt;)
cli.a(type: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, longOpt: &lt;span class=&quot;code-quote&quot;&gt;&apos;optA&apos;&lt;/span&gt;, required: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, args: 1, defaultValue: &lt;span class=&quot;code-quote&quot;&gt;&apos;&apos;, &apos;&lt;/span&gt;Option a (optional)&apos;)
def opts = cli.parse(args)
opts || &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.exit(1)
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(opts.h) {
  cli.usage()
  &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.exit(0)
}

println(opts.a.getClass())
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (opts.a) {
  println(opts.a)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;with Groovy 3.0.2:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
% ~/tmp/groovy-3.0.2/bin/groovy ./cliTest.groovy
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;java.lang.&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and with Groovy 3.0.4:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
% ~/tmp/groovy-3.0.4/bin/groovy ./cliTest.groovy
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.codehaus.groovy.runtime.NullObject
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13312310">GROOVY-9599</key>
            <summary>CliBuilder: Option with &quot;type: String, defaultValue &apos;&apos;&quot; (empty String) results in NullObject if default value is applied</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="rpopma">Remko Popma</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Jun 2020 21:57:24 +0000</created>
                <updated>Thu, 23 Jul 2020 14:16:11 +0000</updated>
                            <resolved>Mon, 22 Jun 2020 01:27:00 +0000</resolved>
                                    <version>2.5.11</version>
                    <version>3.0.4</version>
                                    <fixVersion>3.0.5</fixVersion>
                    <fixVersion>2.5.13</fixVersion>
                                    <component>command line processing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17141605" author="remkop@yahoo.com" created="Mon, 22 Jun 2020 00:02:22 +0000"  >&lt;p&gt;This turned out to have a separate, very different cause from &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-9519&quot; title=&quot;CLIBuilder: Option with &amp;quot;type: Integer, defaultValue &amp;#39;0&amp;#39;&amp;quot; results in Boolean if default value is applied&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-9519&quot;&gt;&lt;del&gt;GROOVY-9519&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Given code like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
def cli = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CliBuilder()
cli.s(type: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, longOpt: &lt;span class=&quot;code-quote&quot;&gt;&apos;str&apos;&lt;/span&gt;, required: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, args: 1, defaultValue: &lt;span class=&quot;code-quote&quot;&gt;&apos;&apos;, &apos;&lt;/span&gt;description&apos;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;the &lt;tt&gt;groovy.cli.picocli.CliBuilder&lt;/tt&gt; class constructs a &lt;tt&gt;picocli.CommandLine.Model.OptionSpec&lt;/tt&gt; from the method arguments.&lt;/p&gt;

&lt;p&gt;These method arguments are given to the conversion logic as a &lt;tt&gt;Map&amp;lt;String, Object&amp;gt;&lt;/tt&gt;. During this conversion, there is the following conditional that prevents all options from getting an empty String value as their default value:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// Map m
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!m.defaultValue) { &lt;span class=&quot;code-comment&quot;&gt;//&amp;lt;-- (line 943) BAD: evaluates to &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; value is empty &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.
&lt;/span&gt;    m.remove(&lt;span class=&quot;code-quote&quot;&gt;&apos;defaultValue&apos;&lt;/span&gt;) &lt;span class=&quot;code-comment&quot;&gt;// don&apos;t &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; the picocli model to empty string
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This works fine when no default is specified, or when the default is specified as something that does not evaluate to &lt;tt&gt;false&lt;/tt&gt; as per Groovy Truthiness, but when an empty String is intentionally specified as the default, what actually happens is that the default value becomes &lt;tt&gt;null&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The correct code should just look at the absence or presence of the &quot;defaultValue&quot; key in the map:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!m.containsKey(&lt;span class=&quot;code-quote&quot;&gt;&apos;defaultValue&apos;&lt;/span&gt;)) { &lt;span class=&quot;code-comment&quot;&gt;// GROOVY-9599
&lt;/span&gt;    m.remove(&lt;span class=&quot;code-quote&quot;&gt;&apos;defaultValue&apos;&lt;/span&gt;) &lt;span class=&quot;code-comment&quot;&gt;// don&apos;t &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; the picocli model to empty string
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I will commit a fix and an additional test soon.&lt;/p&gt;</comment>
                            <comment id="17141625" author="remkop@yahoo.com" created="Mon, 22 Jun 2020 01:26:52 +0000"  >&lt;p&gt;Fix and additional test committed to the &lt;a href=&quot;https://github.com/apache/groovy/commit/16a5c42e53c440d3675d7b7cb91113a584663b86&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;master&lt;/a&gt;, &lt;a href=&quot;https://github.com/apache/groovy/commit/829b19c7bcc91b3aa80f16379f980dc5dcdf9c64&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;GROOVY_3_0_X&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/groovy/commit/ede7ffca2bf151471cfc888ee41d4c4f68d3d906&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;GROOVY_2_5_X&lt;/a&gt; branches.&lt;/p&gt;

&lt;p&gt;Test results look good in &lt;a href=&quot;https://groovy.apache.org/buildstatus.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CI&lt;/a&gt; (&lt;a href=&quot;https://ci.groovy-lang.org/viewLog.html?buildId=2154&amp;amp;buildTypeId=MasterTestJdk8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;master&lt;/a&gt;,  &lt;a href=&quot;https://ci.groovy-lang.org/viewLog.html?buildId=2151&amp;amp;buildTypeId=Groovy30xTestAllJdk8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;3.0&lt;/a&gt;, &lt;a href=&quot;https://ci.groovy-lang.org/viewLog.html?buildId=2159&amp;amp;buildTypeId=Groovy25xCheckJdk8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.5&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Resolving this ticket as fixed.&lt;/p&gt;</comment>
                            <comment id="17141714" author="dheinric" created="Mon, 22 Jun 2020 05:34:17 +0000"  >&lt;p&gt;Great, thanks a lot &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rpopma&quot; class=&quot;user-hover&quot; rel=&quot;rpopma&quot;&gt;rpopma&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13300198">GROOVY-9519</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 21 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0fzz4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>