<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:31:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-5074] SwingBuilder never shuts down the default executor service</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-5074</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;If you use the swingbuilder.doOutside() method, the execution is delegated to an executor service which is set globally (static variable). The problem is that when application exits, the executor service is never shutdown, so the VM won&apos;t exit.&lt;/p&gt;

&lt;p&gt;Steps to reproduce :&lt;/p&gt;

&lt;p&gt;1. Open Groovy Console&lt;br/&gt;
2. any code like &quot;println &apos;hello&apos;&quot; will do&lt;br/&gt;
3. Open AST Browser (which internally calls doOutside)&lt;br/&gt;
4. Exit the console with the menu. The application won&apos;t return&lt;br/&gt;
5. kill -3 &amp;lt;pid of the groovy console&amp;gt; to obtain a thread dump&lt;/p&gt;

&lt;p&gt;The thread dump shows threads waiting from the executor service :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;pool-1-thread-2&quot;&lt;/span&gt; prio=10 tid=0x0000000040cbe800 nid=0x1204 waiting on condition [0x00007f1a06478000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (parking)
	at sun.misc.Unsafe.park(Native Method)
	- parking to wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;  &amp;lt;0x0000000784fe14b0&amp;gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
	at java.util.concurrent.locks.LockSupport.park(LockSupport.java:156)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:1987)
	at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:399)
	at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:947)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)

&lt;span class=&quot;code-quote&quot;&gt;&quot;pool-1-thread-1&quot;&lt;/span&gt; prio=10 tid=0x0000000041c6b800 nid=0x1203 waiting on condition [0x00007f1a06579000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (parking)
	at sun.misc.Unsafe.park(Native Method)
	- parking to wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;  &amp;lt;0x0000000784fe14b0&amp;gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
	at java.util.concurrent.locks.LockSupport.park(LockSupport.java:156)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:1987)
	at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:399)
	at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:947)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="12814689">GROOVY-5074</key>
            <summary>SwingBuilder never shuts down the default executor service</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aalmiray">Andres Almiray</assignee>
                                    <reporter username="melix">C&#233;dric Champeau</reporter>
                        <labels>
                            <label>contrib</label>
                    </labels>
                <created>Wed, 12 Oct 2011 14:23:24 +0000</created>
                <updated>Fri, 24 Jan 2014 13:18:08 +0000</updated>
                            <resolved>Thu, 10 Jan 2013 11:47:17 +0000</resolved>
                                    <version>1.8.2</version>
                    <version>1.8.3</version>
                    <version>1.9-beta-4</version>
                                    <fixVersion>2.1.0-rc-1</fixVersion>
                                    <component>Groovy Console</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14473565" author="cutterslade" created="Fri, 23 Nov 2012 15:47:16 +0000"  >&lt;p&gt;I&apos;ve seen this same issue in version 2.0.5, using just the groovy console (on windows). Steps to reproduce:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Start the groovy console from the command line,
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;gt; groovyConsole.bat
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Open a file, any file will do,&lt;/li&gt;
	&lt;li&gt;Close the console.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The &lt;tt&gt;groovyConsole.bat&lt;/tt&gt; command will not return. Getting a thread dump at this point shows a similar non-daemon thread still running:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;pool-1-thread-1&quot; prio=6 tid=0x0000000008dd6000 nid=0x1564 waiting on condition [0x000000001a09f000]
   java.lang.Thread.State: WAITING (parking)
        at sun.misc.Unsafe.park(Native Method)
        - parking to wait for  &amp;lt;0x00000000f85980e8&amp;gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2043)
        at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)
        at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1043)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1103)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
        at java.lang.Thread.run(Thread.java:722)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14473708" author="pschumacher" created="Sat, 5 Jan 2013 03:55:36 +0000"  >&lt;p&gt;Possible solutions:&lt;br/&gt;
1. Add a method to shutdown the ExecutorService of SwingBuilder&lt;br/&gt;
2. Remove the ExecutorService&lt;br/&gt;
3. ???&lt;/p&gt;</comment>
                            <comment id="14473667" author="aalmiray" created="Mon, 7 Jan 2013 08:17:19 +0000"  >&lt;p&gt;The problem appears to be that the ExecutorService is never shutdown, because all Threads created by the ExecutorService are not daemon threads the application will &apos;hang&apos; upon closing. Here are some possible solutions:&lt;/p&gt;

&lt;p&gt; 1. Revert back to spawning a new Thread (&lt;b&gt;sigh&lt;/b&gt;)&lt;br/&gt;
 2. Use a custom ThreadFactory that calls setDaemon(true) on the newly created Threads (risky?)&lt;br/&gt;
 3. Keep track of how many ExecutorServices are instantiated and shut them down at the right time (quite difficult with plain SwingBuilder).&lt;/p&gt;

&lt;p&gt;FYI option #3 is what we decided to apply in Griffon (see &lt;a href=&quot;https://github.com/griffon/griffon/commit/feed358e20f76d7b2cc4d3df779315310ac8a0b4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/griffon/griffon/commit/feed358e20f76d7b2cc4d3df779315310ac8a0b4&lt;/a&gt;) as we can clearly identify the moment when the application must shutdown.&lt;/p&gt;</comment>
                            <comment id="14473690" author="melix" created="Mon, 7 Jan 2013 08:24:39 +0000"  >&lt;p&gt;mmm, solution #2 looks ok to me. It would be risky if the thread was killed, but I don&apos;t think the JVM kills any thread, it just waits until it&apos;s done then shuts down the VM.&lt;/p&gt;</comment>
                            <comment id="14473867" author="pschumacher" created="Mon, 7 Jan 2013 12:30:10 +0000"  >&lt;p&gt;&quot;Marks this thread as either a daemon thread or a user thread. The Java Virtual Machine exits when the only threads running are all daemon threads.&quot;&lt;br/&gt;
source: &lt;a href=&quot;http://docs.oracle.com/javase/6/docs/api/java/lang/Thread.html#setDaemon%28boolean%29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.oracle.com/javase/6/docs/api/java/lang/Thread.html#setDaemon%28boolean%29&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So I guess daemon threads are killed on exit. This is confirmed by:&lt;/p&gt;

&lt;p&gt;&quot;When the JVM halts, any remaining daemon threads are abandoned &#151; finally blocks are not executed, stacks are not unwound &#151; the JVM just exits. Daemon threads should be used sparingly&#151;few processing activities can be safely abandoned at any time with no cleanup. In particular, it is dangerous to use daemon threads for tasks that might perform any sort of I/O.&quot;&lt;br/&gt;
source: Brian Goetz - Java Concurrency in Practice, p. 165&lt;/p&gt;

&lt;p&gt;Therefore &quot;1. Revert back to spawning a new Thread&quot; looks like the best option. Else users could be in for potentially unpleasant surprises.&lt;/p&gt;</comment>
                            <comment id="14473762" author="melix" created="Tue, 8 Jan 2013 02:44:19 +0000"  >&lt;p&gt;You&apos;re right, I forgot about that... Reading Brian Goetz is always useful &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; So, going back to plain old threads is a solution, but not really enjoyable...&lt;/p&gt;

&lt;p&gt;Google Guava has a nice tool to deal with this problem. It&apos;s basically a combination of solution 2 and a JVM shutdown hook to wait for the tasks to be complete: &lt;a href=&quot;http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/util/concurrent/MoreExecutors.html#getExitingExecutorService(java.util.concurrent.ThreadPoolExecutor&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/util/concurrent/MoreExecutors.html#getExitingExecutorService(java.util.concurrent.ThreadPoolExecutor&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Maybe we should implement something like this in Groovy.&lt;/p&gt;</comment>
                            <comment id="14473743" author="aalmiray" created="Tue, 8 Jan 2013 02:53:25 +0000"  >&lt;p&gt;Perhaps, though in my experience ShutdownHooks are called after all non-daemon threads are stopped/finish (but I may be missing something here). So, I can revert back the code to plain Threads just for the sake of unsticking this issue. We can decide later how to optimize it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14473778" author="aalmiray" created="Tue, 8 Jan 2013 08:01:23 +0000"  >&lt;p&gt;Pull request sent &lt;a href=&quot;https://github.com/groovy/groovy-core/pull/103&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/groovy/groovy-core/pull/103&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14473763" author="melix" created="Tue, 8 Jan 2013 08:29:47 +0000"  >&lt;p&gt;I merged your pull request in both &lt;tt&gt;master&lt;/tt&gt; and &lt;tt&gt;2.0.x&lt;/tt&gt;. Do you think we should close this issue and create another one as an improvement or keep this one open?&lt;/p&gt;</comment>
                            <comment id="14473709" author="aalmiray" created="Tue, 8 Jan 2013 08:41:32 +0000"  >&lt;p&gt;I don&apos;t like that fact of creating Threads and then throwing them away. I guess it won&apos;t hurt to close this one and open an improvement ticket. We can revisit performance issues at a later date, don&apos;t you think?&lt;/p&gt;</comment>
                            <comment id="14473744" author="melix" created="Tue, 8 Jan 2013 08:45:25 +0000"  >&lt;p&gt;Agreed&lt;/p&gt;</comment>
                            <comment id="14473817" author="pschumacher" created="Thu, 10 Jan 2013 11:11:05 +0000"  >&lt;p&gt;should have fix version 2.1.0-rc-1&lt;/p&gt;</comment>
                            <comment id="14475494" author="dhalbert" created="Fri, 24 Jan 2014 13:18:08 +0000"  >&lt;p&gt;I&apos;m a little late, since this is closed, but I don&apos;t see the improvement ticket mentioned above:&lt;/p&gt;

&lt;p&gt;Note that the semantics of using Thread.start() vs ExecutorService.submit() are different for exceptions inside doOutside{}. ExecutorService.submit() uses a Future which traps exceptions until someone calls Future.get(), which doOutside() did not call. This does not happen with a simple Thread.&lt;/p&gt;

&lt;p&gt;I ended up asking and then self-answering a SO question on this: &lt;a href=&quot;http://stackoverflow.com/questions/21336367/handling-exceptions-in-groovy-swingbuilder-dooutside&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/21336367/handling-exceptions-in-groovy-swingbuilder-dooutside&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 43 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cohr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>