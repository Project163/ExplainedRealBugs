<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:13:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-3830] java.lang.IncompatibleClassChangeError thrown with Interface containing variable</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-3830</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;First reported in &lt;a href=&quot;http://jira.codehaus.org/browse/GROOVY-3823&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jira.codehaus.org/browse/GROOVY-3823&lt;/a&gt;, opening a new Jira, as advised.&lt;/p&gt;

&lt;p&gt;With:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; II {
  &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; i
  &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; 2i = i * 2
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Currently (1.7b2), one gets:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;groovy&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; II {
groovy&amp;gt;   &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; i
groovy&amp;gt;   &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; i2 = i * 2
groovy&amp;gt; }
groovy&amp;gt; println II.i
groovy&amp;gt; println II.i2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Exception thrown&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.IncompatibleClassChangeError: Found &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; II, but &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;was expected

	at II.&amp;lt;clinit&amp;gt;(ConsoleScript0:3)

	at ConsoleScript0.class$(ConsoleScript0)

	at ConsoleScript0.$get$$&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;II(ConsoleScript0)

	at ConsoleScript0.run(ConsoleScript0:6)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12814946">GROOVY-3830</key>
            <summary>java.lang.IncompatibleClassChangeError thrown with Interface containing variable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roshandawrani">Roshan Dawrani</assignee>
                                    <reporter username="alpheratz">alpheratz</reporter>
                        <labels>
                    </labels>
                <created>Sun, 18 Oct 2009 04:51:03 +0000</created>
                <updated>Wed, 9 Dec 2009 18:16:41 +0000</updated>
                            <resolved>Sun, 25 Oct 2009 11:58:07 +0000</resolved>
                                    <version>1.7-beta-2</version>
                                    <fixVersion>1.6.6</fixVersion>
                    <fixVersion>1.7-rc-1</fixVersion>
                                    <component>Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="14467823" author="roshandawrani" created="Tue, 20 Oct 2009 23:10:23 +0000"  >&lt;p&gt;I think the IncompatibleClassChangeError is coming because in the interface II&apos;s &amp;lt;clinit&amp;gt;, there is an invokestatic call being made for method $getCallSiteArray()&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; (for the multiply operation in i * 2).&lt;/p&gt;

&lt;p&gt;Since interface II itself cannot contain any static methods such as $getCallSiteArray() or $createCallSiteArray(), callsites for the interface should probably be pushed into its synthetic, inner class and referenced as II$1.$getCallSiteArray()?&lt;/p&gt;

&lt;p&gt;Is there any other, simpler suggestion?&lt;/p&gt;</comment>
                            <comment id="14467978" author="roshandawrani" created="Wed, 21 Oct 2009 10:42:58 +0000"  >&lt;p&gt;Attaching a patch for review.&lt;/p&gt;

&lt;p&gt;Basically the fix is that the callsites used in the interface are being pushed to its helper inner class and later on instead of invoking $getCallSiteArray() on the interface, the call is delegated to its inner class. &lt;/p&gt;

&lt;p&gt;Also in this case, $getCallSiteArray() is made public in the inner class (usually it is private) so that it can be invoked from static constructor of the outer interface class.&lt;/p&gt;</comment>
                            <comment id="14467991" author="blackdrag" created="Wed, 21 Oct 2009 12:23:50 +0000"  >&lt;p&gt;I think I would prefer a solution that does not expose call sites, especially not in ClassNode, since callsites make no sense in more early phases&lt;/p&gt;</comment>
                            <comment id="14468004" author="roshandawrani" created="Wed, 21 Oct 2009 12:53:59 +0000"  >&lt;p&gt;Where else the callsites can be stored between the ACG invocations for interface ClassNode and its inner class ClassNode?&lt;/p&gt;

&lt;p&gt;I was trying to change the patch to store these callsites in an ACG instance variable but then CompilationUnit uses different instances of ACG for both these ClassNodes.&lt;/p&gt;

&lt;p&gt;Any better suggestions?&lt;/p&gt;</comment>
                            <comment id="14467947" author="roshandawrani" created="Wed, 21 Oct 2009 13:12:50 +0000"  >&lt;p&gt;Here is a slightly modified version of the patch. &lt;/p&gt;

&lt;p&gt;The slight difference now is that on the interface ClassNode, callsites are not set until its classgen phase and helper InnerClassNode does not try to use these callsites until its classgen phase.&lt;/p&gt;

&lt;p&gt;So, callsites are not really set and seen by earlier phases now. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14467877" author="roshandawrani" created="Wed, 21 Oct 2009 21:53:27 +0000"  >&lt;p&gt;Jochen, the 2nd patch also won&apos;t do?&lt;/p&gt;</comment>
                            <comment id="14467992" author="roshandawrani" created="Fri, 23 Oct 2009 10:01:53 +0000"  >&lt;p&gt;Jochen, busy, is it?&lt;/p&gt;

&lt;p&gt;This fix is in wait mode because of this little thing you raised in the comments earlier. Are you comfortable with the 2nd patch? Or do you suggest anything?&lt;/p&gt;</comment>
                            <comment id="14468039" author="blackdrag" created="Sun, 25 Oct 2009 07:55:15 +0000"  >&lt;p&gt;wouldn&apos;t the finer solution to make a subclass of InnerClassNode for that interface helper?&lt;/p&gt;</comment>
                            <comment id="14467950" author="roshandawrani" created="Sun, 25 Oct 2009 11:58:07 +0000"  >&lt;p&gt;OOPs.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;

&lt;p&gt;Fixed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310260">
                    <name>Related</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12814865">GROOVY-3823</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12722069" name="v16x_3830.txt" size="6421" author="roshandawrani" created="Wed, 21 Oct 2009 10:42:58 +0000"/>
                            <attachment id="12722231" name="v16x_3830_v2.txt" size="7132" author="roshandawrani" created="Wed, 21 Oct 2009 13:12:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 5 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bqfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>