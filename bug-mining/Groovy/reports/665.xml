<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:04:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-2453] The Map plus() method creates new TreeMap but javadoc says HashMap</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-2453</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;The implementation of DefaultGroovyMethods.plus(Map,Map) uses a TreeMap, but the javadoc says HashMap.&lt;br/&gt;
I think a HashMap should be used here. I think that performs better.&lt;/p&gt;

&lt;p&gt;In the odd case that someone wants to add two maps and have a sorted map as the result, it should be implemented explicitly, like&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;result = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TreeMap( map1 )
result.putAll( map2 )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;or with the (still missing) leftShift operator&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;result = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TreeMap( map1 ) &amp;lt;&amp;lt; map2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, +1 for the leftshift operator (&lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-644&quot; title=&quot;New Groovy JDK methods - to improve consistency&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-644&quot;&gt;&lt;del&gt;GROOVY-644&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;I think I&apos;ll try to write a patch for this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12813995">GROOVY-2453</key>
            <summary>The Map plus() method creates new TreeMap but javadoc says HashMap</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="rene.de.bloois">Ren&#233; de Bloois</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Dec 2007 07:44:38 +0000</created>
                <updated>Sun, 27 Apr 2008 04:51:11 +0000</updated>
                            <resolved>Sat, 19 Apr 2008 19:04:02 +0000</resolved>
                                    <version>1.5.1</version>
                                    <fixVersion>1.5.6</fixVersion>
                    <fixVersion>1.6-rc-2</fixVersion>
                                    <component>groovy-jdk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14463938" author="blackdrag" created="Sun, 30 Dec 2007 01:27:38 +0000"  >&lt;p&gt;we decided not to change the type if possible, so a plus with a TreeMap stays a TreeMap, same for our LinkedHashMap. The bug here is that the documentation doesn&apos;t tell you this, so the docu needs to be fixed.&lt;/p&gt;</comment>
                            <comment id="14464048" author="rene.de.bloois" created="Sun, 30 Dec 2007 10:43:09 +0000"  >&lt;p&gt;I can live with that if it is done right. For example, the plus(Collection,Collection) is not correct in my opinion. It only looks at the left side.&lt;/p&gt;

&lt;p&gt;For example:&lt;br/&gt;
Set + List -&amp;gt; HashSet&lt;br/&gt;
List + Set -&amp;gt; Arraylist&lt;/p&gt;

&lt;p&gt;I think this is wrong because the order of the operands should not matter for a +.&lt;/p&gt;

&lt;p&gt;With regards to plus(Map,Map), what do you get when you add a TreeMap and a LinkedHashMap? They have conflicting behaviours. The solution would be to consistently return something that has common behaviour from both sides instead of adding all behaviours together. So you get the following decision table:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Map&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;SortedMap&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;LinkedHashMap&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Map&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;HashMap&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;HashMap&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;HashMap&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;SortedMap&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;HashMap&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;TreeMap&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;HashMap&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;LinkedHashMap&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;HashMap&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;HashMap&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;LinkedHashMap&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;plus(Collection,Collection) would then become:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Collection&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;List&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Set&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;SortedSet&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;LinkedHashSet&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Collection&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ArrayList&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ArrayList&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ArrayList&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ArrayList&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ArrayList&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;List&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ArrayList&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ArrayList&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ArrayList&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ArrayList&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ArrayList&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Set&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ArrayList&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ArrayList&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;HashSet&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;HashSet&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;HashSet&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;SortedSet&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ArrayList&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ArrayList&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;HashSet&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;TreeSet&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;HashSet&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;LinkedHashSet&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ArrayList&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ArrayList&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;HashSet&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;HashSet&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;LinkedHashMap&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;But as a programmer I&apos;m still struggling with this. I would be perfectly happy when we remove SortedMap, LinkedHashMap, SortedSet and LinkedHashSet out of the picture. The combinations are endless (for example, we can add Queues, Stacks, whatever, or classes from commons-collections). It makes it more clear if I can only get a List, Set or Map result.&lt;/p&gt;

&lt;p&gt;Another argument for this would be the following: 99% of the time I work with ArrayList or HashSet or HashMap. Sometimes I will add items from my own collection and items from a second collection of unknown type together. Because of the unknown type of the second collection I will always be uncertain about the resulting type of the addition.&lt;br/&gt;
Putting it another way: sometimes you work with collections from a different source than your own. You don&apos;t know (and don&apos;t want to know) the actual type. If you then add your own HashSet and this unknown Set , you&apos;ll get a HashSet, TreeSet or LinkedHashSet dependent on the type of this unknown Set. You effectively loose control.&lt;/p&gt;

&lt;p&gt;So I would be perfectly happy if adding Maps will get me a HashMap, and adding collections will get me an ArrayList, and adding 2 Sets will give me a HashSet.&lt;/p&gt;

&lt;p&gt;It would be better explainable too.&lt;/p&gt;

&lt;p&gt;And if I want more control, I can use the leftshift operator.&lt;/p&gt;</comment>
                            <comment id="14464029" author="rene.de.bloois" created="Mon, 31 Dec 2007 06:03:29 +0000"  >&lt;p&gt;On the other hand, after struggling with it some more... it could make life easier if plus() behaves asymmetrically (as it does now for plus(Collection,Collection). But it should be documented well. And it should be understandable and implemented consistently. Just needs some getting used to.&lt;/p&gt;

&lt;p&gt;To add to this, maybe the type can be inferred through reflection?&lt;/p&gt;

&lt;p&gt;AnswerToLifeTheUniverseAndEverythingMap + SomeMap gives back a new AnswerToLifeTheUniverseAndEverythingMap?&lt;/p&gt;

&lt;p&gt;Construction of known types can still be optimized, when recognized using type equality (instead of instanceof).&lt;/p&gt;</comment>
                            <comment id="14464057" author="rene.de.bloois" created="Wed, 2 Jan 2008 05:46:39 +0000"  >&lt;p&gt;Apparently I was wrong about the Map &amp;lt;&amp;lt; Map. Although &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-644&quot; title=&quot;New Groovy JDK methods - to improve consistency&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-644&quot;&gt;&lt;del&gt;GROOVY-644&lt;/del&gt;&lt;/a&gt; speaks of adding this, it contradicts the semantics of the leftShift operator. I think &amp;lt;&amp;lt; should only add 1 item at the time. Am I right about that?&lt;/p&gt;

&lt;p&gt;Maybe we are missing the possibility to overload the += operator.&lt;/p&gt;

&lt;p&gt;The problem with the following loop for example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Map map = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TreeMap()
somekindofloop() {
    map += getSubMapFromSomewhere( loopVariable )
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;is that it creates a new TreeMap with each iteration. I assume that the plus() is called here for the two maps.&lt;/p&gt;

&lt;p&gt;If we could overload the += operator with a method plusAssignment(). That would seriously improve performance of the loop above.&lt;/p&gt;</comment>
                            <comment id="14464000" author="blackdrag" created="Wed, 2 Jan 2008 06:33:30 +0000"  >&lt;p&gt;+= is no operator on its own, it consists of doing + followed by an assignment. Adding one item only by using &amp;lt;&amp;lt; on lists is on story, but there is no such item in map, as anything consists of pairs there. A &amp;lt;&amp;lt; on Map has to deal with the problem on how to handle duplicates. Overwrite them or not? If we say it can overwrite it would be equal to Map#putAll and do exactly what you wanted to use for +=. Additionally we have the convention that + creates a new object... so if you go and change it for += it is a bit strange, since you still have the + in there. And it would not fit the way numbers are dealt with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def a = 1
def b = a
a += 1  &lt;span class=&quot;code-comment&quot;&gt;// += used here
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; a==2
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; b==1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Noe I am aware that a Map is no number, but we should try to be as consistent with the operators as possible, because you are used as example for how the user implements their own operators. And I so not see any good reason to introduce an += operator just to make code that won&apos;t behave like the one above. There might be other good reasons, but then we should discuss about them, not use something that looks good in one case and is in general not good. If you want to suggest the addition of &amp;lt;&amp;lt; on Maps as an alias to putAll, then we can do that.&lt;/p&gt;</comment>
                            <comment id="14464109" author="rene.de.bloois" created="Thu, 3 Jan 2008 04:46:16 +0000"  >&lt;p&gt;I see your point, but I&apos;m not entirely convinced. A programmer would be more surprised if he hears that &quot;map1 += map2&quot; creates a new map instead of just appending to the existing map. That&apos;s because += means &quot;add x to an existing y&quot; comparable to the ++ operator which adds 1. Programmers then know that they are mutating an existing map. On the other hand, this may break existing code built on the assumption that it will create a new map.&lt;/p&gt;

&lt;p&gt;Regarding your point that we can make a exception for Map &amp;lt;&amp;lt; Map because Map &amp;lt;&amp;lt; item is not possible (which is true of course), that would not be consistent with the current Collection &amp;lt;&amp;lt; Collection or Set &amp;lt;&amp;lt; Set implementation.&lt;/p&gt;

&lt;p&gt;I think we are stuck with using addAll() and putAll()&apos;s then. (with the risk that programmers will accidentally use the non performing += because most of us favor using operators over methods where possible).&lt;/p&gt;

&lt;p&gt;The existence of plus( Collection, Object ), makes the risk even greater that programmers will use that in a loop to add items to a collection (where of course they should have used &amp;lt;&amp;lt;).&lt;/p&gt;

&lt;p&gt;To sum up my view regarding collections and maps:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;lt;&amp;lt;&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;add an item to a collection&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;+&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;add two collections or maps&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;+=&lt;/th&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;add one collection/map to another&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Just presenting my arguments &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; the decision is yours of course&lt;/p&gt;</comment>
                            <comment id="14464058" author="blackdrag" created="Thu, 3 Jan 2008 07:29:32 +0000"  >&lt;p&gt;see my example with the numbers. Here+= does not add a value to a in a sense that it will change b too. If we were in C and a would be a pointer to a number and b would be a pointer to the same number, then increasing this number and saving the new number at the same place would also change the value b points to. But you are working with two pointers here and you need to let C explicitly know about this... well, I hope at last, my C isn&apos;t that good anymore. We should possibly do this more in Java terms if we work with a simple bean:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Bean {def x}
def a = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Bean(x:1)
def a = b
a.x += 1
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; a.x == 2
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; b==a
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; b.x==2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You see, I qualified the x with an a and changed the x while keeping the a. And since b points to the same place as a, b.x is changed as well.Now think of this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def bean = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Bean(x:1)
def a = bean.x
def b = a
a += 1
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; a == 2
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; a!=b
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; b==1
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; x.x==1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As you see I changed a, but I did not change b. ok, next step... now think that in our first example we did not &lt;tt&gt;a.x+=1&lt;/tt&gt;, but &lt;tt&gt;a+=1&lt;/tt&gt; and said it will update the &lt;tt&gt;x&lt;/tt&gt;. Other parts of the code will not change. Let us call this modified first example &lt;em&gt;reference based&lt;/em&gt; and second example &lt;em&gt;value based&lt;/em&gt;. You see there is a big difference in the locality of the change and if you think about it you will see that all math Java has is value based. Or maybe I should better say that all the usual math is more or less value based than reference based. I usually can add two variables in an algebra and getting a new value (or what ever) without having changed the operands.&lt;/p&gt;

&lt;p&gt;If we are &lt;em&gt;value based&lt;/em&gt; then it would be kind of strange to say that &lt;tt&gt;a+b&lt;/tt&gt; does not change the operands, but &lt;tt&gt;a+=b&lt;/tt&gt; will. It is strange because it is not like numbers would behave and numbers are &lt;em&gt;value based&lt;/em&gt;. At a early time of the project we decided, that the normal operands like &lt;tt&gt;&amp;#43;,&amp;#45;,*,/,&amp;#43;&amp;#43;,&amp;#45;-&lt;/tt&gt; should be &lt;em&gt;value based&lt;/em&gt;, which means to create a new Object without changing the operands each time they are executed.&lt;/p&gt;

&lt;p&gt;What you now suggest is to say that &lt;tt&gt;a+=b&lt;/tt&gt; should not behave this way for Collections and Map.This means to introduce an inconsistency on purpose.. So the purpose should be better a good one, as you have to defend that decision and explain why it behaves differently here.&lt;/p&gt;

&lt;p&gt;You mentioned &lt;tt&gt;&amp;#43;&amp;#43;&lt;/tt&gt;, but for numbers it is just a shortcut for &lt;tt&gt;&amp;#43;=1&lt;/tt&gt; and according to the things I wrote above it is still value based, which means &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def bean = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Bean(x:1)
def a = bean.x
def b = a
a ++
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; a == 2
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; a!=b
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; b==1
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; x.x==1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;or in other words: it will change nothing for a number. If you look at &lt;tt&gt;DefaultGroovyMethods&lt;/tt&gt; you will see, that we have a &lt;tt&gt;next()&lt;/tt&gt; defined for Number, Character, Date and String and in all these cases &lt;tt&gt;next&lt;/tt&gt; will create a new object. So &lt;tt&gt;++&lt;/tt&gt; does not means &quot;add 1&quot;, it means &quot;call the next() method and save the generated object&quot;. Theoretically &lt;tt&gt;next()&lt;/tt&gt; is free to modify and return itself, but that is the choice of the programmer for his class and he will have to defend his decision on his own. I wouldn&apos;t advise this.&lt;/p&gt;

&lt;p&gt;Ok, back to &lt;tt&gt;+=&lt;/tt&gt;... you said: &quot;Programmers then know that they are mutating an existing map&quot;. that may be right, but they do have to know that it is a Map they are working with. While in the other case they can know that if they do any of the usual operators they will get a new object. While the later comes naturally when working with numbers, the first requires special knowledge about the type. Just think for example of a generic sum() method. In Groovy you could implement it like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def sum(l) {
  def first = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
  def sum=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (x in l) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (first) {
      sum=x
      first=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
   } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      sum+=x
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This will work with almost any object.. now think &lt;tt&gt;l&lt;/tt&gt; is a ArrayList&amp;lt;Map&amp;gt; for example, then your suggestion will lead to a modification of the first element of the list. which means the algorithm, which works perfectly for lists of numbers and many more, will have to be modified from &lt;tt&gt;sum+=x&lt;/tt&gt; to &lt;tt&gt;sum=sum+x&lt;/tt&gt;. Which in the end means you have different logic for + and += and this means on the other hand that += can&apos;t be used as shortcut anymore. So your suggestion may not only breaking code, it will break code.&lt;/p&gt;

&lt;p&gt;Now with the &lt;tt&gt;&amp;lt;&amp;lt;&lt;/tt&gt; operator...In this case we broke the consistency with numbers and &lt;em&gt;value based&lt;/em&gt; logic on purpose, because we followed the C++ idea of using &lt;tt&gt;&amp;lt;&amp;lt;&lt;/tt&gt; to &lt;em&gt;put something into something&lt;/em&gt; which is of course &lt;em&gt;reference based&lt;/em&gt;. Now what would it mean to put a Map into another Map without having a key? We had long discussions for List if &lt;tt&gt;&amp;lt;&amp;lt;&lt;/tt&gt; means to actually append a list to a list if the second operator is a list, or if it means to put the second list into the first list as last element. We decided for the &lt;em&gt;put into&lt;/em&gt; idea, since it seemed to be more consistent with how other objects are used. Now the only &lt;em&gt;put into&lt;/em&gt; operation that makes sense for a Map with only a value is in my eyes if that value is also a Map and we put all the key/value pairs from that Map into the old Map. So if you argue with consistency here, then the only answer would be to not to have a &lt;tt&gt;&amp;lt;&amp;lt;&lt;/tt&gt; for Maps at all. But I must say I don&apos;t get your argument fully, because a Set is also a Collection, so they are related, ok... but a Map is no Collection and thus not related.On the other hand I think that Map&amp;lt;&amp;lt; is such a special case, that we can life without it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;The reason why I suggested to use &lt;tt&gt;&amp;lt;&amp;lt;&lt;/tt&gt; here instead is that you may have to know the types you are working with to use this operator anyway. Every class might define here its own logic and &lt;tt&gt;&amp;lt;&amp;lt;&lt;/tt&gt; applies by far not to as much objects as for example &lt;tt&gt;+&lt;/tt&gt;. So I thought that we could let it alias putAll... but on the other hand I think it is really not needed. And maybe we are better off without it.&lt;/p&gt;

&lt;p&gt;So in the end... yes, the user has to use putAll and addAll, to be sure hisspecial logic will be used. But I think that is ok. Even if it is a performance trap... you will go into this one time and then nether again. to do our best to avoid having the user go through all that trouble added this comment to all &lt;tt&gt;plus&lt;/tt&gt; methods:  &lt;em&gt;This operation will always create a new object for the result,  while the operands remain unchanged.&lt;/em&gt;&lt;/p&gt;
</comment>
                            <comment id="14464110" author="rene.de.bloois" created="Thu, 3 Jan 2008 09:59:01 +0000"  >&lt;p&gt;You convinced me with the &apos;sum&apos; example. Good discussion, thanx.&lt;/p&gt;

&lt;p&gt;In Groovy 2.0 (with custom operators) maybe we can define something like &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Collection &amp;lt;+ Collection
Map &amp;lt;+ Map
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;or&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Collection &amp;lt;&amp;lt;&amp;lt; Collection
Map &amp;lt;&amp;lt;&amp;lt; Map
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Looks nice &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="14464072" author="blackdrag" created="Thu, 3 Jan 2008 11:18:59 +0000"  >&lt;p&gt;A good discussion always requires two or more people and I like a good discussion very much... so thanks to you too. I think &lt;tt&gt;&amp;lt;&amp;lt;&amp;lt;&lt;/tt&gt; is already an operator you could use... not sure, I nearly never use it. but yes... the Groovy 2.0 line would be good to introduce these things. &lt;/p&gt;</comment>
                            <comment id="14464092" author="blackdrag" created="Thu, 3 Jan 2008 11:19:42 +0000"  >&lt;p&gt;ah yes.. forgot to ask... I can close this issue as &quot;won&apos;t fix&quot; then?&lt;/p&gt;</comment>
                            <comment id="14464132" author="rene.de.bloois" created="Thu, 3 Jan 2008 14:17:14 +0000"  >&lt;p&gt;Well, actually, the original issue was that the javadoc did not match the implementation: TreeMap vs HashMap.&lt;/p&gt;

&lt;p&gt;During the discussion I was already experimenting with the thing I mentioned in my comment from 31/Dec/07 06:03 AM:&lt;/p&gt;

&lt;p&gt;&quot;maybe the type can be inferred through reflection?&quot;&lt;/p&gt;

&lt;p&gt;So I had already tried something like&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (HashMap, LinkedHashMap, Hashtable or IdentityHashMap) {
	result = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; XxxMap(leftsize + rightsize) &lt;span class=&quot;code-comment&quot;&gt;// Same type as left side
&lt;/span&gt;	result.putAll(left)
	result.putAll(right)
	&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; result
} 

&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (TreeMap) {
	result = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TreeMap(left) &lt;span class=&quot;code-comment&quot;&gt;// This inherits the sort order too
&lt;/span&gt;	result.putAll(right)
	&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; result
}

&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
	result = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; XxxMap()
} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;(missing &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; constructor) {
	result = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap(leftsize + rightsize) &lt;span class=&quot;code-comment&quot;&gt;// fallback
&lt;/span&gt;}
result.putAll(left)
result.putAll(right)
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; result
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I can create a new improvement-issue for that if you like.&lt;/p&gt;</comment>
                            <comment id="14478084" author="paulk" created="Sat, 19 Apr 2008 19:04:02 +0000"  >&lt;p&gt;Improved the Javadoc and made the resulting Map preserve the original type for the following 4 cases, otherwise it defaults to a HashMap.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def other = [c: 3]
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; ([a: 1, b: 2] as Properties)    + other == [a:1, b:2, c:3] as Properties
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; ([a: 1, b: 2] as Hashtable)     + other == [a:1, b:2, c:3] as Hashtable
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; ([a: 1, b: 2] as LinkedHashMap) + other == [a:1, b:2, c:3] as LinkedHashMap
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; ([a: 1, b: 2] as TreeMap)       + other == [a:1, b:2, c:3] as TreeMap
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I just handled some of the more common cases rather than trying to be too fancy. I&apos;ll double check concistency with List and Set shortly.&lt;/p&gt;</comment>
                            <comment id="14478093" author="paulk" created="Sat, 19 Apr 2008 19:56:17 +0000"  >&lt;p&gt;Yes, having a look at teh set and list cases, the only anomaly is whether we should return a LinkedList if that is the original (left) type for plus on Collection.&lt;/p&gt;</comment>
                            <comment id="14464672" author="paulk" created="Sat, 19 Apr 2008 20:07:33 +0000"  >&lt;p&gt;Changed that too, see &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-2764&quot; title=&quot;Plus on Collection tries to keep similar type of original collection but not for LinkedList&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-2764&quot;&gt;&lt;del&gt;GROOVY-2764&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310260">
                    <name>Related</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12816462">GROOVY-2388</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 32 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c43j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>