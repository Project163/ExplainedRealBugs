<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:09:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-9719] Class loading issue when class has annotation referenced to a nested class</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-9719</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;A MultipleCompilationErrorsException is thrown when we try to load a class that has a reference to a nested class via annotation.&lt;/p&gt;

&lt;p&gt;Here a small example:&lt;br/&gt;
We have two classes class A and B. Class A has a reference to the nested class of class B (NestedInB) in the annotation.  Class A can not be loaded except the annotation is removed.&lt;br/&gt;
&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; pkg2
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; pkg1.B

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;A {&#160;
@SuppressWarnings(value = [B.NestedInB.NestedProp])&#160; 
  A() {&#160;&#160;&#160;
&#160;&#160; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name = B.NestedInB.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName();&#160;&#160;&#160;&#160;&#160; 
   &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(name);&#160;&#160;&#160;&#160;&#160;      
   &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(B.NestedInB.NestedProp);&#160; 
  }
}&#160;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; pkg1
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; pkg2.A

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;B {
      &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; Prop = &lt;span class=&quot;code-quote&quot;&gt;&quot;ABCD&quot;&lt;/span&gt;;

     B() {
        A a = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; A()
      }
  
     &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;NestedInB {
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; NestedProp = &lt;span class=&quot;code-quote&quot;&gt;&quot;ABCD&quot;&lt;/span&gt;;
   }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void test2() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File mainDirectory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;Path to the &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;A and B&quot;&lt;/span&gt;);
    URL url = mainDirectory.getAbsoluteFile().toURI().toURL();
    groovyClassLoader.addURL(url);
    groovyClassLoader.addClasspath(mainDirectory.getPath());
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; a = groovyClassLoader.loadClass(&lt;span class=&quot;code-quote&quot;&gt;&quot;pkg2.A&quot;&lt;/span&gt;);
    a.newInstance();
    assertNotNull(a);
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="13326031">GROOVY-9719</key>
            <summary>Class loading issue when class has annotation referenced to a nested class</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="AnilRasouli">Anil Rasouli</reporter>
                        <labels>
                            <label>annotations</label>
                    </labels>
                <created>Fri, 4 Sep 2020 07:20:03 +0000</created>
                <updated>Tue, 5 Jul 2022 16:37:15 +0000</updated>
                                            <version>2.4.3</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17200873" author="emilles" created="Wed, 23 Sep 2020 14:55:17 +0000"  >&lt;p&gt;The latest release of Groovy 2.4 is 2.4.20.  I believe this issue is resolved there.  Can you try it out?&lt;/p&gt;</comment>
                            <comment id="17203061" author="anilrasouli" created="Mon, 28 Sep 2020 07:37:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt; I tried it with the version 2.4.20 and also with the latest Groovy version 3.0.5 and the issue is still not resolved.&lt;/p&gt;</comment>
                            <comment id="17203509" author="emilles" created="Mon, 28 Sep 2020 20:26:52 +0000"  >&lt;p&gt;I was able to see a loader issue when classpath refers to source directory of A and B.  But when I use the target directory, the classes loaded fine.  I added a test case for reference: &lt;a href=&quot;https://github.com/apache/groovy/commit/4acca2856baf7483b23bdf9002b35a6bf4501da2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/4acca2856baf7483b23bdf9002b35a6bf4501da2&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17203732" author="anilrasouli" created="Tue, 29 Sep 2020 07:07:51 +0000"  >&lt;p&gt;It works now, but only if I use the CompilationUnit and add all scripts as source &lt;b&gt;compilationUnit.addSources(scripts);&lt;/b&gt;&lt;br/&gt;
So this is the intended way to load scripts? Figuring out the paths of all scripts and also the base path of all scripts and adding them to the CompilationUnit?&lt;/p&gt;</comment>
                            <comment id="17204074" author="emilles" created="Tue, 29 Sep 2020 16:06:15 +0000"  >&lt;p&gt;Is it true that A and B sources are compiled and &quot;mainDirectory&quot; references the directory that contains &quot;pkg1&quot; and &quot;pkg2&quot; where .class files reside?  If yes, then you should be able to add &quot;mainDirectory&quot; using &lt;tt&gt;GroovyClassLoader#addClasspath&lt;/tt&gt; or &lt;tt&gt;#addURL&lt;/tt&gt; &amp;#8211; you don&apos;t need to do both.  And you would not need to use &lt;tt&gt;CompilationUnit&lt;/tt&gt; at all.  I use that in the test to compile A and B separately from loading your script which references A, B and NestedInB.&lt;/p&gt;

&lt;p&gt;If &quot;mainDirectory&quot; points to sources, there is a loader issue related to inner classes that I think was looked at in &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-7812&quot; title=&quot;Static inner classes cannot be accessed from other files when running by &amp;#39;groovy&amp;#39; command&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-7812&quot;&gt;&lt;del&gt;GROOVY-7812&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17204545" author="anilrasouli" created="Wed, 30 Sep 2020 08:00:16 +0000"  >&lt;p&gt;mainDirectory points to the folder where the packages &quot;pkg1&quot; and &quot;pkg2&quot; resides with the sources (.groovy files).&lt;/p&gt;

&lt;p&gt;I have this issue also with the newest version (3.0.5). I added two unit tests on github, one test works (with CompilationUnit ) and one test does not work without the CompilationUnit: &lt;a href=&quot;https://github.com/anil88/GroovyTest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/anil88/GroovyTest&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13399603">NETBEANS-5982</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 6 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ic9c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>