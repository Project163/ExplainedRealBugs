<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:20:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-10731] Exceptions thrown from MarkupTemplateEngine when map accessors and GString interpolation are used</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-10731</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I&apos;ve observed some breaking behavior beginning with v4.0.0 and continuing through the latest 4.0.5-SNAPSHOT. All examples below pass in v3.0.12.&lt;/p&gt;

&lt;p&gt;This is a simplification of errors seen when using the japicmp-gradle-plugin v3.0.0 inside the Gradle build; specifically its use of this &lt;a href=&quot;https://github.com/melix/japicmp-gradle-plugin/blob/master/src/main/resources/templates/default.groovy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;template&lt;/a&gt; to create a HTML report.&lt;/p&gt;

&lt;p&gt;There are three different error messages produced, illustrated by the three examples below: &lt;span class=&quot;error&quot;&gt;&amp;#91;mapLookup, nestedGString, noGString&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Here is a script to reproduce:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.text.markup.MarkupTemplateEngine;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.text.markup.TemplateConfiguration;


&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; tryTemplate(name, template) {
    TemplateConfiguration templateConfiguration = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TemplateConfiguration();
    templateConfiguration.setAutoNewLine(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;); &lt;span class=&quot;code-comment&quot;&gt;// Removing &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; fixes nestedGString
&lt;/span&gt;    MarkupTemplateEngine engine = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MarkupTemplateEngine(templateConfiguration);    
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Trying $name&quot;&lt;/span&gt;)
        engine.createTemplate(template)
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) {
        println(e.message)
    }
}

tryTemplate(&lt;span class=&quot;code-quote&quot;&gt;&apos;mapLookup&apos;&lt;/span&gt;, &apos;&apos;&apos;
&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; severityMappings = [:]
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; err = &quot;&quot;

&lt;span class=&quot;code-comment&quot;&gt;// 1. these two lines fail
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// produces a java.lang.ArrayIndexOutOfBoundsException: size==0
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; foo = severityMappings[err]
span(class: &lt;span class=&quot;code-quote&quot;&gt;&quot;label label-${foo}&quot;&lt;/span&gt;)  

&apos;&apos;&apos;)

tryTemplate(&lt;span class=&quot;code-quote&quot;&gt;&apos;nestedGString&apos;&lt;/span&gt;, &apos;&apos;&apos;
&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; severityMappings = [:]
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; err = &quot;&quot;

&lt;span class=&quot;code-comment&quot;&gt;// 2. just the span line fails
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; groovy.lang.GroovyRuntimeException: ASM reporting processing error &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; GeneratedMarkupTemplate121$_run_closure1#doCall with signature java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; doCall(java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; GeneratedMarkupTemplate121:12. GeneratedMarkupTemplate121
&lt;/span&gt;html {
    span(class: &lt;span class=&quot;code-quote&quot;&gt;&quot;label label-${severityMappings[err]}&quot;&lt;/span&gt;)
}
&apos;&apos;&apos;)

tryTemplate(&lt;span class=&quot;code-quote&quot;&gt;&apos;noGString&apos;&lt;/span&gt;, &apos;&apos;&apos;
&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; severityMappings = [:]
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; err = &quot;&quot;

&lt;span class=&quot;code-comment&quot;&gt;// 3. no GString interpolation fails
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// BUG! exception &lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; phase &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;generation&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; source unit &lt;span class=&quot;code-quote&quot;&gt;&apos;GeneratedMarkupTemplate82&apos;&lt;/span&gt; Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; popping argument from operand stack tracker &lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; class
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; foo = &lt;span class=&quot;code-quote&quot;&gt;&quot;label label-&quot;&lt;/span&gt; + severityMappings[err]
span(class: foo)

&apos;&apos;&apos;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13478885">GROOVY-10731</key>
            <summary>Exceptions thrown from MarkupTemplateEngine when map accessors and GString interpolation are used</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="DPUkyle">Kyle Moore</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Aug 2022 21:41:56 +0000</created>
                <updated>Fri, 10 Feb 2023 21:40:03 +0000</updated>
                            <resolved>Sun, 28 Aug 2022 14:53:18 +0000</resolved>
                                    <version>4.0.0</version>
                    <version>4.0.1</version>
                    <version>4.0.2</version>
                    <version>4.0.4</version>
                    <version>4.0.5</version>
                                    <fixVersion>4.0.5</fixVersion>
                    <fixVersion>2.5.19</fixVersion>
                    <fixVersion>3.0.13</fixVersion>
                                    <component>Templating</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17593338" author="emilles" created="Sun, 28 Aug 2022 14:53:11 +0000"  >&lt;p&gt;The template engine calls for static compilation but sets dynamic resolution on most methods of the generated template class.  Then there is a disconnect somewhere because &quot;severityMappings.getAt(err)&quot; falls into &lt;tt&gt;IndyCallSiteWriter#makeSingleArgumentCall&lt;/tt&gt; which is not supposed to happen.&lt;/p&gt;

&lt;p&gt;I disabled static compilation for now until this can be sorted out, if static compilation is still desirable.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/8baba1ada24a75d89bd6c01ba97489526fd21717&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/8baba1ada24a75d89bd6c01ba97489526fd21717&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17596077" author="emilles" created="Sun, 28 Aug 2022 16:18:45 +0000"  >&lt;p&gt;It appears this has been a long-standing issue with the &quot;indy&quot; code path.  Groovy 4 enables this by default, which is why this appears to be a new issue for Groovy 4.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12811410">GROOVY-6939</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 11 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z183yw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>