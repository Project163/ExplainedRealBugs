<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:43:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-7124] Issue when a the version of a class in local SDK is different from compiled one</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-7124</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;As of Android 5.0 (API 21), Bundle (&lt;a href=&quot;http://developer.android.com/reference/android/os/Bundle.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://developer.android.com/reference/android/os/Bundle.html&lt;/a&gt;) class now inherits from BaseBundle (&lt;a href=&quot;http://developer.android.com/reference/android/os/BaseBundle.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://developer.android.com/reference/android/os/BaseBundle.html&lt;/a&gt;), which was added on API 21.&lt;/p&gt;

&lt;p&gt;As now `putInt()`, `putString()`, etc. - former &lt;b&gt;Bundle&lt;/b&gt; methods - are methods of &lt;b&gt;BaseBundle&lt;/b&gt; which &lt;b&gt;Bundle&lt;/b&gt; inherits &lt;b&gt;but not override&lt;/b&gt;, for some reason on API versions lower than 21 when you try to call those methods from a &lt;b&gt;Bundle object&lt;/b&gt; it will throw:&lt;/p&gt;

&lt;p&gt;java.lang.NoClassDefFoundError: android.os.BaseBundle&lt;/p&gt;

&lt;p&gt;If you call its constructor, which in API 21 only does:&lt;/p&gt;

&lt;p&gt;public Bundle() {&lt;br/&gt;
    super();&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;It will work as Groovy still looks for the constructor on that class and while on API lower than 21 the code is different, there is no problem.&lt;/p&gt;

&lt;p&gt;So even when the &lt;b&gt;BaseBundle&lt;/b&gt; class is not there Groovy still tries to call it. If you try to use those methods on a `.java` file they will work flawlessly.&lt;/p&gt;</description>
                <environment>Tried using Groovy Android plugin on Android lower than 5.0 Lollipop. Seems to happen also on &amp;#39;normal&amp;#39; Groovy code.</environment>
        <key id="12811453">GROOVY-7124</key>
            <summary>Issue when a the version of a class in local SDK is different from compiled one</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="melix">C&#233;dric Champeau</assignee>
                                    <reporter username="arasthel">Jorge Espinosa</reporter>
                        <labels>
                            <label>android</label>
                            <label>groovy</label>
                    </labels>
                <created>Mon, 20 Oct 2014 05:40:02 +0000</created>
                <updated>Wed, 17 Dec 2014 13:25:56 +0000</updated>
                            <resolved>Mon, 17 Nov 2014 08:33:57 +0000</resolved>
                                    <version>2.4.0-beta-3</version>
                                    <fixVersion>2.4.0-beta-4</fixVersion>
                                    <component>Android</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14476721" author="melix" created="Thu, 30 Oct 2014 05:12:47 +0000"  >&lt;p&gt;I need a few more details for this one:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;is the class that calls methods on Bundle statically compiled?&lt;/li&gt;
	&lt;li&gt;can you attach the .class file of a class that calls a method on Bundle and fails?&lt;/li&gt;
	&lt;li&gt;can you paste the full stacktrace?&lt;/li&gt;
	&lt;li&gt;ideally, do you have a small project that would let me reproduce the issue easily?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="14476536" author="arasthel" created="Thu, 30 Oct 2014 08:06:48 +0000"  >&lt;p&gt;&lt;del&gt;Deleted as the file wasn&apos;t the right one&lt;/del&gt;&lt;/p&gt;</comment>
                            <comment id="14476695" author="arasthel" created="Thu, 30 Oct 2014 08:08:14 +0000"  >&lt;p&gt;Attached AS project of a crashing API21 project&lt;/p&gt;</comment>
                            <comment id="14476670" author="arasthel" created="Thu, 30 Oct 2014 08:11:13 +0000"  >&lt;p&gt;Built crashing groovy class (on APIs lower than 21)&lt;/p&gt;</comment>
                            <comment id="14476559" author="arasthel" created="Thu, 30 Oct 2014 08:13:24 +0000"  >&lt;ul&gt;
	&lt;li&gt;Yes, it only happens on @CompileStatic annotated classes, otherwise, it will work fine.&lt;/li&gt;
	&lt;li&gt;There you have the compiled .class file of a sample class which calls &apos;bundle.putInt(&quot;someint&quot;, 1)&apos;.&lt;/li&gt;
	&lt;li&gt;Here is the full stack trace: &lt;a href=&quot;https://ghostbin.com/paste/2sekf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ghostbin.com/paste/2sekf&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Also, I attached you a quick project from which that class was taken. The only thing it does is create a new bundle and try to put an in on &apos;onCreate&apos;.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14476616" author="melix" created="Fri, 14 Nov 2014 01:51:42 +0000"  >&lt;p&gt;Ok, so reading the full trace I can see this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;10-30 13:03:03.649 1101-1101/com.example.arasthel.groovybugtest I/dalvikvm? Could not find method android.os.BaseBundle.putInt, referenced from method com.example.arasthel.groovybugtest.MainActivity.onCreate 10-30 13:03:03.649 1101-1101/com.example.arasthel.groovybugtest W/dalvikvm? VFY: unable to resolve virtual method 5: Landroid/os/BaseBundle;.putInt (Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;;I)V 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which is basically says that the &lt;tt&gt;onCreate&lt;/tt&gt; method has an invokevirtual &lt;tt&gt;BaseBundle#putInt&lt;/tt&gt; call. From what you tell me, it makes sense, and I have &lt;b&gt;no&lt;/b&gt; idea why Java would behave differently on this case: the bytecode references a method which has been added, so if you run it on an older SDK, it doesn&apos;t exist and it fails. @blackdrag what do you think?&lt;/p&gt;
</comment>
                            <comment id="14476729" author="arasthel" created="Fri, 14 Nov 2014 02:55:53 +0000"  >&lt;p&gt;Since Android must have backwards-compatibility it doesn&apos;t really make sense, since it could change from one version to another - as just happened. Instead of translating Bundle#putInt to BaseBundle#putInt directly, I think it should stay as it is. If the Bundle class in the device Android classes replies to the call itself, then it&apos;s good, and if it decides to reply using BaseBundle#putInt then it&apos;s good, too. &lt;/p&gt;

&lt;p&gt;I&apos;m saying this as it was easy, but I really don&apos;t know how Groovy compiler works and if this is as easy as I just said, but it makes a lot more sense to me to keep the original call than to translate it to the selected API losing compatibility.&lt;/p&gt;</comment>
                            <comment id="14476657" author="melix" created="Fri, 14 Nov 2014 03:02:15 +0000"  >&lt;p&gt;The problem is that it is not how the Java compiler works, nor the Groovy compiler. I am wondering if there&apos;s some post-processing done by the toolchain to retrofit that would be missing in the case of Groovy...&lt;/p&gt;</comment>
                            <comment id="14476753" author="blackdrag" created="Fri, 14 Nov 2014 03:51:11 +0000"  >&lt;p&gt;some thoughts... we have Bundle extends BaseBundle and putInt in BaseBundle. And we have a missing method putInt for BaseBundle in a class using Bundle, in the slightly modified version where BaseBundle does not exist.&lt;/p&gt;

&lt;p&gt;When doing an invokevirtual you could imho use BaseBundle as well as Bundle as class to make the method call with. It does not matter if it is a subclass, that does not define the method on its own. Java will resolve the call at runtime to the correct class. Now I strongly assume Java uses the declared type as base for the method call. In the code this would be Bundle. A short test shows, that assumption holds... Now the same code in Groovy will use the class the method was declared in, instead of the static class the method is called on by the place of the method call. In other words, Java produces an invokeVirtual for putString using Bundle and Groovy using BaseBundle.&lt;/p&gt;

&lt;p&gt;This is not exactly wrong, but of course the Java way is more resistant to class changes. Which means a fix would need to make a change as what base class is used for the method call.&lt;/p&gt;</comment>
                            <comment id="14476747" author="melix" created="Mon, 17 Nov 2014 06:30:27 +0000"  >&lt;p&gt;I have pushed a change that should fix this. I am not closing this issue because I still need to handle the case where the receiver implements an interface and that the target method is from the interface, like in the following example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; A{void m()}
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;B &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; A{void m(){}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;See &lt;a href=&quot;https://github.com/groovy/groovy-core/commit/8e7893897e61380f56b4aaa6e828b90b35c8d63b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/groovy/groovy-core/commit/8e7893897e61380f56b4aaa6e828b90b35c8d63b&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14476756" author="melix" created="Mon, 17 Nov 2014 08:33:57 +0000"  >&lt;p&gt;Turned out to be that the bytecode already generated an invokevirtual call for the last case so I just added a test case: &lt;a href=&quot;https://github.com/groovy/groovy-core/commit/905b42b225c5e4a58fec2ee6f421f89db60305e6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/groovy/groovy-core/commit/905b42b225c5e4a58fec2ee6f421f89db60305e6&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12723111" name="GroovyBugTest.zip" size="135720" author="arasthel" created="Thu, 30 Oct 2014 08:08:14 +0000"/>
                            <attachment id="12723253" name="MainActivity.class" size="3068" author="arasthel" created="Thu, 30 Oct 2014 08:11:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 1 week, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bysn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>