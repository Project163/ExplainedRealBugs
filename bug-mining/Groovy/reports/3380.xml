<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:58:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-8212] coerce GString to String when used as Map key</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-8212</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;When a GString is used as the key for a bracket-style map get (in this case, from an overly verbose CSV file):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;row[&lt;span class=&quot;code-quote&quot;&gt;&quot;$param URL&quot;&lt;/span&gt;]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;the &lt;tt&gt;GStringImpl&lt;/tt&gt; object is passed directly to &lt;tt&gt;Map#get(Object)&lt;/tt&gt;. Since GStrings are never equal to Strings, this means that the get will always return null.&lt;/p&gt;

&lt;p&gt;If &lt;tt&gt;row&lt;/tt&gt; is explicitly declared as a &lt;tt&gt;Map&amp;lt;String,?&amp;gt;&lt;/tt&gt;, however, Groovy ought to identify the intended behavior (using a templated string as a map key) and use the string value instead.&lt;/p&gt;

&lt;p&gt;The current behavior is a problem because even in static compilation mode, where the generic key bound is known, Groovy does not complain about the use of a GString here (because it normally treats GStrings as valid for &lt;tt&gt;String&lt;/tt&gt; targets?), but the lookup will fail at runtime.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13076365">GROOVY-8212</key>
            <summary>coerce GString to String when used as Map key</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="chrylis">Christopher Smith</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Jun 2017 01:06:04 +0000</created>
                <updated>Wed, 23 Aug 2023 09:11:18 +0000</updated>
                            <resolved>Sat, 17 Sep 2022 16:35:34 +0000</resolved>
                                    <version>2.4.10</version>
                                    <fixVersion>5.0.0-alpha-1</fixVersion>
                                    <component>Static compilation</component>
                    <component>Static Type Checker</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16472025" author="daniel_sun" created="Fri, 11 May 2018 14:45:38 +0000"  >&lt;p&gt;It is fixed: &lt;a href=&quot;https://github.com/apache/groovy/commit/5f6689638160c44dccbf2b7155d35edff2389979&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/5f6689638160c44dccbf2b7155d35edff2389979&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16556901" author="paulk" created="Thu, 26 Jul 2018 04:53:03 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daniel_sun&quot; class=&quot;user-hover&quot; rel=&quot;daniel_sun&quot;&gt;daniel_sun&lt;/a&gt;, looks like above commit is just the test. Do you now whether there was another commit? I&apos;ll set fix version to my best guess but please correct if you think that is wrong. Thnx.&lt;/p&gt;</comment>
                            <comment id="16560389" author="daniel_sun" created="Fri, 27 Jul 2018 22:01:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/pull/708&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/708&lt;/a&gt;&lt;br/&gt;
As you see, the PR is rejected to merge... so the issue still exists...&lt;/p&gt;</comment>
                            <comment id="16560419" author="paulk" created="Fri, 27 Jul 2018 22:27:13 +0000"  >&lt;p&gt;Okay. It was marked resolved but with no fix version. Thanks for reopening.&lt;/p&gt;</comment>
                            <comment id="16561046" author="daniel_sun" created="Sun, 29 Jul 2018 08:16:12 +0000"  >&lt;p&gt;I find many users expect coercing GString to String when used as Map key, so it&apos;s better to take into account how to deal with the issue properly.&lt;/p&gt;</comment>
                            <comment id="16824074" author="bgshacklett" created="Tue, 23 Apr 2019 12:29:59 +0000"  >&lt;p&gt;Has anyone found any good workarounds for this issue? I&apos;m currently wrapping my map literal in `(collectEntries{ k,v -&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;(k.toString()):v&amp;#93;&lt;/span&gt;})`, because I haven&apos;t found any way to get Groovy to use a proper string as the key if the value is dynamic. Unfortunately, this doesn&apos;t work unless only the top level key is being set dynamically.&lt;/p&gt;</comment>
                            <comment id="16824358" author="emilles" created="Tue, 23 Apr 2019 17:28:30 +0000"  >&lt;p&gt;One issue caused by Java in this space is that, for legacy reasons, Map&apos;s &lt;tt&gt;get&lt;/tt&gt;, &lt;tt&gt;containsKey&lt;/tt&gt; and other methods don&apos;t use the type parameter &lt;tt&gt;K&lt;/tt&gt; but instead &lt;tt&gt;Object&lt;/tt&gt;.  Thus, Java and Groovy have a hard time reasoning about the situation.  Eclipse recently introduced a check for suspicious type passed to &lt;tt&gt;equals&lt;/tt&gt; because it has the same problem, but the check defaults to an info level message because warning or error was considered too strong.&lt;/p&gt;

&lt;p&gt;I think if &lt;tt&gt;get&lt;/tt&gt; accepted a &lt;tt&gt;String&lt;/tt&gt;, Groovy would perform the coercion automatically or issue an error in STC mode.&lt;/p&gt;</comment>
                            <comment id="16824448" author="emilles" created="Tue, 23 Apr 2019 19:16:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bgshacklett&quot; class=&quot;user-hover&quot; rel=&quot;bgshacklett&quot;&gt;bgshacklett&lt;/a&gt; When you mention map literals, do you mean something like this?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; a = 1, b = 2
Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; map = [
  &lt;span class=&quot;code-quote&quot;&gt;&quot;$a&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;one&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;$b&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;two&quot;&lt;/span&gt;
]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I ask because flow-typing currently ignores the declaration generics, so Groovy assumes you meant GString as the key type.  You can add a typecase before or coercion after the GString literal to get to String so that you don&apos;t need to create a new map using &lt;tt&gt;collectEntries&lt;/tt&gt;.  And it may not be too hard to create an AST xform that adds the casts or coercions to a map expression automatically.&lt;/p&gt;</comment>
                            <comment id="17044244" author="mauromol" created="Tue, 25 Feb 2020 08:36:36 +0000"  >&lt;p&gt;Is this the same as, or at least related to, &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-6668&quot; title=&quot;Static compiler doesn&amp;#39;t coerce GString for getAt() call&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-6668&quot;&gt;&lt;del&gt;GROOVY-6668&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="17581450" author="emilles" created="Thu, 18 Aug 2022 17:16:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/pull/1770&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1770&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12817460">GROOVY-6668</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3fq4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>