<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:03:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-2437] Groovyc ant task compiles closures twice</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-2437</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Part 1:&lt;/p&gt;

&lt;p&gt;If I build my software with the groovyc ant task I see that closures are compiled twice. I&apos;ve attached a test project. You&apos;ll see that closure1 .. closure4 are generated, but there are only 2 closures in the groovy class.&lt;/p&gt;

&lt;p&gt;If I remove the java class, the problem is gone.&lt;/p&gt;

&lt;p&gt;I&apos;ve also decompiled the constructor:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Test1()
{
	&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;();
	&lt;span class=&quot;code-keyword&quot;&gt;class1&lt;/span&gt; = Test1.&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;0 == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? ( Test1.&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;0 = Test1.class$( &lt;span class=&quot;code-quote&quot;&gt;&quot;app.Test1&quot;&lt;/span&gt; ) ) : Test1.&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;0;
	&lt;span class=&quot;code-keyword&quot;&gt;class2&lt;/span&gt; = Test1.&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;groovy$lang$MetaClass == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? ( Test1.&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;groovy$lang$MetaClass = Test1.class$( &lt;span class=&quot;code-quote&quot;&gt;&quot;groovy.lang.MetaClass&quot;&lt;/span&gt; ) ) : Test1.&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;groovy$lang$MetaClass;
	&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.index = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; _closure1( &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; );
	&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.search = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; _closure2( &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; );
	&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.metaClass = (MetaClass)ScriptBytecodeAdapter.castToType( 
		(MetaClass)ScriptBytecodeAdapter.castToType( 
			ScriptBytecodeAdapter.invokeStaticMethodN( 
				&lt;span class=&quot;code-keyword&quot;&gt;class1&lt;/span&gt;, 
				Test1.&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;org$codehaus$groovy$runtime$ScriptBytecodeAdapter == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? 
					( Test1.&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;org$codehaus$groovy$runtime$ScriptBytecodeAdapter = Test1.class$( &lt;span class=&quot;code-quote&quot;&gt;&quot;org.codehaus.groovy.runtime.ScriptBytecodeAdapter&quot;&lt;/span&gt; ) ) : 
					Test1.&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;org$codehaus$groovy$runtime$ScriptBytecodeAdapter, 
				&lt;span class=&quot;code-quote&quot;&gt;&quot;initMetaClass&quot;&lt;/span&gt;, 
				&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] { &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; } 
			), 
			&lt;span class=&quot;code-keyword&quot;&gt;class2&lt;/span&gt; 
		), 
		&lt;span class=&quot;code-keyword&quot;&gt;class2&lt;/span&gt; 
	);
	&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.index = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; _closure3( &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; );
	&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.search = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; _closure4( &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; );
	&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.metaClass = (MetaClass)ScriptBytecodeAdapter.castToType( 
		(MetaClass)ScriptBytecodeAdapter.castToType( 
			ScriptBytecodeAdapter.invokeStaticMethodN( 
				&lt;span class=&quot;code-keyword&quot;&gt;class1&lt;/span&gt;, 
				Test1.&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;org$codehaus$groovy$runtime$ScriptBytecodeAdapter == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? 
					( Test1.&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;org$codehaus$groovy$runtime$ScriptBytecodeAdapter = Test1.class$( &lt;span class=&quot;code-quote&quot;&gt;&quot;org.codehaus.groovy.runtime.ScriptBytecodeAdapter&quot;&lt;/span&gt; ) ) : 
					Test1.&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;org$codehaus$groovy$runtime$ScriptBytecodeAdapter, 
				&lt;span class=&quot;code-quote&quot;&gt;&quot;initMetaClass&quot;&lt;/span&gt;, 
				&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] { &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; } 
			), 
			&lt;span class=&quot;code-keyword&quot;&gt;class2&lt;/span&gt; 
		), 
		&lt;span class=&quot;code-keyword&quot;&gt;class2&lt;/span&gt; 
	);
	&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here you see that the index, search and metaClass fields are set twice. 4 closures are instantiated.&lt;/p&gt;

&lt;p&gt;Part 2:&lt;/p&gt;

&lt;p&gt;Furthermore you see that the (MetaClass)ScriptBytecodeAdapter.castToType() method is called twice. The looks a bit overkill. This is done like this in a lot of other methods of the class too: getMetaClass, invokeMethod, getProperty, setProperty. This has negative influence on performance.&lt;/p&gt;

&lt;p&gt;Part 3:&lt;/p&gt;

&lt;p&gt;In the generated getters and setters you will also see that 2 classes are retrieved into 2 local variables although they are not used. This has negative influence on performance too.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached the complete decompiled class.&lt;/p&gt;</description>
                <environment>Java: 1.6.0_03&lt;br/&gt;
Ant: 1.6.5&lt;br/&gt;
WindowsXP SP2</environment>
        <key id="12813928">GROOVY-2437</key>
            <summary>Groovyc ant task compiles closures twice</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="rene.de.bloois">Ren&#233; de Bloois</reporter>
                        <labels>
                    </labels>
                <created>Sat, 22 Dec 2007 12:17:32 +0000</created>
                <updated>Wed, 15 Oct 2008 10:00:14 +0000</updated>
                            <resolved>Wed, 15 Oct 2008 10:00:14 +0000</resolved>
                                    <version>1.5.1</version>
                                    <fixVersion>1.6-rc-1</fixVersion>
                                    <component>Ant integration</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14464025" author="rene.de.bloois" created="Sat, 22 Dec 2007 12:20:46 +0000"  >&lt;p&gt;Forgot to attach the test project &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14463994" author="guillaume" created="Sat, 22 Dec 2007 13:11:39 +0000"  >&lt;p&gt;I haven&apos;t looked at your test project so far, but are you able to retrieve four different Closure classes through reflection?&lt;br/&gt;
Decompiler have to generate some Java source code, but don&apos;t necessarily reflect 100% the reality.&lt;/p&gt;</comment>
                            <comment id="14463978" author="rene.de.bloois" created="Sat, 22 Dec 2007 18:29:05 +0000"  >&lt;p&gt;Looking at the time of day (or night &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ), I do not fully understand your question regarding the reflection (just came back from a birthday party).&lt;/p&gt;

&lt;p&gt;In the attached java file I added the constructor twice, once without bytecode, once with the bytecodes. So you can look at the bytecodes too.&lt;/p&gt;

&lt;p&gt;Furthermore, after compiling, I get 4 closure classes on the filesystem:&lt;/p&gt;

&lt;p&gt;Test1$_closure1.class&lt;br/&gt;
Test1$_closure2.class&lt;br/&gt;
Test1$_closure3.class&lt;br/&gt;
Test1$_closure4.class&lt;/p&gt;</comment>
                            <comment id="14464008" author="guillaume" created="Sun, 23 Dec 2007 12:09:38 +0000"  >&lt;p&gt;Jochen, can you double-check this?&lt;/p&gt;</comment>
                            <comment id="14464013" author="blackdrag" created="Thu, 3 Jan 2008 15:38:19 +0000"  >&lt;p&gt;should be fixed now&lt;/p&gt;</comment>
                            <comment id="14464095" author="rene.de.bloois" created="Sat, 5 Jan 2008 07:51:26 +0000"  >&lt;p&gt;I verified it and part 1 and 2 of this issue are solved now. Although minor, part 3 still exists:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class1&lt;/span&gt; = Test1.&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;0 == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? ( Test1.&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;0 = Test1.class$( &lt;span class=&quot;code-quote&quot;&gt;&quot;app.Test1&quot;&lt;/span&gt; ) ) : Test1.&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;0;
&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class2&lt;/span&gt; = Test1.&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;groovy$lang$MetaClass == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? ( Test1.&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;groovy$lang$MetaClass = Test1.class$( &lt;span class=&quot;code-quote&quot;&gt;&quot;groovy.lang.MetaClass&quot;&lt;/span&gt; ) ) : Test1.&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;groovy$lang$MetaClass;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But most of the time class2 is not used, and half of the time class1 is not used. In generated getters and setters they are never used.&lt;/p&gt;

&lt;p&gt;For each call to a groovy method you get unused executions of:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;getstatic app.Test1.&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;0
ifnonnull
...
getstatic app.Test1.&lt;span class=&quot;code-keyword&quot;&gt;class$&lt;/span&gt;0
dup
astore_1
pop
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(&apos;dup&apos; and &apos;pop&apos; are questionable by itself)&lt;/p&gt;

&lt;p&gt;But, we can also wait till java 1.4 is dropped (when is that?).&lt;br/&gt;
Then we don&apos;t need this anymore.&lt;br/&gt;
Or a &apos;target&apos; option could be added to the groovy compiler.&lt;/p&gt;</comment>
                            <comment id="14464348" author="paulk" created="Sun, 17 Feb 2008 16:02:36 +0000"  >&lt;p&gt;given that parts 1 and 2 are solved, downgrading this to minor&lt;/p&gt;</comment>
                            <comment id="14465338" author="blackdrag" created="Wed, 15 Oct 2008 10:00:14 +0000"  >&lt;p&gt;This issue is partially fixed in beta1 for simple getter and setter. In general you still have the class prelude in many cases where you don&apos;t need need it. But that is not really a bug. Also removing that requires a reachability test in the compiler for bytecode variables... This improvement will come, but not soon.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12721823" name="Test1&apos;.java" size="20868" author="rene.de.bloois" created="Sat, 22 Dec 2007 12:17:33 +0000"/>
                            <attachment id="12721778" name="test3.zip" size="1342" author="rene.de.bloois" created="Sat, 22 Dec 2007 12:20:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 6 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cn07:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>