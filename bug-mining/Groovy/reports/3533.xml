<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:00:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-8975] GroovyCastException on the result of CliBuilder.parseFromSpec</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-8975</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I&apos;m trying to follow the tutorial about the use of CliBuilder in Groovy with Groovy 2.5.5. Copying the code at &lt;a href=&quot;https://github.com/remkop/picocli/wiki/Groovy-2.5-CliBuilder-Renewal#annotating-methods-of-an-interface&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Annotating methods of an interface&lt;/a&gt; paragraph, at runtime I have the following Exception:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception in thread &quot;main&quot; org.codehaus.groovy.runtime.typehandling.GroovyCastException: Cannot cast object &apos;{help=groovy.cli.picocli.CliBuilder$_extractAttributesFromMethod_closure12@3bb9a3ff}&apos; with class &apos;java.util.LinkedHashMap&apos; to class &apos;mypackage.IHello&apos; due to: groovy.lang.GroovyRuntimeException: Could not find matching constructor for: mypackage.IHello(LinkedHashMap)
&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.codehaus.groovy.runtime.typehandling.DefaultTypeTransformation.continueCastOnSAM(DefaultTypeTransformation.java:412)
&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.codehaus.groovy.runtime.typehandling.DefaultTypeTransformation.continueCastOnNumber(DefaultTypeTransformation.java:328)
&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.codehaus.groovy.runtime.typehandling.DefaultTypeTransformation.castToType(DefaultTypeTransformation.java:242)
&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.castToType(ScriptBytecodeAdapter.java:617)
&#160;&#160;&#160;&#160;&#160;&#160;&#160; at mypackage.MyMain.main(MyMain.groovy:20)Exception in thread &quot;main&quot; org.codehaus.groovy.runtime.typehandling.GroovyCastException: Cannot cast object &apos;{help=groovy.cli.picocli.CliBuilder$_extractAttributesFromMethod_closure12@3bb9a3ff}&apos; with class &apos;java.util.LinkedHashMap&apos; to class &apos;mypackage.IHello&apos; due to: groovy.lang.GroovyRuntimeException: Could not find matching constructor for: mypackage.IHello(LinkedHashMap)
&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.codehaus.groovy.runtime.typehandling.DefaultTypeTransformation.continueCastOnSAM(DefaultTypeTransformation.java:412)
&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.codehaus.groovy.runtime.typehandling.DefaultTypeTransformation.continueCastOnNumber(DefaultTypeTransformation.java:328)
&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.codehaus.groovy.runtime.typehandling.DefaultTypeTransformation.castToType(DefaultTypeTransformation.java:242)
&#160;&#160;&#160;&#160;&#160;&#160;&#160; at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.castToType(ScriptBytecodeAdapter.java:617)
&#160;&#160;&#160;&#160;&#160;&#160;&#160; at mypackage.MyMain.main(MyMain.groovy:20)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The exception occurs at this line:&lt;br/&gt;
 &lt;tt&gt;IHello hello = cli.parseFromSpec(IHello, argz)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;The exception goes away (and all works fine) if I replace it with:&lt;br/&gt;
 &lt;tt&gt;def hello = cli.parseFromSpec(IHello, argz)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;I tried to downgrade Groovy down to version 2.5.0 and I always get the exception. So this really puzzles me, since the mentioned tutorial is quite simple and straight to follow...&lt;/p&gt;</description>
                <environment></environment>
        <key id="13212797">GROOVY-8975</key>
            <summary>GroovyCastException on the result of CliBuilder.parseFromSpec</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="mauromol">Mauro Molinari</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Jan 2019 12:01:38 +0000</created>
                <updated>Mon, 20 May 2019 07:31:36 +0000</updated>
                            <resolved>Tue, 19 Feb 2019 03:54:24 +0000</resolved>
                                    <version>2.5.5</version>
                                    <fixVersion>3.0.0-beta-1</fixVersion>
                    <fixVersion>2.5.7</fixVersion>
                                    <component>groovy-runtime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16757271" author="mauromol" created="Thu, 31 Jan 2019 14:20:23 +0000"  >&lt;p&gt;I get the same exception if I leave:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;def hello = cli.parseFromSpec(IHello, argz)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;but I put &lt;tt&gt;@CompileStatic&lt;/tt&gt; on my main class (or, more specifically, on my&#160;&lt;tt&gt;main&lt;/tt&gt; method).&lt;/p&gt;</comment>
                            <comment id="16770104" author="daniel_sun" created="Sat, 16 Feb 2019 12:38:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=remkop%40yahoo.com&quot; class=&quot;user-hover&quot; rel=&quot;remkop@yahoo.com&quot;&gt;remkop@yahoo.com&lt;/a&gt;&lt;br/&gt;
Hi Remko, Could you set aside some time to look into the issue?&lt;/p&gt;</comment>
                            <comment id="16770249" author="remkop@yahoo.com" created="Sat, 16 Feb 2019 23:20:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daniel_sun&quot; class=&quot;user-hover&quot; rel=&quot;daniel_sun&quot;&gt;daniel_sun&lt;/a&gt; Thanks for the heads-up, I wasn&apos;t aware of this. Taking a look now.&lt;/p&gt;</comment>
                            <comment id="16770282" author="daniel_sun" created="Sun, 17 Feb 2019 04:05:40 +0000"  >&lt;p&gt;Great! Thanks a lot!&lt;/p&gt;</comment>
                            <comment id="16770353" author="remkop@yahoo.com" created="Sun, 17 Feb 2019 10:45:51 +0000"  >&lt;p&gt;I was unable to reproduce the problem. I attached the project I created to verify this. This worked as expected in my IDEA (IntelliJ) and on the command line. You can try if this project works. On the command line, the minimum classpath to run the example is the below (assuming the jars are in the current directory): &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java -cp out\production\classes;groovy-2.5.6.jar;groovy-cli-picocli-2.5.6.jar;picocli-3.9.2.jar pkg.App
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I suspect it may be a problem in your environment, and I remember seeing a similar error at some point when I was working on CliBuilder. I don&apos;t remember what I did to fix it...&lt;/p&gt;

&lt;p&gt;Could it be there are multiple versions of Groovy in the classpath?&lt;/p&gt;</comment>
                            <comment id="16770785" author="paulk" created="Mon, 18 Feb 2019 05:07:56 +0000"  >&lt;p&gt;I seem to get slightly different behavior with pre-compiled classes and classes in the same compilation unit. In any case, this script in the GroovyConsole replicates the problem:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.cli.Option
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.cli.Unparsed
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.cli.picocli.CliBuilder

&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; IHello {
    @Option(shortName=&lt;span class=&quot;code-quote&quot;&gt;&apos;h&apos;&lt;/span&gt;, description=&lt;span class=&quot;code-quote&quot;&gt;&apos;display usage&apos;&lt;/span&gt;) &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt; help()
    @Option(shortName=&lt;span class=&quot;code-quote&quot;&gt;&apos;u&apos;&lt;/span&gt;, description=&lt;span class=&quot;code-quote&quot;&gt;&apos;user name&apos;&lt;/span&gt;) &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; user()
    @Unparsed(description = &lt;span class=&quot;code-quote&quot;&gt;&apos;positional parameters&apos;&lt;/span&gt;) List remaining()
}

def cli = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CliBuilder(name: &lt;span class=&quot;code-quote&quot;&gt;&apos;groovy Greeter&apos;&lt;/span&gt;)
def argz = &lt;span class=&quot;code-quote&quot;&gt;&apos;--user abc&apos;&lt;/span&gt;.split()
IHello hello = cli.parseFromSpec(IHello, argz)
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; hello.user() == &lt;span class=&quot;code-quote&quot;&gt;&apos;abc&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If I change the last line in &lt;tt&gt;CliBuilder#parseFromSpec&lt;/tt&gt; as follows, it fixes the problem:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-        cliOptions as T
+        DefaultGroovyMethods.asType(cliOptions, optionsClass)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It&apos;s an easy enough change but I wonder whether there is some underlying behavioral change elsewhere that is surfacing here and requiring this change. Perhaps it is just type erasure surfacing here.&lt;/p&gt;</comment>
                            <comment id="16770786" author="paulk" created="Mon, 18 Feb 2019 05:12:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=remkop%40yahoo.com&quot; class=&quot;user-hover&quot; rel=&quot;remkop@yahoo.com&quot;&gt;remkop@yahoo.com&lt;/a&gt; You have this in your example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
def options = cli.parseFromSpec(GreeterI, argz)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;whereas I suspect there might be problems if you had:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
GreeterI options = cli.parseFromSpec(GreeterI, argz)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but this would work (though shouldn&apos;t be needed):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
GreeterI options = cli.parseFromSpec(GreeterI, argz) as GreeterI
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16770932" author="remkop@yahoo.com" created="Mon, 18 Feb 2019 09:46:21 +0000"  >&lt;p&gt;Hi Paul, thanks for looking into this! I&apos;m a bit out of my depth here.&lt;br/&gt;
Should we change &lt;tt&gt;CliBuilder#parseFromSpec&lt;/tt&gt; to the below?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-        cliOptions as T
+        DefaultGroovyMethods.asType(cliOptions, optionsClass)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16770979" author="paulk" created="Mon, 18 Feb 2019 10:39:28 +0000"  >&lt;p&gt;Yes, I&apos;ll do that now.&lt;/p&gt;</comment>
                            <comment id="16770998" author="mauromol" created="Mon, 18 Feb 2019 11:00:02 +0000"  >&lt;p&gt;Hi Remko, hi Paul!&lt;/p&gt;

&lt;p&gt;Sorry for the delay. To reproduce the problem you can use something as simple as what I&apos;m going to attach (TestGroovy8975.zip).&lt;/p&gt;

&lt;p&gt;Run &quot;./gradlew run&quot; to reproduce. Then change build.gradle and replace &lt;tt&gt;mainClassName = &apos;test.Main&apos;&lt;/tt&gt; with &lt;tt&gt;mainClassName = &apos;test.Main2&apos;&lt;/tt&gt; and run again with Gradle to see the variant with &lt;tt&gt;@CompileStatic&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16771541" author="paulk" created="Tue, 19 Feb 2019 03:54:24 +0000"  >&lt;p&gt;Fixed as per discussion in the comments.&lt;/p&gt;</comment>
                            <comment id="16771591" author="remkop@yahoo.com" created="Tue, 19 Feb 2019 05:46:58 +0000"  >&lt;p&gt;Thank you for taking care of this, Paul!&lt;/p&gt;</comment>
                            <comment id="16771739" author="mauromol" created="Tue, 19 Feb 2019 09:07:58 +0000"  >&lt;p&gt;Thanks for the fix Paul!&lt;/p&gt;

&lt;p&gt;Does a snapshot Maven repository (an Apache one?) exist for me to test this before the release of 2.5.7? Thank you.&lt;/p&gt;</comment>
                            <comment id="16771752" author="paulk" created="Tue, 19 Feb 2019 09:29:08 +0000"  >&lt;p&gt;You can grab the zips from the CI server:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://ci.groovy-lang.org/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ci.groovy-lang.org/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Look under the &quot;Artifacts&quot; for &quot;JDK 8 build with snapshot deploy&quot;. You&apos;ll see 2.5.7-SNAPSHOT and 3.0.0-SNAPSHOT versions depending on the branch you select.&lt;/p&gt;

&lt;p&gt;Or look on the snapshot repo for the snapshot version you are after:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://oss.jfrog.org/artifactory/oss-snapshot-local/org/codehaus/groovy/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://oss.jfrog.org/artifactory/oss-snapshot-local/org/codehaus/groovy/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16771842" author="mauromol" created="Tue, 19 Feb 2019 11:38:43 +0000"  >&lt;p&gt;I verified it&apos;s now fixed for both the dynamic and the static cases, thank you!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12959005" name="GROOVY-8975.zip" size="101288" author="rpopma" created="Sun, 17 Feb 2019 10:35:59 +0000"/>
                            <attachment id="12959094" name="TestGroovy8975.zip" size="55966" author="mauromol" created="Mon, 18 Feb 2019 11:00:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 39 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi0ha0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>