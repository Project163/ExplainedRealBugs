<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:08:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-9702] ASTTest annotation has runtime retention and transform removes required member from AST</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-9702</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;Consider the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-groovy&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.*
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.codehaus.groovy.ast.*
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; static org.codehaus.groovy.transform.stc.StaticTypesMarker.*

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;C {
  void m() {
    &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; that = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;;
    { -&amp;gt;
      @ASTTest(phase=INSTRUCTION_SELECTION, value={
        ClassNode type = node.getNodeMetaData(INFERRED_TYPE)
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; type?.name == &lt;span class=&quot;code-quote&quot;&gt;&apos;C&apos;&lt;/span&gt;
      })
      &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; ref = getThisObject()
      &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; ref == that
    }()
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is a typical use of &lt;tt&gt;@ASTTest&lt;/tt&gt;.  When compiled, the test annotation is retained in the class file, which is unnecessary.  When the transform class runs, it removes the &quot;value&quot; member from the AST, which is causing compiler errors down the line when &lt;tt&gt;ExtendedVerifier&lt;/tt&gt; runs &lt;tt&gt;AnnotationVisitor&lt;/tt&gt;.  Also, the variable scope of the test closure is still connected to the class and module, so code completion is making proposals for class members which will not be there at run-time.&lt;/p&gt;

&lt;p&gt;This was originally investigated from the IDE side (see linked issue).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://user-images.githubusercontent.com/18193802/90964420-fd51c800-e485-11ea-8349-c0f89e04561a.png&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://user-images.githubusercontent.com/18193802/90964420-fd51c800-e485-11ea-8349-c0f89e04561a.png&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13324516">GROOVY-9702</key>
            <summary>ASTTest annotation has runtime retention and transform removes required member from AST</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="emilles">Eric Milles</reporter>
                        <labels>
                            <label>breaking</label>
                    </labels>
                <created>Tue, 25 Aug 2020 17:11:35 +0000</created>
                <updated>Wed, 11 Nov 2020 02:01:15 +0000</updated>
                            <resolved>Sun, 6 Sep 2020 09:45:29 +0000</resolved>
                                                    <fixVersion>4.0.0-alpha-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4200">1h 10m</timespent>
                                <comments>
                            <comment id="17186144" author="paulk" created="Thu, 27 Aug 2020 22:56:49 +0000"  >&lt;p&gt;Merged for Groovy 4. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt; Would something like &lt;a href=&quot;https://github.com/apache/groovy/pull/1356&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1356&lt;/a&gt; work for GROOVY_3_0_X (and potentially GROOVY_2_5_X). I agree that runtime seems unlikely to be needed but just exploring whether we can avoid the breaking change on a point release.&lt;/p&gt;</comment>
                            <comment id="17186145" author="paulk" created="Thu, 27 Aug 2020 22:58:05 +0000"  >&lt;p&gt;Added &lt;tt&gt;breaking&lt;/tt&gt; label but that is only if anyone is relying on the &lt;tt&gt;RUNTIME&lt;/tt&gt; retention.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="13326178">GROOVY-9723</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://github.com/groovy/groovy-eclipse/issues/1155]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 11 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0i2xc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>