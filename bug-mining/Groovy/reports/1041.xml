<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:13:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-3716] groovyc doesn&apos;t catch wrong return type in overriding method</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-3716</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;gt; cat BaseClass.groovy                                                                                                                                               
class BaseClass {
  def foo() {}
}    
                                                                                                                                                                                      
&amp;gt; cat DerivedClass.groovy                                                                                                                                                    
class DerivedClass extends BaseClass {
  void foo() {}  
  static void main(String[] args) {}
}

&amp;gt; groovy DerivedClass                                                                                                                                                         
Caught: java.lang.VerifyError: (class: DerivedClass, method: foo signature: ()Ljava/lang/Object;) Unable to pop operand off an empty stack
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If return types of &lt;tt&gt;BaseClass.foo()&lt;/tt&gt; and &lt;tt&gt;DerivedClass.foo()&lt;/tt&gt; are exchanged, groovyc detects the problem:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.codehaus.groovy.control.MultipleCompilationErrorsException: startup failed:
/swd/tmp/DerivedClass.groovy: 2: The return type of java.lang.Object foo() in DerivedClass is incompatible with void foo() in BaseClass.
Node: org.codehaus.groovy.ast.MethodNode. At [2:3]  @ line 2, column 3.
     def foo() {}
     ^

1 error
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12814864">GROOVY-3716</key>
            <summary>groovyc doesn&apos;t catch wrong return type in overriding method</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roshandawrani">Roshan Dawrani</assignee>
                                    <reporter username="pniederw">Peter Niederwieser</reporter>
                        <labels>
                    </labels>
                <created>Mon, 31 Aug 2009 20:09:24 +0000</created>
                <updated>Thu, 15 Oct 2009 17:15:32 +0000</updated>
                            <resolved>Tue, 1 Sep 2009 10:50:43 +0000</resolved>
                                    <version>1.6.4</version>
                                    <fixVersion>1.6.5</fixVersion>
                    <fixVersion>1.7-beta-2</fixVersion>
                                    <component>Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14467566" author="pniederw" created="Mon, 31 Aug 2009 20:14:15 +0000"  >&lt;p&gt;On second look, the last error message is unfortunate. Why mention &lt;tt&gt;org.codehaus.groovy.ast.MethodNode&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="14467547" author="blackdrag" created="Mon, 31 Aug 2009 23:28:28 +0000"  >&lt;p&gt;I assume the bug is in Verifiyer#getCovariantImplementation. As for the message, that comes from the used RuntimeParserException. A different type shuold be used here I guess.&lt;/p&gt;</comment>
                            <comment id="14467624" author="roshandawrani" created="Mon, 31 Aug 2009 23:53:50 +0000"  >&lt;p&gt;Regarding the RuntimeParserException that is currently being thrown, what other type could be used?&lt;/p&gt;

&lt;p&gt;Would using org.codehaus.groovy.ast.ClassNode instead of org.codehaus.groovy.ast.MethodNode be equally bad?&lt;/p&gt;</comment>
                            <comment id="14467595" author="pniederw" created="Tue, 1 Sep 2009 00:04:01 +0000"  >&lt;p&gt;&amp;gt; Would using org.codehaus.groovy.ast.ClassNode instead of org.codehaus.groovy.ast.MethodNode be equally bad?&lt;br/&gt;
If possible, we should strive for a message that is easily understandable and omits Groovy internals. &lt;tt&gt;org.codehaus.groovy.ast.MethodNode&lt;/tt&gt; means (almost) nothing to a user.&lt;/p&gt;</comment>
                            <comment id="14467668" author="roshandawrani" created="Tue, 1 Sep 2009 00:12:28 +0000"  >&lt;p&gt;If not showing the internals is the case, then may be the following constructor should be changed to remove the ASTNode related information?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; RuntimeParserException(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; message, ASTNode node) {
        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;(message + &lt;span class=&quot;code-quote&quot;&gt;&quot;.\nNode: &quot;&lt;/span&gt; + node.getClass().getName(), node);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If we remove ASTNode information from here, then even messages from other places would get corrected - all the errors that result in a &lt;br/&gt;
RuntimeParserException are showing some ast node or other. As an example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; I {}
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;C &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; I, I {}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;throws&lt;br/&gt;
Try.groovy: 3: Duplicate interfaces in implements list: &lt;span class=&quot;error&quot;&gt;&amp;#91;I, I&amp;#93;&lt;/span&gt;.&lt;br/&gt;
Node: org.codehaus.groovy.ast.ClassNode. At &lt;span class=&quot;error&quot;&gt;&amp;#91;3:1&amp;#93;&lt;/span&gt;  @ line 3, column 1.&lt;br/&gt;
   class C implements I, I {}&lt;/p&gt;</comment>
                            <comment id="14467587" author="roshandawrani" created="Tue, 1 Sep 2009 00:23:02 +0000"  >&lt;p&gt;The bug reported is resulting because verifier comes up with the following wrong conclusion:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;void.isDerivedFrom(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;) = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;  (ClassHelper.VOID_TYPE.isDerivedFrom(ClassHelper.OBJECT_TYPE))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think void return type can be given a bit special handling in such comparisons and void.isDerivedFrom(any_type) should return false. Any issues seen with that?&lt;/p&gt;</comment>
                            <comment id="14467639" author="roshandawrani" created="Tue, 1 Sep 2009 00:48:49 +0000"  >&lt;p&gt;The following patch is fixing the reported issue and not creating any new ones &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Index: src/main/org/codehaus/groovy/ast/ClassNode.java
===================================================================
--- src/main/org/codehaus/groovy/ast/ClassNode.java (revision 17485)
+++ src/main/org/codehaus/groovy/ast/ClassNode.java (working copy)
@@ -845,6 +845,7 @@
      * @return true if this node is derived from the given ClassNode
      */
     public boolean isDerivedFrom(ClassNode type) {
+       if(this.equals(ClassHelper.VOID_TYPE)) return false;
         if (type.equals(ClassHelper.OBJECT_TYPE)) return true;
         ClassNode node = this;
         while (node != null) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Regarding the message change, may be we can remove the ASTNode related message portion from&lt;br/&gt;
the exception message in the constructor below.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; RuntimeParserException(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; message, ASTNode node) {
        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;(message + &lt;span class=&quot;code-quote&quot;&gt;&quot;.\nNode: &quot;&lt;/span&gt; + node.getClass().getName(), node);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Waiting to hear back from Jochen.&lt;/p&gt;</comment>
                            <comment id="14467650" author="blackdrag" created="Tue, 1 Sep 2009 08:09:06 +0000"  >&lt;p&gt;I think I can agree to the RuntimeParserException, but for the change of &quot;void&quot;... shouldn&apos;t we test if we call void.isDerivedFrom(void)? Because in this case we would need to return true... A check like that is maybe missing in this method in general. Sure the check is made somewhere else, but such a check won&apos;t hurt there.&lt;/p&gt;</comment>
                            <comment id="14467497" author="roshandawrani" created="Tue, 1 Sep 2009 08:21:57 +0000"  >&lt;p&gt;Yes, I missed void vs void boundary case.&lt;/p&gt;

&lt;p&gt;So, I am going ahead with the following changes then:&lt;/p&gt;

&lt;p&gt;1) void.isDerivedFrom(void) == true&lt;br/&gt;
2) void.isDerivedFrom(any_other_type=) == false&lt;br/&gt;
3) removing the ast node portion of the message from RuntimeParserException constructor&lt;/p&gt;</comment>
                            <comment id="14467548" author="roshandawrani" created="Tue, 1 Sep 2009 10:50:43 +0000"  >&lt;p&gt;Fixed - both the covariant issue and the exception message.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 13 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2c8zz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>