<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:17:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-7802] MapWithDefault should be able to be configured to not store its default value</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-7802</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;As described in &lt;a href=&quot;https://github.com/apache/groovy/pull/267&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/267&lt;/a&gt;, a Groovy map with a default value stores all the accessed elements, even if they weren&apos;t added explicitly, just queried.&lt;/p&gt;

&lt;p&gt;In certain algorithms (e.g. &lt;a href=&quot;https://github.com/careercup/CtCI-6th-Edition-Groovy/blob/d116d65469bdf17d1e215e89f3e76ac3a97660a9/src/main/groovy/Ch04_TreesAndGraphs/_04_12_PathsWithSum.groovy#L21&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/careercup/CtCI-6th-Edition-Groovy/blob/d116d65469bdf17d1e215e89f3e76ac3a97660a9/src/main/groovy/Ch04_TreesAndGraphs/_04_12_PathsWithSum.groovy#L21&lt;/a&gt;) the complexity would automatically be reduced, if default values would be deleted (i.e. a default of 0 that is incremented and decremented in a recursive algorithm).&lt;/p&gt;

&lt;p&gt;Topics of discussion:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Currently a `getAt` will `add` also, therefore `containsKey` isn&apos;t the same as `getAt(...) != null`&lt;/li&gt;
	&lt;li&gt;After the change `keySet()/entrySet()` wouldn&apos;t include default values&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I proposed alternatives:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;`removeIfDefault(Object)` // removes current key, if value is equal to default&lt;/li&gt;
	&lt;li&gt;`consolidate()` // removes all default values&lt;/li&gt;
	&lt;li&gt;constructor parameter `STORE_DEFAULT storeDefaultValues = STORE_DEFAULT.FALSE`, or maybe with a `boolean`, though I find primitive parameters confusing&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;others:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;`containsKey` should always return `true`, or throw an exception, since its behavior is inconsistent&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Waiting for your thoughts &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12953947">GROOVY-7802</key>
            <summary>MapWithDefault should be able to be configured to not store its default value</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="papuska@gmail.com">Pap L&#337;rinc</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Mar 2016 12:03:57 +0000</created>
                <updated>Sun, 16 Apr 2023 16:15:21 +0000</updated>
                            <resolved>Sat, 26 Feb 2022 11:27:18 +0000</resolved>
                                    <version>2.4.6</version>
                                    <fixVersion>4.0.1</fixVersion>
                                    <component>groovy-jdk</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15232341" author="jwagenleitner" created="Fri, 8 Apr 2016 15:35:18 +0000"  >&lt;p&gt;I find the current behavior of &lt;tt&gt;withDefault&lt;/tt&gt; makes sense and I definitely would not want to see a breaking change made to it.  &lt;/p&gt;

&lt;p&gt;For the alternatives, the first two would only apply to &lt;tt&gt;MapWithDefault&lt;/tt&gt; maps, so seems odd to add those methods to &lt;tt&gt;Map&lt;/tt&gt;.  So in my opinion the constructor parameter would be my choice of the options available.  Though I don&apos;t usually like boolean parameters I think in this case it would be better than an Enum.  I think the GDK docs for a &lt;tt&gt;#withDefault(boolean, Closure)&lt;/tt&gt; method could make it sufficiently clear what the boolean switch will do in terms of behavior along with code samples in the docs.&lt;/p&gt;

&lt;p&gt;I think the current behavior of &lt;tt&gt;get&lt;/tt&gt; and &lt;tt&gt;containsKey&lt;/tt&gt; are valid.  I don&apos;t agree that contains key should always return &lt;tt&gt;true&lt;/tt&gt; or throw.  If the map doesn&apos;t contain the key it should return false.  Even though &lt;tt&gt;get&lt;/tt&gt; will insert into the map that to me has no bearing on how &lt;tt&gt;containsKey&lt;/tt&gt; should work, since I think it should work based on the current state of the map.&lt;/p&gt;

&lt;p&gt;I find the proposed change more confusing than the current behavior, but that may just be that my use cases fit more with how it&apos;s currently implemented.  But if the change can be introduced without affecting the current behavior or by adding addtional methods to &lt;tt&gt;Map&lt;/tt&gt; that only apply to &lt;tt&gt;MapWithDefault&lt;/tt&gt; then it seems reasonable.  &lt;/p&gt;

&lt;p&gt;Am curious what others may think.&lt;/p&gt;</comment>
                            <comment id="15403899" author="paulk" created="Tue, 2 Aug 2016 12:38:52 +0000"  >&lt;p&gt;There are already quite a few options around default values that users of Groovy maps need to be aware of:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Groovy adds a DGM method for maps: &lt;tt&gt;get(K key, V defaultValue)&lt;/tt&gt; which adds the default entry into the map&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;MapWithDefault&lt;/tt&gt; allows the default value to be specified as a closure (taking the key as parameter) at map creation time rather than at the point of extraction&lt;/li&gt;
	&lt;li&gt;Java 8 adds a &lt;tt&gt;getOrDefault(Object key, V defaultValue)&lt;/tt&gt; default method which is similar to the DGM method but doesn&apos;t change the map&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;d be inclined not to try to wedge further functionality into this mix but rather create a new &lt;tt&gt;SparseMap&lt;/tt&gt; (or some similar name) which ensures as part of creation and every subsequent operation that default values aren&apos;t stored. I&apos;d not assume that &lt;tt&gt;putAll&lt;/tt&gt; necessarily funneled through &lt;tt&gt;put&lt;/tt&gt; and I&apos;d remove entries during construction. I wouldn&apos;t override the normal &lt;tt&gt;containsKey&lt;/tt&gt; behavior once the other changes are in place - so an attempt to put a default value into such a map would leave it unchanged and &lt;tt&gt;containsKey&lt;/tt&gt; would return false.&lt;/p&gt;

&lt;p&gt;The implementation of &lt;tt&gt;SparseMap&lt;/tt&gt; might be close to &lt;tt&gt;MapWithDefault&lt;/tt&gt; so some refactoring of an abstract class with the common functionality might be useful. We can work out syntactic sugar factory methods later, e.g.: &lt;tt&gt;withDefault(boolean, Closure)&lt;/tt&gt; or &lt;tt&gt;withSparseDefault(Closure)&lt;/tt&gt;. We already have &lt;tt&gt;withLazyDefault/withEagerDefault&lt;/tt&gt; for lists, so there is a precedent if we go that way.&lt;/p&gt;</comment>
                            <comment id="17498019" author="paulk" created="Fri, 25 Feb 2022 10:01:33 +0000"  >&lt;p&gt;There is a revised PR here:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/groovy/pull/1692&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/pull/1692&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17498438" author="paulk" created="Sat, 26 Feb 2022 11:27:18 +0000"  >&lt;p&gt;Proposed PR merged.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13344314">GROOVY-9848</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 37 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2va9j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>