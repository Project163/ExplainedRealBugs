<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:19:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-4020] ClassFormatError when using the name including &quot;-&quot; sign</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-4020</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I&apos;m not sure if there any constraint with the name parameter before passing to GroovyCodeSource but it is raising an exception if the name includes &quot;-&quot; sign :&lt;/p&gt;

&lt;p&gt;GroovyCodeSource gcs = new GroovyCodeSource(inputStream, &quot;file-name.gtmpl&quot;, &quot;/groovy/shell&quot;);&lt;/p&gt;

&lt;p&gt;Here is the exception :&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.ClassFormatError: Illegal class name &quot;File-name&quot; in class file File-name&lt;br/&gt;
        at java.lang.ClassLoader.defineClass1(Native Method)&lt;br/&gt;
        at java.lang.ClassLoader.defineClass(ClassLoader.java:616)&lt;br/&gt;
        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:124)&lt;br/&gt;
        at groovy.lang.GroovyClassLoader.access$200(GroovyClassLoader.java:54)&lt;br/&gt;
        at groovy.lang.GroovyClassLoader$ClassCollector.createClass(GroovyClassLoader.java:482)&lt;br/&gt;
        at groovy.lang.GroovyClassLoader$ClassCollector.onClassNode(GroovyClassLoader.java:499)&lt;br/&gt;
        at groovy.lang.GroovyClassLoader$ClassCollector.call(GroovyClassLoader.java:503)&lt;br/&gt;
        at org.codehaus.groovy.control.CompilationUnit$10.call(CompilationUnit.java:728)&lt;br/&gt;
        at org.codehaus.groovy.control.CompilationUnit.applyToPrimaryClassNodes(CompilationUnit.java:925)&lt;br/&gt;
        at org.codehaus.groovy.control.CompilationUnit.compile(CompilationUnit.java:462)&lt;br/&gt;
        at groovy.lang.GroovyClassLoader.parseClass(GroovyClassLoader.java:278)&lt;/p&gt;

&lt;p&gt;It seems that the name parameter is used for createing Class in Java, so it must be a binary name as defined by the Java Language Specification. If so, the name would be validated and converted to good one ? Or I must to take care of that myself before using GroovyCodeSource ?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12813602">GROOVY-4020</key>
            <summary>ClassFormatError when using the name including &quot;-&quot; sign</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="trongtt">Tran The Trong</reporter>
                        <labels>
                            <label>ClassFormatError</label>
                    </labels>
                <created>Fri, 29 Jan 2010 06:36:44 +0000</created>
                <updated>Wed, 23 Aug 2023 09:11:17 +0000</updated>
                            <resolved>Sun, 22 May 2022 19:43:15 +0000</resolved>
                                    <version>1.6.5</version>
                                    <fixVersion>5.0.0-alpha-1</fixVersion>
                                    <component>Compiler</component>
                        <due></due>
                            <votes>4</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14468776" author="roshandawrani" created="Fri, 29 Jan 2010 07:39:00 +0000"  >&lt;p&gt;Yes, the name that you pass to GroovyCodeSource is used to come up with the class name of the script class that you parse using that GroovyCodeSource.&lt;/p&gt;

&lt;p&gt;The behavior reported (class loader rejecting such classes with invalid names with ClassFormatError) seems to be JVM specific.&lt;/p&gt;

&lt;p&gt;I am on Windows XP with following Java 1.5.0_04 and for me the class loading does not fail.&lt;/p&gt;

&lt;p&gt;Should we validate the class names and reject the invalid ones?&lt;/p&gt;</comment>
                            <comment id="14468823" author="trongtt" created="Fri, 29 Jan 2010 10:07:39 +0000"  >&lt;p&gt;a validation is needed i think.&lt;/p&gt;

&lt;p&gt;if the class name is wrong, is there any reason to keep you to automatically convert it to good one ?&lt;/p&gt;</comment>
                            <comment id="14468748" author="roshandawrani" created="Sat, 30 Jan 2010 05:21:08 +0000"  >&lt;p&gt;Jochen, what do you think? Can we reject the invalid class names or convert them into good ones? &lt;/p&gt;

&lt;p&gt;I think I have seen at least one place in groovy where invalid class names are converted.&lt;/p&gt;</comment>
                            <comment id="14468859" author="blackdrag" created="Sat, 30 Jan 2010 16:46:16 +0000"  >&lt;p&gt;if we convert the question is to what.&lt;/p&gt;</comment>
                            <comment id="14468804" author="trongtt" created="Sun, 31 Jan 2010 20:21:39 +0000"  >&lt;p&gt;does the &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-3054&quot; title=&quot;ClassFormatError: Illegal class name Exception when running a script from a folder with dot in its name&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-3054&quot;&gt;&lt;del&gt;GROOVY-3054&lt;/del&gt;&lt;/a&gt; relate to this problem ?&lt;/p&gt;</comment>
                            <comment id="14468836" author="roshandawrani" created="Sun, 31 Jan 2010 22:38:29 +0000"  >&lt;p&gt;Not really. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-3054&quot; title=&quot;ClassFormatError: Illegal class name Exception when running a script from a folder with dot in its name&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-3054&quot;&gt;&lt;del&gt;GROOVY-3054&lt;/del&gt;&lt;/a&gt; seems more about extracting just the file name part from the whole path of the script file. So, if you have c:/groovy/MyScript.groovy, it removes &quot;c:/groovy/&quot; from the front and &quot;.groovy&quot; from the end and comes up with MyScript as the class name. It, kind-of, assumes that file name portion itself will be a valid one, and not like &quot;file-name.gtmpl&quot; - that is the portion that needs to be fixed now.&lt;/p&gt;</comment>
                            <comment id="14479894" author="nicolas raoul" created="Tue, 17 Apr 2012 02:33:33 +0000"  >&lt;p&gt;I can confirm this on Ubuntu 2011.04 with bash and Groovy 1.7.4 JVM: 1.6.0_22:&lt;/p&gt;

&lt;p&gt;$ groovy xmlslurper-url-bug.groovy&lt;br/&gt;
Caught: java.lang.ClassFormatError: Illegal class name &quot;xmlslurper-url-bug&quot; in class file xmlslurper-url-bug&lt;br/&gt;
$ mv xmlslurper-url-bug.groovy xmlslurperurlbug.groovy&lt;br/&gt;
$ groovy xmlslurperurlbug.groovy&lt;br/&gt;
Hello World&lt;/p&gt;</comment>
                            <comment id="14472710" author="aaron.j.garcia" created="Wed, 18 Apr 2012 16:26:21 +0000"  >&lt;p&gt;I&apos;m having this exact same issue.  I&apos;m trying to make a Groovy CGI Script, and I want to call it &quot;test-groovy.cgi&quot;.  I have to do one of two things:&lt;/p&gt;

&lt;p&gt;1) Make a class definition inside of test-groovy.cgi with a good name like TestGroovy, and a main method.  &lt;br/&gt;
2) Rename my file to testGroovy.cgi.&lt;/p&gt;

&lt;p&gt;I think a good solution would be to just remove the &quot;-&quot; from the file name when creating the generated class name.  &lt;/p&gt;</comment>
                            <comment id="14479891" author="paulk" created="Wed, 18 Apr 2012 19:15:59 +0000"  >&lt;p&gt;I think Roshan&apos;s suggestion of reusing &lt;tt&gt;org.codehaus.groovy.bsf.GroovyEngine#convertToValidJavaClassname()&lt;/tt&gt; is the way to go. This would not remove characters like &apos;-&apos; but instead replace them with &apos;_&apos;. Which would be a potential problem for scripts which somehow already had such a class with an underscore - but such systems would already break under BSF anyway. Any objections?&lt;/p&gt;

&lt;p&gt;I also think the method should be moved into some util class outside of BSF and then called from BSF and wherever else it is needed.&lt;/p&gt;</comment>
                            <comment id="14472724" author="blackdrag" created="Thu, 19 Apr 2012 00:17:45 +0000"  >&lt;p&gt;If we change the name it is not bijective any more. Well, being bijective is nice, but maybe not needed. Though having 2 possible source names for a given class name is one thing, having many more possibilities another. As soon as you have one script depending on another, that kind of name mangling will cause a problem. In &lt;a href=&quot;https://blogs.oracle.com/jrose/entry/symbolic_freedom_in_the_vmsuggests&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://blogs.oracle.com/jrose/entry/symbolic_freedom_in_the_vmsuggests&lt;/a&gt; to use an escaping mechanism instead. But the problem is that &apos;-&apos; is not part of that. Still we could take the idea and for example use &lt;br class=&quot;atl-forced-newline&quot; /&gt; + UTF16 hexadecimal number. That would then allow a 1:1 encoding and supports any UTF16 character&lt;/p&gt;</comment>
                            <comment id="17540669" author="emilles" created="Sun, 22 May 2022 19:43:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/2691fb0d2b745a7cc6647edd09a71a3831ffa460&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/2691fb0d2b745a7cc6647edd09a71a3831ffa460&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12912287">GROOVY-7670</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12816497">GROOVY-5760</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 25 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bnc7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>