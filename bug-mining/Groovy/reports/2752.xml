<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:43:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-6618] Enum constructor doesn&apos;t work properly with variable arguments</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-6618</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;enum&lt;/span&gt; Test {
    TEST1(1, 2, 3)

    Test(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;... ints) {
        println ints
    }
}

println Test.TEST1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This code gives me only &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&quot;, but it should be &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;1,2,3&amp;#93;&lt;/span&gt;&quot;&lt;/p&gt;


&lt;p&gt;In Java everything is fine:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;enum&lt;/span&gt; Test {
  TEST1(1, 2, 3);
  
  Test(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;... ints) {
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(java.util.Arrays.toString(ints));
  }

  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; []args){}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12817426">GROOVY-6618</key>
            <summary>Enum constructor doesn&apos;t work properly with variable arguments</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="blackdrag">Jochen Theodorou</assignee>
                                    <reporter username="bsideup">Sergei Egorov</reporter>
                        <labels>
                            <label>breaking</label>
                            <label>varargs</label>
                    </labels>
                <created>Thu, 13 Mar 2014 04:20:12 +0000</created>
                <updated>Wed, 10 Aug 2022 21:51:18 +0000</updated>
                            <resolved>Mon, 27 Oct 2014 10:17:31 +0000</resolved>
                                    <version>2.2.2</version>
                                    <fixVersion>2.4.0-beta-4</fixVersion>
                                    <component>Compiler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14475563" author="bsideup" created="Thu, 13 Mar 2014 04:55:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://jira.codehaus.org/browse/GROOVY-2933&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jira.codehaus.org/browse/GROOVY-2933&lt;/a&gt; this bug is also presented in 2.2.1 again (workaround - cast to List)&lt;/p&gt;</comment>
                            <comment id="14476523" author="blackdrag" created="Thu, 23 Oct 2014 10:13:52 +0000"  >&lt;p&gt;The bug lies in the the way the INIT method works (which is used to build the enum instance). We cannot call the constructor reflective, thus we do the same construction here, that we do for super- and this-calls in constructor delegation cases. For this we have MetaClass#selectAndTransformConstructor, which returns a number for the constructor. Since we can return only one thing, the method also modifies the argument array. Later code then makes assumptions about that array. arguments are transformed before the call. The problem now is that the call will expect an array with the numbers 1,2,3 as element 3 of the transformed argument array (the first two elements are the ordinal and the text of the enum). The argument array has in fact 5 elements, 1,2,3 being the last three. This is fine for the input state, but before the call the last three have to be packed in their own array. This step is missing. Thus it takes element 3 (the int 1) and casts it to Integer[], which Groovy allows. The result is the strangely missing 2 and 3.&lt;/p&gt;

&lt;p&gt;A first bugfix try for this is to add the usual transformation done before invoking a method, which includes the vargs transformation. Since this will produce a new array, the old information can be overwritten with the new information. This works, for the cases where there is at least one given argument for the varargs case. Meaning in my changed version here TEST1(1, 2, 3) works properly. It&apos;s a bit messy, since the argument array will then contain unused elements, but it works in those cases.&lt;/p&gt;

&lt;p&gt;But there is one more case and that is when the number of arguments is less than the number of parameters, This would be here for example TEST1(). This is valid for vargs and is supposed to produce an empty array. Since the original argument array is too short, this bug fix idea cannot be applied.&lt;/p&gt;</comment>
                            <comment id="14476666" author="blackdrag" created="Thu, 23 Oct 2014 10:18:25 +0000"  >&lt;p&gt;to show that the problem is more general and actually not enum specific:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Foo {
    Foo(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s,&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;[] a){println a}
    Foo() {&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;,1,2,3)}
}
&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Foo()&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;will also print &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; only&lt;/p&gt;</comment>
                            <comment id="14476719" author="blackdrag" created="Mon, 27 Oct 2014 10:17:31 +0000"  >&lt;p&gt;This issue should be fixed now. I had to setup a new method in DefaultTypeTransformation, which is called directly from bytecode. Since that will potentially cause problems to older 2.3 versions I decided to give this issue the label breaking (even though it is not strictly breaking anything) and made it 2.4 only&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12811588">GROOVY-7370</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 4 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2csgn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>