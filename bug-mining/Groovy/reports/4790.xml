<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 01:24:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-11313] Closure owner seems to be overwritten</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-11313</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;I had a Groovy script with nested closures that used &lt;tt&gt;owner&lt;/tt&gt; as the name of the outer closure&apos;s parameter (even though &lt;tt&gt;owner&lt;/tt&gt; might conflict with the closure &lt;a href=&quot;https://groovy-lang.org/closures.html#_owner_of_a_closure&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;owner&lt;/a&gt;):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.sql.GroovyRowResult
&#160;
runAll()
&#160;
void runAll() {
&#160; &#160; List owners = [&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyRowResult([user_id: 1])]
&#160; &#160; List pets = [&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GroovyRowResult([id: 1])]
&#160;
&#160; &#160; owners.each { owner -&amp;gt;
&#160; &#160; &#160; &#160; myMethod(1)
&#160; &#160; &#160; &#160; pets.each { pet -&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; myMethod(2)
&#160; &#160; &#160; &#160; &#160; &#160; println(owner.user_id)
&#160; &#160; &#160; &#160; }
&#160; &#160; }
}
&#160;
void myMethod(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i) {
&#160; &#160; println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Running my method ${i}&quot;&lt;/span&gt;)
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The same script worked as I expected in Groovy 3.x, but, in Groovy 4.0.18, it fails with the following error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; groovy.lang.MissingPropertyException: No such property: myMethod &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; class: groovy.sql.GroovyRowResult
at groovy.sql.GroovyRowResult.getProperty(GroovyRowResult.java:55)
at groovy.sql.GroovyRowResult.get(GroovyRowResult.java:157)
at groovy.lang.MetaClassImpl.invokePropertyOrMissing(MetaClassImpl.java:1389)
at groovy.lang.MetaClassImpl.doInvokeMethod(MetaClassImpl.java:1335)
at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1088)
at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1007)
at org.codehaus.groovy.runtime.InvokerHelper.invokePogoMethod(InvokerHelper.java:645)
at org.codehaus.groovy.runtime.InvokerHelper.invokeMethod(InvokerHelper.java:628)
at org.codehaus.groovy.runtime.metaclass.ClosureMetaClass.invokeOnDelegationObjects(ClosureMetaClass.java:391)
at org.codehaus.groovy.runtime.metaclass.ClosureMetaClass.invokeMethod(ClosureMetaClass.java:328)
at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1007)
at org.codehaus.groovy.vmplugin.v8.IndyInterface.fromCache(IndyInterface.java:321)
at Script1$_runAll_closure1$_closure2.doCall(Script1.groovy:16)
at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.base/java.lang.reflect.Method.invoke(Method.java:568)
at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:343)
at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:328) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It seems that &lt;tt&gt;myMethod&lt;/tt&gt; in the inner closure is trying to get resolved as a property of &lt;tt&gt;GroovyRowResult&lt;/tt&gt;, which is the type of the &lt;tt&gt;owner&lt;/tt&gt; parameter of the outer closure. The moment I rename &lt;tt&gt;owner&lt;/tt&gt; to something else or transform the inner &lt;tt&gt;each&lt;/tt&gt; to a &lt;tt&gt;for&lt;/tt&gt; loop, the script works. It doesn&apos;t fail either if I don&apos;t try to access any property of &lt;tt&gt;owner&lt;/tt&gt; inside the inner closure (such as &lt;tt&gt;owner.user_id&lt;/tt&gt;).&lt;br/&gt;
&#160;&lt;br/&gt;
Is this expected?&#160;&lt;br/&gt;
&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13568534">GROOVY-11313</key>
            <summary>Closure owner seems to be overwritten</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="emilles">Eric Milles</assignee>
                                    <reporter username="tcrespog">Tom&#225;s Crespo Garc&#237;a</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Feb 2024 06:47:17 +0000</created>
                <updated>Tue, 5 Mar 2024 01:53:29 +0000</updated>
                            <resolved>Sun, 25 Feb 2024 16:02:24 +0000</resolved>
                                    <version>4.0.18</version>
                                    <fixVersion>3.0.21</fixVersion>
                    <fixVersion>4.0.19</fixVersion>
                    <fixVersion>5.0.0-alpha-6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17819781" author="emilles" created="Thu, 22 Feb 2024 19:21:37 +0000"  >&lt;p&gt;&quot;owner&quot;, &quot;delegate&quot; and &quot;thisObject&quot; have special meaning within a closure.  They refer to &lt;tt&gt;Closure#getDelegate()&lt;/tt&gt;, &lt;tt&gt;Closure#getOwner()&lt;/tt&gt; and &lt;tt&gt;Closure#getThisObject()&lt;/tt&gt; respectively.&lt;/p&gt;</comment>
                            <comment id="17819818" author="blackdrag" created="Thu, 22 Feb 2024 21:12:48 +0000"  >&lt;p&gt;in &lt;/p&gt;
{ owner -&amp;gt; owner}
&lt;p&gt; owner refers to a local variable named owner, shadowing the getOwner. local variables take precedence, because of lexical scope. If you see a Closure as class then you expect the same rules to apply:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;X {
    def getFoo(){1}
    def m(){foo}
    def m2(foo){foo}
    def m3(){
        def foo = 42
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; foo
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; X().m() == 1
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; X().m2(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;) == &lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; X().m3() == 42
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Following these examples I see not why owner in a Closure should get resolved to getOwner if there is a local variable of the same name. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
def owner = 1
def cl = {owner}
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; cl() == 1
def cl2 = {&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; {owner}}
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; cl2()() == 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And frankly I even expect this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;X {
  def owner = 22
  def m() {&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; {owner}}
}
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; X().m() == 22
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But I am aware that this probably never worked. And changing it would break things now. Out of delegate, owner and thisObject there is really only delegate the one that can change and might not be available through other means. So from inside a Closure we would really only to take care of that. But in the end the MOP gets in the way for this last one. But the others are supposed to work.&lt;/p&gt;</comment>
                            <comment id="17820479" author="emilles" created="Sun, 25 Feb 2024 14:32:55 +0000"  >&lt;p&gt;Regarding the failure to resolve &lt;tt&gt;myMethod&lt;/tt&gt; in the inner closure.  The &lt;tt&gt;each&lt;/tt&gt; method executes the given closure with no delegate or resolve strategy alterations.  To resolve &quot;myMethod(2)&quot; it checks first with &quot;owner&quot; due to owner-first strategy.  Line 283 of &lt;tt&gt;ClosureMetaClass&lt;/tt&gt; is &quot;closure.getOwner()&quot; which is a generated method &amp;#8211; each referenced local variable gets a private field and public getter.  See &lt;a href=&quot;https://github.com/apache/groovy/blob/40ce8f0a670ce132d59a57535a29b7082e97baa4/src/main/java/org/codehaus/groovy/classgen/asm/ClosureWriter.java#L306&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;ClosureWriter#addFieldsAndGettersForLocalVariables&lt;/tt&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;We can try to restrict addition of getters for Closure properties.  We can try to get &quot;owner&quot; via some other means in &lt;tt&gt;ClosureMetaClass&lt;/tt&gt;.  Or ...&lt;/p&gt;

&lt;p&gt;In the meantime, you can do &quot;this.myMethod(...)&quot; to force resolution or change the name of the param from &quot;owner&quot; to something else.&lt;/p&gt;</comment>
                            <comment id="17820486" author="emilles" created="Sun, 25 Feb 2024 14:55:57 +0000"  >&lt;p&gt;In Groovy 3, the owner-first strategy is deferring to &quot;thisObject&quot; not &quot;owner&quot;, which is a bug that was fixed in Groovy 4.  It still gets &quot;owner&quot; from the generated method but uses it less.&lt;/p&gt;</comment>
                            <comment id="17820489" author="emilles" created="Sun, 25 Feb 2024 16:02:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/43e76661b94c3103845dab26b799a29c9b6bb1e7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/43e76661b94c3103845dab26b799a29c9b6bb1e7&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17820493" author="emilles" created="Sun, 25 Feb 2024 17:03:45 +0000"  >&lt;p&gt;I&apos;m not sure why the getters are created for closure shared variables.  Removing them altogether only failed tests checking that the methods exist and are marked as generated.&lt;/p&gt;</comment>
                            <comment id="17820513" author="blackdrag" created="Sun, 25 Feb 2024 19:56:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=emilles&quot; class=&quot;user-hover&quot; rel=&quot;emilles&quot;&gt;emilles&lt;/a&gt; Looks like I forgot to make an example with owner comming from another closure:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
def cl = { owner -&amp;gt; {&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; {owner}}}
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; cl(1)() == 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The inner owner reference is not supposed to be resolved against the owner getter of the outer closure, not even if owner comes from more outside, as long as owner is a local variable. And of course I also expect this to work (independent of the resolving strategy):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
def foo = &lt;span class=&quot;code-quote&quot;&gt;&apos;bar&apos;&lt;/span&gt;
def cl = { &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; {&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; {foo}}}
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; cl(1)() == foo
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There should be no getter created for foo, since foo is a context variable encapsulated in a holder, given to the closure at construction time. Therefore I do not understand the change you did for this. But that is not your fault - I see those getter actually exist for a longer time already. But really they should not, exactly because of the name clash. There cannot be a getOwner method for owner as property of the Closure and for owner as referenced local variable. Either those getter are required, then this name clash is a problem and your fix is probably a good temporary solution... or the getter are not required, then we should not create them.&lt;/p&gt;
</comment>
                            <comment id="17820798" author="emilles" created="Mon, 26 Feb 2024 17:41:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/groovy/commit/094b57b0f760fe1afba1fe93741e0115ed185b73&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/groovy/commit/094b57b0f760fe1afba1fe93741e0115ed185b73&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 37 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1neqg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>