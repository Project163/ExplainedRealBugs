<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 00:37:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[GROOVY-5864] @AutoExternalize doesn&apos;t create no-argument constructor</title>
                <link>https://issues.apache.org/jira/browse/GROOVY-5864</link>
                <project id="12318123" key="GROOVY">Groovy</project>
                    <description>&lt;p&gt;@AutoExternalize doesn&apos;t create a no-argument constructor, which is required to use Externalizable.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;gt;javap -classpath .;c:\Users\Johann\.m2\repository\org\codehaus\groovy\groovy\2.0.5\groovy-2.0.5.jar xyz.Stream | grep Stream
Compiled from &quot;Stream.groovy&quot;
public final class xyz.Stream implements java.io.Externalizable,groovy.lang.GroovyObject {
  public xyz.Stream(java.util.HashMap);
  public xyz.Stream(java.lang.String, java.lang.String, java.lang.String, java.lang.String, java.lang.Int
eger, java.lang.Integer, java.lang.Long);
&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Consequently, attempts at deserializing fail:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;classOrInstanceShouldBeSerializable[2](xyz.SerializationTest)  Time elapsed: 0.016 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
org.apache.commons.lang.SerializationException: java.io.InvalidClassException: xyz.Stream; no valid consuctor
        at org.apache.commons.lang.SerializationUtils.deserialize(SerializationUtils.java:168)
...
Caused by: java.io.InvalidClassException: xyz.Stream; no valid constructor
        at java.io.ObjectStreamClass$ExceptionInfo.newInvalidClassException(ObjectStreamClass.java:147)
        at java.io.ObjectStreamClass.checkDeserialize(ObjectStreamClass.java:755)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12812046">GROOVY-5864</key>
            <summary>@AutoExternalize doesn&apos;t create no-argument constructor</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paulk">Paul King</assignee>
                                    <reporter username="johann">Johann</reporter>
                        <labels>
                    </labels>
                <created>Sat, 22 Dec 2012 07:42:35 +0000</created>
                <updated>Sat, 5 Apr 2014 00:00:56 +0000</updated>
                            <resolved>Wed, 15 Jan 2014 03:36:03 +0000</resolved>
                                    <version>2.0.5</version>
                    <version>2.0.6</version>
                                    <fixVersion>2.3.0-beta-1</fixVersion>
                                    <component>xforms</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14473730" author="paulk" created="Sun, 23 Dec 2012 01:37:25 +0000"  >&lt;p&gt;Do you have the source to your &lt;tt&gt;Stream&lt;/tt&gt; class available? It looks like you are providing some constructors yourself (directly and/or with other AST transforms). I agree that the current behavior is less than ideal but want to make sure I understand your example correctly as I look at possible improvements (i.e. do we always provide the no-args constructor or alternatively give an error if it doesn&apos;t exist). Thanks.&lt;/p&gt;</comment>
                            <comment id="14473607" author="johann" created="Sun, 23 Dec 2012 05:23:45 +0000"  >&lt;p&gt;Here&apos;s the source:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; xyz

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.AutoExternalize
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; groovy.transform.Immutable

@Immutable
@AutoExternalize
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Stream {
    
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; serialVersionUID = -612566306978315215L
    
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fnuh, guh, keks, blorg
    
    &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; pruh, ctuh
    
    &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; mhhbop

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For &lt;tt&gt;Externalizable&lt;/tt&gt; you always need to have a no-argument constructor so the AST transform should add that in any cases.&lt;/p&gt;</comment>
                            <comment id="14480061" author="paulk" created="Sun, 23 Dec 2012 19:05:47 +0000"  >&lt;p&gt;I am wondering though whether it makes sense to use @Immutable with @AutoExternalize. @Immutable sets backing final fields for each property which can only be set in a constructor. @AutoExternalize is going to try to set fields in the readExternal method.&lt;/p&gt;</comment>
                            <comment id="14473564" author="johann" created="Mon, 24 Dec 2012 05:36:01 +0000"  >&lt;p&gt;If &lt;tt&gt;@Immutable&lt;/tt&gt; marks those fields as final, then yes, those two will not work together. That still doesn&apos;t mean the two concepts (serializability/immutability) cannot work together &amp;#8211; see &lt;tt&gt;java.lang.String&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;But &lt;tt&gt;@AutoExternalize&lt;/tt&gt; must create an or verify the existence of a no-argument constructor in any case. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Also, happy Christmas.&lt;/p&gt;</comment>
                            <comment id="14480095" author="paulk" created="Tue, 25 Dec 2012 22:59:54 +0000"  >&lt;p&gt;Happy Christmas to you too.&lt;/p&gt;

&lt;p&gt;There are some tricky issues to deal with in general when dealing with final fields and serialization, e.g. see:&lt;br/&gt;
&lt;a href=&quot;http://bugs.sun.com/view_bug.do?bug_id=6379948&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bugs.sun.com/view_bug.do?bug_id=6379948&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;But getting back to specific issues wrt @AutoExtermalize, we can do a little more than we do now but it is still trickier than you would think. The default constructor is added by Groovy&apos;s compiler in the class generation phase of the compilation. When the AutoExternalize transform is processing, we will have available any explicitly defined constructors in the classnode but we won&apos;t know if subsequent AST transforms add additional constructors (and hence stop Groovy adding in the default constructor later) or add a default constructor later themselves (and hence we wouldn&apos;t want to pre-emptively throw a false-positive compile time error). We might be tempted to add the no-arg constructor in early ourselves but that might confuse subsequent transforms. We also could try to sniff about and see if there are other transform annotations on the class and try to deduce what constructors they might add but that would be considered bad practice as we want AST transforms to be as independent as possible. But there are some things we could do and particularly in 2.1 with annotation aliases.&lt;/p&gt;

&lt;p&gt;For example, we could rename the existing &lt;tt&gt;AutoExternalize&lt;/tt&gt; to &lt;tt&gt;AutoExternalizePre&lt;/tt&gt; or &lt;tt&gt;AutoExternalizeCanonical&lt;/tt&gt; or something; add a new verifier which checked that a no-arg constructor is defined, e.g. &lt;tt&gt;AutoExternalizeVerifier&lt;/tt&gt; or &lt;tt&gt;AutoExternalizePost&lt;/tt&gt; or &lt;tt&gt;AutoExternalizeClassGen&lt;/tt&gt; or something; then define an annotation alias (new in 2.1) something like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@AnnotationCollector([AutoExternalizePre, AutoExternalizeVerifier])
@&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; AutoExternalize { }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This would give you are nicer error message you are after. Instead of a &apos;no valid constructor&apos; runtime error you would get an error such as &apos;@AutoExternalizable requires a no-arg constructor but none found&apos;.&lt;/p&gt;</comment>
                            <comment id="14480073" author="paulk" created="Wed, 26 Dec 2012 03:29:55 +0000"  >&lt;p&gt;Spike for this functionality here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/paulk-asert/groovy-core/commit/7e6ecaacd94efe4e9b642a1fe88c71adc62a87ae&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/paulk-asert/groovy-core/commit/7e6ecaacd94efe4e9b642a1fe88c71adc62a87ae&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/paulk-asert/groovy-core/commit/baf23e2787f84c4aae43b183e25438538925f91d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/paulk-asert/groovy-core/commit/baf23e2787f84c4aae43b183e25438538925f91d&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Needs further discussion about what to call the introduced (and existing) annotations.&lt;/p&gt;</comment>
                            <comment id="14473717" author="johann" created="Wed, 26 Dec 2012 04:45:07 +0000"  >&lt;p&gt;I don&apos;t see why it should be that complicated since the &lt;tt&gt;readExternal&lt;/tt&gt; method should restore all serializable state. In other words, creating a no-argument constructor should not hurt?&lt;/p&gt;</comment>
                            <comment id="14480067" author="paulk" created="Wed, 26 Dec 2012 05:08:58 +0000"  >&lt;p&gt;Well that&apos;s certainly one solution. In your earlier example, @Immutable would then complain with a compile error that you provided a no-arg constructor where none was allowed. Similarly there are other AST transforms that might behave in different ways when finding a no-arg constructor. These kind of interactions are to be expected but we try to minimise them when we can.&lt;/p&gt;</comment>
                            <comment id="14473766" author="paulk" created="Wed, 26 Dec 2012 15:59:39 +0000"  >&lt;p&gt;Perhaps there is one other point that perhaps wasn&apos;t clear in my discussion above. Groovy will normally give you the no-arg constructor that @AutoExternalize requires. It is only if you go out of your way to override that behaviour, e.g. by using @Immutable (or some other AST transform that plays with constructors without giving you a no-arg one) or defining your own explicit constructors that you would run into trouble.&lt;/p&gt;</comment>
                            <comment id="14473699" author="blackdrag" created="Thu, 27 Dec 2012 01:10:00 +0000"  >&lt;p&gt;If it were only about adding the no args constructor... we could maybe have it as private constructor. That would not prevent anything for Immutable. But setting the final fields then... &lt;/p&gt;</comment>
                            <comment id="14473677" author="johann" created="Thu, 27 Dec 2012 06:29:22 +0000"  >&lt;p&gt;This is just an interaction between &lt;tt&gt;@Immutable&lt;/tt&gt; and &lt;tt&gt;@AutoExternalize&lt;/tt&gt; then? That makes it harder to fix since you would need to anticipate the behaviour of all annotations. It also means the annotations are not going to be usable in all cases, which is sad since AST transforms in Groovy are so helpful.&lt;/p&gt;</comment>
                            <comment id="14480102" author="paulk" created="Thu, 27 Dec 2012 15:54:59 +0000"  >&lt;p&gt;A private no-arg constructor is not good enough. You still get the same &apos;no valid constructor&apos; runtime error.&lt;/p&gt;

&lt;p&gt;@Johann, yes it is an interaction. Such interactions are to be expected. One wouldn&apos;t expect @Immutable to work with for example a @Mutable transform - one would break. Indeed, feature interaction is a well known research topic and the subject of many a PhD thesis with no known general solution. I don&apos;t regard it as &apos;sad&apos;; it just means that there are times when knowing some of what goes on under the covers with a transform can&apos;t be avoided. The reason your request has generated some discussion is precisely because of the effort we go to minimising interactions when we can.&lt;/p&gt;

&lt;p&gt;So to summarise, we have these options:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;leave things as they are - the runtime error message is perhaps not obvious&lt;/li&gt;
	&lt;li&gt;change @AutoExternalize to add a no-arg constructor in an early phase; could potentially interact with other transforms; might need to provide various options, e.g. see force on @TupleConstructor&lt;/li&gt;
	&lt;li&gt;change @AutoExternalize to add a np-arg constructor in a latter phase if none is found; minimises the chance of interactions but requires two transforms and an alias&lt;/li&gt;
	&lt;li&gt;leave adding constructors to specialist transforms, e.g. @TupleConstructor but check one has been added in a later phase; requires two transforms and an alias&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The two transforms and an alias variants would only be for Groovy 2.1+ and have potential implications for classes compiled with earlier versions of Groovy but running on 2.1+ (depending on what names we use for the transforms &amp;amp; alias).&lt;/p&gt;</comment>
                            <comment id="14473712" author="paulk" created="Thu, 27 Dec 2012 15:57:10 +0000"  >&lt;p&gt;Assigning temporarily to 2.1.0-rc-1 for review, to ensure discussion before that release.&lt;/p&gt;</comment>
                            <comment id="14474028" author="aalmiray" created="Mon, 11 Feb 2013 03:16:40 +0000"  >&lt;p&gt;Personally I&apos;ll leave @AutoExternalize as it is. If only @AutoExternalize is applied to a class then the code works as expected. The moment a developer adds a no-args constructor (either manually or via another AST xform) then things go south.&lt;/p&gt;

&lt;p&gt;Checking for a no-args constructor during the processing @AutoExternalize is too early; the xform should check if such constructor exists after &lt;em&gt;all&lt;/em&gt; AST xforms have run, which is something we don&apos;t support yet as far as I recall, that is, running AST xform code in two different phases.&lt;/p&gt;</comment>
                            <comment id="14480166" author="paulk" created="Mon, 11 Feb 2013 17:07:54 +0000"  >&lt;p&gt;@Andres: Re: &quot;running AST xform code in two different phases&quot; - a good use case for AnnotationCollector as per the spike. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; But otherwise I agree with your comments.&lt;/p&gt;</comment>
                            <comment id="14474352" author="pschumacher" created="Sat, 6 Apr 2013 05:38:08 +0000"  >&lt;p&gt;@Paul should we close this issue?&lt;/p&gt;</comment>
                            <comment id="14480205" author="paulk" created="Fri, 12 Apr 2013 17:18:40 +0000"  >&lt;p&gt;Pascal, I would be keen to implement something like what is in the spike - it is &quot;just&quot; a matter of working out what (if any) backwards compatibility issues there night be.&lt;/p&gt;</comment>
                            <comment id="14480420" author="paulk" created="Fri, 3 Jan 2014 22:12:33 +0000"  >&lt;p&gt;This might have become a non-issue since we fixed &lt;a href=&quot;https://issues.apache.org/jira/browse/GROOVY-6473&quot; title=&quot;@Immutable should provide a no-arg constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;GROOVY-6473&quot;&gt;&lt;del&gt;GROOVY-6473&lt;/del&gt;&lt;/a&gt;. Well, the no-arg constructor bit is a non-issue - though we might still want a verifier. The final fields part of the issue which Immutable sets up would still be an issue for AutoExternalize.&lt;/p&gt;</comment>
                            <comment id="14480391" author="paulk" created="Wed, 15 Jan 2014 03:36:03 +0000"  >&lt;p&gt;I am going to close this. For Groovy 2.3, AutoExternalize uses the neat annotation collection feature to now run a verification step. The problem with mixing Immutable and AutoExternalize isn&apos;t solved - they are incompatible transforms - but now you get a clearer error message. In addition, numerous other error cases are now covered by the verifier and give better error messages. On top of that, the ExternalizeVerifier annotation can be used with your own Externalizable classes to perform various checks if you like. Also, you can use the ExternalizeMethods annotation if you don&apos;t want the verification at all.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 44 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2crav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>