diff --git a/src/main/org/codehaus/groovy/transform/ImmutableASTTransformation.java b/src/main/org/codehaus/groovy/transform/ImmutableASTTransformation.java
index 4378f0b33e..65bfa40d45 100644
--- a/src/main/org/codehaus/groovy/transform/ImmutableASTTransformation.java
+++ b/src/main/org/codehaus/groovy/transform/ImmutableASTTransformation.java
@@ -271,9 +271,14 @@ public class ImmutableASTTransformation extends AbstractASTTransformation {
         return immutables;
     }
 
-    private static void makeClassFinal(ClassNode cNode) {
-        if ((cNode.getModifiers() & ACC_FINAL) == 0) {
-            cNode.setModifiers(cNode.getModifiers() | ACC_FINAL);
+    private void makeClassFinal(ClassNode cNode) {
+        int modifiers = cNode.getModifiers();
+        if ((modifiers & ACC_FINAL) == 0) {
+            if ((modifiers & (ACC_ABSTRACT | ACC_SYNTHETIC)) == (ACC_ABSTRACT | ACC_SYNTHETIC)) {
+                addError("Error during " + MY_TYPE_NAME + " processing: annotation found on inappropriate class " + cNode.getName(), cNode);
+                return;
+            }
+            cNode.setModifiers(modifiers | ACC_FINAL);
         }
     }
 
diff --git a/src/main/org/codehaus/groovy/transform/trait/TraitASTTransformation.java b/src/main/org/codehaus/groovy/transform/trait/TraitASTTransformation.java
index f287284801..5ff3bb7890 100644
--- a/src/main/org/codehaus/groovy/transform/trait/TraitASTTransformation.java
+++ b/src/main/org/codehaus/groovy/transform/trait/TraitASTTransformation.java
@@ -576,9 +576,11 @@ public class TraitASTTransformation extends AbstractASTTransformation implements
 
         @Override
         public Expression transform(final Expression exp) {
-            Expression replacement = exp.getNodeMetaData(TraitASTTransformation.POST_TYPECHECKING_REPLACEMENT);
-            if (replacement!=null) {
-                return replacement;
+            if (exp != null) {
+                Expression replacement = exp.getNodeMetaData(TraitASTTransformation.POST_TYPECHECKING_REPLACEMENT);
+                if (replacement!=null) {
+                    return replacement;
+                }
             }
             return super.transform(exp);
         }
