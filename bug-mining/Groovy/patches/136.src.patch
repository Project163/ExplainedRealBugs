diff --git a/src/main/groovy/util/AntBuilder.java b/src/main/groovy/util/AntBuilder.java
index 332d4186f3..121001e8b0 100644
--- a/src/main/groovy/util/AntBuilder.java
+++ b/src/main/groovy/util/AntBuilder.java
@@ -55,14 +55,7 @@ import java.util.Map;
 import java.util.logging.Level;
 import java.util.logging.Logger;
 
-import org.apache.tools.ant.BuildException;
-import org.apache.tools.ant.BuildLogger;
-import org.apache.tools.ant.IntrospectionHelper;
-import org.apache.tools.ant.NoBannerLogger;
-import org.apache.tools.ant.Project;
-import org.apache.tools.ant.Task;
-import org.apache.tools.ant.TaskAdapter;
-import org.apache.tools.ant.TaskContainer;
+import org.apache.tools.ant.*;
 import org.apache.tools.ant.types.DataType;
 import org.codehaus.groovy.ant.FileScanner;
 import org.codehaus.groovy.runtime.InvokerHelper;
@@ -70,7 +63,7 @@ import org.codehaus.groovy.runtime.InvokerHelper;
 /**
  * Allows Ant tasks to be used with GroovyMarkup 
  * 
- * @author <a href="mailto:james@coredevelopers.net">James Strachan</a>
+ * @author <a href="mailto:james@coredevelopers.net">James Strachan</a>, changes by Dierk Koenig (dk)
  * @version $Revision$
  */
 public class AntBuilder extends BuilderSupport {
@@ -88,6 +81,11 @@ public class AntBuilder extends BuilderSupport {
         this.project = project;
     }
 
+    // dk: introduced for convenience in subclasses
+    protected Project getProject() {
+        return project;
+    }
+
     /**
      * @return Factory method to create new Project instances
      */
@@ -109,7 +107,20 @@ public class AntBuilder extends BuilderSupport {
     protected void setParent(Object parent, Object child) {
     }
 
+    /**
+     * Determines, when the ANT Task that is represented by the "node" should perform.
+     * Node must be an ANT Task or no "perform" is called.
+     * If node is an ANT Task, it performs right after complete contstruction.
+     * If node is nested in a TaskContainer, calling "perform" is delegated to that
+     * TaskContainer.
+     * @param parent note: null when node is root
+     * @param node the node that now has all its children applied
+     */
     protected void nodeCompleted(Object parent, Object node) {
+        if (parent instanceof TaskContainer) {
+            log.finest("parent is TaskContainer: no perform on nodeCompleted");
+            return; // parent will care about when children perform
+        }
         if (node instanceof Task) {
             Task task = (Task) node;
             task.perform();
@@ -187,6 +198,11 @@ public class AntBuilder extends BuilderSupport {
 
                 // now lets set any attributes of this tag...
                 setBeanProperties(task, attributes);
+
+                // dk: TaskContainers have their own adding logic
+                if (parentObject instanceof TaskContainer){
+                    ((TaskContainer)parentObject).addTask(task);
+                }
             }
         }
 
@@ -346,7 +362,11 @@ public class AntBuilder extends BuilderSupport {
 
             if (ih != null) {
                 try {
-                    dataType = ih.createElement(getAntProject(), object, name.toLowerCase());
+                    // dk: the line below resolves the deprecation warning but may not work
+                    // properly with namespaces.
+                    String namespaceUri = "";               // todo: how to set this?
+                    UnknownElement unknownElement = null;   // todo: what is expected here?
+                    dataType = ih.getElementCreator(getAntProject(), namespaceUri, object, name.toLowerCase(), unknownElement).create();
                 }
                 catch (BuildException be) {
                     log.log(Level.SEVERE, "Caught: " + be, be);
diff --git a/src/test/groovy/util/AntTest.groovy b/src/test/groovy/util/AntTest.groovy
index 27ab899d9e..55f4f5025e 100644
--- a/src/test/groovy/util/AntTest.groovy
+++ b/src/test/groovy/util/AntTest.groovy
@@ -76,5 +76,37 @@ class AntTest extends GroovyTestCase {
     	println "Found path of type ${value.class.name}"
     	println value
     }
+
+    void testTaskContainerAddTaskIsCalled() {
+        ant = new AntBuilder()
+        taskContainer = ant.parallel(){ // "Parallel" serves as a sample TaskContainer
+            ant.echo()                  // "Echo" without message to keep tests silent
+        }
+        // not very elegant, but the easiest way to get the ant internals...
+        assert taskContainer.dump() =~ 'nestedTasks=\\[org.apache.tools.ant.taskdefs.Echo@\\w+\\]'
+    }
+
+    void testTaskContainerExecutionSequence() {
+        ant = new AntBuilder()
+        SpoofTaskContainer.getSpoof().length = 0
+        PATH = 'task.path'
+        ant.path(id:PATH){ant.pathelement(location:'classes')}
+        ['spoofcontainer':'SpoofTaskContainer', 'spoof':'SpoofTask'].each{ |pair|
+            ant.taskdef(name:pair.key, classname:'groovy.util.'+pair.value, classpathref:PATH)
+        }
+        ant.spoofcontainer(){
+            ant.spoof()
+        }
+        expectedSpoof =
+            "SpoofTaskContainer ctor\n"+
+            "SpoofTask ctor\n"+
+            "in addTask\n"+
+            "begin SpoofTaskContainer execute\n"+
+            "begin SpoofTask execute\n"+
+            "end SpoofTask execute\n"+
+            "end SpoofTaskContainer execute\n"
+        assertEquals expectedSpoof, SpoofTaskContainer.getSpoof().toString()
+    }
+
     
 }
diff --git a/src/test/groovy/util/SpoofTask.java b/src/test/groovy/util/SpoofTask.java
new file mode 100644
index 0000000000..66ea4c308a
--- /dev/null
+++ b/src/test/groovy/util/SpoofTask.java
@@ -0,0 +1,18 @@
+package groovy.util;
+
+import org.apache.tools.ant.BuildException;
+import org.apache.tools.ant.Task;
+
+public class SpoofTask extends Task {
+
+    public SpoofTask() {
+        super();
+        SpoofTaskContainer.spoof("SpoofTask ctor");
+    }
+
+    public void execute() throws BuildException {
+        SpoofTaskContainer.spoof("begin SpoofTask execute");
+        SpoofTaskContainer.spoof("end SpoofTask execute");
+    }
+
+}
diff --git a/src/test/groovy/util/SpoofTaskContainer.java b/src/test/groovy/util/SpoofTaskContainer.java
new file mode 100644
index 0000000000..abadceed3f
--- /dev/null
+++ b/src/test/groovy/util/SpoofTaskContainer.java
@@ -0,0 +1,49 @@
+package groovy.util;
+
+import org.apache.tools.ant.Task;
+import org.apache.tools.ant.TaskContainer;
+import org.apache.tools.ant.UnknownElement;
+import org.apache.tools.ant.BuildException;
+
+import java.util.List;
+import java.util.ArrayList;
+import java.util.Iterator;
+
+public class SpoofTaskContainer extends Task implements TaskContainer {
+    private List tasks = new ArrayList();
+    static StringBuffer spoof = new StringBuffer();
+
+    public SpoofTaskContainer() {
+        super();
+        spoof("SpoofTaskContainer ctor");
+    }
+
+    static StringBuffer getSpoof(){
+        return spoof;
+    }
+
+    static void spoof(String message){
+        spoof.append(message);
+        spoof.append("\n");
+    }
+
+    public void addTask(Task task) {
+    	// to work with ant 1.6
+        spoof("in addTask");
+        if (task instanceof UnknownElement) {
+            task.maybeConfigure();
+            task = ((UnknownElement) task).getTask();
+        }
+        tasks.add(task);
+    }
+
+    public void execute() throws BuildException {
+        spoof("begin SpoofTaskContainer execute");
+        for (Iterator iter = tasks.iterator(); iter.hasNext();) {
+            Task task = (Task) iter.next();
+            task.perform();
+        }
+        spoof("end SpoofTaskContainer execute");
+    }
+
+}
