diff --git a/src/main/org/codehaus/groovy/tools/shell/Groovysh.groovy b/src/main/org/codehaus/groovy/tools/shell/Groovysh.groovy
index b216298773..fb1ba9459a 100644
--- a/src/main/org/codehaus/groovy/tools/shell/Groovysh.groovy
+++ b/src/main/org/codehaus/groovy/tools/shell/Groovysh.groovy
@@ -60,7 +60,10 @@ class Groovysh
     InteractiveShellRunner runner
     
     History history
-    
+
+    boolean historyFull  // used as a workaround for GROOVY-2177
+    String evictedLine  // remembers the command which will get evicted if history is full
+
     Groovysh(final ClassLoader classLoader, final Binding binding, final IO io, final Closure registrar) {
         super(io)
         
@@ -166,7 +169,7 @@ class Groovysh
                 // Should never happen
                 throw new Error("Invalid parse status: $status.code")
         }
-        
+
         return result
     }
 
diff --git a/src/main/org/codehaus/groovy/tools/shell/InteractiveShellRunner.groovy b/src/main/org/codehaus/groovy/tools/shell/InteractiveShellRunner.groovy
index 09824d3bca..d6c980ea96 100644
--- a/src/main/org/codehaus/groovy/tools/shell/InteractiveShellRunner.groovy
+++ b/src/main/org/codehaus/groovy/tools/shell/InteractiveShellRunner.groovy
@@ -61,6 +61,7 @@ class InteractiveShellRunner
         completor.refresh()
 
         // And then actually run
+        adjustHistory()
         super.run()
     }
     
@@ -92,6 +93,22 @@ class InteractiveShellRunner
             return "";
         }
     }
+
+    @Override
+    protected boolean work() {
+        boolean result= super.work()
+        adjustHistory()
+
+        result
+    }
+
+    private void adjustHistory() {
+        if (shell instanceof Groovysh) {
+            shell.historyFull = shell.history.size() >= shell.history.maxSize
+            if (shell.historyFull) shell.evictedLine = shell.history.historyList[0]
+        }
+    }
+
 }
 
 /**
diff --git a/src/main/org/codehaus/groovy/tools/shell/commands/HistoryCommand.groovy b/src/main/org/codehaus/groovy/tools/shell/commands/HistoryCommand.groovy
index e368106d76..80b6d4c478 100644
--- a/src/main/org/codehaus/groovy/tools/shell/commands/HistoryCommand.groovy
+++ b/src/main/org/codehaus/groovy/tools/shell/commands/HistoryCommand.groovy
@@ -103,8 +103,13 @@ class HistoryCommand
         
         try {
             id = Integer.parseInt(id)
-            
-            line = history.historyList[id]
+            if (shell.historyFull) {
+                // if history was full before execution of the command, then the recall command itself
+                // has been added to history before it actually gets executed
+                // so we need to shift by one
+                id--
+            };
+            line = id<0?shell.evictedLine:history.historyList[id]
         }
         catch (Exception e) {
             fail("Invalid history identifier: $id", e)
