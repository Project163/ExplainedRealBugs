diff --git a/src/bin/grok b/src/bin/grok
index 75a8c47ae6..d1f6e229f7 100644
--- a/src/bin/grok
+++ b/src/bin/grok
@@ -40,6 +40,22 @@ case "`uname`" in
         ;;
 esac
 
+# Attempt to set JAVA_HOME if it's not already set
+if [ -z "$JAVA_HOME" ]; then
+	
+	# Set JAVA_HOME for Darwin
+	if $darwin; then
+		
+		[ -z "$JAVA_HOME" -a -d "/Library/Java/Home" ] &&
+			export JAVA_HOME="/Library/Java/Home"
+			
+		[ -z "$JAVA_HOME" -a -d "/System/Library/Frameworks/JavaVM.framework/Home" ] &&
+			export JAVA_HOME="/System/Library/Frameworks/JavaVM.framework/Home"
+		
+	fi
+	
+fi
+
 # For Cygwin, ensure paths are in UNIX format before anything is touched
 if $cygwin ; then
     [ -n "$GROOVY_HOME" ] &&
@@ -51,10 +67,28 @@ if $cygwin ; then
 fi
 
 # Locate GROOVY_HOME if not it is not set
-if [ "x$GROOVY_HOME" = "x" ]; then
-    GROOVY_HOME=`cd "$DIRNAME/.."; pwd`
+if [ -z "$GROOVY_HOME" -o ! -d "$GROOVY_HOME" ] ; then
+  # resolve links - $0 may be a link to groovy's home
+  PRG="$0"
+
+  # need this for relative symlinks
+  while [ -h "$PRG" ] ; do
+    ls=`ls -ld "$PRG"`
+    link=`expr "$ls" : '.*-> \(.*\)$'`
+    if expr "$link" : '/.*' > /dev/null; then
+    PRG="$link"
+    else
+    PRG=`dirname "$PRG"`"/$link"
+    fi
+  done
+
+  SAVED="`pwd`"
+  cd "`dirname \"$PRG\"`/.."
+  GROOVY_HOME="`pwd -P`"
+  cd "$SAVED"
 fi
 
+
 # Use default grok-classworlds config
 if [ -z "$CLASSWORLDS_CONF" ]; then
     CLASSWORLDS_CONF="$GROOVY_HOME/conf/grok-classworlds.conf"
diff --git a/src/bin/groovy b/src/bin/groovy
index 33337d8572..7bed035ac7 100644
--- a/src/bin/groovy
+++ b/src/bin/groovy
@@ -47,6 +47,22 @@ if [ "$1" = "-cp" ] || [ "$1" = "-classpath" ]; then
   shift 2
 fi
 
+# Attempt to set JAVA_HOME if it's not already set
+if [ -z "$JAVA_HOME" ]; then
+	
+	# Set JAVA_HOME for Darwin
+	if $darwin; then
+		
+		[ -z "$JAVA_HOME" -a -d "/Library/Java/Home" ] &&
+			export JAVA_HOME="/Library/Java/Home"
+			
+		[ -z "$JAVA_HOME" -a -d "/System/Library/Frameworks/JavaVM.framework/Home" ] &&
+			export JAVA_HOME="/System/Library/Frameworks/JavaVM.framework/Home"
+		
+	fi
+	
+fi
+
 # For Cygwin, ensure paths are in UNIX format before anything is touched
 if $cygwin ; then
     [ -n "$GROOVY_HOME" ] &&
@@ -60,8 +76,25 @@ if $cygwin ; then
 fi
 
 # Locate GROOVY_HOME if not it is not set
-if [ "x$GROOVY_HOME" = "x" ]; then
-    GROOVY_HOME=`cd "$DIRNAME/.."; pwd`
+if [ -z "$GROOVY_HOME" -o ! -d "$GROOVY_HOME" ] ; then
+  # resolve links - $0 may be a link to groovy's home
+  PRG="$0"
+
+  # need this for relative symlinks
+  while [ -h "$PRG" ] ; do
+    ls=`ls -ld "$PRG"`
+    link=`expr "$ls" : '.*-> \(.*\)$'`
+    if expr "$link" : '/.*' > /dev/null; then
+    PRG="$link"
+    else
+    PRG=`dirname "$PRG"`"/$link"
+    fi
+  done
+
+  SAVED="`pwd`"
+  cd "`dirname \"$PRG\"`/.."
+  GROOVY_HOME="`pwd -P`"
+  cd "$SAVED"
 fi
 
 # Use default groovy-classworlds config
diff --git a/src/bin/groovyConsole b/src/bin/groovyConsole
index ca30e5827d..b2075dd899 100644
--- a/src/bin/groovyConsole
+++ b/src/bin/groovyConsole
@@ -40,6 +40,22 @@ case "`uname`" in
         ;;
 esac
 
+# Attempt to set JAVA_HOME if it's not already set
+if [ -z "$JAVA_HOME" ]; then
+	
+	# Set JAVA_HOME for Darwin
+	if $darwin; then
+		
+		[ -z "$JAVA_HOME" -a -d "/Library/Java/Home" ] &&
+			export JAVA_HOME="/Library/Java/Home"
+			
+		[ -z "$JAVA_HOME" -a -d "/System/Library/Frameworks/JavaVM.framework/Home" ] &&
+			export JAVA_HOME="/System/Library/Frameworks/JavaVM.framework/Home"
+		
+	fi
+	
+fi
+
 # For Cygwin, ensure paths are in UNIX format before anything is touched
 if $cygwin ; then
     [ -n "$GROOVY_HOME" ] &&
@@ -51,8 +67,25 @@ if $cygwin ; then
 fi
 
 # Locate GROOVY_HOME if not it is not set
-if [ "x$GROOVY_HOME" = "x" ]; then
-    GROOVY_HOME=`cd "$DIRNAME/.."; pwd`
+if [ -z "$GROOVY_HOME" -o ! -d "$GROOVY_HOME" ] ; then
+  # resolve links - $0 may be a link to groovy's home
+  PRG="$0"
+
+  # need this for relative symlinks
+  while [ -h "$PRG" ] ; do
+    ls=`ls -ld "$PRG"`
+    link=`expr "$ls" : '.*-> \(.*\)$'`
+    if expr "$link" : '/.*' > /dev/null; then
+    PRG="$link"
+    else
+    PRG=`dirname "$PRG"`"/$link"
+    fi
+  done
+
+  SAVED="`pwd`"
+  cd "`dirname \"$PRG\"`/.."
+  GROOVY_HOME="`pwd -P`"
+  cd "$SAVED"
 fi
 
 # Use default groovy-classworlds config
diff --git a/src/bin/groovyc b/src/bin/groovyc
index 5d419bbe73..2f65b3a12e 100644
--- a/src/bin/groovyc
+++ b/src/bin/groovyc
@@ -40,6 +40,22 @@ case "`uname`" in
         ;;
 esac
 
+# Attempt to set JAVA_HOME if it's not already set
+if [ -z "$JAVA_HOME" ]; then
+	
+	# Set JAVA_HOME for Darwin
+	if $darwin; then
+		
+		[ -z "$JAVA_HOME" -a -d "/Library/Java/Home" ] &&
+			export JAVA_HOME="/Library/Java/Home"
+			
+		[ -z "$JAVA_HOME" -a -d "/System/Library/Frameworks/JavaVM.framework/Home" ] &&
+			export JAVA_HOME="/System/Library/Frameworks/JavaVM.framework/Home"
+		
+	fi
+	
+fi
+
 # For Cygwin, ensure paths are in UNIX format before anything is touched
 if $cygwin ; then
     [ -n "$GROOVY_HOME" ] &&
@@ -51,8 +67,25 @@ if $cygwin ; then
 fi
 
 # Locate GROOVY_HOME if not it is not set
-if [ "x$GROOVY_HOME" = "x" ]; then
-    GROOVY_HOME=`cd "$DIRNAME/.."; pwd`
+if [ -z "$GROOVY_HOME" -o ! -d "$GROOVY_HOME" ] ; then
+  # resolve links - $0 may be a link to groovy's home
+  PRG="$0"
+
+  # need this for relative symlinks
+  while [ -h "$PRG" ] ; do
+    ls=`ls -ld "$PRG"`
+    link=`expr "$ls" : '.*-> \(.*\)$'`
+    if expr "$link" : '/.*' > /dev/null; then
+    PRG="$link"
+    else
+    PRG=`dirname "$PRG"`"/$link"
+    fi
+  done
+
+  SAVED="`pwd`"
+  cd "`dirname \"$PRG\"`/.."
+  GROOVY_HOME="`pwd -P`"
+  cd "$SAVED"
 fi
 
 # Use default groovyc-classworlds config
diff --git a/src/bin/groovysh b/src/bin/groovysh
index d2ab5efe79..4c9ba04d57 100644
--- a/src/bin/groovysh
+++ b/src/bin/groovysh
@@ -40,6 +40,22 @@ case "`uname`" in
         ;;
 esac
 
+# Attempt to set JAVA_HOME if it's not already set
+if [ -z "$JAVA_HOME" ]; then
+	
+	# Set JAVA_HOME for Darwin
+	if $darwin; then
+		
+		[ -z "$JAVA_HOME" -a -d "/Library/Java/Home" ] &&
+			export JAVA_HOME="/Library/Java/Home"
+			
+		[ -z "$JAVA_HOME" -a -d "/System/Library/Frameworks/JavaVM.framework/Home" ] &&
+			export JAVA_HOME="/System/Library/Frameworks/JavaVM.framework/Home"
+		
+	fi
+	
+fi
+
 # For Cygwin, ensure paths are in UNIX format before anything is touched
 if $cygwin ; then
     [ -n "$GROOVY_HOME" ] &&
@@ -51,8 +67,25 @@ if $cygwin ; then
 fi
 
 # Locate GROOVY_HOME if not it is not set
-if [ "x$GROOVY_HOME" = "x" ]; then
-    GROOVY_HOME=`cd "$DIRNAME/.."; pwd`
+if [ -z "$GROOVY_HOME" -o ! -d "$GROOVY_HOME" ] ; then
+  # resolve links - $0 may be a link to groovy's home
+  PRG="$0"
+
+  # need this for relative symlinks
+  while [ -h "$PRG" ] ; do
+    ls=`ls -ld "$PRG"`
+    link=`expr "$ls" : '.*-> \(.*\)$'`
+    if expr "$link" : '/.*' > /dev/null; then
+    PRG="$link"
+    else
+    PRG=`dirname "$PRG"`"/$link"
+    fi
+  done
+
+  SAVED="`pwd`"
+  cd "`dirname \"$PRG\"`/.."
+  GROOVY_HOME="`pwd -P`"
+  cd "$SAVED"
 fi
 
 # Use default groovy-classworlds config
