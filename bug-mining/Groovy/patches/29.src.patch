diff --git a/src/main/groovy/lang/GroovyShell.java b/src/main/groovy/lang/GroovyShell.java
index 0cdb2680b8..ee3ac57096 100644
--- a/src/main/groovy/lang/GroovyShell.java
+++ b/src/main/groovy/lang/GroovyShell.java
@@ -132,7 +132,12 @@ public class GroovyShell extends GroovyObjectSupport {
 
     public void setProperty(String property, Object newValue) {
         setVariable(property, newValue);
-        super.setProperty(property, newValue);
+        try {
+            super.setProperty(property, newValue);
+        }
+        catch (GroovyRuntimeException e) {
+            // ignore, was probably a dynamic property
+        }
     }
 
     /**
diff --git a/src/main/groovy/lang/Script.java b/src/main/groovy/lang/Script.java
index 3196de433e..e7fbfc4031 100644
--- a/src/main/groovy/lang/Script.java
+++ b/src/main/groovy/lang/Script.java
@@ -45,7 +45,6 @@
  */
 package groovy.lang;
 
-
 /**
  * This object represents a Groovy script
  * 
@@ -58,17 +57,20 @@ public abstract class Script extends GroovyObjectSupport {
     public Binding getBindings() {
         return bindings;
     }
-    
+
     public void setBindings(Binding bindings) {
         this.bindings = bindings;
     }
 
     public Object getProperty(String property) {
+        //System.out.println("Script.getProperty for: " + property + " with bindings: " + bindings.getVariables());
         return bindings.getVariable(property);
     }
 
     public void setProperty(String property, Object newValue) {
-    	bindings.setVariable(property, newValue);
+        //System.out.println("Script.setProperty for: " + property + " with newValue: " + newValue);
+        bindings.setVariable(property, newValue);
+        //System.out.println("bindings are now: " + bindings.getVariables());
     }
 
     /**
diff --git a/src/main/org/codehaus/groovy/classgen/ClassGenerator.java b/src/main/org/codehaus/groovy/classgen/ClassGenerator.java
index 7367f077ad..950a08b954 100644
--- a/src/main/org/codehaus/groovy/classgen/ClassGenerator.java
+++ b/src/main/org/codehaus/groovy/classgen/ClassGenerator.java
@@ -1403,20 +1403,23 @@ public class ClassGenerator extends CodeVisitorSupport implements GroovyClassVis
                 String name = variableName;
                 Variable variable = null;
                 String variableType = expression.getType();
+                boolean useProperty = isInScriptBody();
                 if (!leftHandExpression) {
                     variable = (Variable) variableStack.get(name);
                 }
                 else {
-                    variable = defineVariable(name, variableType);
+                    if (! useProperty) {
+                        variable = defineVariable(name, variableType);
+                    }
                 }
                 if (variable == null) {
-                    variable = defineVariable(name, variableType, false);
+                    //variable = defineVariable(name, variableType, false);
                     visitPropertyExpression(new PropertyExpression(VariableExpression.THIS_EXPRESSION, name));
                     // We need to store this in a local variable now since it
                     // has been looked at in this scope and possibly
                     // compared and it hasn't been referenced before.
-                    cv.visitInsn(DUP);
-                    cv.visitVarInsn(ASTORE, variable.getIndex());
+                    //cv.visitInsn(DUP);
+                    //cv.visitVarInsn(ASTORE, variable.getIndex());
                     return;
                 }
                 String type = variable.getType();
@@ -1488,6 +1491,15 @@ public class ClassGenerator extends CodeVisitorSupport implements GroovyClassVis
         }
     }
 
+    /**
+     * @return true if we are in a script body, where all variables declared are no longer
+     * local variables but are properties
+     */
+    protected boolean isInScriptBody() {
+        String superClass = classNode.getSuperClass();
+        return superClass != null && superClass.equals("groovy.lang.Script") && methodNode != null && methodNode.getName().equals("run");
+    }
+
     protected boolean firstStatementIsSuperMethodCall(Statement code) {
         if (code instanceof BlockStatement) {
             BlockStatement block = (BlockStatement) code;
diff --git a/src/test/groovy/ShellTest.groovy b/src/test/groovy/ShellTest.groovy
new file mode 100644
index 0000000000..8f0f4a512a
--- /dev/null
+++ b/src/test/groovy/ShellTest.groovy
@@ -0,0 +1,33 @@
+class ShellTest extends GroovyTestCase {
+
+    void testReadAndWriteVariable() {
+        shell = new GroovyShell()
+        
+        shell.foo = 1
+        
+        value = shell.evaluate(<<<EOF
+println('foo is currently ' + foo)
+foo = 2 
+println('foo is now ' + foo)                
+return foo
+EOF, "Dummy1.groovy")
+
+        
+        assert value == 2
+        assert shell.foo == 2 : "Value is now ${shell.foo}"
+	}
+    
+    void testDefineNewVariable() {
+        shell = new GroovyShell()
+        
+        value = shell.evaluate( <<<EOF2
+bar = 3 
+println('bar is now ' + bar)                
+return bar
+EOF2, "Dummy2.groovy")
+
+        
+        assert value == 3
+        assert shell.bar == 3 : "Value is now ${shell.bar}"
+    }
+}
\ No newline at end of file
