diff --git a/src/main/org/codehaus/groovy/control/CompilationUnit.java b/src/main/org/codehaus/groovy/control/CompilationUnit.java
index 08e27c3d22..d3e9a93525 100644
--- a/src/main/org/codehaus/groovy/control/CompilationUnit.java
+++ b/src/main/org/codehaus/groovy/control/CompilationUnit.java
@@ -937,7 +937,7 @@ public class CompilationUnit extends ProcessingUnit {
             try {
                 ClassNode classNode = (ClassNode) classNodes.next();
                 context = classNode.getModule().getContext();
-                if (context == null || context.phase <= phase) {
+                if (context == null || context.phase < phase || (context.phase == phase && !context.phaseComplete)) {
                     body.call(context, new GeneratorContext(this.ast), classNode);
                 }
             } catch (CompilationFailedException e) {
