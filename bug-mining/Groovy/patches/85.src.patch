diff --git a/src/main/org/codehaus/groovy/ast/ClassNode.java b/src/main/org/codehaus/groovy/ast/ClassNode.java
index b42a5043bf..6458adfa11 100644
--- a/src/main/org/codehaus/groovy/ast/ClassNode.java
+++ b/src/main/org/codehaus/groovy/ast/ClassNode.java
@@ -35,6 +35,7 @@
 package org.codehaus.groovy.ast;
 
 import groovy.lang.GroovyObject;
+import groovy.lang.MissingClassException;
 import groovy.lang.Script;
 
 import java.lang.reflect.Constructor;
@@ -116,6 +117,10 @@ public class ClassNode extends MetadataNode implements Constants {
         return superClass;
     }
 
+    public void setSuperClass(String superClass) {
+        this.superClass = superClass;
+    }
+    
     public List getFields() {
         return fields;
     }
@@ -425,6 +430,13 @@ public class ClassNode extends MetadataNode implements Constants {
     public ClassNode getSuperClassNode() {
         if (superClass != null && superClassNode == null && !name.equals("java.lang.Object")) {
             // lets try find the class in the compile unit
+            String temp = resolveClassName(superClass);
+            if (temp == null) {
+                throw new MissingClassException(superClass, this, "No such superclass");
+            }
+            else {
+                superClass = temp;
+            }
             superClassNode = findClassNode(superClass);
         }
         return superClassNode;
@@ -450,6 +462,7 @@ public class ClassNode extends MetadataNode implements Constants {
                 catch (ClassNotFoundException e) {
                     // lets ignore class not found exceptions
                     log.warning("Cannot find class: " + type + " due to: " + e);
+                    e.printStackTrace();
                 }
             }
         }
diff --git a/src/main/org/codehaus/groovy/ast/ModuleNode.java b/src/main/org/codehaus/groovy/ast/ModuleNode.java
index 02238fcf5a..a31e5dff40 100644
--- a/src/main/org/codehaus/groovy/ast/ModuleNode.java
+++ b/src/main/org/codehaus/groovy/ast/ModuleNode.java
@@ -90,6 +90,10 @@ public class ModuleNode extends ASTNode implements Constants {
     public ModuleNode() {
     }
 
+    public ModuleNode(CompileUnit unit) {
+        this.unit = unit;
+    }
+
     public BlockStatement getStatementBlock() {
         return statementBlock;
     }
diff --git a/src/main/org/codehaus/groovy/ast/expr/ConstantExpression.java b/src/main/org/codehaus/groovy/ast/expr/ConstantExpression.java
index 68e248d22c..a72b91be9a 100644
--- a/src/main/org/codehaus/groovy/ast/expr/ConstantExpression.java
+++ b/src/main/org/codehaus/groovy/ast/expr/ConstantExpression.java
@@ -59,7 +59,7 @@ public class ConstantExpression extends Expression {
     public static final ConstantExpression TRUE = new ConstantExpression(Boolean.TRUE);
     public static final ConstantExpression FALSE = new ConstantExpression(Boolean.FALSE);
     public static final ConstantExpression EMPTY_STRING = new ConstantExpression("");
-    public static final Expression EMPTY_ARRAY = new PropertyExpression(new ClassExpression(ArgumentListExpression.class.getName()), "EMPTY_ARRAY");
+    //public static final Expression EMPTY_ARRAY = new PropertyExpression(new ClassExpression(ArgumentListExpression.class.getName()), "EMPTY_ARRAY");
 
     private Object value;
     
diff --git a/src/main/org/codehaus/groovy/classgen/ClassGenerator.java b/src/main/org/codehaus/groovy/classgen/ClassGenerator.java
index 5176413227..f755639182 100644
--- a/src/main/org/codehaus/groovy/classgen/ClassGenerator.java
+++ b/src/main/org/codehaus/groovy/classgen/ClassGenerator.java
@@ -248,6 +248,14 @@ public class ClassGenerator extends CodeVisitorSupport implements GroovyClassVis
             this.classNode = classNode;
             this.outermostClass = null;
             this.internalClassName = BytecodeHelper.getClassInternalName(classNode.getName());
+            
+            // lets check that the classes are all valid
+            classNode.setSuperClass(checkValidType(classNode.getSuperClass(), classNode, "Must be a valid base class"));
+            String[] interfaces = classNode.getInterfaces();
+            for (int i = 0; i < interfaces.length; i++ ) {
+                interfaces[i] = checkValidType(interfaces[i], classNode, "Must be a valid interface name");
+            }
+            
             this.internalBaseClassName = BytecodeHelper.getClassInternalName(classNode.getSuperClass());
 
             cw.visit(
diff --git a/src/main/org/codehaus/groovy/syntax/parser/ASTBuilder.java b/src/main/org/codehaus/groovy/syntax/parser/ASTBuilder.java
index 638b4dc2ca..e6a3157283 100644
--- a/src/main/org/codehaus/groovy/syntax/parser/ASTBuilder.java
+++ b/src/main/org/codehaus/groovy/syntax/parser/ASTBuilder.java
@@ -311,19 +311,30 @@ public class ASTBuilder {
         return qualifiedName;
     }
 
+    /**
+     * @todo we should actually remove all resolving code from the ASTBuilder and 
+     * move it into the verifier / analyser
+     */
     protected String resolvedQualifiedName(CSTNode nameRoot) {
         return resolveName(qualifiedName(nameRoot));
     }
 
+    /**
+     * @todo we should actually remove all resolving code from the ASTBuilder and 
+     * move it into the verifier / analyser
+     */
     protected String resolvedQualifiedNameNotNull(CSTNode child) throws ParserException {
         String answer = resolvedQualifiedName(child);
         if (answer == null) {
             return qualifiedName(child);
-            //throw new ParserException("Unknown type: " + child.getToken().getText() + " could not be resolved", child.getToken());
         }
         return answer;
     }
 
+    /**
+     * @todo we should actually remove all resolving code from the ASTBuilder and 
+     * move it into the verifier / analyser
+     */
     protected String[] qualifiedNames(CSTNode[] nameRoots) {
         String[] qualifiedNames = new String[nameRoots.length];
 
@@ -334,15 +345,19 @@ public class ASTBuilder {
         return qualifiedNames;
     }
 
-    protected String[] resolvedQualifiedNamesNotNull(CSTNode[] nameRoots) throws ParserException {
+    /**
+     * @todo we should actually remove all resolving code from the ASTBuilder and 
+     * move it into the verifier / analyser
+     */
+    protected String[] resolvedQualifiedNames(CSTNode[] nameRoots) throws ParserException {
         String[] qualifiedNames = qualifiedNames(nameRoots);
 
         for (int i = 0; i < qualifiedNames.length; ++i) {
-            qualifiedNames[i] = resolveName(qualifiedNames[i]);
-            if (qualifiedNames[i] == null) {
-                Token token = nameRoots[i].getToken();
-                throw new ParserException("Unknown type: " + token.getText() + " could not be resolved", token);
+            String name = resolveName(qualifiedNames[i]);
+            if (name == null) {
+                name = qualifiedNames[i];
             }
+            qualifiedNames[i] = name;
         }
 
         return qualifiedNames;
@@ -381,7 +396,7 @@ public class ASTBuilder {
         String[] interfaceNames = EMPTY_STRING_ARRAY;
 
         if (matches(classRoot.getChild(3), Token.KEYWORD_IMPLEMENTS)) {
-            interfaceNames = resolvedQualifiedNamesNotNull(classRoot.getChild(3).getChildren());
+            interfaceNames = resolvedQualifiedNames(classRoot.getChild(3).getChildren());
         }
 
         /** @todo parser
diff --git a/src/test/groovy/bugs/Groovy303_Bug.groovy b/src/test/groovy/bugs/Groovy303_Bug.groovy
new file mode 100644
index 0000000000..434c38cbc7
--- /dev/null
+++ b/src/test/groovy/bugs/Groovy303_Bug.groovy
@@ -0,0 +1,46 @@
+package groovy.bugs
+
+import java.awt.*
+import java.awt.event.*
+import javax.swing.*
+
+
+/**
+ * @author Bing Ran
+ * @author Andy Dwelly
+ * @version $Revision$
+ */
+class Groovy303_Bug extends GroovyTestCase {
+    
+    void testBug() {
+        try {
+			scholastic = new Scholastic()
+       		scholastic.createUI()
+       	}
+       	catch (HeadlessException e) {
+       		// called from a non-UI environment
+       	}
+    }
+}
+
+
+class Scholastic implements ActionListener {
+
+    void createUI() {
+       println('createUI called')
+       frame = new JFrame("Hello World")
+       contents = frame.getContentPane()
+       pane = new JPanel()
+       pane.setLayout(new BorderLayout())
+       button = new JButton("A button")
+       button.addActionListener(this)
+       pane.add(button, BorderLayout.CENTER)
+       contents.add(pane)
+       frame.setSize(100, 100)
+       frame.setVisible(true)
+    }
+
+    public void actionPerformed(ActionEvent event) {
+       println "hello"
+    }
+}
diff --git a/src/test/groovy/sql/SqlCompleteTest.groovy b/src/test/groovy/sql/SqlCompleteTest.groovy
index 44c1a22c51..f41501ec23 100644
--- a/src/test/groovy/sql/SqlCompleteTest.groovy
+++ b/src/test/groovy/sql/SqlCompleteTest.groovy
@@ -1,8 +1,5 @@
 package groovy.sql
 
-/** @todo bug - should not need this line */
-import groovy.sql.TestHelper
-
 class SqlCompleteTest extends TestHelper {
 
     void testSqlQuery() {
diff --git a/src/test/groovy/sql/SqlCompleteWithoutDataSourceTest.groovy b/src/test/groovy/sql/SqlCompleteWithoutDataSourceTest.groovy
index a5fba7d0a1..c6447c3821 100644
--- a/src/test/groovy/sql/SqlCompleteWithoutDataSourceTest.groovy
+++ b/src/test/groovy/sql/SqlCompleteWithoutDataSourceTest.groovy
@@ -3,9 +3,6 @@ package groovy.sql
 import org.axiondb.jdbc.AxionDriver
 import java.sql.DriverManager
 
-/** @todo bug - should not need this line */
-import groovy.sql.SqlCompleteTest
-
 /**
  * Tests the use of the Sql class using just a Connection 
  * rather than a DataSource
diff --git a/src/test/groovy/sql/SqlWithBuilderTest.groovy b/src/test/groovy/sql/SqlWithBuilderTest.groovy
index ec8a4d4cf0..3dabe28a99 100644
--- a/src/test/groovy/sql/SqlWithBuilderTest.groovy
+++ b/src/test/groovy/sql/SqlWithBuilderTest.groovy
@@ -2,9 +2,6 @@ package groovy.sql
 
 import groovy.xml.MarkupBuilder 
 
-/** @todo bug - should not need this line */
-import groovy.sql.TestHelper
-
 /**
  * @author Brian McCallister
  * @version $Revision$
diff --git a/src/test/groovy/sql/SqlWithTypedResultsTest.groovy b/src/test/groovy/sql/SqlWithTypedResultsTest.groovy
index 3d6a69e267..d7c9891a31 100644
--- a/src/test/groovy/sql/SqlWithTypedResultsTest.groovy
+++ b/src/test/groovy/sql/SqlWithTypedResultsTest.groovy
@@ -2,9 +2,6 @@ package groovy.sql
 
 import groovy.xml.MarkupBuilder 
 
-/** @todo bug - should not need this line */
-import groovy.sql.TestHelper
-
 /**
  * @author Thomas Heller
  * @version $Revision$
diff --git a/src/test/org/codehaus/groovy/classgen/TestSupport.java b/src/test/org/codehaus/groovy/classgen/TestSupport.java
index 131186df47..aa3e88ae34 100644
--- a/src/test/org/codehaus/groovy/classgen/TestSupport.java
+++ b/src/test/org/codehaus/groovy/classgen/TestSupport.java
@@ -47,6 +47,7 @@
 package org.codehaus.groovy.classgen;
 
 import groovy.lang.Binding;
+import groovy.lang.CompilerConfig;
 import groovy.lang.GroovyClassLoader;
 import groovy.lang.GroovyObject;
 import groovy.lang.Script;
@@ -63,7 +64,9 @@ import java.lang.reflect.InvocationTargetException;
 import java.lang.reflect.Method;
 
 import org.codehaus.groovy.ast.ClassNode;
+import org.codehaus.groovy.ast.CompileUnit;
 import org.codehaus.groovy.ast.FieldNode;
+import org.codehaus.groovy.ast.ModuleNode;
 import org.codehaus.groovy.ast.expr.Expression;
 import org.codehaus.groovy.ast.expr.FieldExpression;
 import org.codehaus.groovy.ast.expr.MethodCallExpression;
@@ -81,10 +84,14 @@ public class TestSupport extends GroovyTestCase implements Constants {
 
     protected static boolean DUMP_CLASS = false;
 
+    // ClassLoader parentLoader = Thread.currentThread().getContextClassLoader();
     ClassLoader parentLoader = getClass().getClassLoader();
     protected GroovyClassLoader loader = (DUMP_CLASS) ? new DumpingClassLoader(parentLoader): new GroovyClassLoader(parentLoader);
+    CompileUnit unit = new CompileUnit(parentLoader, new CompilerConfig());
+    ModuleNode module = new ModuleNode(unit);
     
     protected Class loadClass(ClassNode classNode) {
+        classNode.setModule(module);
         Class fooClass = loader.defineClass(classNode, classNode.getName() + ".groovy");
         return fooClass;
     }
