diff --git a/src/main/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java b/src/main/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java
index 9ef8b77d14..59c65552d0 100644
--- a/src/main/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java
+++ b/src/main/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java
@@ -222,6 +222,14 @@ public class StaticTypeCheckingVisitor extends ClassCodeVisitorSupport {
         alreadyVisitedMethods = oldVisitedMethod;
         classNode = oldCN;
         node.putNodeMetaData(StaticTypesMarker.INFERRED_TYPE, node);
+        // mark all methods as visited. We can't do this in visitMethod because the type checker
+        // works in a two pass sequence and we don't want to skip the second pass
+        for (MethodNode methodNode : node.getAllDeclaredMethods()) {
+            methodNode.putNodeMetaData(StaticTypeCheckingVisitor.class, Boolean.TRUE);
+        }
+        for (ConstructorNode constructorNode : node.getDeclaredConstructors()) {
+            constructorNode.putNodeMetaData(StaticTypeCheckingVisitor.class, Boolean.TRUE);
+        }
     }
 
     protected boolean shouldSkipClassNode(final ClassNode node) {
@@ -1315,8 +1323,17 @@ public class StaticTypeCheckingVisitor extends ClassCodeVisitorSupport {
         }
     }
 
+    protected boolean shouldSkipMethodNode(final MethodNode node) {
+        Object type = node.getNodeMetaData(StaticTypeCheckingVisitor.class);
+        return Boolean.TRUE.equals(type);
+    }
+
     @Override
     public void visitMethod(final MethodNode node) {
+        if (shouldSkipMethodNode(node)) {
+            // method has already been visited by a static type checking visitor
+            return;
+        }
         ErrorCollector collector = (ErrorCollector) node.getNodeMetaData(ERROR_COLLECTOR);
         if (collector!=null) {
             errorCollector.addCollectorContents(collector);
diff --git a/src/test/org/codehaus/groovy/classgen/asm/sc/BugsStaticCompileTest.groovy b/src/test/org/codehaus/groovy/classgen/asm/sc/BugsStaticCompileTest.groovy
index 400f8bd0ad..97d2f3c979 100644
--- a/src/test/org/codehaus/groovy/classgen/asm/sc/BugsStaticCompileTest.groovy
+++ b/src/test/org/codehaus/groovy/classgen/asm/sc/BugsStaticCompileTest.groovy
@@ -212,5 +212,47 @@ class BugsStaticCompileTest extends BugsSTCTest {
             new Main().test()
         '''
     }
+
+    void testCompileStaticTwiceShouldNotBeAProblem() {
+        new GroovyShell().evaluate '''import groovy.transform.CompileStatic
+        @CompileStatic
+        class Tool {
+            @CompileStatic // annotated too, even if class is already annotated
+            String relativePath(File relbase, File file) {
+                def pathParts = []
+                def currentFile = file
+                while (currentFile != null && currentFile != relbase) {
+                    pathParts += currentFile.name
+                    currentFile = currentFile.parentFile
+                }
+                pathParts.reverse().join('/')
+            }
+        }
+        File a = new File('foo')
+        File b = new File(new File(a, 'bar'), 'baz')
+        assert new Tool().relativePath(a,b) == 'bar/baz'
+        '''
+    }
+
+    void testCompileStaticTwiceShouldNotBeAProblemUsingCustomizer() {
+        assertScript '''import groovy.transform.CompileStatic
+        @CompileStatic
+        class Tool {
+            @CompileStatic // annotated too, even if class is already annotated
+            String relativePath(File relbase, File file) {
+                def pathParts = []
+                def currentFile = file
+                while (currentFile != null && currentFile != relbase) {
+                    pathParts += currentFile.name
+                    currentFile = currentFile.parentFile
+                }
+                pathParts.reverse().join('/')
+            }
+        }
+        File a = new File('foo')
+        File b = new File(new File(a, 'bar'), 'baz')
+        assert new Tool().relativePath(a,b) == 'bar/baz'
+        '''
+    }
 }
 
