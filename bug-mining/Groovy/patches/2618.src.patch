diff --git a/src/main/org/codehaus/groovy/classgen/asm/BinaryExpressionHelper.java b/src/main/org/codehaus/groovy/classgen/asm/BinaryExpressionHelper.java
index 95fc9718f6..819223602a 100644
--- a/src/main/org/codehaus/groovy/classgen/asm/BinaryExpressionHelper.java
+++ b/src/main/org/codehaus/groovy/classgen/asm/BinaryExpressionHelper.java
@@ -791,6 +791,9 @@ public class BinaryExpressionHelper {
         int mark = operandStack.getStackLength();
         boolPart.visit(controller.getAcg());
         operandStack.dup();
+        if (ClassHelper.isPrimitiveType(truePartType) && !ClassHelper.isPrimitiveType(operandStack.getTopOperand())) {
+            truePartType = ClassHelper.getWrapper(truePartType);
+        }
         int retValueId = compileStack.defineTemporaryVariable("$t", truePartType, true);
         operandStack.castToBool(mark,true);
         
diff --git a/src/test/org/codehaus/groovy/classgen/asm/sc/BugsStaticCompileTest.groovy b/src/test/org/codehaus/groovy/classgen/asm/sc/BugsStaticCompileTest.groovy
index 2fe4352327..574b7aa8c3 100644
--- a/src/test/org/codehaus/groovy/classgen/asm/sc/BugsStaticCompileTest.groovy
+++ b/src/test/org/codehaus/groovy/classgen/asm/sc/BugsStaticCompileTest.groovy
@@ -1158,5 +1158,17 @@ assert it.next() == 1G
     assert text(String) == 'java.lang.String'
     '''
     }
+
+    // GROOVY-6342
+    void testShouldNotThrowNPEIfElvisOperatorIsUsedInsideTernary() {
+        assertScript '''class Inner {
+    int somestuff
+}
+Inner inner = null
+int someInt = inner?.somestuff ?: 0
+println someInt
+
+'''
+    }
 }
 
