diff --git a/subprojects/groovy-xml/src/main/groovy/groovy/xml/StreamingMarkupBuilder.groovy b/subprojects/groovy-xml/src/main/groovy/groovy/xml/StreamingMarkupBuilder.groovy
index e5c8ad3958..28a7abb4ba 100644
--- a/subprojects/groovy-xml/src/main/groovy/groovy/xml/StreamingMarkupBuilder.groovy
+++ b/subprojects/groovy-xml/src/main/groovy/groovy/xml/StreamingMarkupBuilder.groovy
@@ -1,5 +1,5 @@
 /*
- * Copyright 2003-2011 the original author or authors.
+ * Copyright 2003-2013 the original author or authors.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -136,9 +136,9 @@ class StreamingMarkupBuilder extends AbstractStreamingBuilder {
         attrs.each {key, value ->
             if (key.contains('$')) {
                 def parts = key.tokenize('$')
-
+                String localpart = parts[1].contains("}") ? parts[1].tokenize("}")[1] : parts[1]
                 if (namespaces.containsKey(parts[0]) || pendingNamespaces.containsKey(parts[0])) {
-                    key = parts[0] + ":" + parts[1]
+                    key = parts[0] + ":" + localpart
                 } else {
                     throw new GroovyRuntimeException("bad attribute namespace tag: ${parts[0]} in ${key}")
                 }
diff --git a/subprojects/groovy-xml/src/test/groovy/groovy/xml/StreamingMarkupBuilderTest.groovy b/subprojects/groovy-xml/src/test/groovy/groovy/xml/StreamingMarkupBuilderTest.groovy
index 3d62141962..320ff817ed 100644
--- a/subprojects/groovy-xml/src/test/groovy/groovy/xml/StreamingMarkupBuilderTest.groovy
+++ b/subprojects/groovy-xml/src/test/groovy/groovy/xml/StreamingMarkupBuilderTest.groovy
@@ -1,5 +1,5 @@
 /*
- * Copyright 2003-2009 the original author or authors.
+ * Copyright 2003-2013 the original author or authors.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -25,6 +25,14 @@ package groovy.xml
  */
 class StreamingMarkupBuilderTest extends BuilderTestSupport {
 
+    void testAttributesAndNamespaces() {
+        def xml = '''<?xml version="1.0" encoding="UTF-8"?>
+        <grammar xml:lang="en-us" xmlns="http://www.w3.org/2001/06/grammar"/>'''
+        def grammar = new XmlSlurper().parseText(xml)
+        def smb = new StreamingMarkupBuilder()
+        assert smb.bindNode(grammar).toString().contains("xml:lang='en-us'")
+    }
+
     protected assertExpectedXml(Closure markup, String expectedXml) {
         assertExpectedXml markup, null, expectedXml
     }
