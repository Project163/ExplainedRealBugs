diff --git a/src/main/org/codehaus/groovy/classgen/AsmClassGenerator.java b/src/main/org/codehaus/groovy/classgen/AsmClassGenerator.java
index 82365657de..f3e7ddf6a1 100644
--- a/src/main/org/codehaus/groovy/classgen/AsmClassGenerator.java
+++ b/src/main/org/codehaus/groovy/classgen/AsmClassGenerator.java
@@ -805,7 +805,10 @@ public class AsmClassGenerator extends ClassGenerator {
 
         statement.getExpression().visit(this);
 
-        pushBlockScope();
+        // switch does not have a continue label. use its parent's for continue
+        pushBlockScope(false, true);
+        scope.setContinueLabel(scope.getParent().getContinueLabel());
+
 
         int switchVariableIndex = defineVariable(createVariableName("switch"), "java.lang.Object").getIndex();
         cv.visitVarInsn(ASTORE, switchVariableIndex);
@@ -3086,8 +3089,15 @@ public class AsmClassGenerator extends ClassGenerator {
         scope = scope.getParent();
     }
 
+
     protected void pushBlockScope() {
+        pushBlockScope(true, true);
+    }
+
+    protected void pushBlockScope(boolean canContinue, boolean canBreak) {
         scope = new BlockScope(scope);
+        scope.setContinueLabel(canContinue ? new Label() : null);
+        scope.setBreakLabel(canBreak? new Label() : null);
         scope.setLastVariableIndex(getNextVariableID());
     }
 
@@ -3124,7 +3134,7 @@ public class AsmClassGenerator extends ClassGenerator {
                 else {
                     // using new variable inside a comparison expression
                     // so lets initialize it too
-                    if (answer.isHolder() /*&& !isInScriptBody()*/) { // br doesn't seem to need different treatment, in script or not
+                    if (answer.isHolder() && !isInScriptBody()) { // br doesn't seem to need different treatment, in script or not
                         //cv.visitVarInsn(ASTORE, lastVariableIndex + 1); // I might need this to set the reference value
 
                         cv.visitTypeInsn(NEW, "groovy/lang/Reference");
diff --git a/src/main/org/codehaus/groovy/classgen/BlockScope.java b/src/main/org/codehaus/groovy/classgen/BlockScope.java
index 8123d904b1..fb4bb450f8 100644
--- a/src/main/org/codehaus/groovy/classgen/BlockScope.java
+++ b/src/main/org/codehaus/groovy/classgen/BlockScope.java
@@ -55,8 +55,12 @@ import org.objectweb.asm.Label;
  */
 public class BlockScope {
 
-    private Label breakLabel = new Label();
-    private Label continueLabel = new Label();
+
+    // new scopes for methods do not have continue and break labels
+    // for, while, dowhile need to explicitly set the lables
+	// switch can break but not continue
+    private Label breakLabel = null; //new Label();
+    private Label continueLabel = null; //new Label();
     private BlockScope parent;
     private int lastVariableIndex;
     
@@ -76,6 +80,10 @@ public class BlockScope {
         return breakLabel;
     }
 
+    public void setBreakLabel(Label breakLabel) {
+            this.breakLabel = breakLabel;
+        }
+
     public BlockScope getParent() {
         return parent;
     }
diff --git a/src/test/groovy/SwitchTest.groovy b/src/test/groovy/SwitchTest.groovy
index ea19193f1b..52b6cf8c0b 100644
--- a/src/test/groovy/SwitchTest.groovy
+++ b/src/test/groovy/SwitchTest.groovy
@@ -51,5 +51,25 @@ class SwitchTest extends GroovyTestCase {
         
         assert result == expected : "when calling switch with ${x}"
     }
+
+    // test the continue in switch, which should jump to the the while start
+    void testSwitchScope() {
+        i = 0
+        j = 0
+        while (true) {
+            i++;
+            switch(i) {
+                case 4:
+                    continue
+                case 5:
+                    break;
+                default:
+                    j += i;
+                    break;
+            }
+            if (i == 5) break;
+        }
+        assert j == 6
+    }
     
 }
