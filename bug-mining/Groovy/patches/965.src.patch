diff --git a/build.xml b/build.xml
index 89291338a4..875b8b0ce3 100644
--- a/build.xml
+++ b/build.xml
@@ -466,7 +466,7 @@ $Date$
     <target name="-includeGroovyDocTemplates">
         <copy todir="${mainClassesDirectory}">
             <fileset dir="${mainSourceDirectory}">
-                <include name="org/codehaus/groovy/tools/groovydoc/gstring-templates/**/*.*"/>
+                <include name="org/codehaus/groovy/tools/groovydoc/gstringTemplates/**/*.*"/>
             </fileset>
             <fileset dir="${toolsSourceDirectory}">
                 <include name="org/codehaus/groovy/tools/groovy.ico"/>
diff --git a/src/main/org/codehaus/groovy/ant/Groovydoc.java b/src/main/org/codehaus/groovy/ant/Groovydoc.java
index cdad32e5d6..a3abf6bf28 100644
--- a/src/main/org/codehaus/groovy/ant/Groovydoc.java
+++ b/src/main/org/codehaus/groovy/ant/Groovydoc.java
@@ -36,7 +36,7 @@ import java.util.*;
  * @version $Id$
  */
 public class Groovydoc extends Task {
-    private static final String TEMPLATE_BASEDIR = "org/codehaus/groovy/tools/groovydoc/gstring-templates/";
+    private static final String TEMPLATE_BASEDIR = "org/codehaus/groovy/tools/groovydoc/gstringTemplates/";
     private static final String DOCGEN_BASEDIR = "org/codehaus/groovy/tools/";
     private final LoggingHelper log = new LoggingHelper(this);
 
@@ -345,23 +345,23 @@ public class Groovydoc extends Task {
                 new ClasspathResourceManager(), // we're gonna get the default templates out of the dist jar file
                 sourcePath.list(), // sourcepaths
                 new String[]{ // top level templates
-                        TEMPLATE_BASEDIR + "top-level/index.html",
-                        TEMPLATE_BASEDIR + "top-level/overview-frame.html", // needs all package names
-                        TEMPLATE_BASEDIR + "top-level/allclasses-frame.html", // needs all packages / class names
-                        TEMPLATE_BASEDIR + "top-level/overview-summary.html", // needs all packages
-                        TEMPLATE_BASEDIR + "top-level/help-doc.html",
-                        TEMPLATE_BASEDIR + "top-level/index-all.html",
-                        TEMPLATE_BASEDIR + "top-level/deprecated-list.html",
-                        TEMPLATE_BASEDIR + "top-level/stylesheet.css",
-                        TEMPLATE_BASEDIR + "top-level/inherit.gif",
+                        TEMPLATE_BASEDIR + "topLevel/index.html",
+                        TEMPLATE_BASEDIR + "topLevel/overview-frame.html", // needs all package names
+                        TEMPLATE_BASEDIR + "topLevel/allclasses-frame.html", // needs all packages / class names
+                        TEMPLATE_BASEDIR + "topLevel/overview-summary.html", // needs all packages
+                        TEMPLATE_BASEDIR + "topLevel/help-doc.html",
+                        TEMPLATE_BASEDIR + "topLevel/index-all.html",
+                        TEMPLATE_BASEDIR + "topLevel/deprecated-list.html",
+                        TEMPLATE_BASEDIR + "topLevel/stylesheet.css",
+                        TEMPLATE_BASEDIR + "topLevel/inherit.gif",
                         DOCGEN_BASEDIR + "groovy.ico",
                 },
                 new String[]{ // package level templates
-                        TEMPLATE_BASEDIR + "package-level/package-frame.html",
-                        TEMPLATE_BASEDIR + "package-level/package-summary.html"
+                        TEMPLATE_BASEDIR + "packageLevel/package-frame.html",
+                        TEMPLATE_BASEDIR + "packageLevel/package-summary.html"
                 },
                 new String[]{ // class level templates
-                        TEMPLATE_BASEDIR + "class-level/classDocName.html"
+                        TEMPLATE_BASEDIR + "classLevel/classDocName.html"
                 },
                 links,
                 properties
diff --git a/src/main/org/codehaus/groovy/reflection/ClassInfo.java b/src/main/org/codehaus/groovy/reflection/ClassInfo.java
index da2e70db11..94b5d08669 100644
--- a/src/main/org/codehaus/groovy/reflection/ClassInfo.java
+++ b/src/main/org/codehaus/groovy/reflection/ClassInfo.java
@@ -28,6 +28,7 @@ import org.codehaus.groovy.util.ManagedConcurrentMap;
 import org.codehaus.groovy.util.ManagedReference;
 import org.codehaus.groovy.util.ReferenceBundle;
 
+import java.lang.ref.WeakReference;
 import java.math.BigDecimal;
 import java.math.BigInteger;
 import java.util.HashMap;
@@ -59,6 +60,7 @@ public class ClassInfo extends ManagedConcurrentMap.Entry<Class,ClassInfo> {
     private ManagedConcurrentMap perInstanceMetaClassMap;
     
     private static ReferenceBundle softBundle = ReferenceBundle.getSoftBundle();
+    private static ReferenceBundle weakBundle = ReferenceBundle.getWeakBundle();
     private static final ClassInfoSet globalClassSet = new ClassInfoSet(softBundle);
 
     ClassInfo(ManagedConcurrentMap.Segment segment, Class klazz, int hash) {
@@ -101,7 +103,9 @@ public class ClassInfo extends ManagedConcurrentMap.Entry<Class,ClassInfo> {
     }
 
     public static ClassInfo getClassInfo (Class cls) {
-        return localMap.get().get(cls);
+        ThreadLocalMapHandler handler = localMapRef.get();
+        if (handler!=null) return handler.get().get(cls);
+        return (ClassInfo) globalClassSet.getOrPut(cls,null);
     }
 
     public MetaClass getStrongMetaClass() {
@@ -365,9 +369,9 @@ public class ClassInfo extends ManagedConcurrentMap.Entry<Class,ClassInfo> {
         }
     }
 
-    private static final ThreadLocal<LocalMap> localMap = new ThreadLocal<LocalMap> () {
+    private static class ThreadLocalMapHandler extends ThreadLocal<LocalMap> {
         LocalMap recentThreadMap;
-
+        
         protected LocalMap initialValue() {
             return new LocalMap();
         }
@@ -382,7 +386,13 @@ public class ClassInfo extends ManagedConcurrentMap.Entry<Class,ClassInfo> {
                 return res;
             }
         }
-    };
+    }
+    
+    private static final WeakReference<ThreadLocalMapHandler> localMapRef;
+    static {
+        ThreadLocalMapHandler localMap = new ThreadLocalMapHandler();
+        localMapRef = new WeakReference<ThreadLocalMapHandler>(localMap,null);
+    }
 
     private static class LazyCachedClassRef extends LazyReference<CachedClass> {
         private final ClassInfo info;
diff --git a/src/main/org/codehaus/groovy/runtime/callsite/AbstractCallSite.java b/src/main/org/codehaus/groovy/runtime/callsite/AbstractCallSite.java
index 0f0cd5de99..61c31c07ae 100644
--- a/src/main/org/codehaus/groovy/runtime/callsite/AbstractCallSite.java
+++ b/src/main/org/codehaus/groovy/runtime/callsite/AbstractCallSite.java
@@ -307,12 +307,7 @@ public class AbstractCallSite implements CallSite {
     }
 
     private CallSite createPogoMetaClassGetPropertySite(GroovyObject receiver) {
-        final MetaClass metaClass = receiver.getMetaClass();
-
-        if (metaClass.getTheClass() != receiver.getClass()) {
-            // It happens when object was proxied, for example by Hibernate
-            return new PogoGetPropertySite(this, metaClass.getTheClass());
-        }
+        MetaClass metaClass = receiver.getMetaClass();
 
         CallSite site;
         if (metaClass.getClass() != MetaClassImpl.class || GroovyCategorySupport.hasCategoryInCurrentThread()) {
diff --git a/src/main/org/codehaus/groovy/runtime/callsite/CallSiteArray.java b/src/main/org/codehaus/groovy/runtime/callsite/CallSiteArray.java
index 70e3203f1d..3104c72f3b 100644
--- a/src/main/org/codehaus/groovy/runtime/callsite/CallSiteArray.java
+++ b/src/main/org/codehaus/groovy/runtime/callsite/CallSiteArray.java
@@ -15,14 +15,11 @@
  */
 package org.codehaus.groovy.runtime.callsite;
 
-import groovy.lang.GroovyRuntimeException;
 import groovy.lang.MetaClass;
 import groovy.lang.MetaClassImpl;
 import groovy.lang.GroovyInterceptable;
 import groovy.lang.GroovyObject;
 import org.codehaus.groovy.runtime.InvokerHelper;
-import org.codehaus.groovy.runtime.NullObject;
-import org.codehaus.groovy.runtime.ScriptBytecodeAdapter;
 import org.codehaus.groovy.reflection.ClassInfo;
 
 public final class CallSiteArray {
@@ -130,8 +127,6 @@ public final class CallSiteArray {
           return new PogoInterceptableSite(callSite);
 
         MetaClass metaClass = ((GroovyObject)receiver).getMetaClass();
-        if (receiver.getClass() != metaClass.getTheClass() && !metaClass.getTheClass().isInterface())
-            return new PogoInterceptableSite(callSite);
 
         if (metaClass instanceof MetaClassImpl) {
             return ((MetaClassImpl)metaClass).createPogoCallSite(callSite, args);
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/classLevel/classDocName.html b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/classLevel/classDocName.html
new file mode 100644
index 0000000000..4566b8d2c9
--- /dev/null
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/classLevel/classDocName.html
@@ -0,0 +1,626 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
+<!-- **************************************************************** -->
+<!-- *  PLEASE KEEP COMPLICATED EXPRESSIONS OUT OF THESE TEMPLATES, * -->
+<!-- *  i.e. only iterate & print data where possible. Thanks, Jez. * -->
+<!-- **************************************************************** -->
+<%
+    def title = classDoc.name() + (props.docTitle ? " (${props.docTitle})" : "")
+    def visibleFields = classDoc.fields().findAll{ !it.isPrivate() || props.privateScope }
+    def visibleProperties = classDoc.properties().findAll{ !it.isPrivate() || props.privateScope }
+    boolean hasFields = !classDoc.isAnnotationType() && visibleFields.size() > 0
+    boolean hasProperties = !classDoc.isAnnotationType() && visibleProperties.size() > 0
+    boolean hasElements = classDoc.isAnnotationType() && visibleFields.size() > 0
+    boolean hasConstructors = classDoc.constructors().size() > 0
+    boolean hasNested = classDoc.innerClasses().size() > 0
+    def visibleMethods = classDoc.methods().findAll{ !it.isPrivate() || props.privateScope }
+    boolean hasMethods = visibleMethods.size() > 0
+    boolean methodSummaryShown = hasMethods
+    boolean fieldSummaryShown = hasFields
+    boolean hasEnumConstants = classDoc.enumConstants().size() > 0
+    def dolink = { t, boolean b ->
+        if (!t || t instanceof String) {
+            return classDoc.getDocUrl(t, b)
+        }
+        if (t instanceof org.codehaus.groovy.tools.groovydoc.SimpleGroovyClassDoc) {
+            return "<a href='" + classDoc.relativeRootPath + t.fullPathName + ".html'>" + (b ? t.qualifiedTypeName() : t.name()) + "</a>"
+        }
+        return classDoc.getDocUrl(t.qualifiedTypeName(), b)
+    }
+    def linkfull = { t -> dolink(t, true) }
+    def linkable = { t -> dolink(t, false) }
+    def modifiers = { t ->
+        (t.isPrivate()?"private&nbsp;":"") +
+        (t.isPublic()?"public&nbsp;":"") +
+        (t.isProtected()?"protected&nbsp;":"") +
+        (t.isStatic()?"static&nbsp;":"") +
+        (t.isFinal()?"final&nbsp;":"") +
+        (t.respondsTo('isAbstract') && t.isAbstract()?"abstract&nbsp;":"")
+    }
+    def modifiersBrief = { t ->
+        (t.isPrivate()?"private&nbsp;":"") +
+        (t.isProtected()?"protected&nbsp;":"") +
+        (t.isStatic()?"static&nbsp;":"")
+    }
+    def annotations = { t, sepChar -> t.annotations() ? t.annotations()*.description().join(sepChar) + sepChar : '' }
+    def isVisible = { t -> java.lang.reflect.Modifier.isPublic(t.modifiers) || java.lang.reflect.Modifier.isProtected(t.modifiers) }
+    def elementTypes = [
+        "required":"true",
+        "optional":"false"
+    ]
+    def isRequired = { f, v -> def req = f.constantValueExpression() == null; req.toString() == v }
+    def upcase = { n -> n[0].toUpperCase() + n[1..-1] }
+    def paramsOf = { n, boolean brief -> n.parameters().collect{ param -> (brief?'':annotations(param, ' ')) + linkable(param.isTypeAvailable()?param.type():param.typeName()) + ' ' + param.name() + (param.defaultValue() ? " = " + param.defaultValue():"") }.join(", ") }
+    def nameFromParams = { n -> n.name() + '(' + n.parameters().collect{ param -> param.isTypeAvailable()?param.type().qualifiedTypeName():param.typeName() }.join(', ') + ')' }
+%>
+<html>
+<head>
+<!-- Generated by groovydoc (${org.codehaus.groovy.runtime.InvokerHelper.version}) on ${new Date()} -->
+<title>${title}</title>
+<meta name="date" content="${new Date().format('yyyy-MM-dd')}">
+<link href="${classDoc.relativeRootPath}groovy.ico" type="image/x-icon" rel="shortcut icon">
+<link href="${classDoc.relativeRootPath}groovy.ico" type="image/x-icon" rel="icon">
+<link rel="stylesheet" type="text/css" href="${classDoc.relativeRootPath}stylesheet.css" title="Style">
+<script type="text/javascript">
+function windowTitle()
+{
+    if (location.href.indexOf('is-external=true') == -1) {
+        parent.document.title="${title}";
+    }
+}
+</script>
+<noscript>
+</noscript>
+
+</head><body onload="windowTitle();" bgcolor="white">
+<hr>
+
+<!-- ========= START OF TOP NAVBAR ======= -->
+<A NAME="navbar_top"><!-- --></A>
+<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
+<TR>
+<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
+<A NAME="navbar_top_firstrow"><!-- --></A>
+<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
+  <TR ALIGN="center" VALIGN="top">
+  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="${classDoc.relativeRootPath}overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
+
+  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
+  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
+  <!--<TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
+  -->
+  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="${classDoc.relativeRootPath}deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
+  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="${classDoc.relativeRootPath}index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
+  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="${classDoc.relativeRootPath}help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
+  </TR>
+</TABLE>
+</TD>
+<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
+<% if (props.header) { %><b>${props.header}</b><% } %>
+</EM></TD>
+</TR>
+
+<TR>
+<TD BGCOLOR="white" CLASS="NavBarCell2"><!--<FONT SIZE="-2">
+&nbsp;<A HREF="${classDoc.relativeRootPath}groovy/lang/ExpandoMetaClass.ExpandoMetaProperty.html" title="class in groovy.lang"><B>PREV CLASS</B></A>&nbsp;
+
+&nbsp;<A HREF="${classDoc.relativeRootPath}groovy/lang/GroovyClassLoader.html" title="class in groovy.lang"><B>NEXT CLASS</B></A></FONT>--></TD>
+<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
+  <A HREF="${classDoc.relativeRootPath}index.html?${classDoc.fullPathName}.html" target="_top"><B>FRAMES</B></A>  &nbsp;
+&nbsp;<A HREF="${classDoc.name()}.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
+&nbsp;<script type="text/javascript">
+  <!--
+  if(window==top) {
+    document.writeln('<A HREF="${classDoc.relativeRootPath}allclasses-frame.html"><B>All Classes</B></A>');
+  }
+  //-->
+</script>
+<noscript>
+  <A HREF="${classDoc.relativeRootPath}allclasses-frame.html"><B>All Classes</B></A>
+</noscript>
+
+</FONT></TD>
+
+</TR>
+<TR>
+<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
+SUMMARY:&nbsp;<%
+    if (classDoc.isAnnotationType()) {
+        def hasReq = classDoc.fields().any{ isRequired(it, "true") }
+        def hasOpt = classDoc.fields().any{ isRequired(it, "false") }
+        %><% if (hasReq) { %><A HREF="#required_element_summary"><% } %>REQUIRED<% if (hasReq) { %></A><% }
+        %> | <% if (hasOpt) { %><A HREF="#optional_element_summary"><% } %>OPTIONAL<% if (hasOpt) { %></A><% } %><%
+    } else {
+        if (hasNested) { %><A HREF="#nested_summary"><% } %>NESTED<% if (hasNested) { %></A><% }
+        if (classDoc.isEnum()) {
+            %>&nbsp;|&nbsp;<% if (hasEnumConstants) { %><A HREF="#enum_constant_summary"><% } %>ENUM CONSTANTS<% if (hasEnumConstants) { %></A><% }
+        }
+        %>&nbsp;|&nbsp;<% if (hasFields) { %><A HREF="#field_summary"><% } %>FIELD<% if (hasFields) { %></A><% }
+        if (hasProperties) { %>&nbsp;|&nbsp;<A HREF="#property_summary">PROPERTY</A><% }
+        if (classDoc.isClass()) {
+            %>&nbsp;|&nbsp;<% if (hasConstructors) { %><A HREF="#constructor_summary"><% } %>CONSTR<% if (hasConstructors) { %></A><% }
+        }
+        %>&nbsp;|&nbsp;<% if (hasMethods) { %><A HREF="#method_summary"><% } %>METHOD<% if (hasMethods) { %></A><% }
+    }
+    %></FONT></TD>
+<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
+DETAIL:&nbsp;<%
+    if (classDoc.isAnnotationType()) {
+        if (hasElements) { %><A HREF="#element_detail"><% } %>ELEMENT<% if (hasElements) { %></A><% }
+    } else {
+        if (classDoc.isEnum()) {
+            if (hasEnumConstants) { %><A HREF="#enum_constant_detail"><% } %>ENUM CONSTANTS<% if (hasEnumConstants) { %></A>&nbsp;|&nbsp;<% }
+        }
+        if (hasFields) { %><A HREF="#field_detail"><% } %>FIELD<% if (hasFields) { %></A><% }
+        if (hasProperties) { %>&nbsp;|&nbsp;<A HREF="#prop_detail">PROPERTY</A><% }
+        if (classDoc.isClass()) {
+            %>&nbsp;|&nbsp;<% if (hasConstructors) { %><A HREF="#constructor_detail"><% } %>CONSTR<% if (hasConstructors) { %></A><% }
+        }
+        %>&nbsp;|&nbsp;<% if (hasMethods) { %><A HREF="#method_detail"><% } %>METHOD<% if (hasMethods) { %></A><% }
+    }
+    %></FONT></TD>
+</TR>
+</TABLE>
+<!-- ========= END OF TOP NAVBAR ========= -->
+
+
+<HR>
+<!-- ======== START OF CLASS DATA ======== -->
+<H2>
+<FONT SIZE="-1">
+${classDoc.containingPackage().nameWithDots()}</FONT>
+<BR>
+<FONT CLASS="ClassTitleFont">${classDoc.typeDescription} ${classDoc.name()}</FONT></H2>
+<%
+def parents = classDoc.isInterface() ? classDoc.parentInterfaces : classDoc.parentClasses
+if (parents.size() >= 2) {
+    %><pre><%
+    parents.eachWithIndex { p, i ->
+        %>${(i > 0 ? "  " * i + "  " * (i - 1) + "<img src='" + classDoc.relativeRootPath + "inherit.gif'>" : "") + ( i == parents.size() - 1 ? p.qualifiedTypeName() : linkfull(p))}\n<%
+    }
+    %></pre><%
+}
+if (classDoc.isInterface()) {
+    Set interfaces = classDoc.parentInterfaces
+    interfaces -= classDoc
+    if (interfaces) {
+        %><dl><dt><b>All Superinterfaces:</b> </dt><dd>${interfaces.collect{ linkable(it) }.join(', ')}</dd></dl><%
+    }
+} else {
+    // TODO follow up the tree collecting interfaces seen?
+    def interfaces = classDoc.interfaces()
+    if (interfaces) {
+        %><dl><dt><b>All Implemented Interfaces:</b> </dt><dd>${interfaces.collect{ linkable(it) }.join(', ')}</dd></dl><%
+    }
+}
+%><hr>
+<PRE>${annotations(classDoc, '\n') + modifiers(classDoc) + classDoc.typeSourceDescription + ' ' + classDoc.name()}
+<% if (classDoc.isInterface() && classDoc.interfaces()) {
+%>extends ${classDoc.interfaces().collect{ linkable(it) }.join(', ')}
+<% } else if (classDoc.superclass()) {
+%>extends ${linkable(classDoc.superclass())}
+<% } %>
+</PRE>
+<% if (classDoc.commentText()) { %>
+<P>
+${classDoc.commentText()}
+</P>
+<hr>
+<% } %>
+
+<!-- =========== NESTED CLASS SUMMARY =========== -->
+
+<A NAME="nested_summary"><!-- --></A>
+<% if (hasNested) { %>
+    <TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
+    <TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
+    <TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
+    <B>Nested Class Summary</B></FONT></TH>
+    </TR>
+    <% for (c in classDoc.innerClasses()) { %>
+        <TR BGCOLOR="white" CLASS="TableRowColor">
+        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
+        <CODE>${modifiersBrief(c) + c.typeSourceDescription}</CODE></FONT></TD>
+        <TD>
+            <CODE>${linkable(c)}</CODE>
+            <BR>
+            <P>${c.firstSentenceCommentText()}</P>
+        </TD>
+        </TR>
+    <% } %>
+    </TABLE>
+    &nbsp;
+<% } %>
+
+<!-- =========== ENUM CONSTANT SUMMARY =========== -->
+
+<A NAME="enum_constant_summary"><!-- --></A>
+<% if (hasEnumConstants) { %>
+    <TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
+    <TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
+    <TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
+    <B>Enum Constant Summary</B></FONT></TH>
+    </TR>
+    <% for (ec in classDoc.enumConstants()) { %>
+        <TR BGCOLOR="white" CLASS="TableRowColor">
+        <TD>
+            <CODE><B><A HREF="#${ec.name()}">${ec.name()}</A></B></CODE>
+            <BR>
+            <P>${ec.firstSentenceCommentText()}</P>
+        </TD>
+        </TR>
+    <% } %>
+    </TABLE>
+    &nbsp;
+<% } %>
+
+<!-- =========== FIELD SUMMARY =========== -->
+
+<A NAME="field_summary"><!-- --></A>
+<% if (hasFields) { %>
+    <TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
+    <TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
+    <TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
+    <B>Field Summary</B></FONT></TH>
+    </TR>
+    <% for (field in visibleFields) { %>
+        <TR BGCOLOR="white" CLASS="TableRowColor">
+        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
+        <CODE>${modifiersBrief(field) + linkable(field.type())}</CODE></FONT></TD>
+        <TD>
+            <CODE><B><A HREF="#${field.name()}">${field.name()}</A></B></CODE>
+            <BR>
+            <P>${field.firstSentenceCommentText()}</P>
+        </TD>
+        </TR>
+    <% } %>
+    </TABLE>
+    &nbsp;
+<% }
+    classes = []
+    if (classDoc.isInterface()) {
+        classes.addAll(classDoc.interfaces().toList())
+    } else {
+        if (classDoc.superclass()) classes += classDoc.superclass()
+        else classes += new org.codehaus.groovy.tools.groovydoc.ExternalGroovyClassDoc(Object.class)
+    }
+    visited = [classDoc] as Set
+    while (classes) {
+        Set nextLevel = []
+        classes.each { c ->
+            if (c.isInterface()) nextLevel.addAll(c.interfaces().toList())
+            else if (c.superclass() && c.qualifiedTypeName() != 'java.lang.Object') nextLevel += c.superclass()
+            nextLevel -= visited
+            visited += nextLevel
+            def list = []
+            if (c instanceof org.codehaus.groovy.tools.groovydoc.SimpleGroovyClassDoc) {
+                list = c.fields().findAll{ it.isPublic() || it.isProtected() }.collect { field ->
+                    "<a href='${classDoc.relativeRootPath}${c.fullPathName}.html#${field.name()}'>${field.name()}</a>"
+                }
+            } else {
+                list = c.externalClass().fields.findAll{ isVisible(it) }.collect { field ->
+                    // "<a href='${classDoc.relativeRootPath}${c.fullPathName}.html#${field.name()}'>${field.name()}</a>"
+                    field.name
+                }
+            }
+            if (list) {
+                if (!fieldSummaryShown) {
+                    fieldSummaryShown = true
+                    %><table BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
+                    <TR CLASS="TableHeadingColor">
+                    <TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2" CLASS="ClassHeadingFont">
+                    <B>Field Summary</B></FONT></TH>
+                    </TR>
+                    </table>
+                    &nbsp;<%
+                }
+                %><table BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
+                <tr CLASS="TableSubHeadingColor"><th ALIGN="left" COLSPAN="2">
+                <b>Fields inherited from ${c.typeSourceDescription} ${linkable(c)}</b>
+                </th></tr>
+                <tr class="TableRowColor"><td colspan='2'>${list.join(', ')}</td></tr>
+                </table>
+                &nbsp;<%
+            }
+        }
+        classes = nextLevel
+    }
+%>
+
+<!-- =========== PROPERTY SUMMARY =========== -->
+
+<A NAME="property_summary"><!-- --></A>
+<% if (hasProperties) { %>
+    <TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
+    <TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
+    <TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
+    <B>Property Summary</B></FONT></TH>
+    </TR>
+    <% for (prop in visibleProperties) { %>
+        <TR BGCOLOR="white" CLASS="TableRowColor">
+        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
+        <CODE>${modifiersBrief(prop) + linkable(prop.type())}</CODE></FONT></TD>
+        <TD>
+            <CODE><B><A HREF="#${prop.name()}">${prop.name()}</A></B></CODE>
+            <BR>
+            <P>${prop.firstSentenceCommentText()}</P>
+        </TD>
+        </TR>
+    <% } %>
+    </TABLE>
+    &nbsp;
+<% } %>
+
+<!-- =========== ELEMENT SUMMARY =========== -->
+
+<% if (hasElements) { %>
+    <% elementTypes.each { k, v -> %>
+        <A NAME="${k}_element_summary"><!-- --></A>
+        <% if (visibleFields.any{ isRequired(it, v) }) {  %>
+            <TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
+            <TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
+            <TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
+            <B>${upcase(k)} Element Summary</B></FONT></TH>
+            </TR>
+            <% for (element in visibleFields) { %>
+                <% if (isRequired(element, v)) { %>
+                <TR BGCOLOR="white" CLASS="TableRowColor">
+                <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
+                <CODE>${modifiersBrief(element) + element.type().typeName()}</CODE></FONT></TD>
+                <TD>
+                    <CODE><B><A HREF="#${element.name()}">${element.name()}</A></B></CODE>
+                    <BR>
+                    <P>${element.firstSentenceCommentText()}</P>
+                </TD>
+                </TR>
+                <% } %>
+            <% } %>
+            </TABLE>
+        <% } %>
+        &nbsp;
+    <% } %>
+<% } %>
+
+<!-- ======== CONSTRUCTOR SUMMARY ======== -->
+
+<A NAME="constructor_summary"><!-- --></A>
+<% if (hasConstructors) { %>
+    <TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
+    <TR BGCOLOR="#D5D5FF" CLASS="TableHeadingColor">
+    <TD COLSPAN=2><FONT SIZE="+2">
+    <B>Constructor Summary</B></FONT></TD>
+    </TR>
+    <% for (constructor in classDoc.constructors()) { %>
+        <TR BGCOLOR="white" CLASS="TableRowColor">
+        <TD>
+            <CODE>${modifiersBrief(constructor)}<B><a href="#${nameFromParams(constructor)}">${constructor.name()}</a></B>(${paramsOf(constructor, true)})</CODE>
+            <BR>
+            <P>${constructor.firstSentenceCommentText()}</P>
+        </TD>
+        </TR>
+    <% } %>
+    </TABLE>
+    &nbsp;
+<% } %>
+
+<!-- ========== METHOD SUMMARY =========== -->
+
+<A NAME="method_summary"><!-- --></A>
+<% if (hasMethods) { %>
+    <TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
+    <TR CLASS="TableHeadingColor">
+    <TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2" CLASS="ClassHeadingFont">
+    <B>Method Summary</B></FONT></TH>
+    </TR>
+    <% for (method in visibleMethods) { %>
+        <TR BGCOLOR="white" CLASS="TableRowColor">
+        <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1" CLASS="ClassItemFont">
+            <CODE>${modifiersBrief(method)}${linkable(method.returnType())}</CODE></FONT>
+        </TD>
+        <TD>
+            <CODE><b><a href="#${nameFromParams(method)}">${method.name()}</a></b>(${paramsOf(method, true)})</CODE>
+            <BR>
+            <P>${method.firstSentenceCommentText()}</P>
+        </TD>
+        </TR>
+    <% } %>
+    </TABLE>
+    &nbsp;
+<% }
+    Set classes = []
+    if (classDoc.isInterface()) {
+        classes.addAll(classDoc.interfaces().toList())
+    } else {
+        if (classDoc.superclass()) classes += classDoc.superclass()
+        else classes += new org.codehaus.groovy.tools.groovydoc.ExternalGroovyClassDoc(Object.class)
+    }
+    Set visited = [classDoc] as Set
+    while (classes) {
+        Set nextLevel = []
+        classes.each { c ->
+            if (c.isInterface()) nextLevel.addAll(c.interfaces().toList())
+            else if (c.superclass() && c.qualifiedTypeName() != 'java.lang.Object') nextLevel += c.superclass()
+            nextLevel -= visited
+            visited += nextLevel
+            def list = []
+            if (c instanceof org.codehaus.groovy.tools.groovydoc.SimpleGroovyClassDoc) {
+                list = c.methods().findAll{ it.isPublic() || it.isProtected() }.collect { method ->
+                    "<a href='${classDoc.relativeRootPath}${c.fullPathName}.html#${nameFromParams(method)}'>${method.name()}</a>"
+                }
+            } else {
+                list = c.externalClass().methods.findAll{ isVisible(it) }.collect { method ->
+                    // "<a href='${classDoc.relativeRootPath}${c.fullPathName}.html#${nameFromParams(method)}'>${method.name()}</a>"
+                    method.name
+                }
+            }
+            if (list) {
+                if (!methodSummaryShown) {
+                    methodSummaryShown = true
+                    %><table BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
+                    <TR CLASS="TableHeadingColor">
+                    <TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2" CLASS="ClassHeadingFont">
+                    <B>Method Summary</B></FONT></TH>
+                    </TR>
+                    </table>
+                    &nbsp;<%
+                }
+                %><table BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
+                <tr CLASS="TableSubHeadingColor"><th ALIGN="left" COLSPAN="2">
+                <b>Methods inherited from ${c.typeSourceDescription} ${linkable(c)}</b>
+                </th></tr>
+                <tr class="TableRowColor"><td colspan='2'>${list.join(', ')}</td></tr>
+                </table>
+                &nbsp;<%
+            }
+        }
+        classes = nextLevel
+    }
+%>
+
+<P>
+
+<!-- ============ ENUM CONSTANT DETAIL ========== -->
+
+<A NAME="enum_constant_detail"><!-- --></A>
+<% if (hasEnumConstants) { %>
+    <TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
+    <TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
+    <TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
+    <B>Enum Constant Detail</B></FONT></TH>
+    </TR>
+    </TABLE>
+    <% for (ec in classDoc.enumConstants()) { %>
+        <A NAME="${ec.name()}"><!-- --></A><H3>${ec.name()}</H3>
+        <PRE>${modifiers(ec) + '<a href="' + classDoc.relativeRootPath + classDoc.fullPathName + '.html">' + classDoc.name() + '</a>'} <B>${ec.name()}</B></PRE>
+        <DL>
+        <DD>${ec.commentText()}
+        </DD>
+        <P>
+        </DL>
+        <HR>
+    <% } %>
+    &nbsp;
+<% } %>
+
+<!-- =========== FIELD DETAIL =========== -->
+
+<A NAME="field_detail"><!-- --></A>
+<% if (hasFields) { %>
+    <TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
+    <TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
+    <TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
+    <B>Field Detail</B></FONT></TH>
+    </TR>
+    </TABLE>
+    <% for (field in visibleFields) { %>
+        <A NAME="${field.name()}"><!-- --></A><H3>${field.name()}</H3>
+        <PRE>${annotations(field, '\n') + modifiers(field) + linkable(field.type())} <B>${field.name()}</B></PRE>
+        <DL>
+        <DD>${field.commentText()}
+        </DD>
+        <P>
+        </DL>
+        <HR>
+    <% } %>
+    &nbsp;
+<% } %>
+
+<!-- =========== PROPERTY DETAIL =========== -->
+
+<A NAME="prop_detail"><!-- --></A>
+<% if (hasProperties) { %>
+    <TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
+    <TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
+    <TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
+    <B>Property Detail</B></FONT></TH>
+    </TR>
+    </TABLE>
+    <% for (prop in visibleProperties) { %>
+        <A NAME="${prop.name()}"><!-- --></A><H3>${prop.name()}</H3>
+        <PRE>${annotations(prop, '\n') + modifiers(prop) + linkable(prop.type())} <B>${prop.name()}</B></PRE>
+        <DL>
+        <DD>${prop.commentText()}
+        </DD>
+        <P>
+        </DL>
+        <HR>
+    <% } %>
+    &nbsp;
+<% } %>
+
+<!-- =========== ELEMENT DETAIL =========== -->
+
+<A NAME="element_detail"><!-- --></A>
+<% if (hasElements) { %>
+    <TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
+    <TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
+    <TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
+    <B>Element Detail</B></FONT></TH>
+    </TR>
+    </TABLE>
+    <% for (element in visibleFields) { %>
+        <A NAME="${element.name()}"><!-- --></A><H3>${element.name()}</H3>
+        <PRE>${modifiers(element) + linkable(element.type())} <B>${element.name()}</B></PRE>
+        <DL>
+        <DD>${element.commentText()}
+        </DD>
+        <P>
+        </DL>
+        <HR>
+    <% } %>
+    &nbsp;
+<% } %>
+
+<!-- ========= CONSTRUCTOR DETAIL ======== -->
+
+<A NAME="constructor_detail"><!-- --></A>
+<% if (hasConstructors) { %>
+    <TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
+    <TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
+    <TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
+    <B>Constructor Detail</B></FONT></TH>
+    </TR>
+    </TABLE>
+    <% for (constructor in classDoc.constructors()) { %>
+        <A NAME="${nameFromParams(constructor)}"><!-- --></A><H3>
+        ${constructor.name()}</H3>
+        <PRE>${annotations(constructor, '\n') + modifiers(constructor)}<B>${constructor.name()}</B>(${paramsOf(constructor, false)})</PRE>
+        <DL>
+        <DD>${constructor.commentText()}
+        </DD>
+        <P>
+        </DL>
+        <HR>
+    <% } %>
+    &nbsp;
+<% } %>
+
+<!-- ============ METHOD DETAIL ========== -->
+
+<A NAME="method_detail"><!-- --></A>
+<% if (hasMethods) { %>
+    <TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
+    <TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
+    <TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
+    <B>Method Detail</B></FONT></TH>
+    </TR>
+    </TABLE>
+    <% for (method in visibleMethods) { %>
+        <A NAME="${nameFromParams(method)}"><!-- --></A><H3>
+        ${method.name()}</H3>
+        <PRE>${annotations(method, '\n') + modifiers(method)}${linkable(method.returnType())} <B>${method.name()}</B>(${paramsOf(method, false)})</PRE>
+        <DL>
+        <DD>${method.commentText()}
+        </DD>
+        <P>
+        </DL>
+        <HR>
+    <% } %>
+    &nbsp;
+<% } %>
+
+<!-- ========= END OF CLASS DATA ========= -->
+<p>${props['footer']?:""}</p>
+<hr>
+
+</body>
+</html>
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/classLevel/classDocStructuredData.xml b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/classLevel/classDocStructuredData.xml
new file mode 100644
index 0000000000..5c69ed138d
--- /dev/null
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/classLevel/classDocStructuredData.xml
@@ -0,0 +1,24 @@
+<class name="${classDoc.name()}">
+  <containingPackage name="${classDoc.containingPackage().name()}">${classDoc.containingPackage().nameWithDots()}</containingPackage>
+  <extends>${classDoc.superclass()?.name()}</extends>
+  <comment>${classDoc.commentText()}</comment>
+  <constructors><% for (constructor in classDoc.constructors()) { %>
+    <constructor modifiers="${constructor.isPublic()?'public ':''}" name="${constructor.name()}">
+      <parameters><% for (parameter in constructor.parameters()) { %>
+        <parameter type="${parameter.typeName()}" name="${parameter.name()}" /><% } %>
+      </parameters>
+      <comment>${constructor.commentText()}</comment>
+    </constructor>
+<% } %>
+  </constructors>
+
+  <methods><% for (method in classDoc.methods()) { %>
+    <method modifiers="${method.isPublic()?'public ':''}${method.isStatic()?'static ':''}" returns="${method.returnType().qualifiedTypeName()}" name="${method.name()}">
+      <parameters><% for (parameter in method.parameters()) { %>
+        <parameter type="${parameter.isTypeAvailable()?parameter.type().qualifiedTypeName():parameter.typeName()}" name="${parameter.name()}" /><% } %>
+      </parameters>
+      <comment>${method.commentText()}</comment>
+    </method>
+<% } %>
+  </methods>
+</class>
\ No newline at end of file
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/packageLevel/package-frame.html b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/packageLevel/package-frame.html
new file mode 100644
index 0000000000..b8a29bda20
--- /dev/null
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/packageLevel/package-frame.html
@@ -0,0 +1,56 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
+<HTML>
+<HEAD>
+<TITLE>
+${packageDoc.nameWithDots()}
+</TITLE>
+<%
+// TODO enable errors(), enums() etc in SimpleGroovyPackageDoc then replace closures below
+def classTypes = [
+    "Interface" : { it.isInterface() },
+    "Class" : { it.isClass() && !it.parentClasses*.qualifiedTypeName().contains('java.lang.Throwable') },
+    "Enum" : { it.isEnum() },
+    "Exception" : { it.isClass() && it.parentClasses*.qualifiedTypeName().contains('java.lang.Exception') },
+    "Error" : { it.isClass() && it.parentClasses*.qualifiedTypeName().contains('java.lang.Error') },
+    "Annotation Type" : { it.isAnnotationType() }
+]
+def pluralize = { name -> name + (name.endsWith("s") ? "es" : "s") }
+%>
+
+<META NAME="keywords" CONTENT="${packageDoc.name()} package">
+
+<LINK REL ="stylesheet" TYPE="text/css" HREF="${packageDoc.getRelativeRootPath()}stylesheet.css" TITLE="Style">
+
+</HEAD>
+
+<BODY BGCOLOR="white">
+<FONT size="+1" CLASS="FrameTitleFont">
+<A HREF="package-summary.html" target="classFrame">${packageDoc.nameWithDots()}</A></FONT>
+
+<%
+classTypes.each{ k, v ->
+    if (packageDoc.allClasses().any{ v(it) }) {
+%>
+
+<TABLE BORDER="0" WIDTH="100%" SUMMARY="">
+<TR>
+<TD NOWRAP><FONT size="+1" CLASS="FrameHeadingFont">
+${pluralize(k)}</FONT>&nbsp;
+<FONT CLASS="FrameItemFont"><%
+    for (classDoc in packageDoc.allClasses()) {
+        if (v(classDoc)) {
+            %><BR><A HREF="${classDoc.name()}.html" title="${k.toLowerCase()} in ${packageDoc.nameWithDots()}" target="classFrame"><%
+            if (classDoc.isInterface()) { %><I><% }
+            %>${classDoc.name()}<%
+            if (classDoc.isInterface()) { %></I><% }
+            %></A><%
+        }
+    }
+%></FONT></TD>
+</TR>
+</TABLE>
+<% } %>
+<% } %>
+
+</BODY>
+</HTML>
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/packageLevel/package-summary.html b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/packageLevel/package-summary.html
new file mode 100644
index 0000000000..d118649746
--- /dev/null
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/packageLevel/package-summary.html
@@ -0,0 +1,126 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
+<html>
+<head>
+<%
+def title = packageDoc.nameWithDots() + (props.windowTitle ? " ($props.windowTitle)" : "")
+// TODO enable errors(), enums() etc in SimpleGroovyPackageDoc then replace closures below
+def classTypes = [
+    "Interface" : { it.isInterface() },
+    "Class" : { it.isClass() && !it.parentClasses*.qualifiedTypeName().contains('java.lang.Throwable') },
+    "Enum" : { it.isEnum() },
+    "Exception" : { it.isClass() && it.parentClasses*.qualifiedTypeName().contains('java.lang.Exception') },
+    "Error" : { it.isClass() && it.parentClasses*.qualifiedTypeName().contains('java.lang.Error') },
+    "Annotation Type" : { it.isAnnotationType() }
+]
+%>
+<title>${title}</title>
+<META NAME="keywords" CONTENT="${packageDoc.nameWithDots()} package">
+<LINK REL ="stylesheet" TYPE="text/css" HREF="${packageDoc.relativeRootPath}stylesheet.css" TITLE="Style">
+<link href="${packageDoc.relativeRootPath}groovy.ico" type="image/x-icon" rel="shortcut icon">
+<link href="${packageDoc.relativeRootPath}groovy.ico" type="image/x-icon" rel="icon">
+<SCRIPT type="text/javascript">
+function windowTitle()
+{
+    parent.document.title="${title}";
+}
+</SCRIPT>
+<NOSCRIPT>
+</NOSCRIPT>
+
+</head>
+
+<body BGCOLOR="white" onload="windowTitle();">
+<hr>
+
+<!-- ========= START OF TOP NAVBAR ======= -->
+<a name="navbar_top"><!-- --></a>
+<table summary="" width="100%" border="0" cellpadding="1" cellspacing="0">
+<tbody><tr>
+<td colspan="2" class="NavBarCell1" bgcolor="#eeeeff">
+<a name="navbar_top_firstrow"><!-- --></a>
+<table summary="" border="0" cellpadding="0" cellspacing="3">
+  <tbody><tr valign="top" align="center">
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <a href="${packageDoc.relativeRootPath}overview-summary.html"><font class="NavBarFont1"><b>Overview</b></font></a>&nbsp;</td>
+  <td class="NavBarCell1Rev" bgcolor="#ffffff"> &nbsp;<font class="NavBarFont1Rev"><b>Package</b></font>&nbsp;</td>
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <font class="NavBarFont1">Class</font>&nbsp;</td>
+  <!--
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <a href="overview-tree.html"><font class="NavBarFont1"><b>Tree</b></font></a>&nbsp;</td>
+  -->
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <a href="${packageDoc.relativeRootPath}deprecated-list.html"><font class="NavBarFont1"><b>Deprecated</b></font></a>&nbsp;</td>
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <a href="${packageDoc.relativeRootPath}index-all.html"><font class="NavBarFont1"><b>Index</b></font></a>&nbsp;</td>
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <a href="${packageDoc.relativeRootPath}help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
+  </tr>
+</tbody></table>
+</td>
+<td rowspan="3" valign="top" align="right"><em>
+    <% if (props.header) { %><b>${props.header}</b><% } %>
+</em>
+</td>
+</tr>
+
+<tr>
+<td class="NavBarCell2" bgcolor="white"><font size="-2">
+&nbsp;PREV&nbsp;
+&nbsp;NEXT</font></td>
+<td class="NavBarCell2" bgcolor="white"><font size="-2">
+  <a href="${packageDoc.relativeRootPath}index.html?${packageDoc.name()}/package-summary.html" target="_top"><b>FRAMES</b></a>  &nbsp;
+&nbsp;<a href="package-summary.html" target="_top"><b>NO FRAMES</b></a>  &nbsp;
+&nbsp;<script type="text/javascript">
+  <!--
+  if(window==top) {
+    document.writeln('<A HREF="${packageDoc.relativeRootPath}allclasses-frame.html"><B>All Classes</B></A>');
+  }
+  //-->
+</script>
+<noscript>
+  <A HREF="${packageDoc.relativeRootPath}allclasses-frame.html"><B>All Classes</B></A>
+</noscript>
+
+
+</font></td>
+</tr>
+</tbody></table>
+<!-- ========= END OF TOP NAVBAR ========= -->
+
+
+<HR>
+<H2>
+Package ${packageDoc.nameWithDots()}
+</H2>
+
+${packageDoc.description()}
+
+<P>&nbsp;</P>
+
+<%
+classTypes.each{ k, v ->
+    if (packageDoc.allClasses().any{ v(it) }) {
+%>
+
+<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
+    <TR BGCOLOR="#90DDF7" CLASS="TableHeadingColor">
+    <TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
+    <B>${k} Summary</B></FONT></TH>
+    </TR>
+<%
+    for (classDoc in packageDoc.allClasses()) {
+        if (v(classDoc)) {
+%>
+            <TR BGCOLOR="white" CLASS="TableRowColor">
+            <TD WIDTH="15%"><B><A HREF="${classDoc.name()}.html" title="class in ${packageDoc.name()}">${classDoc.name()}</A></B></TD>
+            <TD>${classDoc.firstSentenceCommentText()}</TD>
+            </TR>
+        <% } %>
+    <% } %>
+</TABLE>
+&nbsp;
+<P>
+<DL>
+</DL>
+<hr>
+    <% } %>
+<% } %>
+<p>${props['footer']?:""}</p>
+<hr>
+</body>
+</html>
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/packageLevel/packageDocStructuredData.xml b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/packageLevel/packageDocStructuredData.xml
new file mode 100644
index 0000000000..91f0dcbcf2
--- /dev/null
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/packageLevel/packageDocStructuredData.xml
@@ -0,0 +1,6 @@
+<package>
+  <classes><% for (classDoc in packageDoc.allClasses()) { %>
+    <class name="${classDoc.name()}" />
+<% } %>
+  </classes>
+</package>
\ No newline at end of file
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/allclasses-frame.html b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/allclasses-frame.html
new file mode 100644
index 0000000000..3e5a3fcf89
--- /dev/null
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/allclasses-frame.html
@@ -0,0 +1,35 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
+<HTML>
+<HEAD>
+<TITLE>
+All Classes
+</TITLE>
+<link href="groovy.ico" type="image/x-icon" rel="shortcut icon">
+<link href="groovy.ico" type="image/x-icon" rel="icon">
+<LINK REL ="stylesheet" TYPE="text/css" HREF="stylesheet.css" TITLE="Style">
+
+</HEAD>
+
+<BODY BGCOLOR="white">
+<FONT size="+1" CLASS="FrameHeadingFont">
+<B>All Classes</B></FONT>
+
+<BR>
+
+<TABLE BORDER="0" WIDTH="100%" SUMMARY="">
+<TR>
+<TD NOWRAP><FONT CLASS="FrameItemFont">
+<!--<A HREF="org/omg/CORBA/ARG_IN.html" title="interface in org.omg.CORBA" target="classFrame"><I>ARG_IN</I></A>-->
+<!--<BR>-->
+<% for (classDoc in rootDoc.classes()) {
+    def packageOrInnerName = classDoc.qualifiedTypeName() - ('.' + classDoc.simpleTypeName())
+    %><A HREF="${classDoc.getFullPathName()}.html" title="${classDoc.typeDescription.toLowerCase()} in ${packageOrInnerName}" target="classFrame">${classDoc.isInterface()?'<I>':''}${classDoc.name()}${classDoc.isInterface()?'</I>':''}</A>
+<BR>
+<% } %>
+	  
+</FONT></TD>
+</TR>
+</TABLE>
+
+</BODY>
+</HTML>
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/deprecated-list.html b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/deprecated-list.html
new file mode 100644
index 0000000000..a11a95f206
--- /dev/null
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/deprecated-list.html
@@ -0,0 +1,185 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
+<%
+def subtitle = 'Deprecated API'
+def title = subtitle + (props.windowTitle ? " (${props.windowTitle})" : "")
+// TODO enable errors(), enums() etc in SimpleGroovyPackageDoc then replace closures below
+def classTypes = [
+    "Interface" : { it.isInterface() && it.isDeprecated() },
+    "Class" : { it.isClass() && !it.parentClasses*.qualifiedTypeName().contains('java.lang.Throwable') && it.isDeprecated() },
+    "Enum" : { it.isEnum() && it.isDeprecated() },
+    "Exception" : { it.isClass() && it.parentClasses*.qualifiedTypeName().contains('java.lang.Exception') && it.isDeprecated() },
+    "Error" : { it.isClass() && it.parentClasses*.qualifiedTypeName().contains('java.lang.Error') && it.isDeprecated() },
+    "Annotation Type" : { it.isAnnotationType() && it.isDeprecated() }
+]
+// TODO fields, properties, enum constants
+def methodTypes = [
+    "Method" : { it.methods().findAll{ it.isDeprecated() } },
+    "Constructor" : { it.constructors().findAll{ it.isDeprecated() } },
+]
+def pluralize = { name -> name + (name.endsWith("s") ? "es" : "s") }
+def dolink = { t, classDoc, boolean b ->
+    if (!t || t instanceof String) {
+        return classDoc.getDocUrl(t, b)
+    }
+    if (t instanceof org.codehaus.groovy.tools.groovydoc.SimpleGroovyClassDoc) {
+        return "<a href='" + classDoc.relativeRootPath + t.fullPathName + ".html'>" + (b ? t.qualifiedTypeName() : t.name()) + "</a>"
+    }
+    return classDoc.getDocUrl(t.qualifiedTypeName(), b)
+}
+def linkable = { t, classDoc -> dolink(t, classDoc, false) }
+def modifiersBrief = { t ->
+    (t.isPrivate()?"private&nbsp;":"") +
+    (t.isProtected()?"protected&nbsp;":"") +
+    (t.isStatic()?"static&nbsp;":"")
+}
+def paramsOf = { n, classDoc, boolean brief -> n.parameters().collect{ param -> (brief?'':annotations(param, ' ')) + linkable(param.isTypeAvailable()?param.type():param.typeName(), classDoc) + ' ' + param.name() + (param.defaultValue() ? " = " + param.defaultValue():"") }.join(", ") }
+def nameFromParams = { n -> n.name() + '(' + n.parameters().collect{ param -> param.isTypeAvailable()?param.type().qualifiedTypeName():param.typeName() }.join(', ') + ')' }
+
+%>
+<html><head>
+<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
+<!-- Generated by groovydoc (${org.codehaus.groovy.runtime.InvokerHelper.version}) on <% new Date() %> -->
+<title>${title}</title>
+<meta name="date" content="${new Date().format('yyyy-MM-dd')}">
+<link rel="stylesheet" type="text/css" href="stylesheet.css" title="Style">
+<link href="groovy.ico" type="image/x-icon" rel="shortcut icon">
+<link href="groovy.ico" type="image/x-icon" rel="icon">
+
+<script type="text/javascript">
+function windowTitle()
+{
+    if (location.href.indexOf('is-external=true') == -1) {
+        parent.document.title="${title}";
+    }
+}
+</script>
+<noscript>
+</noscript>
+
+</head><body onload="windowTitle();" bgcolor="white">
+<hr>
+
+<!-- ========= START OF TOP NAVBAR ======= -->
+<a name="navbar_top"><!-- --></a>
+<table summary="" width="100%" border="0" cellpadding="1" cellspacing="0">
+<tbody><tr>
+<td colspan="2" class="NavBarCell1" bgcolor="#eeeeff">
+<a name="navbar_top_firstrow"><!-- --></a>
+<table summary="" border="0" cellpadding="0" cellspacing="3">
+  <tbody><tr valign="top" align="center">
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <a href="overview-summary.html"><font class="NavBarFont1"><b>Overview</b></font></a>&nbsp;</td>
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <font class="NavBarFont1">Package</font>&nbsp;</td>
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <font class="NavBarFont1">Class</font>&nbsp;</td>
+  <!--
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <a href="overview-tree.html"><font class="NavBarFont1"><b>Tree</b></font></a>&nbsp;</td>
+  -->
+  <td class="NavBarCell1Rev" bgcolor="#ffffff"> &nbsp;<font class="NavBarFont1Rev"><b>Deprecated</b></font>&nbsp;</td>
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <a href="index-all.html"><font class="NavBarFont1"><b>Index</b></font></a>&nbsp;</td>
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <a href="help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
+  </tr>
+</tbody></table>
+</td>
+<td rowspan="3" valign="top" align="right"><em>
+    <% if (props.header) { %><b>${props.header}</b><% } %>
+</em>
+</td>
+</tr>
+
+<tr>
+<td class="NavBarCell2" bgcolor="white"><font size="-2">
+&nbsp;PREV&nbsp;
+&nbsp;NEXT</font></td>
+<td class="NavBarCell2" bgcolor="white"><font size="-2">
+  <a href="index.html?deprecated-list.html" target="_top"><b>FRAMES</b></a>  &nbsp;
+&nbsp;<a href="deprecated-list.html" target="_top"><b>NO FRAMES</b></a>  &nbsp;
+&nbsp;<script type="text/javascript">
+  <!--
+  if(window==top) {
+    document.writeln('<A HREF="allclasses-frame.html"><B>All Classes</B></A>');
+  }
+  //-->
+</script>
+<noscript>
+  <A HREF="allclasses-frame.html"><B>All Classes</B></A>
+</noscript>
+
+</font></td>
+</tr>
+</tbody></table>
+<!-- ========= END OF TOP NAVBAR ========= -->
+
+<hr>
+<center>
+<h1>Deprecated API</h1>
+</center>
+<hr>
+
+<%
+classTypes.each{ k, v ->
+    if (rootDoc.classes().any{ v(it) }) {
+%>
+
+<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
+<TR CLASS="TableHeadingColor">
+<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2" CLASS="ClassHeadingFont">
+<B>${pluralize(k)}</B></FONT></TH>
+</TR>
+<FONT CLASS="FrameItemFont"><%
+    for (classDoc in rootDoc.classes()) {
+        if (v(classDoc)) {
+            def packageOrInnerName = classDoc.qualifiedTypeName() - ('.' + classDoc.simpleTypeName())
+            %><TR BGCOLOR="white" CLASS="TableRowColor">
+            <TD>
+                <CODE><b><a href="${classDoc.fullPathName}.html" title="${k.toLowerCase()} in ${packageOrInnerName}" target="classFrame"><%
+                if (classDoc.isInterface()) { %><I><% }
+                %>${classDoc.name()}<%
+                if (classDoc.isInterface()) { %></I><% }
+                %></a></b></CODE>
+                <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+                ${classDoc.firstSentenceCommentText()}
+            </TD>
+            </TR><%
+        }
+    }
+%></FONT></TD>
+</TR>
+</TABLE><br>
+<% } %>
+<% } %>
+
+<%
+methodTypes.each{ k, v ->
+    if (rootDoc.classes().any{ v(it) }) {
+%>
+
+<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
+<TR CLASS="TableHeadingColor">
+<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2" CLASS="ClassHeadingFont">
+<B>${pluralize(k)}</B></FONT></TH>
+</TR>
+
+<FONT CLASS="FrameItemFont"><%
+    for (classDoc in rootDoc.classes()) {
+        if (v(classDoc)) {
+            for (methOrConstr in v(classDoc)) {
+                %><TR BGCOLOR="white" CLASS="TableRowColor">
+                <TD>
+                    <CODE><b><a href="${classDoc.fullPathName}.html#${nameFromParams(methOrConstr)}">${classDoc.name()}#${methOrConstr.name()}</a></b>(${paramsOf(methOrConstr, classDoc, true)})</CODE>
+                    <BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
+                    ${methOrConstr.firstSentenceCommentText()}
+                </TD>
+                </TR><%
+            }
+        }
+    }
+%></FONT></TD>
+</TR>
+</TABLE><br>
+<% } %>
+<% } %>
+
+<hr>
+<p>${props['footer']?:""}</p>
+<hr>
+
+</body></html>
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/help-doc.html b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/help-doc.html
new file mode 100644
index 0000000000..f3246087d4
--- /dev/null
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/help-doc.html
@@ -0,0 +1,188 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
+<% def subtitle = 'API Help' %>
+<% def title = subtitle + (props.windowTitle ? " (${props.windowTitle})" : "") %>
+<html><head>
+<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
+<!-- Generated by groovydoc (${org.codehaus.groovy.runtime.InvokerHelper.version}) on <% new Date() %> -->
+<title>${title}</title>
+<link href="groovy.ico" type="image/x-icon" rel="shortcut icon">
+<link href="groovy.ico" type="image/x-icon" rel="icon">
+<meta name="date" content="${new Date().format('yyyy-MM-dd')}">
+<link rel="stylesheet" type="text/css" href="stylesheet.css" title="Style">
+
+<script type="text/javascript">
+function windowTitle()
+{
+    if (location.href.indexOf('is-external=true') == -1) {
+        parent.document.title="${title}";
+    }
+}
+</script>
+<noscript>
+</noscript>
+
+</head><body onload="windowTitle();" bgcolor="white">
+<hr>
+
+<!-- ========= START OF TOP NAVBAR ======= -->
+<a name="navbar_top"><!-- --></a>
+<table summary="" width="100%" border="0" cellpadding="1" cellspacing="0">
+<tbody><tr>
+<td colspan="2" class="NavBarCell1" bgcolor="#eeeeff">
+<a name="navbar_top_firstrow"><!-- --></a>
+<table summary="" border="0" cellpadding="0" cellspacing="3">
+  <tbody><tr valign="top" align="center">
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <a href="overview-summary.html"><font class="NavBarFont1"><b>Overview</b></font></a>&nbsp;</td>
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <font class="NavBarFont1">Package</font>&nbsp;</td>
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <font class="NavBarFont1">Class</font>&nbsp;</td>
+  <!--
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <a href="overview-tree.html"><font class="NavBarFont1"><b>Tree</b></font></a>&nbsp;</td>
+  -->
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <a href="deprecated-list.html"><font class="NavBarFont1"><b>Deprecated</b></font></a>&nbsp;</td>
+<!--
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <a href="index-all.html"><font class="NavBarFont1"><b>Index</b></font></a>&nbsp;</td>
+  -->
+  <td class="NavBarCell1Rev" bgcolor="#ffffff"> &nbsp;<font class="NavBarFont1Rev"><b>Help</b></font>&nbsp;</td>
+  </tr>
+</tbody></table>
+</td>
+<td rowspan="3" valign="top" align="right"><em>
+    <% if (props.header) { %><b>${props.header}</b><% } %>
+</em>
+</td>
+</tr>
+
+<tr>
+<td class="NavBarCell2" bgcolor="white"><font size="-2">
+&nbsp;PREV&nbsp;
+&nbsp;NEXT</font></td>
+<td class="NavBarCell2" bgcolor="white"><font size="-2">
+  <a href="index.html?help-doc.html" target="_top"><b>FRAMES</b></a>  &nbsp;
+&nbsp;<a href="help-doc.html" target="_top"><b>NO FRAMES</b></a>  &nbsp;
+&nbsp;<script type="text/javascript">
+  <!--
+  if(window==top) {
+    document.writeln('<A HREF="allclasses-frame.html"><B>All Classes</B></A>');
+  }
+  //-->
+</script>
+<noscript>
+  <A HREF="allclasses-frame.html"><B>All Classes</B></A>
+</noscript>
+
+</font></td>
+</tr>
+</tbody></table>
+<!-- ========= END OF TOP NAVBAR ========= -->
+
+<hr>
+<center>
+<h1>
+How This API Document Is Organized</h1>
+</center>
+This API (Application Programming Interface) document has pages
+corresponding to the items in the navigation bar, described as follows.<h3>
+Overview</h3>
+<blockquote>
+
+<p>
+The <a href="overview-summary.html">Overview</a>
+page is the front page of this API document and provides a list of all
+packages with a summary for each. This page can also contain an overall
+description of the set of packages.</p></blockquote>
+<h3>
+Package</h3>
+<blockquote>
+
+<p>
+Each package has a page that contains a list of its classes and
+interfaces, with a summary for each. This page can contain four
+categories:</p><ul>
+<li>Interfaces (italic)</li><li>Classes</li><li>Enums</li><li>Exceptions</li><li>Errors</li><li>Annotation Types</li></ul>
+</blockquote>
+<h3>
+Class/Interface</h3>
+<blockquote>
+
+<p>
+Each class, interface, nested class and nested interface has its own
+separate page. Each of these pages has three sections consisting of a
+class/interface description, summary tables, and detailed member
+descriptions:</p><ul>
+<li>Class inheritance diagram</li><li>Direct Subclasses</li><li>All Known Subinterfaces</li><li>All Known Implementing Classes</li><li>Class/interface declaration</li><li>Class/interface description
+<p>
+</p></li><li>Nested Class Summary</li><li>Field Summary</li><li>Constructor Summary</li><li>Method Summary
+<p>
+</p></li><li>Field Detail</li><li>Constructor Detail</li><li>Method Detail</li></ul>
+Each summary entry contains the first sentence from the detailed
+description for that item. The summary entries are alphabetical, while
+the detailed descriptions are in the order they appear in the source
+code. This preserves the logical groupings established by the
+programmer.</blockquote>
+
+<h3>Annotation Type</h3>
+<blockquote>
+
+<p>
+Each annotation type has its own separate page with the following sections:</p><ul>
+<li>Annotation Type declaration</li><li>Annotation Type description</li><li>Required Element Summary</li><li>Optional Element Summary</li><li>Element Detail</li></ul>
+</blockquote>
+
+<h3>Enum</h3>
+<blockquote>
+
+<p>
+Each enum has its own separate page with the following sections:</p><ul>
+<li>Enum declaration</li><li>Enum description</li><li>Enum Constant Summary</li><li>Enum Constant Detail</li></ul>
+</blockquote>
+<h3>Tree (Class Hierarchy)</h3>
+<blockquote>
+There is a <a href="overview-tree-todo.html">Class Hierarchy</a>
+page for all packages, plus a hierarchy for each package. Each
+hierarchy page contains a list of classes and a list of interfaces. The
+classes are organized by inheritance structure starting with <code>java.lang.Object</code>. The interfaces do not inherit from <code>java.lang.Object</code>.<ul>
+<li>When viewing the Overview page, clicking on "Tree" displays the hierarchy for all packages.</li><li>When viewing a particular package, class or interface page, clicking "Tree" displays the hierarchy for only that package.</li></ul>
+</blockquote>
+<h3>Deprecated API</h3>
+<blockquote>
+The <a href="deprecated-list.html">Deprecated API</a>
+page lists all of the parts of the API that have been deprecated. A deprecated API
+is not recommended for use, generally due to improvements, and a
+replacement API is usually given. Deprecated APIs may be removed in
+future implementations.</blockquote>
+<h3>
+Index</h3>
+<blockquote>
+The <a href="index-all.html">Index</a> contains an alphabetic list of all classes, interfaces, constructors, methods, and fields.</blockquote>
+<h3>
+Prev/Next</h3>
+These links take you to the next or previous class, interface, package, or related page.<h3>
+Frames/No Frames</h3>
+These links show and hide the HTML frames.  All pages are available with or without frames.
+<p>
+</p>
+<!--
+<h3>Serialized Form</h3>
+Each serializable or externalizable class has a description of its
+serialization fields and methods. This information is of interest to
+re-implementors, not to developers using the API. While there is no
+link in the navigation bar, you can get to this information by going to
+any serialized class and clicking "Serialized Form" in the "See also"
+section of the class description.
+<p>
+</p>
+-->
+<h3>Constant Field Values</h3>
+The <a href="constant-values-todo.html">Constant Field Values</a> page lists the static final fields and their values.
+<p>
+<font size="-1">
+<em>
+This help file applies to API documentation generated using the standard doclet.</em>
+</font>
+<br>
+</p><hr>
+
+<p>${props['footer']?:""}</p>
+<hr>
+
+</body></html>
\ No newline at end of file
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/index-all.html b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/index-all.html
new file mode 100644
index 0000000000..44f57028b1
--- /dev/null
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/index-all.html
@@ -0,0 +1,152 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
+<%
+def subtitle = 'Index'
+def title = subtitle + (props.windowTitle ? " (${props.windowTitle})" : "")
+def letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ_' as char[]
+def elementTypes = [
+    "Method" : { it.methods() },
+    "Constructor" : { it.constructors() },
+    "Field" : { it.fields() },
+    "Property" : { it.properties() },
+    "Enum Constant" : { it.enumConstants() },
+]
+def isVisible = { !it.isPrivate() || props.privateScope }
+def paramsOf = { n, classDoc, boolean brief -> n.parameters().collect{ param -> param.isTypeAvailable()?param.type().name():param.typeName() }.join(", ") }
+def nameFromParams = { n -> n.name() + '(' + n.parameters().collect{ param -> param.isTypeAvailable()?param.type().qualifiedTypeName():param.typeName() }.join(', ') + ')' }
+%>
+<html><head>
+<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
+<!-- Generated by groovydoc (${org.codehaus.groovy.runtime.InvokerHelper.version}) on <% new Date() %> -->
+<title>${title}</title>
+<meta name="date" content="${new Date().format('yyyy-MM-dd')}">
+<link rel="stylesheet" type="text/css" href="stylesheet.css" title="Style">
+<link href="groovy.ico" type="image/x-icon" rel="shortcut icon">
+<link href="groovy.ico" type="image/x-icon" rel="icon">
+<script type="text/javascript">
+function windowTitle()
+{
+    if (location.href.indexOf('is-external=true') == -1) {
+        parent.document.title="${title}";
+    }
+}
+</script>
+<noscript>
+</noscript>
+
+</head><body onload="windowTitle();" bgcolor="white">
+<hr>
+
+<!-- ========= START OF TOP NAVBAR ======= -->
+<a name="navbar_top"><!-- --></a>
+<table summary="" width="100%" border="0" cellpadding="1" cellspacing="0">
+<tbody><tr>
+<td colspan="2" class="NavBarCell1" bgcolor="#eeeeff">
+<a name="navbar_top_firstrow"><!-- --></a>
+<table summary="" border="0" cellpadding="0" cellspacing="3">
+  <tbody><tr valign="top" align="center">
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <a href="overview-summary.html"><font class="NavBarFont1"><b>Overview</b></font></a>&nbsp;</td>
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <font class="NavBarFont1">Package</font>&nbsp;</td>
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <font class="NavBarFont1">Class</font>&nbsp;</td>
+  <!--
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <a href="overview-tree.html"><font class="NavBarFont1"><b>Tree</b></font></a>&nbsp;</td>
+  -->
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <a href="deprecated-list.html"><font class="NavBarFont1"><b>Deprecated</b></font></a>&nbsp;</td>
+  <td class="NavBarCell1Rev" bgcolor="#ffffff"> &nbsp;<font class="NavBarFont1Rev"><b>Index</b></font>&nbsp;</td>
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <a href="help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
+  </tr>
+</tbody></table>
+</td>
+<td rowspan="3" valign="top" align="right"><em>
+    <% if (props.header) { %><b>${props.header}</b><% } %>
+</em>
+</td>
+</tr>
+
+<tr>
+<td class="NavBarCell2" bgcolor="white"><font size="-2">
+&nbsp;PREV&nbsp;
+&nbsp;NEXT</font></td>
+<td class="NavBarCell2" bgcolor="white"><font size="-2">
+  <a href="index.html?index-all.html" target="_top"><b>FRAMES</b></a>  &nbsp;
+&nbsp;<a href="index-all.html" target="_top"><b>NO FRAMES</b></a>  &nbsp;
+&nbsp;<script type="text/javascript">
+  <!--
+  if(window==top) {
+    document.writeln('<A HREF="allclasses-frame.html"><B>All Classes</B></A>');
+  }
+  //-->
+</script>
+<noscript>
+  <A HREF="allclasses-frame.html"><B>All Classes</B></A>
+</noscript>
+
+</font></td>
+</tr>
+</tbody></table>
+<!-- ========= END OF TOP NAVBAR ========= -->
+
+<% letters.each { letter -> %>
+<a href="#_${letter}_">${letter}</a>
+<% } %>
+
+<%
+letters.each { letter ->
+    def entries = [] as TreeMap
+    def upperLower = "$letter${letter.toLowerCase()}"
+    for (classDoc in rootDoc.classes()) {
+        def classLower = classDoc.name().toLowerCase()
+        if (isVisible(classDoc) && upperLower.contains(classDoc.name()[0])) {
+            def packageOrInnerName = classDoc.qualifiedTypeName() - ('.' + classDoc.simpleTypeName())
+            def packageName = classDoc.qualifiedTypeName() - ('.' + classDoc.name())
+            def desc = classDoc.typeDescription + ' in '
+            entries[classLower] = """
+<dt><a href="${classDoc.fullPathName}.html" title="${desc + packageOrInnerName}"><b>${classDoc.name()}</b></a> - ${desc}<a href="./${packageName.replace('.', '/')}/package-summary.html">${packageName}</a>
+</dt><dd>${classDoc.firstSentenceCommentText()}</dd>"""
+        }
+        elementTypes.each { k, v ->
+            def elements = v(classDoc)
+            elements.each { e ->
+                if (isVisible(e) && upperLower.contains(e.name()[0])) {
+                    def packageOrInnerName = classDoc.qualifiedTypeName() - ('.' + classDoc.simpleTypeName())
+                    def packageName = classDoc.qualifiedTypeName() - ('.' + classDoc.name())
+                    def desc = k + ' in '
+                    switch (k) {
+                    case 'Method':
+                    case 'Constructor':
+                        entries[e.name().toLowerCase()+'_'+classLower] = """
+<dt><a href="${classDoc.fullPathName}.html#${nameFromParams(e)}" title="${desc + classDoc.name()}"><b>${e.name()}</b>(${paramsOf(e, classDoc, true)})</b></a> - ${desc}<a href="${classDoc.fullPathName}.html">${classDoc.name()}</a>
+</dt><dd>${e.firstSentenceCommentText()}</dd>"""
+                        break
+                    case 'Field':
+                    case 'Property':
+                    case 'Enum Constant':
+                        entries[e.name().toLowerCase()+'_'+classLower] = """
+<dt><a href="${classDoc.fullPathName}.html#${e.name()}" title="${desc + classDoc.name()}"><b>${e.name()}</b></a> - ${desc}<a href="${classDoc.fullPathName}.html">${classDoc.name()}</a>
+</dt><dd>${e.firstSentenceCommentText()}</dd>"""
+                        break
+                    }
+                }
+            }
+        }
+    }
+%>
+
+<hr>
+<a name="_${letter}_"><!-- --></a><h2>
+<b>${letter}</b></h2>
+
+<dl>
+<%
+    entries.each{ k, v ->
+        %>${v}<%
+    }
+%>
+</dl>
+
+    <% } %>
+
+<hr>
+<p>${props['footer']?:""}</p>
+<hr>
+
+</body></html>
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/index.html b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/index.html
new file mode 100644
index 0000000000..cbe662892e
--- /dev/null
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/index.html
@@ -0,0 +1,37 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Frameset//EN" "http://www.w3.org/TR/html4/frameset.dtd">
+<HTML>
+<HEAD>
+<TITLE>
+{todo.title}
+</TITLE>
+<link href="groovy.ico" type="image/x-icon" rel="shortcut icon">
+<link href="groovy.ico" type="image/x-icon" rel="icon">
+<SCRIPT type="text/javascript">
+    targetPage = "" + window.location.search;
+    if (targetPage != "" && targetPage != "undefined")
+       targetPage = targetPage.substring(1);
+    function loadFrames() {
+        if (targetPage != "" && targetPage != "undefined")
+             top.classFrame.location = top.targetPage;
+    }
+</SCRIPT>
+<NOSCRIPT>
+</NOSCRIPT>
+</HEAD>
+<FRAMESET cols="20%,80%" title="" onLoad="top.loadFrames()">
+<FRAMESET rows="30%,70%" title="" onLoad="top.loadFrames()">
+<FRAME src="overview-frame.html" name="packageListFrame" title="All Packages">
+<FRAME src="allclasses-frame.html" name="packageFrame" title="All classes and interfaces (except non-static nested types)">
+</FRAMESET>
+<FRAME src="overview-summary.html" name="classFrame" title="Package, class and interface descriptions" scrolling="yes">
+<NOFRAMES>
+<H2>
+Frame Alert</H2>
+
+<P>
+This document is designed to be viewed using the frames feature. If you see this message, you are using a non-frame-capable web client.
+<BR>
+Link to<A HREF="overview-summary.html">Non-frame version.</A>
+</NOFRAMES>
+</FRAMESET>
+</HTML>
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/inherit.gif b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/inherit.gif
new file mode 100644
index 0000000000..c814867a13
Binary files /dev/null and b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/inherit.gif differ
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/overview-frame.html b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/overview-frame.html
new file mode 100644
index 0000000000..f4e1d22370
--- /dev/null
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/overview-frame.html
@@ -0,0 +1,41 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
+<HTML>
+<HEAD>
+<TITLE>
+Overview ${props.docTitle ? ("(" + props.docTitle + ")") : ""}
+</TITLE>
+
+<META NAME="keywords" CONTENT="Overview">
+
+<LINK REL ="stylesheet" TYPE="text/css" HREF="stylesheet.css" TITLE="Style">
+
+</HEAD>
+
+<BODY BGCOLOR="white">
+
+<TABLE BORDER="0" WIDTH="100%" SUMMARY="">
+<TR>
+<TH ALIGN="left" NOWRAP><FONT size="+1" CLASS="FrameTitleFont">
+<B>${props.docTitle}</B></FONT></TH>
+</TR>
+</TABLE>
+
+<TABLE BORDER="0" WIDTH="100%" SUMMARY="">
+<TR>
+<TD NOWRAP><FONT CLASS="FrameItemFont"><A HREF="allclasses-frame.html" target="packageFrame">All Classes</A></FONT>
+<P>
+<FONT size="+1" CLASS="FrameHeadingFont">
+Packages</FONT>
+<BR>
+<% for (packageDoc in rootDoc.specifiedPackages()) { %>
+<FONT CLASS="FrameItemFont"><A HREF="${packageDoc.name()}/package-frame.html" target="packageFrame">${packageDoc.nameWithDots()}</A></FONT>
+<BR>
+<% } %>
+</TD>
+</TR>
+</TABLE>
+
+<P>
+&nbsp;
+</BODY>
+</HTML>
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/overview-summary.html b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/overview-summary.html
new file mode 100644
index 0000000000..c4f6c78948
--- /dev/null
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/overview-summary.html
@@ -0,0 +1,94 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
+<% def title = "Overview" + (props.windowTitle ? " (${props.windowTitle})" : "") %>
+<html>
+<head>
+<title>${title}</title>
+<META NAME="keywords" CONTENT="Overview">
+<LINK REL ="stylesheet" TYPE="text/css" HREF="stylesheet.css" TITLE="Style">
+<link href="groovy.ico" type="image/x-icon" rel="shortcut icon">
+<link href="groovy.ico" type="image/x-icon" rel="icon">
+<SCRIPT type="text/javascript">
+function windowTitle()
+{
+    parent.document.title="${title}";
+}
+</SCRIPT>
+<NOSCRIPT>
+</NOSCRIPT>
+</head>
+<body BGCOLOR="white" onload="windowTitle();">
+<hr>
+
+<!-- ========= START OF TOP NAVBAR ======= -->
+<a name="navbar_top"><!-- --></a>
+<table summary="" width="100%" border="0" cellpadding="1" cellspacing="0">
+<tbody><tr>
+<td colspan="2" class="NavBarCell1" bgcolor="#eeeeff">
+<a name="navbar_top_firstrow"><!-- --></a>
+<table summary="" border="0" cellpadding="0" cellspacing="3">
+  <tbody><tr valign="top" align="center">
+  <td class="NavBarCell1Rev" bgcolor="#ffffff"> &nbsp;<font class="NavBarFont1Rev"><b>Overview</b></font>&nbsp;</td>
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <font class="NavBarFont1">Package</font>&nbsp;</td>
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <font class="NavBarFont1">Class</font>&nbsp;</td>
+  <!--
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <a href="overview-tree.html"><font class="NavBarFont1"><b>Tree</b></font></a>&nbsp;</td>
+  -->
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <a href="deprecated-list.html"><font class="NavBarFont1"><b>Deprecated</b></font></a>&nbsp;</td>
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <a href="index-all.html"><font class="NavBarFont1"><b>Index</b></font></a>&nbsp;</td>
+  <td class="NavBarCell1" bgcolor="#eeeeff">    <a href="help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
+  </tr>
+</tbody></table>
+</td>
+<td rowspan="3" valign="top" align="right"><em>
+<% if (props.header) { %><b>${props.header}</b><% } %>
+</em>
+</td>
+</tr>
+
+<tr>
+<td class="NavBarCell2" bgcolor="white"><font size="-2">
+&nbsp;PREV&nbsp;
+&nbsp;NEXT</font></td>
+<td class="NavBarCell2" bgcolor="white"><font size="-2">
+  <a href="index.html?overview-summary.html" target="_top"><b>FRAMES</b></a>  &nbsp;
+&nbsp;<a href="overview-summary.html" target="_top"><b>NO FRAMES</b></a>  &nbsp;
+&nbsp;<script type="text/javascript">
+  <!--
+  if(window==top) {
+    document.writeln('<A HREF="allclasses-frame.html"><B>All Classes</B></A>');
+  }
+  //-->
+</script>
+<noscript>
+  <A HREF="allclasses-frame.html"><B>All Classes</B></A>
+</noscript>
+
+
+</font></td>
+</tr>
+</tbody></table>
+<!-- ========= END OF TOP NAVBAR ========= -->
+
+<HR>
+<center>
+<h1>
+${props.docTitle ?: ''}</h1>
+</center>
+<p>${rootDoc.description()}</p>
+<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
+<TR BGCOLOR="#90DDF7" CLASS="TableHeadingColor">
+<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
+<B>Packages</B></FONT></TH>
+</TR>
+<% for (packageDoc in rootDoc.specifiedPackages()) { %>
+<TR BGCOLOR="white" CLASS="TableRowColor">
+<TD WIDTH="20%"><B><A HREF="${packageDoc.name()}/package-summary.html">${packageDoc.nameWithDots()}</A></B></TD>
+<TD>${packageDoc.summary() ?: ''}</TD>
+</TR>
+<% } %>
+</TABLE>
+
+<P>${props['footer']?:""}</P>
+<hr>
+</body>
+</html>
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/rootDocStructuredData.xml b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/rootDocStructuredData.xml
new file mode 100644
index 0000000000..bb36eac7e7
--- /dev/null
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/rootDocStructuredData.xml
@@ -0,0 +1,10 @@
+<root>
+  <packages><% for (packageDoc in rootDoc.specifiedPackages()) { %>
+  <package name="${packageDoc.name()}" />
+<% } %>
+<packages>
+  <classes><% for (classDoc in rootDoc.classes()) { %>
+    <class path="${classDoc.getFullPathName()}" name="${classDoc.name()}" />
+<% } %>
+  </classes>
+</root>
\ No newline at end of file
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/stylesheet.css b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/stylesheet.css
new file mode 100644
index 0000000000..8f7753043b
--- /dev/null
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/topLevel/stylesheet.css
@@ -0,0 +1,28 @@
+/* Groovydoc style sheet */
+
+/* Define colors, fonts and other style attributes here to override the defaults */
+
+/* Page background color */
+body { background-color: #FFFFFF }
+
+/* Headings */
+h1 { font-size: 145% }
+
+/* Table colors */
+.TableHeadingColor     { background: #97D0E8 } /* Dark cyan */
+.TableSubHeadingColor  { background: #E0F0FF } /* Light cyan */
+.TableRowColor         { background: #FFFFFF } /* White */
+
+/* Font used in left-hand frame lists */
+.FrameTitleFont   { font-size: 100%; font-family: Helvetica, Arial, sans-serif }
+.FrameHeadingFont { font-size:  90%; font-family: Helvetica, Arial, sans-serif }
+.FrameItemFont    { font-size:  90%; font-family: Helvetica, Arial, sans-serif }
+
+/* Navigation bar fonts and colors */
+.NavBarCell1    { background-color:#EEEEFF;} /* Light mauve */
+.NavBarCell1Rev { background-color:#00008B;} /* Dark Blue */
+.NavBarFont1    { font-family: Arial, Helvetica, sans-serif; color:#000000;}
+.NavBarFont1Rev { font-family: Arial, Helvetica, sans-serif; color:#FFFFFF;}
+
+.NavBarCell2    { font-family: Arial, Helvetica, sans-serif; background-color:#FFFFFF;}
+.NavBarCell3    { font-family: Arial, Helvetica, sans-serif; background-color:#FFFFFF;}
\ No newline at end of file
diff --git a/src/main/org/codehaus/groovy/util/ManagedReference.java b/src/main/org/codehaus/groovy/util/ManagedReference.java
index 975c71137f..2dce8a83a3 100644
--- a/src/main/org/codehaus/groovy/util/ManagedReference.java
+++ b/src/main/org/codehaus/groovy/util/ManagedReference.java
@@ -7,9 +7,9 @@ package org.codehaus.groovy.util;
  * @author Jochen Theodorou
  */
 public class ManagedReference<T> implements Finalizable {
-    private static ReferenceManager NULL_MANAGER = new ReferenceManager(null){};
-    private Reference<T,ManagedReference<T>> ref;
-    private ReferenceManager manager;
+    private final static ReferenceManager NULL_MANAGER = new ReferenceManager(null){};
+    private final Reference<T,ManagedReference<T>> ref;
+    private final ReferenceManager manager;
     
     public ManagedReference(ReferenceType type, ReferenceManager rmanager, T value) {
         if (rmanager==null) rmanager = NULL_MANAGER;
diff --git a/src/test/groovy/bugs/Groovy4230Bug.groovy b/src/test/groovy/bugs/Groovy4230Bug.groovy
deleted file mode 100644
index c15e5d5cb5..0000000000
--- a/src/test/groovy/bugs/Groovy4230Bug.groovy
+++ /dev/null
@@ -1,120 +0,0 @@
-package groovy.bugs
-
-public class Groovy4230Bug extends GroovyTestCase {
-  void testMe () {
-new GroovyShell().evaluate """
-import groovy.grape.*
-import javax.persistence.*
-import org.hibernate.cfg.*
-import org.hibernate.annotations.LazyToOne
-import org.hibernate.annotations.LazyToOneOption
-import org.hibernate.annotations.Proxy
-
-
-
-@Grab(group='org.hibernate', module='hibernate-commons-annotations', version='3.3.0.ga')
-@Grab(group='org.hibernate', module='hibernate-annotations', version='3.3.0.ga')
-@Grab(group='org.hibernate', module='hibernate-core', version='3.3.1.GA')
-@Grab(group='hsqldb', module='hsqldb', version='1.8.0.5')
-@Grab(group='antlr', module='antlr', version='2.7.6')
-@Grab(group='javassist', module='javassist', version='3.3')
-@Grab(group='org.slf4j', module='jcl-over-slf4j', version='1.5.6')
-@Grab(group='org.slf4j', module='slf4j-nop', version='1.5.6')
-
-
-/**
- * @author Graeme Rocher
- * @since 1.0
- *
- * Created: Apr 8, 2008
- */
-
-@Entity
-@Proxy(proxyClass=ContentRevision)
-@Inheritance(strategy = InheritanceType.SINGLE_TABLE )
-class ContentRevision implements Serializable {
-	@Id
-    @GeneratedValue(strategy = javax.persistence.GenerationType.AUTO)
-    Long id
-
-	@ManyToOne(fetch=FetchType.LAZY)
-	@LazyToOne(value=LazyToOneOption.PROXY)
-	Content content
-}
-
-@Entity
-@Inheritance(strategy = InheritanceType.SINGLE_TABLE )
-@Proxy(proxyClass=Content)
-class Content implements Serializable {
-    @Id
-    @GeneratedValue(strategy = javax.persistence.GenerationType.AUTO)
-    Long id
-
-    Date dateCreated = new Date()
-
-	@OneToMany(cascade=CascadeType.ALL, mappedBy="content")
-	List<ContentRevision> revisions = new ArrayList()
-}
-
-@Entity
-@Proxy(proxyClass=ArticleRevision)
-class ArticleRevision extends ContentRevision {
-    String title
-    String body
-}
-
-@Entity
-@Proxy(proxyClass=Article)
-class Article extends Content {
-	String author
-}
-
-    ExpandoMetaClass.enableGlobally()
-
-    config = new AnnotationConfiguration()
-    config.addAnnotatedClass Content
-    config.addAnnotatedClass ContentRevision
-    config.addAnnotatedClass Article
-    config.addAnnotatedClass ArticleRevision
-
-
-    config.properties  = ['hibernate.connection.driver_class':'org.hsqldb.jdbcDriver',
-                          'hibernate.connection.username': 'sa',
-                          'hibernate.connection.password': '',
-                          'hibernate.show_sql': 'true',
-                          'hibernate.hbm2ddl.auto': 'create',
-                          'hibernate.connection.url':'jdbc:hsqldb:mem:devDB']
-    config.buildMappings()
-    sessionFactory = config.buildSessionFactory()
-
-    session = sessionFactory.openSession()
-
-    try {
-        article = new Article(author:'author1')
-        article.revisions << new ArticleRevision(title:'title1', body:'body1', content:article)
-        session.save(article)
-
-        article = new Article(author:'author2')
-        article.revisions << new ArticleRevision(title:'title2', body:'body2', content:article)
-        article.revisions << new ArticleRevision(title:'title3', body:'body3', content:article)
-        session.save(article)
-        session.flush()
-
-        session.clear()
-
-        def revisions = session.createCriteria(ArticleRevision).list()
-
-        for(revision in revisions) {
-            println "author = \${revision.content.author}"
-        }
-
-    }
-    catch(e) {
-        e.printStackTrace()
-        println e.message
-        throw e
-
-    }
-"""
-  }
-}
\ No newline at end of file
diff --git a/src/test/org/codehaus/groovy/tools/groovydoc/GroovyDocToolTest.java b/src/test/org/codehaus/groovy/tools/groovydoc/GroovyDocToolTest.java
index 3ad89209dc..31dd842ff9 100644
--- a/src/test/org/codehaus/groovy/tools/groovydoc/GroovyDocToolTest.java
+++ b/src/test/org/codehaus/groovy/tools/groovydoc/GroovyDocToolTest.java
@@ -31,7 +31,7 @@ import java.util.Properties;
  */
 public class GroovyDocToolTest extends GroovyTestCase {
     private static final String MOCK_DIR = "mock/doc";
-    private static final String TEMPLATES_DIR = "main/org/codehaus/groovy/tools/groovydoc/gstring-templates";
+    private static final String TEMPLATES_DIR = "main/org/codehaus/groovy/tools/groovydoc/gstringTemplates";
 
     GroovyDocTool xmlTool;
     GroovyDocTool xmlToolForTests;
@@ -43,9 +43,9 @@ public class GroovyDocToolTest extends GroovyTestCase {
         xmlTool = new GroovyDocTool(
                 new FileSystemResourceManager("src"), // template storage
                 new String[] {"src/main"}, // source file dirs
-                new String[]{TEMPLATES_DIR + "/top-level/rootDocStructuredData.xml"},
-                new String[]{TEMPLATES_DIR + "/package-level/packageDocStructuredData.xml"},
-                new String[]{TEMPLATES_DIR + "/class-level/classDocStructuredData.xml"},
+                new String[]{TEMPLATES_DIR + "/topLevel/rootDocStructuredData.xml"},
+                new String[]{TEMPLATES_DIR + "/packageLevel/packageDocStructuredData.xml"},
+                new String[]{TEMPLATES_DIR + "/classLevel/classDocStructuredData.xml"},
                 new ArrayList(),
                 new Properties()
         );
@@ -53,9 +53,9 @@ public class GroovyDocToolTest extends GroovyTestCase {
         xmlToolForTests = new GroovyDocTool(
                 new FileSystemResourceManager("src"), // template storage
                 new String[] {"src/test"}, // source file dirs, // source file dirs
-                new String[]{TEMPLATES_DIR + "/top-level/rootDocStructuredData.xml"},
-                new String[]{TEMPLATES_DIR + "/package-level/packageDocStructuredData.xml"},
-                new String[]{TEMPLATES_DIR + "/class-level/classDocStructuredData.xml"},
+                new String[]{TEMPLATES_DIR + "/topLevel/rootDocStructuredData.xml"},
+                new String[]{TEMPLATES_DIR + "/packageLevel/packageDocStructuredData.xml"},
+                new String[]{TEMPLATES_DIR + "/classLevel/classDocStructuredData.xml"},
                 new ArrayList(),
                 new Properties()
         );
@@ -254,9 +254,9 @@ public class GroovyDocToolTest extends GroovyTestCase {
         GroovyDocTool multipleXmlTool = new GroovyDocTool(
                 new FileSystemResourceManager("src"), // template storage
                 new String[] {"src/main", "src/test"}, // source file dirs, // source file dirs
-                new String[]{TEMPLATES_DIR + "/top-level/rootDocStructuredData.xml"},
-                new String[]{TEMPLATES_DIR + "/package-level/packageDocStructuredData.xml"},
-                new String[]{TEMPLATES_DIR + "/class-level/classDocStructuredData.xml"},
+                new String[]{TEMPLATES_DIR + "/topLevel/rootDocStructuredData.xml"},
+                new String[]{TEMPLATES_DIR + "/packageLevel/packageDocStructuredData.xml"},
+                new String[]{TEMPLATES_DIR + "/classLevel/classDocStructuredData.xml"},
                 new ArrayList(),
                 new Properties()
         );
