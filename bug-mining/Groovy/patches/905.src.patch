diff --git a/src/main/org/codehaus/groovy/control/OptimizerVisitor.java b/src/main/org/codehaus/groovy/control/OptimizerVisitor.java
index cc961e5978..2b220b54cf 100644
--- a/src/main/org/codehaus/groovy/control/OptimizerVisitor.java
+++ b/src/main/org/codehaus/groovy/control/OptimizerVisitor.java
@@ -18,6 +18,7 @@ package org.codehaus.groovy.control;
 import org.codehaus.groovy.ast.ClassCodeExpressionTransformer;
 import org.codehaus.groovy.ast.ClassNode;
 import org.codehaus.groovy.ast.FieldNode;
+import org.codehaus.groovy.ast.expr.ClosureExpression;
 import org.codehaus.groovy.ast.expr.ConstantExpression;
 import org.codehaus.groovy.ast.expr.Expression;
 import org.objectweb.asm.Opcodes;
@@ -93,4 +94,10 @@ public class OptimizerVisitor extends ClassCodeExpressionTransformer {
     protected SourceUnit getSourceUnit() {
         return source;
     }
+
+    public void visitClosureExpression(ClosureExpression expression) {
+    	/*
+    	 * GROOVY-3339 - do nothing - so that numbers don't get replaced by cached constants in closure classes
+    	 */
+    }
 }
diff --git a/src/test/groovy/bugs/Groovy3339Bug.groovy b/src/test/groovy/bugs/Groovy3339Bug.groovy
new file mode 100644
index 0000000000..5d6a7f83d9
--- /dev/null
+++ b/src/test/groovy/bugs/Groovy3339Bug.groovy
@@ -0,0 +1,38 @@
+package groovy.bugs
+
+class Groovy3339 extends GroovyTestCase {
+    void testConstantCachingInClosureClasses() {
+        // In all the cases below, the OptimizerVisitor replaces number 10 by
+        // the cached constant in the closure class, which it is not supposed
+        // to do as the current implementation does not add synthetic fields
+        // for constant caching in closure classes. So the closure invocation currently
+        // fails in these cases with errors like "java.lang.NoSuchFieldError: $const$0"
+        for(myVal in evaluate('[10,11,12]', 2, 'foo') { [10,11,12] }) { 
+        	println myVal
+        }
+
+        while(evaluate2({10})){
+            // do nothing
+        }
+
+        synchronized(evaluate({10})){
+            // do nothing
+        }
+    }
+    
+    def evaluate(closure) {
+        def res = closure.call()
+        assert res == 10
+        return res
+    }
+    
+    def evaluate(text, num, thing, closure) {
+    	closure.call()
+    }
+
+    def evaluate2(closure) {
+        def res = closure.call()
+        assert res == 10
+        return null
+    }
+}
\ No newline at end of file
