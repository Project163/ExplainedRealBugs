diff --git a/subprojects/groovy-groovysh/src/main/groovy/org/codehaus/groovy/tools/shell/util/CommandArgumentParser.groovy b/subprojects/groovy-groovysh/src/main/groovy/org/codehaus/groovy/tools/shell/util/CommandArgumentParser.groovy
index 8cccb86c96..95b41665eb 100644
--- a/subprojects/groovy-groovysh/src/main/groovy/org/codehaus/groovy/tools/shell/util/CommandArgumentParser.groovy
+++ b/subprojects/groovy-groovysh/src/main/groovy/org/codehaus/groovy/tools/shell/util/CommandArgumentParser.groovy
@@ -36,21 +36,22 @@ class CommandArgumentParser {
     static List<String> parseLine(final String untrimmedLine, final int numTokensToCollect = -1) {
         assert untrimmedLine != null
 
-        String line = untrimmedLine.trim()
+        final String line = untrimmedLine.trim()
         List<String> tokens = []
         String currentToken = ''
         // state machine being either in neutral state, in singleHyphenOpen state, or in doubleHyphenOpen State.
         boolean singleHyphenOpen = false
         boolean doubleHyphenOpen = false
-        for (int i = 0; i < line.length(); i++) {
+        int index = 0
+        for (; index < line.length(); index++) {
             if (tokens.size() == numTokensToCollect) {
                 break
             }
-            String ch = line.charAt(i)
+            String ch = line.charAt(index)
             // escaped char?
             if (ch == '\\' && (singleHyphenOpen || doubleHyphenOpen)) {
-                ch = (i == line.length() - 1) ? '\\' : line.charAt(i + 1)
-                i++
+                ch = (index == line.length() - 1) ? '\\' : line.charAt(index + 1)
+                index++
                 currentToken += ch
                 continue
             }
@@ -91,12 +92,12 @@ class CommandArgumentParser {
                 continue
             }
             currentToken += ch
+        } // end for char in line
+        if (index == line.length() && doubleHyphenOpen) {
+            throw new IllegalArgumentException('Missing closing " in ' + line + ' -- ' + tokens)
         }
-        if (doubleHyphenOpen) {
-            throw new IllegalArgumentException('Missing closing "')
-        }
-        if (singleHyphenOpen) {
-            throw new IllegalArgumentException('Missing closing \'')
+        if (index == line.length() && singleHyphenOpen) {
+            throw new IllegalArgumentException('Missing closing \' in ' + line  + ' -- ' + tokens)
         }
         if (currentToken.size() > 0) {
             tokens.add(currentToken)
diff --git a/subprojects/groovy-groovysh/src/test/groovy/org/codehaus/groovy/tools/shell/util/CommandArgumentParserTest.groovy b/subprojects/groovy-groovysh/src/test/groovy/org/codehaus/groovy/tools/shell/util/CommandArgumentParserTest.groovy
index 6ff97c2447..1bb522dd76 100644
--- a/subprojects/groovy-groovysh/src/test/groovy/org/codehaus/groovy/tools/shell/util/CommandArgumentParserTest.groovy
+++ b/subprojects/groovy-groovysh/src/test/groovy/org/codehaus/groovy/tools/shell/util/CommandArgumentParserTest.groovy
@@ -42,6 +42,10 @@ public class CommandArgumentParserTest extends GroovyTestCase {
         // limited number of tokens
         assertEquals(['foo'], CommandArgumentParser.parseLine("  foo bar  ", 1))
         assertEquals(['bar', 'foo'], CommandArgumentParser.parseLine('bar"foo"\'bam\'\'baz\'', 2))
+
+        assertEquals(['map.put('], CommandArgumentParser.parseLine("map.put('a': 2)", 1))
+        assertEquals(['map.put('], CommandArgumentParser.parseLine("map.put('a", 1))
+
     }
 
 }
