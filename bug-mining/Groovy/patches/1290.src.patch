diff --git a/src/test/groovy/lang/GroovyClassLoaderTest.groovy b/src/test/groovy/lang/GroovyClassLoaderTest.groovy
index 96dc9ecfe5..58080a1c08 100644
--- a/src/test/groovy/lang/GroovyClassLoaderTest.groovy
+++ b/src/test/groovy/lang/GroovyClassLoaderTest.groovy
@@ -20,6 +20,7 @@ import org.codehaus.groovy.control.*
 import org.codehaus.groovy.ast.*
 import org.codehaus.groovy.classgen.*
 import org.objectweb.asm.Opcodes
+import java.util.concurrent.atomic.AtomicInteger
 
 public class GroovyClassLoaderTest extends GroovyTestCase implements Opcodes {
 
@@ -222,11 +223,10 @@ class GroovyClassLoaderTestCustomGCL extends GroovyClassLoader {
     def GroovyClassLoaderTestCustomGCL(config) {
         super(null, config);
     }
-    def counter = 0
+    def counter = new AtomicInteger(0)
     protected Class recompile(URL source, String name, Class oldClass) {
         if (name == "Foox") {
-            if (counter < 100) {
-                counter++
+            if (counter.getAndIncrement() < 100) {
                 return GroovyClassLoaderTestFoo1
             } else {
                 return GroovyClassLoaderTestFoo2
diff --git a/src/test/groovy/lang/gcldeadlock/DeadlockBugUtil.groovy b/src/test/groovy/lang/gcldeadlock/DeadlockBugUtil.groovy
new file mode 100644
index 0000000000..01112b69f9
--- /dev/null
+++ b/src/test/groovy/lang/gcldeadlock/DeadlockBugUtil.groovy
@@ -0,0 +1,3 @@
+class DeadlockBugUtil {
+  def plus(a, b){ return a + b }
+}
diff --git a/src/test/groovy/lang/gcldeadlock/GroovyClassLoaderDeadlockTest.java b/src/test/groovy/lang/gcldeadlock/GroovyClassLoaderDeadlockTest.java
new file mode 100644
index 0000000000..5f7f3b22f2
--- /dev/null
+++ b/src/test/groovy/lang/gcldeadlock/GroovyClassLoaderDeadlockTest.java
@@ -0,0 +1,62 @@
+package groovy.lang.gcldeadlock;
+
+import groovy.lang.Binding;
+import groovy.util.GroovyScriptEngine;
+import junit.framework.TestCase;
+
+import java.io.IOException;
+
+/**
+ * Check that GroovyClassLoader (through GroovyScriptEngine) can compile scripts concurrently.
+ * Test for GROOVY-4002
+ *
+ * @author Guillaume Laforge
+ */
+public class GroovyClassLoaderDeadlockTest extends TestCase {
+    private static final String PATH = "./src/test/groovy/lang/gcldeadlock/";
+
+    private static class Runner extends Thread {
+        private GroovyScriptEngine gse;
+        private String script;
+        private int count;
+        private String result = "";
+
+        public Runner(GroovyScriptEngine gse, String script, int count) {
+            this.gse = gse;
+            this.script = script;
+            this.count = count;
+        }
+
+        @Override
+        public void run() {
+            try {
+                Binding b = new Binding();
+                b.setVariable("number", count);
+                result = (String) this.gse.run(script, b);
+            } catch (Throwable t) {
+                throw new RuntimeException("problem running script", t);
+            }
+        }
+
+        public String getResult() {
+            return result;
+        }
+    }
+
+    public void testNoDeadlockWhenTwoThreadsCompileScripts() throws IOException, InterruptedException {
+        String[] roots = new String[] { PATH };
+        GroovyScriptEngine gse = new GroovyScriptEngine(roots);
+        Runner[] runners = new Runner[] {
+                new Runner(gse, "script0.groovy", 0),
+                new Runner(gse, "script1.groovy", 1)
+        };
+        for (Runner runner : runners) {
+            runner.start();
+        }
+        for (Runner runner : runners) {
+            runner.join();
+        }
+        assertEquals("0+0=0", runners[0].getResult());
+        assertEquals("1+1=2", runners[1].getResult());
+    }
+}
diff --git a/src/test/groovy/lang/gcldeadlock/script0.groovy b/src/test/groovy/lang/gcldeadlock/script0.groovy
new file mode 100644
index 0000000000..03e4d37346
--- /dev/null
+++ b/src/test/groovy/lang/gcldeadlock/script0.groovy
@@ -0,0 +1,3 @@
+def plus(a, b){ return a + b }
+
+number + "+" + number + "=" + plus(number, number)
diff --git a/src/test/groovy/lang/gcldeadlock/script1.groovy b/src/test/groovy/lang/gcldeadlock/script1.groovy
new file mode 100644
index 0000000000..b982e2744e
--- /dev/null
+++ b/src/test/groovy/lang/gcldeadlock/script1.groovy
@@ -0,0 +1,3 @@
+def util = new DeadlockBugUtil()
+
+number + "+" + number + "=" + util.plus(number, number)
