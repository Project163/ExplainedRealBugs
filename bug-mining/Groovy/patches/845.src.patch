diff --git a/src/main/groovy/util/BuilderSupport.java b/src/main/groovy/util/BuilderSupport.java
index 1fc191d0c6..a0f7a0130f 100644
--- a/src/main/groovy/util/BuilderSupport.java
+++ b/src/main/groovy/util/BuilderSupport.java
@@ -136,14 +136,12 @@ public abstract class BuilderSupport extends GroovyObjectSupport {
 
         if (closure != null) {
             // push new node on stack
-            Object oldCurrent = current;
-            current = node;
-
+            Object oldCurrent = getCurrent();
+            setCurrent(node);
             // let's register the builder as the delegate
             setClosureDelegate(closure, node);
             closure.call();
-
-            current = oldCurrent;
+            setCurrent(oldCurrent);
         }
 
         proxyBuilder.nodeCompleted(current, node);
diff --git a/src/main/groovy/xml/NamespaceBuilderSupport.java b/src/main/groovy/xml/NamespaceBuilderSupport.java
index 0c38401ff3..55d2fcdaed 100644
--- a/src/main/groovy/xml/NamespaceBuilderSupport.java
+++ b/src/main/groovy/xml/NamespaceBuilderSupport.java
@@ -16,6 +16,8 @@
 package groovy.xml;
 
 import groovy.util.BuilderSupport;
+import groovy.util.NodeBuilder;
+import org.codehaus.groovy.runtime.InvokerHelper;
 
 import java.util.HashMap;
 import java.util.Map;
@@ -30,9 +32,11 @@ import java.util.Map;
 public class NamespaceBuilderSupport extends BuilderSupport {
     private boolean autoPrefix;
     private Map<String, String> nsMap = new HashMap<String, String>();
-    
+    private BuilderSupport builder;
+
     public NamespaceBuilderSupport(BuilderSupport builder) {
         super(builder);
+        this.builder = builder;
     }
 
     public NamespaceBuilderSupport(BuilderSupport builder, String uri) {
@@ -44,31 +48,49 @@ public class NamespaceBuilderSupport extends BuilderSupport {
     }
 
     public NamespaceBuilderSupport(BuilderSupport builder, String uri, String prefix, boolean autoPrefix) {
-        super(builder);
+        this(builder);
         nsMap.put(prefix, uri);
         this.autoPrefix = autoPrefix;
     }
 
     public NamespaceBuilderSupport(BuilderSupport builder, Map nsMap) {
-        super(builder);
+        this(builder);
         this.nsMap = nsMap;
     }
 
-    protected NamespaceBuilderSupport namespace(String namespaceURI) {
+    public NamespaceBuilderSupport namespace(String namespaceURI) {
         nsMap.put("", namespaceURI);
         return this;
     }
 
-    protected NamespaceBuilderSupport namespace(String namespaceURI, String prefix) {
+    public NamespaceBuilderSupport namespace(String namespaceURI, String prefix) {
         nsMap.put(prefix, namespaceURI);
         return this;
     }
 
-    protected NamespaceBuilderSupport declareNamespace(Map nsMap) {
+    public NamespaceBuilderSupport declareNamespace(Map nsMap) {
         this.nsMap = nsMap;
         return this;
     }
 
+    @Override
+    protected Object getCurrent() {
+        // TODO a better way to do this?
+        if (builder instanceof NodeBuilder)
+            return InvokerHelper.invokeMethod(builder, "getCurrent", null);
+        else
+            return super.getCurrent();
+    }
+
+    @Override
+    protected void setCurrent(Object current) {
+        // TODO a better way to do this?
+        if (builder instanceof NodeBuilder)
+            InvokerHelper.invokeMethod(builder, "setCurrent", current);
+        else
+            super.setCurrent(current);
+    }
+
     @Override
     protected void setParent(Object parent, Object child) {
     }
diff --git a/src/test/groovy/xml/NamespaceNodeTest.groovy b/src/test/groovy/xml/NamespaceNodeTest.groovy
index 81b25bef7d..94d9e2f5be 100644
--- a/src/test/groovy/xml/NamespaceNodeTest.groovy
+++ b/src/test/groovy/xml/NamespaceNodeTest.groovy
@@ -5,16 +5,25 @@ package groovy.xml
  */
 class NamespaceNodeTest extends TestXmlSupport {
 
-    void testTree_FAILS() {if (notYetImplemented()) return
+    void testNodeBuilderWithNamespace() {
+        def n = new Namespace('http://foo/bar')
+        def builder = NamespaceBuilder.newInstance(new NodeBuilder(), n.uri)
+        def result = builder.outer(id: "3") {
+            inner(name: "foo")
+            inner("bar")
+        }
+        assert result[n.inner][0].@name == 'foo'
+        assert result[n.inner][1].text() == 'bar'
+    }
+    
+    void testTree() {
         def builder = NodeBuilder.newInstance()
         def xmlns = new NamespaceBuilder(builder)
-
         def xsd = xmlns.namespace('http://www.w3.org/2001/XMLSchema', 'xsd')
 
-        def root = xsd.schema(xmlns: ['foo': 'http://someOtherNamespace']) {
+        def root = xsd.schema {
             annotation {
                 documentation("Purchase order schema for Example.com.")
-                //documentation(xmlns=[xml.lang:'en']) ["Purchase order schema for Example.com."]
             }
             element(name: 'purchaseOrder', type: 'PurchaseOrderType')
             element(name: 'comment', type: 'xsd:string')
@@ -27,44 +36,6 @@ class NamespaceNodeTest extends TestXmlSupport {
                 }
                 attribute(name: 'orderDate', type: 'xsd:date')
             }
-            complexType(name: 'USAddress') {
-                sequence {
-                    element(name: 'name', type: 'xsd:string')
-                    element(name: 'street', type: 'xsd:string')
-                    element(name: 'city', type: 'xsd:string')
-                    element(name: 'state', type: 'xsd:string')
-                    element(name: 'zip', type: 'xsd:decimal')
-                }
-                attribute(fixed: 'US', name: 'country', type: 'xsd:NMTOKEN')
-            }
-            complexType(name: 'Items') {
-                sequence {
-                    element(maxOccurs: 'unbounded', minOccurs: '0', name: 'item') {
-                        complexType {
-                            sequence {
-                                element(name: 'productName', type: 'xsd:string')
-                                element(name: 'quantity') {
-                                    simpleType {
-                                        restriction(base: 'xsd:positiveInteger') {
-                                            maxExclusive(value: '100')
-                                        }
-                                    }
-                                }
-                                element(name: 'USPrice', type: 'xsd:decimal')
-                                element(minOccurs: '0', ref: 'comment')
-                                element(minOccurs: '0', name: 'shipDate', type: 'xsd:date')
-                            }
-                            attribute(name: 'partNum', type: 'SKU', use: 'required')
-                        }
-                    }
-                }
-            }
-            /* Stock Keeping Unit, a code for identifying products */
-            simpleType(name: 'SKU') {
-                restriction(base: 'xsd:string') {
-                    pattern(value: '\\d{3}-[A-Z]{2}')
-                }
-            }
         }
         assert root != null
 
@@ -72,29 +43,24 @@ class NamespaceNodeTest extends TestXmlSupport {
     }
 
     void assertGPaths(Node root) {
-        Namespace xsd = new Namespace('http://www.w3.org/2001/XMLSchema', 'xsd')
-
-        def children = root.children()
-        println "has children $children"
-
+        // check root node
         def name = root.name()
-        println "name is of type ${name.getClass()} with value $name"
-
-        root.children().each {println "has a child with name ${it.name()} and content $it"}
+        assert name instanceof QName
+        assert name.namespaceURI == 'http://www.w3.org/2001/XMLSchema'
+        assert name.localPart == 'schema'
+        assert name.prefix == 'xsd'
 
-        def foo = xsd.annotation
-        println "qname is $foo"
-        println "qname url is $foo.namespaceURI"
-        println "qname prefix is $foo.prefix"
-        println "qname localPart is $foo.localPart"
-
-        def a = root[xsd.annotation]
-        println "Found results $a"
+        // check 'xsd' qname factory
+        Namespace xsd = new Namespace('http://www.w3.org/2001/XMLSchema', 'xsd')
+        def qname = xsd.annotation
+        assert qname.namespaceURI == 'http://www.w3.org/2001/XMLSchema'
+        assert qname.localPart == 'annotation'
+        assert qname.prefix == 'xsd'
 
-        def e = root[xsd.annotation][xsd.documentation]
+        def docNode = root[xsd.annotation][xsd.documentation]
+        assert docNode[0].text() == "Purchase order schema for Example.com."
 
-        String text = e.text()
-        println "Found element: $e with text: $text"
-        assert text == "Purchase order schema for Example.com."
+        def attrNode = root[xsd.complexType][xsd.attribute]
+        assert attrNode[0].@name == 'orderDate'
     }
 }
\ No newline at end of file
