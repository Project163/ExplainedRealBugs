diff --git a/src/main/org/codehaus/groovy/classgen/VariableScopeVisitor.java b/src/main/org/codehaus/groovy/classgen/VariableScopeVisitor.java
index e9fed61141..cf52f2495a 100644
--- a/src/main/org/codehaus/groovy/classgen/VariableScopeVisitor.java
+++ b/src/main/org/codehaus/groovy/classgen/VariableScopeVisitor.java
@@ -26,6 +26,8 @@ import org.codehaus.groovy.ast.stmt.Statement;
 import org.codehaus.groovy.control.SourceUnit;
 
 import java.util.LinkedList;
+import java.util.List;
+import java.util.Map;
 
 /**
  * goes through an AST and initializes the scopes
@@ -504,4 +506,17 @@ public class VariableScopeVisitor extends ClassCodeVisitorSupport {
         popState();
     }
 
+    public void visitAnnotations(AnnotatedNode node) {
+        List<AnnotationNode> annotations = node.getAnnotations();
+        if (annotations.isEmpty()) return;
+        ClassNode annType;
+        for (AnnotationNode an : annotations) {
+        	// skip built-in properties
+        	if (an.isBuiltIn()) continue;
+            for (Map.Entry<String, Expression> member : an.getMembers().entrySet()) {
+                Expression annMemberValue = member.getValue();
+                annMemberValue.visit(this);
+            }
+        }
+    }
 }
diff --git a/src/main/org/codehaus/groovy/tools/javac/JavaAwareCompilationUnit.java b/src/main/org/codehaus/groovy/tools/javac/JavaAwareCompilationUnit.java
index 451ceb7e98..9dbc912a16 100644
--- a/src/main/org/codehaus/groovy/tools/javac/JavaAwareCompilationUnit.java
+++ b/src/main/org/codehaus/groovy/tools/javac/JavaAwareCompilationUnit.java
@@ -27,6 +27,7 @@ import java.io.FileNotFoundException;
 import org.codehaus.groovy.ast.ClassNode;
 import org.codehaus.groovy.ast.ModuleNode;
 import org.codehaus.groovy.classgen.GeneratorContext;
+import org.codehaus.groovy.classgen.VariableScopeVisitor;
 import org.codehaus.groovy.control.CompilationFailedException;
 import org.codehaus.groovy.control.CompilationUnit;
 import org.codehaus.groovy.control.CompilerConfiguration;
@@ -60,7 +61,11 @@ public class JavaAwareCompilationUnit extends CompilationUnit {
         
         addPhaseOperation(new PrimaryClassNodeOperation() {
             public void call(SourceUnit source, GeneratorContext context, ClassNode node) throws CompilationFailedException {
-                if (javaSources.size() != 0) new JavaAwareResolveVisitor(JavaAwareCompilationUnit.this).startResolving(node,source);
+                if (javaSources.size() != 0) {
+                	VariableScopeVisitor scopeVisitor = new VariableScopeVisitor(source);
+                	scopeVisitor.visitClass(node);
+                	new JavaAwareResolveVisitor(JavaAwareCompilationUnit.this).startResolving(node,source);
+                }
             }
         },Phases.CONVERSION);
 
diff --git a/src/main/org/codehaus/groovy/tools/javac/JavaStubGenerator.java b/src/main/org/codehaus/groovy/tools/javac/JavaStubGenerator.java
index ffa95d5839..1e280a5405 100644
--- a/src/main/org/codehaus/groovy/tools/javac/JavaStubGenerator.java
+++ b/src/main/org/codehaus/groovy/tools/javac/JavaStubGenerator.java
@@ -17,6 +17,7 @@ package org.codehaus.groovy.tools.javac;
 
 import org.codehaus.groovy.ast.*;
 import org.codehaus.groovy.ast.expr.ArgumentListExpression;
+import org.codehaus.groovy.ast.expr.ClassExpression;
 import org.codehaus.groovy.ast.expr.ConstantExpression;
 import org.codehaus.groovy.ast.expr.ConstructorCallExpression;
 import org.codehaus.groovy.ast.expr.Expression;
@@ -648,7 +649,9 @@ public class JavaStubGenerator
             // annotation closure; replaced with this specific class literal to cover the
             // case where annotation type uses Class<? extends Closure> for the closure's type
             val = "groovy.lang.Closure.class";
-        }
+        } else if (memberValue instanceof ClassExpression) {
+            val = ((Expression) memberValue).getText();
+        } 
         return val;
     }
 
diff --git a/src/test/org/codehaus/groovy/tools/stubgenerator/AnnotationMemberValuesResolutionStubsTestV1.groovy b/src/test/org/codehaus/groovy/tools/stubgenerator/AnnotationMemberValuesResolutionStubsTestV1.groovy
new file mode 100644
index 0000000000..413f5b1924
--- /dev/null
+++ b/src/test/org/codehaus/groovy/tools/stubgenerator/AnnotationMemberValuesResolutionStubsTestV1.groovy
@@ -0,0 +1,65 @@
+/*
+ * Copyright 2003-2010 the original author or authors.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.codehaus.groovy.tools.stubgenerator
+
+/**
+ * Test that FQN appears fine in generated stub when a enum ClassExpression.<EnumConstant> 
+ *  is used as an annotation member value
+ *
+ * @author Roshan Dawrani
+ */
+class AnnotationMemberValuesResolutionStubsTestV1 extends StringSourcesStubTestCase {
+
+    Map<String, String> provideSources() {
+        println 'AnnotationMemberValuesResolutionStubsTestV1'
+        [
+            'foo/Foo4434V1.java': '''
+                package foo;
+                
+                import java.lang.annotation.ElementType;
+                import java.lang.annotation.Retention;
+                import java.lang.annotation.RetentionPolicy;
+                import java.lang.annotation.Target;
+                
+                import baz.MyEnum4434V1;
+                
+                @Retention(RetentionPolicy.RUNTIME)
+                @Target( { ElementType.TYPE })
+                public @interface Foo4434V1 {
+                    MyEnum4434V1 val() default MyEnum4434V1.OTHER_VALUE;
+                }
+            ''',
+            'baz/MyEnum4434V1.java': '''
+                package baz;
+
+                public enum MyEnum4434V1 {SOME_VALUE, OTHER_VALUE}
+            ''',
+            'Bar4434V1.groovy': '''
+                import foo.Foo4434V1
+                import baz.MyEnum4434V1
+                
+                @Foo4434V1(val = MyEnum4434V1.SOME_VALUE)
+                class Bar4434V1 {}
+            '''
+        ]
+    }
+
+    void verifyStubs() {
+        classes['Bar4434V1'].with {
+            assert annotations[0].getProperty('val').toString() == 'baz.MyEnum4434V1.SOME_VALUE'
+        }
+    }
+}
diff --git a/src/test/org/codehaus/groovy/tools/stubgenerator/AnnotationMemberValuesResolutionStubsTestV2.groovy b/src/test/org/codehaus/groovy/tools/stubgenerator/AnnotationMemberValuesResolutionStubsTestV2.groovy
new file mode 100644
index 0000000000..c4925dc88a
--- /dev/null
+++ b/src/test/org/codehaus/groovy/tools/stubgenerator/AnnotationMemberValuesResolutionStubsTestV2.groovy
@@ -0,0 +1,64 @@
+/*
+ * Copyright 2003-2010 the original author or authors.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.codehaus.groovy.tools.stubgenerator
+
+/**
+ * Test that FQN appears fine in generated stub when a ClassExpression is used as an annotation member value
+ *
+ * @author Roshan Dawrani
+ */
+class AnnotationMemberValuesResolutionStubsTestV2 extends StringSourcesStubTestCase {
+
+    Map<String, String> provideSources() {
+        println 'AnnotationMemberValuesResolutionStubsTestV2'
+        [
+            'foo/Foo4434V2.java': '''
+                package foo;
+                
+                import java.lang.annotation.ElementType;
+                import java.lang.annotation.Retention;
+                import java.lang.annotation.RetentionPolicy;
+                import java.lang.annotation.Target;
+                
+                import baz.MyEnum4434V2;
+                
+                @Retention(RetentionPolicy.RUNTIME)
+                @Target( { ElementType.TYPE })
+                public @interface Foo4434V2 {
+                    Class val() default java.util.ArrayList.class;
+                }
+            ''',
+            'baz/MyEnum4434V2.java': '''
+                package baz;
+
+                public enum MyEnum4434V2 {SOME_VALUE, OTHER_VALUE}
+            ''',
+            'Bar4434V2.groovy': '''
+                import foo.Foo4434V2
+                import baz.MyEnum4434V2
+                
+                @Foo4434V2(val = MyEnum4434V2)
+                class Bar4434V2 {}
+            '''
+        ]
+    }
+
+    void verifyStubs() {
+        classes['Bar4434V2'].with {
+            assert annotations[0].getProperty('val').toString() == 'baz.MyEnum4434V2'
+        }
+    }
+}
diff --git a/src/test/org/codehaus/groovy/tools/stubgenerator/AnnotationMemberValuesResolutionStubsTestV3.groovy b/src/test/org/codehaus/groovy/tools/stubgenerator/AnnotationMemberValuesResolutionStubsTestV3.groovy
new file mode 100644
index 0000000000..6fa7361f35
--- /dev/null
+++ b/src/test/org/codehaus/groovy/tools/stubgenerator/AnnotationMemberValuesResolutionStubsTestV3.groovy
@@ -0,0 +1,64 @@
+/*
+ * Copyright 2003-2010 the original author or authors.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.codehaus.groovy.tools.stubgenerator
+
+/**
+ * Test that FQN appears fine in generated stub when ClassExpression.<Prop> is used as an annotation member value
+ *
+ * @author Roshan Dawrani
+ */
+class AnnotationMemberValuesResolutionStubsTestV3 extends StringSourcesStubTestCase {
+
+    Map<String, String> provideSources() {
+        println 'AnnotationMemberValuesResolutionStubsTestV3'
+        [
+            'foo/Foo4434V3.java': '''
+                package foo;
+                
+                import java.lang.annotation.ElementType;
+                import java.lang.annotation.Retention;
+                import java.lang.annotation.RetentionPolicy;
+                import java.lang.annotation.Target;
+                
+                import baz.MyClass4434V3;
+                
+                @Retention(RetentionPolicy.RUNTIME)
+                @Target( { ElementType.TYPE })
+                public @interface Foo4434V3 {
+                    String val() default "";
+                }
+            ''',
+            'baz/MyClass4434V3.java': '''
+                package baz;
+
+                public class MyClass4434V3 {public static final String SOME_CONST = "some constant";}
+            ''',
+            'Bar4434V3.groovy': '''
+                import foo.Foo4434V3
+                import baz.MyClass4434V3
+                
+                @Foo4434V3(val = MyClass4434V3.SOME_CONST)
+                class Bar4434V3 {}
+            '''
+        ]
+    }
+
+    void verifyStubs() {
+        classes['Bar4434V3'].with {
+            assert annotations[0].getProperty('val').toString() == 'baz.MyClass4434V3.SOME_CONST'
+        }
+    }
+}
