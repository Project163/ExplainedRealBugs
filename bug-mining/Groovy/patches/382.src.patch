diff --git a/src/main/org/codehaus/groovy/ant/Groovyc.java b/src/main/org/codehaus/groovy/ant/Groovyc.java
index cab122f7d7..e65b363fc9 100644
--- a/src/main/org/codehaus/groovy/ant/Groovyc.java
+++ b/src/main/org/codehaus/groovy/ant/Groovyc.java
@@ -27,6 +27,7 @@ import org.apache.tools.ant.util.SourceFileScanner;
 import org.codehaus.groovy.control.CompilationUnit;
 import org.codehaus.groovy.control.CompilerConfiguration;
 import org.codehaus.groovy.tools.ErrorReporter;
+import org.codehaus.groovy.tools.StringHelper;
 import org.codehaus.groovy.tools.javac.JavaAwareCompilationUnit;
 
 import java.io.File;
@@ -36,7 +37,6 @@ import java.io.StringWriter;
 import java.nio.charset.Charset;
 import java.util.HashMap;
 import java.util.Iterator;
-import java.util.LinkedList;
 import java.util.List;
 import java.util.Map;
 
@@ -562,61 +562,7 @@ public class Groovyc extends MatchingTask
     }
     
     public void setJointCompilationOptions(String options) {
-        String[] args = tokenize(options);
+        String[] args = StringHelper.tokenizeUnquoted(options);
         evalCompilerFlags(args);
-    }
-
-    private String[] tokenize(String str) {
-        if (str.length()==0) return new String[0];
-        LinkedList tokens = new LinkedList();
-        StringBuffer buffer = new StringBuffer(str);
-        int pos = 0;
-        boolean didReadWhiteSpaceOnly = true;
-        int tokenStart = 0;
-        while (true) {
-            if(pos==buffer.length()) {
-                if (!didReadWhiteSpaceOnly) {
-                    tokens.add(buffer.substring(tokenStart));
-                }
-                break;
-            }             
-            
-            char current = buffer.charAt(pos);
-            if (current==' ') { 
-                if (!didReadWhiteSpaceOnly) {
-                    tokens.add(buffer.substring(tokenStart, pos));
-                    didReadWhiteSpaceOnly = true;
-                }
-                pos = parseWhiteSpace(buffer,pos);
-                tokenStart = pos;
-            } else if (current=='\'') {
-                didReadWhiteSpaceOnly = false;
-                pos = parseString(buffer,pos,"\'");
-            } else if (current=='\"') {
-                didReadWhiteSpaceOnly = false;
-                pos = parseString(buffer,pos,"\"");
-            } else {
-                didReadWhiteSpaceOnly = false;
-                pos++;
-            }
-        }
-        
-        return (String[]) tokens.toArray(new String[0]);
-    }
-
-    private int parseString(StringBuffer buffer, int pos, String c) {
-        if (pos==buffer.length()-1) return buffer.length();
-        int index = buffer.indexOf(c,pos+1)+1;
-        if (index==-1) return buffer.length();
-        return index;
-    }
-
-    private int parseWhiteSpace(StringBuffer buffer, int pos) {
-        for (;pos<buffer.length();pos++) {
-            if (buffer.charAt(pos) != ' ') return pos;
-        }
-        return buffer.length();
-    }
-    
-    
+    }    
 }
diff --git a/src/main/org/codehaus/groovy/tools/StringHelper.java b/src/main/org/codehaus/groovy/tools/StringHelper.java
new file mode 100644
index 0000000000..5fb9f412ba
--- /dev/null
+++ b/src/main/org/codehaus/groovy/tools/StringHelper.java
@@ -0,0 +1,67 @@
+package org.codehaus.groovy.tools;
+
+import java.util.LinkedList;
+import java.util.List;
+
+public class StringHelper {
+    private final static char 
+        SPACE = ' ', SINGLE_QUOTE = '\'', DOUBLE_QUOTE = '"';
+    
+    /**
+     * This method tokenizes a string by space characters, 
+     * but ignores spaces in quoted parts,that are parts in 
+     * '' or "". The method does allows the usage of "" in '' 
+     * and '' in "". The space character between tokens is not 
+     * returned. 
+     * 
+     * @param s the string to tokenize
+     * @return the tokens
+     */
+    public static String[] tokenizeUnquoted(String s) {
+        List tokens = new LinkedList();
+        int first = 0;
+        while (first < s.length()) {
+            first = skipWhitespace(s, first);
+            int last = scanToken(s, first);
+            if (first < last) {
+                tokens.add(s.substring(first, last));
+            }
+            first = last;
+        }
+        return (String[])tokens.toArray(new String[0]);
+    }
+
+    private static int scanToken(String s, int pos0) {
+        int pos = pos0;
+        while (pos < s.length()) {
+            char c = s.charAt(pos);
+            if (SPACE==c) break;
+            pos++;
+            if (SINGLE_QUOTE == c) {
+                pos = scanQuoted(s, pos, SINGLE_QUOTE);
+            } else if (DOUBLE_QUOTE == c) {
+                pos = scanQuoted(s, pos, DOUBLE_QUOTE);
+            }
+        }
+        return pos;
+    }
+
+    private static int scanQuoted(String s, int pos0, char quote) {
+        int pos = pos0;
+        while (pos < s.length()) {
+            char c = s.charAt(pos++);
+            if (quote == c) break;
+        }
+        return pos;
+    }
+
+    private static int skipWhitespace(String s, int pos0) {
+        int pos = pos0;
+        while (pos < s.length()) {
+            char c = s.charAt(pos);
+            if (SPACE!=c) break;
+            pos++;
+        }
+        return pos;
+    } 
+}
diff --git a/src/test/org/codehaus/groovy/tools/StringHelperTest.groovy b/src/test/org/codehaus/groovy/tools/StringHelperTest.groovy
new file mode 100644
index 0000000000..8573a4c01a
--- /dev/null
+++ b/src/test/org/codehaus/groovy/tools/StringHelperTest.groovy
@@ -0,0 +1,18 @@
+package org.codehaus.groovy.tools
+
+import static org.codehaus.groovy.tools.StringHelper.*
+
+class StringHelperTest extends GroovyTestCase {
+
+  void testTokenize() {
+    assert tokenizeUnquoted("a b") == ["a","b"]
+    assert tokenizeUnquoted("a 'b a'") == ["a","'b a'"]
+    assert tokenizeUnquoted(" a 'b a'") == ["a","'b a'"]
+    assert tokenizeUnquoted(" a 'b a'" ) == ["a","'b a'"]
+    assert tokenizeUnquoted('a "b a"') == ["a",'"b a"']
+    assert tokenizeUnquoted("a 'b \"a c\"'") == ["a","'b \"a c\"'"]
+    assert tokenizeUnquoted("a \"b 'a c'\"") == ["a","\"b 'a c'\""]
+    assert tokenizeUnquoted("'a ") == ["'a "]
+    assert tokenizeUnquoted("\"a 'b'") == ["\"a 'b'"]
+  }
+}
\ No newline at end of file
