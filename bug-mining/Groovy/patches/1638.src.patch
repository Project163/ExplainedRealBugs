diff --git a/src/main/org/codehaus/groovy/ast/GenericsType.java b/src/main/org/codehaus/groovy/ast/GenericsType.java
index bee8c54020..7d44edfbdf 100644
--- a/src/main/org/codehaus/groovy/ast/GenericsType.java
+++ b/src/main/org/codehaus/groovy/ast/GenericsType.java
@@ -263,8 +263,8 @@ public class GenericsType extends ASTNode {
             GenericsType[] cnTypes = classNode.getGenericsTypes();
             if (cnTypes==null && classNode.isRedirectNode()) cnTypes=classNode.redirect().getGenericsTypes();
             if (cnTypes==null) {
-                // should not happen
-                return false;
+                // may happen if generic type is Foo<T extends Foo> and classnode is Foo -> Foo
+                return true;
             }
             GenericsType[] redirectBoundGenericTypes = bound.redirect().getGenericsTypes();
             Map<String, GenericsType> classNodePlaceholders = org.codehaus.groovy.ast.tools.GenericsUtils.extractPlaceholders(classNode);
diff --git a/src/test/groovy/transform/stc/GenericsSTCTest.groovy b/src/test/groovy/transform/stc/GenericsSTCTest.groovy
index 89d3a79be7..74a80cd178 100644
--- a/src/test/groovy/transform/stc/GenericsSTCTest.groovy
+++ b/src/test/groovy/transform/stc/GenericsSTCTest.groovy
@@ -176,7 +176,68 @@ class GenericsSTCTest extends StaticTypeCheckingTestCase {
             List<? super Number> list = ['string']
         ''', 'Number'
     }
-    
+
+    void testGroovy5154() {
+        assertScript '''
+            class Foo {
+                def say() {
+                    FooWithGenerics f
+                    FooBound fb
+                    f.say(fb)
+                }
+            }
+
+            class FooWithGenerics {
+                def <T extends FooBound> void say(T p) {
+                }
+            }
+            class FooBound {
+            }
+            new Foo()
+        '''
+    }
+
+    void testGroovy5154WithSubclass() {
+        assertScript '''
+            class Foo {
+                def say() {
+                    FooWithGenerics f
+                    FooBound2 fb
+                    f.say(fb)
+                }
+            }
+
+            class FooWithGenerics {
+                def <T extends FooBound> void say(T p) {
+                }
+            }
+            class FooBound {
+            }
+            class FooBound2 extends FooBound {}
+            new Foo()
+        '''
+    }
+
+    void testGroovy5154WithIncorrectType() {
+        shouldFailWithMessages '''
+            class Foo {
+                def say() {
+                    FooWithGenerics f
+                    Object fb
+                    f.say(fb)
+                }
+            }
+
+            class FooWithGenerics {
+                def <T extends FooBound> void say(T p) {
+                }
+            }
+            class FooBound {
+            }
+            new Foo()
+        ''', 'Cannot find matching method FooWithGenerics#say(java.lang.Object)'
+    }
+
     static class MyList extends LinkedList<String> {}
 }
 
