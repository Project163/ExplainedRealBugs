diff --git a/src/main/org/codehaus/groovy/antlr/AntlrParserPlugin.java b/src/main/org/codehaus/groovy/antlr/AntlrParserPlugin.java
index 179d484dcf..58fc8d251f 100644
--- a/src/main/org/codehaus/groovy/antlr/AntlrParserPlugin.java
+++ b/src/main/org/codehaus/groovy/antlr/AntlrParserPlugin.java
@@ -63,6 +63,7 @@ public class AntlrParserPlugin extends ASTHelper implements ParserPlugin, Groovy
     private ClassNode classNode;
     private String[] tokenNames;
     private int innerClassCounter = 1;
+    private boolean enumConstantBeingDef = false;
     
     public /*final*/ Reduction parseCST(final SourceUnit sourceUnit, Reader reader) throws CompilationFailedException {
         final SourceBuffer sourceBuffer = new SourceBuffer();
@@ -439,7 +440,11 @@ public class AntlrParserPlugin extends ASTHelper implements ParserPlugin, Groovy
         ClassNode outerClass = getClassOrScript(oldNode);        
         String fullName = outerClass.getName()+'$'+innerClassCounter;
         innerClassCounter++;
-        classNode = new InnerClassNode(outerClass, fullName, Opcodes.ACC_PUBLIC, ClassHelper.OBJECT_TYPE);
+        if(enumConstantBeingDef) {
+            classNode = new EnumConstantClassNode(outerClass, fullName, Opcodes.ACC_PUBLIC, ClassHelper.OBJECT_TYPE);
+        } else {
+            classNode = new InnerClassNode(outerClass, fullName, Opcodes.ACC_PUBLIC, ClassHelper.OBJECT_TYPE);
+        }
 
         assertNodeType(OBJBLOCK, node);
         objectBlock(node);
@@ -587,6 +592,7 @@ public class AntlrParserPlugin extends ASTHelper implements ParserPlugin, Groovy
     }
     
     protected void enumConstantDef(AST node) {
+    	enumConstantBeingDef = true;
         assertNodeType(ENUM_CONSTANT_DEF, node);
         AST element = node.getFirstChild();
         if (isType(ANNOTATIONS,element)) {
@@ -619,6 +625,7 @@ public class AntlrParserPlugin extends ASTHelper implements ParserPlugin, Groovy
             }
         }
         EnumHelper.addEnumConstant(classNode, identifier, init);
+        enumConstantBeingDef = false;
     }
     
     protected void throwsList(AST node, List list) {
diff --git a/src/main/org/codehaus/groovy/ast/EnumConstantClassNode.java b/src/main/org/codehaus/groovy/ast/EnumConstantClassNode.java
new file mode 100644
index 0000000000..b0119d517f
--- /dev/null
+++ b/src/main/org/codehaus/groovy/ast/EnumConstantClassNode.java
@@ -0,0 +1,36 @@
+/*
+ * Copyright 2003-2007 the original author or authors.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.codehaus.groovy.ast;
+
+/**
+ * Represents the anonymous inner class for an enum constant
+ * This subtype is needed so that EnumVisitor can differentiate between the scenarios when a InnerClassNode
+ * represents anonymous inner class for an enu constant and when it represents an enum class defined inside
+ * another class
+ * 
+ * @author Roshan Dawrani
+ */
+public class EnumConstantClassNode extends InnerClassNode {
+
+    /**
+     * @param name is the full name of the class
+     * @param modifiers the modifiers, @see org.objectweb.asm.Opcodes
+     * @param superClass the base class name - use "java.lang.Object" if no direct base class
+     */
+    public EnumConstantClassNode(ClassNode outerClass, String name, int modifiers, ClassNode superClass) {
+        super(outerClass, name, modifiers, superClass);
+    }
+}
diff --git a/src/main/org/codehaus/groovy/classgen/EnumVisitor.java b/src/main/org/codehaus/groovy/classgen/EnumVisitor.java
index 452f179e42..88c71b9f54 100644
--- a/src/main/org/codehaus/groovy/classgen/EnumVisitor.java
+++ b/src/main/org/codehaus/groovy/classgen/EnumVisitor.java
@@ -9,6 +9,7 @@ import org.codehaus.groovy.ast.ClassHelper;
 import org.codehaus.groovy.ast.ClassNode;
 import org.codehaus.groovy.ast.CodeVisitorSupport;
 import org.codehaus.groovy.ast.ConstructorNode;
+import org.codehaus.groovy.ast.EnumConstantClassNode;
 import org.codehaus.groovy.ast.FieldNode;
 import org.codehaus.groovy.ast.InnerClassNode;
 import org.codehaus.groovy.ast.MethodNode;
@@ -291,7 +292,7 @@ public class EnumVisitor extends ClassCodeVisitorSupport{
                 ListExpression oldArgs = (ListExpression) field.getInitialExpression();
                 for (Iterator oldArgsIterator = oldArgs.getExpressions().iterator(); oldArgsIterator.hasNext();) {
                     Expression exp = (Expression) oldArgsIterator.next();
-                    if (exp instanceof ClassExpression && exp.getType() instanceof InnerClassNode) {
+                    if (exp instanceof ClassExpression && exp.getType() instanceof EnumConstantClassNode) {
                         InnerClassNode inner = (InnerClassNode) exp.getType();
                         if (inner.getVariableScope()==null) {
                             enumBase = inner;
@@ -355,7 +356,7 @@ public class EnumVisitor extends ClassCodeVisitorSupport{
     }
 
     private boolean isAnonymousInnerClass(ClassNode enumClass) {
-        if (!(enumClass instanceof InnerClassNode)) return false;
+        if (!(enumClass instanceof EnumConstantClassNode)) return false;
         InnerClassNode  ic = (InnerClassNode) enumClass;
         return ic.getVariableScope()==null;
     }
diff --git a/src/test/groovy/bugs/GroovyInnerEnumBug.groovy b/src/test/groovy/bugs/GroovyInnerEnumBug.groovy
new file mode 100644
index 0000000000..15853d3713
--- /dev/null
+++ b/src/test/groovy/bugs/GroovyInnerEnumBug.groovy
@@ -0,0 +1,29 @@
+package groovy.bugs
+
+class GroovyInnerEnumBug extends GroovyTestCase {
+    static public enum MyEnum { 
+        a, b, c
+        public static MyEnum[] myenums = [a, b, c];
+    }
+    
+    // GROOVY-3979
+    void testEnumInsideAClass3979() {
+        assertScript """
+            class EnumTest2 {
+                enum Direction3979 { North, East, South, West }
+                static void main(args) {
+                    for (d in Direction3979) { 
+                        assert d instanceof Direction3979
+                    }
+                }
+            }
+        """
+    }
+
+    // GROOVY-3994
+    void testEnumInsideAClass3994() {
+        assert MyEnum.a.name() == 'a'
+        assertTrue Enum.isAssignableFrom(MyEnum.class)
+        assert EnumSet.allOf(MyEnum.class) instanceof EnumSet 
+    }
+}
