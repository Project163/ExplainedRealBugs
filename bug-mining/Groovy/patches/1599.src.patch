diff --git a/src/main/org/codehaus/groovy/classgen/AsmClassGenerator.java b/src/main/org/codehaus/groovy/classgen/AsmClassGenerator.java
index 8fa4ee3ae7..df44fcb58c 100644
--- a/src/main/org/codehaus/groovy/classgen/AsmClassGenerator.java
+++ b/src/main/org/codehaus/groovy/classgen/AsmClassGenerator.java
@@ -277,10 +277,32 @@ public class AsmClassGenerator extends ClassGenerator {
 
     private void visitStdMethod(MethodNode node, boolean isConstructor, Parameter[] parameters, Statement code) {
         MethodVisitor mv = controller.getMethodVisitor();
+        final ClassNode superClass = controller.getClassNode().getSuperClass();
         if (isConstructor && (code == null || !((ConstructorNode) node).firstStatementIsSpecialConstructorCall())) {
-            // invokes the super class constructor
-            mv.visitVarInsn(ALOAD, 0);
-            mv.visitMethodInsn(INVOKESPECIAL, BytecodeHelper.getClassInternalName(controller.getClassNode().getSuperClass()), "<init>", "()V");
+            boolean hasCallToSuper = false;
+            if (code!=null && controller.getClassNode() instanceof InnerClassNode) {
+                // if the class not is an inner class node, there are chances that the call to super is already added
+                // so we must ensure not to add it twice (see GROOVY-4471)
+                if (code instanceof BlockStatement) {
+                    for (Statement statement : ((BlockStatement) code).getStatements()) {
+                        if (statement instanceof ExpressionStatement) {
+                            final Expression expression = ((ExpressionStatement) statement).getExpression();
+                            if (expression instanceof ConstructorCallExpression) {
+                                ConstructorCallExpression call = (ConstructorCallExpression) expression;
+                                if (call.isSuperCall()) {
+                                    hasCallToSuper = true;
+                                    break;
+                                }
+                            }
+                        }
+                    }
+                }
+            }
+            if (!hasCallToSuper) {
+                // invokes the super class constructor
+                mv.visitVarInsn(ALOAD, 0);
+                mv.visitMethodInsn(INVOKESPECIAL, BytecodeHelper.getClassInternalName(superClass), "<init>", "()V");
+            }
         } 
         
         controller.getCompileStack().init(node.getVariableScope(), parameters);
diff --git a/src/main/org/codehaus/groovy/classgen/Verifier.java b/src/main/org/codehaus/groovy/classgen/Verifier.java
index e0f5f6a565..a9b756b5ee 100644
--- a/src/main/org/codehaus/groovy/classgen/Verifier.java
+++ b/src/main/org/codehaus/groovy/classgen/Verifier.java
@@ -814,34 +814,34 @@ public class Verifier implements GroovyClassVisitor, Opcodes {
         }
 
         statements.addAll(node.getObjectInitializerStatements());
-        if (!statements.isEmpty()) {
-            Statement code = constructorNode.getCode();
-            BlockStatement block = new BlockStatement();
-            List<Statement> otherStatements = block.getStatements();
-            if (code instanceof BlockStatement) {
-                block = (BlockStatement) code;
-                otherStatements = block.getStatements();
-            } else if (code != null) {
-                otherStatements.add(code);
+
+        Statement code = constructorNode.getCode();
+        BlockStatement block = new BlockStatement();
+        List<Statement> otherStatements = block.getStatements();
+        if (code instanceof BlockStatement) {
+            block = (BlockStatement) code;
+            otherStatements = block.getStatements();
+        } else if (code != null) {
+            otherStatements.add(code);
+        }
+        if (!otherStatements.isEmpty()) {
+            if (first != null) {
+                // it is super(..) since this(..) is already covered
+                otherStatements.remove(0);
+                statements.add(0, firstStatement);
             }
-            if (!otherStatements.isEmpty()) {
-                if (first != null) {
-                    // it is super(..) since this(..) is already covered
-                    otherStatements.remove(0);
-                    statements.add(0, firstStatement);
-                }
-                Statement stmtThis$0 = getImplicitThis$0StmtIfInnerClass(otherStatements);
-                if (stmtThis$0 != null) {
-                    // since there can be field init statements that depend on method/property dispatching
-                    // that uses this$0, it needs to bubble up just after the constructor call.
-                    statements.add(1, stmtThis$0);
-                }
-                statements.addAll(otherStatements);
+            Statement stmtThis$0 = getImplicitThis$0StmtIfInnerClass(otherStatements);
+            if (stmtThis$0 != null) {
+                // since there can be field init statements that depend on method/property dispatching
+                // that uses this$0, it needs to bubble up before the super call itself (GROOVY-4471)
+                statements.add(0, stmtThis$0);
             }
-            BlockStatement newBlock = new BlockStatement(statements, block.getVariableScope());
-            newBlock.setSourcePosition(block);
-            constructorNode.setCode(newBlock);
+            statements.addAll(otherStatements);
         }
+        BlockStatement newBlock = new BlockStatement(statements, block.getVariableScope());
+        newBlock.setSourcePosition(block);
+        constructorNode.setCode(newBlock);
+
 
 
         if (!staticStatements.isEmpty()) {
@@ -872,23 +872,30 @@ public class Verifier implements GroovyClassVisitor, Opcodes {
                 List<Statement> stmts = ((BlockStatement) stmt).getStatements();
                 for (Statement bstmt : stmts) {
                     if (bstmt instanceof ExpressionStatement) {
-                        Expression expr = ((ExpressionStatement) bstmt).getExpression();
-                        if (expr instanceof BinaryExpression) {
-                            Expression lExpr = ((BinaryExpression) expr).getLeftExpression();
-                            if (lExpr instanceof FieldExpression) {
-                                if ("this$0".equals(((FieldExpression) lExpr).getFieldName())) {
-                                    stmts.remove(bstmt); // remove from here and let the caller reposition it
-                                    return bstmt;
-                                }
-                            }
-                        }
+                        if (extractImplicitThis$0StmtIfInnerClassFromExpression(stmts, bstmt)) return bstmt;
                     }
                 }
+            } else if (stmt instanceof ExpressionStatement) {
+                if (extractImplicitThis$0StmtIfInnerClassFromExpression(otherStatements, stmt)) return stmt;
             }
         }
         return null;
     }
 
+    private boolean extractImplicitThis$0StmtIfInnerClassFromExpression(final List<Statement> stmts, final Statement bstmt) {
+        Expression expr = ((ExpressionStatement) bstmt).getExpression();
+        if (expr instanceof BinaryExpression) {
+            Expression lExpr = ((BinaryExpression) expr).getLeftExpression();
+            if (lExpr instanceof FieldExpression) {
+                if ("this$0".equals(((FieldExpression) lExpr).getFieldName())) {
+                    stmts.remove(bstmt); // remove from here and let the caller reposition it
+                    return true;
+                }
+            }
+        }
+        return false;
+    }
+
     private ConstructorCallExpression getFirstIfSpecialConstructorCall(Statement code) {
         if (code == null || !(code instanceof ExpressionStatement)) return null;
 
diff --git a/src/test/groovy/bugs/Groovy4471Bug.groovy b/src/test/groovy/bugs/Groovy4471Bug.groovy
new file mode 100644
index 0000000000..e5a8fb9f4e
--- /dev/null
+++ b/src/test/groovy/bugs/Groovy4471Bug.groovy
@@ -0,0 +1,34 @@
+package groovy.bugs
+
+
+class Groovy4471Bug extends GroovyTestCase {
+    void testShouldNotThrowNPE() {
+        assertScript """
+            class X {
+                private A a = new A()
+
+                public X() {
+                    new B() {
+                        public A getFoo() {a}
+                    }
+                }
+            }
+
+            class A {}
+            class B {
+                B(){getFoo()}
+                A getFoo(){}
+            }
+
+            def x = new X()
+        """
+    }
+
+    void testShouldAllowArrayListInitialization() {
+        assertScript """
+            def list = new ArrayList() {{
+                add('a')
+            }}
+        """
+    }
+}
