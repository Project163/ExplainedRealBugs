diff --git a/src/main/org/codehaus/groovy/transform/ImmutableASTTransformation.java b/src/main/org/codehaus/groovy/transform/ImmutableASTTransformation.java
index c624f672ae..9cdc6ed9f9 100644
--- a/src/main/org/codehaus/groovy/transform/ImmutableASTTransformation.java
+++ b/src/main/org/codehaus/groovy/transform/ImmutableASTTransformation.java
@@ -60,6 +60,7 @@ public class ImmutableASTTransformation implements ASTTransformation, Opcodes {
     private static final Class MY_CLASS = Immutable.class;
     private static final ClassNode MY_TYPE = new ClassNode(MY_CLASS);
     private static final String MY_TYPE_NAME = "@" + MY_TYPE.getNameWithoutPackage();
+    private static final ClassNode OBJECT_TYPE = new ClassNode(Object.class);
     private static final ClassNode HASHMAP_TYPE = new ClassNode(HashMap.class);
     private static final ClassNode MAP_TYPE = new ClassNode(Map.class);
     private static final ClassNode DATE_TYPE = new ClassNode(Date.class);
@@ -201,13 +202,14 @@ public class ImmutableASTTransformation implements ASTTransformation, Opcodes {
 
     private void createEquals(ClassNode cNode) {
         final BlockStatement body = new BlockStatement();
-        final List<PropertyNode> list = cNode.getProperties();
         Expression other = new VariableExpression("other");
 
         // some short circuit cases for efficiency
         body.addStatement(returnFalseIfNull(other));
+        body.addStatement(returnFalseIfWrongType(cNode, other));
         body.addStatement(returnTrueIfIdentical(VariableExpression.THIS_EXPRESSION, other));
 
+        final List<PropertyNode> list = cNode.getProperties();
         // fields
         for (PropertyNode pNode : list) {
             body.addStatement(returnFalseIfPropertyNotEqual(pNode, other));
@@ -216,10 +218,18 @@ public class ImmutableASTTransformation implements ASTTransformation, Opcodes {
         // default
         body.addStatement(new ReturnStatement(ConstantExpression.TRUE));
 
-        Parameter[] params = {new Parameter(cNode, "other")};
+        Parameter[] params = {new Parameter(OBJECT_TYPE, "other")};
         cNode.addMethod(new MethodNode("equals", ACC_PUBLIC, ClassHelper.boolean_TYPE, params, ClassNode.EMPTY_ARRAY, body));
     }
 
+    private Statement returnFalseIfWrongType(ClassNode cNode, Expression other) {
+        return new IfStatement(
+                identicalExpr(new ClassExpression(cNode), new ClassExpression(other.getType())),
+                new ReturnStatement(ConstantExpression.FALSE),
+                new EmptyStatement()
+        );
+    }
+
     private IfStatement returnFalseIfNull(Expression other) {
         return new IfStatement(
                 equalsNullExpr(other),
@@ -260,7 +270,7 @@ public class ImmutableASTTransformation implements ASTTransformation, Opcodes {
         final FieldExpression constructorStyle = new FieldExpression(constructorField);
         if (cNode.getDeclaredConstructors().size() != 0) {
             // TODO: allow constructors which call provided constructor?
-            throw new RuntimeException(MY_TYPE_NAME + " does not allow explicit constructors");
+            throw new RuntimeException("Explicit constructors not allowed for " + MY_TYPE_NAME + " class: " + cNode.getNameWithoutPackage());
         }
 
         List<PropertyNode> list = cNode.getProperties();
diff --git a/src/test/org/codehaus/groovy/transform/vm5/ImmutableTransformTest.groovy b/src/test/org/codehaus/groovy/transform/vm5/ImmutableTransformTest.groovy
index 5f1e430cc6..a6ec77364c 100644
--- a/src/test/org/codehaus/groovy/transform/vm5/ImmutableTransformTest.groovy
+++ b/src/test/org/codehaus/groovy/transform/vm5/ImmutableTransformTest.groovy
@@ -23,13 +23,13 @@ class ImmutableTransformTest extends GroovyShellTestCase {
     void testImmutable() {
         def objects = evaluate("""
               enum Coin { HEAD, TAIL }
-              @Immutable final class Foo {
+              @Immutable final class Bar {
                   String x, y
                   Coin c
                   Collection nums
               }
-              [new Foo(x:'x', y:'y', c:Coin.HEAD, nums:[1,2]),
-               new Foo('x', 'y', Coin.HEAD, [1,2])]
+              [new Bar(x:'x', y:'y', c:Coin.HEAD, nums:[1,2]),
+               new Bar('x', 'y', Coin.HEAD, [1,2])]
         """)
 
         assertEquals objects[0].hashCode(), objects[1].hashCode()
@@ -37,29 +37,41 @@ class ImmutableTransformTest extends GroovyShellTestCase {
         assertTrue objects[0].nums.class.name.contains("Unmodifiable")
     }
 
+    void testImmutableAsMapKey() {
+        assertScript """
+            @Immutable final class HasString {
+                String s
+            }
+            def k1 = new HasString('xyz')
+            def k2 = new HasString('xyz')
+            def map = [(k1):42]
+            assert map[k2] == 42
+        """
+    }
+
     void testImmutableWithOnlyMap() {
         assertScript """
-            @Immutable final class Foo {
-              Map bar
+            @Immutable final class HasMap {
+                Map map
             }
-            new Foo([:])
+            new HasMap([:])
         """
     }
 
     void testImmutableWithHashMap() {
         assertScript """
-            @Immutable final class Foo {
-                HashMap bar = [d:4]
+            @Immutable final class HasHashMap {
+                HashMap map = [d:4]
             }
-            assert new Foo([a:1]).bar == [a:1]
-            assert new Foo(c:3).bar == [c:3]
-            assert new Foo(bar:[b:2]).bar == [b:2]
-            assert new Foo(null).bar == [d:4]
-            assert new Foo().bar == [d:4]
-            assert new Foo([:]).bar == [:]
-            assert new Foo(bar:5, c:3).bar == [bar:5, c:3]
-            assert new Foo(bar:null).bar == null
-            assert new Foo(bar:[:]).bar == [:]
+            assert new HasHashMap([a:1]).map == [a:1]
+            assert new HasHashMap(c:3).map == [c:3]
+            assert new HasHashMap(map:[b:2]).map == [b:2]
+            assert new HasHashMap(null).map == [d:4]
+            assert new HasHashMap().map == [d:4]
+            assert new HasHashMap([:]).map == [:]
+            assert new HasHashMap(map:5, c:3).map == [map:5, c:3]
+            assert new HasHashMap(map:null).map == null
+            assert new HasHashMap(map:[:]).map == [:]
         """
     }
 }
\ No newline at end of file
