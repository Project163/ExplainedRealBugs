diff --git a/src/main/org/codehaus/groovy/transform/CategoryASTTransformation.java b/src/main/org/codehaus/groovy/transform/CategoryASTTransformation.java
index 4c7383734a..615abd6237 100644
--- a/src/main/org/codehaus/groovy/transform/CategoryASTTransformation.java
+++ b/src/main/org/codehaus/groovy/transform/CategoryASTTransformation.java
@@ -1,5 +1,5 @@
 /*
- * Copyright 2008-2009 the original author or authors.
+ * Copyright 2008-2010 the original author or authors.
  *
  * Licensed under the Apache License, Version 2.0 (the "License");
  * you may not use this file except in compliance with the License.
@@ -29,14 +29,20 @@ import org.objectweb.asm.Opcodes;
 
 import groovy.lang.Reference;
 
-import java.util.Set;
-import java.util.LinkedList;
-import java.util.HashSet;
 import java.util.Arrays;
+import java.util.HashSet;
+import java.util.LinkedList;
+import java.util.List;
+import java.util.Set;
 
 /**
- * Handles generation of code for the @Category annotation
- * - all non-static methods converted to static ones with additional parameter 'self'
+ * Handles generation of code for the @Category annotation.
+ * <p>
+ * Transformation logic is as follows:
+ * <ul>
+ * <li>all non-static methods converted to static ones with an additional 'self' parameter
+ * <li>references to 'this' changed to the additional 'self' parameter
+ * </ul>
  *
  * @author Alex Tkachman
  */
@@ -83,12 +89,14 @@ public class CategoryASTTransformation implements ASTTransformation, Opcodes {
                 varStack.add(names);
             }
             
+            @Override
             public void visitMethod(MethodNode node) {
                 addVariablesToStack(node.getParameters());
                 super.visitMethod(node);
                 varStack.removeLast();
             }
 
+            @Override
             public void visitBlockStatement(BlockStatement block) {
                 Set<String> names = new HashSet<String>();
                 names.addAll(varStack.getLast());
@@ -97,11 +105,31 @@ public class CategoryASTTransformation implements ASTTransformation, Opcodes {
                 varStack.remove(names);
             }
 
+            @Override
+            public void visitClosureExpression(ClosureExpression ce) {
+                addVariablesToStack(ce.getParameters());
+                super.visitClosureExpression(ce);
+                varStack.removeLast();
+            }
+
+            @Override
             public void visitDeclarationExpression(DeclarationExpression expression) {
-                varStack.getLast().add(expression.getVariableExpression().getName());
+                Expression left = expression.getLeftExpression();
+                if (left instanceof ArgumentListExpression) {
+                    ArgumentListExpression ale = (ArgumentListExpression) left;
+                    List<Expression> list = ale.getExpressions();
+                    for (Expression arg : list) {
+                        VariableExpression ve = (VariableExpression) arg;
+                        varStack.getLast().add(ve.getName());
+                    }
+                } else {
+                    VariableExpression ve = (VariableExpression) left;
+                    varStack.getLast().add(ve.getName());
+                }
                 super.visitDeclarationExpression(expression);
             }
 
+            @Override
             public void visitForLoop(ForStatement forLoop) {
                 Expression exp = forLoop.getCollectionExpression();
                 exp.visit(this);
@@ -112,6 +140,7 @@ public class CategoryASTTransformation implements ASTTransformation, Opcodes {
                 super.visitForLoop(forLoop);
             }
 
+            @Override
             public void visitExpressionStatement(ExpressionStatement es) {
                 // GROOVY-3543: visit the declaration expressions so that declaration variables get added on the varStack
                 Expression exp = es.getExpression();
@@ -121,6 +150,7 @@ public class CategoryASTTransformation implements ASTTransformation, Opcodes {
                 super.visitExpressionStatement(es);
             }
 
+            @Override
             public Expression transform(Expression exp) {
                 if (exp instanceof VariableExpression) {
                     VariableExpression ve = (VariableExpression) exp;
@@ -153,6 +183,7 @@ public class CategoryASTTransformation implements ASTTransformation, Opcodes {
                     }
                     addVariablesToStack(params);
                     ce.getCode().visit(this);
+                    varStack.removeLast();
                 }
                 return super.transform(exp);
             }
diff --git a/src/test/groovy/lang/CategoryAnnotationTest.groovy b/src/test/groovy/lang/CategoryAnnotationTest.groovy
index 7b767f75d0..391209c8d6 100644
--- a/src/test/groovy/lang/CategoryAnnotationTest.groovy
+++ b/src/test/groovy/lang/CategoryAnnotationTest.groovy
@@ -38,7 +38,7 @@ class CategoryAnnotationTest extends GroovyTestCase {
             }
         """
     }
-    
+
     void testCategoryMethodsHavingDeclarationStatements() {
         // GROOVY-3543: Declaration statements in category class' methods were not being visited by 
         // CategoryASTTransformation's expressionTransformer resulting in declaration variables not being 
@@ -82,7 +82,7 @@ class CategoryAnnotationTest extends GroovyTestCase {
             }
         """
     }
-    
+
     void testPropertyNameExpandingToGetterInsideCategoryMethod() {
         //GROOVY-3543: Inside the category method, this.getType().name was failing but this.getType().getName() was not.
         assertScript """
@@ -116,7 +116,7 @@ class CategoryAnnotationTest extends GroovyTestCase {
             }
         """
     }
-    
+
     void testClosureUsingThis() {
         assertScript """
             @Category(Guy)
@@ -145,5 +145,33 @@ class CategoryAnnotationTest extends GroovyTestCase {
             assert onetest.process() == onetest.messages.findAll{it.name != onetest.getName()}        
         """
     }
+
+    void testClosureWithinDeclarationExpressionAndMultipleAssignment() {
+        // GROOVY-4546
+        assertScript """
+            @Category(Integer)
+            class MyOps {
+                def multiplesUpTo4() { [this * 2, this * 3, this * 4] }
+                def multiplesUpTo(num) {
+                    (2..num).collect{ j -> this * j }
+                }
+                def alsoMultiplesUpTo(num) {
+                    def ans = (2..num).collect{ i -> this * i }
+                    ans
+                }
+                def twice() {
+                    def (twice, thrice, quad) = multiplesUpTo4()
+                    twice
+                }
+            }
+
+            use(MyOps) {
+                assert 5.multiplesUpTo4() == [10, 15, 20]
+                assert 5.multiplesUpTo(6) == [10, 15, 20, 25, 30]
+                assert 5.alsoMultiplesUpTo(6) == [10, 15, 20, 25, 30]
+                assert 5.twice() == 10
+            }
+        """
+    }
 }
 
