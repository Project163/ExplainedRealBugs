diff --git a/src/main/org/codehaus/groovy/tools/javac/JavacJavaCompiler.java b/src/main/org/codehaus/groovy/tools/javac/JavacJavaCompiler.java
index 6151cc331f..5faaa6ba84 100644
--- a/src/main/org/codehaus/groovy/tools/javac/JavacJavaCompiler.java
+++ b/src/main/org/codehaus/groovy/tools/javac/JavacJavaCompiler.java
@@ -23,10 +23,10 @@ import java.io.PrintWriter;
 import java.io.StringWriter;
 import java.lang.reflect.Method;
 import java.lang.reflect.InvocationTargetException;
-import java.util.LinkedList;
-import java.util.List;
-import java.util.Locale;
-import java.util.Map;
+import java.util.*;
+import java.net.URLClassLoader;
+import java.net.URL;
+import java.net.URISyntaxException;
 
 import org.codehaus.groovy.control.CompilationUnit;
 import org.codehaus.groovy.control.CompilerConfiguration;
@@ -42,7 +42,7 @@ public class JavacJavaCompiler implements JavaCompiler {
     }
 
     public void compile(List files, CompilationUnit cu) {
-        String[] javacParameters = makeParameters(files);
+        String[] javacParameters = makeParameters(files, cu.getClassLoader());
         StringWriter javacOutput=null;
         int javacReturnValue = 0;
         try {
@@ -90,7 +90,7 @@ public class JavacJavaCompiler implements JavaCompiler {
     }
     
 
-    private String[] makeParameters(List files) {
+    private String[] makeParameters(List files, GroovyClassLoader parentClassLoader) {
         Map options = config.getJointCompilationOptions();
         LinkedList paras = new LinkedList();
 
@@ -125,10 +125,25 @@ public class JavacJavaCompiler implements JavaCompiler {
         
         // append classpath if not already defined
         if (!hadClasspath) {
+            // add all classpaths that compilation unit sees
+            StringBuffer resultPath = new StringBuffer(DefaultGroovyMethods.join(config.getClasspath(), File.pathSeparator));
+            ClassLoader cl = parentClassLoader;
+            while (cl != null) {
+                if (cl instanceof URLClassLoader) {
+                    for (URL u : ((URLClassLoader)cl).getURLs()) {
+                        try {
+                            resultPath.append(File.pathSeparator);
+                            resultPath.append(new File(u.toURI()).getPath());
+                        } catch (URISyntaxException e) {
+                            // ignore it
+                        }
+                    }
+                }
+                cl = cl.getParent();
+            }
+
             paras.add("-classpath");
-            List classpath = config.getClasspath();
-            String resultPath = DefaultGroovyMethods.join(classpath, File.pathSeparator);
-            paras.add(resultPath);
+            paras.add(resultPath.toString());
         }
         
         // files to compile
diff --git a/src/test/org/codehaus/groovy/tools/FileSystemCompilerTest.java b/src/test/org/codehaus/groovy/tools/FileSystemCompilerTest.java
index 42c4cd1319..9839a1f337 100644
--- a/src/test/org/codehaus/groovy/tools/FileSystemCompilerTest.java
+++ b/src/test/org/codehaus/groovy/tools/FileSystemCompilerTest.java
@@ -72,7 +72,7 @@ public class FileSystemCompilerTest extends GroovyTestCase {
         runTest("tree/NestedClosureBugTest.groovy");
         runTest("tree/SmallTreeTest.groovy");
         runTest("LittleClosureTest.groovy");
-        //runTest("JointJava.java", "JointGroovy.groovy");
+        runTest("JointJava.java", "JointGroovy.groovy");
     }
 
     protected void runTest(String... names) throws Exception {
