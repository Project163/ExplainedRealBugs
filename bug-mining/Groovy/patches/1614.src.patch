diff --git a/src/main/org/codehaus/groovy/classgen/InnerClassVisitor.java b/src/main/org/codehaus/groovy/classgen/InnerClassVisitor.java
index 6702caf596..bbb97cdb3f 100644
--- a/src/main/org/codehaus/groovy/classgen/InnerClassVisitor.java
+++ b/src/main/org/codehaus/groovy/classgen/InnerClassVisitor.java
@@ -164,11 +164,11 @@ public class InnerClassVisitor extends InnerClassVisitorHelper implements Opcode
         if (cce.isThisCall()) {
             pass = true;
         } else if (cce.isSuperCall()) {
-            // if the super class is another non-static inner class in the same outer class, implicit this
+            // if the super class is another non-static inner class in the same outer class hierarchy, implicit this
             // needs to be passed
             if (!superCN.isEnum() && !superCN.isInterface() && superCN instanceof InnerClassNode) {
                 InnerClassNode superInnerCN = (InnerClassNode) superCN;
-                if (!isStatic(superInnerCN) && superCN.getOuterClass().equals(classNode.getOuterClass())) {
+                if (!isStatic(superInnerCN) && classNode.getOuterClass().isDerivedFrom(superCN.getOuterClass())) {
                     pass = true;
                 }
             }
diff --git a/src/test/groovy/bugs/Groovy5109Bug.groovy b/src/test/groovy/bugs/Groovy5109Bug.groovy
new file mode 100644
index 0000000000..97d964db34
--- /dev/null
+++ b/src/test/groovy/bugs/Groovy5109Bug.groovy
@@ -0,0 +1,17 @@
+package groovy.bugs
+
+class Groovy5109Bug extends GroovyTestCase {
+    void testShouldNotThrowArrayOutOfBounds() {
+        assertScript '''
+        class C1 {
+            class A {}
+        }
+
+        class C2 extends C1 {
+            { new B() }
+            class B extends C1.A {}
+        }
+        new C2()
+        '''
+    }
+}
