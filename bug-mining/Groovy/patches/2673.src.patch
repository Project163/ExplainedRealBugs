diff --git a/src/main/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java b/src/main/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java
index 1ffea497b3..ea6191b52f 100644
--- a/src/main/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java
+++ b/src/main/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java
@@ -1619,6 +1619,18 @@ public class StaticTypeCheckingVisitor extends ClassCodeVisitorSupport {
         checkForbiddenSpreadArgument(argumentList);
 
         ClassNode[] args = getArgumentTypes(argumentList);
+        if (    args.length>0 &&
+                typeCheckingContext.getEnclosingClosure()!=null &&
+                argumentList.getExpression(0) instanceof VariableExpression &&
+                ((VariableExpression) argumentList.getExpression(0)).isThisExpression() &&
+                call.getType() instanceof InnerClassNode &&
+                call.getType().getOuterClass().equals(args[0]) &&
+                !call.getType().isStaticClass())
+        {
+            args[0] = CLOSURE_TYPE;
+        }
+
+
         MethodNode node = null;
         if (args.length == 1
                 && implementsInterfaceOrIsSubclassOf(args[0], MAP_TYPE)
diff --git a/src/test/groovy/transform/stc/AnonymousInnerClassSTCTest.groovy b/src/test/groovy/transform/stc/AnonymousInnerClassSTCTest.groovy
index 739f4afdad..8b713e4467 100644
--- a/src/test/groovy/transform/stc/AnonymousInnerClassSTCTest.groovy
+++ b/src/test/groovy/transform/stc/AnonymousInnerClassSTCTest.groovy
@@ -145,4 +145,27 @@ class AnonymousInnerClassSTCTest extends StaticTypeCheckingTestCase {
             assert A.foo() == "ii i"
         '''
     }
+
+    // GROOVY-6904
+    void testAICInClosure() {
+        assertScript '''
+            interface X {
+                def m()
+            }
+
+            class A {
+                Object pm = "pm"
+                def bar(Closure<? extends X> x) {x().m()}
+                def foo() {
+                    bar { ->
+                        return new X() {
+                            def m() { pm }
+                        }
+                    }
+                }
+            }
+            def a = new A()
+            assert a.foo() == "pm"
+        '''
+    }
 }
