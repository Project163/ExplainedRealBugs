diff --git a/src/main/org/codehaus/groovy/tools/FileSystemCompiler.java b/src/main/org/codehaus/groovy/tools/FileSystemCompiler.java
index 2133c9c646..41fb874052 100644
--- a/src/main/org/codehaus/groovy/tools/FileSystemCompiler.java
+++ b/src/main/org/codehaus/groovy/tools/FileSystemCompiler.java
@@ -98,61 +98,64 @@ public class FileSystemCompiler {
         return checkFiles(filenames) == 0;
     }
 
+    private static boolean displayStackTraceOnError = false;
+
     /**
-     * Primary entry point for compiling from the command line
-     * (using the groovyc script).
+     * Same as main(args) except that exceptions are thrown out instead of causing
+     * the VM to exit.
      */
-    public static void main(String[] args) {
-        boolean displayStackTraceOnError = false;
+    public static void commandLineCompile(String[] args) throws Exception {
+        Options options = createCompilationOptions();
 
-        try {
-            Options options = createCompilationOptions();
+        PosixParser cliParser = new PosixParser();
+
+        CommandLine cli;
+        cli = cliParser.parse(options, args);
 
-            PosixParser cliParser = new PosixParser();
+        if (cli.hasOption('h')) {
+            displayHelp(options);
+            return;
+        }
 
-            CommandLine cli;
-            cli = cliParser.parse(options, args);
+        if (cli.hasOption('v')) {
+            displayVersion();
+            return;
+        }
 
-            if (cli.hasOption('h')) {
-                displayHelp(options);
-                return;
-            }
+        displayStackTraceOnError = cli.hasOption('e');
 
-            if (cli.hasOption('v')) {
-                displayVersion();
-                return;
-            }
+        CompilerConfiguration configuration = generateCompilerConfigurationFromOptions(cli);
 
-            displayStackTraceOnError = cli.hasOption('e');
+        //
+        // Load the file name list
+        String[] filenames = generateFileNamesFromOptions(cli);
+        boolean fileNameErrors = filenames == null;
+        if (!fileNameErrors && (filenames.length == 0)) {
+            displayHelp(options);
+            return;
+        }
 
-            CompilerConfiguration configuration = generateCompilerConfigurationFromOptions(cli);
+        fileNameErrors = fileNameErrors && !validateFiles(filenames);
 
-            //
-            // Load the file name list
-            String[] filenames = generateFileNamesFromOptions(cli);
-            boolean fileNameErrors = filenames == null;
-            if (!fileNameErrors && (filenames.length == 0)) {
-                displayHelp(options);
-                return;
-            }
+        if (!fileNameErrors) {
+            doCompilation(configuration, null, filenames);
+        }
+    }
 
-            fileNameErrors = fileNameErrors && !validateFiles(filenames);
+    /**
+     * Primary entry point for compiling from the command line
+     * (using the groovyc script).
+     *
+     * If calling inside a process and you don't want the JVM to exit on an
+     * error call commandLineCompile(String[]), which this method simply wraps 
+     */
+    public static void main(String[] args) {
 
-            if (!fileNameErrors) {
-                doCompilation(configuration, null, filenames);
-            }
+        try {
+            commandLineCompile(args);
         } catch( Throwable e ) {
-            RuntimeException re = new RuntimeException();
-            if (re.getStackTrace().length > 1) {
-                if (e instanceof RuntimeException) {
-                    re = (RuntimeException) e;
-                } else {
-                    re.initCause(e);
-                }
-            } else {
-                new ErrorReporter( e, displayStackTraceOnError ).write( System.err );
-                System.exit(1);
-            }
+            new ErrorReporter( e, displayStackTraceOnError).write( System.err );
+            System.exit(1);
         }
     }
 
diff --git a/src/test/org/codehaus/groovy/tools/FileSystemCompilerTest.java b/src/test/org/codehaus/groovy/tools/FileSystemCompilerTest.java
index 685434ce7e..86d8b8ce78 100644
--- a/src/test/org/codehaus/groovy/tools/FileSystemCompilerTest.java
+++ b/src/test/org/codehaus/groovy/tools/FileSystemCompilerTest.java
@@ -100,5 +100,18 @@ public class FileSystemCompilerTest extends GroovyTestCase {
 
         compiler = new FileSystemCompiler(configuration);
     }
+                               
+    public void testCommandLine() throws Exception {
+        try {
+            FileSystemCompiler.commandLineCompile(new String[] {"--bogus-option"});
+            fail("Compiler fails to reject bogus command line");
+        } catch (Exception re) {
+            // this is why shouldFail {} exists in Groovy tests
+        }
+
+        File dir = new File("target/test-generated-classes/cl");
+        dir.mkdirs();
+        FileSystemCompiler.commandLineCompile(new String[] {"src/test/groovy/LittleClosureTest.groovy", "-d", dir.getPath()});
+    }
 
 }
