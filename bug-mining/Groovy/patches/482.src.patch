diff --git a/src/main/org/codehaus/groovy/classgen/AsmClassGenerator.java b/src/main/org/codehaus/groovy/classgen/AsmClassGenerator.java
index 456097d985..571d0e41aa 100644
--- a/src/main/org/codehaus/groovy/classgen/AsmClassGenerator.java
+++ b/src/main/org/codehaus/groovy/classgen/AsmClassGenerator.java
@@ -730,13 +730,17 @@ public class AsmClassGenerator extends ClassGenerator {
 
         Label l0 = new Label();
         mv.visitJumpInsn(IFEQ, l0);
+        compileStack.pushBooleanExpression();
         visitAndAutoboxBoolean(truePart);
-
+        compileStack.pop();
+        
         Label l1 = new Label();
         mv.visitJumpInsn(GOTO, l1);
         mv.visitLabel(l0);
-
+        compileStack.pushBooleanExpression();
         visitAndAutoboxBoolean(falsePart);
+        compileStack.pop();
+        
         mv.visitLabel(l1);
     }
 
diff --git a/src/test/groovy/operator/TernaryOperatorsTest.groovy b/src/test/groovy/operator/TernaryOperatorsTest.groovy
index 1e4bbe2d10..67eecd68a2 100644
--- a/src/test/groovy/operator/TernaryOperatorsTest.groovy
+++ b/src/test/groovy/operator/TernaryOperatorsTest.groovy
@@ -53,4 +53,12 @@ class TernaryOperatorsTest extends GroovyTestCase {
         int anInt = b ? 100 : 100 / 3
         assert anInt.class == Integer
     }
-}
+    
+    void testBytecodeRegisters() {
+        // this code will blow up if the true and false parts
+        // are not handled correctly in regards to the registers.
+        def i = 1
+        def c= { false? { i } : it == i }
+        assert true
+    }
+}   
