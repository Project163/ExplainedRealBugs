diff --git a/src/main/groovy/servlet/AbstractHttpServlet.java b/src/main/groovy/servlet/AbstractHttpServlet.java
index 9b84e8d0ae..8daf2011ea 100644
--- a/src/main/groovy/servlet/AbstractHttpServlet.java
+++ b/src/main/groovy/servlet/AbstractHttpServlet.java
@@ -111,7 +111,7 @@ public abstract class AbstractHttpServlet extends HttpServlet implements Resourc
 
     /**
      * Either <code>null</code> or a compiled pattern matcher read from "{@code resource.name.regex}"
-     * and used in {@link AbstractHttpServlet#getResourceConnection(String)}.
+     * and used in {@link AbstractHttpServlet#getScriptUri(HttpServletRequest)}.
      */
     protected Matcher resourceNameMatcher;
 
@@ -170,26 +170,6 @@ public abstract class AbstractHttpServlet extends HttpServlet implements Resourc
         String basePath = servletContext.getRealPath("/");
         if (name.startsWith(basePath)) name = name.substring(basePath.length());
         
-        /*
-         * First, mangle resource name with the compiled pattern.
-         */
-        Matcher matcher = resourceNameMatcher;
-        if (matcher != null) {
-            matcher.reset(name);
-            String replaced;
-            if (resourceNameReplaceAll) {
-                replaced = resourceNameMatcher.replaceAll(resourceNameReplacement);
-            } else {
-                replaced = resourceNameMatcher.replaceFirst(resourceNameReplacement);
-            }
-            if (!name.equals(replaced)) {
-                if (verbose) {
-                    log("Replaced resource name \"" + name + "\" with \"" + replaced + "\".");
-                }
-                name = replaced; 
-            }
-        }
-        
         name = name.replaceAll("\\\\", "/");
         
         //remove the leading / as we are trying with a leading / now
@@ -270,7 +250,7 @@ public abstract class AbstractHttpServlet extends HttpServlet implements Resourc
             if (info != null) {
                 uri += info;
             }
-            return uri;
+            return applyResourceNameMatcher(uri);
         }
 
         //
@@ -289,6 +269,30 @@ public abstract class AbstractHttpServlet extends HttpServlet implements Resourc
          * http://cvs.groovy.codehaus.org/viewrep/groovy/groovy/groovy-core/src/main/groovy/servlet/GroovyServlet.java?r=1.10#l259 
          */
 
+        return applyResourceNameMatcher(uri);
+    }
+	
+    private String applyResourceNameMatcher(final String aUri) {
+        /*
+         * mangle resource name with the compiled pattern.
+         */
+        String uri = aUri;
+        Matcher matcher = resourceNameMatcher;
+        if (matcher != null) {
+            matcher.reset(uri);
+            String replaced;
+            if (resourceNameReplaceAll) {
+                replaced = matcher.replaceAll(resourceNameReplacement);
+            } else {
+                replaced = matcher.replaceFirst(resourceNameReplacement);
+            }
+            if (!uri.equals(replaced)) {
+                if (verbose) {
+                    log("Replaced resource name \"" + uri + "\" with \"" + replaced + "\".");
+                }
+                uri = replaced;
+            }
+        }
         return uri;
     }
 
diff --git a/src/test/groovy/servlet/AbstractHttpServletTest.groovy b/src/test/groovy/servlet/AbstractHttpServletTest.groovy
index 4f49054a9d..b2568bd0fa 100644
--- a/src/test/groovy/servlet/AbstractHttpServletTest.groovy
+++ b/src/test/groovy/servlet/AbstractHttpServletTest.groovy
@@ -194,11 +194,16 @@ class AbstractHttpServletTest extends GroovyTestCase {
 		        else  return null
 		    }] as ServletConfig
 
+        def request = [ 
+            getAttribute: {null}, 
+            getServletPath: {"/somefoo/foo"}, 
+            getPathInfo: {null}] as HttpServletRequest
+            
 		//servlet config is used to find resources
 		servlet.init(servletConfig)    
-
+        
 		//replace first foo with bar in resources
-		def connection = servlet.getResourceConnection("/somefoo/foo")
+		def connection = servlet.getResourceConnection(servlet.getScriptUri(request))
 		//expecting http://somebar/foo
 		def actual = connection.getURL().toExternalForm() 
 		def expected = new URL("file:realPath/somebar/foo").toExternalForm()
@@ -226,11 +231,16 @@ class AbstractHttpServletTest extends GroovyTestCase {
 		        else  return null
 		    }] as ServletConfig
 
+        def request = [ 
+            getAttribute: {null}, 
+            getServletPath: {"/somefoo/foo"}, 
+            getPathInfo: {null}] as HttpServletRequest
+            
 		//servlet config is used to find resources
 		servlet.init(servletConfig)    
 
-		//replace first foo with bar in resources
-		def connection = servlet.getResourceConnection("/somefoo/foo")
+		//replace all foo(s) with bar in resources
+        def connection = servlet.getResourceConnection(servlet.getScriptUri(request))
 		//expecting http://somebar/foo
 		def actual = connection.getURL().toExternalForm() 
 		def expected = new URL("file:realPath/somebar/bar").toExternalForm()
