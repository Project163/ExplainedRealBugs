diff --git a/src/main/org/codehaus/groovy/ast/ClassNode.java b/src/main/org/codehaus/groovy/ast/ClassNode.java
index a9039e477a..25925910a3 100644
--- a/src/main/org/codehaus/groovy/ast/ClassNode.java
+++ b/src/main/org/codehaus/groovy/ast/ClassNode.java
@@ -64,6 +64,7 @@ public class ClassNode extends MetadataNode implements Constants {
     private List properties = new ArrayList();
     private Map fieldIndex = new HashMap();
     private ModuleNode module;
+    private boolean staticClass = false;
 
     /**
      * @param name
@@ -383,4 +384,16 @@ public class ClassNode extends MetadataNode implements Constants {
         return null;
     }
 
+    /**
+     * Is this class delcared in a static method (such as a closure / inner class declared in a static method)
+     * @return
+     */
+    public boolean isStaticClass() {
+        return staticClass;
+    }
+
+    public void setStaticClass(boolean staticClass) {
+        this.staticClass = staticClass;
+    }
+
 }
diff --git a/src/main/org/codehaus/groovy/classgen/ClassGenerator.java b/src/main/org/codehaus/groovy/classgen/ClassGenerator.java
index 53111568f0..bbcd3267e0 100644
--- a/src/main/org/codehaus/groovy/classgen/ClassGenerator.java
+++ b/src/main/org/codehaus/groovy/classgen/ClassGenerator.java
@@ -1004,7 +1004,7 @@ public class ClassGenerator extends CodeVisitorSupport implements GroovyClassVis
 
         ClassNode owner = innerClass.getOuterClass();
         String ownerTypeName = owner.getName();
-        if (isStaticMethod()) {
+        if (classNode.isStaticClass() || isStaticMethod()) {
             ownerTypeName = "java.lang.Class";
         }
 
@@ -1335,8 +1335,13 @@ public class ClassGenerator extends CodeVisitorSupport implements GroovyClassVis
         int tempIndex = defineVariable(createVariableName("field"), "java.lang.Object", false).getIndex();
 
         if (leftHandExpression && !holder) {
-            // this may be superflous
-            doConvertAndCast(type);
+            if (isInClosureConstructor()) {
+                doCast(type);
+            }
+            else {
+	            // this may be superflous
+	            doConvertAndCast(type);
+            }
         }
         int opcode =
             (leftHandExpression && !holder) ? ((isStatic) ? PUTSTATIC : PUTFIELD) : ((isStatic) ? GETSTATIC : GETFIELD);
@@ -1766,7 +1771,8 @@ public class ClassGenerator extends CodeVisitorSupport implements GroovyClassVis
         }
         String outerClassName = owner.getName();
         String name = outerClassName + "$" + context.getNextInnerClassIdx();
-        if (isStaticMethod()) {
+        boolean staticMethodOrInStaticClass = isStaticMethod() || classNode.isStaticClass();
+        if (staticMethodOrInStaticClass) {
             outerClassName = "java.lang.Class";
         }
         Parameter[] parameters = expression.getParameters();
@@ -1778,6 +1784,10 @@ public class ClassGenerator extends CodeVisitorSupport implements GroovyClassVis
         Parameter[] localVariableParams = getClosureSharedVariables(expression);
 
         InnerClassNode answer = new InnerClassNode(owner, name, ACC_PUBLIC, "groovy.lang.Closure");
+        if (staticMethodOrInStaticClass) {
+            //System.out.println("#### Declaring closure in static method");
+            answer.setStaticClass(true);
+        }
         answer.addMethod("doCall", ACC_PUBLIC, "java.lang.Object", parameters, expression.getCode());
         if (parameters.length > 1
             || (parameters.length == 1
diff --git a/src/test/groovy/bugs/StaticMarkupBug.groovy b/src/test/groovy/bugs/StaticMarkupBug.groovy
new file mode 100644
index 0000000000..6b4f0d8744
--- /dev/null
+++ b/src/test/groovy/bugs/StaticMarkupBug.groovy
@@ -0,0 +1,16 @@
+import groovy.xml.MarkupBuilder
+
+class StaticMarkupBug extends GroovyTestCase {
+
+    void testBug() {
+        doMarkup(new MarkupBuilder())
+    }
+    
+    static void doMarkup(builder) {
+        builder.html {
+            head {
+                title("Groovy")
+            }
+        }
+    }
+}
\ No newline at end of file
diff --git a/src/test/org/codehaus/groovy/classgen/RunBugsTest.java b/src/test/org/codehaus/groovy/classgen/RunBugsTest.java
index ec1089e094..b4fdd8fcc6 100644
--- a/src/test/org/codehaus/groovy/classgen/RunBugsTest.java
+++ b/src/test/org/codehaus/groovy/classgen/RunBugsTest.java
@@ -83,4 +83,9 @@ public class RunBugsTest extends TestSupport {
         GroovyObject object = compile("src/test/groovy/bugs/UseStaticInClosureBug.groovy");
         object.invokeMethod("testBug2", null);
     } 
+    
+    public void testStaticMarkupBug() throws Exception {
+        GroovyObject object = compile("src/test/groovy/bugs/StaticMarkupBug.groovy");
+        object.invokeMethod("testBug", null);
+    } 
 }
