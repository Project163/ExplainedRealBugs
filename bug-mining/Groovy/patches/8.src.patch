diff --git a/src/main/org/codehaus/groovy/classgen/ClassGenerator.java b/src/main/org/codehaus/groovy/classgen/ClassGenerator.java
index 743796406a..40f7b081d4 100644
--- a/src/main/org/codehaus/groovy/classgen/ClassGenerator.java
+++ b/src/main/org/codehaus/groovy/classgen/ClassGenerator.java
@@ -1052,8 +1052,11 @@ public class ClassGenerator implements GroovyClassVisitor, GroovyCodeVisitor, Co
                     variable = defineVariable(name, "java.lang.Object");
                 }
                 if (variable == null) {
-                    //System.out.println("No such variable '" + name + "' available, so trying property");
                     visitPropertyExpression(new PropertyExpression(new VariableExpression("this"), variableName));
+                    // We need to store this in a local variable now since it has been looked at in this scope and possibly
+                    // compared and it hasn't been referenced before.
+					cv.visitInsn(DUP);
+					cv.visitVarInsn(ASTORE, idx + 1);
                     return;
                 }
                 String type = variable.getType();
diff --git a/src/test/groovy/IfPropertyTest.groovy b/src/test/groovy/IfPropertyTest.groovy
new file mode 100644
index 0000000000..8ba0845789
--- /dev/null
+++ b/src/test/groovy/IfPropertyTest.groovy
@@ -0,0 +1,25 @@
+class IfPropertyTest extends GroovyTestCase {
+	
+	// This is because normal classes are not extensible, but scripts are extensible by default.
+	Object get(String key) {
+		return null
+	}
+
+    void testIfNullPropertySet() {
+		if (cheese == null) {
+			cheese = 1
+		}
+		assert cheese == 1
+    }
+    
+    void testIfNullPropertySetRecheck() {
+		if (cheese == null) {
+			cheese = 1
+		}
+		if (cheese == 1) {
+			cheese = 2
+		}
+		assert cheese == 2
+    }
+    
+}
