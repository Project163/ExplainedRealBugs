diff --git a/build.xml b/build.xml
index dcdf260652..1840f128a5 100644
--- a/build.xml
+++ b/build.xml
@@ -461,6 +461,7 @@ $Date$
                 <include name="groovy/ui/**/*.png"/>
                 <include name="groovy/inspect/swingui/AstBrowserProperties.groovy"/>
                 <include name="org/codehaus/groovy/tools/shell/**/*.properties"/>
+                <include name="org/codehaus/groovy/tools/groovydoc/**/*.properties"/>
                 <include name="org/codehaus/groovy/tools/shell/**/*.xml"/>
                 <include name="org/codehaus/groovy/antlib.xml"/>
             </fileset>
@@ -653,6 +654,12 @@ $Date$
                 <filter token="GROOVYJAR" value="groovy-${groovyVersion}.jar"/>
             </filterset>
         </copy>
+        <!-- icon -->
+        <copy todir="${installDirectory}/bin" flatten="true">
+            <fileset dir="${toolsSourceDirectory}">
+                <include name="org/codehaus/groovy/tools/groovy.ico"/>
+            </fileset>
+        </copy>
 
         <!-- Tweak scripts for platform compatibility -->
         <fixcrlf srcdir="${installDirectory}/bin" eol="lf" excludes="*.bat"/>
diff --git a/src/bin/groovydoc b/src/bin/groovydoc
new file mode 100644
index 0000000000..a4c4d0f6fa
--- /dev/null
+++ b/src/bin/groovydoc
@@ -0,0 +1,33 @@
+#!/bin/sh
+
+##############################################################################
+##                                                                          ##
+##  Groovy JVM Bootstrap for UN*X                                           ##
+##                                                                          ##
+##############################################################################
+
+##
+## $Revision$
+## $Date$
+##
+
+GROOVY_APP_NAME=GroovyDoc
+
+# resolve links - $0 may be a soft-link
+PRG="$0"
+
+while [ -h "$PRG" ] ; do
+    ls=`ls -ld "$PRG"`
+    link=`expr "$ls" : '.*-> \(.*\)$'`
+    if expr "$link" : '/.*' > /dev/null; then
+        PRG="$link"
+    else
+        PRG=`dirname "$PRG"`/"$link"
+    fi
+done
+
+DIRNAME=`dirname "$PRG"`
+
+. "$DIRNAME/startGroovy"
+
+startGroovy org.codehaus.groovy.tools.groovydoc.Main "$@"
diff --git a/src/bin/groovydoc.bat b/src/bin/groovydoc.bat
new file mode 100644
index 0000000000..e2db1e0a97
--- /dev/null
+++ b/src/bin/groovydoc.bat
@@ -0,0 +1,18 @@
+@if "%DEBUG%" == "" @echo off
+
+@rem 
+@rem $Revision$ $Date$
+@rem 
+
+@rem Set local scope for the variables with windows NT shell
+if "%OS%"=="Windows_NT" setlocal
+
+:begin
+@rem Determine what directory it is in.
+set DIRNAME=%~dp0
+if "%DIRNAME%" == "" set DIRNAME=.\
+
+"%DIRNAME%\startGroovy.bat" "%DIRNAME%" org.codehaus.groovy.tools.groovydoc.Main %*
+
+@rem End local scope for the variables with windows NT shell
+if "%OS%"=="Windows_NT" endlocal
\ No newline at end of file
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/GroovyDocWriter.java b/src/main/org/codehaus/groovy/tools/groovydoc/GroovyDocWriter.java
index c341e8e152..31a4e710ba 100644
--- a/src/main/org/codehaus/groovy/tools/groovydoc/GroovyDocWriter.java
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/GroovyDocWriter.java
@@ -15,6 +15,7 @@
  */
 package org.codehaus.groovy.tools.groovydoc;
 
+import java.io.File;
 import java.util.Arrays;
 import java.util.Iterator;
 
@@ -52,6 +53,7 @@ public class GroovyDocWriter {
 
     public void writePackages(GroovyRootDoc rootDoc, String destdir) throws Exception {
         for (GroovyPackageDoc packageDoc : Arrays.asList(rootDoc.specifiedPackages())) {
+            if (new File(packageDoc.name()).isAbsolute()) continue;
             output.makeOutputArea(destdir + FS + packageDoc.name());
             writePackageToOutput(packageDoc, destdir);
         }
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/GroovyRootDocBuilder.java b/src/main/org/codehaus/groovy/tools/groovydoc/GroovyRootDocBuilder.java
index 2a18142a8b..c2d4607f58 100644
--- a/src/main/org/codehaus/groovy/tools/groovydoc/GroovyRootDocBuilder.java
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/GroovyRootDocBuilder.java
@@ -158,10 +158,15 @@ public class GroovyRootDocBuilder {
         }
 
         for (String filename : filenames) {
+            File srcFile = new File(filename);
+            if (srcFile.exists()) {
+                processFile(filename, srcFile, true);
+                continue;
+            }
             for (File spath : sourcepathFiles) {
-                File srcFile = new File(spath, filename);
+                srcFile = new File(spath, filename);
                 if (srcFile.exists()) {
-                    processFile(filename, srcFile);
+                    processFile(filename, srcFile, false);
                     break;
                 }
             }
@@ -180,15 +185,19 @@ public class GroovyRootDocBuilder {
         }
     }
 
-    private void processFile(String filename, File srcFile) throws IOException {
+    private void processFile(String filename, File srcFile, boolean isAbsolute) throws IOException {
         String src = DefaultGroovyMethods.getText(srcFile);
-        String packagePath = tool.getPath(filename).replace('\\', FS);
+        String packagePath = isAbsolute ? "DefaultPackage" : tool.getPath(filename).replace('\\', FS);
         String file = tool.getFile(filename);
-        SimpleGroovyPackageDoc packageDoc = (SimpleGroovyPackageDoc) rootDoc.packageNamed(packagePath);
-        if (packageDoc == null) {
-            packageDoc = new SimpleGroovyPackageDoc(packagePath);
+        SimpleGroovyPackageDoc packageDoc = null;
+        if (!isAbsolute) {
+            packageDoc = (SimpleGroovyPackageDoc) rootDoc.packageNamed(packagePath);
         }
+        // todo: this might not work correctly for absolute paths
         if (filename.endsWith("package.html") || filename.endsWith("package-info.java") || filename.endsWith("package-info.groovy")) {
+            if (packageDoc == null) {
+                packageDoc = new SimpleGroovyPackageDoc(packagePath);
+            }
             processPackageInfo(src, filename, packageDoc);
             rootDoc.put(packagePath, packageDoc);
             return;
@@ -196,6 +205,16 @@ public class GroovyRootDocBuilder {
         try {
             Map<String, GroovyClassDoc> classDocs = getClassDocsFromSingleSource(packagePath, file, src);
             rootDoc.putAllClasses(classDocs);
+            if (isAbsolute) {
+                final Map.Entry<String, GroovyClassDoc> docEntry = classDocs.entrySet().iterator().next();
+                String fullPath = docEntry.getValue().getFullPathName();
+                int slash = fullPath.lastIndexOf(FS);
+                if (slash > 0) packagePath = fullPath.substring(0, slash);
+                packageDoc = (SimpleGroovyPackageDoc) rootDoc.packageNamed(packagePath);
+            }
+            if (packageDoc == null) {
+                packageDoc = new SimpleGroovyPackageDoc(packagePath);
+            }
             packageDoc.putAll(classDocs);
             rootDoc.put(packagePath, packageDoc);
         } catch (RecognitionException e) {
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/Main.groovy b/src/main/org/codehaus/groovy/tools/groovydoc/Main.groovy
new file mode 100644
index 0000000000..c575311680
--- /dev/null
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/Main.groovy
@@ -0,0 +1,217 @@
+/*
+ * Copyright 2003-2010 the original author or authors.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.codehaus.groovy.tools.groovydoc
+
+import org.codehaus.groovy.runtime.InvokerHelper
+import org.codehaus.groovy.tools.shell.util.Logger
+import org.codehaus.groovy.tools.shell.util.MessageSource
+import org.codehaus.groovy.tools.shell.IO
+import org.codehaus.groovy.tools.groovydoc.gstringTemplates.GroovyDocTemplateInfo
+import groovy.io.FileType
+
+/**
+ * Main CLI entry-point for <tt>groovydoc</tt>.
+ *
+ * @author Paul King
+ */
+class Main {
+    private static final MessageSource messages = new MessageSource(Main)
+    private static File styleSheetFile;
+    private static File overviewFile
+    private static File destDir
+    private static String windowTitle
+    private static String docTitle
+    private static String header
+    private static String footer
+    private static Boolean author
+    private static Boolean privateScope
+    private static Boolean packageScope
+    private static Boolean publicScope
+    private static Boolean protectedScope
+    private static Boolean debug = false
+    private static String[] sourcepath
+    private static List<String> sourceFilesToDoc
+    private static List<String> remainingArgs
+    private static List<String> exclusions
+
+    static void main(final String[] args) {
+        IO io = new IO()
+        Logger.io = io
+
+        def cli = new CliBuilder(usage : 'groovydoc [options] [packagenames] [sourcefiles]', writer: io.out, posix:false)
+
+        cli.help(longOpt: 'help', messages['cli.option.help.description'])
+        cli._(longOpt: 'version', messages['cli.option.version.description'])
+        cli.verbose(messages['cli.option.verbose.description'])
+        cli.quiet(messages['cli.option.quiet.description'])
+        // TODO is debug needed?
+        cli._(longOpt: 'debug', messages['cli.option.debug.description'])
+        cli.d(longOpt: 'destdir', args:1, argName: 'dir', messages['cli.option.destdir.description'])
+        cli.author(messages['cli.option.author.description'])
+        cli.overview(args:1, argName: 'file', messages['cli.option.overview.description'])
+        cli.public(messages['cli.option.public.description'])
+        cli.protected(messages['cli.option.protected.description'])
+        cli.package(messages['cli.option.package.description'])
+        cli.private(messages['cli.option.private.description'])
+        cli.windowtitle(args:1, argName: 'text', messages['cli.option.windowtitle.description'])
+        cli.doctitle(args:1, argName: 'html', messages['cli.option.doctitle.description'])
+        cli.header(args:1, argName: 'html', messages['cli.option.header.description'])
+        cli.footer(args:1, argName: 'html', messages['cli.option.footer.description'])
+        cli.exclude(args:1, argName: 'pkglist', messages['cli.option.exclude.description'])
+        cli.stylesheetfile(args:1, argName: 'path', messages['cli.option.stylesheetfile.description'])
+        cli.sourcepath(args:1, argName: 'pathlist', messages['cli.option.sourcepath.description'])
+
+        def options = cli.parse(args)
+
+        if (options.help) {
+            cli.usage()
+            return
+        }
+
+        if (options.version) {
+            io.out.println(messages.format('cli.info.version', InvokerHelper.version))
+            return
+        }
+
+        if (options.stylesheetfile) {
+            styleSheetFile = new File(options.stylesheetfile)
+        }
+
+        if (options.overview) {
+            overviewFile = new File(options.overview)
+        }
+
+        destDir = new File(options.d ?: '.')
+
+        if (options.exclude) {
+            exclusions = options.exclude.tokenize(':')
+        }
+
+        if (options.sourcepath) {
+            def list = []
+            options.sourcepaths.each {
+                list.addAll(it.tokenize(File.pathSeparator))
+            }
+            sourcepath = list.toArray()
+        }
+
+        author = Boolean.valueOf(options.author) ?: false
+        packageScope = Boolean.valueOf(options.package) ?: false
+        privateScope = Boolean.valueOf(options.private) ?: false
+        protectedScope = Boolean.valueOf(options.protected) ?: true
+        publicScope = Boolean.valueOf(options.public) ?: true
+
+        windowTitle = options.windowtitle ?: ''
+        docTitle = options.doctitle ?: ''
+        header = options.header ?: ''
+        footer = options.footer ?: ''
+
+        if (options.Ds) {
+            def values = options.Ds
+            values.each {
+                setSystemProperty(it as String)
+            }
+        }
+
+        if (options.verbose) {
+            io.verbosity = IO.Verbosity.VERBOSE
+        }
+
+        if (options.debug) {
+            io.verbosity = IO.Verbosity.DEBUG
+            debug = true
+        }
+
+        if (options.quiet) {
+            io.verbosity = IO.Verbosity.QUIET
+        }
+        remainingArgs = options.arguments()
+        if (!remainingArgs) {
+            println "groovydoc: Error - No packages or classes specified."
+            cli.usage()
+            return
+        }
+        execute()
+    }
+
+    static void execute() {
+        Properties properties = new Properties()
+        properties.put("windowTitle", windowTitle)
+        properties.put("docTitle", docTitle)
+        properties.put("footer", footer)
+        properties.put("header", header)
+        properties.put("privateScope", privateScope.toString())
+        properties.put("protectedScope", protectedScope.toString())
+        properties.put("publicScope", publicScope.toString())
+        properties.put("packageScope", packageScope.toString())
+        properties.put("author", author.toString())
+        properties.put("overviewFile", overviewFile?.absolutePath ?: "")
+
+        def links = new ArrayList<LinkArgument>();
+        collectSourceFileNames(remainingArgs, sourcepath, exclusions)
+        GroovyDocTool htmlTool = new GroovyDocTool(
+                new ClasspathResourceManager(), // we're gonna get the default templates out of the dist jar file
+                sourcepath,
+                GroovyDocTemplateInfo.DEFAULT_DOC_TEMPLATES,
+                GroovyDocTemplateInfo.DEFAULT_PACKAGE_TEMPLATES,
+                GroovyDocTemplateInfo.DEFAULT_CLASS_TEMPLATES,
+                links,
+                properties
+        )
+
+        htmlTool.add(sourceFilesToDoc)
+        FileOutputTool output = new FileOutputTool()
+        htmlTool.renderToOutput(output, destDir.canonicalPath)
+
+        // try to override the default stylesheet with custom specified one if needed
+        if (styleSheetFile != null) {
+            try {
+                new File(destDir, "stylesheet.css").text = styleSheetFile.text
+            } catch (IOException e) {
+                println "Warning: Unable to copy specified stylesheet '" + styleSheetFile.absolutePath + "'. Using default stylesheet instead. Due to: " + e.message
+            }
+        }
+    }
+
+    static collectSourceFileNames(List<String> remainingArgs, String[] sourceDirs, List<String> exclusions) {
+        sourceFilesToDoc = []
+        remainingArgs.each { String pkgOrFile ->
+            if (pkgOrFile in exclusions) return
+            File srcFile = new File(pkgOrFile)
+            if (srcFile.exists() && srcFile.isFile()) {
+                sourceFilesToDoc << pkgOrFile
+                return
+            }
+            sourceDirs.each { dirStr ->
+                def dir = new File(dirStr)
+                def pkgOrFileSlashes = pkgOrFile.replace(".", "/")
+                def candidate = new File(dir, pkgOrFile);
+                if (candidate.exists() && candidate.isFile()) {
+                    // assume it is some kind of file
+                    sourceFilesToDoc << pkgOrFile
+                }
+                candidate = new File(dir, pkgOrFileSlashes);
+                if (candidate.exists() && candidate.isDirectory()) {
+                    // TODO handle other extensions too, make configurable
+                    candidate.eachFileMatch(FileType.FILES, ~/.*\.(?:groovy|java)/) { File f ->
+                        sourceFilesToDoc << pkgOrFileSlashes + "/" + f.getName()
+                    }
+                }
+            }
+        }
+    }
+
+}
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/Main.properties b/src/main/org/codehaus/groovy/tools/groovydoc/Main.properties
new file mode 100644
index 0000000000..2a7dee0c2e
--- /dev/null
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/Main.properties
@@ -0,0 +1,59 @@
+#
+# Copyright 2003-2010 the original author or authors.
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#    http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+#
+
+#
+# CLI messages
+#
+
+cli.option.help.description=Display this help message
+
+cli.option.version.description=Display the version
+
+cli.option.verbose.description=Enable verbose output
+
+cli.option.quiet.description=Suppress superfluous output
+
+cli.option.debug.description=Enable debug output
+
+cli.option.stylesheetfile.description=File to change style of the generated documentation
+
+cli.option.doctitle.description=Include title for the overview page
+
+cli.option.windowtitle.description=Browser window title for the documentation
+
+cli.option.header.description=Include header text for each page
+
+cli.option.footer.description=Include footer text for each page
+
+cli.option.author.description=Include @author paragraphs
+
+cli.option.public.description=Show only public classes and members
+
+cli.option.protected.description=Show protected/public classes and members (default)
+
+cli.option.package.description=Show package/protected/public classes and members
+
+cli.option.private.description=Show all classes and members
+
+cli.option.overview.description=Read overview documentation from HTML file
+
+cli.option.destdir.description=Destination directory for output files
+
+cli.option.sourcepath.description=Specify where to find source files (dirs separated by platform path separator)
+
+cli.option.exclude.description=Specify a list of packages to exclude (separated by colons for all operating systems)
+
+cli.info.version=@|green GroovyDoc|@ {0}
\ No newline at end of file
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/SimpleGroovyClassDoc.java b/src/main/org/codehaus/groovy/tools/groovydoc/SimpleGroovyClassDoc.java
index 079044c429..0d32407828 100644
--- a/src/main/org/codehaus/groovy/tools/groovydoc/SimpleGroovyClassDoc.java
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/SimpleGroovyClassDoc.java
@@ -602,7 +602,8 @@ public class SimpleGroovyClassDoc extends SimpleGroovyProgramElementDoc implemen
     }
 
     public String qualifiedTypeName() {
-        return fullPathName == null ? "null" : fullPathName.replace('/', '.');
+        String qtnWithSlashes = fullPathName.startsWith("DefaultPackage/") ? fullPathName.substring("DefaultPackage/".length()) : fullPathName;
+        return qtnWithSlashes.replace('/', '.');
     }
 
     // TODO remove dupe with SimpleGroovyType
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/SimpleGroovyClassDocAssembler.java b/src/main/org/codehaus/groovy/tools/groovydoc/SimpleGroovyClassDocAssembler.java
index 69993c2427..3d3e32cbac 100644
--- a/src/main/org/codehaus/groovy/tools/groovydoc/SimpleGroovyClassDocAssembler.java
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/SimpleGroovyClassDocAssembler.java
@@ -45,6 +45,8 @@ public class SimpleGroovyClassDocAssembler extends VisitorAdapter implements Gro
     private boolean insideEnum;
     private Map<String, SimpleGroovyClassDoc> foundClasses;
     private boolean isGroovy;
+    private boolean deferSetup;
+    private String className;
 
     public SimpleGroovyClassDocAssembler(String packagePath, String file, SourceBuffer sourceBuffer, List<LinkArgument> links, Properties properties, boolean isGroovy) {
         this.sourceBuffer = sourceBuffer;
@@ -55,14 +57,20 @@ public class SimpleGroovyClassDocAssembler extends VisitorAdapter implements Gro
 
         stack = new Stack<GroovySourceAST>();
         classDocs = new HashMap<String, GroovyClassDoc>();
-        String className = file;
+        className = file;
         if (file != null) {
             // todo: replace this simple idea of default class name
             int idx = file.lastIndexOf(".");
             className = file.substring(0, idx);
         }
 
+        deferSetup = packagePath.equals("DefaultPackage");
         importedClassesAndPackages = new ArrayList<String>();
+        if (!deferSetup) setUpImports(packagePath, links, isGroovy, className);
+        lastLineCol = new LineColumn(1, 1);
+    }
+
+    private void setUpImports(String packagePath, List<LinkArgument> links, boolean isGroovy, String className) {
         importedClassesAndPackages.add(packagePath + "/*");  // everything in this package
         if (isGroovy) {
             for (String pkg : ResolveVisitor.DEFAULT_IMPORTS) {
@@ -74,7 +82,6 @@ public class SimpleGroovyClassDocAssembler extends VisitorAdapter implements Gro
         SimpleGroovyClassDoc currentClassDoc = new SimpleGroovyClassDoc(importedClassesAndPackages, className, links);
         currentClassDoc.setFullPathName(packagePath + FS + className);
         classDocs.put(currentClassDoc.getFullPathName(), currentClassDoc);
-        lastLineCol = new LineColumn(1, 1);
     }
 
     public Map<String, GroovyClassDoc> getGroovyClassDocs() {
@@ -129,6 +136,14 @@ public class SimpleGroovyClassDocAssembler extends VisitorAdapter implements Gro
         }
     }
 
+    @Override
+    public void visitPackageDef(GroovySourceAST t, int visit) {
+        if (visit == OPENING_VISIT && deferSetup) {
+            String packageWithSlashes = extractImportPath(t);
+            setUpImports(packageWithSlashes, links, isGroovy, className);
+        }
+    }
+
     @Override
     public void visitImport(GroovySourceAST t, int visit) {
         if (visit == OPENING_VISIT) {
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/SimpleGroovyType.java b/src/main/org/codehaus/groovy/tools/groovydoc/SimpleGroovyType.java
index ecf7984e06..0e624e8de8 100644
--- a/src/main/org/codehaus/groovy/tools/groovydoc/SimpleGroovyType.java
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/SimpleGroovyType.java
@@ -33,7 +33,7 @@ public class SimpleGroovyType implements GroovyType {
     }
 
     public String qualifiedTypeName() {
-        return typeName;
+        return typeName.startsWith("DefaultPackage.") ? typeName.substring("DefaultPackage.".length()) : typeName;
     }
 
     public String simpleTypeName() {
diff --git a/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/classLevel/classDocName.html b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/classLevel/classDocName.html
index f1324850db..9a13183fb0 100644
--- a/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/classLevel/classDocName.html
+++ b/src/main/org/codehaus/groovy/tools/groovydoc/gstringTemplates/classLevel/classDocName.html
@@ -168,10 +168,15 @@ DETAIL:&nbsp;<%
 <HR>
 <!-- ======== START OF CLASS DATA ======== -->
 <H2>
+<%
+def pkg = classDoc.containingPackage().nameWithDots()
+if (pkg != "DefaultPackage") {
+%>
 <FONT SIZE="-1">
-${classDoc.containingPackage().nameWithDots()}</FONT>
+${pkg}</FONT>
 <BR>
-<FONT CLASS="ClassTitleFont">${classDoc.typeDescription} ${classDoc.name()}</FONT></H2>
+<% } %>
+<span CLASS="ClassTitleFont">${classDoc.typeDescription} ${classDoc.name()}</span></H2>
 <%
 def parents = classDoc.isInterface() ? classDoc.parentInterfaces : classDoc.parentClasses
 if (parents.size() >= 2) {
