diff --git a/src/main/org/codehaus/groovy/antlr/SourceBuffer.java b/src/main/org/codehaus/groovy/antlr/SourceBuffer.java
index 9f2601e39c..1d7f38bee8 100644
--- a/src/main/org/codehaus/groovy/antlr/SourceBuffer.java
+++ b/src/main/org/codehaus/groovy/antlr/SourceBuffer.java
@@ -75,6 +75,7 @@ public class SourceBuffer {
                 if (startColumn < 1) { startColumn = 1;}
                 if (endColumn > line.length()) { endColumn = line.length() + 1;}
                 if (endColumn < 1) { endColumn = 1;}
+                if (endColumn < startColumn) { endColumn = startColumn;}
 
                 line = line.substring(startColumn - 1, endColumn - 1);
             } else {
diff --git a/subprojects/groovy-groovydoc/src/main/java/org/codehaus/groovy/tools/groovydoc/SimpleGroovyClassDocAssembler.java b/subprojects/groovy-groovydoc/src/main/java/org/codehaus/groovy/tools/groovydoc/SimpleGroovyClassDocAssembler.java
index a178a926ee..7439ea7ed5 100644
--- a/subprojects/groovy-groovydoc/src/main/java/org/codehaus/groovy/tools/groovydoc/SimpleGroovyClassDocAssembler.java
+++ b/subprojects/groovy-groovydoc/src/main/java/org/codehaus/groovy/tools/groovydoc/SimpleGroovyClassDocAssembler.java
@@ -986,7 +986,9 @@ public class SimpleGroovyClassDocAssembler extends VisitorAdapter implements Gro
     private SimpleGroovyClassDoc getCurrentClassDoc() {
         if (stack.isEmpty()) return null;
         GroovySourceAST node = getParentNode();
-        if (isTopLevelConstruct(node)) return foundClasses.get(getIdentFor(node));
+        if (isTopLevelConstruct(node) && foundClasses != null) {
+            return foundClasses.get(getIdentFor(node));
+        }
         GroovySourceAST saved = stack.pop();
         SimpleGroovyClassDoc result = getCurrentClassDoc();
         stack.push(saved);
