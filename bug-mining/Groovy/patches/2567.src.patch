diff --git a/subprojects/groovy-docgenerator/src/main/groovy/org/codehaus/groovy/tools/DocGenerator.groovy b/subprojects/groovy-docgenerator/src/main/groovy/org/codehaus/groovy/tools/DocGenerator.groovy
index 79a950ceb2..bb5926a6df 100644
--- a/subprojects/groovy-docgenerator/src/main/groovy/org/codehaus/groovy/tools/DocGenerator.groovy
+++ b/subprojects/groovy-docgenerator/src/main/groovy/org/codehaus/groovy/tools/DocGenerator.groovy
@@ -15,175 +15,147 @@
  */
 package org.codehaus.groovy.tools
 
-import com.thoughtworks.qdox.model.JavaClass
+import com.thoughtworks.qdox.JavaDocBuilder
 import com.thoughtworks.qdox.model.JavaMethod
+import com.thoughtworks.qdox.model.JavaParameter
+import com.thoughtworks.qdox.model.Type
+import groovy.text.SimpleTemplateEngine
+import groovy.text.Template
+import groovy.text.TemplateEngine
 import org.codehaus.groovy.runtime.DefaultGroovyMethods
-import com.thoughtworks.qdox.JavaDocBuilder
 import org.codehaus.groovy.tools.shell.util.Logger
 
+import java.text.BreakIterator
+
 /**
  * Generate documentation about the methods provided by the Groovy Development Kit
  * that enhance the standard JDK classes.
  *
- * @author Guillaume Laforge, John Wilson, Bernhard Huber, Paul King
+ * @author Guillaume Laforge, John Wilson, Bernhard Huber, Paul King, Yasuharu Nakano
  */
 class DocGenerator {
-    private static final String PRIMITIVE_TYPE_PSEUDO_PACKAGE = 'primitive-types'
     private static final Logger log = Logger.create(DocGenerator)
     private static final String TITLE = "Groovy JDK"
-    def sourceFiles = []
-    File outputFolder
-    JavaDocBuilder builder
-    // categorize all groovy methods per core JDK class to which it applies
-    Map<String, List<JavaMethod>> enhancedMethodsForClass = [:]
-    Map<String, JavaClass> enhancedClasses = [:]
-    Map<String, String> packages = [:]
-    Set<String> sortedPackages
-
-    DocGenerator(sourceFiles, File outputFolder) {
+    private static final Comparator SORT_KEY_COMPARATOR = [compare: { a, b -> return a.sortKey.compareTo(b.sortKey) }] as Comparator
+
+    List<File> sourceFiles
+    File outputDir
+    DocSource docSource
+
+    DocGenerator(List<File> sourceFiles, File outputFolder) {
         this.sourceFiles = sourceFiles
-        this.outputFolder = outputFolder
-        parse()
+        this.outputDir = outputFolder
+        this.docSource = parseSource(sourceFiles)
     }
 
     /**
      * Parse the DefaultGroovyMethods class to build a graph representing the structure of the class,
      * with its methods, javadoc comments and tags.
      */
-    private void parse() {
-        builder = new JavaDocBuilder()
+    private static DocSource parseSource(List<File> sourceFiles) {
+        JavaDocBuilder builder = new JavaDocBuilder()
         sourceFiles.each {
             if (it.exists()) {
                 builder.addSource(it.newReader())
                 log.debug "adding reader for $it"
-            } else log.debug "not found, skipping: $it.path"
-        }
-
-        def sources = builder.getSources()
-
-        def methods = []
-        sources.each {source ->
-            def classes = source.getClasses()
-            classes.each {aClass ->
-                methods.addAll(aClass.methods.findAll { !it.annotations.any { it.type.fullyQualifiedName == 'java.lang.Deprecated' } })
+            } else {
+                log.debug "not found, skipping: $it.path"
             }
         }
 
-        for (method in methods) {
-            if (method.isPublic() && method.isStatic()) {
-                def parameters = method.parameters
-                if (parameters.size() == 0) continue
-                String jdkClass = parameters[0].type.toString()
-                if (jdkClass.equals('T') || jdkClass.equals('U') || jdkClass.equals('E') || jdkClass.equals('K') || jdkClass.equals('V') || jdkClass.equals('G')) {
-                    jdkClass = 'java.lang.Object'
-                } else if (jdkClass.equals('T[]') || jdkClass.equals('E[]')) {
-                    jdkClass = 'java.lang.Object[]'
-                }
-                if (jdkClass.startsWith('groovy')) {
-                    log.debug "skipping $jdkClass"
-                    continue
-                }
-                String key = jdkClass //.endsWith('[]') ? jdkClass[0..-3] : jdkClass
-                if (enhancedMethodsForClass.containsKey(key)) {
-                    List l = enhancedMethodsForClass[key];
-                    l.add(method)
-                }
-                else {
-                    enhancedMethodsForClass[key] = [method]
-                    enhancedClasses[key] = parameters[0].type.javaClass
-                }
+        def methods = builder.sources.collectMany { source ->
+            source.classes.collectMany { aClass ->
+                aClass.methods.findAll { !it.annotations.any { it.type.fullyQualifiedName == 'java.lang.Deprecated' } }
             }
         }
 
-        enhancedMethodsForClass.keySet().each {className ->
-            def thePackage = className.contains(".") ? className.replaceFirst(/\.[^\.]*$/, "") : ""
-            if (!packages.containsKey(thePackage)) {
-                packages[thePackage] = []
+        def docSource = new DocSource()
+        methods.each { JavaMethod method ->
+            if (!method.isPublic() || !method.isStatic()) {
+                return // skip it
             }
-            packages[thePackage] << className
+            def firstParamType = method.parameters[0].type
+            if (firstParamType.javaClass.fullyQualifiedName.startsWith('groovy')) {
+                return // nothing, skip it
+            }
+            docSource.add(firstParamType, method)
         }
-        sortedPackages = new TreeSet(packages.keySet())
+        return docSource
     }
 
     /**
      * Builds an HTML page from the structure of DefaultGroovyMethods.
      */
-    def generateNew() {
-        def engine = new groovy.text.SimpleTemplateEngine()
-
-        // the index
-        def templateIndex = createTemplate(engine, 'index.html')
-        def out = new File(outputFolder, 'index.html')
-        def binding = [packages: sortedPackages]
-        out.withWriter {
-            it << templateIndex.make(binding)
-        }
-        // the overview
-        def templateOverview = createTemplate(engine, 'overview-summary.html')
-        out = new File(outputFolder, 'overview-summary.html')
-        binding = [packages: sortedPackages]
-        out.withWriter {
-            it << templateOverview.make(binding)
-        }
-
-        def templateOverviewFrame = createTemplate(engine, 'template.overview-frame.html')
-        out = new File(outputFolder, 'overview-frame.html')
-        binding = [packages: sortedPackages, title: TITLE]
-        out.withWriter {
-            it << templateOverviewFrame.make(binding)
-        }
-        
-        // the package list
-        out = new File(outputFolder, 'package-list')
-        out.withWriter { writer ->
-            packages.keySet().findAll{ it }.each{ writer.println it }
-        }
-        
+    void generateAll() {
+        def engine = new SimpleTemplateEngine()
+
+        // the index.html
+        def indexTemplate = createTemplate(engine, 'index.html')
+        new File(outputDir, 'index.html').withWriter {
+            it << indexTemplate.make()
+        }
+
+        // the overview-summary.html
+        def overviewTemplate = createTemplate(engine, 'overview-summary.html')
+        new File(outputDir, 'overview-summary.html').withWriter {
+            it << overviewTemplate.make()
+        }
+
+        // the overview-frame.html
+        def overviewFrameTemplate = createTemplate(engine, 'template.overview-frame.html')
+        new File(outputDir, 'overview-frame.html').withWriter {
+            def docPackagesExceptPrimitiveType = docSource.packages.findAll { !it.primitive }
+            it << overviewFrameTemplate.make(packages: docPackagesExceptPrimitiveType, title: TITLE)
+        }
+
+        // the package-list
+        new File(outputDir, 'package-list').withWriter { writer ->
+            docSource.packages*.name.each { writer.println it }
+        }
+
         // the allclasses-frame.html
-        def templateAllClasses = createTemplate(engine, 'template.allclasses-frame.html')
-        out = new File(outputFolder, 'allclasses-frame.html')
-        def fixPrimitivePackage = {className -> className.contains('.') ? className : "${PRIMITIVE_TYPE_PSEUDO_PACKAGE}.$className"}
-        binding = [classes: enhancedMethodsForClass.keySet().collect(fixPrimitivePackage).sort {it.replaceAll('.*\\.', '')}]
-        out.withWriter {
-            it << templateAllClasses.make(binding)
+        def allClassesTemplate = createTemplate(engine, 'template.allclasses-frame.html')
+        new File(outputDir, 'allclasses-frame.html').withWriter {
+            it << allClassesTemplate.make(docTypes: docSource.allDocTypes)
         }
 
         // the package-frame.html for each package
-        def templatePackageFrame = createTemplate(engine, 'template.package-frame.html')
-        packages.each {curPackage, packageClasses ->
-            def packageName = curPackage ?: PRIMITIVE_TYPE_PSEUDO_PACKAGE
-            generatePackageFrame(templatePackageFrame, packageName, packageClasses)
+        def packageFrameTemplate = createTemplate(engine, 'template.package-frame.html')
+        docSource.packages.each { DocPackage docPackage ->
+            def dir = DocUtil.createPackageDirectory(outputDir, docPackage.name)
+            new File(dir, 'package-frame.html').withWriter {
+                it << packageFrameTemplate.make(docPackage: docPackage)
+            }
         }
 
         // the class.html for each class
-        def templateClass = createTemplate(engine, 'template.class.html')
-        packages.each {curPackage, packageClasses ->
-            def packageName = curPackage ?: PRIMITIVE_TYPE_PSEUDO_PACKAGE
-            packageClasses.each {
-                generateClassDetails(templateClass, packageName, it)
+        def classTemplate = createTemplate(engine, 'template.class.html')
+        docSource.allDocTypes.each { DocType docType ->
+            def dir = DocUtil.createPackageDirectory(outputDir, docType.packageName)
+            new File(dir, docType.simpleClassName + '.html').withWriter {
+                it << classTemplate.make(docType: docType, title: TITLE)
             }
         }
 
         // the index-all.html
-        def templateIndexAll = createTemplate(engine, 'template.index-all.html')
-        out = new File(outputFolder, 'index-all.html')
-        binding = ['indexMap': generateIndex(packages), title: TITLE]
-        out.withWriter {
-            it << templateIndexAll.make(binding)
+        def indexAllTemplate = createTemplate(engine, 'template.index-all.html')
+        new File(outputDir, 'index-all.html').withWriter {
+            it << indexAllTemplate.make('indexMap': generateIndexMap(), title: TITLE)
         }
 
         // copy resources
         ['groovy.ico', 'stylesheet.css'].each { String resource ->
-            new File(outputFolder, resource).withOutputStream { outs ->
-                getClass().getResource(resource).withInputStream { ins ->
-                    outs << ins
-                }
-            }
+            new File(outputDir, resource) << getClass().getResource(resource).bytes
         }
     }
 
+    private Template createTemplate(TemplateEngine templateEngine, String resourceFile) {
+        def resourceUrl = getClass().getResource(resourceFile)
+        return templateEngine.createTemplate(resourceUrl.text)
+    }
+
     /**
-     * Generate an index.
+     * Generate an index map for index-all.html.
      * <p>
      * This method creates a index map indexed by the first letter of the
      * method in upper case, the map value is a list of methods.
@@ -192,281 +164,312 @@ class DocGenerator {
      * The values m1, m2, m3 are sorted by the method name, and the parameter signature.
      * The method names of m1, m2, m3 start either with 'a', or 'A'.
      *
-     * @return index
+     * @return indexMap
      */
-    private def generateIndex(def packages) {
-        def index = []
-        packages.each {curPackage, packageClasses ->
-            def packageName = curPackage ? curPackage : 'primitive-types'
-            packageClasses.each {className ->
-                def simpleClassName = className.replaceAll('.*\\.', '')
-                def fullClassName = packageName + '.' + simpleClassName
-
-                // Class
-                index.add([
-                    'index': simpleClassName.getAt(0).toUpperCase(),
-                    'packageName': packageName,
-                    'simpleClassName': simpleClassName,
-                    'className': fullClassName,
-                    'classDesc': enhancedClasses[className].interface ? 'interface' : 'class',
-                    'shortComment': "", // empty because cannot get a comment of JDK
-                ])
-
-                // Methods
-                def listOfMethods = enhancedMethodsForClass[className]
-                listOfMethods.each {method ->
-                    def methodName = method.name
-                    index.add([
-                            'index': methodName.getAt(0).toUpperCase(),
-                            'packageName': packageName,
-                            'simpleClassName': simpleClassName,
-                            'className': fullClassName,
-                            'classDesc': enhancedClasses[className].interface ? 'interface' : 'class',
-                            'method': method,
-                            'parametersSignature': getParametersDecl(method),
-                            'shortComment': linkify(getFirstSentence(getComment(method)), curPackage),
-                    ])
-                }
+    private Map generateIndexMap() {
+        def indexItems = []
+        docSource.allDocTypes.each { DocType docType ->
+            // the class
+            indexItems << [
+                index: docType.simpleClassName.capitalize()[0],
+                docType: docType,
+                sortKey: docType.sortKey,
+            ]
+
+            // the methods
+            docType.docMethods.each { DocMethod docMethod ->
+                indexItems << [
+                    index: docMethod.javaMethod.name.capitalize()[0],
+                    docType: docType,
+                    docMethod: docMethod,
+                    sortKey: docMethod.sortKey
+                ]
             }
         }
-        def indexMap = new TreeMap()
-        def indexListComparator = [compare: {a, b ->
-            final String aSortKey = (a.method) ? (a.method.name + ' ' + getParametersDecl(a.method) + ' ' + a.className) : a.className
-            final String bSortKey = (b.method) ? (b.method.name + ' ' + getParametersDecl(b.method) + ' ' + b.className) : b.className
-            return aSortKey.compareTo(bSortKey)
-        }] as Comparator
-
-        for (indexEntry in index) {
-            final String key = indexEntry['index']
-            if (indexMap.containsKey(key)) {
-                def indexEntryList = indexMap.get(key)
-                indexEntryList.add(indexEntry)
-            } else {
-                final TreeSet indexEntryList = new TreeSet(indexListComparator)
-                indexEntryList.add(indexEntry)
-                indexMap.put(key, indexEntryList)
-            }
+        def indexMap = new TreeMap().withDefault { new TreeSet(SORT_KEY_COMPARATOR) }
+        for (indexItem in indexItems) {
+            indexMap[indexItem['index']] << indexItem
         }
         return indexMap
     }
 
-    private getFirstSentence(text) {
-        def boundary = java.text.BreakIterator.getSentenceInstance(Locale.getDefault()) // todo - allow locale to be passed in
-        boundary.setText(text)
-        int start = boundary.first()
-        int end = boundary.next()
-        if (start > -1 && end > -1) {
-            text = text.substring(start, end)
+    /**
+     * Main entry point.
+     */
+    static void main(String... args) {
+        def start = System.currentTimeMillis()
+
+        // TODO don't hardcode
+        def outputDir = new File("target/html/groovy-jdk")
+        outputDir.mkdirs()
+
+        def srcFiles = args.collect { DocUtil.sourceFileOf(it) }
+        try {
+            DefaultGroovyMethods.additionals.each { aClass ->
+                def className = aClass.name.replaceAll(/\$.*/, '')
+                def additionalFile = DocUtil.sourceFileOf(className)
+                if (srcFiles.every { it.canonicalPath != additionalFile.canonicalPath }) {
+                    srcFiles << additionalFile
+                }
+            }
+        } catch (MissingPropertyException e) { // TODO is it still needed?
+            // no call site change available, so ignore it
+            log.error e.message, e
         }
-        text
+
+        def docGen = new DocGenerator(srcFiles, outputDir)
+        docGen.generateAll()
+
+        def end = System.currentTimeMillis()
+        log.debug "Done. Took ${end - start} milliseconds."
     }
 
-    private generateClassDetails(template, curPackage, aClass) {
-        def packagePath = generatePackagePath(curPackage)
-        def dir = new File(outputFolder, packagePath)
-        dir.mkdirs()
-        def out = new File(dir, aClass.replaceAll('.*\\.', '') + '.html')
-        def listOfMethods = enhancedMethodsForClass[aClass].sort {it.name}
-        def methods = []
-        listOfMethods.each {method ->
-            def parameters = method.getTagsByName("param").collect {
-                [name: it.value.replaceAll(' .*', ''), comment: linkify(it.value.replaceAll('^\\w*', ''), curPackage)]
+    private static class DocSource {
+        SortedSet<DocPackage> packages = new TreeSet<DocPackage>(SORT_KEY_COMPARATOR)
+
+        void add(Type type, JavaMethod javaMethod) {
+            DocType tempDocType = new DocType(type: type)
+
+            DocPackage aPackage = packages.find { it.name == tempDocType.packageName }
+            if (!aPackage) {
+                aPackage = new DocPackage(name: tempDocType.packageName)
+                packages << aPackage
             }
-            if (parameters)
-                parameters.remove(0) // method is static, first arg is the "real this"
-
-            def seeComments = method.getTagsByName("see").collect { [target: getDocUrl(it.value, curPackage)]}
-
-            def returnType = getReturnType(method)
-            def comment = getComment(method)
-            def methodInfo = [
-                    name: method.name,
-                    comment: linkify(comment, curPackage),
-                    shortComment: linkify(getFirstSentence(comment), curPackage),
-                    returnComment: method.getTagByName("return")?.getValue() ?: '',
-                    seeComments: seeComments,
-                    returnTypeDocUrl: getDocUrl(returnType, curPackage),
-                    parametersSignature: getParametersDecl(method),
-                    parametersDocUrl: getParametersDocUrl(method, curPackage),
-                    parameters: parameters,
-                    isStatic: method.parentClass.name == 'DefaultGroovyStaticMethods',
-                    since: method.getTagByName("since")?.getValue() ?: null
-            ]
-            methods << methodInfo
+
+            DocType docType = aPackage.docTypes.find { it.fullyQualifiedClassName == tempDocType.fullyQualifiedClassName }
+            if (!docType) {
+                docType = tempDocType
+                aPackage.docTypes << docType
+            }
+
+            def docMethod = new DocMethod(declaringDocType: docType, javaMethod: javaMethod)
+            docType.docMethods << docMethod
         }
 
-        def binding = [
-                className: aClass.replaceAll(/.*\./, ''),
-                classDesc: enhancedClasses[aClass].interface ? 'Interface' : 'Class',
-                packageName: curPackage,
-                methods: methods,
-                title: TITLE
-        ]
-        out.withWriter {
-            it << template.make(binding)
+        SortedSet<DocType> getAllDocTypes() {
+            def allSet = new TreeSet(SORT_KEY_COMPARATOR)
+            allSet.addAll(packages.collectMany { it.docTypes })
+            return allSet
         }
     }
 
-    private String getParametersDocUrl(method, curPackage) {
-        getParameters(method).collect {"${getDocUrl(it.type.toString(), curPackage)} $it.name"}.join(", ")
-    }
+    private static class DocPackage {
+        static final String PRIMITIVE_TYPE_PSEUDO_PACKAGE = 'primitive-types'
+        String name
+        SortedSet<DocType> docTypes = new TreeSet<DocType>(SORT_KEY_COMPARATOR)
 
-    private String getDocUrl(type, curPackage) {
-        def inGdk = false
-        if (type.startsWith('#')) {
-            def matchNameArgs = /#([^(]*)\(([^)]+)\)/
-            def m = type =~ matchNameArgs
-            def name = m[0][1]
-            def args = m[0][2].split(/,\s?/).toList()
-            def first = args.remove(0)
-            type = "$first#$name(${args.join(', ')})".toString()
-            inGdk = true
-        }
-        if (type in ['T', 'U', 'V', 'K', 'V']) {
-            type = "java.lang.Object"
-        } else if (type == 'T[]') {
-            type = "java.lang.Object[]"
-        }
-        if (!type.contains('.')) {
-            return type
-        }
-        def target = type.split('#')
-        def shortClassName = target[0].replaceAll(/.*\./, "")
-        def packageName = (shortClassName.size() == target[0].size()) ? "DefaultPackage" : target[0][0..(-shortClassName.size() - 2)]
-        shortClassName += (target.size() > 1 ? '#' + target[1].split('\\(')[0] : '')
-        def apiBaseUrl, title
-        if (inGdk) {
-            apiBaseUrl = ""
-            curPackage.split('\\.').size().times { apiBaseUrl += '../'}
-            title = "GDK enhancement for ${target[0]}"
-        } else if (type.startsWith("groovy") || type.startsWith("org.codehaus.groovy")) {
-            // TODO don't hardcode
-            apiBaseUrl = "http://groovy.codehaus.org/gapi/"
-            title = "Groovy class in $packageName"
-        } else {
-            // TODO don't hardcode
-            apiBaseUrl = "http://docs.oracle.com/javase/7/docs/api/"
-            title = "JDK class in $packageName"
-        }
-
-        def url = apiBaseUrl + target[0].replace('.', '/') + '.html' + (target.size() > 1 ? '#' + target[1] : '')
-        return "<a href='$url' title='$title'>$shortClassName</a>"
-    }
+        boolean isPrimitive() {
+            name == PRIMITIVE_TYPE_PSEUDO_PACKAGE
+        }
 
-    private generatePackagePath(curPackage) {
-        def fileSep = File.separator
-        // need to escape separator on windows for regex's sake
-        if (fileSep == '\\') fileSep *= 2
-        return curPackage.replaceAll('\\.', fileSep)
+        String getSortKey() {
+            name
+        }
     }
 
-    private generatePackageFrame(templatePackageFrame, curPackage, packageClasses) {
-        def packagePath = generatePackagePath(curPackage)
-        def dir = new File(outputFolder, packagePath)
-        dir.mkdirs()
-        def out = new File(dir, 'package-frame.html')
-        def binding = [
-                classes: packageClasses.findAll{ !enhancedClasses[it].interface }.sort().collect {it.replaceAll(/.*\./, '')},
-                interfaces: packageClasses.findAll{ enhancedClasses[it].interface }.sort().collect {it.replaceAll(/.*\./, '')},
-                packageName: curPackage]
-        out.withWriter {
-            it << templatePackageFrame.make(binding)
+    private static class DocType {
+        private Type type
+        final String shortComment = "" // empty because cannot get a comment of JDK
+        SortedSet<DocMethod> docMethods = new TreeSet<DocMethod>(SORT_KEY_COMPARATOR)
+
+        String getPackageName() {
+            if (type.primitive) {
+                return DocPackage.PRIMITIVE_TYPE_PSEUDO_PACKAGE
+            }
+            def fqcn = fullyQualifiedClassName
+            if (fqcn.indexOf(".") < 0) {
+                return ""
+            }
+            fqcn.replaceAll(/\.[^.]*$/, '')
         }
-    }
 
-    def createTemplate(templateEngine, resourceFile) {
-        def resourceUrl = getClass().getResource(resourceFile)
-        return templateEngine.createTemplate(resourceUrl.text)
-    }
+        String getSimpleClassName() {
+            fullyQualifiedClassName.replaceAll(/^.*\./, '')
+        }
 
-    /**
-     * Retrieves a String representing the return type
-     */
-    private getReturnType(method) {
-        def returnType = method.getReturns()
+        String getFullyQualifiedClassName() {
+            if (type.primitive) {
+                return DocPackage.PRIMITIVE_TYPE_PSEUDO_PACKAGE + '.' + type.toString()
+            }
+            DocUtil.resolveJdkClassName(type.toString())
+        }
 
-        if (returnType != null) {
-            return returnType.toString()
+        boolean isInterface() {
+            type.javaClass.isInterface()
         }
-        return ""
-    }
 
-    /**
-     * Retrieve a String representing the declaration of the parameters of the method passed as parameter.
-     *
-     * @param method a method
-     * @return the declaration of the method (long version)
-     */
-    private getParametersDecl(method) {
-        getParameters(method).collect {"${it.getType()}"}.join(", ")
+        String getSortKey() {
+            simpleClassName + ' ' + fullyQualifiedClassName
+        }
     }
 
-    /**
-     * Retrieve the parameters of the method.
-     *
-     * @param method a method
-     * @return a list of parameters without the first one
-     */
-    private getParameters(method) {
-        if (method.getParameters().size() > 1) {
-            return method.getParameters().toList()[1..-1]
+    private static class DocMethod {
+        DocType declaringDocType
+        JavaMethod javaMethod
+
+        String getName() {
+            javaMethod.name
         }
-        return []
-    }
 
-    /**
-     * Retrieve the JavaDoc comment associated with the method passed as parameter.
-     *
-     * @param method a method
-     * @return the JavaDoc comment associated with this method
-     */
-    private getComment(method) {
-        def ans = method.getComment()
-        if (ans == null) return ""
-        return ans
-    }
+        /**
+         * Retrieve the parameters of the method.
+         *
+         * @param method a method
+         * @return a list of parameters without the first one
+         */
+        List<JavaParameter> getParameters() {
+            if (javaMethod.getParameters().size() > 1) {
+                return javaMethod.getParameters().toList()[1..-1]
+            }
+            return []
+        }
 
-    private linkify(orig, curPackage) {
-        orig.replaceAll(/\{@link\s+([^}]*)\s*\}/) {all, link -> getDocUrl(link, curPackage) }
+        String getParametersSignature() {
+            parameters.collect { DocUtil.resolveJdkClassName(it.type.toString()) }.join(", ")
+        }
+
+        String getParametersDocUrl() {
+            parameters.collect { "${DocUtil.getLinkAnchor(it.type.toString(), declaringDocType.packageName)} $it.name" }.join(", ")
+        }
+
+        String getReturnTypeDocUrl() {
+            def returnType = javaMethod.returns
+            def resolvedReturnType = (returnType) ? DocUtil.resolveJdkClassName(returnType.toString()) : ""
+            DocUtil.getLinkAnchor(resolvedReturnType, declaringDocType.packageName)
+        }
+
+        String getComment() {
+            DocUtil.formatJavadocText(javaMethod.comment ?: '', declaringDocType.packageName)
+        }
+
+        String getShortComment() {
+            DocUtil.formatJavadocText(DocUtil.getFirstSentence(javaMethod.comment ?: ''), declaringDocType.packageName)
+        }
+
+        String getReturnComment() {
+            DocUtil.formatJavadocText(javaMethod.getTagByName("return")?.value ?: '', declaringDocType.packageName)
+        }
+
+        Map getParameterComments() {
+            javaMethod.getTagsByName("param").drop(1).collectEntries { // first arg is the "real this"
+                def name = it.value.replaceAll(/ .*/, '')
+                def comment = DocUtil.formatJavadocText(it.value.replaceAll(/^\w*/, ''), declaringDocType.packageName)
+                [name, comment]
+            }
+        }
+
+        List<String> getSeeComments() {
+            javaMethod.getTagsByName("see").collect { DocUtil.getLinkAnchor(it.value, declaringDocType.packageName) }
+        }
+
+        String getSinceComment() {
+            javaMethod.getTagByName("since")?.value
+        }
+
+        boolean isStatic() {
+            javaMethod.parentClass.name == 'DefaultGroovyStaticMethods'
+        }
+
+        String getSortKey() {
+            name + ' ' + parametersSignature + ' ' + declaringDocType.fullyQualifiedClassName
+        }
     }
 
-    /**
-     * Main entry point.
-     */
-    static void main(args) {
-        // TODO don't hardcode
-        def outFolder = new File("target/html/groovy-jdk")
-        outFolder.mkdirs()
-        def start = System.currentTimeMillis()
-        def srcFiles = args.collect {getSourceFile(it)}
-        def srcFileNames = args.collect {getSourceFile(it).canonicalPath}
-        try {
-            Class[] classes = DefaultGroovyMethods.additionals
-            classes.each {
-                def name = it.name
-                if (name.indexOf('$') > 0) {
-                    name = name.tokenize('$')[0]
-                }
-                def newFile = getSourceFile(name)
-                def newFileName = newFile.canonicalPath
-                if (!srcFileNames.contains(newFileName)) {
-                    srcFileNames << newFileName
-                    srcFiles << newFile
+    private static class DocUtil {
+        static String resolveJdkClassName(String className) {
+            if (className in ['T', 'E', 'U', 'K', 'V', 'G']) {
+                return 'java.lang.Object'
+            }
+            if (className in ['T[]', 'E[]']) {
+                return 'java.lang.Object[]'
+            }
+            return className
+        }
+
+        static String formatJavadocText(String text, String packageName) {
+            linkify(codify(text), packageName)
+        }
+
+        private static String linkify(String text, String packageName) {
+            text.replaceAll(/\{@link\s+([^}]*)\s*\}/) { String all, String destination ->
+                // A class name cannot be omitted: https://jira.codehaus.org/browse/GROOVY-6740
+                DocUtil.getLinkAnchor(destination, packageName)
+            }
+        }
+
+        private static String codify(String text) {
+            text.replaceAll(/\{@code\s+([^}]*)\s*\}/) { String all, String code -> """<code>${code}</code>""" }
+        }
+
+        static String getFirstSentence(String text) {
+            def boundary = BreakIterator.getSentenceInstance(Locale.default) // TODO allow locale to be passed in
+            boundary.setText(text)
+            int start = boundary.first()
+            int end = boundary.next()
+            if (start > -1 && end > -1) {
+                return text.substring(start, end)
+            }
+            return text
+        }
+
+        static String getLinkAnchor(String destination, String originPackageName) {
+            // resolving a destination if it's in GDK.
+            def inGdk = destination.startsWith('#')
+            if (inGdk) {
+                (destination =~ /#([^(]*)\(([^)]+)\)/).each { String all, String name, String argsText ->
+                    def args = argsText.split(/,\s?/).toList()
+                    def first = args.remove(0)
+                    destination = "$first#$name(${args.join(', ')})".toString()
                 }
             }
-        } catch (MissingPropertyException mpe) {
-            log.error mpe.message, mpe
-            // no call site change available, so ignore it
+
+            def fullyQualifiedClassName = resolveJdkClassName(destination.replaceFirst(/#.*$/, ''))
+            def methodSignatureHash = destination.replaceFirst(/^[^#]*/, '')
+            def simpleClassName = fullyQualifiedClassName.replaceFirst(/.*\./, "")
+            def packageName = fullyQualifiedClassName.replaceFirst(/.?[^.]+$/, '')
+
+            // If a package is empty, a destination text should be just returned
+            // because a link to the right documentation location cannot be made.
+            if (packageName.empty) {
+                return destination
+            }
+
+            def apiBaseUrl, title
+            if (inGdk) {
+                apiBaseUrl = '../' * (originPackageName.count('.') + 1)
+                title = "GDK enhancement for ${fullyQualifiedClassName}"
+            } else if (packageName.startsWith("groovy") || packageName.startsWith("org.codehaus.groovy")) {
+                apiBaseUrl = "http://groovy.codehaus.org/gapi/" // TODO don't hardcode
+                title = "Groovy class in $packageName"
+            } else {
+                apiBaseUrl = "http://docs.oracle.com/javase/7/docs/api/" // TODO don't hardcode
+                title = "JDK class in $packageName"
+            }
+
+            def url = "${apiBaseUrl}${packageName.replace('.', '/')}/${simpleClassName}.html${methodSignatureHash}"
+            return """<a href="$url" title="$title">${simpleClassName}${methodSignatureHash}</a>"""
+        }
+
+        static File createPackageDirectory(File outputDir, String packageName) {
+            def packagePath = filePathOf(packageName)
+            def dir = new File(outputDir, packagePath)
+            dir.mkdirs()
+            return dir
         }
-        def docGen = new DocGenerator(srcFiles, outFolder)
-        docGen.generateNew()
-        def end = System.currentTimeMillis()
-        log.debug "Done. Took ${end - start} millis."
-    }
 
-    private static File getSourceFile(String classname) {
-        // TODO don't hardcode like this
-        if (classname.contains("/")) return new File(classname)
-        new File("src/main/" + classname.replace('.', '/') + ".java")
+        private static String filePathOf(String packageName) {
+            def fileSep = File.separator
+            // need to escape separator on windows for regex's sake
+            if (fileSep == '\\') fileSep *= 2
+            return packageName.replaceAll(/\./, fileSep)
+        }
+
+        static File sourceFileOf(String className) {
+            // TODO don't hardcode like this
+            if (className.contains("/")) {
+                return new File(className)
+            }
+            new File("src/main/" + className.replace('.', '/') + ".java")
+        }
     }
 }
diff --git a/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/stylesheet.css b/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/stylesheet.css
index 59e73c7913..b3999be7e9 100644
--- a/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/stylesheet.css
+++ b/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/stylesheet.css
@@ -2179,7 +2179,8 @@ table.overviewSummary tr th, .contentContainer ul li table tr th {
     padding: 10px;
     font-weight: bold;
     font-size: 1em;
-    text-align: left
+    text-align: left;
+    white-space: nowrap;
 }
 
 table.overviewSummary tr td, .contentContainer ul li table tr td {
@@ -2303,4 +2304,4 @@ span.strong {
 
 a span.strong {
     font-weight: normal
-}
\ No newline at end of file
+}
diff --git a/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/template.allclasses-frame.html b/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/template.allclasses-frame.html
index f00986f3d9..c1a35f7f7f 100644
--- a/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/template.allclasses-frame.html
+++ b/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/template.allclasses-frame.html
@@ -13,12 +13,15 @@
 
 <div class="indexContainer">
     <h2 title="All Classes">All Classes</h2>
-</div>
-
-<div class="indexContainer">
-    <ul title="All Classes">
-        <% classes.each { %>
-        <li><a href="${it.replaceAll('\\.', '/')}.html" target="classFrame">${it.replaceAll('.*\\.', '')}</a></li>
+    <ul>
+        <% docTypes.each { docType -> %>
+        <li><a href="${docType.fullyQualifiedClassName.replaceAll(/\./, '/')}.html" title="${docType.interface ? 'interface' : 'class'} in ${docType.packageName}"  target="classFrame">
+            <% if (docType.interface) { %>
+            <i>${docType.simpleClassName}</i>
+            <% } else { %>
+            ${docType.simpleClassName}
+            <% } %>
+        </a></li>
         <% } %>
     </ul>
 </div>
diff --git a/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/template.class.html b/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/template.class.html
index d10ef5d45a..546079a7be 100644
--- a/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/template.class.html
+++ b/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/template.class.html
@@ -2,11 +2,11 @@
 
 <html>
 <head>
-    <title>${className} (Groovy JDK)</title>
+    <title>${docType.simpleClassName} (Groovy JDK)</title>
 
     <%
-    int dotCount = packageName.count('.')
-    String pathPref = '../' * (dotCount+1)
+    int dotCount = docType.packageName.count('.')
+    String pathPref = '../' * (dotCount + 1)
     %>
     <link rel="stylesheet" type="text/css" href="${pathPref}stylesheet.css" title="Style">
 
@@ -36,8 +36,8 @@
     <!-- ======== START OF class DATA ======== -->
 
     <div class="header">
-        <div class="subTitle">Package: <strong>${packageName}</strong></div>
-        <h2>${classDesc} ${className}</h2>
+        <div class="subTitle">Package: <strong>${docType.packageName}</strong></div>
+        <h2>${docType.interface ? 'Interface' : 'Class'} ${docType.simpleClassName}</h2>
     </div>
 
     <div class="contentContainer">
@@ -62,21 +62,20 @@
                                             <th>Name and parameters</th>
                                         </tr>
                                         <tbody>
-                                            <% methods.eachWithIndex { method, i -> %>
+                                            <% docType.docMethods.eachWithIndex { docMethod, i -> %>
                                             <tr class="${i % 2 == 0 ? 'altColor' : 'rawColor'}">
                                                 <td align="right" valign="top" width="1%">
-                                                    <span> <code>${method.isStatic ? 'static ' : ''}${method.returnTypeDocUrl}</code></span>
+                                                    <span> <code>${docMethod.isStatic() ? 'static ' : ''}${docMethod.returnTypeDocUrl}</code></span>
                                                 </td>
                                                 <td>
-                                                    <code><strong><a href="#${method.name}(${method.parametersSignature})">${method.name}</a></strong>(${method.parametersDocUrl})</code>
+                                                    <code><strong><a href="#${docMethod.name}(${docMethod.parametersSignature})">${docMethod.name}</a></strong>(${docMethod.parametersDocUrl})</code>
                                                     <br>
-                                                    ${method.shortComment}
+                                                    ${docMethod.shortComment}
                                                 </td>
                                             </tr>
                                             <% } %>
                                         </tbody>
                                     </table>
-
                             </ul>
                         </li>
                     </ul>
@@ -96,45 +95,45 @@
                         <li class="blockList">
                             <h3>Methods Detail</h3>
 
-                            <% methods.eachWithIndex { method, i -> %>
-                            <a name="${method.name}(${method.parametersSignature})"><!-- --></a>
+                            <% docType.docMethods.eachWithIndex { docMethod, i -> %>
+                            <a name="${docMethod.name}(${docMethod.parametersSignature})"><!-- --></a>
 
                             <ul class="blockListLast">
                                 <li class="blockList">
 
-                                    <h4>public ${method.isStatic ? 'static ' : ''}${method.returnTypeDocUrl} <b>${method.name}</b>(${method.parametersDocUrl})</h4>
+                                    <h4>public ${docMethod.isStatic() ? 'static ' : ''}${docMethod.returnTypeDocUrl} <b>${docMethod.name}</b>(${docMethod.parametersDocUrl})</h4>
+
+                                    <p>${docMethod.comment}</p>
 
-                                    <p>${method.comment}</p>
-                                    
-                                    <% if (method.parametersSignature) { %>
+                                    <% if (docMethod.parametersSignature) { %>
                                     <dl>
                                         <dt><b>Parameters:</b></dt>
-                                        <% method.parameters.each { param -> %>
-                                        <dd><code>${param.name}</code> - ${param.comment}.</dd>
+                                        <% docMethod.parameterComments.each { name, comment -> %>
+                                        <dd><code>${name}</code> - ${comment}</dd>
                                         <% } %>
                                     </dl>
                                     <%
                                     } %>
 
-                                    <% if (method.returnComment) { %>
+                                    <% if (docMethod.returnComment) { %>
                                     <dl>
                                         <dt><b>Returns:</b></dt>
-                                        <dd>${method.returnComment}</dd>
+                                        <dd>${docMethod.returnComment}</dd>
                                     </dl>
                                     <% } %>
 
-                                    <%if (method.since) { %>
+                                    <%if (docMethod.sinceComment) { %>
                                     <dl>
                                         <dt><b>Since:</b></dt>
-                                        <dd>${method.since}</dd>
+                                        <dd>${docMethod.sinceComment}</dd>
                                     </dl>
                                     <%}%>
 
-                                    <% if (method.seeComments) { %>
+                                    <% if (docMethod.seeComments) { %>
                                     <dl>
-                                        <dt><b>See:</b></dt>
-                                        <% method.seeComments.each { param -> %>
-                                        <dd>${param.target}.</dd>
+                                        <dt><b>See Also:</b></dt>
+                                        <% docMethod.seeComments.each { %>
+                                        <dd>${it}</dd>
                                         <% }%>
                                     </dl>
                                     <% } %>
diff --git a/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/template.index-all.html b/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/template.index-all.html
index 034f8d8700..c789ddf568 100644
--- a/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/template.index-all.html
+++ b/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/template.index-all.html
@@ -14,7 +14,7 @@ function asd()
 }
 </script>
     <body class="center" onload="asd();">
-        
+
         <!-- ========== START OF NAVBAR ========== -->
         <a name="navbar_top"><!-- --></a>
 
@@ -27,42 +27,39 @@ function asd()
         </div>
         <!-- =========== END OF NAVBAR =========== -->
         <!--
-        <A HREF="#_A_">A</A> 
+        <a HREF="#_A_">A</a>
         -->
-        <% indexMap.each{ it -> %>
-        <A HREF="#_${it.key}_">${it.key}</A>
+        <% indexMap.each { it -> %>
+        <a HREF="#_${it.key}_">${it.key}</a>
         <% } %>
-        <HR>
-        
+        <hr>
+
         <% indexMap.each { indexMapEntry -> %>
-        <A NAME="_${indexMapEntry.key}_"><!-- --></A>
-        <H2><B>${indexMapEntry.key}</B></H2>
-        <DL>
+        <a name="_${indexMapEntry.key}_"><!-- --></a>
+        <h2><b>${indexMapEntry.key}</b></h2>
+        <dl>
             <% indexMapEntry.value.each { it -> %>
-            <% final String classUrl = it.className.replaceAll('\\.','/') + '.html' %>
-            <% if (it.method) { %>
-            <% final String methodUrl = classUrl + '#' + it.method.name + '(' + it.parametersSignature + ')' %>
-            <dt><a href="${methodUrl}"><b>${it.method.name}(${it.parametersSignature})</b></a> - Method in ${it.classDesc} ${it.packageName}.<a href="${classUrl}">${it.simpleClassName}</a>
-            </dt>
+            <% final String classUrl = it.docType.fullyQualifiedClassName.replaceAll('\\.','/') + '.html' %>
+            <% if (it.docMethod) { %>
+            <% final String methodUrl = classUrl + '#' + it.docMethod.name + '(' + it.docMethod.parametersSignature + ')' %>
+            <dt><a href="${methodUrl}"><b>${it.docMethod.name}(${it.docMethod.parametersSignature})</b></a> - Method in ${it.docType.interface ? 'interface' : 'class'} ${it.docType.packageName}.<a href="${classUrl}">${it.docType.simpleClassName}</a></dt>
+            <dd> ${it.docMethod.shortComment}</dd>
             <% } else { %>
-            <dt><a href="${classUrl}"><b>${it.simpleClassName}</b></a> - ${it.classDesc.capitalize()} in ${it.packageName}
-            </dt>
+            <dt><a href="${classUrl}"><b>${it.docType.simpleClassName}</b></a> - ${it.docType.interface ? 'Interface' : 'Class'} in ${it.docType.packageName}</dt>
+            <dd> ${it.docType.shortComment}</dd>
             <% } %>
-            <dd>
-            ${it.shortComment}
-            </dd>
             &nbsp;
             <% } %>
-        </DL>
+        </dl>
         <% } %>
-        
+
         <!--
-        <A HREF="#_A_">A</A> 
+        <a HREF="#_A_">A</a>
         -->
-        <% indexMap.each{ it -> %>
+        <% indexMap.each { it -> %>
         <a href="#_${it.key}_">${it.key}</a>
         <% } %>
-        
+
         <!-- ========== START OF NAVBAR ========== -->
         <a name="navbar_bottom"><!-- --></a>
         <div class="topNav">
@@ -73,6 +70,6 @@ function asd()
             </ul>
         </div>
         <!-- =========== END OF NAVBAR =========== -->
-        
+
     </body>
 </html>
diff --git a/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/template.overview-frame.html b/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/template.overview-frame.html
index 8400588292..9200b34831 100644
--- a/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/template.overview-frame.html
+++ b/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/template.overview-frame.html
@@ -17,11 +17,10 @@
 
 <div class="indexContainer">
     <h2 title="Packages">Packages</h2>
-
-    <ul title="Packages">
-        <li><a href="primitive-types/package-frame.html" target="packageFrame">Primitive types</a></li>
+    <ul>
+        <li><a href="primitive-types/package-frame.html" title="Primitive types" target="packageFrame">Primitive types</a></li>
         <% packages.grep().each { %>
-        <li><a href="${it.replaceAll('\\.', '/')}/package-frame.html" target="packageFrame">${it}</a></li>
+        <li><a href="${it.name.replaceAll('\\.', '/')}/package-frame.html" title="${it.name}" target="packageFrame">${it.name}</a></li>
         <% } %>
     </ul>
 </div>
diff --git a/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/template.package-frame.html b/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/template.package-frame.html
index 88ac0eeea1..bb96c910c2 100644
--- a/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/template.package-frame.html
+++ b/subprojects/groovy-docgenerator/src/main/resources/org/codehaus/groovy/tools/template.package-frame.html
@@ -3,42 +3,35 @@
 <html>
 <head>
     <title>
-        ${packageName} (Groovy enhanced JDK classes)
+        ${docPackage.name} (Groovy enhanced JDK classes)
     </title>
 
-<%
-    def path = '..'
-    packageName.count('.').times {
-        path += ('/..')
-    }
-%>
-
-    <link rel="stylesheet" type="text/css" href="${path}/stylesheet.css" title="Style">
+    <link rel="stylesheet" type="text/css" href="stylesheet.css" title="Style">
 </head>
 
 <body class="left">
 
 <div class="indexHeader">
-    <b><!--<a href="package-summary.html" target="classFrame">-->${packageName}<!--</a>--></b>
+    <b>${docPackage.name}</b>
 </div>
 
-<% if (classes) { %>
+<% if (docPackage.docTypes.any { it.interface }) { %>
 <div class="indexContainer">
-    <h2 title="Classes">Classes</h2>
+    <h2 title="Interfaces">Interfaces</h2>
     <ul>
-        <% classes.grep().each { %>
-        <li><a href="${it}.html" title="class in ${packageName}" target="classFrame">${it}</a></li>
+        <% docPackage.docTypes.findAll { it.interface }.each { docType -> %>
+        <li><a href="${docType.simpleClassName}.html" title="interface in ${docType.packageName}" target="classFrame"><i>${docType.simpleClassName}</i></a></li>
         <% } %>
     </ul>
 </div>
 <% } %>
 
-<% if (interfaces) { %>
+<% if (docPackage.docTypes.any { !it.interface }) { %>
 <div class="indexContainer">
-    <h2 title="Interfaces">Interfaces</h2>
+    <h2 title="Classes">Classes</h2>
     <ul>
-        <% interfaces.grep().each { %>
-        <li><a href="${it}.html" title="interface in ${packageName}" target="classFrame"><I>${it}</I></a></li>
+        <% docPackage.docTypes.findAll { !it.interface }.each { docType -> %>
+        <li><a href="${docType.simpleClassName}.html" title="class in ${docType.packageName}" target="classFrame">${docType.simpleClassName}</a></li>
         <% } %>
     </ul>
 </div>
