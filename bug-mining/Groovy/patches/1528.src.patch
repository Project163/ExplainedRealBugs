diff --git a/src/main/org/codehaus/groovy/classgen/AsmClassGenerator.java b/src/main/org/codehaus/groovy/classgen/AsmClassGenerator.java
index 71a92c8a66..a9ca17bfa8 100644
--- a/src/main/org/codehaus/groovy/classgen/AsmClassGenerator.java
+++ b/src/main/org/codehaus/groovy/classgen/AsmClassGenerator.java
@@ -620,6 +620,7 @@ public class AsmClassGenerator extends ClassGenerator {
         subExpression.visit(this);
         controller.getOperandStack().box();
         bitwiseNegate.call(controller.getMethodVisitor());
+        controller.getOperandStack().replace(ClassHelper.OBJECT_TYPE);
         controller.getAssertionWriter().record(expression);
     }
 
diff --git a/src/test/groovy/operator/StringOperatorsTest.groovy b/src/test/groovy/operator/StringOperatorsTest.groovy
index 115af158e5..a39af2133c 100644
--- a/src/test/groovy/operator/StringOperatorsTest.groovy
+++ b/src/test/groovy/operator/StringOperatorsTest.groovy
@@ -55,4 +55,11 @@ class StringOperatorsTest extends GroovyTestCase {
 
         assert "the quick brown".substring(4).substring(0, 5) == "quick"
     }
+
+    void testBitwiseNegate() {
+        String value="test"
+        String s = "^\\S+$value\$"
+        def p = ~s 
+        assert p instanceof java.util.regex.Pattern
+    }
 }
