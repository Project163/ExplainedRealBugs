diff --git a/src/main/org/codehaus/groovy/transform/ASTTransformationCollectorCodeVisitor.java b/src/main/org/codehaus/groovy/transform/ASTTransformationCollectorCodeVisitor.java
index daf6e1822a..2926bf2bc2 100644
--- a/src/main/org/codehaus/groovy/transform/ASTTransformationCollectorCodeVisitor.java
+++ b/src/main/org/codehaus/groovy/transform/ASTTransformationCollectorCodeVisitor.java
@@ -20,6 +20,7 @@ import org.codehaus.groovy.ast.AnnotatedNode;
 import org.codehaus.groovy.ast.AnnotationNode;
 import org.codehaus.groovy.ast.ClassCodeVisitorSupport;
 import org.codehaus.groovy.ast.ClassNode;
+import org.codehaus.groovy.control.CompilePhase;
 import org.codehaus.groovy.control.SourceUnit;
 import org.codehaus.groovy.control.messages.SimpleMessage;
 
@@ -95,7 +96,8 @@ public class ASTTransformationCollectorCodeVisitor extends ClassCodeVisitorSuppo
         for (String transformClass : transformClassNames) {
             try {
                 Class klass = transformLoader.loadClass(transformClass, false, true, false);
-                verifyClassAndAddTransform(annotation, klass);
+                verifyAndAddTransform(annotation, klass);
+
             } catch (ClassNotFoundException e) {
                 source.getErrorCollector().addErrorAndContinue(
                         new SimpleMessage(
@@ -105,19 +107,40 @@ public class ASTTransformationCollectorCodeVisitor extends ClassCodeVisitorSuppo
             }
         }
         for (Class klass : transformClasses) {
-            verifyClassAndAddTransform(annotation, klass);
+            verifyAndAddTransform(annotation, klass);
         }
     }
-    
-    private void verifyClassAndAddTransform(AnnotationNode annotation, Class klass) {
-        if (ASTTransformation.class.isAssignableFrom(klass)) {
-            classNode.addTransform(klass, annotation);
-        } else {
-            source.getErrorCollector().addError(new SimpleMessage("Not an ASTTransformation: " + 
+
+    private void verifyAndAddTransform(AnnotationNode annotation, Class klass) {
+        verifyClass(annotation, klass);
+        verifyCompilePhase(annotation, klass);
+        addTransform(annotation, klass);
+    }
+
+    private void verifyCompilePhase(AnnotationNode annotation, Class klass) {
+        GroovyASTTransformation transformationClass = (GroovyASTTransformation) klass.getAnnotation(GroovyASTTransformation.class);
+        if (transformationClass != null)  {
+            CompilePhase specifiedCompilePhase = transformationClass.phase();
+            if (specifiedCompilePhase.getPhaseNumber() < CompilePhase.SEMANTIC_ANALYSIS.getPhaseNumber())  {
+                source.getErrorCollector().addError(
+                        new SimpleMessage(
+                                annotation.getClassNode().getName() + " is defined to be run in compile phase " + specifiedCompilePhase + ". Local AST transformations must run in " + CompilePhase.SEMANTIC_ANALYSIS + " or later!",
+                                source));
+            }
+        }
+    }
+
+    private void verifyClass(AnnotationNode annotation, Class klass) {
+        if (!ASTTransformation.class.isAssignableFrom(klass)) {
+            source.getErrorCollector().addError(new SimpleMessage("Not an ASTTransformation: " +
                     klass.getName() + " declared by " + annotation.getClassNode().getName(), source));
         }
     }
 
+    private void addTransform(AnnotationNode annotation, Class klass)  {
+        classNode.addTransform(klass, annotation);
+    }
+
     private static Annotation getTransformClassAnnotation(ClassNode annotatedType) {
         if (!annotatedType.isResolved()) return null;
 
diff --git a/src/test/org/codehaus/groovy/transform/LocalASTTransformTest.groovy b/src/test/org/codehaus/groovy/transform/LocalASTTransformTest.groovy
new file mode 100644
index 0000000000..b2823ff3cb
--- /dev/null
+++ b/src/test/org/codehaus/groovy/transform/LocalASTTransformTest.groovy
@@ -0,0 +1,98 @@
+package org.codehaus.groovy.transform
+
+import org.codehaus.groovy.control.CompilationFailedException
+
+/**
+ * @author Andre Steingress
+ */
+class LocalASTTransformTest extends GroovyShellTestCase {
+
+    void testVerifyCompilePhaseBeforeSemanticAnalysisWithStringClassName()  {
+        def gcl = new GroovyClassLoader()
+
+        gcl.parseClass """
+            package org.codehaus.groovy.transform
+
+            import java.lang.annotation.Retention
+            import java.lang.annotation.RetentionPolicy
+            import java.lang.annotation.Target
+            import java.lang.annotation.ElementType
+
+            @Retention(RetentionPolicy.RUNTIME)
+            @Target([ElementType.TYPE])
+            @GroovyASTTransformationClass("org.codehaus.groovy.transform.LocalTransformASTTransformation")
+            public @interface LocalTransform {}
+        """
+
+        gcl.parseClass """
+            package org.codehaus.groovy.transform
+
+            import org.codehaus.groovy.control.CompilePhase
+
+            @GroovyASTTransformation(phase = CompilePhase.CONVERSION)
+            public class LocalTransformASTTransformation extends AbstractASTTransformation {
+                void visit(org.codehaus.groovy.ast.ASTNode[] nodes, org.codehaus.groovy.control.SourceUnit source) {}
+            }
+        """
+
+        shouldFail CompilationFailedException, {
+            gcl.parseClass """
+                import org.codehaus.groovy.transform.*
+
+                @LocalTransform class Test {}
+            """
+        }
+    }
+
+    void testVerifyCompilePhaseBeforeSemanticAnalysisWithClassReference()  {
+        def gcl = new GroovyClassLoader()
+
+        gcl.parseClass """
+                package org.codehaus.groovy.transform
+
+                import org.codehaus.groovy.control.CompilePhase
+
+                @GroovyASTTransformation(phase = CompilePhase.CONVERSION)
+                public class LocalTransformASTTransformation1 extends AbstractASTTransformation {
+                    void visit(org.codehaus.groovy.ast.ASTNode[] nodes, org.codehaus.groovy.control.SourceUnit source) {}
+                }
+            """
+
+        gcl.parseClass """
+                        package org.codehaus.groovy.transform
+
+                        import org.codehaus.groovy.control.CompilePhase
+
+                        @GroovyASTTransformation(phase = CompilePhase.CONVERSION)
+                        public class LocalTransformASTTransformation2 extends AbstractASTTransformation {
+                            void visit(org.codehaus.groovy.ast.ASTNode[] nodes, org.codehaus.groovy.control.SourceUnit source) {}
+                        }
+                    """
+
+        gcl.parseClass """
+                package org.codehaus.groovy.transform
+
+                import java.lang.annotation.Retention
+                import java.lang.annotation.RetentionPolicy
+                import java.lang.annotation.Target
+                import java.lang.annotation.ElementType
+
+                @Retention(RetentionPolicy.RUNTIME)
+                @Target([ElementType.TYPE])
+                @GroovyASTTransformationClass(classes = [org.codehaus.groovy.transform.LocalTransformASTTransformation1, org.codehaus.groovy.transform.LocalTransformASTTransformation2])
+                public @interface LocalTransform {}
+            """
+
+        shouldFail CompilationFailedException, {
+            gcl.parseClass """
+                    import org.codehaus.groovy.transform.*
+
+                    @LocalTransform class Test {}
+                """
+        }
+    }
+}
+
+
+
+
