diff --git a/build.gradle b/build.gradle
index a92b4ddea4..393758feba 100644
--- a/build.gradle
+++ b/build.gradle
@@ -162,9 +162,9 @@ dependencies {
     api "org.ow2.asm:asm:$asmVersion" // marked as api but manually excluded later in assemble.gradle - modules will use shaded version
     // for internal usage by the parser but manually excluded later in assemble.gradle - modules will use shaded version
     api "antlr:antlr:$antlrVersion"
-    compileOnly "org.ow2.asm:asm-analysis:$asmVersion"
-    compileOnly "org.ow2.asm:asm-commons:$asmVersion"
-    compileOnly "org.ow2.asm:asm-tree:$asmVersion"
+    implementation "org.ow2.asm:asm-analysis:$asmVersion"
+    implementation "org.ow2.asm:asm-commons:$asmVersion"
+    implementation "org.ow2.asm:asm-tree:$asmVersion"
     implementation "org.ow2.asm:asm-util:$asmVersion"
     implementation("com.thoughtworks.xstream:xstream:$xstreamVersion") {
         exclude(group: 'xpp3', module: 'xpp3_min')
diff --git a/gradle/assemble.gradle b/gradle/assemble.gradle
index 2ab73d10a8..fd1d5ffc6a 100644
--- a/gradle/assemble.gradle
+++ b/gradle/assemble.gradle
@@ -204,7 +204,7 @@ allprojects {
             dependsOn arch
             from = file(arch.archiveFile)
             if (project == rootProject) {
-                repackagedLibraries = files(configurations.runtime.incoming.artifactView {
+                repackagedLibraries = files(configurations.runtimeClasspath.incoming.artifactView {
                     componentFilter { component ->
                         if (component instanceof ModuleComponentIdentifier) {
                             return component.module in [
diff --git a/gradle/upload.gradle b/gradle/upload.gradle
index e054aedfdf..ca5cb9a932 100644
--- a/gradle/upload.gradle
+++ b/gradle/upload.gradle
@@ -24,7 +24,7 @@ if (isUsingArtifactory) {
     logger.lifecycle 'Deployment environment set to Artifactory'
 }
 
-def embedded = ['asm', 'asm-util', 'asm-analysis', 'asm-tree', 'asm-commons', 'antlr', 'commons-cli', 'openbeans']
+def embedded = ['asm', 'asm-util', 'asm-analysis', 'asm-tree', 'asm-commons', 'antlr', 'picocli', 'openbeans']
 def removeJarjaredDependencies = { p ->
     p.dependencies.removeAll(p.dependencies.findAll {
         it.groupId == 'org.apache.groovy' || embedded.contains(it.artifactId)
