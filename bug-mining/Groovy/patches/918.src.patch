diff --git a/src/main/org/codehaus/groovy/classgen/AsmClassGenerator.java b/src/main/org/codehaus/groovy/classgen/AsmClassGenerator.java
index 1618f67062..ec536ee70d 100644
--- a/src/main/org/codehaus/groovy/classgen/AsmClassGenerator.java
+++ b/src/main/org/codehaus/groovy/classgen/AsmClassGenerator.java
@@ -3910,7 +3910,12 @@ public class AsmClassGenerator extends ClassGenerator {
         // let's evaluate the RHS then hopefully the LHS will be a field
         Expression rightExpression = expression.getRightExpression();
         if (!(leftExpression instanceof TupleExpression)) {
-            ClassNode type = getLHSType(leftExpression);
+        	ClassNode type = null;
+        	if(expression instanceof DeclarationExpression) {
+        		type = leftExpression.getType();
+        	} else {
+        		type = getLHSType(leftExpression);
+        	}
             assignmentCastAndVisit(type,rightExpression);
         }  else {
             // multiple assignment here!
diff --git a/src/test/groovy/bugs/Groovy3389Bug.groovy b/src/test/groovy/bugs/Groovy3389Bug.groovy
new file mode 100644
index 0000000000..342a092745
--- /dev/null
+++ b/src/test/groovy/bugs/Groovy3389Bug.groovy
@@ -0,0 +1,18 @@
+package groovy.bugs
+
+class Groovy3389Bug extends GroovyTestCase {
+    void testFieldHidingByLocalVariable() {
+        assertScript """
+            class Groovy3389 {
+                String bar
+                void doIt() {
+                    def bar = new File('.')
+                    assert bar instanceof File
+                }
+            }
+            
+            def obj = new Groovy3389()
+            obj.doIt()
+        """
+    }
+}
\ No newline at end of file
