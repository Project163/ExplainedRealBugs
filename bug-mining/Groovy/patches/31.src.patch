diff --git a/src/main/org/codehaus/groovy/classgen/ClassGenerator.java b/src/main/org/codehaus/groovy/classgen/ClassGenerator.java
index 91edd31185..3f4bea1515 100644
--- a/src/main/org/codehaus/groovy/classgen/ClassGenerator.java
+++ b/src/main/org/codehaus/groovy/classgen/ClassGenerator.java
@@ -860,10 +860,9 @@ public class ClassGenerator extends CodeVisitorSupport implements GroovyClassVis
         onLineNumber(statement);
 
         Expression expression = statement.getExpression();
-        expression.visit(this);
+        visitAndAutobox(expression);
 
-        if (expression instanceof MethodCallExpression
-            && !MethodCallExpression.isSuperMethodCall((MethodCallExpression) expression)) {
+        if (isPopRequired(expression)) {
             cv.visitInsn(POP);
         }
     }
@@ -1504,6 +1503,22 @@ public class ClassGenerator extends CodeVisitorSupport implements GroovyClassVis
         return superClass != null && superClass.equals("groovy.lang.Script") && methodNode != null && methodNode.getName().equals("run");
     }
 
+    /**
+     * @return true if this expression will have left a value on the stack
+     * that must be popped
+     */
+    protected boolean isPopRequired(Expression expression) {
+        if (expression instanceof MethodCallExpression) {
+            return !MethodCallExpression.isSuperMethodCall((MethodCallExpression) expression);
+        }
+        if (expression instanceof BinaryExpression) {
+            BinaryExpression binExp = (BinaryExpression) expression;
+            return binExp.getOperation().getType() != Token.EQUAL;
+        }
+        return true;
+    }
+
+    
     protected boolean firstStatementIsSuperMethodCall(Statement code) {
         if (code instanceof BlockStatement) {
             BlockStatement block = (BlockStatement) code;
diff --git a/src/test/groovy/bugs/InconsistentStackHeightBug.groovy b/src/test/groovy/bugs/InconsistentStackHeightBug.groovy
index 1cc4bfe36d..a3f9b303e3 100644
--- a/src/test/groovy/bugs/InconsistentStackHeightBug.groovy
+++ b/src/test/groovy/bugs/InconsistentStackHeightBug.groovy
@@ -5,10 +5,25 @@ class InconsistentStackHeightBug extends GroovyTestCase {
 
     void testBug() {
         server = 0
-        /** @todo the following fails
         server + 1
-        */
-        dummy = server + 1
+        try {
+        }
+        finally {
+        }
+    }
+
+    void testBug2() {
+        server = 0
+        server == 2
+        try {
+        }
+        finally {
+        }
+    }
+
+    void testBug3() {
+        server = 0
+        server
         try {
         }
         finally {
