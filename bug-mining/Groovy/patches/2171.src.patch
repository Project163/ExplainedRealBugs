diff --git a/src/main/org/codehaus/groovy/classgen/ExtendedVerifier.java b/src/main/org/codehaus/groovy/classgen/ExtendedVerifier.java
index 1cda885f4e..b125306a41 100644
--- a/src/main/org/codehaus/groovy/classgen/ExtendedVerifier.java
+++ b/src/main/org/codehaus/groovy/classgen/ExtendedVerifier.java
@@ -162,7 +162,7 @@ public class ExtendedVerifier implements GroovyClassVisitor {
      * @return true if running on a 1.5+ runtime
      */
     protected boolean isAnnotationCompatible() {
-        return CompilerConfiguration.POST_JDK5.equals(this.source.getConfiguration().getTargetBytecode());
+        return CompilerConfiguration.isPostJDK5(this.source.getConfiguration().getTargetBytecode());
     }
 
     protected void addError(String msg, ASTNode expr) {
diff --git a/src/main/org/codehaus/groovy/classgen/asm/WriterController.java b/src/main/org/codehaus/groovy/classgen/asm/WriterController.java
index 1a027eb112..1ad7c9cf4d 100644
--- a/src/main/org/codehaus/groovy/classgen/asm/WriterController.java
+++ b/src/main/org/codehaus/groovy/classgen/asm/WriterController.java
@@ -29,6 +29,7 @@ import org.codehaus.groovy.ast.InterfaceHelperClassNode;
 import org.codehaus.groovy.ast.MethodNode;
 import org.codehaus.groovy.classgen.AsmClassGenerator;
 import org.codehaus.groovy.classgen.GeneratorContext;
+import org.codehaus.groovy.control.CompilerConfiguration;
 import org.codehaus.groovy.control.SourceUnit;
 import org.objectweb.asm.ClassVisitor;
 import org.objectweb.asm.MethodVisitor;
@@ -80,7 +81,8 @@ public class WriterController {
     private int lineNumber = -1;
 
     public void init(AsmClassGenerator asmClassGenerator, GeneratorContext gcon, ClassVisitor cv, ClassNode cn) {
-        Map<String,Boolean> optOptions = cn.getCompileUnit().getConfig().getOptimizationOptions();
+        CompilerConfiguration config = cn.getCompileUnit().getConfig();
+        Map<String,Boolean> optOptions = config.getOptimizationOptions();
         boolean invokedynamic=false;
         if (optOptions.isEmpty()) {
             // IGNORE
@@ -96,9 +98,10 @@ public class WriterController {
         this.classNode = cn;
         this.outermostClass = null;
         this.internalClassName = BytecodeHelper.getClassInternalName(classNode);
-        
+
+        bytecodeVersion = chooseBytecodeVersion(invokedynamic, config.getTargetBytecode());
+
         if (invokedynamic) {
-            bytecodeVersion = Opcodes.V1_7;
             try {
                 this.invocationWriter = (InvocationWriter) indyWriter.newInstance(this);
                 this.callSiteWriter = (CallSiteWriter) indyCallSiteWriter.newInstance(this);
@@ -139,6 +142,27 @@ public class WriterController {
         this.typeChooser = new StatementMetaTypeChooser();
     }
 
+    private static int chooseBytecodeVersion(final boolean invokedynamic, final String targetBytecode) {
+        // todo: support JDK 1.8 when ASM5 is out
+        if (invokedynamic) {
+            return Opcodes.V1_7;
+        } else {
+            if (CompilerConfiguration.JDK4.equals(targetBytecode)) {
+                return Opcodes.V1_4;
+            }
+            if (CompilerConfiguration.JDK5.equals(targetBytecode)) {
+                return Opcodes.V1_5;
+            }
+            if (CompilerConfiguration.JDK6.equals(targetBytecode)) {
+                return Opcodes.V1_6;
+            }
+            if (CompilerConfiguration.JDK7.equals(targetBytecode)) {
+                return Opcodes.V1_7;
+            }
+        }
+        throw new GroovyBugError("Bytecode version ["+targetBytecode+"] is not supported by the compiler");
+    }
+
     public AsmClassGenerator getAcg() {
         return acg;
     }
diff --git a/src/main/org/codehaus/groovy/control/CompilationUnit.java b/src/main/org/codehaus/groovy/control/CompilationUnit.java
index c7b431b4be..8fa2f585f5 100644
--- a/src/main/org/codehaus/groovy/control/CompilationUnit.java
+++ b/src/main/org/codehaus/groovy/control/CompilationUnit.java
@@ -816,7 +816,8 @@ public class CompilationUnit extends ProcessingUnit {
     protected ClassVisitor createClassVisitor() {
         CompilerConfiguration config = getConfiguration();
         int computeMaxStackAndFrames = ClassWriter.COMPUTE_MAXS;
-        if (Boolean.TRUE.equals(config.getOptimizationOptions().get("indy"))) {
+        if (CompilerConfiguration.isPostJDK7(config.getTargetBytecode())
+                || Boolean.TRUE.equals(config.getOptimizationOptions().get("indy"))) {
             computeMaxStackAndFrames += ClassWriter.COMPUTE_FRAMES;
         }
         return new ClassWriter(computeMaxStackAndFrames) {
diff --git a/src/main/org/codehaus/groovy/control/CompilerConfiguration.java b/src/main/org/codehaus/groovy/control/CompilerConfiguration.java
index 91de74a971..3753833392 100644
--- a/src/main/org/codehaus/groovy/control/CompilerConfiguration.java
+++ b/src/main/org/codehaus/groovy/control/CompilerConfiguration.java
@@ -37,11 +37,24 @@ public class CompilerConfiguration {
 
     private static final String JDK5_CLASSNAME_CHECK = "java.lang.annotation.Annotation";
 
+    /** This (<code>"1.4"</code>) is the value for targetBytecode to compile for a JDK 1.4. **/
+    public static final String JDK4 = "1.4";
+    /** This (<code>"1.5"</code>) is the value for targetBytecode to compile for a JDK 1.5. **/
+    public static final String JDK5 = "1.5";
+    /** This (<code>"1.6"</code>) is the value for targetBytecode to compile for a JDK 1.6. **/
+    public static final String JDK6 = "1.6";
+    /** This (<code>"1.7"</code>) is the value for targetBytecode to compile for a JDK 1.7. **/
+    public static final String JDK7 = "1.7";
+    /** This (<code>"1.8"</code>) is the value for targetBytecode to compile for a JDK 1.8. **/
+    public static final String JDK8 = "1.8";
+
     /** This (<code>"1.5"</code>) is the value for targetBytecode to compile for a JDK 1.5 or later JVM. **/
-    public static final String POST_JDK5 = "1.5";
-    
-    /** This (<code>"1.4"</code>) is the value for targetBytecode to compile for a JDK 1.4 JVM. **/
-    public static final String PRE_JDK5 = "1.4";
+    public static final String POST_JDK5 = JDK5; // for backwards compatibility
+
+    /** This (<code>"1.4"<code/>) is the value for targetBytecode to compile for a JDK 1.4 JVM. **/
+    public static final String PRE_JDK5 = JDK4;
+
+    private static final String[] ALLOWED_JDKS = { JDK4, JDK5, JDK6, JDK7 };
 
     // Just call getVMVersion() once.
     public static final String currentJVMVersion = getVMVersion();
@@ -335,7 +348,31 @@ public class CompilerConfiguration {
         this();
         configure(configuration);
     }
-    
+
+    /**
+     * Checks if the specified bytecode version string represents a JDK 1.5+ compatible
+     * bytecode version.
+     * @param bytecodeVersion the bytecode version string (1.4, 1.5, 1.6, 1.7 or 1.8)
+     * @return true if the bytecode version is JDK 1.5+
+     */
+    public static boolean isPostJDK5(String bytecodeVersion) {
+        return JDK5.equals(bytecodeVersion)
+            || JDK6.equals(bytecodeVersion)
+            || JDK7.equals(bytecodeVersion)
+            || JDK8.equals(bytecodeVersion);
+    }
+
+    /**
+     * Checks if the specified bytecode version string represents a JDK 1.7+ compatible
+     * bytecode version.
+     * @param bytecodeVersion the bytecode version string (1.4, 1.5, 1.6, 1.7 or 1.8)
+     * @return true if the bytecode version is JDK 1.7+
+     */
+    public static boolean isPostJDK7(String bytecodeVersion) {
+        return JDK7.equals(bytecodeVersion)
+            || JDK8.equals(bytecodeVersion);
+    }
+
     /**
      * Method to configure a this CompilerConfiguration by using Properties.
      * For a list of available properties look at {link {@link #CompilerConfiguration(Properties)}.
@@ -679,14 +716,16 @@ public class CompilerConfiguration {
 
     /**
      * Allow setting the bytecode compatibility. The parameter can take
-     * one of the values <tt>1.5</tt> or <tt>1.4</tt>. If wrong parameter
-     * then the value will default to VM determined version.
+     * one of the values <tt>1.7</tt>, <tt>1.6</tt>, <tt>1.5</tt> or <tt>1.4</tt>.
+     * If wrong parameter then the value will default to VM determined version.
      * 
      * @param version the bytecode compatibility mode
      */
     public void setTargetBytecode(String version) {
-        if(PRE_JDK5.equals(version) || POST_JDK5.equals(version)) {
-            this.targetBytecode = version;
+        for (String allowedJdk : ALLOWED_JDKS) {
+            if (allowedJdk.equals(version)) {
+                this.targetBytecode = version;
+            }
         }
     }
 
diff --git a/src/main/org/codehaus/groovy/tools/javac/JavaAwareCompilationUnit.java b/src/main/org/codehaus/groovy/tools/javac/JavaAwareCompilationUnit.java
index 1e8fe080cb..2ff9a7c58c 100644
--- a/src/main/org/codehaus/groovy/tools/javac/JavaAwareCompilationUnit.java
+++ b/src/main/org/codehaus/groovy/tools/javac/JavaAwareCompilationUnit.java
@@ -55,7 +55,7 @@ public class JavaAwareCompilationUnit extends CompilationUnit {
         javaSources = new LinkedList<String>();
         Map options = configuration.getJointCompilationOptions();
         generationGoal = (File) options.get("stubDir");
-        boolean useJava5 = configuration.getTargetBytecode().equals(CompilerConfiguration.POST_JDK5);
+        boolean useJava5 = CompilerConfiguration.isPostJDK5(configuration.getTargetBytecode());
         stubGenerator = new JavaStubGenerator(generationGoal, false, useJava5);
         keepStubs = Boolean.TRUE.equals(options.get("keepStubs"));
 
diff --git a/src/main/org/codehaus/groovy/tools/javac/JavaStubCompilationUnit.java b/src/main/org/codehaus/groovy/tools/javac/JavaStubCompilationUnit.java
index 7b0d779430..b557f3242e 100644
--- a/src/main/org/codehaus/groovy/tools/javac/JavaStubCompilationUnit.java
+++ b/src/main/org/codehaus/groovy/tools/javac/JavaStubCompilationUnit.java
@@ -52,7 +52,7 @@ public class JavaStubCompilationUnit extends CompilationUnit {
         if (destDir == null) {
             destDir = (File) options.get("stubDir");
         }
-        boolean useJava5 = config.getTargetBytecode().equals(CompilerConfiguration.POST_JDK5);
+        boolean useJava5 = CompilerConfiguration.isPostJDK5(configuration.getTargetBytecode());
         stubGenerator = new JavaStubGenerator(destDir, false, useJava5);
 
         addPhaseOperation(new PrimaryClassNodeOperation() {
