diff --git a/src/main/java/org/codehaus/groovy/classgen/asm/ClosureWriter.java b/src/main/java/org/codehaus/groovy/classgen/asm/ClosureWriter.java
index 73f1234fe3..0c877f5c8d 100644
--- a/src/main/java/org/codehaus/groovy/classgen/asm/ClosureWriter.java
+++ b/src/main/java/org/codehaus/groovy/classgen/asm/ClosureWriter.java
@@ -407,8 +407,10 @@ public class ClosureWriter {
         Parameter[] refs = new Parameter[variableScope.getReferencedLocalVariablesCount()]; int index = 0;
         for (Iterator<Variable> iter = variableScope.getReferencedLocalVariablesIterator(); iter.hasNext(); ) {
             Variable variable = iter.next();
+            Expression varExp = variable instanceof VariableExpression
+                                ? (VariableExpression) variable : varX(variable); // GROOVY-11471
 
-            ClassNode inferenceType = typeChooser.resolveType(varX(variable), classNode); // GROOVY-11068
+            ClassNode inferenceType = typeChooser.resolveType(varExp, classNode); // GROOVY-11068
             Parameter p = new Parameter(inferenceType, variable.getName());
             p.setClosureSharedVariable(variable.isClosureSharedVariable());
 
diff --git a/src/test/groovy/transform/stc/ClosuresSTCTest.groovy b/src/test/groovy/transform/stc/ClosuresSTCTest.groovy
index 65781ba625..8bceb4cfd2 100644
--- a/src/test/groovy/transform/stc/ClosuresSTCTest.groovy
+++ b/src/test/groovy/transform/stc/ClosuresSTCTest.groovy
@@ -510,8 +510,21 @@ class ClosuresSTCTest extends StaticTypeCheckingTestCase {
         '''
     }
 
-    // GROOVY-10052
+    // GROOVY-11471
     void testClosureSharedVariable6() {
+        assertScript '''
+            def x = 1
+            Closure c = null
+            if (true) {
+              c = { x = "" }
+            }
+            x = 1
+            c()
+        '''
+    }
+
+    // GROOVY-10052
+    void testClosureSharedVariable7() {
         assertScript '''
             String x
             def f = { ->
@@ -523,7 +536,7 @@ class ClosuresSTCTest extends StaticTypeCheckingTestCase {
     }
 
     // GROOVY-10052
-    void testClosureSharedVariable7() {
+    void testClosureSharedVariable8() {
         assertScript '''
             def x
             def f = { ->
