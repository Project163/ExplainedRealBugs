diff --git a/src/main/org/codehaus/groovy/transform/sc/transformers/BinaryExpressionTransformer.java b/src/main/org/codehaus/groovy/transform/sc/transformers/BinaryExpressionTransformer.java
index e1bcacbbe6..9380f6b292 100644
--- a/src/main/org/codehaus/groovy/transform/sc/transformers/BinaryExpressionTransformer.java
+++ b/src/main/org/codehaus/groovy/transform/sc/transformers/BinaryExpressionTransformer.java
@@ -84,7 +84,10 @@ public class BinaryExpressionTransformer {
                 if (!rightExpression.getType().equals(declarationType)
                         && wrapper.isDerivedFrom(ClassHelper.Number_TYPE)
                         && WideningCategories.isDoubleCategory(unwrapper)) {
-                    return optimizeConstantInitialization(bin, operation, (ConstantExpression) rightExpression, leftExpression, declarationType);
+                    ConstantExpression constant = (ConstantExpression) rightExpression;
+                    if (constant.getValue()!=null) {
+                        return optimizeConstantInitialization(bin, operation, constant, leftExpression, declarationType);
+                    }
                 }
             }
         }
diff --git a/src/test/org/codehaus/groovy/classgen/asm/sc/Groovy7222OptimizationsTest.groovy b/src/test/org/codehaus/groovy/classgen/asm/sc/Groovy7222OptimizationsTest.groovy
index 0571479a51..44b6597820 100644
--- a/src/test/org/codehaus/groovy/classgen/asm/sc/Groovy7222OptimizationsTest.groovy
+++ b/src/test/org/codehaus/groovy/classgen/asm/sc/Groovy7222OptimizationsTest.groovy
@@ -94,4 +94,15 @@ class Groovy7222OptimizationsTest extends StaticTypeCheckingTestCase implements
             assert !bytecode.contains('java/math/BigDecimal')
         }
     }
+
+    void testShouldNotThrowNPE() {
+        assertScript '''
+            @groovy.transform.CompileStatic
+            void foo() {
+              Double d = null
+            }
+
+            foo()
+        '''
+    }
 }
