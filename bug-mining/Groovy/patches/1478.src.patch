diff --git a/src/main/org/codehaus/groovy/classgen/InnerClassCompletionVisitor.java b/src/main/org/codehaus/groovy/classgen/InnerClassCompletionVisitor.java
index 004e18ee76..af55356f9a 100644
--- a/src/main/org/codehaus/groovy/classgen/InnerClassCompletionVisitor.java
+++ b/src/main/org/codehaus/groovy/classgen/InnerClassCompletionVisitor.java
@@ -21,34 +21,24 @@ import org.codehaus.groovy.ast.InnerClassNode;
 import org.codehaus.groovy.ast.MethodNode;
 import org.codehaus.groovy.ast.Parameter;
 import org.codehaus.groovy.ast.expr.ClassExpression;
+import org.codehaus.groovy.ast.expr.VariableExpression;
 import org.codehaus.groovy.ast.stmt.BlockStatement;
 import org.codehaus.groovy.classgen.asm.BytecodeHelper;
-import org.codehaus.groovy.control.CompilationUnit;
-import org.codehaus.groovy.control.SourceUnit;
 import org.objectweb.asm.MethodVisitor;
 import org.objectweb.asm.Opcodes;
 
-public class InnerClassCompletionVisitor extends InnerClassVisitorHelper implements Opcodes {
+import static org.objectweb.asm.Opcodes.*;
+import static org.codehaus.groovy.classgen.InnerClassVisitorHelper.*;
 
-    private final SourceUnit sourceUnit;
+public class InnerClassCompletionVisitor {
 
-    public InnerClassCompletionVisitor(CompilationUnit cu, SourceUnit su) {
-        sourceUnit = su;
-    }
-
-    @Override
-    protected SourceUnit getSourceUnit() {
-        return sourceUnit;
-    }
-
-    @Override
     public void visitClass(ClassNode node) {
         InnerClassNode innerClass = null;
         if (!node.isEnum() && !node.isInterface() && node instanceof InnerClassNode) {
             innerClass = (InnerClassNode) node;
         }
-        super.visitClass(node);
         if (node.isEnum() || node.isInterface()) return;
+        addDispatcherMethods(node);
         if (innerClass == null) return;
 
         addDefaultMethods(innerClass);
@@ -62,13 +52,74 @@ public class InnerClassCompletionVisitor extends InnerClassVisitorHelper impleme
         return BytecodeHelper.getClassInternalName(getClassNode(node, isStatic));
     }
 
+    private void addDispatcherMethods(ClassNode classNode) {
+        final int objectDistance = getObjectDistance(classNode);
+
+        // since we added an anonymous inner class we should also
+        // add the dispatcher methods
+
+        // add method dispatcher
+        Parameter[] parameters = new Parameter[]{
+                new Parameter(ClassHelper.STRING_TYPE, "name"),
+                new Parameter(ClassHelper.OBJECT_TYPE, "args")
+        };
+        MethodNode method = classNode.addSyntheticMethod(
+                "this$dist$invoke$" + objectDistance,
+                ACC_PUBLIC + ACC_SYNTHETIC,
+                ClassHelper.OBJECT_TYPE,
+                parameters,
+                ClassNode.EMPTY_ARRAY,
+                null
+        );
+
+        BlockStatement block = new BlockStatement();
+        setMethodDispatcherCode(block, VariableExpression.THIS_EXPRESSION, parameters);
+        method.setCode(block);
+
+        // add property setter
+        parameters = new Parameter[]{
+                new Parameter(ClassHelper.STRING_TYPE, "name"),
+                new Parameter(ClassHelper.OBJECT_TYPE, "value")
+        };
+        method = classNode.addSyntheticMethod(
+                "this$dist$set$" + objectDistance,
+                ACC_PUBLIC + ACC_SYNTHETIC,
+                ClassHelper.VOID_TYPE,
+                parameters,
+                ClassNode.EMPTY_ARRAY,
+                null
+        );
+
+        block = new BlockStatement();
+        setPropertySetterDispatcher(block, VariableExpression.THIS_EXPRESSION, parameters);
+        method.setCode(block);
+
+        // add property getter
+        parameters = new Parameter[]{
+                new Parameter(ClassHelper.STRING_TYPE, "name")
+        };
+        method = classNode.addSyntheticMethod(
+                "this$dist$get$" + objectDistance,
+                ACC_PUBLIC + ACC_SYNTHETIC,
+                ClassHelper.OBJECT_TYPE,
+                parameters,
+                ClassNode.EMPTY_ARRAY,
+                null
+        );
+
+        block = new BlockStatement();
+        setPropertyGetterDispatcher(block, VariableExpression.THIS_EXPRESSION, parameters);
+        method.setCode(block);
+    }
+    
     private void addDefaultMethods(InnerClassNode node) {
         final boolean isStatic = isStatic(node);
 
+        ClassNode outerClass = node.getOuterClass();
         final String classInternalName = org.codehaus.groovy.classgen.asm.BytecodeHelper.getClassInternalName(node);
-        final String outerClassInternalName = getInternalName(node.getOuterClass(), isStatic);
-        final String outerClassDescriptor = getTypeDescriptor(node.getOuterClass(), isStatic);
-        final int objectDistance = getObjectDistance(node.getOuterClass());
+        final String outerClassInternalName = getInternalName(outerClass, isStatic);
+        final String outerClassDescriptor = getTypeDescriptor(outerClass, isStatic);
+        final int objectDistance = getObjectDistance(outerClass);
 
         // add method dispatcher
         Parameter[] parameters = new Parameter[]{
@@ -86,7 +137,7 @@ public class InnerClassCompletionVisitor extends InnerClassVisitorHelper impleme
 
         BlockStatement block = new BlockStatement();
         if (isStatic) {
-            setMethodDispatcherCode(block, new ClassExpression(node.getOuterClass()), parameters);
+            setMethodDispatcherCode(block, new ClassExpression(outerClass), parameters);
         } else {
             block.addStatement(
                     new BytecodeSequence(new BytecodeInstruction() {
diff --git a/src/main/org/codehaus/groovy/classgen/InnerClassVisitor.java b/src/main/org/codehaus/groovy/classgen/InnerClassVisitor.java
index f1aa1daa07..8b32da5591 100644
--- a/src/main/org/codehaus/groovy/classgen/InnerClassVisitor.java
+++ b/src/main/org/codehaus/groovy/classgen/InnerClassVisitor.java
@@ -77,7 +77,6 @@ public class InnerClassVisitor extends InnerClassVisitorHelper implements Opcode
         super.visitClass(node);
 
         if (node.isEnum() || node.isInterface()) return;
-        addDispatcherMethods();
         if (innerClass == null) return;
 
         if (node.getSuperClass().isInterface()) {
@@ -358,66 +357,6 @@ public class InnerClassVisitor extends InnerClassVisitorHelper implements Opcode
         }
     }
 
-    private void addDispatcherMethods() {
-        final int objectDistance = getObjectDistance(classNode);
-
-        // since we added an anonymous inner class we should also
-        // add the dispatcher methods
-
-        // add method dispatcher
-        Parameter[] parameters = new Parameter[]{
-                new Parameter(ClassHelper.STRING_TYPE, "name"),
-                new Parameter(ClassHelper.OBJECT_TYPE, "args")
-        };
-        MethodNode method = classNode.addSyntheticMethod(
-                "this$dist$invoke$" + objectDistance,
-                ACC_PUBLIC + ACC_SYNTHETIC,
-                ClassHelper.OBJECT_TYPE,
-                parameters,
-                ClassNode.EMPTY_ARRAY,
-                null
-        );
-
-        BlockStatement block = new BlockStatement();
-        setMethodDispatcherCode(block, VariableExpression.THIS_EXPRESSION, parameters);
-        method.setCode(block);
-
-        // add property setter
-        parameters = new Parameter[]{
-                new Parameter(ClassHelper.STRING_TYPE, "name"),
-                new Parameter(ClassHelper.OBJECT_TYPE, "value")
-        };
-        method = classNode.addSyntheticMethod(
-                "this$dist$set$" + objectDistance,
-                ACC_PUBLIC + ACC_SYNTHETIC,
-                ClassHelper.VOID_TYPE,
-                parameters,
-                ClassNode.EMPTY_ARRAY,
-                null
-        );
-
-        block = new BlockStatement();
-        setPropertySetterDispatcher(block, VariableExpression.THIS_EXPRESSION, parameters);
-        method.setCode(block);
-
-        // add property getter
-        parameters = new Parameter[]{
-                new Parameter(ClassHelper.STRING_TYPE, "name")
-        };
-        method = classNode.addSyntheticMethod(
-                "this$dist$get$" + objectDistance,
-                ACC_PUBLIC + ACC_SYNTHETIC,
-                ClassHelper.OBJECT_TYPE,
-                parameters,
-                ClassNode.EMPTY_ARRAY,
-                null
-        );
-
-        block = new BlockStatement();
-        setPropertyGetterDispatcher(block, VariableExpression.THIS_EXPRESSION, parameters);
-        method.setCode(block);
-    }
-
     private static void addFieldInit(Parameter p, FieldNode fn, BlockStatement block) {
         VariableExpression ve = new VariableExpression(p);
         FieldExpression fe = new FieldExpression(fn);
diff --git a/src/main/org/codehaus/groovy/classgen/InnerClassVisitorHelper.java b/src/main/org/codehaus/groovy/classgen/InnerClassVisitorHelper.java
index 77120f61b9..7cddc68ca3 100644
--- a/src/main/org/codehaus/groovy/classgen/InnerClassVisitorHelper.java
+++ b/src/main/org/codehaus/groovy/classgen/InnerClassVisitorHelper.java
@@ -33,7 +33,7 @@ import java.util.ArrayList;
 import java.util.List;
 
 public abstract class InnerClassVisitorHelper extends ClassCodeVisitorSupport {
-    protected void setPropertyGetterDispatcher(BlockStatement block, Expression thiz, Parameter[] parameters) {
+    protected static void setPropertyGetterDispatcher(BlockStatement block, Expression thiz, Parameter[] parameters) {
         List<ConstantExpression> gStringStrings = new ArrayList<ConstantExpression>();
         gStringStrings.add(new ConstantExpression(""));
         gStringStrings.add(new ConstantExpression(""));
@@ -52,7 +52,7 @@ public abstract class InnerClassVisitorHelper extends ClassCodeVisitorSupport {
         );
     }
 
-    protected void setPropertySetterDispatcher(BlockStatement block, Expression thiz, Parameter[] parameters) {
+    protected static void setPropertySetterDispatcher(BlockStatement block, Expression thiz, Parameter[] parameters) {
         List<ConstantExpression> gStringStrings = new ArrayList<ConstantExpression>();
         gStringStrings.add(new ConstantExpression(""));
         gStringStrings.add(new ConstantExpression(""));
@@ -75,7 +75,7 @@ public abstract class InnerClassVisitorHelper extends ClassCodeVisitorSupport {
         );
     }
 
-    protected void setMethodDispatcherCode(BlockStatement block, Expression thiz, Parameter[] parameters) {
+    protected static void setMethodDispatcherCode(BlockStatement block, Expression thiz, Parameter[] parameters) {
         List<ConstantExpression> gStringStrings = new ArrayList<ConstantExpression>();
         gStringStrings.add(new ConstantExpression(""));
         gStringStrings.add(new ConstantExpression(""));
@@ -97,19 +97,19 @@ public abstract class InnerClassVisitorHelper extends ClassCodeVisitorSupport {
         );
     }
 
-    protected boolean isStatic(InnerClassNode node) {
+    protected static boolean isStatic(InnerClassNode node) {
         VariableScope scope = node.getVariableScope();
         if (scope != null) return scope.isInStaticContext();
         return (node.getModifiers() & Opcodes.ACC_STATIC) != 0;
     }
 
-    protected ClassNode getClassNode(ClassNode node, boolean isStatic) {
+    protected static ClassNode getClassNode(ClassNode node, boolean isStatic) {
         if (isStatic) node = ClassHelper.CLASS_Type;
         return node;
     }
 
-    protected int getObjectDistance(ClassNode node) {
-        int count = 1;
+    protected static int getObjectDistance(ClassNode node) {
+        int count = 0;
         while (node != null && node != ClassHelper.OBJECT_TYPE) {
             count++;
             node = node.getSuperClass();
diff --git a/src/main/org/codehaus/groovy/control/CompilationUnit.java b/src/main/org/codehaus/groovy/control/CompilationUnit.java
index 0ca1360fd2..213dd0011d 100644
--- a/src/main/org/codehaus/groovy/control/CompilationUnit.java
+++ b/src/main/org/codehaus/groovy/control/CompilationUnit.java
@@ -198,7 +198,7 @@ public class CompilationUnit extends ProcessingUnit {
             @Override
             public void call(SourceUnit source, GeneratorContext context,
                              ClassNode classNode) throws CompilationFailedException {
-                InnerClassCompletionVisitor iv = new InnerClassCompletionVisitor(CompilationUnit.this, source);
+                InnerClassCompletionVisitor iv = new InnerClassCompletionVisitor();
                 iv.visitClass(classNode);
             }
         }, Phases.CANONICALIZATION);
