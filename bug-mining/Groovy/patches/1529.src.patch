diff --git a/src/main/org/codehaus/groovy/classgen/asm/CompileStack.java b/src/main/org/codehaus/groovy/classgen/asm/CompileStack.java
index dbb7abace3..d406951a07 100644
--- a/src/main/org/codehaus/groovy/classgen/asm/CompileStack.java
+++ b/src/main/org/codehaus/groovy/classgen/asm/CompileStack.java
@@ -587,6 +587,22 @@ public class CompileStack implements Opcodes {
         mv.visitVarInsn(ASTORE, reference.getIndex());
     }
     
+    private void pushInitValue(ClassNode type, MethodVisitor mv) {
+        if (ClassHelper.isPrimitiveType(type)) {
+            if (type==ClassHelper.long_TYPE) {
+                mv.visitInsn(LCONST_0);
+            } else if (type==ClassHelper.double_TYPE) {
+                mv.visitInsn(DCONST_0);
+            } else if (type==ClassHelper.float_TYPE) {
+                mv.visitInsn(FCONST_0);
+            } else {
+                mv.visitLdcInsn(0);
+            }
+        } else {
+            mv.visitInsn(ACONST_NULL);
+        }
+    }
+    
     /**
      * Defines a new Variable using an AST variable.
      * @param initFromStack if true the last element of the 
@@ -605,37 +621,19 @@ public class CompileStack implements Opcodes {
         MethodVisitor mv = controller.getMethodVisitor();
         Label startLabel  = new Label();
         answer.setStartLabel(startLabel);
+        ClassNode type = answer.getType().redirect();
+        OperandStack operandStack = controller.getOperandStack();
+
+        if (!initFromStack) pushInitValue(type, mv);
+        operandStack.push(answer.getType());
         if (answer.isHolder())  {
-            if (!initFromStack) {
-                mv.visitInsn(ACONST_NULL);
-            } else {
-                OperandStack operandStack = controller.getOperandStack();
-                operandStack.push(answer.getType());
-                operandStack.box();
-                operandStack.remove(1);
-            }
+            operandStack.box();
+            operandStack.remove(1);
             createReference(answer);
         } else {
-            if (!initFromStack) {
-                ClassNode type = answer.getType().redirect();
-                if (ClassHelper.isPrimitiveType(type)) {
-                    if (type==ClassHelper.long_TYPE) {
-                        mv.visitInsn(LCONST_0);
-                    } else if (type==ClassHelper.double_TYPE) {
-                        mv.visitInsn(DCONST_0);
-                    } else if (type==ClassHelper.float_TYPE) {
-                        mv.visitInsn(FCONST_0);
-                    } else {
-                        mv.visitLdcInsn(0);
-                    }
-                } else {
-                    mv.visitInsn(ACONST_NULL);
-                }
-            }
-            OperandStack operandStack = controller.getOperandStack();
-            operandStack.push(answer.getType());
             operandStack.storeVar(answer);
         } 
+        
         mv.visitLabel(startLabel);
         return answer;
     }
diff --git a/src/test/groovy/bugs/ClosureVariableBug.groovy b/src/test/groovy/bugs/ClosureVariableBug.groovy
index a08d318151..72814b2927 100644
--- a/src/test/groovy/bugs/ClosureVariableBug.groovy
+++ b/src/test/groovy/bugs/ClosureVariableBug.groovy
@@ -40,4 +40,22 @@ class ClosureVariableBug extends GroovyTestCase {
         collection.each { x = it }
         return x
     }
-}
\ No newline at end of file
+
+    void testLocalVariableWithPrimitiveType() {
+        assertScript """
+            int x
+            1.times { x=2 }
+            assert x==2
+        """
+        assertScript """
+            long x
+            1.times { x=2 }
+            assert x==2
+        """
+        assertScript """
+            double x
+            1.times { x=2 }
+            assert x==2
+        """
+    }
+}
