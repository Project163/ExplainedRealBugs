diff --git a/src/main/org/codehaus/groovy/runtime/m12n/StandardPropertiesModuleFactory.java b/src/main/org/codehaus/groovy/runtime/m12n/StandardPropertiesModuleFactory.java
index 21d85251d7..497ee82e43 100644
--- a/src/main/org/codehaus/groovy/runtime/m12n/StandardPropertiesModuleFactory.java
+++ b/src/main/org/codehaus/groovy/runtime/m12n/StandardPropertiesModuleFactory.java
@@ -35,6 +35,9 @@ public class StandardPropertiesModuleFactory extends PropertiesModuleFactory {
         if (factoryName!=null) {
             try {
                 Class<? extends PropertiesModuleFactory> factoryClass = (Class<? extends PropertiesModuleFactory>) classLoader.loadClass(factoryName);
+                System.err.println("Factory class classloader           = " + dump(factoryClass.getClassLoader()));
+                System.err.println("PropertiesModuleFactory classloader = " + dump(PropertiesModuleFactory.class.getClassLoader()));
+                System.err.println("ExtensionModule classloader         = " + dump(ExtensionModule.class.getClassLoader()));
                 PropertiesModuleFactory delegate = factoryClass.newInstance();
                 return delegate.newModule(properties, classLoader);
             } catch (ClassNotFoundException e) {
@@ -47,4 +50,18 @@ public class StandardPropertiesModuleFactory extends PropertiesModuleFactory {
         }
         return MetaInfExtensionModule.newModule(properties, classLoader);
     }
+
+    private String dump(ClassLoader cl) {
+        StringBuilder sb = new StringBuilder();
+        dump(cl, sb, 0);
+        return sb.toString();
+    }
+    private void dump(ClassLoader cl, StringBuilder sb, int depth) {
+        for (int i=0;i<4*depth;i++) sb.append("|--");
+        sb.append(cl);
+        sb.append('\n');
+        if (cl.getParent()!=null) {
+            dump(cl.getParent(), sb, depth+1);
+        }
+    }
 }
diff --git a/src/main/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java b/src/main/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java
index 0b2599e5fc..f66d78605a 100644
--- a/src/main/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java
+++ b/src/main/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java
@@ -1063,7 +1063,7 @@ public class StaticTypeCheckingVisitor extends ClassCodeVisitorSupport {
                     }
                 }
                 // GROOVY-5568, the property may be defined by DGM
-                List<MethodNode> methods = findDGMMethodsByNameAndArguments(getSourceUnit().getClassLoader(), testClass, "get" + capName, ClassNode.EMPTY_ARRAY);
+                List<MethodNode> methods = findDGMMethodsByNameAndArguments(getTransformLoader(), testClass, "get" + capName, ClassNode.EMPTY_ARRAY);
                 if (!methods.isEmpty()) {
                     List<MethodNode> methodNodes = chooseBestMethod(testClass, methods, ClassNode.EMPTY_ARRAY);
                     if (methodNodes.size() == 1) {
@@ -1845,7 +1845,7 @@ public class StaticTypeCheckingVisitor extends ClassCodeVisitorSupport {
         if (rtype != null && node.getAnnotations(TYPECHECKING_INFO_NODE).isEmpty()) {
             AnnotationNode anno = new AnnotationNode(TYPECHECKING_INFO_NODE);
             anno.setMember("version", CURRENT_SIGNATURE_PROTOCOL);
-            SignatureCodec codec = SignatureCodecFactory.getCodec(CURRENT_SIGNATURE_PROTOCOL_VERSION, getSourceUnit().getClassLoader());
+            SignatureCodec codec = SignatureCodecFactory.getCodec(CURRENT_SIGNATURE_PROTOCOL_VERSION, getTransformLoader());
             String genericsSignature = codec.encode(rtype);
             if (genericsSignature != null) {
                 ConstantExpression signature = new ConstantExpression(genericsSignature);
@@ -2096,9 +2096,7 @@ public class StaticTypeCheckingVisitor extends ClassCodeVisitorSupport {
         // initialize hints
         List<ClassNode[]> closureSignatures = null;
         try {
-            CompilationUnit compilationUnit = typeCheckingContext.getCompilationUnit();
-            @SuppressWarnings("resource")
-            GroovyClassLoader transformLoader = compilationUnit!=null?compilationUnit.getTransformLoader():getSourceUnit().getClassLoader();
+            ClassLoader transformLoader = getTransformLoader();
             @SuppressWarnings("unchecked")
             Class<? extends ClosureSignatureHint> hint = (Class<? extends ClosureSignatureHint>) transformLoader.loadClass(hintClass.getText());
             ClosureSignatureHint hintInstance = hint.newInstance();
@@ -2117,6 +2115,11 @@ public class StaticTypeCheckingVisitor extends ClassCodeVisitorSupport {
         return closureSignatures;
     }
 
+    private ClassLoader getTransformLoader() {
+        CompilationUnit compilationUnit = typeCheckingContext.getCompilationUnit();
+        return compilationUnit!=null?compilationUnit.getTransformLoader():getSourceUnit().getClassLoader();
+    }
+
     private void doInferClosureParameterTypes(final ClassNode receiver, final Expression arguments, final ClosureExpression expression, final MethodNode selectedMethod, final Expression hintClass, final Expression options) {
         List<ClassNode[]> closureSignatures = getSignaturesFromHint(expression,selectedMethod,hintClass,options);
         List<ClassNode[]> candidates = new LinkedList<ClassNode[]>();
@@ -3498,7 +3501,7 @@ public class StaticTypeCheckingVisitor extends ClassCodeVisitorSupport {
         }
 
         // lookup in DGM methods too
-        findDGMMethodsByNameAndArguments(getSourceUnit().getClassLoader(), receiver, name, args, methods);
+        findDGMMethodsByNameAndArguments(getTransformLoader(), receiver, name, args, methods);
         List<MethodNode> chosen = chooseBestMethod(receiver, methods, args);
         if (!chosen.isEmpty()) return chosen;
 
