diff --git a/src/main/org/codehaus/groovy/ast/ClassHelper.java b/src/main/org/codehaus/groovy/ast/ClassHelper.java
index 265a892f1c..1101185003 100644
--- a/src/main/org/codehaus/groovy/ast/ClassHelper.java
+++ b/src/main/org/codehaus/groovy/ast/ClassHelper.java
@@ -72,7 +72,7 @@ public class ClassHelper {
         BigDecimal_TYPE = new ClassNode(java.math.BigDecimal.class),
         void_WRAPPER_TYPE = new ClassNode(Void.class),   
         
-        CLASS_Type = new ClassNode(Class.class),        METACLASS_TYPE = new ClassNode(MetaClass.class),
+        CLASS_Type = makeWithoutCaching(Class.class),        METACLASS_TYPE = new ClassNode(MetaClass.class),
         GENERATED_CLOSURE_Type = new ClassNode(GeneratedClosure.class),
         Enum_Type = new ClassNode("java.lang.Enum",0,OBJECT_TYPE),
         Annotation_TYPE = new ClassNode("java.lang.annotation.Annotation",0,OBJECT_TYPE);
diff --git a/src/main/org/codehaus/groovy/ast/builder/AstSpecificationCompiler.groovy b/src/main/org/codehaus/groovy/ast/builder/AstSpecificationCompiler.groovy
index dcfa8f24e0..cec71d7531 100644
--- a/src/main/org/codehaus/groovy/ast/builder/AstSpecificationCompiler.groovy
+++ b/src/main/org/codehaus/groovy/ast/builder/AstSpecificationCompiler.groovy
@@ -1150,7 +1150,7 @@ import org.codehaus.groovy.ast.ClassHelper
     private void staticMethodCall(MethodClosure target, Closure argBlock) {
         captureAndCreateNode("StaticMethodCallExpression", argBlock) {
             expression.add(0, target.method)
-            expression.add(0, ClassHelper.make(target.owner.class))
+            expression.add(0, ClassHelper.makeWithoutCaching(target.owner.class, false))
             new StaticMethodCallExpression(
                     * enforceConstraints('staticMethodCall', [ClassNode, String, Expression])
             )
@@ -1170,4 +1170,4 @@ import org.codehaus.groovy.ast.ClassHelper
             )
         }
     }
-}
\ No newline at end of file
+}
diff --git a/src/main/org/codehaus/groovy/control/GenericsVisitor.java b/src/main/org/codehaus/groovy/control/GenericsVisitor.java
index fba4796910..b610535afb 100644
--- a/src/main/org/codehaus/groovy/control/GenericsVisitor.java
+++ b/src/main/org/codehaus/groovy/control/GenericsVisitor.java
@@ -18,7 +18,10 @@ package org.codehaus.groovy.control;
 
 import org.codehaus.groovy.ast.ClassCodeVisitorSupport;
 import org.codehaus.groovy.ast.ClassNode;
+import org.codehaus.groovy.ast.FieldNode;
 import org.codehaus.groovy.ast.GenericsType;
+import org.codehaus.groovy.ast.MethodNode;
+import org.codehaus.groovy.ast.Parameter;
 
 /**
  * class used to verify correct usage of generics in 
@@ -44,6 +47,22 @@ public class GenericsVisitor extends ClassCodeVisitorSupport {
         for (int i = 0; i < interfaces.length; i++) {
             checkGenericsUsage(interfaces[i], interfaces[i].redirect());
         }
+        node.visitContents(this);
+    }
+    
+    public void visitField(FieldNode node) {
+    	ClassNode type = node.getType();
+    	checkGenericsUsage(type, type.redirect());
+    }
+    
+    public void visitMethod(MethodNode node) {
+    	Parameter[] parameters = node.getParameters();
+    	for (Parameter param : parameters) {
+    		ClassNode paramType = param.getType();
+    		checkGenericsUsage(paramType, paramType.redirect());
+    	}
+    	ClassNode returnType = node.getReturnType();
+    	checkGenericsUsage(returnType, returnType.redirect());
     }
     
     private boolean checkWildcard(ClassNode cn) {
@@ -62,6 +81,7 @@ public class GenericsVisitor extends ClassCodeVisitorSupport {
     }
 
     private void checkGenericsUsage(ClassNode n, ClassNode cn) {
+    	if(n.isGenericsPlaceHolder()) return;
         GenericsType[] nTypes = n.getGenericsTypes();
         GenericsType[] cnTypes = cn.getGenericsTypes();
         // raw type usage is always allowed
diff --git a/src/test/groovy/bugs/Groovy3731Bug.groovy b/src/test/groovy/bugs/Groovy3731Bug.groovy
new file mode 100644
index 0000000000..a1cd1dc772
--- /dev/null
+++ b/src/test/groovy/bugs/Groovy3731Bug.groovy
@@ -0,0 +1,26 @@
+package groovy.bugs
+
+import gls.CompilableTestSupport
+
+class Groovy3731Bug extends CompilableTestSupport {
+	
+	void testWrongGenericsUseInFieldsAndMethods() {
+		shouldNotCompile """
+			public class G3731A {
+				Map<Object> m = [:]
+			}
+		"""
+
+        shouldNotCompile """
+	        public class G3731B {
+	            void m1(x, Map<Object> y) {}
+	        }
+	    """
+
+        shouldNotCompile """
+	        public class G3731C {
+	            Map<Object> m1(x, y) {null}
+	        }
+	    """
+	}
+}
\ No newline at end of file
diff --git a/src/test/org/codehaus/groovy/ast/builder/AstAssert.groovy b/src/test/org/codehaus/groovy/ast/builder/AstAssert.groovy
index 94f3acabd7..03ed8b74f2 100644
--- a/src/test/org/codehaus/groovy/ast/builder/AstAssert.groovy
+++ b/src/test/org/codehaus/groovy/ast/builder/AstAssert.groovy
@@ -354,7 +354,7 @@ public class AstAssert {
     static void assertSyntaxTree(expected, actual) {
         if (expected == null && actual == null) return
         
-        if (expected.size() != actual?.size()) {
+        if (actual == null || expected == null || expected.size() != actual?.size()) {
             Assert.fail("AST comparison failure. \nExpected $expected \nReceived $actual")
         }
         expected.eachWithIndex { item, index ->
@@ -373,4 +373,4 @@ public class AstAssert {
         }
     }
 
-}
\ No newline at end of file
+}
diff --git a/src/test/org/codehaus/groovy/ast/builder/AstBuilderFromSpecificationTest.groovy b/src/test/org/codehaus/groovy/ast/builder/AstBuilderFromSpecificationTest.groovy
index 912436e274..3a8bd2f5b3 100644
--- a/src/test/org/codehaus/groovy/ast/builder/AstBuilderFromSpecificationTest.groovy
+++ b/src/test/org/codehaus/groovy/ast/builder/AstBuilderFromSpecificationTest.groovy
@@ -1114,7 +1114,7 @@ public class AstBuilderFromSpecificationTest extends GroovyTestCase {
         }
 
         def expected = new StaticMethodCallExpression(
-                new ClassNode(Math),
+                ClassHelper.make(Math, false),
                 "min",
                 new ArgumentListExpression(
                         new ConstantExpression(1),
