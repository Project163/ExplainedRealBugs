diff --git a/src/main/groovy/util/GroovyScriptEngine.java b/src/main/groovy/util/GroovyScriptEngine.java
index ed2067ae0d..cf5c4ca569 100644
--- a/src/main/groovy/util/GroovyScriptEngine.java
+++ b/src/main/groovy/util/GroovyScriptEngine.java
@@ -74,9 +74,11 @@ public class GroovyScriptEngine implements ResourceConnector {
     private static class LocalData {
         CompilationUnit cu;
         StringSetMap dependencyCache = new StringSetMap();
-        Map<String,String> precompiledEntries = new HashMap<String,String>();
+        Map<String, String> precompiledEntries = new HashMap<String, String>();
     }
+
     private static WeakReference<ThreadLocal<LocalData>> localData = new WeakReference<ThreadLocal<LocalData>>(null);
+
     private static synchronized ThreadLocal<LocalData> getLocalData() {
         ThreadLocal<LocalData> local = localData.get();
         if (local != null) return local;
@@ -113,6 +115,7 @@ public class GroovyScriptEngine implements ResourceConnector {
             this.dependencies = depend;
             this.sourceNewer = sourceNewer;
         }
+
         public ScriptCacheEntry(ScriptCacheEntry old, long lastCheck, boolean sourceNewer) {
             this(old.scriptClass, old.lastModified, lastCheck, old.dependencies, sourceNewer);
         }
@@ -155,7 +158,7 @@ public class GroovyScriptEngine implements ResourceConnector {
             LocalData local = getLocalData().get();
             local.cu = cu;
             final StringSetMap cache = local.dependencyCache;
-            final Map<String,String> precompiledEntries = local.precompiledEntries;
+            final Map<String, String> precompiledEntries = local.precompiledEntries;
 
             // "." is used to transfer compilation dependencies, which will be
             // recollected later during compilation
@@ -170,7 +173,7 @@ public class GroovyScriptEngine implements ResourceConnector {
 
             // remove all old entries including the "." entry
             cache.clear();
-            
+
             cu.addPhaseOperation(new CompilationUnit.PrimaryClassNodeOperation() {
                 @Override
                 public void call(final SourceUnit source, GeneratorContext context, ClassNode classNode)
@@ -190,7 +193,7 @@ public class GroovyScriptEngine implements ResourceConnector {
                     String name = origName.replace('.', '/');
                     for (String ext : cc.getScriptExtensions()) {
                         try {
-                            String finalName = name+"."+ext;
+                            String finalName = name + "." + ext;
                             URLConnection conn = rc.getResourceConnection(finalName);
                             URL url = conn.getURL();
                             String path = url.toExternalForm();
@@ -207,7 +210,7 @@ public class GroovyScriptEngine implements ResourceConnector {
                             } else {
                                 precompiledEntries.put(origName, path);
                             }
-                            if (clazz!=null) {
+                            if (clazz != null) {
                                 ClassNode cn = new ClassNode(clazz);
                                 return new LookupResult(null, cn);
                             }
@@ -220,7 +223,7 @@ public class GroovyScriptEngine implements ResourceConnector {
             });
 
             final List<CompilationCustomizer> customizers = config.getCompilationCustomizers();
-            if (customizers!=null) {
+            if (customizers != null) {
                 // GROOVY-4813 : apply configuration customizers
                 for (CompilationCustomizer customizer : customizers) {
                     cu.addPhaseOperation(customizer, customizer.getPhase().getPhaseNumber());
@@ -243,7 +246,7 @@ public class GroovyScriptEngine implements ResourceConnector {
             LocalData localData = new LocalData();
             localTh.set(localData);
             StringSetMap cache = localData.dependencyCache;
-            
+
             // we put the old dependencies into local cache so createCompilationUnit
             // can pick it up. We put that entry under the name "."
             ScriptCacheEntry origEntry = scriptCache.get(codeSource.getName());
@@ -253,12 +256,12 @@ public class GroovyScriptEngine implements ResourceConnector {
                 Set<String> newDep = new HashSet<String>(origDep.size());
                 for (String depName : origDep) {
                     ScriptCacheEntry dep = scriptCache.get(depName);
-                    try{
-                        if (origEntry==dep || GroovyScriptEngine.this.isSourceNewer(dep)) {
+                    try {
+                        if (origEntry == dep || GroovyScriptEngine.this.isSourceNewer(dep)) {
                             newDep.add(depName);
                         }
                     } catch (ResourceException re) {
-                        
+
                     }
                 }
                 cache.put(".", newDep);
@@ -291,21 +294,22 @@ public class GroovyScriptEngine implements ResourceConnector {
             localTh.set(null);
             return answer;
         }
-        private String getPath(Class clazz, Map<String,String> precompiledEntries) {
+
+        private String getPath(Class clazz, Map<String, String> precompiledEntries) {
             CompilationUnit cu = getLocalData().get().cu;
             String name = clazz.getName();
             ClassNode classNode = cu.getClassNode(name);
             if (classNode == null) {
                 // this is a precompiled class!
                 String path = precompiledEntries.get(name);
-                if (path == null) throw new GroovyBugError("Precompiled class "+name+" should be available in precompiled entries map, but was not.");
+                if (path == null) throw new GroovyBugError("Precompiled class " + name + " should be available in precompiled entries map, but was not.");
                 return path;
             } else {
                 return classNode.getModule().getContext().getName();
             }
         }
 
-        private Set<String> convertToPaths(Set<String> orig, Map<String,String> precompiledEntries) {
+        private Set<String> convertToPaths(Set<String> orig, Map<String, String> precompiledEntries) {
             Set<String> ret = new HashSet<String>();
             for (String className : orig) {
                 Class clazz = getClassCacheEntry(className);
@@ -329,8 +333,9 @@ public class GroovyScriptEngine implements ResourceConnector {
         String line;
         while (true) {
             System.out.print("groovy> ");
-            if ((line = br.readLine()) == null || line.equals("quit"))
+            if ((line = br.readLine()) == null || line.equals("quit")) {
                 break;
+            }
             try {
                 System.out.println(gse.run(line, new Binding()));
             } catch (Exception e) {
@@ -374,14 +379,9 @@ public class GroovyScriptEngine implements ResourceConnector {
             URL scriptURL = null;
             try {
                 scriptURL = new URL(root, resourceName);
-                groovyScriptConn = scriptURL.openConnection();
-
-                // Make sure we can open it, if we can't it doesn't exist.
-                // Could be very slow if there are any non-file:// URLs in there
-                groovyScriptConn.getInputStream();
+                groovyScriptConn = openConnection(scriptURL);
 
                 break; // Now this is a bit unusual
-
             } catch (MalformedURLException e) {
                 String message = "Malformed URL: " + root + ", " + resourceName;
                 if (se == null) {
@@ -390,7 +390,6 @@ public class GroovyScriptEngine implements ResourceConnector {
                     se = new ResourceException(message, se);
                 }
             } catch (IOException e1) {
-                groovyScriptConn = null;
                 String message = "Cannot open URL: " + root + resourceName;
                 groovyScriptConn = null;
                 if (se == null) {
@@ -408,6 +407,13 @@ public class GroovyScriptEngine implements ResourceConnector {
         return groovyScriptConn;
     }
 
+    private static URLConnection openConnection(URL scriptURL) throws IOException {
+        URLConnection urlConnection = scriptURL.openConnection();
+        verifyInputStream(urlConnection);
+
+        return scriptURL.openConnection();
+    }
+
     /**
      * This method closes a {@link URLConnection} by getting its {@link InputStream} and calling the
      * {@link InputStream#close()} method on it. The {@link URLConnection} doesn't have a close() method
@@ -419,24 +425,29 @@ public class GroovyScriptEngine implements ResourceConnector {
      *
      * @param urlConnection the {@link URLConnection} to be "closed" to close the underlying file descriptors.
      */
-    private void forceClose(URLConnection urlConnection) {
+    private static void forceClose(URLConnection urlConnection) {
         if (urlConnection != null) {
             // We need to get the input stream and close it to force the open
             // file descriptor to be released. Otherwise, we will reach the limit
             // for number of files open at one time.
 
-            InputStream in = null;
             try {
-                in = urlConnection.getInputStream();
+                verifyInputStream(urlConnection);
             } catch (Exception e) {
                 // Do nothing: We were not going to use it anyway.
-            } finally {
-                if (in != null) {
-                    try {
-                        in.close();
-                    } catch (IOException e) {
-                        // Do nothing: Just want to make sure it is closed.
-                    }
+            }
+        }
+    }
+
+    private static void verifyInputStream(URLConnection urlConnection) throws IOException {
+        InputStream in = null;
+        try {
+            in = urlConnection.getInputStream();
+        } finally {
+            if (in != null) {
+                try {
+                    in.close();
+                } catch (IOException ignore) {
                 }
             }
         }
@@ -589,7 +600,7 @@ public class GroovyScriptEngine implements ResourceConnector {
     public Script createScript(String scriptName, Binding binding) throws ResourceException, ScriptException {
         return InvokerHelper.createScript(loadScriptByName(scriptName), binding);
     }
-    
+
     private long getLastModified(String scriptName) throws ResourceException {
         URLConnection conn = rc.getResourceConnection(scriptName);
         long lastMod = 0;
@@ -614,12 +625,12 @@ public class GroovyScriptEngine implements ResourceConnector {
             if (depEntry.sourceNewer) return true;
 
             // check if maybe dependency was recompiled, but this one here not
-            if (mainEntryLastCheck<depEntry.lastModified) {
+            if (mainEntryLastCheck < depEntry.lastModified) {
                 returnValue = true;
                 continue;
             }
 
-            if (now==0) now = getCurrentTime();
+            if (now == 0) now = getCurrentTime();
             long nextSourceCheck = depEntry.lastCheck + config.getMinimumRecompilationInterval();
             if (nextSourceCheck > now) continue;
 
