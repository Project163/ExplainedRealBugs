diff --git a/src/main/org/codehaus/groovy/ast/ClassHelper.java b/src/main/org/codehaus/groovy/ast/ClassHelper.java
index 1101185003..49fddf4053 100644
--- a/src/main/org/codehaus/groovy/ast/ClassHelper.java
+++ b/src/main/org/codehaus/groovy/ast/ClassHelper.java
@@ -75,7 +75,8 @@ public class ClassHelper {
         CLASS_Type = makeWithoutCaching(Class.class),        METACLASS_TYPE = new ClassNode(MetaClass.class),
         GENERATED_CLOSURE_Type = new ClassNode(GeneratedClosure.class),
         Enum_Type = new ClassNode("java.lang.Enum",0,OBJECT_TYPE),
-        Annotation_TYPE = new ClassNode("java.lang.annotation.Annotation",0,OBJECT_TYPE);
+        Annotation_TYPE = new ClassNode("java.lang.annotation.Annotation",0,OBJECT_TYPE),
+        ELEMENT_TYPE_TYPE = new ClassNode("java.lang.annotation.ElementType",0,Enum_Type);
         
     static {
         Enum_Type.isPrimaryNode = false;
diff --git a/src/main/org/codehaus/groovy/ast/builder/AstSpecificationCompiler.groovy b/src/main/org/codehaus/groovy/ast/builder/AstSpecificationCompiler.groovy
index 3be061703c..5f88d315f6 100644
--- a/src/main/org/codehaus/groovy/ast/builder/AstSpecificationCompiler.groovy
+++ b/src/main/org/codehaus/groovy/ast/builder/AstSpecificationCompiler.groovy
@@ -98,7 +98,7 @@ import org.codehaus.groovy.ast.ClassHelper
      * Creates the DSL compiler.
      */
 
-    @PackageScope AstSpecificationCompiler(Closure spec) {
+    AstSpecificationCompiler(Closure spec) {
         spec.delegate = this
         spec()
     }
@@ -108,7 +108,7 @@ import org.codehaus.groovy.ast.ClassHelper
      * Gets the current generated expression.
      */
 
-    @PackageScope List<ASTNode> getExpression() {
+    List<ASTNode> getExpression() {
         return expression
     }
 
diff --git a/src/main/org/codehaus/groovy/ast/builder/AstStringCompiler.groovy b/src/main/org/codehaus/groovy/ast/builder/AstStringCompiler.groovy
index 125109ffda..655e35cbab 100644
--- a/src/main/org/codehaus/groovy/ast/builder/AstStringCompiler.groovy
+++ b/src/main/org/codehaus/groovy/ast/builder/AstStringCompiler.groovy
@@ -23,7 +23,7 @@ import org.codehaus.groovy.control.CompilerConfiguration
      *      the int based CompilePhase to compile it to.
      * @param statementsOnly
      */
-    @PackageScope List<ASTNode> compile(String script, CompilePhase compilePhase, boolean statementsOnly) {
+    List<ASTNode> compile(String script, CompilePhase compilePhase, boolean statementsOnly) {
         def scriptClassName = "script" + System.currentTimeMillis()
         GroovyClassLoader classLoader = new GroovyClassLoader()
         GroovyCodeSource codeSource = new GroovyCodeSource(script, scriptClassName + ".groovy", "/groovy/script")
diff --git a/src/main/org/codehaus/groovy/vmplugin/v5/Java5.java b/src/main/org/codehaus/groovy/vmplugin/v5/Java5.java
index 38b66b6638..02cd5b6231 100644
--- a/src/main/org/codehaus/groovy/vmplugin/v5/Java5.java
+++ b/src/main/org/codehaus/groovy/vmplugin/v5/Java5.java
@@ -213,11 +213,12 @@ public class Java5 implements VMPlugin {
         } else if (type == Target.class) {
             Target t = (Target) annotation;
             ElementType[] elements = t.value();
-            int bitmap = 0;
+            ListExpression elementExprs = new ListExpression();
             for (ElementType element : elements) {
-                bitmap |= getElementCode(element);
+                elementExprs.addExpression(new PropertyExpression(
+                        new ClassExpression(ClassHelper.ELEMENT_TYPE_TYPE), element.name()));
             }
-            node.setAllowedTargets(bitmap);
+            node.setMember("value", elementExprs);
         }
     }
 
diff --git a/src/test/gls/annotations/AnnotationTest.groovy b/src/test/gls/annotations/AnnotationTest.groovy
index 61f5d1f1b9..e73b8ba056 100644
--- a/src/test/gls/annotations/AnnotationTest.groovy
+++ b/src/test/gls/annotations/AnnotationTest.groovy
@@ -528,6 +528,44 @@ class Foo {}
         """
         // compiler should allow this, because there is default value for x and value provided for y
         assertScript(scriptStr)
-  }
+    }
+
+    void testAllowedTargetsCheckAlsoWorksForAnnotationTypesDefinedOutsideThisCompilationUnit() {
+        shouldCompile """
+@java.lang.annotation.Documented
+@interface Foo {}
+        """
+
+        shouldNotCompile """
+@java.lang.annotation.Documented
+class Foo {
+    def bar
+}
+        """
 
+        shouldNotCompile """
+class Foo {
+    @java.lang.annotation.Documented
+    def bar
+}
+        """
+
+        shouldCompile """
+import org.junit.*
+
+class Foo {
+    @Test
+    void foo() {}
+}
+        """
+
+        shouldNotCompile """
+import org.junit.*
+
+@Test
+class Foo {
+    void foo() {}
+}
+        """
+    }
 }
