diff --git a/src/main/org/codehaus/groovy/control/LabelVerifier.java b/src/main/org/codehaus/groovy/control/LabelVerifier.java
index 98f56b9c5b..da2d554e3c 100644
--- a/src/main/org/codehaus/groovy/control/LabelVerifier.java
+++ b/src/main/org/codehaus/groovy/control/LabelVerifier.java
@@ -161,8 +161,10 @@ public class LabelVerifier extends ClassCodeVisitorSupport {
     }
     
     public void visitSwitch(SwitchStatement statement) {
-        inSwitch=true;
+        boolean oldInSwitch = inSwitch;
+        inSwitch = true;
         super.visitSwitch(statement);
+        inSwitch = oldInSwitch;
     }
 
 }
diff --git a/src/test/groovy/bugs/Groovy3304Bug.groovy b/src/test/groovy/bugs/Groovy3304Bug.groovy
new file mode 100644
index 0000000000..ab68c743e7
--- /dev/null
+++ b/src/test/groovy/bugs/Groovy3304Bug.groovy
@@ -0,0 +1,16 @@
+package groovy.bugs
+
+import org.codehaus.groovy.control.MultipleCompilationErrorsException
+
+class Groovy3304Bug extends GroovyTestCase {
+    void testBreakAfterSwitchCausesSyntaxError() {
+        try {
+            new GroovyShell().parse("switch(x) {}\nbreak")
+            fail()
+        } catch (MultipleCompilationErrorsException e) {
+            def syntaxError = e.errorCollector.getSyntaxError(0)
+            assert syntaxError
+            assert syntaxError.line == 2
+        }
+    }
+}
