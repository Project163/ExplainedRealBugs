diff --git a/maven.xml b/maven.xml
index 0c8a36eb99..6f21ce9550 100644
--- a/maven.xml
+++ b/maven.xml
@@ -221,12 +221,17 @@
         <include name="**/*.groovy"/>
         <exclude name="**/notworking/*.groovy"/>
         <exclude name="**/parser/*.groovy"/>
+        <!--
+        <exclude name="**/script/AtomTestScript.groovy"/>
+        -->
         <exclude name="CVS/*"/>
       </fileset>
     </copy>
+    <!--
     <touch>
     <fileset dir="${basedir}/target/test-classes" includes="**/*.groovy"/>
     </touch>
+    -->
     <groovyc destdir="${basedir}/target/test-classes" srcdir="${basedir}/target/test-classes" listfiles="true">
       <classpath refid="test.classpath"/>
     </groovyc>
diff --git a/src/main/org/codehaus/groovy/ast/ClassNode.java b/src/main/org/codehaus/groovy/ast/ClassNode.java
index 6458adfa11..961afa3845 100644
--- a/src/main/org/codehaus/groovy/ast/ClassNode.java
+++ b/src/main/org/codehaus/groovy/ast/ClassNode.java
@@ -61,6 +61,8 @@ import org.objectweb.asm.Constants;
  */
 public class ClassNode extends MetadataNode implements Constants {
 
+    private static final String[] defaultImports = { "java.lang", "java.util", "groovy.lang", "groovy.util" };
+
     private Logger log = Logger.getLogger(getClass().getName());
 
     private String name;
@@ -566,6 +568,15 @@ public class ClassNode extends MetadataNode implements Constants {
                     }
                 }
             }
+            if (answer == null) {
+                for (int i = 0, size = defaultImports.length; i < size; i++ ) {
+                    String packagePrefix = defaultImports[i];
+                    answer = tryResolveClassFromCompileUnit(packagePrefix + "." + type);
+                    if (answer != null) {
+                        return answer;
+                    }
+                }
+            }
         }
         return answer;
     }
diff --git a/src/main/org/codehaus/groovy/ast/CompileUnit.java b/src/main/org/codehaus/groovy/ast/CompileUnit.java
index 26454b14f4..39beb0ac0a 100644
--- a/src/main/org/codehaus/groovy/ast/CompileUnit.java
+++ b/src/main/org/codehaus/groovy/ast/CompileUnit.java
@@ -46,7 +46,7 @@ import java.util.Map;
  * Represents the entire contents of a compilation step which consists of one
  * or more {@link ModuleNode}instances
  * 
- * @author <a href="mailto:james@coredevelopers.net">James Strachan</a>
+ * @author <a href="mailto:james@coredevelopers.net">James Strachan </a>
  * @version $Revision$
  */
 public class CompileUnit {
@@ -59,7 +59,7 @@ public class CompileUnit {
     public CompileUnit(ClassLoader classLoader, CompilerConfig config) {
         this.classLoader = classLoader;
         this.config = config;
-       }
+    }
 
     public List getModules() {
         return modules;
@@ -68,22 +68,20 @@ public class CompileUnit {
     public void addModule(ModuleNode node) {
         modules.add(node);
         node.setUnit(this);
-        node.addClasses(classes);
+        addClasses(node.classes);
     }
 
     /**
-     * @return the ClassNode for the given qualified name
-     * or returns null if the name does not exist in the
-     * current compilation unit (ignoring the .class files 
-     * on the classpath)
+     * @return the ClassNode for the given qualified name or returns null if
+     *         the name does not exist in the current compilation unit
+     *         (ignoring the .class files on the classpath)
      */
     public ClassNode getClass(String name) {
         return (ClassNode) classes.get(name);
     }
 
     /**
-     * @return a list of all the classes in each module in the compilation
-     * unit
+     * @return a list of all the classes in each module in the compilation unit
      */
     public List getClasses() {
         List answer = new ArrayList();
@@ -106,14 +104,23 @@ public class CompileUnit {
      * Loads a class on the compile classpath so that it can be introspected
      * 
      * @param type
-     * @return
-     * @throws ClassNotFoundException
+     * @return @throws
+     *         ClassNotFoundException
      */
     public Class loadClass(String type) throws ClassNotFoundException {
         try {
             return getClassLoader().loadClass(type);
         }
         catch (ClassNotFoundException e) {
+
+            // lets try the context class loader
+            try {
+                return Thread.currentThread().getContextClassLoader().loadClass(type);
+            }
+            catch (ClassNotFoundException e1) {
+                // fall through
+            }
+
             // lets try our class loader
             try {
                 return getClass().getClassLoader().loadClass(type);
@@ -133,4 +140,24 @@ public class CompileUnit {
         }
     }
 
+
+    /**
+     * Appends all of the fully qualified class names in this
+     * module into the given map
+     */
+    void addClasses(List classList) {
+        for (Iterator iter = classList.iterator(); iter.hasNext();) {
+            addClass((ClassNode) iter.next());
+        }
+    }
+    
+    void addClass(ClassNode node) {
+        String name = node.getName();
+        if (classes.containsKey(name)) {
+            throw new RuntimeException(
+                "Error: duplicate class declaration for name: " + name + " and class: " + node);
+        }
+        classes.put(name, node);
+    }
+
 }
diff --git a/src/main/org/codehaus/groovy/ast/FieldNode.java b/src/main/org/codehaus/groovy/ast/FieldNode.java
index 9275acc06f..05641726f8 100644
--- a/src/main/org/codehaus/groovy/ast/FieldNode.java
+++ b/src/main/org/codehaus/groovy/ast/FieldNode.java
@@ -100,6 +100,10 @@ public class FieldNode extends MetadataNode implements Constants {
         return type;
     }
 
+    public void setType(String type) {
+        this.type = type;
+    }
+    
     public String getOwner() {
         return owner;
     }
diff --git a/src/main/org/codehaus/groovy/ast/MethodNode.java b/src/main/org/codehaus/groovy/ast/MethodNode.java
index fe42b898e7..e6ba04ec7d 100644
--- a/src/main/org/codehaus/groovy/ast/MethodNode.java
+++ b/src/main/org/codehaus/groovy/ast/MethodNode.java
@@ -133,4 +133,7 @@ public class MethodNode extends MetadataNode implements Constants {
         return super.toString() + "[name: " + name + "]";
     }
 
+    public void setReturnType(String returnType) {
+        this.returnType = returnType;
+    }
 }
diff --git a/src/main/org/codehaus/groovy/ast/ModuleNode.java b/src/main/org/codehaus/groovy/ast/ModuleNode.java
index a31e5dff40..bfb0a3a5d0 100644
--- a/src/main/org/codehaus/groovy/ast/ModuleNode.java
+++ b/src/main/org/codehaus/groovy/ast/ModuleNode.java
@@ -77,7 +77,7 @@ import org.objectweb.asm.Constants;
 public class ModuleNode extends ASTNode implements Constants {
 
     private BlockStatement statementBlock = new BlockStatement();
-    private List classes = new ArrayList();
+    List classes = new ArrayList();
     private List methods = new ArrayList();
     private List imports = new ArrayList();
     private List importPackages = new ArrayList();
@@ -105,9 +105,10 @@ public class ModuleNode extends ASTNode implements Constants {
     public List getClasses() {
         if (createClassForStatements && (!statementBlock.isEmpty() || !methods.isEmpty())) {
             ClassNode mainClass = createStatementsClass();
+            createClassForStatements = false;
             classes.add(0, mainClass);
             mainClass.setModule(this);
-            createClassForStatements = false;
+            addToCompileUnit(mainClass);
         }
         return classes;
     }
@@ -144,6 +145,17 @@ public class ModuleNode extends ASTNode implements Constants {
     public void addClass(ClassNode node) {
         classes.add(node);
         node.setModule(this);
+        addToCompileUnit(node);
+    }
+
+    /**
+     * @param node
+     */
+    private void addToCompileUnit(ClassNode node) {
+        // register the new class with the compile unit
+        if (unit != null) {
+            unit.addClass(node);
+        }
     }
 
     public void addMethod(MethodNode node) {
@@ -172,22 +184,6 @@ public class ModuleNode extends ASTNode implements Constants {
         this.description = description;
     }
 
-    /**
-     * Appends all of the fully qualified class names in this
-     * module into the given map
-     */
-    public void addClasses(Map classMap) {
-        for (Iterator iter = classes.iterator(); iter.hasNext();) {
-            ClassNode node = (ClassNode) iter.next();
-            String name = node.getName();
-            if (classMap.containsKey(name)) {
-                throw new RuntimeException(
-                    "Error: duplicate class declaration for name: " + name + " and class: " + node);
-            }
-            classMap.put(name, node);
-        }
-    }
-
     public CompileUnit getUnit() {
         return unit;
     }
diff --git a/src/main/org/codehaus/groovy/ast/Parameter.java b/src/main/org/codehaus/groovy/ast/Parameter.java
index 72828a4490..c5372cfd6f 100644
--- a/src/main/org/codehaus/groovy/ast/Parameter.java
+++ b/src/main/org/codehaus/groovy/ast/Parameter.java
@@ -68,7 +68,7 @@ public class Parameter {
     private String realType;
 
     public Parameter(String name) {
-        this("java.lang.Object", name);
+        this(null, name);
     }
 
     public Parameter(String type, String name) {
diff --git a/src/main/org/codehaus/groovy/classgen/ClassGenerator.java b/src/main/org/codehaus/groovy/classgen/ClassGenerator.java
index f755639182..36db1a3267 100644
--- a/src/main/org/codehaus/groovy/classgen/ClassGenerator.java
+++ b/src/main/org/codehaus/groovy/classgen/ClassGenerator.java
@@ -249,6 +249,8 @@ public class ClassGenerator extends CodeVisitorSupport implements GroovyClassVis
             this.outermostClass = null;
             this.internalClassName = BytecodeHelper.getClassInternalName(classNode.getName());
             
+            //System.out.println("Generating class: " + classNode.getName());
+            
             // lets check that the classes are all valid
             classNode.setSuperClass(checkValidType(classNode.getSuperClass(), classNode, "Must be a valid base class"));
             String[] interfaces = classNode.getInterfaces();
@@ -296,6 +298,8 @@ public class ClassGenerator extends CodeVisitorSupport implements GroovyClassVis
         this.methodNode = null;
         this.variableScope = null;
         
+        visitParameters(node, node.getParameters());
+        
         String methodType = BytecodeHelper.getMethodDescriptor("void", node.getParameters());
         cv = cw.visitMethod(node.getModifiers(), "<init>", methodType, null, null);
         helper = new BytecodeHelper(cv);
@@ -324,6 +328,9 @@ public class ClassGenerator extends CodeVisitorSupport implements GroovyClassVis
         this.methodNode = node;
         this.variableScope = null;
 
+        visitParameters(node, node.getParameters());
+        node.setReturnType(checkValidType(node.getReturnType(), node, "Must be a valid return type"));
+        
         String methodType = BytecodeHelper.getMethodDescriptor(node.getReturnType(), node.getParameters());
         cv = cw.visitMethod(node.getModifiers(), node.getName(), methodType, null, null);
         helper = new BytecodeHelper(cv);
@@ -349,9 +356,24 @@ public class ClassGenerator extends CodeVisitorSupport implements GroovyClassVis
         cv.visitMaxs(0, 0);
     }
 
+    protected void visitParameters(ASTNode node, Parameter[] parameters) {
+        for (int i = 0, size = parameters.length; i < size; i++ ) {
+            visitParameter(node, parameters[i]);
+        }
+    }
+
+    protected void visitParameter(ASTNode node, Parameter parameter) {
+        if (! parameter.isDynamicType()) {
+            parameter.setType(checkValidType(parameter.getType(), node, "Must be a valid parameter class"));
+        }
+    }
+
     public void visitField(FieldNode fieldNode) {
         onLineNumber(fieldNode);
 
+        // lets check that the classes are all valid
+        fieldNode.setType(checkValidType(fieldNode.getType(), fieldNode, "Must be a valid field class for field: " + fieldNode.getName()));
+
         //System.out.println("Visiting field: " + fieldNode.getName() + " on
         // class: " + classNode.getName());
 
@@ -2985,7 +3007,18 @@ public class ClassGenerator extends CodeVisitorSupport implements GroovyClassVis
     }
 
     protected String checkValidType(String type, ASTNode node, String message) {
-        if (helper.isPrimitiveType(type)) {
+        if (type.endsWith("[]")) {
+            String postfix = "[]";
+            String prefix = type.substring(0, type.length() - 2);
+            return checkValidType(prefix, node, message) + postfix;
+        }
+        int idx = type.indexOf('$');
+        if (idx > 0) {
+            String postfix = type.substring(idx);
+            String prefix = type.substring(0, idx);
+            return checkValidType(prefix, node, message) + postfix;
+        }
+        if (helper.isPrimitiveType(type) || "void".equals(type)) {
             return type;
         }
         String original = type;
@@ -2993,7 +3026,7 @@ public class ClassGenerator extends CodeVisitorSupport implements GroovyClassVis
         if (type != null) {
             return type;
         }
-        throw new MissingClassException(original, node, message);
+        throw new MissingClassException(original, node, message + " for class: " + classNode.getName());
     }
 
     protected String resolveClassName(String type) {
diff --git a/src/main/org/codehaus/groovy/syntax/parser/ASTBuilder.java b/src/main/org/codehaus/groovy/syntax/parser/ASTBuilder.java
index e6a3157283..f01b44bad0 100644
--- a/src/main/org/codehaus/groovy/syntax/parser/ASTBuilder.java
+++ b/src/main/org/codehaus/groovy/syntax/parser/ASTBuilder.java
@@ -316,7 +316,12 @@ public class ASTBuilder {
      * move it into the verifier / analyser
      */
     protected String resolvedQualifiedName(CSTNode nameRoot) {
-        return resolveName(qualifiedName(nameRoot));
+        String name = qualifiedName(nameRoot);
+        String answer = resolveName(name);
+        if (answer == null) {
+            answer = name;
+        }
+        return answer;
     }
 
     /**
diff --git a/src/test/groovy/bugs/Groovy303_Bug.groovy b/src/test/groovy/bugs/Groovy303_Bug.groovy
index 434c38cbc7..2efa48ca99 100644
--- a/src/test/groovy/bugs/Groovy303_Bug.groovy
+++ b/src/test/groovy/bugs/Groovy303_Bug.groovy
@@ -37,7 +37,8 @@ class Scholastic implements ActionListener {
        pane.add(button, BorderLayout.CENTER)
        contents.add(pane)
        frame.setSize(100, 100)
-       frame.setVisible(true)
+       //frame.setVisible(true)
+       button.doClick()
     }
 
     public void actionPerformed(ActionEvent event) {
diff --git a/src/test/groovy/bugs/TedsClosureBug.groovy b/src/test/groovy/bugs/TedsClosureBug.groovy
index a7811655b0..c197bd4639 100644
--- a/src/test/groovy/bugs/TedsClosureBug.groovy
+++ b/src/test/groovy/bugs/TedsClosureBug.groovy
@@ -1,6 +1,5 @@
 import groovy.xml.MarkupBuilder
 
-
 /**
  * @author Ted Leung
  * @version $Revision$
diff --git a/src/test/groovy/sql/PersonTest.groovy b/src/test/groovy/sql/PersonTest.groovy
index 42673c3530..6fc2243791 100644
--- a/src/test/groovy/sql/PersonTest.groovy
+++ b/src/test/groovy/sql/PersonTest.groovy
@@ -1,5 +1,7 @@
 package groovy.sql
 
+import javax.sql.DataSource
+
 import org.axiondb.jdbc.AxionDataSource
 
 class PersonTest extends GroovyTestCase {
diff --git a/src/test/org/codehaus/groovy/classgen/RunBugsTest.java b/src/test/org/codehaus/groovy/classgen/RunBugsTest.java
index 07b338dadc..0c9fd28a1b 100644
--- a/src/test/org/codehaus/groovy/classgen/RunBugsTest.java
+++ b/src/test/org/codehaus/groovy/classgen/RunBugsTest.java
@@ -142,8 +142,8 @@ public class RunBugsTest extends TestSupport {
     
     */
         
-    public void testGroovy278_Bug() throws Exception {
-        GroovyObject object = compile("src/test/groovy/bugs/Groovy278_Bug.groovy");
+    public void testGroovy303_Bug() throws Exception {
+        GroovyObject object = compile("src/test/groovy/bugs/Groovy303_Bug.groovy");
         object.invokeMethod("testBug", null);
     }
     
