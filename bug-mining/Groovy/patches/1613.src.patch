diff --git a/src/main/org/codehaus/groovy/ant/FileSystemCompilerFacade.java b/src/main/org/codehaus/groovy/ant/FileSystemCompilerFacade.java
new file mode 100644
index 0000000000..be426fb052
--- /dev/null
+++ b/src/main/org/codehaus/groovy/ant/FileSystemCompilerFacade.java
@@ -0,0 +1,29 @@
+/*
+ * Copyright 2003-2010 the original author or authors.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.codehaus.groovy.ant;
+
+import org.codehaus.groovy.tools.FileSystemCompiler;
+
+/**
+ * This is a helper class, to provide a controlled entry point for the groovyc
+ * ant task forked mode.
+ * @author <a href="mailto:blackdrag@gmx.org">Jochen "blackdrag" Theodorou</a>
+ */
+public class FileSystemCompilerFacade {
+    public static void main(String[] args) {
+        FileSystemCompiler.commandLineCompileWithErrorHandling(args,false);
+    }
+}
diff --git a/src/main/org/codehaus/groovy/ant/Groovyc.java b/src/main/org/codehaus/groovy/ant/Groovyc.java
index cc33850838..f8eecabf6f 100644
--- a/src/main/org/codehaus/groovy/ant/Groovyc.java
+++ b/src/main/org/codehaus/groovy/ant/Groovyc.java
@@ -796,7 +796,7 @@ public class Groovyc extends MatchingTask {
                         if (tmpExtension.startsWith("*.")) tmpExtension = tmpExtension.substring(1);
                         commandLineList.add("-Dgroovy.default.scriptExtension=" + tmpExtension);
                     }
-                    commandLineList.add("org.codehaus.groovy.tools.FileSystemCompiler");
+                    commandLineList.add(FileSystemCompilerFacade.class.getName());
                 }
                 commandLineList.add("--classpath");
                 commandLineList.add(classpath.toString());
@@ -900,7 +900,7 @@ public class Groovyc extends MatchingTask {
                         }
 
                         if (!fileNameErrors) {
-                            FileSystemCompiler.doCompilation(configuration, makeCompileUnit(), filenames);
+                            FileSystemCompiler.doCompilation(configuration, makeCompileUnit(), filenames, false);
                         }
 
                     } catch (Exception re) {
diff --git a/src/main/org/codehaus/groovy/tools/FileSystemCompiler.java b/src/main/org/codehaus/groovy/tools/FileSystemCompiler.java
index edb21ea393..e5ef3e231d 100644
--- a/src/main/org/codehaus/groovy/tools/FileSystemCompiler.java
+++ b/src/main/org/codehaus/groovy/tools/FileSystemCompiler.java
@@ -53,13 +53,6 @@ public class FileSystemCompiler {
         } else {
             unit = new CompilationUnit(configuration);
         }
-
-        // in command line we don't need to do script lookups
-        unit.getClassLoader().setResourceLoader(new GroovyResourceLoader() {
-            public URL loadGroovySource(String filename) throws MalformedURLException {
-                return null;
-            }
-        });
     }
 
     public void compile(String[] paths) throws Exception {
@@ -80,7 +73,7 @@ public class FileSystemCompiler {
     public static void displayVersion() {
         String version = GroovySystem.getVersion();
         System.err.println("Groovy compiler version " + version);
-        System.err.println("Copyright 2003-2010 The Codehaus. http://groovy.codehaus.org/");
+        System.err.println("Copyright 2003-2011 The Codehaus. http://groovy.codehaus.org/");
         System.err.println("");
     }
 
@@ -112,6 +105,14 @@ public class FileSystemCompiler {
      * the VM to exit.
      */
     public static void commandLineCompile(String[] args) throws Exception {
+        commandLineCompile(args, true);
+    }
+    
+    /**
+     * Same as main(args) except that exceptions are thrown out instead of causing
+     * the VM to exit and the lookup for .groovy files can be controlled
+     */
+    public static void commandLineCompile(String[] args, boolean lookupUnnamedFiles) throws Exception {
         Options options = createCompilationOptions();
 
         PosixParser cliParser = new PosixParser();
@@ -145,7 +146,7 @@ public class FileSystemCompiler {
         fileNameErrors = fileNameErrors && !validateFiles(filenames);
 
         if (!fileNameErrors) {
-            doCompilation(configuration, null, filenames);
+            doCompilation(configuration, null, filenames, lookupUnnamedFiles);
         }
     }
 
@@ -154,12 +155,28 @@ public class FileSystemCompiler {
      * (using the groovyc script).
      *
      * If calling inside a process and you don't want the JVM to exit on an
-     * error call commandLineCompile(String[]), which this method simply wraps 
+     * error call commandLineCompile(String[]), which this method simply wraps
+     * 
+     * @param args command line arguments
      */
     public static void main(String[] args) {
-
+        commandLineCompileWithErrorHandling(args,true);
+    }
+    
+    /**
+     * Primary entry point for compiling from the command line
+     * (using the groovyc script).
+     *
+     * If calling inside a process and you don't want the JVM to exit on an
+     * error call commandLineCompile(String[]), which this method simply wraps
+     * 
+     * @param   args command line arguments
+     * @param   lookupUnnamedFiles do a lookup for .groovy files not part of 
+     *          the given list of files to compile
+     */
+    public static void commandLineCompileWithErrorHandling(String[] args, boolean lookupUnnamedFiles) {
         try {
-            commandLineCompile(args);
+            commandLineCompile(args, lookupUnnamedFiles);
         } catch( Throwable e ) {
             new ErrorReporter( e, displayStackTraceOnError).write( System.err );
             System.exit(1);
@@ -167,6 +184,10 @@ public class FileSystemCompiler {
     }
 
     public static void doCompilation(CompilerConfiguration configuration, CompilationUnit unit, String[] filenames) throws Exception {
+        doCompilation(configuration, unit, filenames, true);
+    }
+    
+    public static void doCompilation(CompilerConfiguration configuration, CompilationUnit unit, String[] filenames, boolean lookupUnnamedFiles) throws Exception {
         File tmpDir = null;
         // if there are any joint compilation options set stubDir if not set
         try {
@@ -177,6 +198,21 @@ public class FileSystemCompiler {
                 configuration.getJointCompilationOptions().put("stubDir", tmpDir);
             }
             FileSystemCompiler compiler = new FileSystemCompiler(configuration, unit);
+            if (lookupUnnamedFiles) {
+                for (String filename : filenames) {
+                    File file = new File(filename);
+                    if (file.isFile()) {
+                        URL url = file.getAbsoluteFile().getParentFile().toURI().toURL();
+                        compiler.unit.getClassLoader().addURL(url);
+                    }
+                }
+            } else {
+                compiler.unit.getClassLoader().setResourceLoader(new GroovyResourceLoader() {
+                    public URL loadGroovySource(String filename) throws MalformedURLException {
+                        return null;
+                    }
+                });
+            }  
             compiler.compile(filenames);
         } finally {
             try {
