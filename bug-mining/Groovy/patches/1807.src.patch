diff --git a/src/main/org/codehaus/groovy/classgen/asm/sc/StaticTypesStatementWriter.java b/src/main/org/codehaus/groovy/classgen/asm/sc/StaticTypesStatementWriter.java
index 7cc5e8b259..dea503fcb6 100644
--- a/src/main/org/codehaus/groovy/classgen/asm/sc/StaticTypesStatementWriter.java
+++ b/src/main/org/codehaus/groovy/classgen/asm/sc/StaticTypesStatementWriter.java
@@ -72,6 +72,7 @@ public class StaticTypesStatementWriter extends StatementWriter {
         if (collectionType.implementsInterface(ITERABLE_CLASSNODE)) {
             MethodCallExpression iterator = new MethodCallExpression(collectionExpression, "iterator", new ArgumentListExpression());
             iterator.setMethodTarget(collectionType.getMethod("iterator", Parameter.EMPTY_ARRAY));
+            iterator.setImplicitThis(false);
             iterator.visit(controller.getAcg());
         } else {
             collectionExpression.visit(controller.getAcg());
diff --git a/src/main/org/codehaus/groovy/transform/sc/StaticCompilationVisitor.java b/src/main/org/codehaus/groovy/transform/sc/StaticCompilationVisitor.java
index e6885880f2..1c2f5a2918 100644
--- a/src/main/org/codehaus/groovy/transform/sc/StaticCompilationVisitor.java
+++ b/src/main/org/codehaus/groovy/transform/sc/StaticCompilationVisitor.java
@@ -91,8 +91,8 @@ public class StaticCompilationVisitor extends StaticTypeCheckingVisitor {
         }
         while (innerClasses.hasNext()) {
             InnerClassNode innerClassNode = innerClasses.next();
-            innerClassNode.setNodeMetaData(STATIC_COMPILE_NODE, !skip);
-            innerClassNode.setNodeMetaData(WriterControllerFactory.class, node.getNodeMetaData(WriterControllerFactory.class));
+            innerClassNode.putNodeMetaData(STATIC_COMPILE_NODE, !skip);
+            innerClassNode.putNodeMetaData(WriterControllerFactory.class, node.getNodeMetaData(WriterControllerFactory.class));
             addPrivateBridgeMethods(innerClassNode);
             addPrivateFieldsAccessors(innerClassNode);
         }
diff --git a/src/test/org/codehaus/groovy/classgen/asm/sc/BugsStaticCompileTest.groovy b/src/test/org/codehaus/groovy/classgen/asm/sc/BugsStaticCompileTest.groovy
index 90dcd1ffad..c9390604fa 100644
--- a/src/test/org/codehaus/groovy/classgen/asm/sc/BugsStaticCompileTest.groovy
+++ b/src/test/org/codehaus/groovy/classgen/asm/sc/BugsStaticCompileTest.groovy
@@ -51,5 +51,23 @@ class BugsStaticCompileTest extends BugsSTCTest {
             new Test().someMethod()
         '''
     }
+
+    // GROOVY-5512
+    void testCreateRangeInInnerClass() {
+        def shell = new GroovyShell()
+        shell.evaluate '''
+            class Outer {
+                static class Inner {
+                    @groovy.transform.CompileStatic
+                    int m() {
+                        int x = 0
+                        for (int i in 1..10) {x++}
+                        x
+                    }
+                }
+            }
+            assert new Outer.Inner().m() == 10
+        '''
+    }
 }
 
