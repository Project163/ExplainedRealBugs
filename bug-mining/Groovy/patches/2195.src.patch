diff --git a/src/main/org/codehaus/groovy/classgen/asm/BinaryExpressionHelper.java b/src/main/org/codehaus/groovy/classgen/asm/BinaryExpressionHelper.java
index c7501ad58f..c6fad11ca3 100644
--- a/src/main/org/codehaus/groovy/classgen/asm/BinaryExpressionHelper.java
+++ b/src/main/org/codehaus/groovy/classgen/asm/BinaryExpressionHelper.java
@@ -399,10 +399,12 @@ public class BinaryExpressionHelper {
 
     protected void evaluateCompareExpression(MethodCaller compareMethod, BinaryExpression expression) {
         Expression leftExp = expression.getLeftExpression();
-        ClassNode leftType = leftExp.getType();
+        TypeChooser typeChooser = controller.getTypeChooser();
+        ClassNode cn = controller.getClassNode();
+        ClassNode leftType = typeChooser.resolveType(leftExp,cn);
         Expression rightExp = expression.getRightExpression();
-        ClassNode rightType = rightExp.getType();
-        
+        ClassNode rightType = typeChooser.resolveType(rightExp,cn);
+
         boolean done = false;
         if (    ClassHelper.isPrimitiveType(leftType) &&
                 ClassHelper.isPrimitiveType(rightType)) 
diff --git a/src/main/org/codehaus/groovy/transform/sc/transformers/BooleanExpressionTransformer.java b/src/main/org/codehaus/groovy/transform/sc/transformers/BooleanExpressionTransformer.java
index b1a87d40b5..b78f2601ce 100644
--- a/src/main/org/codehaus/groovy/transform/sc/transformers/BooleanExpressionTransformer.java
+++ b/src/main/org/codehaus/groovy/transform/sc/transformers/BooleanExpressionTransformer.java
@@ -21,6 +21,7 @@ import org.codehaus.groovy.classgen.AsmClassGenerator;
 import org.codehaus.groovy.classgen.asm.WriterController;
 import org.codehaus.groovy.classgen.asm.sc.StaticTypesTypeChooser;
 import org.codehaus.groovy.transform.stc.ExtensionMethodNode;
+import org.objectweb.asm.Label;
 import org.objectweb.asm.MethodVisitor;
 
 import java.lang.reflect.Modifier;
@@ -97,9 +98,19 @@ public class BooleanExpressionTransformer {
                 }
                 if (type.equals(ClassHelper.Boolean_TYPE)) {
                     expression.visit(visitor);
-                    // unbox
                     MethodVisitor mv = controller.getMethodVisitor();
+                    Label unbox = new Label();
+                    Label exit = new Label();
+                    // check for null
+                    mv.visitInsn(DUP);
+                    mv.visitJumpInsn(IFNONNULL, unbox);
+                    mv.visitInsn(POP);
+                    mv.visitInsn(ICONST_0);
+                    mv.visitJumpInsn(GOTO, exit);
+                    mv.visitLabel(unbox);
+                    // unbox
                     mv.visitMethodInsn(INVOKEVIRTUAL, "java/lang/Boolean", "booleanValue", "()Z");
+                    mv.visitLabel(exit);
                     controller.getOperandStack().replace(ClassHelper.boolean_TYPE);
                     return;
                 }
diff --git a/src/main/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java b/src/main/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java
index 7534e2faf2..61fe75300e 100644
--- a/src/main/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java
+++ b/src/main/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java
@@ -2428,6 +2428,8 @@ public class StaticTypeCheckingVisitor extends ClassCodeVisitorSupport {
     protected void storeType(Expression exp, ClassNode cn) {
         if (exp instanceof VariableExpression && ((VariableExpression) exp).isClosureSharedVariable() && isPrimitiveType(cn)) {
             cn = getWrapper(cn);
+        } else if (exp instanceof MethodCallExpression && ((MethodCallExpression) exp).isSafe() && isPrimitiveType(cn)) {
+            cn = getWrapper(cn);
         }
         if (cn == UNKNOWN_PARAMETER_TYPE) {
             // this can happen for example when "null" is used in an assignment or a method parameter.
diff --git a/src/test/org/codehaus/groovy/classgen/asm/MethodPatternsTest.groovy b/src/test/org/codehaus/groovy/classgen/asm/MethodPatternsTest.groovy
index a80feaaa06..6bb753c106 100644
--- a/src/test/org/codehaus/groovy/classgen/asm/MethodPatternsTest.groovy
+++ b/src/test/org/codehaus/groovy/classgen/asm/MethodPatternsTest.groovy
@@ -197,7 +197,7 @@ class MethodPatternsTest extends AbstractBytecodeTestCase {
             'ICONST_1',
             'IADD',
             'ISTORE',
-            'GOTO L14'
+            'GOTO'
         ])
     }
 
diff --git a/src/test/org/codehaus/groovy/classgen/asm/sc/BugsStaticCompileTest.groovy b/src/test/org/codehaus/groovy/classgen/asm/sc/BugsStaticCompileTest.groovy
index 200f150b77..0fcf66df5e 100644
--- a/src/test/org/codehaus/groovy/classgen/asm/sc/BugsStaticCompileTest.groovy
+++ b/src/test/org/codehaus/groovy/classgen/asm/sc/BugsStaticCompileTest.groovy
@@ -803,5 +803,16 @@ import groovy.transform.TypeCheckingMode
             assert foo.hasSideEffect
          '''
     }
+
+    void testShouldNotThrowNPEBecauseLHSIsNull() {
+        assertScript '''
+            class A {
+                int foo() { 123 }
+            }
+            A a = null
+            def bar = a?.foo() == 123 // will evaluate to false
+            assert bar == false
+        '''
+    }
 }
 
diff --git a/src/test/org/codehaus/groovy/classgen/asm/sc/StaticCompileNullCompareOptimizationTest.groovy b/src/test/org/codehaus/groovy/classgen/asm/sc/StaticCompileNullCompareOptimizationTest.groovy
index f12bcb3e84..9ec1041feb 100644
--- a/src/test/org/codehaus/groovy/classgen/asm/sc/StaticCompileNullCompareOptimizationTest.groovy
+++ b/src/test/org/codehaus/groovy/classgen/asm/sc/StaticCompileNullCompareOptimizationTest.groovy
@@ -104,7 +104,7 @@ class StaticCompileNullCompareOptimizationTest extends AbstractBytecodeTestCase
                 }
             }
         ''')
-        assert bytecode.hasStrictSequence(['ALOAD 1', 'INVOKEVIRTUAL', 'IFEQ'])
+        assert bytecode.hasStrictSequence(['ALOAD 1', 'DUP', 'IFNONNULL', 'POP', 'ICONST_0', 'GOTO', 'L1', 'INVOKEVIRTUAL', 'L2', 'IFEQ'])
     }
 
     void testOptimizeGroovyTruthWithStringShouldNotBeTriggered() {
