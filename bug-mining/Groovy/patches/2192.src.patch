diff --git a/src/main/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java b/src/main/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java
index 368dc2d72c..2e5aa884c5 100644
--- a/src/main/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java
+++ b/src/main/org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.java
@@ -503,7 +503,7 @@ public class StaticTypeCheckingVisitor extends ClassCodeVisitorSupport {
                         if (types == null) {
                             types = new LinkedList<ClassNode>();
                             ClassNode type = (ClassNode) var.getNodeMetaData(StaticTypesMarker.INFERRED_TYPE);
-                            if (type != null) types.add(type);
+                            types.add(type);
                             typeCheckingContext.ifElseForWhileAssignmentTracker.put(var, types);
                         }
                         types.add(resultType);
@@ -2283,6 +2283,15 @@ public class StaticTypeCheckingVisitor extends ClassCodeVisitorSupport {
             // pop if-then-else temporary type info
             typeCheckingContext.popTemporaryTypeInfo();
 
+            // GROOVY-6099: restore assignement info as before the if branch
+            Set<Map.Entry<VariableExpression, List<ClassNode>>> entries = typeCheckingContext.ifElseForWhileAssignmentTracker.entrySet();
+            for (Map.Entry<VariableExpression, List<ClassNode>> entry : entries) {
+                VariableExpression var = entry.getKey();
+                List<ClassNode> items = entry.getValue();
+                ClassNode originValue = items.get(0);
+                storeType(var, originValue);
+            }
+
             Statement elseBlock = ifElse.getElseBlock();
             if (elseBlock instanceof EmptyStatement) {
                 // dispatching to EmptyStatement will not call back visitor,
@@ -2301,7 +2310,13 @@ public class StaticTypeCheckingVisitor extends ClassCodeVisitorSupport {
         if (!typeCheckingContext.ifElseForWhileAssignmentTracker.isEmpty()) {
             for (Map.Entry<VariableExpression, List<ClassNode>> entry : typeCheckingContext.ifElseForWhileAssignmentTracker.entrySet()) {
                 VariableExpression key = entry.getKey();
-                ClassNode cn = lowestUpperBound(entry.getValue());
+                List<ClassNode> allValues = entry.getValue();
+                // GROOVY-6099: First element of the list may be null, if no assignment was made before the branch
+                List<ClassNode> nonNullValues = new ArrayList<ClassNode>(allValues.size());
+                for (ClassNode value : allValues) {
+                    if (value!=null) nonNullValues.add(value);
+                }
+                ClassNode cn = lowestUpperBound(nonNullValues);
                 storeType(key, cn);
                 assignments.put(key, cn);
             }
diff --git a/src/test/groovy/transform/stc/BugsSTCTest.groovy b/src/test/groovy/transform/stc/BugsSTCTest.groovy
index e38ed4135a..2b1f84e7c4 100644
--- a/src/test/groovy/transform/stc/BugsSTCTest.groovy
+++ b/src/test/groovy/transform/stc/BugsSTCTest.groovy
@@ -382,4 +382,37 @@ class BugsSTCTest extends StaticTypeCheckingTestCase {
             foo(null)
         '''
     }
+
+    // GROOVY-6099
+    void testFlowTypingErrorWithIfElse() {
+        assertScript '''
+            def o = new Object()
+            boolean b = true
+            if (b) {
+                o = 1
+            } else {
+                @ASTTest(phase=INSTRUCTION_SELECTION, value={
+                    assert node.getNodeMetaData(INFERRED_TYPE) == OBJECT_TYPE
+                })
+                def o2 = o
+                println (o2.toString())
+            }
+        '''
+    }
+    void testFlowTypingErrorWithIfElseAndNoInitialInferredType() {
+        assertScript '''
+            def o
+            boolean b = true
+            if (b) {
+                o = 1
+            } else {
+                @ASTTest(phase=INSTRUCTION_SELECTION, value={
+                    assert node.getNodeMetaData(INFERRED_TYPE) == OBJECT_TYPE
+                })
+                def o2 = o
+                o2 = 'foo'
+                println (o2.toString())
+            }
+        '''
+    }
 }
