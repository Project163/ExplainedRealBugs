{"url":"https://api.github.com/repos/libgdx/libgdx/issues/3130","repository_url":"https://api.github.com/repos/libgdx/libgdx","labels_url":"https://api.github.com/repos/libgdx/libgdx/issues/3130/labels{/name}","comments_url":"https://api.github.com/repos/libgdx/libgdx/issues/3130/comments","events_url":"https://api.github.com/repos/libgdx/libgdx/issues/3130/events","html_url":"https://github.com/libgdx/libgdx/issues/3130","id":76384628,"node_id":"MDU6SXNzdWU3NjM4NDYyOA==","number":3130,"title":"wrong draw() coords when using TextField with e.g. (0,0)-(1,1) coord system","user":{"login":"FyiurAmron","id":11016998,"node_id":"MDQ6VXNlcjExMDE2OTk4","avatar_url":"https://avatars.githubusercontent.com/u/11016998?v=4","gravatar_id":"","url":"https://api.github.com/users/FyiurAmron","html_url":"https://github.com/FyiurAmron","followers_url":"https://api.github.com/users/FyiurAmron/followers","following_url":"https://api.github.com/users/FyiurAmron/following{/other_user}","gists_url":"https://api.github.com/users/FyiurAmron/gists{/gist_id}","starred_url":"https://api.github.com/users/FyiurAmron/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/FyiurAmron/subscriptions","organizations_url":"https://api.github.com/users/FyiurAmron/orgs","repos_url":"https://api.github.com/users/FyiurAmron/repos","events_url":"https://api.github.com/users/FyiurAmron/events{/privacy}","received_events_url":"https://api.github.com/users/FyiurAmron/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2015-05-14T14:56:00Z","updated_at":"2015-06-25T16:32:14Z","closed_at":"2015-06-25T16:32:14Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Sample repro case is to try using TextField with a Batch that uses (0,0)-(1,1) coord system (or any other (0,0)-(x,y) coord system with small enough x/y values) for positioning elements, instead of regular screen coords. The cursor and/or selection will either not appear at all, or appear in \"strange places\".\n\nAFAIK, it happens due to two things.\n\nFirst, the values get truncated in Y dimension due to `(int)` cast in `getTextY` ( https://github.com/libgdx/libgdx/blob/master/gdx/src/com/badlogic/gdx/scenes/scene2d/ui/TextField.java#L329 & https://github.com/libgdx/libgdx/blob/master/gdx/src/com/badlogic/gdx/scenes/scene2d/ui/TextField.java#L331 ), so everything gets Y mapped to 0. I think this was somehow designed to either limit bleeding due to filtering on non-integer positions or to better match the text if it used integer Y; still, BitmapFont currently has its own devices to deal with that, and I guess we should either query the font if it's needed at all, or allow any other way to disable the truncation.\n\nSecondly, in https://github.com/libgdx/libgdx/blob/master/gdx/src/com/badlogic/gdx/scenes/scene2d/ui/TextField.java#L337 & https://github.com/libgdx/libgdx/blob/master/gdx/src/com/badlogic/gdx/scenes/scene2d/ui/TextField.java#L346 there's a magical -1 added to `fontOffset`, which was probably aiming at showing the cursor a single pixel to the left to look better, but which makes any sense only for screen-sized viewport coordinates, and not with e.g. (0,0)-(1,1); there, moving a visible point by 1 unit in any direction makes the element not visible at all due to being off the visible range.\n\nPossible solutions would be to either remove those casts at all, figure if they are really needed based on something (`font.usesIntegerPositions()` ?) or add an option to disable it/them if they are really necessary in some cases. Removing them worked for me without any visible side effects.\n\nAs to the offsets, selection offset looks quite OK to me even without that 1 pix, and cursor offset should be probably calculated proportionally, based on glyph width, with the option of setting a custom offset factor multiplier or value (e.g. default factor 0.1 giving -0.1 of the glyph width, settable to any direct float or factor). It could also be calculated from `cursorPatch.getMinWidth()`. That's the solution I used:\n\n```\n    protected void drawCursor( Drawable cursorPatch, Batch3D batch, BitmapFontEx font, float x, float y ) {\n        float textHeight = getTextHeight(), cpWidth = cursorPatch.getMinWidth();\n        cursorPatch.draw( batch, x + textOffset + glyphPositions.get( cursor ) - glyphPositions.items[visibleTextStart] - 0.5f * cpWidth,\n                y - textHeight - font.getDescent(), cpWidth, textHeight + 0.5f * font.getDescent() );\n    }\n```\n","closed_by":{"login":"NathanSweet","id":434010,"node_id":"MDQ6VXNlcjQzNDAxMA==","avatar_url":"https://avatars.githubusercontent.com/u/434010?v=4","gravatar_id":"","url":"https://api.github.com/users/NathanSweet","html_url":"https://github.com/NathanSweet","followers_url":"https://api.github.com/users/NathanSweet/followers","following_url":"https://api.github.com/users/NathanSweet/following{/other_user}","gists_url":"https://api.github.com/users/NathanSweet/gists{/gist_id}","starred_url":"https://api.github.com/users/NathanSweet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NathanSweet/subscriptions","organizations_url":"https://api.github.com/users/NathanSweet/orgs","repos_url":"https://api.github.com/users/NathanSweet/repos","events_url":"https://api.github.com/users/NathanSweet/events{/privacy}","received_events_url":"https://api.github.com/users/NathanSweet/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/libgdx/libgdx/issues/3130/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/libgdx/libgdx/issues/3130/timeline","performed_via_github_app":null,"state_reason":"completed"}