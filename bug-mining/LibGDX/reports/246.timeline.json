[{"url":"https://api.github.com/repos/libgdx/libgdx/issues/comments/99253917","html_url":"https://github.com/libgdx/libgdx/issues/3082#issuecomment-99253917","issue_url":"https://api.github.com/repos/libgdx/libgdx/issues/3082","id":99253917,"node_id":"MDEyOklzc3VlQ29tbWVudDk5MjUzOTE3","user":{"login":"RobRendell","id":1848870,"node_id":"MDQ6VXNlcjE4NDg4NzA=","avatar_url":"https://avatars.githubusercontent.com/u/1848870?v=4","gravatar_id":"","url":"https://api.github.com/users/RobRendell","html_url":"https://github.com/RobRendell","followers_url":"https://api.github.com/users/RobRendell/followers","following_url":"https://api.github.com/users/RobRendell/following{/other_user}","gists_url":"https://api.github.com/users/RobRendell/gists{/gist_id}","starred_url":"https://api.github.com/users/RobRendell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RobRendell/subscriptions","organizations_url":"https://api.github.com/users/RobRendell/orgs","repos_url":"https://api.github.com/users/RobRendell/repos","events_url":"https://api.github.com/users/RobRendell/events{/privacy}","received_events_url":"https://api.github.com/users/RobRendell/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-05-05T22:51:30Z","updated_at":"2015-05-05T22:51:30Z","body":"One consequence of this issue is that labels can overflow their boundaries.  This is because `Label.computePrefSize()` wraps the text at the Label's width, but `Label.layout()` wraps the text at the minimum width computed by `computePrefSize`.  The two different routines therefore attempt to break the multiple whitespace characters at different character positions in the run, and because `BitmapFont.getWrapIndex()` does not consume white space characters forward, `Label.layout()` gets a different pattern of line breaks to `Label.computePrefSize()`.  You can see in the screenshot below the whitespace characters that `Label.layout()` left at the start of the third row, which `Label.computePrefSize()` eliminated when it was laying out the text because it worked backwards from somewhere in the word \"multiple\".\n\nScreenshot:\n![image](https://cloud.githubusercontent.com/assets/1848870/7484408/865d696c-f3cb-11e4-8e0e-f723e71b27b8.png)\n\nCode to reproduce the issue:\n\n```\npublic class WhitespaceFontWrapIssue extends ApplicationAdapter {\n\n    private static final float GAME_WIDTH = 200f;\n\n    private Stage stage;\n\n    public static void main (String[] args) throws Exception {\n        new LwjglApplication(new WhitespaceFontWrapIssue());\n    }\n\n    @Override\n    public void create () {\n        float gameScale = GAME_WIDTH / Gdx.graphics.getWidth();\n        int gameHeight = (int) (Gdx.graphics.getHeight() * gameScale + 0.5);\n        stage = new Stage(new FitViewport(GAME_WIDTH, gameHeight));\n        Gdx.input.setInputProcessor(stage);\n        FreeTypeFontGenerator generator = new FreeTypeFontGenerator(Gdx.files.internal(\"data/arial.ttf\"));\n        FreeTypeFontGenerator.FreeTypeFontParameter parameter = new FreeTypeFontGenerator.FreeTypeFontParameter();\n        parameter.size = (int) (20 / gameScale + 0.5);\n        BitmapFont font = generator.generateFont(parameter);\n        font.getData().setScale(gameScale);\n        Label.LabelStyle labelStyle = new Label.LabelStyle();\n        labelStyle.font = font;\n        labelStyle.fontColor = Color.WHITE;\n        Table table = new Table();\n        table.setFillParent(true);\n        addLabel(table, \"Another font wrap issue, this time with    multiple whitespace characters.\", labelStyle);\n        stage.addActor(table);\n        table.debug();\n    }\n\n    private void addLabel(Table table, String text, Label.LabelStyle labelStyle) {\n        Label label = new Label(text, labelStyle);\n        label.setWrap(true);\n        table.add(label).fillX().expandX().row();\n\n    }\n\n    @Override\n    public void render () {\n        Gdx.gl.glClearColor(0, 0, 0, 1);\n        Gdx.gl.glClear(GL20.GL_COLOR_BUFFER_BIT);\n        stage.act(Gdx.graphics.getDeltaTime());\n        stage.draw();\n    }\n}\n```\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/libgdx/libgdx/issues/comments/99253917/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"RobRendell","id":1848870,"node_id":"MDQ6VXNlcjE4NDg4NzA=","avatar_url":"https://avatars.githubusercontent.com/u/1848870?v=4","gravatar_id":"","url":"https://api.github.com/users/RobRendell","html_url":"https://github.com/RobRendell","followers_url":"https://api.github.com/users/RobRendell/followers","following_url":"https://api.github.com/users/RobRendell/following{/other_user}","gists_url":"https://api.github.com/users/RobRendell/gists{/gist_id}","starred_url":"https://api.github.com/users/RobRendell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RobRendell/subscriptions","organizations_url":"https://api.github.com/users/RobRendell/orgs","repos_url":"https://api.github.com/users/RobRendell/repos","events_url":"https://api.github.com/users/RobRendell/events{/privacy}","received_events_url":"https://api.github.com/users/RobRendell/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":299261735,"node_id":"MDExOkNsb3NlZEV2ZW50Mjk5MjYxNzM1","url":"https://api.github.com/repos/libgdx/libgdx/issues/events/299261735","actor":{"login":"NathanSweet","id":434010,"node_id":"MDQ6VXNlcjQzNDAxMA==","avatar_url":"https://avatars.githubusercontent.com/u/434010?v=4","gravatar_id":"","url":"https://api.github.com/users/NathanSweet","html_url":"https://github.com/NathanSweet","followers_url":"https://api.github.com/users/NathanSweet/followers","following_url":"https://api.github.com/users/NathanSweet/following{/other_user}","gists_url":"https://api.github.com/users/NathanSweet/gists{/gist_id}","starred_url":"https://api.github.com/users/NathanSweet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NathanSweet/subscriptions","organizations_url":"https://api.github.com/users/NathanSweet/orgs","repos_url":"https://api.github.com/users/NathanSweet/repos","events_url":"https://api.github.com/users/NathanSweet/events{/privacy}","received_events_url":"https://api.github.com/users/NathanSweet/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"0117db8edb4182f391fa1de95beae9f9205748f1","commit_url":"https://api.github.com/repos/libgdx/libgdx/commits/0117db8edb4182f391fa1de95beae9f9205748f1","created_at":"2015-05-07T13:28:19Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/libgdx/libgdx/issues/comments/100051945","html_url":"https://github.com/libgdx/libgdx/issues/3082#issuecomment-100051945","issue_url":"https://api.github.com/repos/libgdx/libgdx/issues/3082","id":100051945,"node_id":"MDEyOklzc3VlQ29tbWVudDEwMDA1MTk0NQ==","user":{"login":"RobRendell","id":1848870,"node_id":"MDQ6VXNlcjE4NDg4NzA=","avatar_url":"https://avatars.githubusercontent.com/u/1848870?v=4","gravatar_id":"","url":"https://api.github.com/users/RobRendell","html_url":"https://github.com/RobRendell","followers_url":"https://api.github.com/users/RobRendell/followers","following_url":"https://api.github.com/users/RobRendell/following{/other_user}","gists_url":"https://api.github.com/users/RobRendell/gists{/gist_id}","starred_url":"https://api.github.com/users/RobRendell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RobRendell/subscriptions","organizations_url":"https://api.github.com/users/RobRendell/orgs","repos_url":"https://api.github.com/users/RobRendell/repos","events_url":"https://api.github.com/users/RobRendell/events{/privacy}","received_events_url":"https://api.github.com/users/RobRendell/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-05-08T00:04:31Z","updated_at":"2015-05-08T00:08:02Z","body":"Sorry, but I'm not convinced this fix is right either.  The result of running the test is now:\n![image](https://cloud.githubusercontent.com/assets/1848870/7527920/4f4dab9a-f564-11e4-946d-40454b266418.png)\n\nIt doesn't overflow its bounds, but I believe the whitespace at a line break should be consumed so the text is flush along the left edge.  Even putting aside the question of multiple spaces, there's only a single space between \"wrap\" and \"issue\" but you can see that it's been preserved and pushes the second line right.\n\nThe two ways to deal with this IMHO is either have `BitmapFont.getWrapIndex()` consume whitespace to the right for the first character, like this:\n\n```\n        /** Returns the first valid glyph index to use to wrap to the next line, starting at the specified start index and\n         * (typically) moving toward the beginning of the glyphs array. */\n        public int getWrapIndex (Array<Glyph> glyphs, int start) {\n            char ch = (char)glyphs.get(start).id;\n            if (isWhitespace(ch)) {\n                for (int i = start; i < glyphs.size; i++) {\n                    ch = (char)glyphs.get(i).id;\n                    if (!isWhitespace(ch) || isBreakChar(ch)) return i;\n                }\n                return glyphs.size; // TODO could cause problems in existing calling code\n            } else {\n                for (int i = start - 1; i >= 1; i--) {\n                    ch = (char)glyphs.get(i).id;\n                    if (isWhitespace(ch)) return i + 1;\n                    if (isBreakChar(ch)) return i;\n                }\n            }\n            return 0;\n        }\n```\n\nor to leave `BitmapFont.getWrapIndex()` as it was originally and modify the code in `GlyphLayout.wrap()` where it says \"Eat whitespace at end of first run\" to have a second loop that likewise eats whitespace at the start of the second run (and accounting for the possibility of the second run being entirely whitespace and thus completely consumed and discarded).\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/libgdx/libgdx/issues/comments/100051945/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"RobRendell","id":1848870,"node_id":"MDQ6VXNlcjE4NDg4NzA=","avatar_url":"https://avatars.githubusercontent.com/u/1848870?v=4","gravatar_id":"","url":"https://api.github.com/users/RobRendell","html_url":"https://github.com/RobRendell","followers_url":"https://api.github.com/users/RobRendell/followers","following_url":"https://api.github.com/users/RobRendell/following{/other_user}","gists_url":"https://api.github.com/users/RobRendell/gists{/gist_id}","starred_url":"https://api.github.com/users/RobRendell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RobRendell/subscriptions","organizations_url":"https://api.github.com/users/RobRendell/orgs","repos_url":"https://api.github.com/users/RobRendell/repos","events_url":"https://api.github.com/users/RobRendell/events{/privacy}","received_events_url":"https://api.github.com/users/RobRendell/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":300281836,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDMwMDI4MTgzNg==","url":"https://api.github.com/repos/libgdx/libgdx/issues/events/300281836","actor":{"login":"NathanSweet","id":434010,"node_id":"MDQ6VXNlcjQzNDAxMA==","avatar_url":"https://avatars.githubusercontent.com/u/434010?v=4","gravatar_id":"","url":"https://api.github.com/users/NathanSweet","html_url":"https://github.com/NathanSweet","followers_url":"https://api.github.com/users/NathanSweet/followers","following_url":"https://api.github.com/users/NathanSweet/following{/other_user}","gists_url":"https://api.github.com/users/NathanSweet/gists{/gist_id}","starred_url":"https://api.github.com/users/NathanSweet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NathanSweet/subscriptions","organizations_url":"https://api.github.com/users/NathanSweet/orgs","repos_url":"https://api.github.com/users/NathanSweet/repos","events_url":"https://api.github.com/users/NathanSweet/events{/privacy}","received_events_url":"https://api.github.com/users/NathanSweet/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"fe9af6a02fc4719385965943cc26155fa64e9edf","commit_url":"https://api.github.com/repos/libgdx/libgdx/commits/fe9af6a02fc4719385965943cc26155fa64e9edf","created_at":"2015-05-08T14:19:19Z","performed_via_github_app":null}]