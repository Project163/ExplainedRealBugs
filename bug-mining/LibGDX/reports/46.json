{"url":"https://api.github.com/repos/libgdx/libgdx/issues/1160","repository_url":"https://api.github.com/repos/libgdx/libgdx","labels_url":"https://api.github.com/repos/libgdx/libgdx/issues/1160/labels{/name}","comments_url":"https://api.github.com/repos/libgdx/libgdx/issues/1160/comments","events_url":"https://api.github.com/repos/libgdx/libgdx/issues/1160/events","html_url":"https://github.com/libgdx/libgdx/issues/1160","id":25198873,"node_id":"MDU6SXNzdWUyNTE5ODg3Mw==","number":1160,"title":"Add AtlasRegionDrawable to libgdx","user":{"login":"desertkun","id":1666014,"node_id":"MDQ6VXNlcjE2NjYwMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/1666014?v=4","gravatar_id":"","url":"https://api.github.com/users/desertkun","html_url":"https://github.com/desertkun","followers_url":"https://api.github.com/users/desertkun/followers","following_url":"https://api.github.com/users/desertkun/following{/other_user}","gists_url":"https://api.github.com/users/desertkun/gists{/gist_id}","starred_url":"https://api.github.com/users/desertkun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/desertkun/subscriptions","organizations_url":"https://api.github.com/users/desertkun/orgs","repos_url":"https://api.github.com/users/desertkun/repos","events_url":"https://api.github.com/users/desertkun/events{/privacy}","received_events_url":"https://api.github.com/users/desertkun/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":11336982,"node_id":"MDU6TGFiZWwxMTMzNjk4Mg==","url":"https://api.github.com/repos/libgdx/libgdx/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2014-01-07T21:35:14Z","updated_at":"2014-02-11T23:04:44Z","closed_at":"2014-02-11T23:00:11Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hello,\n\nI use `TexturePacker2` to pack textures into one atlas. \n\nIt supports `stripWhitespaceX` and `stripWhitespaceY` options to strip whitespace at borders of every image. But i've noticed that if I render `TextureRegion`'s with these options â€” the regions size is corrupted. \n\nThere is an example what I am talking about: \n![atlasregiondrawable](https://f.cloud.github.com/assets/1666014/1863407/2b270e56-77e2-11e3-854e-96aaa870f05c.png)\nOriginal image (a), packed (b) and currupted render (c)\n\nSo, i decided to [dig deeper](https://github.com/libgdx/libgdx/wiki/Texture-packer#settings), and I've noticed that there are no support for drawing `Atlas$AtlasRegion`'s additinal data for that (`OffsetX`, `OffsetY`, `OriginalWidth` etc) correctly (if I am right).\n\nSo, I wrote it by myself, and glad to contribute it to Community, if it is possible.\n\n``` java\npackage com.badlogic.gdx.scenes.scene2d.utils;\n\n\nimport com.badlogic.gdx.graphics.g2d.SpriteBatch;\nimport com.badlogic.gdx.graphics.g2d.TextureAtlas;\nimport com.badlogic.gdx.graphics.g2d.TextureRegion;\nimport com.badlogic.gdx.scenes.scene2d.utils.BaseDrawable;\n\npublic class AtlasRegionDrawable extends BaseDrawable\n{\n    private TextureAtlas.AtlasRegion region;\n    private float coefWidth;\n    private float coefHeight;\n    private float coefX;\n    private float coefY;\n\n    public AtlasRegionDrawable () {\n    }\n\n    public AtlasRegionDrawable (TextureAtlas.AtlasRegion region) {\n        setRegion(region);\n    }\n\n    public AtlasRegionDrawable (AtlasRegionDrawable drawable) {\n        super(drawable);\n        setRegion(drawable.region);\n    }\n\n    @Override\n    public void draw (SpriteBatch batch, float x, float y, float width, float height) {\n        batch.draw(region,\n                x + coefX * (width - width * coefWidth),\n                y + coefY * (height - height * coefHeight),\n                width * coefWidth,\n                height * coefHeight);\n    }\n\n    public void draw (SpriteBatch batch, float x, float y,\n        float originX, float originY, float width, float height,\n        float scaleX, float scaleY, float rotation) {\n\n        batch.draw(region,\n                x + coefX * (width - width * coefWidth),\n                y + coefY * (height - height * coefHeight),\n\n                originX - coefX * (width - width * coefWidth),\n                originY - coefY * (height - height * coefHeight),\n\n                width * coefWidth,\n                height * coefHeight,\n                scaleX, scaleY, rotation);\n    }\n\n    public void setRegion (TextureAtlas.AtlasRegion region) {\n\n        this.region = region;\n\n        if (region.originalWidth == region.packedWidth && region.originalHeight == region.packedHeight)\n        {\n            this.coefX = 0;\n            this.coefY = 0;\n            this.coefWidth = 1;\n            this.coefHeight = 1;\n        }\n        else\n        {\n            this.coefWidth = (float)region.packedWidth / (float)region.originalWidth;\n            this.coefHeight = (float)region.packedHeight / (float)region.originalHeight;\n            this.coefX = region.offsetX / (float)(region.originalWidth - region.packedWidth);\n            this.coefY = region.offsetY / (float)(region.originalHeight - region.packedHeight);\n        }\n\n        setMinWidth(region.originalWidth);\n        setMinHeight(region.originalHeight);\n    }\n\n    public TextureRegion getRegion () {\n        return region;\n    }\n}\n```\n\nI've used it in `Image` for the first time, and i've noticed that `Image` dont supports `Atlas$AtlasRegion` too. There is modification for it (i've created inherited class `AtlasImage`, but this code could be easly inserted into original `Image`) that renders `AtlasRegionDrawable` correctly:\n\n``` java\n    @Override\n    public void draw(SpriteBatch batch, float parentAlpha)\n    {\n        validate();\n\n        Color color = getColor();\n        batch.setColor(color.r, color.g, color.b, color.a * parentAlpha);\n\n        Drawable drawable = getDrawable();\n        if (drawable != null) {\n            if (drawable instanceof AtlasRegionDrawable) {\n                AtlasRegionDrawable region = (AtlasRegionDrawable)drawable;\n\n                float rotation = getRotation();\n                if (getScaleX() == 1 && getScaleY() == 1 && rotation == 0)\n                {\n                    region.draw(batch,\n                            getX() + getImageX(), getY() + getImageY(),\n                            getImageWidth(), getImageHeight());\n\n                    return;\n                }\n                else\n                {\n                    region.draw(batch,\n                            getX() + getImageX(), getY() + getImageY(),\n                            getOriginX() - getImageX(), getOriginY() - getImageY(),\n                            getImageWidth(), getImageHeight(),\n                            getScaleX(), getScaleY(), rotation);\n\n                    return;\n                }\n            }\n        }\n\n        super.draw(batch, parentAlpha);\n    }\n```\n\n(`draw` method only)\n\nThank you for attention.\n","closed_by":{"login":"NathanSweet","id":434010,"node_id":"MDQ6VXNlcjQzNDAxMA==","avatar_url":"https://avatars.githubusercontent.com/u/434010?v=4","gravatar_id":"","url":"https://api.github.com/users/NathanSweet","html_url":"https://github.com/NathanSweet","followers_url":"https://api.github.com/users/NathanSweet/followers","following_url":"https://api.github.com/users/NathanSweet/following{/other_user}","gists_url":"https://api.github.com/users/NathanSweet/gists{/gist_id}","starred_url":"https://api.github.com/users/NathanSweet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NathanSweet/subscriptions","organizations_url":"https://api.github.com/users/NathanSweet/orgs","repos_url":"https://api.github.com/users/NathanSweet/repos","events_url":"https://api.github.com/users/NathanSweet/events{/privacy}","received_events_url":"https://api.github.com/users/NathanSweet/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/libgdx/libgdx/issues/1160/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/libgdx/libgdx/issues/1160/timeline","performed_via_github_app":null,"state_reason":"completed"}