{"url":"https://api.github.com/repos/libgdx/libgdx/issues/5810","repository_url":"https://api.github.com/repos/libgdx/libgdx","labels_url":"https://api.github.com/repos/libgdx/libgdx/issues/5810/labels{/name}","comments_url":"https://api.github.com/repos/libgdx/libgdx/issues/5810/comments","events_url":"https://api.github.com/repos/libgdx/libgdx/issues/5810/events","html_url":"https://github.com/libgdx/libgdx/issues/5810","id":503128531,"node_id":"MDU6SXNzdWU1MDMxMjg1MzE=","number":5810,"title":"Timer tasks scheduled during pauses have incorrect delay","user":{"login":"PokeMMO","id":2398581,"node_id":"MDQ6VXNlcjIzOTg1ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2398581?v=4","gravatar_id":"","url":"https://api.github.com/users/PokeMMO","html_url":"https://github.com/PokeMMO","followers_url":"https://api.github.com/users/PokeMMO/followers","following_url":"https://api.github.com/users/PokeMMO/following{/other_user}","gists_url":"https://api.github.com/users/PokeMMO/gists{/gist_id}","starred_url":"https://api.github.com/users/PokeMMO/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PokeMMO/subscriptions","organizations_url":"https://api.github.com/users/PokeMMO/orgs","repos_url":"https://api.github.com/users/PokeMMO/repos","events_url":"https://api.github.com/users/PokeMMO/events{/privacy}","received_events_url":"https://api.github.com/users/PokeMMO/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2019-10-06T16:57:00Z","updated_at":"2019-10-10T09:21:54Z","closed_at":"2019-10-10T09:21:54Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### Issue details\r\nTimer tasks scheduled during pauses have incorrect extra long delay depending on how long into a pause they were scheduled.\r\n\r\nhttps://github.com/libgdx/libgdx/blob/a4805d6a017b80622d6bfdd3a791352257a3c539/gdx/src/com/badlogic/gdx/utils/Timer.java#L290-L305\r\n\r\nThe whole duration of a pause is added to all tasks on resume, regardless of their start time.\r\n\r\n#### Reproduction steps/code\r\nSSCCE:\r\n```java\r\nimport com.badlogic.gdx.*;\r\nimport com.badlogic.gdx.backends.lwjgl.*;\r\nimport com.badlogic.gdx.graphics.GL20;\r\nimport com.badlogic.gdx.utils.Timer;\r\nimport com.badlogic.gdx.utils.Timer.Task;\r\n\r\npublic class TimerDelaySSCCE extends ApplicationAdapter {\r\n\t@Override\r\n\tpublic void create () {\r\n\t\t//Dummy task to warm up timer so pause works.\r\n\t\tTimer.schedule(new Task() {\r\n\t\t\t@Override\r\n\t\t\tpublic void run() {\r\n\t\t\t}\r\n\t\t}, 0.001f);\r\n\t}\r\n\r\n\t@Override\r\n\tpublic void render () {\r\n\t\tGdx.gl.glClear(GL20.GL_COLOR_BUFFER_BIT);\r\n\t}\r\n\t\r\n\tlong expected = 0;\r\n\tlong sleepDelay = 1000;\r\n\t\r\n\t@Override\r\n\tpublic void pause() {\r\n\t\tSystem.out.println(\"Pausing\");\r\n\t\tsuper.pause();\r\n\t\t\r\n\t\tnew Thread(new Runnable() {\t\r\n\t\t\t@Override\r\n\t\t\tpublic void run() {\r\n\t\t\t\t//However long we sleep offsets the execution delay\r\n\t\t\t\ttry { Thread.sleep(sleepDelay); } catch (InterruptedException e){}\r\n\t\t\t\t\r\n\t\t\t\tsleepDelay += 1000; //Sleep 1s more next time\r\n\t\t\t\t\r\n\t\t\t\tTimer.schedule(new Task() {\r\n\t\t\t\t\t@Override\r\n\t\t\t\t\tpublic void run() {\r\n\t\t\t\t\t\tSystem.out.println(\"Task ran at \" + System.currentTimeMillis() + \" difference of \" + (System.currentTimeMillis() - expected));\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 1);\r\n\t\t\t\t\r\n\t\t\t\tSystem.out.println(\"Timer created\");\r\n\t\t\t}\r\n\t\t}).start();\r\n\t}\r\n\t\r\n\t@Override\r\n\tpublic void resume() {\r\n\t\texpected = (System.currentTimeMillis()+1000);\r\n\t\tSystem.out.println(\"Resuming, we expect task to run at \" + expected);\r\n\t\tsuper.resume();\r\n\t}\r\n\r\n\tpublic static void main (String[] args) throws Exception {\r\n\t\tLwjglApplicationConfiguration config = new LwjglApplicationConfiguration();\r\n\t\tconfig.pauseWhenBackground = true;\r\n\t\tnew LwjglApplication(new TimerDelaySSCCE(), config);\r\n\t}\r\n}\r\n```\r\n\r\nResult of tabbing out and back in at correct states:\r\n```\r\nPausing\r\nTimer created\r\nResuming, we expect task to run at 1570380609020\r\nTask ran at 1570380610037 1017\r\nPausing\r\nTimer created\r\nResuming, we expect task to run at 1570380624331\r\nTask ran at 1570380626333 difference of 2002\r\nPausing\r\nTimer created\r\nResuming, we expect task to run at 1570380633272\r\nTask ran at 1570380636280 difference of 3008\r\nPausing\r\nTimer created\r\n```\r\n\r\n#### Version of LibGDX and/or relevant dependencies\r\n1.9.10\r\n\r\n#### Stacktrace\r\nN/A\r\n\r\n#### Please select the affected platforms\r\n- [x] Android\r\n- [ ] iOS (robovm)\r\n- [ ] iOS (MOE)\r\n- [ ] HTML/GWT\r\n- [x] Windows\r\n- [x] Linux\r\n- [x] MacOS","closed_by":{"login":"NathanSweet","id":434010,"node_id":"MDQ6VXNlcjQzNDAxMA==","avatar_url":"https://avatars.githubusercontent.com/u/434010?v=4","gravatar_id":"","url":"https://api.github.com/users/NathanSweet","html_url":"https://github.com/NathanSweet","followers_url":"https://api.github.com/users/NathanSweet/followers","following_url":"https://api.github.com/users/NathanSweet/following{/other_user}","gists_url":"https://api.github.com/users/NathanSweet/gists{/gist_id}","starred_url":"https://api.github.com/users/NathanSweet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NathanSweet/subscriptions","organizations_url":"https://api.github.com/users/NathanSweet/orgs","repos_url":"https://api.github.com/users/NathanSweet/repos","events_url":"https://api.github.com/users/NathanSweet/events{/privacy}","received_events_url":"https://api.github.com/users/NathanSweet/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/libgdx/libgdx/issues/5810/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/libgdx/libgdx/issues/5810/timeline","performed_via_github_app":null,"state_reason":"completed"}