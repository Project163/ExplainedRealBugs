{"url":"https://api.github.com/repos/libgdx/libgdx/issues/3509","repository_url":"https://api.github.com/repos/libgdx/libgdx","labels_url":"https://api.github.com/repos/libgdx/libgdx/issues/3509/labels{/name}","comments_url":"https://api.github.com/repos/libgdx/libgdx/issues/3509/comments","events_url":"https://api.github.com/repos/libgdx/libgdx/issues/3509/events","html_url":"https://github.com/libgdx/libgdx/issues/3509","id":113146834,"node_id":"MDU6SXNzdWUxMTMxNDY4MzQ=","number":3509,"title":"Bullet wrapper issue","user":{"login":"eadle","id":13059397,"node_id":"MDQ6VXNlcjEzMDU5Mzk3","avatar_url":"https://avatars.githubusercontent.com/u/13059397?v=4","gravatar_id":"","url":"https://api.github.com/users/eadle","html_url":"https://github.com/eadle","followers_url":"https://api.github.com/users/eadle/followers","following_url":"https://api.github.com/users/eadle/following{/other_user}","gists_url":"https://api.github.com/users/eadle/gists{/gist_id}","starred_url":"https://api.github.com/users/eadle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eadle/subscriptions","organizations_url":"https://api.github.com/users/eadle/orgs","repos_url":"https://api.github.com/users/eadle/repos","events_url":"https://api.github.com/users/eadle/events{/privacy}","received_events_url":"https://api.github.com/users/eadle/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-10-24T09:04:27Z","updated_at":"2016-03-17T23:09:18Z","closed_at":"2016-03-17T23:09:18Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The Bullet wrapper currently doesn't allow a btPairCachingGhostObject to getAllContactManfolds. I've tracked this bug down to how a btBroadphasePair temporary instance is stored when trying to access an index in btBroadphasePairArray. It's an easy fix by storing the temporary btBroadphasePair instance in Java instead of C++. This doesn't change how the API is exposed and it looks like this is the desired behaviour anyway (see btBroadphasePair.java).\n\n```\n    /** Temporary instance, use by native methods that return a btBroadphasePair instance */\n    protected final static btBroadphasePair temp = new btBroadphasePair(0, false);\n    public static btBroadphasePair internalTemp(long cPtr, boolean own) {\n        temp.reset(cPtr, own);\n        return temp;\n    }\n```\n\nI'll add to this tomorrow with an example to reproduce the results, but the following three file changes fixes the issue ([this guy](http://www.badlogicgames.com/forum/viewtopic.php?f=11&t=19830) had a similar issue). I didn't make a pull request because I'm having no luck with swig. Any tips would be appreciated.\n\n_jni/swig-src/collision/collision_wrap.cpp_:\n\n```\nSWIGEXPORT jlong JNICALL Java_com_badlogic_gdx_physics_bullet_collision_CollisionJNI_btBroadphasePairArray_1at(JNIEnv *jenv, jclass jcls, jlong jarg1, jobject jarg1_, jint jarg2) {\n  jlong jresult = 0 ;\n  btAlignedObjectArray< btBroadphasePair > *arg1 = (btAlignedObjectArray< btBroadphasePair > *) 0 ;\n  btBroadphasePair *result = 0 ;\n  int arg2 ;\n\n  (void)jenv;\n  (void)jcls;\n  (void)jarg1_;\n  arg1 = *(btAlignedObjectArray< btBroadphasePair > **)&jarg1;\n  arg2 = (int)jarg2;\n  result = (btBroadphasePair *) &((btAlignedObjectArray< btBroadphasePair > const *)arg1)->at(arg2);\n  *(btBroadphasePair **)&jresult = result;\n  return jresult;\n}\n```\n\n_jni/swig-src/collision/com/badlogic/gdx/physics/bullet/collision/btBroadphaseArray.java:_\n\n```\npublic btBroadphasePair at(int n) {\n  return btBroadphasePair.internalTemp(CollisionJNI.btBroadphasePairArray_at(swigCPtr, this, n), false);\n}\n```\n\n_jni/swig-src/collision/CollisionJNI.java:_\n\n```\npublic final static native long btBroadphasePairArray_at(long jarg1, btBroadphasePairArray jarg1_, int jarg2);\n```\n","closed_by":{"login":"xoppa","id":2349087,"node_id":"MDQ6VXNlcjIzNDkwODc=","avatar_url":"https://avatars.githubusercontent.com/u/2349087?v=4","gravatar_id":"","url":"https://api.github.com/users/xoppa","html_url":"https://github.com/xoppa","followers_url":"https://api.github.com/users/xoppa/followers","following_url":"https://api.github.com/users/xoppa/following{/other_user}","gists_url":"https://api.github.com/users/xoppa/gists{/gist_id}","starred_url":"https://api.github.com/users/xoppa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xoppa/subscriptions","organizations_url":"https://api.github.com/users/xoppa/orgs","repos_url":"https://api.github.com/users/xoppa/repos","events_url":"https://api.github.com/users/xoppa/events{/privacy}","received_events_url":"https://api.github.com/users/xoppa/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/libgdx/libgdx/issues/3509/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/libgdx/libgdx/issues/3509/timeline","performed_via_github_app":null,"state_reason":"completed"}