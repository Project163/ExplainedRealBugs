{"url":"https://api.github.com/repos/libgdx/libgdx/issues/6228","repository_url":"https://api.github.com/repos/libgdx/libgdx","labels_url":"https://api.github.com/repos/libgdx/libgdx/issues/6228/labels{/name}","comments_url":"https://api.github.com/repos/libgdx/libgdx/issues/6228/comments","events_url":"https://api.github.com/repos/libgdx/libgdx/issues/6228/events","html_url":"https://github.com/libgdx/libgdx/issues/6228","id":722109955,"node_id":"MDU6SXNzdWU3MjIxMDk5NTU=","number":6228,"title":"Smoothed Delta times on Android and overall improvements","user":{"login":"obigu","id":1794492,"node_id":"MDQ6VXNlcjE3OTQ0OTI=","avatar_url":"https://avatars.githubusercontent.com/u/1794492?v=4","gravatar_id":"","url":"https://api.github.com/users/obigu","html_url":"https://github.com/obigu","followers_url":"https://api.github.com/users/obigu/followers","following_url":"https://api.github.com/users/obigu/following{/other_user}","gists_url":"https://api.github.com/users/obigu/gists{/gist_id}","starred_url":"https://api.github.com/users/obigu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/obigu/subscriptions","organizations_url":"https://api.github.com/users/obigu/orgs","repos_url":"https://api.github.com/users/obigu/repos","events_url":"https://api.github.com/users/obigu/events{/privacy}","received_events_url":"https://api.github.com/users/obigu/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2305934347,"node_id":"MDU6TGFiZWwyMzA1OTM0MzQ3","url":"https://api.github.com/repos/libgdx/libgdx/labels/core","name":"core","color":"0052cc","default":false,"description":"affecting all platforms"},{"id":2313818191,"node_id":"MDU6TGFiZWwyMzEzODE4MTkx","url":"https://api.github.com/repos/libgdx/libgdx/labels/graphics","name":"graphics","color":"fbca04","default":false,"description":"Concerning Gdx.graphics"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-10-15T08:18:19Z","updated_at":"2020-10-24T15:57:10Z","closed_at":"2020-10-24T15:57:10Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"`Graphics` has 2 different methods to get delta time, `float getDeltaTime()` and `float getRawDeltaTime();`. According to java docs, the difference is that `getDeltaTime()` \"Might be smoothed over n frames.\".\r\n\r\nChecking all backend `Graphics` implementations, the only backend that does smoothing on the delta is the Android backend, that applies a simple size 5 window mean. This is probably due to legacy reasons when libGDX was created some Android devices were really unrealiable (we're talking Android 1.5 or 1.6) and my guess is that this was a workaround for those old devices with very inconsistent delta times.\r\n\r\nAveraging the delta over 5 frames has a significant impact on how the game behaves during lag spikes. Let me show with an example.\r\n\r\nImagine we have the following sequence of Raw delta times\r\n1/60 1/60 1/60 1/60 1/60 **1/5** 1/60 1/60 1/60 1/60 1/60\r\n\r\nIn every backend except from Android, in a typical setup in which delta is capped to 1/30 (Scene2D does that by default) the resulting deltas used by the game would be  \r\n1/60 1/60 1/60 1/60 1/60 **1/30** 1/60 1/60 1/60 1/60 1/60 1/60\r\nIn which only the 1/30 frame would have a \"slow motion\" distortion caused due to real elapsed time being higher than delta time\r\n\r\nOn Android, on the other hand, we would get\r\n1/60 1/60 1/60 1/60 1/60 **1/30 1/30 1/30 1/30 1/30** 1/60\r\nIn which the first 1/30 frame would be distorted exactly like before but the next 4 1/30 ones they would be \"fast forward\" (as if it was catching up).\r\n\r\nUnderstanding that\r\n- Different games have different needs (not the same a multiplayer racing game than a puzzle game) and may want to deal differently with lag spikes or delta inconsistencies.\r\n- It is a complex topic and there's not a perfect solution. See for example https://blogs.unity3d.com/2020/10/01/fixing-time-deltatime-in-unity-2020-2-for-smoother-gameplay-what-did-it-take/ for recent Unity improvements or https://frankforce.com/frame-rate-delta-buffering/ for a strategy working on a specific game.\r\n\r\nI think there are several things of this design decision that are worth revisiting:\r\n\r\n1. I'm not aware of any reason why Android should be treated differently from the other backends. Considering the algorithm applied is not particularly good (most smoothing approaches go for a weighted average or some kind of low filter) and in many scenarios the current solution will impact how lag is perceived in games and feel worse than raw delta. I think we should remove the smoothing from Android.\r\n2. The \"maybe smoothed\" version `getDeltaTime()` is used across libGDX code base by different systems to get the delta time (with calls to `Gdx.graphics.getDeltaTime()`). This means that, even if a user didn't want the smoothed delta to be used on his game, some parts of libGDX (from Scene2D to particles among others) would still use the smoothed one causing unpredictable issues.\r\n3. As an larger scoped improvement (that would entail breaking backwards compatibility) I think it's worth evaluating adding optional Delta capping and the ability to provide a Smoothing strategy at framework level. We could also consider having `getDeltaTime()` to return raw delta time and add a `getSmoothedDeltaTime()` (Unity has something on these lines).\r\n\r\n","closed_by":{"login":"MrStahlfelge","id":26038055,"node_id":"MDQ6VXNlcjI2MDM4MDU1","avatar_url":"https://avatars.githubusercontent.com/u/26038055?v=4","gravatar_id":"","url":"https://api.github.com/users/MrStahlfelge","html_url":"https://github.com/MrStahlfelge","followers_url":"https://api.github.com/users/MrStahlfelge/followers","following_url":"https://api.github.com/users/MrStahlfelge/following{/other_user}","gists_url":"https://api.github.com/users/MrStahlfelge/gists{/gist_id}","starred_url":"https://api.github.com/users/MrStahlfelge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MrStahlfelge/subscriptions","organizations_url":"https://api.github.com/users/MrStahlfelge/orgs","repos_url":"https://api.github.com/users/MrStahlfelge/repos","events_url":"https://api.github.com/users/MrStahlfelge/events{/privacy}","received_events_url":"https://api.github.com/users/MrStahlfelge/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/libgdx/libgdx/issues/6228/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/libgdx/libgdx/issues/6228/timeline","performed_via_github_app":null,"state_reason":"completed"}