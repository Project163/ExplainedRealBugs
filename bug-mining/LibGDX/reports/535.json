{"url":"https://api.github.com/repos/libgdx/libgdx/issues/6334","repository_url":"https://api.github.com/repos/libgdx/libgdx","labels_url":"https://api.github.com/repos/libgdx/libgdx/issues/6334/labels{/name}","comments_url":"https://api.github.com/repos/libgdx/libgdx/issues/6334/comments","events_url":"https://api.github.com/repos/libgdx/libgdx/issues/6334/events","html_url":"https://github.com/libgdx/libgdx/issues/6334","id":775121848,"node_id":"MDU6SXNzdWU3NzUxMjE4NDg=","number":6334,"title":"Problem with the calculation of the internal offset in SpriteCache#draw(cacheID, offset, length)","user":{"login":"pcfreak9000","id":23034961,"node_id":"MDQ6VXNlcjIzMDM0OTYx","avatar_url":"https://avatars.githubusercontent.com/u/23034961?v=4","gravatar_id":"","url":"https://api.github.com/users/pcfreak9000","html_url":"https://github.com/pcfreak9000","followers_url":"https://api.github.com/users/pcfreak9000/followers","following_url":"https://api.github.com/users/pcfreak9000/following{/other_user}","gists_url":"https://api.github.com/users/pcfreak9000/gists{/gist_id}","starred_url":"https://api.github.com/users/pcfreak9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pcfreak9000/subscriptions","organizations_url":"https://api.github.com/users/pcfreak9000/orgs","repos_url":"https://api.github.com/users/pcfreak9000/repos","events_url":"https://api.github.com/users/pcfreak9000/events{/privacy}","received_events_url":"https://api.github.com/users/pcfreak9000/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-12-27T22:45:51Z","updated_at":"2020-12-30T22:43:08Z","closed_at":"2020-12-30T22:43:08Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"``draw(int cacheID, int offset, int length)`` in the SpriteCache ([Here](https://github.com/libgdx/libgdx/blob/793372025c94abfa6b4fa28a6b8543ff54033ead/gdx/src/com/badlogic/gdx/graphics/g2d/SpriteCache.java#L912)) seems to be broken. More precisely, the calculation of the internal offset. \r\n#### Issue details\r\nUsing that method to draw a cache which is not the first one, e.g. ``draw(2, 0, imagecount)`` where imagecount is a manual count of how many images i added earlier, nothing is shown, but i would expect the same result as when calling ``draw(2)`` which is working correctly. Also, if ``cacheID`` is zero (meaning the internal cache offset is also zero), the method works as expected, further pointing to an issue with the offset.\r\n\r\nLooking into the SpriteCache, i found the line ``int offset = cache.offset / (verticesPerImage * VERTEX_SIZE) * 6;`` in ``draw(int cacheID)`` and  the line ``offset = offset * 6 + cache.offset;`` in ``draw(int cacheID, int offset, int length)``. In the first one (which is the one correctly working), there is a division by some factor which i didn't find in the second method, so i suppose there's the problem.\r\n\r\n#### Reproduction steps/code\r\n```java\r\nimport com.badlogic.gdx.ApplicationAdapter;\r\nimport com.badlogic.gdx.Gdx;\r\nimport com.badlogic.gdx.backends.lwjgl3.Lwjgl3Application;\r\nimport com.badlogic.gdx.backends.lwjgl3.Lwjgl3ApplicationConfiguration;\r\nimport com.badlogic.gdx.graphics.Color;\r\nimport com.badlogic.gdx.graphics.GL20;\r\nimport com.badlogic.gdx.graphics.Pixmap;\r\nimport com.badlogic.gdx.graphics.Pixmap.Format;\r\nimport com.badlogic.gdx.graphics.Texture;\r\nimport com.badlogic.gdx.graphics.g2d.SpriteCache;\r\n\r\npublic class DesktopLauncher {\r\n    public static void main(String[] arg) {\r\n        Lwjgl3ApplicationConfiguration config = new Lwjgl3ApplicationConfiguration();\r\n        config.useOpenGL3(true, 3, 3);\r\n        config.setTitle(\"Problem\");\r\n        config.enableGLDebugOutput(true, System.out);\r\n        new Lwjgl3Application(new ReproduceBug(), config);\r\n    }\r\n    \r\n    private static class ReproduceBug extends ApplicationAdapter {\r\n        \r\n        private SpriteCache cache;\r\n        private Texture texture;\r\n        \r\n        private static final int MAX_COUNT = 30;\r\n        \r\n        @Override\r\n        public void create() {\r\n            this.cache = new SpriteCache(1000, false);\r\n            Pixmap p = new Pixmap(100, 100, Format.RGB888);\r\n            p.setColor(1, 1, 1, 1);\r\n            p.fill();\r\n            p.setColor(Color.CORAL);\r\n            p.fillCircle(50, 50, 50);\r\n            this.texture = new Texture(p);\r\n            p.dispose();\r\n        }\r\n        \r\n        @Override\r\n        public void render() {\r\n            Gdx.gl.glClearColor(1, 0, 0, 1);\r\n            Gdx.gl.glClear(GL20.GL_COLOR_BUFFER_BIT);\r\n            cache.clear();\r\n            for (int i = 0; i < 5; i++) {\r\n                cache.beginCache();\r\n                for (int j = 0; j < MAX_COUNT; j++) {\r\n                    cache.add(texture, i * 40, j * 10);\r\n                }\r\n                int id = cache.endCache();\r\n                cache.begin();\r\n                //***** Problem here: \r\n                cache.draw(id, 0, MAX_COUNT); //<- does only work for the first cache (offset and the internal cache.offset are both zero then)\r\n                //cache.draw(id); //<- Works as expected\r\n                //*****\r\n                cache.end();\r\n            }\r\n        }\r\n        \r\n        @Override\r\n        public void dispose() {\r\n            this.cache.dispose();\r\n            this.texture.dispose();\r\n        }\r\n        \r\n    }\r\n}\r\n```\r\n\r\n#### Version of LibGDX and/or relevant dependencies\r\nLibGDX 1.9.12\r\n\r\n#### Please select the affected platforms\r\n- [ ] Android\r\n- [ ] iOS\r\n- [ ] HTML/GWT\r\n- [ ] Windows\r\n- [x] Linux\r\n- [ ] MacOS\r\n\r\nBut I suppose the bug is independent of platform.","closed_by":{"login":"NathanSweet","id":434010,"node_id":"MDQ6VXNlcjQzNDAxMA==","avatar_url":"https://avatars.githubusercontent.com/u/434010?v=4","gravatar_id":"","url":"https://api.github.com/users/NathanSweet","html_url":"https://github.com/NathanSweet","followers_url":"https://api.github.com/users/NathanSweet/followers","following_url":"https://api.github.com/users/NathanSweet/following{/other_user}","gists_url":"https://api.github.com/users/NathanSweet/gists{/gist_id}","starred_url":"https://api.github.com/users/NathanSweet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NathanSweet/subscriptions","organizations_url":"https://api.github.com/users/NathanSweet/orgs","repos_url":"https://api.github.com/users/NathanSweet/repos","events_url":"https://api.github.com/users/NathanSweet/events{/privacy}","received_events_url":"https://api.github.com/users/NathanSweet/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/libgdx/libgdx/issues/6334/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/libgdx/libgdx/issues/6334/timeline","performed_via_github_app":null,"state_reason":"completed"}