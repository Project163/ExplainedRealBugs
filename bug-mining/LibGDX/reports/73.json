{"url":"https://api.github.com/repos/libgdx/libgdx/issues/1726","repository_url":"https://api.github.com/repos/libgdx/libgdx","labels_url":"https://api.github.com/repos/libgdx/libgdx/issues/1726/labels{/name}","comments_url":"https://api.github.com/repos/libgdx/libgdx/issues/1726/comments","events_url":"https://api.github.com/repos/libgdx/libgdx/issues/1726/events","html_url":"https://github.com/libgdx/libgdx/issues/1726","id":31829048,"node_id":"MDU6SXNzdWUzMTgyOTA0OA==","number":1726,"title":"Precision problems with Intersector.intersectSegmentPolygon","user":{"login":"manuel-freire","id":2271676,"node_id":"MDQ6VXNlcjIyNzE2NzY=","avatar_url":"https://avatars.githubusercontent.com/u/2271676?v=4","gravatar_id":"","url":"https://api.github.com/users/manuel-freire","html_url":"https://github.com/manuel-freire","followers_url":"https://api.github.com/users/manuel-freire/followers","following_url":"https://api.github.com/users/manuel-freire/following{/other_user}","gists_url":"https://api.github.com/users/manuel-freire/gists{/gist_id}","starred_url":"https://api.github.com/users/manuel-freire/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/manuel-freire/subscriptions","organizations_url":"https://api.github.com/users/manuel-freire/orgs","repos_url":"https://api.github.com/users/manuel-freire/repos","events_url":"https://api.github.com/users/manuel-freire/events{/privacy}","received_events_url":"https://api.github.com/users/manuel-freire/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2014-04-18T22:27:40Z","updated_at":"2014-04-25T07:10:52Z","closed_at":"2014-04-25T07:10:52Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Testcase: a 10x10 square (the polygon), and a segment from nearly-(9,9) to (20, 5): libgdx detects no intersection, although the first point is clearly inside and the second is outside:\n\n``` java\nPolygon p = new Polygon(new float[] {\n    0, 0, 10, 0, 10, 10, 0, 10\n});\n// these values fail. However, (9, 9) works fine.\nVector2 source = new Vector2(9.009702f, 9.002425f);\nVector2 target = new Vector2(20, 5);\nassertTrue(\"Point inside square \" + source\n    + \" intersects with point outside \" + target,\n    Intersector.intersectSegmentPolygon(source, target, p,));\n```\n\nThis seems to be due to a rounding error: `intersectSegmentPolygon` checks whether\nx = 9.999999 lies within 10.0 and 10.0 in (https://github.com/libgdx/libgdx/blob/master/gdx/src/com/badlogic/gdx/math/Intersector.java#L726). This results in a false negative.\n\nA fix, which works for me, is to add a new `float epsilon` parameter to sidestep precision problems in the final tests. The problematic lines would be transformed into\n\n``` java\nif (((x+epsilon > x3 && x < x4+epsilon) || (x+epsilon > x4 && x < x3+epsilon)) && ((x+epsilon > x1 && x < x2+epsilon) || (x+epsilon > x2 && x < x1+epsilon))) {\n    float y = (det1 * height34 - height12 * det2) / det3;\n    if (((y+epsilon > y3 && y < y4+epsilon) || (y+epsilon > y4 && y < y3+epsilon)) && ((y+epsilon > y1 && y < y2+epsilon) || (y+epsilon > y2 && y < y1+epsilon))) return true;\n}\n```\n\nThis is certainly more expensive than not using epsilon at all; but failing such a simple test-case is surprising, and paves the way to hard-to-reproduce \"random\" bugs.\n","closed_by":{"login":"badlogic","id":514052,"node_id":"MDQ6VXNlcjUxNDA1Mg==","avatar_url":"https://avatars.githubusercontent.com/u/514052?v=4","gravatar_id":"","url":"https://api.github.com/users/badlogic","html_url":"https://github.com/badlogic","followers_url":"https://api.github.com/users/badlogic/followers","following_url":"https://api.github.com/users/badlogic/following{/other_user}","gists_url":"https://api.github.com/users/badlogic/gists{/gist_id}","starred_url":"https://api.github.com/users/badlogic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/badlogic/subscriptions","organizations_url":"https://api.github.com/users/badlogic/orgs","repos_url":"https://api.github.com/users/badlogic/repos","events_url":"https://api.github.com/users/badlogic/events{/privacy}","received_events_url":"https://api.github.com/users/badlogic/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/libgdx/libgdx/issues/1726/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/libgdx/libgdx/issues/1726/timeline","performed_via_github_app":null,"state_reason":"completed"}