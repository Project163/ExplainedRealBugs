{"url":"https://api.github.com/repos/libgdx/libgdx/issues/3147","repository_url":"https://api.github.com/repos/libgdx/libgdx","labels_url":"https://api.github.com/repos/libgdx/libgdx/issues/3147/labels{/name}","comments_url":"https://api.github.com/repos/libgdx/libgdx/issues/3147/comments","events_url":"https://api.github.com/repos/libgdx/libgdx/issues/3147/events","html_url":"https://github.com/libgdx/libgdx/issues/3147","id":78136959,"node_id":"MDU6SXNzdWU3ODEzNjk1OQ==","number":3147,"title":"Intersector.intersectRayTriangle failures (again)","user":{"login":"fwolff","id":527445,"node_id":"MDQ6VXNlcjUyNzQ0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/527445?v=4","gravatar_id":"","url":"https://api.github.com/users/fwolff","html_url":"https://github.com/fwolff","followers_url":"https://api.github.com/users/fwolff/followers","following_url":"https://api.github.com/users/fwolff/following{/other_user}","gists_url":"https://api.github.com/users/fwolff/gists{/gist_id}","starred_url":"https://api.github.com/users/fwolff/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fwolff/subscriptions","organizations_url":"https://api.github.com/users/fwolff/orgs","repos_url":"https://api.github.com/users/fwolff/repos","events_url":"https://api.github.com/users/fwolff/events{/privacy}","received_events_url":"https://api.github.com/users/fwolff/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2015-05-19T15:32:32Z","updated_at":"2017-01-16T14:59:23Z","closed_at":"2015-07-22T15:50:25Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I have found another issue with intersectRayTriangle. How to reproduce:\n\n``` java\nVector3 t1 = new Vector3(90.0f, -150.0f, 1077.0f);\nVector3 t2 = new Vector3(90.0f, -120.0f, 1109.0f);\nVector3 t3 = new Vector3(120.0f, -150.0f, 1076.0f);\n\nRay ray = new Ray(new Vector3(90.0f, -150.0f, 1077.1f), new Vector3(-0.0f, 0.99503726f, 0.099503726f));\nSystem.out.println(Intersector.intersectRayTriangle(ray, t1, t2, t3, null); // error: print false\n```\n\nIt's not obvious there is an intersection, but it is at: [90.0, -149.89658, 1077.1104]\n\nSuggested fix (adapted from the [MÃ¶ller-Trumbore algorithm](http://www.cs.virginia.edu/~gfx/Courses/2003/ImageSynthesis/papers/Acceleration/Fast%20MinimumStorage%20RayTriangle%20Intersection.pdf)):\n\n``` java\nprivate static final float epsilon = 0.00001f;\n\npublic static boolean intersectRayTriangle (Ray ray, Vector3 t1, Vector3 t2, Vector3 t3, Vector3 intersection) {\n    Vector3 edge1 = v0.set(t2).sub(t1);\n    Vector3 edge2 = v1.set(t3).sub(t1);\n\n    Vector3 pvec = v2.set(ray.direction).crs(edge2);\n    float det = edge1.dot(pvec);\n    if (det > -epsilon && det < epsilon) {\n        p.set(t1, t2, t3);\n        if (p.testPoint(ray.origin) == PlaneSide.OnPlane && isPointInTriangle(ray.origin, t1, t2, t3)) {\n            if (intersection != null) intersection.set(ray.origin);\n            return true;\n        }\n        return false;\n    }\n\n    det = 1.0f / det;\n\n    Vector3 tvec = i.set(ray.origin).sub(t1);\n    float u = tvec.dot(pvec) * det;\n    if (u < 0.0f || u > 1.0f) return false;\n\n    Vector3 qvec = tvec.crs(edge1);\n    float v = ray.direction.dot(qvec) * det;\n    if (v < 0.0f || u + v > 1.0f) return false;\n\n    float t = edge2.dot(qvec) * det;\n    if (t < 0) return false;\n\n    if (intersection != null) {\n        if (t < epsilon) {\n            intersection.set(ray.origin);\n        } else {\n            ray.getEndPoint(intersection, t);\n        }\n    }\n\n    return true;\n}\n```\n\nThe only difference with the original algorithm is that the method returns true when the ray origin is inside the triangle. It is clear this new code should be tested thoroughly to make sure it doesn't break existing applications.\n\nShould I send a new pull request?\n","closed_by":{"login":"dsaltares","id":570314,"node_id":"MDQ6VXNlcjU3MDMxNA==","avatar_url":"https://avatars.githubusercontent.com/u/570314?v=4","gravatar_id":"","url":"https://api.github.com/users/dsaltares","html_url":"https://github.com/dsaltares","followers_url":"https://api.github.com/users/dsaltares/followers","following_url":"https://api.github.com/users/dsaltares/following{/other_user}","gists_url":"https://api.github.com/users/dsaltares/gists{/gist_id}","starred_url":"https://api.github.com/users/dsaltares/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dsaltares/subscriptions","organizations_url":"https://api.github.com/users/dsaltares/orgs","repos_url":"https://api.github.com/users/dsaltares/repos","events_url":"https://api.github.com/users/dsaltares/events{/privacy}","received_events_url":"https://api.github.com/users/dsaltares/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/libgdx/libgdx/issues/3147/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/libgdx/libgdx/issues/3147/timeline","performed_via_github_app":null,"state_reason":"completed"}