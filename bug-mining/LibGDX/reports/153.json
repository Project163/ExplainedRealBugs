{"url":"https://api.github.com/repos/libgdx/libgdx/issues/2448","repository_url":"https://api.github.com/repos/libgdx/libgdx","labels_url":"https://api.github.com/repos/libgdx/libgdx/issues/2448/labels{/name}","comments_url":"https://api.github.com/repos/libgdx/libgdx/issues/2448/comments","events_url":"https://api.github.com/repos/libgdx/libgdx/issues/2448/events","html_url":"https://github.com/libgdx/libgdx/issues/2448","id":45460094,"node_id":"MDU6SXNzdWU0NTQ2MDA5NA==","number":2448,"title":"JSON improvements: #toString and #name()","user":{"login":"RotaruDan","id":5658058,"node_id":"MDQ6VXNlcjU2NTgwNTg=","avatar_url":"https://avatars.githubusercontent.com/u/5658058?v=4","gravatar_id":"","url":"https://api.github.com/users/RotaruDan","html_url":"https://github.com/RotaruDan","followers_url":"https://api.github.com/users/RotaruDan/followers","following_url":"https://api.github.com/users/RotaruDan/following{/other_user}","gists_url":"https://api.github.com/users/RotaruDan/gists{/gist_id}","starred_url":"https://api.github.com/users/RotaruDan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RotaruDan/subscriptions","organizations_url":"https://api.github.com/users/RotaruDan/orgs","repos_url":"https://api.github.com/users/RotaruDan/repos","events_url":"https://api.github.com/users/RotaruDan/events{/privacy}","received_events_url":"https://api.github.com/users/RotaruDan/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2014-10-10T09:01:02Z","updated_at":"2014-10-10T10:59:15Z","closed_at":"2014-10-10T10:59:15Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi,\n#### Problem:\n\nit seems that this commit: https://github.com/libgdx/libgdx/commit/72c9d62cfb9810459a1de85f3101f1a3cb6f7213 changed JSON to use Enums#name() instead of Enums#toString() and this broke our tests and build.\n#### Use case:\n\nHaving the following autogenerated java class:\n\n``` java\n/**\n * Simple object for storing information about the current release of the ead2 editor. This release.json file should be generated automatically on each release.\n * \n */\n@Generated(\"org.jsonschema2pojo\")\npublic class ReleaseInfo {\n\n    /**\n     * Name of the application. Used mostly in tracking\n     * \n     */\n    private String appName;\n    /**\n     * The release version given as three numbers separated by dots (e.g. 2.0.0)\n     * \n     */\n    private String appVersion = \"0.0.0\";\n    /**\n     * The release flavour. For explanations on canary, beta and stable, see the wiki\n     * \n     */\n    private ReleaseInfo.ReleaseType releaseType;\n    /**\n     * true if this is a dev working copy, not an actual release. If true, the update system is disabled.\n     * \n     */\n    private boolean dev = false;\n    /**\n     * The API Key used for tracking\n     * \n     */\n    private String tracking;\n    /**\n     * URL that stores the update.json file with information about the latest release available.\n     * \n     */\n    private String updateURL;\n    /**\n     * URL for bug reporting.\n     * \n     */\n    private String bugReportURL;\n    /**\n     * Simple enum that stores platform-os types. To be used by UpdateInfo and ReleaseInfo. More info: https://github.com/e-ucm/ead/wiki/Platform-version-names\n     * \n     */\n    private OS os = OS.fromValue(\"multiplatform\");\n    /**\n     * The relative or absolute path of the engine.jar library that is used for exporting the games from the editor. This path changes depending on whether you are on an actual release or on a development environment. In an actual release, this is expected to be in lib/engine.jar while in a development environment this will point to a local Maven repo\n     * \n     */\n    private String engineLibPath;\n\n    /**\n     * Name of the application. Used mostly in tracking\n     * \n     */\n    public String getAppName() {\n        return appName;\n    }\n\n    /**\n     * Name of the application. Used mostly in tracking\n     * \n     */\n    public void setAppName(String appName) {\n        this.appName = appName;\n    }\n\n    /**\n     * The release version given as three numbers separated by dots (e.g. 2.0.0)\n     * \n     */\n    public String getAppVersion() {\n        return appVersion;\n    }\n\n    /**\n     * The release version given as three numbers separated by dots (e.g. 2.0.0)\n     * \n     */\n    public void setAppVersion(String appVersion) {\n        this.appVersion = appVersion;\n    }\n\n    /**\n     * The release flavour. For explanations on canary, beta and stable, see the wiki\n     * \n     */\n    public ReleaseInfo.ReleaseType getReleaseType() {\n        return releaseType;\n    }\n\n    /**\n     * The release flavour. For explanations on canary, beta and stable, see the wiki\n     * \n     */\n    public void setReleaseType(ReleaseInfo.ReleaseType releaseType) {\n        this.releaseType = releaseType;\n    }\n\n    /**\n     * true if this is a dev working copy, not an actual release. If true, the update system is disabled.\n     * \n     */\n    public boolean isDev() {\n        return dev;\n    }\n\n    /**\n     * true if this is a dev working copy, not an actual release. If true, the update system is disabled.\n     * \n     */\n    public void setDev(boolean dev) {\n        this.dev = dev;\n    }\n\n    /**\n     * The API Key used for tracking\n     * \n     */\n    public String getTracking() {\n        return tracking;\n    }\n\n    /**\n     * The API Key used for tracking\n     * \n     */\n    public void setTracking(String tracking) {\n        this.tracking = tracking;\n    }\n\n    /**\n     * URL that stores the update.json file with information about the latest release available.\n     * \n     */\n    public String getUpdateURL() {\n        return updateURL;\n    }\n\n    /**\n     * URL that stores the update.json file with information about the latest release available.\n     * \n     */\n    public void setUpdateURL(String updateURL) {\n        this.updateURL = updateURL;\n    }\n\n    /**\n     * URL for bug reporting.\n     * \n     */\n    public String getBugReportURL() {\n        return bugReportURL;\n    }\n\n    /**\n     * URL for bug reporting.\n     * \n     */\n    public void setBugReportURL(String bugReportURL) {\n        this.bugReportURL = bugReportURL;\n    }\n\n    /**\n     * Simple enum that stores platform-os types. To be used by UpdateInfo and ReleaseInfo. More info: https://github.com/e-ucm/ead/wiki/Platform-version-names\n     * \n     */\n    public OS getOs() {\n        return os;\n    }\n\n    /**\n     * Simple enum that stores platform-os types. To be used by UpdateInfo and ReleaseInfo. More info: https://github.com/e-ucm/ead/wiki/Platform-version-names\n     * \n     */\n    public void setOs(OS os) {\n        this.os = os;\n    }\n\n    /**\n     * The relative or absolute path of the engine.jar library that is used for exporting the games from the editor. This path changes depending on whether you are on an actual release or on a development environment. In an actual release, this is expected to be in lib/engine.jar while in a development environment this will point to a local Maven repo\n     * \n     */\n    public String getEngineLibPath() {\n        return engineLibPath;\n    }\n\n    /**\n     * The relative or absolute path of the engine.jar library that is used for exporting the games from the editor. This path changes depending on whether you are on an actual release or on a development environment. In an actual release, this is expected to be in lib/engine.jar while in a development environment this will point to a local Maven repo\n     * \n     */\n    public void setEngineLibPath(String engineLibPath) {\n        this.engineLibPath = engineLibPath;\n    }\n\n    @Generated(\"org.jsonschema2pojo\")\n    public static enum ReleaseType {\n\n        NIGHTLY(\"nightly\"),\n        BETA(\"beta\"),\n        STABLE(\"stable\");\n        private final String value;\n        private static Map<String, ReleaseInfo.ReleaseType> constants = new HashMap<String, ReleaseInfo.ReleaseType>();\n\n        static {\n            for (ReleaseInfo.ReleaseType c: values()) {\n                constants.put(c.value, c);\n            }\n        }\n\n        private ReleaseType(String value) {\n            this.value = value;\n        }\n\n        @Override\n        public String toString() {\n            return this.value;\n        }\n\n        public static ReleaseInfo.ReleaseType fromValue(String value) {\n            ReleaseInfo.ReleaseType constant = constants.get(value);\n            if (constant == null) {\n                throw new IllegalArgumentException(value);\n            } else {\n                return constant;\n            }\n        }\n\n    }\n\n}\n```\n\nand trying to parse the following JSON:\n\n``` json\n{\n    \"appVersion\": \"0.9\",\n    \"releaseType\": \"nightly\",\n    \"dev\": false,\n    \"os\": \"multiplatform\",\n    \"updateURL\": \"http://sourceforge.net/projects/e-adventure/files/ead2-nightly/update.json/download\"\n}\n```\n\nlike this:\n\n``` java\nReleaseInfo releaseInfo = fromJson(ReleaseInfo.class, releaseFH);\n```\n\nthrows the following Serialization exceptions while trying to read the values of the Enums (\"releaseType\" and \"os\") in the file:\n\n``` java\ncom.badlogic.gdx.utils.SerializationException: Unable to convert value to required type: releaseType: nightly (es.eucm.ead.editor.control.appdata.ReleaseInfo$ReleaseType)\nSerialization trace:\nreleaseType (es.eucm.ead.editor.control.appdata.ReleaseInfo)\n    at com.badlogic.gdx.utils.Json.readValue(Json.java:953)\n    at com.badlogic.gdx.utils.Json.readFields(Json.java:752)\n    at es.eucm.ead.engine.assets.Assets.readFields(Assets.java:230)\n    at com.badlogic.gdx.utils.Json.readValue(Json.java:874)\n    at com.badlogic.gdx.utils.Json.fromJson(Json.java:658)\n    at es.eucm.ead.editor.assets.ApplicationAssets.loadReleaseInfo(ApplicationAssets.java:201)\n    at es.eucm.ead.editor.control.ReleaseInfoTest.testValidReleaseInfo(ReleaseInfoTest.java:65)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:606)\n    at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)\n    at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)\n    at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)\n    at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)\n    at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)\n    at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)\n    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)\n    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)\n    at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)\n    at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)\n    at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)\n    at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)\n    at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)\n    at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)\n    at org.junit.runners.ParentRunner.run(ParentRunner.java:236)\n    at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:50)\n    at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)\n    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:459)\n    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:675)\n    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:382)\n    at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:192)\n```\n\nwhich is excepted since the new JSON implementation uses Enum#name() instead of Enum#toString().\nIf we change \n\n``` json\n     // note how this is #toString() \n    \"releaseType\": \"nightly\",\n```\n\nfor the ReleaseType#name() as following:\n\n``` json\n    // note how this is #name()\n    \"releaseType\": \"NIGHTLY\",\n```\n\nthe parsing is done correctly.\n#### Possible solution?\n\nSince we have a ton of files parsed as the one shown above, my question is if it's possible to allow the user to choose between the usage of Enum#name() or Enum#toString() depending on a boolean flag inside Json.java class. This solution would also add some flexilibity to the class since the users could decide what values to use when working with .json files.\n\nBtw we're using the leatest nightlies because in the previous versions the JsonReader.java didn't work correctly with comments and we needed some of the features added after the 1.0.0 stable release.\n\nThankyou for you time.\n","closed_by":{"login":"NathanSweet","id":434010,"node_id":"MDQ6VXNlcjQzNDAxMA==","avatar_url":"https://avatars.githubusercontent.com/u/434010?v=4","gravatar_id":"","url":"https://api.github.com/users/NathanSweet","html_url":"https://github.com/NathanSweet","followers_url":"https://api.github.com/users/NathanSweet/followers","following_url":"https://api.github.com/users/NathanSweet/following{/other_user}","gists_url":"https://api.github.com/users/NathanSweet/gists{/gist_id}","starred_url":"https://api.github.com/users/NathanSweet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NathanSweet/subscriptions","organizations_url":"https://api.github.com/users/NathanSweet/orgs","repos_url":"https://api.github.com/users/NathanSweet/repos","events_url":"https://api.github.com/users/NathanSweet/events{/privacy}","received_events_url":"https://api.github.com/users/NathanSweet/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/libgdx/libgdx/issues/2448/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/libgdx/libgdx/issues/2448/timeline","performed_via_github_app":null,"state_reason":"completed"}