{"url":"https://api.github.com/repos/libgdx/libgdx/issues/6561","repository_url":"https://api.github.com/repos/libgdx/libgdx","labels_url":"https://api.github.com/repos/libgdx/libgdx/issues/6561/labels{/name}","comments_url":"https://api.github.com/repos/libgdx/libgdx/issues/6561/comments","events_url":"https://api.github.com/repos/libgdx/libgdx/issues/6561/events","html_url":"https://github.com/libgdx/libgdx/issues/6561","id":919588244,"node_id":"MDU6SXNzdWU5MTk1ODgyNDQ=","number":6561,"title":"Pool.clear() doesn't clear all elements from the internal Array<T> freeObjects","user":{"login":"tscissors","id":32910342,"node_id":"MDQ6VXNlcjMyOTEwMzQy","avatar_url":"https://avatars.githubusercontent.com/u/32910342?v=4","gravatar_id":"","url":"https://api.github.com/users/tscissors","html_url":"https://github.com/tscissors","followers_url":"https://api.github.com/users/tscissors/followers","following_url":"https://api.github.com/users/tscissors/following{/other_user}","gists_url":"https://api.github.com/users/tscissors/gists{/gist_id}","starred_url":"https://api.github.com/users/tscissors/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tscissors/subscriptions","organizations_url":"https://api.github.com/users/tscissors/orgs","repos_url":"https://api.github.com/users/tscissors/repos","events_url":"https://api.github.com/users/tscissors/events{/privacy}","received_events_url":"https://api.github.com/users/tscissors/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-06-12T15:22:22Z","updated_at":"2021-06-12T19:01:31Z","closed_at":"2021-06-12T19:01:31Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### Issue details\r\n`Pool.clear()` doesn't clear all elements from the internal `Array<T> freeObjects`. \r\nThe size of the array is reduced inside the loop every time when freeObjects.pop() is called, which means that `freeObjects.size` will return a smaller value and `i < freeObjects.size` condition will not allow to remove all elements.\r\n\r\nThe issue leads to a very unpleasant bugs, for example if you have a pool with objects storing reference to box2d bodies.\r\nI believe it may lead to other serious bugs because Pool is used in many parts of LibGDX itself.\r\n\r\nThis part of the Pool.java code is broken:\r\n```\r\n\tpublic void clear () {\r\n\t\tfor (int i = 0; i < freeObjects.size; i++) {\r\n\t\t\tT obj = freeObjects.pop();\r\n\t\t\tdiscard(obj);\r\n\t\t}\r\n\t}\r\n```\r\n\r\nThe solution could be:\r\n```\r\n\tpublic void clear () {\r\n\t\twhile (freeObjects.size > 0) {\r\n\t\t\tT obj = freeObjects.pop();\r\n\t\t\tdiscard(obj);\r\n\t\t}\r\n        }\r\n```\r\n\r\n#### Reproduction steps\r\n1, Create `Pool` object with any objects inside.\r\n2. Call `.obtain()` method of the pool multiple times (5+) to get enough objects\r\n3. Free all obtained objects by calling `free(T object)` method of the pool (probably same will happen for `freeAll (Array<T> objects) `)\r\n4. Call `.clear()` method of the pool once\r\n5. Check the size of the internal `freeObjects` array by calling `getFree()` method of the pool\r\n\r\nExpected result: 0 elements remain in the internal array\r\nActual results: ~half of elements remains in the internal array\r\n\r\n#### Version of LibGDX\r\nLibGDX 1.10.0\r\n\r\nRelated to this [commit](https://github.com/libgdx/libgdx/commit/049174598204936eab55375079944983c39530e1#diff-2b502e40add95b689c7f66b2f0a0fa97d4b1d1961881443a6e4a7d470a2c6208R115)\r\n\r\n#### Affected platforms\r\n- [x] Android\r\n- [x] iOS\r\n- [x] HTML/GWT\r\n- [x] Windows\r\n- [x] Linux\r\n- [x] MacOS\r\n","closed_by":{"login":"NathanSweet","id":434010,"node_id":"MDQ6VXNlcjQzNDAxMA==","avatar_url":"https://avatars.githubusercontent.com/u/434010?v=4","gravatar_id":"","url":"https://api.github.com/users/NathanSweet","html_url":"https://github.com/NathanSweet","followers_url":"https://api.github.com/users/NathanSweet/followers","following_url":"https://api.github.com/users/NathanSweet/following{/other_user}","gists_url":"https://api.github.com/users/NathanSweet/gists{/gist_id}","starred_url":"https://api.github.com/users/NathanSweet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NathanSweet/subscriptions","organizations_url":"https://api.github.com/users/NathanSweet/orgs","repos_url":"https://api.github.com/users/NathanSweet/repos","events_url":"https://api.github.com/users/NathanSweet/events{/privacy}","received_events_url":"https://api.github.com/users/NathanSweet/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/libgdx/libgdx/issues/6561/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/libgdx/libgdx/issues/6561/timeline","performed_via_github_app":null,"state_reason":"completed"}