{"url":"https://api.github.com/repos/libgdx/libgdx/issues/3661","repository_url":"https://api.github.com/repos/libgdx/libgdx","labels_url":"https://api.github.com/repos/libgdx/libgdx/issues/3661/labels{/name}","comments_url":"https://api.github.com/repos/libgdx/libgdx/issues/3661/comments","events_url":"https://api.github.com/repos/libgdx/libgdx/issues/3661/events","html_url":"https://github.com/libgdx/libgdx/issues/3661","id":123554179,"node_id":"MDU6SXNzdWUxMjM1NTQxNzk=","number":3661,"title":"GWT/html5 build - dangling entries in the joint list of a box2d world","user":{"login":"Snack-a-Dog","id":16405806,"node_id":"MDQ6VXNlcjE2NDA1ODA2","avatar_url":"https://avatars.githubusercontent.com/u/16405806?v=4","gravatar_id":"","url":"https://api.github.com/users/Snack-a-Dog","html_url":"https://github.com/Snack-a-Dog","followers_url":"https://api.github.com/users/Snack-a-Dog/followers","following_url":"https://api.github.com/users/Snack-a-Dog/following{/other_user}","gists_url":"https://api.github.com/users/Snack-a-Dog/gists{/gist_id}","starred_url":"https://api.github.com/users/Snack-a-Dog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Snack-a-Dog/subscriptions","organizations_url":"https://api.github.com/users/Snack-a-Dog/orgs","repos_url":"https://api.github.com/users/Snack-a-Dog/repos","events_url":"https://api.github.com/users/Snack-a-Dog/events{/privacy}","received_events_url":"https://api.github.com/users/Snack-a-Dog/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-12-22T20:53:11Z","updated_at":"2017-01-16T14:55:17Z","closed_at":"2015-12-23T15:23:50Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"In the html5 build, the internal joints list of the World class contains dangling entries after a body with multiple attached joints was destroyed. The method `World.getJointCount()` returns a different value than the size of the list returned by `World.getJoints()`. The list still contains joints that should have been destroyed together with the body that they were attached to.\n\nExample code (please paste as an ApplicationListener into a libGDX project):\n\n``` java\npublic class PhysicsDebug extends ApplicationAdapter {\n\n    private World world;\n\n    @Override\n    public void create () {\n        world = new World(new Vector2(0, 0),  true);\n\n        Body bodyA = createBody();\n        Body bodyB = createBody();\n        createDistanceJointBetweenBodies(bodyA, bodyB);\n        createDistanceJointBetweenBodies(bodyA, bodyB);\n\n        Gdx.app.setLogLevel(Application.LOG_DEBUG);\n\n        Gdx.app.log(\"debug\", \"Created the bodies and the joints\");\n        Gdx.app.log(\"debug\", \"world.getJointCount() -> \" + world.getJointCount() \n                           + \", world.getJoints().size -> \" + getJointsListSize());\n\n        world.destroyBody(bodyA);\n        Gdx.app.log(\"debug\", \"Destroyed the body A\");\n        Gdx.app.log(\"debug\", \"world.getJointCount() -> \" + world.getJointCount() \n                           + \", world.getJoints().size -> \" + getJointsListSize());\n\n        world.destroyBody(bodyB);\n        Gdx.app.log(\"debug\", \"Destroyed the body B\");\n        Gdx.app.log(\"debug\", \"world.getJointCount() -> \" + world.getJointCount() \n                           + \", world.getJoints().size -> \" + getJointsListSize());\n\n    }\n\n    private Body createBody() {\n        BodyDef bodyDef = new BodyDef();\n        return world.createBody(bodyDef);\n    }\n\n    private void createDistanceJointBetweenBodies(Body bodyA, Body bodyB) {\n        DistanceJointDef jointDefA = new DistanceJointDef();\n        jointDefA.bodyA = bodyA;\n        jointDefA.bodyB = bodyB;\n        world.createJoint(jointDefA);\n    }\n\n    private int getJointsListSize() {\n        Array<Joint> joints = new Array<Joint>();\n        world.getJoints(joints);\n        return joints.size;\n    }\n}\n```\n\nOn desktop, the joints list is empty after destroying one of the bodies, which is the expected behaviour. The application log output:\n\n```\ndebug: Created the bodies and the joints\ndebug: world.getJointCount() -> 2, world.getJoints().size -> 2\ndebug: Destroyed the body A\ndebug: world.getJointCount() -> 0, world.getJoints().size -> 0\ndebug: Destroyed the body B\ndebug: world.getJointCount() -> 0, world.getJoints().size -> 0\n```\n\nIn the html5 client, however, the list still contains one joint, even though the `World.getJointCount()` method returns zero. The application log output:\n\n```\ndebug: Created the bodies and the joints\ndebug: world.getJointCount() -> 2, world.getJoints().size -> 2\ndebug: Destroyed the body A\ndebug: world.getJointCount() -> 0, world.getJoints().size -> 1\ndebug: Destroyed the body B\ndebug: world.getJointCount() -> 0, world.getJoints().size -> 1\n```\n\nThe problem only occurs when a body with at least two attached joints is destroyed.\n\nI found the similar issue #1913, where a single joint wasn't properly destroyed together with its parent body in GWT. However, that was with only one joint and that issue was closed in May 2014, so this seems to be a different problem\n\nTested with libGDX 1.7.2 in Chrome 45.0.2454.85 (64-bit) on Linux.\n","closed_by":{"login":"MobiDevelop","id":1095464,"node_id":"MDQ6VXNlcjEwOTU0NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1095464?v=4","gravatar_id":"","url":"https://api.github.com/users/MobiDevelop","html_url":"https://github.com/MobiDevelop","followers_url":"https://api.github.com/users/MobiDevelop/followers","following_url":"https://api.github.com/users/MobiDevelop/following{/other_user}","gists_url":"https://api.github.com/users/MobiDevelop/gists{/gist_id}","starred_url":"https://api.github.com/users/MobiDevelop/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MobiDevelop/subscriptions","organizations_url":"https://api.github.com/users/MobiDevelop/orgs","repos_url":"https://api.github.com/users/MobiDevelop/repos","events_url":"https://api.github.com/users/MobiDevelop/events{/privacy}","received_events_url":"https://api.github.com/users/MobiDevelop/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/libgdx/libgdx/issues/3661/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/libgdx/libgdx/issues/3661/timeline","performed_via_github_app":null,"state_reason":"completed"}