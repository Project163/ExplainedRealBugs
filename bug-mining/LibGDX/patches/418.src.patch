diff --git a/backends/gdx-backend-moe/src/com/badlogic/gdx/backends/iosmoe/IOSGraphics.java b/backends/gdx-backend-moe/src/com/badlogic/gdx/backends/iosmoe/IOSGraphics.java
index a3938b859..722aa6d70 100755
--- a/backends/gdx-backend-moe/src/com/badlogic/gdx/backends/iosmoe/IOSGraphics.java
+++ b/backends/gdx-backend-moe/src/com/badlogic/gdx/backends/iosmoe/IOSGraphics.java
@@ -20,6 +20,7 @@ import com.badlogic.gdx.Application;
 import com.badlogic.gdx.Gdx;
 import com.badlogic.gdx.Graphics;
 import com.badlogic.gdx.LifecycleListener;
+import com.badlogic.gdx.backends.iosmoe.custom.HWMachine;
 import com.badlogic.gdx.backends.iosrobovm.IOSGLES20;
 import com.badlogic.gdx.backends.iosrobovm.IOSGLES30;
 import com.badlogic.gdx.graphics.Cursor;
@@ -160,10 +161,10 @@ public class IOSGraphics extends NSObject implements Graphics, GLKViewDelegate,
 		}
 		bufferFormat = new BufferFormat(r, g, b, a, depth, stencil, samples, false);
 
-		// String machineString = HWMachine.getMachineString();
-		IOSDevice device = null; // IOSDevice.getDevice(machineString);
-		// if (device == null)
-		// 	app.error(tag, "Machine ID: " + machineString + " not found, please report to LibGDX");
+		String machineString = HWMachine.getMachineString();
+		IOSDevice device = IOSDevice.getDevice(machineString);
+		 if (device == null)
+		 	app.error(tag, "Machine ID: " + machineString + " not found, please report to LibGDX");
 		int ppi = device != null ? device.ppi : 163;
 		density = device != null ? device.ppi / 160f : scale;
 		ppiX = ppi;
diff --git a/backends/gdx-backend-moe/src/com/badlogic/gdx/backends/iosmoe/custom/HWMachine.java b/backends/gdx-backend-moe/src/com/badlogic/gdx/backends/iosmoe/custom/HWMachine.java
index ebe9b1e41..d1a3188f2 100755
--- a/backends/gdx-backend-moe/src/com/badlogic/gdx/backends/iosmoe/custom/HWMachine.java
+++ b/backends/gdx-backend-moe/src/com/badlogic/gdx/backends/iosmoe/custom/HWMachine.java
@@ -18,12 +18,14 @@ package com.badlogic.gdx.backends.iosmoe.custom;
 
 import com.badlogic.gdx.utils.BufferUtils;
 import org.moe.natj.c.CRuntime;
+import org.moe.natj.c.StructObject;
 import org.moe.natj.c.ann.CFunction;
 import org.moe.natj.general.NatJ;
 import org.moe.natj.general.ann.Runtime;
 import org.moe.natj.general.ann.UncertainArgument;
 import org.moe.natj.general.ptr.BytePtr;
 import org.moe.natj.general.ptr.IntPtr;
+import org.moe.natj.general.ptr.NUIntPtr;
 import org.moe.natj.general.ptr.impl.PtrFactory;
 import org.moe.natj.general.ptr.VoidPtr;
 
@@ -34,15 +36,18 @@ public class HWMachine {
 	}
 
 	@CFunction
-	public static native int sysctlbyname(@UncertainArgument("Options: java.string, c.const-byte-ptr Fallback: java.string") String name,
-		VoidPtr oldp, IntPtr oldlenp, VoidPtr newp, int newlen);
+	public static native int sysctlbyname(BytePtr name, VoidPtr oldp,
+			NUIntPtr oldlenp, VoidPtr newp, long newlen);
 
 	public static String getMachineString () {
 		String name = "hw.machine";
-		IntPtr sizePtr = PtrFactory.newIntPtr(BufferUtils.newIntBuffer(1));
-		sysctlbyname(name, null, sizePtr, null, 0);
-		BytePtr machine = PtrFactory.newBytePtr(sizePtr.get(), true, true);
-		sysctlbyname(name, machine, sizePtr, null, 0);
-		return machine.toUTF8String();
+		BytePtr namePtr = PtrFactory.newByteArray(name.getBytes());
+		NUIntPtr sizePtr = PtrFactory.newNUIntReference();
+		sysctlbyname(namePtr, null, sizePtr, null, 0);
+		long longsize = sizePtr.get();
+		BytePtr machinePtr = PtrFactory.newByteReference();
+		machinePtr.setValue((byte) longsize);
+		sysctlbyname(namePtr, machinePtr, sizePtr, null, 0);
+		return machinePtr.toUTF8String();
 	}
 }
