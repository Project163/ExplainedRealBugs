{"url":"https://api.github.com/repos/paramiko/paramiko/issues/399","repository_url":"https://api.github.com/repos/paramiko/paramiko","labels_url":"https://api.github.com/repos/paramiko/paramiko/issues/399/labels{/name}","comments_url":"https://api.github.com/repos/paramiko/paramiko/issues/399/comments","events_url":"https://api.github.com/repos/paramiko/paramiko/issues/399/events","html_url":"https://github.com/paramiko/paramiko/issues/399","id":43355071,"node_id":"MDU6SXNzdWU0MzM1NTA3MQ==","number":399,"title":"Commands using agent forwarding hang","user":{"login":"dylanahsmith","id":954402,"node_id":"MDQ6VXNlcjk1NDQwMg==","avatar_url":"https://avatars.githubusercontent.com/u/954402?v=4","gravatar_id":"","url":"https://api.github.com/users/dylanahsmith","html_url":"https://github.com/dylanahsmith","followers_url":"https://api.github.com/users/dylanahsmith/followers","following_url":"https://api.github.com/users/dylanahsmith/following{/other_user}","gists_url":"https://api.github.com/users/dylanahsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/dylanahsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dylanahsmith/subscriptions","organizations_url":"https://api.github.com/users/dylanahsmith/orgs","repos_url":"https://api.github.com/users/dylanahsmith/repos","events_url":"https://api.github.com/users/dylanahsmith/events{/privacy}","received_events_url":"https://api.github.com/users/dylanahsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2014-09-22T02:32:02Z","updated_at":"2014-09-22T15:39:46Z","closed_at":"2014-09-22T15:39:46Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Version 1.15.0 introduced a regression with ssh agent forwarding which causes commands to hang when they use the forwarded agent.  This bug wasn't present in version 1.14.1\n\nWe were experiencing this problem with fabric, which can be reproduced with the following script executed with `fab -H $HOST test`\n\n``` python\nfrom fabric.api import run, env\nenv.forward_agent = True\ndef test():\n    run('ssh-add -L')\n```\n\nFabric is using `paramiko.agent.AgentRequestHandler(channel)` to enable ssh agent forwarding, and I managed to reproduce the regression using paramiko directly:\n\n``` python\nimport sys\nimport paramiko\n\nhost = sys.argv[1]\nclient = paramiko.SSHClient()\nclient.load_system_host_keys()\nclient.connect(host)\nchannel = client.get_transport().open_session()\nforward = paramiko.agent.AgentRequestHandler(channel)\nchannel.exec_command('ssh-add -L')\nstdout = channel.makefile('r')\nstderr = channel.makefile_stderr('r')\nfor line in stdout:\n    sys.stdout.write(line)\nfor line in stderr:\n    sys.stderr.write(line)\nchannel.close()\nforward.close()\nclient.close()\n```\n","closed_by":{"login":"bitprophet","id":6088,"node_id":"MDQ6VXNlcjYwODg=","avatar_url":"https://avatars.githubusercontent.com/u/6088?v=4","gravatar_id":"","url":"https://api.github.com/users/bitprophet","html_url":"https://github.com/bitprophet","followers_url":"https://api.github.com/users/bitprophet/followers","following_url":"https://api.github.com/users/bitprophet/following{/other_user}","gists_url":"https://api.github.com/users/bitprophet/gists{/gist_id}","starred_url":"https://api.github.com/users/bitprophet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bitprophet/subscriptions","organizations_url":"https://api.github.com/users/bitprophet/orgs","repos_url":"https://api.github.com/users/bitprophet/repos","events_url":"https://api.github.com/users/bitprophet/events{/privacy}","received_events_url":"https://api.github.com/users/bitprophet/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/paramiko/paramiko/issues/399/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/paramiko/paramiko/issues/399/timeline","performed_via_github_app":null,"state_reason":"completed"}