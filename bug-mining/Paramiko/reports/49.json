{"url":"https://api.github.com/repos/paramiko/paramiko/issues/44","repository_url":"https://api.github.com/repos/paramiko/paramiko","labels_url":"https://api.github.com/repos/paramiko/paramiko/issues/44/labels{/name}","comments_url":"https://api.github.com/repos/paramiko/paramiko/issues/44/comments","events_url":"https://api.github.com/repos/paramiko/paramiko/issues/44/events","html_url":"https://github.com/paramiko/paramiko/issues/44","id":1786423,"node_id":"MDU6SXNzdWUxNzg2NDIz","number":44,"title":"channels don't work unless a reference to SSHClient is explicitly kept","user":{"login":"w31rd0","id":157719,"node_id":"MDQ6VXNlcjE1NzcxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/157719?v=4","gravatar_id":"","url":"https://api.github.com/users/w31rd0","html_url":"https://github.com/w31rd0","followers_url":"https://api.github.com/users/w31rd0/followers","following_url":"https://api.github.com/users/w31rd0/following{/other_user}","gists_url":"https://api.github.com/users/w31rd0/gists{/gist_id}","starred_url":"https://api.github.com/users/w31rd0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/w31rd0/subscriptions","organizations_url":"https://api.github.com/users/w31rd0/orgs","repos_url":"https://api.github.com/users/w31rd0/repos","events_url":"https://api.github.com/users/w31rd0/events{/privacy}","received_events_url":"https://api.github.com/users/w31rd0/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2011-09-30T15:01:30Z","updated_at":"2017-02-20T22:42:03Z","closed_at":"2017-02-20T22:42:03Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Using an instance of Channel received from somewhere without a reference to SSHClient being explicitly kept (to prevent it from being garbage collected) sometimes gives unexpected results. For instance, a call to exec_command() raises an exception about the channel being closed, while recv_exit_status() just returns -1.\n\nHere's a synthetic test case.\n\n``` python\nimport paramiko\n\ndef exec_remote_command(command, host, username=None, password=None):\n    channel = _exec_remote_command(command, host, username=username, password=password)\n    return channel.recv_exit_status()\n\ndef _exec_remote_command(command, host, username=None, password=None):\n    client = paramiko.SSHClient()\n    client.set_missing_host_key_policy(paramiko.MissingHostKeyPolicy())\n    client.connect(host, username=username, password=password)\n    channel = client.get_transport().open_session()\n    channel.exec_command(command)\n    return channel\n\nif __name__ == '__main__':\n    print exec_remote_command('ls', '127.0.0.1') # prints -1\n```\n","closed_by":{"login":"bitprophet","id":6088,"node_id":"MDQ6VXNlcjYwODg=","avatar_url":"https://avatars.githubusercontent.com/u/6088?v=4","gravatar_id":"","url":"https://api.github.com/users/bitprophet","html_url":"https://github.com/bitprophet","followers_url":"https://api.github.com/users/bitprophet/followers","following_url":"https://api.github.com/users/bitprophet/following{/other_user}","gists_url":"https://api.github.com/users/bitprophet/gists{/gist_id}","starred_url":"https://api.github.com/users/bitprophet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bitprophet/subscriptions","organizations_url":"https://api.github.com/users/bitprophet/orgs","repos_url":"https://api.github.com/users/bitprophet/repos","events_url":"https://api.github.com/users/bitprophet/events{/privacy}","received_events_url":"https://api.github.com/users/bitprophet/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/paramiko/paramiko/issues/44/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/paramiko/paramiko/issues/44/timeline","performed_via_github_app":null,"state_reason":"completed"}