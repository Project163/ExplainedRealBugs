{"url":"https://api.github.com/repos/paramiko/paramiko/issues/2009","repository_url":"https://api.github.com/repos/paramiko/paramiko","labels_url":"https://api.github.com/repos/paramiko/paramiko/issues/2009/labels{/name}","comments_url":"https://api.github.com/repos/paramiko/paramiko/issues/2009/comments","events_url":"https://api.github.com/repos/paramiko/paramiko/issues/2009/events","html_url":"https://github.com/paramiko/paramiko/issues/2009","id":1173726680,"node_id":"I_kwDOAAHTOc5F9aXY","number":2009,"title":"open_sftp() can block up to an hour","user":{"login":"ilija-lazoroski","id":15820737,"node_id":"MDQ6VXNlcjE1ODIwNzM3","avatar_url":"https://avatars.githubusercontent.com/u/15820737?v=4","gravatar_id":"","url":"https://api.github.com/users/ilija-lazoroski","html_url":"https://github.com/ilija-lazoroski","followers_url":"https://api.github.com/users/ilija-lazoroski/followers","following_url":"https://api.github.com/users/ilija-lazoroski/following{/other_user}","gists_url":"https://api.github.com/users/ilija-lazoroski/gists{/gist_id}","starred_url":"https://api.github.com/users/ilija-lazoroski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilija-lazoroski/subscriptions","organizations_url":"https://api.github.com/users/ilija-lazoroski/orgs","repos_url":"https://api.github.com/users/ilija-lazoroski/repos","events_url":"https://api.github.com/users/ilija-lazoroski/events{/privacy}","received_events_url":"https://api.github.com/users/ilija-lazoroski/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/paramiko/paramiko/milestones/25","html_url":"https://github.com/paramiko/paramiko/milestone/25","labels_url":"https://api.github.com/repos/paramiko/paramiko/milestones/25/labels","id":4431821,"node_id":"MDk6TWlsZXN0b25lNDQzMTgyMQ==","number":25,"title":"Next feature release","description":"","creator":{"login":"bitprophet","id":6088,"node_id":"MDQ6VXNlcjYwODg=","avatar_url":"https://avatars.githubusercontent.com/u/6088?v=4","gravatar_id":"","url":"https://api.github.com/users/bitprophet","html_url":"https://github.com/bitprophet","followers_url":"https://api.github.com/users/bitprophet/followers","following_url":"https://api.github.com/users/bitprophet/following{/other_user}","gists_url":"https://api.github.com/users/bitprophet/gists{/gist_id}","starred_url":"https://api.github.com/users/bitprophet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bitprophet/subscriptions","organizations_url":"https://api.github.com/users/bitprophet/orgs","repos_url":"https://api.github.com/users/bitprophet/repos","events_url":"https://api.github.com/users/bitprophet/events{/privacy}","received_events_url":"https://api.github.com/users/bitprophet/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":9,"closed_issues":7,"state":"open","created_at":"2019-06-22T00:46:08Z","updated_at":"2023-05-12T17:46:22Z","due_on":null,"closed_at":null},"comments":1,"created_at":"2022-03-18T15:35:10Z","updated_at":"2023-03-10T19:07:59Z","closed_at":"2023-03-10T19:07:58Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hey all, I want to report a bug that @VakarisZ and me found.\r\n\r\nIt comes from `open_sftp` function on SSHClient which can block up to an hour, if a machine is killed after connecting\r\n\r\nTo reproduce it just connect to a VM machine, set breakpoint before calling `open_sftp`, pause the VM machine and run the `open_sftp`. It will wait up to an hour until it timeouts. I have waited 14 minutes and then unpaused the VM which unblocked the `open_sftp` function.\r\n\r\nWhat I purpose for a solution is that we add timeout argument to `open_sftp`.\r\n\r\nHere is a snippet code I used to reproduce the block:\r\n\r\n```import paramiko\r\nimport datetime\r\nimport pdb\r\n\r\nssh = paramiko.SSHClient()\r\nssh.set_missing_host_key_policy(paramiko.WarningPolicy)\r\n\r\nssh.connect(\"x.x.x.x\", port=22, username=username, password=password, timeout=10,\r\n            auth_timeout=10, banner_timeout=5)\r\n\r\nprint(datetime.datetime.now())\r\n\r\npdb.set_trace()\r\n\r\nwith ssh.open_sftp() as ftp:\r\n    print(datetime.datetime.now())\r\n\r\n\r\nprint(datetime.datetime.now())\r\n```\r\n\r\n","closed_by":{"login":"bitprophet","id":6088,"node_id":"MDQ6VXNlcjYwODg=","avatar_url":"https://avatars.githubusercontent.com/u/6088?v=4","gravatar_id":"","url":"https://api.github.com/users/bitprophet","html_url":"https://github.com/bitprophet","followers_url":"https://api.github.com/users/bitprophet/followers","following_url":"https://api.github.com/users/bitprophet/following{/other_user}","gists_url":"https://api.github.com/users/bitprophet/gists{/gist_id}","starred_url":"https://api.github.com/users/bitprophet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bitprophet/subscriptions","organizations_url":"https://api.github.com/users/bitprophet/orgs","repos_url":"https://api.github.com/users/bitprophet/repos","events_url":"https://api.github.com/users/bitprophet/events{/privacy}","received_events_url":"https://api.github.com/users/bitprophet/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/paramiko/paramiko/issues/2009/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/paramiko/paramiko/issues/2009/timeline","performed_via_github_app":null,"state_reason":"completed"}