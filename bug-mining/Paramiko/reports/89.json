{"url":"https://api.github.com/repos/paramiko/paramiko/issues/2017","repository_url":"https://api.github.com/repos/paramiko/paramiko","labels_url":"https://api.github.com/repos/paramiko/paramiko/issues/2017/labels{/name}","comments_url":"https://api.github.com/repos/paramiko/paramiko/issues/2017/comments","events_url":"https://api.github.com/repos/paramiko/paramiko/issues/2017/events","html_url":"https://github.com/paramiko/paramiko/issues/2017","id":1183735618,"node_id":"I_kwDOAAHTOc5Gjl9C","number":2017,"title":"SHA2 support broke SHA1 support when server is OpenSSH <7.8","user":{"login":"adarsh-chauhan","id":32217731,"node_id":"MDQ6VXNlcjMyMjE3NzMx","avatar_url":"https://avatars.githubusercontent.com/u/32217731?v=4","gravatar_id":"","url":"https://api.github.com/users/adarsh-chauhan","html_url":"https://github.com/adarsh-chauhan","followers_url":"https://api.github.com/users/adarsh-chauhan/followers","following_url":"https://api.github.com/users/adarsh-chauhan/following{/other_user}","gists_url":"https://api.github.com/users/adarsh-chauhan/gists{/gist_id}","starred_url":"https://api.github.com/users/adarsh-chauhan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adarsh-chauhan/subscriptions","organizations_url":"https://api.github.com/users/adarsh-chauhan/orgs","repos_url":"https://api.github.com/users/adarsh-chauhan/repos","events_url":"https://api.github.com/users/adarsh-chauhan/events{/privacy}","received_events_url":"https://api.github.com/users/adarsh-chauhan/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":19,"created_at":"2022-03-28T17:09:27Z","updated_at":"2022-05-17T00:52:29Z","closed_at":"2022-05-17T00:52:29Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### simply running nornir with following command\r\n\r\n```\r\ndevdsk.run(task=netmiko_file_transfer, source_file='./test_sbc_cert_file.pem', dest_file='/tmp/test_sbc_cert_file.pem')\r\n```\r\n\r\n```\r\nName: netmiko\r\nVersion: 4.0.0\r\nSummary: Multi-vendor library to simplify legacy CLI connections to network devices\r\nHome-page: https://github.com/ktbyers/netmiko\r\nAuthor: Kirk Byers\r\nAuthor-email: ktbyers@twb-tech.com\r\nLicense: MIT\r\nLocation: /Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages\r\nRequires: paramiko, ntc-templates, pyserial, tenacity, scp, textfsm, setuptools\r\nRequired-by: nornir-netmiko\r\n```\r\n\r\n```\r\nName: nornir\r\nVersion: 3.2.0\r\nSummary: Pluggable multi-threaded framework with inventory management to help operate collections of devices\r\nHome-page: https://github.com/nornir-automation/nornir\r\nAuthor: David Barroso\r\nAuthor-email: dbarrosop@dravetech.com\r\nLicense: Apache 2.0\r\nLocation: /Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages\r\nRequires: mypy_extensions, ruamel.yaml, typing_extensions\r\nRequired-by: nornir-utils\r\n```\r\n\r\n### Pramiko 2.10.3 Does not work with cert authentication\r\n\r\n```\r\nName: paramiko\r\nVersion: 2.10.3\r\nSummary: SSH2 protocol library\r\nHome-page: https://paramiko.org\r\nAuthor: Jeff Forcier\r\nAuthor-email: jeff@bitprophet.org\r\nLicense: LGPL\r\nLocation: /Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages\r\nRequires: bcrypt, cryptography, six, pynacl\r\nRequired-by: scp, netmiko\r\n```\r\n\r\n```\r\nINFO:nornir.core:Running task 'netmiko_file_transfer' with args {'source_file': './test_sbc_cert_file.pem', 'dest_file': '/tmp/test_sbc_cert_file.pem'} on 1 hosts\r\nDEBUG:nornir.core.task:Host 'devdsk': running task 'netmiko_file_transfer'\r\nDEBUG:paramiko.transport:starting thread (client mode): 0xc9bdc60\r\nDEBUG:paramiko.transport:Local version/idstring: SSH-2.0-paramiko_2.10.3\r\nDEBUG:paramiko.transport:Remote version/idstring: SSH-2.0-OpenSSH_7.4\r\nINFO:paramiko.transport:Connected (version 2.0, client OpenSSH_7.4)\r\nDEBUG:paramiko.transport:=== Key exchange possibilities ===\r\nDEBUG:paramiko.transport:kex algos: curve25519-sha256, curve25519-sha256@libssh.org, ecdh-sha2-nistp256, ecdh-sha2-nistp384, ecdh-sha2-nistp521, diffie-hellman-group-exchange-sha256, diffie-hellman-group16-sha512, diffie-hellman-group18-sha512, diffie-hellman-group-exchange-sha1, diffie-hellman-group14-sha256, diffie-hellman-group14-sha1, diffie-hellman-group1-sha1\r\nDEBUG:paramiko.transport:server key: ssh-rsa, rsa-sha2-512, rsa-sha2-256, ecdsa-sha2-nistp256, ssh-ed25519\r\nDEBUG:paramiko.transport:client encrypt: chacha20-poly1305@openssh.com, aes128-ctr, aes192-ctr, aes256-ctr, aes128-gcm@openssh.com, aes256-gcm@openssh.com, aes128-cbc, aes192-cbc, aes256-cbc, blowfish-cbc, cast128-cbc, 3des-cbc\r\nDEBUG:paramiko.transport:server encrypt: chacha20-poly1305@openssh.com, aes128-ctr, aes192-ctr, aes256-ctr, aes128-gcm@openssh.com, aes256-gcm@openssh.com, aes128-cbc, aes192-cbc, aes256-cbc, blowfish-cbc, cast128-cbc, 3des-cbc\r\nDEBUG:paramiko.transport:client mac: umac-64-etm@openssh.com, umac-128-etm@openssh.com, hmac-sha2-256-etm@openssh.com, hmac-sha2-512-etm@openssh.com, hmac-sha1-etm@openssh.com, umac-64@openssh.com, umac-128@openssh.com, hmac-sha2-256, hmac-sha2-512, hmac-sha1\r\nDEBUG:paramiko.transport:server mac: umac-64-etm@openssh.com, umac-128-etm@openssh.com, hmac-sha2-256-etm@openssh.com, hmac-sha2-512-etm@openssh.com, hmac-sha1-etm@openssh.com, umac-64@openssh.com, umac-128@openssh.com, hmac-sha2-256, hmac-sha2-512, hmac-sha1\r\nDEBUG:paramiko.transport:client compress: none, zlib@openssh.com\r\nDEBUG:paramiko.transport:server compress: none, zlib@openssh.com\r\nDEBUG:paramiko.transport:client lang: <none>\r\nDEBUG:paramiko.transport:server lang: <none>\r\nDEBUG:paramiko.transport:kex follows: False\r\nDEBUG:paramiko.transport:=== Key exchange agreements ===\r\nDEBUG:paramiko.transport:Kex: curve25519-sha256@libssh.org\r\nDEBUG:paramiko.transport:HostKey: ssh-ed25519\r\nDEBUG:paramiko.transport:Cipher: aes128-ctr\r\nDEBUG:paramiko.transport:MAC: hmac-sha2-256\r\nDEBUG:paramiko.transport:Compression: none\r\nDEBUG:paramiko.transport:=== End of kex handshake ===\r\nDEBUG:paramiko.transport:kex engine KexCurve25519 specified hash_algo <built-in function openssl_sha256>\r\nDEBUG:paramiko.transport:Switch to new keys ...\r\nDEBUG:paramiko.transport:Got EXT_INFO: {'server-sig-algs': b'rsa-sha2-256,rsa-sha2-512'}\r\nDEBUG:paramiko.transport:Adding ssh-ed25519 host key for <redacted>: b'b4c8c90d11ba08dc8243bb8312554ad6'\r\nDEBUG:paramiko.transport:Trying discovered key b'fc9db78e21554336dba204b193502cde' in /Users/<redacted>/.ssh/id_rsa\r\nDEBUG:paramiko.transport:Adding public certificate /Users/<redacted>/.ssh/id_rsa-cert.pub\r\nDEBUG:paramiko.transport:userauth is OK\r\nDEBUG:paramiko.transport:Finalizing pubkey algorithm for key of type 'ssh-rsa-cert-v01@openssh.com'\r\nDEBUG:paramiko.transport:Our pubkey algorithm list: ['rsa-sha2-512', 'rsa-sha2-256', 'ssh-rsa']\r\nDEBUG:paramiko.transport:Server-side algorithm list: ['rsa-sha2-256', 'rsa-sha2-512']\r\nDEBUG:paramiko.transport:Agreed upon 'rsa-sha2-512' pubkey algorithm\r\nINFO:paramiko.transport:Authentication (publickey) failed.\r\nDEBUG:paramiko.transport:Trying discovered key b'f7b9889d1f44f0058ded06fa8bd4befa' in /Users/<redacted>/.ssh/id_rsa\r\nERROR:nornir.core.task:Host 'devdsk': task 'netmiko_file_transfer' failed with traceback:\r\nTraceback (most recent call last):\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/nornir/core/task.py\", line 99, in start\r\n    r = self.task(self, **self.params)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/nornir_netmiko/tasks/netmiko_file_transfer.py\", line 24, in netmiko_file_transfer\r\n    net_connect = task.host.get_connection(CONNECTION_NAME, task.nornir.config)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/nornir/core/inventory.py\", line 494, in get_connection\r\n    self.open_connection(\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/nornir/core/inventory.py\", line 546, in open_connection\r\n    conn_obj.open(\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/nornir_netmiko/connections/netmiko.py\", line 59, in open\r\n    connection = ConnectHandler(**parameters)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/netmiko/ssh_dispatcher.py\", line 344, in ConnectHandler\r\n    return ConnectionClass(*args, **kwargs)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/netmiko/base_connection.py\", line 434, in __init__\r\n    self._open()\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/netmiko/base_connection.py\", line 439, in _open\r\n    self.establish_connection()\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/netmiko/base_connection.py\", line 1021, in establish_connection\r\n    self.remote_conn_pre.connect(**ssh_connect_params)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/paramiko/client.py\", line 435, in connect\r\n    self._auth(\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/paramiko/client.py\", line 678, in _auth\r\n    key = self._key_from_filepath(\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/paramiko/client.py\", line 598, in _key_from_filepath\r\n    key.load_certificate(cert_path)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/paramiko/pkey.py\", line 663, in load_certificate\r\n    raise ValueError(err.format(blob.key_type, self.get_name()))\r\nValueError: PublicBlob type ssh-rsa-cert-v01@openssh.com incompatible with key type ssh-dss\r\n\r\nnetmiko_file_transfer***********************************************************\r\n* devdsk ** changed : False ****************************************************\r\nvvvv netmiko_file_transfer ** changed : False vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv ERROR\r\nTraceback (most recent call last):\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/nornir/core/task.py\", line 99, in start\r\n    r = self.task(self, **self.params)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/nornir_netmiko/tasks/netmiko_file_transfer.py\", line 24, in netmiko_file_transfer\r\n    net_connect = task.host.get_connection(CONNECTION_NAME, task.nornir.config)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/nornir/core/inventory.py\", line 494, in get_connection\r\n    self.open_connection(\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/nornir/core/inventory.py\", line 546, in open_connection\r\n    conn_obj.open(\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/nornir_netmiko/connections/netmiko.py\", line 59, in open\r\n    connection = ConnectHandler(**parameters)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/netmiko/ssh_dispatcher.py\", line 344, in ConnectHandler\r\n    return ConnectionClass(*args, **kwargs)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/netmiko/base_connection.py\", line 434, in __init__\r\n    self._open()\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/netmiko/base_connection.py\", line 439, in _open\r\n    self.establish_connection()\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/netmiko/base_connection.py\", line 1021, in establish_connection\r\n    self.remote_conn_pre.connect(**ssh_connect_params)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/paramiko/client.py\", line 435, in connect\r\n    self._auth(\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/paramiko/client.py\", line 678, in _auth\r\n    key = self._key_from_filepath(\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/paramiko/client.py\", line 598, in _key_from_filepath\r\n    key.load_certificate(cert_path)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages/paramiko/pkey.py\", line 663, in load_certificate\r\n    raise ValueError(err.format(blob.key_type, self.get_name()))\r\nValueError: PublicBlob type ssh-rsa-cert-v01@openssh.com incompatible with key type ssh-dss\r\n\r\n^^^^ END netmiko_file_transfer ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n```\r\n\r\n\r\n### Downgrading to paramiko 2.8.1 Works\r\n```\r\nName: paramiko\r\nVersion: 2.8.1\r\nSummary: SSH2 protocol library\r\nHome-page: https://paramiko.org\r\nAuthor: Jeff Forcier\r\nAuthor-email: jeff@bitprophet.org\r\nLicense: LGPL\r\nLocation: /Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/site-packages\r\nRequires: pynacl, bcrypt, cryptography\r\nRequired-by: scp, netmiko\r\n```\r\n\r\n\r\n```\r\nINFO:nornir.core:Running task 'netmiko_file_transfer' with args {'source_file': './test_sbc_cert_file.pem', 'dest_file': '/tmp/test_sbc_cert_file.pem'} on 1 hosts\r\nDEBUG:nornir.core.task:Host 'devdsk': running task 'netmiko_file_transfer'\r\nDEBUG:paramiko.transport:starting thread (client mode): 0x10b12950\r\nDEBUG:paramiko.transport:Local version/idstring: SSH-2.0-paramiko_2.8.1\r\nDEBUG:paramiko.transport:Remote version/idstring: SSH-2.0-OpenSSH_7.4\r\nINFO:paramiko.transport:Connected (version 2.0, client OpenSSH_7.4)\r\nDEBUG:paramiko.transport:kex algos:['curve25519-sha256', 'curve25519-sha256@libssh.org', 'ecdh-sha2-nistp256', 'ecdh-sha2-nistp384', 'ecdh-sha2-nistp521', 'diffie-hellman-group-exchange-sha256', 'diffie-hellman-group16-sha512', 'diffie-hellman-group18-sha512', 'diffie-hellman-group-exchange-sha1', 'diffie-hellman-group14-sha256', 'diffie-hellman-group14-sha1', 'diffie-hellman-group1-sha1'] server key:['ssh-rsa', 'rsa-sha2-512', 'rsa-sha2-256', 'ecdsa-sha2-nistp256', 'ssh-ed25519'] client encrypt:['chacha20-poly1305@openssh.com', 'aes128-ctr', 'aes192-ctr', 'aes256-ctr', 'aes128-gcm@openssh.com', 'aes256-gcm@openssh.com', 'aes128-cbc', 'aes192-cbc', 'aes256-cbc', 'blowfish-cbc', 'cast128-cbc', '3des-cbc'] server encrypt:['chacha20-poly1305@openssh.com', 'aes128-ctr', 'aes192-ctr', 'aes256-ctr', 'aes128-gcm@openssh.com', 'aes256-gcm@openssh.com', 'aes128-cbc', 'aes192-cbc', 'aes256-cbc', 'blowfish-cbc', 'cast128-cbc', '3des-cbc'] client mac:['umac-64-etm@openssh.com', 'umac-128-etm@openssh.com', 'hmac-sha2-256-etm@openssh.com', 'hmac-sha2-512-etm@openssh.com', 'hmac-sha1-etm@openssh.com', 'umac-64@openssh.com', 'umac-128@openssh.com', 'hmac-sha2-256', 'hmac-sha2-512', 'hmac-sha1'] server mac:['umac-64-etm@openssh.com', 'umac-128-etm@openssh.com', 'hmac-sha2-256-etm@openssh.com', 'hmac-sha2-512-etm@openssh.com', 'hmac-sha1-etm@openssh.com', 'umac-64@openssh.com', 'umac-128@openssh.com', 'hmac-sha2-256', 'hmac-sha2-512', 'hmac-sha1'] client compress:['none', 'zlib@openssh.com'] server compress:['none', 'zlib@openssh.com'] client lang:[''] server lang:[''] kex follows?False\r\nDEBUG:paramiko.transport:Kex agreed: curve25519-sha256@libssh.org\r\nDEBUG:paramiko.transport:HostKey agreed: ssh-ed25519\r\nDEBUG:paramiko.transport:Cipher agreed: aes128-ctr\r\nDEBUG:paramiko.transport:MAC agreed: hmac-sha2-256\r\nDEBUG:paramiko.transport:Compression agreed: none\r\nDEBUG:paramiko.transport:kex engine KexCurve25519 specified hash_algo <built-in function openssl_sha256>\r\nDEBUG:paramiko.transport:Switch to new keys ...\r\nDEBUG:paramiko.transport:Adding ssh-ed25519 host key for <redacted>: b'b4c8c90d11ba08dc8243bb8312554ad6'\r\nDEBUG:paramiko.transport:Trying discovered key b'fc9db78e21554336dba204b193502cde' in /Users/<redacted>/.ssh/id_rsa\r\nDEBUG:paramiko.transport:Adding public certificate /Users/<redacted>/.ssh/id_rsa-cert.pub\r\nDEBUG:paramiko.transport:userauth is OK\r\nINFO:paramiko.transport:Authentication (publickey) successful!\r\nDEBUG:paramiko.transport:[chan 0] Max packet in: 32768 bytes\r\nDEBUG:paramiko.transport:Received global request \"hostkeys-00@openssh.com\"\r\nDEBUG:paramiko.transport:Rejecting \"hostkeys-00@openssh.com\" global request from server.\r\nDEBUG:paramiko.transport:[chan 0] Max packet out: 32768 bytes\r\nDEBUG:paramiko.transport:Secsh channel 0 opened.\r\nDEBUG:paramiko.transport:[chan 0] Sesch channel 0 request ok\r\nDEBUG:paramiko.transport:[chan 0] Sesch channel 0 request ok\r\n```\r\n\r\n`disabled_algorithm` as pointed out it in https://docs.paramiko.org/en/stable/api/transport.html does not work for me.","closed_by":{"login":"bitprophet","id":6088,"node_id":"MDQ6VXNlcjYwODg=","avatar_url":"https://avatars.githubusercontent.com/u/6088?v=4","gravatar_id":"","url":"https://api.github.com/users/bitprophet","html_url":"https://github.com/bitprophet","followers_url":"https://api.github.com/users/bitprophet/followers","following_url":"https://api.github.com/users/bitprophet/following{/other_user}","gists_url":"https://api.github.com/users/bitprophet/gists{/gist_id}","starred_url":"https://api.github.com/users/bitprophet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bitprophet/subscriptions","organizations_url":"https://api.github.com/users/bitprophet/orgs","repos_url":"https://api.github.com/users/bitprophet/repos","events_url":"https://api.github.com/users/bitprophet/events{/privacy}","received_events_url":"https://api.github.com/users/bitprophet/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/paramiko/paramiko/issues/2017/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/paramiko/paramiko/issues/2017/timeline","performed_via_github_app":null,"state_reason":"completed"}