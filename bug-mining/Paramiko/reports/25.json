{"url":"https://api.github.com/repos/paramiko/paramiko/issues/428","repository_url":"https://api.github.com/repos/paramiko/paramiko","labels_url":"https://api.github.com/repos/paramiko/paramiko/issues/428/labels{/name}","comments_url":"https://api.github.com/repos/paramiko/paramiko/issues/428/comments","events_url":"https://api.github.com/repos/paramiko/paramiko/issues/428/events","html_url":"https://github.com/paramiko/paramiko/issues/428","id":47730724,"node_id":"MDU6SXNzdWU0NzczMDcyNA==","number":428,"title":"BufferedFile readline() does not check for newline characters if buffer size is met or exceeded","user":{"login":"achapp","id":1297913,"node_id":"MDQ6VXNlcjEyOTc5MTM=","avatar_url":"https://avatars.githubusercontent.com/u/1297913?v=4","gravatar_id":"","url":"https://api.github.com/users/achapp","html_url":"https://github.com/achapp","followers_url":"https://api.github.com/users/achapp/followers","following_url":"https://api.github.com/users/achapp/following{/other_user}","gists_url":"https://api.github.com/users/achapp/gists{/gist_id}","starred_url":"https://api.github.com/users/achapp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/achapp/subscriptions","organizations_url":"https://api.github.com/users/achapp/orgs","repos_url":"https://api.github.com/users/achapp/repos","events_url":"https://api.github.com/users/achapp/events{/privacy}","received_events_url":"https://api.github.com/users/achapp/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":60522311,"node_id":"MDU6TGFiZWw2MDUyMjMxMQ==","url":"https://api.github.com/repos/paramiko/paramiko/labels/Needs%20investigation","name":"Needs investigation","color":"fad8c7","default":false,"description":null},{"id":120561399,"node_id":"MDU6TGFiZWwxMjA1NjEzOTk=","url":"https://api.github.com/repos/paramiko/paramiko/labels/Bug","name":"Bug","color":"a04040","default":false,"description":null},{"id":120566518,"node_id":"MDU6TGFiZWwxMjA1NjY1MTg=","url":"https://api.github.com/repos/paramiko/paramiko/labels/Stream%20behavior","name":"Stream behavior","color":"fef2c0","default":false,"description":null},{"id":121094372,"node_id":"MDU6TGFiZWwxMjEwOTQzNzI=","url":"https://api.github.com/repos/paramiko/paramiko/labels/Needs%20patch","name":"Needs patch","color":"fad8c7","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2014-11-04T16:12:15Z","updated_at":"2014-12-15T21:29:55Z","closed_at":"2014-12-15T21:29:55Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Paramiko version: 1.15\nPython version:     2.6.6\n\nI'm running into an issue with the readline() function in BufferedFile. It appears that when the buffer size is met or exceeded, the function will return a buffer size chunk of the file and not attempt to locate newline characters.\n\nDocumentation of readline()\n\n```\n    Read one entire line from the file.  A trailing newline character is\n    kept in the string (but may be absent when a file ends with an\n    incomplete line).  If the size argument is present and non-negative, it\n    is a maximum byte count (including the trailing newline) and an\n    incomplete line may be returned.\n```\n\nMy interpretation of the documentation is that readline() should read up to the next newline character or buffer size bytes, whichever comes first. If readline() is given a file greater than or equal to the buffer size it should always look for a newline character or, failing that, return up to buffer size bytes. If my understanding is correct, then I think there is a problem in the following code.\n\nFrom BufferedFile readline():     \n\n```\n 219     # check size before looking for a linefeed, in case we already have\n 220     # enough.\n 221     if (size is not None) and (size >= 0):\n 222           if len(line) >= size:\n 223               # truncate line and return\n 224               self._rbuffer = line[size:]\n 225               line = line[:size]\n 226               self._pos += len(line)\n 227               return line if self._flags & self.FLAG_BINARY else u(line)\n 228           n = size - len(line)\n```\n\nThe problem lies with line 227.\n\n```\n 227               return line if self._flags & self.FLAG_BINARY else u(line)\n```\n\nThis exits the function with a buffer size chunk before any search is made for newline characters. It's possible there are lines within that buffer size chunk, but we never look so they are disregarded in this case.\n\nThanks for taking the time to read this and for your work on Paramiko!\n","closed_by":{"login":"bitprophet","id":6088,"node_id":"MDQ6VXNlcjYwODg=","avatar_url":"https://avatars.githubusercontent.com/u/6088?v=4","gravatar_id":"","url":"https://api.github.com/users/bitprophet","html_url":"https://github.com/bitprophet","followers_url":"https://api.github.com/users/bitprophet/followers","following_url":"https://api.github.com/users/bitprophet/following{/other_user}","gists_url":"https://api.github.com/users/bitprophet/gists{/gist_id}","starred_url":"https://api.github.com/users/bitprophet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bitprophet/subscriptions","organizations_url":"https://api.github.com/users/bitprophet/orgs","repos_url":"https://api.github.com/users/bitprophet/repos","events_url":"https://api.github.com/users/bitprophet/events{/privacy}","received_events_url":"https://api.github.com/users/bitprophet/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/paramiko/paramiko/issues/428/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/paramiko/paramiko/issues/428/timeline","performed_via_github_app":null,"state_reason":"completed"}