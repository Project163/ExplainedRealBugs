diff --git a/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/facade/LmqQueueStore.java b/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/facade/LmqQueueStore.java
index b393abe..66c9bac 100644
--- a/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/facade/LmqQueueStore.java
+++ b/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/facade/LmqQueueStore.java
@@ -20,6 +20,8 @@ package org.apache.rocketmq.mqtt.common.facade;
 import java.util.Set;
 import java.util.concurrent.CompletableFuture;
 
+import org.apache.rocketmq.common.message.MessageExt;
+import org.apache.rocketmq.common.message.MessageQueue;
 import org.apache.rocketmq.mqtt.common.model.Message;
 import org.apache.rocketmq.mqtt.common.model.PullResult;
 import org.apache.rocketmq.mqtt.common.model.Queue;
@@ -48,6 +50,19 @@ public interface LmqQueueStore {
      */
     CompletableFuture<PullResult> pullMessage(String firstTopic, Queue queue, QueueOffset queueOffset, long count);
 
+    /**
+     * pop messages
+     *
+     * @param consumerGroup
+     * @param firstTopic
+     * @param queue
+     * @param count
+     * @return
+     */
+    CompletableFuture<PullResult> popMessage(String consumerGroup, String firstTopic, Queue queue, long count);
+
+    void popAck(String lmqTopic, String consumerGroup, Message message);
+
     /**
      * pull last messages
      *
diff --git a/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/model/Constants.java b/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/model/Constants.java
index f6e404c..cd764d7 100644
--- a/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/model/Constants.java
+++ b/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/model/Constants.java
@@ -23,6 +23,7 @@ public class Constants {
 
     public static final String PLUS_SIGN = "+";
     public static final String NUMBER_SIGN = "#";
+    public static final String DOLLAR_SIGN = "$";
     public static final String COLON = ":";
 
     public static final String P2P = "/p2p/";
@@ -55,5 +56,7 @@ public class Constants {
     public static final byte CTRL_2 = '\u0002';
 
     public static final String NOT_FOUND = "NOT_FOUND";
+    public static final String SHARED_PREFIX = DOLLAR_SIGN + "share";
+    public static final String EMPTY_SHARE_NAME = "";
 
 }
diff --git a/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/model/PullResult.java b/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/model/PullResult.java
index e26f780..60d4ba8 100644
--- a/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/model/PullResult.java
+++ b/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/model/PullResult.java
@@ -24,6 +24,7 @@ import java.util.List;
 public class PullResult {
     public static final int PULL_SUCCESS = 301;
     public static final int PULL_OFFSET_MOVED = 302;
+    public static final int NO_NEW_MSG = 303;
     private int code = PULL_SUCCESS;
     private String remark;
     private List<Message> messageList;
diff --git a/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/model/Queue.java b/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/model/Queue.java
index c10921f..47b7e69 100644
--- a/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/model/Queue.java
+++ b/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/model/Queue.java
@@ -51,6 +51,10 @@ public class Queue {
         return TopicUtils.isP2pTopic(queueName);
     }
 
+    public boolean isShare() {
+        return TopicUtils.isSharedSubscription(queueName);
+    }
+
     public long getQueueId() {
         return queueId;
     }
diff --git a/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/model/Subscription.java b/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/model/Subscription.java
index cd2d380..8aa62fb 100644
--- a/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/model/Subscription.java
+++ b/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/model/Subscription.java
@@ -85,6 +85,17 @@ public class Subscription {
         return topicFilter != null ? topicFilter.hashCode() : 0;
     }
 
+    public boolean isShare() {
+        return TopicUtils.isSharedSubscription(topicFilter);
+    }
+
+    public String getSharedName() {
+        if (!isShare()) {
+            return null;
+        }
+        return TopicUtils.getSharedName(topicFilter);
+    }
+
     public String getTopicFilter() {
         return topicFilter;
     }
diff --git a/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/util/TopicUtils.java b/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/util/TopicUtils.java
index 166475f..4e5f07b 100644
--- a/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/util/TopicUtils.java
+++ b/mqtt-common/src/main/java/org/apache/rocketmq/mqtt/common/util/TopicUtils.java
@@ -17,6 +17,8 @@
 
 package org.apache.rocketmq.mqtt.common.util;
 
+import java.util.Arrays;
+
 import org.apache.commons.lang3.StringUtils;
 import org.apache.rocketmq.mqtt.common.model.Constants;
 import org.apache.rocketmq.mqtt.common.model.MqttTopic;
@@ -116,6 +118,9 @@ public class TopicUtils {
         if (topics.startsWith(Constants.MQTT_TOPIC_DELIMITER)) {
             topics = topics.substring(1);
         }
+        if (topics.startsWith(Constants.SHARED_PREFIX)) {
+            topics = TopicUtils.getSharedTopicFilter(topics);
+        }
         String topic;
         String secondTopic = null;
         int index = topics.indexOf(Constants.MQTT_TOPIC_DELIMITER, 1);
@@ -185,4 +190,24 @@ public class TopicUtils {
     public static String wrapP2pLmq(String clientId) {
         return normalizeTopic(Constants.P2P + clientId);
     }
+
+    // shared subscription topic filter format: $share/{ShareName}/{filter}
+    public static boolean isSharedSubscription(String topicFilter) {
+        if (StringUtils.isEmpty(topicFilter)) {
+            return false;
+        }
+        if (!topicFilter.startsWith(Constants.SHARED_PREFIX)) {
+            return false;
+        }
+        String[] arr = topicFilter.split(Constants.MQTT_TOPIC_DELIMITER);
+        return arr.length > 2;
+    }
+
+    public static String getSharedName(String topicFilter) {
+        return topicFilter.split(Constants.MQTT_TOPIC_DELIMITER)[1];
+    }
+
+    public static String getSharedTopicFilter(String topicFilter) {
+        return topicFilter.split(Constants.MQTT_TOPIC_DELIMITER, 3)[2];
+    }
 }
