diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/IncludeAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/IncludeAnalyzer.php
index 89f0dc2e9..4cb34604e 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/IncludeAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/IncludeAnalyzer.php
@@ -335,7 +335,7 @@ class IncludeAnalyzer
         $reduce_pattern = '/\/[^\/]+\/\.\.\//';
 
         while (preg_match($reduce_pattern, $path_to_file)) {
-            $path_to_file = preg_replace($reduce_pattern, DIRECTORY_SEPARATOR, $path_to_file);
+            $path_to_file = preg_replace($reduce_pattern, DIRECTORY_SEPARATOR, $path_to_file, 1);
         }
 
         $path_to_file = str_replace('/./', '/', $path_to_file);
diff --git a/tests/IncludeTest.php b/tests/IncludeTest.php
index 7d459a55d..b19e8713a 100644
--- a/tests/IncludeTest.php
+++ b/tests/IncludeTest.php
@@ -558,6 +558,17 @@ class IncludeTest extends TestCase
                     getcwd() . DIRECTORY_SEPARATOR . 'file1.php',
                 ],
             ],
+            'nestedParentFile' => [
+                'files' => [
+                    getcwd() . DIRECTORY_SEPARATOR . 'a' . DIRECTORY_SEPARATOR . 'b' . DIRECTORY_SEPARATOR . 'c' . DIRECTORY_SEPARATOR . 'd' . DIRECTORY_SEPARATOR . 'script.php' => '<?php
+                        require_once __DIR__ . "/../../../../e/begin.php";',
+                    getcwd() . DIRECTORY_SEPARATOR . 'e' . DIRECTORY_SEPARATOR . 'begin.php' => '<?php
+                        echo "hello";',
+                ],
+                'files_to_check' => [
+                    getcwd() . DIRECTORY_SEPARATOR . 'a' . DIRECTORY_SEPARATOR . 'b' . DIRECTORY_SEPARATOR . 'c' . DIRECTORY_SEPARATOR . 'd' . DIRECTORY_SEPARATOR . 'script.php',
+                ],
+            ],
         ];
     }
 
