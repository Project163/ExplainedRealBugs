diff --git a/src/Psalm/Internal/Analyzer/Statements/Block/DoAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Block/DoAnalyzer.php
index 9902a6b61..7fdadba0e 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Block/DoAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Block/DoAnalyzer.php
@@ -228,7 +228,7 @@ class DoAnalyzer
         );
 
         if ($context->collect_references) {
-            $context->unreferenced_vars = $inner_loop_context->unreferenced_vars;
+            $context->unreferenced_vars = $loop_scope->loop_context->unreferenced_vars;
         }
 
         if ($context->collect_exceptions) {
diff --git a/tests/UnusedVariableTest.php b/tests/UnusedVariableTest.php
index 369b742ac..eec86ff4b 100644
--- a/tests/UnusedVariableTest.php
+++ b/tests/UnusedVariableTest.php
@@ -1424,6 +1424,21 @@ class UnusedVariableTest extends TestCase
                         echo implode(",", $p);
                     }'
             ],
+            'doWhileWithBreak' => [
+                '<?php
+                    function foo(): void {
+                        $f = false;
+
+                        do {
+                            if (rand(0,1)) {
+                                $f = true;
+                                break;
+                            }
+                        } while (rand(0,1));
+
+                        if ($f) {}
+                    }'
+            ],
         ];
     }
 
