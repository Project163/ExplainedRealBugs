diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/BinaryOpAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/BinaryOpAnalyzer.php
index 88fccef77..dd7d5e785 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/BinaryOpAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/BinaryOpAnalyzer.php
@@ -99,14 +99,6 @@ class BinaryOpAnalyzer
                 return null;
             }
 
-            $left_clauses = Algebra::getFormula(
-                \spl_object_id($stmt->left),
-                $stmt->left,
-                $context->self,
-                $statements_analyzer,
-                $codebase
-            );
-
             $pre_referenced_var_ids = $context->referenced_var_ids;
 
             $pre_assigned_var_ids = $context->assigned_var_ids;
@@ -123,6 +115,14 @@ class BinaryOpAnalyzer
                 return false;
             }
 
+            $left_clauses = Algebra::getFormula(
+                \spl_object_id($stmt->left),
+                $stmt->left,
+                $context->self,
+                $statements_analyzer,
+                $codebase
+            );
+
             foreach ($left_context->vars_in_scope as $var_id => $type) {
                 if (isset($left_context->assigned_var_ids[$var_id])) {
                     $context->vars_in_scope[$var_id] = $type;
diff --git a/tests/TypeReconciliation/ConditionalTest.php b/tests/TypeReconciliation/ConditionalTest.php
index 4a72164e2..a2f106d78 100644
--- a/tests/TypeReconciliation/ConditionalTest.php
+++ b/tests/TypeReconciliation/ConditionalTest.php
@@ -1813,6 +1813,7 @@ class ConditionalTest extends \Psalm\Tests\TestCase
             ],
             'avoidOOM' => [
                 '<?php
+                    /** @psalm-suppress MixedInferredReturnType */
                     function gameOver(
                         int $b0,
                         int $b1,
@@ -2470,6 +2471,18 @@ class ConditionalTest extends \Psalm\Tests\TestCase
                         return strlen($project->assessment->root);
                     }'
             ],
+            'castIsType' => [
+                '<?php
+                    /**
+                     * @param string|int $s
+                     */
+                    function foo($s, int $f = 1) : void {
+                        if ($f === 1
+                            && (string) $s === $s
+                            && \strpos($s, "foo") !== false
+                        ) {}
+                    }'
+            ],
         ];
     }
 
