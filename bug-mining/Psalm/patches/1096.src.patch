diff --git a/src/Psalm/Internal/Analyzer/ClassAnalyzer.php b/src/Psalm/Internal/Analyzer/ClassAnalyzer.php
index c6246db99..09143db63 100644
--- a/src/Psalm/Internal/Analyzer/ClassAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/ClassAnalyzer.php
@@ -14,6 +14,7 @@ use Psalm\Codebase;
 use Psalm\CodeLocation;
 use Psalm\Config;
 use Psalm\Context;
+use Psalm\Internal\Type\TemplateInferredTypeReplacer;
 use Psalm\Issue\DeprecatedClass;
 use Psalm\Issue\DeprecatedInterface;
 use Psalm\Issue\DeprecatedTrait;
@@ -71,6 +72,7 @@ use function array_keys;
 use function array_merge;
 use function array_filter;
 use function in_array;
+use function assert;
 
 /**
  * @internal
@@ -705,20 +707,82 @@ class ClassAnalyzer extends ClassLikeAnalyzer
                         }
                     }
 
-                    if ($property_storage->type
-                        && $guide_property_storage->type
-                        && $property_storage->location
-                        && !$property_storage->type->equals($guide_property_storage->type)
-                        && !$guide_property_storage->type->containsTemplate()
+                    if ($property_storage->type === null) {
+                        // Property type not set, no need to check for docblock invariance
+                        continue;
+                    }
+
+                    $property_type = clone $property_storage->type;
+
+                    $guide_property_type = $guide_property_storage->type === null
+                        ? Type::getMixed()
+                        : clone $guide_property_storage->type;
+
+                    // Set upper bounds for all templates
+                    $upper_bounds = [];
+                    $extended_templates = $storage->template_extended_params ?? [];
+                    foreach ($extended_templates as $et_name => $et_array) {
+                        foreach ($et_array as $et_class_name => $extended_template) {
+                            if (!isset($upper_bounds[$et_class_name][$et_name])) {
+                                $upper_bounds[$et_class_name][$et_name] = $extended_template;
+                            }
+                        }
+                    }
+
+                    // Get actual types used for templates (to support @template-covariant)
+                    $template_standins = new \Psalm\Internal\Type\TemplateResult($upper_bounds, []);
+                    TemplateStandinTypeReplacer::replace(
+                        $guide_property_type,
+                        $template_standins,
+                        $codebase,
+                        null,
+                        $property_type
+                    );
+
+                    // Iterate over parent classes to find template-covariants, and replace the upper bound with the
+                    // standin. Since @template-covariant allows child classes, we want to use the standin type
+                    // instead of the template extended type.
+                    $parent_class = $storage->parent_class;
+                    while ($parent_class !== null) {
+                        $parent_storage = $codebase->classlike_storage_provider->get($parent_class);
+                        foreach ($parent_storage->template_covariants ?? [] as $pt_offset => $covariant) {
+                            if ($covariant) {
+                                // If template_covariants is set template_types should also be set
+                                assert($parent_storage->template_types !== null);
+                                $pt_name = array_keys($parent_storage->template_types)[$pt_offset];
+                                if (isset($template_standins->upper_bounds[$pt_name][$parent_class])) {
+                                    $upper_bounds[$pt_name][$parent_class] =
+                                        $template_standins->upper_bounds[$pt_name][$parent_class]->type;
+                                }
+                            }
+                        }
+                        $parent_class = $parent_storage->parent_class;
+                    }
+
+                    $template_result = new \Psalm\Internal\Type\TemplateResult([], $upper_bounds);
+
+                    TemplateInferredTypeReplacer::replace(
+                        $guide_property_type,
+                        $template_result,
+                        $codebase
+                    );
+                    TemplateInferredTypeReplacer::replace(
+                        $property_type,
+                        $template_result,
+                        $codebase
+                    );
+
+                    if ($property_storage->location
+                        && !$property_type->equals($guide_property_type)
                         && $guide_class_storage->user_defined
                     ) {
                         if (IssueBuffer::accepts(
                             new NonInvariantDocblockPropertyType(
                                 'Property ' . $fq_class_name . '::$' . $property_name
-                                    . ' has type ' . $property_storage->type->getId()
+                                    . ' has type ' . $property_type->getId()
                                     . ", not invariant with " . $guide_class_name . '::$'
                                     . $property_name . ' of type '
-                                    . $guide_property_storage->type->getId(),
+                                    . $guide_property_type->getId(),
                                 $property_storage->location
                             ),
                             $property_storage->suppressed_issues
diff --git a/src/Psalm/Internal/TypeVisitor/ContainsTemplateVisitor.php b/src/Psalm/Internal/TypeVisitor/ContainsTemplateVisitor.php
deleted file mode 100644
index 5f99d23e1..000000000
--- a/src/Psalm/Internal/TypeVisitor/ContainsTemplateVisitor.php
+++ /dev/null
@@ -1,33 +0,0 @@
-<?php
-
-declare(strict_types=1);
-
-namespace Psalm\Internal\TypeVisitor;
-
-use Psalm\Type\Atomic\TTemplateParam;
-use Psalm\Type\Atomic\TTemplateParamClass;
-use Psalm\Type\TypeNode;
-use Psalm\Type\NodeVisitor;
-
-class ContainsTemplateVisitor extends NodeVisitor
-{
-    /**
-     * @var bool
-     */
-    private $contains_template = false;
-
-    protected function enterNode(TypeNode $type): ?int
-    {
-        if ($type instanceof TTemplateParam || $type instanceof TTemplateParamClass) {
-            $this->contains_template = true;
-            return NodeVisitor::STOP_TRAVERSAL;
-        }
-
-        return null;
-    }
-
-    public function matches(): bool
-    {
-        return $this->contains_template;
-    }
-}
diff --git a/src/Psalm/Type/Union.php b/src/Psalm/Type/Union.php
index 7db42dccd..15d93c80e 100644
--- a/src/Psalm/Type/Union.php
+++ b/src/Psalm/Type/Union.php
@@ -1320,18 +1320,6 @@ class Union implements TypeNode
         return $classlike_visitor->matches();
     }
 
-    /**
-     * Returns true if union contains template at any nested level.
-     */
-    public function containsTemplate(): bool
-    {
-        $template_visitor = new \Psalm\Internal\TypeVisitor\ContainsTemplateVisitor();
-
-        $template_visitor->traverseArray($this->types);
-
-        return $template_visitor->matches();
-    }
-
     /**
      * @return list<TTemplateParam>
      */
diff --git a/tests/PropertyTypeInvarianceTest.php b/tests/PropertyTypeInvarianceTest.php
index 455284c3f..2130d92be 100644
--- a/tests/PropertyTypeInvarianceTest.php
+++ b/tests/PropertyTypeInvarianceTest.php
@@ -99,7 +99,7 @@ class PropertyTypeInvarianceTest extends TestCase
                         protected $items;
                     }',
             ],
-            'allowTemplatedInvarianceWithClassString' => [
+            'allowTemplatedInvarianceWithClassStringTemplate' => [
                 '<?php
                     abstract class Item {}
                     class Foo extends Item {}
@@ -118,6 +118,118 @@ class PropertyTypeInvarianceTest extends TestCase
                         protected $type;
                     }',
             ],
+            'templatedInvarianceGrandchild' => [
+                '<?php
+                    abstract class Item {}
+                    class Foo extends Item {}
+                    class Bar extends Foo {}
+
+                    /** @template T of Item */
+                    abstract class ItemCollection
+                    {
+                        /** @var list<T> */
+                        protected $items = [];
+                    }
+
+                    /**
+                     * @template T of Foo
+                     * @extends ItemCollection<T>
+                     */
+                    class FooCollection extends ItemCollection
+                    {
+                        /** @var list<T> */
+                        protected $items = [];
+                    }
+
+                    /** @extends FooCollection<Bar> */
+                    class BarCollection extends FooCollection
+                    {
+                        /** @var list<Bar> */
+                        protected $items = [];
+                    }',
+            ],
+            'allowTemplateCovariant' => [
+                '<?php
+                    class Foo {}
+                    class Bar extends Foo {}
+                    class Baz extends Bar {}
+
+                    /** @template-covariant T */
+                    class Pair
+                    {
+                        /** @var T|null */
+                        public $a;
+
+                        /** @var T|null */
+                        public $b;
+                    }
+
+                    /** @extends Pair<Foo> */
+                    class FooPair extends Pair
+                    {
+                        /** @var Bar|null */
+                        public $a;
+
+                        /** @var Baz|null */
+                        public $b;
+                    }',
+            ],
+            'allowTemplateCovariantManyTemplates' => [
+                '<?php
+                    class A {}
+                    class B extends A {}
+                    class C extends B {}
+
+                    /**
+                     * @template Ta
+                     * @template Tb
+                     * @template-covariant Tc
+                     * @template Td
+                     */
+                    class Foo {
+                        /** @var Ta|null */
+                        public $a;
+
+                        /** @var Tb|null */
+                        public $b;
+
+                        /** @var Tc|null */
+                        public $c;
+
+                        /** @var Td|null */
+                        public $d;
+                    }
+
+                    /**
+                     * @template Ta
+                     * @template Tb
+                     * @template-covariant Tc
+                     * @template Td
+                     * @extends Foo<Ta, Tb, Tc, Td>
+                     */
+                    class Bar extends Foo {}
+
+                    /**
+                     * @template Ta
+                     * @template Tb
+                     * @template-covariant Tc
+                     * @template Td
+                     * @extends Bar<A, B, A, C>
+                     */
+                    class Baz extends Bar {
+                        /** @var A|null */
+                        public $a;
+
+                        /** @var B|null */
+                        public $b;
+
+                        /** @var C|null */
+                        public $c;
+
+                        /** @var C|null */
+                        public $d;
+                    }',
+            ],
         ];
     }
 
@@ -155,26 +267,80 @@ class PropertyTypeInvarianceTest extends TestCase
                     }',
                 'error_message' => 'NonInvariantPropertyType',
             ],
-            // TODO support property invariance checks with templates
-            // 'disallowInvalidTemplatedInvariance' => [
-            //     '<?php
-            //         /**
-            //          * @template T as string|null
-            //          */
-            //         abstract class A {
-            //             /** @var T */
-            //             public $foo;
-            //         }
-
-            //         /**
-            //          * @extends A<string>
-            //          */
-            //         class AChild extends A {
-            //             /** @var int */
-            //             public $foo = 0;
-            //         }',
-            //     'error_message' => 'NonInvariantPropertyType',
-            // ],
+            'variantTemplatedProperties' => [
+                '<?php
+                    /**
+                     * @template T as string|null
+                     */
+                    abstract class A {
+                        /** @var T */
+                        public $foo;
+                    }
+
+                    /**
+                     * @extends A<string>
+                     */
+                    class AChild extends A {
+                        /** @var int */
+                        public $foo = 0;
+                    }',
+                'error_message' => 'NonInvariantDocblockPropertyType',
+            ],
+            'variantTemplatedGrandchild' => [
+                '<?php
+                    abstract class Item {}
+                    class Foo extends Item {}
+                    class Bar extends Foo {}
+
+                    /** @template T of Item */
+                    abstract class ItemCollection
+                    {
+                        /** @var list<T> */
+                        protected $items = [];
+                    }
+
+                    /**
+                     * @template T of Foo
+                     * @extends ItemCollection<T>
+                     */
+                    class FooCollection extends ItemCollection
+                    {
+                        /** @var list<T> */
+                        protected $items = [];
+                    }
+
+                    /** @extends FooCollection<Bar> */
+                    class BarCollection extends FooCollection
+                    {
+                        /** @var list<Item> */ // Should be list<Bar>
+                        protected $items = [];
+                    }',
+                'error_message' => 'NonInvariantDocblockPropertyType',
+            ],
+            'variantPropertiesWithTemplateNotSpecified' => [
+                '<?php
+                    class Foo {}
+
+                    /** @template T */
+                    class Pair
+                    {
+                        /** @var T|null */
+                        protected $a;
+
+                        /** @var T|null */
+                        protected $b;
+                    }
+
+                    class FooPair extends Pair
+                    {
+                        /** @var Foo|null */ // Template defaults to mixed, this is invariant
+                        protected $a;
+
+                        /** @var Foo|null */
+                        protected $b;
+                    }',
+                'error_message' => 'NonInvariantDocblockPropertyType',
+            ],
         ];
     }
 }
