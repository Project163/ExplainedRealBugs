diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/Call/FunctionCallAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/Call/FunctionCallAnalyzer.php
index ea2b081ba..63576b23a 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/Call/FunctionCallAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/Call/FunctionCallAnalyzer.php
@@ -645,6 +645,26 @@ class FunctionCallAnalyzer extends \Psalm\Internal\Analyzer\Statements\Expressio
 
                         if (!$codebase->classlikes->classExists($resolved_name)) {
                             $context->phantom_classes[strtolower($resolved_name)] = true;
+                        } elseif ($context->inside_negation) {
+                            return false;
+                        }
+                    }
+                }
+            } elseif ($function->parts === ['interface_exists']) {
+                if ($first_arg) {
+                    if ($first_arg->value instanceof PhpParser\Node\Scalar\String_) {
+                        $context->phantom_classes[strtolower($first_arg->value->value)] = true;
+                    } elseif ($first_arg->value instanceof PhpParser\Node\Expr\ClassConstFetch
+                        && $first_arg->value->class instanceof PhpParser\Node\Name
+                        && $first_arg->value->name instanceof PhpParser\Node\Identifier
+                        && $first_arg->value->name->name === 'class'
+                    ) {
+                        $resolved_name = (string) $first_arg->value->class->getAttribute('resolvedName');
+
+                        if (!$codebase->classlikes->interfaceExists($resolved_name)) {
+                            $context->phantom_classes[strtolower($resolved_name)] = true;
+                        } elseif ($context->inside_negation) {
+                            return false;
                         }
                     }
                 }
diff --git a/src/Psalm/Internal/Visitor/ReflectorVisitor.php b/src/Psalm/Internal/Visitor/ReflectorVisitor.php
index b11df92b9..69bd2cc7d 100644
--- a/src/Psalm/Internal/Visitor/ReflectorVisitor.php
+++ b/src/Psalm/Internal/Visitor/ReflectorVisitor.php
@@ -158,14 +158,6 @@ class ReflectorVisitor extends PhpParser\NodeVisitorAbstract implements PhpParse
      */
     public function enterNode(PhpParser\Node $node)
     {
-        if ($this->skip_if_descendants
-            && !$node instanceof PhpParser\Node\Stmt\If_
-            && !$node instanceof PhpParser\Node\Stmt\Else_
-            && !$node instanceof PhpParser\Node\Stmt\ElseIf_
-        ) {
-            return;
-        }
-
         foreach ($node->getComments() as $comment) {
             if ($comment instanceof PhpParser\Comment\Doc) {
                 try {
@@ -265,6 +257,10 @@ class ReflectorVisitor extends PhpParser\NodeVisitorAbstract implements PhpParse
                 }
             }
         } elseif ($node instanceof PhpParser\Node\Stmt\ClassLike) {
+            if ($this->skip_if_descendants) {
+                return;
+            }
+
             if ($this->registerClassLike($node) === false) {
                 return PhpParser\NodeTraverser::STOP_TRAVERSAL;
             }
@@ -300,6 +296,14 @@ class ReflectorVisitor extends PhpParser\NodeVisitorAbstract implements PhpParse
                 }
             }
         } elseif ($node instanceof PhpParser\Node\FunctionLike) {
+            if ($node instanceof PhpParser\Node\Stmt\Function_
+                || $node instanceof PhpParser\Node\Stmt\ClassMethod
+            ) {
+                if ($this->skip_if_descendants) {
+                    return;
+                }
+            }
+
             $this->registerFunctionLike($node);
 
             if ($node instanceof PhpParser\Node\Expr\Closure) {
@@ -515,14 +519,6 @@ class ReflectorVisitor extends PhpParser\NodeVisitorAbstract implements PhpParse
      */
     public function leaveNode(PhpParser\Node $node)
     {
-        if ($this->skip_if_descendants
-            && !$node instanceof PhpParser\Node\Stmt\If_
-            && !$node instanceof PhpParser\Node\Stmt\Else_
-            && !$node instanceof PhpParser\Node\Stmt\ElseIf_
-        ) {
-            return;
-        }
-
         if ($node instanceof PhpParser\Node\Stmt\Namespace_) {
             $this->aliases = $this->file_aliases;
 
@@ -542,6 +538,10 @@ class ReflectorVisitor extends PhpParser\NodeVisitorAbstract implements PhpParse
                 }
             }
         } elseif ($node instanceof PhpParser\Node\Stmt\ClassLike) {
+            if ($this->skip_if_descendants) {
+                return;
+            }
+
             if (!$this->fq_classlike_names) {
                 throw new \LogicException('$this->fq_classlike_names should not be empty');
             }
@@ -614,6 +614,10 @@ class ReflectorVisitor extends PhpParser\NodeVisitorAbstract implements PhpParse
         ) {
             $this->function_template_types = [];
         } elseif ($node instanceof PhpParser\Node\FunctionLike) {
+            if ($this->skip_if_descendants) {
+                return;
+            }
+
             if (!$this->functionlike_storages) {
                 throw new \UnexpectedValueException('There should be function storages');
             }
diff --git a/tests/ClassStringTest.php b/tests/ClassStringTest.php
index c4c9dc777..2f6dffd5f 100644
--- a/tests/ClassStringTest.php
+++ b/tests/ClassStringTest.php
@@ -603,6 +603,14 @@ class ClassStringTest extends TestCase
 
                     class B extends A {}'
             ],
+            'noCrashWhenClassExists' => [
+                '<?php
+                    class A {}
+
+                    if (class_exists(A::class)) {
+                        new \RuntimeException();
+                    }'
+            ],
         ];
     }
 
diff --git a/tests/StubTest.php b/tests/StubTest.php
index e21643fc7..cd9bae38f 100644
--- a/tests/StubTest.php
+++ b/tests/StubTest.php
@@ -706,6 +706,14 @@ class StubTest extends TestCase
 
                 function bar(I6 $d) : void {
                     $d->getMessage();
+                }
+
+                function bat(I7 $d) : void {
+                    $d->getMessage();
+                }
+
+                function baz(I8 $d) : void {
+                    $d->getMessage();
                 }'
         );
 
diff --git a/tests/fixtures/stubs/conditional_interface.php b/tests/fixtures/stubs/conditional_interface.php
index 1f91a4f37..95e2a4bc0 100644
--- a/tests/fixtures/stubs/conditional_interface.php
+++ b/tests/fixtures/stubs/conditional_interface.php
@@ -23,15 +23,27 @@ if (!interface_exists('Bar')) {
     interface I4 extends Bar {}
 }
 
-if (interface_exists(Throwable::class)) {
+if (interface_exists('Throwable')) {
     interface I5 extends Throwable {}
 } else {
     interface I5 {}
 }
 
-if (!interface_exists(Throwable::class)) {
+if (!interface_exists('Throwable')) {
     interface I6 {}
 } else {
     interface I6 extends Throwable {}
 }
 
+if (interface_exists(Throwable::class)) {
+    interface I7 extends Throwable {}
+} else {
+    interface I7 {}
+}
+
+if (!interface_exists(Throwable::class)) {
+    interface I8 {}
+} else {
+    interface I8 extends Throwable {}
+}
+
