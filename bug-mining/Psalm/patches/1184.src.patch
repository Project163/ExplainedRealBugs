diff --git a/.github/workflows/ci.yml b/.github/workflows/ci.yml
index b9b7d2edc..07270f593 100644
--- a/.github/workflows/ci.yml
+++ b/.github/workflows/ci.yml
@@ -81,7 +81,7 @@ jobs:
           php-version: '8.0'
           tools: composer:v2
           coverage: none
-          extensions: decimal
+          extensions: :pdo
 
       - uses: actions/checkout@v2
 
diff --git a/dictionaries/InternalTaintSinkMap.php b/dictionaries/InternalTaintSinkMap.php
index 3838720a2..ac244bead 100644
--- a/dictionaries/InternalTaintSinkMap.php
+++ b/dictionaries/InternalTaintSinkMap.php
@@ -43,9 +43,6 @@ return [
 'mysqli_stmt::prepare' => [['sql']],
 'passthru' => [['shell']],
 'pcntl_exec' => [['shell']],
-'PDO::prepare' => [['sql']],
-'PDO::query' => [['sql']],
-'PDO::exec' => [['sql']],
 'pg_exec' => [[], ['sql']],
 'pg_prepare' => [[], [], ['sql']],
 'pg_put_line' => [[], ['sql']],
diff --git a/src/Psalm/Config.php b/src/Psalm/Config.php
index d99f30d3d..831863db2 100644
--- a/src/Psalm/Config.php
+++ b/src/Psalm/Config.php
@@ -58,7 +58,6 @@ use function class_exists;
 use function count;
 use function dirname;
 use function explode;
-use function extension_loaded;
 use function file_exists;
 use function file_get_contents;
 use function filetype;
@@ -574,6 +573,34 @@ class Config
     /** @var ?int */
     public $threads;
 
+    /**
+     * @psalm-readonly-allow-private-mutation
+     * @var array{
+     *     decimal: bool,
+     *     dom: bool,
+     *     ds: bool,
+     *     geos: bool,
+     *     gmp: bool,
+     *     mongodb: bool,
+     *     mysqli: bool,
+     *     pdo: bool,
+     *     soap: bool,
+     *     xdebug: bool,
+     * }
+     */
+    public $php_extensions = [
+        "decimal" => false,
+        "dom" => false,
+        "ds" => false,
+        "geos" => false,
+        "gmp" => false,
+        "mongodb" => false,
+        "mysqli" => false,
+        "pdo" => false,
+        "soap" => false,
+        "xdebug" => false,
+    ];
+
     protected function __construct()
     {
         self::$instance = $this;
@@ -964,6 +991,32 @@ class Config
             $base_dir = $current_dir;
         }
 
+        $composer_json_path = Composer::getJsonFilePath($config->base_dir);
+
+        $composer_json = null;
+        if (file_exists($composer_json_path)) {
+            if (!$composer_json = json_decode(file_get_contents($composer_json_path), true)) {
+                throw new UnexpectedValueException('Invalid composer.json at ' . $composer_json_path);
+            }
+        }
+        foreach ([
+            "decimal",
+            "dom",
+            "ds",
+            "geos",
+            "mongodb",
+            "mysqli",
+            "pdo",
+            "soap",
+            "xdebug",
+        ] as $ext) {
+            $config->php_extensions[$ext] = isset($composer_json["require"]["ext-$ext"]);
+        }
+
+        if ($config->load_xdebug_stub !== null) {
+            $config->php_extensions[$ext] = $config->load_xdebug_stub;
+        }
+
         if (isset($config_xml['phpVersion'])) {
             $config->configured_php_version = (string) $config_xml['phpVersion'];
         }
@@ -1967,7 +2020,6 @@ class Config
             $dir_lvl_2 . DIRECTORY_SEPARATOR . 'stubs' . DIRECTORY_SEPARATOR . 'CoreGenericClasses.phpstub',
             $dir_lvl_2 . DIRECTORY_SEPARATOR . 'stubs' . DIRECTORY_SEPARATOR . 'CoreGenericIterators.phpstub',
             $dir_lvl_2 . DIRECTORY_SEPARATOR . 'stubs' . DIRECTORY_SEPARATOR . 'CoreImmutableClasses.phpstub',
-            $dir_lvl_2 . DIRECTORY_SEPARATOR . 'stubs' . DIRECTORY_SEPARATOR . 'DOM.phpstub',
             $dir_lvl_2 . DIRECTORY_SEPARATOR . 'stubs' . DIRECTORY_SEPARATOR . 'Reflection.phpstub',
             $dir_lvl_2 . DIRECTORY_SEPARATOR . 'stubs' . DIRECTORY_SEPARATOR . 'SPL.phpstub',
         ];
@@ -1982,39 +2034,11 @@ class Config
             $this->internal_stubs[] = $stringable_path;
         }
 
-        if (extension_loaded('PDO')) {
-            $ext_pdo_path = $dir_lvl_2 . DIRECTORY_SEPARATOR . 'stubs' . DIRECTORY_SEPARATOR . 'pdo.phpstub';
-            $this->internal_stubs[] = $ext_pdo_path;
-        }
-
-        if (extension_loaded('soap')) {
-            $ext_soap_path = $dir_lvl_2 . DIRECTORY_SEPARATOR . 'stubs' . DIRECTORY_SEPARATOR . 'soap.phpstub';
-            $this->internal_stubs[] = $ext_soap_path;
-        }
-
-        if (extension_loaded('ds')) {
-            $ext_ds_path = $dir_lvl_2 . DIRECTORY_SEPARATOR . 'stubs' . DIRECTORY_SEPARATOR . 'ext-ds.phpstub';
-            $this->internal_stubs[] = $ext_ds_path;
-        }
-
-        if (extension_loaded('mongodb')) {
-            $ext_mongodb_path = $dir_lvl_2 . DIRECTORY_SEPARATOR . 'stubs' . DIRECTORY_SEPARATOR . 'mongodb.phpstub';
-            $this->internal_stubs[] = $ext_mongodb_path;
-        }
-
-        if ($this->load_xdebug_stub) {
-            $xdebug_stub_path = $dir_lvl_2 . DIRECTORY_SEPARATOR . 'stubs' . DIRECTORY_SEPARATOR . 'Xdebug.phpstub';
-            $this->internal_stubs[] = $xdebug_stub_path;
-        }
-
-        if (extension_loaded('mysqli')) {
-            $ext_mysqli_path = $dir_lvl_2 . DIRECTORY_SEPARATOR . 'stubs' . DIRECTORY_SEPARATOR . 'mysqli.phpstub';
-            $this->internal_stubs[] = $ext_mysqli_path;
-        }
-
-        if (extension_loaded('decimal')) {
-            $ext_decimal_path = $dir_lvl_2 . DIRECTORY_SEPARATOR . 'stubs' . DIRECTORY_SEPARATOR . 'decimal.phpstub';
-            $this->internal_stubs[] = $ext_decimal_path;
+        foreach ($this->php_extensions as $ext => $enabled) {
+            if ($enabled) {
+                $this->internal_stubs[] = $dir_lvl_2 . DIRECTORY_SEPARATOR . "stubs"
+                    . DIRECTORY_SEPARATOR . "extensions" . DIRECTORY_SEPARATOR . "$ext.phpstub";
+            }
         }
 
         foreach ($this->internal_stubs as $stub_path) {
diff --git a/src/Psalm/Internal/Provider/ReturnTypeProvider/PdoStatementReturnTypeProvider.php b/src/Psalm/Internal/Provider/ReturnTypeProvider/PdoStatementReturnTypeProvider.php
index 1d2521ea0..6ef85193a 100644
--- a/src/Psalm/Internal/Provider/ReturnTypeProvider/PdoStatementReturnTypeProvider.php
+++ b/src/Psalm/Internal/Provider/ReturnTypeProvider/PdoStatementReturnTypeProvider.php
@@ -2,7 +2,7 @@
 
 namespace Psalm\Internal\Provider\ReturnTypeProvider;
 
-use PDO;
+use Psalm\Config;
 use Psalm\Plugin\EventHandler\Event\MethodReturnTypeProviderEvent;
 use Psalm\Plugin\EventHandler\MethodReturnTypeProviderInterface;
 use Psalm\Type;
@@ -15,8 +15,6 @@ use Psalm\Type\Atomic\TObject;
 use Psalm\Type\Atomic\TScalar;
 use Psalm\Type\Union;
 
-use function class_exists;
-
 /**
  * @internal
  */
@@ -29,11 +27,12 @@ class PdoStatementReturnTypeProvider implements MethodReturnTypeProviderInterfac
 
     public static function getMethodReturnType(MethodReturnTypeProviderEvent $event): ?Union
     {
+        $config = Config::getInstance();
         $source = $event->getSource();
         $call_args = $event->getCallArgs();
         $method_name_lowercase = $event->getMethodNameLowercase();
         if ($method_name_lowercase === 'fetch'
-            && class_exists('PDO')
+            && $config->php_extensions["pdo"]
             && isset($call_args[0])
             && ($first_arg_type = $source->getNodeTypeProvider()->getType($call_args[0]->value))
             && $first_arg_type->isSingleIntLiteral()
@@ -41,7 +40,7 @@ class PdoStatementReturnTypeProvider implements MethodReturnTypeProviderInterfac
             $fetch_mode = $first_arg_type->getSingleIntLiteral()->value;
 
             switch ($fetch_mode) {
-                case PDO::FETCH_ASSOC: // array<string,scalar|null>|false
+                case 2: // PDO::FETCH_ASSOC - array<string,scalar|null>|false
                     return new Union([
                         new TArray([
                             Type::getString(),
@@ -53,7 +52,7 @@ class PdoStatementReturnTypeProvider implements MethodReturnTypeProviderInterfac
                         new TFalse(),
                     ]);
 
-                case PDO::FETCH_BOTH: // array<array-key,scalar|null>|false
+                case 4: // PDO::FETCH_BOTH - array<array-key,scalar|null>|false
                     return new Union([
                         new TArray([
                             Type::getArrayKey(),
@@ -65,16 +64,16 @@ class PdoStatementReturnTypeProvider implements MethodReturnTypeProviderInterfac
                         new TFalse(),
                     ]);
 
-                case PDO::FETCH_BOUND: // bool
+                case 6: // PDO::FETCH_BOUND - bool
                     return Type::getBool();
 
-                case PDO::FETCH_CLASS: // object|false
+                case 8: // PDO::FETCH_CLASS - object|false
                     return new Union([
                         new TObject(),
                         new TFalse(),
                     ]);
 
-                case PDO::FETCH_LAZY: // object|false
+                case 1: // PDO::FETCH_LAZY - object|false
                     // This actually returns a PDORow object, but that class is
                     // undocumented, and its attributes are all dynamic anyway
                     return new Union([
@@ -82,7 +81,7 @@ class PdoStatementReturnTypeProvider implements MethodReturnTypeProviderInterfac
                         new TFalse(),
                     ]);
 
-                case PDO::FETCH_NAMED: // array<string, scalar|list<scalar>>|false
+                case 11: // PDO::FETCH_NAMED - array<string, scalar|list<scalar>>|false
                     return new Union([
                         new TArray([
                             Type::getString(),
@@ -94,7 +93,7 @@ class PdoStatementReturnTypeProvider implements MethodReturnTypeProviderInterfac
                         new TFalse(),
                     ]);
 
-                case PDO::FETCH_NUM: // list<scalar|null>|false
+                case 3: // PDO::FETCH_NUM - list<scalar|null>|false
                     return new Union([
                         new TList(
                             new Union([
@@ -105,7 +104,7 @@ class PdoStatementReturnTypeProvider implements MethodReturnTypeProviderInterfac
                         new TFalse(),
                     ]);
 
-                case PDO::FETCH_OBJ: // stdClass|false
+                case 5: // PDO::FETCH_OBJ - stdClass|false
                     return new Union([
                         new TNamedObject('stdClass'),
                         new TFalse(),
diff --git a/src/Psalm/Internal/Provider/ReturnTypeProvider/PdoStatementSetFetchMode.php b/src/Psalm/Internal/Provider/ReturnTypeProvider/PdoStatementSetFetchMode.php
index cd88b1427..c8eba4361 100644
--- a/src/Psalm/Internal/Provider/ReturnTypeProvider/PdoStatementSetFetchMode.php
+++ b/src/Psalm/Internal/Provider/ReturnTypeProvider/PdoStatementSetFetchMode.php
@@ -2,7 +2,6 @@
 
 namespace Psalm\Internal\Provider\ReturnTypeProvider;
 
-use PDO;
 use Psalm\Internal\Analyzer\Statements\ExpressionAnalyzer;
 use Psalm\Internal\Analyzer\StatementsAnalyzer;
 use Psalm\Plugin\EventHandler\Event\MethodParamsProviderEvent;
@@ -62,7 +61,7 @@ class PdoStatementSetFetchMode implements MethodParamsProviderInterface
                 $value = $first_call_arg_type->getSingleIntLiteral()->value;
 
                 switch ($value) {
-                    case PDO::FETCH_COLUMN:
+                    case 7: // PDO::FETCH_COLUMN
                         $params[] = new FunctionLikeParameter(
                             'colno',
                             false,
@@ -73,7 +72,7 @@ class PdoStatementSetFetchMode implements MethodParamsProviderInterface
                         );
                         break;
 
-                    case PDO::FETCH_CLASS:
+                    case 8: // PDO::FETCH_CLASS
                         $params[] = new FunctionLikeParameter(
                             'classname',
                             false,
@@ -93,7 +92,7 @@ class PdoStatementSetFetchMode implements MethodParamsProviderInterface
                         );
                         break;
 
-                    case PDO::FETCH_INTO:
+                    case 9: // PDO::FETCH_INTO
                         $params[] = new FunctionLikeParameter(
                             'object',
                             false,
diff --git a/stubs/decimal.phpstub b/stubs/extensions/decimal.phpstub
similarity index 100%
rename from stubs/decimal.phpstub
rename to stubs/extensions/decimal.phpstub
diff --git a/stubs/DOM.phpstub b/stubs/extensions/dom.phpstub
similarity index 100%
rename from stubs/DOM.phpstub
rename to stubs/extensions/dom.phpstub
diff --git a/stubs/ext-ds.phpstub b/stubs/extensions/ds.phpstub
similarity index 100%
rename from stubs/ext-ds.phpstub
rename to stubs/extensions/ds.phpstub
diff --git a/stubs/ext-geos.phpstub b/stubs/extensions/geos.phpstub
similarity index 100%
rename from stubs/ext-geos.phpstub
rename to stubs/extensions/geos.phpstub
diff --git a/stubs/extensions/gmp.phpstub b/stubs/extensions/gmp.phpstub
new file mode 100644
index 000000000..6a621bc0d
--- /dev/null
+++ b/stubs/extensions/gmp.phpstub
@@ -0,0 +1,11 @@
+<?php
+
+class GMP implements Serializable {
+    private function __construct() {}
+
+    public function __toString(): string {}
+
+    public function serialize(): string {}
+
+    public function unserialize(string $data): void {}
+}
diff --git a/stubs/mongodb.phpstub b/stubs/extensions/mongodb.phpstub
similarity index 100%
rename from stubs/mongodb.phpstub
rename to stubs/extensions/mongodb.phpstub
diff --git a/stubs/mysqli.phpstub b/stubs/extensions/mysqli.phpstub
similarity index 100%
rename from stubs/mysqli.phpstub
rename to stubs/extensions/mysqli.phpstub
diff --git a/stubs/extensions/pdo.phpstub b/stubs/extensions/pdo.phpstub
new file mode 100644
index 000000000..5ed1439ff
--- /dev/null
+++ b/stubs/extensions/pdo.phpstub
@@ -0,0 +1,153 @@
+<?php
+
+class PDO
+{
+    public const PARAM_NULL = 0;
+    public const PARAM_INT = 1;
+    public const PARAM_STR = 2;
+    public const PARAM_LOB = 3;
+    public const PARAM_STMT = 4;
+    public const PARAM_BOOL = 5;
+    // public const PARAM_STR_NATL = 1073741824; since 7.2
+    // public const PARAM_STR_CHAR = 536870912; since 7.2
+    public const PARAM_INPUT_OUTPUT = 2147483648;
+    // public const FETCH_DEFAULT = 0; since 8.0.7
+    public const FETCH_LAZY = 1;
+    public const FETCH_ASSOC = 2;
+    public const FETCH_NAMED = 11;
+    public const FETCH_NUM = 3;
+    public const FETCH_BOTH = 4;
+    public const FETCH_OBJ = 5;
+    public const FETCH_BOUND = 6;
+    public const FETCH_COLUMN = 7;
+    public const FETCH_CLASS = 8;
+    public const FETCH_INTO = 9;
+    public const FETCH_FUNC = 10;
+    public const FETCH_GROUP = 65536;
+    public const FETCH_UNIQUE = 196608;
+    public const FETCH_KEY_PAIR = 12;
+    public const FETCH_CLASSTYPE = 262144;
+    public const FETCH_SERIALIZE = 524288; // Deprecated 8.1
+    public const FETCH_PROPS_LATE = 1048576;
+    public const ATTR_AUTOCOMMIT = 0;
+    public const ATTR_PREFETCH = 1;
+    public const ATTR_TIMEOUT = 2;
+    public const ATTR_ERRMODE = 3;
+    public const ATTR_SERVER_VERSION = 4;
+    public const ATTR_CLIENT_VERSION = 5;
+    public const ATTR_SERVER_INFO = 6;
+    public const ATTR_CONNECTION_STATUS = 7;
+    public const ATTR_CASE = 8;
+    public const ATTR_CURSOR_NAME = 9;
+    public const ATTR_CURSOR = 10;
+    public const ATTR_DRIVER_NAME = 16;
+    public const ATTR_ORACLE_NULLS = 11;
+    public const ATTR_PERSISTENT = 12;
+    public const ATTR_STATEMENT_CLASS = 13;
+    public const ATTR_FETCH_CATALOG_NAMES = 15;
+    public const ATTR_FETCH_TABLE_NAMES = 14;
+    public const ATTR_STRINGIFY_FETCHES = 17;
+    public const ATTR_MAX_COLUMN_LEN = 18;
+    public const ATTR_DEFAULT_FETCH_MODE = 19;
+    public const ATTR_EMULATE_PREPARES = 20;
+    // public const ATTR_DEFAULT_STR_PARAM = 21; since 7.2
+    public const ERRMODE_SILENT = 0;
+    public const ERRMODE_WARNING = 1;
+    public const ERRMODE_EXCEPTION = 2;
+    public const CASE_NATURAL = 0;
+    public const CASE_LOWER = 2;
+    public const CASE_UPPER = 1;
+    public const NULL_NATURAL = 0;
+    public const NULL_EMPTY_STRING = 1;
+    public const NULL_TO_STRING = 2;
+    public const FETCH_ORI_NEXT = 0;
+    public const FETCH_ORI_PRIOR = 1;
+    public const FETCH_ORI_FIRST = 2;
+    public const FETCH_ORI_LAST = 3;
+    public const FETCH_ORI_ABS = 4;
+    public const FETCH_ORI_REL = 5;
+    public const CURSOR_FWDONLY = 0;
+    public const CURSOR_SCROLL = 1;
+    public const ERR_NONE = 00000;
+    public const PARAM_EVT_ALLOC = 0;
+    public const PARAM_EVT_FREE = 1;
+    public const PARAM_EVT_EXEC_PRE = 2;
+    public const PARAM_EVT_EXEC_POST = 3;
+    public const PARAM_EVT_FETCH_PRE = 4;
+    public const PARAM_EVT_FETCH_POST = 5;
+    public const PARAM_EVT_NORMALIZE = 6;
+    // public const SQLITE_DETERMINISTIC = ???; since 7.1.4 with pdo_sqlite
+
+    public function __construct(
+        string $dsn,
+        ?string $username = null,
+        ?string $password = null,
+        ?array $options = null
+    ) {}
+
+    public function beginTransaction(): bool {}
+
+    public function commit(): bool {}
+
+    public function errorCode(): ?string {}
+
+    public function errorInfo(): array {}
+
+    /**
+     * @psalm-taint-sink sql $statement
+     *
+     * @return int|false
+     */
+    public function exec(string $statement) {}
+
+    /** @return bool|int|string|array|null */
+    public function getAttribute(int $attribute) {}
+
+    public static function getAvailableDrivers(): array {}
+
+    public function inTransaction(): bool {}
+
+    /** @return string|false */
+    public function lastInsertId(?string $name = null) {}
+
+    /**
+     * @psalm-taint-sink sql $query
+     *
+     * @return PDOStatement|false
+     */
+    public function prepare(string $query, array $options = []) {}
+
+    /**
+     * @psalm-taint-sink sql $query
+     *
+     * @return PDOStatement|false
+     */
+    public function query(string $query, ?int $fetchMode = null) {}
+
+    /**
+     * @return string|false
+     */
+    public function quote(string $string, int $type = PDO::PARAM_STR) {}
+
+    public function rollBack(): bool {}
+
+    public function setAttribute(int $attribute, mixed $value): bool {}
+}
+
+/**
+ * @template TValue
+ *
+ * @template-implements Traversable<int, TValue>
+ */
+class PDOStatement implements Traversable
+{
+    /**
+     * @psalm-taint-sink callable $class
+     *
+     * @template T of object
+     * @param class-string<T> $class
+     * @param array $ctorArgs
+     * @return false|T
+     */
+    public function fetchObject($class = \stdclass::class, array $ctorArgs = array()) {}
+}
diff --git a/stubs/soap.phpstub b/stubs/extensions/soap.phpstub
similarity index 100%
rename from stubs/soap.phpstub
rename to stubs/extensions/soap.phpstub
diff --git a/stubs/Xdebug.phpstub b/stubs/extensions/xdebug.phpstub
similarity index 100%
rename from stubs/Xdebug.phpstub
rename to stubs/extensions/xdebug.phpstub
diff --git a/stubs/pdo.phpstub b/stubs/pdo.phpstub
deleted file mode 100644
index 0abf50533..000000000
--- a/stubs/pdo.phpstub
+++ /dev/null
@@ -1,19 +0,0 @@
-<?php
-
-/**
- * @template TValue
- *
- * @template-implements Traversable<int, TValue>
- */
-class PDOStatement implements Traversable
-{
-    /**
-     * @psalm-taint-sink callable $class
-     *
-     * @template T of object
-     * @param class-string<T> $class
-     * @param array $ctorArgs
-     * @return false|T
-     */
-    public function fetchObject($class = \stdclass::class, array $ctorArgs = array()) {}
-}
diff --git a/tests/BinaryOperationTest.php b/tests/BinaryOperationTest.php
index 2f2e37f19..9b268caf1 100644
--- a/tests/BinaryOperationTest.php
+++ b/tests/BinaryOperationTest.php
@@ -8,8 +8,6 @@ use Psalm\Exception\CodeException;
 use Psalm\Tests\Traits\InvalidCodeAnalysisTestTrait;
 use Psalm\Tests\Traits\ValidCodeAnalysisTestTrait;
 
-use function class_exists;
-
 use const DIRECTORY_SEPARATOR;
 
 class BinaryOperationTest extends TestCase
@@ -19,10 +17,6 @@ class BinaryOperationTest extends TestCase
 
     public function testGMPOperations(): void
     {
-        if (class_exists('GMP') === false) {
-            $this->markTestSkipped('Cannot run test, base class "GMP" does not exist!');
-        }
-
         $this->addFile(
             'somefile.php',
             '<?php
@@ -88,10 +82,6 @@ class BinaryOperationTest extends TestCase
 
     public function testDecimalOperations(): void
     {
-        if (!class_exists('Decimal\\Decimal')) {
-            $this->markTestSkipped('Cannot run test, base class "Decimal\\Decimal" does not exist!');
-        }
-
         $this->addFile(
             'somefile.php',
             '<?php
diff --git a/tests/ClassTest.php b/tests/ClassTest.php
index f0b0ef0ca..45e767a3f 100644
--- a/tests/ClassTest.php
+++ b/tests/ClassTest.php
@@ -5,8 +5,6 @@ namespace Psalm\Tests;
 use Psalm\Tests\Traits\InvalidCodeAnalysisTestTrait;
 use Psalm\Tests\Traits\ValidCodeAnalysisTestTrait;
 
-use function class_exists;
-
 class ClassTest extends TestCase
 {
     use InvalidCodeAnalysisTestTrait;
@@ -14,10 +12,6 @@ class ClassTest extends TestCase
 
     public function testExtendsMysqli(): void
     {
-        if (class_exists('mysqli') === false) {
-            $this->markTestSkipped('Cannot run test, base class "mysqli" does not exist!');
-        }
-
         $this->addFile(
             'somefile.php',
             '<?php
diff --git a/tests/MethodCallTest.php b/tests/MethodCallTest.php
index 9d3eeb449..0102eaf05 100644
--- a/tests/MethodCallTest.php
+++ b/tests/MethodCallTest.php
@@ -6,8 +6,6 @@ use Psalm\Context;
 use Psalm\Tests\Traits\InvalidCodeAnalysisTestTrait;
 use Psalm\Tests\Traits\ValidCodeAnalysisTestTrait;
 
-use function class_exists;
-
 use const DIRECTORY_SEPARATOR;
 
 class MethodCallTest extends TestCase
@@ -17,10 +15,6 @@ class MethodCallTest extends TestCase
 
     public function testExtendDocblockParamType(): void
     {
-        if (class_exists('SoapClient') === false) {
-            $this->markTestSkipped('Cannot run test, base class "SoapClient" does not exist!');
-        }
-
         $this->addFile(
             'somefile.php',
             '<?php
diff --git a/tests/MethodSignatureTest.php b/tests/MethodSignatureTest.php
index fdc937006..d37c6d9b0 100644
--- a/tests/MethodSignatureTest.php
+++ b/tests/MethodSignatureTest.php
@@ -7,8 +7,6 @@ use Psalm\Exception\CodeException;
 use Psalm\Tests\Traits\InvalidCodeAnalysisTestTrait;
 use Psalm\Tests\Traits\ValidCodeAnalysisTestTrait;
 
-use function class_exists;
-
 use const DIRECTORY_SEPARATOR;
 
 class MethodSignatureTest extends TestCase
@@ -18,10 +16,6 @@ class MethodSignatureTest extends TestCase
 
     public function testExtendSoapClientWithDocblockTypes(): void
     {
-        if (class_exists('SoapClient') === false) {
-            $this->markTestSkipped('Cannot run test, base class "SoapClient" does not exist!');
-        }
-
         $this->addFile(
             'somefile.php',
             '<?php
@@ -52,10 +46,6 @@ class MethodSignatureTest extends TestCase
 
     public function testExtendSoapClientWithNoDocblockTypes(): void
     {
-        if (class_exists('SoapClient') === false) {
-            $this->markTestSkipped('Cannot run test, base class "SoapClient" does not exist!');
-        }
-
         $this->addFile(
             'somefile.php',
             '<?php
@@ -78,10 +68,6 @@ class MethodSignatureTest extends TestCase
 
     public function testExtendSoapClientWithParamType(): void
     {
-        if (class_exists('SoapClient') === false) {
-            $this->markTestSkipped('Cannot run test, base class "SoapClient" does not exist!');
-        }
-
         $this->addFile(
             'somefile.php',
             '<?php
@@ -249,9 +235,6 @@ class MethodSignatureTest extends TestCase
     {
         $this->expectExceptionMessage('ImplementedParamTypeMismatch');
         $this->expectException(CodeException::class);
-        if (class_exists('SoapClient') === false) {
-            $this->markTestSkipped('Cannot run test, base class "SoapClient" does not exist!');
-        }
 
         $this->addFile(
             'somefile.php',
@@ -286,10 +269,6 @@ class MethodSignatureTest extends TestCase
         $this->expectException(CodeException::class);
         $this->expectExceptionMessage('MethodSignatureMismatch');
 
-        if (class_exists('SoapClient') === false) {
-            $this->markTestSkipped('Cannot run test, base class "SoapClient" does not exist!');
-        }
-
         $this->addFile(
             'somefile.php',
             '<?php
diff --git a/tests/TestConfig.php b/tests/TestConfig.php
index 26db8a8ca..b442c22bd 100644
--- a/tests/TestConfig.php
+++ b/tests/TestConfig.php
@@ -20,6 +20,10 @@ class TestConfig extends Config
     {
         parent::__construct();
 
+        foreach ($this->php_extensions as $ext => $_enabled) {
+            $this->php_extensions[$ext] = true;
+        }
+
         $this->throw_exception = true;
         $this->use_docblock_types = true;
         $this->level = 1;
