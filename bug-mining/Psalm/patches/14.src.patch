diff --git a/src/Psalm/Internal/Provider/FileStorageProvider.php b/src/Psalm/Internal/Provider/FileStorageProvider.php
index 6454adef2..2cd1c2f05 100644
--- a/src/Psalm/Internal/Provider/FileStorageProvider.php
+++ b/src/Psalm/Internal/Provider/FileStorageProvider.php
@@ -74,21 +74,23 @@ class FileStorageProvider
             return true;
         }
 
-        if (!$this->cache) {
+        if ($file_contents === null) {
             return false;
         }
 
-        if ($file_contents !== null) {
-            $cached_value = $this->cache->getLatestFromCache($file_path, $file_contents);
+        if (!$this->cache) {
+            return false;
+        }
 
-            if (!$cached_value) {
-                return false;
-            }
+        $cached_value = $this->cache->getLatestFromCache($file_path, $file_contents);
 
-            self::$storage[$file_path] = $cached_value;
-            self::$new_storage[$file_path] = $cached_value;
+        if (!$cached_value) {
+            return false;
         }
 
+        self::$storage[$file_path] = $cached_value;
+        self::$new_storage[$file_path] = $cached_value;
+
         return true;
     }
 
