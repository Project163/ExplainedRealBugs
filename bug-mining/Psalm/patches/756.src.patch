diff --git a/src/Psalm/Internal/Analyzer/FunctionLikeAnalyzer.php b/src/Psalm/Internal/Analyzer/FunctionLikeAnalyzer.php
index 90ac54589..68871ce7f 100644
--- a/src/Psalm/Internal/Analyzer/FunctionLikeAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/FunctionLikeAnalyzer.php
@@ -41,6 +41,7 @@ use function array_search;
 use function array_keys;
 use function end;
 use Psalm\Internal\Taint\TaintNode;
+use Psalm\Storage\FunctionStorage;
 
 /**
  * @internal
@@ -341,14 +342,20 @@ abstract class FunctionLikeAnalyzer extends SourceAnalyzer
                 $closure_return_type = Type::getMixed();
             }
 
+            $closure_type = new Type\Atomic\TFn(
+                'Closure',
+                $storage->params,
+                $closure_return_type
+            );
+
+            if ($storage instanceof FunctionStorage) {
+                $closure_type->byref_uses = $storage->byref_uses;
+            }
+
             $type_provider->setType(
                 $this->function,
                 new Type\Union([
-                    new Type\Atomic\TFn(
-                        'Closure',
-                        $storage->params,
-                        $closure_return_type
-                    ),
+                    $closure_type,
                 ])
             );
         }
diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/Call/FunctionCallAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/Call/FunctionCallAnalyzer.php
index ae5d33c89..63fc70ab3 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/Call/FunctionCallAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/Call/FunctionCallAnalyzer.php
@@ -112,15 +112,18 @@ class FunctionCallAnalyzer extends CallAnalyzer
             }
         }
 
+        $byref_uses = [];
+
         if ($function_name instanceof PhpParser\Node\Expr) {
-            list($expr_function_exists, $expr_function_name, $expr_function_params) = self::getAnalyzeNamedExpression(
-                $statements_analyzer,
-                $codebase,
-                $stmt,
-                $real_stmt,
-                $function_name,
-                $context
-            );
+            list($expr_function_exists, $expr_function_name, $expr_function_params, $byref_uses)
+                = self::getAnalyzeNamedExpression(
+                    $statements_analyzer,
+                    $codebase,
+                    $stmt,
+                    $real_stmt,
+                    $function_name,
+                    $context
+                );
 
             if ($expr_function_exists === false) {
                 return true;
@@ -473,6 +476,13 @@ class FunctionCallAnalyzer extends CallAnalyzer
             }
         }
 
+        if ($byref_uses) {
+            foreach ($byref_uses as $byref_use_var => $_) {
+                $context->vars_in_scope['$' . $byref_use_var] = Type::getMixed();
+                $context->vars_possibly_in_scope['$' . $byref_use_var] = true;
+            }
+        }
+
         if ($function_name instanceof PhpParser\Node\Name) {
             self::handleNamedFunction(
                 $statements_analyzer,
@@ -493,7 +503,12 @@ class FunctionCallAnalyzer extends CallAnalyzer
     }
 
     /**
-     * @return  array{?bool, ?PhpParser\Node\Expr|PhpParser\Node\Name, array<int, FunctionLikeParameter>|null}
+     * @return  array{
+     *     ?bool,
+     *     ?PhpParser\Node\Expr|PhpParser\Node\Name,
+     *     array<int, FunctionLikeParameter>|null,
+     *     ?array<string, bool>
+     * }
      */
     private static function getAnalyzeNamedExpression(
         StatementsAnalyzer $statements_analyzer,
@@ -513,11 +528,13 @@ class FunctionCallAnalyzer extends CallAnalyzer
         if (ExpressionAnalyzer::analyze($statements_analyzer, $function_name, $context) === false) {
             $context->inside_call = $was_in_call;
 
-            return [false, null, null];
+            return [false, null, null, null];
         }
 
         $context->inside_call = $was_in_call;
 
+        $byref_uses = [];
+
         if ($stmt_name_type = $statements_analyzer->node_data->getType($function_name)) {
             if ($stmt_name_type->isNull()) {
                 if (IssueBuffer::accepts(
@@ -530,7 +547,7 @@ class FunctionCallAnalyzer extends CallAnalyzer
                     // fall through
                 }
 
-                return [false, null, null];
+                return [false, null, null, null];
             }
 
             if ($stmt_name_type->isNullable()) {
@@ -569,6 +586,10 @@ class FunctionCallAnalyzer extends CallAnalyzer
                         );
                     }
 
+                    if ($var_type_part instanceof Type\Atomic\TFn) {
+                        $byref_uses += $var_type_part->byref_uses;
+                    }
+
                     $function_exists = true;
                     $has_valid_function_call_type = true;
                 } elseif ($var_type_part instanceof TTemplateParam && $var_type_part->as->hasCallableType()) {
@@ -689,7 +710,7 @@ class FunctionCallAnalyzer extends CallAnalyzer
                     }
                 }
 
-                return [false, null, null];
+                return [false, null, null, null];
             }
         }
 
@@ -697,7 +718,12 @@ class FunctionCallAnalyzer extends CallAnalyzer
             $statements_analyzer->node_data->setType($real_stmt, Type::getMixed());
         }
 
-        return [$function_exists, $explicit_function_name ?: $function_name, $function_params];
+        return [
+            $function_exists,
+            $explicit_function_name ?: $function_name,
+            $function_params,
+            $byref_uses
+        ];
     }
 
     private static function analyzeInvokeCall(
diff --git a/src/Psalm/Internal/Codebase/Functions.php b/src/Psalm/Internal/Codebase/Functions.php
index b6c1c67f8..4e7d576bc 100644
--- a/src/Psalm/Internal/Codebase/Functions.php
+++ b/src/Psalm/Internal/Codebase/Functions.php
@@ -11,7 +11,7 @@ use Psalm\Internal\Provider\FunctionExistenceProvider;
 use Psalm\Internal\Provider\FunctionParamsProvider;
 use Psalm\Internal\Provider\FunctionReturnTypeProvider;
 use Psalm\StatementsSource;
-use Psalm\Storage\FunctionLikeStorage;
+use Psalm\Storage\FunctionStorage;
 use function strpos;
 use function strtolower;
 use function substr;
@@ -30,7 +30,7 @@ class Functions
     private $file_storage_provider;
 
     /**
-     * @var array<lowercase-string, FunctionLikeStorage>
+     * @var array<lowercase-string, FunctionStorage>
      */
     private static $stubbed_functions;
 
@@ -67,7 +67,7 @@ class Functions
         string $function_id,
         ?string $root_file_path = null,
         ?string $checked_file_path = null
-    ) : FunctionLikeStorage {
+    ) : FunctionStorage {
         if ($function_id[0] === '\\') {
             $function_id = substr($function_id, 1);
         }
@@ -143,11 +143,10 @@ class Functions
 
     /**
      * @param string $function_id
-     * @param FunctionLikeStorage $storage
      *
      * @return void
      */
-    public function addGlobalFunction($function_id, FunctionLikeStorage $storage)
+    public function addGlobalFunction($function_id, FunctionStorage $storage)
     {
         self::$stubbed_functions[strtolower($function_id)] = $storage;
     }
@@ -163,7 +162,7 @@ class Functions
     }
 
     /**
-     * @return array<string, FunctionLikeStorage>
+     * @return array<string, FunctionStorage>
      */
     public function getAllStubbedFunctions()
     {
diff --git a/src/Psalm/Internal/Codebase/Reflection.php b/src/Psalm/Internal/Codebase/Reflection.php
index 163082f72..7e6e3eafe 100644
--- a/src/Psalm/Internal/Codebase/Reflection.php
+++ b/src/Psalm/Internal/Codebase/Reflection.php
@@ -6,7 +6,7 @@ use Psalm\Codebase;
 use Psalm\Internal\Analyzer\ClassLikeAnalyzer;
 use Psalm\Internal\Provider\ClassLikeStorageProvider;
 use Psalm\Storage\FunctionLikeParameter;
-use Psalm\Storage\FunctionLikeStorage;
+use Psalm\Storage\FunctionStorage;
 use Psalm\Storage\MethodStorage;
 use Psalm\Storage\PropertyStorage;
 use Psalm\Type;
@@ -30,7 +30,7 @@ class Reflection
     private $codebase;
 
     /**
-     * @var array<string, FunctionLikeStorage>
+     * @var array<string, FunctionStorage>
      */
     private static $builtin_functions = [];
 
@@ -356,7 +356,7 @@ class Reflection
                 return;
             }
 
-            $storage = self::$builtin_functions[$function_id] = new FunctionLikeStorage();
+            $storage = self::$builtin_functions[$function_id] = new FunctionStorage();
 
             if (InternalCallMapHandler::inCallMap($function_id)) {
                 $callmap_callable = \Psalm\Internal\Codebase\InternalCallMapHandler::getCallableFromCallMapById(
@@ -508,7 +508,7 @@ class Reflection
     /**
      * @param  string  $function_id
      *
-     * @return FunctionLikeStorage
+     * @return FunctionStorage
      */
     public function getFunctionStorage($function_id)
     {
diff --git a/src/Psalm/Internal/PhpVisitor/ReflectorVisitor.php b/src/Psalm/Internal/PhpVisitor/ReflectorVisitor.php
index e1f4767de..452bdfe16 100644
--- a/src/Psalm/Internal/PhpVisitor/ReflectorVisitor.php
+++ b/src/Psalm/Internal/PhpVisitor/ReflectorVisitor.php
@@ -58,6 +58,7 @@ use Psalm\Storage\ClassLikeStorage;
 use Psalm\Storage\FileStorage;
 use Psalm\Storage\FunctionLikeParameter;
 use Psalm\Storage\FunctionLikeStorage;
+use Psalm\Storage\FunctionStorage;
 use Psalm\Storage\MethodStorage;
 use Psalm\Storage\PropertyStorage;
 use Psalm\Type;
@@ -66,6 +67,7 @@ use function strtolower;
 use function substr;
 use function trim;
 use function preg_split;
+use php_user_filter;
 
 /**
  * @internal
@@ -1658,7 +1660,7 @@ class ReflectorVisitor extends PhpParser\NodeVisitorAbstract implements PhpParse
                 ($this->aliases->namespace ? $this->aliases->namespace . '\\' : '') . $stmt->name->name;
             $function_id = strtolower($cased_function_id);
 
-            $storage = new FunctionLikeStorage();
+            $storage = new FunctionStorage();
 
             if ($this->codebase->register_stub_files || $this->codebase->register_autoload_files) {
                 if (isset($this->file_storage->functions[$function_id])
@@ -1839,12 +1841,24 @@ class ReflectorVisitor extends PhpParser\NodeVisitorAbstract implements PhpParse
             } else {
                 $storage->visibility = ClassLikeAnalyzer::VISIBILITY_PUBLIC;
             }
-        } else {
+        } elseif ($stmt instanceof PhpParser\Node\Expr\Closure
+            || $stmt instanceof PhpParser\Node\Expr\ArrowFunction
+        ) {
             $function_id = $cased_function_id = strtolower($this->file_path)
                 . ':' . $stmt->getLine()
                 . ':' . (int) $stmt->getAttribute('startFilePos') . ':-:closure';
 
-            $storage = $this->file_storage->functions[$function_id] = new FunctionLikeStorage();
+            $storage = $this->file_storage->functions[$function_id] = new FunctionStorage();
+
+            if ($stmt instanceof PhpParser\Node\Expr\Closure) {
+                foreach ($stmt->uses as $closure_use) {
+                    if ($closure_use->byRef && \is_string($closure_use->var->name)) {
+                        $storage->byref_uses[$closure_use->var->name] = true;
+                    }
+                }
+            }
+        } else {
+            throw new \UnexpectedValueException('Unrecognized functionlike');
         }
 
         $this->functionlike_storages[] = $storage;
diff --git a/src/Psalm/Storage/FileStorage.php b/src/Psalm/Storage/FileStorage.php
index 5f7dbebe2..85f5cdfcc 100644
--- a/src/Psalm/Storage/FileStorage.php
+++ b/src/Psalm/Storage/FileStorage.php
@@ -36,7 +36,7 @@ class FileStorage
     public $file_path;
 
     /**
-     * @var array<string, FunctionLikeStorage>
+     * @var array<string, FunctionStorage>
      */
     public $functions = [];
 
diff --git a/src/Psalm/Storage/FunctionLikeStorage.php b/src/Psalm/Storage/FunctionLikeStorage.php
index 276578b7c..0c69e9425 100644
--- a/src/Psalm/Storage/FunctionLikeStorage.php
+++ b/src/Psalm/Storage/FunctionLikeStorage.php
@@ -7,7 +7,7 @@ use Psalm\CodeLocation;
 use Psalm\Internal\Analyzer\ClassLikeAnalyzer;
 use Psalm\Type;
 
-class FunctionLikeStorage
+abstract class FunctionLikeStorage
 {
     use CustomMetadataTrait;
 
diff --git a/src/Psalm/Storage/FunctionStorage.php b/src/Psalm/Storage/FunctionStorage.php
new file mode 100644
index 000000000..bff2b70f4
--- /dev/null
+++ b/src/Psalm/Storage/FunctionStorage.php
@@ -0,0 +1,14 @@
+<?php
+namespace Psalm\Storage;
+
+use function array_map;
+use function implode;
+use Psalm\CodeLocation;
+use Psalm\Internal\Analyzer\ClassLikeAnalyzer;
+use Psalm\Type;
+
+class FunctionStorage extends FunctionLikeStorage
+{
+    /** @var array<string, bool> */
+    public $byref_uses = [];
+}
diff --git a/src/Psalm/Type/Atomic/TFn.php b/src/Psalm/Type/Atomic/TFn.php
index 1a66761cc..110a55a7a 100644
--- a/src/Psalm/Type/Atomic/TFn.php
+++ b/src/Psalm/Type/Atomic/TFn.php
@@ -8,6 +8,9 @@ class TFn extends TNamedObject
 {
     use CallableTrait;
 
+    /** @var array<string, bool> */
+    public $byref_uses = [];
+
     /**
      * @return bool
      */
diff --git a/tests/CallableTest.php b/tests/CallableTest.php
index fc4a5087f..3b939a70c 100644
--- a/tests/CallableTest.php
+++ b/tests/CallableTest.php
@@ -818,6 +818,16 @@ class CallableTest extends TestCase
 
                     takesCallable(function() { return; });',
             ],
+            'byRefUsesAlwaysMixed' => [
+                '<?php
+                    $callback = function() use (&$isCalled) : void {
+                        $isCalled = true;
+                    };
+                    $isCalled = false;
+                    $callback();
+
+                    if ($isCalled === true) {}'
+            ],
         ];
     }
 
