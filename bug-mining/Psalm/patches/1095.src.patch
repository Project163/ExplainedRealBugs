diff --git a/src/Psalm/Type/Atomic/TKeyedArray.php b/src/Psalm/Type/Atomic/TKeyedArray.php
index 88a40285f..0412c26db 100644
--- a/src/Psalm/Type/Atomic/TKeyedArray.php
+++ b/src/Psalm/Type/Atomic/TKeyedArray.php
@@ -268,7 +268,7 @@ class TKeyedArray extends \Psalm\Type\Atomic
                 $value_type = Type::combineUnionTypes($property, $value_type);
             }
 
-            if (!$value_type->possibly_undefined) {
+            if (!$property->possibly_undefined) {
                 $has_defined_keys = true;
             }
         }
diff --git a/tests/ArrayAssignmentTest.php b/tests/ArrayAssignmentTest.php
index 80b08c8ad..491b5cd84 100644
--- a/tests/ArrayAssignmentTest.php
+++ b/tests/ArrayAssignmentTest.php
@@ -436,6 +436,17 @@ class ArrayAssignmentTest extends TestCase
                     '$foo' => 'array{a: int, b: array{int, int}}',
                 ],
             ],
+            'objectLikeArrayIsNonEmpty' => [
+                '<?php
+                    /**
+                     * @param array{a?: string, b: string} $arg
+                     * @return non-empty-array<string, string>
+                     */
+                    function test(array $arg): array {
+                        return $arg;
+                    }
+                ',
+            ],
             'nestedTKeyedArrayAddition' => [
                 '<?php
                     $foo = [];
