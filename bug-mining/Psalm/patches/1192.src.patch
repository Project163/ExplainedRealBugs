diff --git a/src/Psalm/Internal/Algebra.php b/src/Psalm/Internal/Algebra.php
index 01bf31016..bad362dc4 100644
--- a/src/Psalm/Internal/Algebra.php
+++ b/src/Psalm/Internal/Algebra.php
@@ -457,10 +457,9 @@ class Algebra
                     foreach ($impossible_types as $impossible_type) {
                         $new_clause_possibilities = $grouped_clause->possibilities;
 
-                        if (isset($grouped_clause->possibilities[$var])) {
-                            $new_clause_possibilities[$var][(string)$impossible_type] = $impossible_type;
-
-                            $removed_indexes = [];
+                        if (isset($new_clause_possibilities[$var])) {
+                            $impossible_type_string = (string)$impossible_type;
+                            $new_clause_possibilities[$var][$impossible_type_string] = $impossible_type;
 
                             foreach ($new_clause_possibilities[$var] as $ak => $av) {
                                 foreach ($new_clause_possibilities[$var] as $bk => $bv) {
@@ -468,33 +467,19 @@ class Algebra
                                         break;
                                     }
 
-                                    if ($av->isNegationOf($bv)) {
-                                        $removed_indexes[$ak] = true;
-                                        $removed_indexes[$bk] = true;
+                                    if ($ak !== $impossible_type_string && $bk !== $impossible_type_string) {
+                                        continue;
                                     }
-                                }
-                            }
-
-                            if ($removed_indexes) {
-                                $new_possibilities = array_diff_key(
-                                    $new_clause_possibilities[$var],
-                                    $removed_indexes
-                                );
 
-                                if (!$new_possibilities) {
-                                    unset($new_clause_possibilities[$var]);
-                                } else {
-                                    $new_clause_possibilities[$var] = $new_possibilities;
+                                    if ($av->isNegationOf($bv)) {
+                                        break 3;
+                                    }
                                 }
                             }
                         } else {
                             $new_clause_possibilities[$var] = [(string)$impossible_type => $impossible_type];
                         }
 
-                        if (!$new_clause_possibilities) {
-                            continue;
-                        }
-
                         $new_clause = new Clause(
                             $new_clause_possibilities,
                             $grouped_clause->creating_conditional_id,
diff --git a/tests/TypeReconciliation/TypeAlgebraTest.php b/tests/TypeReconciliation/TypeAlgebraTest.php
index 800efa523..4930d695a 100644
--- a/tests/TypeReconciliation/TypeAlgebraTest.php
+++ b/tests/TypeReconciliation/TypeAlgebraTest.php
@@ -1180,6 +1180,28 @@ class TypeAlgebraTest extends TestCase
                         if ($a) {}
                     }'
             ],
+            'compareToIntInsideIfDNF' => [
+                'code' => '<?php
+                    function foo(?int $foo): void {
+                        if (($foo && $foo !== 5) || (!$foo && rand(0,1))) {
+                            return;
+                        }
+
+                        if ($foo === null) {}
+                    }'
+            ],
+            'compareToIntInsideIfCNF' => [
+                'code' => '<?php
+                    function baz(?int $foo): void {
+                        if (
+                            (!$foo || $foo !== 5) && ($foo || rand(0,1)) && ($foo !== 5 || rand(0, 1))
+                        ) {
+                            return;
+                        }
+
+                        if ($foo === null) {}
+                    }'
+            ],
         ];
     }
 
