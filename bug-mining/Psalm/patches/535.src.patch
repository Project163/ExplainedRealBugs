diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/Call/StaticCallAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/Call/StaticCallAnalyzer.php
index d0115fe2a..82bf8b972 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/Call/StaticCallAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/Call/StaticCallAnalyzer.php
@@ -15,6 +15,7 @@ use Psalm\Issue\ImpureMethodCall;
 use Psalm\Issue\InvalidStringClass;
 use Psalm\Issue\InternalClass;
 use Psalm\Issue\MixedMethodCall;
+use Psalm\Issue\NonStaticSelfCall;
 use Psalm\Issue\ParentNotFound;
 use Psalm\Issue\UndefinedClass;
 use Psalm\Issue\UndefinedMethod;
@@ -103,11 +104,17 @@ class StaticCallAnalyzer extends \Psalm\Internal\Analyzer\Statements\Expression\
                         $fq_class_name = $context->self;
                     }
                 } else {
-                    $namespace = $statements_analyzer->getNamespace()
-                        ? $statements_analyzer->getNamespace() . '\\'
-                        : '';
+                    if (IssueBuffer::accepts(
+                        new NonStaticSelfCall(
+                            'Cannot use ' . $stmt->class->parts[0] . ' outside class context',
+                            new CodeLocation($statements_analyzer->getSource(), $stmt)
+                        ),
+                        $statements_analyzer->getSuppressedIssues()
+                    )) {
+                        return false;
+                    }
 
-                    $fq_class_name = $namespace . $statements_analyzer->getClassName();
+                    return;
                 }
 
                 if ($context->isPhantomClass($fq_class_name)) {
diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/Fetch/ClassConstFetchAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/Fetch/ClassConstFetchAnalyzer.php
index c42d5d8ce..618e93b9c 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/Fetch/ClassConstFetchAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/Fetch/ClassConstFetchAnalyzer.php
@@ -14,6 +14,7 @@ use Psalm\Issue\CircularReference;
 use Psalm\Issue\DeprecatedClass;
 use Psalm\Issue\DeprecatedConstant;
 use Psalm\Issue\InaccessibleClassConstant;
+use Psalm\Issue\NonStaticSelfCall;
 use Psalm\Issue\ParentNotFound;
 use Psalm\Issue\UndefinedClass;
 use Psalm\Issue\UndefinedConstant;
@@ -47,10 +48,20 @@ class ClassConstFetchAnalyzer
 
             if ($first_part_lc === 'self' || $first_part_lc === 'static') {
                 if (!$context->self) {
-                    throw new \UnexpectedValueException('$context->self cannot be null');
+                    if (IssueBuffer::accepts(
+                        new NonStaticSelfCall(
+                            'Cannot use ' . $first_part_lc . ' outside class context',
+                            new CodeLocation($statements_analyzer->getSource(), $stmt)
+                        ),
+                        $statements_analyzer->getSuppressedIssues()
+                    )) {
+                        return false;
+                    }
+
+                    return;
                 }
 
-                $fq_class_name = (string)$context->self;
+                $fq_class_name = $context->self;
             } elseif ($first_part_lc === 'parent') {
                 $fq_class_name = $statements_analyzer->getParentFQCLN();
 
diff --git a/tests/ClassScopeTest.php b/tests/ClassScopeTest.php
index 0f90e8fa8..9792a416a 100644
--- a/tests/ClassScopeTest.php
+++ b/tests/ClassScopeTest.php
@@ -287,6 +287,20 @@ class ClassScopeTest extends TestCase
                     }',
                 'error_message' => 'InaccessibleMethod',
             ],
+            'noSelfInFunctionConstant' => [
+                '<?php
+                    function foo() : void {
+                        echo self::SOMETHING;
+                    }',
+                'error_message' => 'NonStaticSelfCall',
+            ],
+            'noSelfInFunctionCall' => [
+                '<?php
+                    function foo() : void {
+                        echo self::bar();
+                    }',
+                'error_message' => 'NonStaticSelfCall',
+            ],
         ];
     }
 }
