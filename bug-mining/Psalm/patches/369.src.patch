diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/BinaryOpAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/BinaryOpAnalyzer.php
index aad0dc387..be2169f18 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/BinaryOpAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/BinaryOpAnalyzer.php
@@ -586,7 +586,11 @@ class BinaryOpAnalyzer
                     new CodeLocation($statements_analyzer->getSource(), $stmt->left)
                 );
 
-                $t_if_context->vars_in_scope = $t_if_vars_in_scope_reconciled;
+                foreach ($context->vars_in_scope as $var_id => $_) {
+                    if (isset($t_if_vars_in_scope_reconciled[$var_id])) {
+                        $t_if_context->vars_in_scope[$var_id] = $t_if_vars_in_scope_reconciled[$var_id];
+                    }
+                }
             }
 
             if (!self::hasArrayDimFetch($stmt->left)) {
diff --git a/tests/TypeReconciliation/IssetTest.php b/tests/TypeReconciliation/IssetTest.php
index e268c6b44..efb66dc1e 100644
--- a/tests/TypeReconciliation/IssetTest.php
+++ b/tests/TypeReconciliation/IssetTest.php
@@ -744,6 +744,16 @@ class IssetTest extends \Psalm\Tests\TestCase
                     }',
                 'error_message' => 'NullableReturnStatement',
             ],
+            'undefinedVarInNullCoalesce' => [
+                '<?php
+                    function bar(): void {
+                        $do_baz = $config["do_it"] ?? false;
+                        if ($do_baz) {
+                            baz();
+                        }
+                    }',
+                'UndefinedVariable'
+            ],
         ];
     }
 }
