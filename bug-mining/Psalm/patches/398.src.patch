diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/CallAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/CallAnalyzer.php
index 8ca8d1785..681f557b5 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/CallAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/CallAnalyzer.php
@@ -1281,7 +1281,8 @@ class CallAnalyzer
                         $template_result,
                         $codebase,
                         $arg_value_type,
-                        $context->self ?: 'fn-' . $context->calling_function_id,
+                        $context->self,
+                        $context->calling_function_id,
                         false
                     );
 
@@ -1466,7 +1467,8 @@ class CallAnalyzer
                         $template_result,
                         $codebase,
                         clone $param->default_type,
-                        'fn-' . $context->calling_function_id,
+                        $context->self,
+                        $context->calling_function_id,
                         true
                     );
                 }
@@ -1804,7 +1806,8 @@ class CallAnalyzer
                 $template_result,
                 $codebase,
                 $arg_type_param,
-                $context->self ?: 'fn-' . $context->calling_function_id
+                $context->self,
+                $context->calling_function_id
             );
 
             foreach ($bindable_template_params as $template_type) {
diff --git a/src/Psalm/Internal/Type/UnionTemplateHandler.php b/src/Psalm/Internal/Type/UnionTemplateHandler.php
index a16a74904..45b26b593 100644
--- a/src/Psalm/Internal/Type/UnionTemplateHandler.php
+++ b/src/Psalm/Internal/Type/UnionTemplateHandler.php
@@ -23,6 +23,7 @@ class UnionTemplateHandler
         ?Codebase $codebase,
         ?Union $input_type,
         ?string $calling_class = null,
+        ?string $calling_function = null,
         bool $replace = true,
         bool $add_upper_bound = false,
         int $depth = 0
@@ -43,6 +44,7 @@ class UnionTemplateHandler
                     $codebase,
                     $input_type,
                     $calling_class,
+                    $calling_function,
                     $replace,
                     $add_upper_bound,
                     $depth,
@@ -87,6 +89,7 @@ class UnionTemplateHandler
         ?Codebase $codebase,
         ?Union $input_type,
         ?string $calling_class,
+        ?string $calling_function,
         bool $replace,
         bool $add_upper_bound,
         int $depth,
@@ -106,6 +109,7 @@ class UnionTemplateHandler
                 $key,
                 $input_type,
                 $calling_class,
+                $calling_function,
                 $template_result,
                 $codebase,
                 $replace,
@@ -243,6 +247,7 @@ class UnionTemplateHandler
             $codebase,
             $matching_atomic_type,
             $calling_class,
+            $calling_function,
             $replace,
             $add_upper_bound,
             $depth + 1
@@ -365,6 +370,7 @@ class UnionTemplateHandler
         string $key,
         ?Union $input_type,
         ?string $calling_class,
+        ?string $calling_function,
         TemplateResult $template_result,
         ?Codebase $codebase,
         bool $replace,
@@ -432,6 +438,7 @@ class UnionTemplateHandler
 
                     if ($replacement_atomic_type instanceof Atomic\TTemplateParam
                         && $replacement_atomic_type->defining_class !== $calling_class
+                        && $replacement_atomic_type->defining_class !== 'fn-' . $calling_function
                     ) {
                         foreach ($replacement_atomic_type->as->getTypes() as $nested_type_atomic) {
                             $replacements_found = true;
diff --git a/src/Psalm/Type/Atomic.php b/src/Psalm/Type/Atomic.php
index 4702ad4e6..435500655 100644
--- a/src/Psalm/Type/Atomic.php
+++ b/src/Psalm/Type/Atomic.php
@@ -816,6 +816,7 @@ abstract class Atomic
         Codebase $codebase = null,
         Type\Atomic $input_type = null,
         ?string $calling_class = null,
+        ?string $calling_function = null,
         bool $replace = true,
         bool $add_upper_bound = false,
         int $depth = 0
diff --git a/src/Psalm/Type/Atomic/CallableTrait.php b/src/Psalm/Type/Atomic/CallableTrait.php
index 95a04a3fa..77b044b7f 100644
--- a/src/Psalm/Type/Atomic/CallableTrait.php
+++ b/src/Psalm/Type/Atomic/CallableTrait.php
@@ -199,6 +199,7 @@ trait CallableTrait
         Codebase $codebase = null,
         Atomic $input_type = null,
         ?string $calling_class = null,
+        ?string $calling_function = null,
         bool $replace = true,
         bool $add_upper_bound = false,
         int $depth = 0
@@ -225,6 +226,7 @@ trait CallableTrait
                     $codebase,
                     $input_param_type,
                     $calling_class,
+                    $calling_function,
                     $replace,
                     !$add_upper_bound,
                     $depth
@@ -242,6 +244,7 @@ trait CallableTrait
                 $codebase,
                 $input_type->return_type,
                 $calling_class,
+                $calling_function,
                 $replace,
                 $add_upper_bound
             );
diff --git a/src/Psalm/Type/Atomic/GenericTrait.php b/src/Psalm/Type/Atomic/GenericTrait.php
index e950a6ea9..33ebb479e 100644
--- a/src/Psalm/Type/Atomic/GenericTrait.php
+++ b/src/Psalm/Type/Atomic/GenericTrait.php
@@ -158,6 +158,7 @@ trait GenericTrait
         Codebase $codebase = null,
         Atomic $input_type = null,
         ?string $calling_class = null,
+        ?string $calling_function = null,
         bool $replace = true,
         bool $add_upper_bound = false,
         int $depth = 0
@@ -195,6 +196,7 @@ trait GenericTrait
                 $codebase,
                 $input_type_param,
                 $calling_class,
+                $calling_function,
                 $replace,
                 $add_upper_bound,
                 $depth + 1
diff --git a/src/Psalm/Type/Atomic/ObjectLike.php b/src/Psalm/Type/Atomic/ObjectLike.php
index 1136d8ce7..139e025cc 100644
--- a/src/Psalm/Type/Atomic/ObjectLike.php
+++ b/src/Psalm/Type/Atomic/ObjectLike.php
@@ -324,6 +324,7 @@ class ObjectLike extends \Psalm\Type\Atomic
         Codebase $codebase = null,
         Atomic $input_type = null,
         ?string $calling_class = null,
+        ?string $calling_function = null,
         bool $replace = true,
         bool $add_upper_bound = false,
         int $depth = 0
@@ -345,6 +346,7 @@ class ObjectLike extends \Psalm\Type\Atomic
                 $codebase,
                 $input_type_param,
                 $calling_class,
+                $calling_function,
                 $replace,
                 $add_upper_bound,
                 $depth
diff --git a/src/Psalm/Type/Atomic/TClassStringMap.php b/src/Psalm/Type/Atomic/TClassStringMap.php
index 64f39c9ec..86c0001f7 100644
--- a/src/Psalm/Type/Atomic/TClassStringMap.php
+++ b/src/Psalm/Type/Atomic/TClassStringMap.php
@@ -149,6 +149,7 @@ class TClassStringMap extends \Psalm\Type\Atomic
         Codebase $codebase = null,
         Atomic $input_type = null,
         ?string $calling_class = null,
+        ?string $calling_function = null,
         bool $replace = true,
         bool $add_upper_bound = false,
         int $depth = 0
@@ -185,6 +186,7 @@ class TClassStringMap extends \Psalm\Type\Atomic
                 $codebase,
                 $input_type_param,
                 $calling_class,
+                $calling_function,
                 $replace,
                 $add_upper_bound,
                 $depth + 1
diff --git a/src/Psalm/Type/Atomic/TList.php b/src/Psalm/Type/Atomic/TList.php
index e4ace680f..fbf8c4b65 100644
--- a/src/Psalm/Type/Atomic/TList.php
+++ b/src/Psalm/Type/Atomic/TList.php
@@ -119,6 +119,7 @@ class TList extends \Psalm\Type\Atomic
         Codebase $codebase = null,
         Atomic $input_type = null,
         ?string $calling_class = null,
+        ?string $calling_function = null,
         bool $replace = true,
         bool $add_upper_bound = false,
         int $depth = 0
@@ -155,6 +156,7 @@ class TList extends \Psalm\Type\Atomic
                 $codebase,
                 $input_type_param,
                 $calling_class,
+                $calling_function,
                 $replace,
                 $add_upper_bound,
                 $depth + 1
diff --git a/src/Psalm/Type/Atomic/TObjectWithProperties.php b/src/Psalm/Type/Atomic/TObjectWithProperties.php
index 849497c06..7315379a3 100644
--- a/src/Psalm/Type/Atomic/TObjectWithProperties.php
+++ b/src/Psalm/Type/Atomic/TObjectWithProperties.php
@@ -247,6 +247,7 @@ class TObjectWithProperties extends TObject
         Codebase $codebase = null,
         Atomic $input_type = null,
         ?string $calling_class = null,
+        ?string $calling_function = null,
         bool $replace = true,
         bool $add_upper_bound = false,
         int $depth = 0
@@ -268,6 +269,7 @@ class TObjectWithProperties extends TObject
                 $codebase,
                 $input_type_param,
                 $calling_class,
+                $calling_function,
                 $replace,
                 $add_upper_bound,
                 $depth
diff --git a/tests/Template/ClassTemplateTest.php b/tests/Template/ClassTemplateTest.php
index 609bcd514..e2cab1a7b 100644
--- a/tests/Template/ClassTemplateTest.php
+++ b/tests/Template/ClassTemplateTest.php
@@ -2203,6 +2203,22 @@ class ClassTemplateTest extends TestCase
                         }
                     }'
             ],
+            'uasortCallableInMethod' => [
+                '<?php
+                    class C {
+                        /**
+                         * @template T of object
+                         * @psalm-param array<T> $collection
+                         * @psalm-param callable(T, T): int $sorter
+                         * @psalm-return array<T>
+                         */
+                        function order(array $collection, callable $sorter): array {
+                            usort($collection, $sorter);
+
+                            return $collection;
+                        }
+                    }'
+            ],
         ];
     }
 
