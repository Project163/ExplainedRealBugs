diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/AssertionFinder.php b/src/Psalm/Internal/Analyzer/Statements/Expression/AssertionFinder.php
index 480bbeb36..cf2a0d3d2 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/AssertionFinder.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/AssertionFinder.php
@@ -1645,7 +1645,7 @@ class AssertionFinder
             if ($first_var_name) {
                 $if_types[$first_var_name] = [[$prefix . 'null']];
             }
-        } elseif (self::hasIsACheck($expr) && $source instanceof StatementsAnalyzer) {
+        } elseif ($source instanceof StatementsAnalyzer && self::hasIsACheck($expr, $source)) {
             if ($expr->args[0]->value instanceof PhpParser\Node\Expr\ClassConstFetch
                 && $expr->args[0]->value->name instanceof PhpParser\Node\Identifier
                 && strtolower($expr->args[0]->value->name->name) === 'class'
@@ -1657,8 +1657,8 @@ class AssertionFinder
             }
 
             if ($first_var_name) {
+                $first_arg = $expr->args[0]->value;
                 $second_arg = $expr->args[1]->value;
-
                 $third_arg = isset($expr->args[2]->value) ? $expr->args[2]->value : null;
 
                 if ($third_arg instanceof PhpParser\Node\Expr\ConstFetch) {
@@ -1676,39 +1676,26 @@ class AssertionFinder
 
                 $is_a_prefix = $third_arg_value === 'true' ? 'isa-string-' : 'isa-';
 
-                if ($second_arg instanceof PhpParser\Node\Scalar\String_) {
-                    $fq_class_name = $second_arg->value;
-                    if ($fq_class_name[0] === '\\') {
-                        $fq_class_name = substr($fq_class_name, 1);
-                    }
-
-                    $first_arg = $expr->args[0]->value;
-
-                    if ($first_arg
-                        && ($first_arg_type = $source->node_data->getType($first_arg))
-                        && $first_arg_type->isSingleStringLiteral()
-                        && $source->getSource()->getSource() instanceof \Psalm\Internal\Analyzer\TraitAnalyzer
-                        && $first_arg_type->getSingleStringLiteral()->value === $this_class_name
-                    ) {
-                        // do nothing
-                    } else {
-                        $if_types[$first_var_name] = [[$prefix . $is_a_prefix . $fq_class_name]];
-                    }
-                } elseif ($second_arg instanceof PhpParser\Node\Expr\ClassConstFetch
-                    && $second_arg->class instanceof PhpParser\Node\Name
-                    && $second_arg->name instanceof PhpParser\Node\Identifier
-                    && strtolower($second_arg->name->name) === 'class'
+                if ($first_arg
+                    && ($first_arg_type = $source->node_data->getType($first_arg))
+                    && $first_arg_type->isSingleStringLiteral()
+                    && $source->getSource()->getSource() instanceof \Psalm\Internal\Analyzer\TraitAnalyzer
+                    && $first_arg_type->getSingleStringLiteral()->value === $this_class_name
                 ) {
-                    $first_arg = $expr->args[0]->value;
+                    // do nothing
+                } else {
+                    if ($second_arg instanceof PhpParser\Node\Scalar\String_) {
+                        $fq_class_name = $second_arg->value;
+                        if ($fq_class_name[0] === '\\') {
+                            $fq_class_name = substr($fq_class_name, 1);
+                        }
 
-                    if ($first_arg
-                        && ($first_arg_type = $source->node_data->getType($first_arg))
-                        && $first_arg_type->isSingleStringLiteral()
-                        && $source->getSource()->getSource() instanceof \Psalm\Internal\Analyzer\TraitAnalyzer
-                        && $first_arg_type->getSingleStringLiteral()->value === $this_class_name
+                        $if_types[$first_var_name] = [[$prefix . $is_a_prefix . $fq_class_name]];
+                    } elseif ($second_arg instanceof PhpParser\Node\Expr\ClassConstFetch
+                        && $second_arg->class instanceof PhpParser\Node\Name
+                        && $second_arg->name instanceof PhpParser\Node\Identifier
+                        && strtolower($second_arg->name->name) === 'class'
                     ) {
-                        // do nothing
-                    } else {
                         $class_node = $second_arg->class;
 
                         if ($class_node->parts === ['static'] || $class_node->parts === ['self']) {
@@ -1726,6 +1713,20 @@ class AssertionFinder
                                     )
                             ]];
                         }
+                    } elseif (($second_arg_type = $source->node_data->getType($second_arg))
+                        && $second_arg_type->hasString()
+                    ) {
+                        $vals = [];
+
+                        foreach ($second_arg_type->getAtomicTypes() as $second_arg_atomic_type) {
+                            if ($second_arg_atomic_type instanceof Type\Atomic\TTemplateParamClass) {
+                                $vals[] = [$prefix . $is_a_prefix . $second_arg_atomic_type->param_name];
+                            }
+                        }
+
+                        if ($vals) {
+                            $if_types[$first_var_name] = $vals;
+                        }
                     }
                 }
             }
@@ -2433,8 +2434,10 @@ class AssertionFinder
      *
      * @return  bool
      */
-    protected static function hasIsACheck(PhpParser\Node\Expr\FuncCall $stmt)
-    {
+    protected static function hasIsACheck(
+        PhpParser\Node\Expr\FuncCall $stmt,
+        StatementsAnalyzer $source
+    ) {
         if ($stmt->name instanceof PhpParser\Node\Name
             && (strtolower($stmt->name->parts[0]) === 'is_a'
                 || strtolower($stmt->name->parts[0]) === 'is_subclass_of')
@@ -2449,6 +2452,8 @@ class AssertionFinder
                     && $second_arg->name instanceof PhpParser\Node\Identifier
                     && strtolower($second_arg->name->name) === 'class'
                 )
+                || (($second_arg_type = $source->node_data->getType($second_arg))
+                    && $second_arg_type->hasString())
             ) {
                 return true;
             }
diff --git a/src/Psalm/Internal/Type/AssertionReconciler.php b/src/Psalm/Internal/Type/AssertionReconciler.php
index 252c89a96..ae14e0014 100644
--- a/src/Psalm/Internal/Type/AssertionReconciler.php
+++ b/src/Psalm/Internal/Type/AssertionReconciler.php
@@ -2454,6 +2454,19 @@ class AssertionReconciler extends \Psalm\Type\Reconciler
                     }
                 }
 
+                if ($new_type_part instanceof Type\Atomic\TTemplateParam
+                    && $existing_type_part instanceof Type\Atomic\TTemplateParam
+                    && $new_type_part->param_name !== $existing_type_part->param_name
+                    && $new_type_part->as->hasObject()
+                    && $existing_type_part->as->hasObject()
+                ) {
+                    $new_type_part->extra_types[$existing_type_part->getKey()] = $existing_type_part;
+                    $matching_atomic_types[] = $new_type_part;
+                    $has_local_match = true;
+
+                    continue;
+                }
+
                 if (($new_type_part instanceof Type\Atomic\TGenericObject
                         || $new_type_part instanceof Type\Atomic\TArray
                         || $new_type_part instanceof Type\Atomic\TIterable)
diff --git a/tests/Template/FunctionTemplateAssertTest.php b/tests/Template/FunctionTemplateAssertTest.php
index 9dd3c72d2..a26ef5045 100644
--- a/tests/Template/FunctionTemplateAssertTest.php
+++ b/tests/Template/FunctionTemplateAssertTest.php
@@ -619,6 +619,18 @@ class FunctionTemplateAssertTest extends TestCase
                         }
                     }',
             ],
+            'castClassStringWithIsA' => [
+                '<?php
+                    /**
+                     * @psalm-template RequestedClass of object
+                     * @psalm-param class-string<RequestedClass> $expectedType
+                     * @psalm-return class-string<RequestedClass>
+                     */
+                    function castStringToClassString(string $expectedType, string $anyString): string {
+                        \assert(\is_a($anyString, $expectedType, true));
+                        return $anyString;
+                    }'
+            ],
         ];
     }
 
