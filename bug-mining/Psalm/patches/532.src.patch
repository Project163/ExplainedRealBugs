diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/IncludeAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/IncludeAnalyzer.php
index f1165824c..0a452364a 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/IncludeAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/IncludeAnalyzer.php
@@ -160,9 +160,6 @@ class IncludeAnalyzer
                         $global_context
                     );
                 } catch (\Psalm\Exception\UnpreparedAnalysisException $e) {
-                    $context->check_classes = false;
-                    $context->check_variables = false;
-                    $context->check_functions = false;
                 }
 
                 foreach ($include_file_analyzer->getRequiredFilePaths() as $required_file_path) {
@@ -203,10 +200,6 @@ class IncludeAnalyzer
             }
         }
 
-        $context->check_classes = false;
-        $context->check_variables = false;
-        $context->check_functions = false;
-
         return null;
     }
 
diff --git a/tests/IncludeTest.php b/tests/IncludeTest.php
index b19e8713a..3c7a0d3c9 100644
--- a/tests/IncludeTest.php
+++ b/tests/IncludeTest.php
@@ -779,6 +779,25 @@ class IncludeTest extends TestCase
                 ],
                 'error_message' => 'UndefinedConstant',
             ],
+            'undefinedMethodAfterInvalidRequire' => [
+                'files' => [
+                    getcwd() . DIRECTORY_SEPARATOR . 'file2.php' => '<?php
+                        /** @psalm-suppress MissingFile */
+                        require("doesnotexist.php");
+                        require("file1.php");
+
+                        foo();
+                        bar();
+                        ',
+                    getcwd() . DIRECTORY_SEPARATOR . 'file1.php' => '<?php
+                        function bar(): void {}
+                        ',
+                ],
+                'files_to_check' => [
+                    getcwd() . DIRECTORY_SEPARATOR . 'file2.php',
+                ],
+                'error_message' => 'UndefinedFunction',
+            ],
         ];
     }
 }
