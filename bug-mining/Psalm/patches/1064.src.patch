diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/Fetch/InstancePropertyFetchAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/Fetch/InstancePropertyFetchAnalyzer.php
index 4a2b2764a..96e514095 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/Fetch/InstancePropertyFetchAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/Fetch/InstancePropertyFetchAnalyzer.php
@@ -71,7 +71,12 @@ class InstancePropertyFetchAnalyzer
             $statements_analyzer
         );
 
-        if ($var_id && $context->hasVariable($var_id)) {
+        if ($var_id
+            && $context->hasVariable($var_id)
+            && (!$stmt_var_id === '$this'
+                || (isset($context->vars_in_scope['$this'])
+                    && $context->self === $context->vars_in_scope['$this']->getId()))
+        ) {
             self::handleScopedProperty(
                 $context,
                 $var_id,
diff --git a/tests/Template/ClassTemplateExtendsTest.php b/tests/Template/ClassTemplateExtendsTest.php
index 325289874..650f80417 100644
--- a/tests/Template/ClassTemplateExtendsTest.php
+++ b/tests/Template/ClassTemplateExtendsTest.php
@@ -4347,6 +4347,31 @@ class ClassTemplateExtendsTest extends TestCase
                         }
                     }'
             ],
+            'inferPropertyTypeOnThisInstanceofExtended' => [
+                '<?php
+
+                    /** @template T as scalar */
+                    class Collection {
+                        /** @var T */
+                        public $val;
+
+                        /** @param T $val */
+                        public function __construct($val) {
+                            $this->val = $val;
+                        }
+
+                        public function foo() : string {
+                            if ($this instanceof StringCollection) {
+                                return $this->val;
+                            }
+
+                            return "hello";
+                        }
+                    }
+
+                    /** @extends Collection<string> */
+                    class StringCollection extends Collection {}',
+            ],
         ];
     }
 
