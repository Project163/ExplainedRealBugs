diff --git a/config.xsd b/config.xsd
index 041333c30..0113bbb59 100644
--- a/config.xsd
+++ b/config.xsd
@@ -403,11 +403,12 @@
             <xs:element name="TaintedHtml" type="IssueHandlerType" minOccurs="0" />
             <xs:element name="TaintedInclude" type="IssueHandlerType" minOccurs="0" />
             <xs:element name="TaintedInput" type="IssueHandlerType" minOccurs="0" />
+            <xs:element name="TaintedLdap" type="IssueHandlerType" minOccurs="0" />
             <xs:element name="TaintedShell" type="IssueHandlerType" minOccurs="0" />
             <xs:element name="TaintedSql" type="IssueHandlerType" minOccurs="0" />
             <xs:element name="TaintedSSRF" type="IssueHandlerType" minOccurs="0" />
-            <xs:element name="TaintedLdap" type="IssueHandlerType" minOccurs="0" />
             <xs:element name="TaintedSystemSecret" type="IssueHandlerType" minOccurs="0" />
+            <xs:element name="TaintedTextWithQuotes" type="IssueHandlerType" minOccurs="0" />
             <xs:element name="TaintedUnserialize" type="IssueHandlerType" minOccurs="0" />
             <xs:element name="TaintedUserSecret" type="IssueHandlerType" minOccurs="0" />
             <xs:element name="TooFewArguments" type="ArgumentIssueHandlerType" minOccurs="0" />
diff --git a/docs/running_psalm/issues/TaintedHtml.md b/docs/running_psalm/issues/TaintedHtml.md
index 17e0c9462..8222c71fd 100644
--- a/docs/running_psalm/issues/TaintedHtml.md
+++ b/docs/running_psalm/issues/TaintedHtml.md
@@ -1,6 +1,6 @@
 # TaintedHtml
 
-Emitted when user-controlled input can be passed into to an `echo` statement.
+Emitted when user-controlled input that can contain HTML can be passed into to an `echo` statement.
 
 ## Risk
 
diff --git a/docs/running_psalm/issues/TaintedTextWithQuotes.md b/docs/running_psalm/issues/TaintedTextWithQuotes.md
new file mode 100644
index 000000000..888584583
--- /dev/null
+++ b/docs/running_psalm/issues/TaintedTextWithQuotes.md
@@ -0,0 +1,42 @@
+# TaintedTextWithQuotes
+
+Emitted when user-controlled input that can contain quotation marks can be passed into to an `echo` statement.
+
+## Risk
+
+This could lead to a potential Cross Site Scripting (XSS) vulnerability. Using a XSS vulnerability, an attacker could inject malicious JavaScript and execute any action JavaScript could do. Examples include:
+
+- Stealing authentication material (e.g. cookies, JWT tokens)
+- Exfiltrate sensitive information by reading the DOM
+- Keylog entries on the website (e.g. fake login form)
+
+Wheter this is exploitable or not depends on a few conditions:
+
+- Is an executable mimetype set? (e.g. `text/html`)
+- Is the content served inline or as attachment? (`Content-Disposition`)
+- Is the output properly sanitized? (e.g. stripping all HTML tags or having an allowlist of allowed characters)
+
+## Example
+
+```php
+<?php
+$param = strip_tags($_GET['param']);
+?>
+
+<script>
+    console.log('<?=$param?>')
+</script>
+```
+
+Passing `');alert('injection');//` as a `GET` param here would would cause the `alert` to trigger.
+
+## Mitigations
+
+- Sanitize user-input by using functions such as `htmlentities` or use an allowlist.
+- Set all cookies to `HTTPOnly`.
+- Consider using Content Security Policy (CSP), to limit the risk of XSS vulnerabilities.
+
+## Further resources
+
+- [OWASP Wiki for Cross Site Scripting (XSS)](https://owasp.org/www-community/attacks/xss/)
+- [Content-Security-Policy - Web Fundamentals](https://developers.google.com/web/fundamentals/security/csp)
diff --git a/src/Psalm/Config.php b/src/Psalm/Config.php
index 756f69d58..946a8cfb5 100644
--- a/src/Psalm/Config.php
+++ b/src/Psalm/Config.php
@@ -1295,6 +1295,10 @@ class Config
         foreach ($socket->getAdditionalFileTypeAnalyzers() as $extension => $className) {
             $this->filetype_analyzers[$extension] = $className;
         }
+
+        new \Psalm\Internal\Provider\AddRemoveTaints\HtmlFunctionTainter();
+
+        $socket->registerHooksFromClass(\Psalm\Internal\Provider\AddRemoveTaints\HtmlFunctionTainter::class);
     }
 
     private static function requirePath(string $path): void
diff --git a/src/Psalm/Internal/Analyzer/Statements/EchoAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/EchoAnalyzer.php
index ddeaf6d9c..67f0035ca 100644
--- a/src/Psalm/Internal/Analyzer/Statements/EchoAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/EchoAnalyzer.php
@@ -60,6 +60,7 @@ class EchoAnalyzer
 
                 $echo_param_sink->taints = [
                     Type\TaintKind::INPUT_HTML,
+                    Type\TaintKind::INPUT_HAS_QUOTES,
                     Type\TaintKind::USER_SECRET,
                     Type\TaintKind::SYSTEM_SECRET
                 ];
diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/Call/FunctionCallReturnTypeFetcher.php b/src/Psalm/Internal/Analyzer/Statements/Expression/Call/FunctionCallReturnTypeFetcher.php
index d646409b5..03e290a79 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/Call/FunctionCallReturnTypeFetcher.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/Call/FunctionCallReturnTypeFetcher.php
@@ -588,6 +588,7 @@ class FunctionCallReturnTypeFetcher
 
                         if (self::simpleExclusion($pattern, $first_arg_value[0])) {
                             $removed_taints[] = 'html';
+                            $removed_taints[] = 'has_quotes';
                             $removed_taints[] = 'sql';
                         }
                     }
diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/ExitAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/ExitAnalyzer.php
index 163d97421..e81ab524b 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/ExitAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/ExitAnalyzer.php
@@ -41,6 +41,7 @@ class ExitAnalyzer
 
                 $echo_param_sink->taints = [
                     Type\TaintKind::INPUT_HTML,
+                    Type\TaintKind::INPUT_HAS_QUOTES,
                     Type\TaintKind::USER_SECRET,
                     Type\TaintKind::SYSTEM_SECRET
                 ];
diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/PrintAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/PrintAnalyzer.php
index 1c948e19b..562990893 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/PrintAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/PrintAnalyzer.php
@@ -39,6 +39,7 @@ class PrintAnalyzer
 
             $print_param_sink->taints = [
                 Type\TaintKind::INPUT_HTML,
+                Type\TaintKind::INPUT_HAS_QUOTES,
                 Type\TaintKind::USER_SECRET,
                 Type\TaintKind::SYSTEM_SECRET
             ];
diff --git a/src/Psalm/Internal/Codebase/TaintFlowGraph.php b/src/Psalm/Internal/Codebase/TaintFlowGraph.php
index 56fedbdf7..3fcf5846c 100644
--- a/src/Psalm/Internal/Codebase/TaintFlowGraph.php
+++ b/src/Psalm/Internal/Codebase/TaintFlowGraph.php
@@ -19,6 +19,7 @@ use Psalm\Issue\TaintedSSRF;
 use Psalm\Issue\TaintedShell;
 use Psalm\Issue\TaintedSql;
 use Psalm\Issue\TaintedSystemSecret;
+use Psalm\Issue\TaintedTextWithQuotes;
 use Psalm\Issue\TaintedUnserialize;
 use Psalm\Issue\TaintedUserSecret;
 use Psalm\IssueBuffer;
@@ -353,6 +354,15 @@ class TaintFlowGraph extends DataFlowGraph
                                 );
                                 break;
 
+                            case TaintKind::INPUT_HAS_QUOTES:
+                                $issue = new TaintedTextWithQuotes(
+                                    'Detected tainted text with possible quotes',
+                                    $issue_location,
+                                    $issue_trace,
+                                    $path
+                                );
+                                break;
+
                             case TaintKind::INPUT_SHELL:
                                 $issue = new TaintedShell(
                                     'Detected tainted shell code',
diff --git a/src/Psalm/Internal/Provider/AddRemoveTaints/HtmlFunctionTainter.php b/src/Psalm/Internal/Provider/AddRemoveTaints/HtmlFunctionTainter.php
new file mode 100644
index 000000000..074dda6d0
--- /dev/null
+++ b/src/Psalm/Internal/Provider/AddRemoveTaints/HtmlFunctionTainter.php
@@ -0,0 +1,105 @@
+<?php
+namespace Psalm\Internal\Provider\AddRemoveTaints;
+
+use PhpParser;
+use Psalm\Internal\Analyzer\StatementsAnalyzer;
+use Psalm\Plugin\EventHandler\Event\AddRemoveTaintsEvent;
+use Psalm\Plugin\EventHandler\AddTaintsInterface;
+use Psalm\Plugin\EventHandler\RemoveTaintsInterface;
+
+class HtmlFunctionTainter implements AddTaintsInterface, RemoveTaintsInterface
+{
+    /**
+     * Called to see what taints should be added
+     *
+     * @return list<string>
+     */
+    public static function addTaints(AddRemoveTaintsEvent $event): array {
+        $item = $event->getExpr();
+        $statements_analyzer = $event->getStatementsSource();
+        
+        if (!$statements_analyzer instanceof StatementsAnalyzer
+            || !$item instanceof PhpParser\Node\Expr\FuncCall
+            || !$item->name instanceof PhpParser\Node\Name
+            || \count($item->name->parts) !== 1
+            || \count($item->args) === 0
+        ) {
+            return [];
+        }
+
+        $function_id = \strtolower($item->name->parts[0]);
+
+        if ($function_id === 'html_entity_decode'
+            || $function_id === 'htmlspecialchars_decode'
+        ) {
+            $second_arg = $item->args[1]->value ?? null;
+
+            if ($second_arg === null) {
+                return ['html'];
+            }
+
+            $second_arg_value = $statements_analyzer->node_data->getType($second_arg);
+
+            if (!$second_arg_value || !$second_arg_value->isSingleIntLiteral()) {
+                return ['html'];
+            }
+
+            $second_arg_value = $second_arg_value->getSingleIntLiteral()->value;
+            
+            if (($second_arg_value & \ENT_QUOTES) === \ENT_QUOTES) {
+                return ['html', 'has_quotes'];
+            }
+
+            return ['html'];
+        }
+
+        return [];
+    }
+
+    /**
+     * Called to see what taints should be removed
+     *
+     * @return list<string>
+     */
+    public static function removeTaints(AddRemoveTaintsEvent $event): array {
+        $item = $event->getExpr();
+        $statements_analyzer = $event->getStatementsSource();
+        
+        if (!$statements_analyzer instanceof StatementsAnalyzer
+            || !$item instanceof PhpParser\Node\Expr\FuncCall
+            || !$item->name instanceof PhpParser\Node\Name
+            || \count($item->name->parts) !== 1
+            || \count($item->args) === 0
+        ) {
+            return [];
+        }
+
+        $function_id = \strtolower($item->name->parts[0]);
+
+        if ($function_id === 'htmlentities'
+            || $function_id === 'htmlspecialchars'
+        ) {
+            $second_arg = $item->args[1]->value ?? null;
+
+            if ($second_arg === null) {
+                return ['html'];
+            }
+
+            $second_arg_value = $statements_analyzer->node_data->getType($second_arg);
+
+            if (!$second_arg_value || !$second_arg_value->isSingleIntLiteral()) {
+                return ['html'];
+            }
+
+            $second_arg_value = $second_arg_value->getSingleIntLiteral()->value;
+            
+            if (($second_arg_value & \ENT_QUOTES) === \ENT_QUOTES) {
+                return ['html', 'has_quotes'];
+            }
+
+            return ['html'];
+        }
+        
+        return [];
+    }
+}
diff --git a/src/Psalm/Issue/TaintedTextWithQuotes.php b/src/Psalm/Issue/TaintedTextWithQuotes.php
new file mode 100644
index 000000000..2745e0408
--- /dev/null
+++ b/src/Psalm/Issue/TaintedTextWithQuotes.php
@@ -0,0 +1,7 @@
+<?php
+namespace Psalm\Issue;
+
+class TaintedTextWithQuotes extends TaintedInput
+{
+    public const SHORTCODE = 274;
+}
diff --git a/src/Psalm/Type/TaintKind.php b/src/Psalm/Type/TaintKind.php
index 8e9758480..b5022d986 100644
--- a/src/Psalm/Type/TaintKind.php
+++ b/src/Psalm/Type/TaintKind.php
@@ -14,6 +14,7 @@ class TaintKind
     public const INPUT_LDAP = 'ldap';
     public const INPUT_SQL = 'sql';
     public const INPUT_HTML = 'html';
+    public const INPUT_HAS_QUOTES = 'has_quotes';
     public const INPUT_SHELL = 'shell';
     public const INPUT_SSRF = 'ssrf';
     public const INPUT_FILE = 'file';
diff --git a/src/Psalm/Type/TaintKindGroup.php b/src/Psalm/Type/TaintKindGroup.php
index 6ee38d079..de1b365de 100644
--- a/src/Psalm/Type/TaintKindGroup.php
+++ b/src/Psalm/Type/TaintKindGroup.php
@@ -9,6 +9,7 @@ class TaintKindGroup
 {
     public const ALL_INPUT = [
         TaintKind::INPUT_HTML,
+        TaintKind::INPUT_HAS_QUOTES,
         TaintKind::INPUT_SHELL,
         TaintKind::INPUT_SQL,
         TaintKind::INPUT_CALLABLE,
diff --git a/stubs/CoreGenericFunctions.phpstub b/stubs/CoreGenericFunctions.phpstub
index a0c4f5513..c219f78f5 100644
--- a/stubs/CoreGenericFunctions.phpstub
+++ b/stubs/CoreGenericFunctions.phpstub
@@ -676,7 +676,7 @@ function stripslashes(string $str) : string {}
 /**
  * @psalm-pure
  *
- * @psalm-taint-escape html
+ * Tainting is handled in a plugin
  *
  * @psalm-flow ($string) -> return
  */
@@ -685,7 +685,7 @@ function htmlentities(string $string, ?int $quote_style = null, ?string $charset
 /**
  * @psalm-pure
  *
- * @psalm-taint-unescape html
+ * Tainting is handled in a plugin
  *
  * @psalm-flow ($string) -> return
  */
@@ -694,8 +694,7 @@ function html_entity_decode(string $string, ?int $quote_style = null, ?string $c
 /**
  * @psalm-pure
  *
- * @psalm-taint-escape html
- * @psalm-taint-escape sql
+ * Tainting is handled in a plugin
  *
  * @psalm-flow ($string) -> return
  * @psalm-return (
@@ -709,8 +708,7 @@ function htmlspecialchars(string $string, int $flags = ENT_COMPAT | ENT_HTML401,
 /**
  * @psalm-pure
  *
- * @psalm-taint-unescape html
- * @psalm-taint-unescape sql
+ * Tainting is handled in a plugin
  *
  * @psalm-flow ($string) -> return
  */
diff --git a/tests/TaintTest.php b/tests/TaintTest.php
index 9e0b72eac..9febcda7c 100644
--- a/tests/TaintTest.php
+++ b/tests/TaintTest.php
@@ -32,6 +32,8 @@ class TaintTest extends TestCase
 
         $this->project_analyzer->trackTaintedInputs();
 
+        $this->project_analyzer->getCodebase()->config->initializePlugins($this->project_analyzer);
+
         $this->analyzeFile($file_path, new Context(), false);
     }
 
@@ -76,7 +78,7 @@ class TaintTest extends TestCase
 
                     $data = ["name" => $name, "id" => $id];
 
-                    echo "<h1>" . htmlentities($data["name"]) . "</h1>";
+                    echo "<h1>" . htmlentities($data["name"], \ENT_QUOTES) . "</h1>";
                     echo "<p>" . $data["id"] . "</p>";'
             ],
             'taintedInputInAssignedArrayNotEchoed' => [
@@ -88,7 +90,7 @@ class TaintTest extends TestCase
                     $data["name"] = $name;
                     $data["id"] = $id;
 
-                    echo "<h1>" . htmlentities($data["name"]) . "</h1>";
+                    echo "<h1>" . htmlentities($data["name"], \ENT_QUOTES) . "</h1>";
                     echo "<p>" . $data["id"] . "</p>";'
             ],
             'taintedInputDirectlySuppressed' => [
@@ -214,7 +216,7 @@ class TaintTest extends TestCase
 
                     class A {
                         public function foo() : void {
-                            echo(htmlentities(Utils::shorten((string) $_GET["user_id"])));
+                            echo(htmlentities(Utils::shorten((string) $_GET["user_id"]), \ENT_QUOTES));
                         }
 
                         public function bar() : void {
@@ -225,7 +227,7 @@ class TaintTest extends TestCase
             'taintHtmlEntities' => [
                 '<?php
                     function foo() : void {
-                        $a = htmlentities((string) $_GET["bad"]);
+                        $a = htmlentities((string) $_GET["bad"], \ENT_QUOTES);
                         echo $a;
                     }'
             ],
@@ -242,6 +244,7 @@ class TaintTest extends TestCase
                         /**
                          * @psalm-pure
                          * @psalm-taint-escape html
+                         * @psalm-taint-escape has_quotes
                          */
                         public static function shorten(string $s) : string {
                             return str_replace("foo", "bar", $s);
@@ -307,6 +310,7 @@ class TaintTest extends TestCase
                         public function foo(O1 $o) : void {
                             /**
                              * @psalm-taint-escape html
+                             * @psalm-taint-escape has_quotes
                              */
                             $a = str_replace("foo", "bar", $o->s);
                             echo $a;
@@ -323,7 +327,7 @@ class TaintTest extends TestCase
 
                         /** @psalm-pure */
                         public static function escape(string $s) : string {
-                            return htmlentities($s);
+                            return htmlentities($s, \ENT_QUOTES);
                         }
                     }
 
@@ -2240,7 +2244,7 @@ class TaintTest extends TestCase
                     $value = triggerShell($value);
                     $value = triggerFile($value);
                 ',
-                'expectedIssueTypes' => ['TaintedHtml', 'TaintedShell', 'TaintedFile'],
+                'expectedIssueTypes' => ['TaintedHtml', 'TaintedTextWithQuotes', 'TaintedShell', 'TaintedFile'],
             ]
         ];
     }
