diff --git a/src/Psalm/Internal/Analyzer/Statements/Block/DoAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Block/DoAnalyzer.php
index d72a140fe..1564f919f 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Block/DoAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Block/DoAnalyzer.php
@@ -42,47 +42,7 @@ class DoAnalyzer
         $loop_scope = new LoopScope($do_context, $context);
         $loop_scope->protected_var_ids = $context->protected_var_ids;
 
-        $suppressed_issues = $statements_analyzer->getSuppressedIssues();
-
-        if (!in_array('RedundantCondition', $suppressed_issues, true)) {
-            $statements_analyzer->addSuppressedIssues(['RedundantCondition']);
-        }
-        if (!in_array('RedundantConditionGivenDocblockType', $suppressed_issues, true)) {
-            $statements_analyzer->addSuppressedIssues(['RedundantConditionGivenDocblockType']);
-        }
-        if (!in_array('TypeDoesNotContainType', $suppressed_issues, true)) {
-            $statements_analyzer->addSuppressedIssues(['TypeDoesNotContainType']);
-        }
-
-        $do_context->loop_scope = $loop_scope;
-
-        $statements_analyzer->analyze($stmt->stmts, $do_context);
-
-        if (!in_array('RedundantCondition', $suppressed_issues, true)) {
-            $statements_analyzer->removeSuppressedIssues(['RedundantCondition']);
-        }
-        if (!in_array('RedundantConditionGivenDocblockType', $suppressed_issues, true)) {
-            $statements_analyzer->removeSuppressedIssues(['RedundantConditionGivenDocblockType']);
-        }
-        if (!in_array('TypeDoesNotContainType', $suppressed_issues, true)) {
-            $statements_analyzer->removeSuppressedIssues(['TypeDoesNotContainType']);
-        }
-
-        $loop_scope->iteration_count++;
-
-        foreach ($context->vars_in_scope as $var => $type) {
-            if ($type->hasMixed()) {
-                continue;
-            }
-
-            if (isset($do_context->vars_in_scope[$var])) {
-                if (!$do_context->vars_in_scope[$var]->equals($type)) {
-                    $was_possibly_undefined = $do_context->vars_in_scope[$var]->possibly_undefined_from_try;
-                    $do_context->vars_in_scope[$var] = Type::combineUnionTypes($do_context->vars_in_scope[$var], $type);
-                    $do_context->vars_in_scope[$var]->possibly_undefined_from_try = $was_possibly_undefined;
-                }
-            }
-        }
+        self::analyzeDoNaively($statements_analyzer, $stmt, $do_context, $loop_scope);
 
         $mixed_var_ids = [];
 
@@ -126,34 +86,6 @@ class DoAnalyzer
             $while_clauses = [new Clause([], true)];
         }
 
-        $reconcilable_while_types = \Psalm\Type\Algebra::getTruthsFromFormula($while_clauses);
-
-        if ($reconcilable_while_types) {
-            $changed_var_ids = [];
-            $while_vars_in_scope_reconciled =
-                Type\Reconciler::reconcileKeyedTypes(
-                    $reconcilable_while_types,
-                    [],
-                    $do_context->vars_in_scope,
-                    $changed_var_ids,
-                    [],
-                    $statements_analyzer,
-                    [],
-                    true,
-                    new \Psalm\CodeLocation($statements_analyzer->getSource(), $stmt->cond)
-                );
-
-            $do_context->vars_in_scope = $while_vars_in_scope_reconciled;
-        }
-
-        foreach ($do_context->vars_in_scope as $var_id => $type) {
-            if (isset($context->vars_in_scope[$var_id])) {
-                $was_possibly_undefined = $type->possibly_undefined_from_try;
-                $context->vars_in_scope[$var_id] = Type::combineUnionTypes($context->vars_in_scope[$var_id], $type);
-                $context->vars_in_scope[$var_id]->possibly_undefined_from_try = $was_possibly_undefined;
-            }
-        }
-
         LoopAnalyzer::analyze(
             $statements_analyzer,
             $stmt->stmts,
@@ -161,6 +93,7 @@ class DoAnalyzer
             [],
             $loop_scope,
             $inner_loop_context,
+            true,
             true
         );
 
@@ -177,6 +110,8 @@ class DoAnalyzer
             )
         );
 
+        //var_dump($do_context->vars_in_scope);
+
         if ($negated_while_types) {
             $changed_var_ids = [];
 
@@ -230,4 +165,39 @@ class DoAnalyzer
             $context->mergeExceptions($inner_loop_context);
         }
     }
+
+    private static function analyzeDoNaively(
+        StatementsAnalyzer $statements_analyzer,
+        PhpParser\Node\Stmt\Do_ $stmt,
+        Context $context,
+        LoopScope $loop_scope
+    ) : void {
+        $do_context = clone $context;
+
+        $suppressed_issues = $statements_analyzer->getSuppressedIssues();
+
+        if (!in_array('RedundantCondition', $suppressed_issues, true)) {
+            $statements_analyzer->addSuppressedIssues(['RedundantCondition']);
+        }
+        if (!in_array('RedundantConditionGivenDocblockType', $suppressed_issues, true)) {
+            $statements_analyzer->addSuppressedIssues(['RedundantConditionGivenDocblockType']);
+        }
+        if (!in_array('TypeDoesNotContainType', $suppressed_issues, true)) {
+            $statements_analyzer->addSuppressedIssues(['TypeDoesNotContainType']);
+        }
+
+        $do_context->loop_scope = $loop_scope;
+
+        $statements_analyzer->analyze($stmt->stmts, $do_context);
+
+        if (!in_array('RedundantCondition', $suppressed_issues, true)) {
+            $statements_analyzer->removeSuppressedIssues(['RedundantCondition']);
+        }
+        if (!in_array('RedundantConditionGivenDocblockType', $suppressed_issues, true)) {
+            $statements_analyzer->removeSuppressedIssues(['RedundantConditionGivenDocblockType']);
+        }
+        if (!in_array('TypeDoesNotContainType', $suppressed_issues, true)) {
+            $statements_analyzer->removeSuppressedIssues(['TypeDoesNotContainType']);
+        }
+    }
 }
diff --git a/src/Psalm/Internal/Analyzer/Statements/Block/ForeachAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Block/ForeachAnalyzer.php
index 24bf31133..8d8ddd71e 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Block/ForeachAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Block/ForeachAnalyzer.php
@@ -305,39 +305,21 @@ class ForeachAnalyzer
 
         $loop_scope->protected_var_ids = $context->protected_var_ids;
 
-        LoopAnalyzer::analyze($statements_analyzer, $stmt->stmts, [], [], $loop_scope, $inner_loop_context);
+        LoopAnalyzer::analyze(
+            $statements_analyzer,
+            $stmt->stmts,
+            [],
+            [],
+            $loop_scope,
+            $inner_loop_context,
+            false,
+            $always_non_empty_array
+        );
 
         if (!$inner_loop_context) {
             throw new \UnexpectedValueException('There should be an inner loop context');
         }
 
-        if ($always_non_empty_array) {
-            foreach ($inner_loop_context->vars_in_scope as $var_id => $type) {
-                // if there are break statements in the loop it's not certain
-                // that the loop has finished executing, so the assertions at the end
-                // the loop in the while conditional may not hold
-                if (in_array(ScopeAnalyzer::ACTION_BREAK, $loop_scope->final_actions, true)
-                    || in_array(ScopeAnalyzer::ACTION_CONTINUE, $loop_scope->final_actions, true)
-                ) {
-                    if (isset($loop_scope->possibly_defined_loop_parent_vars[$var_id])) {
-                        $context->vars_in_scope[$var_id] = Type::combineUnionTypes(
-                            $type,
-                            $loop_scope->possibly_defined_loop_parent_vars[$var_id]
-                        );
-                    }
-                } else {
-                    if ($codebase->find_unused_variables
-                        && !isset($context->vars_in_scope[$var_id])
-                        && isset($inner_loop_context->unreferenced_vars[$var_id])
-                    ) {
-                        $context->unreferenced_vars[$var_id] = $inner_loop_context->unreferenced_vars[$var_id];
-                    }
-
-                    $context->vars_in_scope[$var_id] = $type;
-                }
-            }
-        }
-
         $foreach_context->loop_scope = null;
 
         $context->vars_possibly_in_scope = array_merge(
diff --git a/src/Psalm/Internal/Analyzer/Statements/Block/LoopAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Block/LoopAnalyzer.php
index 7935091b0..01e5d5079 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Block/LoopAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Block/LoopAnalyzer.php
@@ -44,7 +44,8 @@ class LoopAnalyzer
         array $post_expressions,
         LoopScope $loop_scope,
         Context &$inner_context = null,
-        $is_do = false
+        bool $is_do = false,
+        bool $always_enters_loop = false
     ) {
         $traverser = new PhpParser\NodeTraverser;
 
@@ -65,6 +66,8 @@ class LoopAnalyzer
 
         $codebase = $statements_analyzer->getCodebase();
 
+        $inner_do_context = null;
+
         if ($pre_conditions) {
             foreach ($pre_conditions as $i => $pre_condition) {
                 $pre_condition_clauses[$i] = Algebra::getFormula(
@@ -159,18 +162,20 @@ class LoopAnalyzer
 
             IssueBuffer::startRecording();
 
-            foreach ($pre_conditions as $condition_offset => $pre_condition) {
-                $asserted_var_ids = array_merge(
-                    self::applyPreConditionToLoopContext(
-                        $statements_analyzer,
-                        $pre_condition,
-                        $pre_condition_clauses[$condition_offset],
-                        $loop_scope->loop_context,
-                        $loop_scope->loop_parent_context,
-                        $is_do
-                    ),
-                    $asserted_var_ids
-                );
+            if (!$is_do) {
+                foreach ($pre_conditions as $condition_offset => $pre_condition) {
+                    $asserted_var_ids = array_merge(
+                        self::applyPreConditionToLoopContext(
+                            $statements_analyzer,
+                            $pre_condition,
+                            $pre_condition_clauses[$condition_offset],
+                            $loop_scope->loop_context,
+                            $loop_scope->loop_parent_context,
+                            $is_do
+                        ),
+                        $asserted_var_ids
+                    );
+                }
             }
 
             // record all the vars that existed before we did the first pass through the loop
@@ -188,8 +193,6 @@ class LoopAnalyzer
             $old_referenced_var_ids = $inner_context->referenced_var_ids;
             $inner_context->referenced_var_ids = [];
 
-            $asserted_var_ids = array_unique($asserted_var_ids);
-
             $inner_context->protected_var_ids = $loop_scope->protected_var_ids;
 
             $statements_analyzer->analyze($stmts, $inner_context);
@@ -198,6 +201,26 @@ class LoopAnalyzer
 
             $inner_context->protected_var_ids = $original_protected_var_ids;
 
+            if ($is_do) {
+                $inner_do_context = clone $inner_context;
+
+                foreach ($pre_conditions as $condition_offset => $pre_condition) {
+                    $asserted_var_ids = array_merge(
+                        self::applyPreConditionToLoopContext(
+                            $statements_analyzer,
+                            $pre_condition,
+                            $pre_condition_clauses[$condition_offset],
+                            $inner_context,
+                            $loop_scope->loop_parent_context,
+                            $is_do
+                        ),
+                        $asserted_var_ids
+                    );
+                }
+            }
+
+            $asserted_var_ids = array_unique($asserted_var_ids);
+
             foreach ($post_expressions as $post_expression) {
                 if (ExpressionAnalyzer::analyze($statements_analyzer, $post_expression, $inner_context) === false) {
                     return false;
@@ -327,15 +350,17 @@ class LoopAnalyzer
                     }
                 }
 
-                foreach ($pre_conditions as $condition_offset => $pre_condition) {
-                    self::applyPreConditionToLoopContext(
-                        $statements_analyzer,
-                        $pre_condition,
-                        $pre_condition_clauses[$condition_offset],
-                        $inner_context,
-                        $loop_scope->loop_parent_context,
-                        false
-                    );
+                if (!$is_do) {
+                    foreach ($pre_conditions as $condition_offset => $pre_condition) {
+                        self::applyPreConditionToLoopContext(
+                            $statements_analyzer,
+                            $pre_condition,
+                            $pre_condition_clauses[$condition_offset],
+                            $inner_context,
+                            $loop_scope->loop_parent_context,
+                            false
+                        );
+                    }
                 }
 
                 foreach ($asserted_var_ids as $var_id) {
@@ -368,6 +393,21 @@ class LoopAnalyzer
 
                 $inner_context->protected_var_ids = $original_protected_var_ids;
 
+                if ($is_do) {
+                    $inner_do_context = clone $inner_context;
+
+                    foreach ($pre_conditions as $condition_offset => $pre_condition) {
+                        self::applyPreConditionToLoopContext(
+                            $statements_analyzer,
+                            $pre_condition,
+                            $pre_condition_clauses[$condition_offset],
+                            $inner_context,
+                            $loop_scope->loop_parent_context,
+                            $is_do
+                        );
+                    }
+                }
+
                 foreach ($post_expressions as $post_expression) {
                     if (ExpressionAnalyzer::analyze($statements_analyzer, $post_expression, $inner_context) === false) {
                         return false;
@@ -522,6 +562,37 @@ class LoopAnalyzer
                 }
             }
         }
+
+        if ($always_enters_loop) {
+            foreach ($inner_context->vars_in_scope as $var_id => $type) {
+                // if there are break statements in the loop it's not certain
+                // that the loop has finished executing, so the assertions at the end
+                // the loop in the while conditional may not hold
+                if (in_array(ScopeAnalyzer::ACTION_BREAK, $loop_scope->final_actions, true)
+                    || in_array(ScopeAnalyzer::ACTION_CONTINUE, $loop_scope->final_actions, true)
+                ) {
+                    if (isset($loop_scope->possibly_defined_loop_parent_vars[$var_id])) {
+                        $loop_scope->loop_parent_context->vars_in_scope[$var_id] = Type::combineUnionTypes(
+                            $type,
+                            $loop_scope->possibly_defined_loop_parent_vars[$var_id]
+                        );
+                    }
+                } else {
+                    if ($codebase->find_unused_variables
+                        && !isset($loop_scope->loop_parent_context->vars_in_scope[$var_id])
+                        && isset($inner_context->unreferenced_vars[$var_id])
+                    ) {
+                        $loop_scope->loop_parent_context->unreferenced_vars[$var_id] = $inner_context->unreferenced_vars[$var_id];
+                    }
+
+                    $loop_scope->loop_parent_context->vars_in_scope[$var_id] = $type;
+                }
+            }
+        }
+
+        if ($inner_do_context) {
+            $inner_context = $inner_do_context;
+        }
     }
 
     /**
diff --git a/tests/Loop/DoTest.php b/tests/Loop/DoTest.php
index fa75e543b..08db8ba9b 100644
--- a/tests/Loop/DoTest.php
+++ b/tests/Loop/DoTest.php
@@ -319,6 +319,30 @@ class DoTest extends \Psalm\Tests\TestCase
                         } while ($c && $e);
                     }',
             ],
+            'doConditionInWhileAndIfWithSingleVar' => [
+                '<?php
+                    $b = !!rand(0, 1);
+
+                    do {
+                        if (!$b) {
+                           $b = !rand(0, 1);
+                        }
+                    } while (!$b);',
+                [
+                    '$b' => 'true'
+                ]
+            ],
+            'doConditionInWhileAndIfWithTwoVars' => [
+                '<?php
+                    $b = !!rand(0, 1);
+
+                    do {
+                        $s = rand(0, 1);
+                        if (!$b && $s) {}
+                    } while (!$b && $s);
+
+                    if ($b) {}'
+            ],
         ];
     }
 
@@ -375,9 +399,7 @@ class DoTest extends \Psalm\Tests\TestCase
                 '<?php
                     do {
                         $array[] = "hello";
-                    } while (rand(0, 1));
-
-                    echo $array;',
+                    } while (rand(0, 1));',
                 'error_message' => 'PossiblyUndefinedGlobalVariable - src' . DIRECTORY_SEPARATOR . 'somefile.php:3:25 - Possibly undefined ' .
                     'global variable $array, first seen on line 3',
             ],
