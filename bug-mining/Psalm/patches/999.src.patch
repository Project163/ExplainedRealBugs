diff --git a/src/Psalm/Internal/Provider/ReturnTypeProvider/ArrayMapReturnTypeProvider.php b/src/Psalm/Internal/Provider/ReturnTypeProvider/ArrayMapReturnTypeProvider.php
index 058ec29b9..0ac498c8a 100644
--- a/src/Psalm/Internal/Provider/ReturnTypeProvider/ArrayMapReturnTypeProvider.php
+++ b/src/Psalm/Internal/Provider/ReturnTypeProvider/ArrayMapReturnTypeProvider.php
@@ -230,7 +230,7 @@ class ArrayMapReturnTypeProvider implements \Psalm\Plugin\Hook\FunctionReturnTyp
     }
 
     /**
-     * @param-out array<string, array<array<string>>>|null $assertions
+     * @param-out array<string, array<array<int, string>>>|null $assertions
      */
     private static function executeFakeCall(
         \Psalm\Internal\Analyzer\StatementsAnalyzer $statements_analyzer,
@@ -309,9 +309,9 @@ class ArrayMapReturnTypeProvider implements \Psalm\Plugin\Hook\FunctionReturnTyp
     }
 
     /**
-     * @param non-empty-array<string> $mapping_function_ids
+     * @param non-empty-array<int, string> $mapping_function_ids
      * @param list<PhpParser\Node\Arg> $array_args
-     * @param-out array<string, array<array<string>>>|null $assertions
+     * @param-out array<string, array<array<int, string>>>|null $assertions
      */
     public static function getReturnTypeFromMappingIds(
         \Psalm\Internal\Analyzer\StatementsAnalyzer $statements_source,
diff --git a/src/Psalm/Type/Reconciler.php b/src/Psalm/Type/Reconciler.php
index 90ecc69ef..de9fdce7a 100644
--- a/src/Psalm/Type/Reconciler.php
+++ b/src/Psalm/Type/Reconciler.php
@@ -46,8 +46,8 @@ class Reconciler
     /**
      * Takes two arrays and consolidates them, removing null values from existing types where applicable
      *
-     * @param  array<string, array<int, array<int, string>>> $new_types
-     * @param  array<string, array<int, array<int, string>>> $active_new_types - types we can complain about
+     * @param  array<string, array<array<int, string>>> $new_types
+     * @param  array<string, array<array<int, string>>> $active_new_types - types we can complain about
      * @param  array<string, Type\Union> $existing_types
      * @param  array<string, bool>       $changed_var_ids
      * @param  array<string, bool>       $referenced_var_ids
@@ -282,10 +282,23 @@ class Reconciler
     }
 
     /**
-     * @param array<string, array<int, array<int, string>>> $new_types
+     * This generates a list of extra assertions for an assertion on a nested key.
+     *
+     * For example  ['$a[0]->foo->bar' => 'isset']
+     *
+     * generates the assertions
+     *
+     * [
+     *     '$a' => '=int-or-string-array-access',
+     *     '$a[0]' => '=isset',
+     *     '$a[0]->foo' => '=isset',
+     *     '$a[0]->foo->bar' => 'isset' // original assertion
+     * ]
+     *
+     * @param array<string, array<array<int, string>>> $new_types
      * @param array<string, Type\Union> $existing_types
      *
-     * @return array<string, array<int, array<int, string>>>
+     * @return array<string, array<array<int, string>>>
      */
     private static function addNestedAssertions(array $new_types, array $existing_types) : array
     {
@@ -341,6 +354,10 @@ class Reconciler
                             $property_name = array_shift($key_parts);
                             $new_base_key = $base_key . '->' . $property_name;
 
+                            if (!isset($new_types[$base_key])) {
+                                $new_types[$base_key] = [['=isset']];
+                            }
+
                             $base_key = $new_base_key;
                         } else {
                             break;
diff --git a/tests/ArrayAccessTest.php b/tests/ArrayAccessTest.php
index fcfb3aff8..e14a91b38 100644
--- a/tests/ArrayAccessTest.php
+++ b/tests/ArrayAccessTest.php
@@ -216,6 +216,29 @@ class ArrayAccessTest extends TestCase
         $this->analyzeFile('somefile.php', new \Psalm\Context());
     }
 
+    public function testEnsureOffsetExistsAfterNestedIsset(): void
+    {
+        \Psalm\Config::getInstance()->ensure_array_string_offsets_exist = true;
+
+        $this->addFile(
+            'somefile.php',
+            '<?php
+                class A {
+                    public int $foo = 0;
+                }
+
+                /**
+                 * @param array<string, A> $value
+                 */
+                function test(array $value): int
+                {
+                    return isset($value["a"]->foo) ? $value["a"]->foo : 0;
+                }'
+        );
+
+        $this->analyzeFile('somefile.php', new \Psalm\Context());
+    }
+
     public function testEnsureListOffsetExistsAfterCountValueInRange(): void
     {
         \Psalm\Config::getInstance()->ensure_array_int_offsets_exist = true;
