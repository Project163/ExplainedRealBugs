diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/Call/FunctionCallAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/Call/FunctionCallAnalyzer.php
index 153e66708..31b68b426 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/Call/FunctionCallAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/Call/FunctionCallAnalyzer.php
@@ -707,7 +707,8 @@ class FunctionCallAnalyzer extends \Psalm\Internal\Analyzer\Statements\Expressio
                 ? $codebase->functions->isCallMapFunctionPure($codebase, $function_id, $stmt->args, $must_use)
                 : null;
 
-            if (($function_storage
+            if ((!$in_call_map
+                    && $function_storage
                     && !$function_storage->pure)
                 || ($callmap_function_pure === false)
             ) {
diff --git a/tests/PureAnnotationTest.php b/tests/PureAnnotationTest.php
index 140593cd2..9b82879a0 100644
--- a/tests/PureAnnotationTest.php
+++ b/tests/PureAnnotationTest.php
@@ -166,6 +166,22 @@ class PureAnnotationTest extends TestCase
                         }
                     }',
             ],
+            'sortFunction' => [
+                '<?php
+                    /**
+                     * @psalm-pure
+                     *
+                     * @param int[] $ar
+                     */
+                    function foo(array $ar): int
+                    {
+                        usort($ar, static function (int $a, int $b): int {
+                            return $a <=> $b;
+                        });
+
+                        return $ar[0] ?? 0;
+                    }',
+            ],
         ];
     }
 
@@ -308,6 +324,24 @@ class PureAnnotationTest extends TestCase
                     }',
                 'error_message' => 'ImpureFunctionCall',
             ],
+            'sortFunctionImpure' => [
+                '<?php
+                    /**
+                     * @psalm-pure
+                     *
+                     * @param int[] $ar
+                     */
+                    function foo(array $ar): int
+                    {
+                        usort($ar, static function (int $a, int $b): int {
+                            session_start();
+                            return $a <=> $b;
+                        });
+
+                        return $ar[0] ?? 0;
+                    }',
+                'error_message' => 'ImpureFunctionCall',
+            ],
         ];
     }
 }
