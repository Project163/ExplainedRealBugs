diff --git a/src/Psalm/Internal/Type/AssertionReconciler.php b/src/Psalm/Internal/Type/AssertionReconciler.php
index 6b1fac74b..1d9eaafcc 100644
--- a/src/Psalm/Internal/Type/AssertionReconciler.php
+++ b/src/Psalm/Internal/Type/AssertionReconciler.php
@@ -1016,6 +1016,7 @@ class AssertionReconciler extends \Psalm\Type\Reconciler
                     $has_string = true;
                 } elseif ($existing_var_atomic_type instanceof TTemplateParam) {
                     if ($existing_var_atomic_type->as->hasMixed()
+                        || $existing_var_atomic_type->as->hasString()
                         || $existing_var_atomic_type->as->hasScalar()
                         || $existing_var_atomic_type->as->hasArrayKey()
                     ) {
@@ -1023,7 +1024,20 @@ class AssertionReconciler extends \Psalm\Type\Reconciler
                             return $existing_var_type;
                         }
 
-                        return new Type\Union([new Type\Atomic\TLiteralString($value)]);
+                        $existing_var_atomic_type = clone $existing_var_atomic_type;
+
+                        $existing_var_atomic_type->as = self::handleLiteralEquality(
+                            $assertion,
+                            $bracket_pos,
+                            $is_loose_equality,
+                            $existing_var_atomic_type->as,
+                            $old_var_type_string,
+                            $var_id,
+                            $code_location,
+                            $suppressed_issues
+                        );
+
+                        return new Type\Union([$existing_var_atomic_type]);
                     }
 
                     if ($existing_var_atomic_type->as->hasString()) {
diff --git a/src/Psalm/Internal/Type/SimpleAssertionReconciler.php b/src/Psalm/Internal/Type/SimpleAssertionReconciler.php
index 327843796..8baab0e63 100644
--- a/src/Psalm/Internal/Type/SimpleAssertionReconciler.php
+++ b/src/Psalm/Internal/Type/SimpleAssertionReconciler.php
@@ -348,6 +348,7 @@ class SimpleAssertionReconciler extends \Psalm\Type\Reconciler
         if ($existing_var_type->isSingle()
             && $existing_var_type->hasTemplate()
             && strpos($assertion, '-') === false
+            && strpos($assertion, '(') === false
         ) {
             foreach ($existing_var_type->getAtomicTypes() as $atomic_type) {
                 if ($atomic_type instanceof TTemplateParam) {
diff --git a/tests/ImmutableAnnotationTest.php b/tests/ImmutableAnnotationTest.php
index 4f806334c..52e49b358 100644
--- a/tests/ImmutableAnnotationTest.php
+++ b/tests/ImmutableAnnotationTest.php
@@ -408,6 +408,45 @@ class ImmutableAnnotationTest extends TestCase
                     $item = new Item();
                     new Immutable($item);',
             ],
+            'noCrashWhenCheckingValueTwice' => [
+                '<?php
+                    /**
+                     * @psalm-template T
+                     * @psalm-immutable
+                     */
+                    abstract class Enum {
+                        /** @var T */
+                        private $value;
+
+                        /** @param T $value */
+                        public function __construct($value) {
+                            $this->value = $value;
+                        }
+
+                        /**
+                         * @psalm-pure
+                         * @return mixed
+                         * @psalm-return T
+                         */
+                        public function getValue() {
+                            return $this->value;
+                        }
+                    }
+
+                    /**
+                     * @extends Enum<string>
+                     * @psalm-immutable
+                     */
+                    class TestEnum extends Enum {
+                        public const TEST = "test";
+                    }
+
+                    function foo(TestEnum $e): void {
+                        if ($e->getValue() === TestEnum::TEST
+                            && $e->getValue() === TestEnum::TEST
+                        ) {}
+                    }'
+            ],
         ];
     }
 
