diff --git a/src/Psalm/Internal/Stubs/CoreGenericFunctions.phpstub b/src/Psalm/Internal/Stubs/CoreGenericFunctions.phpstub
index bb4035e62..251a581c8 100644
--- a/src/Psalm/Internal/Stubs/CoreGenericFunctions.phpstub
+++ b/src/Psalm/Internal/Stubs/CoreGenericFunctions.phpstub
@@ -135,8 +135,7 @@ function array_flip(array $arr)
  *
  * @param array<TKey, mixed> $arr
  *
- * @return TKey|null
- * @psalm-ignore-nullable-return
+ * @return (TKey is empty ? null : ($arr is non-empty-array ? TKey : TKey|null))
  * @psalm-pure
  */
 function key($arr)
@@ -148,8 +147,7 @@ function key($arr)
  *
  * @param array<TKey, mixed> $arr
  *
- * @return TKey|null
- * @psalm-ignore-nullable-return
+ * @return (TKey is empty ? null : ($arr is non-empty-array ? TKey : TKey|null))
  * @psalm-pure
  */
 function array_key_first($arr)
@@ -161,8 +159,7 @@ function array_key_first($arr)
  *
  * @param array<TKey, mixed> $arr
  *
- * @return TKey|null
- * @psalm-ignore-nullable-return
+ * @return (TKey is empty ? null : ($arr is non-empty-array ? TKey : TKey|null))
  * @psalm-pure
  */
 function array_key_last($arr)
diff --git a/tests/ArrayFunctionCallTest.php b/tests/ArrayFunctionCallTest.php
index cc12f1d51..45b4b2ee3 100644
--- a/tests/ArrayFunctionCallTest.php
+++ b/tests/ArrayFunctionCallTest.php
@@ -766,32 +766,81 @@ class ArrayFunctionCallTest extends TestCase
                 '<?php
                     $a = ["one" => 1, "two" => 3];
                     $b = key($a);
-                    $c = $a[$b];',
+                    $c = null;
+                    if ($b !== null) {
+                        $c = $a[$b];
+                    }',
                 'assertions' => [
                     '$b' => 'null|string',
-                    '$c' => 'int',
+                    '$c' => 'int|null',
                 ],
             ],
-            'array_key_first' => [
+            'arrayKeyFirst' => [
+                '<?php
+                    /** @return array<string, int> */
+                    function makeArray(): array { return ["one" => 1, "two" => 3]; }
+                    $a = makeArray();
+                    $b = array_key_first($a);
+                    $c = null;
+                    if ($b !== null) {
+                        $c = $a[$b];
+                    }',
+                'assertions' => [
+                    '$b' => 'null|string',
+                    '$c' => 'int|null',
+                ],
+            ],
+            'arrayKeyFirstNonEmpty' => [
                 '<?php
                     $a = ["one" => 1, "two" => 3];
                     $b = array_key_first($a);
                     $c = $a[$b];',
                 'assertions' => [
-                    '$b' => 'null|string',
+                    '$b' => 'string',
                     '$c' => 'int',
                 ],
             ],
-            'array_key_last' => [
+            'arrayKeyFirstEmpty' => [
+                '<?php
+                    $a = [];
+                    $b = array_key_first($a);',
+                'assertions' => [
+                    '$b' => 'null'
+                ],
+            ],
+            'arrayKeyLast' => [
+                '<?php
+                    /** @return array<string, int> */
+                    function makeArray(): array { return ["one" => 1, "two" => 3]; }
+                    $a = makeArray();
+                    $b = array_key_last($a);
+                    $c = null;
+                    if ($b !== null) {
+                        $c = $a[$b];
+                    }',
+                'assertions' => [
+                    '$b' => 'null|string',
+                    '$c' => 'int|null',
+                ],
+            ],
+            'arrayKeyLastNonEmpty' => [
                 '<?php
                     $a = ["one" => 1, "two" => 3];
                     $b = array_key_last($a);
                     $c = $a[$b];',
                 'assertions' => [
-                    '$b' => 'null|string',
+                    '$b' => 'string',
                     '$c' => 'int',
                 ],
             ],
+            'arrayKeyLastEmpty' => [
+                '<?php
+                    $a = [];
+                    $b = array_key_last($a);',
+                'assertions' => [
+                    '$b' => 'null'
+                ],
+            ],
             'arrayColumnInference' => [
                 '<?php
                     function makeMixedArray(): array { return []; }
