diff --git a/src/Psalm/Internal/Analyzer/ClassAnalyzer.php b/src/Psalm/Internal/Analyzer/ClassAnalyzer.php
index 5d11a3e36..18bdaf558 100644
--- a/src/Psalm/Internal/Analyzer/ClassAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/ClassAnalyzer.php
@@ -772,7 +772,7 @@ class ClassAnalyzer extends ClassLikeAnalyzer
                     );
 
                     if ($property_storage->location
-                        && !$property_type->equals($guide_property_type)
+                        && !$property_type->equals($guide_property_type, false)
                         && $guide_class_storage->user_defined
                     ) {
                         if (IssueBuffer::accepts(
diff --git a/src/Psalm/Internal/Type/Comparator/ArrayTypeComparator.php b/src/Psalm/Internal/Type/Comparator/ArrayTypeComparator.php
index 042cc2bc3..0f1579c4f 100644
--- a/src/Psalm/Internal/Type/Comparator/ArrayTypeComparator.php
+++ b/src/Psalm/Internal/Type/Comparator/ArrayTypeComparator.php
@@ -33,10 +33,7 @@ class ArrayTypeComparator
     ) : bool {
         $all_types_contain = true;
 
-        $is_empty_array = $input_type_part->equals(new Type\Atomic\TArray([
-            new Type\Union([new Type\Atomic\TEmpty()]),
-            new Type\Union([new Type\Atomic\TEmpty()])
-        ]));
+        $is_empty_array = $input_type_part->getId() === 'array<empty, empty>';
         if ($is_empty_array
             && ($container_type_part instanceof Type\Atomic\TArray
                 || $container_type_part instanceof Type\Atomic\TKeyedArray)
diff --git a/src/Psalm/Internal/Type/Comparator/ObjectComparator.php b/src/Psalm/Internal/Type/Comparator/ObjectComparator.php
index 230304d4c..ddc645379 100644
--- a/src/Psalm/Internal/Type/Comparator/ObjectComparator.php
+++ b/src/Psalm/Internal/Type/Comparator/ObjectComparator.php
@@ -87,7 +87,7 @@ class ObjectComparator
                             }
 
                             foreach ($intersection_input_type->as->getAtomicTypes() as $input_as_atomic) {
-                                if ($input_as_atomic->equals($intersection_container_type)) {
+                                if ($input_as_atomic->equals($intersection_container_type, false)) {
                                     continue 3;
                                 }
                             }
diff --git a/src/Psalm/Type/Atomic.php b/src/Psalm/Type/Atomic.php
index 36581acb4..4a7b5a367 100644
--- a/src/Psalm/Type/Atomic.php
+++ b/src/Psalm/Type/Atomic.php
@@ -614,7 +614,7 @@ abstract class Atomic implements TypeNode
         // do nothing
     }
 
-    public function equals(Atomic $other_type): bool
+    public function equals(Atomic $other_type, bool $ensure_source_equality): bool
     {
         return get_class($other_type) === get_class($this);
     }
diff --git a/src/Psalm/Type/Atomic/TArray.php b/src/Psalm/Type/Atomic/TArray.php
index 45262bc75..7dced6f43 100644
--- a/src/Psalm/Type/Atomic/TArray.php
+++ b/src/Psalm/Type/Atomic/TArray.php
@@ -55,7 +55,7 @@ class TArray extends \Psalm\Type\Atomic
         return $this->type_params[0]->isArrayKey() && $this->type_params[1]->isMixed();
     }
 
-    public function equals(Atomic $other_type): bool
+    public function equals(Atomic $other_type, bool $ensure_source_equality): bool
     {
         if (get_class($other_type) !== static::class) {
             return false;
@@ -73,7 +73,7 @@ class TArray extends \Psalm\Type\Atomic
         }
 
         foreach ($this->type_params as $i => $type_param) {
-            if (!$type_param->equals($other_type->type_params[$i])) {
+            if (!$type_param->equals($other_type->type_params[$i], $ensure_source_equality)) {
                 return false;
             }
         }
diff --git a/src/Psalm/Type/Atomic/TClassStringMap.php b/src/Psalm/Type/Atomic/TClassStringMap.php
index f49095644..ddeb93f93 100644
--- a/src/Psalm/Type/Atomic/TClassStringMap.php
+++ b/src/Psalm/Type/Atomic/TClassStringMap.php
@@ -209,13 +209,13 @@ class TClassStringMap extends \Psalm\Type\Atomic
         return [$this->value_param];
     }
 
-    public function equals(Atomic $other_type): bool
+    public function equals(Atomic $other_type, bool $ensure_source_equality): bool
     {
         if (get_class($other_type) !== static::class) {
             return false;
         }
 
-        if (!$this->value_param->equals($other_type->value_param)) {
+        if (!$this->value_param->equals($other_type->value_param, $ensure_source_equality)) {
             return false;
         }
 
diff --git a/src/Psalm/Type/Atomic/TGenericObject.php b/src/Psalm/Type/Atomic/TGenericObject.php
index 9900c49ac..c00284a66 100644
--- a/src/Psalm/Type/Atomic/TGenericObject.php
+++ b/src/Psalm/Type/Atomic/TGenericObject.php
@@ -71,7 +71,7 @@ class TGenericObject extends TNamedObject
         return parent::toNamespacedString($namespace, $aliased_classes, $this_class, false);
     }
 
-    public function equals(Atomic $other_type): bool
+    public function equals(Atomic $other_type, bool $ensure_source_equality): bool
     {
         if (!$other_type instanceof self) {
             return false;
@@ -82,7 +82,7 @@ class TGenericObject extends TNamedObject
         }
 
         foreach ($this->type_params as $i => $type_param) {
-            if (!$type_param->equals($other_type->type_params[$i])) {
+            if (!$type_param->equals($other_type->type_params[$i], $ensure_source_equality)) {
                 return false;
             }
         }
diff --git a/src/Psalm/Type/Atomic/TIterable.php b/src/Psalm/Type/Atomic/TIterable.php
index 3c13d395c..7acbbc75d 100644
--- a/src/Psalm/Type/Atomic/TIterable.php
+++ b/src/Psalm/Type/Atomic/TIterable.php
@@ -99,7 +99,7 @@ class TIterable extends Atomic
         return $this->type_params[0]->isMixed() && $this->type_params[1]->isMixed();
     }
 
-    public function equals(Atomic $other_type): bool
+    public function equals(Atomic $other_type, bool $ensure_source_equality): bool
     {
         if (!$other_type instanceof self) {
             return false;
@@ -110,7 +110,7 @@ class TIterable extends Atomic
         }
 
         foreach ($this->type_params as $i => $type_param) {
-            if (!$type_param->equals($other_type->type_params[$i])) {
+            if (!$type_param->equals($other_type->type_params[$i], $ensure_source_equality)) {
                 return false;
             }
         }
diff --git a/src/Psalm/Type/Atomic/TKeyedArray.php b/src/Psalm/Type/Atomic/TKeyedArray.php
index 0412c26db..2b71e348d 100644
--- a/src/Psalm/Type/Atomic/TKeyedArray.php
+++ b/src/Psalm/Type/Atomic/TKeyedArray.php
@@ -366,7 +366,7 @@ class TKeyedArray extends \Psalm\Type\Atomic
         return $this->properties;
     }
 
-    public function equals(Atomic $other_type): bool
+    public function equals(Atomic $other_type, bool $ensure_source_equality): bool
     {
         if (get_class($other_type) !== static::class) {
             return false;
@@ -385,7 +385,7 @@ class TKeyedArray extends \Psalm\Type\Atomic
                 return false;
             }
 
-            if (!$property_type->equals($other_type->properties[$property_name])) {
+            if (!$property_type->equals($other_type->properties[$property_name], $ensure_source_equality)) {
                 return false;
             }
         }
diff --git a/src/Psalm/Type/Atomic/TList.php b/src/Psalm/Type/Atomic/TList.php
index 62bf105f7..c3a3689dc 100644
--- a/src/Psalm/Type/Atomic/TList.php
+++ b/src/Psalm/Type/Atomic/TList.php
@@ -177,13 +177,13 @@ class TList extends \Psalm\Type\Atomic
         );
     }
 
-    public function equals(Atomic $other_type): bool
+    public function equals(Atomic $other_type, bool $ensure_source_equality): bool
     {
         if (get_class($other_type) !== static::class) {
             return false;
         }
 
-        if (!$this->type_param->equals($other_type->type_param)) {
+        if (!$this->type_param->equals($other_type->type_param, $ensure_source_equality)) {
             return false;
         }
 
diff --git a/src/Psalm/Type/Atomic/TObjectWithProperties.php b/src/Psalm/Type/Atomic/TObjectWithProperties.php
index 268701d85..2e11eb26a 100644
--- a/src/Psalm/Type/Atomic/TObjectWithProperties.php
+++ b/src/Psalm/Type/Atomic/TObjectWithProperties.php
@@ -189,7 +189,7 @@ class TObjectWithProperties extends TObject
         }
     }
 
-    public function equals(Atomic $other_type): bool
+    public function equals(Atomic $other_type, bool $ensure_source_equality): bool
     {
         if (!$other_type instanceof self) {
             return false;
@@ -208,7 +208,7 @@ class TObjectWithProperties extends TObject
                 return false;
             }
 
-            if (!$property_type->equals($other_type->properties[$property_name])) {
+            if (!$property_type->equals($other_type->properties[$property_name], $ensure_source_equality)) {
                 return false;
             }
         }
diff --git a/src/Psalm/Type/Union.php b/src/Psalm/Type/Union.php
index a4695c3d2..be201478b 100644
--- a/src/Psalm/Type/Union.php
+++ b/src/Psalm/Type/Union.php
@@ -1360,7 +1360,7 @@ class Union implements TypeNode
         }
     }
 
-    public function equals(Union $other_type): bool
+    public function equals(Union $other_type, bool $ensure_source_equality = true): bool
     {
         if ($other_type === $this) {
             return true;
@@ -1390,7 +1390,7 @@ class Union implements TypeNode
             return false;
         }
 
-        if ($this->from_docblock !== $other_type->from_docblock) {
+        if ($ensure_source_equality && $this->from_docblock !== $other_type->from_docblock) {
             return false;
         }
 
@@ -1413,7 +1413,7 @@ class Union implements TypeNode
                 return false;
             }
 
-            if (!$atomic_type->equals($other_atomic_types[$key])) {
+            if (!$atomic_type->equals($other_atomic_types[$key], $ensure_source_equality)) {
                 return false;
             }
         }
diff --git a/tests/PropertyTypeTest.php b/tests/PropertyTypeTest.php
index 957245660..422db2024 100644
--- a/tests/PropertyTypeTest.php
+++ b/tests/PropertyTypeTest.php
@@ -2502,6 +2502,18 @@ class PropertyTypeTest extends TestCase
                     $mode->enableAutoCommit();
                     assert($mode->isAutoCommitEnabled() === true);'
             ],
+            'promotedInheritedPropertyWithDocblock' => [
+                '<?php
+                    abstract class A {
+                        /** @var array */
+                        public array $arr;
+                    }
+
+                    final class B extends A {
+                        /** @param array $arr */
+                        protected function __construct(public array $arr){}
+                    }'
+            ],
         ];
     }
 
