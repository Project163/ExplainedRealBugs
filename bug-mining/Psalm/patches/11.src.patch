diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/IncludeAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/IncludeAnalyzer.php
index 0a5c18814..d51d11a2a 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/IncludeAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/IncludeAnalyzer.php
@@ -79,6 +79,7 @@ class IncludeAnalyzer
 
             if ($current_file_analyzer->project_analyzer->fileExists($path_to_file)) {
                 if ($statements_analyzer->hasParentFilePath($path_to_file)
+                    || !$codebase->file_storage_provider->has($path_to_file)
                     || ($statements_analyzer->hasAlreadyRequiredFilePath($path_to_file)
                         && !$codebase->file_storage_provider->get($path_to_file)->has_extra_statements)
                 ) {
diff --git a/src/Psalm/Internal/Provider/FileStorageProvider.php b/src/Psalm/Internal/Provider/FileStorageProvider.php
index e15177c9e..6454adef2 100644
--- a/src/Psalm/Internal/Provider/FileStorageProvider.php
+++ b/src/Psalm/Internal/Provider/FileStorageProvider.php
@@ -66,7 +66,7 @@ class FileStorageProvider
      *
      * @return bool
      */
-    public function has($file_path, $file_contents)
+    public function has($file_path, string $file_contents = null)
     {
         $file_path = strtolower($file_path);
 
@@ -78,14 +78,16 @@ class FileStorageProvider
             return false;
         }
 
-        $cached_value = $this->cache->getLatestFromCache($file_path, $file_contents);
+        if ($file_contents !== null) {
+            $cached_value = $this->cache->getLatestFromCache($file_path, $file_contents);
 
-        if (!$cached_value) {
-            return false;
-        }
+            if (!$cached_value) {
+                return false;
+            }
 
-        self::$storage[$file_path] = $cached_value;
-        self::$new_storage[$file_path] = $cached_value;
+            self::$storage[$file_path] = $cached_value;
+            self::$new_storage[$file_path] = $cached_value;
+        }
 
         return true;
     }
diff --git a/tests/IncludeTest.php b/tests/IncludeTest.php
index 29fd1654a..d43356ca3 100644
--- a/tests/IncludeTest.php
+++ b/tests/IncludeTest.php
@@ -539,6 +539,21 @@ class IncludeTest extends TestCase
                     getcwd() . DIRECTORY_SEPARATOR . 'index.php',
                 ],
             ],
+            'suppressMissingFile' => [
+                'files' => [
+                    getcwd() . DIRECTORY_SEPARATOR . 'file1.php' => '<?php
+                        function getEndpoints() : void {
+                            $listFile = "tests/stubs/custom_functions.php";
+                            if (!file_exists($listFile)) {
+                                throw new RuntimeException("Endpoint list not found");
+                            }
+                            include $listFile;
+                        }',
+                ],
+                'files_to_check' => [
+                    getcwd() . DIRECTORY_SEPARATOR . 'file1.php',
+                ],
+            ],
         ];
     }
 
