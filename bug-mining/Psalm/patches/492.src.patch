diff --git a/src/Psalm/Internal/Analyzer/TypeAnalyzer.php b/src/Psalm/Internal/Analyzer/TypeAnalyzer.php
index 4002000a7..110f34c32 100644
--- a/src/Psalm/Internal/Analyzer/TypeAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/TypeAnalyzer.php
@@ -2014,6 +2014,16 @@ class TypeAnalyzer
                 $container_param = $container_type_part->type_params[$i];
 
                 if ($input_param->isEmpty()) {
+                    if (!$atomic_comparison_result->replacement_atomic_type) {
+                        $atomic_comparison_result->replacement_atomic_type = clone $input_type_part;
+                    }
+
+                    if ($atomic_comparison_result->replacement_atomic_type instanceof TGenericObject) {
+                        /** @psalm-suppress PropertyTypeCoercion */
+                        $atomic_comparison_result->replacement_atomic_type->type_params[$i]
+                            = clone $container_param;
+                    }
+
                     continue;
                 }
 
diff --git a/tests/Template/ClassTemplateTest.php b/tests/Template/ClassTemplateTest.php
index b007c5dcc..3900a8e42 100644
--- a/tests/Template/ClassTemplateTest.php
+++ b/tests/Template/ClassTemplateTest.php
@@ -331,7 +331,7 @@ class ClassTemplateTest extends TestCase
                          * @return ArrayCollection<TKey,T>
                          */
                         public function map(Closure $func) {
-                          return new static(array_map($func, $this->data));
+                            return new static(array_map($func, $this->data));
                         }
                     }
 
@@ -428,13 +428,13 @@ class ClassTemplateTest extends TestCase
                     $c = new Collection;
 
                     $c->filter(
-                      /** @param Collection<mixed,I> $elt */
-                      function(Collection $elt): bool { return (bool) rand(0,1); }
+                        /** @param Collection<mixed,I> $elt */
+                        function(Collection $elt): bool { return (bool) rand(0,1); }
                     );
 
                     $c->filter(
-                      /** @param Collection<mixed,I> $elt */
-                      function(Collection $elt): bool { return true; }
+                        /** @param Collection<mixed,I> $elt */
+                        function(Collection $elt): bool { return true; }
                     );',
             ],
             'templatedInterfaceIteration' => [
@@ -1128,8 +1128,8 @@ class ClassTemplateTest extends TestCase
                         public $records;
 
                         /**
-                          * @param array<I, V> $records
-                          */
+                         * @param array<I, V> $records
+                         */
                         public function __construct(array $records) {
                             $this->records = $records;
                         }
@@ -1146,7 +1146,7 @@ class ClassTemplateTest extends TestCase
                             $arr = [];
                             foreach ($this->records as $key => $obj) {
                                 if (rand(0, 1)) {
-                                  $obj = $obj2;
+                                    $obj = $obj2;
                                 }
                                 $arr[$key] = $obj;
                             }
@@ -1211,7 +1211,7 @@ class ClassTemplateTest extends TestCase
                             $arr = [];
                             foreach ($this->records as $key => $obj) {
                                 if (rand(0, 1)) {
-                                  $obj = new $obj2;
+                                    $obj = new $obj2;
                                 }
                                 $arr[$key] = $obj;
                             }
@@ -1852,23 +1852,22 @@ class ClassTemplateTest extends TestCase
 
                     class Bar
                     {
-                      /** @var Foo<array> */
-                      private $FooArray;
+                        /** @var Foo<array> */
+                        private $FooArray;
 
-                      public function __construct()
-                      {
-                          $this->FooArray = new Foo(function(string $s): array {
-                              /** @psalm-suppress MixedAssignment */
-                              $json = \json_decode($s, true);
+                        public function __construct() {
+                            $this->FooArray = new Foo(function(string $s): array {
+                                /** @psalm-suppress MixedAssignment */
+                                $json = \json_decode($s, true);
 
-                              if (! \is_array($json)) {
-                                  return [];
-                              }
+                                if (! \is_array($json)) {
+                                    return [];
+                                }
 
-                              return $json;
-                          });
+                                return $json;
+                            });
 
-                          takesFooArray($this->FooArray);
+                            takesFooArray($this->FooArray);
                         }
                     }
 
@@ -2275,6 +2274,55 @@ class ClassTemplateTest extends TestCase
                         }
                     }'
             ],
+            'newGenericBecomesPropertyType' => [
+                '<?php
+                    class B {}
+
+                    class A {
+                        /** @var ArrayCollection<int, B> */
+                        public ArrayCollection $b_collection;
+
+                        public function __construct() {
+                            $this->b_collection = new ArrayCollection([]);
+                            $this->b_collection->add(5, new B());
+                        }
+                    }
+
+                    /**
+                     * @psalm-template TKey
+                     * @psalm-template T
+                     */
+                    class ArrayCollection
+                    {
+                        /**
+                         * An array containing the entries of this collection.
+                         *
+                         * @psalm-var array<TKey,T>
+                         * @var array
+                         */
+                        private $elements = [];
+
+                        /**
+                         * Initializes a new ArrayCollection.
+                         *
+                         * @param array $elements
+                         *
+                         * @psalm-param array<TKey,T> $elements
+                         */
+                        public function __construct(array $elements = [])
+                        {
+                            $this->elements = $elements;
+                        }
+
+                        /**
+                         * @param TKey $key
+                         * @param T $t
+                         */
+                        public function add($key, $t) : void {
+                            $this->elements[$key] = $t;
+                        }
+                    }'
+            ],
         ];
     }
 
@@ -2722,6 +2770,57 @@ class ClassTemplateTest extends TestCase
                     }',
                 'error_message' => 'UndefinedDocblockClass'
             ],
+            'newGenericBecomesPropertyType' => [
+                '<?php
+                    class B {}
+                    class C {}
+
+                    class A {
+                        /** @var ArrayCollection<int, B> */
+                        public ArrayCollection $b_collection;
+
+                        public function __construct() {
+                            $this->b_collection = new ArrayCollection([]);
+                            $this->b_collection->add(5, new C());
+                        }
+                    }
+
+                    /**
+                     * @psalm-template TKey
+                     * @psalm-template T
+                     */
+                    class ArrayCollection
+                    {
+                        /**
+                         * An array containing the entries of this collection.
+                         *
+                         * @psalm-var array<TKey,T>
+                         * @var array
+                         */
+                        private $elements = [];
+
+                        /**
+                         * Initializes a new ArrayCollection.
+                         *
+                         * @param array $elements
+                         *
+                         * @psalm-param array<TKey,T> $elements
+                         */
+                        public function __construct(array $elements = [])
+                        {
+                            $this->elements = $elements;
+                        }
+
+                        /**
+                         * @param TKey $key
+                         * @param T $t
+                         */
+                        public function add($key, $t) : void {
+                            $this->elements[$key] = $t;
+                        }
+                    }',
+                'error_message' => 'InvalidArgument'
+            ],
         ];
     }
 }
