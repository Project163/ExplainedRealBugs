diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/AssertionFinder.php b/src/Psalm/Internal/Analyzer/Statements/Expression/AssertionFinder.php
index 6e53f9912..480bbeb36 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/AssertionFinder.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/AssertionFinder.php
@@ -2037,6 +2037,11 @@ class AssertionFinder
                     $source->getAliases()
                 );
 
+                if ($source instanceof StatementsAnalyzer) {
+                    $codebase = $source->getCodebase();
+                    $instanceof_class = $codebase->classlikes->getUnAliasedName($instanceof_class);
+                }
+
                 return [$instanceof_class];
             } elseif ($this_class_name
                 && (in_array(strtolower($stmt->class->parts[0]), ['self', 'static'], true))
diff --git a/src/Psalm/Internal/Visitor/ReflectorVisitor.php b/src/Psalm/Internal/Visitor/ReflectorVisitor.php
index 3f47deb85..25922913d 100644
--- a/src/Psalm/Internal/Visitor/ReflectorVisitor.php
+++ b/src/Psalm/Internal/Visitor/ReflectorVisitor.php
@@ -349,6 +349,10 @@ class ReflectorVisitor extends PhpParser\NodeVisitorAbstract implements PhpParse
                 $this->registerClassMapFunctionCall($function_id, $node);
             }
         } elseif ($node instanceof PhpParser\Node\Stmt\TraitUse) {
+            if ($this->skip_if_descendants) {
+                return;
+            }
+
             if (!$this->classlike_storages) {
                 throw new \LogicException('$this->classlike_storages should not be empty');
             }
