diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/Call/Method/MethodCallPurityAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/Call/Method/MethodCallPurityAnalyzer.php
index a3b030ee8..9d5ed21ca 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/Call/Method/MethodCallPurityAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/Call/Method/MethodCallPurityAnalyzer.php
@@ -145,7 +145,11 @@ class MethodCallPurityAnalyzer
                     && isset($context->vars_in_scope[$mutation_var_id])
                     && !isset($class_storage->declaring_property_ids[$name]);
 
-                $context->remove($mutation_var_id);
+                $current_context = $context;
+
+                do {
+                    $current_context->remove($mutation_var_id);
+                } while ($current_context = $current_context->parent_context);
 
                 if ($this_property_didnt_exist) {
                     $context->vars_in_scope[$mutation_var_id] = Type::getMixed();
diff --git a/tests/PropertyTypeTest.php b/tests/PropertyTypeTest.php
index 53907c01f..40c703c16 100644
--- a/tests/PropertyTypeTest.php
+++ b/tests/PropertyTypeTest.php
@@ -2392,6 +2392,28 @@ class PropertyTypeTest extends TestCase
                         echo $bar->{$b} ?? null;
                     }',
             ],
+            'dontMemoizeConditionalAssignment' => [
+                '<?php
+                    class A {}
+
+                    class B {
+                        protected ?A $a = null;
+
+                        public function test(): void {
+                            if (!$this->a) {
+                                $this->mayBeSetA();
+                            }
+                            if ($this->a instanceof A) {
+                            }
+                        }
+
+                        protected function mayBeSetA(): void {
+                            if (mt_rand(0, 1)) {
+                                $this->a = new A();
+                            }
+                        }
+                    }'
+            ],
         ];
     }
 
