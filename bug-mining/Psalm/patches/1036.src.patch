diff --git a/src/Psalm/Internal/Type/TemplateStandinTypeReplacer.php b/src/Psalm/Internal/Type/TemplateStandinTypeReplacer.php
index dde3632c7..5df67708e 100644
--- a/src/Psalm/Internal/Type/TemplateStandinTypeReplacer.php
+++ b/src/Psalm/Internal/Type/TemplateStandinTypeReplacer.php
@@ -132,7 +132,7 @@ class TemplateStandinTypeReplacer
         if ($atomic_type instanceof Atomic\TTemplateParam
             && isset($template_result->template_types[$atomic_type->param_name][$atomic_type->defining_class])
         ) {
-            $a = self::handleTemplateParamStandin(
+            return self::handleTemplateParamStandin(
                 $atomic_type,
                 $key,
                 $input_type,
@@ -147,12 +147,10 @@ class TemplateStandinTypeReplacer
                 $depth,
                 $had_template
             );
-
-            return $a;
         }
 
         if ($atomic_type instanceof Atomic\TTemplateParamClass
-            && isset($template_result->template_types[$atomic_type->param_name])
+            && isset($template_result->template_types[$atomic_type->param_name][$atomic_type->defining_class])
         ) {
             if ($replace) {
                 return self::handleTemplateParamClassStandin(
@@ -796,8 +794,6 @@ class TemplateStandinTypeReplacer
 
         $atomic_types = [];
 
-        $atomic_types[] = $class_string;
-
         if ($input_type && !$template_result->readonly) {
             $valid_input_atomic_types = [];
 
@@ -857,6 +853,25 @@ class TemplateStandinTypeReplacer
                     );
                 }
             }
+        } else {
+            $template_type = $template_result->template_types
+                [$atomic_type->param_name]
+                [$atomic_type->defining_class];
+
+            foreach ($template_type->getAtomicTypes() as $atomic_type) {
+                if ($atomic_type instanceof Atomic\TNamedObject) {
+                    $atomic_types[] = new Atomic\TClassString(
+                        $atomic_type->value,
+                        $atomic_type
+                    );
+                } elseif ($atomic_type instanceof Atomic\TObject) {
+                    $atomic_types[] = new Atomic\TClassString();
+                }
+            }
+        }
+
+        if (!$atomic_types) {
+            $atomic_types[] = $class_string;
         }
 
         return $atomic_types;
diff --git a/tests/Template/FunctionClassStringTemplateTest.php b/tests/Template/FunctionClassStringTemplateTest.php
index 221390d67..2fc3d6c4e 100644
--- a/tests/Template/FunctionClassStringTemplateTest.php
+++ b/tests/Template/FunctionClassStringTemplateTest.php
@@ -810,6 +810,28 @@ class FunctionClassStringTemplateTest extends TestCase
                     }',
                 'error_message' => 'Closure(object):void'
             ],
+            'preventClassStringInPlaceOfTemplatedClassString' => [
+                '<?php
+                    class ImageFile {}
+                    class MusicFile {}
+
+                    /**
+                     * @template T of object
+                     */
+                    interface FileManager {
+                        /**
+                         * @param class-string<T> $instance
+                         * @return T
+                         */
+                        public function create(string $instance) : object;
+                    }
+
+                    /** @param FileManager<ImageFile> $m */
+                    function foo(FileManager $m) : void {
+                        $m->create(MusicFile::class);
+                    }',
+                'error_message' => 'InvalidArgument'
+            ],
         ];
     }
 }
