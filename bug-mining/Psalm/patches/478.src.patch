diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/Fetch/ArrayFetchAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/Fetch/ArrayFetchAnalyzer.php
index a4344125e..7c5b7023d 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/Fetch/ArrayFetchAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/Fetch/ArrayFetchAnalyzer.php
@@ -117,12 +117,27 @@ class ArrayFetchAnalyzer
 
         if ($keyed_array_var_id
             && $context->hasVariable($keyed_array_var_id)
-            && !$context->vars_in_scope[$keyed_array_var_id]->possibly_undefined
+            && !($context->vars_in_scope[$keyed_array_var_id]->possibly_undefined
+                && ($context->inside_isset || $context->inside_unset))
             && !$context->vars_in_scope[$keyed_array_var_id]->isVanillaMixed()
         ) {
+            $stmt_type = $context->vars_in_scope[$keyed_array_var_id];
+
+            if ($stmt_type->possibly_undefined) {
+                if (IssueBuffer::accepts(
+                    new PossiblyUndefinedArrayOffset(
+                        'Possibly undefined array key ' . $keyed_array_var_id,
+                        new CodeLocation($statements_analyzer->getSource(), $stmt)
+                    ),
+                    $statements_analyzer->getSuppressedIssues()
+                )) {
+                    // fall through
+                }
+            }
+
             $statements_analyzer->node_data->setType(
                 $stmt,
-                clone $context->vars_in_scope[$keyed_array_var_id]
+                clone $stmt_type
             );
 
             return;
diff --git a/src/Psalm/Type/Reconciler.php b/src/Psalm/Type/Reconciler.php
index 6366927e4..a721eb92e 100644
--- a/src/Psalm/Type/Reconciler.php
+++ b/src/Psalm/Type/Reconciler.php
@@ -226,7 +226,8 @@ class Reconciler
                     $key,
                     $existing_types,
                     $code_location,
-                    $has_isset || $has_inverted_isset,
+                    $has_isset,
+                    $has_inverted_isset,
                     $has_empty
                 );
 
@@ -432,6 +433,7 @@ class Reconciler
         array &$existing_keys,
         ?CodeLocation $code_location,
         bool $has_isset,
+        bool $has_inverted_isset,
         bool $has_empty
     ) {
         $key_parts = self::breakUpPathIntoParts($key);
@@ -488,7 +490,11 @@ class Reconciler
 
                             $new_base_type_candidate = clone $existing_key_type_part->type_params[1];
 
-                            if ($has_isset) {
+                            if ($has_isset || $has_inverted_isset) {
+                                if ($has_inverted_isset) {
+                                    $new_base_type_candidate = Type::getNull();
+                                }
+
                                 $new_base_type_candidate->possibly_undefined = true;
                             }
                         } elseif ($existing_key_type_part instanceof Type\Atomic\TList) {
@@ -498,7 +504,11 @@ class Reconciler
 
                             $new_base_type_candidate = clone $existing_key_type_part->type_param;
 
-                            if ($has_isset) {
+                            if ($has_isset || $has_inverted_isset) {
+                                if ($has_inverted_isset) {
+                                    $new_base_type_candidate = Type::getNull();
+                                }
+
                                 $new_base_type_candidate->possibly_undefined = true;
                             }
                         } elseif ($existing_key_type_part instanceof Type\Atomic\TNull) {
diff --git a/tests/TypeReconciliation/IssetTest.php b/tests/TypeReconciliation/IssetTest.php
index b6ff1994e..bea7345ae 100644
--- a/tests/TypeReconciliation/IssetTest.php
+++ b/tests/TypeReconciliation/IssetTest.php
@@ -796,6 +796,20 @@ class IssetTest extends \Psalm\Tests\TestCase
                         }
                     }'
             ],
+            'issetOnArrayOfArraysReturningString' => [
+                '<?php
+                    function foo(int $i) : ?string {
+                        /** @var array<array> */
+                        $tokens = [];
+
+                        if (!isset($tokens[$i]["a"])) {
+                            /** @psalm-suppress PossiblyUndefinedArrayOffset */
+                            return $tokens[$i]["a"];
+                        }
+
+                        return "hello";
+                    }',
+            ],
         ];
     }
 
@@ -875,6 +889,50 @@ class IssetTest extends \Psalm\Tests\TestCase
                     }',
                 'error_message' => 'TypeDoesNotContainType'
             ],
+            'issetOnArrayOfMixed' => [
+                '<?php
+                    /**
+                     * @psalm-suppress PossiblyUndefinedStringArrayOffset
+                     * @psalm-suppress MixedArrayAccess
+                     * @psalm-suppress MixedArgument
+                     */
+                    function foo(int $i) : void {
+                        /** @var array */
+                        $tokens = [];
+
+                        if (!isset($tokens[$i]["a"])) {
+                            echo $tokens[$i]["b"];
+                        }
+                    }',
+                'error_message' => 'PossiblyUndefinedArrayOffset',
+            ],
+            'issetOnArrayOfArrays' => [
+                '<?php
+                    /**
+                     * @psalm-suppress MixedArgument
+                     */
+                    function foo(int $i) : void {
+                        /** @var array<array> */
+                        $tokens = [];
+
+                        if (!isset($tokens[$i]["a"])) {
+                            echo $tokens[$i]["b"];
+                        }
+                    }',
+                'error_message' => 'PossiblyUndefinedArrayOffset',
+            ],
+            'issetOnArrayOfArrayOfStrings' => [
+                '<?php
+                    function foo(int $i) : void {
+                        /** @var array<int, array<string, string>> */
+                        $tokens = [];
+
+                        if (!isset($tokens[$i]["a"])) {
+                            echo $tokens[$i]["b"];
+                        }
+                    }',
+                'error_message' => 'PossiblyUndefinedArrayOffset',
+            ],
         ];
     }
 }
