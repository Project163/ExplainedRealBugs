diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/Call/ArgumentsAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/Call/ArgumentsAnalyzer.php
index e5f860a4f..4f351906e 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/Call/ArgumentsAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/Call/ArgumentsAnalyzer.php
@@ -460,7 +460,9 @@ class ArgumentsAnalyzer
 
         if ($function_storage) {
             $template_types = CallAnalyzer::getTemplateTypesForCall(
+                $codebase,
                 $class_storage,
+                $self_fq_class_name,
                 $calling_class_storage,
                 $function_storage->template_types ?: []
             );
diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/CallAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/CallAnalyzer.php
index d4e31f175..9a56d4014 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/CallAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/CallAnalyzer.php
@@ -330,8 +330,10 @@ class CallAnalyzer
      * @param array<string, non-empty-array<string, array{Type\Union}>> $existing_template_types
      */
     public static function getTemplateTypesForCall(
-        ClassLikeStorage $declaring_class_storage = null,
-        ClassLikeStorage $calling_class_storage = null,
+        \Psalm\Codebase $codebase,
+        ?ClassLikeStorage $declaring_class_storage,
+        ?string $appearing_class_name,
+        ?ClassLikeStorage $calling_class_storage,
         array $existing_template_types = []
     ) : array {
         $template_types = $existing_template_types;
@@ -390,7 +392,16 @@ class CallAnalyzer
 
         foreach ($template_types as $key => $type_map) {
             foreach ($type_map as $class => $type) {
-                $template_types[$key][$class][0] = clone $type[0];
+                $template_types[$key][$class][0] = \Psalm\Internal\Type\TypeExpander::expandUnion(
+                    $codebase,
+                    $type[0],
+                    $appearing_class_name,
+                    $calling_class_storage ? $calling_class_storage->name : null,
+                    null,
+                    true,
+                    false,
+                    $calling_class_storage ? $calling_class_storage->final : false
+                );
             }
         }
 
diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/Fetch/InstancePropertyFetchAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/Fetch/InstancePropertyFetchAnalyzer.php
index 15a519985..ee5c8f90e 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/Fetch/InstancePropertyFetchAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/Fetch/InstancePropertyFetchAnalyzer.php
@@ -999,9 +999,11 @@ class InstancePropertyFetchAnalyzer
         ClassLikeStorage $declaring_class_storage
     ) : Type\Union {
         $template_types = CallAnalyzer::getTemplateTypesForCall(
+            $codebase,
             $declaring_class_storage,
+            $declaring_class_storage->name,
             $calling_class_storage,
-            $calling_class_storage->template_types ?: []
+            $calling_class_storage->template_types ?: [],
         );
 
         $extended_types = $calling_class_storage->template_type_extends;
diff --git a/tests/Template/ClassTemplateExtendsTest.php b/tests/Template/ClassTemplateExtendsTest.php
index 0bf93a777..e8564fda7 100644
--- a/tests/Template/ClassTemplateExtendsTest.php
+++ b/tests/Template/ClassTemplateExtendsTest.php
@@ -4216,6 +4216,35 @@ class ClassTemplateExtendsTest extends TestCase
                         public function i(): Closure;
                     }'
             ],
+            'traitSelfAsParam' => [
+                '<?php
+                    trait InstancePool {
+                        /**
+                         * @template T as self
+                         * @param callable():?T $callback
+                         * @return ?T
+                         */
+                        public static function getInstance(callable $callback)
+                        {
+                            return $callback();
+                        }
+                    }
+
+                    class Foo
+                    {
+                        use InstancePool;
+                    }
+
+                    class Bar
+                    {
+                        public function a(): void
+                        {
+                            Foo::getInstance(function () {
+                                return new Foo();
+                            });
+                        }
+                    }'
+            ],
         ];
     }
 
