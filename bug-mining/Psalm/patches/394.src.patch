diff --git a/src/Psalm/Internal/Analyzer/Statements/Block/IfAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Block/IfAnalyzer.php
index 48243e6f8..9f2d406d4 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Block/IfAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Block/IfAnalyzer.php
@@ -1025,7 +1025,7 @@ class IfAnalyzer
         $elseif_clauses = Algebra::getFormula(
             \spl_object_id($elseif->cond),
             $elseif->cond,
-            $statements_analyzer->getFQCLN(),
+            $else_context->self,
             $statements_analyzer,
             $codebase
         );
diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/BinaryOpAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/BinaryOpAnalyzer.php
index da53def27..88fccef77 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/BinaryOpAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/BinaryOpAnalyzer.php
@@ -102,7 +102,7 @@ class BinaryOpAnalyzer
             $left_clauses = Algebra::getFormula(
                 \spl_object_id($stmt->left),
                 $stmt->left,
-                $statements_analyzer->getFQCLN(),
+                $context->self,
                 $statements_analyzer,
                 $codebase
             );
@@ -330,7 +330,7 @@ class BinaryOpAnalyzer
             $left_clauses = Algebra::getFormula(
                 \spl_object_id($stmt->left),
                 $stmt->left,
-                $statements_analyzer->getFQCLN(),
+                $context->self,
                 $statements_analyzer,
                 $codebase
             );
@@ -562,7 +562,7 @@ class BinaryOpAnalyzer
             $if_clauses = Algebra::getFormula(
                 \spl_object_id($stmt),
                 $stmt,
-                $statements_analyzer->getFQCLN(),
+                $context->self,
                 $statements_analyzer,
                 $codebase
             );
diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/Call/FunctionCallAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/Call/FunctionCallAnalyzer.php
index 82e660ca7..f14f5bb82 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/Call/FunctionCallAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/Call/FunctionCallAnalyzer.php
@@ -601,7 +601,7 @@ class FunctionCallAnalyzer extends \Psalm\Internal\Analyzer\Statements\Expressio
                 $assert_clauses = \Psalm\Type\Algebra::getFormula(
                     \spl_object_id($stmt->args[0]->value),
                     $stmt->args[0]->value,
-                    $statements_analyzer->getFQCLN(),
+                    $context->self,
                     $statements_analyzer,
                     $codebase
                 );
diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/CallAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/CallAnalyzer.php
index 40a755ea6..0df49124e 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/CallAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/CallAnalyzer.php
@@ -3464,7 +3464,7 @@ class CallAnalyzer
                     $assert_clauses = \Psalm\Type\Algebra::getFormula(
                         \spl_object_id($conditional),
                         $conditional,
-                        $statements_analyzer->getFQCLN(),
+                        $context->self,
                         $statements_analyzer,
                         $statements_analyzer->getCodebase()
                     );
@@ -3472,7 +3472,7 @@ class CallAnalyzer
                     $assert_clauses = \Psalm\Type\Algebra::getFormula(
                         \spl_object_id($arg_value),
                         $arg_value,
-                        $statements_analyzer->getFQCLN(),
+                        $context->self,
                         $statements_analyzer,
                         $statements_analyzer->getCodebase()
                     );
diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/TernaryAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/TernaryAnalyzer.php
index a3139314c..725652b62 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/TernaryAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/TernaryAnalyzer.php
@@ -65,7 +65,7 @@ class TernaryAnalyzer
         $if_clauses = \Psalm\Type\Algebra::getFormula(
             \spl_object_id($stmt->cond),
             $stmt->cond,
-            $statements_analyzer->getFQCLN(),
+            $context->self,
             $statements_analyzer,
             $codebase
         );
diff --git a/tests/TraitTest.php b/tests/TraitTest.php
index 5999300c0..c4f5dde97 100644
--- a/tests/TraitTest.php
+++ b/tests/TraitTest.php
@@ -920,6 +920,22 @@ class TraitTest extends TestCase
                         }
                     }',
             ],
+            'instanceofStaticInsideTrait' => [
+                '<?php
+                    trait T {
+                        /**
+                         * @param mixed $instance
+                         * @return ?static
+                         */
+                        public static function filterInstance($instance) {
+                            return $instance instanceof static ? $instance : null;
+                        }
+                    }
+
+                    class A {
+                        use T;
+                    }'
+            ],
         ];
     }
 
