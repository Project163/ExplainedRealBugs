diff --git a/src/Psalm/Internal/Analyzer/Statements/Block/ForeachAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Block/ForeachAnalyzer.php
index 5f9bc5fb6..efb9fcbfe 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Block/ForeachAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Block/ForeachAnalyzer.php
@@ -447,14 +447,6 @@ class ForeachAnalyzer
                     $value_type = Type::combineUnionTypes($value_type, $iterator_atomic_type->type_params[1]);
                 }
 
-                ArrayFetchAnalyzer::taintArrayFetch(
-                    $statements_analyzer,
-                    $expr,
-                    null,
-                    $value_type,
-                    Type::getMixed()
-                );
-
                 $key_type_part = $iterator_atomic_type->type_params[0];
 
                 if (!$key_type) {
@@ -463,6 +455,14 @@ class ForeachAnalyzer
                     $key_type = Type::combineUnionTypes($key_type, $key_type_part);
                 }
 
+                ArrayFetchAnalyzer::taintArrayFetch(
+                    $statements_analyzer,
+                    $expr,
+                    null,
+                    $value_type,
+                    $key_type
+                );
+
                 $has_valid_iterator = true;
                 continue;
             }
@@ -569,6 +569,14 @@ class ForeachAnalyzer
                     $key_type = Type::combineUnionTypes($key_type, $intersection_key_type);
                 }
 
+                ArrayFetchAnalyzer::taintArrayFetch(
+                    $statements_analyzer,
+                    $expr,
+                    null,
+                    $value_type,
+                    $key_type
+                );
+
                 $has_valid_iterator = true;
 
                 if (!$context->pure) {
diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/ArrayAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/ArrayAnalyzer.php
index 31d4ea8f3..d59462f4e 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/ArrayAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/ArrayAnalyzer.php
@@ -275,6 +275,7 @@ class ArrayAnalyzer
         }
 
         $item_key_value = null;
+        $item_key_type = null;
         $item_is_list_item = false;
 
         if ($item->key) {
@@ -388,6 +389,40 @@ class ArrayAnalyzer
 
                     $array_creation_info->parent_taint_nodes += [$new_parent_node->id => $new_parent_node];
                 }
+
+                if ($item_key_type
+                    && $item_key_type->parent_nodes
+                    && $item_key_value === null
+                    && !($item_key_type->isSingle()
+                        && $item_key_type->hasLiteralValue()
+                        && $data_flow_graph instanceof \Psalm\Internal\Codebase\TaintFlowGraph)
+                ) {
+                    $var_location = new CodeLocation($statements_analyzer->getSource(), $item);
+
+                    $new_parent_node = \Psalm\Internal\DataFlow\DataFlowNode::getForAssignment(
+                        'array',
+                        $var_location
+                    );
+
+                    $data_flow_graph->addNode($new_parent_node);
+
+                    $event = new AddRemoveTaintsEvent($item, $context, $statements_analyzer, $codebase);
+
+                    $added_taints = $codebase->config->eventDispatcher->dispatchAddTaints($event);
+                    $removed_taints = $codebase->config->eventDispatcher->dispatchRemoveTaints($event);
+
+                    foreach ($item_key_type->parent_nodes as $parent_node) {
+                        $data_flow_graph->addPath(
+                            $parent_node,
+                            $new_parent_node,
+                            'arraykey-assignment',
+                            $added_taints,
+                            $removed_taints
+                        );
+                    }
+
+                    $array_creation_info->parent_taint_nodes += [$new_parent_node->id => $new_parent_node];
+                }
             }
         }
 
diff --git a/src/Psalm/Internal/Analyzer/Statements/Expression/Fetch/ArrayFetchAnalyzer.php b/src/Psalm/Internal/Analyzer/Statements/Expression/Fetch/ArrayFetchAnalyzer.php
index 50d101ac0..f7a142a21 100644
--- a/src/Psalm/Internal/Analyzer/Statements/Expression/Fetch/ArrayFetchAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/Statements/Expression/Fetch/ArrayFetchAnalyzer.php
@@ -369,6 +369,8 @@ class ArrayFetchAnalyzer
                 $var_location
             );
 
+            $array_key_node = null;
+
             $statements_analyzer->data_flow_graph->addNode($new_parent_node);
 
             $dim_value = $offset_type->isSingleStringLiteral()
@@ -377,6 +379,15 @@ class ArrayFetchAnalyzer
                     ? $offset_type->getSingleIntLiteral()->value
                     : null);
 
+            if ($keyed_array_var_id === null && $dim_value === null) {
+                $array_key_node = DataFlowNode::getForAssignment(
+                    'arraykey-fetch',
+                    $var_location
+                );
+
+                $statements_analyzer->data_flow_graph->addNode($array_key_node);
+            }
+
             foreach ($stmt_var_type->parent_nodes as $parent_node) {
                 $statements_analyzer->data_flow_graph->addPath(
                     $parent_node,
@@ -395,9 +406,23 @@ class ArrayFetchAnalyzer
                         $removed_taints
                     );
                 }
+
+                if ($array_key_node) {
+                    $statements_analyzer->data_flow_graph->addPath(
+                        $parent_node,
+                        $array_key_node,
+                        'arraykey-fetch',
+                        $added_taints,
+                        $removed_taints
+                    );
+                }
             }
 
             $stmt_type->parent_nodes = [$new_parent_node->id => $new_parent_node];
+
+            if ($array_key_node) {
+                $offset_type->parent_nodes = [$array_key_node->id => $array_key_node];
+            }
         }
     }
 
diff --git a/src/Psalm/Internal/Codebase/TaintFlowGraph.php b/src/Psalm/Internal/Codebase/TaintFlowGraph.php
index 08a66f9d9..cbb84f128 100644
--- a/src/Psalm/Internal/Codebase/TaintFlowGraph.php
+++ b/src/Psalm/Internal/Codebase/TaintFlowGraph.php
@@ -260,6 +260,10 @@ class TaintFlowGraph extends DataFlowGraph
                 continue;
             }
 
+            if (self::shouldIgnoreFetch($path_type, 'arraykey', $generated_source->path_types)) {
+                continue;
+            }
+
             if (self::shouldIgnoreFetch($path_type, 'arrayvalue', $generated_source->path_types)) {
                 continue;
             }
diff --git a/src/Psalm/Internal/Codebase/VariableUseGraph.php b/src/Psalm/Internal/Codebase/VariableUseGraph.php
index d3d768d14..cd69db579 100644
--- a/src/Psalm/Internal/Codebase/VariableUseGraph.php
+++ b/src/Psalm/Internal/Codebase/VariableUseGraph.php
@@ -163,6 +163,10 @@ class VariableUseGraph extends DataFlowGraph
                 continue;
             }
 
+            if (self::shouldIgnoreFetch($path_type, 'arraykey', $generated_source->path_types)) {
+                continue;
+            }
+
             if (self::shouldIgnoreFetch($path_type, 'arrayvalue', $generated_source->path_types)) {
                 continue;
             }
diff --git a/tests/TaintTest.php b/tests/TaintTest.php
index 6d3564cd3..5a9d0b477 100644
--- a/tests/TaintTest.php
+++ b/tests/TaintTest.php
@@ -2103,6 +2103,25 @@ class TaintTest extends TestCase
                     $res = Wdb::query("SELECT blah FROM tablea ORDER BY ". $order. " DESC");',
                 'error_message' => 'TaintedSql',
             ],
+            'taintArrayKey' => [
+                '<?php
+                    function doTheMagic(array $values) {
+                        foreach ($values as $key => $value) {
+                            echo $key . " " . $value;
+                        }
+                    }
+
+                    doTheMagic([(string)$_GET["bad"] => "foo"]);',
+                'error_message' => 'TaintedHtml',
+            ],
+            'taintArrayKeyWithExplicitSink' => [
+                '<?php
+                    /** @psalm-taint-sink html $values */
+                    function doTheMagic(array $values) {}
+
+                    doTheMagic([(string)$_GET["bad"] => "foo"]);',
+                'error_message' => 'TaintedHtml',
+            ],
             /*
             // TODO: Stubs do not support this type of inference even with $this->message = $message.
             // Most uses of getMessage() would be with caught exceptions, so this is not representative of real code.
diff --git a/tests/UnusedVariableTest.php b/tests/UnusedVariableTest.php
index 9572815f6..262e30399 100644
--- a/tests/UnusedVariableTest.php
+++ b/tests/UnusedVariableTest.php
@@ -3283,6 +3283,13 @@ class UnusedVariableTest extends TestCase
                     }',
                 'error_message' => 'MixedReturnStatement - src' . DIRECTORY_SEPARATOR . 'somefile.php:11:36 - Could not infer a return type. Consider improving the type at src' . DIRECTORY_SEPARATOR . 'somefile.php:2:44'
             ],
+            'warnAboutIterableKeySource' => [
+                '<?php
+                    function foo(iterable $arr) : void {
+                        foreach ($arr as $key => $_) {}
+                    }',
+                'error_message' => 'MixedAssignment - src' . DIRECTORY_SEPARATOR . 'somefile.php:3:42 - Unable to determine the type that $key is being assigned to. Consider improving the type at src' . DIRECTORY_SEPARATOR . 'somefile.php:2:43'
+            ],
         ];
     }
 }
