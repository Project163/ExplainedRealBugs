diff --git a/src/Psalm/Internal/Analyzer/FunctionLike/ReturnTypeAnalyzer.php b/src/Psalm/Internal/Analyzer/FunctionLike/ReturnTypeAnalyzer.php
index 17e92a497..ce5f26029 100644
--- a/src/Psalm/Internal/Analyzer/FunctionLike/ReturnTypeAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/FunctionLike/ReturnTypeAnalyzer.php
@@ -263,7 +263,7 @@ class ReturnTypeAnalyzer
                             $source,
                             $function_like_analyzer,
                             ($project_analyzer->only_replace_php_types_with_non_docblock_types
-                                || $unsafe_return_type)
+                                    || $unsafe_return_type)
                                 && $inferred_return_type->from_docblock,
                             $function_like_storage
                         );
@@ -300,9 +300,9 @@ class ReturnTypeAnalyzer
                     $source,
                     $function_like_analyzer,
                     $compatible_method_ids
-                    || (($project_analyzer->only_replace_php_types_with_non_docblock_types
-                            || $unsafe_return_type)
-                        && $inferred_return_type->from_docblock),
+                        || (($project_analyzer->only_replace_php_types_with_non_docblock_types
+                                || $unsafe_return_type)
+                            && $inferred_return_type->from_docblock),
                     $function_like_storage
                 );
 
@@ -356,8 +356,8 @@ class ReturnTypeAnalyzer
                     $function_like_analyzer,
                     $compatible_method_ids
                         || (($project_analyzer->only_replace_php_types_with_non_docblock_types
-                            || $unsafe_return_type)
-                        && $inferred_return_type->from_docblock)
+                                || $unsafe_return_type)
+                            && $inferred_return_type->from_docblock)
                 );
 
                 return null;
@@ -448,7 +448,7 @@ class ReturnTypeAnalyzer
                             $source,
                             $function_like_analyzer,
                             ($project_analyzer->only_replace_php_types_with_non_docblock_types
-                                || $unsafe_return_type)
+                                    || $unsafe_return_type)
                                 && $inferred_return_type->from_docblock,
                             $function_like_storage
                         );
@@ -485,9 +485,9 @@ class ReturnTypeAnalyzer
                         $source,
                         $function_like_analyzer,
                         $compatible_method_ids
-                        || (($project_analyzer->only_replace_php_types_with_non_docblock_types
-                            || $unsafe_return_type)
-                        && $inferred_return_type->from_docblock),
+                            || (($project_analyzer->only_replace_php_types_with_non_docblock_types
+                                    || $unsafe_return_type)
+                                && $inferred_return_type->from_docblock),
                         $function_like_storage
                     );
 
@@ -542,7 +542,7 @@ class ReturnTypeAnalyzer
                         $source,
                         $function_like_analyzer,
                         ($project_analyzer->only_replace_php_types_with_non_docblock_types
-                            || $unsafe_return_type)
+                                || $unsafe_return_type)
                             && $inferred_return_type->from_docblock,
                         $function_like_storage
                     );
@@ -578,7 +578,7 @@ class ReturnTypeAnalyzer
                         $source,
                         $function_like_analyzer,
                         ($project_analyzer->only_replace_php_types_with_non_docblock_types
-                            || $unsafe_return_type)
+                                || $unsafe_return_type)
                             && $inferred_return_type->from_docblock,
                         $function_like_storage
                     );
@@ -736,11 +736,12 @@ class ReturnTypeAnalyzer
             && (
                 $codebase->allow_backwards_incompatible_changes
                 || $is_final
+                || !$function instanceof PhpParser\Node\Stmt\ClassMethod
             );
 
         $manipulator->setReturnType(
             $allow_native_type
-                ? $inferred_return_type->toPhpString(
+                ? (string) $inferred_return_type->toPhpString(
                     $source->getNamespace(),
                     $source->getAliasedClassesFlipped(),
                     $source->getFQCLN(),
diff --git a/src/Psalm/Internal/FileManipulation/FunctionDocblockManipulator.php b/src/Psalm/Internal/FileManipulation/FunctionDocblockManipulator.php
index fe434eb70..a64bea28b 100644
--- a/src/Psalm/Internal/FileManipulation/FunctionDocblockManipulator.php
+++ b/src/Psalm/Internal/FileManipulation/FunctionDocblockManipulator.php
@@ -354,7 +354,8 @@ class FunctionDocblockManipulator
                         ': ' . $manipulator->new_php_return_type
                     );
                 }
-            } elseif ($manipulator->return_typehint_colon_start
+            } elseif ($manipulator->new_php_return_type === ''
+                && $manipulator->return_typehint_colon_start
                 && $manipulator->new_phpdoc_return_type
                 && $manipulator->return_typehint_start
                 && $manipulator->return_typehint_end
diff --git a/tests/FileManipulation/FileManipulationTest.php b/tests/FileManipulation/FileManipulationTest.php
index b5b53bb71..5cece19d3 100644
--- a/tests/FileManipulation/FileManipulationTest.php
+++ b/tests/FileManipulation/FileManipulationTest.php
@@ -34,8 +34,14 @@ abstract class FileManipulationTest extends \Psalm\Tests\TestCase
      *
      * @return void
      */
-    public function testValidCode($input_code, $output_code, $php_version, array $issues_to_fix, $safe_types, bool $allow_backwards_incompatible_changes = true)
-    {
+    public function testValidCode(
+        $input_code,
+        $output_code,
+        $php_version,
+        array $issues_to_fix,
+        $safe_types,
+        bool $allow_backwards_incompatible_changes = true
+    ) {
         $test_name = $this->getTestName();
         if (strpos($test_name, 'SKIPPED-') !== false) {
             $this->markTestSkipped('Skipped due to a bug.');
diff --git a/tests/FileManipulation/ReturnTypeManipulationTest.php b/tests/FileManipulation/ReturnTypeManipulationTest.php
index 75d2a0328..709e830b0 100644
--- a/tests/FileManipulation/ReturnTypeManipulationTest.php
+++ b/tests/FileManipulation/ReturnTypeManipulationTest.php
@@ -8,7 +8,7 @@ use Psalm\Tests\Internal\Provider;
 class ReturnTypeManipulationTest extends FileManipulationTest
 {
     /**
-     * @return array<string,array{string,string,string,string[],bool}>
+     * @return array<string,array{string,string,string,string[],bool,5?:bool}>
      */
     public function providerValidCodeParse()
     {
@@ -1226,6 +1226,58 @@ class ReturnTypeManipulationTest extends FileManipulationTest
                 ['MissingReturnType'],
                 false,
             ],
+            'dontReplaceValidReturnTypePreventingBackwardsIncompatibility' => [
+                '<?php
+                    class A {
+                        /**
+                         * @return int[]|null
+                         */
+                        public function foo(): ?array {
+                            return ["hello"];
+                        }
+                    }',
+                '<?php
+                    class A {
+                        /**
+                         * @return string[]
+                         *
+                         * @psalm-return array{0:string}
+                         */
+                        public function foo(): ?array {
+                            return ["hello"];
+                        }
+                    }',
+                '7.3',
+                ['InvalidReturnType'],
+                false,
+                false
+            ],
+            'dontReplaceValidReturnTypeAllowBackwardsIncompatibility' => [
+                '<?php
+                    class A {
+                        /**
+                         * @return int[]|null
+                         */
+                        public function foo(): ?array {
+                            return ["hello"];
+                        }
+                    }',
+                '<?php
+                    class A {
+                        /**
+                         * @return string[]
+                         *
+                         * @psalm-return array{0:string}
+                         */
+                        public function foo(): array {
+                            return ["hello"];
+                        }
+                    }',
+                '7.3',
+                ['InvalidReturnType'],
+                false,
+                true
+            ],
         ];
     }
 }
