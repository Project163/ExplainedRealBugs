diff --git a/src/Psalm/Internal/Analyzer/ProjectAnalyzer.php b/src/Psalm/Internal/Analyzer/ProjectAnalyzer.php
index 513560a52..1e8a4b341 100644
--- a/src/Psalm/Internal/Analyzer/ProjectAnalyzer.php
+++ b/src/Psalm/Internal/Analyzer/ProjectAnalyzer.php
@@ -122,6 +122,11 @@ class ProjectAnalyzer
      */
     public $onchange_line_limit;
 
+    /**
+     * @var bool
+     */
+    public $provide_completion = false;
+
     /**
      * @var array<string,string>
      */
diff --git a/src/Psalm/Internal/LanguageServer/LanguageServer.php b/src/Psalm/Internal/LanguageServer/LanguageServer.php
index 9653f2f22..bcfe7ea72 100644
--- a/src/Psalm/Internal/LanguageServer/LanguageServer.php
+++ b/src/Psalm/Internal/LanguageServer/LanguageServer.php
@@ -218,11 +218,11 @@ class LanguageServer extends AdvancedJsonRpc\Dispatcher
                 $serverCapabilities->hoverProvider = true;
                 // Support "Completion"
 
-                /**
-                $serverCapabilities->completionProvider = new CompletionOptions;
-                $serverCapabilities->completionProvider->resolveProvider = false;
-                $serverCapabilities->completionProvider->triggerCharacters = ['$', '>', ':'];
-                */
+                if ($this->project_analyzer->provide_completion) {
+                    $serverCapabilities->completionProvider = new CompletionOptions;
+                    $serverCapabilities->completionProvider->resolveProvider = false;
+                    $serverCapabilities->completionProvider->triggerCharacters = ['$', '>', ':'];
+                }
 
                 /*
                 $serverCapabilities->signatureHelpProvider = new SignatureHelpOptions();
diff --git a/src/Psalm/Internal/Visitor/PartialParserVisitor.php b/src/Psalm/Internal/Visitor/PartialParserVisitor.php
index 9b03579ca..abe70f56c 100644
--- a/src/Psalm/Internal/Visitor/PartialParserVisitor.php
+++ b/src/Psalm/Internal/Visitor/PartialParserVisitor.php
@@ -169,16 +169,19 @@ class PartialParserVisitor extends PhpParser\NodeVisitorAbstract implements PhpP
                                 return PhpParser\NodeTraverser::STOP_TRAVERSAL;
                             }
 
+                            // changes "): {" to ") {"
                             $hacky_class_fix = preg_replace('/(\)[\s]*):([\s]*\{)/', '$1 $2', $fake_class);
 
                             // allows autocompletion
-                            $hacky_class_fix = str_replace(["->\n", "::\n"], "~;\n", $hacky_class_fix);
-
-                            /** @var array<PhpParser\Node\Stmt> */
-                            $replacement_stmts = $this->parser->parse(
-                                $hacky_class_fix,
-                                $error_handler
-                            ) ?: [];
+                            $hacky_class_fix = preg_replace('/(->|::)(\n\s*if\s*\()/', '~;$2', $hacky_class_fix);
+
+                            if ($hacky_class_fix !== $fake_class) {
+                                /** @var array<PhpParser\Node\Stmt> */
+                                $replacement_stmts = $this->parser->parse(
+                                    $hacky_class_fix,
+                                    $error_handler
+                                ) ?: [];
+                            }
 
                             if (!$replacement_stmts
                                 || !$replacement_stmts[0] instanceof PhpParser\Node\Stmt\ClassLike
diff --git a/src/psalm-language-server.php b/src/psalm-language-server.php
index 9b9d5a852..3d300f10e 100644
--- a/src/psalm-language-server.php
+++ b/src/psalm-language-server.php
@@ -26,7 +26,8 @@ $valid_long_options = [
     'version',
     'tcp:',
     'tcp-server',
-    'disable-on-change::'
+    'disable-on-change::',
+    'enable-autocomplete',
 ];
 
 $args = array_slice($argv, 1);
@@ -53,6 +54,7 @@ array_map(
             ) {
                 echo 'Unrecognised argument "--' . $arg_name . '"' . PHP_EOL
                     . 'Type --help to see a list of supported arguments'. PHP_EOL;
+                error_log('Bad argument');
                 exit(1);
             }
         } elseif (substr($arg, 0, 2) === '-' && $arg !== '-' && $arg !== '--') {
@@ -61,6 +63,7 @@ array_map(
             if (!in_array($arg_name, $valid_short_options) && !in_array($arg_name . ':', $valid_short_options)) {
                 echo 'Unrecognised argument "-' . $arg_name . '"' . PHP_EOL
                     . 'Type --help to see a list of supported arguments'. PHP_EOL;
+                error_log('Bad argument');
                 exit(1);
             }
         }
@@ -130,6 +133,9 @@ Options:
     --disable-on-change[=line-number-threshold]
         If added, the language server will not respond to onChange events.
         You can also specify a line count over which Psalm will not run on-change events.
+
+    --enable-autocomplete
+        EXPERIMENTAL: Turns on autocompletion for methods and properties
 HELP;
 
     exit;
@@ -236,6 +242,10 @@ if (isset($options['disable-on-change'])) {
     $project_analyzer->onchange_line_limit = (int) $options['disable-on-change'];
 }
 
+if (isset($options['enable-autocomplete'])) {
+    $project_analyzer->provide_completion = true;
+}
+
 $config->visitComposerAutoloadFiles($project_analyzer);
 
 if ($find_dead_code) {
