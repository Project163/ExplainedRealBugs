{"url":"https://api.github.com/repos/vimeo/psalm/issues/4410","repository_url":"https://api.github.com/repos/vimeo/psalm","labels_url":"https://api.github.com/repos/vimeo/psalm/issues/4410/labels{/name}","comments_url":"https://api.github.com/repos/vimeo/psalm/issues/4410/comments","events_url":"https://api.github.com/repos/vimeo/psalm/issues/4410/events","html_url":"https://github.com/vimeo/psalm/issues/4410","id":728946305,"node_id":"MDU6SXNzdWU3Mjg5NDYzMDU=","number":4410,"title":"Psalm 4.0 ignores baseline when resolveFromConfigFile is implicitly \"true\"","user":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":486061586,"node_id":"MDU6TGFiZWw0ODYwNjE1ODY=","url":"https://api.github.com/repos/vimeo/psalm/labels/bug","name":"bug","color":"ee0701","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-10-25T05:35:08Z","updated_at":"2020-10-25T20:18:10Z","closed_at":"2020-10-25T20:18:10Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I have set up Psalm in my projects, for instance for PHPUnit, like so:\r\n```\r\n$ ls -lh .psalm                      \r\ntotal 88K\r\n-rw-r--r--. 1 sb sb  76K Oct 25 06:14 baseline.xml\r\ndrwxr-xr-x. 3 sb sb 4.0K Oct 25 06:14 cache\r\n-rw-r--r--. 1 sb sb  591 Oct 25 06:14 config.xml\r\n-rw-r--r--. 1 sb sb 1.8K Jul 26 12:20 static-analysis.xml\r\n```\r\n#### `.psalm/config.xml`\r\n```xml\r\n<?xml version=\"1.0\"?>\r\n<psalm\r\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n    xmlns=\"https://getpsalm.org/schema/config\"\r\n    xsi:schemaLocation=\"https://getpsalm.org/schema/config vendor/vimeo/psalm/config.xsd\"\r\n    cacheDirectory=\".psalm/cache\"\r\n    totallyTyped=\"false\"\r\n    checkForThrowsDocblock=\"true\"\r\n    findUnusedVariablesAndParams=\"true\"\r\n    findUnusedCode=\"true\"\r\n    errorBaseline=\".psalm/baseline.xml\"\r\n>\r\n    <projectFiles>\r\n        <directory name=\"src\" />\r\n        <ignoreFiles>\r\n            <directory name=\"vendor\" />\r\n        </ignoreFiles>\r\n    </projectFiles>\r\n</psalm>\r\n```\r\n### Psalm 3.18\r\n```\r\n$ ./tools/psalm --version                 \r\nPsalm 3.18.2@19aa905f7c3c7350569999a93c40ae91ae4e1626\r\n```\r\n```\r\n$ ./tools/psalm --config=.psalm/config.xml\r\nScanning files...\r\nAnalyzing files...\r\n\r\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  60 / 322 (18%)\r\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ 120 / 322 (37%)\r\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ 180 / 322 (55%)\r\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ 240 / 322 (74%)\r\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ 300 / 322 (93%)\r\n░░░░░░░░░░░░░░░░░░░░░░\r\n\r\n------------------------------\r\nNo errors found!\r\n------------------------------\r\n1085 other issues found.\r\nYou can display them with --show-info=true\r\n------------------------------\r\nPsalm can automatically fix 122 of these issues.\r\nRun Psalm again with \r\n--alter --issues=MissingReturnType,UnusedVariable,InvalidReturnType,MissingParamType,PossiblyUnusedMethod,UnusedMethod --dry-run\r\nto see what it can fix.\r\n------------------------------\r\n\r\nChecks took 3.19 seconds and used 229.881MB of memory\r\nPsalm was able to infer types for 93.8080% of the codebase\r\n```\r\nAs you can see, this works fine with Psalm 3.18.\r\n\r\n### Psalm 4.0\r\n```\r\n$ ./tools/psalm --version                 \r\nPsalm 4.0.1@b1e2e30026936ef8d5bf6a354d1c3959b6231f44\r\n```\r\nThe first problem I run into when upgrading from Psalm 3 to Psalm 4 is that the handling of paths has changed in Psalm's XML configuration file:\r\n```\r\n$ ./tools/psalm --config=.psalm/config.xml\r\nProblem parsing /usr/local/src/phpunit/.psalm/config.xml:\r\n  Could not resolve config path to /usr/local/src/phpunit/.psalm//src\r\n```\r\nWith the changes shown below I am able to run Psalm 4:\r\n```patch\r\ndiff --git a/.psalm/config.xml b/.psalm/config.xml\r\nindex 8821e7f0b..2ce131438 100644\r\n--- a/.psalm/config.xml\r\n+++ b/.psalm/config.xml\r\n@@ -3,17 +3,17 @@\r\n     xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n     xmlns=\"https://getpsalm.org/schema/config\"\r\n     xsi:schemaLocation=\"https://getpsalm.org/schema/config vendor/vimeo/psalm/config.xsd\"\r\n-    cacheDirectory=\".psalm/cache\"\r\n+    cacheDirectory=\"cache\"\r\n     totallyTyped=\"false\"\r\n     checkForThrowsDocblock=\"true\"\r\n     findUnusedVariablesAndParams=\"true\"\r\n     findUnusedCode=\"true\"\r\n-    errorBaseline=\".psalm/baseline.xml\"\r\n+    errorBaseline=\"baseline.xml\"\r\n >\r\n     <projectFiles>\r\n-        <directory name=\"src\" />\r\n+        <directory name=\"../src\" />\r\n         <ignoreFiles>\r\n-            <directory name=\"vendor\" />\r\n+            <directory name=\"../vendor\" />\r\n```\r\n```\r\n$ ./tools/psalm --config=.psalm/config.xml\r\nScanning files...\r\nAnalyzing files...\r\n\r\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  60 / 322 (18%)\r\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ 120 / 322 (37%)\r\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ 180 / 322 (55%)\r\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ 240 / 322 (74%)\r\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ 300 / 322 (93%)\r\n░░░░░░░░░░░░░░░░░░░░░░\r\n\r\nERROR: DocblockTypeContradiction - /usr/local/src/phpunit/src/Framework/Assert.php:110:15 - Docblock-defined type string for $key is always string (see https://psalm.dev/155)\r\n        if (!(is_int($key) || is_string($key))) {\r\n.\r\n.\r\n.\r\n------------------------------\r\n1089 errors found\r\n------------------------------\r\n3 other issues found.\r\nYou can display them with --show-info=true\r\n------------------------------\r\nPsalm can automatically fix 120 of these issues.\r\nRun Psalm again with \r\n--alter --issues=MissingReturnType,UnusedVariable,InvalidReturnType,MissingParamType,PossiblyUnusedMethod,UnusedMethod --dry-run\r\nto see what it can fix.\r\n------------------------------\r\n\r\nChecks took 5.32 seconds and used 155.797MB of memory\r\nPsalm was able to infer types for 92.7308% of the codebase\r\n```\r\nHowever, the baseline is ignored.\r\n\r\nWhen I make the changes show below then the baseline is not ignored:\r\n```diff\r\ndiff --git a/.psalm/config.xml b/.psalm/config.xml\r\nindex 8821e7f0b..6989ee238 100644\r\n--- a/.psalm/config.xml\r\n+++ b/.psalm/config.xml\r\n@@ -3,6 +3,7 @@\r\n     xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n     xmlns=\"https://getpsalm.org/schema/config\"\r\n     xsi:schemaLocation=\"https://getpsalm.org/schema/config vendor/vimeo/psalm/config.xsd\"\r\n+    resolveFromConfigFile=\"false\"\r\n```\r\n```\r\n$ ./tools/psalm --config=.psalm/config.xml\r\nScanning files...\r\nAnalyzing files...\r\n\r\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  60 / 322 (18%)\r\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ 120 / 322 (37%)\r\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ 180 / 322 (55%)\r\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ 240 / 322 (74%)\r\n░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ 300 / 322 (93%)\r\n░░░░░░░░░░░░░░░░░░░░░░\r\n\r\nERROR: ArgumentTypeCoercion - src/Framework/TestResult.php:683:40 - Argument 1 of SebastianBergmann\\CodeCoverage\\CodeCoverage::start expects PHPUnit\\Framework\\TestCase|PHPUnit\\Runner\\PhptTestCase|string, parent type PHPUnit\\Framework\\Test provided (see https://psalm.dev/193)\r\n            $this->codeCoverage->start($test);\r\n.\r\n.\r\n.\r\n------------------------------\r\n17 errors found\r\n------------------------------\r\n1075 other issues found.\r\nYou can display them with --show-info=true\r\n------------------------------\r\nPsalm can automatically fix 120 of these issues.\r\nRun Psalm again with \r\n--alter --issues=MissingReturnType,UnusedVariable,InvalidReturnType,MissingParamType,PossiblyUnusedMethod,UnusedMethod --dry-run\r\nto see what it can fix.\r\n------------------------------\r\n\r\nChecks took 5.54 seconds and used 155.598MB of memory\r\nPsalm was able to infer types for 92.7308% of the codebase\r\n```\r\nAs far as I understand it, the two sets of changes to the XML configuration file should be equivalent. Of course, the one which works for me (which is also explained in the release notes for Psalm 4.0.0) is likely the correct one. Still I wonder whether the other should also work and whether that fact that it does not means that there is a bug somewhere.","closed_by":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/4410/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vimeo/psalm/issues/4410/timeline","performed_via_github_app":null,"state_reason":"completed"}