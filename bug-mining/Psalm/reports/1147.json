{"url":"https://api.github.com/repos/vimeo/psalm/issues/5997","repository_url":"https://api.github.com/repos/vimeo/psalm","labels_url":"https://api.github.com/repos/vimeo/psalm/issues/5997/labels{/name}","comments_url":"https://api.github.com/repos/vimeo/psalm/issues/5997/comments","events_url":"https://api.github.com/repos/vimeo/psalm/issues/5997/events","html_url":"https://github.com/vimeo/psalm/issues/5997","id":930542784,"node_id":"MDU6SXNzdWU5MzA1NDI3ODQ=","number":5997,"title":"Language Server Shutdown message throws exception","user":{"login":"tm1000","id":564256,"node_id":"MDQ6VXNlcjU2NDI1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/564256?v=4","gravatar_id":"","url":"https://api.github.com/users/tm1000","html_url":"https://github.com/tm1000","followers_url":"https://api.github.com/users/tm1000/followers","following_url":"https://api.github.com/users/tm1000/following{/other_user}","gists_url":"https://api.github.com/users/tm1000/gists{/gist_id}","starred_url":"https://api.github.com/users/tm1000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tm1000/subscriptions","organizations_url":"https://api.github.com/users/tm1000/orgs","repos_url":"https://api.github.com/users/tm1000/repos","events_url":"https://api.github.com/users/tm1000/events{/privacy}","received_events_url":"https://api.github.com/users/tm1000/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1110282282,"node_id":"MDU6TGFiZWwxMTEwMjgyMjgy","url":"https://api.github.com/repos/vimeo/psalm/labels/language%20server","name":"language server","color":"fcdeb0","default":false,"description":""},{"id":3081263289,"node_id":"MDU6TGFiZWwzMDgxMjYzMjg5","url":"https://api.github.com/repos/vimeo/psalm/labels/causes%20crash","name":"causes crash","color":"A80503","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2021-06-25T22:34:44Z","updated_at":"2021-06-28T20:12:30Z","closed_at":"2021-06-28T20:12:30Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Additionally the language server does not shutdown but continues to run in a broken state\r\nMessage:\r\n```\r\nContent-Length: 60\r\n\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"shutdown\",\"params\":[null]}\r\n```\r\n\r\nResponse\r\n```\r\nout: Content-Type: application/vscode-jsonrpc; charset=utf8\r\nContent-Length: 85\r\n\r\n{\"method\":\"telemetry\\/event\",\"params\":{\"type\":3,\"message\":\"closing\"},\"jsonrpc\":\"2.0\"}Content-Type: application/vscode-jsonrpc; charset=utf8\r\nContent-Length: 173\r\n\r\n{\"method\":\"window\\/logMessage\",\"params\":{\"type\":4,\"message\":\"[Psalm 4.8.1@f73f2299dbc59a3e6c4d66cff4605176e728ee69 - PHP Language Server] Shutting down...\"},\"jsonrpc\":\"2.0\"}\r\n\r\nout: Content-Type: application/vscode-jsonrpc; charset=utf8\r\nContent-Length: 84\r\n\r\n{\"method\":\"telemetry\\/event\",\"params\":{\"type\":3,\"message\":\"closed\"},\"jsonrpc\":\"2.0\"}\r\n\r\nout: Content-Type: application/vscode-jsonrpc; charset=utf8\r\nContent-Length: 3404\r\n\r\n{\"error\":{\"code\":-32603,\"message\":\"Amp\\\\InvalidYieldError: Unexpected yield; Expected an instance of Amp\\\\Promise or React\\\\Promise\\\\PromiseInterface or an array of such instances; NULL yielded at key 0 on line 133 in \\/Users\\/andrewnagy\\/smsapi-web\\/app\\/vendor\\/vimeo\\/psalm\\/src\\/Psalm\\/Internal\\/LanguageServer\\/LanguageServer.php in \\/Users\\/andrewnagy\\/smsapi-web\\/app\\/vendor\\/amphp\\/amp\\/lib\\/Coroutine.php:48\\nStack trace:\\n#0 \\/Users\\/andrewnagy\\/smsapi-web\\/app\\/vendor\\/amphp\\/amp\\/lib\\/Coroutine.php(75): Amp\\\\Coroutine::transform(NULL, Object(Generator))\\n#1 \\/Users\\/andrewnagy\\/smsapi-web\\/app\\/vendor\\/amphp\\/amp\\/lib\\/functions.php(96): Amp\\\\Coroutine->__construct(Object(Generator))\\n#2 \\/Users\\/andrewnagy\\/smsapi-web\\/app\\/vendor\\/amphp\\/amp\\/lib\\/functions.php(61): Amp\\\\call(Object(Closure), Object(Psalm\\\\Internal\\\\LanguageServer\\\\Message))\\n#3 \\/Users\\/andrewnagy\\/smsapi-web\\/app\\/vendor\\/vimeo\\/psalm\\/src\\/Psalm\\/Internal\\/LanguageServer\\/EmitterTrait.php(78): Amp\\\\{closure}(Object(Psalm\\\\Internal\\\\LanguageServer\\\\Message))\\n#4 \\/Users\\/andrewnagy\\/smsapi-web\\/app\\/vendor\\/vimeo\\/psalm\\/src\\/Psalm\\/Internal\\/LanguageServer\\/ProtocolStreamReader.php(118): Psalm\\\\Internal\\\\LanguageServer\\\\ProtocolStreamReader->emit('message', Array)\\n#5 \\/Users\\/andrewnagy\\/smsapi-web\\/app\\/vendor\\/vimeo\\/psalm\\/src\\/Psalm\\/Internal\\/LanguageServer\\/ProtocolStreamReader.php(67): Psalm\\\\Internal\\\\LanguageServer\\\\ProtocolStreamReader->readMessages('{\\\"jsonrpc\\\":\\\"2.0...')\\n#6 [internal function]: Psalm\\\\Internal\\\\LanguageServer\\\\ProtocolStreamReader->Psalm\\\\Internal\\\\LanguageServer\\\\{closure}()\\n#7 \\/Users\\/andrewnagy\\/smsapi-web\\/app\\/vendor\\/amphp\\/amp\\/lib\\/Coroutine.php(118): Generator->send('{\\\"jsonrpc\\\":\\\"2.0...')\\n#8 \\/Users\\/andrewnagy\\/smsapi-web\\/app\\/vendor\\/amphp\\/amp\\/lib\\/Internal\\/Placeholder.php(149): Amp\\\\Coroutine->Amp\\\\{closure}(NULL, '{\\\"jsonrpc\\\":\\\"2.0...')\\n#9 \\/Users\\/andrewnagy\\/smsapi-web\\/app\\/vendor\\/amphp\\/amp\\/lib\\/Deferred.php(52): class@anonymous->resolve('{\\\"jsonrpc\\\":\\\"2.0...')\\n#10 \\/Users\\/andrewnagy\\/smsapi-web\\/app\\/vendor\\/amphp\\/byte-stream\\/lib\\/ResourceInputStream.php(101): Amp\\\\Deferred->resolve('{\\\"jsonrpc\\\":\\\"2.0...')\\n#11 \\/Users\\/andrewnagy\\/smsapi-web\\/app\\/vendor\\/amphp\\/amp\\/lib\\/Loop\\/NativeDriver.php(321): Amp\\\\ByteStream\\\\ResourceInputStream::Amp\\\\ByteStream\\\\{closure}('a', Resource id #1, NULL)\\n#12 \\/Users\\/andrewnagy\\/smsapi-web\\/app\\/vendor\\/amphp\\/amp\\/lib\\/Loop\\/NativeDriver.php(127): Amp\\\\Loop\\\\NativeDriver->selectStreams(Array, Array, -0.001)\\n#13 \\/Users\\/andrewnagy\\/smsapi-web\\/app\\/vendor\\/amphp\\/amp\\/lib\\/Loop\\/Driver.php(138): Amp\\\\Loop\\\\NativeDriver->dispatch(true)\\n#14 \\/Users\\/andrewnagy\\/smsapi-web\\/app\\/vendor\\/amphp\\/amp\\/lib\\/Loop\\/Driver.php(72): Amp\\\\Loop\\\\Driver->tick()\\n#15 \\/Users\\/andrewnagy\\/smsapi-web\\/app\\/vendor\\/amphp\\/amp\\/lib\\/Loop.php(95): Amp\\\\Loop\\\\Driver->run()\\n#16 \\/Users\\/andrewnagy\\/smsapi-web\\/app\\/vendor\\/vimeo\\/psalm\\/src\\/Psalm\\/Internal\\/Analyzer\\/ProjectAnalyzer.php(533): Amp\\\\Loop::run()\\n#17 \\/Users\\/andrewnagy\\/smsapi-web\\/app\\/vendor\\/vimeo\\/psalm\\/src\\/Psalm\\/Internal\\/Cli\\/LanguageServer.php(312): Psalm\\\\Internal\\\\Analyzer\\\\ProjectAnalyzer->server(NULL, false)\\n#18 \\/Users\\/andrewnagy\\/smsapi-web\\/app\\/vendor\\/vimeo\\/psalm\\/psalm-language-server(4): Psalm\\\\Internal\\\\Cli\\\\LanguageServer::run(Array)\\n#19 {main}\",\"data\":null},\"id\":1,\"jsonrpc\":\"2.0\"}Content-Type: application/vscode-jsonrpc; charset=utf8\r\n```\r\n\r\nSince the error is caught the server does not shutdown","closed_by":{"login":"weirdan","id":57403,"node_id":"MDQ6VXNlcjU3NDAz","avatar_url":"https://avatars.githubusercontent.com/u/57403?v=4","gravatar_id":"","url":"https://api.github.com/users/weirdan","html_url":"https://github.com/weirdan","followers_url":"https://api.github.com/users/weirdan/followers","following_url":"https://api.github.com/users/weirdan/following{/other_user}","gists_url":"https://api.github.com/users/weirdan/gists{/gist_id}","starred_url":"https://api.github.com/users/weirdan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weirdan/subscriptions","organizations_url":"https://api.github.com/users/weirdan/orgs","repos_url":"https://api.github.com/users/weirdan/repos","events_url":"https://api.github.com/users/weirdan/events{/privacy}","received_events_url":"https://api.github.com/users/weirdan/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/5997/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vimeo/psalm/issues/5997/timeline","performed_via_github_app":null,"state_reason":"completed"}