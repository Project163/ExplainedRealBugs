{"url":"https://api.github.com/repos/vimeo/psalm/issues/4310","repository_url":"https://api.github.com/repos/vimeo/psalm","labels_url":"https://api.github.com/repos/vimeo/psalm/issues/4310/labels{/name}","comments_url":"https://api.github.com/repos/vimeo/psalm/issues/4310/comments","events_url":"https://api.github.com/repos/vimeo/psalm/issues/4310/events","html_url":"https://github.com/vimeo/psalm/issues/4310","id":719345456,"node_id":"MDU6SXNzdWU3MTkzNDU0NTY=","number":4310,"title":"Typing a dependency injection container","user":{"login":"ChristophWurst","id":1374172,"node_id":"MDQ6VXNlcjEzNzQxNzI=","avatar_url":"https://avatars.githubusercontent.com/u/1374172?v=4","gravatar_id":"","url":"https://api.github.com/users/ChristophWurst","html_url":"https://github.com/ChristophWurst","followers_url":"https://api.github.com/users/ChristophWurst/followers","following_url":"https://api.github.com/users/ChristophWurst/following{/other_user}","gists_url":"https://api.github.com/users/ChristophWurst/gists{/gist_id}","starred_url":"https://api.github.com/users/ChristophWurst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ChristophWurst/subscriptions","organizations_url":"https://api.github.com/users/ChristophWurst/orgs","repos_url":"https://api.github.com/users/ChristophWurst/repos","events_url":"https://api.github.com/users/ChristophWurst/events{/privacy}","received_events_url":"https://api.github.com/users/ChristophWurst/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":486061586,"node_id":"MDU6TGFiZWw0ODYwNjE1ODY=","url":"https://api.github.com/repos/vimeo/psalm/labels/bug","name":"bug","color":"ee0701","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2020-10-12T12:36:15Z","updated_at":"2020-10-12T19:01:29Z","closed_at":"2020-10-12T18:45:16Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hello :wave:,\r\n\r\nI'm in the process of rolling out Psalm for more components of the Nextcloud ecosystem and I came to the following problem. If you have a dependency injection container, it would be really cool to let Psalm know the container returns an instance of the class string passed as identifier, though containers might also work with regular strings as service identifications.\r\n\r\nSample code: https://psalm.dev/r/f4113ff8b9\r\n\r\nIf I limit the container interface to only work with class strings, then the typing is easy: https://psalm.dev/r/b86ac518bd. But in practice you have some named services where the string is not actually a class string but just a literal.\r\n\r\nDoes Psalm automatically use the *class string* as more specific type? It looks like the union type with `string` has no effect except eliminating the error `Argument 1 of f expects class-string, parent type string(...) provided`. Therefore it still complains about every service that is queried by name instead of class name like `Class or interface hello does not exist` in the example above..\r\n\r\nUnfortunately I could not find any other container implementation that uses psalm typing.\r\n\r\nAre there any tricks to make this work?\r\n\r\nWhat I'm trying to tell Psalm is\r\n* If it's a class name then an instance of `T` is returned\r\n* Fall back to `mixed` in any other case","closed_by":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/4310/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vimeo/psalm/issues/4310/timeline","performed_via_github_app":null,"state_reason":"completed"}