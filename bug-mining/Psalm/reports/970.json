{"url":"https://api.github.com/repos/vimeo/psalm/issues/4600","repository_url":"https://api.github.com/repos/vimeo/psalm","labels_url":"https://api.github.com/repos/vimeo/psalm/issues/4600/labels{/name}","comments_url":"https://api.github.com/repos/vimeo/psalm/issues/4600/comments","events_url":"https://api.github.com/repos/vimeo/psalm/issues/4600/events","html_url":"https://github.com/vimeo/psalm/issues/4600","id":745561191,"node_id":"MDU6SXNzdWU3NDU1NjExOTE=","number":4600,"title":"Taint Flow: -1 as line_from  (breaking SARIF report)","user":{"login":"LukasReschke","id":878997,"node_id":"MDQ6VXNlcjg3ODk5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/878997?v=4","gravatar_id":"","url":"https://api.github.com/users/LukasReschke","html_url":"https://github.com/LukasReschke","followers_url":"https://api.github.com/users/LukasReschke/followers","following_url":"https://api.github.com/users/LukasReschke/following{/other_user}","gists_url":"https://api.github.com/users/LukasReschke/gists{/gist_id}","starred_url":"https://api.github.com/users/LukasReschke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LukasReschke/subscriptions","organizations_url":"https://api.github.com/users/LukasReschke/orgs","repos_url":"https://api.github.com/users/LukasReschke/repos","events_url":"https://api.github.com/users/LukasReschke/events{/privacy}","received_events_url":"https://api.github.com/users/LukasReschke/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-11-18T11:04:23Z","updated_at":"2020-11-18T17:45:05Z","closed_at":"2020-11-18T17:45:05Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I saw a taint flow in which -1 was used as `line_from`. See below for the whole trace:\r\n\r\n```diff\r\n+  call to OCP\\AppFramework\\Http\\TemplateResponse::__construct - Server/lib/public/AppFramework/Http/StandaloneTemplateResponse.php:-1:1\r\n\u001B[30;47m\u001B[0m?php\r\n\r\n  OCP\\AppFramework\\Http\\TemplateResponse::__construct#2 - Server/lib/public/AppFramework/Http/TemplateResponse.php:109:40\r\n\tpublic function __construct($appName, \u001B[30;47m$templateName\u001B[0m, array $params = [],\r\n\r\n  $templateName - Server/lib/public/AppFramework/Http/TemplateResponse.php:109:40\r\n\tpublic function __construct($appName, \u001B[30;47m$templateName\u001B[0m, array $params = [],\r\n\r\n  $this->templateName - Server/lib/public/AppFramework/Http/TemplateResponse.php:113:3\r\n\t\t\u001B[30;47m$this->templateName\u001B[0m = $templateName;\r\n```\r\n\r\nThe `-1` is problematic as that breaks the SARIF report, as it's not allowed as per standard.\r\n\r\nWhilst I could just filter `-1` from the SARIF report, this feels like the actual wrong line number is reported here. I guess this is because the class has no body?\r\n\r\nhttps://github.com/nextcloud/server/blob/66013f906d1957bdc9de1851a0f7497fbc5bbfbf/lib/public/AppFramework/Http/StandaloneTemplateResponse.php#L37-L38\r\n\r\nI will try to see if I can get a more condensed example.\r\n\r\n\r\n```diff\r\n\u001B[0;31mERROR\u001B[0m: TaintedInclude - Server/3rdparty/composer/autoload_real.php:64:17 - Detected tainted code passed to include or similar (see https://psalm.dev/251)\r\n  oc\\core\\controller\\clientflowloginv2controller::grantpage#1 - Server/core/Controller/ClientFlowLoginV2Controller.php:153:28\r\n\tpublic function grantPage(\u001B[30;47mstring $stateToken\u001B[0m): StandaloneTemplateResponse {\r\n\r\n  $stateToken - Server/core/Controller/ClientFlowLoginV2Controller.php:153:35\r\n\tpublic function grantPage(string \u001B[30;47m$stateToken\u001B[0m): StandaloneTemplateResponse {\r\n\r\n  array['stateToken'] - Server/core/Controller/ClientFlowLoginV2Controller.php:171:5\r\n\t\t\t\t\u001B[30;47m'stateToken' => $stateToken\u001B[0m,\r\n\r\n  call to OCP\\AppFramework\\Http\\StandaloneTemplateResponse::__construct - Server/core/Controller/ClientFlowLoginV2Controller.php:167:4\r\n\t\t\t\u001B[30;47m[\r\n\t\t\t\t'client' => $flow->getClientName(),\r\n\t\t\t\t'instanceName' => $this->defaults->getName(),\r\n\t\t\t\t'urlGenerator' => $this->urlGenerator,\r\n\t\t\t\t'stateToken' => $stateToken,\r\n\t\t\t]\u001B[0m,\r\n\r\n  OCP\\AppFramework\\Http\\StandaloneTemplateResponse::__construct#3 - Server/lib/public/AppFramework/Http/TemplateResponse.php:109:61\r\n\tpublic function __construct($appName, $templateName, array \u001B[30;47m$params\u001B[0m = [],\r\n\r\n  $params - Server/lib/public/AppFramework/Http/TemplateResponse.php:109:61\r\n\tpublic function __construct($appName, $templateName, array \u001B[30;47m$params\u001B[0m = [],\r\n\r\n+  call to OCP\\AppFramework\\Http\\TemplateResponse::__construct - Server/lib/public/AppFramework/Http/StandaloneTemplateResponse.php:-1:1\r\n\u001B[30;47m\u001B[0m?php\r\n\r\n  OCP\\AppFramework\\Http\\TemplateResponse::__construct#2 - Server/lib/public/AppFramework/Http/TemplateResponse.php:109:40\r\n\tpublic function __construct($appName, \u001B[30;47m$templateName\u001B[0m, array $params = [],\r\n\r\n  $templateName - Server/lib/public/AppFramework/Http/TemplateResponse.php:109:40\r\n\tpublic function __construct($appName, \u001B[30;47m$templateName\u001B[0m, array $params = [],\r\n\r\n  $this->templateName - Server/lib/public/AppFramework/Http/TemplateResponse.php:113:3\r\n\t\t\u001B[30;47m$this->templateName\u001B[0m = $templateName;\r\n\r\n  OCP\\AppFramework\\Http\\TemplateResponse::$templateName\r\n    <no known location>\r\n\r\n  $this->templateName - Server/lib/public/AppFramework/Http/TemplateResponse.php:204:49\r\n\t\t$template = new \\OCP\\Template($this->appName, \u001B[30;47m$this->templateName\u001B[0m, $renderAs);\r\n\r\n  call to OCP\\Template::__construct - Server/lib/public/AppFramework/Http/TemplateResponse.php:204:49\r\n\t\t$template = new \\OCP\\Template($this->appName, \u001B[30;47m$this->templateName\u001B[0m, $renderAs);\r\n\r\n  OCP\\Template::__construct#2 - Server/lib/private/legacy/OC_Template.php:76:36\r\n\tpublic function __construct($app, \u001B[30;47m$name\u001B[0m, $renderAs = TemplateResponse::RENDER_AS_BLANK, $registerCall = true) {\r\n\r\n  $name - Server/lib/private/legacy/OC_Template.php:76:36\r\n\tpublic function __construct($app, \u001B[30;47m$name\u001B[0m, $renderAs = TemplateResponse::RENDER_AS_BLANK, $registerCall = true) {\r\n\r\n  call to OC_Template::findTemplate - Server/lib/private/legacy/OC_Template.php:89:62\r\n\t\tlist($path, $template) = $this->findTemplate($theme, $app, \u001B[30;47m$name\u001B[0m);\r\n\r\n  OC_Template::findTemplate#3 - Server/lib/private/legacy/OC_Template.php:144:48\r\n\tprotected function findTemplate($theme, $app, \u001B[30;47m$name\u001B[0m) {\r\n\r\n  $name - Server/lib/private/legacy/OC_Template.php:144:48\r\n\tprotected function findTemplate($theme, $app, \u001B[30;47m$name\u001B[0m) {\r\n\r\n  call to OC\\Template\\TemplateFileLocator::find - Server/lib/private/legacy/OC_Template.php:152:30\r\n\t\t$template = $locator->find(\u001B[30;47m$name\u001B[0m);\r\n\r\n  OC\\Template\\TemplateFileLocator::find#1 - Server/lib/private/Template/TemplateFileLocator.php:45:23\r\n\tpublic function find(\u001B[30;47m$template\u001B[0m) {\r\n\r\n  $template - Server/lib/private/Template/TemplateFileLocator.php:45:23\r\n\tpublic function find(\u001B[30;47m$template\u001B[0m) {\r\n\r\n  concat - Server/lib/private/Template/TemplateFileLocator.php:51:12\r\n\t\t\t$file = \u001B[30;47m$dir.$template\u001B[0m.'.php';\r\n\r\n  concat - Server/lib/private/Template/TemplateFileLocator.php:51:12\r\n\t\t\t$file = \u001B[30;47m$dir.$template.'.php'\u001B[0m;\r\n\r\n  $file - Server/lib/private/Template/TemplateFileLocator.php:51:4\r\n\t\t\t\u001B[30;47m$file\u001B[0m = $dir.$template.'.php';\r\n\r\n  OC\\Template\\TemplateFileLocator::find - Server/lib/private/Template/TemplateFileLocator.php:45:18\r\n\tpublic function \u001B[30;47mfind\u001B[0m($template) {\r\n\r\n  $template - Server/lib/private/legacy/OC_Template.php:152:3\r\n\t\t\u001B[30;47m$template\u001B[0m = $locator->find($name);\r\n\r\n  array['1'] - Server/lib/private/legacy/OC_Template.php:154:18\r\n\t\treturn [$path, \u001B[30;47m$template\u001B[0m];\r\n\r\n  OC\\TemplateLayout::findTemplate - Server/lib/private/legacy/OC_Template.php:144:21\r\n\tprotected function \u001B[30;47mfindTemplate\u001B[0m($theme, $app, $name) {\r\n\r\n  array-fetch - Server/lib/private/legacy/OC_Template.php:89:28\r\n\t\tlist($path, $template) = \u001B[30;47m$this->findTemplate($theme, $app, $name)\u001B[0m;\r\n\r\n  $template - Server/lib/private/legacy/OC_Template.php:89:15\r\n\t\tlist($path, \u001B[30;47m$template\u001B[0m) = $this->findTemplate($theme, $app, $name);\r\n\r\n  call to OC\\Template\\Base::__construct - Server/lib/private/legacy/OC_Template.php:96:23\r\n\t\tparent::__construct(\u001B[30;47m$template\u001B[0m, $requestToken, $l10n, $themeDefaults);\r\n\r\n  OC\\Template\\Base::__construct#1 - Server/lib/private/Template/Base.php:52:30\r\n\tpublic function __construct(\u001B[30;47m$template\u001B[0m, $requestToken, $l10n, $theme) {\r\n\r\n  $template - Server/lib/private/Template/Base.php:52:30\r\n\tpublic function __construct(\u001B[30;47m$template\u001B[0m, $requestToken, $l10n, $theme) {\r\n\r\n  $this->template - Server/lib/private/Template/Base.php:56:3\r\n\t\t\u001B[30;47m$this->template\u001B[0m = $template;\r\n\r\n  OC\\Template\\Base::$template\r\n    <no known location>\r\n\r\n  $this->template - Server/lib/private/Template/Base.php:151:22\r\n\t\treturn $this->load(\u001B[30;47m$this->template\u001B[0m, $additionalParams);\r\n\r\n  call to OC\\Template\\Base::load - Server/lib/private/Template/Base.php:151:22\r\n\t\treturn $this->load(\u001B[30;47m$this->template\u001B[0m, $additionalParams);\r\n\r\n  OC\\Template\\Base::load#1 - Server/lib/private/Template/Base.php:163:26\r\n\tprotected function load(\u001B[30;47m$file\u001B[0m, $additionalParams = null) {\r\n\r\n  $file - Server/lib/private/Template/Base.php:163:26\r\n\tprotected function load(\u001B[30;47m$file\u001B[0m, $additionalParams = null) \r\n```","closed_by":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/4600/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vimeo/psalm/issues/4600/timeline","performed_via_github_app":null,"state_reason":"completed"}