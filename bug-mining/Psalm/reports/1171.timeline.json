[{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/988449788","html_url":"https://github.com/vimeo/psalm/issues/7095#issuecomment-988449788","issue_url":"https://api.github.com/repos/vimeo/psalm/issues/7095","id":988449788,"node_id":"IC_kwDOBG8K98466ov8","user":{"login":"psalm-github-bot[bot]","id":58627613,"node_id":"MDM6Qm90NTg2Mjc2MTM=","avatar_url":"https://avatars.githubusercontent.com/in/48546?v=4","gravatar_id":"","url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D","html_url":"https://github.com/apps/psalm-github-bot","followers_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/followers","following_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/repos","events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2021-12-08T02:53:37Z","updated_at":"2021-12-08T02:53:37Z","body":"I found these snippets:\n<details>\n<summary>https://psalm.dev/r/2756501f64</summary>\n\n```php\n<?php\n\n/**\n * @param \"a\"|\"b\"|\"c\" $a\n * @param array<non-empty-string, true> $b\n */\nfunction foo(string $a, array &$b): void\n{\n    /** @psalm-trace $baz */\n    $baz = \"bar $a\";\n    $b[$baz] = true;\n}\n\n$b = [];\nfoo(\"a\", $b);\n```\n\n```\nPsalm output (using commit 0ca856b):\n\nINFO: Trace - 10:5 - $baz: non-empty-literal-string\n\nERROR: ReferenceConstraintViolation - 7:32 - Variable $b is limited to values of type array<non-empty-string, true> because it is passed by reference, non-empty-array<string, true> type found. Use @param-out to specify a different output type\n```\n</details>\n\n<details>\n<summary>https://psalm.dev/r/f8845a750d</summary>\n\n```php\n<?php\n\n/**\n * @param non-empty-string $bar\n */\nfunction foo(string $bar): string\n{\n    return $bar;\n}\n\n/** @var \"bar\"|\"baz\" */\n$bar = \"bar\";\n/** @psalm-trace $baz */\n$baz = \"foo$bar\";\nfoo($baz);\n```\n\n```\nPsalm output (using commit 0ca856b):\n\nINFO: Trace - 14:1 - $baz: non-empty-literal-string\n```\n</details>\n\n<details>\n<summary>https://psalm.dev/r/c9ad19355c</summary>\n\n```php\n<?php\n\n/**\n * @param \"a\"|\"b\"|\"c\" $a\n * @param non-empty-string $b\n */\nfunction foo(string $a, string &$b): void\n{\n    /** @psalm-trace $baz */\n    $baz = \"bar $a\";\n    $b = $baz;\n}\n\n$b = \"b\";\nfoo(\"a\", $b);\n```\n\n```\nPsalm output (using commit 0ca856b):\n\nINFO: Trace - 10:5 - $baz: non-empty-literal-string\n```\n</details>\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/988449788/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"psalm-github-bot[bot]","id":58627613,"node_id":"MDM6Qm90NTg2Mjc2MTM=","avatar_url":"https://avatars.githubusercontent.com/in/48546?v=4","gravatar_id":"","url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D","html_url":"https://github.com/apps/psalm-github-bot","followers_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/followers","following_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/repos","events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false}},{"id":5731713756,"node_id":"LE_lADOBG8K985AAz2YzwAAAAFVowLc","url":"https://api.github.com/repos/vimeo/psalm/issues/events/5731713756","actor":{"login":"orklah","id":9605520,"node_id":"MDQ6VXNlcjk2MDU1MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9605520?v=4","gravatar_id":"","url":"https://api.github.com/users/orklah","html_url":"https://github.com/orklah","followers_url":"https://api.github.com/users/orklah/followers","following_url":"https://api.github.com/users/orklah/following{/other_user}","gists_url":"https://api.github.com/users/orklah/gists{/gist_id}","starred_url":"https://api.github.com/users/orklah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/orklah/subscriptions","organizations_url":"https://api.github.com/users/orklah/orgs","repos_url":"https://api.github.com/users/orklah/repos","events_url":"https://api.github.com/users/orklah/events{/privacy}","received_events_url":"https://api.github.com/users/orklah/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-12-08T06:17:49Z","label":{"name":"bug","color":"ee0701"},"performed_via_github_app":null},{"id":5731713758,"node_id":"LE_lADOBG8K985AAz2YzwAAAAFVowLe","url":"https://api.github.com/repos/vimeo/psalm/issues/events/5731713758","actor":{"login":"orklah","id":9605520,"node_id":"MDQ6VXNlcjk2MDU1MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9605520?v=4","gravatar_id":"","url":"https://api.github.com/users/orklah","html_url":"https://github.com/orklah","followers_url":"https://api.github.com/users/orklah/followers","following_url":"https://api.github.com/users/orklah/following{/other_user}","gists_url":"https://api.github.com/users/orklah/gists{/gist_id}","starred_url":"https://api.github.com/users/orklah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/orklah/subscriptions","organizations_url":"https://api.github.com/users/orklah/orgs","repos_url":"https://api.github.com/users/orklah/repos","events_url":"https://api.github.com/users/orklah/events{/privacy}","received_events_url":"https://api.github.com/users/orklah/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-12-08T06:17:49Z","label":{"name":"references","color":"6DD1B1"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/989014536","html_url":"https://github.com/vimeo/psalm/issues/7095#issuecomment-989014536","issue_url":"https://api.github.com/repos/vimeo/psalm/issues/7095","id":989014536,"node_id":"IC_kwDOBG8K98468yoI","user":{"login":"craigfrancis","id":1296695,"node_id":"MDQ6VXNlcjEyOTY2OTU=","avatar_url":"https://avatars.githubusercontent.com/u/1296695?v=4","gravatar_id":"","url":"https://api.github.com/users/craigfrancis","html_url":"https://github.com/craigfrancis","followers_url":"https://api.github.com/users/craigfrancis/followers","following_url":"https://api.github.com/users/craigfrancis/following{/other_user}","gists_url":"https://api.github.com/users/craigfrancis/gists{/gist_id}","starred_url":"https://api.github.com/users/craigfrancis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/craigfrancis/subscriptions","organizations_url":"https://api.github.com/users/craigfrancis/orgs","repos_url":"https://api.github.com/users/craigfrancis/repos","events_url":"https://api.github.com/users/craigfrancis/events{/privacy}","received_events_url":"https://api.github.com/users/craigfrancis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-12-08T17:21:28Z","updated_at":"2021-12-08T17:21:28Z","body":"I'm not familiar with Psalm internals (and I've run out of time today), but it looks like `$all_types_contain` is getting set to `false` in [ArrayTypeComparator.php](https://github.com/vimeo/psalm/blob/8bd525a55f4f5303637c43cc1441a865bdbdf2a1/src/Psalm/Internal/Type/Comparator/ArrayTypeComparator.php#L266) (I assume that shouldn't be the case).","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/989014536/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"craigfrancis","id":1296695,"node_id":"MDQ6VXNlcjEyOTY2OTU=","avatar_url":"https://avatars.githubusercontent.com/u/1296695?v=4","gravatar_id":"","url":"https://api.github.com/users/craigfrancis","html_url":"https://github.com/craigfrancis","followers_url":"https://api.github.com/users/craigfrancis/followers","following_url":"https://api.github.com/users/craigfrancis/following{/other_user}","gists_url":"https://api.github.com/users/craigfrancis/gists{/gist_id}","starred_url":"https://api.github.com/users/craigfrancis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/craigfrancis/subscriptions","organizations_url":"https://api.github.com/users/craigfrancis/orgs","repos_url":"https://api.github.com/users/craigfrancis/repos","events_url":"https://api.github.com/users/craigfrancis/events{/privacy}","received_events_url":"https://api.github.com/users/craigfrancis/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5736135206,"node_id":"REFE_lADOBG8K985AAz2YzwAAAAFV5nom","url":"https://api.github.com/repos/vimeo/psalm/issues/events/5736135206","actor":{"login":"AndrolGenhald","id":7794502,"node_id":"MDQ6VXNlcjc3OTQ1MDI=","avatar_url":"https://avatars.githubusercontent.com/u/7794502?v=4","gravatar_id":"","url":"https://api.github.com/users/AndrolGenhald","html_url":"https://github.com/AndrolGenhald","followers_url":"https://api.github.com/users/AndrolGenhald/followers","following_url":"https://api.github.com/users/AndrolGenhald/following{/other_user}","gists_url":"https://api.github.com/users/AndrolGenhald/gists{/gist_id}","starred_url":"https://api.github.com/users/AndrolGenhald/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndrolGenhald/subscriptions","organizations_url":"https://api.github.com/users/AndrolGenhald/orgs","repos_url":"https://api.github.com/users/AndrolGenhald/repos","events_url":"https://api.github.com/users/AndrolGenhald/events{/privacy}","received_events_url":"https://api.github.com/users/AndrolGenhald/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"d9e79138475e2ba7c44d78adb47cb182e7e9de0b","commit_url":"https://api.github.com/repos/AndrolGenhald/psalm/commits/d9e79138475e2ba7c44d78adb47cb182e7e9de0b","created_at":"2021-12-08T19:37:07Z","performed_via_github_app":null},{"id":5736142713,"node_id":"REFE_lADOBG8K985AAz2YzwAAAAFV5pd5","url":"https://api.github.com/repos/vimeo/psalm/issues/events/5736142713","actor":{"login":"AndrolGenhald","id":7794502,"node_id":"MDQ6VXNlcjc3OTQ1MDI=","avatar_url":"https://avatars.githubusercontent.com/u/7794502?v=4","gravatar_id":"","url":"https://api.github.com/users/AndrolGenhald","html_url":"https://github.com/AndrolGenhald","followers_url":"https://api.github.com/users/AndrolGenhald/followers","following_url":"https://api.github.com/users/AndrolGenhald/following{/other_user}","gists_url":"https://api.github.com/users/AndrolGenhald/gists{/gist_id}","starred_url":"https://api.github.com/users/AndrolGenhald/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AndrolGenhald/subscriptions","organizations_url":"https://api.github.com/users/AndrolGenhald/orgs","repos_url":"https://api.github.com/users/AndrolGenhald/repos","events_url":"https://api.github.com/users/AndrolGenhald/events{/privacy}","received_events_url":"https://api.github.com/users/AndrolGenhald/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"a89e8ec28caa326c21641363d44b121dc23d40de","commit_url":"https://api.github.com/repos/AndrolGenhald/psalm/commits/a89e8ec28caa326c21641363d44b121dc23d40de","created_at":"2021-12-08T19:38:38Z","performed_via_github_app":null},{"id":5736251025,"node_id":"CE_lADOBG8K985AAz2YzwAAAAFV6D6R","url":"https://api.github.com/repos/vimeo/psalm/issues/events/5736251025","actor":{"login":"orklah","id":9605520,"node_id":"MDQ6VXNlcjk2MDU1MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9605520?v=4","gravatar_id":"","url":"https://api.github.com/users/orklah","html_url":"https://github.com/orklah","followers_url":"https://api.github.com/users/orklah/followers","following_url":"https://api.github.com/users/orklah/following{/other_user}","gists_url":"https://api.github.com/users/orklah/gists{/gist_id}","starred_url":"https://api.github.com/users/orklah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/orklah/subscriptions","organizations_url":"https://api.github.com/users/orklah/orgs","repos_url":"https://api.github.com/users/orklah/repos","events_url":"https://api.github.com/users/orklah/events{/privacy}","received_events_url":"https://api.github.com/users/orklah/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"a89e8ec28caa326c21641363d44b121dc23d40de","commit_url":"https://api.github.com/repos/vimeo/psalm/commits/a89e8ec28caa326c21641363d44b121dc23d40de","created_at":"2021-12-08T20:02:10Z","state_reason":null,"performed_via_github_app":null},{"id":5736251042,"node_id":"REFE_lADOBG8K985AAz2YzwAAAAFV6D6i","url":"https://api.github.com/repos/vimeo/psalm/issues/events/5736251042","actor":{"login":"orklah","id":9605520,"node_id":"MDQ6VXNlcjk2MDU1MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9605520?v=4","gravatar_id":"","url":"https://api.github.com/users/orklah","html_url":"https://github.com/orklah","followers_url":"https://api.github.com/users/orklah/followers","following_url":"https://api.github.com/users/orklah/following{/other_user}","gists_url":"https://api.github.com/users/orklah/gists{/gist_id}","starred_url":"https://api.github.com/users/orklah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/orklah/subscriptions","organizations_url":"https://api.github.com/users/orklah/orgs","repos_url":"https://api.github.com/users/orklah/repos","events_url":"https://api.github.com/users/orklah/events{/privacy}","received_events_url":"https://api.github.com/users/orklah/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"b65e37c5f9defa6f199fd3deb72029bd2a18ee62","commit_url":"https://api.github.com/repos/vimeo/psalm/commits/b65e37c5f9defa6f199fd3deb72029bd2a18ee62","created_at":"2021-12-08T20:02:10Z","performed_via_github_app":null}]