{"url":"https://api.github.com/repos/vimeo/psalm/issues/2644","repository_url":"https://api.github.com/repos/vimeo/psalm","labels_url":"https://api.github.com/repos/vimeo/psalm/issues/2644/labels{/name}","comments_url":"https://api.github.com/repos/vimeo/psalm/issues/2644/comments","events_url":"https://api.github.com/repos/vimeo/psalm/issues/2644/events","html_url":"https://github.com/vimeo/psalm/issues/2644","id":550995838,"node_id":"MDU6SXNzdWU1NTA5OTU4Mzg=","number":2644,"title":"Type of global constant from define()","user":{"login":"sapphirecat","id":325537,"node_id":"MDQ6VXNlcjMyNTUzNw==","avatar_url":"https://avatars.githubusercontent.com/u/325537?v=4","gravatar_id":"","url":"https://api.github.com/users/sapphirecat","html_url":"https://github.com/sapphirecat","followers_url":"https://api.github.com/users/sapphirecat/followers","following_url":"https://api.github.com/users/sapphirecat/following{/other_user}","gists_url":"https://api.github.com/users/sapphirecat/gists{/gist_id}","starred_url":"https://api.github.com/users/sapphirecat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sapphirecat/subscriptions","organizations_url":"https://api.github.com/users/sapphirecat/orgs","repos_url":"https://api.github.com/users/sapphirecat/repos","events_url":"https://api.github.com/users/sapphirecat/events{/privacy}","received_events_url":"https://api.github.com/users/sapphirecat/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2020-01-16T19:01:54Z","updated_at":"2020-01-17T15:00:50Z","closed_at":"2020-01-17T14:52:48Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I have a Slim Framework app I'm adding Psalm to. There is a global constant defined at runtime during configuration:\r\n\r\n```php\r\n<?php\r\n// in the main settings file (slightly simplified),\r\n// included by the front controller\r\n// (phpunit bootstrap file defines it as 'test')\r\nif (! defined('ENVIRONMENT')) {\r\n    define('ENVIRONMENT', $_SERVER['APP_ENV'] ?? 'prod'); \r\n}\r\n\r\n// in a PSR-4 autoloaded class file\r\nclass ErrorHandler {\r\n  private function formatException(Throwable $ex) {\r\n    // ...\r\n    if (ENVIRONMENT === 'dev' || ENVIRONMENT === 'test') {\r\n      // add stack trace to error responses\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nThis constant is not available when Psalm is running, because it doesn't load in via the framework's front controller.  If I give Psalm a bootstrap file that defines the constant, then Psalm ends up thinking the constant can have only one value, and flags the other values as impossible.  (Psalm is set up to analyze this settings file, since it's under src/ with everything else, but it doesn't seem to be picking up this information about the constant and applying it to other files.  Which is reasonable, since Psalm doesn't know the entry points / load order.)\r\n\r\nMaybe the type could be set in `<globals>` in the config, except that it's not a variable, so that didn't work.  It doesn't look like globals supports a const/constant tag.\r\n\r\nIt seems to be too complex to reproduce on https://psalm.dev â€“ if everything is in one file, then Psalm can recognize that the constant can have multiple values and reports \"no issues\".\r\n\r\n**How do I get the correct type,** or even just `string`, to Psalm; or, should I replace the constant with a global variable?\r\n\r\nvimeo/psalm 3.8.2.","closed_by":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/2644/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vimeo/psalm/issues/2644/timeline","performed_via_github_app":null,"state_reason":"completed"}