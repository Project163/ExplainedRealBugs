{"url":"https://api.github.com/repos/vimeo/psalm/issues/9350","repository_url":"https://api.github.com/repos/vimeo/psalm","labels_url":"https://api.github.com/repos/vimeo/psalm/issues/9350/labels{/name}","comments_url":"https://api.github.com/repos/vimeo/psalm/issues/9350/comments","events_url":"https://api.github.com/repos/vimeo/psalm/issues/9350/events","html_url":"https://github.com/vimeo/psalm/issues/9350","id":1591551888,"node_id":"I_kwDOBG8K985e3SeQ","number":9350,"title":"opcache.jit=1205 causes an assertion","user":{"login":"edsrzf","id":369904,"node_id":"MDQ6VXNlcjM2OTkwNA==","avatar_url":"https://avatars.githubusercontent.com/u/369904?v=4","gravatar_id":"","url":"https://api.github.com/users/edsrzf","html_url":"https://github.com/edsrzf","followers_url":"https://api.github.com/users/edsrzf/followers","following_url":"https://api.github.com/users/edsrzf/following{/other_user}","gists_url":"https://api.github.com/users/edsrzf/gists{/gist_id}","starred_url":"https://api.github.com/users/edsrzf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edsrzf/subscriptions","organizations_url":"https://api.github.com/users/edsrzf/orgs","repos_url":"https://api.github.com/users/edsrzf/repos","events_url":"https://api.github.com/users/edsrzf/events{/privacy}","received_events_url":"https://api.github.com/users/edsrzf/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":486061586,"node_id":"MDU6TGFiZWw0ODYwNjE1ODY=","url":"https://api.github.com/repos/vimeo/psalm/labels/bug","name":"bug","color":"ee0701","default":true,"description":null},{"id":3081263289,"node_id":"MDU6TGFiZWwzMDgxMjYzMjg5","url":"https://api.github.com/repos/vimeo/psalm/labels/causes%20crash","name":"causes crash","color":"A80503","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2023-02-20T10:17:05Z","updated_at":"2023-02-20T22:26:22Z","closed_at":"2023-02-20T22:10:12Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"After updating from 5.6.0 to 5.7.1, I'm seeing an assertion when type-checking my code. It happens often, but not 100% of the time.\r\n\r\nIf I change `opcache.jit` from `1205` to `1254` (which is the default), the assertion goes away.\r\n\r\n## System Information\r\n\r\nOS: MacOS 13.2.1\r\nCPU: arm64\r\nPHP: 8.1.15\r\n\r\n## Stack Trace\r\n\r\n```\r\nUncaught AssertionError: assert(false) in vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/BinaryOp/ConcatAnalyzer.php:189\r\n#0 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/BinaryOp/ConcatAnalyzer.php(181): assert(false, 'assert(count($r...')\r\n#1 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/BinaryOpAnalyzer.php(139): Psalm\\Internal\\Analyzer\\Statements\\Expression\\BinaryOp\\ConcatAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Scalar\\MagicConst\\Dir), Object(PhpParser\\Node\\Scalar\\String_), Object(Psalm\\Context), Object(Psalm\\Type\\Union))\r\n#2 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(266): Psalm\\Internal\\Analyzer\\Statements\\Expression\\BinaryOpAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\BinaryOp\\Concat), Object(Psalm\\Context), 0, false)\r\n#3 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(86): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::handleExpression(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\BinaryOp\\Concat), Object(Psalm\\Context), false, NULL, false, NULL, false)\r\n#4 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/Call/ArgumentsAnalyzer.php(241): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\BinaryOp\\Concat), Object(Psalm\\Context), false, NULL, false, NULL)\r\n#5 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/Call/FunctionCallAnalyzer.php(186): Psalm\\Internal\\Analyzer\\Statements\\Expression\\Call\\ArgumentsAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Array, Array, 'realpath', true, Object(Psalm\\Context), Object(Psalm\\Internal\\Type\\TemplateResult))\r\n#6 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(296): Psalm\\Internal\\Analyzer\\Statements\\Expression\\Call\\FunctionCallAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\FuncCall), Object(Psalm\\Context), Object(Psalm\\Internal\\Type\\TemplateResult))\r\n#7 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(86): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::handleExpression(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\FuncCall), Object(Psalm\\Context), false, NULL, false, NULL, false)\r\n#8 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/AssignmentAnalyzer.php(242): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\FuncCall), Object(Psalm\\Context))\r\n#9 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(544): Psalm\\Internal\\Analyzer\\Statements\\Expression\\AssignmentAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\PropertyFetch), Object(PhpParser\\Node\\Expr\\FuncCall), NULL, Object(Psalm\\Context), NULL, Array, NULL)\r\n#10 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(178): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::analyzeAssignment(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\Assign), Object(Psalm\\Context), true)\r\n#11 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(86): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::handleExpression(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\Assign), Object(Psalm\\Context), false, NULL, true, NULL, false)\r\n#12 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/StatementsAnalyzer.php(566): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\Assign), Object(Psalm\\Context), false, NULL, true)\r\n#13 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/StatementsAnalyzer.php(195): Psalm\\Internal\\Analyzer\\StatementsAnalyzer::analyzeStatement(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Stmt\\Expression), Object(Psalm\\Context), NULL)\r\n#14 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/FunctionLikeAnalyzer.php(468): Psalm\\Internal\\Analyzer\\StatementsAnalyzer->analyze(Array, Object(Psalm\\Context), NULL, true)\r\n#15 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/ClassLikeAnalyzer.php(131): Psalm\\Internal\\Analyzer\\FunctionLikeAnalyzer->analyze(Object(Psalm\\Context), Object(Psalm\\Internal\\Provider\\NodeDataProvider), NULL, true)\r\n#16 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/FileAnalyzer.php(414): Psalm\\Internal\\Analyzer\\ClassLikeAnalyzer->getMethodMutations('__construct', Object(Psalm\\Context))\r\n#17 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/ProjectAnalyzer.php(1393): Psalm\\Internal\\Analyzer\\FileAnalyzer->getMethodMutations(Object(Psalm\\Internal\\MethodIdentifier), Object(Psalm\\Context), true)\r\n#18 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/FileAnalyzer.php(381): Psalm\\Internal\\Analyzer\\ProjectAnalyzer->getMethodMutations(Object(Psalm\\Internal\\MethodIdentifier), Object(Psalm\\Context), '...', 'apps/backend/co...')\r\n#19 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/Call/StaticMethod/ExistingAtomicStaticCallAnalyzer.php(130): Psalm\\Internal\\Analyzer\\FileAnalyzer->getMethodMutations(Object(Psalm\\Internal\\MethodIdentifier), Object(Psalm\\Context))\r\n#20 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/Call/StaticMethod/AtomicStaticCallAnalyzer.php(882): Psalm\\Internal\\Analyzer\\Statements\\Expression\\Call\\StaticMethod\\ExistingAtomicStaticCallAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\StaticCall), Object(PhpParser\\Node\\Identifier), Array, Object(Psalm\\Context), Object(Psalm\\Type\\Atomic\\TNamedObject), Object(Psalm\\Internal\\MethodIdentifier), 'ProjectConfigur...', Object(Psalm\\Storage\\ClassLikeStorage), false, NULL)\r\n#21 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/Call/StaticMethod/AtomicStaticCallAnalyzer.php(207): Psalm\\Internal\\Analyzer\\Statements\\Expression\\Call\\StaticMethod\\AtomicStaticCallAnalyzer::handleNamedCall(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\StaticCall), Object(PhpParser\\Node\\Identifier), Object(Psalm\\Context), Object(Psalm\\Type\\Atomic\\TNamedObject), Array, 'ProjectConfigur...', false, true, NULL)\r\n#22 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/Call/StaticCallAnalyzer.php(208): Psalm\\Internal\\Analyzer\\Statements\\Expression\\Call\\StaticMethod\\AtomicStaticCallAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\StaticCall), Object(Psalm\\Context), Object(Psalm\\Type\\Atomic\\TNamedObject), false, false, false, true, NULL)\r\n#23 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(190): Psalm\\Internal\\Analyzer\\Statements\\Expression\\Call\\StaticCallAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\StaticCall), Object(Psalm\\Context), NULL)\r\n#24 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(86): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::handleExpression(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\StaticCall), Object(Psalm\\Context), false, NULL, true, NULL, false)\r\n#25 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/StatementsAnalyzer.php(566): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\StaticCall), Object(Psalm\\Context), false, NULL, true)\r\n#26 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/StatementsAnalyzer.php(195): Psalm\\Internal\\Analyzer\\StatementsAnalyzer::analyzeStatement(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Stmt\\Expression), Object(Psalm\\Context), NULL)\r\n#27 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/FunctionLikeAnalyzer.php(468): Psalm\\Internal\\Analyzer\\StatementsAnalyzer->analyze(Array, Object(Psalm\\Context), NULL, true)\r\n#28 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/ClassLikeAnalyzer.php(131): Psalm\\Internal\\Analyzer\\FunctionLikeAnalyzer->analyze(Object(Psalm\\Context), Object(Psalm\\Internal\\Provider\\NodeDataProvider), NULL, true)\r\n#29 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/FileAnalyzer.php(414): Psalm\\Internal\\Analyzer\\ClassLikeAnalyzer->getMethodMutations('__construct', Object(Psalm\\Context))\r\n#30 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/ProjectAnalyzer.php(1393): Psalm\\Internal\\Analyzer\\FileAnalyzer->getMethodMutations(Object(Psalm\\Internal\\MethodIdentifier), Object(Psalm\\Context), true)\r\n#31 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/FileAnalyzer.php(381): Psalm\\Internal\\Analyzer\\ProjectAnalyzer->getMethodMutations(Object(Psalm\\Internal\\MethodIdentifier), Object(Psalm\\Context), '...', 'apps/backend/co...')\r\n#32 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/Call/StaticMethod/ExistingAtomicStaticCallAnalyzer.php(130): Psalm\\Internal\\Analyzer\\FileAnalyzer->getMethodMutations(Object(Psalm\\Internal\\MethodIdentifier), Object(Psalm\\Context))\r\n#33 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/Call/StaticMethod/AtomicStaticCallAnalyzer.php(882): Psalm\\Internal\\Analyzer\\Statements\\Expression\\Call\\StaticMethod\\ExistingAtomicStaticCallAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\StaticCall), Object(PhpParser\\Node\\Identifier), Array, Object(Psalm\\Context), Object(Psalm\\Type\\Atomic\\TNamedObject), Object(Psalm\\Internal\\MethodIdentifier), 'sfApplicationCo...', Object(Psalm\\Storage\\ClassLikeStorage), false, NULL)\r\n#34 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/Call/StaticMethod/AtomicStaticCallAnalyzer.php(207): Psalm\\Internal\\Analyzer\\Statements\\Expression\\Call\\StaticMethod\\AtomicStaticCallAnalyzer::handleNamedCall(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\StaticCall), Object(PhpParser\\Node\\Identifier), Object(Psalm\\Context), Object(Psalm\\Type\\Atomic\\TNamedObject), Array, 'sfApplicationCo...', false, true, NULL)\r\n#35 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/Call/StaticCallAnalyzer.php(208): Psalm\\Internal\\Analyzer\\Statements\\Expression\\Call\\StaticMethod\\AtomicStaticCallAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\StaticCall), Object(Psalm\\Context), Object(Psalm\\Type\\Atomic\\TNamedObject), false, false, false, true, NULL)\r\n#36 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(190): Psalm\\Internal\\Analyzer\\Statements\\Expression\\Call\\StaticCallAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\StaticCall), Object(Psalm\\Context), NULL)\r\n#37 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(86): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::handleExpression(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\StaticCall), Object(Psalm\\Context), false, NULL, true, NULL, false)\r\n#38 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/StatementsAnalyzer.php(566): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\StaticCall), Object(Psalm\\Context), false, NULL, true)\r\n#39 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/StatementsAnalyzer.php(195): Psalm\\Internal\\Analyzer\\StatementsAnalyzer::analyzeStatement(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Stmt\\Expression), Object(Psalm\\Context), NULL)\r\n#40 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/FunctionLikeAnalyzer.php(468): Psalm\\Internal\\Analyzer\\StatementsAnalyzer->analyze(Array, Object(Psalm\\Context), NULL, true)\r\n#41 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/ClassLikeAnalyzer.php(131): Psalm\\Internal\\Analyzer\\FunctionLikeAnalyzer->analyze(Object(Psalm\\Context), Object(Psalm\\Internal\\Provider\\NodeDataProvider), NULL, true)\r\n#42 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/FileAnalyzer.php(414): Psalm\\Internal\\Analyzer\\ClassLikeAnalyzer->getMethodMutations('__construct', Object(Psalm\\Context))\r\n#43 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/ProjectAnalyzer.php(1393): Psalm\\Internal\\Analyzer\\FileAnalyzer->getMethodMutations(Object(Psalm\\Internal\\MethodIdentifier), Object(Psalm\\Context), true)\r\n#44 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/FileAnalyzer.php(381): Psalm\\Internal\\Analyzer\\ProjectAnalyzer->getMethodMutations(Object(Psalm\\Internal\\MethodIdentifier), Object(Psalm\\Context), '...', 'apps/backend/co...')\r\n#45 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/Call/StaticMethod/ExistingAtomicStaticCallAnalyzer.php(130): Psalm\\Internal\\Analyzer\\FileAnalyzer->getMethodMutations(Object(Psalm\\Internal\\MethodIdentifier), Object(Psalm\\Context))\r\n#46 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/Call/StaticMethod/AtomicStaticCallAnalyzer.php(882): Psalm\\Internal\\Analyzer\\Statements\\Expression\\Call\\StaticMethod\\ExistingAtomicStaticCallAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(Psalm\\Node\\Expr\\VirtualStaticCall), Object(Psalm\\Node\\VirtualIdentifier), Array, Object(Psalm\\Context), Object(Psalm\\Type\\Atomic\\TNamedObject), Object(Psalm\\Internal\\MethodIdentifier), 'VendApplication...', Object(Psalm\\Storage\\ClassLikeStorage), false, NULL)\r\n#47 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/Call/StaticMethod/AtomicStaticCallAnalyzer.php(207): Psalm\\Internal\\Analyzer\\Statements\\Expression\\Call\\StaticMethod\\AtomicStaticCallAnalyzer::handleNamedCall(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(Psalm\\Node\\Expr\\VirtualStaticCall), Object(Psalm\\Node\\VirtualIdentifier), Object(Psalm\\Context), Object(Psalm\\Type\\Atomic\\TNamedObject), Array, 'VendApplication...', false, true, NULL)\r\n#48 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/Call/StaticCallAnalyzer.php(208): Psalm\\Internal\\Analyzer\\Statements\\Expression\\Call\\StaticMethod\\AtomicStaticCallAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(Psalm\\Node\\Expr\\VirtualStaticCall), Object(Psalm\\Context), Object(Psalm\\Type\\Atomic\\TNamedObject), false, false, false, true, NULL)\r\n#49 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(190): Psalm\\Internal\\Analyzer\\Statements\\Expression\\Call\\StaticCallAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(Psalm\\Node\\Expr\\VirtualStaticCall), Object(Psalm\\Context), NULL)\r\n#50 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(86): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::handleExpression(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(Psalm\\Node\\Expr\\VirtualStaticCall), Object(Psalm\\Context), false, Object(Psalm\\Context), true, NULL, false)\r\n#51 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/StatementsAnalyzer.php(566): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(Psalm\\Node\\Expr\\VirtualStaticCall), Object(Psalm\\Context), false, Object(Psalm\\Context), true)\r\n#52 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/StatementsAnalyzer.php(195): Psalm\\Internal\\Analyzer\\StatementsAnalyzer::analyzeStatement(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(Psalm\\Node\\Stmt\\VirtualExpression), Object(Psalm\\Context), Object(Psalm\\Context))\r\n#53 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/FunctionLikeAnalyzer.php(468): Psalm\\Internal\\Analyzer\\StatementsAnalyzer->analyze(Array, Object(Psalm\\Context), Object(Psalm\\Context), true)\r\n#54 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/ClassAnalyzer.php(1799): Psalm\\Internal\\Analyzer\\FunctionLikeAnalyzer->analyze(Object(Psalm\\Context), Object(Psalm\\Internal\\Provider\\NodeDataProvider), Object(Psalm\\Context))\r\n#55 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/ClassAnalyzer.php(1226): Psalm\\Internal\\Analyzer\\ClassAnalyzer->analyzeClassMethod(Object(Psalm\\Node\\Stmt\\VirtualClassMethod), Object(Psalm\\Storage\\ClassLikeStorage), Object(Psalm\\Internal\\Analyzer\\ClassAnalyzer), Object(Psalm\\Context), Object(Psalm\\Context), true)\r\n#56 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/ClassAnalyzer.php(551): Psalm\\Internal\\Analyzer\\ClassAnalyzer->checkPropertyInitialization(Object(Psalm\\Codebase), Object(Psalm\\Config), Object(Psalm\\Storage\\ClassLikeStorage), Object(Psalm\\Context), Object(Psalm\\Context), NULL)\r\n#57 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/FileAnalyzer.php(203): Psalm\\Internal\\Analyzer\\ClassAnalyzer->analyze(Object(Psalm\\Context), Object(Psalm\\Context))\r\n#58 vendor/vimeo/psalm/src/Psalm/Internal/Codebase/Analyzer.php(1581): Psalm\\Internal\\Analyzer\\FileAnalyzer->analyze()\r\n#59 vendor/vimeo/psalm/src/Psalm/Internal/Codebase/Analyzer.php(522): Psalm\\Internal\\Codebase\\Analyzer->analysisWorker(0, '...')\r\n#60 vendor/vimeo/psalm/src/Psalm/Internal/Codebase/Analyzer.php(272): Psalm\\Internal\\Codebase\\Analyzer->doAnalysis(Object(Psalm\\Internal\\Analyzer\\ProjectAnalyzer), 1)\r\n#61 vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/ProjectAnalyzer.php(1187): Psalm\\Internal\\Codebase\\Analyzer->analyzeFiles(Object(Psalm\\Internal\\Analyzer\\ProjectAnalyzer), 1, false, false)\r\n#62 vendor/vimeo/psalm/src/Psalm/Internal/Cli/Psalm.php(374): Psalm\\Internal\\Analyzer\\ProjectAnalyzer->checkPaths(Array)\r\n#63 vendor/vimeo/psalm/psalm(9): Psalm\\Internal\\Cli\\Psalm::run(Array)\r\n#64 vendor/bin/psalm(120): include('...')\r\n#65 {main}\r\n```\r\n\r\n## Code\r\n\r\nThe code that triggers this assertion is:\r\n\r\n```\r\n<?php\r\n\r\n$v = __DIR__ . '';\r\n// Also works:\r\n// $v = __FILE__ . '';\r\n```\r\n\r\n(This can't be reproduced with a snippet because the snippet likely runs on a different platform.)\r\n\r\n## Further Debugging\r\n\r\nThis is probably a JIT bug in PHP. If I add some debug logging I see some truly unexplainable behavior:\r\n\r\nOriginal code:\r\n\r\n```php\r\n                    if ($literal_concat) {\r\n                        assert(count($result_type_parts) === $combinations);\r\n                        assert(count($result_type_parts) !== 0); // #8163\r\n                        $result_type = new Union($result_type_parts);\r\n                    }\r\n```\r\n\r\nWith added debugging:\r\n\r\n```php\r\n                    if ($literal_concat) {\r\n                        if (count($result_type_parts) !== $combinations) {\r\n                            var_dump(count($result_type_parts) === $combinations);\r\n                            var_dump(count($result_type_parts));\r\n                            var_dump($combinations);\r\n                            assert(false);\r\n                        }\r\n                        assert(count($result_type_parts) === $combinations);\r\n                        assert(count($result_type_parts) !== 0); // #8163\r\n                        $result_type = new Union($result_type_parts);\r\n                    }\r\n```\r\n\r\nWhen the assertion triggers, the output of this code is:\r\n\r\n```\r\nbool(false)\r\nint(1)\r\nint(1)\r\n```\r\n\r\nSo, it's saying 1 !== 1, which is...puzzling, to say the least. Also, if I change the order of the logging and move `var_dump($combinations)` first, the output becomes:\r\n\r\n```\r\nint(1)\r\nbool(true)\r\nint(1)\r\n```","closed_by":{"login":"weirdan","id":57403,"node_id":"MDQ6VXNlcjU3NDAz","avatar_url":"https://avatars.githubusercontent.com/u/57403?v=4","gravatar_id":"","url":"https://api.github.com/users/weirdan","html_url":"https://github.com/weirdan","followers_url":"https://api.github.com/users/weirdan/followers","following_url":"https://api.github.com/users/weirdan/following{/other_user}","gists_url":"https://api.github.com/users/weirdan/gists{/gist_id}","starred_url":"https://api.github.com/users/weirdan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weirdan/subscriptions","organizations_url":"https://api.github.com/users/weirdan/orgs","repos_url":"https://api.github.com/users/weirdan/repos","events_url":"https://api.github.com/users/weirdan/events{/privacy}","received_events_url":"https://api.github.com/users/weirdan/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/9350/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vimeo/psalm/issues/9350/timeline","performed_via_github_app":null,"state_reason":"completed"}