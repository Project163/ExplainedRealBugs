{"url":"https://api.github.com/repos/vimeo/psalm/issues/9363","repository_url":"https://api.github.com/repos/vimeo/psalm","labels_url":"https://api.github.com/repos/vimeo/psalm/issues/9363/labels{/name}","comments_url":"https://api.github.com/repos/vimeo/psalm/issues/9363/comments","events_url":"https://api.github.com/repos/vimeo/psalm/issues/9363/events","html_url":"https://github.com/vimeo/psalm/issues/9363","id":1593061872,"node_id":"I_kwDOBG8K985e9DHw","number":9363,"title":"Uncaught Exception: AssertionError The number of parts does not match!","user":{"login":"gcg","id":811685,"node_id":"MDQ6VXNlcjgxMTY4NQ==","avatar_url":"https://avatars.githubusercontent.com/u/811685?v=4","gravatar_id":"","url":"https://api.github.com/users/gcg","html_url":"https://github.com/gcg","followers_url":"https://api.github.com/users/gcg/followers","following_url":"https://api.github.com/users/gcg/following{/other_user}","gists_url":"https://api.github.com/users/gcg/gists{/gist_id}","starred_url":"https://api.github.com/users/gcg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gcg/subscriptions","organizations_url":"https://api.github.com/users/gcg/orgs","repos_url":"https://api.github.com/users/gcg/repos","events_url":"https://api.github.com/users/gcg/events{/privacy}","received_events_url":"https://api.github.com/users/gcg/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2023-02-21T08:45:00Z","updated_at":"2023-02-21T16:02:55Z","closed_at":"2023-02-21T16:02:55Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hey there, \r\n\r\nSo I can't update psalm to 5.7.x due to this error. \r\n\r\n<img width=\"1250\" alt=\"image\" src=\"https://user-images.githubusercontent.com/811685/220290814-95f3a924-020c-4601-b740-c2ab67f38dca.png\">\r\n\r\n<details><summary>full stack trace</summary>\r\n<p>\r\n\r\n```\r\nTarget PHP version: 8.2 (inferred from current PHP version).\r\nScanning files...\r\nAnalyzing files...\r\n\r\nUncaught Exception: AssertionError The number of parts does not match!\r\nEmitted in /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/BinaryOp/ConcatAnalyzer.php:196\r\nStack trace in the forked worker:\r\n#0 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/BinaryOpAnalyzer.php(138): Psalm\\Internal\\Analyzer\\Statements\\Expression\\BinaryOp\\ConcatAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\Variable), Object(PhpParser\\Node\r\n\\Scalar\\String_), Object(Psalm\\Context), Object(Psalm\\Type\\Union))\r\n#1 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(265): Psalm\\Internal\\Analyzer\\Statements\\Expression\\BinaryOpAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(Psalm\\Node\\Expr\\BinaryOp\\VirtualConcat), Object(Psalm\\Context), 0, f\r\nalse)\r\n#2 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(85): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::handleExpression(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(Psalm\\Node\\Expr\\BinaryOp\\VirtualConcat), Object(Psalm\\Context), false\r\n, NULL, false, NULL, false)\r\n#3 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/AssignmentAnalyzer.php(242): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(Psalm\\Node\\Expr\\BinaryOp\\VirtualConcat), Object(Psalm\\Context))\r\n#4 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(536): Psalm\\Internal\\Analyzer\\Statements\\Expression\\AssignmentAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\Variable), Object(Psalm\\Node\\Expr\\BinaryOp\\Vir\r\ntualConcat), NULL, Object(Psalm\\Context), NULL, Array, Object(Psalm\\Node\\Expr\\VirtualAssign))\r\n#5 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(178): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::analyzeAssignment(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(Psalm\\Node\\Expr\\VirtualAssign), Object(Psalm\\Context), false)\r\n#6 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(85): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::handleExpression(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(Psalm\\Node\\Expr\\VirtualAssign), Object(Psalm\\Context), false, NULL, f\r\nalse, NULL, false)\r\n#7 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/AssignmentAnalyzer.php(881): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(Psalm\\Node\\Expr\\VirtualAssign), Object(Psalm\\Context))\r\n#8 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(182): Psalm\\Internal\\Analyzer\\Statements\\Expression\\AssignmentAnalyzer::analyzeAssignmentOperation(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\AssignOp\\Concat), Object(Ps\r\nalm\\Context))\r\n#9 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(85): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::handleExpression(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\AssignOp\\Concat), Object(Psalm\\Context), false, N\r\nULL, true, NULL, false)\r\n#10 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/StatementsAnalyzer.php(560): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Expr\\AssignOp\\Concat), Object(Psalm\\Context), false, NULL, true)\r\n#11 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/StatementsAnalyzer.php(195): Psalm\\Internal\\Analyzer\\StatementsAnalyzer::analyzeStatement(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Stmt\\Expression), Object(Psalm\\Context), NULL)\r\n#12 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Block/IfElse/IfAnalyzer.php(161): Psalm\\Internal\\Analyzer\\StatementsAnalyzer->analyze(Array, Object(Psalm\\Context))\r\n#13 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Block/IfElseAnalyzer.php(260): Psalm\\Internal\\Analyzer\\Statements\\Block\\IfElse\\IfAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Stmt\\If_), Object(Psalm\\Internal\\Scope\\IfScope), Objec\r\nt(Psalm\\Internal\\Scope\\IfConditionalScope), Object(Psalm\\Context), Object(Psalm\\Context), Array)\r\n#14 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/StatementsAnalyzer.php(514): Psalm\\Internal\\Analyzer\\Statements\\Block\\IfElseAnalyzer::analyze(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Stmt\\If_), Object(Psalm\\Context))\r\n#15 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/StatementsAnalyzer.php(195): Psalm\\Internal\\Analyzer\\StatementsAnalyzer::analyzeStatement(Object(Psalm\\Internal\\Analyzer\\StatementsAnalyzer), Object(PhpParser\\Node\\Stmt\\If_), Object(Psalm\\Context), Object(Psalm\\Context))\r\n#16 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/FunctionLikeAnalyzer.php(468): Psalm\\Internal\\Analyzer\\StatementsAnalyzer->analyze(Array, Object(Psalm\\Context), Object(Psalm\\Context), true)\r\n#17 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/ClassAnalyzer.php(1796): Psalm\\Internal\\Analyzer\\FunctionLikeAnalyzer->analyze(Object(Psalm\\Context), Object(Psalm\\Internal\\Provider\\NodeDataProvider), Object(Psalm\\Context))\r\n#18 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/ClassAnalyzer.php(425): Psalm\\Internal\\Analyzer\\ClassAnalyzer->analyzeClassMethod(Object(PhpParser\\Node\\Stmt\\ClassMethod), Object(Psalm\\Storage\\ClassLikeStorage), Object(Psalm\\Internal\\Analyzer\\ClassAnalyzer), Object(Psalm\\Context), Objec\r\nt(Psalm\\Context))\r\n#19 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/FileAnalyzer.php(203): Psalm\\Internal\\Analyzer\\ClassAnalyzer->analyze(Object(Psalm\\Context), Object(Psalm\\Context))\r\n#20 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Codebase/Analyzer.php(1581): Psalm\\Internal\\Analyzer\\FileAnalyzer->analyze()\r\n#21 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Fork/Pool.php(209): Psalm\\Internal\\Codebase\\Analyzer->analysisWorker(0, '/Users/gcg/Work...')\r\n#22 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Codebase/Analyzer.php(372): Psalm\\Internal\\Fork\\Pool->__construct(Object(Psalm\\Config), Array, Object(Closure), Object(Closure), Object(Closure), Object(Closure))\r\n#23 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Codebase/Analyzer.php(272): Psalm\\Internal\\Codebase\\Analyzer->doAnalysis(Object(Psalm\\Internal\\Analyzer\\ProjectAnalyzer), 9)\r\n#24 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/ProjectAnalyzer.php(665): Psalm\\Internal\\Codebase\\Analyzer->analyzeFiles(Object(Psalm\\Internal\\Analyzer\\ProjectAnalyzer), 9, false, true)\r\n#25 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Cli/Psalm.php(372): Psalm\\Internal\\Analyzer\\ProjectAnalyzer->check('/Users/gcg/Work...', true)\r\n#26 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/psalm(9): Psalm\\Internal\\Cli\\Psalm::run(Array)\r\n#27 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/bin/psalm(120): include('/Users/gcg/Work...')\r\n#28 {main} in /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Fork/Pool.php:397\r\nStack trace:\r\n#0 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Fork/Pool.php(431): Psalm\\Internal\\Fork\\Pool->readResultsFromChildren()\r\n#1 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Codebase/Analyzer.php(406): Psalm\\Internal\\Fork\\Pool->wait()\r\n#2 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Codebase/Analyzer.php(272): Psalm\\Internal\\Codebase\\Analyzer->doAnalysis(Object(Psalm\\Internal\\Analyzer\\ProjectAnalyzer), 9)\r\n#3 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/ProjectAnalyzer.php(665): Psalm\\Internal\\Codebase\\Analyzer->analyzeFiles(Object(Psalm\\Internal\\Analyzer\\ProjectAnalyzer), 9, false, true)\r\n#4 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/src/Psalm/Internal/Cli/Psalm.php(372): Psalm\\Internal\\Analyzer\\ProjectAnalyzer->check('/Users/gcg/Work...', true)\r\n#5 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/vimeo/psalm/psalm(9): Psalm\\Internal\\Cli\\Psalm::run(Array)\r\n#6 /Users/gcg/Work/src/github.com/Poltio/api1/vendor/bin/psalm(120): include('/Users/gcg/Work...')\r\n#7 {main}\r\n(Psalm 5.7.4@c46eccda769925073b8f65d66c4a3a7dc5d440b1 crashed due to an uncaught Throwable)\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\nI tried with 5.7.0 5.7.1 and now today with 5.7.4 same thing. \r\n\r\nI am on apple silicon with php 8.2 (PHP 8.2.3 (cli) (built: Feb 15 2023 00:18:01) (NTS)) \r\n\r\nAnd the funny thing is, I added var_dump to the  [file/variables](https://github.com/vimeo/psalm/blob/master/src/Psalm/Internal/Analyzer/Statements/Expression/BinaryOp/ConcatAnalyzer.php#L180) throwing this error: \r\n\r\n<img width=\"809\" alt=\"image\" src=\"https://user-images.githubusercontent.com/811685/220292239-d6591953-92fc-49bc-af21-1c61b0a04fd1.png\">\r\n\r\n<img width=\"1159\" alt=\"image\" src=\"https://user-images.githubusercontent.com/811685/220292475-ec2d1bf6-e601-4ffd-9455-f347eff664f7.png\">\r\n\r\nAm I just missing something silly or shouldnt `int(1) !== int(1)` supposed to return `false` instead of `true` like it does here \r\n\r\nI am trying to fiddle it out but if anyone has more experience and can point a finger to something that i am failing to see, that will be much appriciated. \r\n\r\n\r\n\r\n\r\n","closed_by":{"login":"weirdan","id":57403,"node_id":"MDQ6VXNlcjU3NDAz","avatar_url":"https://avatars.githubusercontent.com/u/57403?v=4","gravatar_id":"","url":"https://api.github.com/users/weirdan","html_url":"https://github.com/weirdan","followers_url":"https://api.github.com/users/weirdan/followers","following_url":"https://api.github.com/users/weirdan/following{/other_user}","gists_url":"https://api.github.com/users/weirdan/gists{/gist_id}","starred_url":"https://api.github.com/users/weirdan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weirdan/subscriptions","organizations_url":"https://api.github.com/users/weirdan/orgs","repos_url":"https://api.github.com/users/weirdan/repos","events_url":"https://api.github.com/users/weirdan/events{/privacy}","received_events_url":"https://api.github.com/users/weirdan/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/9363/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vimeo/psalm/issues/9363/timeline","performed_via_github_app":null,"state_reason":"completed"}