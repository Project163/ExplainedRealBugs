[{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/738942124","html_url":"https://github.com/vimeo/psalm/issues/4778#issuecomment-738942124","issue_url":"https://api.github.com/repos/vimeo/psalm/issues/4778","id":738942124,"node_id":"MDEyOklzc3VlQ29tbWVudDczODk0MjEyNA==","user":{"login":"psalm-github-bot[bot]","id":58627613,"node_id":"MDM6Qm90NTg2Mjc2MTM=","avatar_url":"https://avatars.githubusercontent.com/in/48546?v=4","gravatar_id":"","url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D","html_url":"https://github.com/apps/psalm-github-bot","followers_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/followers","following_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/repos","events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2020-12-04T18:22:57Z","updated_at":"2020-12-04T18:22:57Z","body":"Hey @theodorejb, can you reproduce the issue on https://psalm.dev ?","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/738942124/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"psalm-github-bot[bot]","id":58627613,"node_id":"MDM6Qm90NTg2Mjc2MTM=","avatar_url":"https://avatars.githubusercontent.com/in/48546?v=4","gravatar_id":"","url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D","html_url":"https://github.com/apps/psalm-github-bot","followers_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/followers","following_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/repos","events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false}},{"id":4073926452,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDA3MzkyNjQ1Mg==","url":"https://api.github.com/repos/vimeo/psalm/issues/events/4073926452","actor":{"login":"theodorejb","id":3053271,"node_id":"MDQ6VXNlcjMwNTMyNzE=","avatar_url":"https://avatars.githubusercontent.com/u/3053271?v=4","gravatar_id":"","url":"https://api.github.com/users/theodorejb","html_url":"https://github.com/theodorejb","followers_url":"https://api.github.com/users/theodorejb/followers","following_url":"https://api.github.com/users/theodorejb/following{/other_user}","gists_url":"https://api.github.com/users/theodorejb/gists{/gist_id}","starred_url":"https://api.github.com/users/theodorejb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/theodorejb/subscriptions","organizations_url":"https://api.github.com/users/theodorejb/orgs","repos_url":"https://api.github.com/users/theodorejb/repos","events_url":"https://api.github.com/users/theodorejb/events{/privacy}","received_events_url":"https://api.github.com/users/theodorejb/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-12-04T18:22:58Z","performed_via_github_app":null},{"id":4073926457,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQwNzM5MjY0NTc=","url":"https://api.github.com/repos/vimeo/psalm/issues/events/4073926457","actor":{"login":"theodorejb","id":3053271,"node_id":"MDQ6VXNlcjMwNTMyNzE=","avatar_url":"https://avatars.githubusercontent.com/u/3053271?v=4","gravatar_id":"","url":"https://api.github.com/users/theodorejb","html_url":"https://github.com/theodorejb","followers_url":"https://api.github.com/users/theodorejb/followers","following_url":"https://api.github.com/users/theodorejb/following{/other_user}","gists_url":"https://api.github.com/users/theodorejb/gists{/gist_id}","starred_url":"https://api.github.com/users/theodorejb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/theodorejb/subscriptions","organizations_url":"https://api.github.com/users/theodorejb/orgs","repos_url":"https://api.github.com/users/theodorejb/repos","events_url":"https://api.github.com/users/theodorejb/events{/privacy}","received_events_url":"https://api.github.com/users/theodorejb/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-12-04T18:22:58Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/738942985","html_url":"https://github.com/vimeo/psalm/issues/4778#issuecomment-738942985","issue_url":"https://api.github.com/repos/vimeo/psalm/issues/4778","id":738942985,"node_id":"MDEyOklzc3VlQ29tbWVudDczODk0Mjk4NQ==","user":{"login":"theodorejb","id":3053271,"node_id":"MDQ6VXNlcjMwNTMyNzE=","avatar_url":"https://avatars.githubusercontent.com/u/3053271?v=4","gravatar_id":"","url":"https://api.github.com/users/theodorejb","html_url":"https://github.com/theodorejb","followers_url":"https://api.github.com/users/theodorejb/followers","following_url":"https://api.github.com/users/theodorejb/following{/other_user}","gists_url":"https://api.github.com/users/theodorejb/gists{/gist_id}","starred_url":"https://api.github.com/users/theodorejb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/theodorejb/subscriptions","organizations_url":"https://api.github.com/users/theodorejb/orgs","repos_url":"https://api.github.com/users/theodorejb/repos","events_url":"https://api.github.com/users/theodorejb/events{/privacy}","received_events_url":"https://api.github.com/users/theodorejb/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-04T18:24:46Z","updated_at":"2020-12-04T18:24:46Z","body":"https://psalm.dev/r/246cc48833","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/738942985/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"theodorejb","id":3053271,"node_id":"MDQ6VXNlcjMwNTMyNzE=","avatar_url":"https://avatars.githubusercontent.com/u/3053271?v=4","gravatar_id":"","url":"https://api.github.com/users/theodorejb","html_url":"https://github.com/theodorejb","followers_url":"https://api.github.com/users/theodorejb/followers","following_url":"https://api.github.com/users/theodorejb/following{/other_user}","gists_url":"https://api.github.com/users/theodorejb/gists{/gist_id}","starred_url":"https://api.github.com/users/theodorejb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/theodorejb/subscriptions","organizations_url":"https://api.github.com/users/theodorejb/orgs","repos_url":"https://api.github.com/users/theodorejb/repos","events_url":"https://api.github.com/users/theodorejb/events{/privacy}","received_events_url":"https://api.github.com/users/theodorejb/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/738943009","html_url":"https://github.com/vimeo/psalm/issues/4778#issuecomment-738943009","issue_url":"https://api.github.com/repos/vimeo/psalm/issues/4778","id":738943009,"node_id":"MDEyOklzc3VlQ29tbWVudDczODk0MzAwOQ==","user":{"login":"psalm-github-bot[bot]","id":58627613,"node_id":"MDM6Qm90NTg2Mjc2MTM=","avatar_url":"https://avatars.githubusercontent.com/in/48546?v=4","gravatar_id":"","url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D","html_url":"https://github.com/apps/psalm-github-bot","followers_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/followers","following_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/repos","events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2020-12-04T18:24:48Z","updated_at":"2020-12-04T18:24:48Z","body":"I found these snippets:\n<details>\n<summary>https://psalm.dev/r/246cc48833</summary>\n\n```php\n<?php\n\ndeclare(strict_types=1);\n\nclass Thing\n{\n    public function __construct(\n        public string $name,\n        public string $value,\n    ) {}\n}\n\nnew Foo([\n    new Thing('foo', 'bar'),\n    // Foo::__construct will cause the string '123' to end up as an int array key\n    new Thing('123', 'baz'),\n]);\n\nclass Foo\n{\n    /**\n     * @var array<mixed, string>\n     */\n    public array $map;\n\n    /**\n     * @param Thing[] $things\n     */\n    public function __construct(array $things)\n    {\n        $this->map = [];\n\n        foreach ($things as $thing) {\n            $this->map[$thing->name] = $thing->value;\n        }\n\n        // map may now contain some string keys and some int keys\n\n        foreach ($this->map as $key => $value) {\n            // $key may be an int, but Psalm fails to produce the error it does inside useMap()\n            echo strlen($key);\n        }\n\n        $this->useMap();\n    }\n\n    public function useMap(): void\n    {\n        foreach ($this->map as $key => $value) {\n            // this line correctly causes an error\n            echo strlen($key); // MixedArgumentTypeCoercion: Argument 1 of strlen expects string, parent type of array-key provided\n\n            // this line incorrectly says the cast is redundant\n            echo strlen((string) $key); // RedundantCast: Redundant cast to string\n        }\n    }\n}\n```\n\n```\nPsalm output (using commit 4a0e2f5):\n\nINFO: UnusedVariable - 39:40 - $value is never referenced or the value is not used\n\nINFO: MixedArgumentTypeCoercion - 51:25 - Argument 1 of strlen expects string, parent type array-key provided\n\nINFO: UnusedVariable - 49:40 - $value is never referenced or the value is not used\n\nERROR: RedundantCast - 54:25 - Redundant cast to string\n```\n</details>\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/738943009/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"psalm-github-bot[bot]","id":58627613,"node_id":"MDM6Qm90NTg2Mjc2MTM=","avatar_url":"https://avatars.githubusercontent.com/in/48546?v=4","gravatar_id":"","url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D","html_url":"https://github.com/apps/psalm-github-bot","followers_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/followers","following_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/repos","events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/738957370","html_url":"https://github.com/vimeo/psalm/issues/4778#issuecomment-738957370","issue_url":"https://api.github.com/repos/vimeo/psalm/issues/4778","id":738957370,"node_id":"MDEyOklzc3VlQ29tbWVudDczODk1NzM3MA==","user":{"login":"orklah","id":9605520,"node_id":"MDQ6VXNlcjk2MDU1MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9605520?v=4","gravatar_id":"","url":"https://api.github.com/users/orklah","html_url":"https://github.com/orklah","followers_url":"https://api.github.com/users/orklah/followers","following_url":"https://api.github.com/users/orklah/following{/other_user}","gists_url":"https://api.github.com/users/orklah/gists{/gist_id}","starred_url":"https://api.github.com/users/orklah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/orklah/subscriptions","organizations_url":"https://api.github.com/users/orklah/orgs","repos_url":"https://api.github.com/users/orklah/repos","events_url":"https://api.github.com/users/orklah/events{/privacy}","received_events_url":"https://api.github.com/users/orklah/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-04T18:55:04Z","updated_at":"2020-12-04T18:55:04Z","body":"On __construct method, Psalm considers `$this->map` as an `array<string, string>` so there's no error displayed. PHP quirks makes working on string key really difficult, especially in strict_types and Psalm doesn't really handle this for now. @muglug not sure how I could suppress the issue in this case, maybe something like from_array_key??\r\n\r\nOn useMap, your array is indeed an `array<array-key, string>` and $key is `array-key`, this is a full blown bug. I'll look into it","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/738957370/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"orklah","id":9605520,"node_id":"MDQ6VXNlcjk2MDU1MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9605520?v=4","gravatar_id":"","url":"https://api.github.com/users/orklah","html_url":"https://github.com/orklah","followers_url":"https://api.github.com/users/orklah/followers","following_url":"https://api.github.com/users/orklah/following{/other_user}","gists_url":"https://api.github.com/users/orklah/gists{/gist_id}","starred_url":"https://api.github.com/users/orklah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/orklah/subscriptions","organizations_url":"https://api.github.com/users/orklah/orgs","repos_url":"https://api.github.com/users/orklah/repos","events_url":"https://api.github.com/users/orklah/events{/privacy}","received_events_url":"https://api.github.com/users/orklah/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4074035334,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDA3NDAzNTMzNA==","url":"https://api.github.com/repos/vimeo/psalm/issues/events/4074035334","actor":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-12-04T18:55:04Z","performed_via_github_app":null},{"id":4074035338,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQwNzQwMzUzMzg=","url":"https://api.github.com/repos/vimeo/psalm/issues/events/4074035338","actor":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-12-04T18:55:04Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/738964131","html_url":"https://github.com/vimeo/psalm/issues/4778#issuecomment-738964131","issue_url":"https://api.github.com/repos/vimeo/psalm/issues/4778","id":738964131,"node_id":"MDEyOklzc3VlQ29tbWVudDczODk2NDEzMQ==","user":{"login":"orklah","id":9605520,"node_id":"MDQ6VXNlcjk2MDU1MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9605520?v=4","gravatar_id":"","url":"https://api.github.com/users/orklah","html_url":"https://github.com/orklah","followers_url":"https://api.github.com/users/orklah/followers","following_url":"https://api.github.com/users/orklah/following{/other_user}","gists_url":"https://api.github.com/users/orklah/gists{/gist_id}","starred_url":"https://api.github.com/users/orklah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/orklah/subscriptions","organizations_url":"https://api.github.com/users/orklah/orgs","repos_url":"https://api.github.com/users/orklah/repos","events_url":"https://api.github.com/users/orklah/events{/privacy}","received_events_url":"https://api.github.com/users/orklah/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-04T19:09:26Z","updated_at":"2020-12-04T19:09:26Z","body":"Simple reproducer the redundantCast:\r\nhttps://psalm.dev/r/57aa4a7a0d\r\n\r\nThe $key is an array-key but complains on the cast. If we remove the __construct or even the call to useMap in the __construct, the issue disappear, which means the code flow is important here.\r\nI'd guess this has something to do with memoization but the settings on psalm.dev don't change anything.\r\n\r\nIn the other hand, that means this is just the continuation of the first issue.\r\nThe whole issue disappear if you document the map array on initialization:\r\nhttps://psalm.dev/r/46ef8349ce\r\nor even if you initialize it in property:\r\nhttps://psalm.dev/r/beffa4073a","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/738964131/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"orklah","id":9605520,"node_id":"MDQ6VXNlcjk2MDU1MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9605520?v=4","gravatar_id":"","url":"https://api.github.com/users/orklah","html_url":"https://github.com/orklah","followers_url":"https://api.github.com/users/orklah/followers","following_url":"https://api.github.com/users/orklah/following{/other_user}","gists_url":"https://api.github.com/users/orklah/gists{/gist_id}","starred_url":"https://api.github.com/users/orklah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/orklah/subscriptions","organizations_url":"https://api.github.com/users/orklah/orgs","repos_url":"https://api.github.com/users/orklah/repos","events_url":"https://api.github.com/users/orklah/events{/privacy}","received_events_url":"https://api.github.com/users/orklah/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/738964156","html_url":"https://github.com/vimeo/psalm/issues/4778#issuecomment-738964156","issue_url":"https://api.github.com/repos/vimeo/psalm/issues/4778","id":738964156,"node_id":"MDEyOklzc3VlQ29tbWVudDczODk2NDE1Ng==","user":{"login":"psalm-github-bot[bot]","id":58627613,"node_id":"MDM6Qm90NTg2Mjc2MTM=","avatar_url":"https://avatars.githubusercontent.com/in/48546?v=4","gravatar_id":"","url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D","html_url":"https://github.com/apps/psalm-github-bot","followers_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/followers","following_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/repos","events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2020-12-04T19:09:29Z","updated_at":"2020-12-04T19:09:29Z","body":"I found these snippets:\n<details>\n<summary>https://psalm.dev/r/57aa4a7a0d</summary>\n\n```php\n<?php\nclass Foo\n{\n    /**\n     * @var array<mixed, string>\n     */\n    public array $map;\n\n    public function __construct()\n    {\n        $this->map = [];\n        $this->map['test'] = 'test';\n\n        $this->useMap();\n    }\n\n    public function useMap(): void\n    {\n        foreach ($this->map as $key => $value) {\n            /** @psalm-trace $key */;\n            echo (string) $key;\n        }\n    }\n}\n```\n\n```\nPsalm output (using commit 4a0e2f5):\n\nINFO: Trace - 20:37 - $key: array-key\n\nINFO: UnusedVariable - 19:40 - $value is never referenced or the value is not used\n\nERROR: RedundantCast - 21:18 - Redundant cast to string\n```\n</details>\n\n<details>\n<summary>https://psalm.dev/r/46ef8349ce</summary>\n\n```php\n<?php\n\ndeclare(strict_types=1);\n\nclass Thing\n{\n    public function __construct(\n        public string $name,\n        public string $value,\n    ) {}\n}\n\nnew Foo([\n    new Thing('foo', 'bar'),\n    // Foo::__construct will cause the string '123' to end up as an int array key\n    new Thing('123', 'baz'),\n]);\n\nclass Foo\n{\n    /**\n     * @var array<mixed, string>\n     */\n    public array $map;\n\n    /**\n     * @param Thing[] $things\n     */\n    public function __construct(array $things)\n    {\n        /**\n         * @var array<mixed, string>\n         */\n        $this->map = [];\n\n        foreach ($things as $thing) {\n            $this->map[$thing->name] = $thing->value;\n        }\n\n        // map may now contain some string keys and some int keys\n\n        foreach ($this->map as $key => $value) {\n            // $key may be an int, but Psalm fails to produce the error it does inside useMap()\n            echo strlen($key);\n        }\n\n        $this->useMap();\n    }\n\n    public function useMap(): void\n    {\n        foreach ($this->map as $key => $value) {\n            // this line correctly causes an error\n            echo strlen($key); // MixedArgumentTypeCoercion: Argument 1 of strlen expects string, parent type of array-key provided\n\n            // this line incorrectly says the cast is redundant\n            echo strlen((string) $key); // RedundantCast: Redundant cast to string\n        }\n    }\n}\n```\n\n```\nPsalm output (using commit 4a0e2f5):\n\nINFO: MixedArgumentTypeCoercion - 44:25 - Argument 1 of strlen expects string, parent type array-key provided\n\nINFO: UnusedVariable - 42:40 - $value is never referenced or the value is not used\n\nINFO: MixedArgumentTypeCoercion - 54:25 - Argument 1 of strlen expects string, parent type array-key provided\n\nINFO: UnusedVariable - 52:40 - $value is never referenced or the value is not used\n```\n</details>\n\n<details>\n<summary>https://psalm.dev/r/beffa4073a</summary>\n\n```php\n<?php\n\ndeclare(strict_types=1);\n\nclass Thing\n{\n    public function __construct(\n        public string $name,\n        public string $value,\n    ) {}\n}\n\nnew Foo([\n    new Thing('foo', 'bar'),\n    // Foo::__construct will cause the string '123' to end up as an int array key\n    new Thing('123', 'baz'),\n]);\n\nclass Foo\n{\n    /**\n     * @var array<mixed, string>\n     */\n    public array $map = [];\n\n    /**\n     * @param Thing[] $things\n     */\n    public function __construct(array $things)\n    {\n        foreach ($things as $thing) {\n            $this->map[$thing->name] = $thing->value;\n        }\n\n        // map may now contain some string keys and some int keys\n\n        foreach ($this->map as $key => $value) {\n            // $key may be an int, but Psalm fails to produce the error it does inside useMap()\n            echo strlen($key);\n        }\n\n        $this->useMap();\n    }\n\n    public function useMap(): void\n    {\n        foreach ($this->map as $key => $value) {\n            // this line correctly causes an error\n            echo strlen($key); // MixedArgumentTypeCoercion: Argument 1 of strlen expects string, parent type of array-key provided\n\n            // this line incorrectly says the cast is redundant\n            echo strlen((string) $key); // RedundantCast: Redundant cast to string\n        }\n    }\n}\n```\n\n```\nPsalm output (using commit 4a0e2f5):\n\nINFO: MixedArgumentTypeCoercion - 39:25 - Argument 1 of strlen expects string, parent type array-key provided\n\nINFO: UnusedVariable - 37:40 - $value is never referenced or the value is not used\n\nINFO: MixedArgumentTypeCoercion - 49:25 - Argument 1 of strlen expects string, parent type array-key provided\n\nINFO: UnusedVariable - 47:40 - $value is never referenced or the value is not used\n```\n</details>\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/738964156/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"psalm-github-bot[bot]","id":58627613,"node_id":"MDM6Qm90NTg2Mjc2MTM=","avatar_url":"https://avatars.githubusercontent.com/in/48546?v=4","gravatar_id":"","url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D","html_url":"https://github.com/apps/psalm-github-bot","followers_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/followers","following_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/repos","events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/739011355","html_url":"https://github.com/vimeo/psalm/issues/4778#issuecomment-739011355","issue_url":"https://api.github.com/repos/vimeo/psalm/issues/4778","id":739011355,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTAxMTM1NQ==","user":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-04T20:47:32Z","updated_at":"2020-12-04T20:47:32Z","body":"Everything Psalm is saying here is correct.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/739011355/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":1,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4074414102,"node_id":"MDExOkNsb3NlZEV2ZW50NDA3NDQxNDEwMg==","url":"https://api.github.com/repos/vimeo/psalm/issues/events/4074414102","actor":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-12-04T20:47:32Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/739011839","html_url":"https://github.com/vimeo/psalm/issues/4778#issuecomment-739011839","issue_url":"https://api.github.com/repos/vimeo/psalm/issues/4778","id":739011839,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTAxMTgzOQ==","user":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-04T20:48:34Z","updated_at":"2020-12-04T20:48:34Z","body":"When you have `declare(strict_types=1)` on, PHP will exit with a type error if the type is incorrect. Therefore any statements _after_ that one must assume the type is correct.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/739011839/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/739012268","html_url":"https://github.com/vimeo/psalm/issues/4778#issuecomment-739012268","issue_url":"https://api.github.com/repos/vimeo/psalm/issues/4778","id":739012268,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTAxMjI2OA==","user":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-04T20:49:25Z","updated_at":"2020-12-04T20:49:25Z","body":"oh but the `array-key` redundant cast is an actual bug, sorry","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/739012268/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4074420192,"node_id":"MDEzOlJlb3BlbmVkRXZlbnQ0MDc0NDIwMTky","url":"https://api.github.com/repos/vimeo/psalm/issues/events/4074420192","actor":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"reopened","commit_id":null,"commit_url":null,"created_at":"2020-12-04T20:49:25Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/739013786","html_url":"https://github.com/vimeo/psalm/issues/4778#issuecomment-739013786","issue_url":"https://api.github.com/repos/vimeo/psalm/issues/4778","id":739013786,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTAxMzc4Ng==","user":{"login":"orklah","id":9605520,"node_id":"MDQ6VXNlcjk2MDU1MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9605520?v=4","gravatar_id":"","url":"https://api.github.com/users/orklah","html_url":"https://github.com/orklah","followers_url":"https://api.github.com/users/orklah/followers","following_url":"https://api.github.com/users/orklah/following{/other_user}","gists_url":"https://api.github.com/users/orklah/gists{/gist_id}","starred_url":"https://api.github.com/users/orklah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/orklah/subscriptions","organizations_url":"https://api.github.com/users/orklah/orgs","repos_url":"https://api.github.com/users/orklah/repos","events_url":"https://api.github.com/users/orklah/events{/privacy}","received_events_url":"https://api.github.com/users/orklah/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-04T20:52:21Z","updated_at":"2020-12-04T20:52:21Z","body":"This redundantCast is also problematic because it's needed to avoid a TypeError in strict_types\r\nhttps://psalm.dev/r/71609264b3","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/739013786/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"orklah","id":9605520,"node_id":"MDQ6VXNlcjk2MDU1MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9605520?v=4","gravatar_id":"","url":"https://api.github.com/users/orklah","html_url":"https://github.com/orklah","followers_url":"https://api.github.com/users/orklah/followers","following_url":"https://api.github.com/users/orklah/following{/other_user}","gists_url":"https://api.github.com/users/orklah/gists{/gist_id}","starred_url":"https://api.github.com/users/orklah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/orklah/subscriptions","organizations_url":"https://api.github.com/users/orklah/orgs","repos_url":"https://api.github.com/users/orklah/repos","events_url":"https://api.github.com/users/orklah/events{/privacy}","received_events_url":"https://api.github.com/users/orklah/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/739013818","html_url":"https://github.com/vimeo/psalm/issues/4778#issuecomment-739013818","issue_url":"https://api.github.com/repos/vimeo/psalm/issues/4778","id":739013818,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTAxMzgxOA==","user":{"login":"psalm-github-bot[bot]","id":58627613,"node_id":"MDM6Qm90NTg2Mjc2MTM=","avatar_url":"https://avatars.githubusercontent.com/in/48546?v=4","gravatar_id":"","url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D","html_url":"https://github.com/apps/psalm-github-bot","followers_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/followers","following_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/repos","events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2020-12-04T20:52:24Z","updated_at":"2020-12-04T20:52:24Z","body":"I found these snippets:\n<details>\n<summary>https://psalm.dev/r/71609264b3</summary>\n\n```php\n<?php\n\ndeclare(strict_types=1);\n\nclass Thing\n{\n    public function __construct(\n        public string $name,\n        public string $value,\n    ) {}\n}\n\nnew Foo([\n    new Thing('foo', 'bar'),\n    // Foo::__construct will cause the string '123' to end up as an int array key\n    new Thing('123', 'baz'),\n]);\n\nclass Foo\n{\n    /**\n     * @var array<mixed, string>\n     */\n    public array $map;\n\n    /**\n     * @param Thing[] $things\n     */\n    public function __construct(array $things)\n    {\n        $this->map = [];\n\n        foreach ($things as $thing) {\n            $this->map[$thing->name] = $thing->value;\n        }\n\n        // map may now contain some string keys and some int keys\n\n        foreach ($this->map as $key => $value) {\n            // $key may be an int, but Psalm fails to produce the error it does inside useMap()\n            echo strlen((string)$key);\n        }\n    }\n}\n```\n\n```\nPsalm output (using commit 3f15579):\n\nERROR: RedundantCast - 41:25 - Redundant cast to string\n\nINFO: UnusedVariable - 39:40 - $value is never referenced or the value is not used\n```\n</details>\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/739013818/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"psalm-github-bot[bot]","id":58627613,"node_id":"MDM6Qm90NTg2Mjc2MTM=","avatar_url":"https://avatars.githubusercontent.com/in/48546?v=4","gravatar_id":"","url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D","html_url":"https://github.com/apps/psalm-github-bot","followers_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/followers","following_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/repos","events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false}},{"id":4074433942,"node_id":"MDEyOkxhYmVsZWRFdmVudDQwNzQ0MzM5NDI=","url":"https://api.github.com/repos/vimeo/psalm/issues/events/4074433942","actor":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-12-04T20:53:37Z","label":{"name":"bug","color":"ee0701"},"performed_via_github_app":null},{"id":4076745696,"node_id":"MDExOkNsb3NlZEV2ZW50NDA3Njc0NTY5Ng==","url":"https://api.github.com/repos/vimeo/psalm/issues/events/4076745696","actor":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"4d1aae43f9717baf12cf9b3a3618550490e41876","commit_url":"https://api.github.com/repos/vimeo/psalm/commits/4d1aae43f9717baf12cf9b3a3618550490e41876","created_at":"2020-12-06T16:08:04Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/739529290","html_url":"https://github.com/vimeo/psalm/issues/4778#issuecomment-739529290","issue_url":"https://api.github.com/repos/vimeo/psalm/issues/4778","id":739529290,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTUyOTI5MA==","user":{"login":"theodorejb","id":3053271,"node_id":"MDQ6VXNlcjMwNTMyNzE=","avatar_url":"https://avatars.githubusercontent.com/u/3053271?v=4","gravatar_id":"","url":"https://api.github.com/users/theodorejb","html_url":"https://github.com/theodorejb","followers_url":"https://api.github.com/users/theodorejb/followers","following_url":"https://api.github.com/users/theodorejb/following{/other_user}","gists_url":"https://api.github.com/users/theodorejb/gists{/gist_id}","starred_url":"https://api.github.com/users/theodorejb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/theodorejb/subscriptions","organizations_url":"https://api.github.com/users/theodorejb/orgs","repos_url":"https://api.github.com/users/theodorejb/repos","events_url":"https://api.github.com/users/theodorejb/events{/privacy}","received_events_url":"https://api.github.com/users/theodorejb/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-06T16:47:02Z","updated_at":"2020-12-06T16:47:02Z","body":"@muglug Thank you for all your work on this project and for fixing the redundant cast bug.\r\n\r\n> On __construct method, Psalm considers `$this->map` as an `array<string, string>` so there's no error displayed.\r\n\r\nShouldn't this be considered a bug? `$this->map` was declared as `array<mixed, string>`, so I would expect the constructor to respect this and not require me to duplicate the type when assigning to `$this->map`.\r\n\r\nIt seems like what's happening is that Psalm sees that the array keys are only populated with values of type `string`, and it incorrectly assumes that this means the array only contains string keys (which isn't the case since values like `'123'` become integer keys). The outcome is that there's a hidden bug which is unlikely to be caught during development, and only manifests later as a TypeError in production once a `Thing` happens to be constructed with a numeric name.\r\n\r\nhttps://psalm.dev/r/3adce1cc53","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/739529290/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"theodorejb","id":3053271,"node_id":"MDQ6VXNlcjMwNTMyNzE=","avatar_url":"https://avatars.githubusercontent.com/u/3053271?v=4","gravatar_id":"","url":"https://api.github.com/users/theodorejb","html_url":"https://github.com/theodorejb","followers_url":"https://api.github.com/users/theodorejb/followers","following_url":"https://api.github.com/users/theodorejb/following{/other_user}","gists_url":"https://api.github.com/users/theodorejb/gists{/gist_id}","starred_url":"https://api.github.com/users/theodorejb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/theodorejb/subscriptions","organizations_url":"https://api.github.com/users/theodorejb/orgs","repos_url":"https://api.github.com/users/theodorejb/repos","events_url":"https://api.github.com/users/theodorejb/events{/privacy}","received_events_url":"https://api.github.com/users/theodorejb/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4076781485,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDA3Njc4MTQ4NQ==","url":"https://api.github.com/repos/vimeo/psalm/issues/events/4076781485","actor":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-12-06T16:47:02Z","performed_via_github_app":null},{"id":4076781487,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQwNzY3ODE0ODc=","url":"https://api.github.com/repos/vimeo/psalm/issues/events/4076781487","actor":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-12-06T16:47:02Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/739529296","html_url":"https://github.com/vimeo/psalm/issues/4778#issuecomment-739529296","issue_url":"https://api.github.com/repos/vimeo/psalm/issues/4778","id":739529296,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTUyOTI5Ng==","user":{"login":"psalm-github-bot[bot]","id":58627613,"node_id":"MDM6Qm90NTg2Mjc2MTM=","avatar_url":"https://avatars.githubusercontent.com/in/48546?v=4","gravatar_id":"","url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D","html_url":"https://github.com/apps/psalm-github-bot","followers_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/followers","following_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/repos","events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2020-12-06T16:47:05Z","updated_at":"2020-12-06T16:47:05Z","body":"I found these snippets:\n<details>\n<summary>https://psalm.dev/r/3adce1cc53</summary>\n\n```php\n<?php\n\ndeclare(strict_types=1);\n\nclass Thing\n{\n    public function __construct(\n        public string $name,\n        public string $value,\n    ) {}\n}\n\nnew Foo([\n    new Thing('foo', 'bar'),\n    // Foo::__construct will cause the string '123' to end up as an int array key\n    new Thing('123', 'baz'),\n]);\n\nclass Foo\n{\n    /**\n     * @var array<mixed, string>\n     */\n    public array $map;\n\n    /**\n     * @param Thing[] $things\n     */\n    public function __construct(array $things)\n    {\n        $this->map = [];\n\n        foreach ($things as $thing) {\n            $this->map[$thing->name] = $thing->value;\n        }\n\n        // map may now contain some string keys and some int keys\n\n        foreach ($this->map as $key => $value) {\n            // $key may be an int, but Psalm fails to detect this, resulting in a TypeError at runtime\n            echo strlen($key);\n        }\n    }\n}\n```\n\n```\nPsalm output (using commit 373c0bb):\n\nINFO: UnusedVariable - 39:40 - $value is never referenced or the value is not used\n```\n</details>\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/739529296/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"psalm-github-bot[bot]","id":58627613,"node_id":"MDM6Qm90NTg2Mjc2MTM=","avatar_url":"https://avatars.githubusercontent.com/in/48546?v=4","gravatar_id":"","url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D","html_url":"https://github.com/apps/psalm-github-bot","followers_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/followers","following_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/repos","events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/psalm-github-bot%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/739529987","html_url":"https://github.com/vimeo/psalm/issues/4778#issuecomment-739529987","issue_url":"https://api.github.com/repos/vimeo/psalm/issues/4778","id":739529987,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTUyOTk4Nw==","user":{"login":"orklah","id":9605520,"node_id":"MDQ6VXNlcjk2MDU1MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9605520?v=4","gravatar_id":"","url":"https://api.github.com/users/orklah","html_url":"https://github.com/orklah","followers_url":"https://api.github.com/users/orklah/followers","following_url":"https://api.github.com/users/orklah/following{/other_user}","gists_url":"https://api.github.com/users/orklah/gists{/gist_id}","starred_url":"https://api.github.com/users/orklah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/orklah/subscriptions","organizations_url":"https://api.github.com/users/orklah/orgs","repos_url":"https://api.github.com/users/orklah/repos","events_url":"https://api.github.com/users/orklah/events{/privacy}","received_events_url":"https://api.github.com/users/orklah/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-06T16:51:54Z","updated_at":"2020-12-06T16:51:54Z","body":"I proposed something to handle this issue a few month ago: https://github.com/vimeo/psalm/pull/4237.\r\n\r\nHowever, this is something that will probably have a lot of false positives (almost every string array-key is potentially problematic) for only a few actual bug caught","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/739529987/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"orklah","id":9605520,"node_id":"MDQ6VXNlcjk2MDU1MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9605520?v=4","gravatar_id":"","url":"https://api.github.com/users/orklah","html_url":"https://github.com/orklah","followers_url":"https://api.github.com/users/orklah/followers","following_url":"https://api.github.com/users/orklah/following{/other_user}","gists_url":"https://api.github.com/users/orklah/gists{/gist_id}","starred_url":"https://api.github.com/users/orklah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/orklah/subscriptions","organizations_url":"https://api.github.com/users/orklah/orgs","repos_url":"https://api.github.com/users/orklah/repos","events_url":"https://api.github.com/users/orklah/events{/privacy}","received_events_url":"https://api.github.com/users/orklah/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/739531802","html_url":"https://github.com/vimeo/psalm/issues/4778#issuecomment-739531802","issue_url":"https://api.github.com/repos/vimeo/psalm/issues/4778","id":739531802,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTUzMTgwMg==","user":{"login":"theodorejb","id":3053271,"node_id":"MDQ6VXNlcjMwNTMyNzE=","avatar_url":"https://avatars.githubusercontent.com/u/3053271?v=4","gravatar_id":"","url":"https://api.github.com/users/theodorejb","html_url":"https://github.com/theodorejb","followers_url":"https://api.github.com/users/theodorejb/followers","following_url":"https://api.github.com/users/theodorejb/following{/other_user}","gists_url":"https://api.github.com/users/theodorejb/gists{/gist_id}","starred_url":"https://api.github.com/users/theodorejb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/theodorejb/subscriptions","organizations_url":"https://api.github.com/users/theodorejb/orgs","repos_url":"https://api.github.com/users/theodorejb/repos","events_url":"https://api.github.com/users/theodorejb/events{/privacy}","received_events_url":"https://api.github.com/users/theodorejb/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-06T17:03:46Z","updated_at":"2020-12-06T17:03:46Z","body":"@orklah Maybe as you proposed in that PR a check for this would only be activated at level 1 with strict_types enabled. I think there are a lot of legitimate bugs this could catch, which people just haven't noticed since most of the time their data *happens* to not contain integer strings.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/739531802/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"theodorejb","id":3053271,"node_id":"MDQ6VXNlcjMwNTMyNzE=","avatar_url":"https://avatars.githubusercontent.com/u/3053271?v=4","gravatar_id":"","url":"https://api.github.com/users/theodorejb","html_url":"https://github.com/theodorejb","followers_url":"https://api.github.com/users/theodorejb/followers","following_url":"https://api.github.com/users/theodorejb/following{/other_user}","gists_url":"https://api.github.com/users/theodorejb/gists{/gist_id}","starred_url":"https://api.github.com/users/theodorejb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/theodorejb/subscriptions","organizations_url":"https://api.github.com/users/theodorejb/orgs","repos_url":"https://api.github.com/users/theodorejb/repos","events_url":"https://api.github.com/users/theodorejb/events{/privacy}","received_events_url":"https://api.github.com/users/theodorejb/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4076798940,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDA3Njc5ODk0MA==","url":"https://api.github.com/repos/vimeo/psalm/issues/events/4076798940","actor":{"login":"orklah","id":9605520,"node_id":"MDQ6VXNlcjk2MDU1MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9605520?v=4","gravatar_id":"","url":"https://api.github.com/users/orklah","html_url":"https://github.com/orklah","followers_url":"https://api.github.com/users/orklah/followers","following_url":"https://api.github.com/users/orklah/following{/other_user}","gists_url":"https://api.github.com/users/orklah/gists{/gist_id}","starred_url":"https://api.github.com/users/orklah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/orklah/subscriptions","organizations_url":"https://api.github.com/users/orklah/orgs","repos_url":"https://api.github.com/users/orklah/repos","events_url":"https://api.github.com/users/orklah/events{/privacy}","received_events_url":"https://api.github.com/users/orklah/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-12-06T17:03:46Z","performed_via_github_app":null},{"id":4076798941,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQwNzY3OTg5NDE=","url":"https://api.github.com/repos/vimeo/psalm/issues/events/4076798941","actor":{"login":"orklah","id":9605520,"node_id":"MDQ6VXNlcjk2MDU1MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9605520?v=4","gravatar_id":"","url":"https://api.github.com/users/orklah","html_url":"https://github.com/orklah","followers_url":"https://api.github.com/users/orklah/followers","following_url":"https://api.github.com/users/orklah/following{/other_user}","gists_url":"https://api.github.com/users/orklah/gists{/gist_id}","starred_url":"https://api.github.com/users/orklah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/orklah/subscriptions","organizations_url":"https://api.github.com/users/orklah/orgs","repos_url":"https://api.github.com/users/orklah/repos","events_url":"https://api.github.com/users/orklah/events{/privacy}","received_events_url":"https://api.github.com/users/orklah/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-12-06T17:03:46Z","performed_via_github_app":null},{"id":4265552094,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQyNjU1NTIwOTQ=","url":"https://api.github.com/repos/vimeo/psalm/issues/events/4265552094","actor":{"login":"danog","id":7339644,"node_id":"MDQ6VXNlcjczMzk2NDQ=","avatar_url":"https://avatars.githubusercontent.com/u/7339644?v=4","gravatar_id":"","url":"https://api.github.com/users/danog","html_url":"https://github.com/danog","followers_url":"https://api.github.com/users/danog/followers","following_url":"https://api.github.com/users/danog/following{/other_user}","gists_url":"https://api.github.com/users/danog/gists{/gist_id}","starred_url":"https://api.github.com/users/danog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danog/subscriptions","organizations_url":"https://api.github.com/users/danog/orgs","repos_url":"https://api.github.com/users/danog/repos","events_url":"https://api.github.com/users/danog/events{/privacy}","received_events_url":"https://api.github.com/users/danog/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"a5408aafc977f7c9475b170c0952f7b9a2bd600a","commit_url":"https://api.github.com/repos/danog/psalm/commits/a5408aafc977f7c9475b170c0952f7b9a2bd600a","created_at":"2021-01-29T10:48:50Z","performed_via_github_app":null}]