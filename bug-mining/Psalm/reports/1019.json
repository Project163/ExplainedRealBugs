{"url":"https://api.github.com/repos/vimeo/psalm/issues/4829","repository_url":"https://api.github.com/repos/vimeo/psalm","labels_url":"https://api.github.com/repos/vimeo/psalm/issues/4829/labels{/name}","comments_url":"https://api.github.com/repos/vimeo/psalm/issues/4829/comments","events_url":"https://api.github.com/repos/vimeo/psalm/issues/4829/events","html_url":"https://github.com/vimeo/psalm/issues/4829","id":762119887,"node_id":"MDU6SXNzdWU3NjIxMTk4ODc=","number":4829,"title":"Crash with symfony/mailer when class does not exist","user":{"login":"asgrim","id":496145,"node_id":"MDQ6VXNlcjQ5NjE0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/496145?v=4","gravatar_id":"","url":"https://api.github.com/users/asgrim","html_url":"https://github.com/asgrim","followers_url":"https://api.github.com/users/asgrim/followers","following_url":"https://api.github.com/users/asgrim/following{/other_user}","gists_url":"https://api.github.com/users/asgrim/gists{/gist_id}","starred_url":"https://api.github.com/users/asgrim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/asgrim/subscriptions","organizations_url":"https://api.github.com/users/asgrim/orgs","repos_url":"https://api.github.com/users/asgrim/repos","events_url":"https://api.github.com/users/asgrim/events{/privacy}","received_events_url":"https://api.github.com/users/asgrim/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":486061586,"node_id":"MDU6TGFiZWw0ODYwNjE1ODY=","url":"https://api.github.com/repos/vimeo/psalm/labels/bug","name":"bug","color":"ee0701","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2020-12-11T09:14:23Z","updated_at":"2020-12-11T15:10:32Z","closed_at":"2020-12-11T15:04:40Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Using the latest Psalm version, Psalm execution is crashing on a codebase I'm trying to run it on:\r\n\r\n```\r\n░░░░░░░░░░░░░EEEEEEEEEEEEEEEEEEEEE░░░EEEE░░EEEEEEE░EEE░EEEEE  60 / 227 (26%)\r\nEE░░░E░EEEE░░░EEEEEEE░EE░EEEEEEE░░░E░░EEEEEEEEEEEEE░EEEEEEEE 120 / 227 (52%)\r\n░EE░░EEEE░░░EEEE░EE░E░░E░EE░░░EEEEEEEE░░░░EE░EEEEE░E░E░░EEEE 180 / 227 (79%)\r\nEE░EE░E░EEEEEE░░░░░E░░EEE░░░EE░Uncaught Exception: Could not get class storage for symfony\\component\\mailer\\bridge\\sendinblue\\transport\\sendinbluetransportfactory\r\nStack trace in the forked worker:\r\n#0 /path/to/project/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/Expression/YieldAnalyzer.php(145): Psalm\\Internal\\Provider\\ClassLikeStorageProvider->get()\r\n#1 /path/to/project/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(370): Psalm\\Internal\\Analyzer\\Statements\\Expression\\YieldAnalyzer::analyze()\r\n#2 /path/to/project/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/Statements/ExpressionAnalyzer.php(39): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::handleExpression()\r\n#3 /path/to/project/vendor/vimeo/psalm/src/Psalm/Internal/Analyzer/StatementsAnalyzer.php(522): Psalm\\Internal\\Analyzer\\Statements\\ExpressionAnalyzer::analyze()\r\n<...snip...>\r\n#5 /path/to/project/vendor/vimeo/psalm/psalm(2): require_once('...')\r\n#6 {main}\r\n(Psalm 4.3.1@2feba22a005a18bf31d4c7b9bdb9252c73897476 crashed due to an uncaught Throwable)\r\n```\r\n\r\nI *think* judging by the top of the stack, it is a `yield` statement, and with that class, it is coming from the following block in `symfony/mailer` package (which is used):\r\n\r\nhttps://github.com/symfony/mailer/blob/f30fe13d4c9049f3c1f63be2c7f580779b058522/Transport.php#L159-L163\r\n```php\r\n        foreach (self::FACTORY_CLASSES as $factoryClass) {\r\n            if (class_exists($factoryClass)) {\r\n                yield new $factoryClass($dispatcher, $client, $logger);\r\n            }\r\n        }\r\n```\r\n\r\nI wondered if `psalm/symfony-plugin` might have stubs for this missing class, but no joy. I also don't really understand why it doesn't crash on any of the other missing classes in that `self::FACTORY_CLASSES`:\r\n\r\n```php\r\n    private const FACTORY_CLASSES = [\r\n        SesTransportFactory::class,\r\n        GmailTransportFactory::class,\r\n        MandrillTransportFactory::class,\r\n        MailgunTransportFactory::class,\r\n        PostmarkTransportFactory::class,\r\n        SendgridTransportFactory::class,\r\n        MailjetTransportFactory::class,\r\n        SendinblueTransportFactory::class,\r\n    ];\r\n```\r\n\r\nJust to be clear, the project is not actually using `Symfony\\Component\\Mailer\\Bridge\\Sendinblue\\Transport\\SendinblueTransportFactory`, so the package where that class resides (presumably `symfony/sendinblue-mailer`) is not installed.\r\n\r\nUnsure of the workaround here, since this is vendor code, I'm not sure how to tell Psalm to ignore that the class does not exist etc.\r\n\r\nIf it's any help, my Psalm configuration is:\r\n\r\n```xml\r\n<?xml version=\"1.0\"?>\r\n<psalm\r\n    errorLevel=\"1\"\r\n    resolveFromConfigFile=\"true\"\r\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n    xmlns=\"https://getpsalm.org/schema/config\"\r\n    xsi:schemaLocation=\"https://getpsalm.org/schema/config vendor/vimeo/psalm/config.xsd\"\r\n>\r\n    <projectFiles>\r\n        <directory name=\"src\"/>\r\n        <ignoreFiles>\r\n            <directory name=\"vendor\"/>\r\n        </ignoreFiles>\r\n    </projectFiles>\r\n    <plugins>\r\n        <pluginClass class=\"Psalm\\SymfonyPsalmPlugin\\Plugin\">\r\n            <containerXml>var/cache/dev/App_KernelDevDebugContainer.xml</containerXml>\r\n        </pluginClass>\r\n    </plugins>\r\n</psalm>\r\n```","closed_by":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/4829/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vimeo/psalm/issues/4829/timeline","performed_via_github_app":null,"state_reason":"completed"}