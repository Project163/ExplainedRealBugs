[{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/569333046","html_url":"https://github.com/vimeo/psalm/issues/2515#issuecomment-569333046","issue_url":"https://api.github.com/repos/vimeo/psalm/issues/2515","id":569333046,"node_id":"MDEyOklzc3VlQ29tbWVudDU2OTMzMzA0Ng==","user":{"login":"weirdan","id":57403,"node_id":"MDQ6VXNlcjU3NDAz","avatar_url":"https://avatars.githubusercontent.com/u/57403?v=4","gravatar_id":"","url":"https://api.github.com/users/weirdan","html_url":"https://github.com/weirdan","followers_url":"https://api.github.com/users/weirdan/followers","following_url":"https://api.github.com/users/weirdan/following{/other_user}","gists_url":"https://api.github.com/users/weirdan/gists{/gist_id}","starred_url":"https://api.github.com/users/weirdan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weirdan/subscriptions","organizations_url":"https://api.github.com/users/weirdan/orgs","repos_url":"https://api.github.com/users/weirdan/repos","events_url":"https://api.github.com/users/weirdan/events{/privacy}","received_events_url":"https://api.github.com/users/weirdan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-12-27T19:41:04Z","updated_at":"2019-12-27T19:41:04Z","body":"It's a bit longer, but yes, you can rewrite the code using intermediate variables so there's no need to memoize the method call results:\r\n```php\r\n<?php\r\n  class Assessment {\r\n     public function getAttributeRoot(): ?string {\r\n       return rand(0, 1) ? 'root' : null;\r\n     }\r\n  }\r\n  class Project {\r\n     public function getAssessment(): ?Assessment {\r\n       return rand(0, 1) ? new Assessment : null;\r\n     }\r\n  }\r\n\r\nfunction f(Project $project): int {\r\n  $assessment = $project->getAssessment();\r\n  if (is_null($assessment)) {\r\n    throw new RuntimeException('no assessment');\r\n  }\r\n  \r\n  $attributeRoot = $assessment->getAttributeRoot();\r\n  if (is_null($attributeRoot)) {\r\n    throw new RuntimeException('no attribute root');\r\n  }\r\n  \r\n  return strlen($attributeRoot);\r\n}\r\n```\r\nhttps://psalm.dev/r/1efae3f536","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/569333046/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"weirdan","id":57403,"node_id":"MDQ6VXNlcjU3NDAz","avatar_url":"https://avatars.githubusercontent.com/u/57403?v=4","gravatar_id":"","url":"https://api.github.com/users/weirdan","html_url":"https://github.com/weirdan","followers_url":"https://api.github.com/users/weirdan/followers","following_url":"https://api.github.com/users/weirdan/following{/other_user}","gists_url":"https://api.github.com/users/weirdan/gists{/gist_id}","starred_url":"https://api.github.com/users/weirdan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weirdan/subscriptions","organizations_url":"https://api.github.com/users/weirdan/orgs","repos_url":"https://api.github.com/users/weirdan/repos","events_url":"https://api.github.com/users/weirdan/events{/privacy}","received_events_url":"https://api.github.com/users/weirdan/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":2911326569,"node_id":"MDEyOkxhYmVsZWRFdmVudDI5MTEzMjY1Njk=","url":"https://api.github.com/repos/vimeo/psalm/issues/events/2911326569","actor":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-12-27T20:49:02Z","label":{"name":"bug","color":"ee0701"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/569343315","html_url":"https://github.com/vimeo/psalm/issues/2515#issuecomment-569343315","issue_url":"https://api.github.com/repos/vimeo/psalm/issues/2515","id":569343315,"node_id":"MDEyOklzc3VlQ29tbWVudDU2OTM0MzMxNQ==","user":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-12-27T20:49:05Z","updated_at":"2019-12-27T20:49:05Z","body":"This should definitely work:\r\n\r\n```php\r\n<?php\r\nclass Assessment {\r\n    private ?string $root = null;\r\n  \r\n    /** @psalm-mutation-free */\r\n    public function getRoot(): ?string {\r\n        return $this->root;\r\n    }\r\n}\r\n\r\nclass Project {\r\n    private ?Assessment $assessment = null;\r\n  \r\n    /** @psalm-mutation-free */\r\n    public function getAssessment(): ?Assessment {\r\n        return $this->assessment;\r\n    }\r\n}\r\n\r\nfunction f(Project $project): int {\r\n    if (($project->getAssessment() === null)\r\n        || ($project->getAssessment()->getRoot() !== null)\r\n    ) {\r\n        throw new RuntimeException('no assessment');\r\n    }\r\n  \r\n    return strlen($project->getAssessment()->getRoot());\r\n}\r\n```\r\n\r\nhttps://psalm.dev/r/531c4ad15b","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/569343315/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":2911386162,"node_id":"MDExOkNsb3NlZEV2ZW50MjkxMTM4NjE2Mg==","url":"https://api.github.com/repos/vimeo/psalm/issues/events/2911386162","actor":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"982fe627e0bd1c7ce2b697d97745fa0863b0d38d","commit_url":"https://api.github.com/repos/vimeo/psalm/commits/982fe627e0bd1c7ce2b697d97745fa0863b0d38d","created_at":"2019-12-27T21:45:00Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/569352548","html_url":"https://github.com/vimeo/psalm/issues/2515#issuecomment-569352548","issue_url":"https://api.github.com/repos/vimeo/psalm/issues/2515","id":569352548,"node_id":"MDEyOklzc3VlQ29tbWVudDU2OTM1MjU0OA==","user":{"login":"mhitza","id":273079,"node_id":"MDQ6VXNlcjI3MzA3OQ==","avatar_url":"https://avatars.githubusercontent.com/u/273079?v=4","gravatar_id":"","url":"https://api.github.com/users/mhitza","html_url":"https://github.com/mhitza","followers_url":"https://api.github.com/users/mhitza/followers","following_url":"https://api.github.com/users/mhitza/following{/other_user}","gists_url":"https://api.github.com/users/mhitza/gists{/gist_id}","starred_url":"https://api.github.com/users/mhitza/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhitza/subscriptions","organizations_url":"https://api.github.com/users/mhitza/orgs","repos_url":"https://api.github.com/users/mhitza/repos","events_url":"https://api.github.com/users/mhitza/events{/privacy}","received_events_url":"https://api.github.com/users/mhitza/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-12-27T21:54:38Z","updated_at":"2019-12-27T21:54:38Z","body":"@muglug you're awesome, I can confirm it works with the latest master version and the `@psalm-mutation-free` annotation","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/comments/569352548/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mhitza","id":273079,"node_id":"MDQ6VXNlcjI3MzA3OQ==","avatar_url":"https://avatars.githubusercontent.com/u/273079?v=4","gravatar_id":"","url":"https://api.github.com/users/mhitza","html_url":"https://github.com/mhitza","followers_url":"https://api.github.com/users/mhitza/followers","following_url":"https://api.github.com/users/mhitza/following{/other_user}","gists_url":"https://api.github.com/users/mhitza/gists{/gist_id}","starred_url":"https://api.github.com/users/mhitza/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhitza/subscriptions","organizations_url":"https://api.github.com/users/mhitza/orgs","repos_url":"https://api.github.com/users/mhitza/repos","events_url":"https://api.github.com/users/mhitza/events{/privacy}","received_events_url":"https://api.github.com/users/mhitza/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":2911395923,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjkxMTM5NTkyMw==","url":"https://api.github.com/repos/vimeo/psalm/issues/events/2911395923","actor":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-12-27T21:54:38Z","performed_via_github_app":null},{"id":2911395924,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDI5MTEzOTU5MjQ=","url":"https://api.github.com/repos/vimeo/psalm/issues/events/2911395924","actor":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-12-27T21:54:38Z","performed_via_github_app":null}]