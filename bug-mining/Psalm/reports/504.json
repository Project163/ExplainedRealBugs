{"url":"https://api.github.com/repos/vimeo/psalm/issues/2804","repository_url":"https://api.github.com/repos/vimeo/psalm","labels_url":"https://api.github.com/repos/vimeo/psalm/issues/2804/labels{/name}","comments_url":"https://api.github.com/repos/vimeo/psalm/issues/2804/comments","events_url":"https://api.github.com/repos/vimeo/psalm/issues/2804/events","html_url":"https://github.com/vimeo/psalm/issues/2804","id":564495064,"node_id":"MDU6SXNzdWU1NjQ0OTUwNjQ=","number":2804,"title":"AfterFunctionCallAnalysisInterface::afterFunctionCallAnalysis is not called for every function call","user":{"login":"pilif","id":4990,"node_id":"MDQ6VXNlcjQ5OTA=","avatar_url":"https://avatars.githubusercontent.com/u/4990?v=4","gravatar_id":"","url":"https://api.github.com/users/pilif","html_url":"https://github.com/pilif","followers_url":"https://api.github.com/users/pilif/followers","following_url":"https://api.github.com/users/pilif/following{/other_user}","gists_url":"https://api.github.com/users/pilif/gists{/gist_id}","starred_url":"https://api.github.com/users/pilif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pilif/subscriptions","organizations_url":"https://api.github.com/users/pilif/orgs","repos_url":"https://api.github.com/users/pilif/repos","events_url":"https://api.github.com/users/pilif/events{/privacy}","received_events_url":"https://api.github.com/users/pilif/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2020-02-13T07:36:36Z","updated_at":"2020-02-13T14:13:52Z","closed_at":"2020-02-13T14:10:25Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When writing a plugin for our project that was using `AfterFunctionCallAnalysisInterface`, I noticed that the plugin method wasn't called for even close to all function calls in the body of analysis.\r\n\r\nOne condition for the plugin to not be called is if the function call in question is calling a function for which psalm knows it has issues.\r\n\r\nAnother condition is that the plugin is not called for some internal php library function (but not others).\r\n\r\nI've created a demo project in an empty branch of my clone here:\r\n\r\nhttps://github.com/pilif/psalm/tree/after-function\r\n\r\nThe project contains a pslam plugin that `var_dump()`s all `$function_id`s it gets called with.\r\n\r\nIn the initial commit in the demo project, I miss calls to \r\n\r\n* `fopen()`\r\n* `feof()`\r\n* `fgets()`\r\n* `generateTemplateStrings` (see later)\r\n* `array_map`\r\n*  the anonymous functoin\r\n\r\nhttps://github.com/pilif/psalm/blob/1661b330fd6aa3b22af2df97808bff412f34430c/src/demo.php#L10-L18\r\n\r\n`generateTemplateStrings()` is a function included in the project via demo2.php. Psalm has an issue with it because it's missing a return type declaration.\r\n\r\nEven after [base-lining the errors](https://github.com/pilif/psalm/commit/97de7dd1f6ac360f22057785203c21b89951071e), the logged output is still the same.\r\n\r\nHowever, after [fixing the function](https://github.com/pilif/psalm/commit/de2c98bc6c1a76677c0bae9fb9986f07af413dcd), now `afterFunctionCallAnalysis` is called for `generateTemplateStrings`.\r\n\r\nThis lead me to the conclusion that `afterFunctionCallAnalysis` is not called for functions plsam has issues with.\r\n\r\nHowever, that doesn't explain why `afterFunctionCallAnalysis` isn't called for most of the php standard library. \r\n\r\nIs this a documentation issue? Is there a hook to be called for *any* function call, not just a few specific ones from the standard library and those that don't have issues?\r\n","closed_by":{"login":"muglug","id":2292638,"node_id":"MDQ6VXNlcjIyOTI2Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/2292638?v=4","gravatar_id":"","url":"https://api.github.com/users/muglug","html_url":"https://github.com/muglug","followers_url":"https://api.github.com/users/muglug/followers","following_url":"https://api.github.com/users/muglug/following{/other_user}","gists_url":"https://api.github.com/users/muglug/gists{/gist_id}","starred_url":"https://api.github.com/users/muglug/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muglug/subscriptions","organizations_url":"https://api.github.com/users/muglug/orgs","repos_url":"https://api.github.com/users/muglug/repos","events_url":"https://api.github.com/users/muglug/events{/privacy}","received_events_url":"https://api.github.com/users/muglug/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/vimeo/psalm/issues/2804/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vimeo/psalm/issues/2804/timeline","performed_via_github_app":null,"state_reason":"completed"}