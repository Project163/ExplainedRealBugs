<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:50:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CLI-137] Change of behaviour 1.0 -&gt; 1.1</title>
                <link>https://issues.apache.org/jira/browse/CLI-137</link>
                <project id="12310463" key="CLI">Commons CLI</project>
                    <description>&lt;p&gt;The code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.cli.*;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Trial {

  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void execute (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] commandLine) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ParseException {
    Options options = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Options();
    options.addOption ( OptionBuilder.withLongOpt(&lt;span class=&quot;code-quote&quot;&gt;&quot;flob&quot;&lt;/span&gt;).hasArg().create(&lt;span class=&quot;code-quote&quot;&gt;&apos;F&apos;&lt;/span&gt;) );

    CommandLine line = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GnuParser().parse(options, commandLine);

    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] results = line.getOptionValues(&lt;span class=&quot;code-quote&quot;&gt;&apos;F&apos;&lt;/span&gt;);

    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( results != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ) { 
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ( &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s : results ) { 
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println( &lt;span class=&quot;code-quote&quot;&gt;&quot;-F &quot;&lt;/span&gt; + s );
      } 
    }

    results = line.getOptionValues(&lt;span class=&quot;code-quote&quot;&gt;&quot;flob&quot;&lt;/span&gt;) ;

    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( results != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ) { 
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ( &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s : results ) { 
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println( &lt;span class=&quot;code-quote&quot;&gt;&quot;--blah &quot;&lt;/span&gt; + s ); 
      }
    }

    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] theRest = line.getArgs() ;
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ( &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s : theRest ) { 
      &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.print( s + &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt; ); 
    }
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println();
  }

  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ParseException {
    Trial trial = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Trial() ;
    trial.execute ( &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] { &lt;span class=&quot;code-quote&quot;&gt;&quot;-F1&quot;&lt;/span&gt; , &lt;span class=&quot;code-quote&quot;&gt;&quot;-F3&quot;&lt;/span&gt; , &lt;span class=&quot;code-quote&quot;&gt;&quot;-Fbla&quot;&lt;/span&gt; , &lt;span class=&quot;code-quote&quot;&gt;&quot;-F 76&quot;&lt;/span&gt; , &lt;span class=&quot;code-quote&quot;&gt;&quot;--flob&quot;&lt;/span&gt; , &lt;span class=&quot;code-quote&quot;&gt;&quot;54&quot;&lt;/span&gt; } ) ;
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;when compiled and executed under 1.0 produces:&lt;/p&gt;

&lt;p&gt;trial:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; -F 1&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; -F 3&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; -F bla&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; -F  76&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; -F 54&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;However, when compiled and executed under 1.1 produces:&lt;/p&gt;

&lt;p&gt;trial:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; -F 1&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; --blah 1&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; 3 bla  76 54 &lt;/p&gt;
</description>
                <environment>&lt;p&gt;Ubuntu 7.04 Feisty Fawn (JDK 1.6.0) + Commons CLI 1.0 and 1.1&lt;/p&gt;</environment>
        <key id="12374325">CLI-137</key>
            <summary>Change of behaviour 1.0 -&gt; 1.1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="russel">Dr. Russel Winder</reporter>
                        <labels>
                    </labels>
                <created>Sun, 22 Jul 2007 07:25:11 +0000</created>
                <updated>Fri, 6 Feb 2009 06:59:43 +0000</updated>
                            <resolved>Fri, 13 Jun 2008 15:12:46 +0000</resolved>
                                    <version>1.1</version>
                                    <fixVersion>1.2</fixVersion>
                                    <component>CLI-1.x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12514577" author="brianegge" created="Mon, 23 Jul 2007 07:14:40 +0000"  >&lt;p&gt;In 1.1, the hasArg() set the number of expected values to &apos;1&apos;.  Apparently, in 1.0 it defaulted to unlimited.   You can get the previous behavior by changing the code like this:&lt;/p&gt;

&lt;p&gt;Option option = OptionBuilder.withLongOpt(&quot;flob&quot;).hasArgs().create(&apos;F&apos;);&lt;/p&gt;

&lt;p&gt;The output will then look like:&lt;br/&gt;
-F 1&lt;br/&gt;
-F 3&lt;br/&gt;
-F bla&lt;br/&gt;
-F  76&lt;br/&gt;
-F 54&lt;br/&gt;
--blah 1&lt;br/&gt;
--blah 3&lt;br/&gt;
--blah bla&lt;br/&gt;
--blah  76&lt;br/&gt;
--blah 54&lt;/p&gt;

&lt;p&gt;In 1.1, you can call getOptionValues by either the short name or the long name.  Since they are the same option, they return the same values.  &lt;/p&gt;

&lt;p&gt;hasArg expects a single value, while hasArgs allows unlimited values.  I think this behavior, although different, is what the original API has intended.  &lt;/p&gt;</comment>
                            <comment id="12515729" author="bayard" created="Thu, 26 Jul 2007 15:06:44 +0000"  >&lt;p&gt;Is this a viable workaround Russel?&lt;/p&gt;</comment>
                            <comment id="12515737" author="russel" created="Thu, 26 Jul 2007 15:27:21 +0000"  >&lt;p&gt;Yes and no.  There appear to be problems but it is not clear whether these are problems in the Groovy use of Commons CLI, or whether there are bugs in Commons CLI.  I am hesitant to report bugs in 1.0 since most are probably all removed in 1.1.  However, 1.1 is not working as it should with Groovy.  A bit of a chicken and egg situation.&lt;/p&gt;</comment>
                            <comment id="12571477" author="scogden" created="Fri, 22 Feb 2008 17:18:33 +0000"  >&lt;p&gt;This broke us as well.  We expected that an option may be repeated multiple times on the command line with the same semantics.  For example, assume that -F takes only one arg.  This was true in CLI 1.0 for every occurrence of -F.  We didn&apos;t want every arg to be lumped into a general -F bucket.  This allowed us to do this in 1.0:&lt;/p&gt;

&lt;p&gt;   trial -F 1 -F 2 -F 3 file1 file2&lt;/p&gt;

&lt;p&gt;and have the output be:&lt;/p&gt;

&lt;p&gt;   -F 1&lt;br/&gt;
   -F 2&lt;br/&gt;
   -F 3&lt;br/&gt;
   file1 file2&lt;/p&gt;

&lt;p&gt;not as it is now in 1.1:&lt;/p&gt;

&lt;p&gt;   -F 1&lt;br/&gt;
   file1 file2&lt;/p&gt;</comment>
                            <comment id="12596277" author="bayard" created="Tue, 13 May 2008 04:58:11 +0000"  >&lt;p&gt;It seems that this is a simple backwards compat issue. The default behaviour of Option/OptionBuilder mistakenly changed from hasArgs to hasArg. Now it&apos;s there - it&apos;s probably best to document this very clearly and mark this as wontfix.&lt;/p&gt;</comment>
                            <comment id="12600753" author="ebourg" created="Thu, 29 May 2008 12:09:42 +0000"  >&lt;p&gt;This bug seems to be a blocker for projects willing to upgrade from 1.0 to 1.1. Considering that the original behavior is right, and that the usage of CLI 1.0 &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; outweighs greatly the usage of CLI 1.1 &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;, I think we&apos;d better fix this. The recommended upgrade path would be 1.0-&amp;gt;1.2.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://mvnrepository.com/artifact/commons-cli/commons-cli/1.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mvnrepository.com/artifact/commons-cli/commons-cli/1.0&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://mvnrepository.com/artifact/commons-cli/commons-cli/1.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mvnrepository.com/artifact/commons-cli/commons-cli/1.1&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12600831" author="ebourg" created="Thu, 29 May 2008 16:46:56 +0000"  >&lt;p&gt;I misunderstood the issue, I tend to agree with Henri, the hasArg vs hasArgs semantic seems sensible, even if it breaks the compatibility with CLI 1.0. It should be properly documented, currently the 1.1 upgrade notes make no mention of this issue.&lt;/p&gt;

&lt;p&gt;Regarding the case suggested by Steve, it seems that with hasArgs() his example would return an array with &lt;span class=&quot;error&quot;&gt;&amp;#91;1, 2, 3&amp;#93;&lt;/span&gt; and not only 1, provided the getOptionValues() method is called instead of getOptionValue(), is this correct ?&lt;/p&gt;</comment>
                            <comment id="12600844" author="russel" created="Thu, 29 May 2008 17:23:16 +0000"  >&lt;p&gt;Someone reformated my code, it now looks really ugly &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;The problem is that the 1.1 implementation doesn&apos;t match the semantics specified, so you go and change all the code to the new semantics and you find you can&apos;t have multiple options and if you try it eats all the parameters whether they are options or not. &lt;/p&gt;</comment>
                            <comment id="12600852" author="scogden" created="Thu, 29 May 2008 17:42:05 +0000"  >&lt;p&gt;Source code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.cli.*;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.*;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestBed
{
   &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args_;

   &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; TestBed( &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args ) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception
   {
      args_ = args;
   }

   &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void cliTest() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception
   {
      Options options = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Options();
      Option option = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;

      option = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Option( &lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;alpha&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;comment&quot;&lt;/span&gt; );
      option.setRequired( &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; );
      option.setArgs( Option.UNLIMITED_VALUES );
      options.addOption( option );

      CommandLineParser parser = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GnuParser();
      CommandLine commandLine = parser.parse( options, args_ );
      
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ( Iterator iter = commandLine.iterator(); iter.hasNext(); )
      {
         Option opt = (Option)iter.next();
         &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt; id = (&lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt;)opt.getId();
         &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] values = opt.getValues();
         &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println( &lt;span class=&quot;code-quote&quot;&gt;&quot;values &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &quot;&lt;/span&gt; + opt );

         &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ( &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; ii = 0; ii &amp;lt; values.length; ii++ )
         {
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.print( values[ ii ] );

            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( ii &amp;lt; ( values.length - 1 ) )
            {
               &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.print( &lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt; );
            }
         }
         &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println();
      }
   }


   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main( &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args ) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Throwable
   {
      TestBed testBed = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TestBed( args );

      testBed.cliTest();
   }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Running with ant:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   &amp;lt;target name=&lt;span class=&quot;code-quote&quot;&gt;&quot;run&quot;&lt;/span&gt; depends=&lt;span class=&quot;code-quote&quot;&gt;&quot;jar&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;java classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;${main.class}&quot;&lt;/span&gt;
            fork=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;
         &amp;lt;jvmarg value=&lt;span class=&quot;code-quote&quot;&gt;&quot;-showversion&quot;&lt;/span&gt;/&amp;gt;
         &amp;lt;arg value=&lt;span class=&quot;code-quote&quot;&gt;&quot;-a 1&quot;&lt;/span&gt;/&amp;gt;
         &amp;lt;arg value=&lt;span class=&quot;code-quote&quot;&gt;&quot;-a 2&quot;&lt;/span&gt;/&amp;gt;
         &amp;lt;arg value=&lt;span class=&quot;code-quote&quot;&gt;&quot;-a 3&quot;&lt;/span&gt;/&amp;gt;
         &amp;lt;arg value=&lt;span class=&quot;code-quote&quot;&gt;&quot;-a 4&quot;&lt;/span&gt;/&amp;gt;
         &amp;lt;arg value=&lt;span class=&quot;code-quote&quot;&gt;&quot;-b x&quot;&lt;/span&gt;/&amp;gt;
         &amp;lt;arg value=&lt;span class=&quot;code-quote&quot;&gt;&quot;output/output.bin&quot;&lt;/span&gt;/&amp;gt;
         &amp;lt;classpath&amp;gt;
            &amp;lt;pathelement location=&lt;span class=&quot;code-quote&quot;&gt;&quot;${classes.dir}&quot;&lt;/span&gt;/&amp;gt;
            &amp;lt;fileset dir=&lt;span class=&quot;code-quote&quot;&gt;&quot;${cots.dir}&quot;&lt;/span&gt;&amp;gt;
               &amp;lt;include name=&lt;span class=&quot;code-quote&quot;&gt;&quot;*.jar&quot;&lt;/span&gt;/&amp;gt;
            &amp;lt;/fileset&amp;gt;
         &amp;lt;/classpath&amp;gt;
      &amp;lt;/java&amp;gt;
   &amp;lt;/target&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Produces this output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;===============================================================================
1.0:
===============================================================================
run:
     [java] java version &lt;span class=&quot;code-quote&quot;&gt;&quot;1.5.0_15&quot;&lt;/span&gt;
     [java] Java(TM) 2 &lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt; Environment, Standard Edition (build 1.5.0_15-b04)
     [java] Java HotSpot(TM) Server VM (build 1.5.0_15-b04, mixed mode)

     [java] values &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; [ option: a alpha  :: comment ]
     [java]  1
     [java] values &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; [ option: a alpha  :: comment ]
     [java]  4, -b x, output/output.bin
     [java] values &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; [ option: a alpha  :: comment ]
     [java]  3
     [java] values &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; [ option: a alpha  :: comment ]
     [java]  2

===============================================================================
1.1
===============================================================================
run:
     [java] java version &lt;span class=&quot;code-quote&quot;&gt;&quot;1.5.0_15&quot;&lt;/span&gt;
     [java] Java(TM) 2 &lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt; Environment, Standard Edition (build 1.5.0_15-b04)
     [java] Java HotSpot(TM) Server VM (build 1.5.0_15-b04, mixed mode)

     [java] values &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; [ option: a alpha +ARG :: comment ]
     [java]  1,  2,  3,  4, -b x, output/output.bin
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So it seems we can&apos;t have multiple instances of equivalent options when iterating.  The opt values get grouped into a single option instance.&lt;/p&gt;</comment>
                            <comment id="12600871" author="ebourg" created="Thu, 29 May 2008 18:36:03 +0000"  >&lt;p&gt;Sorry for the reformatting Russel, it was a bit compact for my eyes &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Steve, do you always use the option iterator to fetch the arguments from the CommandLine ? Or do you use getOptionValues() ? I&apos;m comparing the code in 1.0 and 1.1, if I understand well the result should be the same in both versions with getOptionValues(). But the output of iterator() is clearly not compatible.&lt;/p&gt;

&lt;p&gt;Why is it important to keep the repeated options isolated instead of grouping their values ? That looks equivalent to me. Unless you start having several values per option, and the number of values may vary. Something like :&lt;/p&gt;

&lt;p&gt;grantaccess --user scott admin --user tom --user dean manager&lt;/p&gt;

&lt;p&gt;This example can&apos;t be properly interpreted with CLI 1.1, it returns a list with the names and the roles and it&apos;s impossible to know what value is a name or a role because the number of values per option is not the same. It could be worked around by changing the format to --user name:role, but that&apos;s the only use case I can imagine that requires the original behavior of iterator().&lt;/p&gt;</comment>
                            <comment id="12600879" author="scogden" created="Thu, 29 May 2008 18:50:47 +0000"  >&lt;p&gt;Emmanuel, your example is very insightful.  We are actually spawning multiple processes and using a flag to pass values to them.  As for your questions, I don&apos;t know how to answer at the moment.  I&apos;ll need to do some more research.  This gives me ideas for work-arounds, though.&lt;/p&gt;</comment>
                            <comment id="12601753" author="ebourg" created="Mon, 2 Jun 2008 20:29:55 +0000"  >&lt;p&gt;Here is the patch I intend to apply, I put it here first for review. CommandLine not longer stores the options in a Set, and the parsers clone the options matched. The consequences are:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;CommandLine.iterator() may return the same option more than once, with different arguments. This is like CLI 1.0&lt;/li&gt;
	&lt;li&gt;the hasArgs( n ) semantic is &apos;n arguments per occurrence&apos;, and not &apos; n arguments for all occurrences&apos; of the option. This is like CLI 1.0&lt;/li&gt;
	&lt;li&gt;the option put in the Options instance before parsing the command line no longer receives any argument. The right way of querying the option is to use the CommandLine instance. (this breaks test15046() in BugsTest, but this isn&apos;t the purpose of this test)&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="12601765" author="sebb@apache.org" created="Mon, 2 Jun 2008 21:18:06 +0000"  >&lt;p&gt;Is there any merit in allowing both behaviours?&lt;/p&gt;

&lt;p&gt;I.e. revert the normal behaviour to 1.0 as per the patch, but have a flag (perhaps settable via a system property) that can be used to specify 1.1-compliant behaviour?&lt;/p&gt;

&lt;p&gt;It does not look like it would complicate the code hugely, but I could be wrong...&lt;/p&gt;

</comment>
                            <comment id="12601980" author="russel" created="Tue, 3 Jun 2008 15:46:43 +0000"  >&lt;p&gt;I have been trying to create a TestNG test program to try and determine what I think should work and what shouldn&apos;t.  Currently the single biggest problem I have with 1.2-SNAPSHOT (r662829) is exemplified by the test:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Test &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void multipleOptionsWithResidue_Posix ( ) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ParseException {
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Options options = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Options ( ) ;
    options.addOption (
                       OptionBuilder.withArgName ( &lt;span class=&quot;code-quote&quot;&gt;&quot;property=value&quot;&lt;/span&gt; )
                       .hasArgs ( )
                       .create ( &lt;span class=&quot;code-quote&quot;&gt;&quot;D&quot;&lt;/span&gt; ) ) ;
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; CommandLine line = posixParser.parse ( options , &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] { &lt;span class=&quot;code-quote&quot;&gt;&quot;-D&quot;&lt;/span&gt; , &lt;span class=&quot;code-quote&quot;&gt;&quot;x=2&quot;&lt;/span&gt; , &lt;span class=&quot;code-quote&quot;&gt;&quot;-Dz=1&quot;&lt;/span&gt; , &lt;span class=&quot;code-quote&quot;&gt;&quot;blah&quot;&lt;/span&gt; , &lt;span class=&quot;code-quote&quot;&gt;&quot;Flobadob&quot;&lt;/span&gt; } ) ;
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] strings = line.getOptionValues ( &lt;span class=&quot;code-quote&quot;&gt;&apos;D&apos;&lt;/span&gt; ) ;
    assertEquals ( strings.length , 2 ) ;
    assertEquals ( strings[0] , &lt;span class=&quot;code-quote&quot;&gt;&quot;x=2&quot;&lt;/span&gt; ) ;
    assertEquals ( strings[1] , &lt;span class=&quot;code-quote&quot;&gt;&quot;z=1&quot;&lt;/span&gt; ) ;
   &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; excess = line.getArgList ( ) ;
    assertEquals ( excess.size ( ) , 2 ) ;
    assertEquals ( excess.get ( 0 ) , &lt;span class=&quot;code-quote&quot;&gt;&quot;blah&quot;&lt;/span&gt; ) ;
    assertEquals ( excess.get ( 1 ) , &lt;span class=&quot;code-quote&quot;&gt;&quot;Flobadob&quot;&lt;/span&gt; ) ;
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This test fails:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.AssertionError: expected:&amp;lt;2&amp;gt; but was:&amp;lt;4&amp;gt;
	at org.testng.Assert.fail(Assert.java:84)
	at org.testng.Assert.failNotEquals(Assert.java:438)
	at org.testng.Assert.assertEquals(Assert.java:108)
	at org.testng.Assert.assertEquals(Assert.java:323)
	at org.testng.Assert.assertEquals(Assert.java:333)
	at CommonsCLI_1_1_Test.multipleOptionsWithResidue_Gnu(CommonsCLI_1_1_Test.java:141)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.testng.internal.MethodHelper.invokeMethod(MethodHelper.java:580)
	at org.testng.internal.Invoker.invokeMethod(Invoker.java:478)
	at org.testng.internal.Invoker.invokeTestMethod(Invoker.java:617)
	at org.testng.internal.Invoker.invokeTestMethods(Invoker.java:885)
	at org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:126)
	at org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:110)
	at org.testng.TestRunner.runWorkers(TestRunner.java:712)
	at org.testng.TestRunner.privateRun(TestRunner.java:582)
	at org.testng.TestRunner.run(TestRunner.java:477)
	at org.testng.SuiteRunner.runTest(SuiteRunner.java:324)
	at org.testng.SuiteRunner.runSequentially(SuiteRunner.java:319)
	at org.testng.SuiteRunner.privateRun(SuiteRunner.java:292)
	at org.testng.SuiteRunner.run(SuiteRunner.java:198)
	at org.testng.TestNG.createAndRunSuiteRunners(TestNG.java:821)
	at org.testng.TestNG.runSuitesLocally(TestNG.java:788)
	at org.testng.TestNG.run(TestNG.java:708)
	at org.testng.TestNG.privateMain(TestNG.java:858)
	at org.testng.TestNG.main(TestNG.java:831)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The -D option processing is collecting all parameters not just the ones with a -D.  The same result obtains with the GnuParser.&lt;/p&gt;</comment>
                            <comment id="12603529" author="ebourg" created="Mon, 9 Jun 2008 09:47:56 +0000"  >&lt;p&gt;I don&apos;t think it&apos;s worth supporting both behaviors, the vast majority of CLI users are still with the 1.0 version, and those using CLI 1.1 are unlikely to rely on this weird behavior (I checked the code for JEuclid, James JSPF, easyb and OpenEJB which are depending on CLI 1.1 according to mvnrepository.com, none uses more than 1 argument per option)&lt;/p&gt;</comment>
                            <comment id="12604904" author="ebourg" created="Fri, 13 Jun 2008 14:58:18 +0000"  >&lt;p&gt;I tried your test Russel, it fails on CLI 1.0. I don&apos;t think your example is right, you declare that -D has an unlimited number of arguments, so there shouldn&apos;t be remaining arguments, the last -D option gets 3 values. Your example would work with hasArg() instead of hasArgs().&lt;/p&gt;

&lt;p&gt;With hasArg() the test fails on CLI 1.1, and it works on CLI 1.2 with my patch applied.&lt;/p&gt;</comment>
                            <comment id="12604907" author="ebourg" created="Fri, 13 Jun 2008 15:12:46 +0000"  >&lt;p&gt;The patch has been applied. Russel and Steve, if you could give it a try that would be great.&lt;/p&gt;</comment>
                            <comment id="12604924" author="ebourg" created="Fri, 13 Jun 2008 16:37:08 +0000"  >&lt;p&gt;Just a thought on Russel&apos;s last example, I believe we hit a flaw in the parser, if the command line is:
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-Dz=1 blah&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The parser should know that &quot;blah&quot; can&apos;t be an argument of the option because the first argument is attached to the option, even if the option is defined with an unlimited number of arguments. That would not be true if the first value was detached from the option, like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-D z=1 blah&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ll file this in another JIRA issue.&lt;/p&gt;</comment>
                            <comment id="12632921" author="russel" created="Sat, 20 Sep 2008 07:11:51 +0000"  >&lt;p&gt;As at 2008-09-20 08:08:00+01:00, the original code of this issue generates:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-F 1
-F 3
-F bla
-F  76
-F 54
{code&amp;gt;
using CLI 1.0:
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;-F 1&lt;br/&gt;
--blah 1&lt;br/&gt;
3 bla  76 54 &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;using CLI 1.1, and:
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;-F 1&lt;br/&gt;
-F 3&lt;br/&gt;
-F bla&lt;br/&gt;
-F  76&lt;br/&gt;
-F 54&lt;br/&gt;
--blah 1&lt;br/&gt;
--blah 3&lt;br/&gt;
--blah bla&lt;br/&gt;
--blah  76&lt;br/&gt;
--blah 54&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;using 1.2-SNAPSHOT (a local build of Subversion HEAD, this is not in the Maven repository).  This would seem to confirm the status of this as &quot;fixed&quot;.&lt;/p&gt;</comment>
                            <comment id="12632922" author="russel" created="Sat, 20 Sep 2008 07:19:13 +0000"  >&lt;p&gt;The TestNG test above (posting of 2008-06-03T08:46 &amp;lt;in whatever timezone this JIRA exists in&amp;gt;) now passes further confirming that this issue is correctly marked as &quot;Fixed&quot;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12383250" name="repeated-options.patch" size="2375" author="ebourg" created="Mon, 2 Jun 2008 20:29:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>89184</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0frpr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90087</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>