<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:52:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CLI-344] Option.processValue() throws NullPointerException when passed null value with value separator configured</title>
                <link>https://issues.apache.org/jira/browse/CLI-344</link>
                <project id="12310463" key="CLI">Commons CLI</project>
                    <description>&lt;p&gt;The &lt;tt&gt;Option.processValue(String value)&lt;/tt&gt; method does not properly handle null input values. When a null value is passed to this method and the Option has a value separator configured, it throws a &lt;tt&gt;NullPointerException&lt;/tt&gt; instead of handling the null gracefully with proper validation.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Steps to Reproduce:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Option option = new Option(&quot;D&quot;, true, &quot;Define property&quot;);&lt;br/&gt;
option.setValueSeparator(&apos;=&apos;);&lt;br/&gt;
option.processValue(null); &#160;// Throws NullPointerException&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Expected Behavior:&lt;/b&gt; The method should validate the input and throw an &lt;tt&gt;IllegalArgumentException&lt;/tt&gt; with a clear error message when null is passed, consistent with how other methods in the library handle invalid input.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Actual Behavior:&lt;/b&gt; A &lt;tt&gt;NullPointerException&lt;/tt&gt; is thrown at line 839 in Option.java when the code attempts to call &lt;tt&gt;indexOf()&lt;/tt&gt; on the null value:&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
&#160; &#160; at org.apache.commons.cli.Option.processValue(Option.java:839)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Root Cause Analysis:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;processValue()&lt;/tt&gt; method assigns the input value directly to a local variable without null checking:&lt;/p&gt;

&lt;p&gt;void processValue(final String value) {&lt;br/&gt;
&#160; &#160; if (argCount == UNINITIALIZED) &lt;/p&gt;
{
&#160; &#160; &#160; &#160; throw new IllegalArgumentException(&quot;NO_ARGS_ALLOWED&quot;);
&#160; &#160; }&lt;br/&gt;
&#160; &#160; String add = value; &#160;// No null check&lt;br/&gt;
&#160; &#160; if (hasValueSeparator()) {
&#160; &#160; &#160; &#160; final char sep = getValueSeparator();
&#160; &#160; &#160; &#160; int index = add.indexOf(sep); &#160;// NPE occurs here when add is null
&#160; &#160; &#160; &#160; // ...
&#160; &#160; }&lt;br/&gt;
}&lt;br/&gt;
&lt;br/&gt;
&#160;&lt;br/&gt;
&lt;br/&gt;
&lt;b&gt;Unit Test Cases:&lt;/b&gt;&lt;br/&gt;
&lt;br/&gt;
@Test&lt;br/&gt;
public void testProcessValueWithNullThrowsIllegalArgumentException() {
&#160; &#160; Option option = new Option(&quot;D&quot;, true, &quot;Define property&quot;);
&#160; &#160; option.setValueSeparator(&apos;=&apos;);
&#160; &#160;&#160;
&#160; &#160; IllegalArgumentException exception = assertThrows(
&#160; &#160; &#160; &#160; IllegalArgumentException.class,&#160;
&#160; &#160; &#160; &#160; () -&amp;gt; option.processValue(null),
&#160; &#160; &#160; &#160; &quot;processValue(null) should throw IllegalArgumentException&quot;
&#160; &#160; );
&#160; &#160;&#160;
&#160; &#160; assertTrue(exception.getMessage().contains(&quot;null&quot;),
&#160; &#160; &#160; &#160; &quot;Exception message should indicate null value issue&quot;);
}&lt;br/&gt;
&lt;br/&gt;
&#160;&lt;br/&gt;
&lt;br/&gt;
&lt;b&gt;Test Results:&lt;/b&gt;&lt;br/&gt;
&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;*INFO*&amp;#93;&lt;/span&gt; Running org.apache.commons.cli.&lt;b&gt;OptionTest&lt;/b&gt;&lt;b&gt;{&lt;/b&gt;}&lt;br/&gt;
&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;*ERROR*&amp;#93;&lt;/span&gt; &lt;b&gt;Tests&lt;/b&gt; &lt;b&gt;run: 1&lt;/b&gt;, &lt;b&gt;Failures: 1&lt;/b&gt;, Errors: 0, Skipped: 0, Time elapsed: 0.001 s &lt;b&gt;&amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;/b&gt; &amp;#8211; in org.apache.commons.cli.&lt;b&gt;OptionTest&lt;/b&gt;&lt;b&gt;{&lt;/b&gt;}&lt;br/&gt;
&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;*ERROR*&amp;#93;&lt;/span&gt; org.apache.commons.cli.OptionTest.testProcessValueWithNullThrowsIllegalArgumentException &amp;#8211; Time elapsed: 0.001 s &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
&lt;br/&gt;
org.opentest4j.AssertionFailedError: processValue(null) should throw IllegalArgumentException ==&amp;gt; Unexpected exception type thrown, expected: &amp;lt;java.lang.IllegalArgumentException&amp;gt; but was: &amp;lt;java.lang.NullPointerException&amp;gt;&lt;br/&gt;
&lt;br/&gt;
 at org.junit.jupiter.api.AssertionFailureBuilder.build(AssertionFailureBuilder.java:151)&lt;br/&gt;
&lt;br/&gt;
 at org.junit.jupiter.api.AssertThrows.assertThrows(AssertThrows.java:67)&lt;br/&gt;
&lt;br/&gt;
 at org.junit.jupiter.api.AssertThrows.assertThrows(AssertThrows.java:39)&lt;br/&gt;
&lt;br/&gt;
 at org.junit.jupiter.api.Assertions.assertThrows(Assertions.java:3153)&lt;br/&gt;
&lt;br/&gt;
 at org.apache.commons.cli.OptionTest.testProcessValueWithNullThrowsIllegalArgumentException(OptionTest.java:32)&lt;br/&gt;
&lt;br/&gt;
 at java.lang.reflect.Method.invoke(Method.java:498)&lt;br/&gt;
&lt;br/&gt;
 at java.util.ArrayList.forEach(ArrayList.java:1259)&lt;br/&gt;
&lt;br/&gt;
 at java.util.ArrayList.forEach(ArrayList.java:1259)&lt;br/&gt;
&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
&lt;br/&gt;
 at org.apache.commons.cli.Option.processValue(Option.java:839)&lt;br/&gt;
&lt;br/&gt;
 at org.apache.commons.cli.OptionTest.lambda$testProcessValueWithNullThrowsIllegalArgumentException$0(OptionTest.java:34)&lt;br/&gt;
&lt;br/&gt;
 at org.junit.jupiter.api.AssertThrows.assertThrows(AssertThrows.java:53)&lt;br/&gt;
&lt;br/&gt;
 ... 6 more&lt;br/&gt;
&lt;br/&gt;
&#160;&lt;br/&gt;
&lt;br/&gt;
&lt;b&gt;Suggested Fix:&lt;/b&gt; &lt;br/&gt;
&lt;br/&gt;
Add null validation at the beginning of the method:&lt;br/&gt;
&lt;br/&gt;
void processValue(final String value) {&lt;br/&gt;
&#160; &#160; if (value == null) {
&#160; &#160; &#160; &#160; throw new IllegalArgumentException(&quot;The value must not be null&quot;);
&#160; &#160; }&lt;br/&gt;
&#160; &#160; if (argCount == UNINITIALIZED) {
&#160; &#160; &#160; &#160; throw new IllegalArgumentException(&quot;NO_ARGS_ALLOWED&quot;);
&#160; &#160; }
&lt;p&gt;&#160; &#160; // ... rest of the method remains unchanged&lt;br/&gt;
}&lt;/p&gt;</description>
                <environment></environment>
        <key id="13621530">CLI-344</key>
            <summary>Option.processValue() throws NullPointerException when passed null value with value separator configured</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="rickydong">Ruiqi Dong</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 Jun 2025 08:07:32 +0000</created>
                <updated>Tue, 29 Jul 2025 14:39:33 +0000</updated>
                            <resolved>Tue, 29 Jul 2025 14:35:51 +0000</resolved>
                                    <version>1.10.0</version>
                                    <fixVersion>1.10.0</fixVersion>
                                    <component>Options definition</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="1800">0.5h</timeoriginalestimate>
                            <timeestimate seconds="1800">0.5h</timeestimate>
                                        <comments>
                            <comment id="18010688" author="garydgregory" created="Tue, 29 Jul 2025 14:35:51 +0000"  >&lt;p&gt;In git master and snapshot builds: Fail faster with a more precise NullPointerException&lt;/p&gt;

&lt;p&gt;NPE is the most precise exception and message&lt;/p&gt;

&lt;p&gt;Nevertheless, we can make this a touch better using Java&apos;s&#160;&lt;tt&gt;Objects.requireNonNull()&lt;/tt&gt; to fail faster with a message specific to the argument. The exception is still an NPE, the most precise for this case.&lt;/p&gt;

&lt;p&gt;Done in git master and snapshot builds in&#160;&lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/commons-cli/commons-cli/1.10.0-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/commons-cli/commons-cli/1.10.0-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13077170" name="Option.java" size="32345" author="rickydong" created="Mon, 23 Jun 2025 08:06:57 +0000"/>
                            <attachment id="13077169" name="OptionTest.java" size="1542" author="rickydong" created="Mon, 23 Jun 2025 08:07:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1wfr4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>