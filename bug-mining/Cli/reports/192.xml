<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:51:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CLI-193] StringIndexOutOfBoundsException in HelpFormatter.findWrapPos</title>
                <link>https://issues.apache.org/jira/browse/CLI-193</link>
                <project id="12310463" key="CLI">Commons CLI</project>
                    <description>&lt;p&gt;In the last while loop in HelpFormatter.findWrapPos, it can pass text.length() to text.charAt(int), which throws a StringIndexOutOfBoundsException. The first expression in that while loop condition should use a &amp;lt;, not a &amp;lt;=.&lt;/p&gt;

&lt;p&gt;This is on line 908 in r779646:&lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/viewvc/commons/proper/cli/trunk/src/java/org/apache/commons/cli/HelpFormatter.java?revision=779646&amp;amp;view=markup&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/commons/proper/cli/trunk/src/java/org/apache/commons/cli/HelpFormatter.java?revision=779646&amp;amp;view=markup&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12446404">CLI-193</key>
            <summary>StringIndexOutOfBoundsException in HelpFormatter.findWrapPos</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="motravo">Travis McLeskey</reporter>
                        <labels>
                    </labels>
                <created>Sat, 23 Jan 2010 01:58:29 +0000</created>
                <updated>Sat, 9 May 2015 18:43:31 +0000</updated>
                            <resolved>Wed, 7 Jul 2010 13:51:30 +0000</resolved>
                                    <version>1.2</version>
                                    <fixVersion>1.3</fixVersion>
                                    <component>CLI-1.x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="300">5m</timeoriginalestimate>
                            <timeestimate seconds="300">5m</timeestimate>
                                        <comments>
                            <comment id="12877867" author="ebourg" created="Fri, 11 Jun 2010 17:26:15 +0000"  >&lt;p&gt;Thank you for the report Travis. Do you have a test case that triggers the exception?&lt;/p&gt;</comment>
                            <comment id="12878392" author="chris.lee" created="Sun, 13 Jun 2010 14:59:44 +0000"  >&lt;p&gt;Here is a patch that adds a test case and applies the fix suggested by Travis.&lt;/p&gt;</comment>
                            <comment id="12878422" author="motravo" created="Sun, 13 Jun 2010 19:08:13 +0000"  >&lt;p&gt;You should be able to get it to throw with a call like this:&lt;/p&gt;

&lt;p&gt;  findWrapPos( &quot;hello&quot;, 3, 0 );  // should return -1&lt;/p&gt;

&lt;p&gt;The exception gets thrown whenever the passed-in string does not contain any spaces, tabs, or newlines. It looks like line 914 was also expecting line 908 to have a &amp;lt;.&lt;/p&gt;


&lt;p&gt;Also, I think there are other bugs. In this call:&lt;/p&gt;

&lt;p&gt;  findWrapPos( &quot;helloooo\noo\ngoodbye&quot;, 6, 7 );  // should return 8&lt;/p&gt;

&lt;p&gt;we want it to short circuit and return the first newline if there is one in the substring starting at 7 with width 6 (&quot;o\noo\ng&quot;), and so it should return the index of the first &apos;\n&apos;, which is 8. However, on lines 876 and 877, it&apos;s doing &quot;pos &amp;lt;= width&quot;, instead of &quot;pos &amp;lt;= startPos+width&quot;, so it won&apos;t return, and it will end up (incorrectly, I think) returning the index of the second newline&apos;s position. And once you fix lines 876 and 877, it&apos;s going to return 9 instead of 8, which I think is incorrect. The other return statements return pos, not pos+1, and I think line 879 should do the same.&lt;/p&gt;</comment>
                            <comment id="12880690" author="ebourg" created="Sun, 20 Jun 2010 23:17:44 +0000"  >&lt;p&gt;The proposed change makes sense but it doesn&apos;t solve completely the issue with &quot;unbreakable&quot; text.&lt;/p&gt;

&lt;p&gt;For example, considering the following test:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testRenderWrappedTextWordCut()
{
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; width = 7;
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; padding = 0;
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; text = &lt;span class=&quot;code-quote&quot;&gt;&quot;Thisisatest.&quot;&lt;/span&gt;;
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; expected = &lt;span class=&quot;code-quote&quot;&gt;&quot;Thisisa&quot;&lt;/span&gt; + EOL + 
                      &lt;span class=&quot;code-quote&quot;&gt;&quot;test.&quot;&lt;/span&gt;;
    
    &lt;span class=&quot;code-object&quot;&gt;StringBuffer&lt;/span&gt; sb = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;StringBuffer&lt;/span&gt;();
    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HelpFormatter().renderWrappedText(sb, width, padding, text);
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(sb.toString());
    assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;cut and wrap&quot;&lt;/span&gt;, expected, sb.toString());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With the current code it throws a StringIndexOutOfBoundsException. With the modification it fails because the text is not cut.&lt;/p&gt;</comment>
                            <comment id="12881262" author="chris.lee" created="Tue, 22 Jun 2010 17:45:00 +0000"  >&lt;p&gt;Well, that would be easy enough to fix, but that&apos;s at odds with how the method is documented now. It currently says it will ONLY break on a newline or space (&quot;The wrap point is the last postion before startPos+width having a whitespace character (space, \n, \r).&quot;).&lt;/p&gt;

&lt;p&gt;In addition to that, it&apos;s currently looking for whitespace AFTER startPos+width (also at odds with documentation). How should it actually behave?&lt;/p&gt;

&lt;p&gt;I&apos;ve attached another patch that will preserve the existing functionality (looking for spaces after startPos+width) but reverts back to returning startPos+width if none is found.&lt;/p&gt;

&lt;p&gt;If, instead, it should &lt;b&gt;never&lt;/b&gt; allow for a string longer than startPos+width, then current lines 908-912 should probably just be removed. This will cause &quot;wrap position 3&quot; unit test to fail though.&lt;/p&gt;</comment>
                            <comment id="12881328" author="ebourg" created="Tue, 22 Jun 2010 19:50:09 +0000"  >&lt;p&gt;I believe the absolute rule for the wrapping should be to not exceed the maximum width, then to do the best effort to wrap on space characters, and if it is not possible, break a word.&lt;/p&gt;</comment>
                            <comment id="12881356" author="chris.lee" created="Tue, 22 Jun 2010 20:56:02 +0000"  >&lt;p&gt;Makes sense to me too. Doesn&apos;t help to have characters run only a &lt;b&gt;little&lt;/b&gt; bit off the screen &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Here is an updated patch that will never exceed startPos+width.&lt;/p&gt;</comment>
                            <comment id="12885947" author="ebourg" created="Wed, 7 Jul 2010 13:51:30 +0000"  >&lt;p&gt;Thank you for the patch Chris. I applied the change you suggested and it seems to work fine.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12447722" name="cli-helpformatter-stringIndexOOB-2.patch" size="4739" author="chris.lee" created="Tue, 22 Jun 2010 17:45:46 +0000"/>
                            <attachment id="12447741" name="cli-helpformatter-stringIndexOOB-3.patch" size="2363" author="chris.lee" created="Tue, 22 Jun 2010 20:56:02 +0000"/>
                            <attachment id="12446980" name="cli-helpformatter-stringIndexOOB.patch" size="1287" author="chris.lee" created="Sun, 13 Jun 2010 14:59:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40188</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 20 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0frhz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90052</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>