<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:49:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CLI-151] HelpFormatter wraps incorrectly on every line beyond the first</title>
                <link>https://issues.apache.org/jira/browse/CLI-151</link>
                <project id="12310463" key="CLI">Commons CLI</project>
                    <description>&lt;p&gt;The method findWrapPos(...) in the HelpFormatter is a couple of bugs in the way that it deals with the &quot;startPos&quot; variable.  This causes it to format every line beyond the first line by &quot;startPos&quot; to many characters, beyond the specified width.  &lt;/p&gt;

&lt;p&gt;To see this, create an option with a long description, and then use the help formatter to print it.  The first line will be the correct length.  The 2nd, 3rd, etc lines will all be too long.&lt;/p&gt;

&lt;p&gt;I don&apos;t have a patch (sorry) - but here is a corrected version of the method.&lt;/p&gt;

&lt;p&gt;I fixed it in two places - both were using &quot;width + startPos&quot; when they should have been using width.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; findWrapPos(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; text, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; width, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; startPos)
    {
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; pos = -1;

        &lt;span class=&quot;code-comment&quot;&gt;// the line ends before the max wrap pos or a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; line &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt; found
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (((pos = text.indexOf(&lt;span class=&quot;code-quote&quot;&gt;&apos;\n&apos;&lt;/span&gt;, startPos)) != -1 &amp;amp;&amp;amp; pos &amp;lt;= width)
            || ((pos = text.indexOf(&lt;span class=&quot;code-quote&quot;&gt;&apos;\t&apos;&lt;/span&gt;, startPos)) != -1 &amp;amp;&amp;amp; pos &amp;lt;= width))
        {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; pos+1;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((width) &amp;gt;= text.length())
        {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; -1;
        }


        &lt;span class=&quot;code-comment&quot;&gt;// look &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the last whitespace character before startPos+width
&lt;/span&gt;        pos = width;

        &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt; c;

        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; ((pos &amp;gt;= startPos) &amp;amp;&amp;amp; ((c = text.charAt(pos)) != &lt;span class=&quot;code-quote&quot;&gt;&apos; &apos;&lt;/span&gt;)
               &amp;amp;&amp;amp; (c != &lt;span class=&quot;code-quote&quot;&gt;&apos;\n&apos;&lt;/span&gt;) &amp;amp;&amp;amp; (c != &lt;span class=&quot;code-quote&quot;&gt;&apos;\r&apos;&lt;/span&gt;))
        {
            --pos;
        }

        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we found it - just &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (pos &amp;gt; startPos)
        {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; pos;
        }
        
        &lt;span class=&quot;code-comment&quot;&gt;// must look &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the first whitespace chearacter after startPos 
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// + width
&lt;/span&gt;        pos = startPos + width;

        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; ((pos &amp;lt;= text.length()) &amp;amp;&amp;amp; ((c = text.charAt(pos)) != &lt;span class=&quot;code-quote&quot;&gt;&apos; &apos;&lt;/span&gt;)
               &amp;amp;&amp;amp; (c != &lt;span class=&quot;code-quote&quot;&gt;&apos;\n&apos;&lt;/span&gt;) &amp;amp;&amp;amp; (c != &lt;span class=&quot;code-quote&quot;&gt;&apos;\r&apos;&lt;/span&gt;))
        {
            ++pos;
        }

        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (pos == text.length())        ? (-1) : pos;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12388948">CLI-151</key>
            <summary>HelpFormatter wraps incorrectly on every line beyond the first</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="armbrust">Dan Armbrust</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Feb 2008 22:20:39 +0000</created>
                <updated>Mon, 25 May 2009 17:26:26 +0000</updated>
                            <resolved>Wed, 18 Feb 2009 05:20:49 +0000</resolved>
                                                    <fixVersion>1.2</fixVersion>
                                    <component>Help formatter</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12590028" author="jlmuir" created="Thu, 17 Apr 2008 13:35:27 +0000"  >&lt;p&gt;I have observed this same problem.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure the suggested fix to &lt;tt&gt;findWrapPos&lt;/tt&gt; is correct.  When I tried it, the &lt;tt&gt;testFindWrapPos&lt;/tt&gt; test case failed with&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[junit] wrap position 2 expected:&amp;lt;-1&amp;gt; but was:&amp;lt;16&amp;gt;
[junit] junit.framework.AssertionFailedError:
[junit]     wrap position 2 expected:&amp;lt;-1&amp;gt; but was:&amp;lt;16&amp;gt;
[junit]   at org.apache.commons.cli.HelpFormatterTest.testFindWrapPos(
[junit]     HelpFormatterTest.java:62)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think the problem is actually in &lt;tt&gt;HelpFormatter.renderWrappedText&lt;/tt&gt; (&lt;tt&gt;HelpFormatter.java&lt;/tt&gt; line 812).  It calls &lt;tt&gt;findWrapPos&lt;/tt&gt; with a start position of &lt;tt&gt;nextLineTabStop&lt;/tt&gt;, but that&apos;s not right; it should be a start position of 0.&lt;/p&gt;

&lt;p&gt;The line wrapping works for me after making this correction.  I will attach a patch containing this fix as well as an addition to the test cases to validate it.&lt;/p&gt;</comment>
                            <comment id="12590030" author="jlmuir" created="Thu, 17 Apr 2008 13:38:05 +0000"  >&lt;p&gt;Line wrapping fix.&lt;/p&gt;</comment>
                            <comment id="12595128" author="bayard" created="Thu, 8 May 2008 06:41:24 +0000"  >&lt;p&gt;Looks good to me - thanks for the report and the patch.&lt;/p&gt;

&lt;p&gt;&amp;#8212;&lt;/p&gt;

&lt;p&gt;svn ci -m &quot;Applying J. Lewis Muir&apos;s patch from &lt;a href=&quot;https://issues.apache.org/jira/browse/CLI-151&quot; title=&quot;HelpFormatter wraps incorrectly on every line beyond the first&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CLI-151&quot;&gt;&lt;del&gt;CLI-151&lt;/del&gt;&lt;/a&gt; fixing HelpFormatter so it wraps properly on multiple lines&quot;&lt;/p&gt;

&lt;p&gt;Sending        src/java/org/apache/commons/cli/HelpFormatter.java&lt;br/&gt;
Sending        src/test/org/apache/commons/cli/HelpFormatterTest.java&lt;br/&gt;
Transmitting file data ..&lt;br/&gt;
Committed revision 654428.&lt;/p&gt;</comment>
                            <comment id="12674449" author="bayard" created="Wed, 18 Feb 2009 04:24:29 +0000"  >&lt;p&gt;This caused OutOfMemoryExceptions in some cases, so reopening.&lt;/p&gt;</comment>
                            <comment id="12674462" author="bayard" created="Wed, 18 Feb 2009 05:20:49 +0000"  >&lt;p&gt;I&apos;ve sat and looked at the code fresh, and I agree with the 0 as a fix here. Digging into the new failing test, I think the errors are in other code - so closing this out again.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12340590">CLI-37</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12416130">CLI-176</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12380393" name="fix-wrapping.patch" size="1458" author="jlmuir" created="Thu, 17 Apr 2008 13:38:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40221</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 40 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0frof:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90081</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>