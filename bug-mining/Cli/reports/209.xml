<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:51:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CLI-265] Optional argument picking up next regular option as its argument</title>
                <link>https://issues.apache.org/jira/browse/CLI-265</link>
                <project id="12310463" key="CLI">Commons CLI</project>
                    <description></description>
                <environment></environment>
        <key id="12965433">CLI-265</key>
            <summary>Optional argument picking up next regular option as its argument</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="britter">Benedikt Ritter</assignee>
                                    <reporter username="lynnskii">Lynn Henderson</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 May 2016 22:22:35 +0000</created>
                <updated>Sat, 5 Jun 2021 21:15:28 +0000</updated>
                            <resolved>Wed, 2 Sep 2020 02:58:32 +0000</resolved>
                                    <version>1.3.1</version>
                                    <fixVersion>1.4</fixVersion>
                                    <component>CLI-1.x</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15273243" author="lynnskii" created="Thu, 5 May 2016 22:35:06 +0000"  >&lt;p&gt;I have recently migrated a project from CLI 1.2 to 1.3.1 and have encountered what may be a bug or difference in the way optional arguments are being processed.&lt;/p&gt;

&lt;p&gt;I have a command that opens several different kinds of databases by type, or alternately, the last opened database of that type.&lt;/p&gt;

&lt;p&gt;Option TYPE1 = Option.builder(&quot;t1&quot;).hasArg().numberOfArgs(1).optionalArg(true).argName(&quot;t1_path&quot;).build();&lt;br/&gt;
Option TYPE2 = Option.builder(&quot;t2&quot;).hasArg().numberOfArgs(1).optionalArg(true).argName(&quot;t2_path&quot;).build();&lt;br/&gt;
Option LAST  =  Option.builder(&quot;last&quot;).hasArg(false).build();&lt;/p&gt;

&lt;p&gt;Commands then look like &quot;open -t1 path/to/my/db&quot; or &quot;open -t1 -last&quot;&lt;/p&gt;

&lt;p&gt;If I use the now deprecated GnuParser, both commands work as expected.  However, if I use the new DefaultParser, for the 2nd example, it thinks &quot;-last&quot; is the argument for -t1 rather than an option in its own right.&lt;/p&gt;

&lt;p&gt;I added the numberOfArgs(1) after reading a post on StackOverflow, but it made no difference in the behavior.  Only switching back to the GnuParser seemed to work.&lt;/p&gt;
</comment>
                            <comment id="15422019" author="msandiford" created="Tue, 16 Aug 2016 01:40:13 +0000"  >&lt;p&gt;See also this question/answer on Stackoverflow for a slightly different symptom and potential fix.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://stackoverflow.com/questions/38964866/defaultparser-in-commons-cli-doesnt-behave-like-the-deprecated-parsers/38965293#38965293&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/38964866/defaultparser-in-commons-cli-doesnt-behave-like-the-deprecated-parsers/38965293#38965293&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15468470" author="vguna" created="Tue, 6 Sep 2016 20:34:19 +0000"  >&lt;p&gt;Seeing the exact same behavior as described here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://markmail.org/thread/ozeke3q7ni572psi#query:+page:1+mid:i6gssbpyvxozt633+state:results&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/thread/ozeke3q7ni572psi#query:+page:1+mid:i6gssbpyvxozt633+state:results&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15471681" author="britter" created="Wed, 7 Sep 2016 20:20:54 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;~/w/a/c/cli &amp;gt; svn ci -m &lt;span class=&quot;code-quote&quot;&gt;&quot;CLI-265: Optional argument picking up next regular option as its argument. Thank you to Lynn Henderson, Martin Sandiford and Veit Guna &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; providing reproductions.&quot;&lt;/span&gt;
Sending        src/changes/changes.xml
Sending        src/main/java/org/apache/commons/cli/DefaultParser.java
Adding         src/test/java/org/apache/commons/cli/bug/BugCLI265Test.java
Transmitting file data ...done
Committing transaction...
Committed revision 1759695.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                            <comment id="15472346" author="msandiford" created="Thu, 8 Sep 2016 01:10:23 +0000"  >&lt;p&gt;Hey Benedikt,  thanks for looking at this quickly.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure if this is a complete fix.  It seems to miss the case where short options are concatenated after an option that takes an optional argument.&lt;/p&gt;

&lt;p&gt;A failing test case for this would be to modify &lt;tt&gt;setUp()&lt;/tt&gt; in BugCLI265Test.java to include short options &quot;a&quot; and &quot;b&quot;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @Before
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setUp() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        parser = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultParser();

        Option TYPE1 = Option.builder(&lt;span class=&quot;code-quote&quot;&gt;&quot;t1&quot;&lt;/span&gt;).hasArg().numberOfArgs(1).optionalArg(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;).argName(&lt;span class=&quot;code-quote&quot;&gt;&quot;t1_path&quot;&lt;/span&gt;).build();
        Option OPTION_A = Option.builder(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;).hasArg(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;).build();
        Option OPTION_B = Option.builder(&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;).hasArg(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;).build();
        Option LAST = Option.builder(&lt;span class=&quot;code-quote&quot;&gt;&quot;last&quot;&lt;/span&gt;).hasArg(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;).build();

        options = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Options().addOption(TYPE1).addOption(OPTION_A).addOption(OPTION_B).addOption(LAST);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Add add a test for the concatenated options following an option with optional argument case:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void shouldParseConcatenatedShortOptions() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] concatenatedShortOptions = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] { &lt;span class=&quot;code-quote&quot;&gt;&quot;-t1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;-ab&quot;&lt;/span&gt; };

      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; CommandLine commandLine = parser.parse(options, concatenatedShortOptions);

      assertTrue(commandLine.hasOption(&lt;span class=&quot;code-quote&quot;&gt;&quot;t1&quot;&lt;/span&gt;));
      assertEquals(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, commandLine.getOptionValue(&lt;span class=&quot;code-quote&quot;&gt;&quot;t1&quot;&lt;/span&gt;));
      assertTrue(commandLine.hasOption(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;));
      assertTrue(commandLine.hasOption(&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;));
      assertFalse(commandLine.hasOption(&lt;span class=&quot;code-quote&quot;&gt;&quot;last&quot;&lt;/span&gt;));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;One possible fix is to check that at least the first character of the option is a short option if all the other cases fail in &lt;tt&gt;isShortOption(...)&lt;/tt&gt; like so:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isShortOption(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; token)
    {
        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt; options (-S, -SV, -S=V, -SV1=V2, -S1S2)
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!token.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;-&quot;&lt;/span&gt;) || token.length() == 1)
        {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
        }

        &lt;span class=&quot;code-comment&quot;&gt;// remove leading &lt;span class=&quot;code-quote&quot;&gt;&quot;-&quot;&lt;/span&gt; and &lt;span class=&quot;code-quote&quot;&gt;&quot;=value&quot;&lt;/span&gt;
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; pos = token.indexOf(&lt;span class=&quot;code-quote&quot;&gt;&quot;=&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; optName = pos == -1 ? token.substring(1) : token.substring(1, pos);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (options.hasShortOption(optName))
        {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; optName.length() &amp;gt; 0 &amp;amp;&amp;amp; options.hasShortOption(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(optName.charAt(0)));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15472835" author="britter" created="Thu, 8 Sep 2016 05:26:57 +0000"  >&lt;p&gt;Reopen issue to address the problem identified by Martin Sandiford.&lt;/p&gt;</comment>
                            <comment id="15472851" author="britter" created="Thu, 8 Sep 2016 05:37:30 +0000"  >&lt;p&gt;See &lt;a href=&quot;http://svn.apache.org/r1759745&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1759745&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17187858" author="lynnskii" created="Mon, 31 Aug 2020 16:44:17 +0000"  >&lt;p&gt;Sorry it&apos;s been a few years, but I&apos;m in the process of updating some libraries for an existing project, including CLI 1.4 (downloaded today), and I notice the bug I reported before still seems to be present in 1.4.&lt;/p&gt;

&lt;p&gt;If I have an option that takes an optional argument but don&apos;t include one, it&apos;s picking up the next option as if it were the argument.&lt;/p&gt;

&lt;p&gt;&#160;Option DB = Option&lt;br/&gt;
 .builder(&quot;db&quot;).hasArg().optionalArg(true).numberOfArgs(1).build();&lt;/p&gt;

&lt;p&gt;Option LAST = Option.builder(&quot;last&quot;).hasArg(false)&lt;br/&gt;
 .desc(&quot;Open the most recently opened database&quot;)&lt;br/&gt;
 .required(false).build();&lt;/p&gt;

&lt;p&gt;Commands are of the form &quot;open -db /path/to/db&quot; or &quot;open -db -last&quot;.&lt;/p&gt;

&lt;p&gt;Executing &quot;open -db -last&quot; with 1.4 using the DefaultParser still gives me this error:&lt;br/&gt;
 ERROR Database &quot;-last&quot; not found (i.e., it thinks it&apos;s the arg to option -db).&lt;/p&gt;

&lt;p&gt;As with 1.2 and 1.3.1, if I use the now deprecated GnuParser, it works as expected.&lt;/p&gt;

&lt;p&gt;In 1.4, reversing the order of the options works with DefaultParser, but this shouldn&apos;t be required: &quot;open -last -db&quot;&lt;/p&gt;</comment>
                            <comment id="17188945" author="lynnskii" created="Wed, 2 Sep 2020 02:58:32 +0000"  >&lt;p&gt;Turns out I had a dependent project that was still using 1.3.1, so that ending up taking precedence in my classpath instead of 1.4.&#160; Apologies for the false alarm.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13382180">CLI-309</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 10 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2x8i7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>