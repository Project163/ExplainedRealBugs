<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:49:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CLI-21] [cli] clone method in Option should use super.clone()</title>
                <link>https://issues.apache.org/jira/browse/CLI-21</link>
                <project id="12310463" key="CLI">Commons CLI</project>
                    <description>&lt;p&gt;In&lt;br/&gt;
org.apache.commons.cli.Option&lt;br/&gt;
public method clone is implemented by creating a new instance through one of &lt;br/&gt;
the class Constructors, and then assigning values as required through the &lt;br/&gt;
setter methods.&lt;/p&gt;

&lt;p&gt;This means that any subclasses of the Option class will not return a true &lt;br/&gt;
clone, but a new Option instance instead.&lt;/p&gt;

&lt;p&gt;A proper implementation of clone should use super.clone() to create a new &lt;br/&gt;
instance, rather than calling the class constructor.  This allows shallows &lt;br/&gt;
clones to propogate correctly down to subclasses.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: other&lt;br/&gt;
Platform: Other&lt;/p&gt;</environment>
        <key id="12341555">CLI-21</key>
            <summary>[cli] clone method in Option should use super.clone()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="nathan.mcdonald@optusnet.com.au">Nathan McDonald</reporter>
                        <labels>
                    </labels>
                <created>Sun, 4 Jul 2004 16:57:38 +0000</created>
                <updated>Sat, 30 Jun 2007 18:18:40 +0000</updated>
                            <resolved>Sat, 30 Jun 2007 18:18:40 +0000</resolved>
                                    <version>1.0</version>
                                    <fixVersion>1.1</fixVersion>
                                    <component>CLI-1.x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12406967" author="bayard" created="Fri, 10 Feb 2006 15:04:33 +0000"  >&lt;p&gt;+1 on the implementation not correctly supporting subclassing.&lt;/p&gt;

&lt;p&gt;Is there even a use case for cloning an Option I wonder. Nothing else can be cloned - why would an &lt;br/&gt;
Option be special.&lt;/p&gt;
</comment>
                            <comment id="12406968" author="sebb@apache.org" created="Mon, 13 Feb 2006 09:39:28 +0000"  >&lt;p&gt;An alternative is to make the class final.&lt;/p&gt;</comment>
                            <comment id="12406969" author="bayard" created="Wed, 8 Mar 2006 14:40:11 +0000"  >&lt;p&gt;clone() showed up in a commit from jkeyes, whose comment doesn&apos;t indicate any&lt;br/&gt;
reason for the addition:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/jakarta/commons/proper/cli/trunk/src/java/org/apache/commons/cli/Option.java?rev=129799&amp;amp;r1=129796&amp;amp;r2=129799&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/jakarta/commons/proper/cli/trunk/src/java/org/apache/commons/cli/Option.java?rev=129799&amp;amp;r1=129796&amp;amp;r2=129799&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12406970" author="bayard" created="Wed, 8 Mar 2006 14:42:18 +0000"  >&lt;p&gt;Removed clone() from Option - thus resolving this bug.&lt;/p&gt;</comment>
                            <comment id="12504139" author="brianegge" created="Wed, 13 Jun 2007 06:49:24 +0000"  >&lt;p&gt;Properly supporting Cloneable is fairly trivial.  Previously I submitted a patch which includes a proper implementation and test case. See:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12358085/Cloneable.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12358085/Cloneable.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There&apos;s some other code in the patch which does not need to be included.  In practice usually the CLI library is only invoked once at startup, so it doesn&apos;t matter that some classes aren&apos;t quite immutable.  However, in unit testing, the options may be reused.  &lt;/p&gt;

&lt;p&gt;I have some code which looks like this:&lt;/p&gt;

&lt;p&gt;abstract class CommandLine {&lt;br/&gt;
  protected static final Option URL = new Option(&quot;u&quot;, &quot;url&quot;, true, &quot;url&quot;);&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;I&apos;ll then share this option in various subclasses.  In my unit tests, it would be best if I don&apos;t alter the original static option.  In this situation having a clone option might be helpful.  The better solution would probably just be not to make it static and forget about cloning altogether.&lt;/p&gt;

&lt;p&gt;I&apos;m not opposed to removing clone, but I don&apos;t see a strong enough reason here to break compatibility.&lt;/p&gt;</comment>
                            <comment id="12504143" author="bens" created="Wed, 13 Jun 2007 07:02:09 +0000"  >&lt;p&gt;My comment from the mailing list thread:&lt;/p&gt;

&lt;p&gt;Implementing clone() properly is a pain and hard to get right. If someone really needs distinct copies of Option classes (why?!), I&apos;d suggest providing a copy constructor instead. If compatibility is a really big deal, you could change clone() to call Object.clone(), which throws an exception. Think of it as a gentle hint to the user not to use the method anymore &amp;#8211; and the exception message could also point out the new copy constructor.&lt;/p&gt;</comment>
                            <comment id="12504479" author="brianegge" created="Thu, 14 Jun 2007 00:03:04 +0000"  >&lt;p&gt;Add clone method back to Option.  Includes test case with subclass.&lt;/p&gt;</comment>
                            <comment id="12505282" author="bayard" created="Fri, 15 Jun 2007 15:54:28 +0000"  >&lt;p&gt;Patch applied - thanks for doing that Brian.&lt;/p&gt;

&lt;p&gt;One question - when cloning, should the effects of addValue/processValue be undone?&lt;/p&gt;

&lt;p&gt;ie) Rather than:&lt;/p&gt;

&lt;p&gt;        option.values = new ArrayList(values);&lt;/p&gt;

&lt;p&gt;it should be:&lt;/p&gt;

&lt;p&gt;        option.values = new ArrayList();&lt;/p&gt;

&lt;p&gt;Or should we just recommend in the javadoc for clone() that people will probably want to immediatley call clearValues()?&lt;/p&gt;</comment>
                            <comment id="12505435" author="brianegge" created="Sat, 16 Jun 2007 07:19:01 +0000"  >&lt;p&gt;I think clearing the values would generally be useful, but I think copying them follows the principle of least surprise.  I think we should update the JavaDoc to recommend calling clearValues.&lt;/p&gt;</comment>
                            <comment id="12509022" author="bayard" created="Fri, 29 Jun 2007 06:48:20 +0000"  >&lt;p&gt;Another thought - as I kick myself to keep momentum on the CLI release. Need to find out if a change from:&lt;/p&gt;

&lt;p&gt;public Object clone()&lt;/p&gt;

&lt;p&gt;to&lt;/p&gt;

&lt;p&gt;protected Object clone() throws CloneNotSupportedException&lt;/p&gt;

&lt;p&gt;will be voted down. I presume it will. &lt;/p&gt;</comment>
                            <comment id="12509037" author="bayard" created="Fri, 29 Jun 2007 07:15:18 +0000"  >&lt;p&gt;Here&apos;s the clirr error:&lt;/p&gt;

&lt;p&gt;ERROR: 7009: org.apache.commons.cli.Option: Accessibility of method &apos;public java.lang.Object clone()&apos; has been decreased from public to protected&lt;/p&gt;

&lt;p&gt;Solutionwise, I guess we make it public again, drop the exception and throw a RuntimeException if it&apos;s thrown. Will attach a patch to that end.&lt;/p&gt;

&lt;p&gt;I am confused that Clirr doesn&apos;t seem to care about the exception being added.&lt;/p&gt;
</comment>
                            <comment id="12509038" author="bayard" created="Fri, 29 Jun 2007 07:15:55 +0000"  >&lt;p&gt;Patch making the clone method public again, and dropping the exception.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12360787" name="CLI-21.patch" size="854" author="bayard" created="Fri, 29 Jun 2007 07:15:50 +0000"/>
                            <attachment id="12359642" name="bug21.patch" size="2669" author="brianegge" created="Thu, 14 Jun 2007 00:03:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                        <customfieldname>Bugzilla Id</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29908</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>107820</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 22 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0frxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90124</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>