<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:52:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CLI-347] Options.addOptionGroup() does not remove required options from requiredOpts list</title>
                <link>https://issues.apache.org/jira/browse/CLI-347</link>
                <project id="12310463" key="CLI">Commons CLI</project>
                    <description>&lt;p&gt;When a required Option is added to an OptionGroup via &lt;tt&gt;Options.addOptionGroup()&lt;/tt&gt;, the option&apos;s &lt;tt&gt;required&lt;/tt&gt; flag is correctly set to false, but the option&apos;s key remains in the &lt;tt&gt;requiredOpts&lt;/tt&gt; list. This violates the documented design principle that &quot;an Option cannot be required if it is in an OptionGroup&quot;.&lt;/p&gt;



&lt;p&gt;&lt;b&gt;Impact:&lt;/b&gt;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;getRequiredOptions()&lt;/tt&gt; returns incorrect results&lt;/li&gt;
	&lt;li&gt;Breaks the contract that options in OptionGroups cannot be required&lt;/li&gt;
	&lt;li&gt;May cause incorrect validation behavior during command line parsing&lt;/li&gt;
	&lt;li&gt;Inconsistent behavior depending on the order of operations&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;b&gt;Test Case:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testRequiredOptionInGroupShouldNotBeInRequiredList() {
&#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// Create a required option
&lt;/span&gt;&#160; &#160; Option option = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Option(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;along&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Option A&quot;&lt;/span&gt;);
&#160; &#160; option.setRequired(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&#160; &#160;&#160;
&#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// Add required option to Options
&lt;/span&gt;&#160; &#160; Options options = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Options();
&#160; &#160; options.addOption(option);
&#160; &#160;&#160;
&#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// Verify option is in required list
&lt;/span&gt;&#160; &#160; assertTrue(options.getRequiredOptions().contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;));
&#160; &#160;&#160;
&#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// Create OptionGroup and add the same option
&lt;/span&gt;&#160; &#160; OptionGroup group = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OptionGroup();
&#160; &#160; group.addOption(option);
&#160; &#160;&#160;
&#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// Add OptionGroup to Options
&lt;/span&gt;&#160; &#160; options.addOptionGroup(group);
&#160; &#160;&#160;
&#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// Verify option&apos;s required flag is &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/span&gt;&#160; &#160; assertFalse(options.getOption(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;).isRequired());
&#160; &#160;&#160;
&#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// This assertion fails - demonstrating the bug
&lt;/span&gt;&#160; &#160; assertFalse(options.getRequiredOptions().contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;),&#160;
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&lt;span class=&quot;code-quote&quot;&gt;&quot;Option in group should NOT be in required options list&quot;&lt;/span&gt;);
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;Test Failure Scenario:&lt;/b&gt;&lt;br/&gt;
In the &lt;tt&gt;addOptionGroup()&lt;/tt&gt; method, while the code correctly sets &lt;tt&gt;option.setRequired(false)&lt;/tt&gt;, it does not remove the option&apos;s key from the &lt;tt&gt;requiredOpts&lt;/tt&gt; list. The &lt;tt&gt;addOption()&lt;/tt&gt; method only adds to &lt;tt&gt;requiredOpts&lt;/tt&gt; when &lt;tt&gt;isRequired()&lt;/tt&gt; is true, but never removes entries when the required status changes.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[ERROR] org.apache.commons.cli.OptionsTest.testRequiredOptionInGroupShouldNotBeInRequiredList -- Time elapsed: 0.001 s &amp;lt;&amp;lt;&amp;lt; FAILURE!
org.opentest4j.AssertionFailedError: Option in group should NOT be in required options list ==&amp;gt; expected: &amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;gt; but was: &amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;gt;
&#160; &#160; &#160; &#160; at org.junit.jupiter.api.AssertionFailureBuilder.build(AssertionFailureBuilder.java:151)
&#160; &#160; &#160; &#160; at org.junit.jupiter.api.AssertionFailureBuilder.buildAndThrow(AssertionFailureBuilder.java:132)
&#160; &#160; &#160; &#160; at org.junit.jupiter.api.AssertFalse.failNotFalse(AssertFalse.java:63)
&#160; &#160; &#160; &#160; at org.junit.jupiter.api.AssertFalse.assertFalse(AssertFalse.java:36)
&#160; &#160; &#160; &#160; at org.junit.jupiter.api.Assertions.assertFalse(Assertions.java:239)
&#160; &#160; &#160; &#160; at org.apache.commons.cli.OptionsTest.testRequiredOptionInGroupShouldNotBeInRequiredList(OptionsTest.java:55)
&#160; &#160; &#160; &#160; at java.lang.reflect.Method.invoke(Method.java:498)
&#160; &#160; &#160; &#160; at java.util.ArrayList.forEach(ArrayList.java:1259)
&#160; &#160; &#160; &#160; at java.util.ArrayList.forEach(ArrayList.java:1259) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Proposed Fix:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;addOptionGroup()&lt;/tt&gt; method should remove the option from &lt;tt&gt;requiredOpts&lt;/tt&gt; after setting required to false:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Options addOptionGroup(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; OptionGroup group) {
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (group.isRequired()) {
&#160; &#160; &#160; &#160; requiredOpts.add(group);
&#160; &#160; }
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Option option : group.getOptions()) {
&#160; &#160; &#160; &#160; option.setRequired(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// Remove option from requiredOpts list
&lt;/span&gt;&#160; &#160; &#160; &#160; requiredOpts.remove(option.getKey());
&#160; &#160; &#160; &#160; addOption(option);
&#160; &#160; &#160; &#160; optionGroups.put(option.getKey(), group);
&#160; &#160; }
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;;
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13622117">CLI-347</key>
            <summary>Options.addOptionGroup() does not remove required options from requiredOpts list</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rickydong">Ruiqi Dong</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 Jun 2025 09:20:23 +0000</created>
                <updated>Tue, 29 Jul 2025 15:21:15 +0000</updated>
                            <resolved>Tue, 29 Jul 2025 15:21:11 +0000</resolved>
                                                    <fixVersion>1.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="1800">0.5h</timeoriginalestimate>
                            <timeestimate seconds="1800">0.5h</timeestimate>
                                        <comments>
                            <comment id="18010695" author="garydgregory" created="Tue, 29 Jul 2025 15:21:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rickydong&quot; class=&quot;user-hover&quot; rel=&quot;rickydong&quot;&gt;rickydong&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you for your report.&lt;/p&gt;

&lt;p&gt;This is now fixed in git master.&#160;&lt;/p&gt;

&lt;p&gt;Please check git master and/or snapshot builds in &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1wjdk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>