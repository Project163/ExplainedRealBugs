<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:52:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CLI-343] OptionFormatter.getBothOpt() lacks validation for Options without opt or longOpt</title>
                <link>https://issues.apache.org/jira/browse/CLI-343</link>
                <project id="12310463" key="CLI">Commons CLI</project>
                    <description>&lt;p&gt;&lt;b&gt;Description:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;OptionFormatter.getBothOpt()&lt;/tt&gt; method contains a comment stating &quot;Option requires at least one of opt or longOpt&quot;, but the method itself does not validate this constraint. Instead, it relies entirely on the &lt;tt&gt;Option&lt;/tt&gt; class validation.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Current Behavior:&lt;/b&gt; The &lt;tt&gt;getBothOpt()&lt;/tt&gt; method would return an empty string if called with an Option that has neither opt nor longOpt. The method includes a comment acknowledging the constraint but doesn&apos;t enforce it.&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Expected Behavior:&lt;/b&gt; &lt;tt&gt;OptionFormatter&lt;/tt&gt; should validate the Option constraint independently, either in its constructor or in the &lt;tt&gt;getBothOpt()&lt;/tt&gt; method&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Unit Test Cases:&lt;/b&gt;&lt;br/&gt;
public class OptionFormatterTest {&lt;/p&gt;

&lt;p&gt;@Test&lt;br/&gt;
@DisplayName(&quot;getBothOpt() should throw exception when both opt and longOpt are null&quot;)&lt;br/&gt;
publicvoidtestGetBothOptWithNullShortAndLongOptShouldThrowException(){&lt;br/&gt;
// Create an Option with both opt and longOpt as null&lt;br/&gt;
// This violates the constraint mentioned in the comment:&lt;br/&gt;
// &quot;Option requires at least one of opt or longOpt&quot;&lt;br/&gt;
Optionoption = Option.builder()&lt;br/&gt;
.required(false)&lt;br/&gt;
.build();&lt;br/&gt;
&#160;&lt;br/&gt;
// This should throw an exception but doesn&apos;t in the current implementation&lt;br/&gt;
assertThrows(IllegalArgumentException.class, () -&amp;gt; &lt;/p&gt;
{
OptionFormatterformatter = OptionFormatter.builder().build(option);
formatter.getBothOpt();
}
&lt;p&gt;, &quot;OptionFormatter should throw exception when Option has neither opt nor longOpt&quot;);&lt;br/&gt;
}&lt;br/&gt;
&#160;&lt;br/&gt;
@Test&lt;br/&gt;
@DisplayName(&quot;OptionFormatter construction should fail when Option has neither opt nor longOpt&quot;)&lt;br/&gt;
publicvoidtestOptionFormatterConstructionWithInvalidOption(){&lt;br/&gt;
// Create an Option without any opt or longOpt&lt;br/&gt;
OptioninvalidOption = Option.builder()&lt;br/&gt;
.desc(&quot;This option has no way to be specified&quot;)&lt;br/&gt;
.build();&lt;br/&gt;
&#160;&lt;br/&gt;
// The builder.build() method should validate and throw exception&lt;br/&gt;
OptionFormatter.Builderbuilder = OptionFormatter.builder();&lt;br/&gt;
&#160;&lt;br/&gt;
assertThrows(IllegalArgumentException.class, () -&amp;gt; &lt;/p&gt;
{
builder.build(invalidOption);
}
&lt;p&gt;, &quot;OptionFormatter.Builder.build() should reject Options without opt or longOpt&quot;);&lt;br/&gt;
}&lt;br/&gt;
}&lt;br/&gt;
&#160;&lt;br/&gt;
&lt;b&gt;Test Results:&lt;/b&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;*INFO*&amp;#93;&lt;/span&gt; Running org.apache.commons.cli.help.&lt;b&gt;OptionFormatterTest&lt;/b&gt;&lt;b&gt;{&lt;/b&gt;}&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;*ERROR*&amp;#93;&lt;/span&gt; &lt;b&gt;Tests&lt;/b&gt; &lt;b&gt;run: 2&lt;/b&gt;, Failures: 0, &lt;b&gt;Errors: 2&lt;/b&gt;, Skipped: 0, Time elapsed: 0.001 s &lt;b&gt;&amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;/b&gt; &amp;#8211; in org.apache.commons.cli.help.&lt;b&gt;OptionFormatterTest&lt;/b&gt;&lt;b&gt;{&lt;/b&gt;}&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;*ERROR*&amp;#93;&lt;/span&gt; org.apache.commons.cli.help.OptionFormatterTest.testGetBothOptWithNullShortAndLongOptShouldThrowException &amp;#8211; Time elapsed: 0 s &amp;lt;&amp;lt;&amp;lt; ERROR!&lt;/p&gt;

&lt;p&gt;java.lang.IllegalArgumentException: Either opt or longOpt must be specified&lt;/p&gt;

&lt;p&gt; at org.apache.commons.cli.Option$Builder.build(Option.java:134)&lt;/p&gt;

&lt;p&gt; at org.apache.commons.cli.help.OptionFormatterTest.testGetBothOptWithNullShortAndLongOptShouldThrowException(OptionFormatterTest.java:36)&lt;/p&gt;

&lt;p&gt; at java.lang.reflect.Method.invoke(Method.java:498)&lt;/p&gt;

&lt;p&gt; at java.util.ArrayList.forEach(ArrayList.java:1259)&lt;/p&gt;

&lt;p&gt; at java.util.ArrayList.forEach(ArrayList.java:1259)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Suggested Fix:&lt;/b&gt;&#160;&lt;/p&gt;

&lt;p&gt;Add validation in the &lt;tt&gt;OptionFormatter&lt;/tt&gt; constructor&lt;/p&gt;

&lt;p&gt;private OptionFormatter(final Option option, final Builder builder) {&lt;br/&gt;
&#160; &#160; if (Util.isEmpty(option.getOpt()) &amp;amp;&amp;amp; Util.isEmpty(option.getLongOpt())) &lt;/p&gt;
{
&#160; &#160; &#160; &#160; throw new IllegalArgumentException(&quot;Option must have at least one of opt or longOpt&quot;);
&#160; &#160; }
&lt;p&gt;&#160; &#160; // ... rest of constructor&lt;br/&gt;
}&lt;/p&gt;</description>
                <environment></environment>
        <key id="13621523">CLI-343</key>
            <summary>OptionFormatter.getBothOpt() lacks validation for Options without opt or longOpt</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rickydong">Ruiqi Dong</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 Jun 2025 07:22:32 +0000</created>
                <updated>Wed, 30 Jul 2025 12:45:26 +0000</updated>
                            <resolved>Wed, 30 Jul 2025 12:45:26 +0000</resolved>
                                    <version>Nightly Builds</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="1800">0.5h</timeoriginalestimate>
                            <timeestimate seconds="1800">0.5h</timeestimate>
                                        <comments>
                            <comment id="18010905" author="garydgregory" created="Wed, 30 Jul 2025 12:45:19 +0000"  >&lt;p&gt;These tests are invalid, the following reflect corrept behavior:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @Test
    void testCli343Part1() {
        assertThrows(IllegalStateException.class, () -&amp;gt; Option.builder().required(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;).build());
    }

    @Test
    void testCli343Part2() {
        assertThrows(IllegalStateException.class, () -&amp;gt; Option.builder().desc(&lt;span class=&quot;code-quote&quot;&gt;&quot;This option has no way to be specified&quot;&lt;/span&gt;).build());
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13077158" name="OptionFormatter.java" size="17816" author="rickydong" created="Mon, 23 Jun 2025 07:22:18 +0000"/>
                            <attachment id="13077157" name="OptionFormatterTest.java" size="2658" author="rickydong" created="Mon, 23 Jun 2025 07:22:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1wfpk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>