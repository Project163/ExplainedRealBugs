<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:51:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CLI-209] OptionBuilder is not thread-safe</title>
                <link>https://issues.apache.org/jira/browse/CLI-209</link>
                <project id="12310463" key="CLI">Commons CLI</project>
                    <description>&lt;p&gt;Class OptionBuilder is not thread-safe.&lt;br/&gt;
It uses one OptionBuilder instance without synchronizing access to it.&lt;br/&gt;
If more than one thread uses OptionBuilder, that can result in invalid Options (suppose a scheduler component).&lt;/p&gt;

&lt;p&gt;Don&apos;t know if this should be fixed. At least the Javadoc should mention the fact that the class is not thread-safe.&lt;br/&gt;
As a workaround, use constructor of class Option.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12475196">CLI-209</key>
            <summary>OptionBuilder is not thread-safe</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="therre">Thomas Herre</reporter>
                        <labels>
                    </labels>
                <created>Mon, 27 Sep 2010 14:25:34 +0000</created>
                <updated>Sat, 9 May 2015 18:43:34 +0000</updated>
                            <resolved>Fri, 29 Oct 2010 10:34:17 +0000</resolved>
                                    <version>1.0</version>
                    <version>1.1</version>
                    <version>1.2</version>
                                    <fixVersion>1.3</fixVersion>
                                    <component>CLI-1.x</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12915331" author="sebb@apache.org" created="Mon, 27 Sep 2010 15:25:39 +0000"  >&lt;p&gt;In fact the OptionBuilder code is at best serially re-usable. &lt;/p&gt;

&lt;p&gt;Even then, the second thread would need to ensure that reset() was called before starting to use the class, because the lack of synch. means that the static variables updated by one thread may not be published to the second thread - i.e. the second thread might see stale values even though the first thread called reset() as part of create(). And of course the threads would have to ensure that they took it in turns to use the class.&lt;/p&gt;

&lt;p&gt;Note that Option is not thread-safe either (settters/getters not synch.), however if the Option instance is confined to a single thread it would be OK.&lt;/p&gt;

&lt;p&gt;Many of the other classes are not thread-safe either, as they have mutable variables that aren&apos;t volatile or synch.&lt;br/&gt;
But if confined to a thread, they would be OK.&lt;/p&gt;

&lt;p&gt;Unless the documentation says otherwise, it&apos;s not safe to assume that a lbrary is thread-safe.&lt;/p&gt;

&lt;p&gt;But I agree that the OptionBuilder is a particular problem.&lt;/p&gt;

&lt;p&gt;It could be fixed by using ThreadLocal for all the static variables. But is it worth the effort?&lt;/p&gt;</comment>
                            <comment id="12915662" author="ebourg" created="Tue, 28 Sep 2010 07:51:51 +0000"  >&lt;p&gt;Just curious, what is the use case that would require making CLI thread safe? A typical application uses CLI on its main thread to parse the command line parameters, that&apos;s far from a multi thread scenario.&lt;/p&gt;</comment>
                            <comment id="12915694" author="sebb@apache.org" created="Tue, 28 Sep 2010 09:54:47 +0000"  >&lt;p&gt;Another way to fix the class would be to turn all the static variables into instance variables, and add parallel instance methods. The static methods would then use a static singleton instance. That would allow use from multiple threads without the overhead of ThreadLocal.&lt;/p&gt;

&lt;p&gt;The library would still not be thread-safe, but at least it could be used by multiple threads in parallel so long as each thread had its own instances.&lt;/p&gt;</comment>
                            <comment id="12926231" author="ebourg" created="Fri, 29 Oct 2010 10:34:17 +0000"  >&lt;p&gt;I updated the Javadoc as suggested by Thomas.&lt;/p&gt;

&lt;p&gt;Ideally I&apos;d like to rewrite OptionBuilder with non static methods, beside the thread safety issue this cause my IDE to show a lot of ugly warnings, that&apos;s not a pleasant experience. Due to the incompatible nature of this modification it will have to wait for a major release. We might also deprecate the class and rewrite it under a new name, for example OptionsBuilder.&lt;/p&gt;</comment>
                            <comment id="13437793" author="karel1980" created="Mon, 20 Aug 2012 11:26:44 +0000"  >&lt;p&gt;I would mark this &apos;wont fix&apos;, since OptionBuilder still is not, by any definition threadsafe.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/CLI-224&quot; title=&quot;OptionBuilder only has static methods, yet many return an OptionBuilder instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CLI-224&quot;&gt;&lt;del&gt;CLI-224&lt;/del&gt;&lt;/a&gt; seems to be a duplicate. Perhaps you could keep this one closed (won&apos;t fix in 1.x line) and keep the other one open for 2.0.&lt;/p&gt;

&lt;p&gt;Two hypothetical use cases for making CLI thread safe:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;A container where multiple users enter commands simultaneously, and where the parsing of the command happens in the container).&lt;/li&gt;
	&lt;li&gt;A program designed to execute multiple commands in parallel: The commands are read from configuration files, and for each line a parallel process is started to parse and execute the command.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40217</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0frfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90041</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>