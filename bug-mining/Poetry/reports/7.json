{"url":"https://api.github.com/repos/python-poetry/poetry/issues/585","repository_url":"https://api.github.com/repos/python-poetry/poetry","labels_url":"https://api.github.com/repos/python-poetry/poetry/issues/585/labels{/name}","comments_url":"https://api.github.com/repos/python-poetry/poetry/issues/585/comments","events_url":"https://api.github.com/repos/python-poetry/poetry/issues/585/events","html_url":"https://github.com/python-poetry/poetry/issues/585","id":375844119,"node_id":"MDU6SXNzdWUzNzU4NDQxMTk=","number":585,"title":"Excluding file with unsupported VCS","user":{"login":"Lothiraldan","id":243665,"node_id":"MDQ6VXNlcjI0MzY2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/243665?v=4","gravatar_id":"","url":"https://api.github.com/users/Lothiraldan","html_url":"https://github.com/Lothiraldan","followers_url":"https://api.github.com/users/Lothiraldan/followers","following_url":"https://api.github.com/users/Lothiraldan/following{/other_user}","gists_url":"https://api.github.com/users/Lothiraldan/gists{/gist_id}","starred_url":"https://api.github.com/users/Lothiraldan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lothiraldan/subscriptions","organizations_url":"https://api.github.com/users/Lothiraldan/orgs","repos_url":"https://api.github.com/users/Lothiraldan/repos","events_url":"https://api.github.com/users/Lothiraldan/events{/privacy}","received_events_url":"https://api.github.com/users/Lothiraldan/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":851628021,"node_id":"MDU6TGFiZWw4NTE2MjgwMjE=","url":"https://api.github.com/repos/python-poetry/poetry/labels/kind/bug","name":"kind/bug","color":"f74a2a","default":false,"description":"Something isn't working as expected"},{"id":851634863,"node_id":"MDU6TGFiZWw4NTE2MzQ4NjM=","url":"https://api.github.com/repos/python-poetry/poetry/labels/area/build-system","name":"area/build-system","color":"7e56c4","default":false,"description":"Related to PEP 517 packaging (see poetry-core)"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-10-31T08:11:54Z","updated_at":"2024-03-03T18:05:24Z","closed_at":"2018-11-05T18:04:37Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!-- Checked checkbox should look like this: [x] -->\r\n- [x] I am on the [latest](https://github.com/sdispater/poetry/releases/latest) Poetry version.\r\n- [x] I have searched the [issues](https://github.com/sdispater/poetry/issues) of this repo and believe that this is not a duplicate.\r\n- [x] If an exception occurs when executing a command, I executed it again in debug mode (`-vvv` option).\r\n\r\n- **OS version and name**: Fedora 28\r\n- **Poetry version**: 0.12.5\r\n- **Link of a [Gist](https://gist.github.com/) with the contents of your pyproject.toml file**: https://gist.github.com/Lothiraldan/7e4c1ffde3ed90ec183ad4eb5e72a44c\r\n\r\n## Issue\r\n<!-- Now feel free to write your issue, but please be descriptive! Thanks again ðŸ™Œ â¤ï¸ -->\r\n\r\nHello, first thank you for your work on poetry, packaging in Python is something we should be better at and poetry looks very promising.\r\n\r\nI'm trying to use poetry with one of my project https://github.com/lothiraldan/balto which will include a compiled react project. I develop the project using Mercurial and then export the repository to Github.\r\n\r\nThe first time I ran `poetry build`, I saw that the nodes_modules directory was included so I try explictly excluding it with:\r\n\r\n```toml\r\n[tool.poetry]\r\nexclude = [\"balto/web_interfaces/balto_react/node_modules/**/*\"]\r\n```\r\n\r\nBut it didn't help.\r\n\r\nI start taking a look at the code and found that the `find_excluded_files` early abort in case it didn't find the VCS (in my case Mercurial). Apart from adding Mercurial support (which I may do in the future), I think excluding files shouldn't depend on projects using a supported VCS.\r\n\r\nI applied the following diff locally to still reads the explicitely excluded files that did the trick:\r\n\r\n```diff\r\ndiff --git a/poetry/masonry/builders/builder.py b/poetry/masonry/builders/builder.py\r\nindex 627e006..477ec8d 100644\r\n--- a/poetry/masonry/builders/builder.py\r\n+++ b/poetry/masonry/builders/builder.py\r\n@@ -43,14 +43,16 @@ class Builder(object):\r\n         # Checking VCS\r\n         vcs = get_vcs(self._path)\r\n         if not vcs:\r\n-            return []\r\n+            vcs_ignored_files = []\r\n+        else:\r\n+            vcs_ignored_files = vcs.get_ignored_files()\r\n \r\n         explicitely_excluded = []\r\n         for excluded_glob in self._package.exclude:\r\n             for excluded in self._path.glob(excluded_glob):\r\n                 explicitely_excluded.append(excluded)\r\n \r\n-        ignored = vcs.get_ignored_files() + explicitely_excluded\r\n+        ignored = vcs_ignored_files + explicitely_excluded\r\n         result = []\r\n         for file in ignored:\r\n             try:\r\n```\r\n\r\nI can send a PR with it if the code looks correct and the behavior change is ok.","closed_by":{"login":"sdispater","id":555648,"node_id":"MDQ6VXNlcjU1NTY0OA==","avatar_url":"https://avatars.githubusercontent.com/u/555648?v=4","gravatar_id":"","url":"https://api.github.com/users/sdispater","html_url":"https://github.com/sdispater","followers_url":"https://api.github.com/users/sdispater/followers","following_url":"https://api.github.com/users/sdispater/following{/other_user}","gists_url":"https://api.github.com/users/sdispater/gists{/gist_id}","starred_url":"https://api.github.com/users/sdispater/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sdispater/subscriptions","organizations_url":"https://api.github.com/users/sdispater/orgs","repos_url":"https://api.github.com/users/sdispater/repos","events_url":"https://api.github.com/users/sdispater/events{/privacy}","received_events_url":"https://api.github.com/users/sdispater/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python-poetry/poetry/issues/585/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python-poetry/poetry/issues/585/timeline","performed_via_github_app":null,"state_reason":"completed"}