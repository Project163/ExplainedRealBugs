{"url":"https://api.github.com/repos/python-poetry/poetry/issues/2867","repository_url":"https://api.github.com/repos/python-poetry/poetry","labels_url":"https://api.github.com/repos/python-poetry/poetry/issues/2867/labels{/name}","comments_url":"https://api.github.com/repos/python-poetry/poetry/issues/2867/comments","events_url":"https://api.github.com/repos/python-poetry/poetry/issues/2867/events","html_url":"https://github.com/python-poetry/poetry/issues/2867","id":688615943,"node_id":"MDU6SXNzdWU2ODg2MTU5NDM=","number":2867,"title":"Poetry always detects venvs created by mingw-w64-x86_64-python (MSYS2) as broken","user":{"login":"daniel-a-melo","id":6760808,"node_id":"MDQ6VXNlcjY3NjA4MDg=","avatar_url":"https://avatars.githubusercontent.com/u/6760808?v=4","gravatar_id":"","url":"https://api.github.com/users/daniel-a-melo","html_url":"https://github.com/daniel-a-melo","followers_url":"https://api.github.com/users/daniel-a-melo/followers","following_url":"https://api.github.com/users/daniel-a-melo/following{/other_user}","gists_url":"https://api.github.com/users/daniel-a-melo/gists{/gist_id}","starred_url":"https://api.github.com/users/daniel-a-melo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daniel-a-melo/subscriptions","organizations_url":"https://api.github.com/users/daniel-a-melo/orgs","repos_url":"https://api.github.com/users/daniel-a-melo/repos","events_url":"https://api.github.com/users/daniel-a-melo/events{/privacy}","received_events_url":"https://api.github.com/users/daniel-a-melo/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":851628021,"node_id":"MDU6TGFiZWw4NTE2MjgwMjE=","url":"https://api.github.com/repos/python-poetry/poetry/labels/kind/bug","name":"kind/bug","color":"f74a2a","default":false,"description":"Something isn't working as expected"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-08-29T22:46:26Z","updated_at":"2024-03-02T06:05:57Z","closed_at":"2021-03-21T01:21:03Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!-- Checked checkbox should look like this: [x] -->\r\n- [X] I am on the [latest](https://github.com/python-poetry/poetry/releases/latest) Poetry version.\r\n- [X] I have searched the [issues](https://github.com/python-poetry/poetry/issues) of this repo and believe that this is not a duplicate.\r\n- [X] If an exception occurs when executing a command, I executed it again in debug mode (`-vvv` option).\r\n\r\n<!--\r\n  Once those are done, if you're able to fill in the following list with your information,\r\n  it'd be very helpful to whoever handles the issue.\r\n-->\r\n\r\n- **OS version and name**: Windows 10\r\n- **Poetry version**: 1.0.10\r\n- **Link of a [Gist](https://gist.github.com/) with the contents of your pyproject.toml file**: \r\n\r\n```toml\r\n[tool.poetry]\r\nname = \"poetry-demo2\"\r\nversion = \"0.1.0\"\r\ndescription = \"\"\r\nauthors = [\"Your Name <you@example.com>\"]\r\n\r\n[tool.poetry.dependencies]\r\npython = \"^3.8\"\r\npendulum = \"^2.1.2\"\r\n\r\n[tool.poetry.dev-dependencies]\r\npytest = \"^5.2\"\r\n\r\n[build-system]\r\nrequires = [\"poetry>=0.12\"]\r\nbuild-backend = \"poetry.masonry.api\"\r\n```\r\n\r\n## Issue\r\n<!-- Now feel free to write your issue, but please be descriptive! Thanks again ðŸ™Œ â¤ï¸ -->\r\n\r\nWhen using MSYS2, package `mingw-w64-x86_64-python`  (https://packages.msys2.org/package/mingw-w64-x86_64-python) venvs are created with POSIX-style layout :\r\n\r\n```\r\n daniel@GALILEO ~/A/L/p/C/v/poetry-demo2-raCoCXDb-py3.8> pwd\r\n/c/Users/Daniel/AppData/Local/pypoetry/Cache/virtualenvs/poetry-demo2-raCoCXDb-py3.8\r\ndaniel@GALILEO ~/A/L/p/C/v/poetry-demo2-raCoCXDb-py3.8> ls -al\r\ntotal 5\r\ndrwxr-xr-x 1 daniel daniel   0 Aug 29 23:05 ./\r\ndrwxr-xr-x 1 daniel daniel   0 Aug 29 23:05 ../\r\ndrwxr-xr-x 1 daniel daniel   0 Aug 29 23:06 bin/\r\ndrwxr-xr-x 1 daniel daniel   0 Aug 29 23:05 include/\r\ndrwxr-xr-x 1 daniel daniel   0 Aug 29 23:05 lib/\r\n-rw-r--r-- 1 daniel daniel 106 Aug 29 23:05 pyvenv.cfg\r\n```\r\n\r\nEvery subsequent command will display the message \"The virtual environment found in <path> seems to be broken\" and the venv will be recreated. I\r\n\r\n**Steps to reproduce**\r\n\r\n1 - Install MSYS2\r\n2 - From MSYS shell, install python mingw64 build : `pacman -S mingw-w64-x86_64-python`\r\n3 - Install poetry\r\n4 - `poetry new poetry-demo`\r\n5 - `poetry install` \r\n6 - `poetry show` . The message will be displayed and venv will be recreated.\r\n\r\nThe cause seems to be in  https://github.com/python-poetry/poetry/blob/c22052cb7a37dfe45c3cb02650eb7b5e8450b940/poetry/utils/env.py#L746\r\n\r\nAs the system is detected to be Windows it expects the bin dir to be `Scripts` which is not the case for venvs created with this python distro. \r\n\r\nI changed this line to be `bin_dir = \"bin\"` and it seems to work correctly. \r\n\r\nit is possible to detect this python distro with `sysconfig.get_platform()` . It will return `mingw` . See https://stackoverflow.com/questions/35956180/how-to-determine-the-python-is-mingw-or-official-build\r\n","closed_by":{"login":"abn","id":165325,"node_id":"MDQ6VXNlcjE2NTMyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/165325?v=4","gravatar_id":"","url":"https://api.github.com/users/abn","html_url":"https://github.com/abn","followers_url":"https://api.github.com/users/abn/followers","following_url":"https://api.github.com/users/abn/following{/other_user}","gists_url":"https://api.github.com/users/abn/gists{/gist_id}","starred_url":"https://api.github.com/users/abn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abn/subscriptions","organizations_url":"https://api.github.com/users/abn/orgs","repos_url":"https://api.github.com/users/abn/repos","events_url":"https://api.github.com/users/abn/events{/privacy}","received_events_url":"https://api.github.com/users/abn/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python-poetry/poetry/issues/2867/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python-poetry/poetry/issues/2867/timeline","performed_via_github_app":null,"state_reason":"completed"}