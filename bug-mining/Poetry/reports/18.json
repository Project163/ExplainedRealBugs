{"url":"https://api.github.com/repos/python-poetry/poetry/issues/1150","repository_url":"https://api.github.com/repos/python-poetry/poetry","labels_url":"https://api.github.com/repos/python-poetry/poetry/issues/1150/labels{/name}","comments_url":"https://api.github.com/repos/python-poetry/poetry/issues/1150/comments","events_url":"https://api.github.com/repos/python-poetry/poetry/issues/1150/events","html_url":"https://github.com/python-poetry/poetry/issues/1150","id":452741781,"node_id":"MDU6SXNzdWU0NTI3NDE3ODE=","number":1150,"title":"Pre-release `~=` constrains are mis calculated","user":{"login":"epage","id":60961,"node_id":"MDQ6VXNlcjYwOTYx","avatar_url":"https://avatars.githubusercontent.com/u/60961?v=4","gravatar_id":"","url":"https://api.github.com/users/epage","html_url":"https://github.com/epage","followers_url":"https://api.github.com/users/epage/followers","following_url":"https://api.github.com/users/epage/following{/other_user}","gists_url":"https://api.github.com/users/epage/gists{/gist_id}","starred_url":"https://api.github.com/users/epage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/epage/subscriptions","organizations_url":"https://api.github.com/users/epage/orgs","repos_url":"https://api.github.com/users/epage/repos","events_url":"https://api.github.com/users/epage/events{/privacy}","received_events_url":"https://api.github.com/users/epage/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2019-06-05T22:16:04Z","updated_at":"2024-03-03T08:05:48Z","closed_at":"2020-01-06T17:47:39Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n  Hi there! Thank you for discovering and submitting an issue.\r\n\r\n  Before you submit this; let's make sure of a few things.\r\n  Please make sure the following boxes are ticked if they are correct.\r\n  If not, please try and fulfill these first.\r\n-->\r\n\r\n<!-- Checked checkbox should look like this: [x] -->\r\n- [x] I am on the [latest](https://github.com/sdispater/poetry/releases/latest) Poetry version.\r\n- [x] I have searched the [issues](https://github.com/sdispater/poetry/issues) of this repo and believe that this is not a duplicate.\r\n- [ ] If an exception occurs when executing a command, I executed it again in debug mode (`-vvv` option).\r\n\r\n<!--\r\n  Once those are done, if you're able to fill in the following list with your information,\r\n  it'd be very helpful to whoever handles the issue.\r\n-->\r\n\r\n- **OS version and name**: Windows\r\n- **Poetry version**: 0.12.16\r\n- **Link of a [Gist](https://gist.github.com/) with the contents of your pyproject.toml file**: N/A, requires access to a proprietary pypi instance\r\n\r\n## Issue\r\n<!-- Now feel free to write your issue, but please be descriptive! Thanks again ðŸ™Œ â¤ï¸ -->\r\n\r\nMy constraints aren't resolving.\r\n\r\nA rough look at my dependency tree\r\n- A: `B = \"^0.7.5\" via poetry\r\n- B: `\"C~=0.2.0dev16\"` via setup.py\r\n\r\nPoetry complains that it cannot resolve B's dependency on C\r\n```\r\n[SolverProblemError]\r\nBecause B (0.7.5) depends on C(>=0.2.0,<0.3.0) which doesn't match any versions, B is forbidden.\r\nSo, because no versions of B match >0.7.5,<0.8.0\r\n and A depends on B (^0.7.5), version solving failed.\r\n```\r\n\r\nI traced the problem down into [`semver/__init__.py:parse_single_constraint`](https://github.com/sdispater/poetry/blob/master/poetry/semver/__init__.py#L67) where the constraint\r\n- `~=0.2.0dev16`\r\ngets compiled into\r\n- `>=0.2.0,<0.3.0`\r\n\r\nIn contrast, the constraint\r\n- `~=2.0.dev0`\r\ncorrectly gets compiled into\r\n- ` >=2.0.dev0,<3.0.0`\r\n\r\nThe problem seems to be\r\n```python\r\n        if precision == 2:\r\n            low = version\r\n            high = version.stable.next_major\r\n        else:\r\n            low = Version(version.major, version.minor, 0)\r\n            high = version.stable.next_minor\r\n```\r\nwhere if the `precision` is 1 or 3, then the pre-release is dropped from `low`, disqualifying them from resolving the constraint.","closed_by":{"login":"sdispater","id":555648,"node_id":"MDQ6VXNlcjU1NTY0OA==","avatar_url":"https://avatars.githubusercontent.com/u/555648?v=4","gravatar_id":"","url":"https://api.github.com/users/sdispater","html_url":"https://github.com/sdispater","followers_url":"https://api.github.com/users/sdispater/followers","following_url":"https://api.github.com/users/sdispater/following{/other_user}","gists_url":"https://api.github.com/users/sdispater/gists{/gist_id}","starred_url":"https://api.github.com/users/sdispater/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sdispater/subscriptions","organizations_url":"https://api.github.com/users/sdispater/orgs","repos_url":"https://api.github.com/users/sdispater/repos","events_url":"https://api.github.com/users/sdispater/events{/privacy}","received_events_url":"https://api.github.com/users/sdispater/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/python-poetry/poetry/issues/1150/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/python-poetry/poetry/issues/1150/timeline","performed_via_github_app":null,"state_reason":"completed"}