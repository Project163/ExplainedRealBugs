<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:16:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LANG-456] HashCodeBuilder throws StackOverflowError in bidirectional navigable association</title>
                <link>https://issues.apache.org/jira/browse/LANG-456</link>
                <project id="12310481" key="LANG">Commons Lang</project>
                    <description>&lt;p&gt;This is not the reflection methods, it is the regular HashCodeBuilder append methods. It causes EqualsBuilder, ToStringBuilder, CompareToBuilder to also throw the StackOverflowException, but those methods work when one of the HashCodeBuilder bidirectional association attributes .hashCode() is commented out. The problem is that all of the builders call registerObject() which creates a hashCode, but only the reflectionAppend method checks if an object is registered.&lt;/p&gt;

&lt;p&gt;Bi-directional associations are a very common pattern in Jaxb and Hibernate. In this case, I generate code from a model in order to avoid the reflection penalty - I already know what the attributes are at compile time, so I use .append instead of .reflectionAppend.&lt;/p&gt;

&lt;p&gt;See attached example + unit test. One side of the bidirectional association must be commented out in the hashCode method.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Widows XP. Sun JDK 1.5 or 1.6.&lt;/p&gt;</environment>
        <key id="12403156">LANG-456</key>
            <summary>HashCodeBuilder throws StackOverflowError in bidirectional navigable association</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="bob fields">Bob Fields</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Aug 2008 14:20:56 +0000</created>
                <updated>Wed, 8 Jun 2016 20:32:15 +0000</updated>
                                            <version>2.4</version>
                                                    <component>lang.builder.*</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="12626129" author="bob fields" created="Wed, 27 Aug 2008 14:21:57 +0000"  >&lt;p&gt;BidirectionalTest demonstrating StackOverflowError when using non-reflection HashCodeBuilder methods.&lt;/p&gt;</comment>
                            <comment id="12626162" author="jwcarman" created="Wed, 27 Aug 2008 15:32:28 +0000"  >&lt;p&gt;Have you tried using UUIDs rather than basing hashCode/equals on &quot;business&quot; fields?&lt;/p&gt;</comment>
                            <comment id="12633169" author="sebb@apache.org" created="Mon, 22 Sep 2008 08:30:46 +0000"  >&lt;p&gt;Can you provide a simpler test case that works with Java 1.3 and does not require JAXB?&lt;/p&gt;</comment>
                            <comment id="12633934" author="bob fields" created="Tue, 23 Sep 2008 22:12:45 +0000"  >&lt;p&gt;Does anybody even use JDK 1.3 any more? I haven&apos;t had it on my machine in years.&lt;/p&gt;

&lt;p&gt;Here&apos;s an updated version with all the Jaxb stuff removed, built with JDK 1.4.2 with compiler compliance level set to JDK 1.3, that should work for you. There&apos;s no dependencies other than commons-lang and JUnit.&lt;/p&gt;</comment>
                            <comment id="12633948" author="sebb@apache.org" created="Tue, 23 Sep 2008 22:41:42 +0000"  >&lt;p&gt;Thanks for the updated test case which causes the expected stack overflow.&lt;/p&gt;

&lt;p&gt;In fact LANG is currently targeted at Java 1.2 - I believe it may be used by Java ME code, which is not so easily upgraded.&lt;/p&gt;

&lt;p&gt;==&lt;/p&gt;

&lt;p&gt;Since the HashCode for the Bidirectional class depends on the hash code for the JavBVO class and vice versa, it&apos;s not surprising that there is a stack overflow.&lt;/p&gt;

&lt;p&gt;If you were not using the HashCodeBuider, how would you define the hashcodes?&lt;/p&gt;
</comment>
                            <comment id="12634175" author="bob fields" created="Wed, 24 Sep 2008 15:48:27 +0000"  >&lt;p&gt;The other builder methods (toString, compare, equals) specifically check for recursive behavior and prevent a StackOverflow.&lt;/p&gt;

&lt;p&gt;We use HashCodeBuilder globally on all ValueObjects generated by templates using AndroMDA www.andromda.org. Right now I check for the recursive relationship in the model and remove one side of the relationship from the HashCodeBuilder generated code output. That defaults to the hashCode for all attributes (except the recursive one on one side) plus the hashCode of the ancestor.&lt;/p&gt;</comment>
                            <comment id="12982482" author="bayard" created="Mon, 17 Jan 2011 05:48:28 +0000"  >&lt;p&gt;Moving to 3.1; there&apos;s no patch and I don&apos;t think a fix would be backwards incompatible &lt;span class=&quot;error&quot;&gt;&amp;#91;i.e. doesn&amp;#39;t have to be done in 3.0&amp;#93;&lt;/span&gt;.&lt;/p&gt;</comment>
                            <comment id="13801984" author="woon_san" created="Tue, 22 Oct 2013 16:27:36 +0000"  >&lt;p&gt;Attaching my patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/LANG-456&quot; title=&quot;HashCodeBuilder throws StackOverflowError in bidirectional navigable association&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LANG-456&quot;&gt;LANG-456&lt;/a&gt;-patch.txt) to fix this issue.&lt;/p&gt;

&lt;p&gt;I moved the isRegistered()&lt;del&gt;&amp;gt;register()&lt;/del&gt;&amp;gt;unregister() code from #reflectionAppend() to #append().&lt;br/&gt;
I think this should be more reasonable because #reflectionAppend() invokes #append() method anyway.&lt;br/&gt;
Also, #append(Object) code has been improved to check registration status only when the object argument is neither primitive nor String type.&lt;/p&gt;

&lt;p&gt;Please take a review.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;/p&gt;

&lt;p&gt;Woonsan&lt;/p&gt;</comment>
                            <comment id="13801990" author="bayard" created="Tue, 22 Oct 2013 16:31:05 +0000"  >&lt;p&gt;Thanks Woonsan &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Moving to Review Patch.&lt;/p&gt;</comment>
                            <comment id="14523038" author="kinow" created="Fri, 1 May 2015 10:50:44 +0000"  >&lt;p&gt;Applying the patch to my project today resulted in errors both via command line and using Eclipse (guess it&apos;s something with my `patch -p0 -i ...` command?). Using Eclipse, however, let me at least copy the test code without the +&apos;s in the beginning of the line. &lt;/p&gt;

&lt;p&gt;After importing the tests from the patch, the bug was reproducible via a new test method. Later I imported the part of the code that fixes the issue, and it worked like a charm. &lt;/p&gt;

&lt;p&gt;+1 to applying the Woonsan&apos;s patch&lt;/p&gt;</comment>
                            <comment id="14523854" author="britter" created="Fri, 1 May 2015 20:28:30 +0000"  >&lt;p&gt;Fixed by applying 0001-&lt;a href=&quot;https://issues.apache.org/jira/browse/LANG-456&quot; title=&quot;HashCodeBuilder throws StackOverflowError in bidirectional navigable association&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LANG-456&quot;&gt;LANG-456&lt;/a&gt;-HashCodeBuilder-throws-StackOverflowError-i.patch. Thanks to all who helped fixing this.&lt;/p&gt;</comment>
                            <comment id="15321388" author="pascalschumacher" created="Wed, 8 Jun 2016 20:32:09 +0000"  >&lt;p&gt;I reverted the commit because it caused &lt;a href=&quot;https://issues.apache.org/jira/browse/LANG-1229&quot; title=&quot;Performance regression due to cyclic hashCode guard&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LANG-1229&quot;&gt;&lt;del&gt;LANG-1229&lt;/del&gt;&lt;/a&gt;. I believe we can not justify a major performance regression to add this feature. The best approach would be to add a new method that appends with the check (see discussion of &lt;a href=&quot;https://issues.apache.org/jira/browse/LANG-1229&quot; title=&quot;Performance regression due to cyclic hashCode guard&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LANG-1229&quot;&gt;&lt;del&gt;LANG-1229&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12350282">LANG-279</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12969830">LANG-1229</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12729738" name="0001-LANG-456-HashCodeBuilder-throws-StackOverflowError-i.patch" size="5790" author="kinow" created="Fri, 1 May 2015 10:50:44 +0000"/>
                            <attachment id="12390791" name="HashCodeBuilderStackOverflow.zip" size="18264" author="bob fields" created="Tue, 23 Sep 2008 22:12:45 +0000"/>
                            <attachment id="12609676" name="LANG-456-patch.txt" size="7679" author="woon_san" created="Tue, 22 Oct 2013 16:27:36 +0000"/>
                            <attachment id="12389004" name="StackOverflowError.zip" size="14427" author="bob fields" created="Wed, 27 Aug 2008 14:21:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3032</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b5v3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63062</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>