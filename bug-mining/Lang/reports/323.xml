<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:16:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LANG-796] DateUtils.addDays does not work properly with daylight saving time (DST)</title>
                <link>https://issues.apache.org/jira/browse/LANG-796</link>
                <project id="12310481" key="LANG">Commons Lang</project>
                    <description>&lt;p&gt;&lt;tt&gt;DateUtils.addDays&lt;/tt&gt; does not work properly with daylight saving time. The signature of the method is &lt;tt&gt;Date addDays(Date date, int amount)&lt;/tt&gt; and the javadocs says:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Adds a number of days to a date returning a new object. The original date object is unchanged&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;so if X=date.getTime() is the number of milliseconds of the date in input,&lt;br/&gt;
the expected behaviour is that the returned Date has a number of milliseconds equal to X+amount*(86400000), where 86400000 is the number of milliseconds in one day.&lt;br/&gt;
But when the calculation goes across the DST change date, the number of milliseconds added does not correspond to whole days.&lt;/p&gt;

&lt;p&gt;For example, here in Brussels, this code fragment:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Date input = DateUtils.parseDateStrictly(&lt;span class=&quot;code-quote&quot;&gt;&quot;25-03-2012_00:00&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] { &lt;span class=&quot;code-quote&quot;&gt;&quot;dd-MM-yyyy_HH:mm&quot;&lt;/span&gt; });
Date output = DateUtils.addDays(input, 1);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;will give:&lt;/p&gt;

&lt;p&gt;&apos;input&apos; equals to &quot;Sun Mar 25 00:00:00 CET 2012&quot;    ==&amp;gt; input.getTime() equals to 1332630000000&lt;br/&gt;
&apos;output&apos; equals to &quot;Mon Mar 26 00:00:00 CEST 2012&quot;  ==&amp;gt; output.getTime() equals to 1332712800000&lt;/p&gt;

&lt;p&gt;where 1332712800000-1332630000000=82800000 &amp;lt; 86400000&lt;br/&gt;
(in fact 82800000 is equivalent to 23h).&lt;/p&gt;

&lt;p&gt;Since &lt;tt&gt;addDays&lt;/tt&gt; is working with objects Date, it should not be influenced by events like the DST.&lt;/p&gt;


&lt;p&gt;Proposed solution: replace the current implementation&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Date add(Date date, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; calendarField, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; amount) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (date == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-quote&quot;&gt;&quot;The date must not be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;);
        }
        Calendar c = Calendar.getInstance();
        c.setTime(date);
        c.add(calendarField, amount);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; c.getTime();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;based on Calendar with an implementation that works only with Date objects, for example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Date add(Date date, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; calendarField, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; amount) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (date == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-quote&quot;&gt;&quot;The date must not be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Date(input.getTime() + amount * 86400000l);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</description>
                <environment></environment>
        <key id="12548305">LANG-796</key>
            <summary>DateUtils.addDays does not work properly with daylight saving time (DST)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="nicola.barbiero">Nicola Barbiero</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Mar 2012 13:20:58 +0000</created>
                <updated>Wed, 22 Oct 2014 14:50:51 +0000</updated>
                                            <version>3.3.2</version>
                                    <fixVersion>Discussion</fixVersion>
                                    <component>lang.time.*</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13239466" author="adrianc@hlmksw.com" created="Tue, 27 Mar 2012 13:57:40 +0000"  >&lt;p&gt;The current behavior is correct. The result added one day. One day is NOT equal to 86400000 milliseconds - as you can see from the result.&lt;/p&gt;</comment>
                            <comment id="13239560" author="nicola.barbiero" created="Tue, 27 Mar 2012 15:34:48 +0000"  >&lt;p&gt;From &lt;a href=&quot;http://docs.oracle.com/javase/6/docs/api/java/util/Date.html:&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.oracle.com/javase/6/docs/api/java/util/Date.html:&lt;/a&gt;&lt;br/&gt;
&quot;The class Date represents a specific instant in time, with millisecond precision. &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt; the Date class is intended to reflect coordinated universal time (UTC) &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt; Nearly all modern operating systems assume that 1 day = 24 &#215; 60 &#215; 60 = 86400 seconds in all cases.&quot;&lt;/p&gt;

&lt;p&gt;The concept of daylight saving time (DST) is not present in UTC, and UTC is NEVER effected by DST, so a method that receives a Date in input and returns a Date should never be effected by DST.&lt;br/&gt;
&lt;a href=&quot;http://en.wikipedia.org/wiki/Coordinated_Universal_Time#Daylight_saving&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://en.wikipedia.org/wiki/Coordinated_Universal_Time#Daylight_saving&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The current behavior would be correct if working on Calendar objects, since a Calendar takes in account the concept of DST.&lt;/p&gt;

&lt;p&gt;By the way, even if the final choice will be to not change the current behavior for this method, at least it should be better documented in its javadoc, to avoid misuses and misunderstanding in its way of working.&lt;/p&gt;</comment>
                            <comment id="13239606" author="adrianc@hlmksw.com" created="Tue, 27 Mar 2012 16:31:48 +0000"  >&lt;p&gt;If you want to perform millisecond arithmetic, then I recommend you use long values and avoid using the DateUtils class.&lt;/p&gt;

&lt;p&gt;The JavaDocs seem clear to me - the method adds a day, not 86400000 milliseconds.&lt;/p&gt;</comment>
                            <comment id="13239608" author="tn" created="Tue, 27 Mar 2012 16:36:21 +0000"  >&lt;p&gt;I had to deal with DST problems just recently myself:&lt;/p&gt;

&lt;p&gt;The behaviour of DateUtils is perfectly valid if you consider your local timezone. The method uses internally the default Calendar instance (that is set to your local timezone) and is thus affected by DST. If you want to operate on UTC dates only, use a Calendar configured for the UTC timezone.&lt;/p&gt;

&lt;p&gt;It could be elaborated a bit more in the javadoc, so that people are aware of the fact, but there is nothing wrong with it imho.&lt;/p&gt;</comment>
                            <comment id="13240283" author="nicola.barbiero" created="Wed, 28 Mar 2012 08:11:20 +0000"  >&lt;p&gt;That&apos;s the point: DateUtils.addDays receives in input a Date, that is an absolute time, so it should not be influenced by DST. Using a Calendar configured for the UTC timezone means to not use DateUtils.addDays, since there is no overloading method that receives a Calendar in input.&lt;br/&gt;
As Thomas said, the method uses internally the default Calendar instance, that is set to the local timezone of the server where the code is running, and this is quite problematic in those time of cloud computing, because the code will work differently if the server is located in a zone where DST is applied or not (some countries do not implement any DST at all).&lt;/p&gt;

&lt;p&gt;Summarizing, for me the issue is that the user of this method is affected by the TimeZone but he has no way to set this TimeZone, because always the default Calendar instance and the local timezone are used.&lt;/p&gt;</comment>
                            <comment id="13240293" author="tn" created="Wed, 28 Mar 2012 08:36:29 +0000"  >&lt;p&gt;The whole idea of DateUtils is to provide convenience methods when manipulating Date objects. The use-case that you describe, and I assume that&apos;s quite a common one, requires a properly configured Calendar object. Now we could add a method like this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  public static Date add(Date date, int calendarField, int amount, Calendar cal) {
     cal.setTime(date);
     cal.add(calendarField, amount);
     return cal.getTime();
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But what&apos;s the point of it? If you already have the Calendar that you want to use, why not just do it straight-away?&lt;/p&gt;

&lt;p&gt;The fix that you propose would only support the UTC timezone, and will return wrong results for different timezones in case of a DST. While you are right, when you say that a Date object is not influenced by DST, any manipulation of it is in fact (or better could, depending on the timezone). When you need to operate in UTC time, always use proper configured Calendars (and also Formatters) for the UTC timezone (or set your local timezone to UTC).&lt;/p&gt;</comment>
                            <comment id="13245250" author="tn" created="Tue, 3 Apr 2012 12:13:07 +0000"  >&lt;p&gt;I was still musing about this issue, and maybe adding an additional version with a TimeZone parameter could make sense:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;public static Date add(Date date, int calendarField, int amount, TimeZone tz) {
     Calendar cal = Calendar.getInstance(tz);
     cal.setTime(date);
     cal.add(calendarField, amount);
     return cal.getTime();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But to be consistent, this should be done for all methods (e.g. addDays, addMonths, ..), and would definitely bloat the API.&lt;/p&gt;</comment>
                            <comment id="13245300" author="joehni" created="Tue, 3 Apr 2012 13:15:04 +0000"  >&lt;p&gt;What about creating UTCDateUtils instead that operates on UTC and is therefore independent of any TZ? Then we have simply to properly document both types. We could use a package private base class to share common functionality.&lt;/p&gt;</comment>
                            <comment id="13246097" author="tn" created="Wed, 4 Apr 2012 07:53:49 +0000"  >&lt;p&gt;I like the idea somehow, but it would also mean to duplicate the signature of a class, as all the methods in DateUtils are static.&lt;/p&gt;

&lt;p&gt;Something that I have in mind, is to extract the current interface of DateUtils into a separate class TBD. DateUtils would then provide two static members DEFAULT and UTC, which instantiate the separate class TBD with the corresponding timezones (TimeZone.getDefault() or TimeZone.getTimeZone(&quot;UTC&quot;)). Additionally to mimick the current behavior, the existing static methods in DateUtils would call the corresponding methods of DateUtils.DEFAULT.&lt;/p&gt;

&lt;p&gt;Users can instantiate also a TBD instance by providing a custom timezone.&lt;/p&gt;

&lt;p&gt;But this is maybe an overkill, the same can be achieved by altering the default Timezone via TimeZone.setDefault. Although there are surely use-cases where this is not possible or desirable (e.g. due to multi-threading).&lt;/p&gt;</comment>
                            <comment id="13461108" author="dmjones500" created="Sat, 22 Sep 2012 10:43:56 +0000"  >&lt;p&gt;I agree with Nicola. A class that intends to work with Date values should not be interested in daylight savings. I suspect this was an unintentional error on the part of the original implementation.&lt;/p&gt;

&lt;p&gt;At the very least, the Javadocs need to change to reflect this behaviour.&lt;/p&gt;

&lt;p&gt;The issue with changing the code is that people may already be relying on this behaviour. All of the &lt;tt&gt;addXXX&lt;/tt&gt; methods use Calendars and would be impacted.&lt;/p&gt;</comment>
                            <comment id="13461528" author="nicola.barbiero" created="Sun, 23 Sep 2012 22:29:03 +0000"  >&lt;p&gt;Right, changing the code now might be dangerous...&lt;br/&gt;
And of course I agree that an update of Javadoc will be harmless for those who are already using the library, and helpful for everyone.&lt;/p&gt;</comment>
                            <comment id="13796579" author="bayard" created="Wed, 16 Oct 2013 08:56:10 +0000"  >&lt;p&gt;Javadoc patch needed.&lt;/p&gt;</comment>
                            <comment id="14149033" author="dmjones500" created="Fri, 26 Sep 2014 11:23:14 +0000"  >&lt;p&gt;I&apos;ve just updated the Javadoc to provide a warning in the opening paragraphs:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Several methods are provided for adding to &lt;tt&gt;Date&lt;/tt&gt; objects, of the form &lt;br/&gt;
&lt;tt&gt;addXXX(Date date, int amount)&lt;/tt&gt;. It is important to note these methods &lt;br/&gt;
use a &lt;tt&gt;Calendar&lt;/tt&gt; internally (with default timezone and locale) and may&lt;br/&gt;
be affected by changes to daylight saving time (DST).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We should discuss whether this behaviour should change in a future release. I&apos;ve updated the affected version to the latest, since this is still an issue.&lt;/p&gt;

&lt;p&gt;SVN log:&lt;/p&gt;

&lt;p&gt;Author: djones&lt;br/&gt;
Date: Fri Sep 26 11:19:32 2014&lt;br/&gt;
New Revision: 1627753&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/r1627753&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1627753&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
Added Javadoc warnings related to &lt;a href=&quot;https://issues.apache.org/jira/browse/LANG-796&quot; title=&quot;DateUtils.addDays does not work properly with daylight saving time (DST)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LANG-796&quot;&gt;LANG-796&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Modified:&lt;br/&gt;
    commons/proper/lang/trunk/src/main/java/org/apache/commons/lang3/time/DateUtils.java&lt;/p&gt;</comment>
                            <comment id="14150489" author="adrianc@hlmksw.com" created="Sat, 27 Sep 2014 07:31:24 +0000"  >&lt;p&gt;I repeat:&lt;/p&gt;

&lt;p&gt;The current behavior is correct. The result added one day. One day is NOT equal to 86400000 milliseconds - as you can see from the result.&lt;/p&gt;</comment>
                            <comment id="14179981" author="jpollak" created="Wed, 22 Oct 2014 14:50:51 +0000"  >&lt;p&gt;I am affected by this situation as well, and I agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nicola.barbiero&quot; class=&quot;user-hover&quot; rel=&quot;nicola.barbiero&quot;&gt;nicola.barbiero&lt;/a&gt; - As he quoted the Oracle specification at the top of bug: &quot;Nearly all modern operating systems assume that 1 day = 24 &#215; 60 &#215; 60 = 86400 seconds in all cases&quot;.&lt;/p&gt;

&lt;p&gt;Adding a day should add a 86400 seconds, in all cases, regardless of timezone.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233402</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 4 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b5if:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63005</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>