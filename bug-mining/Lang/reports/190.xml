<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:15:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LANG-686] StringUtils.replaceEachRepeatedly(&quot;aaa&quot;, new String[]{&quot;aa&quot;}, new String[]{&quot;aXa&quot;}); throw an exception</title>
                <link>https://issues.apache.org/jira/browse/LANG-686</link>
                <project id="12310481" key="LANG">Commons Lang</project>
                    <description>&lt;p&gt;After executing line&lt;/p&gt;

&lt;p&gt;StringUtils.replaceEachRepeatedly(&quot;aaa&quot;, new String[]&lt;/p&gt;
{&quot;aa&quot;}
&lt;p&gt;, new String[]&lt;/p&gt;
{&quot;aXa&quot;}
&lt;p&gt;);&lt;/p&gt;

&lt;p&gt;exception is thrown:&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.lang.IllegalStateException: TimeToLive of -1 is less than 0: aXaXa&lt;br/&gt;
	at org.apache.commons.lang.StringUtils.replaceEach(StringUtils.java:3986)&lt;br/&gt;
	at org.apache.commons.lang.StringUtils.replaceEach(StringUtils.java:4099)&lt;br/&gt;
	at org.apache.commons.lang.StringUtils.replaceEach(StringUtils.java:4099)&lt;br/&gt;
	at org.apache.commons.lang.StringUtils.replaceEachRepeatedly(StringUtils.java:3920)&lt;/p&gt;
</description>
                <environment>&lt;p&gt;jdk 1.6.24, windows xp pro sp3, eclipse helios&lt;/p&gt;</environment>
        <key id="12501015">LANG-686</key>
            <summary>StringUtils.replaceEachRepeatedly(&quot;aaa&quot;, new String[]{&quot;aa&quot;}, new String[]{&quot;aXa&quot;}); throw an exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="qed">qed</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Mar 2011 13:19:28 +0000</created>
                <updated>Mon, 21 Oct 2013 05:43:12 +0000</updated>
                                            <version>2.6</version>
                                    <fixVersion>Review Patch</fixVersion>
                                    <component>lang.*</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13005142" author="maurizio.cucchiara" created="Thu, 10 Mar 2011 16:40:09 +0000"  >&lt;p&gt;I&apos;m not sure this is a bug. The IllegalStateException was throwned because your substitution pattern triggers a (though little) recursion, it&apos;s a kind of prevention, in order to avoid StackOverflowError&lt;/p&gt;</comment>
                            <comment id="13005226" author="qed" created="Thu, 10 Mar 2011 18:32:01 +0000"  >&lt;p&gt;I solved this problem by making this call instead:&lt;/p&gt;

&lt;p&gt;StringUtils.replaceEachRepeatedly(&quot;aaa&quot;, new String[]&lt;/p&gt;
{&quot;aa&quot;, &quot;&quot;}
&lt;p&gt;, new String[]&lt;/p&gt;
{&quot;aXa&quot;, &quot;&quot;}
&lt;p&gt;);&lt;/p&gt;

&lt;p&gt;Maybe there should be a limit to number of iterations or something similar. I didn&apos;t know that this function is not supposed to support recursion. I think this function is good suited when (java) regex fail in matching already replaced part of string and hence it shouldn&apos;t be dicouraged to use this function as a solution imho.&lt;/p&gt;</comment>
                            <comment id="13007341" author="bayard" created="Wed, 16 Mar 2011 04:00:06 +0000"  >&lt;p&gt;At the very least the exception could explain what the problem is rather than what the state of an obscure private variable is.&lt;/p&gt;</comment>
                            <comment id="13071526" author="bayard" created="Wed, 27 Jul 2011 05:43:11 +0000"  >&lt;p&gt;Digging into this, the search should have been:&lt;/p&gt;

&lt;p&gt;&quot;aaa&quot;&lt;br/&gt;
&quot;aXaa&quot;&lt;br/&gt;
&quot;aXaXa&quot;&lt;/p&gt;

&lt;p&gt;Which is hardly the deepest loop.&lt;/p&gt;

&lt;p&gt;The TTL would have been 1, ie) the length of the inputted String[] &lt;/p&gt;
{ &quot;aXa&quot; }
&lt;p&gt;.&lt;/p&gt;

&lt;p&gt;I wonder if the issue is that TTL needs to be longer (which is what qed did by adding extra &quot;&quot;s).&lt;/p&gt;</comment>
                            <comment id="13071533" author="bayard" created="Wed, 27 Jul 2011 05:56:39 +0000"  >&lt;p&gt;For this regexp; and I suspect it&apos;s the worst, yet vaguely sane, case; the TTL would have needed to have been text.length() - 1. For large text that&apos;s going to offer no protection against StackOverflowError. Options would seem to be:&lt;/p&gt;

&lt;p&gt;1) Leave as is, improve IllegalStateException message (and update in javadoc which says IllegalArgumentException).&lt;br/&gt;
2) Stop protecting against StackOverflowError.&lt;br/&gt;
3) Increase the size by a marginal, yet arbitrary, amount.&lt;/p&gt;

&lt;p&gt;I&apos;m going to continue to go with #1.&lt;/p&gt;</comment>
                            <comment id="13071554" author="bayard" created="Wed, 27 Jul 2011 06:35:53 +0000"  >&lt;p&gt;Improved error message added (I hope):&lt;/p&gt;

&lt;p&gt;&quot;Output of one loop is the input of another; protecting from potential StackOverflowError&quot;&lt;/p&gt;

&lt;p&gt;I think there is value in #3 above as well. Some arbitrarily small number to be a minimum TTL. &lt;/p&gt;</comment>
                            <comment id="13071603" author="sebb@apache.org" created="Wed, 27 Jul 2011 08:55:07 +0000"  >&lt;p&gt;The message is ambiguous; protecting could refer to the first part of the sentence rather than the exception itself.&lt;/p&gt;

&lt;p&gt;How about&lt;/p&gt;

&lt;p&gt;&quot;Aborting to protect against StackOverflowError - output of one loop is the input of another&quot;&lt;/p&gt;</comment>
                            <comment id="13071774" author="qed" created="Wed, 27 Jul 2011 14:50:37 +0000"  >&lt;p&gt;&amp;gt; output of one loop is the input of another&lt;br/&gt;
And that&apos;s a problem? That&apos;s how grammars are working. I don&apos;t think that this function should prevent such behaviour (ie. output of one loop should be allowed to be input of another loop).&lt;/p&gt;</comment>
                            <comment id="13072569" author="bayard" created="Thu, 28 Jul 2011 22:23:35 +0000"  >&lt;p&gt;Sebb: I&apos;ve changed to your suggested text (r1152021).&lt;/p&gt;

&lt;p&gt;qed: Not disagreeing. For 3.0.1, improving the error message to avoid your &apos;WTF???&apos; is an improvement. Whether we simply strip out the TTL code and let the StackOverflowError happen is another question. My personal feeling is in line with yours (I think). That is - &quot;let it happen&quot;.&lt;/p&gt;</comment>
                            <comment id="13076074" author="bayard" created="Tue, 2 Aug 2011 07:22:03 +0000"  >&lt;p&gt;Moving to 3.0.2. Note that the error message was improved and javadoc Exceptions fixed in 3.0.1. When resolving, make 3.0.1 a fix version as well.&lt;/p&gt;</comment>
                            <comment id="13245710" author="tn" created="Tue, 3 Apr 2012 20:42:10 +0000"  >&lt;p&gt;I have worked on this a bit and provide a patch that does the following:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;refactor the replaceEach method to avoid code duplication&lt;/li&gt;
	&lt;li&gt;change loop detection code&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Instead of using a timeToLive variable that tries to detect infinite loops, I used a quite simple but effective method:&lt;/p&gt;

&lt;p&gt;Whenever at the end of a replace cycle we end up having a result string that has already be seen so far, we have possibly detected an infinite loop and thus abort the execution (with an exception as before).&lt;/p&gt;

&lt;p&gt;I have also added two additional unit test cases.&lt;/p&gt;

&lt;p&gt;Edit:&lt;/p&gt;

&lt;p&gt;The new loop detection code does not prevent stackoverflow exceptions of course. But as others have pointed out, just let it happen (it is anyway very unlikely to occur, need to come up with a test case for it somehow). I would prefer correct behavior in normal cases, and a robust loop detection for recursive/weird cases.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12521211" name="LANG-686.patch" size="11146" author="tn" created="Tue, 3 Apr 2012 20:42:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3001</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 33 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b5pb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63036</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>