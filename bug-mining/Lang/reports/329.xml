<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:16:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LANG-1077] [PATCH] StringUtils.ordinalIndexOf(&quot;aaaaaa&quot;, &quot;aa&quot;, 2) should return 2</title>
                <link>https://issues.apache.org/jira/browse/LANG-1077</link>
                <project id="12310481" key="LANG">Commons Lang</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;org.apache.commons.lang3.StringUtils.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; found = 0;
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; index = lastIndex ? str.length() : INDEX_NOT_FOUND;
        &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (lastIndex) {
                index = CharSequenceUtils.lastIndexOf(str, searchStr, index - 1);
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                index = CharSequenceUtils.indexOf(str, searchStr, index + 1);
            }
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (index &amp;lt; 0) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; index;
            }
            found++;
        } &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (found &amp;lt; ordinal);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Should it be:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;org.apache.commons.lang3.StringUtils.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; ordinalIndexOf(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; CharSequence str, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; CharSequence searchStr, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; ordinal, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; lastIndex) {
        &lt;span class=&quot;code-comment&quot;&gt;//        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (str == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || searchStr == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || ordinal &amp;lt;= 0) {
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; INDEX_NOT_FOUND;
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//        }
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (searchStr.length() == 0) {
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; lastIndex ? str.length() : 0;
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//        }
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; found = 0;
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; index = lastIndex ? str.length() : INDEX_NOT_FOUND;
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//        &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; {
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (lastIndex) {
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//                index = CharSequenceUtils.lastIndexOf(str, searchStr, index - 1);
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//                index = CharSequenceUtils.indexOf(str, searchStr, index + 1);
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//            }
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (index &amp;lt; 0) {
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; index;
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//            }
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//            found++;
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//        } &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (found &amp;lt; ordinal);
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; index;
&lt;/span&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (str == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || searchStr == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || ordinal &amp;lt;= 0) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; INDEX_NOT_FOUND;
        }

        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (searchStr.length() == 0) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; lastIndex ? str.length() : 0;
        }

        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; searchStrLen = searchStr.length();
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; index = lastIndex ? str.length() : 0;

        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; found = 0; index &amp;gt;= 0;) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (lastIndex) {
                index = CharSequenceUtils.lastIndexOf(str, searchStr, index);
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                index = CharSequenceUtils.indexOf(str, searchStr, index);
            }

            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (index &amp;lt; 0) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; INDEX_NOT_FOUND;
            }

            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (++found &amp;gt;= ordinal) {
                &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
            }

            index = lastIndex ? index - searchStrLen : index + searchStrLen;
        }

        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; index;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12761125">LANG-1077</key>
            <summary>[PATCH] StringUtils.ordinalIndexOf(&quot;aaaaaa&quot;, &quot;aa&quot;, 2) should return 2</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lihy70">haiyang li</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Thu, 11 Dec 2014 18:23:17 +0000</created>
                <updated>Sun, 29 May 2016 15:35:08 +0000</updated>
                            <resolved>Fri, 11 Dec 2015 13:48:36 +0000</resolved>
                                    <version>3.3.2</version>
                                                    <component>lang.*</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14244073" author="kinow" created="Fri, 12 Dec 2014 12:49:46 +0000"  >&lt;p&gt;Hi Haiyang!&lt;/p&gt;

&lt;p&gt;Your code does make sense, and I&apos;ve made a patch with it (hope you don&apos;t mind) for others to take a look and experiment with it. &lt;/p&gt;

&lt;p&gt;I thought about committing it to the trunk, but I got confused with the title of the issue.&lt;/p&gt;

&lt;p&gt;Running the code as is in the trunk, &lt;tt&gt;StringUtils.ordinalIndexOf(&quot;aaaaaa&quot;, &quot;aa&quot;, 2)&lt;/tt&gt; returns &lt;b&gt;1&lt;/b&gt;. After applying the patch with your code, &lt;tt&gt;StringUtils.ordinalIndexOf(&quot;aaaaaa&quot;, &quot;aa&quot;, 2)&lt;/tt&gt; returns &lt;b&gt;3&lt;/b&gt;... so it is still != 2, and I think that&apos;s the expected behavior.&lt;/p&gt;

&lt;p&gt;Do you reckon that the expected result should be indeed &lt;b&gt;3&lt;/b&gt;? &lt;/p&gt;

&lt;p&gt;Thanks!&lt;br/&gt;
Bruno&lt;/p&gt;</comment>
                            <comment id="14244075" author="kinow" created="Fri, 12 Dec 2014 12:50:45 +0000"  >&lt;p&gt;Patch with Haiyang Li code and a unit test.&lt;/p&gt;</comment>
                            <comment id="14244545" author="lihy70" created="Fri, 12 Dec 2014 18:15:03 +0000"  >&lt;p&gt;HI, Bruno&lt;br/&gt;
The code i pasted is incorrect. I changed it now. please have a look. &lt;br/&gt;
Previously I just read the code but didn&apos;t test it with the modification.&lt;/p&gt;

&lt;p&gt;thank you for testing it out!&lt;/p&gt;</comment>
                            <comment id="14244613" author="kinow" created="Fri, 12 Dec 2014 18:57:18 +0000"  >&lt;p&gt;Hello Haiyang!&lt;/p&gt;

&lt;p&gt;No, I thank you for filing the issue and taking your time to provide some code. I never used the orginalIndexOf, so I thought it was a good chance to learn it too &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I &lt;b&gt;think&lt;/b&gt; your previous code was right. Looking at the current implementation, it sems to always return the first occurrence of the needle (searchStr), &lt;b&gt;after&lt;/b&gt; the given offset (ordinal) in the haystack (str).&lt;/p&gt;

&lt;p&gt;I updated my local copy with your updated code, and it broke existing tests. &lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="14244670" author="lihy70" created="Fri, 12 Dec 2014 19:39:25 +0000"  >&lt;p&gt;en... It&apos;s my bad. updated it again. I downloaded the source code and made the change and tested it this time.&lt;br/&gt;
(BTW, I a newcomer and we have a project which uses Commons Lang a lot. that&apos;s why i&apos;m looking into code. Commons Lang provides a lot of useful APIs and help me a lot. appreciate the work you guys have done. Good job!)&lt;/p&gt;</comment>
                            <comment id="14244691" author="kinow" created="Fri, 12 Dec 2014 19:55:27 +0000"  >&lt;p&gt;So are you +1 for we applying the existing patch, with your original code? If so I will commit the patch to the trunk tonight.&lt;/p&gt;

&lt;p&gt;Also, if you agree, I would like to update the title from &quot;StringUtils.ordinalIndexOf(&quot;aaaaaa&quot;, &quot;aa&quot;, 2) != 2 in StringUtils&quot; to &quot;StringUtils.ordinalIndexOf(&quot;aaaaaa&quot;, &quot;aa&quot;, 2) != &lt;b&gt;3&lt;/b&gt; in StringUtils&quot; just to avoid any confusion in the future.&lt;/p&gt;

&lt;p&gt;&amp;gt; (BTW, I a newcomer and we have a project which uses Commons Lang a lot. that&apos;s why i&apos;m looking into code. Commons Lang provides a lot of useful APIs and help me a lot. appreciate the work you guys have done. Good job!)&lt;/p&gt;

&lt;p&gt;That&apos;s a great initiative Haiyang. We are a group of volunteers, and the feedback and contributions like yours are very important. Feel free to report other issues. If you feel like, you can also write patches (tests are always welcome :-D ), this way your code can get merged and released to all users (how cool is that?).&lt;/p&gt;

&lt;p&gt;All the best,&lt;br/&gt;
Bruno&lt;/p&gt;</comment>
                            <comment id="14244697" author="lihy70" created="Fri, 12 Dec 2014 20:04:03 +0000"  >&lt;p&gt;yes. i will be glad to see the code is to be merged into trunk.&lt;/p&gt;

&lt;p&gt;And I will continue to review the code in my spare time and report any issues I find.&lt;/p&gt;</comment>
                            <comment id="14245100" author="kinow" created="Sat, 13 Dec 2014 02:01:01 +0000"  >&lt;p&gt;Committed in revision r1645101.&lt;/p&gt;

&lt;p&gt;Thank you very much for your contribution Haiyang. &lt;/p&gt;

&lt;p&gt;Bruno&lt;/p&gt;</comment>
                            <comment id="14245949" author="kinow" created="Sun, 14 Dec 2014 15:39:03 +0000"  >&lt;p&gt;Patch with user contribution applied to trunk.&lt;/p&gt;</comment>
                            <comment id="15052710" author="sebb@apache.org" created="Fri, 11 Dec 2015 12:49:32 +0000"  >&lt;p&gt;The patch that was applied was wrong.&lt;br/&gt;
The problem is that one cannot subtract the search length each time, unless one allows for this in the initial index. &lt;/p&gt;

&lt;p&gt;This is why the initial index is set to str.len (i.e. max index +1) or -1 (min index -1); then the first time through the loop, the original code starts at the end or start respectively.&lt;/p&gt;

&lt;p&gt;The patched code now fails to start searching at the beginning when the search string len &amp;gt; 1, see &lt;a href=&quot;https://issues.apache.org/jira/browse/LANG-1193&quot; title=&quot;ordinalIndexOf(&amp;quot;abc&amp;quot;, &amp;quot;ab&amp;quot;, 1) gives incorrect answer of -1 (correct answer should be 0)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LANG-1193&quot;&gt;&lt;del&gt;LANG-1193&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15052734" author="sebb@apache.org" created="Fri, 11 Dec 2015 13:21:20 +0000"  >&lt;p&gt;On further reflection, I think the original bug report was wrong, and the original code is correct.&lt;/p&gt;

&lt;p&gt;The original code steps through the search target one char at a time, so I think the behaviour should be:&lt;/p&gt;

&lt;p&gt;StringUtils.ordinalIndexOf(&quot;aaaaaa&quot;, &quot;aa&quot;, 1) =&amp;gt; 0 // matches &quot;aa&quot;&lt;br/&gt;
StringUtils.ordinalIndexOf(&quot;aaaaaa&quot;, &quot;aa&quot;, 2) =&amp;gt; 1 // matches &quot;.aa&quot;&lt;/p&gt;

&lt;p&gt;However if overlapping matches are not allowed, I would expect:&lt;/p&gt;

&lt;p&gt;StringUtils.ordinalIndexOf(&quot;aaaaaa&quot;, &quot;aa&quot;, 2) =&amp;gt; 2 // matches &quot;..aa&quot;&lt;/p&gt;

&lt;p&gt;I have no idea why it was ever expected that the result should be &quot;3&quot;, unless it was thought that the index started at 1.&lt;/p&gt;

&lt;p&gt;Perhaps the OP expected overlapping matches to be disallowed.&lt;br/&gt;
However there is  no indication that this was ever intended.&lt;/p&gt;

&lt;p&gt;The fix needs to be reverted, and the Javadoc updated to make it clear that overlapping matches are allowed.&lt;/p&gt;</comment>
                            <comment id="15052778" author="sebb@apache.org" created="Fri, 11 Dec 2015 13:48:36 +0000"  >&lt;p&gt;Revert &lt;a href=&quot;https://issues.apache.org/jira/browse/LANG-1077&quot; title=&quot;[PATCH] StringUtils.ordinalIndexOf(&amp;quot;aaaaaa&amp;quot;, &amp;quot;aa&amp;quot;, 2) should return 2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LANG-1077&quot;&gt;&lt;del&gt;LANG-1077&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Project: &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/commons-lang/repo&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/commons-lang/repo&lt;/a&gt;&lt;br/&gt;
Commit: &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/commons-lang/commit/d75fe46b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/commons-lang/commit/d75fe46b&lt;/a&gt;&lt;br/&gt;
Tree: &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/commons-lang/tree/d75fe46b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/commons-lang/tree/d75fe46b&lt;/a&gt;&lt;br/&gt;
Diff: &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/commons-lang/diff/d75fe46b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/commons-lang/diff/d75fe46b&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Branch: refs/heads/master&lt;br/&gt;
Commit: d75fe46b8f1b0d5c27887052ee4714d6a9c7ea4b&lt;br/&gt;
Parents: 15e1ea2&lt;br/&gt;
Author: Sebb &amp;lt;sebb@apache.org&amp;gt;&lt;br/&gt;
Authored: Fri Dec 11 13:41:22 2015 +0000&lt;br/&gt;
Committer: Sebb &amp;lt;sebb@apache.org&amp;gt;&lt;br/&gt;
Committed: Fri Dec 11 13:41:22 2015 +0000&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------------&lt;br/&gt;
 src/changes/changes.xml                            |  2 +-&lt;br/&gt;
 .../java/org/apache/commons/lang3/StringUtils.java | 15 ++++++++++++---&lt;br/&gt;
 .../lang3/StringUtilsEqualsIndexOfTest.java        | 17 +++++++++++++++--&lt;br/&gt;
 3 files changed, 28 insertions&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/add.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, 6 deletions&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/forbidden.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
----------------------------------------------------------------------&lt;/p&gt;
</comment>
                            <comment id="15053018" author="lihy70" created="Fri, 11 Dec 2015 16:58:58 +0000"  >&lt;p&gt;Sebb, &lt;br/&gt;
The original bug is: StringUtils.ordinalIndexOf(&quot;aaaaaa&quot;, &quot;aa&quot;, 2) should return 2. somehow title was changed:  &lt;br/&gt;
&quot;StringUtils.ordinalIndexOf(&quot;aaaaaa&quot;, &quot;aa&quot;, 2) != 2 in StringUtils&quot; to &quot;StringUtils.ordinalIndexOf(&quot;aaaaaa&quot;, &quot;aa&quot;, 2) != 3&lt;br/&gt;
And wrong patch was merged into trunk.&lt;br/&gt;
The right code should be:&lt;br/&gt;
--------------------------------------------------------------------------------------------------------------&lt;br/&gt;
    private static int ordinalIndexOf(final CharSequence str, final CharSequence searchStr, final int ordinal, final boolean lastIndex) {&lt;br/&gt;
        if (str == null || searchStr == null || ordinal &amp;lt;= 0) &lt;/p&gt;
{
            return INDEX_NOT_FOUND;
        }

&lt;p&gt;        if (searchStr.length() == 0) &lt;/p&gt;
{
            return lastIndex ? str.length() : 0;
        }

&lt;p&gt;        final int searchStrLen = searchStr.length();&lt;br/&gt;
        int index = lastIndex ? str.length() : 0;&lt;/p&gt;

&lt;p&gt;        for (int found = 0; index &amp;gt;= 0&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; {&lt;br/&gt;
            if (lastIndex) &lt;/p&gt;
{
                index = CharSequenceUtils.lastIndexOf(str, searchStr, index);
            }
&lt;p&gt; else &lt;/p&gt;
{
                index = CharSequenceUtils.indexOf(str, searchStr, index);
            }

&lt;p&gt;            if (index &amp;lt; 0) &lt;/p&gt;
{
                return INDEX_NOT_FOUND;
            }

&lt;p&gt;            if (++found &amp;gt;= ordinal) &lt;/p&gt;
{
                break;
            }

&lt;p&gt;            index = lastIndex ? index - searchStrLen : index + searchStrLen;&lt;br/&gt;
        }&lt;/p&gt;

&lt;p&gt;        return index;&lt;br/&gt;
    }&lt;br/&gt;
--------------------------------------------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;please look into the original code.&lt;br/&gt;
This is a valid bug. It&apos;s can&apos;t be correct by just updating java doc. because it may confuse people.&lt;/p&gt;

&lt;p&gt;BTW, the bug was reported on 12/11/2014,  today is 12/11/15&lt;/p&gt;</comment>
                            <comment id="15053099" author="sebb@apache.org" created="Fri, 11 Dec 2015 17:50:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;The original bug is: StringUtils.ordinalIndexOf(&quot;aaaaaa&quot;, &quot;aa&quot;, 2) should return 2.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sorry, but that is wrong.&lt;/p&gt;

&lt;p&gt;The code returns &lt;b&gt;all&lt;/b&gt; matches, so the first match is &quot;aa....&quot;, i.e. index 0.&lt;br/&gt;
The second match is &quot;.aa...&quot;, i.e. index 1.&lt;br/&gt;
Third match would be &quot;..aa..&quot;, i.e. index 2.&lt;br/&gt;
etc.&lt;/p&gt;</comment>
                            <comment id="15053124" author="lihy70" created="Fri, 11 Dec 2015 18:07:18 +0000"  >&lt;p&gt;Sebb, &lt;br/&gt;
It doesn&apos;t make sense. take a few minutes to think about the definition/contract of &quot;indexOf&quot;, and consider &quot;searchStr&quot; as whole object, no matter it&apos;s &quot;aa&quot;, or &quot;ab&quot;.&lt;/p&gt;

&lt;p&gt;Or, try to think about the question:&lt;br/&gt;
There is one string A: &quot;aaaaaa&quot;, string B: &quot;aa&quot;, how many B in A and return the index of each?&lt;/p&gt;</comment>
                            <comment id="15053159" author="sebb@apache.org" created="Fri, 11 Dec 2015 18:31:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;There is one string A: &quot;aaaaaa&quot;, string B: &quot;aa&quot;, how many B in A and return the index of each?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There are 5 B in A, indexes 0,1,2,3,4&lt;/p&gt;

&lt;p&gt;Remember that overlapping matches are allowed, and indexes start at 0.&lt;/p&gt;</comment>
                            <comment id="15053183" author="lihy70" created="Fri, 11 Dec 2015 18:44:21 +0000"  >&lt;p&gt;There are ONLY 3 B in A. &lt;br/&gt;
Consider the case: A: &quot;ababab&quot;, B: &quot;ab&quot;, or A:&quot;aaaaaa&quot;, B: &quot;aa&quot;. in different scenarios, the expected result should be same, not matter what in A and B. &lt;br/&gt;
You are assuming the programmers always know what in B or have to check what in B, and remember what they should NOT when call this method.&lt;/p&gt;</comment>
                            <comment id="15053390" author="sebb@apache.org" created="Fri, 11 Dec 2015 19:15:20 +0000"  >&lt;p&gt;The difference with &quot;ab&quot; is that it cannot ever match overlapping sections of the string.&lt;/p&gt;

&lt;p&gt;However consider A: &quot;ababab&quot; B: &quot;aba&quot;. B matches at index 0, it also matches at index 2.&lt;br/&gt;
Similarly for B: &quot;abab&quot;&lt;/p&gt;

&lt;p&gt;As I already wrote, the method allows overlapping matches.&lt;br/&gt;
It did so until version 3.4 when the code was changed, breaking it in the process (e.g. JIRA-1193)&lt;/p&gt;

&lt;p&gt;I agree that the Javadoc was not precise, as it did not specify whether or not overlapping matches should be allowed.&lt;br/&gt;
The Javadoc has now been clarified to agree with the original behaviour.&lt;/p&gt;

&lt;p&gt;It would of course be possible to have a different strategy whereby overlapping matches were not allowed, but that would be a change from the original behaviour, so would need a new method in order to avoid breaking the code for users that rely on the original behaviour.&lt;/p&gt;</comment>
                            <comment id="15053411" author="lihy70" created="Fri, 11 Dec 2015 19:27:36 +0000"  >&lt;p&gt;It&apos;s 19:18 at London?  how are you doing today? It&apos;s Friday. Here is 11:18 at CA.&lt;/p&gt;

&lt;p&gt;JIRA-1193 is broken by wrong patch. the right code will work fine and fix JIRA-1193.&lt;br/&gt;
You&apos;re keeping talking &quot;overlapping matches&quot;. This is a general XXXIndexOf(...), not a match method...&lt;br/&gt;
The doc looks good to me. what wrong is the behavior/code in the method. Even the java doc is updated with &quot;overlapping matches  is allowed&quot;. People may NOT notice it, or remember it, or even don&apos;t read the doc. It could bring bugs by unexpected result even doc is updated.&lt;/p&gt;</comment>
                            <comment id="15053437" author="tn" created="Fri, 11 Dec 2015 19:45:47 +0000"  >&lt;p&gt;This code exists since a long time and looking at the implementation it is clear what it does and what its intention is: repeatedly execute indexOf with a start index of +1 compared to the last match. There are even suggestions on stackoverflow to use this method for exactly that use-case.&lt;/p&gt;

&lt;p&gt;What you are facing is a corner-case that was not described in the javadoc and thus it might create confusion for a user. So the right thing to do is what sebb did: revert the fix to the previous, working version and update the javadoc to document the corner case. Contrary to your opinion that this might introduce bugs, it is quite the opposite, your fix will introduce bugs as people relied on the previous version for a long time already.&lt;/p&gt;

&lt;p&gt;If there is a need for a method that does not handle overlaps, then this should be a new feature request. The method could have an additional flag to indicate how it handles overlaps.&lt;/p&gt;</comment>
                            <comment id="15053470" author="sebb@apache.org" created="Fri, 11 Dec 2015 19:57:42 +0000"  >&lt;p&gt;I agree that had the patch been &apos;better&apos; it would not have caused JIRA-1193 to be raised. In fact I was originally going to try to fix it accordingly.&lt;/p&gt;

&lt;p&gt;However, I looked further into it, and noticed that fixing the behaviour according to your original issue was not a good idea, as it would have changed the existing behaviour.&lt;br/&gt;
The code was added to LANG in version 2.1 about 12 years ago, and the behaviour did not change until 3.4 which broke it.&lt;/p&gt;

&lt;p&gt;Although the behaviour is not what you expect, it is consistent with the original Javadoc.&lt;br/&gt;
Furthermore the behaviour has been the same for multiple releases, so changing the behaviour now would potentially break existing applications.&lt;/p&gt;</comment>
                            <comment id="15053486" author="lihy70" created="Fri, 11 Dec 2015 20:03:42 +0000"  >&lt;p&gt;If as you said: &quot;There are even suggestions on stackoverflow to use this method for exactly that use-case&quot;, (I think that use-case you referred is: StringUtils.ordinalIndexOf(&quot;aaaaaa&quot;, &quot;aa&quot;, 2) should return 1), I agree to roll back the change to previous version.&lt;/p&gt;

&lt;p&gt;On the other side: &quot;This code exists since a long time and looking at the implementation it is clear what it does and what its intention is: ...&quot;&lt;br/&gt;
How long it exists doesn&apos;t mean how right it is. Definitely it does incorrectly what it&apos;s supposed to do, from my aspect.&lt;/p&gt;

&lt;p&gt;By the way, again, JIRA-1193 in 3.4 was broken by the wrong patch/code, not by this ticket&lt;/p&gt;</comment>
                            <comment id="15053494" author="lihy70" created="Fri, 11 Dec 2015 20:11:57 +0000"  >&lt;p&gt;OK, basically, I think all of us agree: &quot;Furthermore the behaviour has been the same for multiple releases, so changing the behaviour now would potentially break existing applications.&quot;.&lt;br/&gt;
The discussion can be moved to how to improve this method.&lt;/p&gt;</comment>
                            <comment id="15053521" author="lihy70" created="Fri, 11 Dec 2015 20:33:17 +0000"  >&lt;p&gt;After think it about couple of minutes, I have another question: What&apos;re the general policies to fix bug/improve the code if it is not reported as bug in previous versions?&lt;/p&gt;

&lt;p&gt;Again, I can understand and agree to roll back the changes to previous version for this case since it has been there for a long time.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12921028">LANG-1193</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12973809">LANG-1241</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12686843" name="LANG-1077.patch" size="1538" author="kinow" created="Fri, 12 Dec 2014 12:50:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 49 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i23btr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>