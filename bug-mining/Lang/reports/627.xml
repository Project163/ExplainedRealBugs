<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:18:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LANG-1773] Apache Commons Lang no longer builds on Android</title>
                <link>https://issues.apache.org/jira/browse/LANG-1773</link>
                <project id="12310481" key="LANG">Commons Lang</project>
                    <description>&lt;p&gt;Google periodically imports various open source projects into the &lt;a href=&quot;https://research.google/pubs/why-google-stores-billions-of-lines-of-code-in-a-single-repository&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Google Monorepo&lt;/a&gt; &lt;a href=&quot;https://research.google/pubs/why-google-stores-billions-of-lines-of-code-in-a-single-repository/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;.&lt;/a&gt;.] When I attempted to do that for Commons Lang, I found that it no longer builds against the Android API. The reason is that &lt;a href=&quot;https://github.com/apache/commons-lang/commit/c4007c4a24eafbed53109e4b0376b4fd0ba01b56&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this commit&lt;/a&gt; introduced a usage of `java.lang.reflect.AnnotatedType`, but that interface doesn&apos;t exist on Android (&lt;a href=&quot;https://developer.android.com/reference/java/lang/reflect/package-summary&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Android `java.lang.reflect`&lt;/a&gt;). The open-source Commons Lang is probably not built against the Android API, but the built artifacts get used there, and this code could lead to bizarre runtime failures.&lt;/p&gt;

&lt;p&gt;I was able to patch the code so that it uses reflection to access `AnnotatedType`, and I could make a PR with that change if that is helpful. Then if `AnnotatedType` doesn&apos;t exist, the private `TypeUtils.isCyclical` method just returns false. Or perhaps the test for these cyclical types could work some other way that doesn&apos;t involve `AnnotatedType`.&lt;/p&gt;

&lt;p&gt;Alternatively, if this is unlikely to be useful to users outside Google, we can maintain a private patch.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13617618">LANG-1773</key>
            <summary>Apache Commons Lang no longer builds on Android</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="eamonnmcmanus">&#201;amonn McManus</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 May 2025 20:14:55 +0000</created>
                <updated>Mon, 12 May 2025 12:02:53 +0000</updated>
                            <resolved>Mon, 12 May 2025 12:02:27 +0000</resolved>
                                                    <fixVersion>3.18.0</fixVersion>
                                    <component>lang.reflect.*</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17950374" author="garydgregory" created="Thu, 8 May 2025 21:41:39 +0000"  >&lt;p&gt;I would not want to use reflection but what about rewriting the method to use a stream:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git a/src/main/java/org/apache/commons/lang3/reflect/TypeUtils.java b/src/main/java/org/apache/commons/lang3/reflect/TypeUtils.java
index 3cdc9c1..ba1be44 100644
--- a/src/main/java/org/apache/commons/lang3/reflect/TypeUtils.java
+++ b/src/main/java/org/apache/commons/lang3/reflect/TypeUtils.java
@@ -16,7 +16,6 @@
  */
 package org.apache.commons.lang3.reflect;
 
-import java.lang.reflect.AnnotatedType;
 import java.lang.reflect.Array;
 import java.lang.reflect.GenericArrayType;
 import java.lang.reflect.GenericDeclaration;
@@ -34,6 +33,7 @@
 import java.util.Objects;
 import java.util.Set;
 import java.util.TreeSet;
+import java.util.stream.Stream;
 
 import org.apache.commons.lang3.AppendableJoiner;
 import org.apache.commons.lang3.ArrayUtils;
@@ -1361,10 +1361,9 @@ private static boolean isAssignable(final Type type, final WildcardType toWildca
      */
     private static boolean isCyclical(final Class&amp;lt;?&amp;gt; cls) {
         for (final TypeVariable&amp;lt;?&amp;gt; typeParameter : cls.getTypeParameters()) {
-            for (final AnnotatedType annotatedBound : typeParameter.getAnnotatedBounds()) {
-                if (annotatedBound.getType().getTypeName().contains(cls.getName())) {
-                    return true;
-                }
+            // Hack for LANG-1173
+            if (Stream.of(typeParameter.getAnnotatedBounds()).anyMatch(bound -&amp;gt; bound.getType().getTypeName().contains(cls.getName()))) {
+                return true;
             }
         }
         return false;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17950378" author="eamonnmcmanus" created="Thu, 8 May 2025 22:17:03 +0000"  >&lt;p&gt;&amp;gt;&#160;I would not want to use reflection but what about rewriting the method to use a stream:&lt;/p&gt;

&lt;p&gt;I don&apos;t think that can work. If the platform doesn&apos;t have `AnnotatedType` then it doesn&apos;t have methods that return `AnnotatedType` either. So `typeParameter.getAnnotatedBounds()` will fail.&lt;/p&gt;</comment>
                            <comment id="17950706" author="eamonnmcmanus" created="Sat, 10 May 2025 17:50:59 +0000"  >&lt;p&gt;Actually, looking more closely, I don&apos;t think the code needs to reference &lt;tt&gt;AnnotatedType&lt;/tt&gt; at all. This is what we have:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&#160; &#160; private static boolean isCyclical(final Class&amp;lt;?&amp;gt; cls) {
&#160; &#160; &#160; &#160; for (final TypeVariable&amp;lt;?&amp;gt; typeParameter : cls.getTypeParameters()) {
&#160; &#160; &#160; &#160; &#160; &#160; for (final AnnotatedType annotatedBound : typeParameter.getAnnotatedBounds()) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; if (annotatedBound.getType().getTypeName().contains(cls.getName())) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; return true;
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; return false;
&#160; &#160; }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There&apos;s no need to call &lt;tt&gt;getAnnotatedBounds()&lt;/tt&gt;, since the code immediately calls &lt;tt&gt;getType()&lt;/tt&gt; on the result. So the loop could just call &lt;tt&gt;typeParameter.getBounds()&lt;/tt&gt; directly. I&apos;ll prototype this and send a PR if tests pass.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17950932" author="garydgregory" created="Mon, 12 May 2025 12:02:27 +0000"  >&lt;p&gt;TY &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eamonnmcmanus&quot; class=&quot;user-hover&quot; rel=&quot;eamonnmcmanus&quot;&gt;eamonnmcmanus&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The PR is now in git master. Please verify a local clone of git master or a snapshot build from &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            25 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1vrm0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>