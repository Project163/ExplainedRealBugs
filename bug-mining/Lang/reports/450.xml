<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:17:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LANG-1295] ArrayUtils.toArray(T... items) has unsafe use of varargs</title>
                <link>https://issues.apache.org/jira/browse/LANG-1295</link>
                <project id="12310481" key="LANG">Commons Lang</project>
                    <description>&lt;p&gt;&lt;tt&gt;ArrayUtils.toArray(T... items)&lt;/tt&gt; is marked as &lt;tt&gt;@SafeVarargs&lt;/tt&gt;, but I suspect the use of the varargs is unsafe.&lt;/p&gt;

&lt;p&gt;An example, drawn heavily from &lt;a href=&quot;http://stackoverflow.com/a/14252221/474189&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this StackOverflow answer&lt;/a&gt;, demonstrates this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;T&amp;gt; T[] arrayOfTwo(T a, T b) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ArrayUtils.toArray(a, b);
}

@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testBadVarArgs() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    @SuppressWarnings(&lt;span class=&quot;code-quote&quot;&gt;&quot;unused&quot;&lt;/span&gt;) &lt;span class=&quot;code-comment&quot;&gt;// Need to assign to trigger exception
&lt;/span&gt;    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] result = arrayOfTwo(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;the above code throws an exception: &lt;tt&gt;java.lang.ClassCastException: [Ljava.lang.Object; cannot be cast to [Ljava.lang.String;&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13027421">LANG-1295</key>
            <summary>ArrayUtils.toArray(T... items) has unsafe use of varargs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dmjones500">Duncan Jones</reporter>
                        <labels>
                    </labels>
                <created>Mon, 12 Dec 2016 11:09:00 +0000</created>
                <updated>Fri, 8 Sep 2017 17:10:56 +0000</updated>
                                            <version>3.5</version>
                                                    <component>lang.*</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15742049" author="dmjones500" created="Mon, 12 Dec 2016 14:29:11 +0000"  >&lt;p&gt;Unfortunately, this method seems to do exactly what you&apos;re not supposed to do with varargs.&lt;/p&gt;

&lt;p&gt;We may have to deprecate this and warn people off using it.&lt;/p&gt;

&lt;p&gt;I&apos;m going to create another issue for the &lt;tt&gt;addAll&lt;/tt&gt; method, since the solution (and discussion thereof) is likely to be different.&lt;/p&gt;</comment>
                            <comment id="15743414" author="pascalschumacher" created="Mon, 12 Dec 2016 22:48:54 +0000"  >&lt;p&gt;A version of commons-lang containing this method with the @SafeVarargs annotation has not been released yet, so the annotation can just be removed.&lt;/p&gt;</comment>
                            <comment id="15747364" author="dmjones500" created="Wed, 14 Dec 2016 05:48:38 +0000"  >&lt;p&gt;Agreed, but the bigger question on this issue and &lt;a href=&quot;https://issues.apache.org/jira/browse/LANG-1296&quot; title=&quot;ArrayUtils.addAll() has unsafe use of varargs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LANG-1296&quot;&gt;LANG-1296&lt;/a&gt; is can we fix the underlying problem and, if not, how best to cope with that.&lt;/p&gt;</comment>
                            <comment id="15758385" author="dmjones500" created="Sun, 18 Dec 2016 07:20:51 +0000"  >&lt;p&gt;The only solution I can think of here is to deprecate the original method and instead offer:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @SafeVarargs
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;T&amp;gt; T[] toArrayOf(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;T&amp;gt; clazz, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; T... items) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (items == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        }
        
        @SuppressWarnings(&lt;span class=&quot;code-quote&quot;&gt;&quot;unchecked&quot;&lt;/span&gt;)
        T[] result = (T[]) Array.newInstance(clazz, items.length);
        
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.arraycopy(items, 0, result, 0, items.length);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; result;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I believe this new method is safe, since it only relies on the items being of type &lt;tt&gt;T&lt;/tt&gt;, but doesn&apos;t care whether &lt;tt&gt;items&lt;/tt&gt; is a &lt;tt&gt;T[]&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Thoughts and comments on this issue very welcome!&lt;/p&gt;</comment>
                            <comment id="15832097" author="pascalschumacher" created="Fri, 20 Jan 2017 16:53:18 +0000"  >&lt;p&gt;As I first step I have just removed the SafeVarargs annotation from the method.&lt;/p&gt;</comment>
                            <comment id="16023556" author="joehni" created="Wed, 24 May 2017 19:54:26 +0000"  >&lt;p&gt;I am definitely -1 for deprecation. We have a lot of unit tests for this method, that demonstrate, what actually works (incl. indirect generic calls). In the case above, you get a compiler warning for the return value of the method arrayOfTwo if the @SafeVarargs is missing.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13027464">LANG-1296</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 25 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i37h5z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>