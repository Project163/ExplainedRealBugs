{% extends "base.html" %}
{% block title %}Bug {{ bug["project_id"] }}-{{ bug["bug_id"] }}{% endblock %}

{% block content %}
<h1>Bug {{ bug["project_id"] }}-{{ bug["bug_id"] }}</h1>

<div class="row mb-3">
  <div class="col-md-6">
    <h5>{% if lang == 'zh' %}基本信息{% else %}Basic Info{% endif %}</h5>
    <ul class="list-group list-group-flush">
      <li class="list-group-item"><strong>Project:</strong> {{ bug["project_id"] }}</li>
      <li class="list-group-item"><strong>Bug ID:</strong> {{ bug["bug_id"] }}</li>
      <li class="list-group-item"><strong>Issue:</strong>
        {% if bug["issue_id"] %}
          <a href="{{ bug["issue_url"] }}" target="_blank">{{ bug["issue_id"] }}</a>
        {% else %}
          N/A
        {% endif %}
      </li>
      <li class="list-group-item"><strong>LLM Label:</strong> {{ bug["llm_label"] or '-' }}</li>
      <li class="list-group-item"><strong>Manual Label:</strong> {{ bug["manual_label"] or '-' }}</li>
      <li class="list-group-item"><strong>Status:</strong> {{ bug["status"] or '-' }}</li>
    </ul>
  </div>
  <div class="col-md-6">
    <h5>{% if lang == 'zh' %}仓库信息{% else %}Repository{% endif %}</h5>
    <ul class="list-group list-group-flush">
      <li class="list-group-item"><strong>Buggy Commit:</strong>
        {% if bug["revision_buggy"] %}
          <a href="{{ bug["buggy_commit_url"] }}" target="_blank">{{ bug["revision_buggy"] }}</a>
        {% else %}N/A{% endif %}
      </li>
      <li class="list-group-item"><strong>Fixed Commit:</strong>
        {% if bug["revision_fixed"] %}
          <a href="{{ bug["fixed_commit_url"] }}" target="_blank">{{ bug["revision_fixed"] }}</a>
        {% else %}N/A{% endif %}
      </li>
      <li class="list-group-item"><strong>Compare:</strong>
        {% if bug["compare_url"] %}
          <a href="{{ bug["compare_url"] }}" target="_blank">Diff</a>
        {% else %}N/A{% endif %}
      </li>
      <li class="list-group-item"><strong>Patch file:</strong>
        {% set patch_path = '/bug-mining/' ~ bug["project_id"] ~ '/patches/' ~ bug["bug_id"] ~ '.src.patch' %}
        {{ patch_path }}
      </li>
    </ul>
  </div>
</div>

<div class="row mb-3">
  <div class="col-md-8">
    <h5>Title</h5>
    <p>{{ bug["title"] }}</p>
    <h5>Description</h5>
    <pre class="border p-2" style="white-space: pre-wrap;">{{ bug["description"] }}</pre>
    <h5>Discussion</h5>
    <pre class="border p-2" style="white-space: pre-wrap;">{{ bug["discussion"] }}</pre>
  </div>
  <div class="col-md-4">
    <h5>{% if lang == 'zh' %}管理信息{% else %}Management{% endif %}</h5>
    <form method="post" action="/bugs/{{ bug["project_id"] }}/{{ bug["bug_id"] }}/meta?lang={{ lang }}">
      <div class="mb-2">
        <label class="form-label">Manual Label</label>
        <input class="form-control" type="text" name="manual_label" value="{{ bug["manual_label"] or '' }}" />
      </div>
      <div class="mb-2">
        <label class="form-label">Status</label>
        <input class="form-control" type="text" name="status" value="{{ bug["status"] or '' }}" placeholder="unreviewed/reviewed/..." />
      </div>
      <div class="mb-2">
        <label class="form-label">{% if lang == 'zh' %}备注{% else %}Notes{% endif %}</label>
        <textarea class="form-control" name="notes" rows="3">{{ bug["notes"] or '' }}</textarea>
      </div>
      <div class="mb-2">
        <label class="form-label">Tags (comma separated)</label>
        <input class="form-control" type="text" name="tags" value="{{ ", ".join(tags) }}" />
      </div>
      <button class="btn btn-primary" type="submit">{% if lang == 'zh' %}保存{% else %}Save{% endif %}</button>
    </form>
  </div>
</div>

{% endblock %}
